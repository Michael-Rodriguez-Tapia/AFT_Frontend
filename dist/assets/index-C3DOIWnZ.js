var nL=Object.defineProperty;var rL=(d,s,u)=>s in d?nL(d,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):d[s]=u;var Ln=(d,s,u)=>rL(d,typeof s!="symbol"?s+"":s,u);function oL(d,s){for(var u=0;u<s.length;u++){const _=s[u];if(typeof _!="string"&&!Array.isArray(_)){for(const v in _)if(v!=="default"&&!(v in d)){const E=Object.getOwnPropertyDescriptor(_,v);E&&Object.defineProperty(d,v,E.get?E:{enumerable:!0,get:()=>_[v]})}}}return Object.freeze(Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))_(v);new MutationObserver(v=>{for(const E of v)if(E.type==="childList")for(const A of E.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&_(A)}).observe(document,{childList:!0,subtree:!0});function u(v){const E={};return v.integrity&&(E.integrity=v.integrity),v.referrerPolicy&&(E.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?E.credentials="include":v.crossOrigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function _(v){if(v.ep)return;v.ep=!0;const E=u(v);fetch(v.href,E)}})();var aL=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function IO(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var RO={exports:{}},hR={},DO={exports:{}},EA={exports:{}};EA.exports;(function(d,s){/**
 * @license React
 * react.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var u="18.3.1",_=Symbol.for("react.element"),v=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),L=Symbol.for("react.provider"),N=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),re=Symbol.for("react.suspense_list"),he=Symbol.for("react.memo"),de=Symbol.for("react.lazy"),ve=Symbol.for("react.offscreen"),xe=Symbol.iterator,$e="@@iterator";function Le(ge){if(ge===null||typeof ge!="object")return null;var Je=xe&&ge[xe]||ge[$e];return typeof Je=="function"?Je:null}var Ke={current:null},Ge={transition:null},Ye={current:null,isBatchingLegacy:!1,didScheduleLegacyUpdate:!1},mt={current:null},Ct={},Vt=null;function ui(ge){Vt=ge}Ct.setExtraStackFrame=function(ge){Vt=ge},Ct.getCurrentStack=null,Ct.getStackAddendum=function(){var ge="";Vt&&(ge+=Vt);var Je=Ct.getCurrentStack;return Je&&(ge+=Je()||""),ge};var Di=!1,si=!1,di=!1,Nt=!1,Ii=!1,Qt={ReactCurrentDispatcher:Ke,ReactCurrentBatchConfig:Ge,ReactCurrentOwner:mt};Qt.ReactDebugCurrentFrame=Ct,Qt.ReactCurrentActQueue=Ye;function _t(ge){{for(var Je=arguments.length,Ut=new Array(Je>1?Je-1:0),Jt=1;Jt<Je;Jt++)Ut[Jt-1]=arguments[Jt];fi("warn",ge,Ut)}}function Et(ge){{for(var Je=arguments.length,Ut=new Array(Je>1?Je-1:0),Jt=1;Jt<Je;Jt++)Ut[Jt-1]=arguments[Jt];fi("error",ge,Ut)}}function fi(ge,Je,Ut){{var Jt=Qt.ReactDebugCurrentFrame,Mi=Jt.getStackAddendum();Mi!==""&&(Je+="%s",Ut=Ut.concat([Mi]));var vn=Ut.map(function(ki){return String(ki)});vn.unshift("Warning: "+Je),Function.prototype.apply.call(console[ge],console,vn)}}var rn={};function zn(ge,Je){{var Ut=ge.constructor,Jt=Ut&&(Ut.displayName||Ut.name)||"ReactClass",Mi=Jt+"."+Je;if(rn[Mi])return;Et("Can't call %s on a component that is not yet mounted. This is a no-op, but it might indicate a bug in your application. Instead, assign to `this.state` directly or define a `state = {};` class property with the desired state in the %s component.",Je,Jt),rn[Mi]=!0}}var er={isMounted:function(ge){return!1},enqueueForceUpdate:function(ge,Je,Ut){zn(ge,"forceUpdate")},enqueueReplaceState:function(ge,Je,Ut,Jt){zn(ge,"replaceState")},enqueueSetState:function(ge,Je,Ut,Jt){zn(ge,"setState")}},Mn=Object.assign,pn={};Object.freeze(pn);function pr(ge,Je,Ut){this.props=ge,this.context=Je,this.refs=pn,this.updater=Ut||er}pr.prototype.isReactComponent={},pr.prototype.setState=function(ge,Je){if(typeof ge!="object"&&typeof ge!="function"&&ge!=null)throw new Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ge,Je,"setState")},pr.prototype.forceUpdate=function(ge){this.updater.enqueueForceUpdate(this,ge,"forceUpdate")};{var Vr={isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in componentWillUnmount to prevent memory leaks."],replaceState:["replaceState","Refactor your code to use setState instead (see https://github.com/facebook/react/issues/3236)."]},Or=function(ge,Je){Object.defineProperty(pr.prototype,ge,{get:function(){_t("%s(...) is deprecated in plain JavaScript React classes. %s",Je[0],Je[1])}})};for(var kr in Vr)Vr.hasOwnProperty(kr)&&Or(kr,Vr[kr])}function Wr(){}Wr.prototype=pr.prototype;function mn(ge,Je,Ut){this.props=ge,this.context=Je,this.refs=pn,this.updater=Ut||er}var Ei=mn.prototype=new Wr;Ei.constructor=mn,Mn(Ei,pr.prototype),Ei.isPureReactComponent=!0;function Xi(){var ge={current:null};return Object.seal(ge),ge}var Rn=Array.isArray;function on(ge){return Rn(ge)}function Ur(ge){{var Je=typeof Symbol=="function"&&Symbol.toStringTag,Ut=Je&&ge[Symbol.toStringTag]||ge.constructor.name||"Object";return Ut}}function gr(ge){try{return tr(ge),!1}catch{return!0}}function tr(ge){return""+ge}function co(ge){if(gr(ge))return Et("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",Ur(ge)),tr(ge)}function Fr(ge,Je,Ut){var Jt=ge.displayName;if(Jt)return Jt;var Mi=Je.displayName||Je.name||"";return Mi!==""?Ut+"("+Mi+")":Ut}function Da(ge){return ge.displayName||"Context"}function ma(ge){if(ge==null)return null;if(typeof ge.tag=="number"&&Et("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof ge=="function")return ge.displayName||ge.name||null;if(typeof ge=="string")return ge;switch(ge){case E:return"Fragment";case v:return"Portal";case r:return"Profiler";case A:return"StrictMode";case X:return"Suspense";case re:return"SuspenseList"}if(typeof ge=="object")switch(ge.$$typeof){case N:var Je=ge;return Da(Je)+".Consumer";case L:var Ut=ge;return Da(Ut._context)+".Provider";case H:return Fr(ge,ge.render,"ForwardRef");case he:var Jt=ge.displayName||null;return Jt!==null?Jt:ma(ge.type)||"Memo";case de:{var Mi=ge,vn=Mi._payload,ki=Mi._init;try{return ma(ki(vn))}catch{return null}}}return null}var _o=Object.prototype.hasOwnProperty,Oo={key:!0,ref:!0,__self:!0,__source:!0},ba,Uo,Io;Io={};function jo(ge){if(_o.call(ge,"ref")){var Je=Object.getOwnPropertyDescriptor(ge,"ref").get;if(Je&&Je.isReactWarning)return!1}return ge.ref!==void 0}function Yo(ge){if(_o.call(ge,"key")){var Je=Object.getOwnPropertyDescriptor(ge,"key").get;if(Je&&Je.isReactWarning)return!1}return ge.key!==void 0}function xs(ge,Je){var Ut=function(){ba||(ba=!0,Et("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",Je))};Ut.isReactWarning=!0,Object.defineProperty(ge,"key",{get:Ut,configurable:!0})}function $o(ge,Je){var Ut=function(){Uo||(Uo=!0,Et("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",Je))};Ut.isReactWarning=!0,Object.defineProperty(ge,"ref",{get:Ut,configurable:!0})}function Fi(ge){if(typeof ge.ref=="string"&&mt.current&&ge.__self&&mt.current.stateNode!==ge.__self){var Je=ma(mt.current.type);Io[Je]||(Et('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',Je,ge.ref),Io[Je]=!0)}}var an=function(ge,Je,Ut,Jt,Mi,vn,ki){var Zn={$$typeof:_,type:ge,key:Je,ref:Ut,props:ki,_owner:vn};return Zn._store={},Object.defineProperty(Zn._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(Zn,"_self",{configurable:!1,enumerable:!1,writable:!1,value:Jt}),Object.defineProperty(Zn,"_source",{configurable:!1,enumerable:!1,writable:!1,value:Mi}),Object.freeze&&(Object.freeze(Zn.props),Object.freeze(Zn)),Zn};function ir(ge,Je,Ut){var Jt,Mi={},vn=null,ki=null,Zn=null,Dr=null;if(Je!=null){jo(Je)&&(ki=Je.ref,Fi(Je)),Yo(Je)&&(co(Je.key),vn=""+Je.key),Zn=Je.__self===void 0?null:Je.__self,Dr=Je.__source===void 0?null:Je.__source;for(Jt in Je)_o.call(Je,Jt)&&!Oo.hasOwnProperty(Jt)&&(Mi[Jt]=Je[Jt])}var po=arguments.length-2;if(po===1)Mi.children=Ut;else if(po>1){for(var Qi=Array(po),Fo=0;Fo<po;Fo++)Qi[Fo]=arguments[Fo+2];Object.freeze&&Object.freeze(Qi),Mi.children=Qi}if(ge&&ge.defaultProps){var Er=ge.defaultProps;for(Jt in Er)Mi[Jt]===void 0&&(Mi[Jt]=Er[Jt])}if(vn||ki){var Jo=typeof ge=="function"?ge.displayName||ge.name||"Unknown":ge;vn&&xs(Mi,Jo),ki&&$o(Mi,Jo)}return an(ge,vn,ki,Zn,Dr,mt.current,Mi)}function jr(ge,Je){var Ut=an(ge.type,Je,ge.ref,ge._self,ge._source,ge._owner,ge.props);return Ut}function jn(ge,Je,Ut){if(ge==null)throw new Error("React.cloneElement(...): The argument must be a React element, but you passed "+ge+".");var Jt,Mi=Mn({},ge.props),vn=ge.key,ki=ge.ref,Zn=ge._self,Dr=ge._source,po=ge._owner;if(Je!=null){jo(Je)&&(ki=Je.ref,po=mt.current),Yo(Je)&&(co(Je.key),vn=""+Je.key);var Qi;ge.type&&ge.type.defaultProps&&(Qi=ge.type.defaultProps);for(Jt in Je)_o.call(Je,Jt)&&!Oo.hasOwnProperty(Jt)&&(Je[Jt]===void 0&&Qi!==void 0?Mi[Jt]=Qi[Jt]:Mi[Jt]=Je[Jt])}var Fo=arguments.length-2;if(Fo===1)Mi.children=Ut;else if(Fo>1){for(var Er=Array(Fo),Jo=0;Jo<Fo;Jo++)Er[Jo]=arguments[Jo+2];Mi.children=Er}return an(ge.type,vn,ki,Zn,Dr,po,Mi)}function yo(ge){return typeof ge=="object"&&ge!==null&&ge.$$typeof===_}var To=".",Wo=":";function qr(ge){var Je=/[=:]/g,Ut={"=":"=0",":":"=2"},Jt=ge.replace(Je,function(Mi){return Ut[Mi]});return"$"+Jt}var wr=!1,bn=/\/+/g;function uo(ge){return ge.replace(bn,"$&/")}function wa(ge,Je){return typeof ge=="object"&&ge!==null&&ge.key!=null?(co(ge.key),qr(""+ge.key)):Je.toString(36)}function ga(ge,Je,Ut,Jt,Mi){var vn=typeof ge;(vn==="undefined"||vn==="boolean")&&(ge=null);var ki=!1;if(ge===null)ki=!0;else switch(vn){case"string":case"number":ki=!0;break;case"object":switch(ge.$$typeof){case _:case v:ki=!0}}if(ki){var Zn=ge,Dr=Mi(Zn),po=Jt===""?To+wa(Zn,0):Jt;if(on(Dr)){var Qi="";po!=null&&(Qi=uo(po)+"/"),ga(Dr,Je,Qi,"",function(Xn){return Xn})}else Dr!=null&&(yo(Dr)&&(Dr.key&&(!Zn||Zn.key!==Dr.key)&&co(Dr.key),Dr=jr(Dr,Ut+(Dr.key&&(!Zn||Zn.key!==Dr.key)?uo(""+Dr.key)+"/":"")+po)),Je.push(Dr));return 1}var Fo,Er,Jo=0,Si=Jt===""?To:Jt+Wo;if(on(ge))for(var lc=0;lc<ge.length;lc++)Fo=ge[lc],Er=Si+wa(Fo,lc),Jo+=ga(Fo,Je,Ut,Er,Mi);else{var vl=Le(ge);if(typeof vl=="function"){var Oa=ge;vl===Oa.entries&&(wr||_t("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),wr=!0);for(var ws=vl.call(Oa),kc,Ti=0;!(kc=ws.next()).done;)Fo=kc.value,Er=Si+wa(Fo,Ti++),Jo+=ga(Fo,Je,Ut,Er,Mi)}else if(vn==="object"){var Pn=String(ge);throw new Error("Objects are not valid as a React child (found: "+(Pn==="[object Object]"?"object with keys {"+Object.keys(ge).join(", ")+"}":Pn)+"). If you meant to render a collection of children, use an array instead.")}}return Jo}function ra(ge,Je,Ut){if(ge==null)return ge;var Jt=[],Mi=0;return ga(ge,Jt,"","",function(vn){return Je.call(Ut,vn,Mi++)}),Jt}function tc(ge){var Je=0;return ra(ge,function(){Je++}),Je}function ml(ge,Je,Ut){ra(ge,function(){Je.apply(this,arguments)},Ut)}function ic(ge){return ra(ge,function(Je){return Je})||[]}function Ks(ge){if(!yo(ge))throw new Error("React.Children.only expected to receive a single React element child.");return ge}function Tt(ge){var Je={$$typeof:N,_currentValue:ge,_currentValue2:ge,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null};Je.Provider={$$typeof:L,_context:Je};var Ut=!1,Jt=!1,Mi=!1;{var vn={$$typeof:N,_context:Je};Object.defineProperties(vn,{Provider:{get:function(){return Jt||(Jt=!0,Et("Rendering <Context.Consumer.Provider> is not supported and will be removed in a future major release. Did you mean to render <Context.Provider> instead?")),Je.Provider},set:function(ki){Je.Provider=ki}},_currentValue:{get:function(){return Je._currentValue},set:function(ki){Je._currentValue=ki}},_currentValue2:{get:function(){return Je._currentValue2},set:function(ki){Je._currentValue2=ki}},_threadCount:{get:function(){return Je._threadCount},set:function(ki){Je._threadCount=ki}},Consumer:{get:function(){return Ut||(Ut=!0,Et("Rendering <Context.Consumer.Consumer> is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?")),Je.Consumer}},displayName:{get:function(){return Je.displayName},set:function(ki){Mi||(_t("Setting `displayName` on Context.Consumer has no effect. You should set it directly on the context with Context.displayName = '%s'.",ki),Mi=!0)}}}),Je.Consumer=vn}return Je._currentRenderer=null,Je._currentRenderer2=null,Je}var Ta=-1,Ga=0,Ma=1,hn=2;function Ko(ge){if(ge._status===Ta){var Je=ge._result,Ut=Je();if(Ut.then(function(vn){if(ge._status===Ga||ge._status===Ta){var ki=ge;ki._status=Ma,ki._result=vn}},function(vn){if(ge._status===Ga||ge._status===Ta){var ki=ge;ki._status=hn,ki._result=vn}}),ge._status===Ta){var Jt=ge;Jt._status=Ga,Jt._result=Ut}}if(ge._status===Ma){var Mi=ge._result;return Mi===void 0&&Et(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))

Did you accidentally put curly braces around the import?`,Mi),"default"in Mi||Et(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))`,Mi),Mi.default}else throw ge._result}function it(ge){var Je={_status:Ta,_result:ge},Ut={$$typeof:de,_payload:Je,_init:Ko};{var Jt,Mi;Object.defineProperties(Ut,{defaultProps:{configurable:!0,get:function(){return Jt},set:function(vn){Et("React.lazy(...): It is not supported to assign `defaultProps` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),Jt=vn,Object.defineProperty(Ut,"defaultProps",{enumerable:!0})}},propTypes:{configurable:!0,get:function(){return Mi},set:function(vn){Et("React.lazy(...): It is not supported to assign `propTypes` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),Mi=vn,Object.defineProperty(Ut,"propTypes",{enumerable:!0})}}})}return Ut}function bi(ge){ge!=null&&ge.$$typeof===he?Et("forwardRef requires a render function but received a `memo` component. Instead of forwardRef(memo(...)), use memo(forwardRef(...))."):typeof ge!="function"?Et("forwardRef requires a render function but was given %s.",ge===null?"null":typeof ge):ge.length!==0&&ge.length!==2&&Et("forwardRef render functions accept exactly two parameters: props and ref. %s",ge.length===1?"Did you forget to use the ref parameter?":"Any additional parameter will be undefined."),ge!=null&&(ge.defaultProps!=null||ge.propTypes!=null)&&Et("forwardRef render functions do not support propTypes or defaultProps. Did you accidentally pass a React component?");var Je={$$typeof:H,render:ge};{var Ut;Object.defineProperty(Je,"displayName",{enumerable:!1,configurable:!0,get:function(){return Ut},set:function(Jt){Ut=Jt,!ge.name&&!ge.displayName&&(ge.displayName=Jt)}})}return Je}var ie;ie=Symbol.for("react.module.reference");function W(ge){return!!(typeof ge=="string"||typeof ge=="function"||ge===E||ge===r||Ii||ge===A||ge===X||ge===re||Nt||ge===ve||Di||si||di||typeof ge=="object"&&ge!==null&&(ge.$$typeof===de||ge.$$typeof===he||ge.$$typeof===L||ge.$$typeof===N||ge.$$typeof===H||ge.$$typeof===ie||ge.getModuleId!==void 0))}function Y(ge,Je){W(ge)||Et("memo: The first argument must be a component. Instead received: %s",ge===null?"null":typeof ge);var Ut={$$typeof:he,type:ge,compare:Je===void 0?null:Je};{var Jt;Object.defineProperty(Ut,"displayName",{enumerable:!1,configurable:!0,get:function(){return Jt},set:function(Mi){Jt=Mi,!ge.name&&!ge.displayName&&(ge.displayName=Mi)}})}return Ut}function ue(){var ge=Ke.current;return ge===null&&Et(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.`),ge}function we(ge){var Je=ue();if(ge._context!==void 0){var Ut=ge._context;Ut.Consumer===ge?Et("Calling useContext(Context.Consumer) is not supported, may cause bugs, and will be removed in a future major release. Did you mean to call useContext(Context) instead?"):Ut.Provider===ge&&Et("Calling useContext(Context.Provider) is not supported. Did you mean to call useContext(Context) instead?")}return Je.useContext(ge)}function ye(ge){var Je=ue();return Je.useState(ge)}function Me(ge,Je,Ut){var Jt=ue();return Jt.useReducer(ge,Je,Ut)}function je(ge){var Je=ue();return Je.useRef(ge)}function ze(ge,Je){var Ut=ue();return Ut.useEffect(ge,Je)}function We(ge,Je){var Ut=ue();return Ut.useInsertionEffect(ge,Je)}function xt(ge,Je){var Ut=ue();return Ut.useLayoutEffect(ge,Je)}function ht(ge,Je){var Ut=ue();return Ut.useCallback(ge,Je)}function ti(ge,Je){var Ut=ue();return Ut.useMemo(ge,Je)}function Ri(ge,Je,Ut){var Jt=ue();return Jt.useImperativeHandle(ge,Je,Ut)}function xi(ge,Je){{var Ut=ue();return Ut.useDebugValue(ge,Je)}}function ei(){var ge=ue();return ge.useTransition()}function Yi(ge){var Je=ue();return Je.useDeferredValue(ge)}function un(){var ge=ue();return ge.useId()}function hr(ge,Je,Ut){var Jt=ue();return Jt.useSyncExternalStore(ge,Je,Ut)}var Lr=0,Ro,ho,to,nr,Sn,Rr,Zr;function sr(){}sr.__reactDisabledLog=!0;function Sr(){{if(Lr===0){Ro=console.log,ho=console.info,to=console.warn,nr=console.error,Sn=console.group,Rr=console.groupCollapsed,Zr=console.groupEnd;var ge={configurable:!0,enumerable:!0,value:sr,writable:!0};Object.defineProperties(console,{info:ge,log:ge,warn:ge,error:ge,group:ge,groupCollapsed:ge,groupEnd:ge})}Lr++}}function fo(){{if(Lr--,Lr===0){var ge={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Mn({},ge,{value:Ro}),info:Mn({},ge,{value:ho}),warn:Mn({},ge,{value:to}),error:Mn({},ge,{value:nr}),group:Mn({},ge,{value:Sn}),groupCollapsed:Mn({},ge,{value:Rr}),groupEnd:Mn({},ge,{value:Zr})})}Lr<0&&Et("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var oa=Qt.ReactCurrentDispatcher,Ha;function Fl(ge,Je,Ut){{if(Ha===void 0)try{throw Error()}catch(Mi){var Jt=Mi.stack.trim().match(/\n( *(at )?)/);Ha=Jt&&Jt[1]||""}return`
`+Ha+ge}}var ko=!1,os;{var Pa=typeof WeakMap=="function"?WeakMap:Map;os=new Pa}function Js(ge,Je){if(!ge||ko)return"";{var Ut=os.get(ge);if(Ut!==void 0)return Ut}var Jt;ko=!0;var Mi=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var vn;vn=oa.current,oa.current=null,Sr();try{if(Je){var ki=function(){throw Error()};if(Object.defineProperty(ki.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ki,[])}catch(Si){Jt=Si}Reflect.construct(ge,[],ki)}else{try{ki.call()}catch(Si){Jt=Si}ge.call(ki.prototype)}}else{try{throw Error()}catch(Si){Jt=Si}ge()}}catch(Si){if(Si&&Jt&&typeof Si.stack=="string"){for(var Zn=Si.stack.split(`
`),Dr=Jt.stack.split(`
`),po=Zn.length-1,Qi=Dr.length-1;po>=1&&Qi>=0&&Zn[po]!==Dr[Qi];)Qi--;for(;po>=1&&Qi>=0;po--,Qi--)if(Zn[po]!==Dr[Qi]){if(po!==1||Qi!==1)do if(po--,Qi--,Qi<0||Zn[po]!==Dr[Qi]){var Fo=`
`+Zn[po].replace(" at new "," at ");return ge.displayName&&Fo.includes("<anonymous>")&&(Fo=Fo.replace("<anonymous>",ge.displayName)),typeof ge=="function"&&os.set(ge,Fo),Fo}while(po>=1&&Qi>=0);break}}}finally{ko=!1,oa.current=vn,fo(),Error.prepareStackTrace=Mi}var Er=ge?ge.displayName||ge.name:"",Jo=Er?Fl(Er):"";return typeof ge=="function"&&os.set(ge,Jo),Jo}function Ka(ge,Je,Ut){return Js(ge,!1)}function bs(ge){var Je=ge.prototype;return!!(Je&&Je.isReactComponent)}function Ic(ge,Je,Ut){if(ge==null)return"";if(typeof ge=="function")return Js(ge,bs(ge));if(typeof ge=="string")return Fl(ge);switch(ge){case X:return Fl("Suspense");case re:return Fl("SuspenseList")}if(typeof ge=="object")switch(ge.$$typeof){case H:return Ka(ge.render);case he:return Ic(ge.type,Je,Ut);case de:{var Jt=ge,Mi=Jt._payload,vn=Jt._init;try{return Ic(vn(Mi),Je,Ut)}catch{}}}return""}var ch={},xu=Qt.ReactDebugCurrentFrame;function Gr(ge){if(ge){var Je=ge._owner,Ut=Ic(ge.type,ge._source,Je?Je.type:null);xu.setExtraStackFrame(Ut)}else xu.setExtraStackFrame(null)}function as(ge,Je,Ut,Jt,Mi){{var vn=Function.call.bind(_o);for(var ki in ge)if(vn(ge,ki)){var Zn=void 0;try{if(typeof ge[ki]!="function"){var Dr=Error((Jt||"React class")+": "+Ut+" type `"+ki+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof ge[ki]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw Dr.name="Invariant Violation",Dr}Zn=ge[ki](Je,ki,Jt,Ut,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(po){Zn=po}Zn&&!(Zn instanceof Error)&&(Gr(Mi),Et("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",Jt||"React class",Ut,ki,typeof Zn),Gr(null)),Zn instanceof Error&&!(Zn.message in ch)&&(ch[Zn.message]=!0,Gr(Mi),Et("Failed %s type: %s",Ut,Zn.message),Gr(null))}}}function $a(ge){if(ge){var Je=ge._owner,Ut=Ic(ge.type,ge._source,Je?Je.type:null);ui(Ut)}else ui(null)}var yn;yn=!1;function ss(){if(mt.current){var ge=ma(mt.current.type);if(ge)return`

Check the render method of \``+ge+"`."}return""}function aa(ge){if(ge!==void 0){var Je=ge.fileName.replace(/^.*[\\\/]/,""),Ut=ge.lineNumber;return`

Check your code at `+Je+":"+Ut+"."}return""}function gl(ge){return ge!=null?aa(ge.__source):""}var nc={};function $d(ge){var Je=ss();if(!Je){var Ut=typeof ge=="string"?ge:ge.displayName||ge.name;Ut&&(Je=`

Check the top-level render call using <`+Ut+">.")}return Je}function Go(ge,Je){if(!(!ge._store||ge._store.validated||ge.key!=null)){ge._store.validated=!0;var Ut=$d(Je);if(!nc[Ut]){nc[Ut]=!0;var Jt="";ge&&ge._owner&&ge._owner!==mt.current&&(Jt=" It was passed a child from "+ma(ge._owner.type)+"."),$a(ge),Et('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',Ut,Jt),$a(null)}}}function vo(ge,Je){if(typeof ge=="object"){if(on(ge))for(var Ut=0;Ut<ge.length;Ut++){var Jt=ge[Ut];yo(Jt)&&Go(Jt,Je)}else if(yo(ge))ge._store&&(ge._store.validated=!0);else if(ge){var Mi=Le(ge);if(typeof Mi=="function"&&Mi!==ge.entries)for(var vn=Mi.call(ge),ki;!(ki=vn.next()).done;)yo(ki.value)&&Go(ki.value,Je)}}}function Wd(ge){{var Je=ge.type;if(Je==null||typeof Je=="string")return;var Ut;if(typeof Je=="function")Ut=Je.propTypes;else if(typeof Je=="object"&&(Je.$$typeof===H||Je.$$typeof===he))Ut=Je.propTypes;else return;if(Ut){var Jt=ma(Je);as(Ut,ge.props,"prop",Jt,ge)}else if(Je.PropTypes!==void 0&&!yn){yn=!0;var Mi=ma(Je);Et("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",Mi||"Unknown")}typeof Je.getDefaultProps=="function"&&!Je.getDefaultProps.isReactClassApproved&&Et("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function _l(ge){{for(var Je=Object.keys(ge.props),Ut=0;Ut<Je.length;Ut++){var Jt=Je[Ut];if(Jt!=="children"&&Jt!=="key"){$a(ge),Et("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",Jt),$a(null);break}}ge.ref!==null&&($a(ge),Et("Invalid attribute `ref` supplied to `React.Fragment`."),$a(null))}}function qo(ge,Je,Ut){var Jt=W(ge);if(!Jt){var Mi="";(ge===void 0||typeof ge=="object"&&ge!==null&&Object.keys(ge).length===0)&&(Mi+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var vn=gl(Je);vn?Mi+=vn:Mi+=ss();var ki;ge===null?ki="null":on(ge)?ki="array":ge!==void 0&&ge.$$typeof===_?(ki="<"+(ma(ge.type)||"Unknown")+" />",Mi=" Did you accidentally export a JSX literal instead of a component?"):ki=typeof ge,Et("React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",ki,Mi)}var Zn=ir.apply(this,arguments);if(Zn==null)return Zn;if(Jt)for(var Dr=2;Dr<arguments.length;Dr++)vo(arguments[Dr],ge);return ge===E?_l(Zn):Wd(Zn),Zn}var yl=!1;function bu(ge){var Je=qo.bind(null,ge);return Je.type=ge,yl||(yl=!0,_t("React.createFactory() is deprecated and will be removed in a future major release. Consider using JSX or use React.createElement() directly instead.")),Object.defineProperty(Je,"type",{enumerable:!1,get:function(){return _t("Factory.type is deprecated. Access the class directly before passing it to createFactory."),Object.defineProperty(this,"type",{value:ge}),ge}}),Je}function rc(ge,Je,Ut){for(var Jt=jn.apply(this,arguments),Mi=2;Mi<arguments.length;Mi++)vo(arguments[Mi],Jt.type);return Wd(Jt),Jt}function qd(ge,Je){var Ut=Ge.transition;Ge.transition={};var Jt=Ge.transition;Ge.transition._updatedFibers=new Set;try{ge()}finally{if(Ge.transition=Ut,Ut===null&&Jt._updatedFibers){var Mi=Jt._updatedFibers.size;Mi>10&&_t("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),Jt._updatedFibers.clear()}}}var wu=!1,oc=null;function Gn(ge){if(oc===null)try{var Je=("require"+Math.random()).slice(0,7),Ut=d&&d[Je];oc=Ut.call(d,"timers").setImmediate}catch{oc=function(Mi){wu===!1&&(wu=!0,typeof MessageChannel>"u"&&Et("This browser does not have a MessageChannel implementation, so enqueuing tasks via await act(async () => ...) will fail. Please file an issue at https://github.com/facebook/react/issues if you encounter this warning."));var vn=new MessageChannel;vn.port1.onmessage=Mi,vn.port2.postMessage(void 0)}}return oc(ge)}var Rc=0,ac=!1;function Tu(ge){{var Je=Rc;Rc++,Ye.current===null&&(Ye.current=[]);var Ut=Ye.isBatchingLegacy,Jt;try{if(Ye.isBatchingLegacy=!0,Jt=ge(),!Ut&&Ye.didScheduleLegacyUpdate){var Mi=Ye.current;Mi!==null&&(Ye.didScheduleLegacyUpdate=!1,Pc(Mi))}}catch(Er){throw sc(Je),Er}finally{Ye.isBatchingLegacy=Ut}if(Jt!==null&&typeof Jt=="object"&&typeof Jt.then=="function"){var vn=Jt,ki=!1,Zn={then:function(Er,Jo){ki=!0,vn.then(function(Si){sc(Je),Rc===0?Dc(Si,Er,Jo):Er(Si)},function(Si){sc(Je),Jo(Si)})}};return!ac&&typeof Promise<"u"&&Promise.resolve().then(function(){}).then(function(){ki||(ac=!0,Et("You called act(async () => ...) without await. This could lead to unexpected testing behaviour, interleaving multiple act calls and mixing their scopes. You should - await act(async () => ...);"))}),Zn}else{var Dr=Jt;if(sc(Je),Rc===0){var po=Ye.current;po!==null&&(Pc(po),Ye.current=null);var Qi={then:function(Er,Jo){Ye.current===null?(Ye.current=[],Dc(Dr,Er,Jo)):Er(Dr)}};return Qi}else{var Fo={then:function(Er,Jo){Er(Dr)}};return Fo}}}}function sc(ge){ge!==Rc-1&&Et("You seem to have overlapping act() calls, this is not supported. Be sure to await previous act() calls before making a new one. "),Rc=ge}function Dc(ge,Je,Ut){{var Jt=Ye.current;if(Jt!==null)try{Pc(Jt),Gn(function(){Jt.length===0?(Ye.current=null,Je(ge)):Dc(ge,Je,Ut)})}catch(Mi){Ut(Mi)}else Je(ge)}}var Mc=!1;function Pc(ge){if(!Mc){Mc=!0;var Je=0;try{for(;Je<ge.length;Je++){var Ut=ge[Je];do Ut=Ut(!0);while(Ut!==null)}ge.length=0}catch(Jt){throw ge=ge.slice(Je+1),Jt}finally{Mc=!1}}}var Oc=qo,dp=rc,uh=bu,Lm={map:ra,forEach:ml,count:tc,toArray:ic,only:Ks};s.Children=Lm,s.Component=pr,s.Fragment=E,s.Profiler=r,s.PureComponent=mn,s.StrictMode=A,s.Suspense=X,s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Qt,s.act=Tu,s.cloneElement=dp,s.createContext=Tt,s.createElement=Oc,s.createFactory=uh,s.createRef=Xi,s.forwardRef=bi,s.isValidElement=yo,s.lazy=it,s.memo=Y,s.startTransition=qd,s.unstable_act=Tu,s.useCallback=ht,s.useContext=we,s.useDebugValue=xi,s.useDeferredValue=Yi,s.useEffect=ze,s.useId=un,s.useImperativeHandle=Ri,s.useInsertionEffect=We,s.useLayoutEffect=xt,s.useMemo=ti,s.useReducer=Me,s.useRef=je,s.useState=ye,s.useSyncExternalStore=hr,s.useTransition=ei,s.version=u,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)})()})(EA,EA.exports);var sL=EA.exports;DO.exports=sL;var ft=DO.exports;const kR=IO(ft),lL=oL({__proto__:null,default:kR},[ft]);/**
 * @license React
 * react-jsx-dev-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){var d=ft,s=Symbol.for("react.element"),u=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),r=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),X=Symbol.for("react.memo"),re=Symbol.for("react.lazy"),he=Symbol.for("react.offscreen"),de=Symbol.iterator,ve="@@iterator";function xe(it){if(it===null||typeof it!="object")return null;var bi=de&&it[de]||it[ve];return typeof bi=="function"?bi:null}var $e=d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Le(it){{for(var bi=arguments.length,ie=new Array(bi>1?bi-1:0),W=1;W<bi;W++)ie[W-1]=arguments[W];Ke("error",it,ie)}}function Ke(it,bi,ie){{var W=$e.ReactDebugCurrentFrame,Y=W.getStackAddendum();Y!==""&&(bi+="%s",ie=ie.concat([Y]));var ue=ie.map(function(we){return String(we)});ue.unshift("Warning: "+bi),Function.prototype.apply.call(console[it],console,ue)}}var Ge=!1,Ye=!1,mt=!1,Ct=!1,Vt=!1,ui;ui=Symbol.for("react.module.reference");function Di(it){return!!(typeof it=="string"||typeof it=="function"||it===_||it===E||Vt||it===v||it===N||it===H||Ct||it===he||Ge||Ye||mt||typeof it=="object"&&it!==null&&(it.$$typeof===re||it.$$typeof===X||it.$$typeof===A||it.$$typeof===r||it.$$typeof===L||it.$$typeof===ui||it.getModuleId!==void 0))}function si(it,bi,ie){var W=it.displayName;if(W)return W;var Y=bi.displayName||bi.name||"";return Y!==""?ie+"("+Y+")":ie}function di(it){return it.displayName||"Context"}function Nt(it){if(it==null)return null;if(typeof it.tag=="number"&&Le("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof it=="function")return it.displayName||it.name||null;if(typeof it=="string")return it;switch(it){case _:return"Fragment";case u:return"Portal";case E:return"Profiler";case v:return"StrictMode";case N:return"Suspense";case H:return"SuspenseList"}if(typeof it=="object")switch(it.$$typeof){case r:var bi=it;return di(bi)+".Consumer";case A:var ie=it;return di(ie._context)+".Provider";case L:return si(it,it.render,"ForwardRef");case X:var W=it.displayName||null;return W!==null?W:Nt(it.type)||"Memo";case re:{var Y=it,ue=Y._payload,we=Y._init;try{return Nt(we(ue))}catch{return null}}}return null}var Ii=Object.assign,Qt=0,_t,Et,fi,rn,zn,er,Mn;function pn(){}pn.__reactDisabledLog=!0;function pr(){{if(Qt===0){_t=console.log,Et=console.info,fi=console.warn,rn=console.error,zn=console.group,er=console.groupCollapsed,Mn=console.groupEnd;var it={configurable:!0,enumerable:!0,value:pn,writable:!0};Object.defineProperties(console,{info:it,log:it,warn:it,error:it,group:it,groupCollapsed:it,groupEnd:it})}Qt++}}function Vr(){{if(Qt--,Qt===0){var it={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Ii({},it,{value:_t}),info:Ii({},it,{value:Et}),warn:Ii({},it,{value:fi}),error:Ii({},it,{value:rn}),group:Ii({},it,{value:zn}),groupCollapsed:Ii({},it,{value:er}),groupEnd:Ii({},it,{value:Mn})})}Qt<0&&Le("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Or=$e.ReactCurrentDispatcher,kr;function Wr(it,bi,ie){{if(kr===void 0)try{throw Error()}catch(Y){var W=Y.stack.trim().match(/\n( *(at )?)/);kr=W&&W[1]||""}return`
`+kr+it}}var mn=!1,Ei;{var Xi=typeof WeakMap=="function"?WeakMap:Map;Ei=new Xi}function Rn(it,bi){if(!it||mn)return"";{var ie=Ei.get(it);if(ie!==void 0)return ie}var W;mn=!0;var Y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var ue;ue=Or.current,Or.current=null,pr();try{if(bi){var we=function(){throw Error()};if(Object.defineProperty(we.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(we,[])}catch(ti){W=ti}Reflect.construct(it,[],we)}else{try{we.call()}catch(ti){W=ti}it.call(we.prototype)}}else{try{throw Error()}catch(ti){W=ti}it()}}catch(ti){if(ti&&W&&typeof ti.stack=="string"){for(var ye=ti.stack.split(`
`),Me=W.stack.split(`
`),je=ye.length-1,ze=Me.length-1;je>=1&&ze>=0&&ye[je]!==Me[ze];)ze--;for(;je>=1&&ze>=0;je--,ze--)if(ye[je]!==Me[ze]){if(je!==1||ze!==1)do if(je--,ze--,ze<0||ye[je]!==Me[ze]){var We=`
`+ye[je].replace(" at new "," at ");return it.displayName&&We.includes("<anonymous>")&&(We=We.replace("<anonymous>",it.displayName)),typeof it=="function"&&Ei.set(it,We),We}while(je>=1&&ze>=0);break}}}finally{mn=!1,Or.current=ue,Vr(),Error.prepareStackTrace=Y}var xt=it?it.displayName||it.name:"",ht=xt?Wr(xt):"";return typeof it=="function"&&Ei.set(it,ht),ht}function on(it,bi,ie){return Rn(it,!1)}function Ur(it){var bi=it.prototype;return!!(bi&&bi.isReactComponent)}function gr(it,bi,ie){if(it==null)return"";if(typeof it=="function")return Rn(it,Ur(it));if(typeof it=="string")return Wr(it);switch(it){case N:return Wr("Suspense");case H:return Wr("SuspenseList")}if(typeof it=="object")switch(it.$$typeof){case L:return on(it.render);case X:return gr(it.type,bi,ie);case re:{var W=it,Y=W._payload,ue=W._init;try{return gr(ue(Y),bi,ie)}catch{}}}return""}var tr=Object.prototype.hasOwnProperty,co={},Fr=$e.ReactDebugCurrentFrame;function Da(it){if(it){var bi=it._owner,ie=gr(it.type,it._source,bi?bi.type:null);Fr.setExtraStackFrame(ie)}else Fr.setExtraStackFrame(null)}function ma(it,bi,ie,W,Y){{var ue=Function.call.bind(tr);for(var we in it)if(ue(it,we)){var ye=void 0;try{if(typeof it[we]!="function"){var Me=Error((W||"React class")+": "+ie+" type `"+we+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof it[we]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw Me.name="Invariant Violation",Me}ye=it[we](bi,we,W,ie,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(je){ye=je}ye&&!(ye instanceof Error)&&(Da(Y),Le("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",W||"React class",ie,we,typeof ye),Da(null)),ye instanceof Error&&!(ye.message in co)&&(co[ye.message]=!0,Da(Y),Le("Failed %s type: %s",ie,ye.message),Da(null))}}}var _o=Array.isArray;function Oo(it){return _o(it)}function ba(it){{var bi=typeof Symbol=="function"&&Symbol.toStringTag,ie=bi&&it[Symbol.toStringTag]||it.constructor.name||"Object";return ie}}function Uo(it){try{return Io(it),!1}catch{return!0}}function Io(it){return""+it}function jo(it){if(Uo(it))return Le("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",ba(it)),Io(it)}var Yo=$e.ReactCurrentOwner,xs={key:!0,ref:!0,__self:!0,__source:!0},$o,Fi,an;an={};function ir(it){if(tr.call(it,"ref")){var bi=Object.getOwnPropertyDescriptor(it,"ref").get;if(bi&&bi.isReactWarning)return!1}return it.ref!==void 0}function jr(it){if(tr.call(it,"key")){var bi=Object.getOwnPropertyDescriptor(it,"key").get;if(bi&&bi.isReactWarning)return!1}return it.key!==void 0}function jn(it,bi){if(typeof it.ref=="string"&&Yo.current&&bi&&Yo.current.stateNode!==bi){var ie=Nt(Yo.current.type);an[ie]||(Le('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',Nt(Yo.current.type),it.ref),an[ie]=!0)}}function yo(it,bi){{var ie=function(){$o||($o=!0,Le("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",bi))};ie.isReactWarning=!0,Object.defineProperty(it,"key",{get:ie,configurable:!0})}}function To(it,bi){{var ie=function(){Fi||(Fi=!0,Le("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",bi))};ie.isReactWarning=!0,Object.defineProperty(it,"ref",{get:ie,configurable:!0})}}var Wo=function(it,bi,ie,W,Y,ue,we){var ye={$$typeof:s,type:it,key:bi,ref:ie,props:we,_owner:ue};return ye._store={},Object.defineProperty(ye._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(ye,"_self",{configurable:!1,enumerable:!1,writable:!1,value:W}),Object.defineProperty(ye,"_source",{configurable:!1,enumerable:!1,writable:!1,value:Y}),Object.freeze&&(Object.freeze(ye.props),Object.freeze(ye)),ye};function qr(it,bi,ie,W,Y){{var ue,we={},ye=null,Me=null;ie!==void 0&&(jo(ie),ye=""+ie),jr(bi)&&(jo(bi.key),ye=""+bi.key),ir(bi)&&(Me=bi.ref,jn(bi,Y));for(ue in bi)tr.call(bi,ue)&&!xs.hasOwnProperty(ue)&&(we[ue]=bi[ue]);if(it&&it.defaultProps){var je=it.defaultProps;for(ue in je)we[ue]===void 0&&(we[ue]=je[ue])}if(ye||Me){var ze=typeof it=="function"?it.displayName||it.name||"Unknown":it;ye&&yo(we,ze),Me&&To(we,ze)}return Wo(it,ye,Me,Y,W,Yo.current,we)}}var wr=$e.ReactCurrentOwner,bn=$e.ReactDebugCurrentFrame;function uo(it){if(it){var bi=it._owner,ie=gr(it.type,it._source,bi?bi.type:null);bn.setExtraStackFrame(ie)}else bn.setExtraStackFrame(null)}var wa;wa=!1;function ga(it){return typeof it=="object"&&it!==null&&it.$$typeof===s}function ra(){{if(wr.current){var it=Nt(wr.current.type);if(it)return`

Check the render method of \``+it+"`."}return""}}function tc(it){{if(it!==void 0){var bi=it.fileName.replace(/^.*[\\\/]/,""),ie=it.lineNumber;return`

Check your code at `+bi+":"+ie+"."}return""}}var ml={};function ic(it){{var bi=ra();if(!bi){var ie=typeof it=="string"?it:it.displayName||it.name;ie&&(bi=`

Check the top-level render call using <`+ie+">.")}return bi}}function Ks(it,bi){{if(!it._store||it._store.validated||it.key!=null)return;it._store.validated=!0;var ie=ic(bi);if(ml[ie])return;ml[ie]=!0;var W="";it&&it._owner&&it._owner!==wr.current&&(W=" It was passed a child from "+Nt(it._owner.type)+"."),uo(it),Le('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',ie,W),uo(null)}}function Tt(it,bi){{if(typeof it!="object")return;if(Oo(it))for(var ie=0;ie<it.length;ie++){var W=it[ie];ga(W)&&Ks(W,bi)}else if(ga(it))it._store&&(it._store.validated=!0);else if(it){var Y=xe(it);if(typeof Y=="function"&&Y!==it.entries)for(var ue=Y.call(it),we;!(we=ue.next()).done;)ga(we.value)&&Ks(we.value,bi)}}}function Ta(it){{var bi=it.type;if(bi==null||typeof bi=="string")return;var ie;if(typeof bi=="function")ie=bi.propTypes;else if(typeof bi=="object"&&(bi.$$typeof===L||bi.$$typeof===X))ie=bi.propTypes;else return;if(ie){var W=Nt(bi);ma(ie,it.props,"prop",W,it)}else if(bi.PropTypes!==void 0&&!wa){wa=!0;var Y=Nt(bi);Le("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",Y||"Unknown")}typeof bi.getDefaultProps=="function"&&!bi.getDefaultProps.isReactClassApproved&&Le("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Ga(it){{for(var bi=Object.keys(it.props),ie=0;ie<bi.length;ie++){var W=bi[ie];if(W!=="children"&&W!=="key"){uo(it),Le("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",W),uo(null);break}}it.ref!==null&&(uo(it),Le("Invalid attribute `ref` supplied to `React.Fragment`."),uo(null))}}var Ma={};function hn(it,bi,ie,W,Y,ue){{var we=Di(it);if(!we){var ye="";(it===void 0||typeof it=="object"&&it!==null&&Object.keys(it).length===0)&&(ye+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var Me=tc(Y);Me?ye+=Me:ye+=ra();var je;it===null?je="null":Oo(it)?je="array":it!==void 0&&it.$$typeof===s?(je="<"+(Nt(it.type)||"Unknown")+" />",ye=" Did you accidentally export a JSX literal instead of a component?"):je=typeof it,Le("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",je,ye)}var ze=qr(it,bi,ie,Y,ue);if(ze==null)return ze;if(we){var We=bi.children;if(We!==void 0)if(W)if(Oo(We)){for(var xt=0;xt<We.length;xt++)Tt(We[xt],it);Object.freeze&&Object.freeze(We)}else Le("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else Tt(We,it)}if(tr.call(bi,"key")){var ht=Nt(it),ti=Object.keys(bi).filter(function(ei){return ei!=="key"}),Ri=ti.length>0?"{key: someKey, "+ti.join(": ..., ")+": ...}":"{key: someKey}";if(!Ma[ht+Ri]){var xi=ti.length>0?"{"+ti.join(": ..., ")+": ...}":"{}";Le(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Ri,ht,xi,ht),Ma[ht+Ri]=!0}}return it===_?Ga(ze):Ta(ze),ze}}var Ko=hn;hR.Fragment=_,hR.jsxDEV=Ko})();RO.exports=hR;var Fe=RO.exports,dR={},MO={exports:{}},sh={},PO={exports:{}},OO={};(function(d){/**
 * @license React
 * scheduler.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var s=!1,u=5;function _(Fi,an){var ir=Fi.length;Fi.push(an),A(Fi,an,ir)}function v(Fi){return Fi.length===0?null:Fi[0]}function E(Fi){if(Fi.length===0)return null;var an=Fi[0],ir=Fi.pop();return ir!==an&&(Fi[0]=ir,r(Fi,ir,0)),an}function A(Fi,an,ir){for(var jr=ir;jr>0;){var jn=jr-1>>>1,yo=Fi[jn];if(L(yo,an)>0)Fi[jn]=an,Fi[jr]=yo,jr=jn;else return}}function r(Fi,an,ir){for(var jr=ir,jn=Fi.length,yo=jn>>>1;jr<yo;){var To=(jr+1)*2-1,Wo=Fi[To],qr=To+1,wr=Fi[qr];if(L(Wo,an)<0)qr<jn&&L(wr,Wo)<0?(Fi[jr]=wr,Fi[qr]=an,jr=qr):(Fi[jr]=Wo,Fi[To]=an,jr=To);else if(qr<jn&&L(wr,an)<0)Fi[jr]=wr,Fi[qr]=an,jr=qr;else return}}function L(Fi,an){var ir=Fi.sortIndex-an.sortIndex;return ir!==0?ir:Fi.id-an.id}var N=1,H=2,X=3,re=4,he=5;function de(Fi,an){}var ve=typeof performance=="object"&&typeof performance.now=="function";if(ve){var xe=performance;d.unstable_now=function(){return xe.now()}}else{var $e=Date,Le=$e.now();d.unstable_now=function(){return $e.now()-Le}}var Ke=1073741823,Ge=-1,Ye=250,mt=5e3,Ct=1e4,Vt=Ke,ui=[],Di=[],si=1,di=null,Nt=X,Ii=!1,Qt=!1,_t=!1,Et=typeof setTimeout=="function"?setTimeout:null,fi=typeof clearTimeout=="function"?clearTimeout:null,rn=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function zn(Fi){for(var an=v(Di);an!==null;){if(an.callback===null)E(Di);else if(an.startTime<=Fi)E(Di),an.sortIndex=an.expirationTime,_(ui,an);else return;an=v(Di)}}function er(Fi){if(_t=!1,zn(Fi),!Qt)if(v(ui)!==null)Qt=!0,Io(Mn);else{var an=v(Di);an!==null&&jo(er,an.startTime-Fi)}}function Mn(Fi,an){Qt=!1,_t&&(_t=!1,Yo()),Ii=!0;var ir=Nt;try{var jr;if(!s)return pn(Fi,an)}finally{di=null,Nt=ir,Ii=!1}}function pn(Fi,an){var ir=an;for(zn(ir),di=v(ui);di!==null&&!(di.expirationTime>ir&&(!Fi||Fr()));){var jr=di.callback;if(typeof jr=="function"){di.callback=null,Nt=di.priorityLevel;var jn=di.expirationTime<=ir,yo=jr(jn);ir=d.unstable_now(),typeof yo=="function"?di.callback=yo:di===v(ui)&&E(ui),zn(ir)}else E(ui);di=v(ui)}if(di!==null)return!0;var To=v(Di);return To!==null&&jo(er,To.startTime-ir),!1}function pr(Fi,an){switch(Fi){case N:case H:case X:case re:case he:break;default:Fi=X}var ir=Nt;Nt=Fi;try{return an()}finally{Nt=ir}}function Vr(Fi){var an;switch(Nt){case N:case H:case X:an=X;break;default:an=Nt;break}var ir=Nt;Nt=an;try{return Fi()}finally{Nt=ir}}function Or(Fi){var an=Nt;return function(){var ir=Nt;Nt=an;try{return Fi.apply(this,arguments)}finally{Nt=ir}}}function kr(Fi,an,ir){var jr=d.unstable_now(),jn;if(typeof ir=="object"&&ir!==null){var yo=ir.delay;typeof yo=="number"&&yo>0?jn=jr+yo:jn=jr}else jn=jr;var To;switch(Fi){case N:To=Ge;break;case H:To=Ye;break;case he:To=Vt;break;case re:To=Ct;break;case X:default:To=mt;break}var Wo=jn+To,qr={id:si++,callback:an,priorityLevel:Fi,startTime:jn,expirationTime:Wo,sortIndex:-1};return jn>jr?(qr.sortIndex=jn,_(Di,qr),v(ui)===null&&qr===v(Di)&&(_t?Yo():_t=!0,jo(er,jn-jr))):(qr.sortIndex=Wo,_(ui,qr),!Qt&&!Ii&&(Qt=!0,Io(Mn))),qr}function Wr(){}function mn(){!Qt&&!Ii&&(Qt=!0,Io(Mn))}function Ei(){return v(ui)}function Xi(Fi){Fi.callback=null}function Rn(){return Nt}var on=!1,Ur=null,gr=-1,tr=u,co=-1;function Fr(){var Fi=d.unstable_now()-co;return!(Fi<tr)}function Da(){}function ma(Fi){if(Fi<0||Fi>125){console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported");return}Fi>0?tr=Math.floor(1e3/Fi):tr=u}var _o=function(){if(Ur!==null){var Fi=d.unstable_now();co=Fi;var an=!0,ir=!0;try{ir=Ur(an,Fi)}finally{ir?Oo():(on=!1,Ur=null)}}else on=!1},Oo;if(typeof rn=="function")Oo=function(){rn(_o)};else if(typeof MessageChannel<"u"){var ba=new MessageChannel,Uo=ba.port2;ba.port1.onmessage=_o,Oo=function(){Uo.postMessage(null)}}else Oo=function(){Et(_o,0)};function Io(Fi){Ur=Fi,on||(on=!0,Oo())}function jo(Fi,an){gr=Et(function(){Fi(d.unstable_now())},an)}function Yo(){fi(gr),gr=-1}var xs=Da,$o=null;d.unstable_IdlePriority=he,d.unstable_ImmediatePriority=N,d.unstable_LowPriority=re,d.unstable_NormalPriority=X,d.unstable_Profiling=$o,d.unstable_UserBlockingPriority=H,d.unstable_cancelCallback=Xi,d.unstable_continueExecution=mn,d.unstable_forceFrameRate=ma,d.unstable_getCurrentPriorityLevel=Rn,d.unstable_getFirstCallbackNode=Ei,d.unstable_next=Vr,d.unstable_pauseExecution=Wr,d.unstable_requestPaint=xs,d.unstable_runWithPriority=pr,d.unstable_scheduleCallback=kr,d.unstable_shouldYield=Fr,d.unstable_wrapCallback=Or,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)})()})(OO);PO.exports=OO;var cL=PO.exports;/**
 * @license React
 * react-dom.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var d=ft,s=cL,u=d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_=!1;function v(l){_=l}function E(l){if(!_){for(var h=arguments.length,w=new Array(h>1?h-1:0),R=1;R<h;R++)w[R-1]=arguments[R];r("warn",l,w)}}function A(l){if(!_){for(var h=arguments.length,w=new Array(h>1?h-1:0),R=1;R<h;R++)w[R-1]=arguments[R];r("error",l,w)}}function r(l,h,w){{var R=u.ReactDebugCurrentFrame,O=R.getStackAddendum();O!==""&&(h+="%s",w=w.concat([O]));var G=w.map(function(K){return String(K)});G.unshift("Warning: "+h),Function.prototype.apply.call(console[l],console,G)}}var L=0,N=1,H=2,X=3,re=4,he=5,de=6,ve=7,xe=8,$e=9,Le=10,Ke=11,Ge=12,Ye=13,mt=14,Ct=15,Vt=16,ui=17,Di=18,si=19,di=21,Nt=22,Ii=23,Qt=24,_t=25,Et=!0,fi=!1,rn=!1,zn=!1,er=!1,Mn=!0,pn=!0,pr=!0,Vr=!0,Or=new Set,kr={},Wr={};function mn(l,h){Ei(l,h),Ei(l+"Capture",h)}function Ei(l,h){kr[l]&&A("EventRegistry: More than one plugin attempted to publish the same registration name, `%s`.",l),kr[l]=h;{var w=l.toLowerCase();Wr[w]=l,l==="onDoubleClick"&&(Wr.ondblclick=l)}for(var R=0;R<h.length;R++)Or.add(h[R])}var Xi=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Rn=Object.prototype.hasOwnProperty;function on(l){{var h=typeof Symbol=="function"&&Symbol.toStringTag,w=h&&l[Symbol.toStringTag]||l.constructor.name||"Object";return w}}function Ur(l){try{return gr(l),!1}catch{return!0}}function gr(l){return""+l}function tr(l,h){if(Ur(l))return A("The provided `%s` attribute is an unsupported type %s. This value must be coerced to a string before before using it here.",h,on(l)),gr(l)}function co(l){if(Ur(l))return A("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",on(l)),gr(l)}function Fr(l,h){if(Ur(l))return A("The provided `%s` prop is an unsupported type %s. This value must be coerced to a string before before using it here.",h,on(l)),gr(l)}function Da(l,h){if(Ur(l))return A("The provided `%s` CSS property is an unsupported type %s. This value must be coerced to a string before before using it here.",h,on(l)),gr(l)}function ma(l){if(Ur(l))return A("The provided HTML markup uses a value of unsupported type %s. This value must be coerced to a string before before using it here.",on(l)),gr(l)}function _o(l){if(Ur(l))return A("Form field values (value, checked, defaultValue, or defaultChecked props) must be strings, not %s. This value must be coerced to a string before before using it here.",on(l)),gr(l)}var Oo=0,ba=1,Uo=2,Io=3,jo=4,Yo=5,xs=6,$o=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",Fi=$o+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",an=new RegExp("^["+$o+"]["+Fi+"]*$"),ir={},jr={};function jn(l){return Rn.call(jr,l)?!0:Rn.call(ir,l)?!1:an.test(l)?(jr[l]=!0,!0):(ir[l]=!0,A("Invalid attribute name: `%s`",l),!1)}function yo(l,h,w){return h!==null?h.type===Oo:w?!1:l.length>2&&(l[0]==="o"||l[0]==="O")&&(l[1]==="n"||l[1]==="N")}function To(l,h,w,R){if(w!==null&&w.type===Oo)return!1;switch(typeof h){case"function":case"symbol":return!0;case"boolean":{if(R)return!1;if(w!==null)return!w.acceptsBooleans;var O=l.toLowerCase().slice(0,5);return O!=="data-"&&O!=="aria-"}default:return!1}}function Wo(l,h,w,R){if(h===null||typeof h>"u"||To(l,h,w,R))return!0;if(R)return!1;if(w!==null)switch(w.type){case Io:return!h;case jo:return h===!1;case Yo:return isNaN(h);case xs:return isNaN(h)||h<1}return!1}function qr(l){return bn.hasOwnProperty(l)?bn[l]:null}function wr(l,h,w,R,O,G,K){this.acceptsBooleans=h===Uo||h===Io||h===jo,this.attributeName=R,this.attributeNamespace=O,this.mustUseProperty=w,this.propertyName=l,this.type=h,this.sanitizeURL=G,this.removeEmptyString=K}var bn={},uo=["children","dangerouslySetInnerHTML","defaultValue","defaultChecked","innerHTML","suppressContentEditableWarning","suppressHydrationWarning","style"];uo.forEach(function(l){bn[l]=new wr(l,Oo,!1,l,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(l){var h=l[0],w=l[1];bn[h]=new wr(h,ba,!1,w,null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(l){bn[l]=new wr(l,Uo,!1,l.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(l){bn[l]=new wr(l,Uo,!1,l,null,!1,!1)}),["allowFullScreen","async","autoFocus","autoPlay","controls","default","defer","disabled","disablePictureInPicture","disableRemotePlayback","formNoValidate","hidden","loop","noModule","noValidate","open","playsInline","readOnly","required","reversed","scoped","seamless","itemScope"].forEach(function(l){bn[l]=new wr(l,Io,!1,l.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(l){bn[l]=new wr(l,Io,!0,l,null,!1,!1)}),["capture","download"].forEach(function(l){bn[l]=new wr(l,jo,!1,l,null,!1,!1)}),["cols","rows","size","span"].forEach(function(l){bn[l]=new wr(l,xs,!1,l,null,!1,!1)}),["rowSpan","start"].forEach(function(l){bn[l]=new wr(l,Yo,!1,l.toLowerCase(),null,!1,!1)});var wa=/[\-\:]([a-z])/g,ga=function(l){return l[1].toUpperCase()};["accent-height","alignment-baseline","arabic-form","baseline-shift","cap-height","clip-path","clip-rule","color-interpolation","color-interpolation-filters","color-profile","color-rendering","dominant-baseline","enable-background","fill-opacity","fill-rule","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","glyph-name","glyph-orientation-horizontal","glyph-orientation-vertical","horiz-adv-x","horiz-origin-x","image-rendering","letter-spacing","lighting-color","marker-end","marker-mid","marker-start","overline-position","overline-thickness","paint-order","panose-1","pointer-events","rendering-intent","shape-rendering","stop-color","stop-opacity","strikethrough-position","strikethrough-thickness","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-anchor","text-decoration","text-rendering","underline-position","underline-thickness","unicode-bidi","unicode-range","units-per-em","v-alphabetic","v-hanging","v-ideographic","v-mathematical","vector-effect","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","writing-mode","xmlns:xlink","x-height"].forEach(function(l){var h=l.replace(wa,ga);bn[h]=new wr(h,ba,!1,l,null,!1,!1)}),["xlink:actuate","xlink:arcrole","xlink:role","xlink:show","xlink:title","xlink:type"].forEach(function(l){var h=l.replace(wa,ga);bn[h]=new wr(h,ba,!1,l,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(l){var h=l.replace(wa,ga);bn[h]=new wr(h,ba,!1,l,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(l){bn[l]=new wr(l,ba,!1,l.toLowerCase(),null,!1,!1)});var ra="xlinkHref";bn[ra]=new wr("xlinkHref",ba,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(l){bn[l]=new wr(l,ba,!1,l.toLowerCase(),null,!0,!0)});var tc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*\:/i,ml=!1;function ic(l){!ml&&tc.test(l)&&(ml=!0,A("A future version of React will block javascript: URLs as a security precaution. Use event handlers instead if you can. If you need to generate unsafe HTML try using dangerouslySetInnerHTML instead. React was passed %s.",JSON.stringify(l)))}function Ks(l,h,w,R){if(R.mustUseProperty){var O=R.propertyName;return l[O]}else{tr(w,h),R.sanitizeURL&&ic(""+w);var G=R.attributeName,K=null;if(R.type===jo){if(l.hasAttribute(G)){var ae=l.getAttribute(G);return ae===""?!0:Wo(h,w,R,!1)?ae:ae===""+w?w:ae}}else if(l.hasAttribute(G)){if(Wo(h,w,R,!1))return l.getAttribute(G);if(R.type===Io)return w;K=l.getAttribute(G)}return Wo(h,w,R,!1)?K===null?w:K:K===""+w?w:K}}function Tt(l,h,w,R){{if(!jn(h))return;if(!l.hasAttribute(h))return w===void 0?void 0:null;var O=l.getAttribute(h);return tr(w,h),O===""+w?w:O}}function Ta(l,h,w,R){var O=qr(h);if(!yo(h,O,R)){if(Wo(h,w,O,R)&&(w=null),R||O===null){if(jn(h)){var G=h;w===null?l.removeAttribute(G):(tr(w,h),l.setAttribute(G,""+w))}return}var K=O.mustUseProperty;if(K){var ae=O.propertyName;if(w===null){var pe=O.type;l[ae]=pe===Io?!1:""}else l[ae]=w;return}var Oe=O.attributeName,Ve=O.attributeNamespace;if(w===null)l.removeAttribute(Oe);else{var gt=O.type,pt;gt===Io||gt===jo&&w===!0?pt="":(tr(w,Oe),pt=""+w,O.sanitizeURL&&ic(pt.toString())),Ve?l.setAttributeNS(Ve,Oe,pt):l.setAttribute(Oe,pt)}}}var Ga=Symbol.for("react.element"),Ma=Symbol.for("react.portal"),hn=Symbol.for("react.fragment"),Ko=Symbol.for("react.strict_mode"),it=Symbol.for("react.profiler"),bi=Symbol.for("react.provider"),ie=Symbol.for("react.context"),W=Symbol.for("react.forward_ref"),Y=Symbol.for("react.suspense"),ue=Symbol.for("react.suspense_list"),we=Symbol.for("react.memo"),ye=Symbol.for("react.lazy"),Me=Symbol.for("react.scope"),je=Symbol.for("react.debug_trace_mode"),ze=Symbol.for("react.offscreen"),We=Symbol.for("react.legacy_hidden"),xt=Symbol.for("react.cache"),ht=Symbol.for("react.tracing_marker"),ti=Symbol.iterator,Ri="@@iterator";function xi(l){if(l===null||typeof l!="object")return null;var h=ti&&l[ti]||l[Ri];return typeof h=="function"?h:null}var ei=Object.assign,Yi=0,un,hr,Lr,Ro,ho,to,nr;function Sn(){}Sn.__reactDisabledLog=!0;function Rr(){{if(Yi===0){un=console.log,hr=console.info,Lr=console.warn,Ro=console.error,ho=console.group,to=console.groupCollapsed,nr=console.groupEnd;var l={configurable:!0,enumerable:!0,value:Sn,writable:!0};Object.defineProperties(console,{info:l,log:l,warn:l,error:l,group:l,groupCollapsed:l,groupEnd:l})}Yi++}}function Zr(){{if(Yi--,Yi===0){var l={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:ei({},l,{value:un}),info:ei({},l,{value:hr}),warn:ei({},l,{value:Lr}),error:ei({},l,{value:Ro}),group:ei({},l,{value:ho}),groupCollapsed:ei({},l,{value:to}),groupEnd:ei({},l,{value:nr})})}Yi<0&&A("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var sr=u.ReactCurrentDispatcher,Sr;function fo(l,h,w){{if(Sr===void 0)try{throw Error()}catch(O){var R=O.stack.trim().match(/\n( *(at )?)/);Sr=R&&R[1]||""}return`
`+Sr+l}}var oa=!1,Ha;{var Fl=typeof WeakMap=="function"?WeakMap:Map;Ha=new Fl}function ko(l,h){if(!l||oa)return"";{var w=Ha.get(l);if(w!==void 0)return w}var R;oa=!0;var O=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var G;G=sr.current,sr.current=null,Rr();try{if(h){var K=function(){throw Error()};if(Object.defineProperty(K.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(K,[])}catch($t){R=$t}Reflect.construct(l,[],K)}else{try{K.call()}catch($t){R=$t}l.call(K.prototype)}}else{try{throw Error()}catch($t){R=$t}l()}}catch($t){if($t&&R&&typeof $t.stack=="string"){for(var ae=$t.stack.split(`
`),pe=R.stack.split(`
`),Oe=ae.length-1,Ve=pe.length-1;Oe>=1&&Ve>=0&&ae[Oe]!==pe[Ve];)Ve--;for(;Oe>=1&&Ve>=0;Oe--,Ve--)if(ae[Oe]!==pe[Ve]){if(Oe!==1||Ve!==1)do if(Oe--,Ve--,Ve<0||ae[Oe]!==pe[Ve]){var gt=`
`+ae[Oe].replace(" at new "," at ");return l.displayName&&gt.includes("<anonymous>")&&(gt=gt.replace("<anonymous>",l.displayName)),typeof l=="function"&&Ha.set(l,gt),gt}while(Oe>=1&&Ve>=0);break}}}finally{oa=!1,sr.current=G,Zr(),Error.prepareStackTrace=O}var pt=l?l.displayName||l.name:"",Ht=pt?fo(pt):"";return typeof l=="function"&&Ha.set(l,Ht),Ht}function os(l,h,w){return ko(l,!0)}function Pa(l,h,w){return ko(l,!1)}function Js(l){var h=l.prototype;return!!(h&&h.isReactComponent)}function Ka(l,h,w){if(l==null)return"";if(typeof l=="function")return ko(l,Js(l));if(typeof l=="string")return fo(l);switch(l){case Y:return fo("Suspense");case ue:return fo("SuspenseList")}if(typeof l=="object")switch(l.$$typeof){case W:return Pa(l.render);case we:return Ka(l.type,h,w);case ye:{var R=l,O=R._payload,G=R._init;try{return Ka(G(O),h,w)}catch{}}}return""}function bs(l){switch(l._debugOwner&&l._debugOwner.type,l._debugSource,l.tag){case he:return fo(l.type);case Vt:return fo("Lazy");case Ye:return fo("Suspense");case si:return fo("SuspenseList");case L:case H:case Ct:return Pa(l.type);case Ke:return Pa(l.type.render);case N:return os(l.type);default:return""}}function Ic(l){try{var h="",w=l;do h+=bs(w),w=w.return;while(w);return h}catch(R){return`
Error generating stack: `+R.message+`
`+R.stack}}function ch(l,h,w){var R=l.displayName;if(R)return R;var O=h.displayName||h.name||"";return O!==""?w+"("+O+")":w}function xu(l){return l.displayName||"Context"}function Gr(l){if(l==null)return null;if(typeof l.tag=="number"&&A("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case hn:return"Fragment";case Ma:return"Portal";case it:return"Profiler";case Ko:return"StrictMode";case Y:return"Suspense";case ue:return"SuspenseList"}if(typeof l=="object")switch(l.$$typeof){case ie:var h=l;return xu(h)+".Consumer";case bi:var w=l;return xu(w._context)+".Provider";case W:return ch(l,l.render,"ForwardRef");case we:var R=l.displayName||null;return R!==null?R:Gr(l.type)||"Memo";case ye:{var O=l,G=O._payload,K=O._init;try{return Gr(K(G))}catch{return null}}}return null}function as(l,h,w){var R=h.displayName||h.name||"";return l.displayName||(R!==""?w+"("+R+")":w)}function $a(l){return l.displayName||"Context"}function yn(l){var h=l.tag,w=l.type;switch(h){case Qt:return"Cache";case $e:var R=w;return $a(R)+".Consumer";case Le:var O=w;return $a(O._context)+".Provider";case Di:return"DehydratedFragment";case Ke:return as(w,w.render,"ForwardRef");case ve:return"Fragment";case he:return w;case re:return"Portal";case X:return"Root";case de:return"Text";case Vt:return Gr(w);case xe:return w===Ko?"StrictMode":"Mode";case Nt:return"Offscreen";case Ge:return"Profiler";case di:return"Scope";case Ye:return"Suspense";case si:return"SuspenseList";case _t:return"TracingMarker";case N:case L:case ui:case H:case mt:case Ct:if(typeof w=="function")return w.displayName||w.name||null;if(typeof w=="string")return w;break}return null}var ss=u.ReactDebugCurrentFrame,aa=null,gl=!1;function nc(){{if(aa===null)return null;var l=aa._debugOwner;if(l!==null&&typeof l<"u")return yn(l)}return null}function $d(){return aa===null?"":Ic(aa)}function Go(){ss.getCurrentStack=null,aa=null,gl=!1}function vo(l){ss.getCurrentStack=l===null?null:$d,aa=l,gl=!1}function Wd(){return aa}function _l(l){gl=l}function qo(l){return""+l}function yl(l){switch(typeof l){case"boolean":case"number":case"string":case"undefined":return l;case"object":return _o(l),l;default:return""}}var bu={button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0};function rc(l,h){bu[h.type]||h.onChange||h.onInput||h.readOnly||h.disabled||h.value==null||A("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`."),h.onChange||h.readOnly||h.disabled||h.checked==null||A("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")}function qd(l){var h=l.type,w=l.nodeName;return w&&w.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function wu(l){return l._valueTracker}function oc(l){l._valueTracker=null}function Gn(l){var h="";return l&&(qd(l)?h=l.checked?"true":"false":h=l.value),h}function Rc(l){var h=qd(l)?"checked":"value",w=Object.getOwnPropertyDescriptor(l.constructor.prototype,h);_o(l[h]);var R=""+l[h];if(!(l.hasOwnProperty(h)||typeof w>"u"||typeof w.get!="function"||typeof w.set!="function")){var O=w.get,G=w.set;Object.defineProperty(l,h,{configurable:!0,get:function(){return O.call(this)},set:function(ae){_o(ae),R=""+ae,G.call(this,ae)}}),Object.defineProperty(l,h,{enumerable:w.enumerable});var K={getValue:function(){return R},setValue:function(ae){_o(ae),R=""+ae},stopTracking:function(){oc(l),delete l[h]}};return K}}function ac(l){wu(l)||(l._valueTracker=Rc(l))}function Tu(l){if(!l)return!1;var h=wu(l);if(!h)return!0;var w=h.getValue(),R=Gn(l);return R!==w?(h.setValue(R),!0):!1}function sc(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var Dc=!1,Mc=!1,Pc=!1,Oc=!1;function dp(l){var h=l.type==="checkbox"||l.type==="radio";return h?l.checked!=null:l.value!=null}function uh(l,h){var w=l,R=h.checked,O=ei({},h,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:R??w._wrapperState.initialChecked});return O}function Lm(l,h){rc("input",h),h.checked!==void 0&&h.defaultChecked!==void 0&&!Mc&&(A("%s contains an input of type %s with both checked and defaultChecked props. Input elements must be either controlled or uncontrolled (specify either the checked prop, or the defaultChecked prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://reactjs.org/link/controlled-components",nc()||"A component",h.type),Mc=!0),h.value!==void 0&&h.defaultValue!==void 0&&!Dc&&(A("%s contains an input of type %s with both value and defaultValue props. Input elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://reactjs.org/link/controlled-components",nc()||"A component",h.type),Dc=!0);var w=l,R=h.defaultValue==null?"":h.defaultValue;w._wrapperState={initialChecked:h.checked!=null?h.checked:h.defaultChecked,initialValue:yl(h.value!=null?h.value:R),controlled:dp(h)}}function ge(l,h){var w=l,R=h.checked;R!=null&&Ta(w,"checked",R,!1)}function Je(l,h){var w=l;{var R=dp(h);!w._wrapperState.controlled&&R&&!Oc&&(A("A component is changing an uncontrolled input to be controlled. This is likely caused by the value changing from undefined to a defined value, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://reactjs.org/link/controlled-components"),Oc=!0),w._wrapperState.controlled&&!R&&!Pc&&(A("A component is changing a controlled input to be uncontrolled. This is likely caused by the value changing from a defined to undefined, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://reactjs.org/link/controlled-components"),Pc=!0)}ge(l,h);var O=yl(h.value),G=h.type;if(O!=null)G==="number"?(O===0&&w.value===""||w.value!=O)&&(w.value=qo(O)):w.value!==qo(O)&&(w.value=qo(O));else if(G==="submit"||G==="reset"){w.removeAttribute("value");return}h.hasOwnProperty("value")?vn(w,h.type,O):h.hasOwnProperty("defaultValue")&&vn(w,h.type,yl(h.defaultValue)),h.checked==null&&h.defaultChecked!=null&&(w.defaultChecked=!!h.defaultChecked)}function Ut(l,h,w){var R=l;if(h.hasOwnProperty("value")||h.hasOwnProperty("defaultValue")){var O=h.type,G=O==="submit"||O==="reset";if(G&&(h.value===void 0||h.value===null))return;var K=qo(R._wrapperState.initialValue);w||K!==R.value&&(R.value=K),R.defaultValue=K}var ae=R.name;ae!==""&&(R.name=""),R.defaultChecked=!R.defaultChecked,R.defaultChecked=!!R._wrapperState.initialChecked,ae!==""&&(R.name=ae)}function Jt(l,h){var w=l;Je(w,h),Mi(w,h)}function Mi(l,h){var w=h.name;if(h.type==="radio"&&w!=null){for(var R=l;R.parentNode;)R=R.parentNode;tr(w,"name");for(var O=R.querySelectorAll("input[name="+JSON.stringify(""+w)+'][type="radio"]'),G=0;G<O.length;G++){var K=O[G];if(!(K===l||K.form!==l.form)){var ae=Wx(K);if(!ae)throw new Error("ReactDOMInput: Mixing React and non-React radio inputs with the same `name` is not supported.");Tu(K),Je(K,ae)}}}}function vn(l,h,w){(h!=="number"||sc(l.ownerDocument)!==l)&&(w==null?l.defaultValue=qo(l._wrapperState.initialValue):l.defaultValue!==qo(w)&&(l.defaultValue=qo(w)))}var ki=!1,Zn=!1,Dr=!1;function po(l,h){h.value==null&&(typeof h.children=="object"&&h.children!==null?d.Children.forEach(h.children,function(w){w!=null&&(typeof w=="string"||typeof w=="number"||Zn||(Zn=!0,A("Cannot infer the option value of complex children. Pass a `value` prop or use a plain string as children to <option>.")))}):h.dangerouslySetInnerHTML!=null&&(Dr||(Dr=!0,A("Pass a `value` prop if you set dangerouslyInnerHTML so React knows which value should be selected.")))),h.selected!=null&&!ki&&(A("Use the `defaultValue` or `value` props on <select> instead of setting `selected` on <option>."),ki=!0)}function Qi(l,h){h.value!=null&&l.setAttribute("value",qo(yl(h.value)))}var Fo=Array.isArray;function Er(l){return Fo(l)}var Jo;Jo=!1;function Si(){var l=nc();return l?`

Check the render method of \``+l+"`.":""}var lc=["value","defaultValue"];function vl(l){{rc("select",l);for(var h=0;h<lc.length;h++){var w=lc[h];if(l[w]!=null){var R=Er(l[w]);l.multiple&&!R?A("The `%s` prop supplied to <select> must be an array if `multiple` is true.%s",w,Si()):!l.multiple&&R&&A("The `%s` prop supplied to <select> must be a scalar value if `multiple` is false.%s",w,Si())}}}}function Oa(l,h,w,R){var O=l.options;if(h){for(var G=w,K={},ae=0;ae<G.length;ae++)K["$"+G[ae]]=!0;for(var pe=0;pe<O.length;pe++){var Oe=K.hasOwnProperty("$"+O[pe].value);O[pe].selected!==Oe&&(O[pe].selected=Oe),Oe&&R&&(O[pe].defaultSelected=!0)}}else{for(var Ve=qo(yl(w)),gt=null,pt=0;pt<O.length;pt++){if(O[pt].value===Ve){O[pt].selected=!0,R&&(O[pt].defaultSelected=!0);return}gt===null&&!O[pt].disabled&&(gt=O[pt])}gt!==null&&(gt.selected=!0)}}function ws(l,h){return ei({},h,{value:void 0})}function kc(l,h){var w=l;vl(h),w._wrapperState={wasMultiple:!!h.multiple},h.value!==void 0&&h.defaultValue!==void 0&&!Jo&&(A("Select elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled select element and remove one of these props. More info: https://reactjs.org/link/controlled-components"),Jo=!0)}function Ti(l,h){var w=l;w.multiple=!!h.multiple;var R=h.value;R!=null?Oa(w,!!h.multiple,R,!1):h.defaultValue!=null&&Oa(w,!!h.multiple,h.defaultValue,!0)}function Pn(l,h){var w=l,R=w._wrapperState.wasMultiple;w._wrapperState.wasMultiple=!!h.multiple;var O=h.value;O!=null?Oa(w,!!h.multiple,O,!1):R!==!!h.multiple&&(h.defaultValue!=null?Oa(w,!!h.multiple,h.defaultValue,!0):Oa(w,!!h.multiple,h.multiple?[]:"",!1))}function Xn(l,h){var w=l,R=h.value;R!=null&&Oa(w,!!h.multiple,R,!1)}var ks=!1;function hh(l,h){var w=l;if(h.dangerouslySetInnerHTML!=null)throw new Error("`dangerouslySetInnerHTML` does not make sense on <textarea>.");var R=ei({},h,{value:void 0,defaultValue:void 0,children:qo(w._wrapperState.initialValue)});return R}function dr(l,h){var w=l;rc("textarea",h),h.value!==void 0&&h.defaultValue!==void 0&&!ks&&(A("%s contains a textarea with both value and defaultValue props. Textarea elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled textarea and remove one of these props. More info: https://reactjs.org/link/controlled-components",nc()||"A component"),ks=!0);var R=h.value;if(R==null){var O=h.children,G=h.defaultValue;if(O!=null){A("Use the `defaultValue` or `value` props instead of setting children on <textarea>.");{if(G!=null)throw new Error("If you supply `defaultValue` on a <textarea>, do not pass children.");if(Er(O)){if(O.length>1)throw new Error("<textarea> can only have at most one child.");O=O[0]}G=O}}G==null&&(G=""),R=G}w._wrapperState={initialValue:yl(R)}}function Zd(l,h){var w=l,R=yl(h.value),O=yl(h.defaultValue);if(R!=null){var G=qo(R);G!==w.value&&(w.value=G),h.defaultValue==null&&w.defaultValue!==G&&(w.defaultValue=G)}O!=null&&(w.defaultValue=qo(O))}function dh(l,h){var w=l,R=w.textContent;R===w._wrapperState.initialValue&&R!==""&&R!==null&&(w.value=R)}function fp(l,h){Zd(l,h)}var Lo="http://www.w3.org/1999/xhtml",na="http://www.w3.org/1998/Math/MathML",N_="http://www.w3.org/2000/svg";function ld(l){switch(l){case"svg":return N_;case"math":return na;default:return Lo}}function pp(l,h){return l==null||l===Lo?ld(h):l===N_&&h==="foreignObject"?Lo:l}var mp=function(l){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(h,w,R,O){MSApp.execUnsafeLocalFunction(function(){return l(h,w,R,O)})}:l},cd,zm=mp(function(l,h){if(l.namespaceURI===N_&&!("innerHTML"in l)){cd=cd||document.createElement("div"),cd.innerHTML="<svg>"+h.valueOf().toString()+"</svg>";for(var w=cd.firstChild;l.firstChild;)l.removeChild(l.firstChild);for(;w.firstChild;)l.appendChild(w.firstChild);return}l.innerHTML=h}),Ja=1,Do=3,zo=8,sa=9,Xd=11,Su=function(l,h){if(h){var w=l.firstChild;if(w&&w===l.lastChild&&w.nodeType===Do){w.nodeValue=h;return}}l.textContent=h},_a={animation:["animationDelay","animationDirection","animationDuration","animationFillMode","animationIterationCount","animationName","animationPlayState","animationTimingFunction"],background:["backgroundAttachment","backgroundClip","backgroundColor","backgroundImage","backgroundOrigin","backgroundPositionX","backgroundPositionY","backgroundRepeat","backgroundSize"],backgroundPosition:["backgroundPositionX","backgroundPositionY"],border:["borderBottomColor","borderBottomStyle","borderBottomWidth","borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRightColor","borderRightStyle","borderRightWidth","borderTopColor","borderTopStyle","borderTopWidth"],borderBlockEnd:["borderBlockEndColor","borderBlockEndStyle","borderBlockEndWidth"],borderBlockStart:["borderBlockStartColor","borderBlockStartStyle","borderBlockStartWidth"],borderBottom:["borderBottomColor","borderBottomStyle","borderBottomWidth"],borderColor:["borderBottomColor","borderLeftColor","borderRightColor","borderTopColor"],borderImage:["borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth"],borderInlineEnd:["borderInlineEndColor","borderInlineEndStyle","borderInlineEndWidth"],borderInlineStart:["borderInlineStartColor","borderInlineStartStyle","borderInlineStartWidth"],borderLeft:["borderLeftColor","borderLeftStyle","borderLeftWidth"],borderRadius:["borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius"],borderRight:["borderRightColor","borderRightStyle","borderRightWidth"],borderStyle:["borderBottomStyle","borderLeftStyle","borderRightStyle","borderTopStyle"],borderTop:["borderTopColor","borderTopStyle","borderTopWidth"],borderWidth:["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth"],columnRule:["columnRuleColor","columnRuleStyle","columnRuleWidth"],columns:["columnCount","columnWidth"],flex:["flexBasis","flexGrow","flexShrink"],flexFlow:["flexDirection","flexWrap"],font:["fontFamily","fontFeatureSettings","fontKerning","fontLanguageOverride","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition","fontWeight","lineHeight"],fontVariant:["fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition"],gap:["columnGap","rowGap"],grid:["gridAutoColumns","gridAutoFlow","gridAutoRows","gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],gridArea:["gridColumnEnd","gridColumnStart","gridRowEnd","gridRowStart"],gridColumn:["gridColumnEnd","gridColumnStart"],gridColumnGap:["columnGap"],gridGap:["columnGap","rowGap"],gridRow:["gridRowEnd","gridRowStart"],gridRowGap:["rowGap"],gridTemplate:["gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],listStyle:["listStyleImage","listStylePosition","listStyleType"],margin:["marginBottom","marginLeft","marginRight","marginTop"],marker:["markerEnd","markerMid","markerStart"],mask:["maskClip","maskComposite","maskImage","maskMode","maskOrigin","maskPositionX","maskPositionY","maskRepeat","maskSize"],maskPosition:["maskPositionX","maskPositionY"],outline:["outlineColor","outlineStyle","outlineWidth"],overflow:["overflowX","overflowY"],padding:["paddingBottom","paddingLeft","paddingRight","paddingTop"],placeContent:["alignContent","justifyContent"],placeItems:["alignItems","justifyItems"],placeSelf:["alignSelf","justifySelf"],textDecoration:["textDecorationColor","textDecorationLine","textDecorationStyle"],textEmphasis:["textEmphasisColor","textEmphasisStyle"],transition:["transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction"],wordWrap:["overflowWrap"]},Qs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};function Eu(l,h){return l+h.charAt(0).toUpperCase()+h.substring(1)}var No=["Webkit","ms","Moz","O"];Object.keys(Qs).forEach(function(l){No.forEach(function(h){Qs[Eu(h,l)]=Qs[l]})});function sn(l,h,w){var R=h==null||typeof h=="boolean"||h==="";return R?"":!w&&typeof h=="number"&&h!==0&&!(Qs.hasOwnProperty(l)&&Qs[l])?h+"px":(Da(h,l),(""+h).trim())}var _i=/([A-Z])/g,ud=/^ms-/;function Gi(l){return l.replace(_i,"-$1").toLowerCase().replace(ud,"-ms-")}var hd=function(){};{var Nm=/^(?:webkit|moz|o)[A-Z]/,Vi=/^-ms-/,gp=/-(.)/g,_p=/;\s*$/,dd={},Ll={},yp=!1,Sa=!1,ls=function(l){return l.replace(gp,function(h,w){return w.toUpperCase()})},fd=function(l){dd.hasOwnProperty(l)&&dd[l]||(dd[l]=!0,A("Unsupported style property %s. Did you mean %s?",l,ls(l.replace(Vi,"ms-"))))},Yd=function(l){dd.hasOwnProperty(l)&&dd[l]||(dd[l]=!0,A("Unsupported vendor-prefixed style property %s. Did you mean %s?",l,l.charAt(0).toUpperCase()+l.slice(1)))},Au=function(l,h){Ll.hasOwnProperty(h)&&Ll[h]||(Ll[h]=!0,A(`Style property values shouldn't contain a semicolon. Try "%s: %s" instead.`,l,h.replace(_p,"")))},ka=function(l,h){yp||(yp=!0,A("`NaN` is an invalid value for the `%s` css style property.",l))},Nb=function(l,h){Sa||(Sa=!0,A("`Infinity` is an invalid value for the `%s` css style property.",l))};hd=function(l,h){l.indexOf("-")>-1?fd(l):Nm.test(l)?Yd(l):_p.test(h)&&Au(l,h),typeof h=="number"&&(isNaN(h)?ka(l,h):isFinite(h)||Nb(l,h))}}var Bb=hd;function vp(l){{var h="",w="";for(var R in l)if(l.hasOwnProperty(R)){var O=l[R];if(O!=null){var G=R.indexOf("--")===0;h+=w+(G?R:Gi(R))+":",h+=sn(R,O,G),w=";"}}return h||null}}function Cu(l,h){var w=l.style;for(var R in h)if(h.hasOwnProperty(R)){var O=R.indexOf("--")===0;O||Bb(R,h[R]);var G=sn(R,h[R],O);R==="float"&&(R="cssFloat"),O?w.setProperty(R,G):w[R]=G}}function ex(l){return l==null||typeof l=="boolean"||l===""}function xl(l){var h={};for(var w in l)for(var R=_a[w]||[w],O=0;O<R.length;O++)h[R[O]]=w;return h}function tx(l,h){{if(!h)return;var w=xl(l),R=xl(h),O={};for(var G in w){var K=w[G],ae=R[G];if(ae&&K!==ae){var pe=K+","+ae;if(O[pe])continue;O[pe]=!0,A("%s a style property during rerender (%s) when a conflicting property is set (%s) can lead to styling bugs. To avoid this, don't mix shorthand and non-shorthand properties for the same value; instead, replace the shorthand with separate values.",ex(l[K])?"Removing":"Updating",K,ae)}}}}var Bm={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},xp=ei({menuitem:!0},Bm),fh="__html";function B_(l,h){if(h){if(xp[l]&&(h.children!=null||h.dangerouslySetInnerHTML!=null))throw new Error(l+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");if(h.dangerouslySetInnerHTML!=null){if(h.children!=null)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");if(typeof h.dangerouslySetInnerHTML!="object"||!(fh in h.dangerouslySetInnerHTML))throw new Error("`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://reactjs.org/link/dangerously-set-inner-html for more information.")}if(!h.suppressContentEditableWarning&&h.contentEditable&&h.children!=null&&A("A component is `contentEditable` and contains `children` managed by React. It is now your responsibility to guarantee that none of those nodes are unexpectedly modified or duplicated. This is probably not intentional."),h.style!=null&&typeof h.style!="object")throw new Error("The `style` prop expects a mapping from style properties to values, not a string. For example, style={{marginRight: spacing + 'em'}} when using JSX.")}}function ph(l,h){if(l.indexOf("-")===-1)return typeof h.is=="string";switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Vm={accept:"accept",acceptcharset:"acceptCharset","accept-charset":"acceptCharset",accesskey:"accessKey",action:"action",allowfullscreen:"allowFullScreen",alt:"alt",as:"as",async:"async",autocapitalize:"autoCapitalize",autocomplete:"autoComplete",autocorrect:"autoCorrect",autofocus:"autoFocus",autoplay:"autoPlay",autosave:"autoSave",capture:"capture",cellpadding:"cellPadding",cellspacing:"cellSpacing",challenge:"challenge",charset:"charSet",checked:"checked",children:"children",cite:"cite",class:"className",classid:"classID",classname:"className",cols:"cols",colspan:"colSpan",content:"content",contenteditable:"contentEditable",contextmenu:"contextMenu",controls:"controls",controlslist:"controlsList",coords:"coords",crossorigin:"crossOrigin",dangerouslysetinnerhtml:"dangerouslySetInnerHTML",data:"data",datetime:"dateTime",default:"default",defaultchecked:"defaultChecked",defaultvalue:"defaultValue",defer:"defer",dir:"dir",disabled:"disabled",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback",download:"download",draggable:"draggable",enctype:"encType",enterkeyhint:"enterKeyHint",for:"htmlFor",form:"form",formmethod:"formMethod",formaction:"formAction",formenctype:"formEncType",formnovalidate:"formNoValidate",formtarget:"formTarget",frameborder:"frameBorder",headers:"headers",height:"height",hidden:"hidden",high:"high",href:"href",hreflang:"hrefLang",htmlfor:"htmlFor",httpequiv:"httpEquiv","http-equiv":"httpEquiv",icon:"icon",id:"id",imagesizes:"imageSizes",imagesrcset:"imageSrcSet",innerhtml:"innerHTML",inputmode:"inputMode",integrity:"integrity",is:"is",itemid:"itemID",itemprop:"itemProp",itemref:"itemRef",itemscope:"itemScope",itemtype:"itemType",keyparams:"keyParams",keytype:"keyType",kind:"kind",label:"label",lang:"lang",list:"list",loop:"loop",low:"low",manifest:"manifest",marginwidth:"marginWidth",marginheight:"marginHeight",max:"max",maxlength:"maxLength",media:"media",mediagroup:"mediaGroup",method:"method",min:"min",minlength:"minLength",multiple:"multiple",muted:"muted",name:"name",nomodule:"noModule",nonce:"nonce",novalidate:"noValidate",open:"open",optimum:"optimum",pattern:"pattern",placeholder:"placeholder",playsinline:"playsInline",poster:"poster",preload:"preload",profile:"profile",radiogroup:"radioGroup",readonly:"readOnly",referrerpolicy:"referrerPolicy",rel:"rel",required:"required",reversed:"reversed",role:"role",rows:"rows",rowspan:"rowSpan",sandbox:"sandbox",scope:"scope",scoped:"scoped",scrolling:"scrolling",seamless:"seamless",selected:"selected",shape:"shape",size:"size",sizes:"sizes",span:"span",spellcheck:"spellCheck",src:"src",srcdoc:"srcDoc",srclang:"srcLang",srcset:"srcSet",start:"start",step:"step",style:"style",summary:"summary",tabindex:"tabIndex",target:"target",title:"title",type:"type",usemap:"useMap",value:"value",width:"width",wmode:"wmode",wrap:"wrap",about:"about",accentheight:"accentHeight","accent-height":"accentHeight",accumulate:"accumulate",additive:"additive",alignmentbaseline:"alignmentBaseline","alignment-baseline":"alignmentBaseline",allowreorder:"allowReorder",alphabetic:"alphabetic",amplitude:"amplitude",arabicform:"arabicForm","arabic-form":"arabicForm",ascent:"ascent",attributename:"attributeName",attributetype:"attributeType",autoreverse:"autoReverse",azimuth:"azimuth",basefrequency:"baseFrequency",baselineshift:"baselineShift","baseline-shift":"baselineShift",baseprofile:"baseProfile",bbox:"bbox",begin:"begin",bias:"bias",by:"by",calcmode:"calcMode",capheight:"capHeight","cap-height":"capHeight",clip:"clip",clippath:"clipPath","clip-path":"clipPath",clippathunits:"clipPathUnits",cliprule:"clipRule","clip-rule":"clipRule",color:"color",colorinterpolation:"colorInterpolation","color-interpolation":"colorInterpolation",colorinterpolationfilters:"colorInterpolationFilters","color-interpolation-filters":"colorInterpolationFilters",colorprofile:"colorProfile","color-profile":"colorProfile",colorrendering:"colorRendering","color-rendering":"colorRendering",contentscripttype:"contentScriptType",contentstyletype:"contentStyleType",cursor:"cursor",cx:"cx",cy:"cy",d:"d",datatype:"datatype",decelerate:"decelerate",descent:"descent",diffuseconstant:"diffuseConstant",direction:"direction",display:"display",divisor:"divisor",dominantbaseline:"dominantBaseline","dominant-baseline":"dominantBaseline",dur:"dur",dx:"dx",dy:"dy",edgemode:"edgeMode",elevation:"elevation",enablebackground:"enableBackground","enable-background":"enableBackground",end:"end",exponent:"exponent",externalresourcesrequired:"externalResourcesRequired",fill:"fill",fillopacity:"fillOpacity","fill-opacity":"fillOpacity",fillrule:"fillRule","fill-rule":"fillRule",filter:"filter",filterres:"filterRes",filterunits:"filterUnits",floodopacity:"floodOpacity","flood-opacity":"floodOpacity",floodcolor:"floodColor","flood-color":"floodColor",focusable:"focusable",fontfamily:"fontFamily","font-family":"fontFamily",fontsize:"fontSize","font-size":"fontSize",fontsizeadjust:"fontSizeAdjust","font-size-adjust":"fontSizeAdjust",fontstretch:"fontStretch","font-stretch":"fontStretch",fontstyle:"fontStyle","font-style":"fontStyle",fontvariant:"fontVariant","font-variant":"fontVariant",fontweight:"fontWeight","font-weight":"fontWeight",format:"format",from:"from",fx:"fx",fy:"fy",g1:"g1",g2:"g2",glyphname:"glyphName","glyph-name":"glyphName",glyphorientationhorizontal:"glyphOrientationHorizontal","glyph-orientation-horizontal":"glyphOrientationHorizontal",glyphorientationvertical:"glyphOrientationVertical","glyph-orientation-vertical":"glyphOrientationVertical",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",hanging:"hanging",horizadvx:"horizAdvX","horiz-adv-x":"horizAdvX",horizoriginx:"horizOriginX","horiz-origin-x":"horizOriginX",ideographic:"ideographic",imagerendering:"imageRendering","image-rendering":"imageRendering",in2:"in2",in:"in",inlist:"inlist",intercept:"intercept",k1:"k1",k2:"k2",k3:"k3",k4:"k4",k:"k",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",kerning:"kerning",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",letterspacing:"letterSpacing","letter-spacing":"letterSpacing",lightingcolor:"lightingColor","lighting-color":"lightingColor",limitingconeangle:"limitingConeAngle",local:"local",markerend:"markerEnd","marker-end":"markerEnd",markerheight:"markerHeight",markermid:"markerMid","marker-mid":"markerMid",markerstart:"markerStart","marker-start":"markerStart",markerunits:"markerUnits",markerwidth:"markerWidth",mask:"mask",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",mathematical:"mathematical",mode:"mode",numoctaves:"numOctaves",offset:"offset",opacity:"opacity",operator:"operator",order:"order",orient:"orient",orientation:"orientation",origin:"origin",overflow:"overflow",overlineposition:"overlinePosition","overline-position":"overlinePosition",overlinethickness:"overlineThickness","overline-thickness":"overlineThickness",paintorder:"paintOrder","paint-order":"paintOrder",panose1:"panose1","panose-1":"panose1",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointerevents:"pointerEvents","pointer-events":"pointerEvents",points:"points",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",prefix:"prefix",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",property:"property",r:"r",radius:"radius",refx:"refX",refy:"refY",renderingintent:"renderingIntent","rendering-intent":"renderingIntent",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",resource:"resource",restart:"restart",result:"result",results:"results",rotate:"rotate",rx:"rx",ry:"ry",scale:"scale",security:"security",seed:"seed",shaperendering:"shapeRendering","shape-rendering":"shapeRendering",slope:"slope",spacing:"spacing",specularconstant:"specularConstant",specularexponent:"specularExponent",speed:"speed",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stemh:"stemh",stemv:"stemv",stitchtiles:"stitchTiles",stopcolor:"stopColor","stop-color":"stopColor",stopopacity:"stopOpacity","stop-opacity":"stopOpacity",strikethroughposition:"strikethroughPosition","strikethrough-position":"strikethroughPosition",strikethroughthickness:"strikethroughThickness","strikethrough-thickness":"strikethroughThickness",string:"string",stroke:"stroke",strokedasharray:"strokeDasharray","stroke-dasharray":"strokeDasharray",strokedashoffset:"strokeDashoffset","stroke-dashoffset":"strokeDashoffset",strokelinecap:"strokeLinecap","stroke-linecap":"strokeLinecap",strokelinejoin:"strokeLinejoin","stroke-linejoin":"strokeLinejoin",strokemiterlimit:"strokeMiterlimit","stroke-miterlimit":"strokeMiterlimit",strokewidth:"strokeWidth","stroke-width":"strokeWidth",strokeopacity:"strokeOpacity","stroke-opacity":"strokeOpacity",suppresscontenteditablewarning:"suppressContentEditableWarning",suppresshydrationwarning:"suppressHydrationWarning",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textanchor:"textAnchor","text-anchor":"textAnchor",textdecoration:"textDecoration","text-decoration":"textDecoration",textlength:"textLength",textrendering:"textRendering","text-rendering":"textRendering",to:"to",transform:"transform",typeof:"typeof",u1:"u1",u2:"u2",underlineposition:"underlinePosition","underline-position":"underlinePosition",underlinethickness:"underlineThickness","underline-thickness":"underlineThickness",unicode:"unicode",unicodebidi:"unicodeBidi","unicode-bidi":"unicodeBidi",unicoderange:"unicodeRange","unicode-range":"unicodeRange",unitsperem:"unitsPerEm","units-per-em":"unitsPerEm",unselectable:"unselectable",valphabetic:"vAlphabetic","v-alphabetic":"vAlphabetic",values:"values",vectoreffect:"vectorEffect","vector-effect":"vectorEffect",version:"version",vertadvy:"vertAdvY","vert-adv-y":"vertAdvY",vertoriginx:"vertOriginX","vert-origin-x":"vertOriginX",vertoriginy:"vertOriginY","vert-origin-y":"vertOriginY",vhanging:"vHanging","v-hanging":"vHanging",videographic:"vIdeographic","v-ideographic":"vIdeographic",viewbox:"viewBox",viewtarget:"viewTarget",visibility:"visibility",vmathematical:"vMathematical","v-mathematical":"vMathematical",vocab:"vocab",widths:"widths",wordspacing:"wordSpacing","word-spacing":"wordSpacing",writingmode:"writingMode","writing-mode":"writingMode",x1:"x1",x2:"x2",x:"x",xchannelselector:"xChannelSelector",xheight:"xHeight","x-height":"xHeight",xlinkactuate:"xlinkActuate","xlink:actuate":"xlinkActuate",xlinkarcrole:"xlinkArcrole","xlink:arcrole":"xlinkArcrole",xlinkhref:"xlinkHref","xlink:href":"xlinkHref",xlinkrole:"xlinkRole","xlink:role":"xlinkRole",xlinkshow:"xlinkShow","xlink:show":"xlinkShow",xlinktitle:"xlinkTitle","xlink:title":"xlinkTitle",xlinktype:"xlinkType","xlink:type":"xlinkType",xmlbase:"xmlBase","xml:base":"xmlBase",xmllang:"xmlLang","xml:lang":"xmlLang",xmlns:"xmlns","xml:space":"xmlSpace",xmlnsxlink:"xmlnsXlink","xmlns:xlink":"xmlnsXlink",xmlspace:"xmlSpace",y1:"y1",y2:"y2",y:"y",ychannelselector:"yChannelSelector",z:"z",zoomandpan:"zoomAndPan"},Iu={"aria-current":0,"aria-description":0,"aria-details":0,"aria-disabled":0,"aria-hidden":0,"aria-invalid":0,"aria-keyshortcuts":0,"aria-label":0,"aria-roledescription":0,"aria-autocomplete":0,"aria-checked":0,"aria-expanded":0,"aria-haspopup":0,"aria-level":0,"aria-modal":0,"aria-multiline":0,"aria-multiselectable":0,"aria-orientation":0,"aria-placeholder":0,"aria-pressed":0,"aria-readonly":0,"aria-required":0,"aria-selected":0,"aria-sort":0,"aria-valuemax":0,"aria-valuemin":0,"aria-valuenow":0,"aria-valuetext":0,"aria-atomic":0,"aria-busy":0,"aria-live":0,"aria-relevant":0,"aria-dropeffect":0,"aria-grabbed":0,"aria-activedescendant":0,"aria-colcount":0,"aria-colindex":0,"aria-colspan":0,"aria-controls":0,"aria-describedby":0,"aria-errormessage":0,"aria-flowto":0,"aria-labelledby":0,"aria-owns":0,"aria-posinset":0,"aria-rowcount":0,"aria-rowindex":0,"aria-rowspan":0,"aria-setsize":0},Kd={},V_=new RegExp("^(aria)-["+Fi+"]*$"),Um=new RegExp("^(aria)[A-Z]["+Fi+"]*$");function U_(l,h){{if(Rn.call(Kd,h)&&Kd[h])return!0;if(Um.test(h)){var w="aria-"+h.slice(4).toLowerCase(),R=Iu.hasOwnProperty(w)?w:null;if(R==null)return A("Invalid ARIA attribute `%s`. ARIA attributes follow the pattern aria-* and must be lowercase.",h),Kd[h]=!0,!0;if(h!==R)return A("Invalid ARIA attribute `%s`. Did you mean `%s`?",h,R),Kd[h]=!0,!0}if(V_.test(h)){var O=h.toLowerCase(),G=Iu.hasOwnProperty(O)?O:null;if(G==null)return Kd[h]=!0,!1;if(h!==G)return A("Unknown ARIA attribute `%s`. Did you mean `%s`?",h,G),Kd[h]=!0,!0}}return!0}function j_(l,h){{var w=[];for(var R in h){var O=U_(l,R);O||w.push(R)}var G=w.map(function(K){return"`"+K+"`"}).join(", ");w.length===1?A("Invalid aria prop %s on <%s> tag. For details, see https://reactjs.org/link/invalid-aria-props",G,l):w.length>1&&A("Invalid aria props %s on <%s> tag. For details, see https://reactjs.org/link/invalid-aria-props",G,l)}}function zl(l,h){ph(l,h)||j_(l,h)}var mh=!1;function bp(l,h){{if(l!=="input"&&l!=="textarea"&&l!=="select")return;h!=null&&h.value===null&&!mh&&(mh=!0,l==="select"&&h.multiple?A("`value` prop on `%s` should not be null. Consider using an empty array when `multiple` is set to `true` to clear the component or `undefined` for uncontrolled components.",l):A("`value` prop on `%s` should not be null. Consider using an empty string to clear the component or `undefined` for uncontrolled components.",l))}}var jm=function(){};{var cs={},pd=/^on./,Jd=/^on[^A-Z]/,G_=new RegExp("^(aria)-["+Fi+"]*$"),Gm=new RegExp("^(aria)[A-Z]["+Fi+"]*$");jm=function(l,h,w,R){if(Rn.call(cs,h)&&cs[h])return!0;var O=h.toLowerCase();if(O==="onfocusin"||O==="onfocusout")return A("React uses onFocus and onBlur instead of onFocusIn and onFocusOut. All React events are normalized to bubble, so onFocusIn and onFocusOut are not needed/supported by React."),cs[h]=!0,!0;if(R!=null){var G=R.registrationNameDependencies,K=R.possibleRegistrationNames;if(G.hasOwnProperty(h))return!0;var ae=K.hasOwnProperty(O)?K[O]:null;if(ae!=null)return A("Invalid event handler property `%s`. Did you mean `%s`?",h,ae),cs[h]=!0,!0;if(pd.test(h))return A("Unknown event handler property `%s`. It will be ignored.",h),cs[h]=!0,!0}else if(pd.test(h))return Jd.test(h)&&A("Invalid event handler property `%s`. React events use the camelCase naming convention, for example `onClick`.",h),cs[h]=!0,!0;if(G_.test(h)||Gm.test(h))return!0;if(O==="innerhtml")return A("Directly setting property `innerHTML` is not permitted. For more information, lookup documentation on `dangerouslySetInnerHTML`."),cs[h]=!0,!0;if(O==="aria")return A("The `aria` attribute is reserved for future use in React. Pass individual `aria-` attributes instead."),cs[h]=!0,!0;if(O==="is"&&w!==null&&w!==void 0&&typeof w!="string")return A("Received a `%s` for a string attribute `is`. If this is expected, cast the value to a string.",typeof w),cs[h]=!0,!0;if(typeof w=="number"&&isNaN(w))return A("Received NaN for the `%s` attribute. If this is expected, cast the value to a string.",h),cs[h]=!0,!0;var pe=qr(h),Oe=pe!==null&&pe.type===Oo;if(Vm.hasOwnProperty(O)){var Ve=Vm[O];if(Ve!==h)return A("Invalid DOM property `%s`. Did you mean `%s`?",h,Ve),cs[h]=!0,!0}else if(!Oe&&h!==O)return A("React does not recognize the `%s` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `%s` instead. If you accidentally passed it from a parent component, remove it from the DOM element.",h,O),cs[h]=!0,!0;return typeof w=="boolean"&&To(h,w,pe,!1)?(w?A('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.',w,h,h,w,h):A('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.',w,h,h,w,h,h,h),cs[h]=!0,!0):Oe?!0:To(h,w,pe,!1)?(cs[h]=!0,!1):((w==="false"||w==="true")&&pe!==null&&pe.type===Io&&(A("Received the string `%s` for the boolean attribute `%s`. %s Did you mean %s={%s}?",w,h,w==="false"?"The browser will interpret it as a truthy value.":'Although this works, it will not work as expected if you pass the string "false".',h,w),cs[h]=!0),!0)}}var bl=function(l,h,w){{var R=[];for(var O in h){var G=jm(l,O,h[O],w);G||R.push(O)}var K=R.map(function(ae){return"`"+ae+"`"}).join(", ");R.length===1?A("Invalid value for prop %s on <%s> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM. For details, see https://reactjs.org/link/attribute-behavior ",K,l):R.length>1&&A("Invalid values for props %s on <%s> tag. Either remove them from the element, or pass a string or number value to keep them in the DOM. For details, see https://reactjs.org/link/attribute-behavior ",K,l)}};function Hm(l,h,w){ph(l,h)||bl(l,h,w)}var Bt=1,wp=2,Fc=4,Qd=Bt|wp|Fc,Ru=null;function Tp(l){Ru!==null&&A("Expected currently replaying event to be null. This error is likely caused by a bug in React. Please file an issue."),Ru=l}function Lc(){Ru===null&&A("Expected currently replaying event to not be null. This error is likely caused by a bug in React. Please file an issue."),Ru=null}function $m(l){return l===Ru}function el(l){var h=l.target||l.srcElement||window;return h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===Do?h.parentNode:h}var Tn=null,cc=null,ef=null;function ix(l){var h=Jc(l);if(h){if(typeof Tn!="function")throw new Error("setRestoreImplementation() needs to be called to handle a target for controlled events. This error is likely caused by a bug in React. Please file an issue.");var w=h.stateNode;if(w){var R=Wx(w);Tn(h.stateNode,h.type,R)}}}function Wm(l){Tn=l}function nx(l){cc?ef?ef.push(l):ef=[l]:cc=l}function io(){return cc!==null||ef!==null}function H_(){if(cc){var l=cc,h=ef;if(cc=null,ef=null,ix(l),h)for(var w=0;w<h.length;w++)ix(h[w])}}var qm=function(l,h){return l(h)},rx=function(){},$_=!1;function Vb(){var l=io();l&&(rx(),H_())}function ox(l,h,w){if($_)return l(h,w);$_=!0;try{return qm(l,h,w)}finally{$_=!1,Vb()}}function ax(l,h,w){qm=l,rx=w}function Ub(l){return l==="button"||l==="input"||l==="select"||l==="textarea"}function Zm(l,h,w){switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":return!!(w.disabled&&Ub(h));default:return!1}}function Sp(l,h){var w=l.stateNode;if(w===null)return null;var R=Wx(w);if(R===null)return null;var O=R[h];if(Zm(h,l.type,R))return null;if(O&&typeof O!="function")throw new Error("Expected `"+h+"` listener to be a function, instead got a value of `"+typeof O+"` type.");return O}var Xm=!1;if(Xi)try{var md={};Object.defineProperty(md,"passive",{get:function(){Xm=!0}}),window.addEventListener("test",md,md),window.removeEventListener("test",md,md)}catch{Xm=!1}function Ep(l,h,w,R,O,G,K,ae,pe){var Oe=Array.prototype.slice.call(arguments,3);try{h.apply(w,Oe)}catch(Ve){this.onError(Ve)}}var Ym=Ep;if(typeof window<"u"&&typeof window.dispatchEvent=="function"&&typeof document<"u"&&typeof document.createEvent=="function"){var Du=document.createElement("react");Ym=function(h,w,R,O,G,K,ae,pe,Oe){if(typeof document>"u"||document===null)throw new Error("The `document` global was defined when React was initialized, but is not defined anymore. This can happen in a test environment if a component schedules an update from an asynchronous callback, but the test has already finished running. To solve this, you can either unmount the component at the end of your test (and ensure that any asynchronous operations get canceled in `componentWillUnmount`), or you can change the test itself to be asynchronous.");var Ve=document.createEvent("Event"),gt=!1,pt=!0,Ht=window.event,$t=Object.getOwnPropertyDescriptor(window,"event");function oi(){Du.removeEventListener(ai,Vn,!1),typeof window.event<"u"&&window.hasOwnProperty("event")&&(window.event=Ht)}var Ji=Array.prototype.slice.call(arguments,3);function Vn(){gt=!0,oi(),w.apply(R,Ji),pt=!1}var An,lo=!1,Kr=!1;function Ot(kt){if(An=kt.error,lo=!0,An===null&&kt.colno===0&&kt.lineno===0&&(Kr=!0),kt.defaultPrevented&&An!=null&&typeof An=="object")try{An._suppressLogging=!0}catch{}}var ai="react-"+(h||"invokeguardedcallback");if(window.addEventListener("error",Ot),Du.addEventListener(ai,Vn,!1),Ve.initEvent(ai,!1,!1),Du.dispatchEvent(Ve),$t&&Object.defineProperty(window,"event",$t),gt&&pt&&(lo?Kr&&(An=new Error("A cross-origin error was thrown. React doesn't have access to the actual error object in development. See https://reactjs.org/link/crossorigin-error for more information.")):An=new Error(`An error was thrown inside one of your components, but React doesn't know what it was. This is likely due to browser flakiness. React does its best to preserve the "Pause on exceptions" behavior of the DevTools, which requires some DEV-mode only tricks. It's possible that these don't work in your browser. Try triggering the error in production mode, or switching to a modern browser. If you suspect that this is actually an issue with React, please file an issue.`),this.onError(An)),window.removeEventListener("error",Ot),!gt)return oi(),Ep.apply(this,arguments)}}var tf=Ym,zc=!1,Mu=null,Ap=!1,Cp=null,sx={onError:function(l){zc=!0,Mu=l}};function gh(l,h,w,R,O,G,K,ae,pe){zc=!1,Mu=null,tf.apply(sx,arguments)}function Km(l,h,w,R,O,G,K,ae,pe){if(gh.apply(this,arguments),zc){var Oe=nf();Ap||(Ap=!0,Cp=Oe)}}function Jm(){if(Ap){var l=Cp;throw Ap=!1,Cp=null,l}}function W_(){return zc}function nf(){if(zc){var l=Mu;return zc=!1,Mu=null,l}else throw new Error("clearCaughtError was called but no error was captured. This error is likely caused by a bug in React. Please file an issue.")}function Nc(l){return l._reactInternals}function lx(l){return l._reactInternals!==void 0}function cx(l,h){l._reactInternals=h}var On=0,uc=1,la=2,no=4,_h=16,Ip=32,Qm=64,Xr=128,Nl=256,Bc=512,Bl=1024,Vc=2048,Uc=4096,hc=8192,Pu=16384,eg=32767,Ts=32768,us=65536,gd=131072,rf=1048576,Rp=2097152,Ou=4194304,Dp=8388608,Vl=16777216,of=33554432,yh=no|Bl|0,af=la|no|_h|Ip|Bc|Uc|hc,vh=no|Qm|Bc|hc,_d=Vc|_h,jc=Ou|Dp|Rp,sf=u.ReactCurrentOwner;function xh(l){var h=l,w=l;if(l.alternate)for(;h.return;)h=h.return;else{var R=h;do h=R,(h.flags&(la|Uc))!==On&&(w=h.return),R=h.return;while(R)}return h.tag===X?w:null}function q_(l){if(l.tag===Ye){var h=l.memoizedState;if(h===null){var w=l.alternate;w!==null&&(h=w.memoizedState)}if(h!==null)return h.dehydrated}return null}function ux(l){return l.tag===X?l.stateNode.containerInfo:null}function jb(l){return xh(l)===l}function Gb(l){{var h=sf.current;if(h!==null&&h.tag===N){var w=h,R=w.stateNode;R._warnedAboutRefsInRender||A("%s is accessing isMounted inside its render() function. render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",yn(w)||"A component"),R._warnedAboutRefsInRender=!0}}var O=Nc(l);return O?xh(O)===O:!1}function Mp(l){if(xh(l)!==l)throw new Error("Unable to find node on an unmounted component.")}function tg(l){var h=l.alternate;if(!h){var w=xh(l);if(w===null)throw new Error("Unable to find node on an unmounted component.");return w!==l?null:l}for(var R=l,O=h;;){var G=R.return;if(G===null)break;var K=G.alternate;if(K===null){var ae=G.return;if(ae!==null){R=O=ae;continue}break}if(G.child===K.child){for(var pe=G.child;pe;){if(pe===R)return Mp(G),l;if(pe===O)return Mp(G),h;pe=pe.sibling}throw new Error("Unable to find node on an unmounted component.")}if(R.return!==O.return)R=G,O=K;else{for(var Oe=!1,Ve=G.child;Ve;){if(Ve===R){Oe=!0,R=G,O=K;break}if(Ve===O){Oe=!0,O=G,R=K;break}Ve=Ve.sibling}if(!Oe){for(Ve=K.child;Ve;){if(Ve===R){Oe=!0,R=K,O=G;break}if(Ve===O){Oe=!0,O=K,R=G;break}Ve=Ve.sibling}if(!Oe)throw new Error("Child was not found in either parent set. This indicates a bug in React related to the return pointer. Please file an issue.")}}if(R.alternate!==O)throw new Error("Return fibers should always be each others' alternates. This error is likely caused by a bug in React. Please file an issue.")}if(R.tag!==X)throw new Error("Unable to find node on an unmounted component.");return R.stateNode.current===R?l:h}function ig(l){var h=tg(l);return h!==null?Z_(h):null}function Z_(l){if(l.tag===he||l.tag===de)return l;for(var h=l.child;h!==null;){var w=Z_(h);if(w!==null)return w;h=h.sibling}return null}function lf(l){var h=tg(l);return h!==null?ng(h):null}function ng(l){if(l.tag===he||l.tag===de)return l;for(var h=l.child;h!==null;){if(h.tag!==re){var w=ng(h);if(w!==null)return w}h=h.sibling}return null}var X_=s.unstable_scheduleCallback,hx=s.unstable_cancelCallback,rg=s.unstable_shouldYield,ku=s.unstable_requestPaint,ya=s.unstable_now,og=s.unstable_getCurrentPriorityLevel,Gc=s.unstable_ImmediatePriority,Hc=s.unstable_UserBlockingPriority,Fu=s.unstable_NormalPriority,ag=s.unstable_LowPriority,Pp=s.unstable_IdlePriority,Y_=s.unstable_yieldValue,sg=s.unstable_setDisableYieldValue,Lu=null,Qa=null,Wi=null,Fs=!1,dc=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u";function bh(l){if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")return!1;var h=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(h.isDisabled)return!0;if(!h.supportsFiber)return A("The installed version of React DevTools is too old and will not work with the current version of React. Please update React DevTools. https://reactjs.org/link/react-devtools"),!0;try{pn&&(l=ei({},l,{getLaneLabelMap:wh,injectProfilingHooks:Op})),Lu=h.inject(l),Qa=h}catch(w){A("React instrumentation encountered an error: %s.",w)}return!!h.checkDCE}function dx(l,h){if(Qa&&typeof Qa.onScheduleFiberRoot=="function")try{Qa.onScheduleFiberRoot(Lu,l,h)}catch(w){Fs||(Fs=!0,A("React instrumentation encountered an error: %s",w))}}function Hb(l,h){if(Qa&&typeof Qa.onCommitFiberRoot=="function")try{var w=(l.current.flags&Xr)===Xr;if(pr){var R;switch(h){case Es:R=Gc;break;case Tl:R=Hc;break;case mc:R=Fu;break;case Hp:R=Pp;break;default:R=Fu;break}Qa.onCommitFiberRoot(Lu,l,R,w)}}catch(O){Fs||(Fs=!0,A("React instrumentation encountered an error: %s",O))}}function lg(l){if(Qa&&typeof Qa.onPostCommitFiberRoot=="function")try{Qa.onPostCommitFiberRoot(Lu,l)}catch(h){Fs||(Fs=!0,A("React instrumentation encountered an error: %s",h))}}function cg(l){if(Qa&&typeof Qa.onCommitFiberUnmount=="function")try{Qa.onCommitFiberUnmount(Lu,l)}catch(h){Fs||(Fs=!0,A("React instrumentation encountered an error: %s",h))}}function Ho(l){if(typeof Y_=="function"&&(sg(l),v(l)),Qa&&typeof Qa.setStrictMode=="function")try{Qa.setStrictMode(Lu,l)}catch(h){Fs||(Fs=!0,A("React instrumentation encountered an error: %s",h))}}function Op(l){Wi=l}function wh(){{for(var l=new Map,h=1,w=0;w<Ar;w++){var R=Bp(h);l.set(h,R),h*=2}return l}}function K_(l){Wi!==null&&typeof Wi.markCommitStarted=="function"&&Wi.markCommitStarted(l)}function kp(){Wi!==null&&typeof Wi.markCommitStopped=="function"&&Wi.markCommitStopped()}function Th(l){Wi!==null&&typeof Wi.markComponentRenderStarted=="function"&&Wi.markComponentRenderStarted(l)}function $c(){Wi!==null&&typeof Wi.markComponentRenderStopped=="function"&&Wi.markComponentRenderStopped()}function ug(l){Wi!==null&&typeof Wi.markComponentPassiveEffectMountStarted=="function"&&Wi.markComponentPassiveEffectMountStarted(l)}function fx(){Wi!==null&&typeof Wi.markComponentPassiveEffectMountStopped=="function"&&Wi.markComponentPassiveEffectMountStopped()}function yd(l){Wi!==null&&typeof Wi.markComponentPassiveEffectUnmountStarted=="function"&&Wi.markComponentPassiveEffectUnmountStarted(l)}function cf(){Wi!==null&&typeof Wi.markComponentPassiveEffectUnmountStopped=="function"&&Wi.markComponentPassiveEffectUnmountStopped()}function li(l){Wi!==null&&typeof Wi.markComponentLayoutEffectMountStarted=="function"&&Wi.markComponentLayoutEffectMountStarted(l)}function J_(){Wi!==null&&typeof Wi.markComponentLayoutEffectMountStopped=="function"&&Wi.markComponentLayoutEffectMountStopped()}function Wc(l){Wi!==null&&typeof Wi.markComponentLayoutEffectUnmountStarted=="function"&&Wi.markComponentLayoutEffectUnmountStarted(l)}function zu(){Wi!==null&&typeof Wi.markComponentLayoutEffectUnmountStopped=="function"&&Wi.markComponentLayoutEffectUnmountStopped()}function Sh(l,h,w){Wi!==null&&typeof Wi.markComponentErrored=="function"&&Wi.markComponentErrored(l,h,w)}function Pi(l,h,w){Wi!==null&&typeof Wi.markComponentSuspended=="function"&&Wi.markComponentSuspended(l,h,w)}function Q_(l){Wi!==null&&typeof Wi.markLayoutEffectsStarted=="function"&&Wi.markLayoutEffectsStarted(l)}function px(){Wi!==null&&typeof Wi.markLayoutEffectsStopped=="function"&&Wi.markLayoutEffectsStopped()}function hg(l){Wi!==null&&typeof Wi.markPassiveEffectsStarted=="function"&&Wi.markPassiveEffectsStarted(l)}function dg(){Wi!==null&&typeof Wi.markPassiveEffectsStopped=="function"&&Wi.markPassiveEffectsStopped()}function fg(l){Wi!==null&&typeof Wi.markRenderStarted=="function"&&Wi.markRenderStarted(l)}function ey(){Wi!==null&&typeof Wi.markRenderYielded=="function"&&Wi.markRenderYielded()}function ty(){Wi!==null&&typeof Wi.markRenderStopped=="function"&&Wi.markRenderStopped()}function $b(l){Wi!==null&&typeof Wi.markRenderScheduled=="function"&&Wi.markRenderScheduled(l)}function Wb(l,h){Wi!==null&&typeof Wi.markForceUpdateScheduled=="function"&&Wi.markForceUpdateScheduled(l,h)}function Ss(l,h){Wi!==null&&typeof Wi.markStateUpdateScheduled=="function"&&Wi.markStateUpdateScheduled(l,h)}var Cn=0,Nn=1,Hr=2,ca=8,Ul=16,pg=Math.clz32?Math.clz32:tl,iy=Math.log,ny=Math.LN2;function tl(l){var h=l>>>0;return h===0?32:31-(iy(h)/ny|0)|0}var Ar=31,yi=0,ua=0,Yn=1,vd=2,hs=4,Nu=8,Ea=16,fc=32,Pt=4194240,Xt=64,Eh=128,ro=256,qe=512,Fp=1024,Ah=2048,Ch=4096,uf=8192,hf=16384,Ih=32768,Rh=65536,ry=131072,mg=262144,gg=524288,Ls=1048576,Lp=2097152,df=130023424,xd=4194304,ff=8388608,bd=16777216,Bu=33554432,_g=67108864,oy=xd,zp=134217728,ay=268435455,Np=268435456,ha=536870912,wl=1073741824;function Bp(l){{if(l&Yn)return"Sync";if(l&vd)return"InputContinuousHydration";if(l&hs)return"InputContinuous";if(l&Nu)return"DefaultHydration";if(l&Ea)return"Default";if(l&fc)return"TransitionHydration";if(l&Pt)return"Transition";if(l&df)return"Retry";if(l&zp)return"SelectiveHydration";if(l&Np)return"IdleHydration";if(l&ha)return"Idle";if(l&wl)return"Offscreen"}}var xn=-1,gn=Xt,pf=xd;function Wa(l){switch(Gu(l)){case Yn:return Yn;case vd:return vd;case hs:return hs;case Nu:return Nu;case Ea:return Ea;case fc:return fc;case Xt:case Eh:case ro:case qe:case Fp:case Ah:case Ch:case uf:case hf:case Ih:case Rh:case ry:case mg:case gg:case Ls:case Lp:return l&Pt;case xd:case ff:case bd:case Bu:case _g:return l&df;case zp:return zp;case Np:return Np;case ha:return ha;case wl:return wl;default:return A("Should have found matching lanes. This is a bug in React."),l}}function qc(l,h){var w=l.pendingLanes;if(w===yi)return yi;var R=yi,O=l.suspendedLanes,G=l.pingedLanes,K=w&ay;if(K!==yi){var ae=K&~O;if(ae!==yi)R=Wa(ae);else{var pe=K&G;pe!==yi&&(R=Wa(pe))}}else{var Oe=w&~O;Oe!==yi?R=Wa(Oe):G!==yi&&(R=Wa(G))}if(R===yi)return yi;if(h!==yi&&h!==R&&(h&O)===yi){var Ve=Gu(R),gt=Gu(h);if(Ve>=gt||Ve===Ea&&(gt&Pt)!==yi)return h}(R&hs)!==yi&&(R|=w&Ea);var pt=l.entangledLanes;if(pt!==yi)for(var Ht=l.entanglements,$t=R&pt;$t>0;){var oi=Gl($t),Ji=1<<oi;R|=Ht[oi],$t&=~Ji}return R}function mf(l,h){for(var w=l.eventTimes,R=xn;h>0;){var O=Gl(h),G=1<<O,K=w[O];K>R&&(R=K),h&=~G}return R}function Vu(l,h){switch(l){case Yn:case vd:case hs:return h+250;case Nu:case Ea:case fc:case Xt:case Eh:case ro:case qe:case Fp:case Ah:case Ch:case uf:case hf:case Ih:case Rh:case ry:case mg:case gg:case Ls:case Lp:return h+5e3;case xd:case ff:case bd:case Bu:case _g:return xn;case zp:case Np:case ha:case wl:return xn;default:return A("Should have found matching lanes. This is a bug in React."),xn}}function sy(l,h){for(var w=l.pendingLanes,R=l.suspendedLanes,O=l.pingedLanes,G=l.expirationTimes,K=w;K>0;){var ae=Gl(K),pe=1<<ae,Oe=G[ae];Oe===xn?((pe&R)===yi||(pe&O)!==yi)&&(G[ae]=Vu(pe,h)):Oe<=h&&(l.expiredLanes|=pe),K&=~pe}}function ly(l){return Wa(l.pendingLanes)}function gf(l){var h=l.pendingLanes&~wl;return h!==yi?h:h&wl?wl:yi}function yg(l){return(l&Yn)!==yi}function zs(l){return(l&ay)!==yi}function Uu(l){return(l&df)===l}function wd(l){var h=Yn|hs|Ea;return(l&h)===yi}function vg(l){return(l&Pt)===l}function Td(l,h){var w=vd|hs|Nu|Ea;return(h&w)!==yi}function _f(l,h){return(h&l.expiredLanes)!==yi}function ju(l){return(l&Pt)!==yi}function xg(){var l=gn;return gn<<=1,(gn&Pt)===yi&&(gn=Xt),l}function jl(){var l=pf;return pf<<=1,(pf&df)===yi&&(pf=xd),l}function Gu(l){return l&-l}function Dh(l){return Gu(l)}function Gl(l){return 31-pg(l)}function Mh(l){return Gl(l)}function lr(l,h){return(l&h)!==yi}function pc(l,h){return(l&h)===h}function _r(l,h){return l|h}function yf(l,h){return l&~h}function Ph(l,h){return l&h}function mx(l){return l}function Vp(l,h){return l!==ua&&l<h?l:h}function Up(l){for(var h=[],w=0;w<Ar;w++)h.push(l);return h}function Hl(l,h,w){l.pendingLanes|=h,h!==ha&&(l.suspendedLanes=yi,l.pingedLanes=yi);var R=l.eventTimes,O=Mh(h);R[O]=w}function cy(l,h){l.suspendedLanes|=h,l.pingedLanes&=~h;for(var w=l.expirationTimes,R=h;R>0;){var O=Gl(R),G=1<<O;w[O]=xn,R&=~G}}function jp(l,h,w){l.pingedLanes|=l.suspendedLanes&h}function bg(l,h){var w=l.pendingLanes&~h;l.pendingLanes=h,l.suspendedLanes=yi,l.pingedLanes=yi,l.expiredLanes&=h,l.mutableReadLanes&=h,l.entangledLanes&=h;for(var R=l.entanglements,O=l.eventTimes,G=l.expirationTimes,K=w;K>0;){var ae=Gl(K),pe=1<<ae;R[ae]=yi,O[ae]=xn,G[ae]=xn,K&=~pe}}function Oh(l,h){for(var w=l.entangledLanes|=h,R=l.entanglements,O=w;O;){var G=Gl(O),K=1<<G;K&h|R[G]&h&&(R[G]|=h),O&=~K}}function uy(l,h){var w=Gu(h),R;switch(w){case hs:R=vd;break;case Ea:R=Nu;break;case Xt:case Eh:case ro:case qe:case Fp:case Ah:case Ch:case uf:case hf:case Ih:case Rh:case ry:case mg:case gg:case Ls:case Lp:case xd:case ff:case bd:case Bu:case _g:R=fc;break;case ha:R=Np;break;default:R=ua;break}return(R&(l.suspendedLanes|h))!==ua?ua:R}function Gp(l,h,w){if(dc)for(var R=l.pendingUpdatersLaneMap;w>0;){var O=Mh(w),G=1<<O,K=R[O];K.add(h),w&=~G}}function wg(l,h){if(dc)for(var w=l.pendingUpdatersLaneMap,R=l.memoizedUpdaters;h>0;){var O=Mh(h),G=1<<O,K=w[O];K.size>0&&(K.forEach(function(ae){var pe=ae.alternate;(pe===null||!R.has(pe))&&R.add(ae)}),K.clear()),h&=~G}}function hy(l,h){return null}var Es=Yn,Tl=hs,mc=Ea,Hp=ha,Sd=ua;function $l(){return Sd}function Aa(l){Sd=l}function gx(l,h){var w=Sd;try{return Sd=l,h()}finally{Sd=w}}function _x(l,h){return l!==0&&l<h?l:h}function yx(l,h){return l>h?l:h}function Tg(l,h){return l!==0&&l<h}function dy(l){var h=Gu(l);return Tg(Es,h)?Tg(Tl,h)?zs(h)?mc:Hp:Tl:Es}function Sg(l){var h=l.current.memoizedState;return h.isDehydrated}var vx;function oo(l){vx=l}function xx(l){vx(l)}var fy;function qb(l){fy=l}var bx;function $p(l){bx=l}var vf;function py(l){vf=l}var Wp;function Wl(l){Wp=l}var xf=!1,So=[],ds=null,Sl=null,ql=null,Ed=new Map,bf=new Map,Zl=[],Zb=["mousedown","mouseup","touchcancel","touchend","touchstart","auxclick","dblclick","pointercancel","pointerdown","pointerup","dragend","dragstart","drop","compositionend","compositionstart","keydown","keypress","keyup","input","textInput","copy","cut","paste","click","change","contextmenu","reset","submit"];function wx(l){return Zb.indexOf(l)>-1}function my(l,h,w,R,O){return{blockedOn:l,domEventName:h,eventSystemFlags:w,nativeEvent:O,targetContainers:[R]}}function Eg(l,h){switch(l){case"focusin":case"focusout":ds=null;break;case"dragenter":case"dragleave":Sl=null;break;case"mouseover":case"mouseout":ql=null;break;case"pointerover":case"pointerout":{var w=h.pointerId;Ed.delete(w);break}case"gotpointercapture":case"lostpointercapture":{var R=h.pointerId;bf.delete(R);break}}}function kh(l,h,w,R,O,G){if(l===null||l.nativeEvent!==G){var K=my(h,w,R,O,G);if(h!==null){var ae=Jc(h);ae!==null&&fy(ae)}return K}l.eventSystemFlags|=R;var pe=l.targetContainers;return O!==null&&pe.indexOf(O)===-1&&pe.push(O),l}function Ag(l,h,w,R,O){switch(h){case"focusin":{var G=O;return ds=kh(ds,l,h,w,R,G),!0}case"dragenter":{var K=O;return Sl=kh(Sl,l,h,w,R,K),!0}case"mouseover":{var ae=O;return ql=kh(ql,l,h,w,R,ae),!0}case"pointerover":{var pe=O,Oe=pe.pointerId;return Ed.set(Oe,kh(Ed.get(Oe)||null,l,h,w,R,pe)),!0}case"gotpointercapture":{var Ve=O,gt=Ve.pointerId;return bf.set(gt,kh(bf.get(gt)||null,l,h,w,R,Ve)),!0}}return!1}function wf(l){var h=Od(l.target);if(h!==null){var w=xh(h);if(w!==null){var R=w.tag;if(R===Ye){var O=q_(w);if(O!==null){l.blockedOn=O,Wp(l.priority,function(){bx(w)});return}}else if(R===X){var G=w.stateNode;if(Sg(G)){l.blockedOn=ux(w);return}}}}l.blockedOn=null}function Hu(l){for(var h=vf(),w={blockedOn:null,target:l,priority:h},R=0;R<Zl.length&&Tg(h,Zl[R].priority);R++);Zl.splice(R,0,w),R===0&&wf(w)}function il(l){if(l.blockedOn!==null)return!1;for(var h=l.targetContainers;h.length>0;){var w=h[0],R=b(l.domEventName,l.eventSystemFlags,w,l.nativeEvent);if(R===null){var O=l.nativeEvent,G=new O.constructor(O.type,O);Tp(G),O.target.dispatchEvent(G),Lc()}else{var K=Jc(R);return K!==null&&fy(K),l.blockedOn=R,!1}h.shift()}return!0}function qa(l,h,w){il(l)&&w.delete(h)}function $u(){xf=!1,ds!==null&&il(ds)&&(ds=null),Sl!==null&&il(Sl)&&(Sl=null),ql!==null&&il(ql)&&(ql=null),Ed.forEach(qa),bf.forEach(qa)}function Ns(l,h){l.blockedOn===h&&(l.blockedOn=null,xf||(xf=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,$u)))}function qp(l){if(So.length>0){Ns(So[0],l);for(var h=1;h<So.length;h++){var w=So[h];w.blockedOn===l&&(w.blockedOn=null)}}ds!==null&&Ns(ds,l),Sl!==null&&Ns(Sl,l),ql!==null&&Ns(ql,l);var R=function(ae){return Ns(ae,l)};Ed.forEach(R),bf.forEach(R);for(var O=0;O<Zl.length;O++){var G=Zl[O];G.blockedOn===l&&(G.blockedOn=null)}for(;Zl.length>0;){var K=Zl[0];if(K.blockedOn!==null)break;wf(K),K.blockedOn===null&&Zl.shift()}}var Tf=u.ReactCurrentBatchConfig,gy=!0;function Tx(l){gy=!!l}function _y(){return gy}function Bs(l,h,w){var R=T(h),O;switch(R){case Es:O=f;break;case Tl:O=t;break;case mc:default:O=o;break}return O.bind(null,h,w,l)}function f(l,h,w,R){var O=$l(),G=Tf.transition;Tf.transition=null;try{Aa(Es),o(l,h,w,R)}finally{Aa(O),Tf.transition=G}}function t(l,h,w,R){var O=$l(),G=Tf.transition;Tf.transition=null;try{Aa(Tl),o(l,h,w,R)}finally{Aa(O),Tf.transition=G}}function o(l,h,w,R){gy&&p(l,h,w,R)}function p(l,h,w,R){var O=b(l,h,w,R);if(O===null){Af(l,h,R,y,w),Eg(l,R);return}if(Ag(O,l,h,w,R)){R.stopPropagation();return}if(Eg(l,R),h&Fc&&wx(l)){for(;O!==null;){var G=Jc(O);G!==null&&xx(G);var K=b(l,h,w,R);if(K===null&&Af(l,h,R,y,w),K===O)break;O=K}O!==null&&R.stopPropagation();return}Af(l,h,R,null,w)}var y=null;function b(l,h,w,R){y=null;var O=el(R),G=Od(O);if(G!==null){var K=xh(G);if(K===null)G=null;else{var ae=K.tag;if(ae===Ye){var pe=q_(K);if(pe!==null)return pe;G=null}else if(ae===X){var Oe=K.stateNode;if(Sg(Oe))return ux(K);G=null}else K!==G&&(G=null)}}return y=G,null}function T(l){switch(l){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return Es;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return Tl;case"message":{var h=og();switch(h){case Gc:return Es;case Hc:return Tl;case Fu:case ag:return mc;case Pp:return Hp;default:return mc}}default:return mc}}function I(l,h,w){return l.addEventListener(h,w,!1),w}function D(l,h,w){return l.addEventListener(h,w,!0),w}function F(l,h,w,R){return l.addEventListener(h,w,{capture:!0,passive:R}),w}function z(l,h,w,R){return l.addEventListener(h,w,{passive:R}),w}var j=null,B=null,$=null;function Z(l){return j=l,B=te(),!0}function Q(){j=null,B=null,$=null}function ne(){if($)return $;var l,h=B,w=h.length,R,O=te(),G=O.length;for(l=0;l<w&&h[l]===O[l];l++);var K=w-l;for(R=1;R<=K&&h[w-R]===O[G-R];R++);var ae=R>1?1-R:void 0;return $=O.slice(l,ae),$}function te(){return"value"in j?j.value:j.textContent}function se(l){var h,w=l.keyCode;return"charCode"in l?(h=l.charCode,h===0&&w===13&&(h=13)):h=w,h===10&&(h=13),h>=32||h===13?h:0}function me(){return!0}function ce(){return!1}function Ce(l){function h(w,R,O,G,K){this._reactName=w,this._targetInst=O,this.type=R,this.nativeEvent=G,this.target=K,this.currentTarget=null;for(var ae in l)if(l.hasOwnProperty(ae)){var pe=l[ae];pe?this[ae]=pe(G):this[ae]=G[ae]}var Oe=G.defaultPrevented!=null?G.defaultPrevented:G.returnValue===!1;return Oe?this.isDefaultPrevented=me:this.isDefaultPrevented=ce,this.isPropagationStopped=ce,this}return ei(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=me)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=me)},persist:function(){},isPersistent:me}),h}var _e={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Re=Ce(_e),Ae=ei({},_e,{view:0,detail:0}),Te=Ce(Ae),De,He,Ue;function rt(l){l!==Ue&&(Ue&&l.type==="mousemove"?(De=l.screenX-Ue.screenX,He=l.screenY-Ue.screenY):(De=0,He=0),Ue=l)}var Qe=ei({},Ae,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:In,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(rt(l),De)},movementY:function(l){return"movementY"in l?l.movementY:He}}),lt=Ce(Qe),Lt=ei({},Qe,{dataTransfer:0}),Xe=Ce(Lt),Ne=ei({},Ae,{relatedTarget:0}),ct=Ce(Ne),et=ei({},_e,{animationName:0,elapsedTime:0,pseudoElement:0}),At=Ce(et),jt=ei({},_e,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),pi=Ce(jt),Ft=ei({},_e,{data:0}),zt=Ce(Ft),mi=zt,ni={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},ii={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};function ri(l){if(l.key){var h=ni[l.key]||l.key;if(h!=="Unidentified")return h}if(l.type==="keypress"){var w=se(l);return w===13?"Enter":String.fromCharCode(w)}return l.type==="keydown"||l.type==="keyup"?ii[l.keyCode]||"Unidentified":""}var Oi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wn(l){var h=this,w=h.nativeEvent;if(w.getModifierState)return w.getModifierState(l);var R=Oi[l];return R?!!w[R]:!1}function In(l){return wn}var vr=ei({},Ae,{key:ri,code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:In,charCode:function(l){return l.type==="keypress"?se(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?se(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),Ui=Ce(vr),Dn=ei({},Qe,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),tn=Ce(Dn),mr=ei({},Ae,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:In}),kn=Ce(mr),Cr=ei({},_e,{propertyName:0,elapsedTime:0,pseudoElement:0}),Hn=Ce(Cr),ln=ei({},Qe,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),rr=Ce(ln),dn=[9,13,27,32],zr=229,Kn=Xi&&"CompositionEvent"in window,Bi=null;Xi&&"documentMode"in document&&(Bi=document.documentMode);var Bn=Xi&&"TextEvent"in window&&!Bi,Yr=Xi&&(!Kn||Bi&&Bi>8&&Bi<=11),Eo=32,Qr=String.fromCharCode(Eo);function xo(){mn("onBeforeInput",["compositionend","keypress","textInput","paste"]),mn("onCompositionEnd",["compositionend","focusout","keydown","keypress","keyup","mousedown"]),mn("onCompositionStart",["compositionstart","focusout","keydown","keypress","keyup","mousedown"]),mn("onCompositionUpdate",["compositionupdate","focusout","keydown","keypress","keyup","mousedown"])}var As=!1;function Cs(l){return(l.ctrlKey||l.altKey||l.metaKey)&&!(l.ctrlKey&&l.altKey)}function Za(l){switch(l){case"compositionstart":return"onCompositionStart";case"compositionend":return"onCompositionEnd";case"compositionupdate":return"onCompositionUpdate"}}function es(l,h){return l==="keydown"&&h.keyCode===zr}function nl(l,h){switch(l){case"keyup":return dn.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==zr;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Fa(l){var h=l.detail;return typeof h=="object"&&"data"in h?h.data:null}function rl(l){return l.locale==="ko"}var fs=!1;function Ca(l,h,w,R,O){var G,K;if(Kn?G=Za(h):fs?nl(h,R)&&(G="onCompositionEnd"):es(h,R)&&(G="onCompositionStart"),!G)return null;Yr&&!rl(R)&&(!fs&&G==="onCompositionStart"?fs=Z(O):G==="onCompositionEnd"&&fs&&(K=ne()));var ae=Yp(w,G);if(ae.length>0){var pe=new zt(G,h,null,R,O);if(l.push({event:pe,listeners:ae}),K)pe.data=K;else{var Oe=Fa(R);Oe!==null&&(pe.data=Oe)}}}function mo(l,h){switch(l){case"compositionend":return Fa(h);case"keypress":var w=h.which;return w!==Eo?null:(As=!0,Qr);case"textInput":var R=h.data;return R===Qr&&As?null:R;default:return null}}function Mo(l,h){if(fs){if(l==="compositionend"||!Kn&&nl(l,h)){var w=ne();return Q(),fs=!1,w}return null}switch(l){case"paste":return null;case"keypress":if(!Cs(h)){if(h.char&&h.char.length>1)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return Yr&&!rl(h)?null:h.data;default:return null}}function Tr(l,h,w,R,O){var G;if(Bn?G=mo(h,R):G=Mo(h,R),!G)return null;var K=Yp(w,"onBeforeInput");if(K.length>0){var ae=new mi("onBeforeInput","beforeinput",null,R,O);l.push({event:ae,listeners:K}),ae.data=G}}function Bo(l,h,w,R,O,G,K){Ca(l,h,w,R,O),Tr(l,h,w,R,O)}var Ia={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ao(l){var h=l&&l.nodeName&&l.nodeName.toLowerCase();return h==="input"?!!Ia[l.type]:h==="textarea"}/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function El(l){if(!Xi)return!1;var h="on"+l,w=h in document;if(!w){var R=document.createElement("div");R.setAttribute(h,"return;"),w=typeof R[h]=="function"}return w}function Sf(){mn("onChange",["change","click","focusin","focusout","input","keydown","keyup","selectionchange"])}function Zc(l,h,w,R){nx(R);var O=Yp(h,"onChange");if(O.length>0){var G=new Re("onChange","change",null,w,R);l.push({event:G,listeners:O})}}var Xc=null,Yc=null;function Al(l){var h=l.nodeName&&l.nodeName.toLowerCase();return h==="select"||h==="input"&&l.type==="file"}function Kc(l){var h=[];Zc(h,Yc,l,el(l)),ox(va,h)}function va(l){iS(l,0)}function Is(l){var h=Wg(l);if(Tu(h))return l}function Ad(l,h){if(l==="change")return h}var yy=!1;Xi&&(yy=El("input")&&(!document.documentMode||document.documentMode>9));function Cg(l,h){Xc=l,Yc=h,Xc.attachEvent("onpropertychange",Xb)}function NT(){Xc&&(Xc.detachEvent("onpropertychange",Xb),Xc=null,Yc=null)}function Xb(l){l.propertyName==="value"&&Is(Yc)&&Kc(l)}function Sx(l,h,w){l==="focusin"?(NT(),Cg(h,w)):l==="focusout"&&NT()}function QA(l,h){if(l==="selectionchange"||l==="keyup"||l==="keydown")return Is(Yc)}function BT(l){var h=l.nodeName;return h&&h.toLowerCase()==="input"&&(l.type==="checkbox"||l.type==="radio")}function eC(l,h){if(l==="click")return Is(h)}function Yb(l,h){if(l==="input"||l==="change")return Is(h)}function Fh(l){var h=l._wrapperState;!h||!h.controlled||l.type!=="number"||vn(l,"number",l.value)}function Cd(l,h,w,R,O,G,K){var ae=w?Wg(w):window,pe,Oe;if(Al(ae)?pe=Ad:ao(ae)?yy?pe=Yb:(pe=QA,Oe=Sx):BT(ae)&&(pe=eC),pe){var Ve=pe(h,w);if(Ve){Zc(l,Ve,R,O);return}}Oe&&Oe(h,ae,w),h==="focusout"&&Fh(ae)}function VT(){Ei("onMouseEnter",["mouseout","mouseover"]),Ei("onMouseLeave",["mouseout","mouseover"]),Ei("onPointerEnter",["pointerout","pointerover"]),Ei("onPointerLeave",["pointerout","pointerover"])}function UT(l,h,w,R,O,G,K){var ae=h==="mouseover"||h==="pointerover",pe=h==="mouseout"||h==="pointerout";if(ae&&!$m(R)){var Oe=R.relatedTarget||R.fromElement;if(Oe&&(Od(Oe)||im(Oe)))return}if(!(!pe&&!ae)){var Ve;if(O.window===O)Ve=O;else{var gt=O.ownerDocument;gt?Ve=gt.defaultView||gt.parentWindow:Ve=window}var pt,Ht;if(pe){var $t=R.relatedTarget||R.toElement;if(pt=w,Ht=$t?Od($t):null,Ht!==null){var oi=xh(Ht);(Ht!==oi||Ht.tag!==he&&Ht.tag!==de)&&(Ht=null)}}else pt=null,Ht=w;if(pt!==Ht){var Ji=lt,Vn="onMouseLeave",An="onMouseEnter",lo="mouse";(h==="pointerout"||h==="pointerover")&&(Ji=tn,Vn="onPointerLeave",An="onPointerEnter",lo="pointer");var Kr=pt==null?Ve:Wg(pt),Ot=Ht==null?Ve:Wg(Ht),ai=new Ji(Vn,lo+"leave",pt,R,O);ai.target=Kr,ai.relatedTarget=Ot;var kt=null,Ci=Od(O);if(Ci===w){var cn=new Ji(An,lo+"enter",Ht,R,O);cn.target=Ot,cn.relatedTarget=Kr,kt=cn}Ay(l,ai,kt,pt,Ht)}}}function Ex(l,h){return l===h&&(l!==0||1/l===1/h)||l!==l&&h!==h}var Cl=typeof Object.is=="function"?Object.is:Ex;function Id(l,h){if(Cl(l,h))return!0;if(typeof l!="object"||l===null||typeof h!="object"||h===null)return!1;var w=Object.keys(l),R=Object.keys(h);if(w.length!==R.length)return!1;for(var O=0;O<w.length;O++){var G=w[O];if(!Rn.call(h,G)||!Cl(l[G],h[G]))return!1}return!0}function vy(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function jT(l){for(;l;){if(l.nextSibling)return l.nextSibling;l=l.parentNode}}function xy(l,h){for(var w=vy(l),R=0,O=0;w;){if(w.nodeType===Do){if(O=R+w.textContent.length,R<=h&&O>=h)return{node:w,offset:h-R};R=O}w=vy(jT(w))}}function Kb(l){var h=l.ownerDocument,w=h&&h.defaultView||window,R=w.getSelection&&w.getSelection();if(!R||R.rangeCount===0)return null;var O=R.anchorNode,G=R.anchorOffset,K=R.focusNode,ae=R.focusOffset;try{O.nodeType,K.nodeType}catch{return null}return Jb(l,O,G,K,ae)}function Jb(l,h,w,R,O){var G=0,K=-1,ae=-1,pe=0,Oe=0,Ve=l,gt=null;e:for(;;){for(var pt=null;Ve===h&&(w===0||Ve.nodeType===Do)&&(K=G+w),Ve===R&&(O===0||Ve.nodeType===Do)&&(ae=G+O),Ve.nodeType===Do&&(G+=Ve.nodeValue.length),(pt=Ve.firstChild)!==null;)gt=Ve,Ve=pt;for(;;){if(Ve===l)break e;if(gt===h&&++pe===w&&(K=G),gt===R&&++Oe===O&&(ae=G),(pt=Ve.nextSibling)!==null)break;Ve=gt,gt=Ve.parentNode}Ve=pt}return K===-1||ae===-1?null:{start:K,end:ae}}function GT(l,h){var w=l.ownerDocument||document,R=w&&w.defaultView||window;if(R.getSelection){var O=R.getSelection(),G=l.textContent.length,K=Math.min(h.start,G),ae=h.end===void 0?K:Math.min(h.end,G);if(!O.extend&&K>ae){var pe=ae;ae=K,K=pe}var Oe=xy(l,K),Ve=xy(l,ae);if(Oe&&Ve){if(O.rangeCount===1&&O.anchorNode===Oe.node&&O.anchorOffset===Oe.offset&&O.focusNode===Ve.node&&O.focusOffset===Ve.offset)return;var gt=w.createRange();gt.setStart(Oe.node,Oe.offset),O.removeAllRanges(),K>ae?(O.addRange(gt),O.extend(Ve.node,Ve.offset)):(gt.setEnd(Ve.node,Ve.offset),O.addRange(gt))}}}function Qb(l){return l&&l.nodeType===Do}function Rd(l,h){return!l||!h?!1:l===h?!0:Qb(l)?!1:Qb(h)?Rd(l,h.parentNode):"contains"in l?l.contains(h):l.compareDocumentPosition?!!(l.compareDocumentPosition(h)&16):!1}function HT(l){return l&&l.ownerDocument&&Rd(l.ownerDocument.documentElement,l)}function e1(l){try{return typeof l.contentWindow.location.href=="string"}catch{return!1}}function t1(){for(var l=window,h=sc();h instanceof l.HTMLIFrameElement;){if(e1(h))l=h.contentWindow;else return h;h=sc(l.document)}return h}function i1(l){var h=l&&l.nodeName&&l.nodeName.toLowerCase();return h&&(h==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||h==="textarea"||l.contentEditable==="true")}function tC(){var l=t1();return{focusedElem:l,selectionRange:i1(l)?$T(l):null}}function iC(l){var h=t1(),w=l.focusedElem,R=l.selectionRange;if(h!==w&&HT(w)){R!==null&&i1(w)&&WT(w,R);for(var O=[],G=w;G=G.parentNode;)G.nodeType===Ja&&O.push({element:G,left:G.scrollLeft,top:G.scrollTop});typeof w.focus=="function"&&w.focus();for(var K=0;K<O.length;K++){var ae=O[K];ae.element.scrollLeft=ae.left,ae.element.scrollTop=ae.top}}}function $T(l){var h;return"selectionStart"in l?h={start:l.selectionStart,end:l.selectionEnd}:h=Kb(l),h||{start:0,end:0}}function WT(l,h){var w=h.start,R=h.end;R===void 0&&(R=w),"selectionStart"in l?(l.selectionStart=w,l.selectionEnd=Math.min(R,l.value.length)):GT(l,h)}var nC=Xi&&"documentMode"in document&&document.documentMode<=11;function qT(){mn("onSelect",["focusout","contextmenu","dragend","focusin","keydown","keyup","mousedown","mouseup","selectionchange"])}var Ig=null,n1=null,Rg=null,Ax=!1;function ZT(l){if("selectionStart"in l&&i1(l))return{start:l.selectionStart,end:l.selectionEnd};var h=l.ownerDocument&&l.ownerDocument.defaultView||window,w=h.getSelection();return{anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}}function XT(l){return l.window===l?l.document:l.nodeType===sa?l:l.ownerDocument}function r1(l,h,w){var R=XT(w);if(!(Ax||Ig==null||Ig!==sc(R))){var O=ZT(Ig);if(!Rg||!Id(Rg,O)){Rg=O;var G=Yp(n1,"onSelect");if(G.length>0){var K=new Re("onSelect","select",null,h,w);l.push({event:K,listeners:G}),K.target=Ig}}}}function YT(l,h,w,R,O,G,K){var ae=w?Wg(w):window;switch(h){case"focusin":(ao(ae)||ae.contentEditable==="true")&&(Ig=ae,n1=w,Rg=null);break;case"focusout":Ig=null,n1=null,Rg=null;break;case"mousedown":Ax=!0;break;case"contextmenu":case"mouseup":case"dragend":Ax=!1,r1(l,R,O);break;case"selectionchange":if(nC)break;case"keydown":case"keyup":r1(l,R,O)}}function by(l,h){var w={};return w[l.toLowerCase()]=h.toLowerCase(),w["Webkit"+l]="webkit"+h,w["Moz"+l]="moz"+h,w}var Ef={animationend:by("Animation","AnimationEnd"),animationiteration:by("Animation","AnimationIteration"),animationstart:by("Animation","AnimationStart"),transitionend:by("Transition","TransitionEnd")},Lh={},Xa={};Xi&&(Xa=document.createElement("div").style,"AnimationEvent"in window||(delete Ef.animationend.animation,delete Ef.animationiteration.animation,delete Ef.animationstart.animation),"TransitionEvent"in window||delete Ef.transitionend.transition);function wy(l){if(Lh[l])return Lh[l];if(!Ef[l])return l;var h=Ef[l];for(var w in h)if(h.hasOwnProperty(w)&&w in Xa)return Lh[l]=h[w];return l}var Dg=wy("animationend"),KT=wy("animationiteration"),JT=wy("animationstart"),QT=wy("transitionend"),eS=new Map,Zp=["abort","auxClick","cancel","canPlay","canPlayThrough","click","close","contextMenu","copy","cut","drag","dragEnd","dragEnter","dragExit","dragLeave","dragOver","dragStart","drop","durationChange","emptied","encrypted","ended","error","gotPointerCapture","input","invalid","keyDown","keyPress","keyUp","load","loadedData","loadedMetadata","loadStart","lostPointerCapture","mouseDown","mouseMove","mouseOut","mouseOver","mouseUp","paste","pause","play","playing","pointerCancel","pointerDown","pointerMove","pointerOut","pointerOver","pointerUp","progress","rateChange","reset","resize","seeked","seeking","stalled","submit","suspend","timeUpdate","touchCancel","touchEnd","touchStart","volumeChange","scroll","toggle","touchMove","waiting","wheel"];function Dd(l,h){eS.set(l,h),mn(h,[l])}function Xp(){for(var l=0;l<Zp.length;l++){var h=Zp[l],w=h.toLowerCase(),R=h[0].toUpperCase()+h.slice(1);Dd(w,"on"+R)}Dd(Dg,"onAnimationEnd"),Dd(KT,"onAnimationIteration"),Dd(JT,"onAnimationStart"),Dd("dblclick","onDoubleClick"),Dd("focusin","onFocus"),Dd("focusout","onBlur"),Dd(QT,"onTransitionEnd")}function Ty(l,h,w,R,O,G,K){var ae=eS.get(h);if(ae!==void 0){var pe=Re,Oe=h;switch(h){case"keypress":if(se(R)===0)return;case"keydown":case"keyup":pe=Ui;break;case"focusin":Oe="focus",pe=ct;break;case"focusout":Oe="blur",pe=ct;break;case"beforeblur":case"afterblur":pe=ct;break;case"click":if(R.button===2)return;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pe=lt;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pe=Xe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pe=kn;break;case Dg:case KT:case JT:pe=At;break;case QT:pe=Hn;break;case"scroll":pe=Te;break;case"wheel":pe=rr;break;case"copy":case"cut":case"paste":pe=pi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pe=tn;break}var Ve=(G&Fc)!==0;{var gt=!Ve&&h==="scroll",pt=Cx(w,ae,R.type,Ve,gt);if(pt.length>0){var Ht=new pe(ae,Oe,null,R,O);l.push({event:Ht,listeners:pt})}}}}Xp(),VT(),Sf(),qT(),xo();function rC(l,h,w,R,O,G,K){Ty(l,h,w,R,O,G);var ae=(G&Qd)===0;ae&&(UT(l,h,w,R,O),Cd(l,h,w,R,O),YT(l,h,w,R,O),Bo(l,h,w,R,O))}var Sy=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","resize","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],o1=new Set(["cancel","close","invalid","load","scroll","toggle"].concat(Sy));function tS(l,h,w){var R=l.type||"unknown-event";l.currentTarget=w,Km(R,h,void 0,l),l.currentTarget=null}function oC(l,h,w){var R;if(w)for(var O=h.length-1;O>=0;O--){var G=h[O],K=G.instance,ae=G.currentTarget,pe=G.listener;if(K!==R&&l.isPropagationStopped())return;tS(l,pe,ae),R=K}else for(var Oe=0;Oe<h.length;Oe++){var Ve=h[Oe],gt=Ve.instance,pt=Ve.currentTarget,Ht=Ve.listener;if(gt!==R&&l.isPropagationStopped())return;tS(l,Ht,pt),R=gt}}function iS(l,h){for(var w=(h&Fc)!==0,R=0;R<l.length;R++){var O=l[R],G=O.event,K=O.listeners;oC(G,K,w)}Jm()}function aC(l,h,w,R,O){var G=el(w),K=[];rC(K,l,R,w,G,h),iS(K,h)}function Qo(l,h){o1.has(l)||A('Did not expect a listenToNonDelegatedEvent() call for "%s". This is a bug in React. Please file an issue.',l);var w=!1,R=CC(h),O=l1(l);R.has(O)||(nS(h,l,wp,w),R.add(O))}function a1(l,h,w){o1.has(l)&&!h&&A('Did not expect a listenToNativeEvent() call for "%s" in the bubble phase. This is a bug in React. Please file an issue.',l);var R=0;h&&(R|=Fc),nS(w,l,R,h)}var Ey="_reactListening"+Math.random().toString(36).slice(2);function Md(l){if(!l[Ey]){l[Ey]=!0,Or.forEach(function(w){w!=="selectionchange"&&(o1.has(w)||a1(w,!1,l),a1(w,!0,l))});var h=l.nodeType===sa?l:l.ownerDocument;h!==null&&(h[Ey]||(h[Ey]=!0,a1("selectionchange",!1,h)))}}function nS(l,h,w,R,O){var G=Bs(l,h,w),K=void 0;Xm&&(h==="touchstart"||h==="touchmove"||h==="wheel")&&(K=!0),l=l,R?K!==void 0?F(l,h,G,K):D(l,h,G):K!==void 0?z(l,h,G,K):I(l,h,G)}function xa(l,h){return l===h||l.nodeType===zo&&l.parentNode===h}function Af(l,h,w,R,O){var G=R;if(!(h&Bt)&&!(h&wp)){var K=O;if(R!==null){var ae=R;e:for(;;){if(ae===null)return;var pe=ae.tag;if(pe===X||pe===re){var Oe=ae.stateNode.containerInfo;if(xa(Oe,K))break;if(pe===re)for(var Ve=ae.return;Ve!==null;){var gt=Ve.tag;if(gt===X||gt===re){var pt=Ve.stateNode.containerInfo;if(xa(pt,K))return}Ve=Ve.return}for(;Oe!==null;){var Ht=Od(Oe);if(Ht===null)return;var $t=Ht.tag;if($t===he||$t===de){ae=G=Ht;continue e}Oe=Oe.parentNode}}ae=ae.return}}}ox(function(){return aC(l,h,w,G)})}function Mg(l,h,w){return{instance:l,listener:h,currentTarget:w}}function Cx(l,h,w,R,O,G){for(var K=h!==null?h+"Capture":null,ae=R?K:h,pe=[],Oe=l,Ve=null;Oe!==null;){var gt=Oe,pt=gt.stateNode,Ht=gt.tag;if(Ht===he&&pt!==null&&(Ve=pt,ae!==null)){var $t=Sp(Oe,ae);$t!=null&&pe.push(Mg(Oe,$t,Ve))}if(O)break;Oe=Oe.return}return pe}function Yp(l,h){for(var w=h+"Capture",R=[],O=l;O!==null;){var G=O,K=G.stateNode,ae=G.tag;if(ae===he&&K!==null){var pe=K,Oe=Sp(O,w);Oe!=null&&R.unshift(Mg(O,Oe,pe));var Ve=Sp(O,h);Ve!=null&&R.push(Mg(O,Ve,pe))}O=O.return}return R}function zh(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==he);return l||null}function rS(l,h){for(var w=l,R=h,O=0,G=w;G;G=zh(G))O++;for(var K=0,ae=R;ae;ae=zh(ae))K++;for(;O-K>0;)w=zh(w),O--;for(;K-O>0;)R=zh(R),K--;for(var pe=O;pe--;){if(w===R||R!==null&&w===R.alternate)return w;w=zh(w),R=zh(R)}return null}function s1(l,h,w,R,O){for(var G=h._reactName,K=[],ae=w;ae!==null&&ae!==R;){var pe=ae,Oe=pe.alternate,Ve=pe.stateNode,gt=pe.tag;if(Oe!==null&&Oe===R)break;if(gt===he&&Ve!==null){var pt=Ve;if(O){var Ht=Sp(ae,G);Ht!=null&&K.unshift(Mg(ae,Ht,pt))}else if(!O){var $t=Sp(ae,G);$t!=null&&K.push(Mg(ae,$t,pt))}}ae=ae.return}K.length!==0&&l.push({event:h,listeners:K})}function Ay(l,h,w,R,O){var G=R&&O?rS(R,O):null;R!==null&&s1(l,h,R,G,!1),O!==null&&w!==null&&s1(l,w,O,G,!0)}function l1(l,h){return l+"__bubble"}var Rs=!1,Cy="dangerouslySetInnerHTML",Iy="suppressContentEditableWarning",Nh="suppressHydrationWarning",Ix="autoFocus",Cf="children",Il="style",Rx="__html",Vs,Ry,Pg,c1,Kp,oS,aS;Vs={dialog:!0,webview:!0},Ry=function(l,h){zl(l,h),bp(l,h),Hm(l,h,{registrationNameDependencies:kr,possibleRegistrationNames:Wr})},oS=Xi&&!document.documentMode,Pg=function(l,h,w){if(!Rs){var R=Og(w),O=Og(h);O!==R&&(Rs=!0,A("Prop `%s` did not match. Server: %s Client: %s",l,JSON.stringify(O),JSON.stringify(R)))}},c1=function(l){if(!Rs){Rs=!0;var h=[];l.forEach(function(w){h.push(w)}),A("Extra attributes from the server: %s",h)}},Kp=function(l,h){h===!1?A("Expected `%s` listener to be a function, instead got `false`.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.",l,l,l):A("Expected `%s` listener to be a function, instead got a value of `%s` type.",l,typeof h)},aS=function(l,h){var w=l.namespaceURI===Lo?l.ownerDocument.createElement(l.tagName):l.ownerDocument.createElementNS(l.namespaceURI,l.tagName);return w.innerHTML=h,w.innerHTML};var u1=/\r\n?/g,sS=/\u0000|\uFFFD/g;function Og(l){ma(l);var h=typeof l=="string"?l:""+l;return h.replace(u1,`
`).replace(sS,"")}function kg(l,h,w,R){var O=Og(h),G=Og(l);if(G!==O&&(R&&(Rs||(Rs=!0,A('Text content did not match. Server: "%s" Client: "%s"',G,O))),w&&Et))throw new Error("Text content does not match server-rendered HTML.")}function h1(l){return l.nodeType===sa?l:l.ownerDocument}function lS(){}function Dy(l){l.onclick=lS}function cS(l,h,w,R,O){for(var G in R)if(R.hasOwnProperty(G)){var K=R[G];if(G===Il)K&&Object.freeze(K),Cu(h,K);else if(G===Cy){var ae=K?K[Rx]:void 0;ae!=null&&zm(h,ae)}else if(G===Cf)if(typeof K=="string"){var pe=l!=="textarea"||K!=="";pe&&Su(h,K)}else typeof K=="number"&&Su(h,""+K);else G===Iy||G===Nh||G===Ix||(kr.hasOwnProperty(G)?K!=null&&(typeof K!="function"&&Kp(G,K),G==="onScroll"&&Qo("scroll",h)):K!=null&&Ta(h,G,K,O))}}function Dx(l,h,w,R){for(var O=0;O<h.length;O+=2){var G=h[O],K=h[O+1];G===Il?Cu(l,K):G===Cy?zm(l,K):G===Cf?Su(l,K):Ta(l,G,K,R)}}function Bh(l,h,w,R){var O,G=h1(w),K,ae=R;if(ae===Lo&&(ae=ld(l)),ae===Lo){if(O=ph(l,h),!O&&l!==l.toLowerCase()&&A("<%s /> is using incorrect casing. Use PascalCase for React components, or lowercase for HTML elements.",l),l==="script"){var pe=G.createElement("div");pe.innerHTML="<script><\/script>";var Oe=pe.firstChild;K=pe.removeChild(Oe)}else if(typeof h.is=="string")K=G.createElement(l,{is:h.is});else if(K=G.createElement(l),l==="select"){var Ve=K;h.multiple?Ve.multiple=!0:h.size&&(Ve.size=h.size)}}else K=G.createElementNS(ae,l);return ae===Lo&&!O&&Object.prototype.toString.call(K)==="[object HTMLUnknownElement]"&&!Rn.call(Vs,l)&&(Vs[l]=!0,A("The tag <%s> is unrecognized in this browser. If you meant to render a React component, start its name with an uppercase letter.",l)),K}function uS(l,h){return h1(h).createTextNode(l)}function sC(l,h,w,R){var O=ph(h,w);Ry(h,w);var G;switch(h){case"dialog":Qo("cancel",l),Qo("close",l),G=w;break;case"iframe":case"object":case"embed":Qo("load",l),G=w;break;case"video":case"audio":for(var K=0;K<Sy.length;K++)Qo(Sy[K],l);G=w;break;case"source":Qo("error",l),G=w;break;case"img":case"image":case"link":Qo("error",l),Qo("load",l),G=w;break;case"details":Qo("toggle",l),G=w;break;case"input":Lm(l,w),G=uh(l,w),Qo("invalid",l);break;case"option":po(l,w),G=w;break;case"select":kc(l,w),G=ws(l,w),Qo("invalid",l);break;case"textarea":dr(l,w),G=hh(l,w),Qo("invalid",l);break;default:G=w}switch(B_(h,G),cS(h,l,R,G,O),h){case"input":ac(l),Ut(l,w,!1);break;case"textarea":ac(l),dh(l);break;case"option":Qi(l,w);break;case"select":Ti(l,w);break;default:typeof G.onClick=="function"&&Dy(l);break}}function lC(l,h,w,R,O){Ry(h,R);var G=null,K,ae;switch(h){case"input":K=uh(l,w),ae=uh(l,R),G=[];break;case"select":K=ws(l,w),ae=ws(l,R),G=[];break;case"textarea":K=hh(l,w),ae=hh(l,R),G=[];break;default:K=w,ae=R,typeof K.onClick!="function"&&typeof ae.onClick=="function"&&Dy(l);break}B_(h,ae);var pe,Oe,Ve=null;for(pe in K)if(!(ae.hasOwnProperty(pe)||!K.hasOwnProperty(pe)||K[pe]==null))if(pe===Il){var gt=K[pe];for(Oe in gt)gt.hasOwnProperty(Oe)&&(Ve||(Ve={}),Ve[Oe]="")}else pe===Cy||pe===Cf||pe===Iy||pe===Nh||pe===Ix||(kr.hasOwnProperty(pe)?G||(G=[]):(G=G||[]).push(pe,null));for(pe in ae){var pt=ae[pe],Ht=K!=null?K[pe]:void 0;if(!(!ae.hasOwnProperty(pe)||pt===Ht||pt==null&&Ht==null))if(pe===Il)if(pt&&Object.freeze(pt),Ht){for(Oe in Ht)Ht.hasOwnProperty(Oe)&&(!pt||!pt.hasOwnProperty(Oe))&&(Ve||(Ve={}),Ve[Oe]="");for(Oe in pt)pt.hasOwnProperty(Oe)&&Ht[Oe]!==pt[Oe]&&(Ve||(Ve={}),Ve[Oe]=pt[Oe])}else Ve||(G||(G=[]),G.push(pe,Ve)),Ve=pt;else if(pe===Cy){var $t=pt?pt[Rx]:void 0,oi=Ht?Ht[Rx]:void 0;$t!=null&&oi!==$t&&(G=G||[]).push(pe,$t)}else pe===Cf?(typeof pt=="string"||typeof pt=="number")&&(G=G||[]).push(pe,""+pt):pe===Iy||pe===Nh||(kr.hasOwnProperty(pe)?(pt!=null&&(typeof pt!="function"&&Kp(pe,pt),pe==="onScroll"&&Qo("scroll",l)),!G&&Ht!==pt&&(G=[])):(G=G||[]).push(pe,pt))}return Ve&&(tx(Ve,ae[Il]),(G=G||[]).push(Il,Ve)),G}function cC(l,h,w,R,O){w==="input"&&O.type==="radio"&&O.name!=null&&ge(l,O);var G=ph(w,R),K=ph(w,O);switch(Dx(l,h,G,K),w){case"input":Je(l,O);break;case"textarea":Zd(l,O);break;case"select":Pn(l,O);break}}function uC(l){{var h=l.toLowerCase();return Vm.hasOwnProperty(h)&&Vm[h]||null}}function hC(l,h,w,R,O,G,K){var ae,pe;switch(ae=ph(h,w),Ry(h,w),h){case"dialog":Qo("cancel",l),Qo("close",l);break;case"iframe":case"object":case"embed":Qo("load",l);break;case"video":case"audio":for(var Oe=0;Oe<Sy.length;Oe++)Qo(Sy[Oe],l);break;case"source":Qo("error",l);break;case"img":case"image":case"link":Qo("error",l),Qo("load",l);break;case"details":Qo("toggle",l);break;case"input":Lm(l,w),Qo("invalid",l);break;case"option":po(l,w);break;case"select":kc(l,w),Qo("invalid",l);break;case"textarea":dr(l,w),Qo("invalid",l);break}B_(h,w);{pe=new Set;for(var Ve=l.attributes,gt=0;gt<Ve.length;gt++){var pt=Ve[gt].name.toLowerCase();switch(pt){case"value":break;case"checked":break;case"selected":break;default:pe.add(Ve[gt].name)}}}var Ht=null;for(var $t in w)if(w.hasOwnProperty($t)){var oi=w[$t];if($t===Cf)typeof oi=="string"?l.textContent!==oi&&(w[Nh]!==!0&&kg(l.textContent,oi,G,K),Ht=[Cf,oi]):typeof oi=="number"&&l.textContent!==""+oi&&(w[Nh]!==!0&&kg(l.textContent,oi,G,K),Ht=[Cf,""+oi]);else if(kr.hasOwnProperty($t))oi!=null&&(typeof oi!="function"&&Kp($t,oi),$t==="onScroll"&&Qo("scroll",l));else if(K&&typeof ae=="boolean"){var Ji=void 0,Vn=qr($t);if(w[Nh]!==!0){if(!($t===Iy||$t===Nh||$t==="value"||$t==="checked"||$t==="selected")){if($t===Cy){var An=l.innerHTML,lo=oi?oi[Rx]:void 0;if(lo!=null){var Kr=aS(l,lo);Kr!==An&&Pg($t,An,Kr)}}else if($t===Il){if(pe.delete($t),oS){var Ot=vp(oi);Ji=l.getAttribute("style"),Ot!==Ji&&Pg($t,Ji,Ot)}}else if(ae&&!er)pe.delete($t.toLowerCase()),Ji=Tt(l,$t,oi),oi!==Ji&&Pg($t,Ji,oi);else if(!yo($t,Vn,ae)&&!Wo($t,oi,Vn,ae)){var ai=!1;if(Vn!==null)pe.delete(Vn.attributeName),Ji=Ks(l,$t,oi,Vn);else{var kt=R;if(kt===Lo&&(kt=ld(h)),kt===Lo)pe.delete($t.toLowerCase());else{var Ci=uC($t);Ci!==null&&Ci!==$t&&(ai=!0,pe.delete(Ci)),pe.delete($t)}Ji=Tt(l,$t,oi)}var cn=er;!cn&&oi!==Ji&&!ai&&Pg($t,Ji,oi)}}}}}switch(K&&pe.size>0&&w[Nh]!==!0&&c1(pe),h){case"input":ac(l),Ut(l,w,!0);break;case"textarea":ac(l),dh(l);break;case"select":case"option":break;default:typeof w.onClick=="function"&&Dy(l);break}return Ht}function dC(l,h,w){var R=l.nodeValue!==h;return R}function d1(l,h){{if(Rs)return;Rs=!0,A("Did not expect server HTML to contain a <%s> in <%s>.",h.nodeName.toLowerCase(),l.nodeName.toLowerCase())}}function f1(l,h){{if(Rs)return;Rs=!0,A('Did not expect server HTML to contain the text node "%s" in <%s>.',h.nodeValue,l.nodeName.toLowerCase())}}function Jp(l,h,w){{if(Rs)return;Rs=!0,A("Expected server HTML to contain a matching <%s> in <%s>.",h,l.nodeName.toLowerCase())}}function Mx(l,h){{if(h===""||Rs)return;Rs=!0,A('Expected server HTML to contain a matching text node for "%s" in <%s>.',h,l.nodeName.toLowerCase())}}function hS(l,h,w){switch(h){case"input":Jt(l,w);return;case"textarea":fp(l,w);return;case"select":Xn(l,w);return}}var If=function(){},Fg=function(){};{var p1=["address","applet","area","article","aside","base","basefont","bgsound","blockquote","body","br","button","caption","center","col","colgroup","dd","details","dir","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","img","input","isindex","li","link","listing","main","marquee","menu","menuitem","meta","nav","noembed","noframes","noscript","object","ol","p","param","plaintext","pre","script","section","select","source","style","summary","table","tbody","td","template","textarea","tfoot","th","thead","title","tr","track","ul","wbr","xmp"],My=["applet","caption","html","table","td","th","marquee","object","template","foreignObject","desc","title"],dS=My.concat(["button"]),fC=["dd","dt","li","option","optgroup","p","rp","rt"],Px={current:null,formTag:null,aTagInScope:null,buttonTagInScope:null,nobrTagInScope:null,pTagInButtonScope:null,listItemTagAutoclosing:null,dlItemTagAutoclosing:null};Fg=function(l,h){var w=ei({},l||Px),R={tag:h};return My.indexOf(h)!==-1&&(w.aTagInScope=null,w.buttonTagInScope=null,w.nobrTagInScope=null),dS.indexOf(h)!==-1&&(w.pTagInButtonScope=null),p1.indexOf(h)!==-1&&h!=="address"&&h!=="div"&&h!=="p"&&(w.listItemTagAutoclosing=null,w.dlItemTagAutoclosing=null),w.current=R,h==="form"&&(w.formTag=R),h==="a"&&(w.aTagInScope=R),h==="button"&&(w.buttonTagInScope=R),h==="nobr"&&(w.nobrTagInScope=R),h==="p"&&(w.pTagInButtonScope=R),h==="li"&&(w.listItemTagAutoclosing=R),(h==="dd"||h==="dt")&&(w.dlItemTagAutoclosing=R),w};var fS=function(l,h){switch(h){case"select":return l==="option"||l==="optgroup"||l==="#text";case"optgroup":return l==="option"||l==="#text";case"option":return l==="#text";case"tr":return l==="th"||l==="td"||l==="style"||l==="script"||l==="template";case"tbody":case"thead":case"tfoot":return l==="tr"||l==="style"||l==="script"||l==="template";case"colgroup":return l==="col"||l==="template";case"table":return l==="caption"||l==="colgroup"||l==="tbody"||l==="tfoot"||l==="thead"||l==="style"||l==="script"||l==="template";case"head":return l==="base"||l==="basefont"||l==="bgsound"||l==="link"||l==="meta"||l==="title"||l==="noscript"||l==="noframes"||l==="style"||l==="script"||l==="template";case"html":return l==="head"||l==="body"||l==="frameset";case"frameset":return l==="frame";case"#document":return l==="html"}switch(l){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return h!=="h1"&&h!=="h2"&&h!=="h3"&&h!=="h4"&&h!=="h5"&&h!=="h6";case"rp":case"rt":return fC.indexOf(h)===-1;case"body":case"caption":case"col":case"colgroup":case"frameset":case"frame":case"head":case"html":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":return h==null}return!0},pS=function(l,h){switch(l){case"address":case"article":case"aside":case"blockquote":case"center":case"details":case"dialog":case"dir":case"div":case"dl":case"fieldset":case"figcaption":case"figure":case"footer":case"header":case"hgroup":case"main":case"menu":case"nav":case"ol":case"p":case"section":case"summary":case"ul":case"pre":case"listing":case"table":case"hr":case"xmp":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return h.pTagInButtonScope;case"form":return h.formTag||h.pTagInButtonScope;case"li":return h.listItemTagAutoclosing;case"dd":case"dt":return h.dlItemTagAutoclosing;case"button":return h.buttonTagInScope;case"a":return h.aTagInScope;case"nobr":return h.nobrTagInScope}return null},Ox={};If=function(l,h,w){w=w||Px;var R=w.current,O=R&&R.tag;h!=null&&(l!=null&&A("validateDOMNesting: when childText is passed, childTag should be null"),l="#text");var G=fS(l,O)?null:R,K=G?null:pS(l,w),ae=G||K;if(ae){var pe=ae.tag,Oe=!!G+"|"+l+"|"+pe;if(!Ox[Oe]){Ox[Oe]=!0;var Ve=l,gt="";if(l==="#text"?/\S/.test(h)?Ve="Text nodes":(Ve="Whitespace text nodes",gt=" Make sure you don't have any extra whitespace between tags on each line of your source code."):Ve="<"+l+">",G){var pt="";pe==="table"&&l==="tr"&&(pt+=" Add a <tbody>, <thead> or <tfoot> to your code to match the DOM tree generated by the browser."),A("validateDOMNesting(...): %s cannot appear as a child of <%s>.%s%s",Ve,pe,gt,pt)}else A("validateDOMNesting(...): %s cannot appear as a descendant of <%s>.",Ve,pe)}}}}var Lg="suppressHydrationWarning",Py="$",zg="/$",Oy="$?",ky="$!",pC="style",m1=null,kx=null;function Rf(l){var h,w,R=l.nodeType;switch(R){case sa:case Xd:{h=R===sa?"#document":"#fragment";var O=l.documentElement;w=O?O.namespaceURI:pp(null,"");break}default:{var G=R===zo?l.parentNode:l,K=G.namespaceURI||null;h=G.tagName,w=pp(K,h);break}}{var ae=h.toLowerCase(),pe=Fg(null,ae);return{namespace:w,ancestorInfo:pe}}}function mS(l,h,w){{var R=l,O=pp(R.namespace,h),G=Fg(R.ancestorInfo,h);return{namespace:O,ancestorInfo:G}}}function mC(l){return l}function Fy(l){m1=_y(),kx=tC();var h=null;return Tx(!1),h}function Ly(l){iC(kx),Tx(m1),m1=null,kx=null}function Fx(l,h,w,R,O){var G;{var K=R;if(If(l,null,K.ancestorInfo),typeof h.children=="string"||typeof h.children=="number"){var ae=""+h.children,pe=Fg(K.ancestorInfo,l);If(null,ae,pe)}G=K.namespace}var Oe=Bh(l,h,w,G);return $g(O,Oe),A1(Oe,h),Oe}function zy(l,h){l.appendChild(h)}function gS(l,h,w,R,O){switch(sC(l,h,w,R),h){case"button":case"input":case"select":case"textarea":return!!w.autoFocus;case"img":return!0;default:return!1}}function _S(l,h,w,R,O,G){{var K=G;if(typeof R.children!=typeof w.children&&(typeof R.children=="string"||typeof R.children=="number")){var ae=""+R.children,pe=Fg(K.ancestorInfo,h);If(null,ae,pe)}}return lC(l,h,w,R)}function Lx(l,h){return l==="textarea"||l==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}function yS(l,h,w,R){{var O=w;If(null,l,O.ancestorInfo)}var G=uS(l,h);return $g(R,G),G}function gC(){var l=window.event;return l===void 0?mc:T(l.type)}var g1=typeof setTimeout=="function"?setTimeout:void 0,_1=typeof clearTimeout=="function"?clearTimeout:void 0,Ng=-1,y1=typeof Promise=="function"?Promise:void 0,_C=typeof queueMicrotask=="function"?queueMicrotask:typeof y1<"u"?function(l){return y1.resolve(null).then(l).catch(vS)}:g1;function vS(l){setTimeout(function(){throw l})}function v1(l,h,w,R){switch(h){case"button":case"input":case"select":case"textarea":w.autoFocus&&l.focus();return;case"img":{w.src&&(l.src=w.src);return}}}function xS(l,h,w,R,O,G){cC(l,h,w,R,O),A1(l,O)}function x1(l){Su(l,"")}function bS(l,h,w){l.nodeValue=w}function wS(l,h){l.appendChild(h)}function TS(l,h){var w;l.nodeType===zo?(w=l.parentNode,w.insertBefore(h,l)):(w=l,w.appendChild(h));var R=l._reactRootContainer;R==null&&w.onclick===null&&Dy(w)}function yC(l,h,w){l.insertBefore(h,w)}function SS(l,h,w){l.nodeType===zo?l.parentNode.insertBefore(h,w):l.insertBefore(h,w)}function ES(l,h){l.removeChild(h)}function Qp(l,h){l.nodeType===zo?l.parentNode.removeChild(h):l.removeChild(h)}function zx(l,h){var w=h,R=0;do{var O=w.nextSibling;if(l.removeChild(w),O&&O.nodeType===zo){var G=O.data;if(G===zg)if(R===0){l.removeChild(O),qp(h);return}else R--;else(G===Py||G===Oy||G===ky)&&R++}w=O}while(w);qp(h)}function AS(l,h){l.nodeType===zo?zx(l.parentNode,h):l.nodeType===Ja&&zx(l,h),qp(l)}function CS(l){l=l;var h=l.style;typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none"}function Nx(l){l.nodeValue=""}function vC(l,h){l=l;var w=h[pC],R=w!=null&&w.hasOwnProperty("display")?w.display:null;l.style.display=sn("display",R)}function IS(l,h){l.nodeValue=h}function Ny(l){l.nodeType===Ja?l.textContent="":l.nodeType===sa&&l.documentElement&&l.removeChild(l.documentElement)}function RS(l,h,w){return l.nodeType!==Ja||h.toLowerCase()!==l.nodeName.toLowerCase()?null:l}function DS(l,h){return h===""||l.nodeType!==Do?null:l}function MS(l){return l.nodeType!==zo?null:l}function b1(l){return l.data===Oy}function w1(l){return l.data===ky}function xC(l){var h=l.nextSibling&&l.nextSibling.dataset,w,R,O;return h&&(w=h.dgst,R=h.msg,O=h.stck),{message:R,digest:w,stack:O}}function PS(l,h){l._reactRetry=h}function Df(l){for(;l!=null;l=l.nextSibling){var h=l.nodeType;if(h===Ja||h===Do)break;if(h===zo){var w=l.data;if(w===Py||w===ky||w===Oy)break;if(w===zg)return null}}return l}function em(l){return Df(l.nextSibling)}function tm(l){return Df(l.firstChild)}function Bg(l){return Df(l.firstChild)}function By(l){return Df(l.nextSibling)}function T1(l,h,w,R,O,G,K){$g(G,l),A1(l,w);var ae;{var pe=O;ae=pe.namespace}var Oe=(G.mode&Nn)!==Cn;return hC(l,h,w,ae,R,Oe,K)}function Bx(l,h,w,R){return $g(w,l),w.mode&Nn,dC(l,h)}function bC(l,h){$g(h,l)}function Vy(l){for(var h=l.nextSibling,w=0;h;){if(h.nodeType===zo){var R=h.data;if(R===zg){if(w===0)return em(h);w--}else(R===Py||R===ky||R===Oy)&&w++}h=h.nextSibling}return null}function Vx(l){for(var h=l.previousSibling,w=0;h;){if(h.nodeType===zo){var R=h.data;if(R===Py||R===ky||R===Oy){if(w===0)return h;w--}else R===zg&&w++}h=h.previousSibling}return null}function Wu(l){qp(l)}function Vg(l){qp(l)}function S1(l){return l!=="head"&&l!=="body"}function Ug(l,h,w,R){var O=!0;kg(h.nodeValue,w,R,O)}function jg(l,h,w,R,O,G){if(h[Lg]!==!0){var K=!0;kg(R.nodeValue,O,G,K)}}function OS(l,h){h.nodeType===Ja?d1(l,h):h.nodeType===zo||f1(l,h)}function Ux(l,h){{var w=l.parentNode;w!==null&&(h.nodeType===Ja?d1(w,h):h.nodeType===zo||f1(w,h))}}function kS(l,h,w,R,O){(O||h[Lg]!==!0)&&(R.nodeType===Ja?d1(w,R):R.nodeType===zo||f1(w,R))}function FS(l,h,w){Jp(l,h)}function wC(l,h){Mx(l,h)}function jx(l,h,w){{var R=l.parentNode;R!==null&&Jp(R,h)}}function TC(l,h){{var w=l.parentNode;w!==null&&Mx(w,h)}}function Uy(l,h,w,R,O,G){(G||h[Lg]!==!0)&&Jp(w,R)}function LS(l,h,w,R,O){(O||h[Lg]!==!0)&&Mx(w,R)}function E1(l){A("An error occurred during hydration. The server HTML was replaced with client content in <%s>.",l.nodeName.toLowerCase())}function SC(l){Md(l)}var Pd=Math.random().toString(36).slice(2),Gg="__reactFiber$"+Pd,Gx="__reactProps$"+Pd,Hg="__reactContainer$"+Pd,Hx="__reactEvents$"+Pd,EC="__reactListeners$"+Pd,zS="__reactHandles$"+Pd;function AC(l){delete l[Gg],delete l[Gx],delete l[Hx],delete l[EC],delete l[zS]}function $g(l,h){h[Gg]=l}function jy(l,h){h[Hg]=l}function $x(l){l[Hg]=null}function im(l){return!!l[Hg]}function Od(l){var h=l[Gg];if(h)return h;for(var w=l.parentNode;w;){if(h=w[Hg]||w[Gg],h){var R=h.alternate;if(h.child!==null||R!==null&&R.child!==null)for(var O=Vx(l);O!==null;){var G=O[Gg];if(G)return G;O=Vx(O)}return h}l=w,w=l.parentNode}return null}function Jc(l){var h=l[Gg]||l[Hg];return h&&(h.tag===he||h.tag===de||h.tag===Ye||h.tag===X)?h:null}function Wg(l){if(l.tag===he||l.tag===de)return l.stateNode;throw new Error("getNodeFromInstance: Invalid argument.")}function Wx(l){return l[Gx]||null}function A1(l,h){l[Gx]=h}function CC(l){var h=l[Hx];return h===void 0&&(h=l[Hx]=new Set),h}var NS={},BS=u.ReactDebugCurrentFrame;function qx(l){if(l){var h=l._owner,w=Ka(l.type,l._source,h?h.type:null);BS.setExtraStackFrame(w)}else BS.setExtraStackFrame(null)}function Qc(l,h,w,R,O){{var G=Function.call.bind(Rn);for(var K in l)if(G(l,K)){var ae=void 0;try{if(typeof l[K]!="function"){var pe=Error((R||"React class")+": "+w+" type `"+K+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof l[K]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw pe.name="Invariant Violation",pe}ae=l[K](h,K,R,w,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(Oe){ae=Oe}ae&&!(ae instanceof Error)&&(qx(O),A("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",R||"React class",w,K,typeof ae),qx(null)),ae instanceof Error&&!(ae.message in NS)&&(NS[ae.message]=!0,qx(O),A("Failed %s type: %s",w,ae.message),qx(null))}}}var Zx=[],nm;nm=[];var ol=-1;function Vh(l){return{current:l}}function Us(l,h){if(ol<0){A("Unexpected pop.");return}h!==nm[ol]&&A("Unexpected Fiber popped."),l.current=Zx[ol],Zx[ol]=null,nm[ol]=null,ol--}function js(l,h,w){ol++,Zx[ol]=l.current,nm[ol]=w,l.current=h}var qg;qg={};var al={};Object.freeze(al);var qu=Vh(al),sl=Vh(!1),Mf=al;function kd(l,h,w){return w&&eu(h)?Mf:qu.current}function C1(l,h,w){{var R=l.stateNode;R.__reactInternalMemoizedUnmaskedChildContext=h,R.__reactInternalMemoizedMaskedChildContext=w}}function Uh(l,h){{var w=l.type,R=w.contextTypes;if(!R)return al;var O=l.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===h)return O.__reactInternalMemoizedMaskedChildContext;var G={};for(var K in R)G[K]=h[K];{var ae=yn(l)||"Unknown";Qc(R,G,"context",ae)}return O&&C1(l,h,G),G}}function Xx(){return sl.current}function eu(l){{var h=l.childContextTypes;return h!=null}}function rm(l){Us(sl,l),Us(qu,l)}function Gy(l){Us(sl,l),Us(qu,l)}function Pf(l,h,w){{if(qu.current!==al)throw new Error("Unexpected context found on stack. This error is likely caused by a bug in React. Please file an issue.");js(qu,h,l),js(sl,w,l)}}function Yx(l,h,w){{var R=l.stateNode,O=h.childContextTypes;if(typeof R.getChildContext!="function"){{var G=yn(l)||"Unknown";qg[G]||(qg[G]=!0,A("%s.childContextTypes is specified but there is no getChildContext() method on the instance. You can either define getChildContext() on %s or remove childContextTypes from it.",G,G))}return w}var K=R.getChildContext();for(var ae in K)if(!(ae in O))throw new Error((yn(l)||"Unknown")+'.getChildContext(): key "'+ae+'" is not defined in childContextTypes.');{var pe=yn(l)||"Unknown";Qc(O,K,"child context",pe)}return ei({},w,K)}}function Kx(l){{var h=l.stateNode,w=h&&h.__reactInternalMemoizedMergedChildContext||al;return Mf=qu.current,js(qu,w,l),js(sl,sl.current,l),!0}}function I1(l,h,w){{var R=l.stateNode;if(!R)throw new Error("Expected to have an instance by this point. This error is likely caused by a bug in React. Please file an issue.");if(w){var O=Yx(l,h,Mf);R.__reactInternalMemoizedMergedChildContext=O,Us(sl,l),Us(qu,l),js(qu,O,l),js(sl,w,l)}else Us(sl,l),js(sl,w,l)}}function IC(l){{if(!jb(l)||l.tag!==N)throw new Error("Expected subtree parent to be a mounted class component. This error is likely caused by a bug in React. Please file an issue.");var h=l;do{switch(h.tag){case X:return h.stateNode.context;case N:{var w=h.type;if(eu(w))return h.stateNode.__reactInternalMemoizedMergedChildContext;break}}h=h.return}while(h!==null);throw new Error("Found unexpected detached subtree parent. This error is likely caused by a bug in React. Please file an issue.")}}var Of=0,Jx=1,Zu=null,R1=!1,Qx=!1;function VS(l){Zu===null?Zu=[l]:Zu.push(l)}function US(l){R1=!0,VS(l)}function jS(){R1&&kf()}function kf(){if(!Qx&&Zu!==null){Qx=!0;var l=0,h=$l();try{var w=!0,R=Zu;for(Aa(Es);l<R.length;l++){var O=R[l];do O=O(w);while(O!==null)}Zu=null,R1=!1}catch(G){throw Zu!==null&&(Zu=Zu.slice(l+1)),X_(Gc,kf),G}finally{Aa(h),Qx=!1}}return null}var om=[],Zg=0,e0=null,t0=0,tu=[],iu=0,Ff=null,nu=1,Fd="";function GS(l){return sm(),(l.flags&rf)!==On}function D1(l){return sm(),t0}function HS(){var l=Fd,h=nu,w=h&~RC(h);return w.toString(32)+l}function am(l,h){sm(),om[Zg++]=t0,om[Zg++]=e0,e0=l,t0=h}function M1(l,h,w){sm(),tu[iu++]=nu,tu[iu++]=Fd,tu[iu++]=Ff,Ff=l;var R=nu,O=Fd,G=n0(R)-1,K=R&~(1<<G),ae=w+1,pe=n0(h)+G;if(pe>30){var Oe=G-G%5,Ve=(1<<Oe)-1,gt=(K&Ve).toString(32),pt=K>>Oe,Ht=G-Oe,$t=n0(h)+Ht,oi=ae<<Ht,Ji=oi|pt,Vn=gt+O;nu=1<<$t|Ji,Fd=Vn}else{var An=ae<<G,lo=An|K,Kr=O;nu=1<<pe|lo,Fd=Kr}}function i0(l){sm();var h=l.return;if(h!==null){var w=1,R=0;am(l,w),M1(l,w,R)}}function n0(l){return 32-pg(l)}function RC(l){return 1<<n0(l)-1}function P1(l){for(;l===e0;)e0=om[--Zg],om[Zg]=null,t0=om[--Zg],om[Zg]=null;for(;l===Ff;)Ff=tu[--iu],tu[iu]=null,Fd=tu[--iu],tu[iu]=null,nu=tu[--iu],tu[iu]=null}function DC(){return sm(),Ff!==null?{id:nu,overflow:Fd}:null}function MC(l,h){sm(),tu[iu++]=nu,tu[iu++]=Fd,tu[iu++]=Ff,nu=h.id,Fd=h.overflow,Ff=l}function sm(){Ds()||A("Expected to be hydrating. This is a bug in React. Please file an issue.")}var Gs=null,gc=null,Xu=!1,lm=!1,Lf=null;function O1(){Xu&&A("We should not be hydrating here. This is a bug in React. Please file a bug.")}function r0(){lm=!0}function $S(){return lm}function WS(l){var h=l.stateNode.containerInfo;return gc=Bg(h),Gs=l,Xu=!0,Lf=null,lm=!1,!0}function qS(l,h,w){return gc=By(h),Gs=l,Xu=!0,Lf=null,lm=!1,w!==null&&MC(l,w),!0}function k1(l,h){switch(l.tag){case X:{OS(l.stateNode.containerInfo,h);break}case he:{var w=(l.mode&Nn)!==Cn;kS(l.type,l.memoizedProps,l.stateNode,h,w);break}case Ye:{var R=l.memoizedState;R.dehydrated!==null&&Ux(R.dehydrated,h);break}}}function F1(l,h){k1(l,h);var w=SF();w.stateNode=h,w.return=l;var R=l.deletions;R===null?(l.deletions=[w],l.flags|=_h):R.push(w)}function o0(l,h){{if(lm)return;switch(l.tag){case X:{var w=l.stateNode.containerInfo;switch(h.tag){case he:var R=h.type;h.pendingProps,FS(w,R);break;case de:var O=h.pendingProps;wC(w,O);break}break}case he:{var G=l.type,K=l.memoizedProps,ae=l.stateNode;switch(h.tag){case he:{var pe=h.type,Oe=h.pendingProps,Ve=(l.mode&Nn)!==Cn;Uy(G,K,ae,pe,Oe,Ve);break}case de:{var gt=h.pendingProps,pt=(l.mode&Nn)!==Cn;LS(G,K,ae,gt,pt);break}}break}case Ye:{var Ht=l.memoizedState,$t=Ht.dehydrated;if($t!==null)switch(h.tag){case he:var oi=h.type;h.pendingProps,jx($t,oi);break;case de:var Ji=h.pendingProps;TC($t,Ji);break}break}default:return}}}function L1(l,h){h.flags=h.flags&~Uc|la,o0(l,h)}function z1(l,h){switch(l.tag){case he:{var w=l.type;l.pendingProps;var R=RS(h,w);return R!==null?(l.stateNode=R,Gs=l,gc=tm(R),!0):!1}case de:{var O=l.pendingProps,G=DS(h,O);return G!==null?(l.stateNode=G,Gs=l,gc=null,!0):!1}case Ye:{var K=MS(h);if(K!==null){var ae={dehydrated:K,treeContext:DC(),retryLane:wl};l.memoizedState=ae;var pe=EF(K);return pe.return=l,l.child=pe,Gs=l,gc=null,!0}return!1}default:return!1}}function Hy(l){return(l.mode&Nn)!==Cn&&(l.flags&Xr)===On}function a0(l){throw new Error("Hydration failed because the initial UI does not match what was rendered on the server.")}function N1(l){if(Xu){var h=gc;if(!h){Hy(l)&&(o0(Gs,l),a0()),L1(Gs,l),Xu=!1,Gs=l;return}var w=h;if(!z1(l,h)){Hy(l)&&(o0(Gs,l),a0()),h=em(w);var R=Gs;if(!h||!z1(l,h)){L1(Gs,l),Xu=!1,Gs=l;return}F1(R,w)}}}function $y(l,h,w){var R=l.stateNode,O=!lm,G=T1(R,l.type,l.memoizedProps,h,w,l,O);return l.updateQueue=G,G!==null}function ZS(l){var h=l.stateNode,w=l.memoizedProps,R=Bx(h,w,l);if(R){var O=Gs;if(O!==null)switch(O.tag){case X:{var G=O.stateNode.containerInfo,K=(O.mode&Nn)!==Cn;Ug(G,h,w,K);break}case he:{var ae=O.type,pe=O.memoizedProps,Oe=O.stateNode,Ve=(O.mode&Nn)!==Cn;jg(ae,pe,Oe,h,w,Ve);break}}}return R}function PC(l){var h=l.memoizedState,w=h!==null?h.dehydrated:null;if(!w)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");bC(w,l)}function OC(l){var h=l.memoizedState,w=h!==null?h.dehydrated:null;if(!w)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");return Vy(w)}function XS(l){for(var h=l.return;h!==null&&h.tag!==he&&h.tag!==X&&h.tag!==Ye;)h=h.return;Gs=h}function s0(l){if(l!==Gs)return!1;if(!Xu)return XS(l),Xu=!0,!1;if(l.tag!==X&&(l.tag!==he||S1(l.type)&&!Lx(l.type,l.memoizedProps))){var h=gc;if(h)if(Hy(l))YS(l),a0();else for(;h;)F1(l,h),h=em(h)}return XS(l),l.tag===Ye?gc=OC(l):gc=Gs?em(l.stateNode):null,!0}function kC(){return Xu&&gc!==null}function YS(l){for(var h=gc;h;)k1(l,h),h=em(h)}function Xg(){Gs=null,gc=null,Xu=!1,lm=!1}function KS(){Lf!==null&&(TD(Lf),Lf=null)}function Ds(){return Xu}function B1(l){Lf===null?Lf=[l]:Lf.push(l)}var La=u.ReactCurrentBatchConfig,FC=null;function Wy(){return La.transition}var Yu={recordUnsafeLifecycleWarnings:function(l,h){},flushPendingUnsafeLifecycleWarnings:function(){},recordLegacyContextWarning:function(l,h){},flushLegacyContextWarning:function(){},discardPendingWarnings:function(){}};{var LC=function(l){for(var h=null,w=l;w!==null;)w.mode&ca&&(h=w),w=w.return;return h},Ld=function(l){var h=[];return l.forEach(function(w){h.push(w)}),h.sort().join(", ")},Yg=[],Kg=[],zf=[],jh=[],Jg=[],qy=[],cm=new Set;Yu.recordUnsafeLifecycleWarnings=function(l,h){cm.has(l.type)||(typeof h.componentWillMount=="function"&&h.componentWillMount.__suppressDeprecationWarning!==!0&&Yg.push(l),l.mode&ca&&typeof h.UNSAFE_componentWillMount=="function"&&Kg.push(l),typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps.__suppressDeprecationWarning!==!0&&zf.push(l),l.mode&ca&&typeof h.UNSAFE_componentWillReceiveProps=="function"&&jh.push(l),typeof h.componentWillUpdate=="function"&&h.componentWillUpdate.__suppressDeprecationWarning!==!0&&Jg.push(l),l.mode&ca&&typeof h.UNSAFE_componentWillUpdate=="function"&&qy.push(l))},Yu.flushPendingUnsafeLifecycleWarnings=function(){var l=new Set;Yg.length>0&&(Yg.forEach(function(pt){l.add(yn(pt)||"Component"),cm.add(pt.type)}),Yg=[]);var h=new Set;Kg.length>0&&(Kg.forEach(function(pt){h.add(yn(pt)||"Component"),cm.add(pt.type)}),Kg=[]);var w=new Set;zf.length>0&&(zf.forEach(function(pt){w.add(yn(pt)||"Component"),cm.add(pt.type)}),zf=[]);var R=new Set;jh.length>0&&(jh.forEach(function(pt){R.add(yn(pt)||"Component"),cm.add(pt.type)}),jh=[]);var O=new Set;Jg.length>0&&(Jg.forEach(function(pt){O.add(yn(pt)||"Component"),cm.add(pt.type)}),Jg=[]);var G=new Set;if(qy.length>0&&(qy.forEach(function(pt){G.add(yn(pt)||"Component"),cm.add(pt.type)}),qy=[]),h.size>0){var K=Ld(h);A(`Using UNSAFE_componentWillMount in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move code with side effects to componentDidMount, and set initial state in the constructor.

Please update the following components: %s`,K)}if(R.size>0){var ae=Ld(R);A(`Using UNSAFE_componentWillReceiveProps in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state

Please update the following components: %s`,ae)}if(G.size>0){var pe=Ld(G);A(`Using UNSAFE_componentWillUpdate in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.

Please update the following components: %s`,pe)}if(l.size>0){var Oe=Ld(l);E(`componentWillMount has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move code with side effects to componentDidMount, and set initial state in the constructor.
* Rename componentWillMount to UNSAFE_componentWillMount to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,Oe)}if(w.size>0){var Ve=Ld(w);E(`componentWillReceiveProps has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state
* Rename componentWillReceiveProps to UNSAFE_componentWillReceiveProps to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,Ve)}if(O.size>0){var gt=Ld(O);E(`componentWillUpdate has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* Rename componentWillUpdate to UNSAFE_componentWillUpdate to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,gt)}};var l0=new Map,JS=new Set;Yu.recordLegacyContextWarning=function(l,h){var w=LC(l);if(w===null){A("Expected to find a StrictMode component in a strict mode tree. This error is likely caused by a bug in React. Please file an issue.");return}if(!JS.has(l.type)){var R=l0.get(w);(l.type.contextTypes!=null||l.type.childContextTypes!=null||h!==null&&typeof h.getChildContext=="function")&&(R===void 0&&(R=[],l0.set(w,R)),R.push(l))}},Yu.flushLegacyContextWarning=function(){l0.forEach(function(l,h){if(l.length!==0){var w=l[0],R=new Set;l.forEach(function(G){R.add(yn(G)||"Component"),JS.add(G.type)});var O=Ld(R);try{vo(w),A(`Legacy context API has been detected within a strict-mode tree.

The old API will be supported in all 16.x releases, but applications using it should migrate to the new version.

Please update the following components: %s

Learn more about this warning here: https://reactjs.org/link/legacy-context`,O)}finally{Go()}}})},Yu.discardPendingWarnings=function(){Yg=[],Kg=[],zf=[],jh=[],Jg=[],qy=[],l0=new Map}}var V1,U1,j1,G1,H1,c0=function(l,h){};V1=!1,U1=!1,j1={},G1={},H1={},c0=function(l,h){if(!(l===null||typeof l!="object")&&!(!l._store||l._store.validated||l.key!=null)){if(typeof l._store!="object")throw new Error("React Component in warnForMissingKey should have a _store. This error is likely caused by a bug in React. Please file an issue.");l._store.validated=!0;var w=yn(h)||"Component";G1[w]||(G1[w]=!0,A('Each child in a list should have a unique "key" prop. See https://reactjs.org/link/warning-keys for more information.'))}};function zC(l){return l.prototype&&l.prototype.isReactComponent}function Zy(l,h,w){var R=w.ref;if(R!==null&&typeof R!="function"&&typeof R!="object"){if((l.mode&ca||Mn)&&!(w._owner&&w._self&&w._owner.stateNode!==w._self)&&!(w._owner&&w._owner.tag!==N)&&!(typeof w.type=="function"&&!zC(w.type))&&w._owner){var O=yn(l)||"Component";j1[O]||(A('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. We recommend using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',O,R),j1[O]=!0)}if(w._owner){var G=w._owner,K;if(G){var ae=G;if(ae.tag!==N)throw new Error("Function components cannot have string refs. We recommend using useRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref");K=ae.stateNode}if(!K)throw new Error("Missing owner for string ref "+R+". This error is likely caused by a bug in React. Please file an issue.");var pe=K;Fr(R,"ref");var Oe=""+R;if(h!==null&&h.ref!==null&&typeof h.ref=="function"&&h.ref._stringRef===Oe)return h.ref;var Ve=function(gt){var pt=pe.refs;gt===null?delete pt[Oe]:pt[Oe]=gt};return Ve._stringRef=Oe,Ve}else{if(typeof R!="string")throw new Error("Expected ref to be a function, a string, an object returned by React.createRef(), or null.");if(!w._owner)throw new Error("Element ref was specified as a string ("+R+`) but no owner was set. This could happen for one of the following reasons:
1. You may be adding a ref to a function component
2. You may be adding a ref to a component that was not created inside a component's render method
3. You have multiple copies of React loaded
See https://reactjs.org/link/refs-must-have-owner for more information.`)}}return R}function u0(l,h){var w=Object.prototype.toString.call(h);throw new Error("Objects are not valid as a React child (found: "+(w==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":w)+"). If you meant to render a collection of children, use an array instead.")}function Xy(l){{var h=yn(l)||"Component";if(H1[h])return;H1[h]=!0,A("Functions are not valid as a React child. This may happen if you return a Component instead of <Component /> from render. Or maybe you meant to call this function rather than return it.")}}function ll(l){var h=l._payload,w=l._init;return w(h)}function Qg(l){function h(Ot,ai){if(l){var kt=Ot.deletions;kt===null?(Ot.deletions=[ai],Ot.flags|=_h):kt.push(ai)}}function w(Ot,ai){if(!l)return null;for(var kt=ai;kt!==null;)h(Ot,kt),kt=kt.sibling;return null}function R(Ot,ai){for(var kt=new Map,Ci=ai;Ci!==null;)Ci.key!==null?kt.set(Ci.key,Ci):kt.set(Ci.index,Ci),Ci=Ci.sibling;return kt}function O(Ot,ai){var kt=Ov(Ot,ai);return kt.index=0,kt.sibling=null,kt}function G(Ot,ai,kt){if(Ot.index=kt,!l)return Ot.flags|=rf,ai;var Ci=Ot.alternate;if(Ci!==null){var cn=Ci.index;return cn<ai?(Ot.flags|=la,ai):cn}else return Ot.flags|=la,ai}function K(Ot){return l&&Ot.alternate===null&&(Ot.flags|=la),Ot}function ae(Ot,ai,kt,Ci){if(ai===null||ai.tag!==de){var cn=MI(kt,Ot.mode,Ci);return cn.return=Ot,cn}else{var nn=O(ai,kt);return nn.return=Ot,nn}}function pe(Ot,ai,kt,Ci){var cn=kt.type;if(cn===hn)return Ve(Ot,ai,kt.props.children,Ci,kt.key);if(ai!==null&&(ai.elementType===cn||BD(ai,kt)||typeof cn=="object"&&cn!==null&&cn.$$typeof===ye&&ll(cn)===ai.type)){var nn=O(ai,kt.props);return nn.ref=Zy(Ot,ai,kt),nn.return=Ot,nn._debugSource=kt._source,nn._debugOwner=kt._owner,nn}var ur=DI(kt,Ot.mode,Ci);return ur.ref=Zy(Ot,ai,kt),ur.return=Ot,ur}function Oe(Ot,ai,kt,Ci){if(ai===null||ai.tag!==re||ai.stateNode.containerInfo!==kt.containerInfo||ai.stateNode.implementation!==kt.implementation){var cn=PI(kt,Ot.mode,Ci);return cn.return=Ot,cn}else{var nn=O(ai,kt.children||[]);return nn.return=Ot,nn}}function Ve(Ot,ai,kt,Ci,cn){if(ai===null||ai.tag!==ve){var nn=A_(kt,Ot.mode,Ci,cn);return nn.return=Ot,nn}else{var ur=O(ai,kt);return ur.return=Ot,ur}}function gt(Ot,ai,kt){if(typeof ai=="string"&&ai!==""||typeof ai=="number"){var Ci=MI(""+ai,Ot.mode,kt);return Ci.return=Ot,Ci}if(typeof ai=="object"&&ai!==null){switch(ai.$$typeof){case Ga:{var cn=DI(ai,Ot.mode,kt);return cn.ref=Zy(Ot,null,ai),cn.return=Ot,cn}case Ma:{var nn=PI(ai,Ot.mode,kt);return nn.return=Ot,nn}case ye:{var ur=ai._payload,br=ai._init;return gt(Ot,br(ur),kt)}}if(Er(ai)||xi(ai)){var Zo=A_(ai,Ot.mode,kt,null);return Zo.return=Ot,Zo}u0(Ot,ai)}return typeof ai=="function"&&Xy(Ot),null}function pt(Ot,ai,kt,Ci){var cn=ai!==null?ai.key:null;if(typeof kt=="string"&&kt!==""||typeof kt=="number")return cn!==null?null:ae(Ot,ai,""+kt,Ci);if(typeof kt=="object"&&kt!==null){switch(kt.$$typeof){case Ga:return kt.key===cn?pe(Ot,ai,kt,Ci):null;case Ma:return kt.key===cn?Oe(Ot,ai,kt,Ci):null;case ye:{var nn=kt._payload,ur=kt._init;return pt(Ot,ai,ur(nn),Ci)}}if(Er(kt)||xi(kt))return cn!==null?null:Ve(Ot,ai,kt,Ci,null);u0(Ot,kt)}return typeof kt=="function"&&Xy(Ot),null}function Ht(Ot,ai,kt,Ci,cn){if(typeof Ci=="string"&&Ci!==""||typeof Ci=="number"){var nn=Ot.get(kt)||null;return ae(ai,nn,""+Ci,cn)}if(typeof Ci=="object"&&Ci!==null){switch(Ci.$$typeof){case Ga:{var ur=Ot.get(Ci.key===null?kt:Ci.key)||null;return pe(ai,ur,Ci,cn)}case Ma:{var br=Ot.get(Ci.key===null?kt:Ci.key)||null;return Oe(ai,br,Ci,cn)}case ye:var Zo=Ci._payload,Ao=Ci._init;return Ht(Ot,ai,kt,Ao(Zo),cn)}if(Er(Ci)||xi(Ci)){var _s=Ot.get(kt)||null;return Ve(ai,_s,Ci,cn,null)}u0(ai,Ci)}return typeof Ci=="function"&&Xy(ai),null}function $t(Ot,ai,kt){{if(typeof Ot!="object"||Ot===null)return ai;switch(Ot.$$typeof){case Ga:case Ma:c0(Ot,kt);var Ci=Ot.key;if(typeof Ci!="string")break;if(ai===null){ai=new Set,ai.add(Ci);break}if(!ai.has(Ci)){ai.add(Ci);break}A("Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted  the behavior is unsupported and could change in a future version.",Ci);break;case ye:var cn=Ot._payload,nn=Ot._init;$t(nn(cn),ai,kt);break}}return ai}function oi(Ot,ai,kt,Ci){for(var cn=null,nn=0;nn<kt.length;nn++){var ur=kt[nn];cn=$t(ur,cn,Ot)}for(var br=null,Zo=null,Ao=ai,_s=0,Co=0,ns=null;Ao!==null&&Co<kt.length;Co++){Ao.index>Co?(ns=Ao,Ao=null):ns=Ao.sibling;var Kl=pt(Ot,Ao,kt[Co],Ci);if(Kl===null){Ao===null&&(Ao=ns);break}l&&Ao&&Kl.alternate===null&&h(Ot,Ao),_s=G(Kl,_s,Co),Zo===null?br=Kl:Zo.sibling=Kl,Zo=Kl,Ao=ns}if(Co===kt.length){if(w(Ot,Ao),Ds()){var Pl=Co;am(Ot,Pl)}return br}if(Ao===null){for(;Co<kt.length;Co++){var ah=gt(Ot,kt[Co],Ci);ah!==null&&(_s=G(ah,_s,Co),Zo===null?br=ah:Zo.sibling=ah,Zo=ah)}if(Ds()){var Ec=Co;am(Ot,Ec)}return br}for(var Ac=R(Ot,Ao);Co<kt.length;Co++){var Jl=Ht(Ac,Ot,Co,kt[Co],Ci);Jl!==null&&(l&&Jl.alternate!==null&&Ac.delete(Jl.key===null?Co:Jl.key),_s=G(Jl,_s,Co),Zo===null?br=Jl:Zo.sibling=Jl,Zo=Jl)}if(l&&Ac.forEach(function(pb){return h(Ot,pb)}),Ds()){var Rm=Co;am(Ot,Rm)}return br}function Ji(Ot,ai,kt,Ci){var cn=xi(kt);if(typeof cn!="function")throw new Error("An object is not an iterable. This error is likely caused by a bug in React. Please file an issue.");{typeof Symbol=="function"&&kt[Symbol.toStringTag]==="Generator"&&(U1||A("Using Generators as children is unsupported and will likely yield unexpected results because enumerating a generator mutates it. You may convert it to an array with `Array.from()` or the `[...spread]` operator before rendering. Keep in mind you might need to polyfill these features for older browsers."),U1=!0),kt.entries===cn&&(V1||A("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),V1=!0);var nn=cn.call(kt);if(nn)for(var ur=null,br=nn.next();!br.done;br=nn.next()){var Zo=br.value;ur=$t(Zo,ur,Ot)}}var Ao=cn.call(kt);if(Ao==null)throw new Error("An iterable object provided no iterator.");for(var _s=null,Co=null,ns=ai,Kl=0,Pl=0,ah=null,Ec=Ao.next();ns!==null&&!Ec.done;Pl++,Ec=Ao.next()){ns.index>Pl?(ah=ns,ns=null):ah=ns.sibling;var Ac=pt(Ot,ns,Ec.value,Ci);if(Ac===null){ns===null&&(ns=ah);break}l&&ns&&Ac.alternate===null&&h(Ot,ns),Kl=G(Ac,Kl,Pl),Co===null?_s=Ac:Co.sibling=Ac,Co=Ac,ns=ah}if(Ec.done){if(w(Ot,ns),Ds()){var Jl=Pl;am(Ot,Jl)}return _s}if(ns===null){for(;!Ec.done;Pl++,Ec=Ao.next()){var Rm=gt(Ot,Ec.value,Ci);Rm!==null&&(Kl=G(Rm,Kl,Pl),Co===null?_s=Rm:Co.sibling=Rm,Co=Rm)}if(Ds()){var pb=Pl;am(Ot,pb)}return _s}for(var qw=R(Ot,ns);!Ec.done;Pl++,Ec=Ao.next()){var tp=Ht(qw,Ot,Pl,Ec.value,Ci);tp!==null&&(l&&tp.alternate!==null&&qw.delete(tp.key===null?Pl:tp.key),Kl=G(tp,Kl,Pl),Co===null?_s=tp:Co.sibling=tp,Co=tp)}if(l&&qw.forEach(function(iL){return h(Ot,iL)}),Ds()){var tL=Pl;am(Ot,tL)}return _s}function Vn(Ot,ai,kt,Ci){if(ai!==null&&ai.tag===de){w(Ot,ai.sibling);var cn=O(ai,kt);return cn.return=Ot,cn}w(Ot,ai);var nn=MI(kt,Ot.mode,Ci);return nn.return=Ot,nn}function An(Ot,ai,kt,Ci){for(var cn=kt.key,nn=ai;nn!==null;){if(nn.key===cn){var ur=kt.type;if(ur===hn){if(nn.tag===ve){w(Ot,nn.sibling);var br=O(nn,kt.props.children);return br.return=Ot,br._debugSource=kt._source,br._debugOwner=kt._owner,br}}else if(nn.elementType===ur||BD(nn,kt)||typeof ur=="object"&&ur!==null&&ur.$$typeof===ye&&ll(ur)===nn.type){w(Ot,nn.sibling);var Zo=O(nn,kt.props);return Zo.ref=Zy(Ot,nn,kt),Zo.return=Ot,Zo._debugSource=kt._source,Zo._debugOwner=kt._owner,Zo}w(Ot,nn);break}else h(Ot,nn);nn=nn.sibling}if(kt.type===hn){var Ao=A_(kt.props.children,Ot.mode,Ci,kt.key);return Ao.return=Ot,Ao}else{var _s=DI(kt,Ot.mode,Ci);return _s.ref=Zy(Ot,ai,kt),_s.return=Ot,_s}}function lo(Ot,ai,kt,Ci){for(var cn=kt.key,nn=ai;nn!==null;){if(nn.key===cn)if(nn.tag===re&&nn.stateNode.containerInfo===kt.containerInfo&&nn.stateNode.implementation===kt.implementation){w(Ot,nn.sibling);var ur=O(nn,kt.children||[]);return ur.return=Ot,ur}else{w(Ot,nn);break}else h(Ot,nn);nn=nn.sibling}var br=PI(kt,Ot.mode,Ci);return br.return=Ot,br}function Kr(Ot,ai,kt,Ci){var cn=typeof kt=="object"&&kt!==null&&kt.type===hn&&kt.key===null;if(cn&&(kt=kt.props.children),typeof kt=="object"&&kt!==null){switch(kt.$$typeof){case Ga:return K(An(Ot,ai,kt,Ci));case Ma:return K(lo(Ot,ai,kt,Ci));case ye:var nn=kt._payload,ur=kt._init;return Kr(Ot,ai,ur(nn),Ci)}if(Er(kt))return oi(Ot,ai,kt,Ci);if(xi(kt))return Ji(Ot,ai,kt,Ci);u0(Ot,kt)}return typeof kt=="string"&&kt!==""||typeof kt=="number"?K(Vn(Ot,ai,""+kt,Ci)):(typeof kt=="function"&&Xy(Ot),w(Ot,ai))}return Kr}var Ku=Qg(!0),h0=Qg(!1);function d0(l,h){if(l!==null&&h.child!==l.child)throw new Error("Resuming work not yet implemented.");if(h.child!==null){var w=h.child,R=Ov(w,w.pendingProps);for(h.child=R,R.return=h;w.sibling!==null;)w=w.sibling,R=R.sibling=Ov(w,w.pendingProps),R.return=h;R.sibling=null}}function NC(l,h){for(var w=l.child;w!==null;)vF(w,h),w=w.sibling}var f0=Vh(null),p0;p0={};var m0=null,um=null,g0=null,e_=!1;function Yy(){m0=null,um=null,g0=null,e_=!1}function $1(){e_=!0}function Ky(){e_=!1}function _0(l,h,w){js(f0,h._currentValue,l),h._currentValue=w,h._currentRenderer!==void 0&&h._currentRenderer!==null&&h._currentRenderer!==p0&&A("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),h._currentRenderer=p0}function y0(l,h){var w=f0.current;Us(f0,h),l._currentValue=w}function v0(l,h,w){for(var R=l;R!==null;){var O=R.alternate;if(pc(R.childLanes,h)?O!==null&&!pc(O.childLanes,h)&&(O.childLanes=_r(O.childLanes,h)):(R.childLanes=_r(R.childLanes,h),O!==null&&(O.childLanes=_r(O.childLanes,h))),R===w)break;R=R.return}R!==w&&A("Expected to find the propagation root when scheduling context work. This error is likely caused by a bug in React. Please file an issue.")}function QS(l,h,w){Ju(l,h,w)}function Ju(l,h,w){var R=l.child;for(R!==null&&(R.return=l);R!==null;){var O=void 0,G=R.dependencies;if(G!==null){O=R.child;for(var K=G.firstContext;K!==null;){if(K.context===h){if(R.tag===N){var ae=Dh(w),pe=th(xn,ae);pe.tag=Bf;var Oe=R.updateQueue;if(Oe!==null){var Ve=Oe.shared,gt=Ve.pending;gt===null?pe.next=pe:(pe.next=gt.next,gt.next=pe),Ve.pending=pe}}R.lanes=_r(R.lanes,w);var pt=R.alternate;pt!==null&&(pt.lanes=_r(pt.lanes,w)),v0(R.return,w,l),G.lanes=_r(G.lanes,w);break}K=K.next}}else if(R.tag===Le)O=R.type===l.type?null:R.child;else if(R.tag===Di){var Ht=R.return;if(Ht===null)throw new Error("We just came from a parent so we must have had a parent. This is a bug in React.");Ht.lanes=_r(Ht.lanes,w);var $t=Ht.alternate;$t!==null&&($t.lanes=_r($t.lanes,w)),v0(Ht,w,l),O=R.sibling}else O=R.child;if(O!==null)O.return=R;else for(O=R;O!==null;){if(O===l){O=null;break}var oi=O.sibling;if(oi!==null){oi.return=O.return,O=oi;break}O=O.return}R=O}}function Qu(l,h){m0=l,um=null,g0=null;var w=l.dependencies;if(w!==null){var R=w.firstContext;R!==null&&(lr(w.lanes,h)&&ee(),w.firstContext=null)}}function za(l){e_&&A("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");var h=l._currentValue;if(g0!==l){var w={context:l,memoizedValue:h,next:null};if(um===null){if(m0===null)throw new Error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");um=w,m0.dependencies={lanes:yi,firstContext:w}}else um=um.next=w}return h}var ru=null;function eh(l){ru===null?ru=[l]:ru.push(l)}function eE(){if(ru!==null){for(var l=0;l<ru.length;l++){var h=ru[l],w=h.interleaved;if(w!==null){h.interleaved=null;var R=w.next,O=h.pending;if(O!==null){var G=O.next;O.next=R,w.next=G}h.pending=w}}ru=null}}function W1(l,h,w,R){var O=h.interleaved;return O===null?(w.next=w,eh(h)):(w.next=O.next,O.next=w),h.interleaved=w,Jy(l,R)}function tE(l,h,w,R){var O=h.interleaved;O===null?(w.next=w,eh(h)):(w.next=O.next,O.next=w),h.interleaved=w}function iE(l,h,w,R){var O=h.interleaved;return O===null?(w.next=w,eh(h)):(w.next=O.next,O.next=w),h.interleaved=w,Jy(l,R)}function Xl(l,h){return Jy(l,h)}var BC=Jy;function Jy(l,h){l.lanes=_r(l.lanes,h);var w=l.alternate;w!==null&&(w.lanes=_r(w.lanes,h)),w===null&&(l.flags&(la|Uc))!==On&&FD(l);for(var R=l,O=l.return;O!==null;)O.childLanes=_r(O.childLanes,h),w=O.alternate,w!==null?w.childLanes=_r(w.childLanes,h):(O.flags&(la|Uc))!==On&&FD(l),R=O,O=O.return;if(R.tag===X){var G=R.stateNode;return G}else return null}var q1=0,Nf=1,Bf=2,Qy=3,ev=!1,hm,tv;hm=!1,tv=null;function x0(l){var h={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:yi},effects:null};l.updateQueue=h}function ou(l,h){var w=h.updateQueue,R=l.updateQueue;if(w===R){var O={baseState:R.baseState,firstBaseUpdate:R.firstBaseUpdate,lastBaseUpdate:R.lastBaseUpdate,shared:R.shared,effects:R.effects};h.updateQueue=O}}function th(l,h){var w={eventTime:l,lane:h,tag:q1,payload:null,callback:null,next:null};return w}function _c(l,h,w){var R=l.updateQueue;if(R===null)return null;var O=R.shared;if(tv===O&&!hm&&(A("An update (setState, replaceState, or forceUpdate) was scheduled from inside an update function. Update functions should be pure, with zero side-effects. Consider using componentDidUpdate or a callback."),hm=!0),Lk()){var G=O.pending;return G===null?h.next=h:(h.next=G.next,G.next=h),O.pending=h,BC(l,w)}else return iE(l,O,h,w)}function yc(l,h,w){var R=h.updateQueue;if(R!==null){var O=R.shared;if(ju(w)){var G=O.lanes;G=Ph(G,l.pendingLanes);var K=_r(G,w);O.lanes=K,Oh(l,K)}}}function b0(l,h){var w=l.updateQueue,R=l.alternate;if(R!==null){var O=R.updateQueue;if(w===O){var G=null,K=null,ae=w.firstBaseUpdate;if(ae!==null){var pe=ae;do{var Oe={eventTime:pe.eventTime,lane:pe.lane,tag:pe.tag,payload:pe.payload,callback:pe.callback,next:null};K===null?G=K=Oe:(K.next=Oe,K=Oe),pe=pe.next}while(pe!==null);K===null?G=K=h:(K.next=h,K=h)}else G=K=h;w={baseState:O.baseState,firstBaseUpdate:G,lastBaseUpdate:K,shared:O.shared,effects:O.effects},l.updateQueue=w;return}}var Ve=w.lastBaseUpdate;Ve===null?w.firstBaseUpdate=h:Ve.next=h,w.lastBaseUpdate=h}function Z1(l,h,w,R,O,G){switch(w.tag){case Nf:{var K=w.payload;if(typeof K=="function"){$1();var ae=K.call(G,R,O);{if(l.mode&ca){Ho(!0);try{K.call(G,R,O)}finally{Ho(!1)}}Ky()}return ae}return K}case Qy:l.flags=l.flags&~us|Xr;case q1:{var pe=w.payload,Oe;if(typeof pe=="function"){$1(),Oe=pe.call(G,R,O);{if(l.mode&ca){Ho(!0);try{pe.call(G,R,O)}finally{Ho(!1)}}Ky()}}else Oe=pe;return Oe==null?R:ei({},R,Oe)}case Bf:return ev=!0,R}return R}function w0(l,h,w,R){var O=l.updateQueue;ev=!1,tv=O.shared;var G=O.firstBaseUpdate,K=O.lastBaseUpdate,ae=O.shared.pending;if(ae!==null){O.shared.pending=null;var pe=ae,Oe=pe.next;pe.next=null,K===null?G=Oe:K.next=Oe,K=pe;var Ve=l.alternate;if(Ve!==null){var gt=Ve.updateQueue,pt=gt.lastBaseUpdate;pt!==K&&(pt===null?gt.firstBaseUpdate=Oe:pt.next=Oe,gt.lastBaseUpdate=pe)}}if(G!==null){var Ht=O.baseState,$t=yi,oi=null,Ji=null,Vn=null,An=G;do{var lo=An.lane,Kr=An.eventTime;if(pc(R,lo)){if(Vn!==null){var ai={eventTime:Kr,lane:ua,tag:An.tag,payload:An.payload,callback:An.callback,next:null};Vn=Vn.next=ai}Ht=Z1(l,O,An,Ht,h,w);var kt=An.callback;if(kt!==null&&An.lane!==ua){l.flags|=Qm;var Ci=O.effects;Ci===null?O.effects=[An]:Ci.push(An)}}else{var Ot={eventTime:Kr,lane:lo,tag:An.tag,payload:An.payload,callback:An.callback,next:null};Vn===null?(Ji=Vn=Ot,oi=Ht):Vn=Vn.next=Ot,$t=_r($t,lo)}if(An=An.next,An===null){if(ae=O.shared.pending,ae===null)break;var cn=ae,nn=cn.next;cn.next=null,An=nn,O.lastBaseUpdate=cn,O.shared.pending=null}}while(!0);Vn===null&&(oi=Ht),O.baseState=oi,O.firstBaseUpdate=Ji,O.lastBaseUpdate=Vn;var ur=O.shared.interleaved;if(ur!==null){var br=ur;do $t=_r($t,br.lane),br=br.next;while(br!==ur)}else G===null&&(O.shared.lanes=yi);jw($t),l.lanes=$t,l.memoizedState=Ht}tv=null}function T0(l,h){if(typeof l!="function")throw new Error("Invalid argument passed as callback. Expected a function. Instead "+("received: "+l));l.call(h)}function X1(){ev=!1}function iv(){return ev}function nv(l,h,w){var R=h.effects;if(h.effects=null,R!==null)for(var O=0;O<R.length;O++){var G=R[O],K=G.callback;K!==null&&(G.callback=null,T0(K,w))}}var Vf={},Uf=Vh(Vf),rv=Vh(Vf),S0=Vh(Vf);function zd(l){if(l===Vf)throw new Error("Expected host context to exist. This error is likely caused by a bug in React. Please file an issue.");return l}function nE(){var l=zd(S0.current);return l}function ov(l,h){js(S0,h,l),js(rv,l,l),js(Uf,Vf,l);var w=Rf(h);Us(Uf,l),js(Uf,w,l)}function t_(l){Us(Uf,l),Us(rv,l),Us(S0,l)}function i_(){var l=zd(Uf.current);return l}function Y1(l){zd(S0.current);var h=zd(Uf.current),w=mS(h,l.type);h!==w&&(js(rv,l,l),js(Uf,w,l))}function K1(l){rv.current===l&&(Us(Uf,l),Us(rv,l))}var E0=0,J1=1,n_=1,av=2,au=Vh(E0);function Q1(l,h){return(l&h)!==0}function dm(l){return l&J1}function sv(l,h){return l&J1|h}function VC(l,h){return l|h}function jf(l,h){js(au,h,l)}function Gh(l){Us(au,l)}function Nd(l,h){var w=l.memoizedState;return w!==null?w.dehydrated!==null:(l.memoizedProps,!0)}function lv(l){for(var h=l;h!==null;){if(h.tag===Ye){var w=h.memoizedState;if(w!==null){var R=w.dehydrated;if(R===null||b1(R)||w1(R))return h}}else if(h.tag===si&&h.memoizedProps.revealOrder!==void 0){var O=(h.flags&Xr)!==On;if(O)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===l)return null;for(;h.sibling===null;){if(h.return===null||h.return===l)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var cl=0,Na=1,su=2,ps=4,Ms=8,fm=[];function A0(){for(var l=0;l<fm.length;l++){var h=fm[l];h._workInProgressVersionPrimary=null}fm.length=0}function UC(l,h){var w=h._getVersion,R=w(h._source);l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[h,R]:l.mutableSourceEagerHydrationData.push(h,R)}var $i=u.ReactCurrentDispatcher,cv=u.ReactCurrentBatchConfig,pm,Hh;pm=new Set;var ih=yi,go=null,Ba=null,ms=null,C0=!1,$h=!1,Gf=0,jC=0,rE=25,hi=null,lu=null,Bd=-1,ew=!1;function bo(){{var l=hi;lu===null?lu=[l]:lu.push(l)}}function Hi(){{var l=hi;lu!==null&&(Bd++,lu[Bd]!==l&&GC(l))}}function mm(l){l!=null&&!Er(l)&&A("%s received a final argument that is not an array (instead, received `%s`). When specified, the final argument must be an array.",hi,typeof l)}function GC(l){{var h=yn(go);if(!pm.has(h)&&(pm.add(h),lu!==null)){for(var w="",R=30,O=0;O<=Bd;O++){for(var G=lu[O],K=O===Bd?l:G,ae=O+1+". "+G;ae.length<R;)ae+=" ";ae+=K+`
`,w+=ae}A(`React has detected a change in the order of Hooks called by %s. This will lead to bugs and errors if not fixed. For more information, read the Rules of Hooks: https://reactjs.org/link/rules-of-hooks

   Previous render            Next render
   ------------------------------------------------------
%s   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
`,h,w)}}}function ul(){throw new Error(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.`)}function gm(l,h){if(ew)return!1;if(h===null)return A("%s received a final argument during this render, but not during the previous render. Even though the final argument is optional, its type cannot change between renders.",hi),!1;l.length!==h.length&&A(`The final argument passed to %s changed size between renders. The order and size of this array must remain constant.

Previous: %s
Incoming: %s`,hi,"["+h.join(", ")+"]","["+l.join(", ")+"]");for(var w=0;w<h.length&&w<l.length;w++)if(!Cl(l[w],h[w]))return!1;return!0}function Wh(l,h,w,R,O,G){ih=G,go=h,lu=l!==null?l._debugHookTypes:null,Bd=-1,ew=l!==null&&l.type!==h.type,h.memoizedState=null,h.updateQueue=null,h.lanes=yi,l!==null&&l.memoizedState!==null?$i.current=p_:lu!==null?$i.current=hE:$i.current=bv;var K=w(R,O);if($h){var ae=0;do{if($h=!1,Gf=0,ae>=rE)throw new Error("Too many re-renders. React limits the number of renders to prevent an infinite loop.");ae+=1,ew=!1,Ba=null,ms=null,h.updateQueue=null,Bd=-1,$i.current=dw,K=w(R,O)}while($h)}$i.current=f_,h._debugHookTypes=lu;var pe=Ba!==null&&Ba.next!==null;if(ih=yi,go=null,Ba=null,ms=null,hi=null,lu=null,Bd=-1,l!==null&&(l.flags&jc)!==(h.flags&jc)&&(l.mode&Nn)!==Cn&&A("Internal React error: Expected static flag was missing. Please notify the React team."),C0=!1,pe)throw new Error("Rendered fewer hooks than expected. This may be caused by an accidental early return statement.");return K}function qh(){var l=Gf!==0;return Gf=0,l}function uv(l,h,w){h.updateQueue=l.updateQueue,(h.mode&Ul)!==Cn?h.flags&=-50333701:h.flags&=-2053,l.lanes=yf(l.lanes,w)}function _m(){if($i.current=f_,C0){for(var l=go.memoizedState;l!==null;){var h=l.queue;h!==null&&(h.pending=null),l=l.next}C0=!1}ih=yi,go=null,Ba=null,ms=null,lu=null,Bd=-1,hi=null,lE=!1,$h=!1,Gf=0}function Zh(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ms===null?go.memoizedState=ms=l:ms=ms.next=l,ms}function Yl(){var l;if(Ba===null){var h=go.alternate;h!==null?l=h.memoizedState:l=null}else l=Ba.next;var w;if(ms===null?w=go.memoizedState:w=ms.next,w!==null)ms=w,w=ms.next,Ba=l;else{if(l===null)throw new Error("Rendered more hooks than during the previous render.");Ba=l;var R={memoizedState:Ba.memoizedState,baseState:Ba.baseState,baseQueue:Ba.baseQueue,queue:Ba.queue,next:null};ms===null?go.memoizedState=ms=R:ms=ms.next=R}return ms}function I0(){return{lastEffect:null,stores:null}}function r_(l,h){return typeof h=="function"?h(l):h}function R0(l,h,w){var R=Zh(),O;w!==void 0?O=w(h):O=h,R.memoizedState=R.baseState=O;var G={pending:null,interleaved:null,lanes:yi,dispatch:null,lastRenderedReducer:l,lastRenderedState:O};R.queue=G;var K=G.dispatch=xm.bind(null,go,G);return[R.memoizedState,K]}function D0(l,h,w){var R=Yl(),O=R.queue;if(O===null)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");O.lastRenderedReducer=l;var G=Ba,K=G.baseQueue,ae=O.pending;if(ae!==null){if(K!==null){var pe=K.next,Oe=ae.next;K.next=Oe,ae.next=pe}G.baseQueue!==K&&A("Internal error: Expected work-in-progress queue to be a clone. This is a bug in React."),G.baseQueue=K=ae,O.pending=null}if(K!==null){var Ve=K.next,gt=G.baseState,pt=null,Ht=null,$t=null,oi=Ve;do{var Ji=oi.lane;if(pc(ih,Ji)){if($t!==null){var An={lane:ua,action:oi.action,hasEagerState:oi.hasEagerState,eagerState:oi.eagerState,next:null};$t=$t.next=An}if(oi.hasEagerState)gt=oi.eagerState;else{var lo=oi.action;gt=l(gt,lo)}}else{var Vn={lane:Ji,action:oi.action,hasEagerState:oi.hasEagerState,eagerState:oi.eagerState,next:null};$t===null?(Ht=$t=Vn,pt=gt):$t=$t.next=Vn,go.lanes=_r(go.lanes,Ji),jw(Ji)}oi=oi.next}while(oi!==null&&oi!==Ve);$t===null?pt=gt:$t.next=Ht,Cl(gt,R.memoizedState)||ee(),R.memoizedState=gt,R.baseState=pt,R.baseQueue=$t,O.lastRenderedState=gt}var Kr=O.interleaved;if(Kr!==null){var Ot=Kr;do{var ai=Ot.lane;go.lanes=_r(go.lanes,ai),jw(ai),Ot=Ot.next}while(Ot!==Kr)}else K===null&&(O.lanes=yi);var kt=O.dispatch;return[R.memoizedState,kt]}function M0(l,h,w){var R=Yl(),O=R.queue;if(O===null)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");O.lastRenderedReducer=l;var G=O.dispatch,K=O.pending,ae=R.memoizedState;if(K!==null){O.pending=null;var pe=K.next,Oe=pe;do{var Ve=Oe.action;ae=l(ae,Ve),Oe=Oe.next}while(Oe!==pe);Cl(ae,R.memoizedState)||ee(),R.memoizedState=ae,R.baseQueue===null&&(R.baseState=ae),O.lastRenderedState=ae}return[ae,G]}function oE(l,h,w){}function HC(l,h,w){}function hv(l,h,w){var R=go,O=Zh(),G,K=Ds();if(K){if(w===void 0)throw new Error("Missing getServerSnapshot, which is required for server-rendered content. Will revert to client rendering.");G=w(),Hh||G!==w()&&(A("The result of getServerSnapshot should be cached to avoid an infinite loop"),Hh=!0)}else{if(G=h(),!Hh){var ae=h();Cl(G,ae)||(A("The result of getSnapshot should be cached to avoid an infinite loop"),Hh=!0)}var pe=UE();if(pe===null)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");Td(pe,ih)||tw(R,h,G)}O.memoizedState=G;var Oe={value:G,getSnapshot:h};return O.queue=Oe,pv(nw.bind(null,R,Oe,l),[l]),R.flags|=Vc,a_(Na|Ms,iw.bind(null,R,Oe,G,h),void 0,null),G}function ym(l,h,w){var R=go,O=Yl(),G=h();if(!Hh){var K=h();Cl(G,K)||(A("The result of getSnapshot should be cached to avoid an infinite loop"),Hh=!0)}var ae=O.memoizedState,pe=!Cl(ae,G);pe&&(O.memoizedState=G,ee());var Oe=O.queue;if(l_(nw.bind(null,R,Oe,l),[l]),Oe.getSnapshot!==h||pe||ms!==null&&ms.memoizedState.tag&Na){R.flags|=Vc,a_(Na|Ms,iw.bind(null,R,Oe,G,h),void 0,null);var Ve=UE();if(Ve===null)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");Td(Ve,ih)||tw(R,h,G)}return G}function tw(l,h,w){l.flags|=Pu;var R={getSnapshot:h,value:w},O=go.updateQueue;if(O===null)O=I0(),go.updateQueue=O,O.stores=[R];else{var G=O.stores;G===null?O.stores=[R]:G.push(R)}}function iw(l,h,w,R){h.value=w,h.getSnapshot=R,rw(h)&&P0(l)}function nw(l,h,w){var R=function(){rw(h)&&P0(l)};return w(R)}function rw(l){var h=l.getSnapshot,w=l.value;try{var R=h();return!Cl(w,R)}catch{return!0}}function P0(l){var h=Xl(l,Yn);h!==null&&Xs(h,l,Yn,xn)}function vm(l){var h=Zh();typeof l=="function"&&(l=l()),h.memoizedState=h.baseState=l;var w={pending:null,interleaved:null,lanes:yi,dispatch:null,lastRenderedReducer:r_,lastRenderedState:l};h.queue=w;var R=w.dispatch=hw.bind(null,go,w);return[h.memoizedState,R]}function O0(l){return D0(r_)}function o_(l){return M0(r_)}function a_(l,h,w,R){var O={tag:l,create:h,destroy:w,deps:R,next:null},G=go.updateQueue;if(G===null)G=I0(),go.updateQueue=G,G.lastEffect=O.next=O;else{var K=G.lastEffect;if(K===null)G.lastEffect=O.next=O;else{var ae=K.next;K.next=O,O.next=ae,G.lastEffect=O}}return O}function ow(l){var h=Zh();{var w={current:l};return h.memoizedState=w,w}}function dv(l){var h=Yl();return h.memoizedState}function s_(l,h,w,R){var O=Zh(),G=R===void 0?null:R;go.flags|=l,O.memoizedState=a_(Na|h,w,void 0,G)}function fv(l,h,w,R){var O=Yl(),G=R===void 0?null:R,K=void 0;if(Ba!==null){var ae=Ba.memoizedState;if(K=ae.destroy,G!==null){var pe=ae.deps;if(gm(G,pe)){O.memoizedState=a_(h,w,K,G);return}}}go.flags|=l,O.memoizedState=a_(Na|h,w,K,G)}function pv(l,h){return(go.mode&Ul)!==Cn?s_(of|Vc|Dp,Ms,l,h):s_(Vc|Dp,Ms,l,h)}function l_(l,h){return fv(Vc,Ms,l,h)}function k0(l,h){return s_(no,su,l,h)}function mv(l,h){return fv(no,su,l,h)}function aw(l,h){var w=no;return w|=Ou,(go.mode&Ul)!==Cn&&(w|=Vl),s_(w,ps,l,h)}function c_(l,h){return fv(no,ps,l,h)}function sw(l,h){if(typeof h=="function"){var w=h,R=l();return w(R),function(){w(null)}}else if(h!=null){var O=h;O.hasOwnProperty("current")||A("Expected useImperativeHandle() first argument to either be a ref callback or React.createRef() object. Instead received: %s.","an object with keys {"+Object.keys(O).join(", ")+"}");var G=l();return O.current=G,function(){O.current=null}}}function u_(l,h,w){typeof h!="function"&&A("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",h!==null?typeof h:"null");var R=w!=null?w.concat([l]):null,O=no;return O|=Ou,(go.mode&Ul)!==Cn&&(O|=Vl),s_(O,ps,sw.bind(null,h,l),R)}function h_(l,h,w){typeof h!="function"&&A("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",h!==null?typeof h:"null");var R=w!=null?w.concat([l]):null;return fv(no,ps,sw.bind(null,h,l),R)}function aE(l,h){}var gv=aE;function _v(l,h){var w=Zh(),R=h===void 0?null:h;return w.memoizedState=[l,R],l}function yv(l,h){var w=Yl(),R=h===void 0?null:h,O=w.memoizedState;if(O!==null&&R!==null){var G=O[1];if(gm(R,G))return O[0]}return w.memoizedState=[l,R],l}function F0(l,h){var w=Zh(),R=h===void 0?null:h,O=l();return w.memoizedState=[O,R],O}function Vd(l,h){var w=Yl(),R=h===void 0?null:h,O=w.memoizedState;if(O!==null&&R!==null){var G=O[1];if(gm(R,G))return O[0]}var K=l();return w.memoizedState=[K,R],K}function vv(l){var h=Zh();return h.memoizedState=l,l}function Hf(l){var h=Yl(),w=Ba,R=w.memoizedState;return cw(h,R,l)}function lw(l){var h=Yl();if(Ba===null)return h.memoizedState=l,l;var w=Ba.memoizedState;return cw(h,w,l)}function cw(l,h,w){var R=!wd(ih);if(R){if(!Cl(w,h)){var O=xg();go.lanes=_r(go.lanes,O),jw(O),l.baseState=!0}return h}else return l.baseState&&(l.baseState=!1,ee()),l.memoizedState=w,w}function sE(l,h,w){var R=$l();Aa(_x(R,Tl)),l(!0);var O=cv.transition;cv.transition={};var G=cv.transition;cv.transition._updatedFibers=new Set;try{l(!1),h()}finally{if(Aa(R),cv.transition=O,O===null&&G._updatedFibers){var K=G._updatedFibers.size;K>10&&E("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),G._updatedFibers.clear()}}}function L0(){var l=vm(!1),h=l[0],w=l[1],R=sE.bind(null,w),O=Zh();return O.memoizedState=R,[h,R]}function xv(){var l=O0(),h=l[0],w=Yl(),R=w.memoizedState;return[h,R]}function d_(){var l=o_(),h=l[0],w=Yl(),R=w.memoizedState;return[h,R]}var lE=!1;function $C(){return lE}function uw(){var l=Zh(),h=UE(),w=h.identifierPrefix,R;if(Ds()){var O=HS();R=":"+w+"R"+O;var G=Gf++;G>0&&(R+="H"+G.toString(32)),R+=":"}else{var K=jC++;R=":"+w+"r"+K.toString(32)+":"}return l.memoizedState=R,R}function Xh(){var l=Yl(),h=l.memoizedState;return h}function xm(l,h,w){typeof arguments[3]=="function"&&A("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var R=S_(l),O={lane:R,action:w,hasEagerState:!1,eagerState:null,next:null};if(cE(l))uE(h,O);else{var G=W1(l,h,O,R);if(G!==null){var K=Sc();Xs(G,l,R,K),z0(G,h,R)}}N0(l,R)}function hw(l,h,w){typeof arguments[3]=="function"&&A("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var R=S_(l),O={lane:R,action:w,hasEagerState:!1,eagerState:null,next:null};if(cE(l))uE(h,O);else{var G=l.alternate;if(l.lanes===yi&&(G===null||G.lanes===yi)){var K=h.lastRenderedReducer;if(K!==null){var ae;ae=$i.current,$i.current=cu;try{var pe=h.lastRenderedState,Oe=K(pe,w);if(O.hasEagerState=!0,O.eagerState=Oe,Cl(Oe,pe)){tE(l,h,O,R);return}}catch{}finally{$i.current=ae}}}var Ve=W1(l,h,O,R);if(Ve!==null){var gt=Sc();Xs(Ve,l,R,gt),z0(Ve,h,R)}}N0(l,R)}function cE(l){var h=l.alternate;return l===go||h!==null&&h===go}function uE(l,h){$h=C0=!0;var w=l.pending;w===null?h.next=h:(h.next=w.next,w.next=h),l.pending=h}function z0(l,h,w){if(ju(w)){var R=h.lanes;R=Ph(R,l.pendingLanes);var O=_r(R,w);h.lanes=O,Oh(l,O)}}function N0(l,h,w){Ss(l,h)}var f_={readContext:za,useCallback:ul,useContext:ul,useEffect:ul,useImperativeHandle:ul,useInsertionEffect:ul,useLayoutEffect:ul,useMemo:ul,useReducer:ul,useRef:ul,useState:ul,useDebugValue:ul,useDeferredValue:ul,useTransition:ul,useMutableSource:ul,useSyncExternalStore:ul,useId:ul,unstable_isNewReconciler:fi},bv=null,hE=null,p_=null,dw=null,Yh=null,cu=null,B0=null;{var fw=function(){A("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().")},cr=function(){A("Do not call Hooks inside useEffect(...), useMemo(...), or other built-in Hooks. You can only call Hooks at the top level of your React function. For more information, see https://reactjs.org/link/rules-of-hooks")};bv={readContext:function(l){return za(l)},useCallback:function(l,h){return hi="useCallback",bo(),mm(h),_v(l,h)},useContext:function(l){return hi="useContext",bo(),za(l)},useEffect:function(l,h){return hi="useEffect",bo(),mm(h),pv(l,h)},useImperativeHandle:function(l,h,w){return hi="useImperativeHandle",bo(),mm(w),u_(l,h,w)},useInsertionEffect:function(l,h){return hi="useInsertionEffect",bo(),mm(h),k0(l,h)},useLayoutEffect:function(l,h){return hi="useLayoutEffect",bo(),mm(h),aw(l,h)},useMemo:function(l,h){hi="useMemo",bo(),mm(h);var w=$i.current;$i.current=Yh;try{return F0(l,h)}finally{$i.current=w}},useReducer:function(l,h,w){hi="useReducer",bo();var R=$i.current;$i.current=Yh;try{return R0(l,h,w)}finally{$i.current=R}},useRef:function(l){return hi="useRef",bo(),ow(l)},useState:function(l){hi="useState",bo();var h=$i.current;$i.current=Yh;try{return vm(l)}finally{$i.current=h}},useDebugValue:function(l,h){return hi="useDebugValue",bo(),void 0},useDeferredValue:function(l){return hi="useDeferredValue",bo(),vv(l)},useTransition:function(){return hi="useTransition",bo(),L0()},useMutableSource:function(l,h,w){return hi="useMutableSource",bo(),void 0},useSyncExternalStore:function(l,h,w){return hi="useSyncExternalStore",bo(),hv(l,h,w)},useId:function(){return hi="useId",bo(),uw()},unstable_isNewReconciler:fi},hE={readContext:function(l){return za(l)},useCallback:function(l,h){return hi="useCallback",Hi(),_v(l,h)},useContext:function(l){return hi="useContext",Hi(),za(l)},useEffect:function(l,h){return hi="useEffect",Hi(),pv(l,h)},useImperativeHandle:function(l,h,w){return hi="useImperativeHandle",Hi(),u_(l,h,w)},useInsertionEffect:function(l,h){return hi="useInsertionEffect",Hi(),k0(l,h)},useLayoutEffect:function(l,h){return hi="useLayoutEffect",Hi(),aw(l,h)},useMemo:function(l,h){hi="useMemo",Hi();var w=$i.current;$i.current=Yh;try{return F0(l,h)}finally{$i.current=w}},useReducer:function(l,h,w){hi="useReducer",Hi();var R=$i.current;$i.current=Yh;try{return R0(l,h,w)}finally{$i.current=R}},useRef:function(l){return hi="useRef",Hi(),ow(l)},useState:function(l){hi="useState",Hi();var h=$i.current;$i.current=Yh;try{return vm(l)}finally{$i.current=h}},useDebugValue:function(l,h){return hi="useDebugValue",Hi(),void 0},useDeferredValue:function(l){return hi="useDeferredValue",Hi(),vv(l)},useTransition:function(){return hi="useTransition",Hi(),L0()},useMutableSource:function(l,h,w){return hi="useMutableSource",Hi(),void 0},useSyncExternalStore:function(l,h,w){return hi="useSyncExternalStore",Hi(),hv(l,h,w)},useId:function(){return hi="useId",Hi(),uw()},unstable_isNewReconciler:fi},p_={readContext:function(l){return za(l)},useCallback:function(l,h){return hi="useCallback",Hi(),yv(l,h)},useContext:function(l){return hi="useContext",Hi(),za(l)},useEffect:function(l,h){return hi="useEffect",Hi(),l_(l,h)},useImperativeHandle:function(l,h,w){return hi="useImperativeHandle",Hi(),h_(l,h,w)},useInsertionEffect:function(l,h){return hi="useInsertionEffect",Hi(),mv(l,h)},useLayoutEffect:function(l,h){return hi="useLayoutEffect",Hi(),c_(l,h)},useMemo:function(l,h){hi="useMemo",Hi();var w=$i.current;$i.current=cu;try{return Vd(l,h)}finally{$i.current=w}},useReducer:function(l,h,w){hi="useReducer",Hi();var R=$i.current;$i.current=cu;try{return D0(l,h,w)}finally{$i.current=R}},useRef:function(l){return hi="useRef",Hi(),dv()},useState:function(l){hi="useState",Hi();var h=$i.current;$i.current=cu;try{return O0(l)}finally{$i.current=h}},useDebugValue:function(l,h){return hi="useDebugValue",Hi(),gv()},useDeferredValue:function(l){return hi="useDeferredValue",Hi(),Hf(l)},useTransition:function(){return hi="useTransition",Hi(),xv()},useMutableSource:function(l,h,w){return hi="useMutableSource",Hi(),void 0},useSyncExternalStore:function(l,h,w){return hi="useSyncExternalStore",Hi(),ym(l,h)},useId:function(){return hi="useId",Hi(),Xh()},unstable_isNewReconciler:fi},dw={readContext:function(l){return za(l)},useCallback:function(l,h){return hi="useCallback",Hi(),yv(l,h)},useContext:function(l){return hi="useContext",Hi(),za(l)},useEffect:function(l,h){return hi="useEffect",Hi(),l_(l,h)},useImperativeHandle:function(l,h,w){return hi="useImperativeHandle",Hi(),h_(l,h,w)},useInsertionEffect:function(l,h){return hi="useInsertionEffect",Hi(),mv(l,h)},useLayoutEffect:function(l,h){return hi="useLayoutEffect",Hi(),c_(l,h)},useMemo:function(l,h){hi="useMemo",Hi();var w=$i.current;$i.current=B0;try{return Vd(l,h)}finally{$i.current=w}},useReducer:function(l,h,w){hi="useReducer",Hi();var R=$i.current;$i.current=B0;try{return M0(l,h,w)}finally{$i.current=R}},useRef:function(l){return hi="useRef",Hi(),dv()},useState:function(l){hi="useState",Hi();var h=$i.current;$i.current=B0;try{return o_(l)}finally{$i.current=h}},useDebugValue:function(l,h){return hi="useDebugValue",Hi(),gv()},useDeferredValue:function(l){return hi="useDeferredValue",Hi(),lw(l)},useTransition:function(){return hi="useTransition",Hi(),d_()},useMutableSource:function(l,h,w){return hi="useMutableSource",Hi(),void 0},useSyncExternalStore:function(l,h,w){return hi="useSyncExternalStore",Hi(),ym(l,h)},useId:function(){return hi="useId",Hi(),Xh()},unstable_isNewReconciler:fi},Yh={readContext:function(l){return fw(),za(l)},useCallback:function(l,h){return hi="useCallback",cr(),bo(),_v(l,h)},useContext:function(l){return hi="useContext",cr(),bo(),za(l)},useEffect:function(l,h){return hi="useEffect",cr(),bo(),pv(l,h)},useImperativeHandle:function(l,h,w){return hi="useImperativeHandle",cr(),bo(),u_(l,h,w)},useInsertionEffect:function(l,h){return hi="useInsertionEffect",cr(),bo(),k0(l,h)},useLayoutEffect:function(l,h){return hi="useLayoutEffect",cr(),bo(),aw(l,h)},useMemo:function(l,h){hi="useMemo",cr(),bo();var w=$i.current;$i.current=Yh;try{return F0(l,h)}finally{$i.current=w}},useReducer:function(l,h,w){hi="useReducer",cr(),bo();var R=$i.current;$i.current=Yh;try{return R0(l,h,w)}finally{$i.current=R}},useRef:function(l){return hi="useRef",cr(),bo(),ow(l)},useState:function(l){hi="useState",cr(),bo();var h=$i.current;$i.current=Yh;try{return vm(l)}finally{$i.current=h}},useDebugValue:function(l,h){return hi="useDebugValue",cr(),bo(),void 0},useDeferredValue:function(l){return hi="useDeferredValue",cr(),bo(),vv(l)},useTransition:function(){return hi="useTransition",cr(),bo(),L0()},useMutableSource:function(l,h,w){return hi="useMutableSource",cr(),bo(),void 0},useSyncExternalStore:function(l,h,w){return hi="useSyncExternalStore",cr(),bo(),hv(l,h,w)},useId:function(){return hi="useId",cr(),bo(),uw()},unstable_isNewReconciler:fi},cu={readContext:function(l){return fw(),za(l)},useCallback:function(l,h){return hi="useCallback",cr(),Hi(),yv(l,h)},useContext:function(l){return hi="useContext",cr(),Hi(),za(l)},useEffect:function(l,h){return hi="useEffect",cr(),Hi(),l_(l,h)},useImperativeHandle:function(l,h,w){return hi="useImperativeHandle",cr(),Hi(),h_(l,h,w)},useInsertionEffect:function(l,h){return hi="useInsertionEffect",cr(),Hi(),mv(l,h)},useLayoutEffect:function(l,h){return hi="useLayoutEffect",cr(),Hi(),c_(l,h)},useMemo:function(l,h){hi="useMemo",cr(),Hi();var w=$i.current;$i.current=cu;try{return Vd(l,h)}finally{$i.current=w}},useReducer:function(l,h,w){hi="useReducer",cr(),Hi();var R=$i.current;$i.current=cu;try{return D0(l,h,w)}finally{$i.current=R}},useRef:function(l){return hi="useRef",cr(),Hi(),dv()},useState:function(l){hi="useState",cr(),Hi();var h=$i.current;$i.current=cu;try{return O0(l)}finally{$i.current=h}},useDebugValue:function(l,h){return hi="useDebugValue",cr(),Hi(),gv()},useDeferredValue:function(l){return hi="useDeferredValue",cr(),Hi(),Hf(l)},useTransition:function(){return hi="useTransition",cr(),Hi(),xv()},useMutableSource:function(l,h,w){return hi="useMutableSource",cr(),Hi(),void 0},useSyncExternalStore:function(l,h,w){return hi="useSyncExternalStore",cr(),Hi(),ym(l,h)},useId:function(){return hi="useId",cr(),Hi(),Xh()},unstable_isNewReconciler:fi},B0={readContext:function(l){return fw(),za(l)},useCallback:function(l,h){return hi="useCallback",cr(),Hi(),yv(l,h)},useContext:function(l){return hi="useContext",cr(),Hi(),za(l)},useEffect:function(l,h){return hi="useEffect",cr(),Hi(),l_(l,h)},useImperativeHandle:function(l,h,w){return hi="useImperativeHandle",cr(),Hi(),h_(l,h,w)},useInsertionEffect:function(l,h){return hi="useInsertionEffect",cr(),Hi(),mv(l,h)},useLayoutEffect:function(l,h){return hi="useLayoutEffect",cr(),Hi(),c_(l,h)},useMemo:function(l,h){hi="useMemo",cr(),Hi();var w=$i.current;$i.current=cu;try{return Vd(l,h)}finally{$i.current=w}},useReducer:function(l,h,w){hi="useReducer",cr(),Hi();var R=$i.current;$i.current=cu;try{return M0(l,h,w)}finally{$i.current=R}},useRef:function(l){return hi="useRef",cr(),Hi(),dv()},useState:function(l){hi="useState",cr(),Hi();var h=$i.current;$i.current=cu;try{return o_(l)}finally{$i.current=h}},useDebugValue:function(l,h){return hi="useDebugValue",cr(),Hi(),gv()},useDeferredValue:function(l){return hi="useDeferredValue",cr(),Hi(),lw(l)},useTransition:function(){return hi="useTransition",cr(),Hi(),d_()},useMutableSource:function(l,h,w){return hi="useMutableSource",cr(),Hi(),void 0},useSyncExternalStore:function(l,h,w){return hi="useSyncExternalStore",cr(),Hi(),ym(l,h)},useId:function(){return hi="useId",cr(),Hi(),Xh()},unstable_isNewReconciler:fi}}var $f=s.unstable_now,dE=0,V0=-1,Wf=-1,U0=-1,pw=!1,bm=!1;function fE(){return pw}function WC(){bm=!0}function qC(){pw=!1,bm=!1}function j0(){pw=bm,bm=!1}function pE(){return dE}function mE(){dE=$f()}function G0(l){Wf=$f(),l.actualStartTime<0&&(l.actualStartTime=$f())}function gE(l){Wf=-1}function H0(l,h){if(Wf>=0){var w=$f()-Wf;l.actualDuration+=w,h&&(l.selfBaseDuration=w),Wf=-1}}function Kh(l){if(V0>=0){var h=$f()-V0;V0=-1;for(var w=l.return;w!==null;){switch(w.tag){case X:var R=w.stateNode;R.effectDuration+=h;return;case Ge:var O=w.stateNode;O.effectDuration+=h;return}w=w.return}}}function mw(l){if(U0>=0){var h=$f()-U0;U0=-1;for(var w=l.return;w!==null;){switch(w.tag){case X:var R=w.stateNode;R!==null&&(R.passiveEffectDuration+=h);return;case Ge:var O=w.stateNode;O!==null&&(O.passiveEffectDuration+=h);return}w=w.return}}}function Jh(){V0=$f()}function qf(){U0=$f()}function wm(l){for(var h=l.child;h;)l.actualDuration+=h.actualDuration,h=h.sibling}function nh(l,h){if(l&&l.defaultProps){var w=ei({},h),R=l.defaultProps;for(var O in R)w[O]===void 0&&(w[O]=R[O]);return w}return h}var wv={},$0,W0,q0,Z0,X0,gw,Tv,Y0,K0,Zf,m_;{$0=new Set,W0=new Set,q0=new Set,Z0=new Set,Y0=new Set,X0=new Set,K0=new Set,Zf=new Set,m_=new Set;var _w=new Set;Tv=function(l,h){if(!(l===null||typeof l=="function")){var w=h+"_"+l;_w.has(w)||(_w.add(w),A("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",h,l))}},gw=function(l,h){if(h===void 0){var w=Gr(l)||"Component";X0.has(w)||(X0.add(w),A("%s.getDerivedStateFromProps(): A valid state object (or null) must be returned. You have returned undefined.",w))}},Object.defineProperty(wv,"_processChildContext",{enumerable:!1,value:function(){throw new Error("_processChildContext is not available in React 16+. This likely means you have multiple copies of React and are attempting to nest a React 15 tree inside a React 16 tree using unstable_renderSubtreeIntoContainer, which isn't supported. Try to make sure you have only one copy of React (and ideally, switch to ReactDOM.createPortal).")}}),Object.freeze(wv)}function g_(l,h,w,R){var O=l.memoizedState,G=w(R,O);{if(l.mode&ca){Ho(!0);try{G=w(R,O)}finally{Ho(!1)}}gw(h,G)}var K=G==null?O:ei({},O,G);if(l.memoizedState=K,l.lanes===yi){var ae=l.updateQueue;ae.baseState=K}}var Sv={isMounted:Gb,enqueueSetState:function(l,h,w){var R=Nc(l),O=Sc(),G=S_(R),K=th(O,G);K.payload=h,w!=null&&(Tv(w,"setState"),K.callback=w);var ae=_c(R,K,G);ae!==null&&(Xs(ae,R,G,O),yc(ae,R,G)),Ss(R,G)},enqueueReplaceState:function(l,h,w){var R=Nc(l),O=Sc(),G=S_(R),K=th(O,G);K.tag=Nf,K.payload=h,w!=null&&(Tv(w,"replaceState"),K.callback=w);var ae=_c(R,K,G);ae!==null&&(Xs(ae,R,G,O),yc(ae,R,G)),Ss(R,G)},enqueueForceUpdate:function(l,h){var w=Nc(l),R=Sc(),O=S_(w),G=th(R,O);G.tag=Bf,h!=null&&(Tv(h,"forceUpdate"),G.callback=h);var K=_c(w,G,O);K!==null&&(Xs(K,w,O,R),yc(K,w,O)),Wb(w,O)}};function yw(l,h,w,R,O,G,K){var ae=l.stateNode;if(typeof ae.shouldComponentUpdate=="function"){var pe=ae.shouldComponentUpdate(R,G,K);{if(l.mode&ca){Ho(!0);try{pe=ae.shouldComponentUpdate(R,G,K)}finally{Ho(!1)}}pe===void 0&&A("%s.shouldComponentUpdate(): Returned undefined instead of a boolean value. Make sure to return true or false.",Gr(h)||"Component")}return pe}return h.prototype&&h.prototype.isPureReactComponent?!Id(w,R)||!Id(O,G):!0}function _E(l,h,w){var R=l.stateNode;{var O=Gr(h)||"Component",G=R.render;G||(h.prototype&&typeof h.prototype.render=="function"?A("%s(...): No `render` method found on the returned component instance: did you accidentally return an object from the constructor?",O):A("%s(...): No `render` method found on the returned component instance: you may have forgotten to define `render`.",O)),R.getInitialState&&!R.getInitialState.isReactClassApproved&&!R.state&&A("getInitialState was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Did you mean to define a state property instead?",O),R.getDefaultProps&&!R.getDefaultProps.isReactClassApproved&&A("getDefaultProps was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Use a static property to define defaultProps instead.",O),R.propTypes&&A("propTypes was defined as an instance property on %s. Use a static property to define propTypes instead.",O),R.contextType&&A("contextType was defined as an instance property on %s. Use a static property to define contextType instead.",O),h.childContextTypes&&!m_.has(h)&&(l.mode&ca)===Cn&&(m_.add(h),A(`%s uses the legacy childContextTypes API which is no longer supported and will be removed in the next major release. Use React.createContext() instead

.Learn more about this warning here: https://reactjs.org/link/legacy-context`,O)),h.contextTypes&&!m_.has(h)&&(l.mode&ca)===Cn&&(m_.add(h),A(`%s uses the legacy contextTypes API which is no longer supported and will be removed in the next major release. Use React.createContext() with static contextType instead.

Learn more about this warning here: https://reactjs.org/link/legacy-context`,O)),R.contextTypes&&A("contextTypes was defined as an instance property on %s. Use a static property to define contextTypes instead.",O),h.contextType&&h.contextTypes&&!K0.has(h)&&(K0.add(h),A("%s declares both contextTypes and contextType static properties. The legacy contextTypes property will be ignored.",O)),typeof R.componentShouldUpdate=="function"&&A("%s has a method called componentShouldUpdate(). Did you mean shouldComponentUpdate()? The name is phrased as a question because the function is expected to return a value.",O),h.prototype&&h.prototype.isPureReactComponent&&typeof R.shouldComponentUpdate<"u"&&A("%s has a method called shouldComponentUpdate(). shouldComponentUpdate should not be used when extending React.PureComponent. Please extend React.Component if shouldComponentUpdate is used.",Gr(h)||"A pure component"),typeof R.componentDidUnmount=="function"&&A("%s has a method called componentDidUnmount(). But there is no such lifecycle method. Did you mean componentWillUnmount()?",O),typeof R.componentDidReceiveProps=="function"&&A("%s has a method called componentDidReceiveProps(). But there is no such lifecycle method. If you meant to update the state in response to changing props, use componentWillReceiveProps(). If you meant to fetch data or run side-effects or mutations after React has updated the UI, use componentDidUpdate().",O),typeof R.componentWillRecieveProps=="function"&&A("%s has a method called componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",O),typeof R.UNSAFE_componentWillRecieveProps=="function"&&A("%s has a method called UNSAFE_componentWillRecieveProps(). Did you mean UNSAFE_componentWillReceiveProps()?",O);var K=R.props!==w;R.props!==void 0&&K&&A("%s(...): When calling super() in `%s`, make sure to pass up the same props that your component's constructor was passed.",O,O),R.defaultProps&&A("Setting defaultProps as an instance property on %s is not supported and will be ignored. Instead, define defaultProps as a static property on %s.",O,O),typeof R.getSnapshotBeforeUpdate=="function"&&typeof R.componentDidUpdate!="function"&&!q0.has(h)&&(q0.add(h),A("%s: getSnapshotBeforeUpdate() should be used with componentDidUpdate(). This component defines getSnapshotBeforeUpdate() only.",Gr(h))),typeof R.getDerivedStateFromProps=="function"&&A("%s: getDerivedStateFromProps() is defined as an instance method and will be ignored. Instead, declare it as a static method.",O),typeof R.getDerivedStateFromError=="function"&&A("%s: getDerivedStateFromError() is defined as an instance method and will be ignored. Instead, declare it as a static method.",O),typeof h.getSnapshotBeforeUpdate=="function"&&A("%s: getSnapshotBeforeUpdate() is defined as a static method and will be ignored. Instead, declare it as an instance method.",O);var ae=R.state;ae&&(typeof ae!="object"||Er(ae))&&A("%s.state: must be set to an object or null",O),typeof R.getChildContext=="function"&&typeof h.childContextTypes!="object"&&A("%s.getChildContext(): childContextTypes must be defined in order to use getChildContext().",O)}}function vw(l,h){h.updater=Sv,l.stateNode=h,cx(h,l),h._reactInternalInstance=wv}function xw(l,h,w){var R=!1,O=al,G=al,K=h.contextType;if("contextType"in h){var ae=K===null||K!==void 0&&K.$$typeof===ie&&K._context===void 0;if(!ae&&!Zf.has(h)){Zf.add(h);var pe="";K===void 0?pe=" However, it is set to undefined. This can be caused by a typo or by mixing up named and default imports. This can also happen due to a circular dependency, so try moving the createContext() call to a separate file.":typeof K!="object"?pe=" However, it is set to a "+typeof K+".":K.$$typeof===bi?pe=" Did you accidentally pass the Context.Provider instead?":K._context!==void 0?pe=" Did you accidentally pass the Context.Consumer instead?":pe=" However, it is set to an object with keys {"+Object.keys(K).join(", ")+"}.",A("%s defines an invalid contextType. contextType should point to the Context object returned by React.createContext().%s",Gr(h)||"Component",pe)}}if(typeof K=="object"&&K!==null)G=za(K);else{O=kd(l,h,!0);var Oe=h.contextTypes;R=Oe!=null,G=R?Uh(l,O):al}var Ve=new h(w,G);if(l.mode&ca){Ho(!0);try{Ve=new h(w,G)}finally{Ho(!1)}}var gt=l.memoizedState=Ve.state!==null&&Ve.state!==void 0?Ve.state:null;vw(l,Ve);{if(typeof h.getDerivedStateFromProps=="function"&&gt===null){var pt=Gr(h)||"Component";W0.has(pt)||(W0.add(pt),A("`%s` uses `getDerivedStateFromProps` but its initial state is %s. This is not recommended. Instead, define the initial state by assigning an object to `this.state` in the constructor of `%s`. This ensures that `getDerivedStateFromProps` arguments have a consistent shape.",pt,Ve.state===null?"null":"undefined",pt))}if(typeof h.getDerivedStateFromProps=="function"||typeof Ve.getSnapshotBeforeUpdate=="function"){var Ht=null,$t=null,oi=null;if(typeof Ve.componentWillMount=="function"&&Ve.componentWillMount.__suppressDeprecationWarning!==!0?Ht="componentWillMount":typeof Ve.UNSAFE_componentWillMount=="function"&&(Ht="UNSAFE_componentWillMount"),typeof Ve.componentWillReceiveProps=="function"&&Ve.componentWillReceiveProps.__suppressDeprecationWarning!==!0?$t="componentWillReceiveProps":typeof Ve.UNSAFE_componentWillReceiveProps=="function"&&($t="UNSAFE_componentWillReceiveProps"),typeof Ve.componentWillUpdate=="function"&&Ve.componentWillUpdate.__suppressDeprecationWarning!==!0?oi="componentWillUpdate":typeof Ve.UNSAFE_componentWillUpdate=="function"&&(oi="UNSAFE_componentWillUpdate"),Ht!==null||$t!==null||oi!==null){var Ji=Gr(h)||"Component",Vn=typeof h.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";Z0.has(Ji)||(Z0.add(Ji),A(`Unsafe legacy lifecycles will not be called for components using new component APIs.

%s uses %s but also contains the following legacy lifecycles:%s%s%s

The above lifecycles should be removed. Learn more about this warning here:
https://reactjs.org/link/unsafe-component-lifecycles`,Ji,Vn,Ht!==null?`
  `+Ht:"",$t!==null?`
  `+$t:"",oi!==null?`
  `+oi:""))}}}return R&&C1(l,O,G),Ve}function yE(l,h){var w=h.state;typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount(),w!==h.state&&(A("%s.componentWillMount(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",yn(l)||"Component"),Sv.enqueueReplaceState(h,h.state,null))}function bw(l,h,w,R){var O=h.state;if(typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(w,R),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(w,R),h.state!==O){{var G=yn(l)||"Component";$0.has(G)||($0.add(G),A("%s.componentWillReceiveProps(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",G))}Sv.enqueueReplaceState(h,h.state,null)}}function J0(l,h,w,R){_E(l,h,w);var O=l.stateNode;O.props=w,O.state=l.memoizedState,O.refs={},x0(l);var G=h.contextType;if(typeof G=="object"&&G!==null)O.context=za(G);else{var K=kd(l,h,!0);O.context=Uh(l,K)}{if(O.state===w){var ae=Gr(h)||"Component";Y0.has(ae)||(Y0.add(ae),A("%s: It is not recommended to assign props directly to state because updates to props won't be reflected in state. In most cases, it is better to use props directly.",ae))}l.mode&ca&&Yu.recordLegacyContextWarning(l,O),Yu.recordUnsafeLifecycleWarnings(l,O)}O.state=l.memoizedState;var pe=h.getDerivedStateFromProps;if(typeof pe=="function"&&(g_(l,h,pe,w),O.state=l.memoizedState),typeof h.getDerivedStateFromProps!="function"&&typeof O.getSnapshotBeforeUpdate!="function"&&(typeof O.UNSAFE_componentWillMount=="function"||typeof O.componentWillMount=="function")&&(yE(l,O),w0(l,w,O,R),O.state=l.memoizedState),typeof O.componentDidMount=="function"){var Oe=no;Oe|=Ou,(l.mode&Ul)!==Cn&&(Oe|=Vl),l.flags|=Oe}}function Xf(l,h,w,R){var O=l.stateNode,G=l.memoizedProps;O.props=G;var K=O.context,ae=h.contextType,pe=al;if(typeof ae=="object"&&ae!==null)pe=za(ae);else{var Oe=kd(l,h,!0);pe=Uh(l,Oe)}var Ve=h.getDerivedStateFromProps,gt=typeof Ve=="function"||typeof O.getSnapshotBeforeUpdate=="function";!gt&&(typeof O.UNSAFE_componentWillReceiveProps=="function"||typeof O.componentWillReceiveProps=="function")&&(G!==w||K!==pe)&&bw(l,O,w,pe),X1();var pt=l.memoizedState,Ht=O.state=pt;if(w0(l,w,O,R),Ht=l.memoizedState,G===w&&pt===Ht&&!Xx()&&!iv()){if(typeof O.componentDidMount=="function"){var $t=no;$t|=Ou,(l.mode&Ul)!==Cn&&($t|=Vl),l.flags|=$t}return!1}typeof Ve=="function"&&(g_(l,h,Ve,w),Ht=l.memoizedState);var oi=iv()||yw(l,h,G,w,pt,Ht,pe);if(oi){if(!gt&&(typeof O.UNSAFE_componentWillMount=="function"||typeof O.componentWillMount=="function")&&(typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount()),typeof O.componentDidMount=="function"){var Ji=no;Ji|=Ou,(l.mode&Ul)!==Cn&&(Ji|=Vl),l.flags|=Ji}}else{if(typeof O.componentDidMount=="function"){var Vn=no;Vn|=Ou,(l.mode&Ul)!==Cn&&(Vn|=Vl),l.flags|=Vn}l.memoizedProps=w,l.memoizedState=Ht}return O.props=w,O.state=Ht,O.context=pe,oi}function ZC(l,h,w,R,O){var G=h.stateNode;ou(l,h);var K=h.memoizedProps,ae=h.type===h.elementType?K:nh(h.type,K);G.props=ae;var pe=h.pendingProps,Oe=G.context,Ve=w.contextType,gt=al;if(typeof Ve=="object"&&Ve!==null)gt=za(Ve);else{var pt=kd(h,w,!0);gt=Uh(h,pt)}var Ht=w.getDerivedStateFromProps,$t=typeof Ht=="function"||typeof G.getSnapshotBeforeUpdate=="function";!$t&&(typeof G.UNSAFE_componentWillReceiveProps=="function"||typeof G.componentWillReceiveProps=="function")&&(K!==pe||Oe!==gt)&&bw(h,G,R,gt),X1();var oi=h.memoizedState,Ji=G.state=oi;if(w0(h,R,G,O),Ji=h.memoizedState,K===pe&&oi===Ji&&!Xx()&&!iv()&&!rn)return typeof G.componentDidUpdate=="function"&&(K!==l.memoizedProps||oi!==l.memoizedState)&&(h.flags|=no),typeof G.getSnapshotBeforeUpdate=="function"&&(K!==l.memoizedProps||oi!==l.memoizedState)&&(h.flags|=Bl),!1;typeof Ht=="function"&&(g_(h,w,Ht,R),Ji=h.memoizedState);var Vn=iv()||yw(h,w,ae,R,oi,Ji,gt)||rn;return Vn?(!$t&&(typeof G.UNSAFE_componentWillUpdate=="function"||typeof G.componentWillUpdate=="function")&&(typeof G.componentWillUpdate=="function"&&G.componentWillUpdate(R,Ji,gt),typeof G.UNSAFE_componentWillUpdate=="function"&&G.UNSAFE_componentWillUpdate(R,Ji,gt)),typeof G.componentDidUpdate=="function"&&(h.flags|=no),typeof G.getSnapshotBeforeUpdate=="function"&&(h.flags|=Bl)):(typeof G.componentDidUpdate=="function"&&(K!==l.memoizedProps||oi!==l.memoizedState)&&(h.flags|=no),typeof G.getSnapshotBeforeUpdate=="function"&&(K!==l.memoizedProps||oi!==l.memoizedState)&&(h.flags|=Bl),h.memoizedProps=R,h.memoizedState=Ji),G.props=R,G.state=Ji,G.context=gt,Vn}function Tm(l,h){return{value:l,source:h,stack:Ic(h),digest:null}}function ww(l,h,w){return{value:l,source:null,stack:w??null,digest:h??null}}function Q0(l,h){return!0}function Tw(l,h){try{var w=Q0(l,h);if(w===!1)return;var R=h.value,O=h.source,G=h.stack,K=G!==null?G:"";if(R!=null&&R._suppressLogging){if(l.tag===N)return;console.error(R)}var ae=O?yn(O):null,pe=ae?"The above error occurred in the <"+ae+"> component:":"The above error occurred in one of your React components:",Oe;if(l.tag===X)Oe=`Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.`;else{var Ve=yn(l)||"Anonymous";Oe="React will try to recreate this component tree from scratch "+("using the error boundary you provided, "+Ve+".")}var gt=pe+`
`+K+`

`+(""+Oe);console.error(gt)}catch(pt){setTimeout(function(){throw pt})}}var XC=typeof WeakMap=="function"?WeakMap:Map;function vE(l,h,w){var R=th(xn,w);R.tag=Qy,R.payload={element:null};var O=h.value;return R.callback=function(){Qk(O),Tw(l,h)},R}function Sw(l,h,w){var R=th(xn,w);R.tag=Qy;var O=l.type.getDerivedStateFromError;if(typeof O=="function"){var G=h.value;R.payload=function(){return O(G)},R.callback=function(){VD(l),Tw(l,h)}}var K=l.stateNode;return K!==null&&typeof K.componentDidCatch=="function"&&(R.callback=function(){VD(l),Tw(l,h),typeof O!="function"&&Kk(this);var pe=h.value,Oe=h.stack;this.componentDidCatch(pe,{componentStack:Oe!==null?Oe:""}),typeof O!="function"&&(lr(l.lanes,Yn)||A("%s: Error boundaries should implement getDerivedStateFromError(). In that method, return a state update to display an error message or fallback UI.",yn(l)||"Unknown"))}),R}function xE(l,h,w){var R=l.pingCache,O;if(R===null?(R=l.pingCache=new XC,O=new Set,R.set(h,O)):(O=R.get(h),O===void 0&&(O=new Set,R.set(h,O))),!O.has(w)){O.add(w);var G=eF.bind(null,l,h,w);dc&&Gw(l,w),h.then(G,G)}}function YC(l,h,w,R){var O=l.updateQueue;if(O===null){var G=new Set;G.add(w),l.updateQueue=G}else O.add(w)}function KC(l,h){var w=l.tag;if((l.mode&Nn)===Cn&&(w===L||w===Ke||w===Ct)){var R=l.alternate;R?(l.updateQueue=R.updateQueue,l.memoizedState=R.memoizedState,l.lanes=R.lanes):(l.updateQueue=null,l.memoizedState=null)}}function bE(l){var h=l;do{if(h.tag===Ye&&Nd(h))return h;h=h.return}while(h!==null);return null}function wE(l,h,w,R,O){if((l.mode&Nn)===Cn){if(l===h)l.flags|=us;else{if(l.flags|=Xr,w.flags|=gd,w.flags&=-52805,w.tag===N){var G=w.alternate;if(G===null)w.tag=ui;else{var K=th(xn,Yn);K.tag=Bf,_c(w,K,Yn)}}w.lanes=_r(w.lanes,Yn)}return l}return l.flags|=us,l.lanes=O,l}function JC(l,h,w,R,O){if(w.flags|=Ts,dc&&Gw(l,O),R!==null&&typeof R=="object"&&typeof R.then=="function"){var G=R;KC(w),Ds()&&w.mode&Nn&&r0();var K=bE(h);if(K!==null){K.flags&=~Nl,wE(K,h,w,l,O),K.mode&Nn&&xE(l,G,O),YC(K,l,G);return}else{if(!yg(O)){xE(l,G,O),yI();return}var ae=new Error("A component suspended while responding to synchronous input. This will cause the UI to be replaced with a loading indicator. To fix, updates that suspend should be wrapped with startTransition.");R=ae}}else if(Ds()&&w.mode&Nn){r0();var pe=bE(h);if(pe!==null){(pe.flags&us)===On&&(pe.flags|=Nl),wE(pe,h,w,l,O),B1(Tm(R,w));return}}R=Tm(R,w),Gk(R);var Oe=h;do{switch(Oe.tag){case X:{var Ve=R;Oe.flags|=us;var gt=Dh(O);Oe.lanes=_r(Oe.lanes,gt);var pt=vE(Oe,Ve,gt);b0(Oe,pt);return}case N:var Ht=R,$t=Oe.type,oi=Oe.stateNode;if((Oe.flags&Xr)===On&&(typeof $t.getDerivedStateFromError=="function"||oi!==null&&typeof oi.componentDidCatch=="function"&&!MD(oi))){Oe.flags|=us;var Ji=Dh(O);Oe.lanes=_r(Oe.lanes,Ji);var Vn=Sw(Oe,Ht,Ji);b0(Oe,Vn);return}break}Oe=Oe.return}while(Oe!==null)}function QC(){return null}var Hs=u.ReactCurrentOwner,Rl=!1,Ew,__,eb,Aw,tb,Yf,ib,nb,Ev;Ew={},__={},eb={},Aw={},tb={},Yf=!1,ib={},nb={},Ev={};function hl(l,h,w,R){l===null?h.child=h0(h,null,w,R):h.child=Ku(h,l.child,w,R)}function da(l,h,w,R){h.child=Ku(h,l.child,null,R),h.child=Ku(h,null,w,R)}function Sm(l,h,w,R,O){if(h.type!==h.elementType){var G=w.propTypes;G&&Qc(G,R,"prop",Gr(w))}var K=w.render,ae=h.ref,pe,Oe;Qu(h,O),Th(h);{if(Hs.current=h,_l(!0),pe=Wh(l,h,K,R,ae,O),Oe=qh(),h.mode&ca){Ho(!0);try{pe=Wh(l,h,K,R,ae,O),Oe=qh()}finally{Ho(!1)}}_l(!1)}return $c(),l!==null&&!Rl?(uv(l,h,O),le(l,h,O)):(Ds()&&Oe&&i0(h),h.flags|=uc,hl(l,h,pe,O),h.child)}function y_(l,h,w,R,O){if(l===null){var G=w.type;if(_F(G)&&w.compare===null&&w.defaultProps===void 0){var K=G;return K=fb(G),h.tag=Ct,h.type=K,x_(h,G),v_(l,h,K,R,O)}{var ae=G.propTypes;if(ae&&Qc(ae,R,"prop",Gr(G)),w.defaultProps!==void 0){var pe=Gr(G)||"Unknown";Ev[pe]||(A("%s: Support for defaultProps will be removed from memo components in a future major release. Use JavaScript default parameters instead.",pe),Ev[pe]=!0)}}var Oe=RI(w.type,null,R,h,h.mode,O);return Oe.ref=h.ref,Oe.return=h,h.child=Oe,Oe}{var Ve=w.type,gt=Ve.propTypes;gt&&Qc(gt,R,"prop",Gr(Ve))}var pt=l.child,Ht=Ie(l,O);if(!Ht){var $t=pt.memoizedProps,oi=w.compare;if(oi=oi!==null?oi:Id,oi($t,R)&&l.ref===h.ref)return le(l,h,O)}h.flags|=uc;var Ji=Ov(pt,R);return Ji.ref=h.ref,Ji.return=h,h.child=Ji,Ji}function v_(l,h,w,R,O){if(h.type!==h.elementType){var G=h.elementType;if(G.$$typeof===ye){var K=G,ae=K._payload,pe=K._init;try{G=pe(ae)}catch{G=null}var Oe=G&&G.propTypes;Oe&&Qc(Oe,R,"prop",Gr(G))}}if(l!==null){var Ve=l.memoizedProps;if(Id(Ve,R)&&l.ref===h.ref&&h.type===l.type)if(Rl=!1,h.pendingProps=R=Ve,Ie(l,O))(l.flags&gd)!==On&&(Rl=!0);else return h.lanes=l.lanes,le(l,h,O)}return Av(l,h,w,R,O)}function Cw(l,h,w){var R=h.pendingProps,O=R.children,G=l!==null?l.memoizedState:null;if(R.mode==="hidden"||zn)if((h.mode&Nn)===Cn){var K={baseLanes:yi,cachePool:null,transitions:null};h.memoizedState=K,jE(h,w)}else if(lr(w,wl)){var gt={baseLanes:yi,cachePool:null,transitions:null};h.memoizedState=gt;var pt=G!==null?G.baseLanes:w;jE(h,pt)}else{var ae=null,pe;if(G!==null){var Oe=G.baseLanes;pe=_r(Oe,w)}else pe=w;h.lanes=h.childLanes=wl;var Ve={baseLanes:pe,cachePool:ae,transitions:null};return h.memoizedState=Ve,h.updateQueue=null,jE(h,pe),null}else{var Ht;G!==null?(Ht=_r(G.baseLanes,w),h.memoizedState=null):Ht=w,jE(h,Ht)}return hl(l,h,O,w),h.child}function eI(l,h,w){var R=h.pendingProps;return hl(l,h,R,w),h.child}function tI(l,h,w){var R=h.pendingProps.children;return hl(l,h,R,w),h.child}function Iw(l,h,w){{h.flags|=no;{var R=h.stateNode;R.effectDuration=0,R.passiveEffectDuration=0}}var O=h.pendingProps,G=O.children;return hl(l,h,G,w),h.child}function uu(l,h){var w=h.ref;(l===null&&w!==null||l!==null&&l.ref!==w)&&(h.flags|=Bc,h.flags|=Rp)}function Av(l,h,w,R,O){if(h.type!==h.elementType){var G=w.propTypes;G&&Qc(G,R,"prop",Gr(w))}var K;{var ae=kd(h,w,!0);K=Uh(h,ae)}var pe,Oe;Qu(h,O),Th(h);{if(Hs.current=h,_l(!0),pe=Wh(l,h,w,R,K,O),Oe=qh(),h.mode&ca){Ho(!0);try{pe=Wh(l,h,w,R,K,O),Oe=qh()}finally{Ho(!1)}}_l(!1)}return $c(),l!==null&&!Rl?(uv(l,h,O),le(l,h,O)):(Ds()&&Oe&&i0(h),h.flags|=uc,hl(l,h,pe,O),h.child)}function TE(l,h,w,R,O){{switch(PF(h)){case!1:{var G=h.stateNode,K=h.type,ae=new K(h.memoizedProps,G.context),pe=ae.state;G.updater.enqueueSetState(G,pe,null);break}case!0:{h.flags|=Xr,h.flags|=us;var Oe=new Error("Simulated error coming from DevTools"),Ve=Dh(O);h.lanes=_r(h.lanes,Ve);var gt=Sw(h,Tm(Oe,h),Ve);b0(h,gt);break}}if(h.type!==h.elementType){var pt=w.propTypes;pt&&Qc(pt,R,"prop",Gr(w))}}var Ht;eu(w)?(Ht=!0,Kx(h)):Ht=!1,Qu(h,O);var $t=h.stateNode,oi;$t===null?(oe(l,h),xw(h,w,R),J0(h,w,R,O),oi=!0):l===null?oi=Xf(h,w,R,O):oi=ZC(l,h,w,R,O);var Ji=vc(l,h,w,oi,Ht,O);{var Vn=h.stateNode;oi&&Vn.props!==R&&(Yf||A("It looks like %s is reassigning its own `this.props` while rendering. This is not supported and can lead to confusing bugs.",yn(h)||"a component"),Yf=!0)}return Ji}function vc(l,h,w,R,O,G){uu(l,h);var K=(h.flags&Xr)!==On;if(!R&&!K)return O&&I1(h,w,!1),le(l,h,G);var ae=h.stateNode;Hs.current=h;var pe;if(K&&typeof w.getDerivedStateFromError!="function")pe=null,gE();else{Th(h);{if(_l(!0),pe=ae.render(),h.mode&ca){Ho(!0);try{ae.render()}finally{Ho(!1)}}_l(!1)}$c()}return h.flags|=uc,l!==null&&K?da(l,h,pe,G):hl(l,h,pe,G),h.memoizedState=ae.state,O&&I1(h,w,!0),h.child}function SE(l){var h=l.stateNode;h.pendingContext?Pf(l,h.pendingContext,h.pendingContext!==h.context):h.context&&Pf(l,h.context,!1),ov(l,h.containerInfo)}function iI(l,h,w){if(SE(h),l===null)throw new Error("Should have a current fiber. This is a bug in React.");var R=h.pendingProps,O=h.memoizedState,G=O.element;ou(l,h),w0(h,R,null,w);var K=h.memoizedState;h.stateNode;var ae=K.element;if(O.isDehydrated){var pe={element:ae,isDehydrated:!1,cache:K.cache,pendingSuspenseBoundaries:K.pendingSuspenseBoundaries,transitions:K.transitions},Oe=h.updateQueue;if(Oe.baseState=pe,h.memoizedState=pe,h.flags&Nl){var Ve=Tm(new Error("There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering."),h);return EE(l,h,ae,w,Ve)}else if(ae!==G){var gt=Tm(new Error("This root received an early update, before anything was able hydrate. Switched the entire root to client rendering."),h);return EE(l,h,ae,w,gt)}else{WS(h);var pt=h0(h,null,ae,w);h.child=pt;for(var Ht=pt;Ht;)Ht.flags=Ht.flags&~la|Uc,Ht=Ht.sibling}}else{if(Xg(),ae===G)return le(l,h,w);hl(l,h,ae,w)}return h.child}function EE(l,h,w,R,O){return Xg(),B1(O),h.flags|=Nl,hl(l,h,w,R),h.child}function hu(l,h,w){Y1(h),l===null&&N1(h);var R=h.type,O=h.pendingProps,G=l!==null?l.memoizedProps:null,K=O.children,ae=Lx(R,O);return ae?K=null:G!==null&&Lx(R,G)&&(h.flags|=Ip),uu(l,h),hl(l,h,K,w),h.child}function nI(l,h){return l===null&&N1(h),null}function AE(l,h,w,R){oe(l,h);var O=h.pendingProps,G=w,K=G._payload,ae=G._init,pe=ae(K);h.type=pe;var Oe=h.tag=yF(pe),Ve=nh(pe,O),gt;switch(Oe){case L:return x_(h,pe),h.type=pe=fb(pe),gt=Av(null,h,pe,Ve,R),gt;case N:return h.type=pe=TI(pe),gt=TE(null,h,pe,Ve,R),gt;case Ke:return h.type=pe=SI(pe),gt=Sm(null,h,pe,Ve,R),gt;case mt:{if(h.type!==h.elementType){var pt=pe.propTypes;pt&&Qc(pt,Ve,"prop",Gr(pe))}return gt=y_(null,h,pe,nh(pe.type,Ve),R),gt}}var Ht="";throw pe!==null&&typeof pe=="object"&&pe.$$typeof===ye&&(Ht=" Did you wrap a component in React.lazy() more than once?"),new Error("Element type is invalid. Received a promise that resolves to: "+pe+". "+("Lazy element type must resolve to a class or function."+Ht))}function rI(l,h,w,R,O){oe(l,h),h.tag=N;var G;return eu(w)?(G=!0,Kx(h)):G=!1,Qu(h,O),xw(h,w,R),J0(h,w,R,O),vc(null,h,w,!0,G,O)}function Rw(l,h,w,R){oe(l,h);var O=h.pendingProps,G;{var K=kd(h,w,!1);G=Uh(h,K)}Qu(h,R);var ae,pe;Th(h);{if(w.prototype&&typeof w.prototype.render=="function"){var Oe=Gr(w)||"Unknown";Ew[Oe]||(A("The <%s /> component appears to have a render method, but doesn't extend React.Component. This is likely to cause errors. Change %s to extend React.Component instead.",Oe,Oe),Ew[Oe]=!0)}h.mode&ca&&Yu.recordLegacyContextWarning(h,null),_l(!0),Hs.current=h,ae=Wh(null,h,w,O,G,R),pe=qh(),_l(!1)}if($c(),h.flags|=uc,typeof ae=="object"&&ae!==null&&typeof ae.render=="function"&&ae.$$typeof===void 0){var Ve=Gr(w)||"Unknown";__[Ve]||(A("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",Ve,Ve,Ve),__[Ve]=!0)}if(typeof ae=="object"&&ae!==null&&typeof ae.render=="function"&&ae.$$typeof===void 0){{var gt=Gr(w)||"Unknown";__[gt]||(A("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",gt,gt,gt),__[gt]=!0)}h.tag=N,h.memoizedState=null,h.updateQueue=null;var pt=!1;return eu(w)?(pt=!0,Kx(h)):pt=!1,h.memoizedState=ae.state!==null&&ae.state!==void 0?ae.state:null,x0(h),vw(h,ae),J0(h,w,O,R),vc(null,h,w,!0,pt,R)}else{if(h.tag=L,h.mode&ca){Ho(!0);try{ae=Wh(null,h,w,O,G,R),pe=qh()}finally{Ho(!1)}}return Ds()&&pe&&i0(h),hl(null,h,ae,R),x_(h,w),h.child}}function x_(l,h){{if(h&&h.childContextTypes&&A("%s(...): childContextTypes cannot be defined on a function component.",h.displayName||h.name||"Component"),l.ref!==null){var w="",R=nc();R&&(w+=`

Check the render method of \``+R+"`.");var O=R||"",G=l._debugSource;G&&(O=G.fileName+":"+G.lineNumber),tb[O]||(tb[O]=!0,A("Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?%s",w))}if(h.defaultProps!==void 0){var K=Gr(h)||"Unknown";Ev[K]||(A("%s: Support for defaultProps will be removed from function components in a future major release. Use JavaScript default parameters instead.",K),Ev[K]=!0)}if(typeof h.getDerivedStateFromProps=="function"){var ae=Gr(h)||"Unknown";Aw[ae]||(A("%s: Function components do not support getDerivedStateFromProps.",ae),Aw[ae]=!0)}if(typeof h.contextType=="object"&&h.contextType!==null){var pe=Gr(h)||"Unknown";eb[pe]||(A("%s: Function components do not support contextType.",pe),eb[pe]=!0)}}}var rb={dehydrated:null,treeContext:null,retryLane:ua};function ob(l){return{baseLanes:l,cachePool:QC(),transitions:null}}function CE(l,h){var w=null;return{baseLanes:_r(l.baseLanes,h),cachePool:w,transitions:l.transitions}}function IE(l,h,w,R){if(h!==null){var O=h.memoizedState;if(O===null)return!1}return Q1(l,av)}function RE(l,h){return yf(l.childLanes,h)}function DE(l,h,w){var R=h.pendingProps;OF(h)&&(h.flags|=Xr);var O=au.current,G=!1,K=(h.flags&Xr)!==On;if(K||IE(O,l)?(G=!0,h.flags&=~Xr):(l===null||l.memoizedState!==null)&&(O=VC(O,n_)),O=dm(O),jf(h,O),l===null){N1(h);var ae=h.memoizedState;if(ae!==null){var pe=ae.dehydrated;if(pe!==null)return e(h,pe)}var Oe=R.children,Ve=R.fallback;if(G){var gt=Dw(h,Oe,Ve,w),pt=h.child;return pt.memoizedState=ob(w),h.memoizedState=rb,gt}else return ab(h,Oe)}else{var Ht=l.memoizedState;if(Ht!==null){var $t=Ht.dehydrated;if($t!==null)return i(l,h,K,R,$t,Ht,w)}if(G){var oi=R.fallback,Ji=R.children,Vn=Pw(l,h,Ji,oi,w),An=h.child,lo=l.child.memoizedState;return An.memoizedState=lo===null?ob(w):CE(lo,w),An.childLanes=RE(l,w),h.memoizedState=rb,Vn}else{var Kr=R.children,Ot=Iv(l,h,Kr,w);return h.memoizedState=null,Ot}}}function ab(l,h,w){var R=l.mode,O={mode:"visible",children:h},G=Cv(O,R);return G.return=l,l.child=G,G}function Dw(l,h,w,R){var O=l.mode,G=l.child,K={mode:"hidden",children:h},ae,pe;return(O&Nn)===Cn&&G!==null?(ae=G,ae.childLanes=yi,ae.pendingProps=K,l.mode&Hr&&(ae.actualDuration=0,ae.actualStartTime=-1,ae.selfBaseDuration=0,ae.treeBaseDuration=0),pe=A_(w,O,R,null)):(ae=Cv(K,O),pe=A_(w,O,R,null)),ae.return=l,pe.return=l,ae.sibling=pe,l.child=ae,pe}function Cv(l,h,w){return jD(l,h,yi,null)}function Mw(l,h){return Ov(l,h)}function Iv(l,h,w,R){var O=l.child,G=O.sibling,K=Mw(O,{mode:"visible",children:w});if((h.mode&Nn)===Cn&&(K.lanes=R),K.return=h,K.sibling=null,G!==null){var ae=h.deletions;ae===null?(h.deletions=[G],h.flags|=_h):ae.push(G)}return h.child=K,K}function Pw(l,h,w,R,O){var G=h.mode,K=l.child,ae=K.sibling,pe={mode:"hidden",children:w},Oe;if((G&Nn)===Cn&&h.child!==K){var Ve=h.child;Oe=Ve,Oe.childLanes=yi,Oe.pendingProps=pe,h.mode&Hr&&(Oe.actualDuration=0,Oe.actualStartTime=-1,Oe.selfBaseDuration=K.selfBaseDuration,Oe.treeBaseDuration=K.treeBaseDuration),h.deletions=null}else Oe=Mw(K,pe),Oe.subtreeFlags=K.subtreeFlags&jc;var gt;return ae!==null?gt=Ov(ae,R):(gt=A_(R,G,O,null),gt.flags|=la),gt.return=h,Oe.return=h,Oe.sibling=gt,h.child=Oe,gt}function Rv(l,h,w,R){R!==null&&B1(R),Ku(h,l.child,null,w);var O=h.pendingProps,G=O.children,K=ab(h,G);return K.flags|=la,h.memoizedState=null,K}function n(l,h,w,R,O){var G=h.mode,K={mode:"visible",children:w},ae=Cv(K,G),pe=A_(R,G,O,null);return pe.flags|=la,ae.return=h,pe.return=h,ae.sibling=pe,h.child=ae,(h.mode&Nn)!==Cn&&Ku(h,l.child,null,O),pe}function e(l,h,w){return(l.mode&Nn)===Cn?(A("Cannot hydrate Suspense in legacy mode. Switch from ReactDOM.hydrate(element, container) to ReactDOMClient.hydrateRoot(container, <App />).render(element) or remove the Suspense components from the server rendered components."),l.lanes=Yn):w1(h)?l.lanes=Nu:l.lanes=wl,null}function i(l,h,w,R,O,G,K){if(w)if(h.flags&Nl){h.flags&=~Nl;var Ot=ww(new Error("There was an error while hydrating this Suspense boundary. Switched to client rendering."));return Rv(l,h,K,Ot)}else{if(h.memoizedState!==null)return h.child=l.child,h.flags|=Xr,null;var ai=R.children,kt=R.fallback,Ci=n(l,h,ai,kt,K),cn=h.child;return cn.memoizedState=ob(K),h.memoizedState=rb,Ci}else{if(O1(),(h.mode&Nn)===Cn)return Rv(l,h,K,null);if(w1(O)){var ae,pe,Oe;{var Ve=xC(O);ae=Ve.digest,pe=Ve.message,Oe=Ve.stack}var gt;pe?gt=new Error(pe):gt=new Error("The server could not finish this Suspense boundary, likely due to an error during server rendering. Switched to client rendering.");var pt=ww(gt,ae,Oe);return Rv(l,h,K,pt)}var Ht=lr(K,l.childLanes);if(Rl||Ht){var $t=UE();if($t!==null){var oi=uy($t,K);if(oi!==ua&&oi!==G.retryLane){G.retryLane=oi;var Ji=xn;Xl(l,oi),Xs($t,l,oi,Ji)}}yI();var Vn=ww(new Error("This Suspense boundary received an update before it finished hydrating. This caused the boundary to switch to client rendering. The usual way to fix this is to wrap the original update in startTransition."));return Rv(l,h,K,Vn)}else if(b1(O)){h.flags|=Xr,h.child=l.child;var An=tF.bind(null,l);return PS(O,An),null}else{qS(h,O,G.treeContext);var lo=R.children,Kr=ab(h,lo);return Kr.flags|=Uc,Kr}}}function a(l,h,w){l.lanes=_r(l.lanes,h);var R=l.alternate;R!==null&&(R.lanes=_r(R.lanes,h)),v0(l.return,h,w)}function c(l,h,w){for(var R=h;R!==null;){if(R.tag===Ye){var O=R.memoizedState;O!==null&&a(R,w,l)}else if(R.tag===si)a(R,w,l);else if(R.child!==null){R.child.return=R,R=R.child;continue}if(R===l)return;for(;R.sibling===null;){if(R.return===null||R.return===l)return;R=R.return}R.sibling.return=R.return,R=R.sibling}}function m(l){for(var h=l,w=null;h!==null;){var R=h.alternate;R!==null&&lv(R)===null&&(w=h),h=h.sibling}return w}function g(l){if(l!==void 0&&l!=="forwards"&&l!=="backwards"&&l!=="together"&&!ib[l])if(ib[l]=!0,typeof l=="string")switch(l.toLowerCase()){case"together":case"forwards":case"backwards":{A('"%s" is not a valid value for revealOrder on <SuspenseList />. Use lowercase "%s" instead.',l,l.toLowerCase());break}case"forward":case"backward":{A('"%s" is not a valid value for revealOrder on <SuspenseList />. React uses the -s suffix in the spelling. Use "%ss" instead.',l,l.toLowerCase());break}default:A('"%s" is not a supported revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',l);break}else A('%s is not a supported value for revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',l)}function x(l,h){l!==void 0&&!nb[l]&&(l!=="collapsed"&&l!=="hidden"?(nb[l]=!0,A('"%s" is not a supported value for tail on <SuspenseList />. Did you mean "collapsed" or "hidden"?',l)):h!=="forwards"&&h!=="backwards"&&(nb[l]=!0,A('<SuspenseList tail="%s" /> is only valid if revealOrder is "forwards" or "backwards". Did you mean to specify revealOrder="forwards"?',l)))}function S(l,h){{var w=Er(l),R=!w&&typeof xi(l)=="function";if(w||R){var O=w?"array":"iterable";return A("A nested %s was passed to row #%s in <SuspenseList />. Wrap it in an additional SuspenseList to configure its revealOrder: <SuspenseList revealOrder=...> ... <SuspenseList revealOrder=...>{%s}</SuspenseList> ... </SuspenseList>",O,h,O),!1}}return!0}function C(l,h){if((h==="forwards"||h==="backwards")&&l!==void 0&&l!==null&&l!==!1)if(Er(l)){for(var w=0;w<l.length;w++)if(!S(l[w],w))return}else{var R=xi(l);if(typeof R=="function"){var O=R.call(l);if(O)for(var G=O.next(),K=0;!G.done;G=O.next()){if(!S(G.value,K))return;K++}}else A('A single row was passed to a <SuspenseList revealOrder="%s" />. This is not useful since it needs multiple rows. Did you mean to pass multiple children or an array?',h)}}function M(l,h,w,R,O){var G=l.memoizedState;G===null?l.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:R,tail:w,tailMode:O}:(G.isBackwards=h,G.rendering=null,G.renderingStartTime=0,G.last=R,G.tail=w,G.tailMode=O)}function P(l,h,w){var R=h.pendingProps,O=R.revealOrder,G=R.tail,K=R.children;g(O),x(G,O),C(K,O),hl(l,h,K,w);var ae=au.current,pe=Q1(ae,av);if(pe)ae=sv(ae,av),h.flags|=Xr;else{var Oe=l!==null&&(l.flags&Xr)!==On;Oe&&c(h,h.child,w),ae=dm(ae)}if(jf(h,ae),(h.mode&Nn)===Cn)h.memoizedState=null;else switch(O){case"forwards":{var Ve=m(h.child),gt;Ve===null?(gt=h.child,h.child=null):(gt=Ve.sibling,Ve.sibling=null),M(h,!1,gt,Ve,G);break}case"backwards":{var pt=null,Ht=h.child;for(h.child=null;Ht!==null;){var $t=Ht.alternate;if($t!==null&&lv($t)===null){h.child=Ht;break}var oi=Ht.sibling;Ht.sibling=pt,pt=Ht,Ht=oi}M(h,!0,pt,null,G);break}case"together":{M(h,!1,null,null,void 0);break}default:h.memoizedState=null}return h.child}function k(l,h,w){ov(h,h.stateNode.containerInfo);var R=h.pendingProps;return l===null?h.child=Ku(h,null,R,w):hl(l,h,R,w),h.child}var V=!1;function U(l,h,w){var R=h.type,O=R._context,G=h.pendingProps,K=h.memoizedProps,ae=G.value;{"value"in G||V||(V=!0,A("The `value` prop is required for the `<Context.Provider>`. Did you misspell it or forget to pass it?"));var pe=h.type.propTypes;pe&&Qc(pe,G,"prop","Context.Provider")}if(_0(h,O,ae),K!==null){var Oe=K.value;if(Cl(Oe,ae)){if(K.children===G.children&&!Xx())return le(l,h,w)}else QS(h,O,w)}var Ve=G.children;return hl(l,h,Ve,w),h.child}var q=!1;function J(l,h,w){var R=h.type;R._context===void 0?R!==R.Consumer&&(q||(q=!0,A("Rendering <Context> directly is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?"))):R=R._context;var O=h.pendingProps,G=O.children;typeof G!="function"&&A("A context consumer was rendered with multiple children, or a child that isn't a function. A context consumer expects a single child that is a function. If you did pass a function, make sure there is no trailing or leading whitespace around it."),Qu(h,w);var K=za(R);Th(h);var ae;return Hs.current=h,_l(!0),ae=G(K),_l(!1),$c(),h.flags|=uc,hl(l,h,ae,w),h.child}function ee(){Rl=!0}function oe(l,h){(h.mode&Nn)===Cn&&l!==null&&(l.alternate=null,h.alternate=null,h.flags|=la)}function le(l,h,w){return l!==null&&(h.dependencies=l.dependencies),gE(),jw(h.lanes),lr(w,h.childLanes)?(d0(l,h),h.child):null}function fe(l,h,w){{var R=h.return;if(R===null)throw new Error("Cannot swap the root fiber.");if(l.alternate=null,h.alternate=null,w.index=h.index,w.sibling=h.sibling,w.return=h.return,w.ref=h.ref,h===R.child)R.child=w;else{var O=R.child;if(O===null)throw new Error("Expected parent to have a child.");for(;O.sibling!==h;)if(O=O.sibling,O===null)throw new Error("Expected to find the previous sibling.");O.sibling=w}var G=R.deletions;return G===null?(R.deletions=[l],R.flags|=_h):G.push(l),w.flags|=la,w}}function Ie(l,h){var w=l.lanes;return!!lr(w,h)}function Se(l,h,w){switch(h.tag){case X:SE(h),h.stateNode,Xg();break;case he:Y1(h);break;case N:{var R=h.type;eu(R)&&Kx(h);break}case re:ov(h,h.stateNode.containerInfo);break;case Le:{var O=h.memoizedProps.value,G=h.type._context;_0(h,G,O);break}case Ge:{var K=lr(w,h.childLanes);K&&(h.flags|=no);{var ae=h.stateNode;ae.effectDuration=0,ae.passiveEffectDuration=0}}break;case Ye:{var pe=h.memoizedState;if(pe!==null){if(pe.dehydrated!==null)return jf(h,dm(au.current)),h.flags|=Xr,null;var Oe=h.child,Ve=Oe.childLanes;if(lr(w,Ve))return DE(l,h,w);jf(h,dm(au.current));var gt=le(l,h,w);return gt!==null?gt.sibling:null}else jf(h,dm(au.current));break}case si:{var pt=(l.flags&Xr)!==On,Ht=lr(w,h.childLanes);if(pt){if(Ht)return P(l,h,w);h.flags|=Xr}var $t=h.memoizedState;if($t!==null&&($t.rendering=null,$t.tail=null,$t.lastEffect=null),jf(h,au.current),Ht)break;return null}case Nt:case Ii:return h.lanes=yi,Cw(l,h,w)}return le(l,h,w)}function Pe(l,h,w){if(h._debugNeedsRemount&&l!==null)return fe(l,h,RI(h.type,h.key,h.pendingProps,h._debugOwner||null,h.mode,h.lanes));if(l!==null){var R=l.memoizedProps,O=h.pendingProps;if(R!==O||Xx()||h.type!==l.type)Rl=!0;else{var G=Ie(l,w);if(!G&&(h.flags&Xr)===On)return Rl=!1,Se(l,h,w);(l.flags&gd)!==On?Rl=!0:Rl=!1}}else if(Rl=!1,Ds()&&GS(h)){var K=h.index,ae=D1();M1(h,ae,K)}switch(h.lanes=yi,h.tag){case H:return Rw(l,h,h.type,w);case Vt:{var pe=h.elementType;return AE(l,h,pe,w)}case L:{var Oe=h.type,Ve=h.pendingProps,gt=h.elementType===Oe?Ve:nh(Oe,Ve);return Av(l,h,Oe,gt,w)}case N:{var pt=h.type,Ht=h.pendingProps,$t=h.elementType===pt?Ht:nh(pt,Ht);return TE(l,h,pt,$t,w)}case X:return iI(l,h,w);case he:return hu(l,h,w);case de:return nI(l,h);case Ye:return DE(l,h,w);case re:return k(l,h,w);case Ke:{var oi=h.type,Ji=h.pendingProps,Vn=h.elementType===oi?Ji:nh(oi,Ji);return Sm(l,h,oi,Vn,w)}case ve:return eI(l,h,w);case xe:return tI(l,h,w);case Ge:return Iw(l,h,w);case Le:return U(l,h,w);case $e:return J(l,h,w);case mt:{var An=h.type,lo=h.pendingProps,Kr=nh(An,lo);if(h.type!==h.elementType){var Ot=An.propTypes;Ot&&Qc(Ot,Kr,"prop",Gr(An))}return Kr=nh(An.type,Kr),y_(l,h,An,Kr,w)}case Ct:return v_(l,h,h.type,h.pendingProps,w);case ui:{var ai=h.type,kt=h.pendingProps,Ci=h.elementType===ai?kt:nh(ai,kt);return rI(l,h,ai,Ci,w)}case si:return P(l,h,w);case di:break;case Nt:return Cw(l,h,w)}throw new Error("Unknown unit of work tag ("+h.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function ke(l){l.flags|=no}function Be(l){l.flags|=Bc,l.flags|=Rp}var ot,Ze,st,dt;ot=function(l,h,w,R){for(var O=h.child;O!==null;){if(O.tag===he||O.tag===de)zy(l,O.stateNode);else if(O.tag!==re){if(O.child!==null){O.child.return=O,O=O.child;continue}}if(O===h)return;for(;O.sibling===null;){if(O.return===null||O.return===h)return;O=O.return}O.sibling.return=O.return,O=O.sibling}},Ze=function(l,h){},st=function(l,h,w,R,O){var G=l.memoizedProps;if(G!==R){var K=h.stateNode,ae=i_(),pe=_S(K,w,G,R,O,ae);h.updateQueue=pe,pe&&ke(h)}},dt=function(l,h,w,R){w!==R&&ke(h)};function wt(l,h){if(!Ds())switch(l.tailMode){case"hidden":{for(var w=l.tail,R=null;w!==null;)w.alternate!==null&&(R=w),w=w.sibling;R===null?l.tail=null:R.sibling=null;break}case"collapsed":{for(var O=l.tail,G=null;O!==null;)O.alternate!==null&&(G=O),O=O.sibling;G===null?!h&&l.tail!==null?l.tail.sibling=null:l.tail=null:G.sibling=null;break}}}function Rt(l){var h=l.alternate!==null&&l.alternate.child===l.child,w=yi,R=On;if(h){if((l.mode&Hr)!==Cn){for(var pe=l.selfBaseDuration,Oe=l.child;Oe!==null;)w=_r(w,_r(Oe.lanes,Oe.childLanes)),R|=Oe.subtreeFlags&jc,R|=Oe.flags&jc,pe+=Oe.treeBaseDuration,Oe=Oe.sibling;l.treeBaseDuration=pe}else for(var Ve=l.child;Ve!==null;)w=_r(w,_r(Ve.lanes,Ve.childLanes)),R|=Ve.subtreeFlags&jc,R|=Ve.flags&jc,Ve.return=l,Ve=Ve.sibling;l.subtreeFlags|=R}else{if((l.mode&Hr)!==Cn){for(var O=l.actualDuration,G=l.selfBaseDuration,K=l.child;K!==null;)w=_r(w,_r(K.lanes,K.childLanes)),R|=K.subtreeFlags,R|=K.flags,O+=K.actualDuration,G+=K.treeBaseDuration,K=K.sibling;l.actualDuration=O,l.treeBaseDuration=G}else for(var ae=l.child;ae!==null;)w=_r(w,_r(ae.lanes,ae.childLanes)),R|=ae.subtreeFlags,R|=ae.flags,ae.return=l,ae=ae.sibling;l.subtreeFlags|=R}return l.childLanes=w,h}function Mt(l,h,w){if(kC()&&(h.mode&Nn)!==Cn&&(h.flags&Xr)===On)return YS(h),Xg(),h.flags|=Nl|Ts|us,!1;var R=s0(h);if(w!==null&&w.dehydrated!==null)if(l===null){if(!R)throw new Error("A dehydrated suspense component was completed without a hydrated node. This is probably a bug in React.");if(PC(h),Rt(h),(h.mode&Hr)!==Cn){var O=w!==null;if(O){var G=h.child;G!==null&&(h.treeBaseDuration-=G.treeBaseDuration)}}return!1}else{if(Xg(),(h.flags&Xr)===On&&(h.memoizedState=null),h.flags|=no,Rt(h),(h.mode&Hr)!==Cn){var K=w!==null;if(K){var ae=h.child;ae!==null&&(h.treeBaseDuration-=ae.treeBaseDuration)}}return!1}else return KS(),!0}function yt(l,h,w){var R=h.pendingProps;switch(P1(h),h.tag){case H:case Vt:case Ct:case L:case Ke:case ve:case xe:case Ge:case $e:case mt:return Rt(h),null;case N:{var O=h.type;return eu(O)&&rm(h),Rt(h),null}case X:{var G=h.stateNode;if(t_(h),Gy(h),A0(),G.pendingContext&&(G.context=G.pendingContext,G.pendingContext=null),l===null||l.child===null){var K=s0(h);if(K)ke(h);else if(l!==null){var ae=l.memoizedState;(!ae.isDehydrated||(h.flags&Nl)!==On)&&(h.flags|=Bl,KS())}}return Ze(l,h),Rt(h),null}case he:{K1(h);var pe=nE(),Oe=h.type;if(l!==null&&h.stateNode!=null)st(l,h,Oe,R,pe),l.ref!==h.ref&&Be(h);else{if(!R){if(h.stateNode===null)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");return Rt(h),null}var Ve=i_(),gt=s0(h);if(gt)$y(h,pe,Ve)&&ke(h);else{var pt=Fx(Oe,R,pe,Ve,h);ot(pt,h,!1,!1),h.stateNode=pt,gS(pt,Oe,R,pe)&&ke(h)}h.ref!==null&&Be(h)}return Rt(h),null}case de:{var Ht=R;if(l&&h.stateNode!=null){var $t=l.memoizedProps;dt(l,h,$t,Ht)}else{if(typeof Ht!="string"&&h.stateNode===null)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");var oi=nE(),Ji=i_(),Vn=s0(h);Vn?ZS(h)&&ke(h):h.stateNode=yS(Ht,oi,Ji,h)}return Rt(h),null}case Ye:{Gh(h);var An=h.memoizedState;if(l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){var lo=Mt(l,h,An);if(!lo)return h.flags&us?h:null}if((h.flags&Xr)!==On)return h.lanes=w,(h.mode&Hr)!==Cn&&wm(h),h;var Kr=An!==null,Ot=l!==null&&l.memoizedState!==null;if(Kr!==Ot&&Kr){var ai=h.child;if(ai.flags|=hc,(h.mode&Nn)!==Cn){var kt=l===null&&(h.memoizedProps.unstable_avoidThisFallback!==!0||!0);kt||Q1(au.current,n_)?jk():yI()}}var Ci=h.updateQueue;if(Ci!==null&&(h.flags|=no),Rt(h),(h.mode&Hr)!==Cn&&Kr){var cn=h.child;cn!==null&&(h.treeBaseDuration-=cn.treeBaseDuration)}return null}case re:return t_(h),Ze(l,h),l===null&&SC(h.stateNode.containerInfo),Rt(h),null;case Le:var nn=h.type._context;return y0(nn,h),Rt(h),null;case ui:{var ur=h.type;return eu(ur)&&rm(h),Rt(h),null}case si:{Gh(h);var br=h.memoizedState;if(br===null)return Rt(h),null;var Zo=(h.flags&Xr)!==On,Ao=br.rendering;if(Ao===null)if(Zo)wt(br,!1);else{var _s=Hk()&&(l===null||(l.flags&Xr)===On);if(!_s)for(var Co=h.child;Co!==null;){var ns=lv(Co);if(ns!==null){Zo=!0,h.flags|=Xr,wt(br,!1);var Kl=ns.updateQueue;return Kl!==null&&(h.updateQueue=Kl,h.flags|=no),h.subtreeFlags=On,NC(h,w),jf(h,sv(au.current,av)),h.child}Co=Co.sibling}br.tail!==null&&ya()>xD()&&(h.flags|=Xr,Zo=!0,wt(br,!1),h.lanes=oy)}else{if(!Zo){var Pl=lv(Ao);if(Pl!==null){h.flags|=Xr,Zo=!0;var ah=Pl.updateQueue;if(ah!==null&&(h.updateQueue=ah,h.flags|=no),wt(br,!0),br.tail===null&&br.tailMode==="hidden"&&!Ao.alternate&&!Ds())return Rt(h),null}else ya()*2-br.renderingStartTime>xD()&&w!==wl&&(h.flags|=Xr,Zo=!0,wt(br,!1),h.lanes=oy)}if(br.isBackwards)Ao.sibling=h.child,h.child=Ao;else{var Ec=br.last;Ec!==null?Ec.sibling=Ao:h.child=Ao,br.last=Ao}}if(br.tail!==null){var Ac=br.tail;br.rendering=Ac,br.tail=Ac.sibling,br.renderingStartTime=ya(),Ac.sibling=null;var Jl=au.current;return Zo?Jl=sv(Jl,av):Jl=dm(Jl),jf(h,Jl),Ac}return Rt(h),null}case di:break;case Nt:case Ii:{_I(h);var Rm=h.memoizedState,pb=Rm!==null;if(l!==null){var qw=l.memoizedState,tp=qw!==null;tp!==pb&&!zn&&(h.flags|=hc)}return!pb||(h.mode&Nn)===Cn?Rt(h):lr(ep,wl)&&(Rt(h),h.subtreeFlags&(la|no)&&(h.flags|=hc)),null}case Qt:return null;case _t:return null}throw new Error("Unknown unit of work tag ("+h.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function Dt(l,h,w){switch(P1(h),h.tag){case N:{var R=h.type;eu(R)&&rm(h);var O=h.flags;return O&us?(h.flags=O&~us|Xr,(h.mode&Hr)!==Cn&&wm(h),h):null}case X:{h.stateNode,t_(h),Gy(h),A0();var G=h.flags;return(G&us)!==On&&(G&Xr)===On?(h.flags=G&~us|Xr,h):null}case he:return K1(h),null;case Ye:{Gh(h);var K=h.memoizedState;if(K!==null&&K.dehydrated!==null){if(h.alternate===null)throw new Error("Threw in newly mounted dehydrated component. This is likely a bug in React. Please file an issue.");Xg()}var ae=h.flags;return ae&us?(h.flags=ae&~us|Xr,(h.mode&Hr)!==Cn&&wm(h),h):null}case si:return Gh(h),null;case re:return t_(h),null;case Le:var pe=h.type._context;return y0(pe,h),null;case Nt:case Ii:return _I(h),null;case Qt:return null;default:return null}}function nt(l,h,w){switch(P1(h),h.tag){case N:{var R=h.type.childContextTypes;R!=null&&rm(h);break}case X:{h.stateNode,t_(h),Gy(h),A0();break}case he:{K1(h);break}case re:t_(h);break;case Ye:Gh(h);break;case si:Gh(h);break;case Le:var O=h.type._context;y0(O,h);break;case Nt:case Ii:_I(h);break}}var tt=null;tt=new Set;var St=!1,It=!1,bt=typeof WeakSet=="function"?WeakSet:Set,vt=null,ci=null,Yt=null;function Wt(l){gh(null,function(){throw l}),nf()}var ji=function(l,h){if(h.props=l.memoizedProps,h.state=l.memoizedState,l.mode&Hr)try{Jh(),h.componentWillUnmount()}finally{Kh(l)}else h.componentWillUnmount()};function Kt(l,h){try{Gt(ps,l)}catch(w){fa(l,h,w)}}function Ai(l,h,w){try{ji(l,w)}catch(R){fa(l,h,R)}}function qi(l,h,w){try{w.componentDidMount()}catch(R){fa(l,h,R)}}function fn(l,h){try{Ki(l)}catch(w){fa(l,h,w)}}function En(l,h){var w=l.ref;if(w!==null)if(typeof w=="function"){var R;try{if(pr&&Vr&&l.mode&Hr)try{Jh(),R=w(null)}finally{Kh(l)}else R=w(null)}catch(O){fa(l,h,O)}typeof R=="function"&&A("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",yn(l))}else w.current=null}function Zi(l,h,w){try{w()}catch(R){fa(l,h,R)}}var $n=!1;function Jn(l,h){Fy(l.containerInfo),vt=h,eo();var w=$n;return $n=!1,w}function eo(){for(;vt!==null;){var l=vt,h=l.child;(l.subtreeFlags&yh)!==On&&h!==null?(h.return=l,vt=h):Ee()}}function Ee(){for(;vt!==null;){var l=vt;vo(l);try{be(l)}catch(w){fa(l,l.return,w)}Go();var h=l.sibling;if(h!==null){h.return=l.return,vt=h;return}vt=l.return}}function be(l){var h=l.alternate,w=l.flags;if((w&Bl)!==On){switch(vo(l),l.tag){case L:case Ke:case Ct:break;case N:{if(h!==null){var R=h.memoizedProps,O=h.memoizedState,G=l.stateNode;l.type===l.elementType&&!Yf&&(G.props!==l.memoizedProps&&A("Expected %s props to match memoized props before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",yn(l)||"instance"),G.state!==l.memoizedState&&A("Expected %s state to match memoized state before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",yn(l)||"instance"));var K=G.getSnapshotBeforeUpdate(l.elementType===l.type?R:nh(l.type,R),O);{var ae=tt;K===void 0&&!ae.has(l.type)&&(ae.add(l.type),A("%s.getSnapshotBeforeUpdate(): A snapshot value (or null) must be returned. You have returned undefined.",yn(l)))}G.__reactInternalSnapshotBeforeUpdate=K}break}case X:{{var pe=l.stateNode;Ny(pe.containerInfo)}break}case he:case de:case re:case ui:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}Go()}}function at(l,h,w){var R=h.updateQueue,O=R!==null?R.lastEffect:null;if(O!==null){var G=O.next,K=G;do{if((K.tag&l)===l){var ae=K.destroy;K.destroy=void 0,ae!==void 0&&((l&Ms)!==cl?yd(h):(l&ps)!==cl&&Wc(h),(l&su)!==cl&&Hw(!0),Zi(h,w,ae),(l&su)!==cl&&Hw(!1),(l&Ms)!==cl?cf():(l&ps)!==cl&&zu())}K=K.next}while(K!==G)}}function Gt(l,h){var w=h.updateQueue,R=w!==null?w.lastEffect:null;if(R!==null){var O=R.next,G=O;do{if((G.tag&l)===l){(l&Ms)!==cl?ug(h):(l&ps)!==cl&&li(h);var K=G.create;(l&su)!==cl&&Hw(!0),G.destroy=K(),(l&su)!==cl&&Hw(!1),(l&Ms)!==cl?fx():(l&ps)!==cl&&J_();{var ae=G.destroy;if(ae!==void 0&&typeof ae!="function"){var pe=void 0;(G.tag&ps)!==On?pe="useLayoutEffect":(G.tag&su)!==On?pe="useInsertionEffect":pe="useEffect";var Oe=void 0;ae===null?Oe=" You returned null. If your effect does not require clean up, return undefined (or nothing).":typeof ae.then=="function"?Oe=`

It looks like you wrote `+pe+`(async () => ...) or returned a Promise. Instead, write the async function inside your effect and call it immediately:

`+pe+`(() => {
  async function fetchData() {
    // You can await here
    const response = await MyAPI.getData(someId);
    // ...
  }
  fetchData();
}, [someId]); // Or [] if effect doesn't need props or state

Learn more about data fetching with Hooks: https://reactjs.org/link/hooks-data-fetching`:Oe=" You returned: "+ae,A("%s must not return anything besides a function, which is used for clean-up.%s",pe,Oe)}}}G=G.next}while(G!==O)}}function ut(l,h){if((h.flags&no)!==On)switch(h.tag){case Ge:{var w=h.stateNode.passiveEffectDuration,R=h.memoizedProps,O=R.id,G=R.onPostCommit,K=pE(),ae=h.alternate===null?"mount":"update";fE()&&(ae="nested-update"),typeof G=="function"&&G(O,ae,w,K);var pe=h.return;e:for(;pe!==null;){switch(pe.tag){case X:var Oe=pe.stateNode;Oe.passiveEffectDuration+=w;break e;case Ge:var Ve=pe.stateNode;Ve.passiveEffectDuration+=w;break e}pe=pe.return}break}}}function qt(l,h,w,R){if((w.flags&vh)!==On)switch(w.tag){case L:case Ke:case Ct:{if(!It)if(w.mode&Hr)try{Jh(),Gt(ps|Na,w)}finally{Kh(w)}else Gt(ps|Na,w);break}case N:{var O=w.stateNode;if(w.flags&no&&!It)if(h===null)if(w.type===w.elementType&&!Yf&&(O.props!==w.memoizedProps&&A("Expected %s props to match memoized props before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",yn(w)||"instance"),O.state!==w.memoizedState&&A("Expected %s state to match memoized state before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",yn(w)||"instance")),w.mode&Hr)try{Jh(),O.componentDidMount()}finally{Kh(w)}else O.componentDidMount();else{var G=w.elementType===w.type?h.memoizedProps:nh(w.type,h.memoizedProps),K=h.memoizedState;if(w.type===w.elementType&&!Yf&&(O.props!==w.memoizedProps&&A("Expected %s props to match memoized props before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",yn(w)||"instance"),O.state!==w.memoizedState&&A("Expected %s state to match memoized state before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",yn(w)||"instance")),w.mode&Hr)try{Jh(),O.componentDidUpdate(G,K,O.__reactInternalSnapshotBeforeUpdate)}finally{Kh(w)}else O.componentDidUpdate(G,K,O.__reactInternalSnapshotBeforeUpdate)}var ae=w.updateQueue;ae!==null&&(w.type===w.elementType&&!Yf&&(O.props!==w.memoizedProps&&A("Expected %s props to match memoized props before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",yn(w)||"instance"),O.state!==w.memoizedState&&A("Expected %s state to match memoized state before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",yn(w)||"instance")),nv(w,ae,O));break}case X:{var pe=w.updateQueue;if(pe!==null){var Oe=null;if(w.child!==null)switch(w.child.tag){case he:Oe=w.child.stateNode;break;case N:Oe=w.child.stateNode;break}nv(w,pe,Oe)}break}case he:{var Ve=w.stateNode;if(h===null&&w.flags&no){var gt=w.type,pt=w.memoizedProps;v1(Ve,gt,pt)}break}case de:break;case re:break;case Ge:{{var Ht=w.memoizedProps,$t=Ht.onCommit,oi=Ht.onRender,Ji=w.stateNode.effectDuration,Vn=pE(),An=h===null?"mount":"update";fE()&&(An="nested-update"),typeof oi=="function"&&oi(w.memoizedProps.id,An,w.actualDuration,w.treeBaseDuration,w.actualStartTime,Vn);{typeof $t=="function"&&$t(w.memoizedProps.id,An,Ji,Vn),Xk(w);var lo=w.return;e:for(;lo!==null;){switch(lo.tag){case X:var Kr=lo.stateNode;Kr.effectDuration+=Ji;break e;case Ge:var Ot=lo.stateNode;Ot.effectDuration+=Ji;break e}lo=lo.return}}}break}case Ye:{Qn(l,w);break}case si:case ui:case di:case Nt:case Ii:case _t:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}It||w.flags&Bc&&Ki(w)}function wi(l){switch(l.tag){case L:case Ke:case Ct:{if(l.mode&Hr)try{Jh(),Kt(l,l.return)}finally{Kh(l)}else Kt(l,l.return);break}case N:{var h=l.stateNode;typeof h.componentDidMount=="function"&&qi(l,l.return,h),fn(l,l.return);break}case he:{fn(l,l.return);break}}}function vi(l,h){for(var w=null,R=l;;){if(R.tag===he){if(w===null){w=R;try{var O=R.stateNode;h?CS(O):vC(R.stateNode,R.memoizedProps)}catch(K){fa(l,l.return,K)}}}else if(R.tag===de){if(w===null)try{var G=R.stateNode;h?Nx(G):IS(G,R.memoizedProps)}catch(K){fa(l,l.return,K)}}else if(!((R.tag===Nt||R.tag===Ii)&&R.memoizedState!==null&&R!==l)){if(R.child!==null){R.child.return=R,R=R.child;continue}}if(R===l)return;for(;R.sibling===null;){if(R.return===null||R.return===l)return;w===R&&(w=null),R=R.return}w===R&&(w=null),R.sibling.return=R.return,R=R.sibling}}function Ki(l){var h=l.ref;if(h!==null){var w=l.stateNode,R;switch(l.tag){case he:R=w;break;default:R=w}if(typeof h=="function"){var O;if(l.mode&Hr)try{Jh(),O=h(R)}finally{Kh(l)}else O=h(R);typeof O=="function"&&A("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",yn(l))}else h.hasOwnProperty("current")||A("Unexpected ref object provided for %s. Use either a ref-setter function or React.createRef().",yn(l)),h.current=R}}function Li(l){var h=l.alternate;h!==null&&(h.return=null),l.return=null}function gi(l){var h=l.alternate;h!==null&&(l.alternate=null,gi(h));{if(l.child=null,l.deletions=null,l.sibling=null,l.tag===he){var w=l.stateNode;w!==null&&AC(w)}l.stateNode=null,l._debugOwner=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}}function Wn(l){for(var h=l.return;h!==null;){if(xr(h))return h;h=h.return}throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.")}function xr(l){return l.tag===he||l.tag===X||l.tag===re}function zi(l){var h=l;e:for(;;){for(;h.sibling===null;){if(h.return===null||xr(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==he&&h.tag!==de&&h.tag!==Di;){if(h.flags&la||h.child===null||h.tag===re)continue e;h.child.return=h,h=h.child}if(!(h.flags&la))return h.stateNode}}function Fn(l){var h=Wn(l);switch(h.tag){case he:{var w=h.stateNode;h.flags&Ip&&(x1(w),h.flags&=~Ip);var R=zi(l);or(l,R,w);break}case X:case re:{var O=h.stateNode.containerInfo,G=zi(l);yr(l,G,O);break}default:throw new Error("Invalid host parent fiber. This error is likely caused by a bug in React. Please file an issue.")}}function yr(l,h,w){var R=l.tag,O=R===he||R===de;if(O){var G=l.stateNode;h?SS(w,G,h):TS(w,G)}else if(R!==re){var K=l.child;if(K!==null){yr(K,h,w);for(var ae=K.sibling;ae!==null;)yr(ae,h,w),ae=ae.sibling}}}function or(l,h,w){var R=l.tag,O=R===he||R===de;if(O){var G=l.stateNode;h?yC(w,G,h):wS(w,G)}else if(R!==re){var K=l.child;if(K!==null){or(K,h,w);for(var ae=K.sibling;ae!==null;)or(ae,h,w),ae=ae.sibling}}}var ar=null,fr=!1;function Mr(l,h,w){{var R=h;e:for(;R!==null;){switch(R.tag){case he:{ar=R.stateNode,fr=!1;break e}case X:{ar=R.stateNode.containerInfo,fr=!0;break e}case re:{ar=R.stateNode.containerInfo,fr=!0;break e}}R=R.return}if(ar===null)throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.");qn(l,h,w),ar=null,fr=!1}Li(w)}function Un(l,h,w){for(var R=w.child;R!==null;)qn(l,h,R),R=R.sibling}function qn(l,h,w){switch(cg(w),w.tag){case he:It||En(w,h);case de:{{var R=ar,O=fr;ar=null,Un(l,h,w),ar=R,fr=O,ar!==null&&(fr?Qp(ar,w.stateNode):ES(ar,w.stateNode))}return}case Di:{ar!==null&&(fr?AS(ar,w.stateNode):zx(ar,w.stateNode));return}case re:{{var G=ar,K=fr;ar=w.stateNode.containerInfo,fr=!0,Un(l,h,w),ar=G,fr=K}return}case L:case Ke:case mt:case Ct:{if(!It){var ae=w.updateQueue;if(ae!==null){var pe=ae.lastEffect;if(pe!==null){var Oe=pe.next,Ve=Oe;do{var gt=Ve,pt=gt.destroy,Ht=gt.tag;pt!==void 0&&((Ht&su)!==cl?Zi(w,h,pt):(Ht&ps)!==cl&&(Wc(w),w.mode&Hr?(Jh(),Zi(w,h,pt),Kh(w)):Zi(w,h,pt),zu())),Ve=Ve.next}while(Ve!==Oe)}}}Un(l,h,w);return}case N:{if(!It){En(w,h);var $t=w.stateNode;typeof $t.componentWillUnmount=="function"&&Ai(w,h,$t)}Un(l,h,w);return}case di:{Un(l,h,w);return}case Nt:{if(w.mode&Nn){var oi=It;It=oi||w.memoizedState!==null,Un(l,h,w),It=oi}else Un(l,h,w);break}default:{Un(l,h,w);return}}}function en(l){l.memoizedState}function Qn(l,h){var w=h.memoizedState;if(w===null){var R=h.alternate;if(R!==null){var O=R.memoizedState;if(O!==null){var G=O.dehydrated;G!==null&&Vg(G)}}}}function Ir(l){var h=l.updateQueue;if(h!==null){l.updateQueue=null;var w=l.stateNode;w===null&&(w=l.stateNode=new bt),h.forEach(function(R){var O=iF.bind(null,l,R);if(!w.has(R)){if(w.add(R),dc)if(ci!==null&&Yt!==null)Gw(Yt,ci);else throw Error("Expected finished root and lanes to be set. This is a bug in React.");R.then(O,O)}})}}function Ni(l,h,w){ci=w,Yt=l,vo(h),$r(h,l),vo(h),ci=null,Yt=null}function _n(l,h,w){var R=h.deletions;if(R!==null)for(var O=0;O<R.length;O++){var G=R[O];try{Mr(l,h,G)}catch(pe){fa(G,h,pe)}}var K=Wd();if(h.subtreeFlags&af)for(var ae=h.child;ae!==null;)vo(ae),$r(ae,l),ae=ae.sibling;vo(K)}function $r(l,h,w){var R=l.alternate,O=l.flags;switch(l.tag){case L:case Ke:case mt:case Ct:{if(_n(h,l),Pr(l),O&no){try{at(su|Na,l,l.return),Gt(su|Na,l)}catch(ur){fa(l,l.return,ur)}if(l.mode&Hr){try{Jh(),at(ps|Na,l,l.return)}catch(ur){fa(l,l.return,ur)}Kh(l)}else try{at(ps|Na,l,l.return)}catch(ur){fa(l,l.return,ur)}}return}case N:{_n(h,l),Pr(l),O&Bc&&R!==null&&En(R,R.return);return}case he:{_n(h,l),Pr(l),O&Bc&&R!==null&&En(R,R.return);{if(l.flags&Ip){var G=l.stateNode;try{x1(G)}catch(ur){fa(l,l.return,ur)}}if(O&no){var K=l.stateNode;if(K!=null){var ae=l.memoizedProps,pe=R!==null?R.memoizedProps:ae,Oe=l.type,Ve=l.updateQueue;if(l.updateQueue=null,Ve!==null)try{xS(K,Ve,Oe,pe,ae,l)}catch(ur){fa(l,l.return,ur)}}}}return}case de:{if(_n(h,l),Pr(l),O&no){if(l.stateNode===null)throw new Error("This should have a text node initialized. This error is likely caused by a bug in React. Please file an issue.");var gt=l.stateNode,pt=l.memoizedProps,Ht=R!==null?R.memoizedProps:pt;try{bS(gt,Ht,pt)}catch(ur){fa(l,l.return,ur)}}return}case X:{if(_n(h,l),Pr(l),O&no&&R!==null){var $t=R.memoizedState;if($t.isDehydrated)try{Wu(h.containerInfo)}catch(ur){fa(l,l.return,ur)}}return}case re:{_n(h,l),Pr(l);return}case Ye:{_n(h,l),Pr(l);var oi=l.child;if(oi.flags&hc){var Ji=oi.stateNode,Vn=oi.memoizedState,An=Vn!==null;if(Ji.isHidden=An,An){var lo=oi.alternate!==null&&oi.alternate.memoizedState!==null;lo||Uk()}}if(O&no){try{en(l)}catch(ur){fa(l,l.return,ur)}Ir(l)}return}case Nt:{var Kr=R!==null&&R.memoizedState!==null;if(l.mode&Nn){var Ot=It;It=Ot||Kr,_n(h,l),It=Ot}else _n(h,l);if(Pr(l),O&hc){var ai=l.stateNode,kt=l.memoizedState,Ci=kt!==null,cn=l;if(ai.isHidden=Ci,Ci&&!Kr&&(cn.mode&Nn)!==Cn){vt=cn;for(var nn=cn.child;nn!==null;)vt=nn,ta(nn),nn=nn.sibling}vi(cn,Ci)}return}case si:{_n(h,l),Pr(l),O&no&&Ir(l);return}case di:return;default:{_n(h,l),Pr(l);return}}}function Pr(l){var h=l.flags;if(h&la){try{Fn(l)}catch(w){fa(l,l.return,w)}l.flags&=~la}h&Uc&&(l.flags&=~Uc)}function Vo(l,h,w){ci=w,Yt=h,vt=l,ea(l,h,w),ci=null,Yt=null}function ea(l,h,w){for(var R=(l.mode&Nn)!==Cn;vt!==null;){var O=vt,G=O.child;if(O.tag===Nt&&R){var K=O.memoizedState!==null,ae=K||St;if(ae){Nr(l,h,w);continue}else{var pe=O.alternate,Oe=pe!==null&&pe.memoizedState!==null,Ve=Oe||It,gt=St,pt=It;St=ae,It=Ve,It&&!pt&&(vt=O,ia(O));for(var Ht=G;Ht!==null;)vt=Ht,ea(Ht,h,w),Ht=Ht.sibling;vt=O,St=gt,It=pt,Nr(l,h,w);continue}}(O.subtreeFlags&vh)!==On&&G!==null?(G.return=O,vt=G):Nr(l,h,w)}}function Nr(l,h,w){for(;vt!==null;){var R=vt;if((R.flags&vh)!==On){var O=R.alternate;vo(R);try{qt(h,O,R,w)}catch(K){fa(R,R.return,K)}Go()}if(R===l){vt=null;return}var G=R.sibling;if(G!==null){G.return=R.return,vt=G;return}vt=R.return}}function ta(l){for(;vt!==null;){var h=vt,w=h.child;switch(h.tag){case L:case Ke:case mt:case Ct:{if(h.mode&Hr)try{Jh(),at(ps,h,h.return)}finally{Kh(h)}else at(ps,h,h.return);break}case N:{En(h,h.return);var R=h.stateNode;typeof R.componentWillUnmount=="function"&&Ai(h,h.return,R);break}case he:{En(h,h.return);break}case Nt:{var O=h.memoizedState!==null;if(O){$s(l);continue}break}}w!==null?(w.return=h,vt=w):$s(l)}}function $s(l){for(;vt!==null;){var h=vt;if(h===l){vt=null;return}var w=h.sibling;if(w!==null){w.return=h.return,vt=w;return}vt=h.return}}function ia(l){for(;vt!==null;){var h=vt,w=h.child;if(h.tag===Nt){var R=h.memoizedState!==null;if(R){dl(l);continue}}w!==null?(w.return=h,vt=w):dl(l)}}function dl(l){for(;vt!==null;){var h=vt;vo(h);try{wi(h)}catch(R){fa(h,h.return,R)}if(Go(),h===l){vt=null;return}var w=h.sibling;if(w!==null){w.return=h.return,vt=w;return}vt=h.return}}function ts(l,h,w,R){vt=h,xc(h,l,w,R)}function xc(l,h,w,R){for(;vt!==null;){var O=vt,G=O.child;(O.subtreeFlags&_d)!==On&&G!==null?(G.return=O,vt=G):fl(l,h,w,R)}}function fl(l,h,w,R){for(;vt!==null;){var O=vt;if((O.flags&Vc)!==On){vo(O);try{Dl(h,O,w,R)}catch(K){fa(O,O.return,K)}Go()}if(O===l){vt=null;return}var G=O.sibling;if(G!==null){G.return=O.return,vt=G;return}vt=O.return}}function Dl(l,h,w,R){switch(h.tag){case L:case Ke:case Ct:{if(h.mode&Hr){qf();try{Gt(Ms|Na,h)}finally{mw(h)}}else Gt(Ms|Na,h);break}}}function is(l){vt=l,Ml()}function Ml(){for(;vt!==null;){var l=vt,h=l.child;if((vt.flags&_h)!==On){var w=l.deletions;if(w!==null){for(var R=0;R<w.length;R++){var O=w[R];vt=O,Ps(O,l)}{var G=l.alternate;if(G!==null){var K=G.child;if(K!==null){G.child=null;do{var ae=K.sibling;K.sibling=null,K=ae}while(K!==null)}}}vt=l}}(l.subtreeFlags&_d)!==On&&h!==null?(h.return=l,vt=h):bc()}}function bc(){for(;vt!==null;){var l=vt;(l.flags&Vc)!==On&&(vo(l),Va(l),Go());var h=l.sibling;if(h!==null){h.return=l.return,vt=h;return}vt=l.return}}function Va(l){switch(l.tag){case L:case Ke:case Ct:{l.mode&Hr?(qf(),at(Ms|Na,l,l.return),mw(l)):at(Ms|Na,l,l.return);break}}}function Ps(l,h){for(;vt!==null;){var w=vt;vo(w),Kf(w,h),Go();var R=w.child;R!==null?(R.return=w,vt=R):Qh(l)}}function Qh(l){for(;vt!==null;){var h=vt,w=h.sibling,R=h.return;if(gi(h),h===l){vt=null;return}if(w!==null){w.return=R,vt=w;return}vt=R}}function Kf(l,h){switch(l.tag){case L:case Ke:case Ct:{l.mode&Hr?(qf(),at(Ms,l,h),mw(l)):at(Ms,l,h);break}}}function b_(l){switch(l.tag){case L:case Ke:case Ct:{try{Gt(ps|Na,l)}catch(w){fa(l,l.return,w)}break}case N:{var h=l.stateNode;try{h.componentDidMount()}catch(w){fa(l,l.return,w)}break}}}function Jf(l){switch(l.tag){case L:case Ke:case Ct:{try{Gt(Ms|Na,l)}catch(h){fa(l,l.return,h)}break}}}function ed(l){switch(l.tag){case L:case Ke:case Ct:{try{at(ps|Na,l,l.return)}catch(w){fa(l,l.return,w)}break}case N:{var h=l.stateNode;typeof h.componentWillUnmount=="function"&&Ai(l,l.return,h);break}}}function sb(l){switch(l.tag){case L:case Ke:case Ct:try{at(Ms|Na,l,l.return)}catch(h){fa(l,l.return,h)}}}if(typeof Symbol=="function"&&Symbol.for){var td=Symbol.for;td("selector.component"),td("selector.has_pseudo_class"),td("selector.role"),td("selector.test_id"),td("selector.text")}var oI=[];function ME(){oI.forEach(function(l){return l()})}var PE=u.ReactCurrentActQueue;function aI(l){{var h=typeof IS_REACT_ACT_ENVIRONMENT<"u"?IS_REACT_ACT_ENVIRONMENT:void 0,w=typeof jest<"u";return w&&h!==!1}}function OE(){{var l=typeof IS_REACT_ACT_ENVIRONMENT<"u"?IS_REACT_ACT_ENVIRONMENT:void 0;return!l&&PE.current!==null&&A("The current testing environment is not configured to support act(...)"),l}}var kE=Math.ceil,lb=u.ReactCurrentDispatcher,Qf=u.ReactCurrentOwner,Ws=u.ReactCurrentBatchConfig,rh=u.ReactCurrentActQueue,gs=0,Ow=1,Os=2,wc=4,id=0,w_=1,Em=2,cb=3,kw=4,_D=5,sI=6,so=gs,Tc=null,Ya=null,qs=yi,ep=yi,lI=Vh(yi),Zs=id,Fw=null,FE=yi,Lw=yi,LE=yi,zw=null,du=null,cI=0,yD=500,vD=1/0,Mk=500,Am=null;function Nw(){vD=ya()+Mk}function xD(){return vD}var zE=!1,uI=null,ub=null,Dv=!1,T_=null,Bw=yi,hI=[],dI=null,Pk=50,Vw=0,fI=null,pI=!1,NE=!1,Ok=50,hb=0,BE=null,Uw=xn,VE=yi,bD=!1;function UE(){return Tc}function Sc(){return(so&(Os|wc))!==gs?ya():(Uw!==xn||(Uw=ya()),Uw)}function S_(l){var h=l.mode;if((h&Nn)===Cn)return Yn;if((so&Os)!==gs&&qs!==yi)return Dh(qs);var w=Wy()!==FC;if(w){if(Ws.transition!==null){var R=Ws.transition;R._updatedFibers||(R._updatedFibers=new Set),R._updatedFibers.add(l)}return VE===ua&&(VE=xg()),VE}var O=$l();if(O!==ua)return O;var G=gC();return G}function kk(l){var h=l.mode;return(h&Nn)===Cn?Yn:jl()}function Xs(l,h,w,R){rF(),bD&&A("useInsertionEffect must not schedule updates."),pI&&(NE=!0),Hl(l,w,R),(so&Os)!==yi&&l===Tc?sF(h):(dc&&Gp(l,h,w),lF(h),l===Tc&&((so&Os)===gs&&(Lw=_r(Lw,w)),Zs===kw&&E_(l,qs)),fu(l,R),w===Yn&&so===gs&&(h.mode&Nn)===Cn&&!rh.isBatchingLegacy&&(Nw(),jS()))}function Fk(l,h,w){var R=l.current;R.lanes=h,Hl(l,h,w),fu(l,w)}function Lk(l){return(so&Os)!==gs}function fu(l,h){var w=l.callbackNode;sy(l,h);var R=qc(l,l===Tc?qs:yi);if(R===yi){w!==null&&zD(w),l.callbackNode=null,l.callbackPriority=ua;return}var O=Gu(R),G=l.callbackPriority;if(G===O&&!(rh.current!==null&&w!==bI)){w==null&&G!==Yn&&A("Expected scheduled callback to exist. This error is likely caused by a bug in React. Please file an issue.");return}w!=null&&zD(w);var K;if(O===Yn)l.tag===Of?(rh.isBatchingLegacy!==null&&(rh.didScheduleLegacyUpdate=!0),US(SD.bind(null,l))):VS(SD.bind(null,l)),rh.current!==null?rh.current.push(kf):_C(function(){(so&(Os|wc))===gs&&kf()}),K=null;else{var ae;switch(dy(R)){case Es:ae=Gc;break;case Tl:ae=Hc;break;case mc:ae=Fu;break;case Hp:ae=Pp;break;default:ae=Fu;break}K=wI(ae,wD.bind(null,l))}l.callbackPriority=O,l.callbackNode=K}function wD(l,h){if(qC(),Uw=xn,VE=yi,(so&(Os|wc))!==gs)throw new Error("Should not already be working.");var w=l.callbackNode,R=Im();if(R&&l.callbackNode!==w)return null;var O=qc(l,l===Tc?qs:yi);if(O===yi)return null;var G=!Td(l,O)&&!_f(l,O)&&!h,K=G?Wk(l,O):GE(l,O);if(K!==id){if(K===Em){var ae=gf(l);ae!==yi&&(O=ae,K=mI(l,ae))}if(K===w_){var pe=Fw;throw Mv(l,yi),E_(l,O),fu(l,ya()),pe}if(K===sI)E_(l,O);else{var Oe=!Td(l,O),Ve=l.current.alternate;if(Oe&&!Nk(Ve)){if(K=GE(l,O),K===Em){var gt=gf(l);gt!==yi&&(O=gt,K=mI(l,gt))}if(K===w_){var pt=Fw;throw Mv(l,yi),E_(l,O),fu(l,ya()),pt}}l.finishedWork=Ve,l.finishedLanes=O,zk(l,K,O)}}return fu(l,ya()),l.callbackNode===w?wD.bind(null,l):null}function mI(l,h){var w=zw;if(Sg(l)){var R=Mv(l,h);R.flags|=Nl,E1(l.containerInfo)}var O=GE(l,h);if(O!==Em){var G=du;du=w,G!==null&&TD(G)}return O}function TD(l){du===null?du=l:du.push.apply(du,l)}function zk(l,h,w){switch(h){case id:case w_:throw new Error("Root did not complete. This is a bug in React.");case Em:{Pv(l,du,Am);break}case cb:{if(E_(l,w),Uu(w)&&!ND()){var R=cI+yD-ya();if(R>10){var O=qc(l,yi);if(O!==yi)break;var G=l.suspendedLanes;if(!pc(G,w)){Sc(),jp(l,G);break}l.timeoutHandle=g1(Pv.bind(null,l,du,Am),R);break}}Pv(l,du,Am);break}case kw:{if(E_(l,w),vg(w))break;if(!ND()){var K=mf(l,w),ae=K,pe=ya()-ae,Oe=nF(pe)-pe;if(Oe>10){l.timeoutHandle=g1(Pv.bind(null,l,du,Am),Oe);break}}Pv(l,du,Am);break}case _D:{Pv(l,du,Am);break}default:throw new Error("Unknown root exit status.")}}function Nk(l){for(var h=l;;){if(h.flags&Pu){var w=h.updateQueue;if(w!==null){var R=w.stores;if(R!==null)for(var O=0;O<R.length;O++){var G=R[O],K=G.getSnapshot,ae=G.value;try{if(!Cl(K(),ae))return!1}catch{return!1}}}}var pe=h.child;if(h.subtreeFlags&Pu&&pe!==null){pe.return=h,h=pe;continue}if(h===l)return!0;for(;h.sibling===null;){if(h.return===null||h.return===l)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}return!0}function E_(l,h){h=yf(h,LE),h=yf(h,Lw),cy(l,h)}function SD(l){if(j0(),(so&(Os|wc))!==gs)throw new Error("Should not already be working.");Im();var h=qc(l,yi);if(!lr(h,Yn))return fu(l,ya()),null;var w=GE(l,h);if(l.tag!==Of&&w===Em){var R=gf(l);R!==yi&&(h=R,w=mI(l,R))}if(w===w_){var O=Fw;throw Mv(l,yi),E_(l,h),fu(l,ya()),O}if(w===sI)throw new Error("Root did not complete. This is a bug in React.");var G=l.current.alternate;return l.finishedWork=G,l.finishedLanes=h,Pv(l,du,Am),fu(l,ya()),null}function Bk(l,h){h!==yi&&(Oh(l,_r(h,Yn)),fu(l,ya()),(so&(Os|wc))===gs&&(Nw(),kf()))}function gI(l,h){var w=so;so|=Ow;try{return l(h)}finally{so=w,so===gs&&!rh.isBatchingLegacy&&(Nw(),jS())}}function Vk(l,h,w,R,O){var G=$l(),K=Ws.transition;try{return Ws.transition=null,Aa(Es),l(h,w,R,O)}finally{Aa(G),Ws.transition=K,so===gs&&Nw()}}function Cm(l){T_!==null&&T_.tag===Of&&(so&(Os|wc))===gs&&Im();var h=so;so|=Ow;var w=Ws.transition,R=$l();try{return Ws.transition=null,Aa(Es),l?l():void 0}finally{Aa(R),Ws.transition=w,so=h,(so&(Os|wc))===gs&&kf()}}function ED(){return(so&(Os|wc))!==gs}function jE(l,h){js(lI,ep,l),ep=_r(ep,h)}function _I(l){ep=lI.current,Us(lI,l)}function Mv(l,h){l.finishedWork=null,l.finishedLanes=yi;var w=l.timeoutHandle;if(w!==Ng&&(l.timeoutHandle=Ng,_1(w)),Ya!==null)for(var R=Ya.return;R!==null;){var O=R.alternate;nt(O,R),R=R.return}Tc=l;var G=Ov(l.current,null);return Ya=G,qs=ep=h,Zs=id,Fw=null,FE=yi,Lw=yi,LE=yi,zw=null,du=null,eE(),Yu.discardPendingWarnings(),G}function AD(l,h){do{var w=Ya;try{if(Yy(),_m(),Go(),Qf.current=null,w===null||w.return===null){Zs=w_,Fw=h,Ya=null;return}if(pr&&w.mode&Hr&&H0(w,!0),pn)if($c(),h!==null&&typeof h=="object"&&typeof h.then=="function"){var R=h;Pi(w,R,qs)}else Sh(w,h,qs);JC(l,w.return,w,h,qs),DD(w)}catch(O){h=O,Ya===w&&w!==null?(w=w.return,Ya=w):w=Ya;continue}return}while(!0)}function CD(){var l=lb.current;return lb.current=f_,l===null?f_:l}function ID(l){lb.current=l}function Uk(){cI=ya()}function jw(l){FE=_r(l,FE)}function jk(){Zs===id&&(Zs=cb)}function yI(){(Zs===id||Zs===cb||Zs===Em)&&(Zs=kw),Tc!==null&&(zs(FE)||zs(Lw))&&E_(Tc,qs)}function Gk(l){Zs!==kw&&(Zs=Em),zw===null?zw=[l]:zw.push(l)}function Hk(){return Zs===id}function GE(l,h){var w=so;so|=Os;var R=CD();if(Tc!==l||qs!==h){if(dc){var O=l.memoizedUpdaters;O.size>0&&(Gw(l,qs),O.clear()),wg(l,h)}Am=hy(),Mv(l,h)}fg(h);do try{$k();break}catch(G){AD(l,G)}while(!0);if(Yy(),so=w,ID(R),Ya!==null)throw new Error("Cannot commit an incomplete root. This error is likely caused by a bug in React. Please file an issue.");return ty(),Tc=null,qs=yi,Zs}function $k(){for(;Ya!==null;)RD(Ya)}function Wk(l,h){var w=so;so|=Os;var R=CD();if(Tc!==l||qs!==h){if(dc){var O=l.memoizedUpdaters;O.size>0&&(Gw(l,qs),O.clear()),wg(l,h)}Am=hy(),Nw(),Mv(l,h)}fg(h);do try{qk();break}catch(G){AD(l,G)}while(!0);return Yy(),ID(R),so=w,Ya!==null?(ey(),id):(ty(),Tc=null,qs=yi,Zs)}function qk(){for(;Ya!==null&&!rg();)RD(Ya)}function RD(l){var h=l.alternate;vo(l);var w;(l.mode&Hr)!==Cn?(G0(l),w=vI(h,l,ep),H0(l,!0)):w=vI(h,l,ep),Go(),l.memoizedProps=l.pendingProps,w===null?DD(l):Ya=w,Qf.current=null}function DD(l){var h=l;do{var w=h.alternate,R=h.return;if((h.flags&Ts)===On){vo(h);var O=void 0;if((h.mode&Hr)===Cn?O=yt(w,h,ep):(G0(h),O=yt(w,h,ep),H0(h,!1)),Go(),O!==null){Ya=O;return}}else{var G=Dt(w,h);if(G!==null){G.flags&=eg,Ya=G;return}if((h.mode&Hr)!==Cn){H0(h,!1);for(var K=h.actualDuration,ae=h.child;ae!==null;)K+=ae.actualDuration,ae=ae.sibling;h.actualDuration=K}if(R!==null)R.flags|=Ts,R.subtreeFlags=On,R.deletions=null;else{Zs=sI,Ya=null;return}}var pe=h.sibling;if(pe!==null){Ya=pe;return}h=R,Ya=h}while(h!==null);Zs===id&&(Zs=_D)}function Pv(l,h,w){var R=$l(),O=Ws.transition;try{Ws.transition=null,Aa(Es),Zk(l,h,w,R)}finally{Ws.transition=O,Aa(R)}return null}function Zk(l,h,w,R){do Im();while(T_!==null);if(oF(),(so&(Os|wc))!==gs)throw new Error("Should not already be working.");var O=l.finishedWork,G=l.finishedLanes;if(K_(G),O===null)return kp(),null;if(G===yi&&A("root.finishedLanes should not be empty during a commit. This is a bug in React."),l.finishedWork=null,l.finishedLanes=yi,O===l.current)throw new Error("Cannot commit the same tree as before. This error is likely caused by a bug in React. Please file an issue.");l.callbackNode=null,l.callbackPriority=ua;var K=_r(O.lanes,O.childLanes);bg(l,K),l===Tc&&(Tc=null,Ya=null,qs=yi),((O.subtreeFlags&_d)!==On||(O.flags&_d)!==On)&&(Dv||(Dv=!0,dI=w,wI(Fu,function(){return Im(),null})));var ae=(O.subtreeFlags&(yh|af|vh|_d))!==On,pe=(O.flags&(yh|af|vh|_d))!==On;if(ae||pe){var Oe=Ws.transition;Ws.transition=null;var Ve=$l();Aa(Es);var gt=so;so|=wc,Qf.current=null,Jn(l,O),mE(),Ni(l,O,G),Ly(l.containerInfo),l.current=O,Q_(G),Vo(O,l,G),px(),ku(),so=gt,Aa(Ve),Ws.transition=Oe}else l.current=O,mE();var pt=Dv;if(Dv?(Dv=!1,T_=l,Bw=G):(hb=0,BE=null),K=l.pendingLanes,K===yi&&(ub=null),pt||kD(l.current,!1),Hb(O.stateNode,R),dc&&l.memoizedUpdaters.clear(),ME(),fu(l,ya()),h!==null)for(var Ht=l.onRecoverableError,$t=0;$t<h.length;$t++){var oi=h[$t],Ji=oi.stack,Vn=oi.digest;Ht(oi.value,{componentStack:Ji,digest:Vn})}if(zE){zE=!1;var An=uI;throw uI=null,An}return lr(Bw,Yn)&&l.tag!==Of&&Im(),K=l.pendingLanes,lr(K,Yn)?(WC(),l===fI?Vw++:(Vw=0,fI=l)):Vw=0,kf(),kp(),null}function Im(){if(T_!==null){var l=dy(Bw),h=yx(mc,l),w=Ws.transition,R=$l();try{return Ws.transition=null,Aa(h),Yk()}finally{Aa(R),Ws.transition=w}}return!1}function Xk(l){hI.push(l),Dv||(Dv=!0,wI(Fu,function(){return Im(),null}))}function Yk(){if(T_===null)return!1;var l=dI;dI=null;var h=T_,w=Bw;if(T_=null,Bw=yi,(so&(Os|wc))!==gs)throw new Error("Cannot flush passive effects while already rendering.");pI=!0,NE=!1,hg(w);var R=so;so|=wc,is(h.current),ts(h,h.current,w,l);{var O=hI;hI=[];for(var G=0;G<O.length;G++){var K=O[G];ut(h,K)}}dg(),kD(h.current,!0),so=R,kf(),NE?h===BE?hb++:(hb=0,BE=h):hb=0,pI=!1,NE=!1,lg(h);{var ae=h.current.stateNode;ae.effectDuration=0,ae.passiveEffectDuration=0}return!0}function MD(l){return ub!==null&&ub.has(l)}function Kk(l){ub===null?ub=new Set([l]):ub.add(l)}function Jk(l){zE||(zE=!0,uI=l)}var Qk=Jk;function PD(l,h,w){var R=Tm(w,h),O=vE(l,R,Yn),G=_c(l,O,Yn),K=Sc();G!==null&&(Hl(G,Yn,K),fu(G,K))}function fa(l,h,w){if(Wt(w),Hw(!1),l.tag===X){PD(l,l,w);return}var R=null;for(R=h;R!==null;){if(R.tag===X){PD(R,l,w);return}else if(R.tag===N){var O=R.type,G=R.stateNode;if(typeof O.getDerivedStateFromError=="function"||typeof G.componentDidCatch=="function"&&!MD(G)){var K=Tm(w,l),ae=Sw(R,K,Yn),pe=_c(R,ae,Yn),Oe=Sc();pe!==null&&(Hl(pe,Yn,Oe),fu(pe,Oe));return}}R=R.return}A(`Internal React error: Attempted to capture a commit phase error inside a detached tree. This indicates a bug in React. Likely causes include deleting the same fiber more than once, committing an already-finished tree, or an inconsistent return pointer.

Error message:

%s`,w)}function eF(l,h,w){var R=l.pingCache;R!==null&&R.delete(h);var O=Sc();jp(l,w),cF(l),Tc===l&&pc(qs,w)&&(Zs===kw||Zs===cb&&Uu(qs)&&ya()-cI<yD?Mv(l,yi):LE=_r(LE,w)),fu(l,O)}function OD(l,h){h===ua&&(h=kk(l));var w=Sc(),R=Xl(l,h);R!==null&&(Hl(R,h,w),fu(R,w))}function tF(l){var h=l.memoizedState,w=ua;h!==null&&(w=h.retryLane),OD(l,w)}function iF(l,h){var w=ua,R;switch(l.tag){case Ye:R=l.stateNode;var O=l.memoizedState;O!==null&&(w=O.retryLane);break;case si:R=l.stateNode;break;default:throw new Error("Pinged unknown suspense boundary type. This is probably a bug in React.")}R!==null&&R.delete(h),OD(l,w)}function nF(l){return l<120?120:l<480?480:l<1080?1080:l<1920?1920:l<3e3?3e3:l<4320?4320:kE(l/1960)*1960}function rF(){if(Vw>Pk)throw Vw=0,fI=null,new Error("Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. React limits the number of nested updates to prevent infinite loops.");hb>Ok&&(hb=0,BE=null,A("Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render."))}function oF(){Yu.flushLegacyContextWarning(),Yu.flushPendingUnsafeLifecycleWarnings()}function kD(l,h){vo(l),HE(l,Vl,ed),h&&HE(l,of,sb),HE(l,Vl,b_),h&&HE(l,of,Jf),Go()}function HE(l,h,w){for(var R=l,O=null;R!==null;){var G=R.subtreeFlags&h;R!==O&&R.child!==null&&G!==On?R=R.child:((R.flags&h)!==On&&w(R),R.sibling!==null?R=R.sibling:R=O=R.return)}}var $E=null;function FD(l){{if((so&Os)!==gs||!(l.mode&Nn))return;var h=l.tag;if(h!==H&&h!==X&&h!==N&&h!==L&&h!==Ke&&h!==mt&&h!==Ct)return;var w=yn(l)||"ReactComponent";if($E!==null){if($E.has(w))return;$E.add(w)}else $E=new Set([w]);var R=aa;try{vo(l),A("Can't perform a React state update on a component that hasn't mounted yet. This indicates that you have a side-effect in your render function that asynchronously later calls tries to update the component. Move this work to useEffect instead.")}finally{R?vo(l):Go()}}}var vI;{var aF=null;vI=function(l,h,w){var R=GD(aF,h);try{return Pe(l,h,w)}catch(G){if($S()||G!==null&&typeof G=="object"&&typeof G.then=="function")throw G;if(Yy(),_m(),nt(l,h),GD(h,R),h.mode&Hr&&G0(h),gh(null,Pe,null,l,h,w),W_()){var O=nf();typeof O=="object"&&O!==null&&O._suppressLogging&&typeof G=="object"&&G!==null&&!G._suppressLogging&&(G._suppressLogging=!0)}throw G}}}var LD=!1,xI;xI=new Set;function sF(l){if(gl&&!$C())switch(l.tag){case L:case Ke:case Ct:{var h=Ya&&yn(Ya)||"Unknown",w=h;if(!xI.has(w)){xI.add(w);var R=yn(l)||"Unknown";A("Cannot update a component (`%s`) while rendering a different component (`%s`). To locate the bad setState() call inside `%s`, follow the stack trace as described in https://reactjs.org/link/setstate-in-render",R,h,h)}break}case N:{LD||(A("Cannot update during an existing state transition (such as within `render`). Render methods should be a pure function of props and state."),LD=!0);break}}}function Gw(l,h){if(dc){var w=l.memoizedUpdaters;w.forEach(function(R){Gp(l,R,h)})}}var bI={};function wI(l,h){{var w=rh.current;return w!==null?(w.push(h),bI):X_(l,h)}}function zD(l){if(l!==bI)return hx(l)}function ND(){return rh.current!==null}function lF(l){{if(l.mode&Nn){if(!OE())return}else if(!aI()||so!==gs||l.tag!==L&&l.tag!==Ke&&l.tag!==Ct)return;if(rh.current===null){var h=aa;try{vo(l),A(`An update to %s inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act`,yn(l))}finally{h?vo(l):Go()}}}}function cF(l){l.tag!==Of&&OE()&&rh.current===null&&A(`A suspended resource finished loading inside a test, but the event was not wrapped in act(...).

When testing, code that resolves suspended data should be wrapped into act(...):

act(() => {
  /* finish loading suspended data */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act`)}function Hw(l){bD=l}var nd=null,db=null,uF=function(l){nd=l};function fb(l){{if(nd===null)return l;var h=nd(l);return h===void 0?l:h.current}}function TI(l){return fb(l)}function SI(l){{if(nd===null)return l;var h=nd(l);if(h===void 0){if(l!=null&&typeof l.render=="function"){var w=fb(l.render);if(l.render!==w){var R={$$typeof:W,render:w};return l.displayName!==void 0&&(R.displayName=l.displayName),R}}return l}return h.current}}function BD(l,h){{if(nd===null)return!1;var w=l.elementType,R=h.type,O=!1,G=typeof R=="object"&&R!==null?R.$$typeof:null;switch(l.tag){case N:{typeof R=="function"&&(O=!0);break}case L:{(typeof R=="function"||G===ye)&&(O=!0);break}case Ke:{(G===W||G===ye)&&(O=!0);break}case mt:case Ct:{(G===we||G===ye)&&(O=!0);break}default:return!1}if(O){var K=nd(w);if(K!==void 0&&K===nd(R))return!0}return!1}}function VD(l){{if(nd===null||typeof WeakSet!="function")return;db===null&&(db=new WeakSet),db.add(l)}}var hF=function(l,h){{if(nd===null)return;var w=h.staleFamilies,R=h.updatedFamilies;Im(),Cm(function(){EI(l.current,R,w)})}},dF=function(l,h){{if(l.context!==al)return;Im(),Cm(function(){$w(h,l,null,null)})}};function EI(l,h,w){{var R=l.alternate,O=l.child,G=l.sibling,K=l.tag,ae=l.type,pe=null;switch(K){case L:case Ct:case N:pe=ae;break;case Ke:pe=ae.render;break}if(nd===null)throw new Error("Expected resolveFamily to be set during hot reload.");var Oe=!1,Ve=!1;if(pe!==null){var gt=nd(pe);gt!==void 0&&(w.has(gt)?Ve=!0:h.has(gt)&&(K===N?Ve=!0:Oe=!0))}if(db!==null&&(db.has(l)||R!==null&&db.has(R))&&(Ve=!0),Ve&&(l._debugNeedsRemount=!0),Ve||Oe){var pt=Xl(l,Yn);pt!==null&&Xs(pt,l,Yn,xn)}O!==null&&!Ve&&EI(O,h,w),G!==null&&EI(G,h,w)}}var fF=function(l,h){{var w=new Set,R=new Set(h.map(function(O){return O.current}));return AI(l.current,R,w),w}};function AI(l,h,w){{var R=l.child,O=l.sibling,G=l.tag,K=l.type,ae=null;switch(G){case L:case Ct:case N:ae=K;break;case Ke:ae=K.render;break}var pe=!1;ae!==null&&h.has(ae)&&(pe=!0),pe?pF(l,w):R!==null&&AI(R,h,w),O!==null&&AI(O,h,w)}}function pF(l,h){{var w=mF(l,h);if(w)return;for(var R=l;;){switch(R.tag){case he:h.add(R.stateNode);return;case re:h.add(R.stateNode.containerInfo);return;case X:h.add(R.stateNode.containerInfo);return}if(R.return===null)throw new Error("Expected to reach root first.");R=R.return}}}function mF(l,h){for(var w=l,R=!1;;){if(w.tag===he)R=!0,h.add(w.stateNode);else if(w.child!==null){w.child.return=w,w=w.child;continue}if(w===l)return R;for(;w.sibling===null;){if(w.return===null||w.return===l)return R;w=w.return}w.sibling.return=w.return,w=w.sibling}return!1}var CI;{CI=!1;try{var UD=Object.preventExtensions({})}catch{CI=!0}}function gF(l,h,w,R){this.tag=l,this.key=w,this.elementType=null,this.type=null,this.stateNode=null,this.return=null,this.child=null,this.sibling=null,this.index=0,this.ref=null,this.pendingProps=h,this.memoizedProps=null,this.updateQueue=null,this.memoizedState=null,this.dependencies=null,this.mode=R,this.flags=On,this.subtreeFlags=On,this.deletions=null,this.lanes=yi,this.childLanes=yi,this.alternate=null,this.actualDuration=Number.NaN,this.actualStartTime=Number.NaN,this.selfBaseDuration=Number.NaN,this.treeBaseDuration=Number.NaN,this.actualDuration=0,this.actualStartTime=-1,this.selfBaseDuration=0,this.treeBaseDuration=0,this._debugSource=null,this._debugOwner=null,this._debugNeedsRemount=!1,this._debugHookTypes=null,!CI&&typeof Object.preventExtensions=="function"&&Object.preventExtensions(this)}var oh=function(l,h,w,R){return new gF(l,h,w,R)};function II(l){var h=l.prototype;return!!(h&&h.isReactComponent)}function _F(l){return typeof l=="function"&&!II(l)&&l.defaultProps===void 0}function yF(l){if(typeof l=="function")return II(l)?N:L;if(l!=null){var h=l.$$typeof;if(h===W)return Ke;if(h===we)return mt}return H}function Ov(l,h){var w=l.alternate;w===null?(w=oh(l.tag,h,l.key,l.mode),w.elementType=l.elementType,w.type=l.type,w.stateNode=l.stateNode,w._debugSource=l._debugSource,w._debugOwner=l._debugOwner,w._debugHookTypes=l._debugHookTypes,w.alternate=l,l.alternate=w):(w.pendingProps=h,w.type=l.type,w.flags=On,w.subtreeFlags=On,w.deletions=null,w.actualDuration=0,w.actualStartTime=-1),w.flags=l.flags&jc,w.childLanes=l.childLanes,w.lanes=l.lanes,w.child=l.child,w.memoizedProps=l.memoizedProps,w.memoizedState=l.memoizedState,w.updateQueue=l.updateQueue;var R=l.dependencies;switch(w.dependencies=R===null?null:{lanes:R.lanes,firstContext:R.firstContext},w.sibling=l.sibling,w.index=l.index,w.ref=l.ref,w.selfBaseDuration=l.selfBaseDuration,w.treeBaseDuration=l.treeBaseDuration,w._debugNeedsRemount=l._debugNeedsRemount,w.tag){case H:case L:case Ct:w.type=fb(l.type);break;case N:w.type=TI(l.type);break;case Ke:w.type=SI(l.type);break}return w}function vF(l,h){l.flags&=jc|la;var w=l.alternate;if(w===null)l.childLanes=yi,l.lanes=h,l.child=null,l.subtreeFlags=On,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null,l.selfBaseDuration=0,l.treeBaseDuration=0;else{l.childLanes=w.childLanes,l.lanes=w.lanes,l.child=w.child,l.subtreeFlags=On,l.deletions=null,l.memoizedProps=w.memoizedProps,l.memoizedState=w.memoizedState,l.updateQueue=w.updateQueue,l.type=w.type;var R=w.dependencies;l.dependencies=R===null?null:{lanes:R.lanes,firstContext:R.firstContext},l.selfBaseDuration=w.selfBaseDuration,l.treeBaseDuration=w.treeBaseDuration}return l}function xF(l,h,w){var R;return l===Jx?(R=Nn,h===!0&&(R|=ca,R|=Ul)):R=Cn,dc&&(R|=Hr),oh(X,null,null,R)}function RI(l,h,w,R,O,G){var K=H,ae=l;if(typeof l=="function")II(l)?(K=N,ae=TI(ae)):ae=fb(ae);else if(typeof l=="string")K=he;else e:switch(l){case hn:return A_(w.children,O,G,h);case Ko:K=xe,O|=ca,(O&Nn)!==Cn&&(O|=Ul);break;case it:return bF(w,O,G,h);case Y:return wF(w,O,G,h);case ue:return TF(w,O,G,h);case ze:return jD(w,O,G,h);case We:case Me:case xt:case ht:case je:default:{if(typeof l=="object"&&l!==null)switch(l.$$typeof){case bi:K=Le;break e;case ie:K=$e;break e;case W:K=Ke,ae=SI(ae);break e;case we:K=mt;break e;case ye:K=Vt,ae=null;break e}var pe="";{(l===void 0||typeof l=="object"&&l!==null&&Object.keys(l).length===0)&&(pe+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var Oe=R?yn(R):null;Oe&&(pe+=`

Check the render method of \``+Oe+"`.")}throw new Error("Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) "+("but got: "+(l==null?l:typeof l)+"."+pe))}}var Ve=oh(K,w,h,O);return Ve.elementType=l,Ve.type=ae,Ve.lanes=G,Ve._debugOwner=R,Ve}function DI(l,h,w){var R=null;R=l._owner;var O=l.type,G=l.key,K=l.props,ae=RI(O,G,K,R,h,w);return ae._debugSource=l._source,ae._debugOwner=l._owner,ae}function A_(l,h,w,R){var O=oh(ve,l,R,h);return O.lanes=w,O}function bF(l,h,w,R){typeof l.id!="string"&&A('Profiler must specify an "id" of type `string` as a prop. Received the type `%s` instead.',typeof l.id);var O=oh(Ge,l,R,h|Hr);return O.elementType=it,O.lanes=w,O.stateNode={effectDuration:0,passiveEffectDuration:0},O}function wF(l,h,w,R){var O=oh(Ye,l,R,h);return O.elementType=Y,O.lanes=w,O}function TF(l,h,w,R){var O=oh(si,l,R,h);return O.elementType=ue,O.lanes=w,O}function jD(l,h,w,R){var O=oh(Nt,l,R,h);O.elementType=ze,O.lanes=w;var G={isHidden:!1};return O.stateNode=G,O}function MI(l,h,w){var R=oh(de,l,null,h);return R.lanes=w,R}function SF(){var l=oh(he,null,null,Cn);return l.elementType="DELETED",l}function EF(l){var h=oh(Di,null,null,Cn);return h.stateNode=l,h}function PI(l,h,w){var R=l.children!==null?l.children:[],O=oh(re,R,l.key,h);return O.lanes=w,O.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},O}function GD(l,h){return l===null&&(l=oh(H,null,null,Cn)),l.tag=h.tag,l.key=h.key,l.elementType=h.elementType,l.type=h.type,l.stateNode=h.stateNode,l.return=h.return,l.child=h.child,l.sibling=h.sibling,l.index=h.index,l.ref=h.ref,l.pendingProps=h.pendingProps,l.memoizedProps=h.memoizedProps,l.updateQueue=h.updateQueue,l.memoizedState=h.memoizedState,l.dependencies=h.dependencies,l.mode=h.mode,l.flags=h.flags,l.subtreeFlags=h.subtreeFlags,l.deletions=h.deletions,l.lanes=h.lanes,l.childLanes=h.childLanes,l.alternate=h.alternate,l.actualDuration=h.actualDuration,l.actualStartTime=h.actualStartTime,l.selfBaseDuration=h.selfBaseDuration,l.treeBaseDuration=h.treeBaseDuration,l._debugSource=h._debugSource,l._debugOwner=h._debugOwner,l._debugNeedsRemount=h._debugNeedsRemount,l._debugHookTypes=h._debugHookTypes,l}function AF(l,h,w,R,O){this.tag=h,this.containerInfo=l,this.pendingChildren=null,this.current=null,this.pingCache=null,this.finishedWork=null,this.timeoutHandle=Ng,this.context=null,this.pendingContext=null,this.callbackNode=null,this.callbackPriority=ua,this.eventTimes=Up(yi),this.expirationTimes=Up(xn),this.pendingLanes=yi,this.suspendedLanes=yi,this.pingedLanes=yi,this.expiredLanes=yi,this.mutableReadLanes=yi,this.finishedLanes=yi,this.entangledLanes=yi,this.entanglements=Up(yi),this.identifierPrefix=R,this.onRecoverableError=O,this.mutableSourceEagerHydrationData=null,this.effectDuration=0,this.passiveEffectDuration=0;{this.memoizedUpdaters=new Set;for(var G=this.pendingUpdatersLaneMap=[],K=0;K<Ar;K++)G.push(new Set)}switch(h){case Jx:this._debugRootType=w?"hydrateRoot()":"createRoot()";break;case Of:this._debugRootType=w?"hydrate()":"render()";break}}function HD(l,h,w,R,O,G,K,ae,pe,Oe){var Ve=new AF(l,h,w,ae,pe),gt=xF(h,G);Ve.current=gt,gt.stateNode=Ve;{var pt={element:R,isDehydrated:w,cache:null,transitions:null,pendingSuspenseBoundaries:null};gt.memoizedState=pt}return x0(gt),Ve}var OI="18.3.1";function CF(l,h,w){var R=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return co(R),{$$typeof:Ma,key:R==null?null:""+R,children:l,containerInfo:h,implementation:w}}var kI,FI;kI=!1,FI={};function $D(l){if(!l)return al;var h=Nc(l),w=IC(h);if(h.tag===N){var R=h.type;if(eu(R))return Yx(h,R,w)}return w}function IF(l,h){{var w=Nc(l);if(w===void 0){if(typeof l.render=="function")throw new Error("Unable to find node on an unmounted component.");var R=Object.keys(l).join(",");throw new Error("Argument appears to not be a ReactComponent. Keys: "+R)}var O=ig(w);if(O===null)return null;if(O.mode&ca){var G=yn(w)||"Component";if(!FI[G]){FI[G]=!0;var K=aa;try{vo(O),w.mode&ca?A("%s is deprecated in StrictMode. %s was passed an instance of %s which is inside StrictMode. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",h,h,G):A("%s is deprecated in StrictMode. %s was passed an instance of %s which renders StrictMode children. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",h,h,G)}finally{K?vo(K):Go()}}}return O.stateNode}}function WD(l,h,w,R,O,G,K,ae){var pe=!1,Oe=null;return HD(l,h,pe,Oe,w,R,O,G,K)}function qD(l,h,w,R,O,G,K,ae,pe,Oe){var Ve=!0,gt=HD(w,R,Ve,l,O,G,K,ae,pe);gt.context=$D(null);var pt=gt.current,Ht=Sc(),$t=S_(pt),oi=th(Ht,$t);return oi.callback=h??null,_c(pt,oi,$t),Fk(gt,$t,Ht),gt}function $w(l,h,w,R){dx(h,l);var O=h.current,G=Sc(),K=S_(O);$b(K);var ae=$D(w);h.context===null?h.context=ae:h.pendingContext=ae,gl&&aa!==null&&!kI&&(kI=!0,A(`Render methods should be a pure function of props and state; triggering nested component updates from render is not allowed. If necessary, trigger nested updates in componentDidUpdate.

Check the render method of %s.`,yn(aa)||"Unknown"));var pe=th(G,K);pe.payload={element:l},R=R===void 0?null:R,R!==null&&(typeof R!="function"&&A("render(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",R),pe.callback=R);var Oe=_c(O,pe,K);return Oe!==null&&(Xs(Oe,O,K,G),yc(Oe,O,K)),K}function WE(l){var h=l.current;if(!h.child)return null;switch(h.child.tag){case he:return h.child.stateNode;default:return h.child.stateNode}}function RF(l){switch(l.tag){case X:{var h=l.stateNode;if(Sg(h)){var w=ly(h);Bk(h,w)}break}case Ye:{Cm(function(){var O=Xl(l,Yn);if(O!==null){var G=Sc();Xs(O,l,Yn,G)}});var R=Yn;LI(l,R);break}}}function ZD(l,h){var w=l.memoizedState;w!==null&&w.dehydrated!==null&&(w.retryLane=Vp(w.retryLane,h))}function LI(l,h){ZD(l,h);var w=l.alternate;w&&ZD(w,h)}function DF(l){if(l.tag===Ye){var h=zp,w=Xl(l,h);if(w!==null){var R=Sc();Xs(w,l,h,R)}LI(l,h)}}function MF(l){if(l.tag===Ye){var h=S_(l),w=Xl(l,h);if(w!==null){var R=Sc();Xs(w,l,h,R)}LI(l,h)}}function XD(l){var h=lf(l);return h===null?null:h.stateNode}var YD=function(l){return null};function PF(l){return YD(l)}var KD=function(l){return!1};function OF(l){return KD(l)}var JD=null,QD=null,eM=null,tM=null,iM=null,nM=null,rM=null,oM=null,aM=null;{var sM=function(l,h,w){var R=h[w],O=Er(l)?l.slice():ei({},l);return w+1===h.length?(Er(O)?O.splice(R,1):delete O[R],O):(O[R]=sM(l[R],h,w+1),O)},lM=function(l,h){return sM(l,h,0)},cM=function(l,h,w,R){var O=h[R],G=Er(l)?l.slice():ei({},l);if(R+1===h.length){var K=w[R];G[K]=G[O],Er(G)?G.splice(O,1):delete G[O]}else G[O]=cM(l[O],h,w,R+1);return G},uM=function(l,h,w){if(h.length!==w.length){E("copyWithRename() expects paths of the same length");return}else for(var R=0;R<w.length-1;R++)if(h[R]!==w[R]){E("copyWithRename() expects paths to be the same except for the deepest key");return}return cM(l,h,w,0)},hM=function(l,h,w,R){if(w>=h.length)return R;var O=h[w],G=Er(l)?l.slice():ei({},l);return G[O]=hM(l[O],h,w+1,R),G},dM=function(l,h,w){return hM(l,h,0,w)},zI=function(l,h){for(var w=l.memoizedState;w!==null&&h>0;)w=w.next,h--;return w};JD=function(l,h,w,R){var O=zI(l,h);if(O!==null){var G=dM(O.memoizedState,w,R);O.memoizedState=G,O.baseState=G,l.memoizedProps=ei({},l.memoizedProps);var K=Xl(l,Yn);K!==null&&Xs(K,l,Yn,xn)}},QD=function(l,h,w){var R=zI(l,h);if(R!==null){var O=lM(R.memoizedState,w);R.memoizedState=O,R.baseState=O,l.memoizedProps=ei({},l.memoizedProps);var G=Xl(l,Yn);G!==null&&Xs(G,l,Yn,xn)}},eM=function(l,h,w,R){var O=zI(l,h);if(O!==null){var G=uM(O.memoizedState,w,R);O.memoizedState=G,O.baseState=G,l.memoizedProps=ei({},l.memoizedProps);var K=Xl(l,Yn);K!==null&&Xs(K,l,Yn,xn)}},tM=function(l,h,w){l.pendingProps=dM(l.memoizedProps,h,w),l.alternate&&(l.alternate.pendingProps=l.pendingProps);var R=Xl(l,Yn);R!==null&&Xs(R,l,Yn,xn)},iM=function(l,h){l.pendingProps=lM(l.memoizedProps,h),l.alternate&&(l.alternate.pendingProps=l.pendingProps);var w=Xl(l,Yn);w!==null&&Xs(w,l,Yn,xn)},nM=function(l,h,w){l.pendingProps=uM(l.memoizedProps,h,w),l.alternate&&(l.alternate.pendingProps=l.pendingProps);var R=Xl(l,Yn);R!==null&&Xs(R,l,Yn,xn)},rM=function(l){var h=Xl(l,Yn);h!==null&&Xs(h,l,Yn,xn)},oM=function(l){YD=l},aM=function(l){KD=l}}function kF(l){var h=ig(l);return h===null?null:h.stateNode}function FF(l){return null}function LF(){return aa}function zF(l){var h=l.findFiberByHostInstance,w=u.ReactCurrentDispatcher;return bh({bundleType:l.bundleType,version:l.version,rendererPackageName:l.rendererPackageName,rendererConfig:l.rendererConfig,overrideHookState:JD,overrideHookStateDeletePath:QD,overrideHookStateRenamePath:eM,overrideProps:tM,overridePropsDeletePath:iM,overridePropsRenamePath:nM,setErrorHandler:oM,setSuspenseHandler:aM,scheduleUpdate:rM,currentDispatcherRef:w,findHostInstanceByFiber:kF,findFiberByHostInstance:h||FF,findHostInstancesForRefresh:fF,scheduleRefresh:hF,scheduleRoot:dF,setRefreshHandler:uF,getCurrentFiber:LF,reconcilerVersion:OI})}var fM=typeof reportError=="function"?reportError:function(l){console.error(l)};function NI(l){this._internalRoot=l}qE.prototype.render=NI.prototype.render=function(l){var h=this._internalRoot;if(h===null)throw new Error("Cannot update an unmounted root.");{typeof arguments[1]=="function"?A("render(...): does not support the second callback argument. To execute a side effect after rendering, declare it in a component body with useEffect()."):ZE(arguments[1])?A("You passed a container to the second argument of root.render(...). You don't need to pass it again since you already passed it to create the root."):typeof arguments[1]<"u"&&A("You passed a second argument to root.render(...) but it only accepts one argument.");var w=h.containerInfo;if(w.nodeType!==zo){var R=XD(h.current);R&&R.parentNode!==w&&A("render(...): It looks like the React-rendered content of the root container was removed without using React. This is not supported and will cause errors. Instead, call root.unmount() to empty a root's container.")}}$w(l,h,null,null)},qE.prototype.unmount=NI.prototype.unmount=function(){typeof arguments[0]=="function"&&A("unmount(...): does not support a callback argument. To execute a side effect after rendering, declare it in a component body with useEffect().");var l=this._internalRoot;if(l!==null){this._internalRoot=null;var h=l.containerInfo;ED()&&A("Attempted to synchronously unmount a root while React was already rendering. React cannot finish unmounting the root until the current render has completed, which may lead to a race condition."),Cm(function(){$w(null,l,null,null)}),$x(h)}};function NF(l,h){if(!ZE(l))throw new Error("createRoot(...): Target container is not a DOM element.");pM(l);var w=!1,R=!1,O="",G=fM;h!=null&&(h.hydrate?E("hydrate through createRoot is deprecated. Use ReactDOMClient.hydrateRoot(container, <App />) instead."):typeof h=="object"&&h!==null&&h.$$typeof===Ga&&A(`You passed a JSX element to createRoot. You probably meant to call root.render instead. Example usage:

  let root = createRoot(domContainer);
  root.render(<App />);`),h.unstable_strictMode===!0&&(w=!0),h.identifierPrefix!==void 0&&(O=h.identifierPrefix),h.onRecoverableError!==void 0&&(G=h.onRecoverableError),h.transitionCallbacks!==void 0&&h.transitionCallbacks);var K=WD(l,Jx,null,w,R,O,G);jy(K.current,l);var ae=l.nodeType===zo?l.parentNode:l;return Md(ae),new NI(K)}function qE(l){this._internalRoot=l}function BF(l){l&&Hu(l)}qE.prototype.unstable_scheduleHydration=BF;function VF(l,h,w){if(!ZE(l))throw new Error("hydrateRoot(...): Target container is not a DOM element.");pM(l),h===void 0&&A("Must provide initial children as second argument to hydrateRoot. Example usage: hydrateRoot(domContainer, <App />)");var R=w??null,O=w!=null&&w.hydratedSources||null,G=!1,K=!1,ae="",pe=fM;w!=null&&(w.unstable_strictMode===!0&&(G=!0),w.identifierPrefix!==void 0&&(ae=w.identifierPrefix),w.onRecoverableError!==void 0&&(pe=w.onRecoverableError));var Oe=qD(h,null,l,Jx,R,G,K,ae,pe);if(jy(Oe.current,l),Md(l),O)for(var Ve=0;Ve<O.length;Ve++){var gt=O[Ve];UC(Oe,gt)}return new qE(Oe)}function ZE(l){return!!(l&&(l.nodeType===Ja||l.nodeType===sa||l.nodeType===Xd))}function Ww(l){return!!(l&&(l.nodeType===Ja||l.nodeType===sa||l.nodeType===Xd||l.nodeType===zo&&l.nodeValue===" react-mount-point-unstable "))}function pM(l){l.nodeType===Ja&&l.tagName&&l.tagName.toUpperCase()==="BODY"&&A("createRoot(): Creating roots directly with document.body is discouraged, since its children are often manipulated by third-party scripts and browser extensions. This may lead to subtle reconciliation issues. Try using a container element created for your app."),im(l)&&(l._reactRootContainer?A("You are calling ReactDOMClient.createRoot() on a container that was previously passed to ReactDOM.render(). This is not supported."):A("You are calling ReactDOMClient.createRoot() on a container that has already been passed to createRoot() before. Instead, call root.render() on the existing root instead if you want to update it."))}var UF=u.ReactCurrentOwner,mM;mM=function(l){if(l._reactRootContainer&&l.nodeType!==zo){var h=XD(l._reactRootContainer.current);h&&h.parentNode!==l&&A("render(...): It looks like the React-rendered content of this container was removed without using React. This is not supported and will cause errors. Instead, call ReactDOM.unmountComponentAtNode to empty a container.")}var w=!!l._reactRootContainer,R=BI(l),O=!!(R&&Jc(R));O&&!w&&A("render(...): Replacing React-rendered children with a new root component. If you intended to update the children of this node, you should instead have the existing children update their state and render the new components instead of calling ReactDOM.render."),l.nodeType===Ja&&l.tagName&&l.tagName.toUpperCase()==="BODY"&&A("render(): Rendering components directly into document.body is discouraged, since its children are often manipulated by third-party scripts and browser extensions. This may lead to subtle reconciliation issues. Try rendering into a container element created for your app.")};function BI(l){return l?l.nodeType===sa?l.documentElement:l.firstChild:null}function gM(){}function jF(l,h,w,R,O){if(O){if(typeof R=="function"){var G=R;R=function(){var pt=WE(K);G.call(pt)}}var K=qD(h,R,l,Of,null,!1,!1,"",gM);l._reactRootContainer=K,jy(K.current,l);var ae=l.nodeType===zo?l.parentNode:l;return Md(ae),Cm(),K}else{for(var pe;pe=l.lastChild;)l.removeChild(pe);if(typeof R=="function"){var Oe=R;R=function(){var pt=WE(Ve);Oe.call(pt)}}var Ve=WD(l,Of,null,!1,!1,"",gM);l._reactRootContainer=Ve,jy(Ve.current,l);var gt=l.nodeType===zo?l.parentNode:l;return Md(gt),Cm(function(){$w(h,Ve,w,R)}),Ve}}function GF(l,h){l!==null&&typeof l!="function"&&A("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",h,l)}function XE(l,h,w,R,O){mM(w),GF(O===void 0?null:O,"render");var G=w._reactRootContainer,K;if(!G)K=jF(w,h,l,O,R);else{if(K=G,typeof O=="function"){var ae=O;O=function(){var pe=WE(K);ae.call(pe)}}$w(h,K,l,O)}return WE(K)}var _M=!1;function HF(l){{_M||(_M=!0,A("findDOMNode is deprecated and will be removed in the next major release. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node"));var h=UF.current;if(h!==null&&h.stateNode!==null){var w=h.stateNode._warnedAboutRefsInRender;w||A("%s is accessing findDOMNode inside its render(). render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",Gr(h.type)||"A component"),h.stateNode._warnedAboutRefsInRender=!0}}return l==null?null:l.nodeType===Ja?l:IF(l,"findDOMNode")}function $F(l,h,w){if(A("ReactDOM.hydrate is no longer supported in React 18. Use hydrateRoot instead. Until you switch to the new API, your app will behave as if it's running React 17. Learn more: https://reactjs.org/link/switch-to-createroot"),!Ww(h))throw new Error("Target container is not a DOM element.");{var R=im(h)&&h._reactRootContainer===void 0;R&&A("You are calling ReactDOM.hydrate() on a container that was previously passed to ReactDOMClient.createRoot(). This is not supported. Did you mean to call hydrateRoot(container, element)?")}return XE(null,l,h,!0,w)}function WF(l,h,w){if(A("ReactDOM.render is no longer supported in React 18. Use createRoot instead. Until you switch to the new API, your app will behave as if it's running React 17. Learn more: https://reactjs.org/link/switch-to-createroot"),!Ww(h))throw new Error("Target container is not a DOM element.");{var R=im(h)&&h._reactRootContainer===void 0;R&&A("You are calling ReactDOM.render() on a container that was previously passed to ReactDOMClient.createRoot(). This is not supported. Did you mean to call root.render(element)?")}return XE(null,l,h,!1,w)}function qF(l,h,w,R){if(A("ReactDOM.unstable_renderSubtreeIntoContainer() is no longer supported in React 18. Consider using a portal instead. Until you switch to the createRoot API, your app will behave as if it's running React 17. Learn more: https://reactjs.org/link/switch-to-createroot"),!Ww(w))throw new Error("Target container is not a DOM element.");if(l==null||!lx(l))throw new Error("parentComponent must be a valid React Component");return XE(l,h,w,!1,R)}var yM=!1;function ZF(l){if(yM||(yM=!0,A("unmountComponentAtNode is deprecated and will be removed in the next major release. Switch to the createRoot API. Learn more: https://reactjs.org/link/switch-to-createroot")),!Ww(l))throw new Error("unmountComponentAtNode(...): Target container is not a DOM element.");{var h=im(l)&&l._reactRootContainer===void 0;h&&A("You are calling ReactDOM.unmountComponentAtNode() on a container that was previously passed to ReactDOMClient.createRoot(). This is not supported. Did you mean to call root.unmount()?")}if(l._reactRootContainer){{var w=BI(l),R=w&&!Jc(w);R&&A("unmountComponentAtNode(): The node you're attempting to unmount was rendered by another copy of React.")}return Cm(function(){XE(null,null,l,!1,function(){l._reactRootContainer=null,$x(l)})}),!0}else{{var O=BI(l),G=!!(O&&Jc(O)),K=l.nodeType===Ja&&Ww(l.parentNode)&&!!l.parentNode._reactRootContainer;G&&A("unmountComponentAtNode(): The node you're attempting to unmount was rendered by React and is not a top-level container. %s",K?"You may have accidentally passed in a React root node instead of its container.":"Instead, have the parent component update its state and rerender in order to remove this component.")}return!1}}oo(RF),qb(DF),$p(MF),py($l),Wl(gx),(typeof Map!="function"||Map.prototype==null||typeof Map.prototype.forEach!="function"||typeof Set!="function"||Set.prototype==null||typeof Set.prototype.clear!="function"||typeof Set.prototype.forEach!="function")&&A("React depends on Map and Set built-in types. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),Wm(hS),ax(gI,Vk,Cm);function XF(l,h){var w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!ZE(h))throw new Error("Target container is not a DOM element.");return CF(l,h,null,w)}function YF(l,h,w,R){return qF(l,h,w,R)}var VI={usingClientEntryPoint:!1,Events:[Jc,Wg,Wx,nx,H_,gI]};function KF(l,h){return VI.usingClientEntryPoint||A('You are importing createRoot from "react-dom" which is not supported. You should instead import it from "react-dom/client".'),NF(l,h)}function JF(l,h,w){return VI.usingClientEntryPoint||A('You are importing hydrateRoot from "react-dom" which is not supported. You should instead import it from "react-dom/client".'),VF(l,h,w)}function QF(l){return ED()&&A("flushSync was called from inside a lifecycle method. React cannot flush when React is already rendering. Consider moving this call to a scheduler task or micro task."),Cm(l)}var eL=zF({findFiberByHostInstance:Od,bundleType:1,version:OI,rendererPackageName:"react-dom"});if(!eL&&Xi&&window.top===window.self&&(navigator.userAgent.indexOf("Chrome")>-1&&navigator.userAgent.indexOf("Edge")===-1||navigator.userAgent.indexOf("Firefox")>-1)){var vM=window.location.protocol;/^(https?|file):$/.test(vM)&&console.info("%cDownload the React DevTools for a better development experience: https://reactjs.org/link/react-devtools"+(vM==="file:"?`
You might need to use a local HTTP server (instead of file://): https://reactjs.org/link/react-devtools-faq`:""),"font-weight:bold")}sh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=VI,sh.createPortal=XF,sh.createRoot=KF,sh.findDOMNode=HF,sh.flushSync=QF,sh.hydrate=$F,sh.hydrateRoot=JF,sh.render=WF,sh.unmountComponentAtNode=ZF,sh.unstable_batchedUpdates=gI,sh.unstable_renderSubtreeIntoContainer=YF,sh.version=OI,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)})();MO.exports=sh;var uL=MO.exports,UI=uL;{var YE=UI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;dR.createRoot=function(d,s){YE.usingClientEntryPoint=!0;try{return UI.createRoot(d,s)}finally{YE.usingClientEntryPoint=!1}},dR.hydrateRoot=function(d,s,u){YE.usingClientEntryPoint=!0;try{return UI.hydrateRoot(d,s,u)}finally{YE.usingClientEntryPoint=!1}}}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function xT(){return xT=Object.assign?Object.assign.bind():function(d){for(var s=1;s<arguments.length;s++){var u=arguments[s];for(var _ in u)Object.prototype.hasOwnProperty.call(u,_)&&(d[_]=u[_])}return d},xT.apply(this,arguments)}var R_;(function(d){d.Pop="POP",d.Push="PUSH",d.Replace="REPLACE"})(R_||(R_={}));const xM="popstate";function hL(d){d===void 0&&(d={});function s(_,v){let{pathname:E,search:A,hash:r}=_.location;return fR("",{pathname:E,search:A,hash:r},v.state&&v.state.usr||null,v.state&&v.state.key||"default")}function u(_,v){return typeof v=="string"?v:bT(v)}return fL(s,u,null,d)}function ja(d,s){if(d===!1||d===null||typeof d>"u")throw new Error(s)}function Gd(d,s){if(!d){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function dL(){return Math.random().toString(36).substr(2,8)}function bM(d,s){return{usr:d.state,key:d.key,idx:s}}function fR(d,s,u,_){return u===void 0&&(u=null),xT({pathname:typeof d=="string"?d:d.pathname,search:"",hash:""},typeof s=="string"?Pb(s):s,{state:u,key:s&&s.key||_||dL()})}function bT(d){let{pathname:s="/",search:u="",hash:_=""}=d;return u&&u!=="?"&&(s+=u.charAt(0)==="?"?u:"?"+u),_&&_!=="#"&&(s+=_.charAt(0)==="#"?_:"#"+_),s}function Pb(d){let s={};if(d){let u=d.indexOf("#");u>=0&&(s.hash=d.substr(u),d=d.substr(0,u));let _=d.indexOf("?");_>=0&&(s.search=d.substr(_),d=d.substr(0,_)),d&&(s.pathname=d)}return s}function fL(d,s,u,_){_===void 0&&(_={});let{window:v=document.defaultView,v5Compat:E=!1}=_,A=v.history,r=R_.Pop,L=null,N=H();N==null&&(N=0,A.replaceState(xT({},A.state,{idx:N}),""));function H(){return(A.state||{idx:null}).idx}function X(){r=R_.Pop;let xe=H(),$e=xe==null?null:xe-N;N=xe,L&&L({action:r,location:ve.location,delta:$e})}function re(xe,$e){r=R_.Push;let Le=fR(ve.location,xe,$e);N=H()+1;let Ke=bM(Le,N),Ge=ve.createHref(Le);try{A.pushState(Ke,"",Ge)}catch(Ye){if(Ye instanceof DOMException&&Ye.name==="DataCloneError")throw Ye;v.location.assign(Ge)}E&&L&&L({action:r,location:ve.location,delta:1})}function he(xe,$e){r=R_.Replace;let Le=fR(ve.location,xe,$e);N=H();let Ke=bM(Le,N),Ge=ve.createHref(Le);A.replaceState(Ke,"",Ge),E&&L&&L({action:r,location:ve.location,delta:0})}function de(xe){let $e=v.location.origin!=="null"?v.location.origin:v.location.href,Le=typeof xe=="string"?xe:bT(xe);return Le=Le.replace(/ $/,"%20"),ja($e,"No window.location.(origin|href) available to create URL for href: "+Le),new URL(Le,$e)}let ve={get action(){return r},get location(){return d(v,A)},listen(xe){if(L)throw new Error("A history only accepts one active listener");return v.addEventListener(xM,X),L=xe,()=>{v.removeEventListener(xM,X),L=null}},createHref(xe){return s(v,xe)},createURL:de,encodeLocation(xe){let $e=de(xe);return{pathname:$e.pathname,search:$e.search,hash:$e.hash}},push:re,replace:he,go(xe){return A.go(xe)}};return ve}var wM;(function(d){d.data="data",d.deferred="deferred",d.redirect="redirect",d.error="error"})(wM||(wM={}));function pL(d,s,u){return u===void 0&&(u="/"),mL(d,s,u)}function mL(d,s,u,_){let v=typeof s=="string"?Pb(s):s,E=L_(v.pathname||"/",u);if(E==null)return null;let A=kO(d);gL(A);let r=null;for(let L=0;r==null&&L<A.length;++L){let N=CL(E);r=EL(A[L],N)}return r}function kO(d,s,u,_){s===void 0&&(s=[]),u===void 0&&(u=[]),_===void 0&&(_="");let v=(E,A,r)=>{let L={relativePath:r===void 0?E.path||"":r,caseSensitive:E.caseSensitive===!0,childrenIndex:A,route:E};L.relativePath.startsWith("/")&&(ja(L.relativePath.startsWith(_),'Absolute route path "'+L.relativePath+'" nested under path '+('"'+_+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),L.relativePath=L.relativePath.slice(_.length));let N=Fm([_,L.relativePath]),H=u.concat(L);E.children&&E.children.length>0&&(ja(E.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+N+'".')),kO(E.children,s,H,N)),!(E.path==null&&!E.index)&&s.push({path:N,score:TL(N,E.index),routesMeta:H})};return d.forEach((E,A)=>{var r;if(E.path===""||!((r=E.path)!=null&&r.includes("?")))v(E,A);else for(let L of FO(E.path))v(E,A,L)}),s}function FO(d){let s=d.split("/");if(s.length===0)return[];let[u,..._]=s,v=u.endsWith("?"),E=u.replace(/\?$/,"");if(_.length===0)return v?[E,""]:[E];let A=FO(_.join("/")),r=[];return r.push(...A.map(L=>L===""?E:[E,L].join("/"))),v&&r.push(...A),r.map(L=>d.startsWith("/")&&L===""?"/":L)}function gL(d){d.sort((s,u)=>s.score!==u.score?u.score-s.score:SL(s.routesMeta.map(_=>_.childrenIndex),u.routesMeta.map(_=>_.childrenIndex)))}const _L=/^:[\w-]+$/,yL=3,vL=2,xL=1,bL=10,wL=-2,TM=d=>d==="*";function TL(d,s){let u=d.split("/"),_=u.length;return u.some(TM)&&(_+=wL),s&&(_+=vL),u.filter(v=>!TM(v)).reduce((v,E)=>v+(_L.test(E)?yL:E===""?xL:bL),_)}function SL(d,s){return d.length===s.length&&d.slice(0,-1).every((_,v)=>_===s[v])?d[d.length-1]-s[s.length-1]:0}function EL(d,s,u){let{routesMeta:_}=d,v={},E="/",A=[];for(let r=0;r<_.length;++r){let L=_[r],N=r===_.length-1,H=E==="/"?s:s.slice(E.length)||"/",X=pR({path:L.relativePath,caseSensitive:L.caseSensitive,end:N},H),re=L.route;if(!X)return null;Object.assign(v,X.params),A.push({params:v,pathname:Fm([E,X.pathname]),pathnameBase:ML(Fm([E,X.pathnameBase])),route:re}),X.pathnameBase!=="/"&&(E=Fm([E,X.pathnameBase]))}return A}function pR(d,s){typeof d=="string"&&(d={path:d,caseSensitive:!1,end:!0});let[u,_]=AL(d.path,d.caseSensitive,d.end),v=s.match(u);if(!v)return null;let E=v[0],A=E.replace(/(.)\/+$/,"$1"),r=v.slice(1);return{params:_.reduce((N,H,X)=>{let{paramName:re,isOptional:he}=H;if(re==="*"){let ve=r[X]||"";A=E.slice(0,E.length-ve.length).replace(/(.)\/+$/,"$1")}const de=r[X];return he&&!de?N[re]=void 0:N[re]=(de||"").replace(/%2F/g,"/"),N},{}),pathname:E,pathnameBase:A,pattern:d}}function AL(d,s,u){s===void 0&&(s=!1),u===void 0&&(u=!0),Gd(d==="*"||!d.endsWith("*")||d.endsWith("/*"),'Route path "'+d+'" will be treated as if it were '+('"'+d.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+d.replace(/\*$/,"/*")+'".'));let _=[],v="^"+d.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(A,r,L)=>(_.push({paramName:r,isOptional:L!=null}),L?"/?([^\\/]+)?":"/([^\\/]+)"));return d.endsWith("*")?(_.push({paramName:"*"}),v+=d==="*"||d==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):u?v+="\\/*$":d!==""&&d!=="/"&&(v+="(?:(?=\\/|$))"),[new RegExp(v,s?void 0:"i"),_]}function CL(d){try{return d.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return Gd(!1,'The URL path "'+d+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),d}}function L_(d,s){if(s==="/")return d;if(!d.toLowerCase().startsWith(s.toLowerCase()))return null;let u=s.endsWith("/")?s.length-1:s.length,_=d.charAt(u);return _&&_!=="/"?null:d.slice(u)||"/"}function IL(d,s){s===void 0&&(s="/");let{pathname:u,search:_="",hash:v=""}=typeof d=="string"?Pb(d):d;return{pathname:u?u.startsWith("/")?u:RL(u,s):s,search:PL(_),hash:OL(v)}}function RL(d,s){let u=s.replace(/\/+$/,"").split("/");return d.split("/").forEach(v=>{v===".."?u.length>1&&u.pop():v!=="."&&u.push(v)}),u.length>1?u.join("/"):"/"}function jI(d,s,u,_){return"Cannot include a '"+d+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(_)+"].  Please separate it out to the ")+("`to."+u+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function DL(d){return d.filter((s,u)=>u===0||s.route.path&&s.route.path.length>0)}function FR(d,s){let u=DL(d);return s?u.map((_,v)=>v===u.length-1?_.pathname:_.pathnameBase):u.map(_=>_.pathnameBase)}function LR(d,s,u,_){_===void 0&&(_=!1);let v;typeof d=="string"?v=Pb(d):(v=xT({},d),ja(!v.pathname||!v.pathname.includes("?"),jI("?","pathname","search",v)),ja(!v.pathname||!v.pathname.includes("#"),jI("#","pathname","hash",v)),ja(!v.search||!v.search.includes("#"),jI("#","search","hash",v)));let E=d===""||v.pathname==="",A=E?"/":v.pathname,r;if(A==null)r=u;else{let X=s.length-1;if(!_&&A.startsWith("..")){let re=A.split("/");for(;re[0]==="..";)re.shift(),X-=1;v.pathname=re.join("/")}r=X>=0?s[X]:"/"}let L=IL(v,r),N=A&&A!=="/"&&A.endsWith("/"),H=(E||A===".")&&u.endsWith("/");return!L.pathname.endsWith("/")&&(N||H)&&(L.pathname+="/"),L}const Fm=d=>d.join("/").replace(/\/\/+/g,"/"),ML=d=>d.replace(/\/+$/,"").replace(/^\/*/,"/"),PL=d=>!d||d==="?"?"":d.startsWith("?")?d:"?"+d,OL=d=>!d||d==="#"?"":d.startsWith("#")?d:"#"+d;function kL(d){return d!=null&&typeof d.status=="number"&&typeof d.statusText=="string"&&typeof d.internal=="boolean"&&"data"in d}const LO=["post","put","patch","delete"];new Set(LO);const FL=["get",...LO];new Set(FL);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function wT(){return wT=Object.assign?Object.assign.bind():function(d){for(var s=1;s<arguments.length;s++){var u=arguments[s];for(var _ in u)Object.prototype.hasOwnProperty.call(u,_)&&(d[_]=u[_])}return d},wT.apply(this,arguments)}const DT=ft.createContext(null);DT.displayName="DataRouter";const zR=ft.createContext(null);zR.displayName="DataRouterState";const LL=ft.createContext(null);LL.displayName="Await";const sd=ft.createContext(null);sd.displayName="Navigation";const MT=ft.createContext(null);MT.displayName="Location";const hp=ft.createContext({outlet:null,matches:[],isDataRoute:!1});hp.displayName="Route";const NR=ft.createContext(null);NR.displayName="RouteError";function zL(d,s){let{relative:u}=s===void 0?{}:s;Ob()||ja(!1,"useHref() may be used only in the context of a <Router> component.");let{basename:_,navigator:v}=ft.useContext(sd),{hash:E,pathname:A,search:r}=PT(d,{relative:u}),L=A;return _!=="/"&&(L=A==="/"?_:Fm([_,A])),v.createHref({pathname:L,search:r,hash:E})}function Ob(){return ft.useContext(MT)!=null}function Kv(){return Ob()||ja(!1,"useLocation() may be used only in the context of a <Router> component."),ft.useContext(MT).location}const zO="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function NO(d){ft.useContext(sd).static||ft.useLayoutEffect(d)}function VA(){let{isDataRoute:d}=ft.useContext(hp);return d?KL():NL()}function NL(){Ob()||ja(!1,"useNavigate() may be used only in the context of a <Router> component.");let d=ft.useContext(DT),{basename:s,future:u,navigator:_}=ft.useContext(sd),{matches:v}=ft.useContext(hp),{pathname:E}=Kv(),A=JSON.stringify(FR(v,u.v7_relativeSplatPath)),r=ft.useRef(!1);return NO(()=>{r.current=!0}),ft.useCallback(function(N,H){if(H===void 0&&(H={}),Gd(r.current,zO),!r.current)return;if(typeof N=="number"){_.go(N);return}let X=LR(N,JSON.parse(A),E,H.relative==="path");d==null&&s!=="/"&&(X.pathname=X.pathname==="/"?s:Fm([s,X.pathname])),(H.replace?_.replace:_.push)(X,H.state,H)},[s,_,A,E,d])}function PT(d,s){let{relative:u}=s===void 0?{}:s,{future:_}=ft.useContext(sd),{matches:v}=ft.useContext(hp),{pathname:E}=Kv(),A=JSON.stringify(FR(v,_.v7_relativeSplatPath));return ft.useMemo(()=>LR(d,JSON.parse(A),E,u==="path"),[d,A,E,u])}function BL(d,s){return VL(d,s)}function VL(d,s,u,_){Ob()||ja(!1,"useRoutes() may be used only in the context of a <Router> component.");let{navigator:v}=ft.useContext(sd),{matches:E}=ft.useContext(hp),A=E[E.length-1],r=A?A.params:{},L=A?A.pathname:"/",N=A?A.pathnameBase:"/",H=A&&A.route;{let Le=H&&H.path||"";VO(L,!H||Le.endsWith("*"),"You rendered descendant <Routes> (or called `useRoutes()`) at "+('"'+L+'" (under <Route path="'+Le+'">) but the ')+`parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

`+('Please change the parent <Route path="'+Le+'"> to <Route ')+('path="'+(Le==="/"?"*":Le+"/*")+'">.'))}let X=Kv(),re;if(s){var he;let Le=typeof s=="string"?Pb(s):s;N==="/"||(he=Le.pathname)!=null&&he.startsWith(N)||ja(!1,"When overriding the location using `<Routes location>` or `useRoutes(routes, location)`, the location pathname must begin with the portion of the URL pathname that was "+('matched by all parent routes. The current pathname base is "'+N+'" ')+('but pathname "'+Le.pathname+'" was given in the `location` prop.')),re=Le}else re=X;let de=re.pathname||"/",ve=de;if(N!=="/"){let Le=N.replace(/^\//,"").split("/");ve="/"+de.replace(/^\//,"").split("/").slice(Le.length).join("/")}let xe=pL(d,{pathname:ve});Gd(H||xe!=null,'No routes matched location "'+re.pathname+re.search+re.hash+'" '),Gd(xe==null||xe[xe.length-1].route.element!==void 0||xe[xe.length-1].route.Component!==void 0||xe[xe.length-1].route.lazy!==void 0,'Matched leaf route at location "'+re.pathname+re.search+re.hash+'" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.');let $e=$L(xe&&xe.map(Le=>Object.assign({},Le,{params:Object.assign({},r,Le.params),pathname:Fm([N,v.encodeLocation?v.encodeLocation(Le.pathname).pathname:Le.pathname]),pathnameBase:Le.pathnameBase==="/"?N:Fm([N,v.encodeLocation?v.encodeLocation(Le.pathnameBase).pathname:Le.pathnameBase])})),E,u,_);return s&&$e?ft.createElement(MT.Provider,{value:{location:wT({pathname:"/",search:"",hash:"",state:null,key:"default"},re),navigationType:R_.Pop}},$e):$e}function UL(){let d=YL(),s=kL(d)?d.status+" "+d.statusText:d instanceof Error?d.message:JSON.stringify(d),u=d instanceof Error?d.stack:null,_="rgba(200,200,200, 0.5)",v={padding:"0.5rem",backgroundColor:_},E={padding:"2px 4px",backgroundColor:_},A=null;return console.error("Error handled by React Router default ErrorBoundary:",d),A=ft.createElement(ft.Fragment,null,ft.createElement("p",null," Hey developer "),ft.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ft.createElement("code",{style:E},"ErrorBoundary")," or"," ",ft.createElement("code",{style:E},"errorElement")," prop on your route.")),ft.createElement(ft.Fragment,null,ft.createElement("h2",null,"Unexpected Application Error!"),ft.createElement("h3",{style:{fontStyle:"italic"}},s),u?ft.createElement("pre",{style:v},u):null,A)}const jL=ft.createElement(UL,null);class GL extends ft.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,u){return u.location!==s.location||u.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:u.error,location:u.location,revalidation:s.revalidation||u.revalidation}}componentDidCatch(s,u){console.error("React Router caught the following error during render",s,u)}render(){return this.state.error!==void 0?ft.createElement(hp.Provider,{value:this.props.routeContext},ft.createElement(NR.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function HL(d){let{routeContext:s,match:u,children:_}=d,v=ft.useContext(DT);return v&&v.static&&v.staticContext&&(u.route.errorElement||u.route.ErrorBoundary)&&(v.staticContext._deepestRenderedBoundaryId=u.route.id),ft.createElement(hp.Provider,{value:s},_)}function $L(d,s,u,_){var v;if(s===void 0&&(s=[]),u===void 0&&(u=null),_===void 0&&(_=null),d==null){var E;if(!u)return null;if(u.errors)d=u.matches;else if((E=_)!=null&&E.v7_partialHydration&&s.length===0&&!u.initialized&&u.matches.length>0)d=u.matches;else return null}let A=d,r=(v=u)==null?void 0:v.errors;if(r!=null){let H=A.findIndex(X=>X.route.id&&(r==null?void 0:r[X.route.id])!==void 0);H>=0||ja(!1,"Could not find a matching route for errors on route IDs: "+Object.keys(r).join(",")),A=A.slice(0,Math.min(A.length,H+1))}let L=!1,N=-1;if(u&&_&&_.v7_partialHydration)for(let H=0;H<A.length;H++){let X=A[H];if((X.route.HydrateFallback||X.route.hydrateFallbackElement)&&(N=H),X.route.id){let{loaderData:re,errors:he}=u,de=X.route.loader&&re[X.route.id]===void 0&&(!he||he[X.route.id]===void 0);if(X.route.lazy||de){L=!0,N>=0?A=A.slice(0,N+1):A=[A[0]];break}}}return A.reduceRight((H,X,re)=>{let he,de=!1,ve=null,xe=null;u&&(he=r&&X.route.id?r[X.route.id]:void 0,ve=X.route.errorElement||jL,L&&(N<0&&re===0?(VO("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),de=!0,xe=null):N===re&&(de=!0,xe=X.route.hydrateFallbackElement||null)));let $e=s.concat(A.slice(0,re+1)),Le=()=>{let Ke;return he?Ke=ve:de?Ke=xe:X.route.Component?Ke=ft.createElement(X.route.Component,null):X.route.element?Ke=X.route.element:Ke=H,ft.createElement(HL,{match:X,routeContext:{outlet:H,matches:$e,isDataRoute:u!=null},children:Ke})};return u&&(X.route.ErrorBoundary||X.route.errorElement||re===0)?ft.createElement(GL,{location:u.location,revalidation:u.revalidation,component:ve,error:he,children:Le(),routeContext:{outlet:null,matches:$e,isDataRoute:!0}}):Le()},null)}var BO=function(d){return d.UseBlocker="useBlocker",d.UseRevalidator="useRevalidator",d.UseNavigateStable="useNavigate",d}(BO||{}),TT=function(d){return d.UseBlocker="useBlocker",d.UseLoaderData="useLoaderData",d.UseActionData="useActionData",d.UseRouteError="useRouteError",d.UseNavigation="useNavigation",d.UseRouteLoaderData="useRouteLoaderData",d.UseMatches="useMatches",d.UseRevalidator="useRevalidator",d.UseNavigateStable="useNavigate",d.UseRouteId="useRouteId",d}(TT||{});function BR(d){return d+" must be used within a data router.  See https://reactrouter.com/v6/routers/picking-a-router."}function WL(d){let s=ft.useContext(DT);return s||ja(!1,BR(d)),s}function qL(d){let s=ft.useContext(zR);return s||ja(!1,BR(d)),s}function ZL(d){let s=ft.useContext(hp);return s||ja(!1,BR(d)),s}function VR(d){let s=ZL(d),u=s.matches[s.matches.length-1];return u.route.id||ja(!1,d+' can only be used on routes that contain a unique "id"'),u.route.id}function XL(){return VR(TT.UseRouteId)}function YL(){var d;let s=ft.useContext(NR),u=qL(TT.UseRouteError),_=VR(TT.UseRouteError);return s!==void 0?s:(d=u.errors)==null?void 0:d[_]}function KL(){let{router:d}=WL(BO.UseNavigateStable),s=VR(TT.UseNavigateStable),u=ft.useRef(!1);return NO(()=>{u.current=!0}),ft.useCallback(function(v,E){E===void 0&&(E={}),Gd(u.current,zO),u.current&&(typeof v=="number"?d.navigate(v):d.navigate(v,wT({fromRouteId:s},E)))},[d,s])}const SM={};function VO(d,s,u){!s&&!SM[d]&&(SM[d]=!0,Gd(!1,u))}const EM={};function JL(d,s){EM[s]||(EM[s]=!0,console.warn(s))}const AM=(d,s,u)=>JL(d," React Router Future Flag Warning: "+s+". "+("You can use the `"+d+"` future flag to opt-in early. ")+("For more information, see "+u+"."));function QL(d,s){(d==null?void 0:d.v7_startTransition)===void 0&&AM("v7_startTransition","React Router will begin wrapping state updates in `React.startTransition` in v7","https://reactrouter.com/v6/upgrading/future#v7_starttransition"),(d==null?void 0:d.v7_relativeSplatPath)===void 0&&AM("v7_relativeSplatPath","Relative route resolution within Splat routes is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_relativesplatpath")}function UO(d){let{to:s,replace:u,state:_,relative:v}=d;Ob()||ja(!1,"<Navigate> may be used only in the context of a <Router> component.");let{future:E,static:A}=ft.useContext(sd);Gd(!A,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:r}=ft.useContext(hp),{pathname:L}=Kv(),N=VA(),H=LR(s,FR(r,E.v7_relativeSplatPath),L,v==="path"),X=JSON.stringify(H);return ft.useEffect(()=>N(JSON.parse(X),{replace:u,state:_,relative:v}),[N,X,v,u,_]),null}function vb(d){ja(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function ez(d){let{basename:s="/",children:u=null,location:_,navigationType:v=R_.Pop,navigator:E,static:A=!1,future:r}=d;Ob()&&ja(!1,"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let L=s.replace(/^\/*/,"/"),N=ft.useMemo(()=>({basename:L,navigator:E,static:A,future:wT({v7_relativeSplatPath:!1},r)}),[L,r,E,A]);typeof _=="string"&&(_=Pb(_));let{pathname:H="/",search:X="",hash:re="",state:he=null,key:de="default"}=_,ve=ft.useMemo(()=>{let xe=L_(H,L);return xe==null?null:{location:{pathname:xe,search:X,hash:re,state:he,key:de},navigationType:v}},[L,H,X,re,he,de,v]);return Gd(ve!=null,'<Router basename="'+L+'"> is not able to match the URL '+('"'+H+X+re+'" because it does not start with the ')+"basename, so the <Router> won't render anything."),ve==null?null:ft.createElement(sd.Provider,{value:N},ft.createElement(MT.Provider,{children:u,value:ve}))}function tz(d){let{children:s,location:u}=d;return BL(mR(s),u)}new Promise(()=>{});function mR(d,s){s===void 0&&(s=[]);let u=[];return ft.Children.forEach(d,(_,v)=>{if(!ft.isValidElement(_))return;let E=[...s,v];if(_.type===ft.Fragment){u.push.apply(u,mR(_.props.children,E));return}_.type!==vb&&ja(!1,"["+(typeof _.type=="string"?_.type:_.type.name)+"] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>"),!_.props.index||!_.props.children||ja(!1,"An index route cannot have child routes.");let A={id:_.props.id||E.join("-"),caseSensitive:_.props.caseSensitive,element:_.props.element,Component:_.props.Component,index:_.props.index,path:_.props.path,loader:_.props.loader,action:_.props.action,errorElement:_.props.errorElement,ErrorBoundary:_.props.ErrorBoundary,hasErrorBoundary:_.props.ErrorBoundary!=null||_.props.errorElement!=null,shouldRevalidate:_.props.shouldRevalidate,handle:_.props.handle,lazy:_.props.lazy};_.props.children&&(A.children=mR(_.props.children,E)),u.push(A)}),u}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ab(){return Ab=Object.assign?Object.assign.bind():function(d){for(var s=1;s<arguments.length;s++){var u=arguments[s];for(var _ in u)Object.prototype.hasOwnProperty.call(u,_)&&(d[_]=u[_])}return d},Ab.apply(this,arguments)}function UR(d,s){if(d==null)return{};var u={},_=Object.keys(d),v,E;for(E=0;E<_.length;E++)v=_[E],!(s.indexOf(v)>=0)&&(u[v]=d[v]);return u}const mA="get",gA="application/x-www-form-urlencoded";function UA(d){return d!=null&&typeof d.tagName=="string"}function iz(d){return UA(d)&&d.tagName.toLowerCase()==="button"}function nz(d){return UA(d)&&d.tagName.toLowerCase()==="form"}function rz(d){return UA(d)&&d.tagName.toLowerCase()==="input"}function oz(d){return!!(d.metaKey||d.altKey||d.ctrlKey||d.shiftKey)}function az(d,s){return d.button===0&&(!s||s==="_self")&&!oz(d)}let KE=null;function sz(){if(KE===null)try{new FormData(document.createElement("form"),0),KE=!1}catch{KE=!0}return KE}const lz=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function GI(d){return d!=null&&!lz.has(d)?(Gd(!1,'"'+d+'" is not a valid `encType` for `<Form>`/`<fetcher.Form>` '+('and will default to "'+gA+'"')),null):d}function cz(d,s){let u,_,v,E,A;if(nz(d)){let r=d.getAttribute("action");_=r?L_(r,s):null,u=d.getAttribute("method")||mA,v=GI(d.getAttribute("enctype"))||gA,E=new FormData(d)}else if(iz(d)||rz(d)&&(d.type==="submit"||d.type==="image")){let r=d.form;if(r==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let L=d.getAttribute("formaction")||r.getAttribute("action");if(_=L?L_(L,s):null,u=d.getAttribute("formmethod")||r.getAttribute("method")||mA,v=GI(d.getAttribute("formenctype"))||GI(r.getAttribute("enctype"))||gA,E=new FormData(r,d),!sz()){let{name:N,type:H,value:X}=d;if(H==="image"){let re=N?N+".":"";E.append(re+"x","0"),E.append(re+"y","0")}else N&&E.append(N,X)}}else{if(UA(d))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');u=mA,_=null,v=gA,A=d}return E&&v==="text/plain"&&(A=E,E=void 0),{action:_,method:u.toLowerCase(),encType:v,formData:E,body:A}}const uz=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],hz=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],dz=["fetcherKey","navigate","reloadDocument","replace","state","method","action","onSubmit","relative","preventScrollReset","viewTransition"],fz="6";try{window.__reactRouterVersion=fz}catch{}const jO=ft.createContext({isTransitioning:!1});jO.displayName="ViewTransition";const pz=ft.createContext(new Map);pz.displayName="Fetchers";const mz="startTransition",CM=lL[mz];function gz(d){let{basename:s,children:u,future:_,window:v}=d,E=ft.useRef();E.current==null&&(E.current=hL({window:v,v5Compat:!0}));let A=E.current,[r,L]=ft.useState({action:A.action,location:A.location}),{v7_startTransition:N}=_||{},H=ft.useCallback(X=>{N&&CM?CM(()=>L(X)):L(X)},[L,N]);return ft.useLayoutEffect(()=>A.listen(H),[A,H]),ft.useEffect(()=>QL(_),[_]),ft.createElement(ez,{basename:s,children:u,location:r.location,navigationType:r.action,navigator:A,future:_})}const _z=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",yz=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Cb=ft.forwardRef(function(s,u){let{onClick:_,relative:v,reloadDocument:E,replace:A,state:r,target:L,to:N,preventScrollReset:H,viewTransition:X}=s,re=UR(s,uz),{basename:he}=ft.useContext(sd),de,ve=!1;if(typeof N=="string"&&yz.test(N)&&(de=N,_z))try{let Ke=new URL(window.location.href),Ge=N.startsWith("//")?new URL(Ke.protocol+N):new URL(N),Ye=L_(Ge.pathname,he);Ge.origin===Ke.origin&&Ye!=null?N=Ye+Ge.search+Ge.hash:ve=!0}catch{Gd(!1,'<Link to="'+N+'"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.')}let xe=zL(N,{relative:v}),$e=wz(N,{replace:A,state:r,target:L,preventScrollReset:H,relative:v,viewTransition:X});function Le(Ke){_&&_(Ke),Ke.defaultPrevented||$e(Ke)}return ft.createElement("a",Ab({},re,{href:de||xe,onClick:ve||E?_:Le,ref:u,target:L}))});Cb.displayName="Link";const vz=ft.forwardRef(function(s,u){let{"aria-current":_="page",caseSensitive:v=!1,className:E="",end:A=!1,style:r,to:L,viewTransition:N,children:H}=s,X=UR(s,hz),re=PT(L,{relative:X.relative}),he=Kv(),de=ft.useContext(zR),{navigator:ve,basename:xe}=ft.useContext(sd),$e=de!=null&&Iz(re)&&N===!0,Le=ve.encodeLocation?ve.encodeLocation(re).pathname:re.pathname,Ke=he.pathname,Ge=de&&de.navigation&&de.navigation.location?de.navigation.location.pathname:null;v||(Ke=Ke.toLowerCase(),Ge=Ge?Ge.toLowerCase():null,Le=Le.toLowerCase()),Ge&&xe&&(Ge=L_(Ge,xe)||Ge);const Ye=Le!=="/"&&Le.endsWith("/")?Le.length-1:Le.length;let mt=Ke===Le||!A&&Ke.startsWith(Le)&&Ke.charAt(Ye)==="/",Ct=Ge!=null&&(Ge===Le||!A&&Ge.startsWith(Le)&&Ge.charAt(Le.length)==="/"),Vt={isActive:mt,isPending:Ct,isTransitioning:$e},ui=mt?_:void 0,Di;typeof E=="function"?Di=E(Vt):Di=[E,mt?"active":null,Ct?"pending":null,$e?"transitioning":null].filter(Boolean).join(" ");let si=typeof r=="function"?r(Vt):r;return ft.createElement(Cb,Ab({},X,{"aria-current":ui,className:Di,ref:u,style:si,to:L,viewTransition:N}),typeof H=="function"?H(Vt):H)});vz.displayName="NavLink";const xz=ft.forwardRef((d,s)=>{let{fetcherKey:u,navigate:_,reloadDocument:v,replace:E,state:A,method:r=mA,action:L,onSubmit:N,relative:H,preventScrollReset:X,viewTransition:re}=d,he=UR(d,dz),de=Az(),ve=Cz(L,{relative:H}),xe=r.toLowerCase()==="get"?"get":"post",$e=Le=>{if(N&&N(Le),Le.defaultPrevented)return;Le.preventDefault();let Ke=Le.nativeEvent.submitter,Ge=(Ke==null?void 0:Ke.getAttribute("formmethod"))||r;de(Ke||Le.currentTarget,{fetcherKey:u,method:Ge,navigate:_,replace:E,state:A,relative:H,preventScrollReset:X,viewTransition:re})};return ft.createElement("form",Ab({ref:s,method:xe,action:ve,onSubmit:v?N:$e},he))});xz.displayName="Form";var AA;(function(d){d.UseScrollRestoration="useScrollRestoration",d.UseSubmit="useSubmit",d.UseSubmitFetcher="useSubmitFetcher",d.UseFetcher="useFetcher",d.useViewTransitionState="useViewTransitionState"})(AA||(AA={}));var IM;(function(d){d.UseFetcher="useFetcher",d.UseFetchers="useFetchers",d.UseScrollRestoration="useScrollRestoration"})(IM||(IM={}));function bz(d){return d+" must be used within a data router.  See https://reactrouter.com/v6/routers/picking-a-router."}function GO(d){let s=ft.useContext(DT);return s||ja(!1,bz(d)),s}function wz(d,s){let{target:u,replace:_,state:v,preventScrollReset:E,relative:A,viewTransition:r}=s===void 0?{}:s,L=VA(),N=Kv(),H=PT(d,{relative:A});return ft.useCallback(X=>{if(az(X,u)){X.preventDefault();let re=_!==void 0?_:bT(N)===bT(H);L(d,{replace:re,state:v,preventScrollReset:E,relative:A,viewTransition:r})}},[N,L,H,_,v,u,d,E,A,r])}function Tz(){if(typeof document>"u")throw new Error("You are calling submit during the server render. Try calling submit within a `useEffect` or callback instead.")}let Sz=0,Ez=()=>"__"+String(++Sz)+"__";function Az(){let{router:d}=GO(AA.UseSubmit),{basename:s}=ft.useContext(sd),u=XL();return ft.useCallback(function(_,v){v===void 0&&(v={}),Tz();let{action:E,method:A,encType:r,formData:L,body:N}=cz(_,s);if(v.navigate===!1){let H=v.fetcherKey||Ez();d.fetch(H,u,v.action||E,{preventScrollReset:v.preventScrollReset,formData:L,body:N,formMethod:v.method||A,formEncType:v.encType||r,flushSync:v.flushSync})}else d.navigate(v.action||E,{preventScrollReset:v.preventScrollReset,formData:L,body:N,formMethod:v.method||A,formEncType:v.encType||r,replace:v.replace,state:v.state,fromRouteId:u,flushSync:v.flushSync,viewTransition:v.viewTransition})},[d,s,u])}function Cz(d,s){let{relative:u}=s===void 0?{}:s,{basename:_}=ft.useContext(sd),v=ft.useContext(hp);v||ja(!1,"useFormAction must be used inside a RouteContext");let[E]=v.matches.slice(-1),A=Ab({},PT(d||".",{relative:u})),r=Kv();if(d==null){A.search=r.search;let L=new URLSearchParams(A.search),N=L.getAll("index");if(N.some(X=>X==="")){L.delete("index"),N.filter(re=>re).forEach(re=>L.append("index",re));let X=L.toString();A.search=X?"?"+X:""}}return(!d||d===".")&&E.route.index&&(A.search=A.search?A.search.replace(/^\?/,"?index&"):"?index"),_!=="/"&&(A.pathname=A.pathname==="/"?_:Fm([_,A.pathname])),bT(A)}function Iz(d,s){s===void 0&&(s={});let u=ft.useContext(jO);u==null&&ja(!1,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:_}=GO(AA.useViewTransitionState),v=PT(d,{relative:s.relative});if(!u.isTransitioning)return!1;let E=L_(u.currentLocation.pathname,_)||u.currentLocation.pathname,A=L_(u.nextLocation.pathname,_)||u.nextLocation.pathname;return pR(v.pathname,A)!=null||pR(v.pathname,E)!=null}var gR=function(d,s){return gR=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,_){u.__proto__=_}||function(u,_){for(var v in _)Object.prototype.hasOwnProperty.call(_,v)&&(u[v]=_[v])},gR(d,s)};function Rz(d,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");gR(d,s);function u(){this.constructor=d}d.prototype=s===null?Object.create(s):(u.prototype=s.prototype,new u)}var pl=function(){return pl=Object.assign||function(s){for(var u,_=1,v=arguments.length;_<v;_++){u=arguments[_];for(var E in u)Object.prototype.hasOwnProperty.call(u,E)&&(s[E]=u[E])}return s},pl.apply(this,arguments)};function RM(d,s){var u={};for(var _ in d)Object.prototype.hasOwnProperty.call(d,_)&&s.indexOf(_)<0&&(u[_]=d[_]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var v=0,_=Object.getOwnPropertySymbols(d);v<_.length;v++)s.indexOf(_[v])<0&&Object.prototype.propertyIsEnumerable.call(d,_[v])&&(u[_[v]]=d[_[v]]);return u}function mb(d,s,u,_){function v(E){return E instanceof u?E:new u(function(A){A(E)})}return new(u||(u=Promise))(function(E,A){function r(H){try{N(_.next(H))}catch(X){A(X)}}function L(H){try{N(_.throw(H))}catch(X){A(X)}}function N(H){H.done?E(H.value):v(H.value).then(r,L)}N((_=_.apply(d,s||[])).next())})}function gb(d,s){var u={label:0,sent:function(){if(E[0]&1)throw E[1];return E[1]},trys:[],ops:[]},_,v,E,A=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return A.next=r(0),A.throw=r(1),A.return=r(2),typeof Symbol=="function"&&(A[Symbol.iterator]=function(){return this}),A;function r(N){return function(H){return L([N,H])}}function L(N){if(_)throw new TypeError("Generator is already executing.");for(;A&&(A=0,N[0]&&(u=0)),u;)try{if(_=1,v&&(E=N[0]&2?v.return:N[0]?v.throw||((E=v.return)&&E.call(v),0):v.next)&&!(E=E.call(v,N[1])).done)return E;switch(v=0,E&&(N=[N[0]&2,E.value]),N[0]){case 0:case 1:E=N;break;case 4:return u.label++,{value:N[1],done:!1};case 5:u.label++,v=N[1],N=[0];continue;case 7:N=u.ops.pop(),u.trys.pop();continue;default:if(E=u.trys,!(E=E.length>0&&E[E.length-1])&&(N[0]===6||N[0]===2)){u=0;continue}if(N[0]===3&&(!E||N[1]>E[0]&&N[1]<E[3])){u.label=N[1];break}if(N[0]===6&&u.label<E[1]){u.label=E[1],E=N;break}if(E&&u.label<E[2]){u.label=E[2],u.ops.push(N);break}E[2]&&u.ops.pop(),u.trys.pop();continue}N=s.call(d,u)}catch(H){N=[6,H],v=0}finally{_=E=0}if(N[0]&5)throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}}function Dz(d,s,u){for(var _=0,v=s.length,E;_<v;_++)(E||!(_ in s))&&(E||(E=Array.prototype.slice.call(s,0,_)),E[_]=s[_]);return d.concat(E||Array.prototype.slice.call(s))}function ap(d,s){var u={};for(var _ in d)Object.prototype.hasOwnProperty.call(d,_)&&s.indexOf(_)<0&&(u[_]=d[_]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function"){var v=0;for(_=Object.getOwnPropertySymbols(d);v<_.length;v++)s.indexOf(_[v])<0&&Object.prototype.propertyIsEnumerable.call(d,_[v])&&(u[_[v]]=d[_[v]])}return u}var Uv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function jR(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}function GR(d,s){return d(s={exports:{}},s.exports),s.exports}var Nv=GR(function(d,s){Object.defineProperty(s,"__esModule",{value:!0});var u=function(){function _(){var v=this;this.locked=new Map,this.addToLocked=function(E,A){var r=v.locked.get(E);r===void 0?A===void 0?v.locked.set(E,[]):v.locked.set(E,[A]):A!==void 0&&(r.unshift(A),v.locked.set(E,r))},this.isLocked=function(E){return v.locked.has(E)},this.lock=function(E){return new Promise(function(A,r){v.isLocked(E)?v.addToLocked(E,A):(v.addToLocked(E),A())})},this.unlock=function(E){var A=v.locked.get(E);if(A!==void 0&&A.length!==0){var r=A.pop();v.locked.set(E,A),r!==void 0&&setTimeout(r,0)}else v.locked.delete(E)}}return _.getInstance=function(){return _.instance===void 0&&(_.instance=new _),_.instance},_}();s.default=function(){return u.getInstance()}});jR(Nv);var Mz=jR(GR(function(d,s){var u=Uv&&Uv.__awaiter||function(H,X,re,he){return new(re||(re=Promise))(function(de,ve){function xe(Ke){try{Le(he.next(Ke))}catch(Ge){ve(Ge)}}function $e(Ke){try{Le(he.throw(Ke))}catch(Ge){ve(Ge)}}function Le(Ke){Ke.done?de(Ke.value):new re(function(Ge){Ge(Ke.value)}).then(xe,$e)}Le((he=he.apply(H,X||[])).next())})},_=Uv&&Uv.__generator||function(H,X){var re,he,de,ve,xe={label:0,sent:function(){if(1&de[0])throw de[1];return de[1]},trys:[],ops:[]};return ve={next:$e(0),throw:$e(1),return:$e(2)},typeof Symbol=="function"&&(ve[Symbol.iterator]=function(){return this}),ve;function $e(Le){return function(Ke){return function(Ge){if(re)throw new TypeError("Generator is already executing.");for(;xe;)try{if(re=1,he&&(de=2&Ge[0]?he.return:Ge[0]?he.throw||((de=he.return)&&de.call(he),0):he.next)&&!(de=de.call(he,Ge[1])).done)return de;switch(he=0,de&&(Ge=[2&Ge[0],de.value]),Ge[0]){case 0:case 1:de=Ge;break;case 4:return xe.label++,{value:Ge[1],done:!1};case 5:xe.label++,he=Ge[1],Ge=[0];continue;case 7:Ge=xe.ops.pop(),xe.trys.pop();continue;default:if(de=xe.trys,!((de=de.length>0&&de[de.length-1])||Ge[0]!==6&&Ge[0]!==2)){xe=0;continue}if(Ge[0]===3&&(!de||Ge[1]>de[0]&&Ge[1]<de[3])){xe.label=Ge[1];break}if(Ge[0]===6&&xe.label<de[1]){xe.label=de[1],de=Ge;break}if(de&&xe.label<de[2]){xe.label=de[2],xe.ops.push(Ge);break}de[2]&&xe.ops.pop(),xe.trys.pop();continue}Ge=X.call(H,xe)}catch(Ye){Ge=[6,Ye],he=0}finally{re=de=0}if(5&Ge[0])throw Ge[1];return{value:Ge[0]?Ge[1]:void 0,done:!0}}([Le,Ke])}}},v=Uv;Object.defineProperty(s,"__esModule",{value:!0});var E="browser-tabs-lock-key",A={key:function(H){return u(v,void 0,void 0,function(){return _(this,function(X){throw new Error("Unsupported")})})},getItem:function(H){return u(v,void 0,void 0,function(){return _(this,function(X){throw new Error("Unsupported")})})},clear:function(){return u(v,void 0,void 0,function(){return _(this,function(H){return[2,window.localStorage.clear()]})})},removeItem:function(H){return u(v,void 0,void 0,function(){return _(this,function(X){throw new Error("Unsupported")})})},setItem:function(H,X){return u(v,void 0,void 0,function(){return _(this,function(re){throw new Error("Unsupported")})})},keySync:function(H){return window.localStorage.key(H)},getItemSync:function(H){return window.localStorage.getItem(H)},clearSync:function(){return window.localStorage.clear()},removeItemSync:function(H){return window.localStorage.removeItem(H)},setItemSync:function(H,X){return window.localStorage.setItem(H,X)}};function r(H){return new Promise(function(X){return setTimeout(X,H)})}function L(H){for(var X="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",re="",he=0;he<H;he++)re+=X[Math.floor(Math.random()*X.length)];return re}var N=function(){function H(X){this.acquiredIatSet=new Set,this.storageHandler=void 0,this.id=Date.now().toString()+L(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),this.storageHandler=X,H.waiters===void 0&&(H.waiters=[])}return H.prototype.acquireLock=function(X,re){return re===void 0&&(re=5e3),u(this,void 0,void 0,function(){var he,de,ve,xe,$e,Le,Ke;return _(this,function(Ge){switch(Ge.label){case 0:he=Date.now()+L(4),de=Date.now()+re,ve=E+"-"+X,xe=this.storageHandler===void 0?A:this.storageHandler,Ge.label=1;case 1:return Date.now()<de?[4,r(30)]:[3,8];case 2:return Ge.sent(),xe.getItemSync(ve)!==null?[3,5]:($e=this.id+"-"+X+"-"+he,[4,r(Math.floor(25*Math.random()))]);case 3:return Ge.sent(),xe.setItemSync(ve,JSON.stringify({id:this.id,iat:he,timeoutKey:$e,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,r(30)];case 4:return Ge.sent(),(Le=xe.getItemSync(ve))!==null&&(Ke=JSON.parse(Le)).id===this.id&&Ke.iat===he?(this.acquiredIatSet.add(he),this.refreshLockWhileAcquired(ve,he),[2,!0]):[3,7];case 5:return H.lockCorrector(this.storageHandler===void 0?A:this.storageHandler),[4,this.waitForSomethingToChange(de)];case 6:Ge.sent(),Ge.label=7;case 7:return he=Date.now()+L(4),[3,1];case 8:return[2,!1]}})})},H.prototype.refreshLockWhileAcquired=function(X,re){return u(this,void 0,void 0,function(){var he=this;return _(this,function(de){return setTimeout(function(){return u(he,void 0,void 0,function(){var ve,xe,$e;return _(this,function(Le){switch(Le.label){case 0:return[4,Nv.default().lock(re)];case 1:return Le.sent(),this.acquiredIatSet.has(re)?(ve=this.storageHandler===void 0?A:this.storageHandler,(xe=ve.getItemSync(X))===null?(Nv.default().unlock(re),[2]):(($e=JSON.parse(xe)).timeRefreshed=Date.now(),ve.setItemSync(X,JSON.stringify($e)),Nv.default().unlock(re),this.refreshLockWhileAcquired(X,re),[2])):(Nv.default().unlock(re),[2])}})})},1e3),[2]})})},H.prototype.waitForSomethingToChange=function(X){return u(this,void 0,void 0,function(){return _(this,function(re){switch(re.label){case 0:return[4,new Promise(function(he){var de=!1,ve=Date.now(),xe=!1;function $e(){if(xe||(window.removeEventListener("storage",$e),H.removeFromWaiting($e),clearTimeout(Le),xe=!0),!de){de=!0;var Ke=50-(Date.now()-ve);Ke>0?setTimeout(he,Ke):he(null)}}window.addEventListener("storage",$e),H.addToWaiting($e);var Le=setTimeout($e,Math.max(0,X-Date.now()))})];case 1:return re.sent(),[2]}})})},H.addToWaiting=function(X){this.removeFromWaiting(X),H.waiters!==void 0&&H.waiters.push(X)},H.removeFromWaiting=function(X){H.waiters!==void 0&&(H.waiters=H.waiters.filter(function(re){return re!==X}))},H.notifyWaiters=function(){H.waiters!==void 0&&H.waiters.slice().forEach(function(X){return X()})},H.prototype.releaseLock=function(X){return u(this,void 0,void 0,function(){return _(this,function(re){switch(re.label){case 0:return[4,this.releaseLock__private__(X)];case 1:return[2,re.sent()]}})})},H.prototype.releaseLock__private__=function(X){return u(this,void 0,void 0,function(){var re,he,de,ve;return _(this,function(xe){switch(xe.label){case 0:return re=this.storageHandler===void 0?A:this.storageHandler,he=E+"-"+X,(de=re.getItemSync(he))===null?[2]:(ve=JSON.parse(de)).id!==this.id?[3,2]:[4,Nv.default().lock(ve.iat)];case 1:xe.sent(),this.acquiredIatSet.delete(ve.iat),re.removeItemSync(he),Nv.default().unlock(ve.iat),H.notifyWaiters(),xe.label=2;case 2:return[2]}})})},H.lockCorrector=function(X){for(var re=Date.now()-5e3,he=X,de=[],ve=0;;){var xe=he.keySync(ve);if(xe===null)break;de.push(xe),ve++}for(var $e=!1,Le=0;Le<de.length;Le++){var Ke=de[Le];if(Ke.includes(E)){var Ge=he.getItemSync(Ke);if(Ge!==null){var Ye=JSON.parse(Ge);(Ye.timeRefreshed===void 0&&Ye.timeAcquired<re||Ye.timeRefreshed!==void 0&&Ye.timeRefreshed<re)&&(he.removeItemSync(Ke),$e=!0)}}}$e&&H.notifyWaiters()},H.waiters=void 0,H}();s.default=N}));const Pz={timeoutInSeconds:60},HO={name:"auth0-spa-js",version:"2.7.0"},$O=()=>Date.now();class ys extends Error{constructor(s,u){super(u),this.error=s,this.error_description=u,Object.setPrototypeOf(this,ys.prototype)}static fromPayload({error:s,error_description:u}){return new ys(s,u)}}class HR extends ys{constructor(s,u,_,v=null){super(s,u),this.state=_,this.appState=v,Object.setPrototypeOf(this,HR.prototype)}}class $R extends ys{constructor(s,u,_,v,E=null){super(s,u),this.connection=_,this.state=v,this.appState=E,Object.setPrototypeOf(this,$R.prototype)}}class ST extends ys{constructor(){super("timeout","Timeout"),Object.setPrototypeOf(this,ST.prototype)}}class WR extends ST{constructor(s){super(),this.popup=s,Object.setPrototypeOf(this,WR.prototype)}}class qR extends ys{constructor(s){super("cancelled","Popup closed"),this.popup=s,Object.setPrototypeOf(this,qR.prototype)}}class ZR extends ys{constructor(s,u,_){super(s,u),this.mfa_token=_,Object.setPrototypeOf(this,ZR.prototype)}}class jA extends ys{constructor(s,u){super("missing_refresh_token",`Missing Refresh Token (audience: '${CA(s,["default"])}', scope: '${CA(u)}')`),this.audience=s,this.scope=u,Object.setPrototypeOf(this,jA.prototype)}}class XR extends ys{constructor(s,u){super("missing_scopes",`Missing requested scopes after refresh (audience: '${CA(s,["default"])}', missing scope: '${CA(u)}')`),this.audience=s,this.scope=u,Object.setPrototypeOf(this,XR.prototype)}}class GA extends ys{constructor(s){super("use_dpop_nonce","Server rejected DPoP proof: wrong nonce"),this.newDpopNonce=s,Object.setPrototypeOf(this,GA.prototype)}}function CA(d,s=[]){return d&&!s.includes(d)?d:""}const IA=()=>window.crypto,Zw=()=>{const d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.";let s="";return Array.from(IA().getRandomValues(new Uint8Array(43))).forEach(u=>s+=d[u%d.length]),s},HI=d=>btoa(d),_R=d=>{var{clientId:s}=d,u=ap(d,["clientId"]);return new URLSearchParams((_=>Object.keys(_).filter(v=>_[v]!==void 0).reduce((v,E)=>Object.assign(Object.assign({},v),{[E]:_[E]}),{}))(Object.assign({client_id:s},u))).toString()},DM=async d=>await IA().subtle.digest({name:"SHA-256"},new TextEncoder().encode(d)),MM=d=>(s=>decodeURIComponent(atob(s).split("").map(u=>"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)).join("")))(d.replace(/_/g,"/").replace(/-/g,"+")),PM=d=>{const s=new Uint8Array(d);return(u=>{const _={"+":"-","/":"_","=":""};return u.replace(/[+/=]/g,v=>_[v])})(window.btoa(String.fromCharCode(...Array.from(s))))},Oz=new TextEncoder,kz=new TextDecoder;function uT(d){return typeof d=="string"?Oz.encode(d):kz.decode(d)}function OM(d){if(typeof d.modulusLength!="number"||d.modulusLength<2048)throw new Lz(`${d.name} modulusLength must be at least 2048 bits`)}async function Fz(d,s,u){if(u.usages.includes("sign")===!1)throw new TypeError('private CryptoKey instances used for signing assertions must include "sign" in their "usages"');const _=`${hT(uT(JSON.stringify(d)))}.${hT(uT(JSON.stringify(s)))}`;return`${_}.${hT(await crypto.subtle.sign(function(v){switch(v.algorithm.name){case"ECDSA":return{name:v.algorithm.name,hash:"SHA-256"};case"RSA-PSS":return OM(v.algorithm),{name:v.algorithm.name,saltLength:32};case"RSASSA-PKCS1-v1_5":return OM(v.algorithm),{name:v.algorithm.name};case"Ed25519":return{name:v.algorithm.name}}throw new jv}(u),u,uT(_)))}`}let yR;Uint8Array.prototype.toBase64?yR=d=>(d instanceof ArrayBuffer&&(d=new Uint8Array(d)),d.toBase64({alphabet:"base64url",omitPadding:!0})):yR=s=>{s instanceof ArrayBuffer&&(s=new Uint8Array(s));const u=[];for(let _=0;_<s.byteLength;_+=32768)u.push(String.fromCharCode.apply(null,s.subarray(_,_+32768)));return btoa(u.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")};function hT(d){return yR(d)}class jv extends Error{constructor(s){var u;super(s??"operation not supported"),this.name=this.constructor.name,(u=Error.captureStackTrace)===null||u===void 0||u.call(Error,this,this.constructor)}}class Lz extends Error{constructor(s){var u;super(s),this.name=this.constructor.name,(u=Error.captureStackTrace)===null||u===void 0||u.call(Error,this,this.constructor)}}function zz(d){switch(d.algorithm.name){case"RSA-PSS":return function(s){if(s.algorithm.hash.name==="SHA-256")return"PS256";throw new jv("unsupported RsaHashedKeyAlgorithm hash name")}(d);case"RSASSA-PKCS1-v1_5":return function(s){if(s.algorithm.hash.name==="SHA-256")return"RS256";throw new jv("unsupported RsaHashedKeyAlgorithm hash name")}(d);case"ECDSA":return function(s){if(s.algorithm.namedCurve==="P-256")return"ES256";throw new jv("unsupported EcKeyAlgorithm namedCurve")}(d);case"Ed25519":return"Ed25519";default:throw new jv("unsupported CryptoKey algorithm name")}}function WO(d){return d instanceof CryptoKey}function qO(d){return WO(d)&&d.type==="public"}async function Nz(d,s,u,_,v,E){const A=d==null?void 0:d.privateKey,r=d==null?void 0:d.publicKey;if(!WO(L=A)||L.type!=="private")throw new TypeError('"keypair.privateKey" must be a private CryptoKey');var L;if(!qO(r))throw new TypeError('"keypair.publicKey" must be a public CryptoKey');if(r.extractable!==!0)throw new TypeError('"keypair.publicKey.extractable" must be true');if(typeof s!="string")throw new TypeError('"htu" must be a string');if(typeof u!="string")throw new TypeError('"htm" must be a string');if(_!==void 0&&typeof _!="string")throw new TypeError('"nonce" must be a string or undefined');if(v!==void 0&&typeof v!="string")throw new TypeError('"accessToken" must be a string or undefined');return Fz({alg:zz(A),typ:"dpop+jwt",jwk:await ZO(r)},Object.assign(Object.assign({},E),{iat:Math.floor(Date.now()/1e3),jti:crypto.randomUUID(),htm:u,nonce:_,htu:s,ath:v?hT(await crypto.subtle.digest("SHA-256",uT(v))):void 0}),A)}async function ZO(d){const{kty:s,e:u,n:_,x:v,y:E,crv:A}=await crypto.subtle.exportKey("jwk",d);return{kty:s,crv:A,e:u,n:_,x:v,y:E}}const Bz=["authorization_code","refresh_token","urn:ietf:params:oauth:grant-type:token-exchange"];function Vz(){return async function(d,s){var u;let _;if(d.length===0)throw new TypeError('"alg" must be a non-empty string');switch(d){case"PS256":_={name:"RSA-PSS",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"RS256":_={name:"RSASSA-PKCS1-v1_5",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"ES256":_={name:"ECDSA",namedCurve:"P-256"};break;case"Ed25519":_={name:"Ed25519"};break;default:throw new jv}return crypto.subtle.generateKey(_,(u=s==null?void 0:s.extractable)!==null&&u!==void 0&&u,["sign","verify"])}("ES256",{extractable:!1})}function Uz(d){return async function(s){if(!qO(s))throw new TypeError('"publicKey" must be a public CryptoKey');if(s.extractable!==!0)throw new TypeError('"publicKey.extractable" must be true');const u=await ZO(s);let _;switch(u.kty){case"EC":_={crv:u.crv,kty:u.kty,x:u.x,y:u.y};break;case"OKP":_={crv:u.crv,kty:u.kty,x:u.x};break;case"RSA":_={e:u.e,kty:u.kty,n:u.n};break;default:throw new jv("unsupported JWK kty")}return hT(await crypto.subtle.digest({name:"SHA-256"},uT(JSON.stringify(_))))}(d.publicKey)}function jz({keyPair:d,url:s,method:u,nonce:_,accessToken:v}){const E=function(A){const r=new URL(A);return r.search="",r.hash="",r.href}(s);return Nz(d,E,u,_,v)}const Gz=async(d,s)=>{const u=await fetch(d,s);return{ok:u.ok,json:await u.json(),headers:(_=u.headers,[..._].reduce((v,[E,A])=>(v[E]=A,v),{}))};var _},Hz=async(d,s,u)=>{const _=new AbortController;let v;return s.signal=_.signal,Promise.race([Gz(d,s),new Promise((E,A)=>{v=setTimeout(()=>{_.abort(),A(new Error("Timeout when executing 'fetch'"))},u)})]).finally(()=>{clearTimeout(v)})},$z=async(d,s,u,_,v,E,A,r)=>{return L={auth:{audience:s,scope:u},timeout:v,fetchUrl:d,fetchOptions:_,useFormData:A,useMrrt:r},N=E,new Promise(function(H,X){const re=new MessageChannel;re.port1.onmessage=function(he){he.data.error?X(new Error(he.data.error)):H(he.data),re.port1.close()},N.postMessage(L,[re.port2])});var L,N},Wz=async(d,s,u,_,v,E,A=1e4,r)=>v?$z(d,s,u,_,A,v,E,r):Hz(d,_,A);async function XO(d,s,u,_,v,E,A,r,L,N){if(L){const Ke=await L.generateProof({url:d,method:v.method||"GET",nonce:await L.getNonce()});v.headers=Object.assign(Object.assign({},v.headers),{dpop:Ke})}let H,X=null;for(let Ke=0;Ke<3;Ke++)try{H=await Wz(d,u,_,v,E,A,s,r),X=null;break}catch(Ge){X=Ge}if(X)throw X;const re=H.json,{error:he,error_description:de}=re,ve=ap(re,["error","error_description"]),{headers:xe,ok:$e}=H;let Le;if(L&&(Le=xe["dpop-nonce"],Le&&await L.setNonce(Le)),!$e){const Ke=de||`HTTP error. Unable to fetch ${d}`;if(he==="mfa_required")throw new ZR(he,Ke,ve.mfa_token);if(he==="missing_refresh_token")throw new jA(u,_);if(he==="use_dpop_nonce"){if(!L||!Le||N)throw new GA(Le);return XO(d,s,u,_,v,E,A,r,L,!0)}throw new ys(he||"request_error",Ke)}return ve}async function qz(d,s){var{baseUrl:u,timeout:_,audience:v,scope:E,auth0Client:A,useFormData:r,useMrrt:L,dpop:N}=d,H=ap(d,["baseUrl","timeout","audience","scope","auth0Client","useFormData","useMrrt","dpop"]);const X=H.grant_type==="urn:ietf:params:oauth:grant-type:token-exchange",re=H.grant_type==="refresh_token"&&L,he=Object.assign(Object.assign(Object.assign(Object.assign({},H),X&&v&&{audience:v}),X&&E&&{scope:E}),re&&{audience:v,scope:E}),de=r?_R(he):JSON.stringify(he),ve=(xe=H.grant_type,Bz.includes(xe));var xe;return await XO(`${u}/oauth/token`,_,v||"default",E,{method:"POST",body:de,headers:{"Content-Type":r?"application/x-www-form-urlencoded":"application/json","Auth0-Client":btoa(JSON.stringify(A||HO))}},s,r,L,ve?N:void 0)}const Xw=(...d)=>{return(s=d.filter(Boolean).join(" ").trim().split(/\s+/),Array.from(new Set(s))).join(" ");var s};class jd{constructor(s,u="@@auth0spajs@@",_){this.prefix=u,this.suffix=_,this.clientId=s.clientId,this.scope=s.scope,this.audience=s.audience}toKey(){return[this.prefix,this.clientId,this.audience,this.scope,this.suffix].filter(Boolean).join("::")}static fromKey(s){const[u,_,v,E]=s.split("::");return new jd({clientId:_,scope:E,audience:v},u)}static fromCacheEntry(s){const{scope:u,audience:_,client_id:v}=s;return new jd({scope:u,audience:_,clientId:v})}}class Zz{set(s,u){localStorage.setItem(s,JSON.stringify(u))}get(s){const u=window.localStorage.getItem(s);if(u)try{return JSON.parse(u)}catch{return}}remove(s){localStorage.removeItem(s)}allKeys(){return Object.keys(window.localStorage).filter(s=>s.startsWith("@@auth0spajs@@"))}}class YO{constructor(){this.enclosedCache=function(){let s={};return{set(u,_){s[u]=_},get(u){const _=s[u];if(_)return _},remove(u){delete s[u]},allKeys:()=>Object.keys(s)}}()}}class Xz{constructor(s,u,_){this.cache=s,this.keyManifest=u,this.nowProvider=_||$O}async setIdToken(s,u,_){var v;const E=this.getIdTokenCacheKey(s);await this.cache.set(E,{id_token:u,decodedToken:_}),await((v=this.keyManifest)===null||v===void 0?void 0:v.add(E))}async getIdToken(s){const u=await this.cache.get(this.getIdTokenCacheKey(s.clientId));if(!u&&s.scope&&s.audience){const _=await this.get(s);return!_||!_.id_token||!_.decodedToken?void 0:{id_token:_.id_token,decodedToken:_.decodedToken}}if(u)return{id_token:u.id_token,decodedToken:u.decodedToken}}async get(s,u=0,_=!1,v){var E;let A=await this.cache.get(s.toKey());if(!A){const N=await this.getCacheKeys();if(!N)return;const H=this.matchExistingCacheKey(s,N);if(H&&(A=await this.cache.get(H)),!H&&_&&v!=="cache-only")return this.getEntryWithRefreshToken(s,N)}if(!A)return;const r=await this.nowProvider(),L=Math.floor(r/1e3);return A.expiresAt-u<L?A.body.refresh_token?this.modifiedCachedEntry(A,s):(await this.cache.remove(s.toKey()),void await((E=this.keyManifest)===null||E===void 0?void 0:E.remove(s.toKey()))):A.body}async modifiedCachedEntry(s,u){return s.body={refresh_token:s.body.refresh_token,audience:s.body.audience,scope:s.body.scope},await this.cache.set(u.toKey(),s),{refresh_token:s.body.refresh_token,audience:s.body.audience,scope:s.body.scope}}async set(s){var u;const _=new jd({clientId:s.client_id,scope:s.scope,audience:s.audience}),v=await this.wrapCacheEntry(s);await this.cache.set(_.toKey(),v),await((u=this.keyManifest)===null||u===void 0?void 0:u.add(_.toKey()))}async clear(s){var u;const _=await this.getCacheKeys();_&&(await _.filter(v=>!s||v.includes(s)).reduce(async(v,E)=>{await v,await this.cache.remove(E)},Promise.resolve()),await((u=this.keyManifest)===null||u===void 0?void 0:u.clear()))}async wrapCacheEntry(s){const u=await this.nowProvider();return{body:s,expiresAt:Math.floor(u/1e3)+s.expires_in}}async getCacheKeys(){var s;return this.keyManifest?(s=await this.keyManifest.get())===null||s===void 0?void 0:s.keys:this.cache.allKeys?this.cache.allKeys():void 0}getIdTokenCacheKey(s){return new jd({clientId:s},"@@auth0spajs@@","@@user@@").toKey()}matchExistingCacheKey(s,u){return u.filter(_=>{var v;const E=jd.fromKey(_),A=new Set(E.scope&&E.scope.split(" ")),r=((v=s.scope)===null||v===void 0?void 0:v.split(" "))||[],L=E.scope&&r.reduce((N,H)=>N&&A.has(H),!0);return E.prefix==="@@auth0spajs@@"&&E.clientId===s.clientId&&E.audience===s.audience&&L})[0]}async getEntryWithRefreshToken(s,u){var _;for(const v of u){const E=jd.fromKey(v);if(E.prefix==="@@auth0spajs@@"&&E.clientId===s.clientId){const A=await this.cache.get(v);if(!((_=A==null?void 0:A.body)===null||_===void 0)&&_.refresh_token)return this.modifiedCachedEntry(A,s)}}}async updateEntry(s,u){var _;const v=await this.getCacheKeys();if(v)for(const E of v){const A=await this.cache.get(E);if(((_=A==null?void 0:A.body)===null||_===void 0?void 0:_.refresh_token)===s){const r=Object.assign(Object.assign({},A.body),{refresh_token:u});await this.set(r)}}}}class Yz{constructor(s,u,_){this.storage=s,this.clientId=u,this.cookieDomain=_,this.storageKey=`a0.spajs.txs.${this.clientId}`}create(s){this.storage.save(this.storageKey,s,{daysUntilExpire:1,cookieDomain:this.cookieDomain})}get(){return this.storage.get(this.storageKey)}remove(){this.storage.remove(this.storageKey,{cookieDomain:this.cookieDomain})}}const Yw=d=>typeof d=="number",Kz=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"],Jz=d=>{if(!d.id_token)throw new Error("ID token is required but missing");const s=(E=>{const A=E.split("."),[r,L,N]=A;if(A.length!==3||!r||!L||!N)throw new Error("ID token could not be decoded");const H=JSON.parse(MM(L)),X={__raw:E},re={};return Object.keys(H).forEach(he=>{X[he]=H[he],Kz.includes(he)||(re[he]=H[he])}),{encoded:{header:r,payload:L,signature:N},header:JSON.parse(MM(r)),claims:X,user:re}})(d.id_token);if(!s.claims.iss)throw new Error("Issuer (iss) claim must be a string present in the ID token");if(s.claims.iss!==d.iss)throw new Error(`Issuer (iss) claim mismatch in the ID token; expected "${d.iss}", found "${s.claims.iss}"`);if(!s.user.sub)throw new Error("Subject (sub) claim must be a string present in the ID token");if(s.header.alg!=="RS256")throw new Error(`Signature algorithm of "${s.header.alg}" is not supported. Expected the ID token to be signed with "RS256".`);if(!s.claims.aud||typeof s.claims.aud!="string"&&!Array.isArray(s.claims.aud))throw new Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(s.claims.aud)){if(!s.claims.aud.includes(d.aud))throw new Error(`Audience (aud) claim mismatch in the ID token; expected "${d.aud}" but was not one of "${s.claims.aud.join(", ")}"`);if(s.claims.aud.length>1){if(!s.claims.azp)throw new Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(s.claims.azp!==d.aud)throw new Error(`Authorized Party (azp) claim mismatch in the ID token; expected "${d.aud}", found "${s.claims.azp}"`)}}else if(s.claims.aud!==d.aud)throw new Error(`Audience (aud) claim mismatch in the ID token; expected "${d.aud}" but found "${s.claims.aud}"`);if(d.nonce){if(!s.claims.nonce)throw new Error("Nonce (nonce) claim must be a string present in the ID token");if(s.claims.nonce!==d.nonce)throw new Error(`Nonce (nonce) claim mismatch in the ID token; expected "${d.nonce}", found "${s.claims.nonce}"`)}if(d.max_age&&!Yw(s.claims.auth_time))throw new Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(s.claims.exp==null||!Yw(s.claims.exp))throw new Error("Expiration Time (exp) claim must be a number present in the ID token");if(!Yw(s.claims.iat))throw new Error("Issued At (iat) claim must be a number present in the ID token");const u=d.leeway||60,_=new Date(d.now||Date.now()),v=new Date(0);if(v.setUTCSeconds(s.claims.exp+u),_>v)throw new Error(`Expiration Time (exp) claim error in the ID token; current time (${_}) is after expiration time (${v})`);if(s.claims.nbf!=null&&Yw(s.claims.nbf)){const E=new Date(0);if(E.setUTCSeconds(s.claims.nbf-u),_<E)throw new Error(`Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Current time (${_}) is before ${E}`)}if(s.claims.auth_time!=null&&Yw(s.claims.auth_time)){const E=new Date(0);if(E.setUTCSeconds(parseInt(s.claims.auth_time)+d.max_age+u),_>E)throw new Error(`Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Current time (${_}) is after last auth at ${E}`)}if(d.organization){const E=d.organization.trim();if(E.startsWith("org_")){const A=E;if(!s.claims.org_id)throw new Error("Organization ID (org_id) claim must be a string present in the ID token");if(A!==s.claims.org_id)throw new Error(`Organization ID (org_id) claim mismatch in the ID token; expected "${A}", found "${s.claims.org_id}"`)}else{const A=E.toLowerCase();if(!s.claims.org_name)throw new Error("Organization Name (org_name) claim must be a string present in the ID token");if(A!==s.claims.org_name)throw new Error(`Organization Name (org_name) claim mismatch in the ID token; expected "${A}", found "${s.claims.org_name}"`)}}return s};var Gv=GR(function(d,s){var u=Uv&&Uv.__assign||function(){return u=Object.assign||function(L){for(var N,H=1,X=arguments.length;H<X;H++)for(var re in N=arguments[H])Object.prototype.hasOwnProperty.call(N,re)&&(L[re]=N[re]);return L},u.apply(this,arguments)};function _(L,N){if(!N)return"";var H="; "+L;return N===!0?H:H+"="+N}function v(L,N,H){return encodeURIComponent(L).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(N).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(X){if(typeof X.expires=="number"){var re=new Date;re.setMilliseconds(re.getMilliseconds()+864e5*X.expires),X.expires=re}return _("Expires",X.expires?X.expires.toUTCString():"")+_("Domain",X.domain)+_("Path",X.path)+_("Secure",X.secure)+_("SameSite",X.sameSite)}(H)}function E(L){for(var N={},H=L?L.split("; "):[],X=/(%[\dA-F]{2})+/gi,re=0;re<H.length;re++){var he=H[re].split("="),de=he.slice(1).join("=");de.charAt(0)==='"'&&(de=de.slice(1,-1));try{N[he[0].replace(X,decodeURIComponent)]=de.replace(X,decodeURIComponent)}catch{}}return N}function A(){return E(document.cookie)}function r(L,N,H){document.cookie=v(L,N,u({path:"/"},H))}s.__esModule=!0,s.encode=v,s.parse=E,s.getAll=A,s.get=function(L){return A()[L]},s.set=r,s.remove=function(L,N){r(L,"",u(u({},N),{expires:-1}))}});jR(Gv),Gv.encode,Gv.parse,Gv.getAll;var Qz=Gv.get,KO=Gv.set,JO=Gv.remove;const xb={get(d){const s=Qz(d);if(s!==void 0)return JSON.parse(s)},save(d,s,u){let _={};window.location.protocol==="https:"&&(_={secure:!0,sameSite:"none"}),u!=null&&u.daysUntilExpire&&(_.expires=u.daysUntilExpire),u!=null&&u.cookieDomain&&(_.domain=u.cookieDomain),KO(d,JSON.stringify(s),_)},remove(d,s){let u={};s!=null&&s.cookieDomain&&(u.domain=s.cookieDomain),JO(d,u)}},eN={get(d){return xb.get(d)||xb.get(`_legacy_${d}`)},save(d,s,u){let _={};window.location.protocol==="https:"&&(_={secure:!0}),u!=null&&u.daysUntilExpire&&(_.expires=u.daysUntilExpire),u!=null&&u.cookieDomain&&(_.domain=u.cookieDomain),KO(`_legacy_${d}`,JSON.stringify(s),_),xb.save(d,s,u)},remove(d,s){let u={};s!=null&&s.cookieDomain&&(u.domain=s.cookieDomain),JO(d,u),xb.remove(d,s),xb.remove(`_legacy_${d}`,s)}},tN={get(d){if(typeof sessionStorage>"u")return;const s=sessionStorage.getItem(d);return s!=null?JSON.parse(s):void 0},save(d,s){sessionStorage.setItem(d,JSON.stringify(s))},remove(d){sessionStorage.removeItem(d)}};var I_;(function(d){d.Code="code",d.ConnectCode="connect_code"})(I_||(I_={}));function iN(d,s,u){var _=s===void 0?null:s,v=function(L,N){var H=atob(L);if(N){for(var X=new Uint8Array(H.length),re=0,he=H.length;re<he;++re)X[re]=H.charCodeAt(re);return String.fromCharCode.apply(null,new Uint16Array(X.buffer))}return H}(d,u!==void 0&&u),E=v.indexOf(`
`,10)+1,A=v.substring(E)+(_?"//# sourceMappingURL="+_:""),r=new Blob([A],{type:"application/javascript"});return URL.createObjectURL(r)}var kM,FM,LM,$I,nN=(kM="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgZSBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKHQscil7c3VwZXIociksdGhpcy5lcnJvcj10LHRoaXMuZXJyb3JfZGVzY3JpcHRpb249cixPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcyxlLnByb3RvdHlwZSl9c3RhdGljIGZyb21QYXlsb2FkKHtlcnJvcjp0LGVycm9yX2Rlc2NyaXB0aW9uOnJ9KXtyZXR1cm4gbmV3IGUodCxyKX19Y2xhc3MgdCBleHRlbmRzIGV7Y29uc3RydWN0b3IoZSxzKXtzdXBlcigibWlzc2luZ19yZWZyZXNoX3Rva2VuIixgTWlzc2luZyBSZWZyZXNoIFRva2VuIChhdWRpZW5jZTogJyR7cihlLFsiZGVmYXVsdCJdKX0nLCBzY29wZTogJyR7cihzKX0nKWApLHRoaXMuYXVkaWVuY2U9ZSx0aGlzLnNjb3BlPXMsT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsdC5wcm90b3R5cGUpfX1mdW5jdGlvbiByKGUsdD1bXSl7cmV0dXJuIGUmJiF0LmluY2x1ZGVzKGUpP2U6IiJ9ImZ1bmN0aW9uIj09dHlwZW9mIFN1cHByZXNzZWRFcnJvciYmU3VwcHJlc3NlZEVycm9yO2NvbnN0IHM9ZT0+e3ZhcntjbGllbnRJZDp0fT1lLHI9ZnVuY3Rpb24oZSx0KXt2YXIgcj17fTtmb3IodmFyIHMgaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxzKSYmdC5pbmRleE9mKHMpPDAmJihyW3NdPWVbc10pO2lmKG51bGwhPWUmJiJmdW5jdGlvbiI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgbz0wO2ZvcihzPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7bzxzLmxlbmd0aDtvKyspdC5pbmRleE9mKHNbb10pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLHNbb10pJiYocltzW29dXT1lW3Nbb11dKX1yZXR1cm4gcn0oZSxbImNsaWVudElkIl0pO3JldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKChlPT5PYmplY3Qua2V5cyhlKS5maWx0ZXIoKHQ9PnZvaWQgMCE9PWVbdF0pKS5yZWR1Y2UoKCh0LHIpPT5PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sdCkse1tyXTplW3JdfSkpLHt9KSkoT2JqZWN0LmFzc2lnbih7Y2xpZW50X2lkOnR9LHIpKSkudG9TdHJpbmcoKX07bGV0IG89e307Y29uc3Qgbj0oZSx0KT0+YCR7ZX18JHt0fWA7YWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsKGFzeW5jKHtkYXRhOnt0aW1lb3V0OmUsYXV0aDpyLGZldGNoVXJsOmksZmV0Y2hPcHRpb25zOmMsdXNlRm9ybURhdGE6YSx1c2VNcnJ0OmZ9LHBvcnRzOltwXX0pPT57bGV0IGgsdSxsPXt9O2NvbnN0e2F1ZGllbmNlOmQsc2NvcGU6eX09cnx8e307dHJ5e2NvbnN0IHI9YT8oZT0+e2NvbnN0IHQ9bmV3IFVSTFNlYXJjaFBhcmFtcyhlKSxyPXt9O3JldHVybiB0LmZvckVhY2goKChlLHQpPT57clt0XT1lfSkpLHJ9KShjLmJvZHkpOkpTT04ucGFyc2UoYy5ib2R5KTtpZighci5yZWZyZXNoX3Rva2VuJiYicmVmcmVzaF90b2tlbiI9PT1yLmdyYW50X3R5cGUpe2lmKHU9KChlLHQpPT5vW24oZSx0KV0pKGQseSksIXUmJmYpe2NvbnN0IGU9by5sYXRlc3RfcmVmcmVzaF90b2tlbix0PSgoZSx0KT0+e2NvbnN0IHI9T2JqZWN0LmtleXMobykuZmluZCgocj0+e2lmKCJsYXRlc3RfcmVmcmVzaF90b2tlbiIhPT1yKXtjb25zdCBzPSgoZSx0KT0+dC5zdGFydHNXaXRoKGAke2V9fGApKSh0LHIpLG89ci5zcGxpdCgifCIpWzFdLnNwbGl0KCIgIiksbj1lLnNwbGl0KCIgIikuZXZlcnkoKGU9Pm8uaW5jbHVkZXMoZSkpKTtyZXR1cm4gcyYmbn19KSk7cmV0dXJuISFyfSkoeSxkKTtlJiYhdCYmKHU9ZSl9aWYoIXUpdGhyb3cgbmV3IHQoZCx5KTtjLmJvZHk9YT9zKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxyKSx7cmVmcmVzaF90b2tlbjp1fSkpOkpTT04uc3RyaW5naWZ5KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxyKSx7cmVmcmVzaF90b2tlbjp1fSkpfWxldCBqLGs7ImZ1bmN0aW9uIj09dHlwZW9mIEFib3J0Q29udHJvbGxlciYmKGo9bmV3IEFib3J0Q29udHJvbGxlcixjLnNpZ25hbD1qLnNpZ25hbCk7dHJ5e2s9YXdhaXQgUHJvbWlzZS5yYWNlKFsoXz1lLG5ldyBQcm9taXNlKChlPT5zZXRUaW1lb3V0KGUsXykpKSksZmV0Y2goaSxPYmplY3QuYXNzaWduKHt9LGMpKV0pfWNhdGNoKGUpe3JldHVybiB2b2lkIHAucG9zdE1lc3NhZ2Uoe2Vycm9yOmUubWVzc2FnZX0pfWlmKCFrKXJldHVybiBqJiZqLmFib3J0KCksdm9pZCBwLnBvc3RNZXNzYWdlKHtlcnJvcjoiVGltZW91dCB3aGVuIGV4ZWN1dGluZyAnZmV0Y2gnIn0pO2c9ay5oZWFkZXJzLGw9Wy4uLmddLnJlZHVjZSgoKGUsW3Qscl0pPT4oZVt0XT1yLGUpKSx7fSksaD1hd2FpdCBrLmpzb24oKSxoLnJlZnJlc2hfdG9rZW4/KGYmJihvLmxhdGVzdF9yZWZyZXNoX3Rva2VuPWgucmVmcmVzaF90b2tlbixPPXUsYj1oLnJlZnJlc2hfdG9rZW4sT2JqZWN0LmVudHJpZXMobykuZm9yRWFjaCgoKFtlLHRdKT0+e3Q9PT1PJiYob1tlXT1iKX0pKSksKChlLHQscik9PntvW24odCxyKV09ZX0pKGgucmVmcmVzaF90b2tlbixkLHkpLGRlbGV0ZSBoLnJlZnJlc2hfdG9rZW4pOigoZSx0KT0+e2RlbGV0ZSBvW24oZSx0KV19KShkLHkpLHAucG9zdE1lc3NhZ2Uoe29rOmsub2ssanNvbjpoLGhlYWRlcnM6bH0pfWNhdGNoKGUpe3AucG9zdE1lc3NhZ2Uoe29rOiExLGpzb246e2Vycm9yOmUuZXJyb3IsZXJyb3JfZGVzY3JpcHRpb246ZS5tZXNzYWdlfSxoZWFkZXJzOmx9KX12YXIgTyxiLGcsX30pKX0oKTsKCg==",FM=null,LM=!1,function(d){return $I=$I||iN(kM,FM,LM),new Worker($I,d)});const WI={};class rN{constructor(s,u){this.cache=s,this.clientId=u,this.manifestKey=this.createManifestKeyFrom(this.clientId)}async add(s){var u;const _=new Set(((u=await this.cache.get(this.manifestKey))===null||u===void 0?void 0:u.keys)||[]);_.add(s),await this.cache.set(this.manifestKey,{keys:[..._]})}async remove(s){const u=await this.cache.get(this.manifestKey);if(u){const _=new Set(u.keys);return _.delete(s),_.size>0?await this.cache.set(this.manifestKey,{keys:[..._]}):await this.cache.remove(this.manifestKey)}}get(){return this.cache.get(this.manifestKey)}clear(){return this.cache.remove(this.manifestKey)}createManifestKeyFrom(s){return`@@auth0spajs@@::${s}`}}const oN={memory:()=>new YO().enclosedCache,localstorage:()=>new Zz},zM=d=>oN[d],NM=d=>{const{openUrl:s,onRedirect:u}=d,_=ap(d,["openUrl","onRedirect"]);return Object.assign(Object.assign({},_),{openUrl:s===!1||s?s:u})},BM=(d,s)=>{const u=(s==null?void 0:s.split(" "))||[];return((d==null?void 0:d.split(" "))||[]).every(_=>u.includes(_))},kv={NONCE:"nonce",KEYPAIR:"keypair"};class aN{constructor(s){this.clientId=s}getVersion(){return 1}createDbHandle(){const s=window.indexedDB.open("auth0-spa-js",this.getVersion());return new Promise((u,_)=>{s.onupgradeneeded=()=>Object.values(kv).forEach(v=>s.result.createObjectStore(v)),s.onerror=()=>_(s.error),s.onsuccess=()=>u(s.result)})}async getDbHandle(){return this.dbHandle||(this.dbHandle=await this.createDbHandle()),this.dbHandle}async executeDbRequest(s,u,_){const v=_((await this.getDbHandle()).transaction(s,u).objectStore(s));return new Promise((E,A)=>{v.onsuccess=()=>E(v.result),v.onerror=()=>A(v.error)})}buildKey(s){const u=s?`_${s}`:"auth0";return`${this.clientId}::${u}`}setNonce(s,u){return this.save(kv.NONCE,this.buildKey(u),s)}setKeyPair(s){return this.save(kv.KEYPAIR,this.buildKey(),s)}async save(s,u,_){await this.executeDbRequest(s,"readwrite",v=>v.put(_,u))}findNonce(s){return this.find(kv.NONCE,this.buildKey(s))}findKeyPair(){return this.find(kv.KEYPAIR,this.buildKey())}find(s,u){return this.executeDbRequest(s,"readonly",_=>_.get(u))}async deleteBy(s,u){const _=await this.executeDbRequest(s,"readonly",v=>v.getAllKeys());_==null||_.filter(u).map(v=>this.executeDbRequest(s,"readwrite",E=>E.delete(v)))}deleteByClientId(s,u){return this.deleteBy(s,_=>typeof _=="string"&&_.startsWith(`${u}::`))}clearNonces(){return this.deleteByClientId(kv.NONCE,this.clientId)}clearKeyPairs(){return this.deleteByClientId(kv.KEYPAIR,this.clientId)}}class sN{constructor(s){this.storage=new aN(s)}getNonce(s){return this.storage.findNonce(s)}setNonce(s,u){return this.storage.setNonce(s,u)}async getOrGenerateKeyPair(){let s=await this.storage.findKeyPair();return s||(s=await Vz(),await this.storage.setKeyPair(s)),s}async generateProof(s){const u=await this.getOrGenerateKeyPair();return jz(Object.assign({keyPair:u},s))}async calculateThumbprint(){return Uz(await this.getOrGenerateKeyPair())}async clear(){await Promise.all([this.storage.clearNonces(),this.storage.clearKeyPairs()])}}var wb;(function(d){d.Bearer="Bearer",d.DPoP="DPoP"})(wb||(wb={}));class lN{constructor(s,u){this.hooks=u,this.config=Object.assign(Object.assign({},s),{fetch:s.fetch||(typeof window>"u"?fetch:window.fetch.bind(window))})}isAbsoluteUrl(s){return/^(https?:)?\/\//i.test(s)}buildUrl(s,u){if(u){if(this.isAbsoluteUrl(u))return u;if(s)return`${s.replace(/\/?\/$/,"")}/${u.replace(/^\/+/,"")}`}throw new TypeError("`url` must be absolute or `baseUrl` non-empty.")}getAccessToken(s){return this.config.getAccessToken?this.config.getAccessToken(s):this.hooks.getAccessToken(s)}extractUrl(s){return typeof s=="string"?s:s instanceof URL?s.href:s.url}buildBaseRequest(s,u){if(!this.config.baseUrl)return new Request(s,u);const _=this.buildUrl(this.config.baseUrl,this.extractUrl(s)),v=s instanceof Request?new Request(_,s):_;return new Request(v,u)}setAuthorizationHeader(s,u,_=wb.Bearer){s.headers.set("authorization",`${_} ${u}`)}async setDpopProofHeader(s,u){if(!this.config.dpopNonceId)return;const _=await this.hooks.getDpopNonce(),v=await this.hooks.generateDpopProof({accessToken:u,method:s.method,nonce:_,url:s.url});s.headers.set("dpop",v)}async prepareRequest(s,u){const _=await this.getAccessToken(u);let v,E;typeof _=="string"?(v=this.config.dpopNonceId?wb.DPoP:wb.Bearer,E=_):(v=_.token_type,E=_.access_token),this.setAuthorizationHeader(s,E,v),v===wb.DPoP&&await this.setDpopProofHeader(s,E)}getHeader(s,u){return Array.isArray(s)?new Headers(s).get(u)||"":typeof s.get=="function"?s.get(u)||"":s[u]||""}hasUseDpopNonceError(s){if(s.status!==401)return!1;const u=this.getHeader(s.headers,"www-authenticate");return u.includes("invalid_dpop_nonce")||u.includes("use_dpop_nonce")}async handleResponse(s,u){const _=this.getHeader(s.headers,"dpop-nonce");if(_&&await this.hooks.setDpopNonce(_),!this.hasUseDpopNonceError(s))return s;if(!_||!u.onUseDpopNonceError)throw new GA(_);return u.onUseDpopNonceError()}async internalFetchWithAuth(s,u,_,v){const E=this.buildBaseRequest(s,u);await this.prepareRequest(E,v);const A=await this.config.fetch(E);return this.handleResponse(A,_)}fetchWithAuth(s,u,_){const v={onUseDpopNonceError:()=>this.internalFetchWithAuth(s,u,Object.assign(Object.assign({},v),{onUseDpopNonceError:void 0}),_)};return this.internalFetchWithAuth(s,u,v,_)}}class cN{constructor(s,u){this.myAccountFetcher=s,this.apiBase=u}async connectAccount(s){const u=await this.myAccountFetcher.fetchWithAuth(`${this.apiBase}v1/connected-accounts/connect`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return this._handleResponse(u)}async completeAccount(s){const u=await this.myAccountFetcher.fetchWithAuth(`${this.apiBase}v1/connected-accounts/complete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return this._handleResponse(u)}async _handleResponse(s){let u;try{u=await s.text(),u=JSON.parse(u)}catch(_){throw new RA({type:"invalid_json",status:s.status,title:"Invalid JSON response",detail:u||String(_)})}if(s.ok)return u;throw new RA(u)}}class RA extends Error{constructor({type:s,status:u,title:_,detail:v,validation_errors:E}){super(v),this.name="MyAccountApiError",this.type=s,this.status=u,this.title=_,this.detail=v,this.validation_errors=E,Object.setPrototypeOf(this,RA.prototype)}}const qI=new Mz;class uN{constructor(s){let u,_;if(this.userCache=new YO().enclosedCache,this.defaultOptions={authorizationParams:{scope:"openid profile email"},useRefreshTokensFallback:!1,useFormData:!0},this._releaseLockOnPageHide=async()=>{await qI.releaseLock("auth0.lock.getTokenSilently"),window.removeEventListener("pagehide",this._releaseLockOnPageHide)},this.options=Object.assign(Object.assign(Object.assign({},this.defaultOptions),s),{authorizationParams:Object.assign(Object.assign({},this.defaultOptions.authorizationParams),s.authorizationParams)}),typeof window<"u"&&(()=>{if(!IA())throw new Error("For security reasons, `window.crypto` is required to run `auth0-spa-js`.");if(IA().subtle===void 0)throw new Error(`
      auth0-spa-js must run on a secure origin. See https://github.com/auth0/auth0-spa-js/blob/main/FAQ.md#why-do-i-get-auth0-spa-js-must-run-on-a-secure-origin for more information.
    `)})(),s.cache&&s.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),s.cache)_=s.cache;else{if(u=s.cacheLocation||"memory",!zM(u))throw new Error(`Invalid cache location "${u}"`);_=zM(u)()}this.httpTimeoutMs=s.httpTimeoutInSeconds?1e3*s.httpTimeoutInSeconds:1e4,this.cookieStorage=s.legacySameSiteCookie===!1?xb:eN,this.orgHintCookieName=`auth0.${this.options.clientId}.organization_hint`,this.isAuthenticatedCookieName=(L=>`auth0.${L}.is.authenticated`)(this.options.clientId),this.sessionCheckExpiryDays=s.sessionCheckExpiryDays||1;const v=s.useCookiesForTransactions?this.cookieStorage:tN;var E;this.scope=Xw("openid",this.options.authorizationParams.scope,this.options.useRefreshTokens?"offline_access":""),this.transactionManager=new Yz(v,this.options.clientId,this.options.cookieDomain),this.nowProvider=this.options.nowProvider||$O,this.cacheManager=new Xz(_,_.allKeys?void 0:new rN(_,this.options.clientId),this.nowProvider),this.dpop=this.options.useDpop?new sN(this.options.clientId):void 0,this.domainUrl=(E=this.options.domain,/^https?:\/\//.test(E)?E:`https://${E}`),this.tokenIssuer=((L,N)=>L?L.startsWith("https://")?L:`https://${L}/`:`${N}/`)(this.options.issuer,this.domainUrl);const A=`${this.domainUrl}/me/`,r=this.createFetcher(Object.assign(Object.assign({},this.options.useDpop&&{dpopNonceId:"__auth0_my_account_api__"}),{getAccessToken:()=>this.getTokenSilently({authorizationParams:{scope:"create:me:connected_accounts",audience:A},detailedResponse:!0})}));this.myAccountApi=new cN(r,A),typeof window<"u"&&window.Worker&&this.options.useRefreshTokens&&u==="memory"&&(this.options.workerUrl?this.worker=new Worker(this.options.workerUrl):this.worker=new nN)}_url(s){const u=encodeURIComponent(btoa(JSON.stringify(this.options.auth0Client||HO)));return`${this.domainUrl}${s}&auth0Client=${u}`}_authorizeUrl(s){return this._url(`/authorize?${_R(s)}`)}async _verifyIdToken(s,u,_){const v=await this.nowProvider();return Jz({iss:this.tokenIssuer,aud:this.options.clientId,id_token:s,nonce:u,organization:_,leeway:this.options.leeway,max_age:(E=this.options.authorizationParams.max_age,typeof E!="string"?E:parseInt(E,10)||void 0),now:v});var E}_processOrgHint(s){s?this.cookieStorage.save(this.orgHintCookieName,s,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}):this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain})}async _prepareAuthorizeUrl(s,u,_){var v;const E=HI(Zw()),A=HI(Zw()),r=Zw(),L=await DM(r),N=PM(L),H=await((v=this.dpop)===null||v===void 0?void 0:v.calculateThumbprint()),X=((he,de,ve,xe,$e,Le,Ke,Ge,Ye)=>Object.assign(Object.assign(Object.assign({client_id:he.clientId},he.authorizationParams),ve),{scope:Xw(de,ve.scope),response_type:"code",response_mode:Ge||"query",state:xe,nonce:$e,redirect_uri:Ke||he.authorizationParams.redirect_uri,code_challenge:Le,code_challenge_method:"S256",dpop_jkt:Ye}))(this.options,this.scope,s,E,A,N,s.redirect_uri||this.options.authorizationParams.redirect_uri||_,u==null?void 0:u.response_mode,H),re=this._authorizeUrl(X);return{nonce:A,code_verifier:r,scope:X.scope,audience:X.audience||"default",redirect_uri:X.redirect_uri,state:E,url:re}}async loginWithPopup(s,u){var _;if(s=s||{},!(u=u||{}).popup&&(u.popup=(r=>{const L=window.screenX+(window.innerWidth-400)/2,N=window.screenY+(window.innerHeight-600)/2;return window.open(r,"auth0:authorize:popup",`left=${L},top=${N},width=400,height=600,resizable,scrollbars=yes,status=1`)})(""),!u.popup))throw new Error("Unable to open a popup for loginWithPopup - window.open returned `null`");const v=await this._prepareAuthorizeUrl(s.authorizationParams||{},{response_mode:"web_message"},window.location.origin);u.popup.location.href=v.url;const E=await(r=>new Promise((L,N)=>{let H;const X=setInterval(()=>{r.popup&&r.popup.closed&&(clearInterval(X),clearTimeout(re),window.removeEventListener("message",H,!1),N(new qR(r.popup)))},1e3),re=setTimeout(()=>{clearInterval(X),N(new WR(r.popup)),window.removeEventListener("message",H,!1)},1e3*(r.timeoutInSeconds||60));H=function(he){if(he.data&&he.data.type==="authorization_response"){if(clearTimeout(re),clearInterval(X),window.removeEventListener("message",H,!1),r.popup.close(),he.data.response.error)return N(ys.fromPayload(he.data.response));L(he.data.response)}},window.addEventListener("message",H)}))(Object.assign(Object.assign({},u),{timeoutInSeconds:u.timeoutInSeconds||this.options.authorizeTimeoutInSeconds||60}));if(v.state!==E.state)throw new ys("state_mismatch","Invalid state");const A=((_=s.authorizationParams)===null||_===void 0?void 0:_.organization)||this.options.authorizationParams.organization;await this._requestToken({audience:v.audience,scope:v.scope,code_verifier:v.code_verifier,grant_type:"authorization_code",code:E.code,redirect_uri:v.redirect_uri},{nonceIn:v.nonce,organization:A})}async getUser(){var s;const u=await this._getIdTokenFromCache();return(s=u==null?void 0:u.decodedToken)===null||s===void 0?void 0:s.user}async getIdTokenClaims(){var s;const u=await this._getIdTokenFromCache();return(s=u==null?void 0:u.decodedToken)===null||s===void 0?void 0:s.claims}async loginWithRedirect(s={}){var u;const _=NM(s),{openUrl:v,fragment:E,appState:A}=_,r=ap(_,["openUrl","fragment","appState"]),L=((u=r.authorizationParams)===null||u===void 0?void 0:u.organization)||this.options.authorizationParams.organization,N=await this._prepareAuthorizeUrl(r.authorizationParams||{}),{url:H}=N,X=ap(N,["url"]);this.transactionManager.create(Object.assign(Object.assign(Object.assign({},X),{appState:A,response_type:I_.Code}),L&&{organization:L}));const re=E?`${H}#${E}`:H;v?await v(re):window.location.assign(re)}async handleRedirectCallback(s=window.location.href){const u=s.split("?").slice(1);if(u.length===0)throw new Error("There are no query params available for parsing.");const _=this.transactionManager.get();if(!_)throw new ys("missing_transaction","Invalid state");this.transactionManager.remove();const v=(E=>{E.indexOf("#")>-1&&(E=E.substring(0,E.indexOf("#")));const A=new URLSearchParams(E);return{state:A.get("state"),code:A.get("code")||void 0,connect_code:A.get("connect_code")||void 0,error:A.get("error")||void 0,error_description:A.get("error_description")||void 0}})(u.join(""));return _.response_type===I_.ConnectCode?this._handleConnectAccountRedirectCallback(v,_):this._handleLoginRedirectCallback(v,_)}async _handleLoginRedirectCallback(s,u){const{code:_,state:v,error:E,error_description:A}=s;if(E)throw new HR(E,A||E,v,u.appState);if(!u.code_verifier||u.state&&u.state!==v)throw new ys("state_mismatch","Invalid state");const r=u.organization,L=u.nonce,N=u.redirect_uri;return await this._requestToken(Object.assign({audience:u.audience,scope:u.scope,code_verifier:u.code_verifier,grant_type:"authorization_code",code:_},N?{redirect_uri:N}:{}),{nonceIn:L,organization:r}),{appState:u.appState,response_type:I_.Code}}async _handleConnectAccountRedirectCallback(s,u){const{connect_code:_,state:v,error:E,error_description:A}=s;if(E)throw new $R(E,A||E,u.connection,v,u.appState);if(!_)throw new ys("missing_connect_code","Missing connect code");if(!(u.code_verifier&&u.state&&u.auth_session&&u.redirect_uri&&u.state===v))throw new ys("state_mismatch","Invalid state");const r=await this.myAccountApi.completeAccount({auth_session:u.auth_session,connect_code:_,redirect_uri:u.redirect_uri,code_verifier:u.code_verifier});return Object.assign(Object.assign({},r),{appState:u.appState,response_type:I_.ConnectCode})}async checkSession(s){if(!this.cookieStorage.get(this.isAuthenticatedCookieName)){if(!this.cookieStorage.get("auth0.is.authenticated"))return;this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove("auth0.is.authenticated")}try{await this.getTokenSilently(s)}catch{}}async getTokenSilently(s={}){var u;const _=Object.assign(Object.assign({cacheMode:"on"},s),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),s.authorizationParams),{scope:Xw(this.scope,(u=s.authorizationParams)===null||u===void 0?void 0:u.scope)})}),v=await((E,A)=>{let r=WI[A];return r||(r=E().finally(()=>{delete WI[A],r=null}),WI[A]=r),r})(()=>this._getTokenSilently(_),`${this.options.clientId}::${_.authorizationParams.audience}::${_.authorizationParams.scope}`);return s.detailedResponse?v:v==null?void 0:v.access_token}async _getTokenSilently(s){const{cacheMode:u}=s,_=ap(s,["cacheMode"]);if(u!=="off"){const v=await this._getEntryFromCache({scope:_.authorizationParams.scope,audience:_.authorizationParams.audience||"default",clientId:this.options.clientId,cacheMode:u});if(v)return v}if(u!=="cache-only"){if(!await(async(v,E=3)=>{for(let A=0;A<E;A++)if(await v())return!0;return!1})(()=>qI.acquireLock("auth0.lock.getTokenSilently",5e3),10))throw new ST;try{if(window.addEventListener("pagehide",this._releaseLockOnPageHide),u!=="off"){const H=await this._getEntryFromCache({scope:_.authorizationParams.scope,audience:_.authorizationParams.audience||"default",clientId:this.options.clientId});if(H)return H}const v=this.options.useRefreshTokens?await this._getTokenUsingRefreshToken(_):await this._getTokenFromIFrame(_),{id_token:E,token_type:A,access_token:r,oauthTokenScope:L,expires_in:N}=v;return Object.assign(Object.assign({id_token:E,token_type:A,access_token:r},L?{scope:L}:null),{expires_in:N})}finally{await qI.releaseLock("auth0.lock.getTokenSilently"),window.removeEventListener("pagehide",this._releaseLockOnPageHide)}}}async getTokenWithPopup(s={},u={}){var _;const v=Object.assign(Object.assign({},s),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),s.authorizationParams),{scope:Xw(this.scope,(_=s.authorizationParams)===null||_===void 0?void 0:_.scope)})});return u=Object.assign(Object.assign({},Pz),u),await this.loginWithPopup(v,u),(await this.cacheManager.get(new jd({scope:v.authorizationParams.scope,audience:v.authorizationParams.audience||"default",clientId:this.options.clientId}),void 0,this.options.useMrrt)).access_token}async isAuthenticated(){return!!await this.getUser()}_buildLogoutUrl(s){s.clientId!==null?s.clientId=s.clientId||this.options.clientId:delete s.clientId;const u=s.logoutParams||{},{federated:_}=u,v=ap(u,["federated"]),E=_?"&federated":"";return this._url(`/v2/logout?${_R(Object.assign({clientId:s.clientId},v))}`)+E}async logout(s={}){var u;const _=NM(s),{openUrl:v}=_,E=ap(_,["openUrl"]);s.clientId===null?await this.cacheManager.clear():await this.cacheManager.clear(s.clientId||this.options.clientId),this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove(this.isAuthenticatedCookieName,{cookieDomain:this.options.cookieDomain}),this.userCache.remove("@@user@@"),await((u=this.dpop)===null||u===void 0?void 0:u.clear());const A=this._buildLogoutUrl(E);v?await v(A):v!==!1&&window.location.assign(A)}async _getTokenFromIFrame(s){const u=Object.assign(Object.assign({},s.authorizationParams),{prompt:"none"}),_=this.cookieStorage.get(this.orgHintCookieName);_&&!u.organization&&(u.organization=_);const{url:v,state:E,nonce:A,code_verifier:r,redirect_uri:L,scope:N,audience:H}=await this._prepareAuthorizeUrl(u,{response_mode:"web_message"},window.location.origin);try{if(window.crossOriginIsolated)throw new ys("login_required","The application is running in a Cross-Origin Isolated context, silently retrieving a token without refresh token is not possible.");const X=s.timeoutInSeconds||this.options.authorizeTimeoutInSeconds;let re;try{re=new URL(this.domainUrl).origin}catch{re=this.domainUrl}const he=await((ve,xe,$e=60)=>new Promise((Le,Ke)=>{const Ge=window.document.createElement("iframe");Ge.setAttribute("width","0"),Ge.setAttribute("height","0"),Ge.style.display="none";const Ye=()=>{window.document.body.contains(Ge)&&(window.document.body.removeChild(Ge),window.removeEventListener("message",mt,!1))};let mt;const Ct=setTimeout(()=>{Ke(new ST),Ye()},1e3*$e);mt=function(Vt){if(Vt.origin!=xe||!Vt.data||Vt.data.type!=="authorization_response")return;const ui=Vt.source;ui&&ui.close(),Vt.data.response.error?Ke(ys.fromPayload(Vt.data.response)):Le(Vt.data.response),clearTimeout(Ct),window.removeEventListener("message",mt,!1),setTimeout(Ye,2e3)},window.addEventListener("message",mt,!1),window.document.body.appendChild(Ge),Ge.setAttribute("src",ve)}))(v,re,X);if(E!==he.state)throw new ys("state_mismatch","Invalid state");const de=await this._requestToken(Object.assign(Object.assign({},s.authorizationParams),{code_verifier:r,code:he.code,grant_type:"authorization_code",redirect_uri:L,timeout:s.authorizationParams.timeout||this.httpTimeoutMs}),{nonceIn:A,organization:u.organization});return Object.assign(Object.assign({},de),{scope:N,oauthTokenScope:de.scope,audience:H})}catch(X){throw X.error==="login_required"&&this.logout({openUrl:!1}),X}}async _getTokenUsingRefreshToken(s){const u=await this.cacheManager.get(new jd({scope:s.authorizationParams.scope,audience:s.authorizationParams.audience||"default",clientId:this.options.clientId}),void 0,this.options.useMrrt);if(!(u&&u.refresh_token||this.worker)){if(this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(s);throw new jA(s.authorizationParams.audience||"default",s.authorizationParams.scope)}const _=s.authorizationParams.redirect_uri||this.options.authorizationParams.redirect_uri||window.location.origin,v=typeof s.timeoutInSeconds=="number"?1e3*s.timeoutInSeconds:null,E=((H,X,re,he)=>{var de;if(H&&re&&he){if(X.audience!==re)return X.scope;const ve=he.split(" "),xe=((de=X.scope)===null||de===void 0?void 0:de.split(" "))||[],$e=xe.every(Le=>ve.includes(Le));return ve.length>=xe.length&&$e?he:X.scope}return X.scope})(this.options.useMrrt,s.authorizationParams,u==null?void 0:u.audience,u==null?void 0:u.scope);try{const H=await this._requestToken(Object.assign(Object.assign(Object.assign({},s.authorizationParams),{grant_type:"refresh_token",refresh_token:u&&u.refresh_token,redirect_uri:_}),v&&{timeout:v}),{scopesToRequest:E});if(H.refresh_token&&this.options.useMrrt&&(u!=null&&u.refresh_token)&&await this.cacheManager.updateEntry(u.refresh_token,H.refresh_token),this.options.useMrrt&&(A=u==null?void 0:u.audience,r=u==null?void 0:u.scope,L=s.authorizationParams.audience,N=s.authorizationParams.scope,(A!==L||!BM(N,r))&&!BM(E,H.scope))){if(this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(s);const X=((re,he)=>{const de=(re==null?void 0:re.split(" "))||[],ve=(he==null?void 0:he.split(" "))||[];return de.filter(xe=>ve.indexOf(xe)==-1).join(",")})(E,H.scope);throw new XR(s.authorizationParams.audience||"default",X)}return Object.assign(Object.assign({},H),{scope:s.authorizationParams.scope,oauthTokenScope:H.scope,audience:s.authorizationParams.audience||"default"})}catch(H){if((H.message.indexOf("Missing Refresh Token")>-1||H.message&&H.message.indexOf("invalid refresh token")>-1)&&this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(s);throw H}var A,r,L,N}async _saveEntryInCache(s){const{id_token:u,decodedToken:_}=s,v=ap(s,["id_token","decodedToken"]);this.userCache.set("@@user@@",{id_token:u,decodedToken:_}),await this.cacheManager.setIdToken(this.options.clientId,s.id_token,s.decodedToken),await this.cacheManager.set(v)}async _getIdTokenFromCache(){const s=this.options.authorizationParams.audience||"default",u=await this.cacheManager.getIdToken(new jd({clientId:this.options.clientId,audience:s,scope:this.scope})),_=this.userCache.get("@@user@@");return u&&u.id_token===(_==null?void 0:_.id_token)?_:(this.userCache.set("@@user@@",u),u)}async _getEntryFromCache({scope:s,audience:u,clientId:_,cacheMode:v}){const E=await this.cacheManager.get(new jd({scope:s,audience:u,clientId:_}),60,this.options.useMrrt,v);if(E&&E.access_token){const{token_type:A,access_token:r,oauthTokenScope:L,expires_in:N}=E,H=await this._getIdTokenFromCache();return H&&Object.assign(Object.assign({id_token:H.id_token,token_type:A||"Bearer",access_token:r},L?{scope:L}:null),{expires_in:N})}}async _requestToken(s,u){const{nonceIn:_,organization:v,scopesToRequest:E}=u||{},A=await qz(Object.assign(Object.assign({baseUrl:this.domainUrl,client_id:this.options.clientId,auth0Client:this.options.auth0Client,useFormData:this.options.useFormData,timeout:this.httpTimeoutMs,useMrrt:this.options.useMrrt,dpop:this.dpop},s),{scope:E||s.scope}),this.worker),r=await this._verifyIdToken(A.id_token,_,v);return await this._saveEntryInCache(Object.assign(Object.assign(Object.assign(Object.assign({},A),{decodedToken:r,scope:s.scope,audience:s.audience||"default"}),A.scope?{oauthTokenScope:A.scope}:null),{client_id:this.options.clientId})),this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this._processOrgHint(v||r.claims.org_id),Object.assign(Object.assign({},A),{decodedToken:r})}async exchangeToken(s){return this._requestToken({grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:s.subject_token,subject_token_type:s.subject_token_type,scope:Xw(s.scope,this.scope),audience:s.audience||this.options.authorizationParams.audience})}_assertDpop(s){if(!s)throw new Error("`useDpop` option must be enabled before using DPoP.")}getDpopNonce(s){return this._assertDpop(this.dpop),this.dpop.getNonce(s)}setDpopNonce(s,u){return this._assertDpop(this.dpop),this.dpop.setNonce(s,u)}generateDpopProof(s){return this._assertDpop(this.dpop),this.dpop.generateProof(s)}createFetcher(s={}){return new lN(s,{isDpopEnabled:()=>!!this.options.useDpop,getAccessToken:u=>{var _;return this.getTokenSilently({authorizationParams:{scope:(_=u==null?void 0:u.scope)===null||_===void 0?void 0:_.join(" "),audience:u==null?void 0:u.audience},detailedResponse:!0})},getDpopNonce:()=>this.getDpopNonce(s.dpopNonceId),setDpopNonce:u=>this.setDpopNonce(u,s.dpopNonceId),generateDpopProof:u=>this.generateDpopProof(u)})}async connectAccountWithRedirect(s){const{openUrl:u,appState:_,connection:v,authorization_params:E,redirectUri:A=this.options.authorizationParams.redirect_uri||window.location.origin}=s;if(!v)throw new Error("connection is required");const r=HI(Zw()),L=Zw(),N=await DM(L),H=PM(N),{connect_uri:X,connect_params:re,auth_session:he}=await this.myAccountApi.connectAccount({connection:v,redirect_uri:A,state:r,code_challenge:H,code_challenge_method:"S256",authorization_params:E});this.transactionManager.create({state:r,code_verifier:L,auth_session:he,redirect_uri:A,appState:_,connection:v,response_type:I_.ConnectCode});const de=new URL(X);de.searchParams.set("ticket",re.ticket),u?await u(de.toString()):window.location.assign(de)}}var QO={isAuthenticated:!1,isLoading:!0,error:void 0,user:void 0},pu=function(){throw new Error("You forgot to wrap your component in <Auth0Provider>.")},hN=pl(pl({},QO),{buildAuthorizeUrl:pu,buildLogoutUrl:pu,getAccessTokenSilently:pu,getAccessTokenWithPopup:pu,getIdTokenClaims:pu,loginWithRedirect:pu,loginWithPopup:pu,connectAccountWithRedirect:pu,logout:pu,handleRedirectCallback:pu,getDpopNonce:pu,setDpopNonce:pu,generateDpopProof:pu,createFetcher:pu}),e2=ft.createContext(hN),VM=function(d){Rz(s,d);function s(u,_){var v=d.call(this,_??u)||this;return v.error=u,v.error_description=_,Object.setPrototypeOf(v,s.prototype),v}return s}(Error),dN=/[?&](?:connect_)?code=[^&]+/,fN=/[?&]state=[^&]+/,pN=/[?&]error=[^&]+/,mN=function(d){return d===void 0&&(d=window.location.search),(dN.test(d)||pN.test(d))&&fN.test(d)},t2=function(d){return function(s){if(s instanceof Error)return s;if(s!==null&&typeof s=="object"&&"error"in s&&typeof s.error=="string"){if("error_description"in s&&typeof s.error_description=="string"){var u=s;return new VM(u.error,u.error_description)}var _=s;return new VM(_.error)}return new Error(d)}},UM=t2("Login failed"),ZI=t2("Get access token failed"),i2=function(d){var s,u;d!=null&&d.redirectUri&&(console.warn("Using `redirectUri` has been deprecated, please use `authorizationParams.redirect_uri` instead as `redirectUri` will be no longer supported in a future version"),d.authorizationParams=(s=d.authorizationParams)!==null&&s!==void 0?s:{},d.authorizationParams.redirect_uri=d.redirectUri,delete d.redirectUri),!((u=d==null?void 0:d.authorizationParams)===null||u===void 0)&&u.redirectUri&&(console.warn("Using `authorizationParams.redirectUri` has been deprecated, please use `authorizationParams.redirect_uri` instead as `authorizationParams.redirectUri` will be removed in a future version"),d.authorizationParams.redirect_uri=d.authorizationParams.redirectUri,delete d.authorizationParams.redirectUri)},gN=function(d,s){switch(s.type){case"LOGIN_POPUP_STARTED":return pl(pl({},d),{isLoading:!0});case"LOGIN_POPUP_COMPLETE":case"INITIALISED":return pl(pl({},d),{isAuthenticated:!!s.user,user:s.user,isLoading:!1,error:void 0});case"HANDLE_REDIRECT_COMPLETE":case"GET_ACCESS_TOKEN_COMPLETE":return d.user===s.user?d:pl(pl({},d),{isAuthenticated:!!s.user,user:s.user});case"LOGOUT":return pl(pl({},d),{isAuthenticated:!1,user:void 0});case"ERROR":return pl(pl({},d),{isLoading:!1,error:s.error})}},_N=function(d){return i2(d),pl(pl({},d),{auth0Client:{name:"auth0-react",version:"2.8.0"}})},yN=function(d){var s;window.history.replaceState({},document.title,(s=d.returnTo)!==null&&s!==void 0?s:window.location.pathname)},vN=function(d){var s=d.children,u=d.skipRedirectCallback,_=d.onRedirectCallback,v=_===void 0?yN:_,E=d.context,A=E===void 0?e2:E,r=RM(d,["children","skipRedirectCallback","onRedirectCallback","context"]),L=ft.useState(function(){return new uN(_N(r))})[0],N=ft.useReducer(gN,QO),H=N[0],X=N[1],re=ft.useRef(!1),he=ft.useCallback(function(si){return X({type:"ERROR",error:si}),si},[]);ft.useEffect(function(){re.current||(re.current=!0,function(){return mb(void 0,void 0,void 0,function(){var si,di,Nt,Ii,Qt,_t,Et;return gb(this,function(fi){switch(fi.label){case 0:return fi.trys.push([0,7,,8]),si=void 0,mN()&&!u?[4,L.handleRedirectCallback()]:[3,3];case 1:return di=fi.sent(),Nt=di.appState,Ii=Nt===void 0?{}:Nt,Qt=di.response_type,_t=RM(di,["appState","response_type"]),[4,L.getUser()];case 2:return si=fi.sent(),Ii.response_type=Qt,Qt===I_.ConnectCode&&(Ii.connectedAccount=_t),v(Ii,si),[3,6];case 3:return[4,L.checkSession()];case 4:return fi.sent(),[4,L.getUser()];case 5:si=fi.sent(),fi.label=6;case 6:return X({type:"INITIALISED",user:si}),[3,8];case 7:return Et=fi.sent(),he(UM(Et)),[3,8];case 8:return[2]}})})}())},[L,v,u,he]);var de=ft.useCallback(function(si){return i2(si),L.loginWithRedirect(si)},[L]),ve=ft.useCallback(function(si,di){return mb(void 0,void 0,void 0,function(){var Nt,Ii;return gb(this,function(Qt){switch(Qt.label){case 0:X({type:"LOGIN_POPUP_STARTED"}),Qt.label=1;case 1:return Qt.trys.push([1,3,,4]),[4,L.loginWithPopup(si,di)];case 2:return Qt.sent(),[3,4];case 3:return Nt=Qt.sent(),he(UM(Nt)),[2];case 4:return[4,L.getUser()];case 5:return Ii=Qt.sent(),X({type:"LOGIN_POPUP_COMPLETE",user:Ii}),[2]}})})},[L,he]),xe=ft.useCallback(function(){for(var si=[],di=0;di<arguments.length;di++)si[di]=arguments[di];return mb(void 0,Dz([],si),void 0,function(Nt){return Nt===void 0&&(Nt={}),gb(this,function(Ii){switch(Ii.label){case 0:return[4,L.logout(Nt)];case 1:return Ii.sent(),(Nt.openUrl||Nt.openUrl===!1)&&X({type:"LOGOUT"}),[2]}})})},[L]),$e=ft.useCallback(function(si){return mb(void 0,void 0,void 0,function(){var di,Nt,Ii,Qt;return gb(this,function(_t){switch(_t.label){case 0:return _t.trys.push([0,2,3,5]),[4,L.getTokenSilently(si)];case 1:return di=_t.sent(),[3,5];case 2:throw Nt=_t.sent(),ZI(Nt);case 3:return Ii=X,Qt={type:"GET_ACCESS_TOKEN_COMPLETE"},[4,L.getUser()];case 4:return Ii.apply(void 0,[(Qt.user=_t.sent(),Qt)]),[7];case 5:return[2,di]}})})},[L]),Le=ft.useCallback(function(si,di){return mb(void 0,void 0,void 0,function(){var Nt,Ii,Qt,_t;return gb(this,function(Et){switch(Et.label){case 0:return Et.trys.push([0,2,3,5]),[4,L.getTokenWithPopup(si,di)];case 1:return Nt=Et.sent(),[3,5];case 2:throw Ii=Et.sent(),ZI(Ii);case 3:return Qt=X,_t={type:"GET_ACCESS_TOKEN_COMPLETE"},[4,L.getUser()];case 4:return Qt.apply(void 0,[(_t.user=Et.sent(),_t)]),[7];case 5:return[2,Nt]}})})},[L]),Ke=ft.useCallback(function(si){return L.connectAccountWithRedirect(si)},[L]),Ge=ft.useCallback(function(){return L.getIdTokenClaims()},[L]),Ye=ft.useCallback(function(si){return mb(void 0,void 0,void 0,function(){var di,Nt,Ii;return gb(this,function(Qt){switch(Qt.label){case 0:return Qt.trys.push([0,2,3,5]),[4,L.handleRedirectCallback(si)];case 1:return[2,Qt.sent()];case 2:throw di=Qt.sent(),ZI(di);case 3:return Nt=X,Ii={type:"HANDLE_REDIRECT_COMPLETE"},[4,L.getUser()];case 4:return Nt.apply(void 0,[(Ii.user=Qt.sent(),Ii)]),[7];case 5:return[2]}})})},[L]),mt=ft.useCallback(function(si){return L.getDpopNonce(si)},[L]),Ct=ft.useCallback(function(si,di){return L.setDpopNonce(si,di)},[L]),Vt=ft.useCallback(function(si){return L.generateDpopProof(si)},[L]),ui=ft.useCallback(function(si){return L.createFetcher(si)},[L]),Di=ft.useMemo(function(){return pl(pl({},H),{getAccessTokenSilently:$e,getAccessTokenWithPopup:Le,getIdTokenClaims:Ge,loginWithRedirect:de,loginWithPopup:ve,connectAccountWithRedirect:Ke,logout:xe,handleRedirectCallback:Ye,getDpopNonce:mt,setDpopNonce:Ct,generateDpopProof:Vt,createFetcher:ui})},[H,$e,Le,Ge,de,ve,Ke,xe,Ye,mt,Ct,Vt,ui]);return kR.createElement(A.Provider,{value:Di},s)},kb=function(d){return d===void 0&&(d=e2),ft.useContext(d)};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xN=d=>d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),bN=d=>d.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,u,_)=>_?_.toUpperCase():u.toLowerCase()),jM=d=>{const s=bN(d);return s.charAt(0).toUpperCase()+s.slice(1)},n2=(...d)=>d.filter((s,u,_)=>!!s&&s.trim()!==""&&_.indexOf(s)===u).join(" ").trim(),wN=d=>{for(const s in d)if(s.startsWith("aria-")||s==="role"||s==="title")return!0};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var TN={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SN=ft.forwardRef(({color:d="currentColor",size:s=24,strokeWidth:u=2,absoluteStrokeWidth:_,className:v="",children:E,iconNode:A,...r},L)=>ft.createElement("svg",{ref:L,...TN,width:s,height:s,stroke:d,strokeWidth:_?Number(u)*24/Number(s):u,className:n2("lucide",v),...!E&&!wN(r)&&{"aria-hidden":"true"},...r},[...A.map(([N,H])=>ft.createElement(N,H)),...Array.isArray(E)?E:[E]]));/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jv=(d,s)=>{const u=ft.forwardRef(({className:_,...v},E)=>ft.createElement(SN,{ref:E,iconNode:s,className:n2(`lucide-${xN(jM(d))}`,`lucide-${d}`,_),...v}));return u.displayName=jM(d),u};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EN=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],AN=Jv("calendar",EN);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CN=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],IN=Jv("log-in",CN);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RN=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],r2=Jv("log-out",RN);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DN=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],GM=Jv("map-pin",DN);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MN=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],PN=Jv("trending-up",MN);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ON=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],kN=Jv("user",ON);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FN=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],o2=Jv("users",FN);function LN(){const{loginWithRedirect:d,isAuthenticated:s,isLoading:u}=kb(),_=VA();return ft.useEffect(()=>{s&&_("/dashboard")},[s,_]),u?Fe.jsxDEV("div",{className:"page-center",children:Fe.jsxDEV("div",{className:"spinner"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Home.tsx",lineNumber:21,columnNumber:9},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Home.tsx",lineNumber:20,columnNumber:7},this):Fe.jsxDEV("div",{className:"page-center",children:Fe.jsxDEV("div",{className:"auth-card",children:[Fe.jsxDEV("div",{className:"text-center mb-6",children:[Fe.jsxDEV("div",{className:"auth-logo",children:"ATF"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Home.tsx",lineNumber:32,columnNumber:11},this),Fe.jsxDEV("h1",{className:"title text-2xl mb-2",children:"Bienvenido"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Home.tsx",lineNumber:33,columnNumber:11},this),Fe.jsxDEV("p",{className:"subtitle text-sm",children:"Sistema de Gestin de Cosechas"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Home.tsx",lineNumber:34,columnNumber:11},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Home.tsx",lineNumber:31,columnNumber:9},this),Fe.jsxDEV("button",{onClick:()=>d({authorizationParams:{redirect_uri:window.location.origin+"/dashboard"}}),className:"button is-primary-orange",children:[Fe.jsxDEV(IN,{size:20},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Home.tsx",lineNumber:47,columnNumber:11},this),"Iniciar Sesin"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Home.tsx",lineNumber:38,columnNumber:9},this),Fe.jsxDEV("div",{className:"auth-divider",children:Fe.jsxDEV("span",{children:"Seguridad"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Home.tsx",lineNumber:53,columnNumber:11},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Home.tsx",lineNumber:52,columnNumber:9},this),Fe.jsxDEV("div",{className:"auth-footer",children:["Acceso protegido mediante ",Fe.jsxDEV("strong",{children:"Auth0"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Home.tsx",lineNumber:58,columnNumber:37},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Home.tsx",lineNumber:57,columnNumber:9},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Home.tsx",lineNumber:28,columnNumber:7},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Home.tsx",lineNumber:27,columnNumber:5},this)}function a2(d,s){return function(){return d.apply(s,arguments)}}const{toString:zN}=Object.prototype,{getPrototypeOf:YR}=Object,{iterator:HA,toStringTag:s2}=Symbol,$A=(d=>s=>{const u=zN.call(s);return d[u]||(d[u]=u.slice(8,-1).toLowerCase())})(Object.create(null)),Hd=d=>(d=d.toLowerCase(),s=>$A(s)===d),WA=d=>s=>typeof s===d,{isArray:Fb}=Array,Ib=WA("undefined");function OT(d){return d!==null&&!Ib(d)&&d.constructor!==null&&!Ib(d.constructor)&&yu(d.constructor.isBuffer)&&d.constructor.isBuffer(d)}const l2=Hd("ArrayBuffer");function NN(d){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(d):s=d&&d.buffer&&l2(d.buffer),s}const BN=WA("string"),yu=WA("function"),c2=WA("number"),kT=d=>d!==null&&typeof d=="object",VN=d=>d===!0||d===!1,_A=d=>{if($A(d)!=="object")return!1;const s=YR(d);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(s2 in d)&&!(HA in d)},UN=d=>{if(!kT(d)||OT(d))return!1;try{return Object.keys(d).length===0&&Object.getPrototypeOf(d)===Object.prototype}catch{return!1}},jN=Hd("Date"),GN=Hd("File"),HN=Hd("Blob"),$N=Hd("FileList"),WN=d=>kT(d)&&yu(d.pipe),qN=d=>{let s;return d&&(typeof FormData=="function"&&d instanceof FormData||yu(d.append)&&((s=$A(d))==="formdata"||s==="object"&&yu(d.toString)&&d.toString()==="[object FormData]"))},ZN=Hd("URLSearchParams"),[XN,YN,KN,JN]=["ReadableStream","Request","Response","Headers"].map(Hd),QN=d=>d.trim?d.trim():d.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function FT(d,s,{allOwnKeys:u=!1}={}){if(d===null||typeof d>"u")return;let _,v;if(typeof d!="object"&&(d=[d]),Fb(d))for(_=0,v=d.length;_<v;_++)s.call(null,d[_],_,d);else{if(OT(d))return;const E=u?Object.getOwnPropertyNames(d):Object.keys(d),A=E.length;let r;for(_=0;_<A;_++)r=E[_],s.call(null,d[r],r,d)}}function u2(d,s){if(OT(d))return null;s=s.toLowerCase();const u=Object.keys(d);let _=u.length,v;for(;_-- >0;)if(v=u[_],s===v.toLowerCase())return v;return null}const Hv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,h2=d=>!Ib(d)&&d!==Hv;function vR(){const{caseless:d,skipUndefined:s}=h2(this)&&this||{},u={},_=(v,E)=>{const A=d&&u2(u,E)||E;_A(u[A])&&_A(v)?u[A]=vR(u[A],v):_A(v)?u[A]=vR({},v):Fb(v)?u[A]=v.slice():(!s||!Ib(v))&&(u[A]=v)};for(let v=0,E=arguments.length;v<E;v++)arguments[v]&&FT(arguments[v],_);return u}const e3=(d,s,u,{allOwnKeys:_}={})=>(FT(s,(v,E)=>{u&&yu(v)?d[E]=a2(v,u):d[E]=v},{allOwnKeys:_}),d),t3=d=>(d.charCodeAt(0)===65279&&(d=d.slice(1)),d),i3=(d,s,u,_)=>{d.prototype=Object.create(s.prototype,_),d.prototype.constructor=d,Object.defineProperty(d,"super",{value:s.prototype}),u&&Object.assign(d.prototype,u)},n3=(d,s,u,_)=>{let v,E,A;const r={};if(s=s||{},d==null)return s;do{for(v=Object.getOwnPropertyNames(d),E=v.length;E-- >0;)A=v[E],(!_||_(A,d,s))&&!r[A]&&(s[A]=d[A],r[A]=!0);d=u!==!1&&YR(d)}while(d&&(!u||u(d,s))&&d!==Object.prototype);return s},r3=(d,s,u)=>{d=String(d),(u===void 0||u>d.length)&&(u=d.length),u-=s.length;const _=d.indexOf(s,u);return _!==-1&&_===u},o3=d=>{if(!d)return null;if(Fb(d))return d;let s=d.length;if(!c2(s))return null;const u=new Array(s);for(;s-- >0;)u[s]=d[s];return u},a3=(d=>s=>d&&s instanceof d)(typeof Uint8Array<"u"&&YR(Uint8Array)),s3=(d,s)=>{const _=(d&&d[HA]).call(d);let v;for(;(v=_.next())&&!v.done;){const E=v.value;s.call(d,E[0],E[1])}},l3=(d,s)=>{let u;const _=[];for(;(u=d.exec(s))!==null;)_.push(u);return _},c3=Hd("HTMLFormElement"),u3=d=>d.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(u,_,v){return _.toUpperCase()+v}),HM=(({hasOwnProperty:d})=>(s,u)=>d.call(s,u))(Object.prototype),h3=Hd("RegExp"),d2=(d,s)=>{const u=Object.getOwnPropertyDescriptors(d),_={};FT(u,(v,E)=>{let A;(A=s(v,E,d))!==!1&&(_[E]=A||v)}),Object.defineProperties(d,_)},d3=d=>{d2(d,(s,u)=>{if(yu(d)&&["arguments","caller","callee"].indexOf(u)!==-1)return!1;const _=d[u];if(yu(_)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+u+"'")})}})},f3=(d,s)=>{const u={},_=v=>{v.forEach(E=>{u[E]=!0})};return Fb(d)?_(d):_(String(d).split(s)),u},p3=()=>{},m3=(d,s)=>d!=null&&Number.isFinite(d=+d)?d:s;function g3(d){return!!(d&&yu(d.append)&&d[s2]==="FormData"&&d[HA])}const _3=d=>{const s=new Array(10),u=(_,v)=>{if(kT(_)){if(s.indexOf(_)>=0)return;if(OT(_))return _;if(!("toJSON"in _)){s[v]=_;const E=Fb(_)?[]:{};return FT(_,(A,r)=>{const L=u(A,v+1);!Ib(L)&&(E[r]=L)}),s[v]=void 0,E}}return _};return u(d,0)},y3=Hd("AsyncFunction"),v3=d=>d&&(kT(d)||yu(d))&&yu(d.then)&&yu(d.catch),f2=((d,s)=>d?setImmediate:s?((u,_)=>(Hv.addEventListener("message",({source:v,data:E})=>{v===Hv&&E===u&&_.length&&_.shift()()},!1),v=>{_.push(v),Hv.postMessage(u,"*")}))(`axios@${Math.random()}`,[]):u=>setTimeout(u))(typeof setImmediate=="function",yu(Hv.postMessage)),x3=typeof queueMicrotask<"u"?queueMicrotask.bind(Hv):typeof process<"u"&&process.nextTick||f2,b3=d=>d!=null&&yu(d[HA]),Zt={isArray:Fb,isArrayBuffer:l2,isBuffer:OT,isFormData:qN,isArrayBufferView:NN,isString:BN,isNumber:c2,isBoolean:VN,isObject:kT,isPlainObject:_A,isEmptyObject:UN,isReadableStream:XN,isRequest:YN,isResponse:KN,isHeaders:JN,isUndefined:Ib,isDate:jN,isFile:GN,isBlob:HN,isRegExp:h3,isFunction:yu,isStream:WN,isURLSearchParams:ZN,isTypedArray:a3,isFileList:$N,forEach:FT,merge:vR,extend:e3,trim:QN,stripBOM:t3,inherits:i3,toFlatObject:n3,kindOf:$A,kindOfTest:Hd,endsWith:r3,toArray:o3,forEachEntry:s3,matchAll:l3,isHTMLForm:c3,hasOwnProperty:HM,hasOwnProp:HM,reduceDescriptors:d2,freezeMethods:d3,toObjectSet:f3,toCamelCase:u3,noop:p3,toFiniteNumber:m3,findKey:u2,global:Hv,isContextDefined:h2,isSpecCompliantForm:g3,toJSONObject:_3,isAsyncFn:y3,isThenable:v3,setImmediate:f2,asap:x3,isIterable:b3};function Br(d,s,u,_,v){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=d,this.name="AxiosError",s&&(this.code=s),u&&(this.config=u),_&&(this.request=_),v&&(this.response=v,this.status=v.status?v.status:null)}Zt.inherits(Br,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Zt.toJSONObject(this.config),code:this.code,status:this.status}}});const p2=Br.prototype,m2={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(d=>{m2[d]={value:d}});Object.defineProperties(Br,m2);Object.defineProperty(p2,"isAxiosError",{value:!0});Br.from=(d,s,u,_,v,E)=>{const A=Object.create(p2);Zt.toFlatObject(d,A,function(H){return H!==Error.prototype},N=>N!=="isAxiosError");const r=d&&d.message?d.message:"Error",L=s==null&&d?d.code:s;return Br.call(A,r,L,u,_,v),d&&A.cause==null&&Object.defineProperty(A,"cause",{value:d,configurable:!0}),A.name=d&&d.name||"Error",E&&Object.assign(A,E),A};const w3=null;function xR(d){return Zt.isPlainObject(d)||Zt.isArray(d)}function g2(d){return Zt.endsWith(d,"[]")?d.slice(0,-2):d}function $M(d,s,u){return d?d.concat(s).map(function(v,E){return v=g2(v),!u&&E?"["+v+"]":v}).join(u?".":""):s}function T3(d){return Zt.isArray(d)&&!d.some(xR)}const S3=Zt.toFlatObject(Zt,{},null,function(s){return/^is[A-Z]/.test(s)});function qA(d,s,u){if(!Zt.isObject(d))throw new TypeError("target must be an object");s=s||new FormData,u=Zt.toFlatObject(u,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ve,xe){return!Zt.isUndefined(xe[ve])});const _=u.metaTokens,v=u.visitor||H,E=u.dots,A=u.indexes,L=(u.Blob||typeof Blob<"u"&&Blob)&&Zt.isSpecCompliantForm(s);if(!Zt.isFunction(v))throw new TypeError("visitor must be a function");function N(de){if(de===null)return"";if(Zt.isDate(de))return de.toISOString();if(Zt.isBoolean(de))return de.toString();if(!L&&Zt.isBlob(de))throw new Br("Blob is not supported. Use a Buffer instead.");return Zt.isArrayBuffer(de)||Zt.isTypedArray(de)?L&&typeof Blob=="function"?new Blob([de]):Buffer.from(de):de}function H(de,ve,xe){let $e=de;if(de&&!xe&&typeof de=="object"){if(Zt.endsWith(ve,"{}"))ve=_?ve:ve.slice(0,-2),de=JSON.stringify(de);else if(Zt.isArray(de)&&T3(de)||(Zt.isFileList(de)||Zt.endsWith(ve,"[]"))&&($e=Zt.toArray(de)))return ve=g2(ve),$e.forEach(function(Ke,Ge){!(Zt.isUndefined(Ke)||Ke===null)&&s.append(A===!0?$M([ve],Ge,E):A===null?ve:ve+"[]",N(Ke))}),!1}return xR(de)?!0:(s.append($M(xe,ve,E),N(de)),!1)}const X=[],re=Object.assign(S3,{defaultVisitor:H,convertValue:N,isVisitable:xR});function he(de,ve){if(!Zt.isUndefined(de)){if(X.indexOf(de)!==-1)throw Error("Circular reference detected in "+ve.join("."));X.push(de),Zt.forEach(de,function($e,Le){(!(Zt.isUndefined($e)||$e===null)&&v.call(s,$e,Zt.isString(Le)?Le.trim():Le,ve,re))===!0&&he($e,ve?ve.concat(Le):[Le])}),X.pop()}}if(!Zt.isObject(d))throw new TypeError("data must be an object");return he(d),s}function WM(d){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(d).replace(/[!'()~]|%20|%00/g,function(_){return s[_]})}function KR(d,s){this._pairs=[],d&&qA(d,this,s)}const _2=KR.prototype;_2.append=function(s,u){this._pairs.push([s,u])};_2.toString=function(s){const u=s?function(_){return s.call(this,_,WM)}:WM;return this._pairs.map(function(v){return u(v[0])+"="+u(v[1])},"").join("&")};function E3(d){return encodeURIComponent(d).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function y2(d,s,u){if(!s)return d;const _=u&&u.encode||E3;Zt.isFunction(u)&&(u={serialize:u});const v=u&&u.serialize;let E;if(v?E=v(s,u):E=Zt.isURLSearchParams(s)?s.toString():new KR(s,u).toString(_),E){const A=d.indexOf("#");A!==-1&&(d=d.slice(0,A)),d+=(d.indexOf("?")===-1?"?":"&")+E}return d}class qM{constructor(){this.handlers=[]}use(s,u,_){return this.handlers.push({fulfilled:s,rejected:u,synchronous:_?_.synchronous:!1,runWhen:_?_.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){Zt.forEach(this.handlers,function(_){_!==null&&s(_)})}}const v2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},A3=typeof URLSearchParams<"u"?URLSearchParams:KR,C3=typeof FormData<"u"?FormData:null,I3=typeof Blob<"u"?Blob:null,R3={isBrowser:!0,classes:{URLSearchParams:A3,FormData:C3,Blob:I3},protocols:["http","https","file","blob","url","data"]},JR=typeof window<"u"&&typeof document<"u",bR=typeof navigator=="object"&&navigator||void 0,D3=JR&&(!bR||["ReactNative","NativeScript","NS"].indexOf(bR.product)<0),M3=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",P3=JR&&window.location.href||"http://localhost",O3=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:JR,hasStandardBrowserEnv:D3,hasStandardBrowserWebWorkerEnv:M3,navigator:bR,origin:P3},Symbol.toStringTag,{value:"Module"})),Ql={...O3,...R3};function k3(d,s){return qA(d,new Ql.classes.URLSearchParams,{visitor:function(u,_,v,E){return Ql.isNode&&Zt.isBuffer(u)?(this.append(_,u.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)},...s})}function F3(d){return Zt.matchAll(/\w+|\[(\w*)]/g,d).map(s=>s[0]==="[]"?"":s[1]||s[0])}function L3(d){const s={},u=Object.keys(d);let _;const v=u.length;let E;for(_=0;_<v;_++)E=u[_],s[E]=d[E];return s}function x2(d){function s(u,_,v,E){let A=u[E++];if(A==="__proto__")return!0;const r=Number.isFinite(+A),L=E>=u.length;return A=!A&&Zt.isArray(v)?v.length:A,L?(Zt.hasOwnProp(v,A)?v[A]=[v[A],_]:v[A]=_,!r):((!v[A]||!Zt.isObject(v[A]))&&(v[A]=[]),s(u,_,v[A],E)&&Zt.isArray(v[A])&&(v[A]=L3(v[A])),!r)}if(Zt.isFormData(d)&&Zt.isFunction(d.entries)){const u={};return Zt.forEachEntry(d,(_,v)=>{s(F3(_),v,u,0)}),u}return null}function z3(d,s,u){if(Zt.isString(d))try{return(s||JSON.parse)(d),Zt.trim(d)}catch(_){if(_.name!=="SyntaxError")throw _}return(u||JSON.stringify)(d)}const LT={transitional:v2,adapter:["xhr","http","fetch"],transformRequest:[function(s,u){const _=u.getContentType()||"",v=_.indexOf("application/json")>-1,E=Zt.isObject(s);if(E&&Zt.isHTMLForm(s)&&(s=new FormData(s)),Zt.isFormData(s))return v?JSON.stringify(x2(s)):s;if(Zt.isArrayBuffer(s)||Zt.isBuffer(s)||Zt.isStream(s)||Zt.isFile(s)||Zt.isBlob(s)||Zt.isReadableStream(s))return s;if(Zt.isArrayBufferView(s))return s.buffer;if(Zt.isURLSearchParams(s))return u.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let r;if(E){if(_.indexOf("application/x-www-form-urlencoded")>-1)return k3(s,this.formSerializer).toString();if((r=Zt.isFileList(s))||_.indexOf("multipart/form-data")>-1){const L=this.env&&this.env.FormData;return qA(r?{"files[]":s}:s,L&&new L,this.formSerializer)}}return E||v?(u.setContentType("application/json",!1),z3(s)):s}],transformResponse:[function(s){const u=this.transitional||LT.transitional,_=u&&u.forcedJSONParsing,v=this.responseType==="json";if(Zt.isResponse(s)||Zt.isReadableStream(s))return s;if(s&&Zt.isString(s)&&(_&&!this.responseType||v)){const A=!(u&&u.silentJSONParsing)&&v;try{return JSON.parse(s,this.parseReviver)}catch(r){if(A)throw r.name==="SyntaxError"?Br.from(r,Br.ERR_BAD_RESPONSE,this,null,this.response):r}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ql.classes.FormData,Blob:Ql.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Zt.forEach(["delete","get","head","post","put","patch"],d=>{LT.headers[d]={}});const N3=Zt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),B3=d=>{const s={};let u,_,v;return d&&d.split(`
`).forEach(function(A){v=A.indexOf(":"),u=A.substring(0,v).trim().toLowerCase(),_=A.substring(v+1).trim(),!(!u||s[u]&&N3[u])&&(u==="set-cookie"?s[u]?s[u].push(_):s[u]=[_]:s[u]=s[u]?s[u]+", "+_:_)}),s},ZM=Symbol("internals");function Kw(d){return d&&String(d).trim().toLowerCase()}function yA(d){return d===!1||d==null?d:Zt.isArray(d)?d.map(yA):String(d)}function V3(d){const s=Object.create(null),u=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=u.exec(d);)s[_[1]]=_[2];return s}const U3=d=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(d.trim());function XI(d,s,u,_,v){if(Zt.isFunction(_))return _.call(this,s,u);if(v&&(s=u),!!Zt.isString(s)){if(Zt.isString(_))return s.indexOf(_)!==-1;if(Zt.isRegExp(_))return _.test(s)}}function j3(d){return d.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,u,_)=>u.toUpperCase()+_)}function G3(d,s){const u=Zt.toCamelCase(" "+s);["get","set","has"].forEach(_=>{Object.defineProperty(d,_+u,{value:function(v,E,A){return this[_].call(this,s,v,E,A)},configurable:!0})})}let vu=class{constructor(s){s&&this.set(s)}set(s,u,_){const v=this;function E(r,L,N){const H=Kw(L);if(!H)throw new Error("header name must be a non-empty string");const X=Zt.findKey(v,H);(!X||v[X]===void 0||N===!0||N===void 0&&v[X]!==!1)&&(v[X||L]=yA(r))}const A=(r,L)=>Zt.forEach(r,(N,H)=>E(N,H,L));if(Zt.isPlainObject(s)||s instanceof this.constructor)A(s,u);else if(Zt.isString(s)&&(s=s.trim())&&!U3(s))A(B3(s),u);else if(Zt.isObject(s)&&Zt.isIterable(s)){let r={},L,N;for(const H of s){if(!Zt.isArray(H))throw TypeError("Object iterator must return a key-value pair");r[N=H[0]]=(L=r[N])?Zt.isArray(L)?[...L,H[1]]:[L,H[1]]:H[1]}A(r,u)}else s!=null&&E(u,s,_);return this}get(s,u){if(s=Kw(s),s){const _=Zt.findKey(this,s);if(_){const v=this[_];if(!u)return v;if(u===!0)return V3(v);if(Zt.isFunction(u))return u.call(this,v,_);if(Zt.isRegExp(u))return u.exec(v);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,u){if(s=Kw(s),s){const _=Zt.findKey(this,s);return!!(_&&this[_]!==void 0&&(!u||XI(this,this[_],_,u)))}return!1}delete(s,u){const _=this;let v=!1;function E(A){if(A=Kw(A),A){const r=Zt.findKey(_,A);r&&(!u||XI(_,_[r],r,u))&&(delete _[r],v=!0)}}return Zt.isArray(s)?s.forEach(E):E(s),v}clear(s){const u=Object.keys(this);let _=u.length,v=!1;for(;_--;){const E=u[_];(!s||XI(this,this[E],E,s,!0))&&(delete this[E],v=!0)}return v}normalize(s){const u=this,_={};return Zt.forEach(this,(v,E)=>{const A=Zt.findKey(_,E);if(A){u[A]=yA(v),delete u[E];return}const r=s?j3(E):String(E).trim();r!==E&&delete u[E],u[r]=yA(v),_[r]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const u=Object.create(null);return Zt.forEach(this,(_,v)=>{_!=null&&_!==!1&&(u[v]=s&&Zt.isArray(_)?_.join(", "):_)}),u}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,u])=>s+": "+u).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...u){const _=new this(s);return u.forEach(v=>_.set(v)),_}static accessor(s){const _=(this[ZM]=this[ZM]={accessors:{}}).accessors,v=this.prototype;function E(A){const r=Kw(A);_[r]||(G3(v,A),_[r]=!0)}return Zt.isArray(s)?s.forEach(E):E(s),this}};vu.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Zt.reduceDescriptors(vu.prototype,({value:d},s)=>{let u=s[0].toUpperCase()+s.slice(1);return{get:()=>d,set(_){this[u]=_}}});Zt.freezeMethods(vu);function YI(d,s){const u=this||LT,_=s||u,v=vu.from(_.headers);let E=_.data;return Zt.forEach(d,function(r){E=r.call(u,E,v.normalize(),s?s.status:void 0)}),v.normalize(),E}function b2(d){return!!(d&&d.__CANCEL__)}function Lb(d,s,u){Br.call(this,d??"canceled",Br.ERR_CANCELED,s,u),this.name="CanceledError"}Zt.inherits(Lb,Br,{__CANCEL__:!0});function w2(d,s,u){const _=u.config.validateStatus;!u.status||!_||_(u.status)?d(u):s(new Br("Request failed with status code "+u.status,[Br.ERR_BAD_REQUEST,Br.ERR_BAD_RESPONSE][Math.floor(u.status/100)-4],u.config,u.request,u))}function H3(d){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(d);return s&&s[1]||""}function $3(d,s){d=d||10;const u=new Array(d),_=new Array(d);let v=0,E=0,A;return s=s!==void 0?s:1e3,function(L){const N=Date.now(),H=_[E];A||(A=N),u[v]=L,_[v]=N;let X=E,re=0;for(;X!==v;)re+=u[X++],X=X%d;if(v=(v+1)%d,v===E&&(E=(E+1)%d),N-A<s)return;const he=H&&N-H;return he?Math.round(re*1e3/he):void 0}}function W3(d,s){let u=0,_=1e3/s,v,E;const A=(N,H=Date.now())=>{u=H,v=null,E&&(clearTimeout(E),E=null),d(...N)};return[(...N)=>{const H=Date.now(),X=H-u;X>=_?A(N,H):(v=N,E||(E=setTimeout(()=>{E=null,A(v)},_-X)))},()=>v&&A(v)]}const DA=(d,s,u=3)=>{let _=0;const v=$3(50,250);return W3(E=>{const A=E.loaded,r=E.lengthComputable?E.total:void 0,L=A-_,N=v(L),H=A<=r;_=A;const X={loaded:A,total:r,progress:r?A/r:void 0,bytes:L,rate:N||void 0,estimated:N&&r&&H?(r-A)/N:void 0,event:E,lengthComputable:r!=null,[s?"download":"upload"]:!0};d(X)},u)},XM=(d,s)=>{const u=d!=null;return[_=>s[0]({lengthComputable:u,total:d,loaded:_}),s[1]]},YM=d=>(...s)=>Zt.asap(()=>d(...s)),q3=Ql.hasStandardBrowserEnv?((d,s)=>u=>(u=new URL(u,Ql.origin),d.protocol===u.protocol&&d.host===u.host&&(s||d.port===u.port)))(new URL(Ql.origin),Ql.navigator&&/(msie|trident)/i.test(Ql.navigator.userAgent)):()=>!0,Z3=Ql.hasStandardBrowserEnv?{write(d,s,u,_,v,E,A){if(typeof document>"u")return;const r=[`${d}=${encodeURIComponent(s)}`];Zt.isNumber(u)&&r.push(`expires=${new Date(u).toUTCString()}`),Zt.isString(_)&&r.push(`path=${_}`),Zt.isString(v)&&r.push(`domain=${v}`),E===!0&&r.push("secure"),Zt.isString(A)&&r.push(`SameSite=${A}`),document.cookie=r.join("; ")},read(d){if(typeof document>"u")return null;const s=document.cookie.match(new RegExp("(?:^|; )"+d+"=([^;]*)"));return s?decodeURIComponent(s[1]):null},remove(d){this.write(d,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function X3(d){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(d)}function Y3(d,s){return s?d.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):d}function T2(d,s,u){let _=!X3(s);return d&&(_||u==!1)?Y3(d,s):s}const KM=d=>d instanceof vu?{...d}:d;function Xv(d,s){s=s||{};const u={};function _(N,H,X,re){return Zt.isPlainObject(N)&&Zt.isPlainObject(H)?Zt.merge.call({caseless:re},N,H):Zt.isPlainObject(H)?Zt.merge({},H):Zt.isArray(H)?H.slice():H}function v(N,H,X,re){if(Zt.isUndefined(H)){if(!Zt.isUndefined(N))return _(void 0,N,X,re)}else return _(N,H,X,re)}function E(N,H){if(!Zt.isUndefined(H))return _(void 0,H)}function A(N,H){if(Zt.isUndefined(H)){if(!Zt.isUndefined(N))return _(void 0,N)}else return _(void 0,H)}function r(N,H,X){if(X in s)return _(N,H);if(X in d)return _(void 0,N)}const L={url:E,method:E,data:E,baseURL:A,transformRequest:A,transformResponse:A,paramsSerializer:A,timeout:A,timeoutMessage:A,withCredentials:A,withXSRFToken:A,adapter:A,responseType:A,xsrfCookieName:A,xsrfHeaderName:A,onUploadProgress:A,onDownloadProgress:A,decompress:A,maxContentLength:A,maxBodyLength:A,beforeRedirect:A,transport:A,httpAgent:A,httpsAgent:A,cancelToken:A,socketPath:A,responseEncoding:A,validateStatus:r,headers:(N,H,X)=>v(KM(N),KM(H),X,!0)};return Zt.forEach(Object.keys({...d,...s}),function(H){const X=L[H]||v,re=X(d[H],s[H],H);Zt.isUndefined(re)&&X!==r||(u[H]=re)}),u}const S2=d=>{const s=Xv({},d);let{data:u,withXSRFToken:_,xsrfHeaderName:v,xsrfCookieName:E,headers:A,auth:r}=s;if(s.headers=A=vu.from(A),s.url=y2(T2(s.baseURL,s.url,s.allowAbsoluteUrls),d.params,d.paramsSerializer),r&&A.set("Authorization","Basic "+btoa((r.username||"")+":"+(r.password?unescape(encodeURIComponent(r.password)):""))),Zt.isFormData(u)){if(Ql.hasStandardBrowserEnv||Ql.hasStandardBrowserWebWorkerEnv)A.setContentType(void 0);else if(Zt.isFunction(u.getHeaders)){const L=u.getHeaders(),N=["content-type","content-length"];Object.entries(L).forEach(([H,X])=>{N.includes(H.toLowerCase())&&A.set(H,X)})}}if(Ql.hasStandardBrowserEnv&&(_&&Zt.isFunction(_)&&(_=_(s)),_||_!==!1&&q3(s.url))){const L=v&&E&&Z3.read(E);L&&A.set(v,L)}return s},K3=typeof XMLHttpRequest<"u",J3=K3&&function(d){return new Promise(function(u,_){const v=S2(d);let E=v.data;const A=vu.from(v.headers).normalize();let{responseType:r,onUploadProgress:L,onDownloadProgress:N}=v,H,X,re,he,de;function ve(){he&&he(),de&&de(),v.cancelToken&&v.cancelToken.unsubscribe(H),v.signal&&v.signal.removeEventListener("abort",H)}let xe=new XMLHttpRequest;xe.open(v.method.toUpperCase(),v.url,!0),xe.timeout=v.timeout;function $e(){if(!xe)return;const Ke=vu.from("getAllResponseHeaders"in xe&&xe.getAllResponseHeaders()),Ye={data:!r||r==="text"||r==="json"?xe.responseText:xe.response,status:xe.status,statusText:xe.statusText,headers:Ke,config:d,request:xe};w2(function(Ct){u(Ct),ve()},function(Ct){_(Ct),ve()},Ye),xe=null}"onloadend"in xe?xe.onloadend=$e:xe.onreadystatechange=function(){!xe||xe.readyState!==4||xe.status===0&&!(xe.responseURL&&xe.responseURL.indexOf("file:")===0)||setTimeout($e)},xe.onabort=function(){xe&&(_(new Br("Request aborted",Br.ECONNABORTED,d,xe)),xe=null)},xe.onerror=function(Ge){const Ye=Ge&&Ge.message?Ge.message:"Network Error",mt=new Br(Ye,Br.ERR_NETWORK,d,xe);mt.event=Ge||null,_(mt),xe=null},xe.ontimeout=function(){let Ge=v.timeout?"timeout of "+v.timeout+"ms exceeded":"timeout exceeded";const Ye=v.transitional||v2;v.timeoutErrorMessage&&(Ge=v.timeoutErrorMessage),_(new Br(Ge,Ye.clarifyTimeoutError?Br.ETIMEDOUT:Br.ECONNABORTED,d,xe)),xe=null},E===void 0&&A.setContentType(null),"setRequestHeader"in xe&&Zt.forEach(A.toJSON(),function(Ge,Ye){xe.setRequestHeader(Ye,Ge)}),Zt.isUndefined(v.withCredentials)||(xe.withCredentials=!!v.withCredentials),r&&r!=="json"&&(xe.responseType=v.responseType),N&&([re,de]=DA(N,!0),xe.addEventListener("progress",re)),L&&xe.upload&&([X,he]=DA(L),xe.upload.addEventListener("progress",X),xe.upload.addEventListener("loadend",he)),(v.cancelToken||v.signal)&&(H=Ke=>{xe&&(_(!Ke||Ke.type?new Lb(null,d,xe):Ke),xe.abort(),xe=null)},v.cancelToken&&v.cancelToken.subscribe(H),v.signal&&(v.signal.aborted?H():v.signal.addEventListener("abort",H)));const Le=H3(v.url);if(Le&&Ql.protocols.indexOf(Le)===-1){_(new Br("Unsupported protocol "+Le+":",Br.ERR_BAD_REQUEST,d));return}xe.send(E||null)})},Q3=(d,s)=>{const{length:u}=d=d?d.filter(Boolean):[];if(s||u){let _=new AbortController,v;const E=function(N){if(!v){v=!0,r();const H=N instanceof Error?N:this.reason;_.abort(H instanceof Br?H:new Lb(H instanceof Error?H.message:H))}};let A=s&&setTimeout(()=>{A=null,E(new Br(`timeout ${s} of ms exceeded`,Br.ETIMEDOUT))},s);const r=()=>{d&&(A&&clearTimeout(A),A=null,d.forEach(N=>{N.unsubscribe?N.unsubscribe(E):N.removeEventListener("abort",E)}),d=null)};d.forEach(N=>N.addEventListener("abort",E));const{signal:L}=_;return L.unsubscribe=()=>Zt.asap(r),L}},eB=function*(d,s){let u=d.byteLength;if(u<s){yield d;return}let _=0,v;for(;_<u;)v=_+s,yield d.slice(_,v),_=v},tB=async function*(d,s){for await(const u of iB(d))yield*eB(u,s)},iB=async function*(d){if(d[Symbol.asyncIterator]){yield*d;return}const s=d.getReader();try{for(;;){const{done:u,value:_}=await s.read();if(u)break;yield _}}finally{await s.cancel()}},JM=(d,s,u,_)=>{const v=tB(d,s);let E=0,A,r=L=>{A||(A=!0,_&&_(L))};return new ReadableStream({async pull(L){try{const{done:N,value:H}=await v.next();if(N){r(),L.close();return}let X=H.byteLength;if(u){let re=E+=X;u(re)}L.enqueue(new Uint8Array(H))}catch(N){throw r(N),N}},cancel(L){return r(L),v.return()}},{highWaterMark:2})},QM=64*1024,{isFunction:JE}=Zt,nB=(({Request:d,Response:s})=>({Request:d,Response:s}))(Zt.global),{ReadableStream:eP,TextEncoder:tP}=Zt.global,iP=(d,...s)=>{try{return!!d(...s)}catch{return!1}},rB=d=>{d=Zt.merge.call({skipUndefined:!0},nB,d);const{fetch:s,Request:u,Response:_}=d,v=s?JE(s):typeof fetch=="function",E=JE(u),A=JE(_);if(!v)return!1;const r=v&&JE(eP),L=v&&(typeof tP=="function"?(de=>ve=>de.encode(ve))(new tP):async de=>new Uint8Array(await new u(de).arrayBuffer())),N=E&&r&&iP(()=>{let de=!1;const ve=new u(Ql.origin,{body:new eP,method:"POST",get duplex(){return de=!0,"half"}}).headers.has("Content-Type");return de&&!ve}),H=A&&r&&iP(()=>Zt.isReadableStream(new _("").body)),X={stream:H&&(de=>de.body)};v&&["text","arrayBuffer","blob","formData","stream"].forEach(de=>{!X[de]&&(X[de]=(ve,xe)=>{let $e=ve&&ve[de];if($e)return $e.call(ve);throw new Br(`Response type '${de}' is not supported`,Br.ERR_NOT_SUPPORT,xe)})});const re=async de=>{if(de==null)return 0;if(Zt.isBlob(de))return de.size;if(Zt.isSpecCompliantForm(de))return(await new u(Ql.origin,{method:"POST",body:de}).arrayBuffer()).byteLength;if(Zt.isArrayBufferView(de)||Zt.isArrayBuffer(de))return de.byteLength;if(Zt.isURLSearchParams(de)&&(de=de+""),Zt.isString(de))return(await L(de)).byteLength},he=async(de,ve)=>{const xe=Zt.toFiniteNumber(de.getContentLength());return xe??re(ve)};return async de=>{let{url:ve,method:xe,data:$e,signal:Le,cancelToken:Ke,timeout:Ge,onDownloadProgress:Ye,onUploadProgress:mt,responseType:Ct,headers:Vt,withCredentials:ui="same-origin",fetchOptions:Di}=S2(de),si=s||fetch;Ct=Ct?(Ct+"").toLowerCase():"text";let di=Q3([Le,Ke&&Ke.toAbortSignal()],Ge),Nt=null;const Ii=di&&di.unsubscribe&&(()=>{di.unsubscribe()});let Qt;try{if(mt&&N&&xe!=="get"&&xe!=="head"&&(Qt=await he(Vt,$e))!==0){let er=new u(ve,{method:"POST",body:$e,duplex:"half"}),Mn;if(Zt.isFormData($e)&&(Mn=er.headers.get("content-type"))&&Vt.setContentType(Mn),er.body){const[pn,pr]=XM(Qt,DA(YM(mt)));$e=JM(er.body,QM,pn,pr)}}Zt.isString(ui)||(ui=ui?"include":"omit");const _t=E&&"credentials"in u.prototype,Et={...Di,signal:di,method:xe.toUpperCase(),headers:Vt.normalize().toJSON(),body:$e,duplex:"half",credentials:_t?ui:void 0};Nt=E&&new u(ve,Et);let fi=await(E?si(Nt,Di):si(ve,Et));const rn=H&&(Ct==="stream"||Ct==="response");if(H&&(Ye||rn&&Ii)){const er={};["status","statusText","headers"].forEach(Vr=>{er[Vr]=fi[Vr]});const Mn=Zt.toFiniteNumber(fi.headers.get("content-length")),[pn,pr]=Ye&&XM(Mn,DA(YM(Ye),!0))||[];fi=new _(JM(fi.body,QM,pn,()=>{pr&&pr(),Ii&&Ii()}),er)}Ct=Ct||"text";let zn=await X[Zt.findKey(X,Ct)||"text"](fi,de);return!rn&&Ii&&Ii(),await new Promise((er,Mn)=>{w2(er,Mn,{data:zn,headers:vu.from(fi.headers),status:fi.status,statusText:fi.statusText,config:de,request:Nt})})}catch(_t){throw Ii&&Ii(),_t&&_t.name==="TypeError"&&/Load failed|fetch/i.test(_t.message)?Object.assign(new Br("Network Error",Br.ERR_NETWORK,de,Nt),{cause:_t.cause||_t}):Br.from(_t,_t&&_t.code,de,Nt)}}},oB=new Map,E2=d=>{let s=d&&d.env||{};const{fetch:u,Request:_,Response:v}=s,E=[_,v,u];let A=E.length,r=A,L,N,H=oB;for(;r--;)L=E[r],N=H.get(L),N===void 0&&H.set(L,N=r?new Map:rB(s)),H=N;return N};E2();const QR={http:w3,xhr:J3,fetch:{get:E2}};Zt.forEach(QR,(d,s)=>{if(d){try{Object.defineProperty(d,"name",{value:s})}catch{}Object.defineProperty(d,"adapterName",{value:s})}});const nP=d=>`- ${d}`,aB=d=>Zt.isFunction(d)||d===null||d===!1;function sB(d,s){d=Zt.isArray(d)?d:[d];const{length:u}=d;let _,v;const E={};for(let A=0;A<u;A++){_=d[A];let r;if(v=_,!aB(_)&&(v=QR[(r=String(_)).toLowerCase()],v===void 0))throw new Br(`Unknown adapter '${r}'`);if(v&&(Zt.isFunction(v)||(v=v.get(s))))break;E[r||"#"+A]=v}if(!v){const A=Object.entries(E).map(([L,N])=>`adapter ${L} `+(N===!1?"is not supported by the environment":"is not available in the build"));let r=u?A.length>1?`since :
`+A.map(nP).join(`
`):" "+nP(A[0]):"as no adapter specified";throw new Br("There is no suitable adapter to dispatch the request "+r,"ERR_NOT_SUPPORT")}return v}const A2={getAdapter:sB,adapters:QR};function KI(d){if(d.cancelToken&&d.cancelToken.throwIfRequested(),d.signal&&d.signal.aborted)throw new Lb(null,d)}function rP(d){return KI(d),d.headers=vu.from(d.headers),d.data=YI.call(d,d.transformRequest),["post","put","patch"].indexOf(d.method)!==-1&&d.headers.setContentType("application/x-www-form-urlencoded",!1),A2.getAdapter(d.adapter||LT.adapter,d)(d).then(function(_){return KI(d),_.data=YI.call(d,d.transformResponse,_),_.headers=vu.from(_.headers),_},function(_){return b2(_)||(KI(d),_&&_.response&&(_.response.data=YI.call(d,d.transformResponse,_.response),_.response.headers=vu.from(_.response.headers))),Promise.reject(_)})}const C2="1.13.1",ZA={};["object","boolean","number","function","string","symbol"].forEach((d,s)=>{ZA[d]=function(_){return typeof _===d||"a"+(s<1?"n ":" ")+d}});const oP={};ZA.transitional=function(s,u,_){function v(E,A){return"[Axios v"+C2+"] Transitional option '"+E+"'"+A+(_?". "+_:"")}return(E,A,r)=>{if(s===!1)throw new Br(v(A," has been removed"+(u?" in "+u:"")),Br.ERR_DEPRECATED);return u&&!oP[A]&&(oP[A]=!0,console.warn(v(A," has been deprecated since v"+u+" and will be removed in the near future"))),s?s(E,A,r):!0}};ZA.spelling=function(s){return(u,_)=>(console.warn(`${_} is likely a misspelling of ${s}`),!0)};function lB(d,s,u){if(typeof d!="object")throw new Br("options must be an object",Br.ERR_BAD_OPTION_VALUE);const _=Object.keys(d);let v=_.length;for(;v-- >0;){const E=_[v],A=s[E];if(A){const r=d[E],L=r===void 0||A(r,E,d);if(L!==!0)throw new Br("option "+E+" must be "+L,Br.ERR_BAD_OPTION_VALUE);continue}if(u!==!0)throw new Br("Unknown option "+E,Br.ERR_BAD_OPTION)}}const vA={assertOptions:lB,validators:ZA},ip=vA.validators;let qv=class{constructor(s){this.defaults=s||{},this.interceptors={request:new qM,response:new qM}}async request(s,u){try{return await this._request(s,u)}catch(_){if(_ instanceof Error){let v={};Error.captureStackTrace?Error.captureStackTrace(v):v=new Error;const E=v.stack?v.stack.replace(/^.+\n/,""):"";try{_.stack?E&&!String(_.stack).endsWith(E.replace(/^.+\n.+\n/,""))&&(_.stack+=`
`+E):_.stack=E}catch{}}throw _}}_request(s,u){typeof s=="string"?(u=u||{},u.url=s):u=s||{},u=Xv(this.defaults,u);const{transitional:_,paramsSerializer:v,headers:E}=u;_!==void 0&&vA.assertOptions(_,{silentJSONParsing:ip.transitional(ip.boolean),forcedJSONParsing:ip.transitional(ip.boolean),clarifyTimeoutError:ip.transitional(ip.boolean)},!1),v!=null&&(Zt.isFunction(v)?u.paramsSerializer={serialize:v}:vA.assertOptions(v,{encode:ip.function,serialize:ip.function},!0)),u.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?u.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:u.allowAbsoluteUrls=!0),vA.assertOptions(u,{baseUrl:ip.spelling("baseURL"),withXsrfToken:ip.spelling("withXSRFToken")},!0),u.method=(u.method||this.defaults.method||"get").toLowerCase();let A=E&&Zt.merge(E.common,E[u.method]);E&&Zt.forEach(["delete","get","head","post","put","patch","common"],de=>{delete E[de]}),u.headers=vu.concat(A,E);const r=[];let L=!0;this.interceptors.request.forEach(function(ve){typeof ve.runWhen=="function"&&ve.runWhen(u)===!1||(L=L&&ve.synchronous,r.unshift(ve.fulfilled,ve.rejected))});const N=[];this.interceptors.response.forEach(function(ve){N.push(ve.fulfilled,ve.rejected)});let H,X=0,re;if(!L){const de=[rP.bind(this),void 0];for(de.unshift(...r),de.push(...N),re=de.length,H=Promise.resolve(u);X<re;)H=H.then(de[X++],de[X++]);return H}re=r.length;let he=u;for(;X<re;){const de=r[X++],ve=r[X++];try{he=de(he)}catch(xe){ve.call(this,xe);break}}try{H=rP.call(this,he)}catch(de){return Promise.reject(de)}for(X=0,re=N.length;X<re;)H=H.then(N[X++],N[X++]);return H}getUri(s){s=Xv(this.defaults,s);const u=T2(s.baseURL,s.url,s.allowAbsoluteUrls);return y2(u,s.params,s.paramsSerializer)}};Zt.forEach(["delete","get","head","options"],function(s){qv.prototype[s]=function(u,_){return this.request(Xv(_||{},{method:s,url:u,data:(_||{}).data}))}});Zt.forEach(["post","put","patch"],function(s){function u(_){return function(E,A,r){return this.request(Xv(r||{},{method:s,headers:_?{"Content-Type":"multipart/form-data"}:{},url:E,data:A}))}}qv.prototype[s]=u(),qv.prototype[s+"Form"]=u(!0)});let cB=class I2{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let u;this.promise=new Promise(function(E){u=E});const _=this;this.promise.then(v=>{if(!_._listeners)return;let E=_._listeners.length;for(;E-- >0;)_._listeners[E](v);_._listeners=null}),this.promise.then=v=>{let E;const A=new Promise(r=>{_.subscribe(r),E=r}).then(v);return A.cancel=function(){_.unsubscribe(E)},A},s(function(E,A,r){_.reason||(_.reason=new Lb(E,A,r),u(_.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const u=this._listeners.indexOf(s);u!==-1&&this._listeners.splice(u,1)}toAbortSignal(){const s=new AbortController,u=_=>{s.abort(_)};return this.subscribe(u),s.signal.unsubscribe=()=>this.unsubscribe(u),s.signal}static source(){let s;return{token:new I2(function(v){s=v}),cancel:s}}};function uB(d){return function(u){return d.apply(null,u)}}function hB(d){return Zt.isObject(d)&&d.isAxiosError===!0}const wR={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(wR).forEach(([d,s])=>{wR[s]=d});function R2(d){const s=new qv(d),u=a2(qv.prototype.request,s);return Zt.extend(u,qv.prototype,s,{allOwnKeys:!0}),Zt.extend(u,s,null,{allOwnKeys:!0}),u.create=function(v){return R2(Xv(d,v))},u}const vs=R2(LT);vs.Axios=qv;vs.CanceledError=Lb;vs.CancelToken=cB;vs.isCancel=b2;vs.VERSION=C2;vs.toFormData=qA;vs.AxiosError=Br;vs.Cancel=vs.CanceledError;vs.all=function(s){return Promise.all(s)};vs.spread=uB;vs.isAxiosError=hB;vs.mergeConfig=Xv;vs.AxiosHeaders=vu;vs.formToJSON=d=>x2(Zt.isHTMLForm(d)?new FormData(d):d);vs.getAdapter=A2.getAdapter;vs.HttpStatusCode=wR;vs.default=vs;const{Axios:g4,AxiosError:_4,CanceledError:y4,isCancel:v4,CancelToken:x4,VERSION:b4,all:w4,Cancel:T4,isAxiosError:S4,spread:E4,toFormData:A4,AxiosHeaders:C4,HttpStatusCode:I4,formToJSON:R4,getAdapter:D4,mergeConfig:M4}=vs,sp=vs.create({baseURL:"http://localhost:3000/api",withCredentials:!0});sp.interceptors.request.use(d=>{const s=localStorage.getItem("access_token");return s&&(d.headers=d.headers??{},d.headers.Authorization=`Bearer ${s}`),d});var D2={exports:{}};(function(d,s){(function(u,_){d.exports=_()})(aL,function(){var u,_,v;function E(r,L){if(!u)u=L;else if(!_)_=L;else{var N="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+_+")(sharedChunk); self.onerror = null;",H={};u(H),v=L(H),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(v.workerUrl=window.URL.createObjectURL(new Blob([N],{type:"text/javascript"})))}}E(["exports"],function(r){var L=1e-6,N=typeof Float32Array<"u"?Float32Array:Array;function H(n,e){var i=e[0],a=e[1],c=e[2],m=e[3],g=i*m-c*a;return g?(n[0]=m*(g=1/g),n[1]=-a*g,n[2]=-c*g,n[3]=i*g,n):null}function X(){var n=new N(9);return N!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function re(n,e){var i=e[0],a=e[1],c=e[2],m=e[3],g=e[4],x=e[5],S=e[6],C=e[7],M=e[8];return n[0]=g*M-x*C,n[1]=c*C-a*M,n[2]=a*x-c*g,n[3]=x*S-m*M,n[4]=i*M-c*S,n[5]=c*m-i*x,n[6]=m*C-g*S,n[7]=a*S-i*C,n[8]=i*g-a*m,n}function he(n,e,i){var a=e[0],c=e[1],m=e[2],g=e[3],x=e[4],S=e[5],C=e[6],M=e[7],P=e[8],k=i[0],V=i[1],U=i[2],q=i[3],J=i[4],ee=i[5],oe=i[6],le=i[7],fe=i[8];return n[0]=k*a+V*g+U*C,n[1]=k*c+V*x+U*M,n[2]=k*m+V*S+U*P,n[3]=q*a+J*g+ee*C,n[4]=q*c+J*x+ee*M,n[5]=q*m+J*S+ee*P,n[6]=oe*a+le*g+fe*C,n[7]=oe*c+le*x+fe*M,n[8]=oe*m+le*S+fe*P,n}function de(){var n=new N(16);return N!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function ve(n){var e=new N(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function xe(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function $e(n,e){var i=e[0],a=e[1],c=e[2],m=e[3],g=e[4],x=e[5],S=e[6],C=e[7],M=e[8],P=e[9],k=e[10],V=e[11],U=e[12],q=e[13],J=e[14],ee=e[15],oe=i*x-a*g,le=i*S-c*g,fe=i*C-m*g,Ie=a*S-c*x,Se=a*C-m*x,Pe=c*C-m*S,ke=M*q-P*U,Be=M*J-k*U,ot=M*ee-V*U,Ze=P*J-k*q,st=P*ee-V*q,dt=k*ee-V*J,wt=oe*dt-le*st+fe*Ze+Ie*ot-Se*Be+Pe*ke;return wt?(n[0]=(x*dt-S*st+C*Ze)*(wt=1/wt),n[1]=(c*st-a*dt-m*Ze)*wt,n[2]=(q*Pe-J*Se+ee*Ie)*wt,n[3]=(k*Se-P*Pe-V*Ie)*wt,n[4]=(S*ot-g*dt-C*Be)*wt,n[5]=(i*dt-c*ot+m*Be)*wt,n[6]=(J*fe-U*Pe-ee*le)*wt,n[7]=(M*Pe-k*fe+V*le)*wt,n[8]=(g*st-x*ot+C*ke)*wt,n[9]=(a*ot-i*st-m*ke)*wt,n[10]=(U*Se-q*fe+ee*oe)*wt,n[11]=(P*fe-M*Se-V*oe)*wt,n[12]=(x*Be-g*Ze-S*ke)*wt,n[13]=(i*Ze-a*Be+c*ke)*wt,n[14]=(q*le-U*Ie-J*oe)*wt,n[15]=(M*Ie-P*le+k*oe)*wt,n):null}function Le(n,e,i){var a=e[0],c=e[1],m=e[2],g=e[3],x=e[4],S=e[5],C=e[6],M=e[7],P=e[8],k=e[9],V=e[10],U=e[11],q=e[12],J=e[13],ee=e[14],oe=e[15],le=i[0],fe=i[1],Ie=i[2],Se=i[3];return n[0]=le*a+fe*x+Ie*P+Se*q,n[1]=le*c+fe*S+Ie*k+Se*J,n[2]=le*m+fe*C+Ie*V+Se*ee,n[3]=le*g+fe*M+Ie*U+Se*oe,n[4]=(le=i[4])*a+(fe=i[5])*x+(Ie=i[6])*P+(Se=i[7])*q,n[5]=le*c+fe*S+Ie*k+Se*J,n[6]=le*m+fe*C+Ie*V+Se*ee,n[7]=le*g+fe*M+Ie*U+Se*oe,n[8]=(le=i[8])*a+(fe=i[9])*x+(Ie=i[10])*P+(Se=i[11])*q,n[9]=le*c+fe*S+Ie*k+Se*J,n[10]=le*m+fe*C+Ie*V+Se*ee,n[11]=le*g+fe*M+Ie*U+Se*oe,n[12]=(le=i[12])*a+(fe=i[13])*x+(Ie=i[14])*P+(Se=i[15])*q,n[13]=le*c+fe*S+Ie*k+Se*J,n[14]=le*m+fe*C+Ie*V+Se*ee,n[15]=le*g+fe*M+Ie*U+Se*oe,n}function Ke(n,e,i){var a,c,m,g,x,S,C,M,P,k,V,U,q=i[0],J=i[1],ee=i[2];return e===n?(n[12]=e[0]*q+e[4]*J+e[8]*ee+e[12],n[13]=e[1]*q+e[5]*J+e[9]*ee+e[13],n[14]=e[2]*q+e[6]*J+e[10]*ee+e[14],n[15]=e[3]*q+e[7]*J+e[11]*ee+e[15]):(c=e[1],m=e[2],g=e[3],x=e[4],S=e[5],C=e[6],M=e[7],P=e[8],k=e[9],V=e[10],U=e[11],n[0]=a=e[0],n[1]=c,n[2]=m,n[3]=g,n[4]=x,n[5]=S,n[6]=C,n[7]=M,n[8]=P,n[9]=k,n[10]=V,n[11]=U,n[12]=a*q+x*J+P*ee+e[12],n[13]=c*q+S*J+k*ee+e[13],n[14]=m*q+C*J+V*ee+e[14],n[15]=g*q+M*J+U*ee+e[15]),n}function Ge(n,e,i){var a=i[0],c=i[1],m=i[2];return n[0]=e[0]*a,n[1]=e[1]*a,n[2]=e[2]*a,n[3]=e[3]*a,n[4]=e[4]*c,n[5]=e[5]*c,n[6]=e[6]*c,n[7]=e[7]*c,n[8]=e[8]*m,n[9]=e[9]*m,n[10]=e[10]*m,n[11]=e[11]*m,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Ye(n,e,i){var a=Math.sin(i),c=Math.cos(i),m=e[4],g=e[5],x=e[6],S=e[7],C=e[8],M=e[9],P=e[10],k=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=m*c+C*a,n[5]=g*c+M*a,n[6]=x*c+P*a,n[7]=S*c+k*a,n[8]=C*c-m*a,n[9]=M*c-g*a,n[10]=P*c-x*a,n[11]=k*c-S*a,n}function mt(n,e,i){var a=Math.sin(i),c=Math.cos(i),m=e[0],g=e[1],x=e[2],S=e[3],C=e[8],M=e[9],P=e[10],k=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=m*c-C*a,n[1]=g*c-M*a,n[2]=x*c-P*a,n[3]=S*c-k*a,n[8]=m*a+C*c,n[9]=g*a+M*c,n[10]=x*a+P*c,n[11]=S*a+k*c,n}function Ct(n,e,i){var a=Math.sin(i),c=Math.cos(i),m=e[0],g=e[1],x=e[2],S=e[3],C=e[4],M=e[5],P=e[6],k=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=m*c+C*a,n[1]=g*c+M*a,n[2]=x*c+P*a,n[3]=S*c+k*a,n[4]=C*c-m*a,n[5]=M*c-g*a,n[6]=P*c-x*a,n[7]=k*c-S*a,n}function Vt(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function ui(n,e,i){var a,c,m,g=i[0],x=i[1],S=i[2],C=Math.sqrt(g*g+x*x+S*S);return C<L?null:(g*=C=1/C,x*=C,S*=C,a=Math.sin(e),c=Math.cos(e),n[0]=g*g*(m=1-c)+c,n[1]=x*g*m+S*a,n[2]=S*g*m-x*a,n[3]=0,n[4]=g*x*m-S*a,n[5]=x*x*m+c,n[6]=S*x*m+g*a,n[7]=0,n[8]=g*S*m+x*a,n[9]=x*S*m-g*a,n[10]=S*S*m+c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function Di(n,e){var i=e[0],a=e[1],c=e[2],m=e[4],g=e[5],x=e[6],S=e[8],C=e[9],M=e[10];return n[0]=Math.sqrt(i*i+a*a+c*c),n[1]=Math.sqrt(m*m+g*g+x*x),n[2]=Math.sqrt(S*S+C*C+M*M),n}function si(n,e){var i=e[0],a=e[1],c=e[2],m=e[3],g=i+i,x=a+a,S=c+c,C=i*g,M=a*g,P=a*x,k=c*g,V=c*x,U=c*S,q=m*g,J=m*x,ee=m*S;return n[0]=1-P-U,n[1]=M+ee,n[2]=k-J,n[3]=0,n[4]=M-ee,n[5]=1-C-U,n[6]=V+q,n[7]=0,n[8]=k+J,n[9]=V-q,n[10]=1-C-P,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}var di=Le;function Nt(){var n=new N(3);return N!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Ii(n){var e=new N(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Qt(n){var e=n[0],i=n[1],a=n[2];return Math.sqrt(e*e+i*i+a*a)}function _t(n,e,i){var a=new N(3);return a[0]=n,a[1]=e,a[2]=i,a}function Et(n,e,i,a){return n[0]=e,n[1]=i,n[2]=a,n}function fi(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function rn(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function zn(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function er(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function Mn(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function pn(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function pr(n,e,i,a){return n[0]=e[0]+i[0]*a,n[1]=e[1]+i[1]*a,n[2]=e[2]+i[2]*a,n}function Vr(n,e){var i=e[0]-n[0],a=e[1]-n[1],c=e[2]-n[2];return Math.sqrt(i*i+a*a+c*c)}function Or(n,e){var i=e[0]-n[0],a=e[1]-n[1],c=e[2]-n[2];return i*i+a*a+c*c}function kr(n){var e=n[0],i=n[1],a=n[2];return e*e+i*i+a*a}function Wr(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function mn(n,e){var i=e[0],a=e[1],c=e[2],m=i*i+a*a+c*c;return m>0&&(m=1/Math.sqrt(m)),n[0]=e[0]*m,n[1]=e[1]*m,n[2]=e[2]*m,n}function Ei(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function Xi(n,e,i){var a=e[0],c=e[1],m=e[2],g=i[0],x=i[1],S=i[2];return n[0]=c*S-m*x,n[1]=m*g-a*S,n[2]=a*x-c*g,n}function Rn(n,e,i,a){var c=e[0],m=e[1],g=e[2];return n[0]=c+a*(i[0]-c),n[1]=m+a*(i[1]-m),n[2]=g+a*(i[2]-g),n}function on(n,e,i){var a=e[0],c=e[1],m=e[2],g=i[3]*a+i[7]*c+i[11]*m+i[15];return n[0]=(i[0]*a+i[4]*c+i[8]*m+i[12])/(g=g||1),n[1]=(i[1]*a+i[5]*c+i[9]*m+i[13])/g,n[2]=(i[2]*a+i[6]*c+i[10]*m+i[14])/g,n}function Ur(n,e,i){var a=e[0],c=e[1],m=e[2];return n[0]=a*i[0]+c*i[3]+m*i[6],n[1]=a*i[1]+c*i[4]+m*i[7],n[2]=a*i[2]+c*i[5]+m*i[8],n}function gr(n,e,i){var a=i[0],c=i[1],m=i[2],g=i[3],x=e[0],S=e[1],C=e[2],M=c*C-m*S,P=m*x-a*C,k=a*S-c*x;return n[0]=x+g*(M+=M)+c*(k+=k)-m*(P+=P),n[1]=S+g*P+m*M-a*k,n[2]=C+g*k+a*P-c*M,n}function tr(n){return n[0]=0,n[1]=0,n[2]=0,n}function co(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var Fr=rn,Da=zn,ma=Qt;function _o(){var n=new N(4);return N!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Oo(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function ba(n,e){var i=e[0],a=e[1],c=e[2],m=e[3],g=i*i+a*a+c*c+m*m;return g>0&&(g=1/Math.sqrt(g)),n[0]=i*g,n[1]=a*g,n[2]=c*g,n[3]=m*g,n}function Uo(n,e,i){var a=e[0],c=e[1],m=e[2],g=e[3];return n[0]=i[0]*a+i[4]*c+i[8]*m+i[12]*g,n[1]=i[1]*a+i[5]*c+i[9]*m+i[13]*g,n[2]=i[2]*a+i[6]*c+i[10]*m+i[14]*g,n[3]=i[3]*a+i[7]*c+i[11]*m+i[15]*g,n}function Io(){var n=new N(4);return N!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function jo(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Yo(n,e,i){i*=.5;var a=e[0],c=e[1],m=e[2],g=e[3],x=Math.sin(i),S=Math.cos(i);return n[0]=a*S+g*x,n[1]=c*S+m*x,n[2]=m*S-c*x,n[3]=g*S-a*x,n}function xs(n,e,i){i*=.5;var a=e[0],c=e[1],m=e[2],g=e[3],x=Math.sin(i),S=Math.cos(i);return n[0]=a*S-m*x,n[1]=c*S+g*x,n[2]=m*S+a*x,n[3]=g*S-c*x,n}Nt(),_o();var $o,Fi,an,ir=ba,jr=($o=Nt(),Fi=_t(1,0,0),an=_t(0,1,0),function(n,e,i){var a=Ei(e,i);return a<-.999999?(Xi($o,Fi,e),ma($o)<1e-6&&Xi($o,an,e),mn($o,$o),function(c,m,g){g*=.5;var x=Math.sin(g);c[0]=x*m[0],c[1]=x*m[1],c[2]=x*m[2],c[3]=Math.cos(g)}(n,$o,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Xi($o,e,i),n[0]=$o[0],n[1]=$o[1],n[2]=$o[2],n[3]=1+a,ir(n,n))});function jn(){var n=new N(2);return N!=Float32Array&&(n[0]=0,n[1]=0),n}function yo(n,e){var i=new N(2);return i[0]=n,i[1]=e,i}function To(n,e,i){return n[0]=e,n[1]=i,n}function Wo(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n}function qr(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n}function wr(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n}function bn(n){var e=n[0],i=n[1];return Math.sqrt(e*e+i*i)}function uo(n,e){var i=e[0],a=e[1],c=i*i+a*a;return c>0&&(c=1/Math.sqrt(c)),n[0]=e[0]*c,n[1]=e[1]*c,n}function wa(n,e){return n[0]*e[0]+n[1]*e[1]}Io(),Io(),X();var ga,ra,tc=qr;function ml(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}jn();var ic=function(){if(ra)return ga;function n(e,i,a,c){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=a,this.p2y=c}return ra=1,ga=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,c=0;c<8;c++){var m=this.sampleCurveX(a)-e;if(Math.abs(m)<i)return a;var g=this.sampleCurveDerivativeX(a);if(Math.abs(g)<1e-6)break;a-=m/g}var x=0,S=1;for(a=e,c=0;c<20&&(m=this.sampleCurveX(a),!(Math.abs(m-e)<i));c++)e>m?x=a:S=a,a=.5*(S-x)+x;return a},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},ga}(),Ks=ml(ic);function Tt(n,e){this.x=n,this.y=e}function Ta(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Ta(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!Ta(n[i],e[i]))return!1;return!0}return n===e}Tt.prototype={clone(){return new Tt(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),i=Math.sin(n),a=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=a,this},_rotateAround(n,e){const i=Math.cos(n),a=Math.sin(n),c=e.y+a*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-a*(this.y-e.y),this.y=c,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Tt},Tt.convert=function(n){if(n instanceof Tt)return n;if(Array.isArray(n))return new Tt(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new Tt(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};const Ga=Math.PI/180,Ma=180/Math.PI;function hn(n){return n*Ga}function Ko(n){return n*Ma}const it=[[0,0],[1,0],[1,1],[0,1]];function bi(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function ie(n,e,i,a){const c=new Ks(n,e,i,a);return function(m){return c.solve(m)}}const W=ie(.25,.1,.25,1);function Y(n,e,i){return Math.min(i,Math.max(e,n))}function ue(n,e,i){return(i=Y((i-n)/(e-n),0,1))*i*(3-2*i)}function we(n,e,i){const a=i-e,c=((n-e)%a+a)%a+e;return c===e?i:c}function ye(n,e,i){if(!n.length)return i(null,[]);let a=n.length;const c=new Array(n.length);let m=null;n.forEach((g,x)=>{e(g,(S,C)=>{S&&(m=S),c[x]=C,--a==0&&i(m,c)})})}let Me=1;function je(){return Me++}function ze(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log2(n)))}function We(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function xt(n,e,i){const a={};for(const c in n)a[c]=e.call(this,n[c],c,n);return a}function ht(n,e,i){const a={};for(const c in n)e.call(this,n[c],c,n)&&(a[c]=n[c]);return a}function ti(n){return Array.isArray(n)?n.map(ti):typeof n=="object"&&n?xt(n,ti):n}function Ri(n,e){for(let i=0;i<n.length;i++)if(e.indexOf(n[i])>=0)return!0;return!1}const xi={};function ei(n){xi[n]||(typeof console<"u"&&console.warn(n),xi[n]=!0)}function Yi(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function un(n){let e=0;for(let i,a,c=0,m=n.length,g=m-1;c<m;g=c++)i=n[c],a=n[g],e+=(a.x-i.x)*(i.y+a.y);return e}function hr([n,e,i]){const a=hn(e+90),c=hn(i);return{x:n*Math.cos(a)*Math.sin(c),y:n*Math.sin(a)*Math.sin(c),z:n*Math.cos(c),azimuthal:e,polar:i}}function Lr(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function Ro(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,c,m)=>{const g=c||m;return e[a]=!g||g.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let ho=null;function to(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function nr(n,e,i,a){for(;e<i;){const c=e+i>>1;n[c]<a?e=c+1:i=c}return e}function Sn(n,e,i,a){for(;e<i;){const c=e+i>>1;n[c]<=a?e=c+1:i=c}return e}function Rr(n){return n>0?1/(1.001-n):1+n}function Zr(n){return n>0?1-1/(1.001-n):-n}function sr(n,e,i){return(n-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Sr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Sr.API_URL)return null;try{const n=new URL(Sr.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function fo(n){return Sr.API_URL_REGEX.test(n)}function oa(n){return Sr.API_SPRITE_REGEX.test(n)}let Ha,Fl,ko,os,Pa,Js;function Ka(){return Ha==null&&(Ha=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ha}const bs={now:()=>os!==void 0?os:performance.now(),setNow(n){os=n},restoreNow(){os=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:a}=n;Pa||(Pa=document.createElement("canvas"));const c=Pa.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(i>Pa.width||a>Pa.height)&&(Pa.width=i,Pa.height=a),c.clearRect(-e,-e,i+2*e,a+2*e),c.drawImage(n,0,0,i,a),c.getImageData(-e,-e,i+2*e,a+2*e)},resolveURL:n=>(Fl||(Fl=document.createElement("a")),Fl.href=n,Fl.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(ko==null&&(ko=window.matchMedia("(prefers-reduced-motion: reduce)")),ko.matches)},hasCanvasFingerprintNoise(){if(Js!==void 0)return Js;if(!Ka())return Js=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let i=0;for(let c=0;c<n.width;++c)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(c,0,1,1);const a=e.getImageData(0,0,n.width,n.height);i=0;for(let c=0;c<a.data.length;++c)if(c%4!=3&&i++!==a.data[c])return Js=!0,!0;return Js=!1,!1}};function Ic(n,e){const i=n.indexOf("?");if(i<0)return`${n}?${new URLSearchParams(e).toString()}`;const a=new URLSearchParams(n.slice(i));for(const c in e)a.set(c,e[c]);return`${n.slice(0,i)}?${a.toString()}`}function ch(n,e={persistentParams:[]}){const i=n.indexOf("?");if(i<0)return n;const a=new URLSearchParams,c=new URLSearchParams(n.slice(i));for(const g of e.persistentParams){const x=c.get(g);x&&a.set(g,x)}const m=a.toString();return`${n.slice(0,i)}${m.length>0?`?${m}`:""}`}const xu="mapbox-tiles";let Gr=500,as=50;const $a=["language","worldview","jobid"];let yn,ss;function aa(){try{return caches}catch{}}function gl(){const n=aa();n&&yn==null&&(yn=n.open(xu))}let nc=1/0;const $d={supported:!1,testSupport:function(n){!Wd&&vo&&(_l?yl(n):Go=n)}};let Go,vo,Wd=!1,_l=!1;const qo=typeof self<"u"?self:{};function yl(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,vo),n.isContextLost())return;$d.supported=!0}catch{}n.deleteTexture(e),Wd=!0}qo.document&&(vo=qo.document.createElement("img"),vo.onload=function(){Go&&yl(Go),Go=null,_l=!0},vo.onerror=function(){Wd=!0,Go=null},vo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const bu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(bu);class rc extends Error{constructor(e,i,a){i===401&&fo(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const qd=Lr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,wu=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(qd())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,c){const m=new AbortController,g=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:qd(),referrerPolicy:a.referrerPolicy,signal:m.signal});let x=!1,S=!1;const C=(M=g.url).indexOf("sku=")>0&&fo(M);var M;a.type==="json"&&g.headers.set("Accept","application/json");const P=(V,U,q)=>{if(S)return;if(V&&V.message!=="SecurityError"&&ei(V.toString()),U&&q)return k(U);const J=Date.now();fetch(g).then(ee=>{if(ee.ok){const oe=C?ee.clone():null;return k(ee,oe,J)}return c(new rc(ee.statusText,ee.status,a.url))}).catch(ee=>{ee.name!=="AbortError"&&c(new Error(`${ee.message} ${a.url}`))})},k=(V,U,q)=>{(a.type==="arrayBuffer"?V.arrayBuffer():a.type==="json"?V.json():V.text()).then(J=>{S||(U&&q&&function(ee,oe,le){if(gl(),yn==null)return;const fe=Ro(oe.headers.get("Cache-Control")||"");if(fe["no-store"])return;const Ie={status:oe.status,statusText:oe.statusText,headers:new Headers};oe.headers.forEach((ke,Be)=>Ie.headers.set(Be,ke)),fe["max-age"]&&Ie.headers.set("Expires",new Date(le+1e3*fe["max-age"]).toUTCString());const Se=Ie.headers.get("Expires");if(!Se||new Date(Se).getTime()-le<42e4)return;let Pe=ch(ee.url,{persistentParams:$a});if(oe.status===206){const ke=ee.headers.get("Range");if(!ke)return;Ie.status=200,Pe=Ic(Pe,{range:ke})}(function(ke,Be){if(ss===void 0)try{new Response(new ReadableStream),ss=!0}catch{ss=!1}ss?Be(ke.body):ke.blob().then(Be).catch(ot=>ei(ot.message))})(oe,ke=>{const Be=new Response((ot=oe.status)!==200&&ot!==404&&[101,103,204,205,304].includes(ot)?null:ke,Ie);var ot;gl(),yn!=null&&yn.then(Ze=>Ze.put(Pe,Be)).catch(Ze=>ei(Ze.message))})}(g,U,q),x=!0,c(null,J,V.headers))}).catch(J=>{S||c(new Error(J.message))})};return C?function(V,U){if(gl(),yn==null)return U(null);yn.then(q=>{let J=ch(V.url,{persistentParams:$a});const ee=V.headers.get("Range");ee&&(J=Ic(J,{range:ee})),q.match(J).then(oe=>{const le=function(fe){if(!fe)return!1;const Ie=new Date(fe.headers.get("Expires")||0),Se=Ro(fe.headers.get("Cache-Control")||"");return Number(Ie)>Date.now()&&!Se["no-cache"]}(oe);q.delete(J).catch(U),le&&q.put(J,oe.clone()).catch(U),U(null,oe,le)}).catch(U)}).catch(U)}(g,P):P(null,null),{cancel:()=>{S=!0,x||m.abort()}}}(n,e);if(Lr(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(a,c){const m=new XMLHttpRequest;m.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const g in a.headers)m.setRequestHeader(g,a.headers[g]);return a.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=a.credentials==="include",m.onerror=()=>{c(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let g=m.response;if(a.type==="json")try{g=JSON.parse(m.response)}catch(S){return c(S)}const x=new Headers;m.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(S=>{const C=S.split(": "),M=C.shift(),P=C.join(": ");x.append(M,P)}),c(null,g,x)}else c(new rc(m.statusText,m.status,a.url))},m.send(a.body),{cancel:()=>m.abort()}}(n,e)},oc=function(n,e){return wu(Object.assign(n,{type:"arrayBuffer"}),e)};function Gn(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const Rc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ac,Tu;ac=[],Tu=0;const sc=function(n,e){if($d.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Tu>=Sr.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ac.push(m),m}Tu++;let i=!1;const a=()=>{if(!i)for(i=!0,Tu--;ac.length&&Tu<Sr.MAX_PARALLEL_IMAGE_REQUESTS;){const m=ac.shift(),{requestParameters:g,callback:x,cancelled:S}=m;S||(m.cancel=sc(g,x).cancel)}},c=oc(n,(m,g,x)=>{a(),m?e(m):g&&(self.createImageBitmap?function(S,C){const M=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(M).then(P=>{C(null,P)}).catch(P=>{C(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(S,C)=>e(S,C,x)):function(S,C){const M=new Image;M.onload=()=>{C(null,M),URL.revokeObjectURL(M.src),M.onload=null,requestAnimationFrame(()=>{M.src=Rc})},M.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(S)],{type:"image/png"});M.src=S.byteLength?URL.createObjectURL(P):Rc}(g,(S,C)=>e(S,C,x)))});return{cancel:()=>{c.cancel(),a()}}};var Dc,Mc,Pc,Oc={exports:{}},dp={exports:{}},uh={exports:{}},Lm=function(){if(Pc)return Oc.exports;Pc=1;var n=(Dc||(Dc=1,dp.exports=function(i,a){var c,m,g,x,S,C,M,P;for(m=i.length-(c=3&i.length),g=a,S=3432918353,C=461845907,P=0;P<m;)M=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,g=27492+(65535&(x=5*(65535&(g=(g^=M=(65535&(M=(M=(65535&M)*S+(((M>>>16)*S&65535)<<16)&4294967295)<<15|M>>>17))*C+(((M>>>16)*C&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(M=0,c){case 3:M^=(255&i.charCodeAt(P+2))<<16;case 2:M^=(255&i.charCodeAt(P+1))<<8;case 1:g^=M=(65535&(M=(M=(65535&(M^=255&i.charCodeAt(P)))*S+(((M>>>16)*S&65535)<<16)&4294967295)<<15|M>>>17))*C+(((M>>>16)*C&65535)<<16)&4294967295}return g^=i.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),dp.exports),e=(Mc||(Mc=1,uh.exports=function(i,a){for(var c,m=i.length,g=a^m,x=0;m>=4;)c=1540483477*(65535&(c=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),m-=4,++x;switch(m){case 3:g^=(255&i.charCodeAt(x+2))<<16;case 2:g^=(255&i.charCodeAt(x+1))<<8;case 1:g=1540483477*(65535&(g^=255&i.charCodeAt(x)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),uh.exports);return Oc.exports=n,Oc.exports.murmur3=n,Oc.exports.murmur2=e,Oc.exports}(),ge=ml(Lm);class Je{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class Ut extends Je{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function Jt(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function Mi(n,e,i){if(i&&i[n]){const a=i[n].indexOf(e);a!==-1&&i[n].splice(a,1)}}class vn{on(e,i){return this._listeners=this._listeners||{},Jt(e,i,this._listeners),this}off(e,i){return Mi(e,i,this._listeners),Mi(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Jt(e,i,this._oneTimeListeners),this):new Promise(a=>{this.once(e,a)})}fire(e,i){const a=typeof e=="string"?new Je(e,i):e,c=a.type;if(this.listens(c)){a.target=this;const m=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const S of m)S.call(this,a);const g=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const S of g)Mi(c,S,this._oneTimeListeners),S.call(this,a);const x=this._eventedParent;if(x){const S=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(a,S),x.fire(a)}}else a instanceof Ut&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class ki{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new ki(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,a]=e.split("");return new ki({name:i,iconsetId:a})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return ki.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Zn,Dr={},po=function(){if(Zn)return Dr;Zn=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(m){return(m=Math.round(m))<0?0:m>255?255:m}function i(m){return e(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function a(m){return(g=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:g>1?1:g;var g}function c(m,g,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?m+(g-m)*x*6:2*x<1?g:3*x<2?m+(g-m)*(2/3-x)*6:m}try{Dr.parseCSSColor=function(m){var g,x=m.replace(/ /g,"").toLowerCase();if(x in n)return n[x].slice();if(x[0]==="#")return x.length===4?(g=parseInt(x.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:x.length===7&&(g=parseInt(x.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var S=x.indexOf("("),C=x.indexOf(")");if(S!==-1&&C+1===x.length){var M=x.substr(0,S),P=x.substr(S+1,C-(S+1)).split(","),k=1;switch(M){case"rgba":if(P.length!==4)return null;k=a(P.pop());case"rgb":return P.length!==3?null:[i(P[0]),i(P[1]),i(P[2]),k];case"hsla":if(P.length!==4)return null;k=a(P.pop());case"hsl":if(P.length!==3)return null;var V=(parseFloat(P[0])%360+360)%360/360,U=a(P[1]),q=a(P[2]),J=q<=.5?q*(U+1):q+U-q*U,ee=2*q-J;return[e(255*c(ee,J,V+1/3)),e(255*c(ee,J,V)),e(255*c(ee,J,V-1/3)),k];default:return null}}return null}}catch{}return Dr}();class Qi{constructor(e,i,a,c=1){this.r=e,this.g=i,this.b=a,this.a=c}static parse(e){if(!e)return;if(e instanceof Qi)return e;if(typeof e!="string")return;const i=po.parseCSSColor(e);return i?new Qi(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,a,c]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*a)},${c})`}toNonPremultipliedRenderColor(e){const{r:i,g:a,b:c,a:m}=this;return new Er(e,i,a,c,m)}toPremultipliedRenderColor(e){const{r:i,g:a,b:c,a:m}=this;return new Jo(e,i*m,a*m,c*m,m)}clone(){return new Qi(this.r,this.g,this.b,this.a)}}class Fo{constructor(e,i,a,c,m,g=!1){if(this.premultiplied=!1,this.premultiplied=g,e){const x=e.image.height,S=x*x;this.premultiplied?(i=m===0?0:i/m*(x-1),a=m===0?0:a/m*(x-1),c=m===0?0:c/m*(x-1)):(i*=x-1,a*=x-1,c*=x-1);const C=Math.floor(i),M=Math.floor(a),P=Math.floor(c),k=Math.ceil(i),V=Math.ceil(a),U=Math.ceil(c),q=i-C,J=a-M,ee=c-P,oe=e.image.data,le=4*(C+M*S+P*x),fe=4*(C+M*S+U*x),Ie=4*(C+V*S+P*x),Se=4*(C+V*S+U*x),Pe=4*(k+M*S+P*x),ke=4*(k+M*S+U*x),Be=4*(k+V*S+P*x),ot=4*(k+V*S+U*x);if(le<0||ot>=oe.length)throw new Error("out of range");this.r=Si(Si(Si(oe[le],oe[fe],ee),Si(oe[Ie],oe[Se],ee),J),Si(Si(oe[Pe],oe[ke],ee),Si(oe[Be],oe[ot],ee),J),q)/255*(this.premultiplied?m:1),this.g=Si(Si(Si(oe[le+1],oe[fe+1],ee),Si(oe[Ie+1],oe[Se+1],ee),J),Si(Si(oe[Pe+1],oe[ke+1],ee),Si(oe[Be+1],oe[ot+1],ee),J),q)/255*(this.premultiplied?m:1),this.b=Si(Si(Si(oe[le+2],oe[fe+2],ee),Si(oe[Ie+2],oe[Se+2],ee),J),Si(Si(oe[Pe+2],oe[ke+2],ee),Si(oe[Be+2],oe[ot+2],ee),J),q)/255*(this.premultiplied?m:1),this.a=m}else this.r=i,this.g=a,this.b=c,this.a=m}toArray(){const{r:e,g:i,b:a,a:c}=this;return[255*e,255*i,255*a,c]}toHslaArray(){let{r:e,g:i,b:a,a:c}=this;if(this.premultiplied){if(c===0)return[0,0,0,0];const U=1/c;e*=U,i*=U,a*=U}const m=Math.min(Math.max(e,0),1),g=Math.min(Math.max(i,0),1),x=Math.min(Math.max(a,0),1),S=Math.min(m,g,x),C=Math.max(m,g,x),M=C-S,P=.5*(S+C);if(M===0)return[0,0,100*P,c];const k=P>.5?M/(2-C-S):M/(C+S);let V;switch(C){case m:V=60*((g-x)/M+(g<x?6:0));break;case g:V=60*((x-m)/M+2);break;default:V=60*((m-g)/M+4)}return[V,100*k,100*P,c]}toArray01(){const{r:e,g:i,b:a,a:c}=this;return[e,i,a,c]}toArray01Scaled(e){const{r:i,g:a,b:c}=this;return[i*e,a*e,c*e]}toArray01Linear(){const{r:e,g:i,b:a,a:c}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(a,2.2),c]}}class Er extends Fo{constructor(e,i,a,c,m){super(e,i,a,c,m,!1)}}class Jo extends Fo{constructor(e,i,a,c,m){super(e,i,a,c,m,!0)}}function Si(n,e,i){return n*(1-i)+e*i}function lc(n,e,i){return n.map((a,c)=>Si(a,e[c],i))}Qi.black=new Qi(0,0,0,1),Qi.white=new Qi(1,1,1,1),Qi.transparent=new Qi(0,0,0,0),Qi.red=new Qi(1,0,0,1),Qi.blue=new Qi(0,0,1,1);var vl=Object.freeze({__proto__:null,array:lc,color:function(n,e,i){return new Qi(Si(n.r,e.r,i),Si(n.g,e.g,i),Si(n.b,e.b,i),Si(n.a,e.a,i))},number:Si});class Oa extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class ws{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,c]of i)this.bindings[a]=c}concat(e){return new ws(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const kc={kind:"null"},Ti={kind:"number"},Pn={kind:"string"},Xn={kind:"boolean"},ks={kind:"color"},hh={kind:"object"},dr={kind:"value"},Zd={kind:"collator"},dh={kind:"formatted"},fp={kind:"resolvedImage"};function Lo(n,e){return{kind:"array",itemType:n,N:e}}function na(n){if(n.kind==="array"){const e=na(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const N_=[kc,Ti,Pn,Xn,ks,dh,hh,Lo(dr),fp];function ld(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ld(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of N_)if(!ld(i,e))return null}}return`Expected ${na(n)} but found ${na(e)} instead.`}function pp(n,e){return e.some(i=>i.kind===n.kind)}function mp(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}function cd(n,e){return n.kind==="array"&&e.kind==="array"?n.N===e.N&&cd(n.itemType,e.itemType):n.kind===e.kind}class zm{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ja{constructor(e,i,a,c,m){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=a,this.fontStack=c,this.textColor=m}}class Do{constructor(e){this.sections=e}static fromString(e){return new Do([new Ja(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Do?e:Do.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const c=i.image.getPrimary().id.toString();e.push(["image",c]);continue}e.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(a)}return e}}class zo{constructor(e,i={}){if(this.id=ki.from(e),this.options=Object.assign({},i),i.transform){const{a,b:c,c:m,d:g,e:x,f:S}=i.transform;this.options.transform=new DOMMatrix([a,c,m,g,x,S])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:a,d:c,e:m,f:g}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:a,d:c,e:m,f:g}})}static parse(e){let i,a,c,m;try{({name:i,iconsetId:a,params:c,transform:m}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:g,b:x,c:S,d:C,e:M,f:P}=m||{};return new zo({name:i,iconsetId:a},{params:c,transform:new DOMMatrix([g,x,S,C,M,P])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class sa{constructor(e,i,a,c,m=!1){this.primaryId=ki.from(e),this.primaryOptions=i,a&&(this.secondaryId=ki.from(a)),this.secondaryOptions=c,this.available=m}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new zo(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new zo(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?sa.build({name:e}):e}static build(e,i,a,c){return!e||typeof e=="object"&&!("name"in e)?null:new sa(e,a,i,c)}}function Xd(n,e,i,a){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,e,i,a]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Su(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Qi||n instanceof zm||n instanceof Do||n instanceof sa)return!0;if(Array.isArray(n)){for(const e of n)if(!Su(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Su(n[e]))return!1;return!0}return!1}function _a(n){if(n===null)return kc;if(typeof n=="string")return Pn;if(typeof n=="boolean")return Xn;if(typeof n=="number")return Ti;if(n instanceof Qi)return ks;if(n instanceof zm)return Zd;if(n instanceof Do)return dh;if(n instanceof sa)return fp;if(Array.isArray(n)){const e=n.length;let i;for(const a of n){const c=_a(a);if(i){if(i===c)continue;i=dr;break}i=c}return Lo(i||dr,e)}return hh}function Qs(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Do||n instanceof sa||n instanceof Qi?n.toString():JSON.stringify(n)}class Eu{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Su(e[1]))return i.error("invalid value");const a=e[1];let c=_a(a);const m=i.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new Eu(c,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Qi?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Do?this.value.serialize():this.value}}class No{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const sn={string:Pn,number:Ti,boolean:Xn,object:hh};class _i{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,c=1;const m=e[0];if(m==="array"){let x,S;if(e.length>2){const C=e[1];if(typeof C!="string"||!(C in sn)||C==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=sn[C],c++}else x=dr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);S=e[2],c++}a=Lo(x,S)}else a=sn[m];const g=[];for(;c<e.length;c++){const x=i.parse(e[c],c,dr);if(!x)return null;g.push(x)}return new _i(a,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!ld(this.type,_a(a)))return a;if(i===this.args.length-1)throw new No(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${na(_a(a))} but was expected to be of type ${na(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(a=>a.serialize()))}}class ud{constructor(e){this.type=dh,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const c=[];let m=!1;for(let g=1;g<=e.length-1;++g){const x=e[g];if(m&&typeof x=="object"&&!Array.isArray(x)){m=!1;let S=null;if(x["font-scale"]&&(S=i.parseObjectValue(x["font-scale"],g,"font-scale",Ti),!S))return null;let C=null;if(x["text-font"]&&(C=i.parseObjectValue(x["text-font"],g,"text-font",Lo(Pn)),!C))return null;let M=null;if(x["text-color"]&&(M=i.parseObjectValue(x["text-color"],g,"text-color",ks),!M))return null;const P=c[c.length-1];P.scale=S,P.font=C,P.textColor=M}else{const S=i.parse(e[g],g,dr);if(!S)return null;const C=S.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:S,scale:null,font:null,textColor:null})}}return new ud(c)}evaluate(e){return new Do(this.sections.map(i=>{const a=i.content.evaluate(e);return cd(_a(a),fp)?new Ja("",a,null,null,null):new Ja(Qs(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class Gi{constructor(e,i,a,c){this._imageWarnHistory={},this.type=fp,this.namePrimary=e,this.nameSecondary=i,a&&(this.paramsPrimary=a.params,this.iconsetIdPrimary=a.iconset?a.iconset.id:void 0),c&&(this.paramsSecondary=c.params,this.iconsetIdSecondary=c.iconset?c.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let a=1;const c=[];function m(){if(a<e.length){const x=i.parse(e[a],a++,Pn);return x?(c.push({image:x,options:{}}),!0):(i.error(c.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(a<e.length){const S=e[a];if((x=S)===null||typeof x!="object"||Array.isArray(x))return!0;const C=S.params,M=S.iconset,P=i.concat(a);if(!C&&!M)return a++,!0;if(C){if(typeof C!="object"||C.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const k={},V=P.concat(void 0,"params");for(const U in C){if(!U)return V.error("Image parameter name should be non-empty"),!1;const q=V.concat(void 0,U).parse(C[U],void 0,ks,void 0,{typeAnnotation:"coerce"});if(!q)return!1;k[U]=q}c[c.length-1].options.params=k}if(M){if(typeof M!="object"||M.constructor!==Object)return P.error('Image options "iconset" should be an object'),!1;if(!M.id)return P.error('Image options "iconset" should have an "id" property'),!1;c[c.length-1].options.iconset=M}return a++,!0}var x;return!0}for(let x=0;x<2;x++)if(!m()||!g())return;return new Gi(c[0].image,c[1]?c[1].image:void 0,c[0].options,c[1]?c[1].options:void 0)}evaluateParams(e,i){const a={};if(i){for(const c in i)if(i[c])try{a[c]=i[c].evaluate(e)}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},a=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,c=sa.build(i,a,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(c&&e.availableImages){const m=c.getPrimary().id;if(c.available=e.availableImages.some(g=>ki.isEqual(g,m)),c.available){const g=c.getSecondary()?c.getSecondary().id:null;g&&(c.available=e.availableImages.some(x=>ki.isEqual(x,g)))}}return c}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const a={};if(i&&(a.iconset={id:i}),e){a.params={};for(const c in e)e[c]&&(a.params[c]=e[c].serialize())}return Object.keys(a).length>0?a:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function hd(n){return Vi(n)?"string":gp(n)?"number":_p(n)?"boolean":Array.isArray(n)?"array":n===null?"null":Nm(n)?"object":typeof n}function Nm(n){return n!=null&&!Array.isArray(n)&&typeof n!="function"&&!(n instanceof String||n instanceof Number||n instanceof Boolean)&&typeof n=="object"}function Vi(n){return typeof n=="string"||n instanceof String}function gp(n){return typeof n=="number"||n instanceof Number}function _p(n){return typeof n=="boolean"||n instanceof Boolean}const dd={"to-boolean":Xn,"to-color":ks,"to-number":Ti,"to-string":Pn};class Ll{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0],c=[];let m=kc;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const g=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);m=Lo(i.expectedType.itemType,g)}else{if(!(g>0&&Su(e[1][0])))return null;m=Lo(_a(e[1][0]),g)}for(let x=0;x<g;x++){const S=e[1][x];let C;if(Array.isArray(S))C=i.parse(S,void 0,m.itemType);else{const M=hd(S);if(M!==m.itemType.kind)return i.error(`Expected ${m.itemType.kind} but found ${M}.`);C=i.registry.literal.parse(["literal",S===void 0?null:S],i)}if(!C)return null;c.push(C)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");m=dd[a];for(let g=1;g<e.length;g++){const x=i.parse(e[g],g,dr);if(!x)return null;c.push(x)}}return new Ll(m,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,a;for(const c of this.args){if(i=c.evaluate(e),a=null,i instanceof Qi)return i;if(typeof i=="string"){const m=e.parseColor(i);if(m)return m}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Xd(i[0],i[1],i[2],i[3]),!a))return new Qi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new No(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new No(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Do.fromString(Qs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?sa.build(Qs(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):Qs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ud([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Gi(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const yp=["Unknown","Point","LineString","Polygon"];class Sa{constructor(e,i,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?yp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-e[0])+this.featureDistanceData.bearing[1]*(c*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Qi.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class ls{constructor(e,i,a,c,m){this.name=e,this.type=i,this._evaluate=a,this.args=c,this._overloadIndex=m}evaluate(e){if(!this._evaluate){const i=ls.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const a=e[0],c=ls.definitions[a];if(!c)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,x=[];let S=null,C=-1;for(const[M,P]of g){if(Array.isArray(M)&&M.length!==e.length-1)continue;x.push(M),C++,S=new Jm(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const k=[];let V=!1;for(let U=1;U<e.length;U++){const q=e[U],J=Array.isArray(M)?M[U-1]:M.type,ee=S.parse(q,1+k.length,J);if(!ee){V=!0;break}k.push(ee)}if(!V)if(Array.isArray(M)&&M.length!==k.length)S.error(`Expected ${M.length} arguments, but found ${k.length} instead.`);else{for(let U=0;U<k.length;U++){const q=Array.isArray(M)?M[U]:M.type,J=k[U];S.concat(U+1).checkSubtype(q,J.type)}if(S.errors.length===0)return new ls(a,m,P,k,C)}}if(x.length===1)i.errors.push(...S.errors);else{const M=(x.length?x:g.map(([k])=>k)).map(fd).join(" | "),P=[];for(let k=1;k<e.length;k++){const V=i.parse(e[k],1+P.length);if(!V)return null;P.push(na(V.type))}i.error(`Expected arguments of type ${M}, but found (${P.join(", ")}) instead.`)}return null}static register(e,i){ls.definitions=i;for(const a in i)e[a]=ls}}function fd(n){return Array.isArray(n)?`(${n.map(na).join(", ")})`:`(${na(n.type)}...)`}class Yd{constructor(e,i,a){this.type=Zd,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const c=a["case-sensitive"]===void 0?i.parse(!1,1,Xn):i.parseObjectValue(a["case-sensitive"],1,"case-sensitive",Xn);if(!c)return null;const m=a["diacritic-sensitive"]===void 0?i.parse(!1,1,Xn):i.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",Xn);if(!m)return null;let g=null;return a.locale&&(g=i.parseObjectValue(a.locale,1,"locale",Pn),!g)?null:new Yd(c,m,g)}evaluate(e){return new zm(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Au(n,e,i=0,a=n.length-1,c=Nb){for(;a>i;){if(a-i>600){const S=a-i+1,C=e-i+1,M=Math.log(S),P=.5*Math.exp(2*M/3),k=.5*Math.sqrt(M*P*(S-P)/S)*(C-S/2<0?-1:1);Au(n,e,Math.max(i,Math.floor(e-C*P/S+k)),Math.min(a,Math.floor(e+(S-C)*P/S+k)),c)}const m=n[e];let g=i,x=a;for(ka(n,i,e),c(n[a],m)>0&&ka(n,i,a);g<x;){for(ka(n,g,x),g++,x--;c(n[g],m)<0;)g++;for(;c(n[x],m)>0;)x--}c(n[i],m)===0?ka(n,i,x):(x++,ka(n,x,a)),x<=e&&(i=x+1),e<=x&&(a=x-1)}}function ka(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}function Nb(n,e){return n<e?-1:n>e?1:0}function Bb(n){let e=0;for(let i,a,c=0,m=n.length,g=m-1;c<m;g=c++)i=n[c],a=n[g],e+=(a.x-i.x)*(i.y+a.y);return e}function vp(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Cu(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function ex(n,e,i){const a=n[0]-e[0],c=n[1]-e[1],m=n[0]-i[0],g=n[1]-i[1];return a*g-m*c==0&&a*m<=0&&c*g<=0}function xl(n,e,i=!1){let a=!1;for(let x=0,S=e.length;x<S;x++){const C=e[x];for(let M=0,P=C.length,k=P-1;M<P;k=M++){const V=C[k],U=C[M];if(ex(n,V,U))return i;(m=V)[1]>(c=n)[1]!=(g=U)[1]>c[1]&&c[0]<(g[0]-m[0])*(c[1]-m[1])/(g[1]-m[1])+m[0]&&(a=!a)}}var c,m,g;return a}function tx(n,e,i,a){const c=a[0]-i[0],m=a[1]-i[1],g=(n[0]-i[0])*m-c*(n[1]-i[1]),x=(e[0]-i[0])*m-c*(e[1]-i[1]);return g>0&&x<0||g<0&&x>0}function Bm(n,e,i,a){return(c=[a[0]-i[0],a[1]-i[1]])[0]*(m=[e[0]-n[0],e[1]-n[1]])[1]-c[1]*m[0]!=0&&!(!tx(n,e,i,a)||!tx(i,a,n,e));var c,m}function xp(n){const e=new Tt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Tt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const a of n[0])e.x>a.x&&(e.x=a.x),e.y>a.y&&(e.y=a.y),i.x<a.x&&(i.x=a.x),i.y<a.y&&(i.y=a.y);return{min:e,max:i}}const fh=8192;function B_(n,e){const i=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*fh),Math.round(a*c*fh)]}function ph(n,e){for(let i=0;i<e.length;i++)if(xl(n,e[i]))return!0;return!1}function Vm(n,e,i){for(const a of i)for(let c=0,m=a.length,g=m-1;c<m;g=c++)if(Bm(n,e,a[g],a[c]))return!0;return!1}function Iu(n,e){for(let i=0;i<n.length;++i)if(!xl(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(Vm(n[i],n[i+1],e))return!1;return!0}function Kd(n,e){for(let i=0;i<e.length;i++)if(Iu(n,e[i]))return!0;return!1}function V_(n,e,i){const a=[];for(let c=0;c<n.length;c++){const m=[];for(let g=0;g<n[c].length;g++){const x=B_(n[c][g],i);vp(e,x),m.push(x)}a.push(m)}return a}function Um(n,e,i){const a=[];for(let c=0;c<n.length;c++){const m=V_(n[c],e,i);a.push(m)}return a}function U_(n,e,i,a){if(n[0]<i[0]||n[0]>i[2]){const c=.5*a;let m=n[0]-i[0]>c?-a:i[0]-n[0]>c?a:0;m===0&&(m=n[0]-i[2]>c?-a:i[2]-n[0]>c?a:0),n[0]+=m}vp(e,n)}function j_(n,e,i,a){const c=Math.pow(2,a.z)*fh,m=[a.x*fh,a.y*fh],g=[];if(!n)return g;for(const x of n)for(const S of x){const C=[S.x+m[0],S.y+m[1]];U_(C,e,i,c),g.push(C)}return g}function zl(n,e,i,a){const c=Math.pow(2,a.z)*fh,m=[a.x*fh,a.y*fh],g=[];if(!n)return g;for(const S of n){const C=[];for(const M of S){const P=[M.x+m[0],M.y+m[1]];vp(e,P),C.push(P)}g.push(C)}if(e[2]-e[0]<=c/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const S of g)for(const C of S)U_(C,e,i,c)}var x;return g}class mh{constructor(e,i){this.type=Xn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Su(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let c=0;c<a.features.length;++c){const m=a.features[c].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new mh(a,a.features[c].geometry)}else if(a.type==="Feature"){const c=a.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new mh(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new mh(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,a){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(a.type==="Polygon"){const x=V_(a.coordinates,m,g),S=j_(i.geometry(),c,m,g);if(!Cu(c,m))return!1;for(const C of S)if(!xl(C,x))return!1}if(a.type==="MultiPolygon"){const x=Um(a.coordinates,m,g),S=j_(i.geometry(),c,m,g);if(!Cu(c,m))return!1;for(const C of S)if(!ph(C,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,a){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(a.type==="Polygon"){const x=V_(a.coordinates,m,g),S=zl(i.geometry(),c,m,g);if(!Cu(c,m))return!1;for(const C of S)if(!Iu(C,x))return!1}if(a.type==="MultiPolygon"){const x=Um(a.coordinates,m,g),S=zl(i.geometry(),c,m,g);if(!Cu(c,m))return!1;for(const C of S)if(!Kd(C,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const bp={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},jm=1/298.257223563,cs=jm*(2-jm),pd=Math.PI/180;class Jd{static fromTile(e,i,a){const c=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),m=Math.atan(.5*(Math.exp(c)-Math.exp(-c)))/pd;return new Jd(m,a)}static get units(){return bp}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!bp[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(bp).join(", ")}`);const a=6378.137*pd*(i?bp[i]:1),c=Math.cos(e*pd),m=1/(1-cs*(1-c*c)),g=Math.sqrt(m);this.kx=a*g*c,this.ky=a*g*m*(1-cs)}distance(e,i){const a=bl(e[0]-i[0])*this.kx,c=(e[1]-i[1])*this.ky;return Math.sqrt(a*a+c*c)}bearing(e,i){const a=bl(i[0]-e[0])*this.kx;return Math.atan2(a,(i[1]-e[1])*this.ky)/pd}destination(e,i,a){const c=a*pd;return this.offset(e,Math.sin(c)*i,Math.cos(c)*i)}offset(e,i,a){return[e[0]+i/this.kx,e[1]+a/this.ky]}lineDistance(e){let i=0;for(let a=0;a<e.length-1;a++)i+=this.distance(e[a],e[a+1]);return i}area(e){let i=0;for(let a=0;a<e.length;a++){const c=e[a];for(let m=0,g=c.length,x=g-1;m<g;x=m++)i+=bl(c[m][0]-c[x][0])*(c[m][1]+c[x][1])*(a?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let a=0;if(i<=0)return e[0];for(let c=0;c<e.length-1;c++){const m=e[c],g=e[c+1],x=this.distance(m,g);if(a+=x,a>i)return Gm(m,g,(i-(a-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,i,a){let[c,m]=i,g=bl(a[0]-c)*this.kx,x=(a[1]-m)*this.ky;if(g!==0||x!==0){const S=(bl(e[0]-c)*this.kx*g+(e[1]-m)*this.ky*x)/(g*g+x*x);S>1?(c=a[0],m=a[1]):S>0&&(c+=g/this.kx*S,m+=x/this.ky*S)}return g=bl(e[0]-c)*this.kx,x=(e[1]-m)*this.ky,Math.sqrt(g*g+x*x)}pointOnLine(e,i){let a=1/0,c=e[0][0],m=e[0][1],g=0,x=0;for(let S=0;S<e.length-1;S++){let C=e[S][0],M=e[S][1],P=bl(e[S+1][0]-C)*this.kx,k=(e[S+1][1]-M)*this.ky,V=0;P===0&&k===0||(V=(bl(i[0]-C)*this.kx*P+(i[1]-M)*this.ky*k)/(P*P+k*k),V>1?(C=e[S+1][0],M=e[S+1][1]):V>0&&(C+=P/this.kx*V,M+=k/this.ky*V)),P=bl(i[0]-C)*this.kx,k=(i[1]-M)*this.ky;const U=P*P+k*k;U<a&&(a=U,c=C,m=M,g=S,x=V)}return{point:[c,m],index:g,t:Math.max(0,Math.min(1,x))}}lineSlice(e,i,a){let c=this.pointOnLine(a,e),m=this.pointOnLine(a,i);if(c.index>m.index||c.index===m.index&&c.t>m.t){const C=c;c=m,m=C}const g=[c.point],x=c.index+1,S=m.index;!G_(a[x],g[0])&&x<=S&&g.push(a[x]);for(let C=x+1;C<=S;C++)g.push(a[C]);return G_(a[S],m.point)||g.push(m.point),g}lineSliceAlong(e,i,a){let c=0;const m=[];for(let g=0;g<a.length-1;g++){const x=a[g],S=a[g+1],C=this.distance(x,S);if(c+=C,c>e&&m.length===0&&m.push(Gm(x,S,(e-(c-C))/C)),c>=i)return m.push(Gm(x,S,(i-(c-C))/C)),m;c>e&&m.push(S)}return m}bufferPoint(e,i){const a=i/this.ky,c=i/this.kx;return[e[0]-c,e[1]-a,e[0]+c,e[1]+a]}bufferBBox(e,i){const a=i/this.ky,c=i/this.kx;return[e[0]-c,e[1]-a,e[2]+c,e[3]+a]}insideBBox(e,i){return bl(e[0]-i[0])>=0&&bl(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function G_(n,e){return n[0]===e[0]&&n[1]===e[1]}function Gm(n,e,i){const a=bl(e[0]-n[0]);return[n[0]+a*i,n[1]+(e[1]-n[1])*i]}function bl(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class Hm{constructor(e=[],i=(a,c)=>a<c?-1:a>c?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,c=i[e];for(;e>0;){const m=e-1>>1,g=i[m];if(a(c,g)>=0)break;i[e]=g,e=m}i[e]=c}_down(e){const{data:i,compare:a}=this,c=this.length>>1,m=i[e];for(;e<c;){let g=1+(e<<1);const x=g+1;if(x<this.length&&a(i[x],i[g])<0&&(g=x),a(i[g],m)>=0)break;i[e]=i[g],e=g}i[e]=m}}var Bt=8192;function wp(n,e){return e.dist-n.dist}const Fc=100,Qd=50;function Ru(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}function Tp(n){return n[1]-n[0]+1}function Lc(n,e){const i=n[1]>=n[0]&&n[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function $m(n,e){if(n[0]>n[1])return[null,null];const i=Tp(n);if(e){if(i===2)return[n,null];const a=Math.floor(i/2);return[[n[0],n[0]+a],[n[0]+a,n[1]]]}{if(i===1)return[n,null];const a=Math.floor(i/2)-1;return[[n[0],n[0]+a],[n[0]+a+1,n[1]]]}}function el(n,e){const i=[1/0,1/0,-1/0,-1/0];if(!Lc(e,n.length))return i;for(let a=e[0];a<=e[1];++a)vp(i,n[a]);return i}function Tn(n){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;++i)for(let a=0;a<n[i].length;++a)vp(e,n[i][a]);return e}function cc(n,e,i){if(Ru(n)||Ru(e))return NaN;let a=0,c=0;return n[2]<e[0]&&(a=e[0]-n[2]),n[0]>e[2]&&(a=n[0]-e[2]),n[1]>e[3]&&(c=n[1]-e[3]),n[3]<e[1]&&(c=e[1]-n[3]),i.distance([0,0],[a,c])}function ef(n){return 360*n-180}function ix(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Wm(n,e){const i=Math.pow(2,e.z),a=(n.y/Bt+e.y)/i;return[ef((n.x/Bt+e.x)/i),ix(a)]}function nx(n,e){const i=[];for(let a=0;a<n.length;++a)i.push(Wm(n[a],e));return i}function io(n,e,i){const a=i.pointOnLine(e,n).point;return i.distance(n,a)}function H_(n,e,i,a,c){const m=i.slice(a[0],a[1]+1);let g=1/0;for(let x=e[0];x<=e[1];++x)if((g=Math.min(g,io(n[x],m,c)))===0)return 0;return g}function qm(n,e,i,a,c){const m=Math.min(c.pointToSegmentDistance(n,i,a),c.pointToSegmentDistance(e,i,a)),g=Math.min(c.pointToSegmentDistance(i,n,e),c.pointToSegmentDistance(a,n,e));return Math.min(m,g)}function rx(n,e,i,a,c){if(!Lc(e,n.length)||!Lc(a,i.length))return NaN;let m=1/0;for(let g=e[0];g<e[1];++g)for(let x=a[0];x<a[1];++x){if(Bm(n[g],n[g+1],i[x],i[x+1]))return 0;m=Math.min(m,qm(n[g],n[g+1],i[x],i[x+1],c))}return m}function $_(n,e,i,a,c){if(!Lc(e,n.length)||!Lc(a,i.length))return NaN;let m=1/0;for(let g=e[0];g<=e[1];++g)for(let x=a[0];x<=a[1];++x)if((m=Math.min(m,c.distance(n[g],i[x])))===0)return m;return m}function Vb(n,e,i){if(xl(n,e,!0))return 0;let a=1/0;for(const c of e){const m=c.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[m-1]&&(a=Math.min(a,i.pointToSegmentDistance(n,c[m-1],c[0])))===0||(a=Math.min(a,io(n,c,i)))===0)return a}return a}function ox(n,e,i,a){if(!Lc(e,n.length))return NaN;for(let m=e[0];m<=e[1];++m)if(xl(n[m],i,!0))return 0;let c=1/0;for(let m=e[0];m<e[1];++m)for(const g of i)for(let x=0,S=g.length,C=S-1;x<S;C=x++){if(Bm(n[m],n[m+1],g[C],g[x]))return 0;c=Math.min(c,qm(n[m],n[m+1],g[C],g[x],a))}return c}function ax(n,e){for(const i of n)for(let a=0;a<=i.length-1;++a)if(xl(i[a],e,!0))return!0;return!1}function Ub(n,e,i,a=1/0){const c=Tn(n),m=Tn(e);if(a!==1/0&&cc(c,m,i)>=a)return a;if(Cu(c,m)){if(ax(n,e))return 0}else if(ax(e,n))return 0;let g=a;for(const x of n)for(let S=0,C=x.length,M=C-1;S<C;M=S++)for(const P of e)for(let k=0,V=P.length,U=V-1;k<V;U=k++){if(Bm(x[M],x[S],P[U],P[k]))return 0;g=Math.min(g,qm(x[M],x[S],P[U],P[k],i))}return g}function Zm(n,e,i,a,c,m,g){if(m===null||g===null)return;const x=cc(el(a,m),el(c,g),i);x<e&&n.push({dist:x,range1:m,range2:g})}function Sp(n,e,i,a,c=1/0){let m=Math.min(a.distance(n[0],i[0][0]),c);if(m===0)return m;const g=new Hm([{dist:0,range1:[0,n.length-1],range2:[0,0]}],wp),x=e?Qd:Fc,S=Tn(i);for(;g.length;){const C=g.pop();if(C.dist>=m)continue;const M=C.range1;if(Tp(M)<=x){if(!Lc(M,n.length))return NaN;if(e){const P=ox(n,M,i,a);if((m=Math.min(m,P))===0)return m}else for(let P=M[0];P<=M[1];++P){const k=Vb(n[P],i,a);if((m=Math.min(m,k))===0)return m}}else{const P=$m(M,e);if(P[0]!==null){const k=cc(el(n,P[0]),S,a);k<m&&g.push({dist:k,range1:P[0],range2:[0,0]})}if(P[1]!==null){const k=cc(el(n,P[1]),S,a);k<m&&g.push({dist:k,range1:P[1],range2:[0,0]})}}}return m}function Xm(n,e,i,a,c,m=1/0){let g=Math.min(m,c.distance(n[0],i[0]));if(g===0)return g;const x=new Hm([{dist:0,range1:[0,n.length-1],range2:[0,i.length-1]}],wp),S=e?Qd:Fc,C=a?Qd:Fc;for(;x.length;){const M=x.pop();if(M.dist>=g)continue;const P=M.range1,k=M.range2;if(Tp(P)<=S&&Tp(k)<=C){if(!Lc(P,n.length)||!Lc(k,i.length))return NaN;if(e&&a?g=Math.min(g,rx(n,P,i,k,c)):e||a?e&&!a?g=Math.min(g,H_(i,k,n,P,c)):!e&&a&&(g=Math.min(g,H_(n,P,i,k,c))):g=Math.min(g,$_(n,P,i,k,c)),g===0)return g}else{const V=$m(P,e),U=$m(k,a);Zm(x,g,c,n,i,V[0],U[0]),Zm(x,g,c,n,i,V[0],U[1]),Zm(x,g,c,n,i,V[1],U[0]),Zm(x,g,c,n,i,V[1],U[1])}}return g}function md(n,e,i,a,c=1/0){let m=c;const g=el(n,[0,n.length-1]);for(const x of i)if(!(m!==1/0&&cc(g,el(x,[0,x.length-1]),a)>=m)&&(m=Math.min(m,Xm(n,e,x,!0,a,m)),m===0))return m;return m}function Ep(n,e,i,a,c=1/0){let m=c;const g=el(n,[0,n.length-1]);for(const x of i){if(m!==1/0&&cc(g,Tn(x),a)>=m)continue;const S=Sp(n,e,x,a,m);if(isNaN(S))return S;if((m=Math.min(m,S))===0)return m}return m}function Ym(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class Du{constructor(e,i){this.type=Ti,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Su(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let c=0;c<a.features.length;++c)if(Ym(a.features[c].geometry.type))return new Du(a,a.features[c].geometry)}else if(a.type==="Feature"){if(Ym(a.geometry.type))return new Du(a,a.geometry)}else if(Ym(a.type))return new Du(a,a)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),a=e.canonicalID();if(i!=null&&a!=null){if(e.geometryType()==="Point")return function(c,m,g){const x=[];for(const C of c)for(const M of C)x.push(Wm(M,m));const S=new Jd(x[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?Xm(x,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",S):g.type==="MultiLineString"?md(x,!1,g.coordinates,S):g.type==="Polygon"||g.type==="MultiPolygon"?Ep(x,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,S):null}(i,a,this.geometries);if(e.geometryType()==="LineString")return function(c,m,g){const x=[];for(const C of c){const M=[];for(const P of C)M.push(Wm(P,m));x.push(M)}const S=new Jd(x[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return md(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",x,S);if(g.type==="MultiLineString"){let C=1/0;for(let M=0;M<g.coordinates.length;M++){const P=md(g.coordinates[M],!0,x,S,C);if(isNaN(P))return P;if((C=Math.min(C,P))===0)return C}return C}if(g.type==="Polygon"||g.type==="MultiPolygon"){let C=1/0;for(let M=0;M<x.length;M++){const P=Ep(x[M],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,S,C);if(isNaN(P))return P;if((C=Math.min(C,P))===0)return C}return C}return null}(i,a,this.geometries);if(e.geometryType()==="Polygon")return function(c,m,g){const x=[];for(const C of function(M,P){const k=M.length;if(k<=1)return[M];const V=[];let U,q;for(let J=0;J<k;J++){const ee=Bb(M[J]);ee!==0&&(M[J].area=Math.abs(ee),q===void 0&&(q=ee<0),q===ee<0?(U&&V.push(U),U=[M[J]]):U.push(M[J]))}return U&&V.push(U),V}(c)){const M=[];for(let P=0;P<C.length;++P)M.push(nx(C[P],m));x.push(M)}const S=new Jd(x[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Ep(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",x,S);if(g.type==="MultiLineString"){let C=1/0;for(let M=0;M<g.coordinates.length;M++){const P=Ep(g.coordinates[M],!0,x,S,C);if(isNaN(P))return P;if((C=Math.min(C,P))===0)return C}return C}return g.type==="Polygon"||g.type==="MultiPolygon"?function(C,M,P){let k=1/0;for(const V of C)for(const U of M){const q=Ub(V,U,P,k);if(isNaN(q))return q;if((k=Math.min(k,q))===0)return k}return k}(g.type==="Polygon"?[g.coordinates]:g.coordinates,x,S):null}(i,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function tf(n){if(n instanceof ls&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof mh||n instanceof Du)return!1;if(n instanceof gh)return n.featureConstant;let e=!0;return n.eachChild(i=>{e&&!tf(i)&&(e=!1)}),e}function zc(n){if(n instanceof ls&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!zc(i)&&(e=!1)}),e}function Mu(n,e){if(n instanceof ls&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(a=>{i&&!Mu(a,e)&&(i=!1)}),i}function Ap(n,e,i){return[n,e,i].filter(Boolean).join("")}function Cp(n,e){switch(n){case"string":return Qs(e);case"number":return+e;case"boolean":return!!e;case"color":return Qi.parse(e);case"formatted":return Do.fromString(Qs(e));case"resolvedImage":return sa.build(Qs(e))}return e}function sx(n,e,i,a){return a!==void 0&&(n=a*Math.round(n/a)),e!==void 0&&n<e&&(n=e),i!==void 0&&n>i&&(n=i),n}class gh{constructor(e,i,a,c=!1){this.type=e,this.key=i,this.scope=a,this.featureConstant=c}static parse(e,i){let a=i.expectedType;if(a==null&&(a=dr),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const c=i.parse(e[1],1);if(!(c instanceof Eu))return i.error("Key name of 'config' expression must be a string literal.");let m,g=!0;const x=Qs(c.value);if(e.length>=3){const S=i.parse(e[2],2);if(!(S instanceof Eu))return i.error("Scope of 'config' expression must be a string literal.");m=Qs(S.value)}if(i.options){const S=Ap(x,m,i._scope),C=i.options.get(S);C&&(g=tf(C.value||C.default))}return new gh(a,x,m,g)}evaluate(e){const i=Ap(this.key,this.scope,e.scope),a=e.getConfig(i);if(!a)return null;const{type:c,value:m,values:g,minValue:x,maxValue:S,stepValue:C}=a,M=a.default.evaluate(e);let P=M;if(m){const k=e.scope;e.scope=(k||"").split("").slice(1).join(""),P=m.evaluate(e),e.scope=k}return c&&(P=Cp(c,P)),P===void 0||x===void 0&&S===void 0&&C===void 0||(typeof P=="number"?P=sx(P,x,S,C):Array.isArray(P)&&(P=P.map(k=>typeof k=="number"?sx(k,x,S,C):k))),m!==void 0&&P!==void 0&&g&&!g.includes(P)&&(P=M,c&&(P=Cp(c,P))),(c&&c!==this.type||P!==void 0&&!cd(_a(P),this.type))&&(P=Cp(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Km{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new Km(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Jm{constructor(e,i=[],a,c=new ws,m=[],g,x,S){this.registry=e,this.path=i,this.key=i.map(C=>typeof C=="string"?`['${C}']`:`[${C}]`).join(""),this.scope=c,this.errors=m,this.expectedType=a,this._scope=g,this.options=x,this.iconImageUseTheme=S}parse(e,i,a,c,m={}){return i||a?this.concat(i,null,a,c)._parse(e,m):this._parse(e,m)}parseObjectValue(e,i,a,c,m,g={}){return this.concat(i,a,c,m)._parse(e,g)}_parse(e,i){function a(c,m,g){return g==="assert"?new _i(m,[c]):g==="coerce"?new Ll(m,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let m=c.parse(e,this);if(!m)return null;if(this.expectedType){const g=this.expectedType,x=m.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||x.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(g,x))return null}else m=a(m,g,i.typeAnnotation||"coerce");else m=a(m,g,i.typeAnnotation||"assert")}if(!(m instanceof Eu)&&m.type.kind!=="resolvedImage"&&W_(m)){const g=new Sa(this._scope,this.options,this.iconImageUseTheme);try{m=new Eu(m.type,m.evaluate(g))}catch(x){return this.error(x.message),null}}return m}return Ll.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a,c){let m=typeof e=="number"?this.path.concat(e):this.path;m=typeof i=="string"?m.concat(i):m;const g=c?this.scope.concat(c):this.scope;return new Jm(this.registry,m,a||null,g,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const a=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new Oa(a,e))}checkSubtype(e,i){const a=ld(e,i);return a&&this.error(a),a}}function W_(n){if(n instanceof Km)return W_(n.boundExpression);if(n instanceof ls&&n.name==="error"||n instanceof Yd||n instanceof mh||n instanceof Du||n instanceof gh)return!1;const e=n instanceof Ll||n instanceof _i;let i=!0;return n.eachChild(a=>{i=e?i&&W_(a):i&&a instanceof Eu}),!!i&&tf(n)&&Mu(n,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function nf(n,e){const i=n.length-1;let a,c,m=0,g=i,x=0;for(;m<=g;)if(x=Math.floor((m+g)/2),a=n[x],c=n[x+1],a<=e){if(x===i||e<c)return x;m=x+1}else{if(!(a>e))throw new No("Input is not a number.");g=x-1}return 0}class Nc{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,m]of a)this.labels.push(c),this.outputs.push(m)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,Ti);if(!a)return null;const c=[];let m=null;i.expectedType&&i.expectedType.kind!=="value"&&(m=i.expectedType);for(let g=1;g<e.length;g+=2){const x=g===1?-1/0:e[g],S=e[g+1],C=g,M=g+1;if(typeof x!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(c.length&&c[c.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const P=i.parse(S,M,m);if(!P)return null;m=m||P.type,c.push([x,P])}return new Nc(m,a,c)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return a[0].evaluate(e);const m=i.length;return c>=i[m-1]?a[m-1].evaluate(e):a[nf(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const lx=.95047,cx=1.08883,On=4/29,uc=6/29,la=3*uc*uc,no=uc*uc*uc,_h=Math.PI/180,Ip=180/Math.PI;function Qm(n){return n>no?Math.pow(n,1/3):n/la+On}function Xr(n){return n>uc?n*n*n:la*(n-On)}function Nl(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Bc(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Bl(n){const e=Bc(n.r),i=Bc(n.g),a=Bc(n.b),c=Qm((.4124564*e+.3575761*i+.1804375*a)/lx),m=Qm((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*m-16,a:500*(c-m),b:200*(m-Qm((.0193339*e+.119192*i+.9503041*a)/cx)),alpha:n.a}}function Vc(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,a=isNaN(n.b)?e:e-n.b/200;return e=1*Xr(e),i=lx*Xr(i),a=cx*Xr(a),new Qi(Nl(3.2404542*i-1.5371385*e-.4985314*a),Nl(-.969266*i+1.8760108*e+.041556*a),Nl(.0556434*i-.2040259*e+1.0572252*a),n.alpha)}function Uc(n,e,i){const a=e-n;return n+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const hc={forward:Bl,reverse:Vc,interpolate:function(n,e,i){return{l:Si(n.l,e.l,i),a:Si(n.a,e.a,i),b:Si(n.b,e.b,i),alpha:Si(n.alpha,e.alpha,i)}}},Pu={forward:function(n){const{l:e,a:i,b:a}=Bl(n),c=Math.atan2(a,i)*Ip;return{h:c<0?c+360:c,c:Math.sqrt(i*i+a*a),l:e,alpha:n.a}},reverse:function(n){const e=n.h*_h,i=n.c;return Vc({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:Uc(n.h,e.h,i),c:Si(n.c,e.c,i),l:Si(n.l,e.l,i),alpha:Si(n.alpha,e.alpha,i)}}};var eg=Object.freeze({__proto__:null,hcl:Pu,lab:hc});class Ts{constructor(e,i,a,c,m){this.type=e,this.operator=i,this.interpolation=a,this.input=c,this.labels=[],this.outputs=[];for(const[g,x]of m)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(e,i,a,c){let m=0;if(e.name==="exponential")m=us(i,e.base,a,c);else if(e.name==="linear")m=us(i,1,a,c);else if(e.name==="cubic-bezier"){const g=e.controlPoints;m=new Ks(g[0],g[1],g[2],g[3]).solve(us(i,1,a,c))}return m}static parse(e,i){let[a,c,m,...g]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const C=c[1];if(typeof C!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:C}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const C=c.slice(1);if(C.length!==4||C.some(M=>typeof M!="number"||M<0||M>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(m=i.parse(m,2,Ti),!m)return null;const x=[];let S=null;a==="interpolate-hcl"||a==="interpolate-lab"?S=ks:i.expectedType&&i.expectedType.kind!=="value"&&(S=i.expectedType);for(let C=0;C<g.length;C+=2){const M=g[C],P=g[C+1],k=C+3,V=C+4;if(typeof M!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(x.length&&x[x.length-1][0]>=M)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const U=i.parse(P,V,S);if(!U)return null;S=S||U.type,x.push([M,U])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new Ts(S,a,c,m,x):i.error(`Type ${na(S)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return a[0].evaluate(e);const m=i.length;if(c>=i[m-1])return a[m-1].evaluate(e);const g=nf(i,c),x=Ts.interpolationFactor(this.interpolation,c,i[g],i[g+1]),S=a[g].evaluate(e),C=a[g+1].evaluate(e);return this.operator==="interpolate"?vl[this.type.kind.toLowerCase()](S,C,x):this.operator==="interpolate-hcl"?Pu.reverse(Pu.interpolate(Pu.forward(S),Pu.forward(C),x)):hc.reverse(hc.interpolate(hc.forward(S),hc.forward(C),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function us(n,e,i,a){const c=a-i,m=n-i;return c===0?0:e===1?m/c:(Math.pow(e,m)-1)/(Math.pow(e,c)-1)}class gd{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const c=i.expectedType;c&&c.kind!=="value"&&(a=c);const m=[];for(const x of e.slice(1)){const S=i.parse(x,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!S)return null;a=a||S.type,m.push(S)}const g=c&&m.some(x=>ld(c,x.type));return new gd(g?dr:a,m)}evaluate(e){let i,a=null,c=0;for(const m of this.args){if(c++,a=m.evaluate(e),a&&a instanceof sa&&!a.available&&(i||(i=a),a=null,c===this.args.length))return i;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class rf{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let m=1;m<e.length-1;m+=2){const g=e[m];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=i.parse(e[m+1],m+1);if(!x)return null;a.push([g,x])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return c?new rf(a,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}class Rp{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Ti),c=i.parse(e[2],2,Lo(i.expectedType||dr));return a&&c?new Rp(c.type.itemType,a,c):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new No("Array index out of bounds: negative index");if(i>=a.length)throw new No("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new No("Array index must be an integer. Use at-interpolated for fractional indices");return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ou{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Ti),c=i.parse(e[2],2,Lo(i.expectedType||dr));return a&&c?new Ou(c.type.itemType,a,c):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new No(`Array index out of bounds: ${i} < 0.`);if(i>a.length-1)throw new No(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i===Math.floor(i))return a[i];const c=Math.floor(i),m=Math.ceil(i),g=a[c],x=a[m];if(typeof g!="number"||typeof x!="number")throw new No(`Cannot interpolate between non-number values at index ${i}.`);const S=i-c;return g*(1-S)+x*S}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Dp{constructor(e,i){this.type=Xn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,dr),c=i.parse(e[2],2,dr);return a&&c?pp(a.type,[Xn,Pn,Ti,kc,dr])?new Dp(a,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${na(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!mp(i,["boolean","string","number","null"]))throw new No(`Expected first argument to be of type boolean, string, number or null, but found ${na(_a(i))} instead.`);if(!mp(a,["string","array"]))throw new No(`Expected second argument to be of type array or string, but found ${na(_a(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Vl{constructor(e,i,a){this.type=Ti,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,dr),c=i.parse(e[2],2,dr);if(!a||!c)return null;if(!pp(a.type,[Xn,Pn,Ti,kc,dr]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${na(a.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,Ti);return m?new Vl(a,c,m):null}return new Vl(a,c)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!mp(i,["boolean","string","number","null"]))throw new No(`Expected first argument to be of type boolean, string, number or null, but found ${na(_a(i))} instead.`);if(!mp(a,["string","array"]))throw new No(`Expected second argument to be of type array or string, but found ${na(_a(a))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return a.indexOf(i,c)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class of{constructor(e,i,a,c,m,g){this.inputType=e,this.type=i,this.input=a,this.cases=c,this.outputs=m,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const m={},g=[];for(let C=2;C<e.length-1;C+=2){let M=e[C];const P=e[C+1];Array.isArray(M)||(M=[M]);const k=i.concat(C);if(M.length===0)return k.error("Expected at least one branch label.");for(const U of M){if(typeof U!="number"&&typeof U!="string")return k.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return k.error("Numeric branch labels must be integer values.");if(a){if(k.checkSubtype(a,_a(U)))return null}else a=_a(U);if(m[String(U)]!==void 0)return k.error("Branch labels must be unique.");m[String(U)]=g.length}const V=i.parse(P,C,c);if(!V)return null;c=c||V.type,g.push(V)}const x=i.parse(e[1],1,dr);if(!x)return null;const S=i.parse(e[e.length-1],e.length-1,c);return S?x.type.kind!=="value"&&i.concat(1).checkSubtype(a,x.type)?null:new of(a,c,x,m,g,S):null}evaluate(e){const i=this.input.evaluate(e);return(cd(_a(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],c={};for(const g of i){const x=c[this.cases[g]];x===void 0?(c[this.cases[g]]=a.length,a.push([this.cases[g],[g]])):a[x][1].push(g)}const m=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,x]of a)e.push(x.length===1?m(x[0]):x.map(m)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}class yh{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const c=[];for(let g=1;g<e.length-1;g+=2){const x=i.parse(e[g],g,Xn);if(!x)return null;const S=i.parse(e[g+1],g+1,a);if(!S)return null;c.push([x,S]),a=a||S.type}const m=i.parse(e[e.length-1],e.length-1,a);return m?new yh(a,c,m):null}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class af{constructor(e,i,a,c){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,dr),c=i.parse(e[2],2,Ti);if(!a||!c)return null;if(!pp(a.type,[Lo(dr),Pn,dr]))return i.error(`Expected first argument to be of type array or string, but found ${na(a.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,Ti);return m?new af(a.type,a,c,m):null}return new af(a.type,a,c)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!mp(i,["string","array"]))throw new No(`Expected first argument to be of type array or string, but found ${na(_a(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return i.slice(a,c)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class vh{constructor(e,i){this.type=Lo(Pn),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Pn),c=i.parse(e[2],2,Pn);return a&&c?new vh(a,c):void 0}evaluate(e){const i=this.str.evaluate(e),a=this.delimiter.evaluate(e);return i.split(a)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function _d(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function jc(n,e,i,a){return a.compare(e,i)===0}function sf(n,e,i){const a=n!=="=="&&n!=="!=";return class M2{constructor(m,g,x){this.type=Xn,this.lhs=m,this.rhs=g,this.collator=x,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const x=m[0];let S=g.parse(m[1],1,dr);if(!S)return null;if(!_d(x,S.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${na(S.type)}'.`);let C=g.parse(m[2],2,dr);if(!C)return null;if(!_d(x,C.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${na(C.type)}'.`);if(S.type.kind!==C.type.kind&&S.type.kind!=="value"&&C.type.kind!=="value")return g.error(`Cannot compare types '${na(S.type)}' and '${na(C.type)}'.`);a&&(S.type.kind==="value"&&C.type.kind!=="value"?S=new _i(C.type,[S]):S.type.kind!=="value"&&C.type.kind==="value"&&(C=new _i(S.type,[C])));let M=null;if(m.length===4){if(S.type.kind!=="string"&&C.type.kind!=="string"&&S.type.kind!=="value"&&C.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(M=g.parse(m[3],3,Zd),!M)return null}return new M2(S,C,M)}evaluate(m){const g=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){const S=_a(g),C=_a(x);if(S.kind!==C.kind||S.kind!=="string"&&S.kind!=="number")throw new No(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${S.kind}, ${C.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const S=_a(g),C=_a(x);if(S.kind!=="string"||C.kind!=="string")return e(m,g,x)}return this.collator?i(m,g,x,this.collator.evaluate(m)):e(m,g,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[n];return this.eachChild(g=>{m.push(g.serialize())}),m}}}const xh=sf("==",function(n,e,i){return e===i},jc),q_=sf("!=",function(n,e,i){return e!==i},function(n,e,i,a){return!jc(0,e,i,a)}),ux=sf("<",function(n,e,i){return e<i},function(n,e,i,a){return a.compare(e,i)<0}),jb=sf(">",function(n,e,i){return e>i},function(n,e,i,a){return a.compare(e,i)>0}),Gb=sf("<=",function(n,e,i){return e<=i},function(n,e,i,a){return a.compare(e,i)<=0}),Mp=sf(">=",function(n,e,i){return e>=i},function(n,e,i,a){return a.compare(e,i)>=0});class tg{constructor(e,i,a,c,m,g){this.type=Pn,this.number=e,this.locale=i,this.currency=a,this.unit=c,this.minFractionDigits=m,this.maxFractionDigits=g}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const a=i.parse(e[1],1,Ti);if(!a)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=i.parseObjectValue(c.locale,2,"locale",Pn),!m))return null;let g=null;if(c.currency&&(g=i.parseObjectValue(c.currency,2,"currency",Pn),!g))return null;let x=null;if(c.unit&&(x=i.parseObjectValue(c.unit,2,"unit",Pn),!x))return null;let S=null;if(c["min-fraction-digits"]&&(S=i.parseObjectValue(c["min-fraction-digits"],2,"min-fraction-digits",Ti),!S))return null;let C=null;return c["max-fraction-digits"]&&(C=i.parseObjectValue(c["max-fraction-digits"],2,"max-fraction-digits",Ti),!C)?null:new tg(a,m,g,x,S,C)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ig{constructor(e){this.type=Ti,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${na(a.type)} instead.`):new ig(a):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new No(`Expected value to be of type string or array, but found ${na(_a(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function Z_(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const lf={"==":xh,"!=":q_,">":jb,"<":ux,">=":Mp,"<=":Gb,array:_i,at:Rp,"at-interpolated":Ou,boolean:_i,case:yh,coalesce:gd,collator:Yd,format:ud,image:Gi,in:Dp,"index-of":Vl,interpolate:Ts,"interpolate-hcl":Ts,"interpolate-lab":Ts,length:ig,let:rf,literal:Eu,match:of,number:_i,"number-format":tg,object:_i,slice:af,step:Nc,string:_i,"to-boolean":Ll,"to-color":Ll,"to-number":Ll,"to-string":Ll,var:Km,within:mh,distance:Du,config:gh,split:vh};function ng(n,[e,i,a,c]){e=e.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const m=c?c.evaluate(n):1,g=Xd(e,i,a,m);if(g)throw new No(g);return new Qi(e/255,i/255,a/255,m)}function X_(n,[e,i,a,c]){e=e.evaluate(n),i=i.evaluate(n),a=a.evaluate(n);const m=c?c.evaluate(n):1,g=function(C,M,P,k){return typeof C=="number"&&C>=0&&C<=360?typeof M=="number"&&M>=0&&M<=100&&typeof P=="number"&&P>=0&&P<=100?k===void 0||typeof k=="number"&&k>=0&&k<=1?null:`Invalid hsla value [${[C,M,P,k].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof k=="number"?[C,M,P,k]:[C,M,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof k=="number"?[C,M,P,k]:[C,M,P]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,a,m);if(g)throw new No(g);const x=`hsla(${e}, ${i}%, ${a}%, ${m})`,S=Qi.parse(x);if(!S)throw new No(`Failed to parse HSLA color: ${x}`);return S}function hx(n,e){return n in e}function rg(n,e){const i=e[n];return i===void 0?null:i}function ku(n){return{type:n}}function ya(n){if(n instanceof gh)return new Set([n.key]);let e=new Set;return n.eachChild(i=>{e=new Set([...e,...ya(i)])}),e}function og(n){if(n instanceof ls&&n.name==="is-active-floor")return!0;let e=!1;return n.eachChild(i=>{!e&&og(i)&&(e=!0)}),e}function Gc(n){return{result:"success",value:n}}function Hc(n){return{result:"error",value:n}}function Fu(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function ag(n){return n["property-type"]==="data-driven"}function Pp(n){return Fu(n.expression,"measure-light")}function Y_(n){return Fu(n.expression,"zoom")}function sg(n){return!!n.expression&&n.expression.interpolated}function Lu(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Qa(n){return n}function Wi(n,e){const i=e.type==="color",a=n.stops&&typeof n.stops[0][0]=="object",c=a||!(a||n.property!==void 0),m=n.type||(sg(e)?"exponential":"interval");if(i&&((n=Object.assign({},n)).stops&&(n.stops=n.stops.map(C=>[C[0],Qi.parse(C[1])])),n.default=Qi.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!eg[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let g,x,S;if(m==="exponential")g=dx;else if(m==="interval")g=bh;else if(m==="categorical"){g=dc,x=Object.create(null);for(const C of n.stops)x[C[0]]=C[1];S=typeof n.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);g=Hb}if(a){const C={},M=[];for(let V=0;V<n.stops.length;V++){const U=n.stops[V],q=U[0].zoom;C[q]===void 0&&(C[q]={zoom:q,type:n.type,property:n.property,default:n.default,stops:[]},M.push(q)),C[q].stops.push([U[0].value,U[1]])}const P=[];for(const V of M)P.push([C[V].zoom,Wi(C[V],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:Ts.interpolationFactor.bind(void 0,k),zoomStops:P.map(V=>V[0]),evaluate:({zoom:V},U)=>dx({stops:P,base:n.base},e,V).evaluate(V,U)}}if(c){const C=m==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:Ts.interpolationFactor.bind(void 0,C),zoomStops:n.stops.map(M=>M[0]),evaluate:({zoom:M})=>g(n,e,M,x,S)}}return{kind:"source",evaluate(C,M){const P=M&&M.properties?M.properties[n.property]:void 0;return P===void 0?Fs(n.default,e.default):g(n,e,P,x,S)}}}function Fs(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function dc(n,e,i,a,c){return Fs(typeof i===c?a[i]:void 0,n.default,e.default)}function bh(n,e,i){if(!gp(i))return Fs(n.default,e.default);const a=n.stops.length;if(a===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[a-1][0])return n.stops[a-1][1];const c=nf(n.stops.map(m=>m[0]),i);return n.stops[c][1]}function dx(n,e,i){const a=n.base!==void 0?n.base:1;if(!gp(i))return Fs(n.default,e.default);const c=n.stops.length;if(c===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[c-1][0])return n.stops[c-1][1];const m=nf(n.stops.map(M=>M[0]),i),g=function(M,P,k,V){const U=V-k,q=M-k;return U===0?0:P===1?q/U:(Math.pow(P,q)-1)/(Math.pow(P,U)-1)}(i,a,n.stops[m][0],n.stops[m+1][0]),x=n.stops[m][1],S=n.stops[m+1][1];let C=vl[e.type]||Qa;if(n.colorSpace&&n.colorSpace!=="rgb"){const M=eg[n.colorSpace];C=(P,k)=>M.reverse(M.interpolate(M.forward(P),M.forward(k),g))}return typeof x.evaluate=="function"?{evaluate(...M){const P=x.evaluate.apply(void 0,M),k=S.evaluate.apply(void 0,M);if(P!==void 0&&k!==void 0)return C(P,k,g)}}:C(x,S,g)}function Hb(n,e,i){return e.type==="color"?i=Qi.parse(i):e.type==="formatted"?i=Do.fromString(i.toString()):e.type==="resolvedImage"?i=sa.build(i.toString()):hd(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Fs(i,n.default,e.default)}ls.register(lf,{error:[{kind:"error"},[Pn],(n,[e])=>{throw new No(e.evaluate(n))}],typeof:[Pn,[dr],(n,[e])=>na(_a(e.evaluate(n)))],"to-rgba":[Lo(Ti,4),[ks],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Lo(Ti,4),[ks],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[ks,[Ti,Ti,Ti],ng],rgba:[ks,[Ti,Ti,Ti,Ti],ng],hsl:[ks,[Ti,Ti,Ti],X_],hsla:[ks,[Ti,Ti,Ti,Ti],X_],has:{type:Xn,overloads:[[[Pn],(n,[e])=>hx(e.evaluate(n),n.properties())],[[Pn,hh],(n,[e,i])=>hx(e.evaluate(n),i.evaluate(n))]]},get:{type:dr,overloads:[[[Pn],(n,[e])=>rg(e.evaluate(n),n.properties())],[[Pn,hh],(n,[e,i])=>rg(e.evaluate(n),i.evaluate(n))]]},"feature-state":[dr,[Pn],(n,[e])=>rg(e.evaluate(n),n.featureState||{})],properties:[hh,[],n=>n.properties()],"geometry-type":[Pn,[],n=>n.geometryType()],worldview:[Pn,[],n=>n.globals.worldview||""],"is-active-floor":[Xn,ku(Pn),(n,e)=>{if(!(n.globals.activeFloors&&n.globals.activeFloors.size>0))return!1;const i=n.globals.activeFloors;return e.some(a=>{const c=a.evaluate(n);return i.has(c)})}],id:[dr,[],n=>n.id()],zoom:[Ti,[],n=>n.globals.zoom],pitch:[Ti,[],n=>n.globals.pitch||0],"distance-from-center":[Ti,[],n=>n.distanceFromCenter()],"measure-light":[Ti,[Pn],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[Ti,[],n=>n.globals.heatmapDensity||0],"line-progress":[Ti,[],n=>n.globals.lineProgress||0],"raster-value":[Ti,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[Ti,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ti,[],n=>n.globals.skyRadialProgress||0],accumulated:[dr,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Ti,ku(Ti),(n,e)=>{let i=0;for(const a of e)i+=a.evaluate(n);return i}],"*":[Ti,ku(Ti),(n,e)=>{let i=1;for(const a of e)i*=a.evaluate(n);return i}],"-":{type:Ti,overloads:[[[Ti,Ti],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Ti],(n,[e])=>-e.evaluate(n)]]},"/":[Ti,[Ti,Ti],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Ti,[Ti,Ti],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Ti,[],()=>Math.LN2],pi:[Ti,[],()=>Math.PI],e:[Ti,[],()=>Math.E],"^":[Ti,[Ti,Ti],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Ti,[Ti],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Ti,[Ti],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Ti,[Ti],(n,[e])=>Math.log(e.evaluate(n))],log2:[Ti,[Ti],(n,[e])=>Math.log2(e.evaluate(n))],sin:[Ti,[Ti],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Ti,[Ti],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Ti,[Ti],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Ti,[Ti],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Ti,[Ti],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Ti,[Ti],(n,[e])=>Math.atan(e.evaluate(n))],min:[Ti,ku(Ti),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[Ti,ku(Ti),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[Ti,[Ti],(n,[e])=>Math.abs(e.evaluate(n))],round:[Ti,[Ti],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ti,[Ti],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Ti,[Ti],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[Xn,[Pn,dr],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[Xn,[dr],(n,[e])=>n.id()===e.value],"filter-type-==":[Xn,[Pn],(n,[e])=>n.geometryType()===e.value],"filter-<":[Xn,[Pn,dr],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a<c}],"filter-id-<":[Xn,[dr],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[Xn,[Pn,dr],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a>c}],"filter-id->":[Xn,[dr],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[Xn,[Pn,dr],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a<=c}],"filter-id-<=":[Xn,[dr],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[Xn,[Pn,dr],(n,[e,i])=>{const a=n.properties()[e.value],c=i.value;return typeof a==typeof c&&a>=c}],"filter-id->=":[Xn,[dr],(n,[e])=>{const i=n.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[Xn,[dr],(n,[e])=>e.value in n.properties()],"filter-has-id":[Xn,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[Xn,[Lo(Pn)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[Xn,[Lo(dr)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[Xn,[Pn,Lo(dr)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[Xn,[Pn,Lo(dr)],(n,[e,i])=>function(a,c,m,g){for(;m<=g;){const x=m+g>>1;if(c[x]===a)return!0;c[x]>a?g=x-1:m=x+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Xn,overloads:[[[Xn,Xn],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[ku(Xn),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:Xn,overloads:[[[Xn,Xn],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[ku(Xn),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[Xn,[Xn],(n,[e])=>!e.evaluate(n)],"is-supported-script":[Xn,[Pn],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Pn,[Pn],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Pn,[Pn],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Pn,ku(dr),(n,e)=>e.map(i=>Qs(i.evaluate(n))).join("")],"resolved-locale":[Pn,[Zd],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[Ti,[Ti,Ti,dr],(n,e)=>{const[i,a,c]=e.map(g=>g.evaluate(n));if(i>a||i===a)return i;let m;if(typeof c=="string")m=function(g){let x=0;if(g.length===0)return x;for(let S=0;S<g.length;S++)x=(x<<5)-x+g.charCodeAt(S),x|=0;return x}(c);else{if(typeof c!="number")throw new No(`Invalid seed input: ${c}`);m=c}return i+Z_(m)()*(a-i)}]});class lg{constructor(e,i,a,c,m){this.expression=e,this._warningHistory={},this._scope=a,this._options=c,this._iconImageUseTheme=m,this._evaluator=new Sa(a,c,m),this._defaultValue=i?function(g){return g.type==="color"&&(Lu(g.default)||Array.isArray(g.default))?new Qi(0,0,0,0):g.type==="color"?Qi.parse(g.default)||null:g.default===void 0?null:g.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=ya(e),this.isIndoorDependent=og(e)}evaluateWithoutErrorHandling(e,i,a,c,m,g,x,S){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=c||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,c,m,g,x,S,C){this._evaluator||(this._evaluator=new Sa(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=S||null,this._evaluator.iconImageUseTheme=C||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new No(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${M.message}`)),this._defaultValue}}}function cg(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in lf}function Ho(n,e,i,a,c){const m=new Jm(lf,[],e?function(x){const S={color:ks,string:Pn,number:Ti,enum:Pn,boolean:Xn,formatted:dh,resolvedImage:fp};return x.type==="array"?Lo(S[x.value]||dr,x.length):S[x.type]}(e):void 0,void 0,void 0,i,a,c),g=m.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?Gc(new lg(g,e,i,a,c)):Hc(m.errors)}class Op{constructor(e,i,a,c){this.kind=e,this._styleExpression=i,this.isLightConstant=a,this.isLineProgressConstant=c,this.isStateDependent=e!=="constant"&&!zc(i.expression),this.configDependencies=ya(i.expression),this.isIndoorDependent=og(i.expression)}evaluateWithoutErrorHandling(e,i,a,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,c,m,g)}evaluate(e,i,a,c,m,g,x){return this._styleExpression.evaluate(e,i,a,c,m,g,void 0,void 0,x)}}class wh{constructor(e,i,a,c,m,g){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!zc(i.expression),this.isIndoorDependent=og(i.expression),this.isLightConstant=m,this.isLineProgressConstant=g,this.configDependencies=ya(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,i,a,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,c,m,g)}evaluate(e,i,a,c,m,g){return this._styleExpression.evaluate(e,i,a,c,m,g)}interpolationFactor(e,i,a){return this.interpolationType?Ts.interpolationFactor(this.interpolationType,e,i,a):0}}function K_(n,e,i,a,c){if((n=Ho(n,e,i,a,c)).result==="error")return n;const m=n.value.expression,g=tf(m);if(!g&&!ag(e))return Hc([new Oa("","data expressions not supported")]);const x=Mu(m,["zoom","pitch","distance-from-center"]);if(!x&&!Y_(e))return Hc([new Oa("","zoom expressions not supported")]);const S=Mu(m,["measure-light"]);if(!S&&!Pp(e))return Hc([new Oa("","measure-light expression not supported")]);const C=Mu(m,["line-progress"]);if(!C&&!function(k){return Fu(k.expression,"line-progress")}(e))return Hc([new Oa("","line-progress expression not supported")]);const M=e.expression&&e.expression.relaxZoomRestriction,P=Th(m);return P||x||M?P instanceof Oa?Hc([P]):P instanceof Ts&&!sg(e)?Hc([new Oa("",'"interpolate" expressions cannot be used with this property')]):Gc(P?new wh(g&&C?"camera":"composite",n.value,P.labels,P instanceof Ts?P.interpolation:void 0,S,C):new Op(g&&C?"constant":"source",n.value,S,C)):Hc([new Oa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class kp{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,Wi(this._parameters,this._specification))}static deserialize(e){return new kp(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Th(n){let e=null;if(n instanceof rf)e=Th(n.result);else if(n instanceof gd){for(const i of n.args)if(e=Th(i),e)break}else(n instanceof Nc||n instanceof Ts)&&n.input instanceof ls&&n.input.name==="zoom"&&(e=n);return e instanceof Oa||n.eachChild(i=>{const a=Th(i);a instanceof Oa?e=a:e&&a&&e!==a&&(e=new Oa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var $c,ug,fx=function(){if(ug)return $c;ug=1,$c=e;var n=3;function e(i,a,c){var m=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var g=new Int32Array(this.arrayBuffer);i=g[0],this.d=(a=g[1])+2*(c=g[2]);for(var x=0;x<this.d*this.d;x++){var S=g[n+x],C=g[n+x+1];m.push(S===C?null:g.subarray(S,C))}var M=g[n+m.length+1];this.keys=g.subarray(g[n+m.length],M),this.bboxes=g.subarray(M),this.insert=this._insertReadonly}else{this.d=a+2*c;for(var P=0;P<this.d*this.d;P++)m.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=i,this.padding=c,this.scale=a/i,this.uid=0;var k=c/a*i;this.min=-k,this.max=i+k}return e.prototype.insert=function(i,a,c,m,g){this._forEachCell(a,c,m,g,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(g)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,a,c,m,g,x){this.cells[g].push(x)},e.prototype.query=function(i,a,c,m,g){var x=this.min,S=this.max;if(i<=x&&a<=x&&S<=c&&S<=m&&!g)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(i,a,c,m,this._queryCell,C,{},g),C},e.prototype._queryCell=function(i,a,c,m,g,x,S,C){var M=this.cells[g];if(M!==null)for(var P=this.keys,k=this.bboxes,V=0;V<M.length;V++){var U=M[V];if(S[U]===void 0){var q=4*U;(C?C(k[q+0],k[q+1],k[q+2],k[q+3]):i<=k[q+2]&&a<=k[q+3]&&c>=k[q+0]&&m>=k[q+1])?(S[U]=!0,x.push(P[U])):S[U]=!1}}},e.prototype._forEachCell=function(i,a,c,m,g,x,S,C){for(var M=this._convertToCellCoord(i),P=this._convertToCellCoord(a),k=this._convertToCellCoord(c),V=this._convertToCellCoord(m),U=M;U<=k;U++)for(var q=P;q<=V;q++){var J=this.d*q+U;if((!C||C(this._convertFromCellCoord(U),this._convertFromCellCoord(q),this._convertFromCellCoord(U+1),this._convertFromCellCoord(q+1)))&&g.call(this,i,a,c,m,J,x,S,C))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,a=n+this.cells.length+1+1,c=0,m=0;m<this.cells.length;m++)c+=this.cells[m].length;var g=new Int32Array(a+c+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var x=a,S=0;S<i.length;S++){var C=i[S];g[n+S]=x,g.set(C,x),x+=C.length}return g[n+i.length]=x,g.set(this.keys,x),g[n+i.length+1]=x+=this.keys.length,g.set(this.bboxes,x),x+=this.bboxes.length,g.buffer},$c}(),yd=ml(fx);const cf={};function li(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),cf[e]={klass:n,omit:i.omit||[]}}li(Object,"Object"),yd.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.add(i),{buffer:i}},yd.deserialize=function(n){return new yd(n.buffer)},Object.defineProperty(yd,"name",{value:"Grid"}),li(yd,"Grid"),delete Tt.prototype.constructor,typeof DOMMatrix<"u"&&li(DOMMatrix,"DOMMatrix"),li(Qi,"Color"),li(Error,"Error"),li(Do,"Formatted"),li(Ja,"FormattedSection"),li(rc,"AJAXError"),li(sa,"ResolvedImage"),li(kp,"StylePropertyFunction"),li(lg,"StyleExpression",{omit:["_evaluator"]}),li(ki,"ImageId"),li(zo,"ImageVariant"),li(wh,"ZoomDependentExpression"),li(Op,"ZoomConstantExpression"),li(ls,"CompoundExpression",{omit:["_evaluate"]});for(const n in lf)cf[lf[n]._classRegistryKey]||li(lf[n],`Expression${n}`);function J_(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Wc(n){return self.ImageBitmap&&n instanceof ImageBitmap}function zu(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(J_(n)||Wc(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const a of n)i.push(zu(a,e));return i}if(n instanceof Map){const i={$name:"Map",entries:[]};for(const[a,c]of n.entries())i.entries.push(zu(a),zu(c,e));return i}if(n instanceof Set){const i={$name:"Set"};let a=0;for(const c of n.values())i[++a]=zu(c);return i}if(n instanceof DOMMatrix){const i={$name:"DOMMatrix"},a=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const c of a)i[c]=n[c];return i}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const i=n.constructor,a=i._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const c=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const m in n)n.hasOwnProperty(m)&&(cf[a].omit.indexOf(m)>=0||(c[m]=zu(n[m],e)));n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(c.$name=a),c}throw new Error("can't serialize object of type "+typeof n)}function Sh(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||J_(n)||Wc(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(Sh);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const c=n.entries||[],m=new Map;for(let g=0;g<c.length;g+=2)m.set(Sh(c[g]),Sh(c[g+1]));return m}if(e==="Set"){const c=new Set;for(const m of Object.keys(n))m!=="$name"&&c.add(Sh(n[m]));return c}if(e==="DOMMatrix"){let c;return c=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(c)}if(e==="BigInt")return BigInt(n.value);const{klass:i}=cf[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(n);const a=Object.create(i.prototype);for(const c of Object.keys(n))c!=="$name"&&(a[c]=Sh(n[c]));return a}throw new Error("can't deserialize object of type "+typeof n)}const Pi={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function Q_(n){for(const e of n)if(dg(e.charCodeAt(0)))return!0;return!1}function px(n){for(const e of n)if(!hg(e.charCodeAt(0)))return!1;return!0}function hg(n){return!(Pi.Arabic(n)||Pi["Arabic Supplement"](n)||Pi["Arabic Extended-A"](n)||Pi["Arabic Presentation Forms-A"](n)||Pi["Arabic Presentation Forms-B"](n))}function dg(n){return!(n!==746&&n!==747&&(n<4352||!(Pi["Bopomofo Extended"](n)||Pi.Bopomofo(n)||Pi["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Pi["CJK Compatibility Ideographs"](n)||Pi["CJK Compatibility"](n)||Pi["CJK Radicals Supplement"](n)||Pi["CJK Strokes"](n)||!(!Pi["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Pi["CJK Unified Ideographs Extension A"](n)||Pi["CJK Unified Ideographs"](n)||Pi["Enclosed CJK Letters and Months"](n)||Pi["Hangul Compatibility Jamo"](n)||Pi["Hangul Jamo Extended-A"](n)||Pi["Hangul Jamo Extended-B"](n)||Pi["Hangul Jamo"](n)||Pi["Hangul Syllables"](n)||Pi.Hiragana(n)||Pi["Ideographic Description Characters"](n)||Pi.Kanbun(n)||Pi["Kangxi Radicals"](n)||Pi["Katakana Phonetic Extensions"](n)||Pi.Katakana(n)&&n!==12540||!(!Pi["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Pi["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Pi["Unified Canadian Aboriginal Syllabics"](n)||Pi["Unified Canadian Aboriginal Syllabics Extended"](n)||Pi["Vertical Forms"](n)||Pi["Yijing Hexagram Symbols"](n)||Pi["Yi Syllables"](n)||Pi["Yi Radicals"](n))))}function fg(n){return!(dg(n)||function(e){return!!(Pi["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Pi["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Pi["Letterlike Symbols"](e)||Pi["Number Forms"](e)||Pi["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Pi["Control Pictures"](e)&&e!==9251||Pi["Optical Character Recognition"](e)||Pi["Enclosed Alphanumerics"](e)||Pi["Geometric Shapes"](e)||Pi["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Pi["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Pi["CJK Symbols and Punctuation"](e)||Pi.Katakana(e)||Pi["Private Use Area"](e)||Pi["CJK Compatibility Forms"](e)||Pi["Small Form Variants"](e)||Pi["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function ey(n){return Pi.Arabic(n)||Pi["Arabic Supplement"](n)||Pi["Arabic Extended-A"](n)||Pi["Arabic Presentation Forms-A"](n)||Pi["Arabic Presentation Forms-B"](n)}function ty(n){return n>=1424&&n<=2303||Pi["Arabic Presentation Forms-A"](n)||Pi["Arabic Presentation Forms-B"](n)}function $b(n,e){return!(!e&&ty(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Pi.Khmer(n))}function Wb(n){for(const e of n)if(ty(e.charCodeAt(0)))return!0;return!1}const Ss={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Cn=null,Nn=Ss.unavailable,Hr=null;const ca=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(Nn=Ss.error),Cn&&Cn(n)};function Ul(){pg.fire(new Je("pluginStateChange",{pluginStatus:Nn,pluginURL:Hr}))}const pg=new vn,iy=function(){return Nn},ny=function(){if(Nn!==Ss.deferred||!Hr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Nn=Ss.loading,Ul(),Hr&&oc({url:Hr},n=>{n?ca(n):(Nn=Ss.loaded,Ul())})},tl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Nn===Ss.loaded||tl.applyArabicShaping!=null,isLoading:()=>Nn===Ss.loading,setState(n){Nn=n.pluginStatus,Hr=n.pluginURL},isParsing:()=>Nn===Ss.parsing,isParsed:()=>Nn===Ss.parsed,getPluginURL:()=>Hr};class Ar{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview,this.activeFloors=i.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,a){for(const c of i)if(!$b(c.charCodeAt(0),a))return!1;return!0}(e,tl.isLoaded())}}class yi{constructor(e,i,a,c,m){this.property=e,this.value=i,this.expression=function(g,x,S,C,M){if(Lu(g))return new kp(g,x);if(cg(g)||Array.isArray(g)&&g.length>0){const P=K_(g,x,S,C,M);if(P.result==="error")throw new Error(P.value.map(k=>`${k.key}: ${k.message}`).join(", "));return P.value}{let P=g;return typeof g=="string"&&x.type==="color"&&(P=Qi.parse(g)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>P}}}(i===void 0?e.specification.default:i,e.specification,a,c,m)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a,c){return this.property.possiblyEvaluate(this,e,i,a,c)}}class ua{constructor(e,i,a,c){this.property=e,this.value=new yi(e,void 0,i,a,c)}transitioned(e,i){return new vd(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new vd(this.property,this.value,null,{},0)}}class Yn{constructor(e,i,a,c){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=a,this._iconImageUseTheme=c,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return ti(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ua(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new yi(this._values[e].property,i===null?void 0:ti(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,i){i&&(this._options=i);const a=this._properties.properties;if(e)for(const c in e){const m=e[c];if(c.endsWith("-transition")){const g=c.slice(0,-11);a[g]&&this.setTransition(g,m)}else a.hasOwnProperty(c)&&this.setValue(c,m)}}getTransition(e){return ti(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ua(this._values[e].property)),this._values[e].transition=ti(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a);const c=this.getTransition(i);c!==void 0&&(e[`${i}-transition`]=c)}return e}transitioned(e,i){const a=new hs(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].transitioned(e,i._values[c]);return a}untransitioned(){const e=new hs(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class vd{constructor(e,i,a,c,m){const g=c.delay||0,x=c.duration||0;m=m||0,this.property=e,this.value=i,this.begin=m+g,this.end=this.begin+x,e.specification.transition&&(c.delay||c.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const c=e.now||0,m=this.value.possiblyEvaluate(e,i,a),g=this.prior;if(g){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return g.possiblyEvaluate(e,i,a);{const x=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,a),m,bi(x))}}return m}}class hs{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const c=new fc(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,i,a);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Nu{constructor(e,i,a,c){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=a,this._iconImageUseTheme=c,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return ti(this._values[e].value)}setValue(e,i){this._values[e]=new yi(this._values[e].property,i===null?void 0:ti(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a,c){const m=new fc(this._properties);for(const g of Object.keys(this._values))m._values[g]=this._values[g].possiblyEvaluate(e,i,a,c);return m}isIndoorDependent(){return this._isIndoorDependent}}class Ea{constructor(e,i,a,c){this.property=e,this.value=i,this.parameters=a,this.iconImageUseTheme=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,c){return this.property.evaluate(this.value,this.parameters,e,i,a,c,this.iconImageUseTheme)}}class fc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Pt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){const c=vl[this.specification.type];return c?c(e,i,a):e}}class Xt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,c,m){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Ea(this,{kind:"constant",value:e.expression.evaluate(i,null,{},a,c,void 0,m)},i):new Ea(this,e.expression,i,m)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ea(this,{kind:"constant",value:void 0},e.parameters);const c=vl[this.specification.type];return c?new Ea(this,{kind:"constant",value:c(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,c,m,g,x){return e.kind==="constant"?e.value:e.evaluate(i,a,c,m,g,void 0,x)}}class Eh{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,c){return!!e.expression.evaluate(i,null,{},a,c)}interpolate(){return!1}}class ro{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Ar(0,{});for(const a in e){const c=e[a];c.specification.overridable&&this.overridableProperties.push(a);const m=this.defaultPropertyValues[a]=new yi(c,void 0),g=this.defaultTransitionablePropertyValues[a]=new ua(c);this.defaultTransitioningPropertyValues[a]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=m.possiblyEvaluate(i)}}}li(Xt,"DataDrivenProperty"),li(Pt,"DataConstantProperty"),li(Eh,"ColorRampProperty");var qe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Fp(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Ah(n){if(Array.isArray(n))return n.map(Ah);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Ah(n[i]);return e}return Fp(n)}function Ch(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Ch(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function uf(n,e="",i=null,a="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ch(n)||(n=Ls(n));const c=n;let m=!0;try{m=function(M){if(!Rh(M))return M;let P=Ah(M);return Ih(P),P=hf(P),P}(c)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(c,null,2)}
        `)}let g=null,x=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){x=qe[`filter_${a}`];const M=Ho(m,x,e,i);if(M.result==="error")throw new Error(M.value.map(P=>`${P.key}: ${P.message}`).join(", "));g=(P,k,V)=>M.value.evaluate(P,k,{},V)}let S=null,C=null;if(m!==c){const M=Ho(c,x,e,i);if(M.result==="error")throw new Error(M.value.map(P=>`${P.key}: ${P.message}`).join(", "));S=(P,k,V,U,q)=>M.value.evaluate(P,k,{},V,void 0,void 0,U,q),C=!tf(M.value.expression)}return{filter:g,dynamicFilter:S||void 0,needGeometry:gg(m),needFeature:!!C}}function hf(n){if(!Array.isArray(n))return n;const e=function(i){if(ry.has(i[0])){for(let a=1;a<i.length;a++)if(Rh(i[a]))return!0}return i}(n);return e===!0?e:e.map(i=>hf(i))}function Ih(n){let e=!1;const i=[];if(n[0]==="case"){for(let a=1;a<n.length-1;a+=2)e=e||Rh(n[a]),i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||Rh(n[1]);for(let a=2;a<n.length-1;a+=2)i.push(n[a+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||Rh(n[1]);for(let a=1;a<n.length-1;a+=2)i.push(n[a+1])}e&&(n.length=0,n.push("any",...i));for(let a=1;a<n.length;a++)Ih(n[a])}function Rh(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(Rh(n[i]))return!0;return!1}const ry=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function mg(n,e){return n<e?-1:n>e?1:0}function gg(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(gg(n[e]))return!0;return!1}function Ls(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Lp(n[1],n[2],"=="):e==="!="?ff(Lp(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Lp(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(Ls))):e==="all"?["all"].concat(n.slice(1).map(Ls)):e==="none"?["all"].concat(n.slice(1).map(Ls).map(ff)):e==="in"?df(n[1],n.slice(2)):e==="!in"?ff(df(n[1],n.slice(2))):e==="has"?xd(n[1]):e!=="!has"||ff(xd(n[1]));var i}function Lp(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function df(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(mg)]]:["filter-in-small",n,["literal",e]]}}function xd(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function ff(n){return["!",n]}const bd="";function Bu(n,e){return e?`${n}${bd}${e}`:n}let _g;const oy=()=>_g||(_g=new ro({"icon-size":new Xt(qe.layout_symbol["icon-size"]),"icon-image":new Xt(qe.layout_symbol["icon-image"]),"icon-rotate":new Xt(qe.layout_symbol["icon-rotate"]),"icon-offset":new Xt(qe.layout_symbol["icon-offset"])}));class zp{constructor(e,i,a,c,m,g){this.cachedIconPrimary=null;const x=Ho(e,qe.appearance.condition);if(x.result==="success"&&(this.condition=x.value),this.name=i,a){this.properties=new fc(oy()),this.unevaluatedLayout=new Nu(oy(),c,m,g);for(const S in a)this.unevaluatedLayout.setValue(S,a[S])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(e){this.cachedIconPrimary=e}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(e,i,a){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,i,a))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}}const ay="-transition",Np=new Set(["fill","line","background","hillshade","raster"]);class ha extends vn{constructor(e,i,a,c,m,g){if(super(),this.id=e.id,this.fqid=Bu(this.id,a),this.type=e.type,this.scope=a,this.lut=c,this.options=m,this.iconImageUseTheme=g,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const x=Ho(this.filter,qe[`filter_${e.type}`]);x.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...x.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||x.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),i.layout&&(this._unevaluatedLayout=new Nu(i.layout,this.scope,m,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),i.paint){this._transitionablePaint=new Yn(i.paint,this.scope,m);for(const x in e.paint)this.setPaintProperty(x,e.paint[x]);for(const x in e.layout)this.setLayoutProperty(x,e.layout[x]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fc(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Np.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...a.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||a.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(i=>{this.appearances.push(new zp(i.condition,i.name,i.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(ay)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,i){const a=this._transitionablePaint,c=a._properties.properties;if(e.endsWith(ay)){const P=e.slice(0,-11);return c[P]&&a.setTransition(P,i||void 0),!1}if(!c[e])return!1;const m=a._values[e],g=m.value.isDataDriven(),x=m.value;a.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...a.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||a.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const S=a._values[e].value,C=S.isDataDriven(),M=e.endsWith("pattern")||e==="line-dasharray";return C||g||M||this._handleOverridablePaintPropertyUpdate(e,x,S)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,a){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(i=>i.serialize())),ht(e,(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ea&&ag(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}for(const e of this.appearances)if(!zc(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=uf(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,i,a){return{}}queryRadius(e){}queryIntersectsFeature(e,i,a,c,m,g,x,S,C){}}const wl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Bp{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class xn{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function gn(n,e=1){let i=0,a=0;return{members:n.map(c=>{const m=wl[c.type].BYTES_PER_ELEMENT,g=i=pf(i,Math.max(e,m)),x=c.components||1;return a=Math.max(a,m),i+=m*x,{name:c.name,type:c.type,components:x,offset:g}}),size:pf(i,Math.max(a,e)),alignment:e}}function pf(n,e){return Math.ceil(n/e)*e}class Wa extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=a,e}}Wa.prototype.bytesPerElement=4,li(Wa,"StructArrayLayout2i4");class qc extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const m=3*e;return this.int16[m+0]=i,this.int16[m+1]=a,this.int16[m+2]=c,e}}qc.prototype.bytesPerElement=6,li(qc,"StructArrayLayout3i6");class mf extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,c)}emplace(e,i,a,c,m){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=a,this.int16[g+2]=c,this.int16[g+3]=m,e}}mf.prototype.bytesPerElement=8,li(mf,"StructArrayLayout4i8");class Vu extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Vu.prototype.bytesPerElement=4,li(Vu,"StructArrayLayout1f4");class sy extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const m=4*e,g=2*e;return this.int16[m+0]=i,this.int16[m+1]=a,this.float32[g+1]=c,e}}sy.prototype.bytesPerElement=8,li(sy,"StructArrayLayout2i1f8");class ly extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=a,this.int16[m+2]=c,e}}ly.prototype.bytesPerElement=8,li(ly,"StructArrayLayout3i8");class gf extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,c,m)}emplace(e,i,a,c,m,g){const x=5*e;return this.int16[x+0]=i,this.int16[x+1]=a,this.int16[x+2]=c,this.int16[x+3]=m,this.int16[x+4]=g,e}}gf.prototype.bytesPerElement=10,li(gf,"StructArrayLayout5i10");class yg extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m,g,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,a,c,m,g,x)}emplace(e,i,a,c,m,g,x,S){const C=6*e,M=12*e,P=3*e;return this.int16[C+0]=i,this.int16[C+1]=a,this.uint8[M+4]=c,this.uint8[M+5]=m,this.uint8[M+6]=g,this.uint8[M+7]=x,this.float32[P+2]=S,e}}yg.prototype.bytesPerElement=12,li(yg,"StructArrayLayout2i4ub1f12");class zs extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const m=3*e;return this.float32[m+0]=i,this.float32[m+1]=a,this.float32[m+2]=c,e}}zs.prototype.bytesPerElement=12,li(zs,"StructArrayLayout3f12");class Uu extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,c,m)}emplace(e,i,a,c,m,g){const x=6*e,S=3*e;return this.uint16[x+0]=i,this.uint16[x+1]=a,this.uint16[x+2]=c,this.uint16[x+3]=m,this.float32[S+2]=g,e}}Uu.prototype.bytesPerElement=12,li(Uu,"StructArrayLayout4ui1f12");class wd extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,c)}emplace(e,i,a,c,m){const g=4*e;return this.uint16[g+0]=i,this.uint16[g+1]=a,this.uint16[g+2]=c,this.uint16[g+3]=m,e}}wd.prototype.bytesPerElement=8,li(wd,"StructArrayLayout4ui8");class vg extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,c,m,g)}emplace(e,i,a,c,m,g,x){const S=6*e;return this.int16[S+0]=i,this.int16[S+1]=a,this.int16[S+2]=c,this.int16[S+3]=m,this.int16[S+4]=g,this.int16[S+5]=x,e}}vg.prototype.bytesPerElement=12,li(vg,"StructArrayLayout6i12");class Td extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m,g,x,S,C,M,P,k){const V=this.length;return this.resize(V+1),this.emplace(V,e,i,a,c,m,g,x,S,C,M,P,k)}emplace(e,i,a,c,m,g,x,S,C,M,P,k,V){const U=12*e;return this.int16[U+0]=i,this.int16[U+1]=a,this.int16[U+2]=c,this.int16[U+3]=m,this.uint16[U+4]=g,this.uint16[U+5]=x,this.uint16[U+6]=S,this.uint16[U+7]=C,this.int16[U+8]=M,this.int16[U+9]=P,this.int16[U+10]=k,this.int16[U+11]=V,e}}Td.prototype.bytesPerElement=24,li(Td,"StructArrayLayout4i4ui4i24");class _f extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,c,m,g)}emplace(e,i,a,c,m,g,x){const S=10*e,C=5*e;return this.int16[S+0]=i,this.int16[S+1]=a,this.int16[S+2]=c,this.float32[C+2]=m,this.float32[C+3]=g,this.float32[C+4]=x,e}}_f.prototype.bytesPerElement=20,li(_f,"StructArrayLayout3i3f20");class ju extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,c)}emplace(e,i,a,c,m){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=a,this.float32[g+2]=c,this.float32[g+3]=m,e}}ju.prototype.bytesPerElement=16,li(ju,"StructArrayLayout4f16");class xg extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}xg.prototype.bytesPerElement=4,li(xg,"StructArrayLayout1ul4");class jl extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=a,e}}jl.prototype.bytesPerElement=4,li(jl,"StructArrayLayout2ui4");class Gu extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m,g,x,S,C,M,P,k,V){const U=this.length;return this.resize(U+1),this.emplace(U,e,i,a,c,m,g,x,S,C,M,P,k,V)}emplace(e,i,a,c,m,g,x,S,C,M,P,k,V,U){const q=20*e,J=10*e;return this.int16[q+0]=i,this.int16[q+1]=a,this.int16[q+2]=c,this.int16[q+3]=m,this.int16[q+4]=g,this.float32[J+3]=x,this.float32[J+4]=S,this.float32[J+5]=C,this.float32[J+6]=M,this.int16[q+14]=P,this.uint32[J+8]=k,this.uint16[q+18]=V,this.uint16[q+19]=U,e}}Gu.prototype.bytesPerElement=40,li(Gu,"StructArrayLayout5i4f1i1ul2ui40");class Dh extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m,g,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,a,c,m,g,x)}emplace(e,i,a,c,m,g,x,S){const C=8*e;return this.int16[C+0]=i,this.int16[C+1]=a,this.int16[C+2]=c,this.int16[C+4]=m,this.int16[C+5]=g,this.int16[C+6]=x,this.int16[C+7]=S,e}}Dh.prototype.bytesPerElement=16,li(Dh,"StructArrayLayout3i2i2i16");class Gl extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,c,m)}emplace(e,i,a,c,m,g){const x=4*e,S=8*e;return this.float32[x+0]=i,this.float32[x+1]=a,this.float32[x+2]=c,this.int16[S+6]=m,this.int16[S+7]=g,e}}Gl.prototype.bytesPerElement=16,li(Gl,"StructArrayLayout2f1f2i16");class Mh extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,c,m,g)}emplace(e,i,a,c,m,g,x){const S=20*e,C=5*e;return this.uint8[S+0]=i,this.uint8[S+1]=a,this.float32[C+1]=c,this.float32[C+2]=m,this.float32[C+3]=g,this.float32[C+4]=x,e}}Mh.prototype.bytesPerElement=20,li(Mh,"StructArrayLayout2ub4f20");class lr extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,a)}emplace(e,i,a,c){const m=3*e;return this.uint16[m+0]=i,this.uint16[m+1]=a,this.uint16[m+2]=c,e}}lr.prototype.bytesPerElement=6,li(lr,"StructArrayLayout3ui6");class pc extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m,g,x,S,C,M,P,k,V,U,q,J,ee,oe,le,fe,Ie){const Se=this.length;return this.resize(Se+1),this.emplace(Se,e,i,a,c,m,g,x,S,C,M,P,k,V,U,q,J,ee,oe,le,fe,Ie)}emplace(e,i,a,c,m,g,x,S,C,M,P,k,V,U,q,J,ee,oe,le,fe,Ie,Se){const Pe=30*e,ke=15*e,Be=60*e;return this.int16[Pe+0]=i,this.int16[Pe+1]=a,this.int16[Pe+2]=c,this.float32[ke+2]=m,this.float32[ke+3]=g,this.uint16[Pe+8]=x,this.uint16[Pe+9]=S,this.uint32[ke+5]=C,this.uint32[ke+6]=M,this.uint32[ke+7]=P,this.uint16[Pe+16]=k,this.uint16[Pe+17]=V,this.uint16[Pe+18]=U,this.float32[ke+10]=q,this.float32[ke+11]=J,this.uint8[Be+48]=ee,this.uint8[Be+49]=oe,this.uint8[Be+50]=le,this.uint32[ke+13]=fe,this.int16[Pe+28]=Ie,this.uint8[Be+58]=Se,e}}pc.prototype.bytesPerElement=60,li(pc,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class _r extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m,g,x,S,C,M,P,k,V,U,q,J,ee,oe,le,fe,Ie,Se,Pe,ke,Be,ot,Ze,st,dt,wt,Rt,Mt,yt){const Dt=this.length;return this.resize(Dt+1),this.emplace(Dt,e,i,a,c,m,g,x,S,C,M,P,k,V,U,q,J,ee,oe,le,fe,Ie,Se,Pe,ke,Be,ot,Ze,st,dt,wt,Rt,Mt,yt)}emplace(e,i,a,c,m,g,x,S,C,M,P,k,V,U,q,J,ee,oe,le,fe,Ie,Se,Pe,ke,Be,ot,Ze,st,dt,wt,Rt,Mt,yt,Dt){const nt=20*e,tt=40*e,St=80*e;return this.float32[nt+0]=i,this.float32[nt+1]=a,this.int16[tt+4]=c,this.int16[tt+5]=m,this.int16[tt+6]=g,this.int16[tt+7]=x,this.int16[tt+8]=S,this.int16[tt+9]=C,this.int16[tt+10]=M,this.int16[tt+11]=P,this.int16[tt+12]=k,this.uint16[tt+13]=V,this.uint16[tt+14]=U,this.uint16[tt+15]=q,this.uint16[tt+16]=J,this.uint16[tt+17]=ee,this.uint16[tt+18]=oe,this.uint16[tt+19]=le,this.uint16[tt+20]=fe,this.uint16[tt+21]=Ie,this.uint16[tt+22]=Se,this.uint16[tt+23]=Pe,this.uint16[tt+24]=ke,this.uint16[tt+25]=Be,this.uint16[tt+26]=ot,this.uint16[tt+27]=Ze,this.uint32[nt+14]=st,this.float32[nt+15]=dt,this.float32[nt+16]=wt,this.float32[nt+17]=Rt,this.float32[nt+18]=Mt,this.uint8[St+76]=yt,this.uint16[tt+39]=Dt,e}}_r.prototype.bytesPerElement=80,li(_r,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class yf extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,a,c,m,g)}emplace(e,i,a,c,m,g,x){const S=6*e;return this.float32[S+0]=i,this.float32[S+1]=a,this.float32[S+2]=c,this.float32[S+3]=m,this.float32[S+4]=g,this.float32[S+5]=x,e}}yf.prototype.bytesPerElement=24,li(yf,"StructArrayLayout6f24");class Ph extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,a,c,m)}emplace(e,i,a,c,m,g){const x=5*e;return this.float32[x+0]=i,this.float32[x+1]=a,this.float32[x+2]=c,this.float32[x+3]=m,this.float32[x+4]=g,e}}Ph.prototype.bytesPerElement=20,li(Ph,"StructArrayLayout5f20");class mx extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m,g,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,a,c,m,g,x)}emplace(e,i,a,c,m,g,x,S){const C=7*e;return this.float32[C+0]=i,this.float32[C+1]=a,this.float32[C+2]=c,this.float32[C+3]=m,this.float32[C+4]=g,this.float32[C+5]=x,this.float32[C+6]=S,e}}mx.prototype.bytesPerElement=28,li(mx,"StructArrayLayout7f28");class Vp extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m,g,x,S,C,M,P){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,a,c,m,g,x,S,C,M,P)}emplace(e,i,a,c,m,g,x,S,C,M,P,k){const V=11*e;return this.float32[V+0]=i,this.float32[V+1]=a,this.float32[V+2]=c,this.float32[V+3]=m,this.float32[V+4]=g,this.float32[V+5]=x,this.float32[V+6]=S,this.float32[V+7]=C,this.float32[V+8]=M,this.float32[V+9]=P,this.float32[V+10]=k,e}}Vp.prototype.bytesPerElement=44,li(Vp,"StructArrayLayout11f44");class Up extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m,g,x,S,C){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,a,c,m,g,x,S,C)}emplace(e,i,a,c,m,g,x,S,C,M){const P=9*e;return this.float32[P+0]=i,this.float32[P+1]=a,this.float32[P+2]=c,this.float32[P+3]=m,this.float32[P+4]=g,this.float32[P+5]=x,this.float32[P+6]=S,this.float32[P+7]=C,this.float32[P+8]=M,e}}Up.prototype.bytesPerElement=36,li(Up,"StructArrayLayout9f36");class Hl extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=a,e}}Hl.prototype.bytesPerElement=8,li(Hl,"StructArrayLayout2f8");class cy extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,c)}emplace(e,i,a,c,m){const g=6*e;return this.uint32[3*e+0]=i,this.uint16[g+2]=a,this.uint16[g+3]=c,this.uint16[g+4]=m,e}}cy.prototype.bytesPerElement=12,li(cy,"StructArrayLayout1ul3ui12");class jp extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}jp.prototype.bytesPerElement=2,li(jp,"StructArrayLayout1ui2");class bg extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m,g,x,S,C,M,P,k,V,U,q,J){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,i,a,c,m,g,x,S,C,M,P,k,V,U,q,J)}emplace(e,i,a,c,m,g,x,S,C,M,P,k,V,U,q,J,ee){const oe=16*e;return this.float32[oe+0]=i,this.float32[oe+1]=a,this.float32[oe+2]=c,this.float32[oe+3]=m,this.float32[oe+4]=g,this.float32[oe+5]=x,this.float32[oe+6]=S,this.float32[oe+7]=C,this.float32[oe+8]=M,this.float32[oe+9]=P,this.float32[oe+10]=k,this.float32[oe+11]=V,this.float32[oe+12]=U,this.float32[oe+13]=q,this.float32[oe+14]=J,this.float32[oe+15]=ee,e}}bg.prototype.bytesPerElement=64,li(bg,"StructArrayLayout16f64");class Oh extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,c,m,g,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,a,c,m,g,x)}emplace(e,i,a,c,m,g,x,S){const C=10*e,M=5*e;return this.uint16[C+0]=i,this.uint16[C+1]=a,this.uint16[C+2]=c,this.uint16[C+3]=m,this.float32[M+2]=g,this.float32[M+3]=x,this.float32[M+4]=S,e}}Oh.prototype.bytesPerElement=20,li(Oh,"StructArrayLayout4ui3f20");class uy extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}uy.prototype.bytesPerElement=2,li(uy,"StructArrayLayout1i2");class Gp extends xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Gp.prototype.bytesPerElement=1,li(Gp,"StructArrayLayout1ub1");class wg extends Bp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}wg.prototype.size=40;class hy extends Gu{get(e){return new wg(this,e)}}li(hy,"CollisionBoxArray");class Es extends Bp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Es.prototype.size=60;class Tl extends pc{get(e){return new Es(this,e)}}li(Tl,"PlacedSymbolArray");class mc extends Bp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}mc.prototype.size=80;class Hp extends _r{get(e){return new mc(this,e)}}li(Hp,"SymbolInstanceArray");class Sd extends Vu{getoffsetX(e){return this.float32[1*e+0]}}li(Sd,"GlyphOffsetArray");class $l extends Wa{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}li($l,"SymbolLineVertexArray");class Aa extends Bp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Aa.prototype.size=12;class gx extends cy{get(e){return new Aa(this,e)}}li(gx,"FeatureIndexArray");class _x extends jl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}li(_x,"FillExtrusionCentroidArray");class yx extends Bp{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}yx.prototype.size=6;class Tg extends qc{get(e){return new yx(this,e)}}li(Tg,"FillExtrusionWallArray");const dy=gn([{name:"a_pos",components:2,type:"Int16"}],4),Sg=gn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),vx=gn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class oo{constructor(e=[]){this.segments=e}_prepareSegment(e,i,a,c){let m=this.segments[this.segments.length-1];return e>oo.MAX_VERTEX_ARRAY_LENGTH&&ei(`Max vertices per segment is ${oo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>oo.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:i,primitiveOffset:a,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}prepareSegment(e,i,a,c){return this._prepareSegment(e,i.length,a.length,c)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,c){return new oo([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:c,vaos:{},sortKey:0}])}}function xx(n,e){return 256*(n=Y(Math.floor(n),0,255))+Y(Math.floor(e),0,255)}oo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,li(oo,"SegmentVector");const fy=gn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),qb=gn([{name:"a_pattern_b",components:4,type:"Uint16"}]),bx=gn([{name:"a_dash",components:4,type:"Uint16"}]);class $p{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,a,c){this.ids.push(vf(e)),this.positions.push(i,a,c)}eachPosition(e,i){const a=vf(e);let c=0,m=this.ids.length-1;for(;c<m;){const g=c+m>>1;this.ids[g]>=a?m=g:c=g+1}for(;this.ids[c]===a;)i(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,i){const a=new Float64Array(e.ids),c=new Uint32Array(e.positions);return py(a,c,0,a.length-1),i&&(i.add(a.buffer),i.add(c.buffer)),{ids:a,positions:c}}static deserialize(e){const i=new $p;let a;i.ids=e.ids,i.positions=e.positions;for(const c of i.ids)c!==a&&i.uniqueIds.push(c),a=c;return i.indexed=!0,i}}function vf(n){const e=+n;return Number.isSafeInteger(e)?e:ge(String(n))}function py(n,e,i,a){for(;i<a;){const c=n[i+a>>1];let m=i-1,g=a+1;for(;;){do m++;while(n[m]<c);do g--;while(n[g]>c);if(m>=g)break;Wp(n,m,g),Wp(e,3*m,3*g),Wp(e,3*m+1,3*g+1),Wp(e,3*m+2,3*g+2)}g-i<a-g?(py(n,e,i,g),i=g+1):(py(n,e,g+1,a),a=g)}}function Wp(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}li($p,"FeaturePositionMap");class Wl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class xf extends Wl{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class So extends Wl{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class ds extends Wl{constructor(e){super(e),this.current=[0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class Sl extends Wl{constructor(e){super(e),this.current=[0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class ql extends Wl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class Ed extends Wl{constructor(e){super(e),this.current=Qi.transparent.toPremultipliedRenderColor(null)}set(e,i,a){this.fetchUniformLocation(e,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const bf=new Float32Array(16);class Zl extends Wl{constructor(e){super(e),this.current=bf}set(e,i,a){if(this.fetchUniformLocation(e,i)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let c=1;c<16;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const Zb=new Float32Array(9),wx=new Float32Array(4);class my extends Wl{constructor(e){super(e),this.current=wx}set(e,i,a){if(this.fetchUniformLocation(e,i)){for(let c=0;c<4;c++)if(a[c]!==this.current[c]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function Eg(n){return[xx(255*n.r,255*n.g),xx(255*n.b,255*n.a)]}function kh(n,e,i,a,c,m,g,x){return!!n&&(n.kind==="composite"||n.kind==="source"?n.evaluate(new Ar(0,{brightness:m,worldview:x}),e,i,c,a,g)==="none":n.value==="none")}class Ag{constructor(e,i,a,c){this.value=e,this.uniformNames=i.map(m=>`u_${m}`),this.type=a,this.context=c}setUniform(e,i,a,c,m){const g=c.constantOr(this.value);i.set(e,m,g instanceof Qi?g.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):g)}getBinding(e,i){return this.type==="color"?new Ed(e):new So(e)}}class wf{constructor(e,i){this.uniformNames=i.map(a=>`u_${a}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,a,c,m){let g=null;m!=="u_pattern"&&m!=="u_dash"||(g=this.pattern),m==="u_pattern_b"&&(g=this.patternTransition),m==="u_pixel_ratio"&&(g=this.pixelRatio),g&&i.set(e,m,g)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new ql(e):new So(e)}}class Hu{constructor(e,i,a,c){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(m=>({name:`a_${m}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,i,a,c,m,g,x,S){const C=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Ar(0,{brightness:g,worldview:S}),i,{},m,c,x):this.expression.kind==="constant"&&this.expression.value,P=kh(this.lutExpression,i,{},c,m,g,x,S);this.paintVertexArray.resize(e),this._setPaintValue(C,e,M,P?null:this.context.lut)}updatePaintArray(e,i,a,c,m,g,x,S){const C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x,worldview:S},a,c,void 0,m):this.expression.kind==="constant"&&this.expression.value,M=kh(this.lutExpression,a,c,m,void 0,x,void 0,S);this._setPaintValue(e,i,C,M?null:this.context.lut)}_setPaintValue(e,i,a,c){if(this.type==="color"){const m=Eg(a.toPremultipliedRenderColor(c));for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,m[0],m[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class il{constructor(e,i,a,c,m,g){this.expression=e,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=a,this.useIntegerZoom=c,this.context=m,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,i,a,c,m,g,x,S){const C=this.expression.evaluate(new Ar(this.context.zoom,{brightness:g,worldview:S}),i,{},m,c,x),M=this.expression.evaluate(new Ar(this.context.zoom+1,{brightness:g,worldview:S}),i,{},m,c,x),P=kh(this.lutExpression,i,{},c,m,g,x,S),k=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(k,e,C,M,P?null:this.context.lut)}updatePaintArray(e,i,a,c,m,g,x,S){const C=this.expression.evaluate({zoom:this.context.zoom,brightness:x,worldview:S},a,c,void 0,m),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x,worldview:S},a,c,void 0,m),P=kh(this.lutExpression,a,c,m,void 0,x,void 0,S);this._setPaintValue(e,i,C,M,P?null:this.context.lut)}_setPaintValue(e,i,a,c,m){if(this.type==="color"){const g=Eg(a.toPremultipliedRenderColor(m)),x=Eg(a.toPremultipliedRenderColor(m));for(let S=e;S<i;S++)this.paintVertexArray.emplace(S,g[0],g[1],x[0],x[1])}else{for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,a,c);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,a,c,m){const g=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,x=Y(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);i.set(e,m,x)}getBinding(e,i){return new So(e)}}class qa{constructor(e,i,a,c,m){this.expression=e,this.layerId=m,this.paintVertexAttributes=(a==="array"?bx:fy).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new c,this.paintTransitionVertexArray=new wd}populatePaintArray(e,i,a,c){const m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(m,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,c,m,g,x){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],g)}_setPaintValues(e,i,a,c){if(!c||!a)return;const m=c[a[0]],g=c[a[1]];if(m){if(m){const{tl:x,br:S,pixelRatio:C}=m;for(let M=e;M<i;M++)this.paintVertexArray.emplace(M,x[0],x[1],S[0],S[1],C)}if(g){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:x,br:S}=g;for(let C=e;C<i;C++)this.paintTransitionVertexArray.emplace(C,x[0],x[1],S[0],S[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,qb.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class $u{constructor(e,i,a=()=>!0){this.binders={},this._buffers=[],this.context=i;const c=[];for(const m in e.paint._values){const g=e.paint.get(m);if(m.endsWith("-use-theme")||!a(m)||!(g instanceof Ea&&ag(g.property.specification)))continue;const x=Tf(m,e.type),S=g.value,C=g.property.specification.type,M=!!g.property.useIntegerZoom,P=m==="line-dasharray"||m.endsWith("pattern"),k=e.paint.get(`${m}-use-theme`),V=m==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||k&&k.value.kind!=="constant";if(S.kind!=="constant"||V)if(S.kind==="source"||V||P){const U=_y(m,C,"source");this.binders[m]=P?new qa(S,x,C,U,e.id):new Hu(S,x,C,U),c.push(`/a_${m}`)}else{const U=_y(m,C,"composite");this.binders[m]=new il(S,x,C,M,i,U),c.push(`/z_${m}`)}else this.binders[m]=P?new wf(S.value,x):new Ag(S.value,x,C,i),c.push(`/u_${m}`);k&&(this.binders[m].lutExpression=k.value)}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Hu||i instanceof il?i.maxValue:0}populatePaintArrays(e,i,a,c,m,g,x,S){for(const C in this.binders){const M=this.binders[C];M.context=this.context,(M instanceof Hu||M instanceof il||M instanceof qa)&&M.populatePaintArray(e,i,a,c,m,g,x,S)}}setConstantPatternPositions(e,i){for(const a in this.binders){const c=this.binders[a];c instanceof wf&&c.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof qa?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,a,c,m,g,x,S,C,M){let P=!1;const k=Object.keys(e),V=k.length!==0&&!S,U=V?k:i.uniqueIds;this.context.lut=m.lut;for(const q in this.binders){const J=this.binders[q];if(J.context=this.context,(J instanceof Hu||J instanceof il||J instanceof qa)&&J.expression&&J.expression.kind&&J.expression.kind!=="constant"&&(J.expression.isStateDependent===!0||J.expression.isLightConstant===!1)){const ee=m.paint.get(q);J.expression=ee.value;for(const oe of U){const le=e[oe.toString()];i.eachPosition(oe,(fe,Ie,Se)=>{const Pe=c.feature(fe);J.updatePaintArray(Ie,Se,Pe,le,g,x,C,M)})}if(!V)for(const oe of a.uniqueIds){const le=e[oe.toString()];a.eachPosition(oe,(fe,Ie,Se)=>{const Pe=c.feature(fe);J.updatePaintArray(Ie,Se,Pe,le,g,x,C,M)})}P=!0}}return P}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof Ag||a instanceof wf)&&e.push(...a.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const a in this.binders){const c=this.binders[a];if(c instanceof Ag||c instanceof wf||c instanceof il)for(const m of c.uniformNames)i.push({name:m,property:a,binding:c.getBinding(e,m)})}return i}setUniforms(e,i,a,c,m){for(const{name:g,property:x,binding:S}of a)this.binders[x].setUniform(e,S,m,c.get(x),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Hu||i instanceof il||i instanceof qa)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof qa&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof Hu||a instanceof il||a instanceof qa)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Hu||i instanceof il||i instanceof qa)&&i.destroy()}}}class Ns{constructor(e,i,a=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new $u(c,i,a);this.needsUpload=!1,this._featureMap=new $p,this._featureMapWithoutIds=new $p,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,a,c,m,g,x,S,C){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(e,i,c,m,g,x,S,C);i.id!==void 0?this._featureMap.add(i.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,c,m,g,x,S){for(const C of a)this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,C,c,m,g,x||0,S)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const qp={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Tf(n,e){return qp[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const gy={"line-pattern":{source:Uu,composite:Uu},"fill-pattern":{source:Uu,composite:Uu},"fill-extrusion-pattern":{source:Uu,composite:Uu},"line-dasharray":{source:wd,composite:wd}},Tx={color:{source:Hl,composite:ju},number:{source:Vu,composite:Hl}};function _y(n,e,i){const a=gy[n];return a&&a[i]||Tx[e][i]}li(Ag,"ConstantBinder"),li(wf,"PatternConstantBinder"),li(Hu,"SourceExpressionBinder"),li(qa,"PatternCompositeBinder"),li(il,"CompositeExpressionBinder"),li($u,"ProgramConfiguration",{omit:["_buffers"]}),li(Ns,"ProgramConfigurationSet");const Bs=Bt/Math.PI/2,f=5,t=6,o=16383,p=64,y=[p,32,16],b=-Bs,T=Bs;function I(n,e,i,a=Bs){return i=hn(i),[n*Math.sin(i)*a,-e*a,n*Math.cos(i)*a]}function D(n,e,i){return I(Math.cos(hn(n)),Math.sin(hn(n)),e,i)}const F=63710088e-1,z=2*Math.PI*F;class j{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new j(we(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,c=e.lat*i,m=Math.sin(a)*Math.sin(c)+Math.cos(a)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return F*Math.acos(Math.min(m,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new B({lng:this.lng-a,lat:this.lat-i},{lng:this.lng+a,lat:this.lat+i})}toEcef(e){return D(this.lat,this.lng,Bs+e*Bs/F)}static convert(e){if(e instanceof j)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new j(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new j(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class B{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof j?new j(e.lng,e.lat):j.convert(e),this}setSouthWest(e){return this._sw=e instanceof j?new j(e.lng,e.lat):j.convert(e),this}extend(e){const i=this._sw,a=this._ne;let c,m;if(e instanceof j)c=e,m=e;else{if(!(e instanceof B))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(B.convert(e)):this.extend(j.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(j.convert(e)):this;if(c=e._sw,m=e._ne,!c||!m)return this}return i||a?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),a.lng=Math.max(m.lng,a.lng),a.lat=Math.max(m.lat,a.lat)):(this._sw=new j(c.lng,c.lat),this._ne=new j(m.lng,m.lat)),this}getCenter(){return new j((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new j(this.getWest(),this.getNorth())}getSouthEast(){return new j(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=j.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){if(e)return e instanceof B?e:new B(e)}}const $=0,Z=25.5;function Q(n){return z*Math.cos(n*Math.PI/180)}function ne(n){return(180+n)/360}function te(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function se(n,e){return n/Q(e)}function me(n){return 360*n-180}function ce(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Ce(n,e){return n*Q(ce(e))}const _e=85.051129;function Re(n){return Math.cos(hn(Y(n,-_e,_e)))}function Ae(n,e){const i=Y(e,$,Z),a=Math.pow(2,i);return Re(n)*z/(512*a)}function Te(n){return 1/Math.cos(n*Math.PI/180)}function De(n,e=0){const i=Math.exp(Math.PI*(1-(n.y+e/Bt)/(1<<n.z)*2));return 80150034*i/(i*i+1)/Bt/(1<<n.z)}class He{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=j.convert(e);return new He(ne(a.lng),te(a.lat),se(i,a.lat))}toLngLat(){return new j(me(this.x),ce(this.y))}toAltitude(){return Ce(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/z*Te(ce(this.y))}}function Ue(n,e,i,a,c,m,g,x,S){const C=(e+a)/2,M=(i+c)/2,P=new Tt(C,M);x(P),function(k,V,U,q,J,ee){const oe=U-J,le=q-ee;return Math.abs((q-V)*oe-(U-k)*le)/Math.hypot(oe,le)}(P.x,P.y,m.x,m.y,g.x,g.y)>=S?(Ue(n,e,i,C,M,m,P,x,S),Ue(n,C,M,a,c,P,g,x,S)):n.push(g)}function rt(n,e,i){let a=n[0],c=a.x,m=a.y;e(a);const g=[a];for(let x=1;x<n.length;x++){const S=n[x],{x:C,y:M}=S;e(S),Ue(g,c,m,C,M,a,S,e,i),c=C,m=M,a=S}return g}function Qe(n,e,i,a){if(a(e,i)){const c=e.add(i)._mult(.5);Qe(n,e,c,a),Qe(n,c,i,a)}else n.push(i)}function lt(n,e){let i=n[0];const a=[i];for(let c=1;c<n.length;c++){const m=n[c];Qe(a,i,m,e),i=m}return a}const Lt=Math.pow(2,14)-1,Xe=-Lt-1;function Ne(n,e){const i=Math.round(n.x*e),a=Math.round(n.y*e);return n.x=Y(i,Xe,Lt),n.y=Y(a,Xe,Lt),(i<n.x||i>n.x+1||a<n.y||a>n.y+1)&&ei("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function ct(n,e,i){const a=n.loadGeometry(),c=n.extent,m=Bt/c;if(e&&i&&i.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:x,x:S,y:C,projection:M}=i,P=k=>{const V=me((e.x+k.x/c)/g),U=ce((e.y+k.y/c)/g),q=M.project(V,U);k.x=(q.x*x-S)*c,k.y=(q.y*x-C)*c};for(let k=0;k<a.length;k++)if(n.type!==1)a[k]=rt(a[k],P,1);else{const V=[];for(const U of a[k])U.x<0||U.x>=c||U.y<0||U.y>=c||(P(U),V.push(U));a[k]=V}}for(const g of a)for(const x of g)Ne(x,m);return a}function et(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?ct(n):[]}}class At{constructor(e,i,a,c,m){this.properties={},this.extent=a,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=c,this._values=m,e.readFields(jt,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,a=[];let c,m=1,g=0,x=0,S=0;for(;e.pos<i;){if(g<=0){const C=e.readVarint();m=7&C,g=C>>3}if(g--,m===1||m===2)x+=e.readSVarint(),S+=e.readSVarint(),m===1&&(c&&a.push(c),c=[]),c&&c.push(new Tt(x,S));else{if(m!==7)throw new Error(`unknown command ${m}`);c&&c.push(c[0].clone())}}return c&&a.push(c),a}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let a=1,c=0,m=0,g=0,x=1/0,S=-1/0,C=1/0,M=-1/0;for(;e.pos<i;){if(c<=0){const P=e.readVarint();a=7&P,c=P>>3}if(c--,a===1||a===2)m+=e.readSVarint(),g+=e.readSVarint(),m<x&&(x=m),m>S&&(S=m),g<C&&(C=g),g>M&&(M=g);else if(a!==7)throw new Error(`unknown command ${a}`)}return[x,C,S,M]}toGeoJSON(e,i,a){const c=this.extent*Math.pow(2,a),m=this.extent*e,g=this.extent*i,x=this.loadGeometry();function S(k){return[360*(k.x+m)/c-180,360/Math.PI*Math.atan(Math.exp((1-2*(k.y+g)/c)*Math.PI))-90]}function C(k){return k.map(S)}let M;if(this.type===1){const k=[];for(const U of x)k.push(U[0]);const V=C(k);M=k.length===1?{type:"Point",coordinates:V[0]}:{type:"MultiPoint",coordinates:V}}else if(this.type===2){const k=x.map(C);M=k.length===1?{type:"LineString",coordinates:k[0]}:{type:"MultiLineString",coordinates:k}}else{if(this.type!==3)throw new Error("unknown feature type");{const k=function(U){const q=U.length;if(q<=1)return[U];const J=[];let ee,oe;for(let le=0;le<q;le++){const fe=pi(U[le]);fe!==0&&(oe===void 0&&(oe=fe<0),oe===fe<0?(ee&&J.push(ee),ee=[U[le]]):ee&&ee.push(U[le]))}return ee&&J.push(ee),J}(x),V=[];for(const U of k)V.push(U.map(C));M=V.length===1?{type:"Polygon",coordinates:V[0]}:{type:"MultiPolygon",coordinates:V}}}const P={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(P.id=this.id),P}}function jt(n,e,i){n===1?e.id=i.readVarint():n===2?function(a,c){const m=a.readVarint()+a.pos;for(;a.pos<m;){const g=c._keys[a.readVarint()],x=c._values[a.readVarint()];c.properties[g]=x}}(i,e):n===3?e.type=i.readVarint():n===4&&(e._geometry=i.pos)}function pi(n){let e=0;for(let i,a,c=0,m=n.length,g=m-1;c<m;g=c++)i=n[c],a=n[g],e+=(a.x-i.x)*(i.y+a.y);return e}At.types=["Unknown","Point","LineString","Polygon"];class Ft{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(zt,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new At(this._pbf,i,this.extent,this._keys,this._values)}}function zt(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push(function(a){let c=null;const m=a.readVarint()+a.pos;for(;a.pos<m;){const g=a.readVarint()>>3;c=g===1?a.readString():g===2?a.readFloat():g===3?a.readDouble():g===4?a.readVarint64():g===5?a.readVarint():g===6?a.readSVarint():g===7?a.readBoolean():null}if(c==null)throw new Error("unknown feature value");return c}(i))}class mi{constructor(e,i){this.layers=e.readFields(ni,{},i)}}function ni(n,e,i){if(n===3){const a=new Ft(i,i.readVarint()+i.pos);a.length&&(e[a.name]=a)}}const ii="3d_elevation_id",ri="level";class Oi{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,a){return this.get(e,!0,i,a)}optional(e,i,a){return this.get(e,!1,i,a)}success(){return this._valid}get(e,i,a,c){const m=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&m!==void 0&&!Number.isNaN(m)?a(c?c(m):m):i&&(this._valid=!1),this}}class wn{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,a){return this.featureFunc(e,i,a)}parseVertex(e,i,a){return this.vertexFunc(e,i,a)}}const In=new wn((n,e,i)=>n.reset(e).require(ii,a=>{i.id=a}).optional("fixed_height_relative",a=>{i.constantHeight=a},Ui.decodeRelativeHeight).geometry(a=>{i.bounds=a},xp).success(),(n,e,i)=>n.reset(e).require(ii,a=>{i.id=a}).require("elevation_idx",a=>{i.idx=a}).require("extent",a=>{i.extent=a}).require("height_relative",a=>{i.height=a},Ui.decodeRelativeHeight).geometry(a=>{i.position=a},Ui.getPoint).success()),vr=new wn((n,e,i)=>n.reset(e).require(ii,a=>{i.id=a}).optional("fixed_height",a=>{i.constantHeight=a},Ui.decodeMetricHeight).geometry(a=>{i.bounds=a},xp).success(),(n,e,i)=>n.reset(e).require(ii,a=>{i.id=a}).require("elevation_idx",a=>{i.idx=a}).require("extent",a=>{i.extent=a}).require("height",a=>{i.height=a},Ui.decodeMetricHeight).geometry(a=>{i.position=a},Ui.getPoint).success());class Ui{static getPoint(e){return yo(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?vr:void 0:In}static parse(e){const i=[],a=[],c=e.length,m=new Oi;for(let g=0;g<c;g++){const x=e.feature(g),S=x.properties.version,C=Ui.getVersionSchema(S);if(C===void 0){ei(`Unknown elevation feature version number ${S||"(unknown)"}`);continue}const M=x.properties.type;if(!M)continue;const P=At.types[x.type];if(P==="Point"&&M==="curve_point"){const k={};C.parseVertex(m,x,k)&&i.push(k)}else if(P==="Polygon"&&M==="curve_meta"){const k={};C.parseFeature(m,x,k)&&a.push(k)}}return{vertices:i,features:a}}}class Dn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const c=wa(i,this.dir);if(Math.abs(c)<1e-6)return!1;const m=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/c;return a[0]=this.pos[0]+this.dir[0]*m,a[1]=this.pos[1]+this.dir[1]*m,!0}}class tn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const c=Ei(i,this.dir);if(Math.abs(c)<1e-6)return!1;const m=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/c;return a[0]=this.pos[0]+this.dir[0]*m,a[1]=this.pos[1]+this.dir[1]*m,a[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,i,a){if(function(V,U){var q=V[0],J=V[1],ee=V[2],oe=U[0],le=U[1],fe=U[2];return Math.abs(q-oe)<=L*Math.max(1,Math.abs(q),Math.abs(oe))&&Math.abs(J-le)<=L*Math.max(1,Math.abs(J),Math.abs(le))&&Math.abs(ee-fe)<=L*Math.max(1,Math.abs(ee),Math.abs(fe))}(this.pos,e)||i===0)return a[0]=a[1]=a[2]=0,!1;const[c,m,g]=this.dir,x=this.pos[0]-e[0],S=this.pos[1]-e[1],C=this.pos[2]-e[2],M=c*c+m*m+g*g,P=2*(x*c+S*m+C*g),k=P*P-4*M*(x*x+S*S+C*C-i*i);if(k<0){const V=Math.max(-P/2,0),U=x+c*V,q=S+m*V,J=C+g*V,ee=Math.hypot(U,q,J);return a[0]=U*i/ee,a[1]=q*i/ee,a[2]=J*i/ee,!1}{const V=(-P-Math.sqrt(k))/(2*M);if(V<0){const U=Math.hypot(x,S,C);return a[0]=x*i/U,a[1]=S*i/U,a[2]=C*i/U,!1}return a[0]=x+c*V,a[1]=S+m*V,a[2]=C+g*V,!0}}}class mr{constructor(e,i,a,c,m){this.TL=e,this.TR=i,this.BR=a,this.BL=c,this.horizon=m}static fromInvProjectionMatrix(e,i,a){const c=[-1,1,1],m=[1,1,1],g=[1,-1,1],x=[-1,-1,1],S=on(c,c,e),C=on(m,m,e),M=on(g,g,e),P=on(x,x,e);return new mr(S,C,M,P,i/a)}}function kn(n,e,i){let a=1/0,c=-1/0;const m=[];for(const g of n){Fr(m,g,e);const x=Ei(m,i);a=Math.min(a,x),c=Math.max(c,x)}return[a,c]}function Cr(n,e){let i=!0;for(let a=0;a<n.planes.length;a++){const c=n.planes[a];let m=0;for(let g=0;g<e.length;g++)m+=+(Ei(c,e[g])+c[3]>=0);if(m===0)return 0;m!==e.length&&(i=!1)}return i?2:1}function Hn(n,e){for(const i of n.projections){const a=kn(e,n.points[0],i.axis);if(i.projection[1]<a[0]||i.projection[0]>a[1])return 0}return 1}function ln(n,e){let i=0;const a=[0,0,0,0];for(let g=0;g<n.length;g++)a[0]=n[g][0],a[1]=n[g][1],a[2]=n[g][2],a[3]=1,(c=a)[0]*(m=e)[0]+c[1]*m[1]+c[2]*m[2]+c[3]*m[3]>=0&&i++;var c,m;return i}class rr{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=dn.fromPoints(this.points),this.projections=[],this.frustumEdges=[Fr([],this.points[2],this.points[3]),Fr([],this.points[0],this.points[3]),Fr([],this.points[4],this.points[0]),Fr([],this.points[5],this.points[1]),Fr([],this.points[6],this.points[2]),Fr([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const c=[0,-a[2],a[1]],m=[a[2],0,-a[0]];this.projections.push({axis:c,projection:kn(this.points,this.points[0],c)}),this.projections.push({axis:m,projection:kn(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(e,i,a,c){const m=Math.pow(2,a),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const M=Uo([],C,e),P=1/M[3]/i*m;return(k=M)[0]=(V=M)[0]*(U=[P,P,c?1/M[3]:P,P])[0],k[1]=V[1]*U[1],k[2]=V[2]*U[2],k[3]=V[3]*U[3],k;var k,V,U}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const M=mn([],Xi([],Fr([],g[C[0]],g[C[1]]),Fr([],g[C[2]],g[C[1]]))),P=-Ei(M,g[C[1]]);return M.concat(P)}),S=[];for(let C=0;C<g.length;C++)S.push([g[C][0],g[C][1],g[C][2]]);return new rr(S,x)}intersectsPrecise(e,i,a){for(let c=0;c<i.length;c++)if(!ln(e,i[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!ln(e,this.planes[c]))return 0;for(const c of a)for(const m of this.frustumEdges){const g=Xi([],c,m),x=Qt(g);if(x===0)continue;pn(g,g,1/x);const S=kn(this.points,this.points[0],g),C=kn(e,this.points[0],g);if(S[0]>C[1]||C[0]>S[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const a=i[3];if(Ei([i[0],i[1],i[2]],e)+a<0)return!1}return!0}}class dn{static fromPoints(e){const i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const c of e)er(i,i,c),Mn(a,a,c);return new dn(i,a)}static fromTileIdAndHeight(e,i,a){const c=1<<e.canonical.z,m=e.canonical.x,g=e.canonical.y;return new dn([m/c,g/c,i],[(m+1)/c,(g+1)/c,a])}static applyTransform(e,i){const a=e.getCorners();for(let c=0;c<a.length;++c)on(a[c],a[c],i);return dn.fromPoints(a)}static applyTransformFast(e,i){const a=[i[12],i[13],i[14]],c=[...a];for(let m=0;m<3;m++)for(let g=0;g<3;g++){const x=i[4*g+m],S=x*e.min[g],C=x*e.max[g];a[m]+=Math.min(S,C),c[m]+=Math.max(S,C)}return new dn(a,c)}static projectAabbCorners(e,i){const a=e.getCorners();for(let c=0;c<a.length;++c)on(a[c],a[c],i);return a}constructor(e,i){this.min=e,this.max=i,this.center=pn([],fi([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=Ii(this.min),c=Ii(this.max);for(let m=0;m<i.length;m++)a[m]=i[m]?this.min[m]:this.center[m],c[m]=i[m]?this.center[m]:this.max[m];return c[2]=this.max[2],new dn(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Cr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Cr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Hn(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Hn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}li(dn,"Aabb");class zr{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,a=i[1],c=-i[0],m=(e.extent+1)*this.metersToTile;return[new Tt(Math.trunc(e.position[0]+a*m),Math.trunc(e.position[1]+c*m)),new Tt(Math.trunc(e.position[0]-a*m),Math.trunc(e.position[1]-c*m))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Kn{constructor(e,i,a,c,m,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[jn(),jn(),jn(),jn(),jn(),jn(),jn()],this.id=e,this.heightRange={min:a,max:a},this.safeArea=i,this.constantHeight=a,this.constantHeight==null&&(this.constantHeight!=null||c.length!==0)){this.vertices=c,this.edges=m,this.edges=this.edges.filter(x=>{return x.a<this.vertices.length&&x.b<this.vertices.length&&!((S=this.vertices[x.a].position)[0]===(C=this.vertices[x.b].position)[0]&&S[1]===C[1]);var S,C}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:yo(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const S=this.vertices[x.a].position,C=this.vertices[x.b].position,M=qr(jn(),C,S),P=bn(M),k=wr(jn(),M,1/P);this.edgeProps.push({vec:M,dir:k,len:P});const V=this.vertexProps[x.a].dir,U=this.vertexProps[x.b].dir;Wo(V,V,k),Wo(U,U,k)}for(const x of this.vertexProps)x.dir[0]===0&&x.dir[1]===0||uo(x.dir,x.dir);this.tessellate(g)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[a,c]=i;return Si(this.vertices[this.edges[a].a].height,this.vertices[this.edges[a].b].height,c)}computeSlopeNormal(e,i){const a=this.getClosestEdge(e);if(!a)return _t(0,0,1);const c=a[0],m=this.edges[c],g=this.edgeProps[c].vec,x=_t(g[0],g[1],(this.vertices[m.b].height-this.vertices[m.a].height)*i),S=_t(x[1],-x[0],0);Xi(S,S,x);const C=Qt(S);return C>0?pn(S,S,1/C):Et(S,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,a=Number.POSITIVE_INFINITY,c=0;const[m,g,x,S,C,M,P]=this._tmpVec2;To(P,e.x,e.y);const k=new Dn(P,null);for(let V=0;V<this.edges.length;V++){const U=this.edges[V],q=this.edgeProps[V].dir;k.dir=q;const J=this.vertices[U.a].position,ee=this.vertices[U.b].position,oe=k.intersectsPlane(J,this.vertexProps[U.a].dir,m),le=k.intersectsPlane(ee,this.vertexProps[U.b].dir,g);if(!oe||!le)continue;qr(x,g,m),qr(S,P,m);const fe=wa(x,x),Ie=fe>0?wa(S,x)/fe:0,Se=Y(Ie,0,1),Pe=Math.abs((Ie-Se)*this.edgeProps[V].len);qr(C,P,J),To(M,q[1],-q[0]);const ke=Pe+Math.abs(wa(C,M));ke<a&&(i=V,a=ke,c=Se)}return[i,c]}tessellate(e){const i=Nt(),a=Nt(),c=Nt(),m=Nt();for(let g=this.edges.length-1;g>=0;--g){const x=this.edges[g].a,S=this.edges[g].b,{position:C,height:M,extent:P}=this.vertices[x],{position:k,height:V,extent:U}=this.vertices[S],q=this.vertexProps[x].dir,J=this.vertexProps[S].dir;if(Et(i,C[0]/e,C[1]/e,M),Et(a,k[0]/e,k[1]/e,V),Et(c,q[1],-q[0],0),pn(c,c,P),Et(m,J[1],-J[0],0),pn(m,m,U),this.distSqLines(_t(i[0]+.5*c[0],i[1]+.5*c[1],i[2]+.5*c[2]),_t(a[0]-.5*m[0],a[1]-.5*m[1],a[2]-.5*m[2]),_t(i[0]-.5*c[0],i[1]-.5*c[1],i[2]-.5*c[2]),_t(a[0]+.5*m[0],a[1]+.5*m[1],a[2]+.5*m[2]))<=.0025000000000000005)continue;const ee=this.vertices.length,oe=Wo(jn(),C,k);this.vertices.push({position:wr(oe,oe,.5),height:.5*(M+V),extent:.5*(P+U)});const le=Wo(jn(),q,J);this.vertexProps.push({dir:uo(le,le)}),this.edges.splice(g,1),this.edgeProps.splice(g,1),this.edges.push({a:x,b:ee}),this.edges.push({a:ee,b:S});const fe=qr(jn(),this.vertices[ee].position,C),Ie=bn(fe),Se={vec:fe,dir:wr(jn(),fe,1/Ie),len:Ie};this.edgeProps.push(Se),this.edgeProps.push(Se)}}distSqLines(e,i,a,c){const m=rn(Nt(),i,e),g=rn(Nt(),c,a),x=rn(Nt(),e,a),S=Ei(m,m),C=Ei(m,g),M=Ei(m,x),P=Ei(g,g),k=Ei(g,x),V=S*P-C*C;if(V===0)return Or(Rn(m,a,c,Ei(x,g)/Ei(g,g)),e);const U=(S*k-C*M)/V;return Or(Rn(m,e,i,(C*k-M*P)/V),Rn(g,a,c,U))}}class Bi{static parseFrom(e,i){const a=Ui.parse(e);if(!a)return[];let{vertices:c,features:m}=a;const g=1/De(i);m.sort((M,P)=>M.id-P.id),c.sort((M,P)=>M.id-P.id||M.idx-P.idx),c=c.filter((M,P,k)=>P===k.findIndex(V=>V.id===M.id&&V.idx===M.idx));const x=new Array;let S=0;const C=c.length;for(const M of m){if(M.constantHeight){x.push(new Kn(M.id,M.bounds,M.constantHeight));continue}for(;S!==C&&c[S].id<M.id;)S++;if(S===C||c[S].id!==M.id)continue;const P=new Array,k=new Array,V=S;for(;S!==C&&c[S].id===M.id;){const U=c[S];if(P.push({position:U.position,height:U.height,extent:U.extent}),S!==V&&c[S-1].idx===U.idx-1){const q=S-V;k.push({a:q-1,b:q})}S++}x.push(new Kn(M.id,M.bounds,void 0,P,k,g))}return x}static getElevationFeature(e,i){if(!i)return;const a=+e.properties[ii];return Number.isNaN(a)?void 0:i.find(c=>c.id===a)}}class Bn{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*Bt,this.yOffset=(e.y*this.zScale-i.y)*Bt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,a){const c=this.constantElevation(i,a);return c??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),a))}computeBiasedHeight(e,i){return i<=0?e:e+i*ue(0,i,e>=0?e:Math.abs(.5*e))}}li(Kn,"ElevationFeature");class Yr{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Wa,this.indexArray=new lr,this.segments=new oo,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Vu),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,c){}populate(e,i,a,c){const m=this.layers[0],g=[];let x=null;m.type==="circle"&&(x=m.layout.get("circle-sort-key"));for(const{feature:C,id:M,index:P,sourceLayerIndex:k}of e){const V=this.layers[0]._featureFilter.needGeometry,U=et(C,V);if(!this.layers[0]._featureFilter.filter(new Ar(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),U,a))continue;const q=x?x.evaluate(U,{},a):void 0,J={id:M,properties:C.properties,type:C.type,sourceLayerIndex:k,index:P,geometry:V?U.geometry:ct(C,a,c),patterns:{},sortKey:q};g.push(J)}x&&g.sort((C,M)=>C.sortKey-M.sortKey);let S=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new vg,S=c.projection);for(const C of g){const{geometry:M,index:P,sourceLayerIndex:k}=C,V=e[P].feature;this.addFeature(C,M,P,i.availableImages,a,S,i.brightness,i.elevationFeatures),i.featureIndex.insert(V,M,P,k,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,a,c,m,g,x){this.programConfigurations.updatePaintArrays(e,i,m,a,c,g,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,vx.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Sg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,a,c,m,g,x,S){let C;this.elevationMode!=="none"&&(C=Bi.getElevationFeature(e,S));for(const M of i)for(const P of M){const k=P.x,V=P.y;if(k<0||k>=Bt||V<0||V>=Bt)continue;if(g){const J=g.projectTilePoint(k,V,m),ee=g.upVector(m,k,V);this.addGlobeExtVertex(J,ee),this.addGlobeExtVertex(J,ee),this.addGlobeExtVertex(J,ee),this.addGlobeExtVertex(J,ee)}const U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),q=U.vertexLength;if(this.addCircleVertex(k,V,-1,-1),this.addCircleVertex(k,V,1,-1),this.addCircleVertex(k,V,1,1),this.addCircleVertex(k,V,-1,1),this.elevationMode!=="none"){const J=C?C.pointElevation(new Tt(k,V)):0;this.hasElevation=this.hasElevation||J!==0;for(let ee=0;ee<4;ee++)this.elevatedLayoutVertexArray.emplaceBack(J)}this.indexArray.emplaceBack(q,q+1,q+2),this.indexArray.emplaceBack(q,q+2,q+3),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},c,m,x,void 0,this.worldview)}addCircleVertex(e,i,a,c){this.layoutVertexArray.emplaceBack(2*e+(a+1)/2,2*i+(c+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function Eo(n,e){for(let i=0;i<n.length;i++)if(Ca(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Ca(n,e[i]))return!0;return!!Cs(n,e)}function Qr(n,e,i){return!!Ca(n,e)||!!Fa(e,n,i)}function xo(n,e){if(n.length===1)return fs(e,n[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let c=0;c<a.length;c++)if(Ca(n,a[c]))return!0}for(let i=0;i<n.length;i++)if(fs(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Cs(n,e[i]))return!0;return!1}function As(n,e,i){if(n.length>1){if(Cs(n,e))return!0;for(let a=0;a<e.length;a++)if(Fa(e[a],n,i))return!0}for(let a=0;a<n.length;a++)if(Fa(n[a],e,i))return!0;return!1}function Cs(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const a=n[i],c=n[i+1];for(let m=0;m<e.length-1;m++)if(Za(a,c,e[m],e[m+1]))return!0}return!1}function Za(n,e,i,a){return Yi(n,i,a)!==Yi(e,i,a)&&Yi(n,e,i)!==Yi(n,e,a)}function es(n,e,i){return(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x)}function nl(n,e,i,a){const c=es(n,e,a),m=es(n,e,i);if(Math.sign(c)===Math.sign(m))return;const g=es(i,a,n),x=g+m-c;return Math.sign(g)!==Math.sign(x)?[g/(g-x),m/(m-c)]:void 0}function Fa(n,e,i){const a=i*i;if(e.length===1)return n.distSqr(e[0])<a;for(let c=1;c<e.length;c++)if(rl(n,e[c-1],e[c])<a)return!0;return!1}function rl(n,e,i){const a=e.distSqr(i);if(a===0)return n.distSqr(e);const c=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/a;return n.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function fs(n,e){let i,a,c,m=!1;for(let g=0;g<n.length;g++){i=n[g];for(let x=0,S=i.length-1;x<i.length;S=x++)a=i[x],c=i[S],a.y>e.y!=c.y>e.y&&e.x<(c.x-a.x)*(e.y-a.y)/(c.y-a.y)+a.x&&(m=!m)}return m}function Ca(n,e){let i=!1;for(let a=0,c=n.length-1;a<n.length;c=a++){const m=n[a],g=n[c];m.y>e.y!=g.y>e.y&&e.x<(g.x-m.x)*(e.y-m.y)/(g.y-m.y)+m.x&&(i=!i)}return i}function mo(n,e,i,a,c){for(const g of n)if(e<=g.x&&i<=g.y&&a>=g.x&&c>=g.y)return!0;const m=[new Tt(e,i),new Tt(e,c),new Tt(a,c),new Tt(a,i)];if(n.length>2){for(const g of m)if(Ca(n,g))return!0}for(let g=0;g<n.length-1;g++)if(Mo(n[g],n[g+1],m))return!0;return!1}function Mo(n,e,i){const a=i[0],c=i[2];if(n.x<a.x&&e.x<a.x||n.x>c.x&&e.x>c.x||n.y<a.y&&e.y<a.y||n.y>c.y&&e.y>c.y)return!1;const m=Yi(n,e,i[0]);return m!==Yi(n,e,i[1])||m!==Yi(n,e,i[2])||m!==Yi(n,e,i[3])}function Tr(n,e,i,a,c,m){let g=e.y-n.y,x=n.x-e.x;if(m=m||0){const S=g*g+x*x;if(S===0)return!0;const C=Math.sqrt(S);g/=C,x/=C}return!((i.x-n.x)*g+(i.y-n.y)*x-m<0||(a.x-n.x)*g+(a.y-n.y)*x-m<0||(c.x-n.x)*g+(c.y-n.y)*x-m<0)}function Bo(n,e,i,a,c,m,g){return!(Tr(n,e,a,c,m,g)||Tr(e,i,a,c,m,g)||Tr(i,n,a,c,m,g)||Tr(a,c,n,e,i,g)||Tr(c,m,n,e,i,g)||Tr(m,a,n,e,i,g))}function Ia(n,e,i){const a=e.paint.get(n).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(n)}function ao(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function El(n,e,i,a,c){if(!e[0]&&!e[1])return n;const m=Tt.convert(e)._mult(c);i==="viewport"&&m._rotate(-a);const g=[];for(let x=0;x<n.length;x++)g.push(n[x].sub(m));return g}function Sf(n,e,i,a){const c=Tt.convert(n)._mult(a);return e==="viewport"&&c._rotate(-i),c}let Zc,Xc;function Yc(n,e,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[n*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}li(Yr,"CircleBucket",{omit:["layers"]});class Al{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=Is(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const a=function(m,g,x){var S=Yc(256*m,256*(g=Math.pow(2,x)-g-1),x),C=Yc(256*(m+1),256*(g+1),x);return S[0]+","+S[1]+","+C[0]+","+C[1]}(this.x,this.y,this.z),c=function(m,g,x){let S,C="";for(let M=m;M>0;M--)S=1<<M-1,C+=(g&S?1:0)+(x&S?2:0);return C}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Kc{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Is(e,i.z,i.z,i.x,i.y)}}class va{constructor(e,i,a,c,m){this.overscaledZ=e,this.wrap=i,this.canonical=new Al(a,+c,+m),this.key=i===0&&e===a?this.canonical.key:Is(i,e,a,c,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new va(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new va(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Is(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Is(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new va(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,c=2*this.canonical.y;return[new va(i,this.wrap,i,a,c),new va(i,this.wrap,i,a+1,c),new va(i,this.wrap,i,a,c+1),new va(i,this.wrap,i,a+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new va(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new va(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Kc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Is(n,e,i,a,c){const m=1<<Math.min(i,22);let g=m*(c%m)+a%m;return n&&i<22&&(g+=m*m*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*g+i)+(e-i)}const Ad=[n=>{let e=n.canonical.x-1,i=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,i--),new va(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,i=n.wrap;return e===1<<n.canonical.z&&(e=0,i++),new va(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>new va(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new va(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];li(Al,"CanonicalTileID"),li(va,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const yy=gn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Cg}=yy,NT=gn([{name:"a_pos_3",components:3,type:"Int16"}]);var Xb=gn([{name:"a_pos",type:"Int16",components:2}]);function Sx(n){return n*Bs/F}const QA=[new dn([b,b,b],[T,T,T]),new dn([b,b,b],[0,0,T]),new dn([0,b,b],[T,0,T]),new dn([b,0,b],[0,T,T]),new dn([0,0,b],[T,T,T])];function BT(n,e,i,a=!0){const c=pn([],n._camera.position,n.worldSize),m=[e,i,1,1];Uo(m,m,n.pixelMatrixInverse),Oo(m,m,1/m[3]);const g=mn([],Fr([],m,c)),x=n.globeMatrix,S=[x[12],x[13],x[14]],C=Fr([],S,c),M=Qt(C),P=mn([],C),k=n.worldSize/(2*Math.PI),V=Ei(P,g),U=Math.asin(k/M);if(U<Math.acos(V)){if(!a)return null;const ot=[],Ze=[];pn(ot,g,M/V),mn(Ze,Fr(Ze,ot,C)),mn(g,fi(g,C,pn(g,Ze,Math.tan(U)*M)))}const q=[];new tn(c,g).closestPointOnSphere(S,k,q);const J=mn([],to(x,0)),ee=mn([],to(x,1)),oe=mn([],to(x,2)),le=Ei(J,q),fe=Ei(ee,q),Ie=Ei(oe,q),Se=Ko(Math.asin(-fe/k));let Pe=Ko(Math.atan2(le,Ie));Pe=n.center.lng+function(ot,Ze){const st=(Ze-ot+180)%360-180;return st<-180?st+360:st}(n.center.lng,Pe);const ke=ne(Pe),Be=Y(te(Se),0,1);return new He(ke,Be)}class eC{constructor(e,i,a){this.a=Fr([],e,a),this.b=Fr([],i,a),this.center=a;const c=mn([],this.a),m=mn([],this.b);this.angle=Math.acos(Ei(c,m))}}function Yb(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(a,c,m,g){const x=Math.sin(m);return a*(Math.sin((1-g)*m)/x)+c*(Math.sin(g*m)/x)}(n.a[e],n.b[e],n.angle,Y(i,0,1))+n.center[e]}function Fh(n){if(n.z<=1)return QA[n.z+2*n.y+n.x];const e=Cl(Ex(n));return dn.fromPoints(e)}function Cd(n,e,i){return pn(n,n,1-i),pr(n,n,e,i)}function VT(n,e,i){for(const a of n)on(a,a,e),pn(a,a,i)}function UT(n,e,i,a){const c=e/n.worldSize,m=n.globeMatrix;if(i.z<=1){const Be=Fh(i).getCorners();return VT(Be,m,c),dn.fromPoints(Be)}const g=Ex(i,a),x=Cl(g,Bs+Sx(n._tileCoverLift));VT(x,m,c);const S=Number.MAX_VALUE,C=[-S,-S,-S],M=[S,S,S];if(g.contains(n.center)){for(const Ze of x)er(M,M,Ze),Mn(C,C,Ze);C[2]=0;const Be=n.point,ot=[Be.x*c,Be.y*c,0];return er(M,M,ot),Mn(C,C,ot),new dn(M,C)}if(n._tileCoverLift>0){for(const Be of x)er(M,M,Be),Mn(C,C,Be);return new dn(M,C)}const P=[m[12]*c,m[13]*c,m[14]*c],k=g.getCenter(),V=Y(n.center.lat,-_e,_e),U=Y(k.lat,-_e,_e),q=ne(n.center.lng),J=te(V);let ee=q-ne(k.lng);const oe=J-te(U);ee>.5?ee-=1:ee<-.5&&(ee+=1);let le=0;Math.abs(ee)>Math.abs(oe)?le=ee>=0?1:3:(le=oe>=0?0:2,pr(P,P,[m[4]*c,m[5]*c,m[6]*c],-Math.sin(hn(oe>=0?g.getSouth():g.getNorth()))*Bs));const fe=x[le],Ie=x[(le+1)%4],Se=new eC(fe,Ie,P),Pe=[Yb(Se,0)||fe[0],Yb(Se,1)||fe[1],Yb(Se,2)||fe[2]],ke=Rd(n.zoom);if(ke>0){const Be=function({x:Ze,y:st,z:dt},wt,Rt,Mt,yt){const Dt=1/(1<<dt);let nt=Ze*Dt,tt=nt+Dt,St=st*Dt,It=St+Dt,bt=0;const vt=(nt+tt)/2-Mt;return vt>.5?bt=-1:vt<-.5&&(bt=1),nt=((nt+bt)*wt-(Mt*=wt))*Rt+Mt,tt=((tt+bt)*wt-Mt)*Rt+Mt,St=(St*wt-(yt*=wt))*Rt+yt,It=(It*wt-yt)*Rt+yt,[[nt,It,0],[tt,It,0],[tt,St,0],[nt,St,0]]}(i,e,n._pixelsPerMercatorPixel,q,J);for(let Ze=0;Ze<x.length;Ze++)Cd(x[Ze],Be[Ze],ke);const ot=fi([],Be[le],Be[(le+1)%4]);pn(ot,ot,.5),Cd(Pe,ot,ke)}for(const Be of x)er(M,M,Be),Mn(C,C,Be);return M[2]=Math.min(fe[2],Ie[2]),er(M,M,Pe),Mn(C,C,Pe),new dn(M,C)}function Ex({x:n,y:e,z:i},a=!1){const c=1/(1<<i),m=new j(me(n*c),e===(1<<i)-1&&a?-90:ce((e+1)*c)),g=new j(me((n+1)*c),e===0&&a?90:ce(e*c));return new B(m,g)}function Cl(n,e=Bs){const i=hn(n.getNorth()),a=hn(n.getSouth()),c=Math.cos(i),m=Math.cos(a),g=Math.sin(i),x=Math.sin(a),S=n.getWest(),C=n.getEast();return[I(m,x,S,e),I(m,x,C,e),I(c,g,C,e),I(c,g,S,e)]}function Id(n,e,i,a){const c=1<<i.z,m=(n/Bt+i.x)/c;return D(ce((e/Bt+i.y)/c),me(m),a)}function vy({min:n,max:e}){return o/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const jT=new Float64Array(16);function xy(n){const e=vy(n),i=Vt(jT,[e,e,e]);return Ke(i,i,Wr([],n.min))}function Kb(n){const e=(a=n.min,(i=jT)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=a[0],i[13]=a[1],i[14]=a[2],i[15]=1,i);var i,a;const c=1/vy(n);return Ge(e,e,[c,c,c])}function Jb(n){const e=Bt/(2*Math.PI);return n/(2*Math.PI)/e}function GT(n,e){return Bt/(512*Math.pow(2,n))*vy(Fh(e))}function Qb(n,e,i,a,c){const m=Jb(i),g=[n,e,-i/(2*Math.PI)],x=xe(new Float64Array(16));return Ke(x,x,g),Ge(x,x,[m,m,m]),Ye(x,x,hn(-c)),mt(x,x,hn(-a)),x}function Rd(n){return ue(f,t,n)}function HT(n,e){const i=D(e.lat,e.lng),a=function(U){const q=D(U._center.lat,U._center.lng);let J=Xi([],_t(0,1,0),q);const ee=ui([],-U.angle,q);J=on(J,J,ee),ui(ee,-U._pitch,J);const oe=mn([],q);return pn(oe,oe,Sx(U.cameraToCenterDistance/U.pixelsPerMeter)),on(oe,oe,ee),fi([],q,oe)}(n);return g=(c=rn([],a,i))[0],x=c[1],S=c[2],C=(m=i)[0],M=m[1],P=m[2],V=(k=Math.sqrt((g*g+x*x+S*S)*(C*C+M*M+P*P)))&&Ei(c,m)/k,Math.acos(Math.min(Math.max(V,-1),1));var c,m,g,x,S,C,M,P,k,V}function e1(n,e){return HT(n,e)>Math.PI/2*1.01}const t1=hn(85),i1=Math.cos(t1),tC=Math.sin(t1),iC=de(),$T=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function WT(n,e,i,a,c,m,g,x,S){if(m&&n.queryGeometry.isAboveHorizon)return!1;m&&(S*=n.pixelToTileUnitsFactor);const C=n.tileID.canonical,M=i.projection.upVectorScale(C,i.center.lat,i.worldSize).metersToTile;for(const P of e)for(const k of P){const V=k.add(x),U=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(V.x,V.y,!0):0,q=i.projection.projectTilePoint(V.x,V.y,C);if(U>0){const le=i.projection.upVector(C,V.x,V.y);q.x+=le[0]*M*U,q.y+=le[1]*M*U,q.z+=le[2]*M*U}const J=m?V:nC(q.x,q.y,q.z,a),ee=m?n.tilespaceRays.map(le=>n1(le,U)):n.queryGeometry.screenGeometry,oe=Uo([],[q.x,q.y,q.z,1],a);if(!g&&m?S*=oe[3]/i.cameraToCenterDistance:g&&!m&&(S*=i.cameraToCenterDistance/oe[3]),m){const le=ce((k.y/Bt+C.y)/(1<<C.z));S/=i.projection.pixelsPerMeter(le,1)/se(1,le)}if(Qr(ee,J,S))return!0}return!1}function nC(n,e,i,a){const c=Uo([],[n,e,i,1],a);return new Tt(c[0]/c[3],c[1]/c[3])}const qT=_t(0,0,0),Ig=_t(0,0,1);function n1(n,e){const i=Nt();return qT[2]=e,n.intersectsPlane(qT,Ig,i),new Tt(i[0],i[1])}class Rg extends Yr{}let Ax,ZT,XT,r1;function YT(n,{width:e,height:i},a,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*a)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*i*a);return n.width=e,n.height=i,n.data=c,n}function by(n,e,i){const{width:a,height:c}=e;a===n.width&&c===n.height||(Ef(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,a),height:Math.min(n.height,c)},i,null),n.width=a,n.height=c,n.data=e.data)}function Ef(n,e,i,a,c,m,g,x){if(c.width===0||c.height===0)return e;if(c.width>n.width||c.height>n.height||i.x>n.width-c.width||i.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||a.x>e.width-c.width||a.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const S=n.data,C=e.data,M=m===4&&x;for(let P=0;P<c.height;P++){const k=((i.y+P)*n.width+i.x)*m,V=((a.y+P)*e.width+a.x)*m;if(M)for(let U=0;U<c.width;U++){const q=k+U*m+3,J=V+U*m;C[J+0]=255,C[J+1]=255,C[J+2]=255,C[J+3]=S[q]}else if(g)for(let U=0;U<c.width;U++){const q=k+U*m,J=V+U*m,ee=new Qi(S[q+0]/255,S[q+1]/255,S[q+2]/255,S[q+3]).toNonPremultipliedRenderColor(g).toArray();C[J+0]=ee[0],C[J+1]=ee[1],C[J+2]=ee[2],C[J+3]=ee[3]}else for(let U=0;U<c.width*m;U++)C[V+U]=S[k+U]}return e}li(Rg,"HeatmapBucket",{omit:["layers"]});class Lh{constructor(e,i){YT(this,e,1,i)}resize(e){by(this,new Lh(e),1)}clone(){return new Lh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,c,m){Ef(e,i,a,c,m,1,null)}}class Xa{constructor(e,i){YT(this,e,4,i)}resize(e){by(this,new Xa(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Xa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,c,m,g,x){Ef(e,i,a,c,m,4,g,x)}}class wy{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Dg(n){const e={},i=n.resolution||256,a=n.clips?n.clips.length:1,c=n.image||new Xa({width:i,height:a}),m=(g,x,S)=>{e[n.evaluationKey]=S;const C=n.expression.evaluate(e),M=C?C.toNonPremultipliedRenderColor(null):null;M&&(c.data[g+x+0]=Math.floor(255*M.r),c.data[g+x+1]=Math.floor(255*M.g),c.data[g+x+2]=Math.floor(255*M.b),c.data[g+x+3]=Math.floor(255*M.a))};if(n.clips)for(let g=0,x=0;g<a;++g,x+=4*i)for(let S=0,C=0;S<i;S++,C+=4){const M=S/(i-1),{start:P,end:k}=n.clips[g];m(x,C,P*(1-M)+k*M)}else for(let g=0,x=0;g<i;g++,x+=4)m(0,x,g/(i-1));return c}li(Lh,"AlphaImage"),li(Xa,"RGBAImage");const KT=gn([{name:"a_pos",components:2,type:"Int16"}],4),JT=gn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),QT=gn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),eS=gn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Zp(n,e,i=2){const a=e&&e.length,c=a?e[0]*i:n.length;let m=Dd(n,0,c,i,!0);const g=[];if(!m||m.next===m.prev)return g;let x,S,C;if(a&&(m=function(M,P,k,V){const U=[];for(let q=0,J=P.length;q<J;q++){const ee=Dd(M,P[q]*V,q<J-1?P[q+1]*V:M.length,V,!1);ee===ee.next&&(ee.steiner=!0),U.push(a1(ee))}U.sort(oC);for(let q=0;q<U.length;q++)k=iS(U[q],k);return k}(n,e,m,i)),n.length>80*i){x=n[0],S=n[1];let M=x,P=S;for(let k=i;k<c;k+=i){const V=n[k],U=n[k+1];V<x&&(x=V),U<S&&(S=U),V>M&&(M=V),U>P&&(P=U)}C=Math.max(M-x,P-S),C=C!==0?32767/C:0}return Ty(m,g,i,x,S,C,0),g}function Dd(n,e,i,a,c){let m;if(c===function(g,x,S,C){let M=0;for(let P=x,k=S-C;P<S;P+=C)M+=(g[k]-g[P])*(g[P+1]+g[k+1]),k=P;return M}(n,e,i,a)>0)for(let g=e;g<i;g+=a)m=s1(g/a|0,n[g],n[g+1],m);else for(let g=i-a;g>=e;g-=a)m=s1(g/a|0,n[g],n[g+1],m);return m&&Af(m,m.next)&&(Ay(m),m=m.next),m}function Xp(n,e){if(!n)return n;e||(e=n);let i,a=n;do if(i=!1,a.steiner||!Af(a,a.next)&&xa(a.prev,a,a.next)!==0)a=a.next;else{if(Ay(a),a=e=a.prev,a===a.next)break;i=!0}while(i||a!==e);return e}function Ty(n,e,i,a,c,m,g){if(!n)return;!g&&m&&function(S,C,M,P){let k=S;do k.z===0&&(k.z=Qo(k.x,k.y,C,M,P)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==S);k.prevZ.nextZ=null,k.prevZ=null,function(V){let U,q=1;do{let J,ee=V;V=null;let oe=null;for(U=0;ee;){U++;let le=ee,fe=0;for(let Se=0;Se<q&&(fe++,le=le.nextZ,le);Se++);let Ie=q;for(;fe>0||Ie>0&&le;)fe!==0&&(Ie===0||!le||ee.z<=le.z)?(J=ee,ee=ee.nextZ,fe--):(J=le,le=le.nextZ,Ie--),oe?oe.nextZ=J:V=J,J.prevZ=oe,oe=J;ee=le}oe.nextZ=null,q*=2}while(U>1)}(k)}(n,a,c,m);let x=n;for(;n.prev!==n.next;){const S=n.prev,C=n.next;if(m?Sy(n,a,c,m):rC(n))e.push(S.i,n.i,C.i),Ay(n),n=C.next,x=C.next;else if((n=C)===x){g?g===1?Ty(n=o1(Xp(n),e),e,i,a,c,m,2):g===2&&tS(n,e,i,a,c,m):Ty(Xp(n),e,i,a,c,m,1);break}}}function rC(n){const e=n.prev,i=n,a=n.next;if(xa(e,i,a)>=0)return!1;const c=e.x,m=i.x,g=a.x,x=e.y,S=i.y,C=a.y,M=Math.min(c,m,g),P=Math.min(x,S,C),k=Math.max(c,m,g),V=Math.max(x,S,C);let U=a.next;for(;U!==e;){if(U.x>=M&&U.x<=k&&U.y>=P&&U.y<=V&&Md(c,x,m,S,g,C,U.x,U.y)&&xa(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function Sy(n,e,i,a){const c=n.prev,m=n,g=n.next;if(xa(c,m,g)>=0)return!1;const x=c.x,S=m.x,C=g.x,M=c.y,P=m.y,k=g.y,V=Math.min(x,S,C),U=Math.min(M,P,k),q=Math.max(x,S,C),J=Math.max(M,P,k),ee=Qo(V,U,e,i,a),oe=Qo(q,J,e,i,a);let le=n.prevZ,fe=n.nextZ;for(;le&&le.z>=ee&&fe&&fe.z<=oe;){if(le.x>=V&&le.x<=q&&le.y>=U&&le.y<=J&&le!==c&&le!==g&&Md(x,M,S,P,C,k,le.x,le.y)&&xa(le.prev,le,le.next)>=0||(le=le.prevZ,fe.x>=V&&fe.x<=q&&fe.y>=U&&fe.y<=J&&fe!==c&&fe!==g&&Md(x,M,S,P,C,k,fe.x,fe.y)&&xa(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;le&&le.z>=ee;){if(le.x>=V&&le.x<=q&&le.y>=U&&le.y<=J&&le!==c&&le!==g&&Md(x,M,S,P,C,k,le.x,le.y)&&xa(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;fe&&fe.z<=oe;){if(fe.x>=V&&fe.x<=q&&fe.y>=U&&fe.y<=J&&fe!==c&&fe!==g&&Md(x,M,S,P,C,k,fe.x,fe.y)&&xa(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function o1(n,e){let i=n;do{const a=i.prev,c=i.next.next;!Af(a,c)&&Mg(a,i,i.next,c)&&zh(a,c)&&zh(c,a)&&(e.push(a.i,i.i,c.i),Ay(i),Ay(i.next),i=n=c),i=i.next}while(i!==n);return Xp(i)}function tS(n,e,i,a,c,m){let g=n;do{let x=g.next.next;for(;x!==g.prev;){if(g.i!==x.i&&nS(g,x)){let S=rS(g,x);return g=Xp(g,g.next),S=Xp(S,S.next),Ty(g,e,i,a,c,m,0),void Ty(S,e,i,a,c,m,0)}x=x.next}g=g.next}while(g!==n)}function oC(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function iS(n,e){const i=function(c,m){let g=m;const x=c.x,S=c.y;let C,M=-1/0;if(Af(c,g))return g;do{if(Af(c,g.next))return g.next;if(S<=g.y&&S>=g.next.y&&g.next.y!==g.y){const q=g.x+(S-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(q<=x&&q>M&&(M=q,C=g.x<g.next.x?g:g.next,q===x))return C}g=g.next}while(g!==m);if(!C)return null;const P=C,k=C.x,V=C.y;let U=1/0;g=C;do{if(x>=g.x&&g.x>=k&&x!==g.x&&Ey(S<V?x:M,S,k,V,S<V?M:x,S,g.x,g.y)){const q=Math.abs(S-g.y)/(x-g.x);zh(g,c)&&(q<U||q===U&&(g.x>C.x||g.x===C.x&&aC(C,g)))&&(C=g,U=q)}g=g.next}while(g!==P);return C}(n,e);if(!i)return e;const a=rS(i,n);return Xp(a,a.next),Xp(i,i.next)}function aC(n,e){return xa(n.prev,n,e.prev)<0&&xa(e.next,n,n.next)<0}function Qo(n,e,i,a,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function a1(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function Ey(n,e,i,a,c,m,g,x){return(c-g)*(e-x)>=(n-g)*(m-x)&&(n-g)*(a-x)>=(i-g)*(e-x)&&(i-g)*(m-x)>=(c-g)*(a-x)}function Md(n,e,i,a,c,m,g,x){return!(n===g&&e===x)&&Ey(n,e,i,a,c,m,g,x)}function nS(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,a){let c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==a.i&&c.next.i!==a.i&&Mg(c,c.next,i,a))return!0;c=c.next}while(c!==i);return!1}(n,e)&&(zh(n,e)&&zh(e,n)&&function(i,a){let c=i,m=!1;const g=(i.x+a.x)/2,x=(i.y+a.y)/2;do c.y>x!=c.next.y>x&&c.next.y!==c.y&&g<(c.next.x-c.x)*(x-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==i);return m}(n,e)&&(xa(n.prev,n,e.prev)||xa(n,e.prev,e))||Af(n,e)&&xa(n.prev,n,n.next)>0&&xa(e.prev,e,e.next)>0)}function xa(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Af(n,e){return n.x===e.x&&n.y===e.y}function Mg(n,e,i,a){const c=Yp(xa(n,e,i)),m=Yp(xa(n,e,a)),g=Yp(xa(i,a,n)),x=Yp(xa(i,a,e));return c!==m&&g!==x||!(c!==0||!Cx(n,i,e))||!(m!==0||!Cx(n,a,e))||!(g!==0||!Cx(i,n,a))||!(x!==0||!Cx(i,e,a))}function Cx(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Yp(n){return n>0?1:n<0?-1:0}function zh(n,e){return xa(n.prev,n,n.next)<0?xa(n,e,n.next)>=0&&xa(n,n.prev,e)>=0:xa(n,e,n.prev)<0||xa(n,n.next,e)<0}function rS(n,e){const i=l1(n.i,n.x,n.y),a=l1(e.i,e.x,e.y),c=n.next,m=e.prev;return n.next=e,e.prev=n,i.next=c,c.prev=i,a.next=i,i.prev=a,m.next=a,a.prev=m,a}function s1(n,e,i,a){const c=l1(n,e,i);return a?(c.next=a.next,c.prev=a,a.next.prev=c,a.next=c):(c.prev=c,c.next=c),c}function Ay(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function l1(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Rs(n,e){const i=n.length;if(i<=1)return[n];const a=[];let c,m;for(let g=0;g<i;g++){const x=un(n[g]);x!==0&&(n[g].area=Math.abs(x),m===void 0&&(m=x<0),m===x<0?(c&&a.push(c),c=[n[g]]):c.push(n[g]))}if(c&&a.push(c),e>1)for(let g=0;g<a.length;g++)a[g].length<=e||(Au(a[g],e,1,a[g].length-1,Cy),a[g]=a[g].slice(0,e));return a}function Cy(n,e){return e.area-n.area}function Iy(n,e,i=1){if(!n)return null;const a=typeof n=="string"?sa.from(n).getPrimary():n.getPrimary(),c=typeof n=="string"?null:n.getSecondary();for(const m of[a,c]){if(!m)continue;const g=m.id.toString();e.has(g)||e.set(g,[]),m.scaleSelf(i),e.get(g).push(m)}return{primary:a.toString(),secondary:c?c.toString():null}}function Nh(n,e,i,a){const c=a.patternDependencies;let m=!1;for(const g of e){const x=g.paint.get(`${n}-pattern`);x.isConstant()||(m=!0),Iy(x.constantOr(null),c,i)&&(m=!0)}return m}function Ix(n,e,i,a,c,m){const g=m.patternDependencies;for(const x of e){const S=x.paint.get(`${n}-pattern`).value;if(S.kind!=="constant"){let C=S.evaluate({zoom:a},i,{},m.availableImages);C=C&&C.name?C.name:C;const M=Iy(C,g,c);if(!M)continue;const{primary:P,secondary:k}=M;P&&(i.patterns[x.id]=[P,k].filter(Boolean))}}return i}class Cf{constructor(){this.polygons=new Map}add(e,...i){const a=this.polygons.get(e);a?a.push(...i):this.polygons.set(e,i)}merge(e){for(const[i,a]of e.polygons)this.add(i,...a)}}class Il{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=Bt&&i>=Bt}static evaluate(e){if(e.length===0)return new Il;let i=[];for(const S of e)i.push(...S.portals);if(i.length===0)return new Il;for(const S of i){const C=S.va,M=S.vb;(Il.isOnBorder(C.x,M.x)||Il.isOnBorder(C.y,M.y))&&(S.type="border")}const a=i.filter(S=>S.type!=="unevaluated"),c=i.filter(S=>S.type==="unevaluated");if(c.length===0)return new Il;c.sort((S,C)=>S.hash===C.hash?S.isTunnel===C.isTunnel?0:S.isTunnel?-1:1:S.hash<C.hash?1:-1),i=a.concat(c);let m=a.length,g=m,x=m;do if(g++,g===i.length||i[m].hash!==i[g].hash){if(g-m==2){x<m&&(i[x]=i[m],i[m]=null);const S=i[x],C=i[g-1];S.type=S.isTunnel!==C.isTunnel?"tunnel":"polygon",S.connection={a:S.connection.a,b:C.connection.a},x++}m=g}while(m!==i.length);return i.splice(x),i.sort((S,C)=>S.hash<C.hash?1:-1),{portals:i}}}li(Il,"ElevationPortalGraph"),li(Cf,"ElevationPolygons");class Rx{constructor(e,i,a){this.outPositions=e,this.outNormals=i,this.outIndices=a,this.vertexLookup=new Map}addVertex(e,i,a){let c=e[2];a!=null&&(c*=a);const m=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,g=this.vertexLookup.get(m);if(g!=null)return g;const x=this.outPositions.length;this.vertexLookup.set(m,x);const S=Math.trunc(16384*i[0]),C=Math.trunc(16384*i[1]),M=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],c),this.outNormals.emplaceBack(S,C,M),x}addTriangle(e,i,a){this.outIndices.emplaceBack(e,i,a)}addTriangles(e,i,a){if(e.length===0)return;const c=a.length===1,m=Nt(),g=Nt();for(let x=0;x<e.length;x+=3){const S=i[e[x+0]],C=i[e[x+1]],M=i[e[x+2]],P=c?a[0]:a[e[x+1]],k=c?a[0]:a[e[x+2]];Et(m,S.x,S.y,c?a[0]:a[e[x+0]]);const V=this.addVertex(m,g);Et(m,C.x,C.y,P);const U=this.addVertex(m,g);Et(m,M.x,M.y,k);const q=this.addVertex(m,g);this.outIndices.emplaceBack(V,U,q)}}addQuad(e,i,a,c,m,g){const x=this.addVertex(e,m,g),S=this.addVertex(i,m,g),C=this.addVertex(a,m,g),M=this.addVertex(c,m,g);this.addTriangle(x,S,C),this.addTriangle(C,M,x)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Vs{constructor(e,i,a,c){this.unevaluatedPortals=new Il,this.portalPolygons=new Cf,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new sy,this.vertexNormals=new ly,this.indexArray=new lr,this.tileToMeters=De(e),this.bridgeProgramConfigurations=new Ns(i,{zoom:a,lut:c},m=>m!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Ns(i,{zoom:a,lut:c},m=>m!=="fill-bridge-guard-rail-color")}addVertices(e,i){const a=this.unevalVertices.length;for(let c=0;c<e.length;c++)this.unevalVertices.push(e[c]),this.unevalHeights.push(i[c]);return a}addTriangles(e,i,a){const c=a?this.unevalTunnelTriangles:this.unevalTriangles;for(const m of e)c.push(m+i)}addRenderableRing(e,i,a,c,m,g){const x=[new Tt(m.min.x,m.min.y),new Tt(m.max.x,m.min.y),new Tt(m.max.x,m.max.y),new Tt(m.min.x,m.max.y)];for(let S=0;S<a-1;S++){const C=i+S,M=C+1,P=this.unevalVertices[C],k=this.unevalVertices[M];if(!(P.x>=m.min.x&&P.x<=m.max.x&&P.y>=m.min.y&&P.y<=m.max.y||k.x>=m.min.x&&k.x<=m.max.x&&k.y>=m.min.y&&k.y<=m.max.y||Mo(P,k,x))||this.isOnBorder(P.x,k.x)||this.isOnBorder(P.y,k.y))continue;const V=Vs.computeEdgeHash(this.unevalVertices[C],this.unevalVertices[M]);let U,q=this.vertexHashLookup.get(Vs.computePosHash(P));q!=null?U=q.next:(q=this.vertexHashLookup.get(Vs.computePosHash(k)),U=q!=null?q.prev:V),this.unevalEdges.push({polygonIdx:e,a:C,b:M,hash:V,portalHash:U,isTunnel:c,type:"unevaluated",featureInfo:g})}}addPortalCandidates(e,i,a,c,m){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:m});const g=i[0];this.vertexHashLookup.clear();let x=Vs.computeEdgeHash(g[g.length-2],g[g.length-1]);for(let S=0;S<g.length-1;S++){const C=g[S+0],M=g[S+1],P=yo(M.x-C.x,M.y-C.y),k=bn(P);if(k===0)continue;let V="unevaluated";const U=c.pointElevation(C),q=c.pointElevation(M);Math.abs(U)<.01&&Math.abs(q)<.01?V="entrance":(this.isOnBorder(C.x,M.x)||this.isOnBorder(C.y,M.y))&&(V="border");const J=Vs.computeEdgeHash(C,M);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:C,vb:M,vab:P,length:k,hash:J,isTunnel:a,type:V});const ee=Vs.computePosHash(C);this.vertexHashLookup.set(ee,{prev:x,next:J}),x=J}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),a=k=>{k.primitiveLength=this.indexArray.length-k.primitiveOffset},c=new Rx(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const m=i(),g=i(),x=i(),S=(k,V)=>{k.sort((q,J)=>q.type===V&&J.type!==V?-1:q.type!==V&&J.type===V?1:0);const U=k.findIndex(q=>q.type!==V);return U>=0?U:k.length};let C=0;this.unevalEdges.length>0&&(C=S(this.unevalEdges,"none"),this.constructBridgeStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},this.tileToMeters)),a(x);const M=i(),P=i();if(this.unevalEdges.length>0){const k=this.unevalEdges.splice(C),V=S(k,"tunnel")+C;this.unevalEdges.push(...k),this.constructTunnelStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},{min:C,max:V})}a(M),c.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),a(P),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),a(g),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),a(m),this.maskSegments=oo.simpleSegment(0,P.primitiveOffset,0,P.primitiveLength),this.depthSegments=oo.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableBridgeSegments=oo.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableTunnelSegments=oo.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.shadowCasterSegments=oo.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength)}update(e,i,a,c,m,g,x,S){this.bridgeProgramConfigurations.updatePaintArrays(e,i,m,a,c,g,x,S),this.tunnelProgramConfigurations.updatePaintArrays(e,i,m,a,c,g,x,S)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,QT.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,eS.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,a,c,m){const g=(x,S)=>{for(let C=0;C<S.length-1;C++){const M=S[C].featureIndex,P=S[C+1].vertexStart,k=e.feature(M);x.populatePaintArrays(P,k,M,{},a,i,c,void 0,m)}};g(this.bridgeProgramConfigurations,this.bridgeFeatureSections),g(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,a,c,m){const g=new Map;for(let x=c;x<m;x++){const S=a[x],C=S.a,M=S.b,P=Vs.computePosHash(e[C]),k=Vs.computePosHash(e[M]);let V=g.get(P);V||(V={},g.set(P,V));let U=g.get(k);U||(U={},g.set(k,U)),i[C]<=0&&i[M]<=0||(V.to=M,U.from=C)}return g}isTerminalVertex(e,i){const a=Vs.computePosHash(this.unevalVertices[e]),c=i.get(a);return!c||!c.from||!c.to}constructBridgeStructures(e,i,a,c,m,g){e.clearVertexLookup();const x=this.computeVertexConnections(i,a,c,m.min,m.max),S=1/g,C=.5*S,M=(Rt,Mt)=>Et(Rt,i[Mt].x,i[Mt].y,a[Mt]*S),P=Nt(),k=Nt(),V=Nt(),U=Nt(),q=Nt(),J=(Rt,Mt)=>{const yt=x.get(Vs.computePosHash(i[Mt])),Dt=yt.from,nt=yt.to;if(!Dt||!nt)return;M(P,Dt),M(k,Mt),M(V,nt),tr(U),co(P,k)||(Fr(q,k,P),mn(U,q)),co(V,k)||(Fr(q,V,k),fi(U,U,mn(q,q)));const tt=ma(U);return tt>0?pn(Rt,U,1/tt):void 0};let ee=Number.POSITIVE_INFINITY;this.sortSubarray(c,m.min,m.max,(Rt,Mt)=>Rt.featureInfo.featureIndex-Mt.featureInfo.featureIndex);const oe=Nt(),le=Nt(),fe=Nt(),Ie=Nt(),Se=Nt(),Pe=Nt(),ke=Nt(),Be=Nt(),ot=Nt(),Ze=[Nt(),Nt(),Nt(),Nt()],st=[Nt(),Nt(),Nt(),Nt()],dt=[{coord:new Tt(0,0),height:0},{coord:new Tt(0,0),height:0}],wt=(Rt,Mt)=>Rt>Mt;for(let Rt=m.min;Rt<m.max;Rt++){const Mt=c[Rt];if(!Mt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(dt,i,a,Mt,wt))continue;const[yt,Dt]=dt;if(Et(oe,yt.coord.x,yt.coord.y,S*yt.height),Et(le,Dt.coord.x,Dt.coord.y,S*Dt.height),co(oe,le))continue;Fr(fe,le,oe),mn(fe,fe);const nt=J(Be,Mt.a)||fe,tt=J(ot,Mt.b)||fe;Et(Ie,nt[1],-nt[0],0),mn(Ie,Ie),Et(Se,tt[1],-tt[0],0),mn(Se,Se),Xi(Be,Ie,nt),mn(Pe,Be),Xi(Be,Se,tt),mn(ke,Be),fi(Ze[0],oe,pn(Be,Fr(Be,Ie,Pe),C)),fi(Ze[1],oe,pn(Be,fi(Be,Ie,Pe),C)),fi(Ze[2],oe,pn(Be,Pe,C)),Ze[3]=oe,fi(st[0],le,pn(Be,Fr(Be,Se,ke),C)),fi(st[1],le,pn(Be,fi(Be,Se,ke),C)),fi(st[2],le,pn(Be,ke,C)),st[3]=le,ee=this.addFeatureSection(Mt.featureInfo.featureIndex,ee,this.bridgeFeatureSections,e);const St=e.addVertex(Ze[0],Ie,g),It=e.addVertex(Ze[1],Ie,g),bt=e.addVertex(st[0],Se,g),vt=e.addVertex(st[1],Se,g);e.addTriangle(St,It,bt),e.addTriangle(It,vt,bt);const ci=e.addVertex(Ze[1],Pe,g),Yt=e.addVertex(Ze[2],Pe,g),Wt=e.addVertex(st[1],ke,g),ji=e.addVertex(st[2],ke,g);e.addTriangle(ci,Yt,Wt),e.addTriangle(Yt,ji,Wt),Wr(Ie,Ie),Wr(Se,Se);const Kt=e.addVertex(Ze[2],Ie,g),Ai=e.addVertex(Ze[3],Ie,g),qi=e.addVertex(st[2],Se,g),fn=e.addVertex(st[3],Se,g);e.addTriangle(Kt,Ai,qi),e.addTriangle(Ai,fn,qi);const En=this.isTerminalVertex(Mt.a,x),Zi=this.isTerminalVertex(Mt.b,x);yt.height<.01&&En&&e.addQuad(Ze[3],Ze[2],Ze[1],Ze[0],Wr(nt,nt),g),Dt.height<.01&&Zi&&e.addQuad(st[0],st[1],st[2],st[3],tt,g)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,a,c,m,g){e.clearVertexLookup();let x=Number.POSITIVE_INFINITY;const S=(ee,oe)=>ee.featureInfo.featureIndex-oe.featureInfo.featureIndex;this.sortSubarray(c,m.min,m.max,S),this.sortSubarray(c,g.min,g.max,S);const C=ee=>mn(ee,ee),M=[{coord:new Tt(0,0),height:0},{coord:new Tt(0,0),height:0}],P=(ee,oe)=>ee<oe,k=Nt(),V=Nt(),U=Nt(),q=Nt(),J=Nt();for(let ee=m.min;ee<m.max;ee++){if(!this.prepareEdgePoints(M,i,a,c[ee],P))continue;const[oe,le]=M,fe=C(Et(J,-(le.coord.y-oe.coord.y),le.coord.x-oe.coord.x,0));x=this.addFeatureSection(c[ee].featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(Et(k,oe.coord.x,oe.coord.y,oe.height),Et(V,le.coord.x,le.coord.y,le.height),Et(U,le.coord.x,le.coord.y,c[ee].isTunnel?-.1:0),Et(q,oe.coord.x,oe.coord.y,c[ee].isTunnel?-.1:0),fe)}for(let ee=g.min;ee<g.max;ee++){const oe=c[ee];oe.isTunnel&&([oe.a,oe.b]=[oe.b,oe.a]);const le=i[oe.a],fe=i[oe.b],Ie=C(Et(J,-(fe.y-le.y),fe.x-le.x,0));x=this.addFeatureSection(oe.featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(Et(k,fe.x,fe.y,0),Et(V,le.x,le.y,0),Et(U,le.x,le.y,a[oe.a]+4),Et(q,fe.x,fe.y,a[oe.b]+4),Ie),e.addQuad(Et(k,le.x,le.y,0),Et(V,fe.x,fe.y,0),Et(U,fe.x,fe.y,a[oe.b]+4),Et(q,le.x,le.y,a[oe.a]+4),Ie)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,a,c){e.coord.x=i,e.coord.y=a,e.height=c}prepareEdgePoints(e,i,a,c,m){let g=i[c.a].x,x=i[c.a].y,S=i[c.b].x,C=i[c.b].y,M=a[c.a],P=a[c.b];const k=m(M,0),V=m(P,0);if(k&&V)return this.setElevatedPoint(e[0],g,x,M),this.setElevatedPoint(e[1],S,C,P),!0;if(!k&&!V)return!1;if(k){if(!V){const U=P/(P-M);S=Si(S,g,U),C=Si(C,x,U),P=Si(P,M,U)}}else{const U=M/(M-P);g=Si(g,S,U),x=Si(x,C,U),M=Si(M,P,U)}return this.setElevatedPoint(e[0],g,x,M),this.setElevatedPoint(e[1],S,C,P),!0}prepareEdges(e,i){if(i.length===0)return;i.sort((x,S)=>x.hash===S.hash?S.polygonIdx-x.polygonIdx:S.hash>x.hash?1:-1);let a=0,c=0,m=0,g=i[a].polygonIdx;do c++,(c===i.length||i[a].hash!==i[c].hash)&&((c-a==1||i[c-1].polygonIdx!==g)&&(m<a&&(i[m]=i[a],i[a]=null),i[m].type="none",m++),a=c,a!==i.length&&(g=i[a].polygonIdx));while(a!==i.length);if(i.splice(m),i.length!==0&&e.length!==0){i.sort((C,M)=>C.portalHash<M.portalHash?1:-1);let x=0,S=0;for(;x!==i.length&&S!==e.length;){const C=i[x],M=e[S];C.portalHash>M.hash?x++:M.hash>C.portalHash?S++:(C.type=M.type,x++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=Bt&&i>=Bt}addFeatureSection(e,i,a,c){return e!==i&&(i=e,a.push({featureIndex:e,vertexStart:c.getVertexCount()}),c.clearVertexLookup()),i}sortSubarray(e,i,a,c){const m=e.slice(i,a);m.sort(c),e.splice(i,m.length,...m)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Vs.computePosHash(e))<<32n|BigInt(Vs.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var Ry,Pg={exports:{}},c1=(Ry||(Ry=1,function(n,e){(function(i){function a(Ee,be){return Ee>be?1:Ee<be?-1:0}var c=function(Ee,be){Ee===void 0&&(Ee=a),be===void 0&&(be=!1),this._compare=Ee,this._root=null,this._size=0,this._noDuplicates=!!be},m={size:{configurable:!0}};function g(Ee,be,at,Gt,ut){var qt=ut-Gt;if(qt>0){var wi=Gt+Math.floor(qt/2),vi={key:be[wi],data:at[wi],parent:Ee};return vi.left=g(vi,be,at,Gt,wi),vi.right=g(vi,be,at,wi+1,ut),vi}return null}function x(Ee,be,at,Gt,ut){if(!(at>=Gt)){for(var qt=Ee[at+Gt>>1],wi=at-1,vi=Gt+1;;){do wi++;while(ut(Ee[wi],qt)<0);do vi--;while(ut(Ee[vi],qt)>0);if(wi>=vi)break;var Ki=Ee[wi];Ee[wi]=Ee[vi],Ee[vi]=Ki,Ki=be[wi],be[wi]=be[vi],be[vi]=Ki}x(Ee,be,at,vi,ut),x(Ee,be,vi+1,Gt,ut)}}c.prototype.rotateLeft=function(Ee){var be=Ee.right;be&&(Ee.right=be.left,be.left&&(be.left.parent=Ee),be.parent=Ee.parent),Ee.parent?Ee===Ee.parent.left?Ee.parent.left=be:Ee.parent.right=be:this._root=be,be&&(be.left=Ee),Ee.parent=be},c.prototype.rotateRight=function(Ee){var be=Ee.left;be&&(Ee.left=be.right,be.right&&(be.right.parent=Ee),be.parent=Ee.parent),Ee.parent?Ee===Ee.parent.left?Ee.parent.left=be:Ee.parent.right=be:this._root=be,be&&(be.right=Ee),Ee.parent=be},c.prototype._splay=function(Ee){for(;Ee.parent;){var be=Ee.parent;be.parent?be.left===Ee&&be.parent.left===be?(this.rotateRight(be.parent),this.rotateRight(be)):be.right===Ee&&be.parent.right===be?(this.rotateLeft(be.parent),this.rotateLeft(be)):be.left===Ee&&be.parent.right===be?(this.rotateRight(be),this.rotateLeft(be)):(this.rotateLeft(be),this.rotateRight(be)):be.left===Ee?this.rotateRight(be):this.rotateLeft(be)}},c.prototype.splay=function(Ee){for(var be,at,Gt,ut,qt;Ee.parent;)(at=(be=Ee.parent).parent)&&at.parent?((Gt=at.parent).left===at?Gt.left=Ee:Gt.right=Ee,Ee.parent=Gt):(Ee.parent=null,this._root=Ee),ut=Ee.left,qt=Ee.right,Ee===be.left?(at&&(at.left===be?(be.right?(at.left=be.right,at.left.parent=at):at.left=null,be.right=at,at.parent=be):(ut?(at.right=ut,ut.parent=at):at.right=null,Ee.left=at,at.parent=Ee)),qt?(be.left=qt,qt.parent=be):be.left=null,Ee.right=be,be.parent=Ee):(at&&(at.right===be?(be.left?(at.right=be.left,at.right.parent=at):at.right=null,be.left=at,at.parent=be):(qt?(at.left=qt,qt.parent=at):at.left=null,Ee.right=at,at.parent=Ee)),ut?(be.right=ut,ut.parent=be):be.right=null,Ee.left=be,be.parent=Ee)},c.prototype.replace=function(Ee,be){Ee.parent?Ee===Ee.parent.left?Ee.parent.left=be:Ee.parent.right=be:this._root=be,be&&(be.parent=Ee.parent)},c.prototype.minNode=function(Ee){if(Ee===void 0&&(Ee=this._root),Ee)for(;Ee.left;)Ee=Ee.left;return Ee},c.prototype.maxNode=function(Ee){if(Ee===void 0&&(Ee=this._root),Ee)for(;Ee.right;)Ee=Ee.right;return Ee},c.prototype.insert=function(Ee,be){var at=this._root,Gt=null,ut=this._compare;if(this._noDuplicates)for(;at;){if(Gt=at,ut(at.key,Ee)===0)return;at=ut(at.key,Ee)<0?at.right:at.left}else for(;at;)Gt=at,at=ut(at.key,Ee)<0?at.right:at.left;return at={key:Ee,data:be,left:null,right:null,parent:Gt},Gt?ut(Gt.key,at.key)<0?Gt.right=at:Gt.left=at:this._root=at,this.splay(at),this._size++,at},c.prototype.find=function(Ee){for(var be=this._root,at=this._compare;be;){var Gt=at(be.key,Ee);if(Gt<0)be=be.right;else{if(!(Gt>0))return be;be=be.left}}return null},c.prototype.contains=function(Ee){for(var be=this._root,at=this._compare;be;){var Gt=at(Ee,be.key);if(Gt===0)return!0;be=Gt<0?be.left:be.right}return!1},c.prototype.remove=function(Ee){var be=this.find(Ee);if(!be)return!1;if(this.splay(be),be.left)if(be.right){var at=this.minNode(be.right);at.parent!==be&&(this.replace(at,at.right),at.right=be.right,at.right.parent=at),this.replace(be,at),at.left=be.left,at.left.parent=at}else this.replace(be,be.left);else this.replace(be,be.right);return this._size--,!0},c.prototype.removeNode=function(Ee){if(!Ee)return!1;if(this.splay(Ee),Ee.left)if(Ee.right){var be=this.minNode(Ee.right);be.parent!==Ee&&(this.replace(be,be.right),be.right=Ee.right,be.right.parent=be),this.replace(Ee,be),be.left=Ee.left,be.left.parent=be}else this.replace(Ee,Ee.left);else this.replace(Ee,Ee.right);return this._size--,!0},c.prototype.erase=function(Ee){var be=this.find(Ee);if(be){this.splay(be);var at=be.left,Gt=be.right,ut=null;at&&(at.parent=null,ut=this.maxNode(at),this.splay(ut),this._root=ut),Gt&&(at?ut.right=Gt:this._root=Gt,Gt.parent=ut),this._size--}},c.prototype.pop=function(){var Ee=this._root,be=null;if(Ee){for(;Ee.left;)Ee=Ee.left;be={key:Ee.key,data:Ee.data},this.remove(Ee.key)}return be},c.prototype.next=function(Ee){var be=Ee;if(be)if(be.right)for(be=be.right;be&&be.left;)be=be.left;else for(be=Ee.parent;be&&be.right===Ee;)Ee=be,be=be.parent;return be},c.prototype.prev=function(Ee){var be=Ee;if(be)if(be.left)for(be=be.left;be&&be.right;)be=be.right;else for(be=Ee.parent;be&&be.left===Ee;)Ee=be,be=be.parent;return be},c.prototype.forEach=function(Ee){for(var be=this._root,at=[],Gt=!1,ut=0;!Gt;)be?(at.push(be),be=be.left):at.length>0?(Ee(be=at.pop(),ut++),be=be.right):Gt=!0;return this},c.prototype.range=function(Ee,be,at,Gt){for(var ut=[],qt=this._compare,wi=this._root;ut.length!==0||wi;)if(wi)ut.push(wi),wi=wi.left;else{if(qt((wi=ut.pop()).key,be)>0)break;if(qt(wi.key,Ee)>=0&&at.call(Gt,wi))return this;wi=wi.right}return this},c.prototype.keys=function(){for(var Ee=this._root,be=[],at=[],Gt=!1;!Gt;)Ee?(be.push(Ee),Ee=Ee.left):be.length>0?(Ee=be.pop(),at.push(Ee.key),Ee=Ee.right):Gt=!0;return at},c.prototype.values=function(){for(var Ee=this._root,be=[],at=[],Gt=!1;!Gt;)Ee?(be.push(Ee),Ee=Ee.left):be.length>0?(Ee=be.pop(),at.push(Ee.data),Ee=Ee.right):Gt=!0;return at},c.prototype.at=function(Ee){for(var be=this._root,at=[],Gt=!1,ut=0;!Gt;)if(be)at.push(be),be=be.left;else if(at.length>0){if(be=at.pop(),ut===Ee)return be;ut++,be=be.right}else Gt=!0;return null},c.prototype.load=function(Ee,be,at){if(Ee===void 0&&(Ee=[]),be===void 0&&(be=[]),at===void 0&&(at=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Gt=Ee.length;return at&&x(Ee,be,0,Gt-1,this._compare),this._root=g(null,Ee,be,0,Gt),this._size=Gt,this},c.prototype.min=function(){var Ee=this.minNode(this._root);return Ee?Ee.key:null},c.prototype.max=function(){var Ee=this.maxNode(this._root);return Ee?Ee.key:null},c.prototype.isEmpty=function(){return this._root===null},m.size.get=function(){return this._size},c.createTree=function(Ee,be,at,Gt,ut){return new c(at,ut).load(Ee,be,Gt)},Object.defineProperties(c.prototype,m);var S=0,C=1,M=2,P=3,k=0,V=1,U=2,q=3;function J(Ee,be,at){be===null?(Ee.inOut=!1,Ee.otherInOut=!0):(Ee.isSubject===be.isSubject?(Ee.inOut=!be.inOut,Ee.otherInOut=be.otherInOut):(Ee.inOut=!be.otherInOut,Ee.otherInOut=be.isVertical()?!be.inOut:be.inOut),be&&(Ee.prevInResult=!ee(be,at)||be.isVertical()?be.prevInResult:be));var Gt=ee(Ee,at);Ee.resultTransition=Gt?function(ut,qt){var wi,vi=!ut.inOut,Ki=!ut.otherInOut;switch(qt){case k:wi=vi&&Ki;break;case V:wi=vi||Ki;break;case q:wi=vi^Ki;break;case U:wi=ut.isSubject?vi&&!Ki:Ki&&!vi}return wi?1:-1}(Ee,at):0}function ee(Ee,be){switch(Ee.type){case S:switch(be){case k:return!Ee.otherInOut;case V:return Ee.otherInOut;case U:return Ee.isSubject&&Ee.otherInOut||!Ee.isSubject&&!Ee.otherInOut;case q:return!0}break;case M:return be===k||be===V;case P:return be===U;case C:return!1}return!1}var oe=function(Ee,be,at,Gt,ut){this.left=be,this.point=Ee,this.otherEvent=at,this.isSubject=Gt,this.type=ut||S,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},le={inResult:{configurable:!0}};function fe(Ee,be){return Ee[0]===be[0]&&Ee[1]===be[1]}oe.prototype.isBelow=function(Ee){var be=this.point,at=this.otherEvent.point;return this.left?(be[0]-Ee[0])*(at[1]-Ee[1])-(at[0]-Ee[0])*(be[1]-Ee[1])>0:(at[0]-Ee[0])*(be[1]-Ee[1])-(be[0]-Ee[0])*(at[1]-Ee[1])>0},oe.prototype.isAbove=function(Ee){return!this.isBelow(Ee)},oe.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},le.inResult.get=function(){return this.resultTransition!==0},oe.prototype.clone=function(){var Ee=new oe(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Ee.contourId=this.contourId,Ee.resultTransition=this.resultTransition,Ee.prevInResult=this.prevInResult,Ee.isExteriorRing=this.isExteriorRing,Ee.inOut=this.inOut,Ee.otherInOut=this.otherInOut,Ee},Object.defineProperties(oe.prototype,le);var Ie=11102230246251565e-32,Se=134217729,Pe=(3+8*Ie)*Ie;function ke(Ee,be,at,Gt,ut){var qt,wi,vi,Ki,Li=be[0],gi=Gt[0],Wn=0,xr=0;gi>Li==gi>-Li?(qt=Li,Li=be[++Wn]):(qt=gi,gi=Gt[++xr]);var zi=0;if(Wn<Ee&&xr<at)for(gi>Li==gi>-Li?(vi=qt-((wi=Li+qt)-Li),Li=be[++Wn]):(vi=qt-((wi=gi+qt)-gi),gi=Gt[++xr]),qt=wi,vi!==0&&(ut[zi++]=vi);Wn<Ee&&xr<at;)gi>Li==gi>-Li?(vi=qt-((wi=qt+Li)-(Ki=wi-qt))+(Li-Ki),Li=be[++Wn]):(vi=qt-((wi=qt+gi)-(Ki=wi-qt))+(gi-Ki),gi=Gt[++xr]),qt=wi,vi!==0&&(ut[zi++]=vi);for(;Wn<Ee;)vi=qt-((wi=qt+Li)-(Ki=wi-qt))+(Li-Ki),Li=be[++Wn],qt=wi,vi!==0&&(ut[zi++]=vi);for(;xr<at;)vi=qt-((wi=qt+gi)-(Ki=wi-qt))+(gi-Ki),gi=Gt[++xr],qt=wi,vi!==0&&(ut[zi++]=vi);return qt===0&&zi!==0||(ut[zi++]=qt),zi}function Be(Ee){return new Float64Array(Ee)}var ot=33306690738754716e-32,Ze=22204460492503146e-32,st=11093356479670487e-47,dt=Be(4),wt=Be(8),Rt=Be(12),Mt=Be(16),yt=Be(4);function Dt(Ee,be,at){var Gt=function(ut,qt,wi,vi,Ki,Li){var gi=(qt-Li)*(wi-Ki),Wn=(ut-Ki)*(vi-Li),xr=gi-Wn;if(gi===0||Wn===0||gi>0!=Wn>0)return xr;var zi=Math.abs(gi+Wn);return Math.abs(xr)>=ot*zi?xr:-function(Fn,yr,or,ar,fr,Mr,Un){var qn,en,Qn,Ir,Ni,_n,$r,Pr,Vo,ea,Nr,ta,$s,ia,dl,ts,xc,fl,Dl=Fn-fr,is=or-fr,Ml=yr-Mr,bc=ar-Mr;dt[0]=(dl=(Pr=Dl-($r=(_n=Se*Dl)-(_n-Dl)))*(ea=bc-(Vo=(_n=Se*bc)-(_n-bc)))-((ia=Dl*bc)-$r*Vo-Pr*Vo-$r*ea))-((Nr=dl-(xc=(Pr=Ml-($r=(_n=Se*Ml)-(_n-Ml)))*(ea=is-(Vo=(_n=Se*is)-(_n-is)))-((ts=Ml*is)-$r*Vo-Pr*Vo-$r*ea)))+(Ni=dl-Nr))+(Ni-xc),dt[1]=($s=ia-((ta=ia+Nr)-(Ni=ta-ia))+(Nr-Ni))-((Nr=$s-ts)+(Ni=$s-Nr))+(Ni-ts),dt[2]=ta-((fl=ta+Nr)-(Ni=fl-ta))+(Nr-Ni),dt[3]=fl;var Va=function(Jf,ed){for(var sb=ed[0],td=1;td<4;td++)sb+=ed[td];return sb}(0,dt),Ps=Ze*Un;if(Va>=Ps||-Va>=Ps||(qn=Fn-(Dl+(Ni=Fn-Dl))+(Ni-fr),Qn=or-(is+(Ni=or-is))+(Ni-fr),en=yr-(Ml+(Ni=yr-Ml))+(Ni-Mr),Ir=ar-(bc+(Ni=ar-bc))+(Ni-Mr),qn===0&&en===0&&Qn===0&&Ir===0)||(Ps=st*Un+Pe*Math.abs(Va),(Va+=Dl*Ir+bc*qn-(Ml*Qn+is*en))>=Ps||-Va>=Ps))return Va;yt[0]=(dl=(Pr=qn-($r=(_n=Se*qn)-(_n-qn)))*(ea=bc-(Vo=(_n=Se*bc)-(_n-bc)))-((ia=qn*bc)-$r*Vo-Pr*Vo-$r*ea))-((Nr=dl-(xc=(Pr=en-($r=(_n=Se*en)-(_n-en)))*(ea=is-(Vo=(_n=Se*is)-(_n-is)))-((ts=en*is)-$r*Vo-Pr*Vo-$r*ea)))+(Ni=dl-Nr))+(Ni-xc),yt[1]=($s=ia-((ta=ia+Nr)-(Ni=ta-ia))+(Nr-Ni))-((Nr=$s-ts)+(Ni=$s-Nr))+(Ni-ts),yt[2]=ta-((fl=ta+Nr)-(Ni=fl-ta))+(Nr-Ni),yt[3]=fl;var Qh=ke(4,dt,4,yt,wt);yt[0]=(dl=(Pr=Dl-($r=(_n=Se*Dl)-(_n-Dl)))*(ea=Ir-(Vo=(_n=Se*Ir)-(_n-Ir)))-((ia=Dl*Ir)-$r*Vo-Pr*Vo-$r*ea))-((Nr=dl-(xc=(Pr=Ml-($r=(_n=Se*Ml)-(_n-Ml)))*(ea=Qn-(Vo=(_n=Se*Qn)-(_n-Qn)))-((ts=Ml*Qn)-$r*Vo-Pr*Vo-$r*ea)))+(Ni=dl-Nr))+(Ni-xc),yt[1]=($s=ia-((ta=ia+Nr)-(Ni=ta-ia))+(Nr-Ni))-((Nr=$s-ts)+(Ni=$s-Nr))+(Ni-ts),yt[2]=ta-((fl=ta+Nr)-(Ni=fl-ta))+(Nr-Ni),yt[3]=fl;var Kf=ke(Qh,wt,4,yt,Rt);yt[0]=(dl=(Pr=qn-($r=(_n=Se*qn)-(_n-qn)))*(ea=Ir-(Vo=(_n=Se*Ir)-(_n-Ir)))-((ia=qn*Ir)-$r*Vo-Pr*Vo-$r*ea))-((Nr=dl-(xc=(Pr=en-($r=(_n=Se*en)-(_n-en)))*(ea=Qn-(Vo=(_n=Se*Qn)-(_n-Qn)))-((ts=en*Qn)-$r*Vo-Pr*Vo-$r*ea)))+(Ni=dl-Nr))+(Ni-xc),yt[1]=($s=ia-((ta=ia+Nr)-(Ni=ta-ia))+(Nr-Ni))-((Nr=$s-ts)+(Ni=$s-Nr))+(Ni-ts),yt[2]=ta-((fl=ta+Nr)-(Ni=fl-ta))+(Nr-Ni),yt[3]=fl;var b_=ke(Kf,Rt,4,yt,Mt);return Mt[b_-1]}(ut,qt,wi,vi,Ki,Li,zi)}(Ee[0],Ee[1],be[0],be[1],at[0],at[1]);return Gt>0?-1:Gt<0?1:0}function nt(Ee,be){var at=Ee.point,Gt=be.point;return at[0]>Gt[0]?1:at[0]<Gt[0]?-1:at[1]!==Gt[1]?at[1]>Gt[1]?1:-1:function(ut,qt,wi,vi){return ut.left!==qt.left?ut.left?1:-1:Dt(wi,ut.otherEvent.point,qt.otherEvent.point)!==0?ut.isBelow(qt.otherEvent.point)?-1:1:!ut.isSubject&&qt.isSubject?1:-1}(Ee,be,at)}function tt(Ee,be,at){var Gt=new oe(be,!1,Ee,Ee.isSubject),ut=new oe(be,!0,Ee.otherEvent,Ee.isSubject);return fe(Ee.point,Ee.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Ee),Gt.contourId=ut.contourId=Ee.contourId,nt(ut,Ee.otherEvent)>0&&(Ee.otherEvent.left=!0,ut.left=!1),Ee.otherEvent.otherEvent=ut,Ee.otherEvent=Gt,at.push(ut),at.push(Gt),at}function St(Ee,be){return Ee[0]*be[1]-Ee[1]*be[0]}function It(Ee,be){return Ee[0]*be[0]+Ee[1]*be[1]}function bt(Ee,be,at){var Gt=function(Ki,Li,gi,Wn,xr){var zi=[Li[0]-Ki[0],Li[1]-Ki[1]],Fn=[Wn[0]-gi[0],Wn[1]-gi[1]];function yr(_n,$r,Pr){return[_n[0]+$r*Pr[0],_n[1]+$r*Pr[1]]}var or=[gi[0]-Ki[0],gi[1]-Ki[1]],ar=St(zi,Fn),fr=ar*ar,Mr=It(zi,zi);if(fr>0){var Un=St(or,Fn)/ar;if(Un<0||Un>1)return null;var qn=St(or,zi)/ar;return qn<0||qn>1?null:Un===0||Un===1?[yr(Ki,Un,zi)]:qn===0||qn===1?[yr(gi,qn,Fn)]:[yr(Ki,Un,zi)]}if((fr=(ar=St(or,zi))*ar)>0)return null;var en=It(zi,or)/Mr,Qn=en+It(zi,Fn)/Mr,Ir=Math.min(en,Qn),Ni=Math.max(en,Qn);return Ir<=1&&Ni>=0?Ir===1?[yr(Ki,Ir>0?Ir:0,zi)]:Ni===0?[yr(Ki,Ni<1?Ni:1,zi)]:[yr(Ki,Ir>0?Ir:0,zi),yr(Ki,Ni<1?Ni:1,zi)]:null}(Ee.point,Ee.otherEvent.point,be.point,be.otherEvent.point),ut=Gt?Gt.length:0;if(ut===0||ut===1&&(fe(Ee.point,be.point)||fe(Ee.otherEvent.point,be.otherEvent.point))||ut===2&&Ee.isSubject===be.isSubject)return 0;if(ut===1)return fe(Ee.point,Gt[0])||fe(Ee.otherEvent.point,Gt[0])||tt(Ee,Gt[0],at),fe(be.point,Gt[0])||fe(be.otherEvent.point,Gt[0])||tt(be,Gt[0],at),1;var qt=[],wi=!1,vi=!1;return fe(Ee.point,be.point)?wi=!0:nt(Ee,be)===1?qt.push(be,Ee):qt.push(Ee,be),fe(Ee.otherEvent.point,be.otherEvent.point)?vi=!0:nt(Ee.otherEvent,be.otherEvent)===1?qt.push(be.otherEvent,Ee.otherEvent):qt.push(Ee.otherEvent,be.otherEvent),wi&&vi||wi?(be.type=C,Ee.type=be.inOut===Ee.inOut?M:P,wi&&!vi&&tt(qt[1].otherEvent,qt[0].point,at),2):vi?(tt(qt[0],qt[1].point,at),3):qt[0]!==qt[3].otherEvent?(tt(qt[0],qt[1].point,at),tt(qt[1],qt[2].point,at),3):(tt(qt[0],qt[1].point,at),tt(qt[3].otherEvent,qt[2].point,at),3)}function vt(Ee,be){if(Ee===be)return 0;if(Dt(Ee.point,Ee.otherEvent.point,be.point)!==0||Dt(Ee.point,Ee.otherEvent.point,be.otherEvent.point)!==0)return fe(Ee.point,be.point)?Ee.isBelow(be.otherEvent.point)?-1:1:Ee.point[0]===be.point[0]?Ee.point[1]<be.point[1]?-1:1:nt(Ee,be)===1?be.isAbove(Ee.point)?-1:1:Ee.isBelow(be.point)?-1:1;if(Ee.isSubject!==be.isSubject)return Ee.isSubject?-1:1;var at=Ee.point,Gt=be.point;return at[0]===Gt[0]&&at[1]===Gt[1]?(at=Ee.otherEvent.point)[0]===(Gt=be.otherEvent.point)[0]&&at[1]===Gt[1]?0:Ee.contourId>be.contourId?1:-1:nt(Ee,be)===1?1:-1}var ci=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Yt(Ee,be,at,Gt){var ut,qt=Ee+1,wi=be[Ee].point,vi=be.length;for(qt<vi&&(ut=be[qt].point);qt<vi&&ut[0]===wi[0]&&ut[1]===wi[1];){if(!at[qt])return qt;++qt<vi&&(ut=be[qt].point)}for(qt=Ee-1;at[qt]&&qt>Gt;)qt--;return qt}ci.prototype.isExterior=function(){return this.holeOf==null};var Wt=Kt,ji=Kt;function Kt(Ee,be){if(!(this instanceof Kt))return new Kt(Ee,be);if(this.data=Ee||[],this.length=this.data.length,this.compare=be||Ai,this.length>0)for(var at=(this.length>>1)-1;at>=0;at--)this._down(at)}function Ai(Ee,be){return Ee<be?-1:Ee>be?1:0}Kt.prototype={push:function(Ee){this.data.push(Ee),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Ee=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Ee}},peek:function(){return this.data[0]},_up:function(Ee){for(var be=this.data,at=this.compare,Gt=be[Ee];Ee>0;){var ut=Ee-1>>1,qt=be[ut];if(at(Gt,qt)>=0)break;be[Ee]=qt,Ee=ut}be[Ee]=Gt},_down:function(Ee){for(var be=this.data,at=this.compare,Gt=this.length>>1,ut=be[Ee];Ee<Gt;){var qt=1+(Ee<<1),wi=qt+1,vi=be[qt];if(wi<this.length&&at(be[wi],vi)<0&&(qt=wi,vi=be[wi]),at(vi,ut)>=0)break;be[Ee]=vi,Ee=qt}be[Ee]=ut}},Wt.default=ji;var qi=Math.max,fn=Math.min,En=0;function Zi(Ee,be,at,Gt,ut,qt){var wi,vi,Ki,Li,gi,Wn;for(wi=0,vi=Ee.length-1;wi<vi;wi++)if(Li=Ee[wi+1],gi=new oe(Ki=Ee[wi],!1,void 0,be),Wn=new oe(Li,!1,gi,be),gi.otherEvent=Wn,Ki[0]!==Li[0]||Ki[1]!==Li[1]){gi.contourId=Wn.contourId=at,qt||(gi.isExteriorRing=!1,Wn.isExteriorRing=!1),nt(gi,Wn)>0?Wn.left=!0:gi.left=!0;var xr=Ki[0],zi=Ki[1];ut[0]=fn(ut[0],xr),ut[1]=fn(ut[1],zi),ut[2]=qi(ut[2],xr),ut[3]=qi(ut[3],zi),Gt.push(gi),Gt.push(Wn)}}var $n=[];function Jn(Ee,be,at){typeof Ee[0][0][0]=="number"&&(Ee=[Ee]),typeof be[0][0][0]=="number"&&(be=[be]);var Gt=function(zi,Fn,yr){var or=null;return zi.length*Fn.length==0&&(yr===k?or=$n:yr===U?or=zi:yr!==V&&yr!==q||(or=zi.length===0?Fn:zi)),or}(Ee,be,at);if(Gt)return Gt===$n?null:Gt;var ut=[1/0,1/0,-1/0,-1/0],qt=[1/0,1/0,-1/0,-1/0],wi=function(zi,Fn,yr,or,ar){var fr,Mr,Un,qn,en,Qn,Ir=new Wt(null,nt);for(Un=0,qn=zi.length;Un<qn;Un++)for(en=0,Qn=(fr=zi[Un]).length;en<Qn;en++)(Mr=en===0)&&En++,Zi(fr[en],!0,En,Ir,yr,Mr);for(Un=0,qn=Fn.length;Un<qn;Un++)for(en=0,Qn=(fr=Fn[Un]).length;en<Qn;en++)Mr=en===0,ar===U&&(Mr=!1),Mr&&En++,Zi(fr[en],!1,En,Ir,or,Mr);return Ir}(Ee,be,ut,qt,at);if(Gt=function(zi,Fn,yr,or,ar){var fr=null;return(yr[0]>or[2]||or[0]>yr[2]||yr[1]>or[3]||or[1]>yr[3])&&(ar===k?fr=$n:ar===U?fr=zi:ar!==V&&ar!==q||(fr=zi.concat(Fn))),fr}(Ee,be,ut,qt,at))return Gt===$n?null:Gt;for(var vi=function(zi){var Fn,yr,or=function(Un){var qn,en,Qn,Ir,Ni=[];for(en=0,Qn=Un.length;en<Qn;en++)((qn=Un[en]).left&&qn.inResult||!qn.left&&qn.otherEvent.inResult)&&Ni.push(qn);for(var _n=!1;!_n;)for(_n=!0,en=0,Qn=Ni.length;en<Qn;en++)en+1<Qn&&nt(Ni[en],Ni[en+1])===1&&(Ir=Ni[en],Ni[en]=Ni[en+1],Ni[en+1]=Ir,_n=!1);for(en=0,Qn=Ni.length;en<Qn;en++)(qn=Ni[en]).otherPos=en;for(en=0,Qn=Ni.length;en<Qn;en++)(qn=Ni[en]).left||(Ir=qn.otherPos,qn.otherPos=qn.otherEvent.otherPos,qn.otherEvent.otherPos=Ir);return Ni}(zi),ar={},fr=[],Mr=function(){if(!ar[Fn]){var Un=fr.length,qn=function(Ni,_n,$r){var Pr=new ci;if(Ni.prevInResult!=null){var Vo=Ni.prevInResult,ea=Vo.outputContourId;if(Vo.resultTransition>0){var Nr=_n[ea];if(Nr.holeOf!=null){var ta=Nr.holeOf;_n[ta].holeIds.push($r),Pr.holeOf=ta,Pr.depth=_n[ea].depth}else _n[ea].holeIds.push($r),Pr.holeOf=ea,Pr.depth=_n[ea].depth+1}else Pr.holeOf=null,Pr.depth=_n[ea].depth}else Pr.holeOf=null,Pr.depth=0;return Pr}(or[Fn],fr,Un),en=function(Ni){ar[Ni]=!0,Ni<or.length&&or[Ni]&&(or[Ni].outputContourId=Un)},Qn=Fn,Ir=Fn;for(qn.points.push(or[Fn].point);en(Qn),en(Qn=or[Qn].otherPos),qn.points.push(or[Qn].point),!((Qn=Yt(Qn,or,ar,Ir))==Ir||Qn>=or.length)&&or[Qn];);fr.push(qn)}};for(Fn=0,yr=or.length;Fn<yr;Fn++)Mr();return fr}(function(zi,Fn,yr,or,ar,fr){for(var Mr,Un,qn,en=new c(vt),Qn=[],Ir=Math.min(or[2],ar[2]);zi.length!==0;){var Ni=zi.pop();if(Qn.push(Ni),fr===k&&Ni.point[0]>Ir||fr===U&&Ni.point[0]>or[2])break;if(Ni.left){Un=Mr=en.insert(Ni),Mr=Mr!==(qn=en.minNode())?en.prev(Mr):null,Un=en.next(Un);var _n=Mr?Mr.key:null;if(J(Ni,_n,fr),Un&&bt(Ni,Un.key,zi)===2&&(J(Ni,_n,fr),J(Un.key,Ni,fr)),Mr&&bt(Mr.key,Ni,zi)===2){var $r=Mr;J(_n,($r=$r!==qn?en.prev($r):null)?$r.key:null,fr),J(Ni,_n,fr)}}else Un=Mr=en.find(Ni=Ni.otherEvent),Mr&&Un&&(Mr=Mr!==qn?en.prev(Mr):null,Un=en.next(Un),en.remove(Ni),Un&&Mr&&bt(Mr.key,Un.key,zi))}return Qn}(wi,0,0,ut,qt,at)),Ki=[],Li=0;Li<vi.length;Li++){var gi=vi[Li];if(gi.isExterior()){for(var Wn=[gi.points],xr=0;xr<gi.holeIds.length;xr++)Wn.push(vi[gi.holeIds[xr]].points);Ki.push(Wn)}}return Ki}var eo={UNION:V,DIFFERENCE:U,INTERSECTION:k,XOR:q};i.diff=function(Ee,be){return Jn(Ee,be,U)},i.intersection=function(Ee,be){return Jn(Ee,be,k)},i.operations=eo,i.union=function(Ee,be){return Jn(Ee,be,V)},i.xor=function(Ee,be){return Jn(Ee,be,q)},Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,Pg.exports)),Pg.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Kp(n,e,i,a){const c=[],m=a===0?(g,x,S,C,M,P)=>{g.push(new Tt(P,S+(P-x)/(C-x)*(M-S)))}:(g,x,S,C,M,P)=>{g.push(new Tt(x+(P-S)/(M-S)*(C-x),P))};for(const g of n){const x=[];for(const S of g){if(S.length<=2)continue;const C=[];for(let k=0;k<S.length-1;k++){const V=S[k].x,U=S[k].y,q=S[k+1].x,J=S[k+1].y,ee=a===0?V:U,oe=a===0?q:J;ee<e?oe>e&&m(C,V,U,q,J,e):ee>i?oe<i&&m(C,V,U,q,J,i):C.push(S[k]),oe<e&&ee>=e&&m(C,V,U,q,J,e),oe>i&&ee<=i&&m(C,V,U,q,J,i)}let M=S[S.length-1];const P=a===0?M.x:M.y;P>=e&&P<=i&&C.push(M),C.length&&(M=C[C.length-1],C[0].x===M.x&&C[0].y===M.y||C.push(C[0]),x.push(C))}x.length&&c.push(x)}return c}function oS(n,e){const i=u1(n),a=u1([e]),c=c1.intersection(i,a);return c==null?[]:sS(c)}function aS(n,e){let a=u1(n,65536);const c=[];for(;e.valid();e.next()){const[m,g]=e.get(),x=m.x*65536,S=m.y*65536,C=g.x*65536,M=g.y*65536,P=C-x,k=M-S,V=Math.hypot(P,k);if(V===0)continue;const U=Math.trunc(k/V*3),q=-Math.trunc(P/V*3);c.push([[[x,S],[C,M],[C+U,M+q],[x+U,S+q],[x,S]]])}return c.length>0&&(a=c1.diff(a,c)),sS(a,1/65536)}function u1(n,e=1){return[n.map(i=>i.map(a=>[a.x*e,a.y*e]))]}function sS(n,e=1){return n.map(i=>i.map((a,c)=>{const m=a.map(g=>new Tt(g[0]*e,g[1]*e).round());return c>0&&m.reverse(),m}))}class Og{constructor(e,i){this.layoutVertexArray=new Wa,this.indexArray=new lr,this.lineIndexArray=new jl,this.triangleSegments=new oo,this.lineSegments=new oo,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Vu)}update(e,i,a,c,m,g,x,S){this.programConfigurations.updatePaintArrays(e,i,m,a,c,g,x,S)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,KT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,JT.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,a,c,m,g,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,a,c,m,g,void 0,x)}}class kg{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new Og(e,!1),this.elevationBufferData=new Og(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,c){}populate(e,i,a,c){this.hasPattern=Nh("fill",this.layers,this.pixelRatio,i);const m=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:x,id:S,index:C,sourceLayerIndex:M}of e){const P=this.layers[0]._featureFilter.needGeometry,k=et(x,P);if(!this.layers[0]._featureFilter.filter(new Ar(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),k,a))continue;const V=m?m.evaluate(k,{},a,i.availableImages):void 0,U={id:S,properties:x.properties,type:x.type,sourceLayerIndex:M,index:C,geometry:P?k.geometry:ct(x,a,c),patterns:{},sortKey:V};g.push(U)}m&&g.sort((x,S)=>x.sortKey-S.sortKey);for(const x of g){const{geometry:S,index:C,sourceLayerIndex:M}=x;if(this.hasPattern){const P=Ix("fill",this.layers,x,this.zoom,this.pixelRatio,i);this.patternFeatures.push(P)}else this.addFeature(x,S,C,a,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[C].feature,S,C,M,this.index)}}update(e,i,a,c,m,g,x){this.bufferData.update(e,i,a,c,m,g,x,this.worldview),this.elevationBufferData.update(e,i,a,c,m,g,x,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,a,c,m,g,x,this.worldview)}addFeatures(e,i,a,c,m,g){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,a,c,g,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,a,c,m,g=[],x,S){const C=Rs(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,C,c,a,S):this.addGeometry(C,this.bufferData),this.bufferData.populatePaintArrays(e,a,m,g,c,x,this.worldview),this.elevationBufferData.populatePaintArrays(e,a,m,g,c,x,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,a,c,m){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,a,c,m,this.worldview))}addElevatedRoadFeature(e,i,a,c,m){const g=new Array,x=Bi.getElevationFeature(e,m);if(!x)return void this.addGeometry(i,this.bufferData);{const C=this.clipPolygonsToTile(i,1);C.length>0&&g.push({polygons:C,elevationFeature:x,elevationTileID:a})}const S={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},a),featureIndex:c};for(const C of g)if(C.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Vs(C.elevationTileID,this.layers,this.zoom,this.lut));const P=C.elevationFeature.isTunnel();let k=0;e.properties.hasOwnProperty(ri)&&(k=+e.properties[ri]);for(const V of C.polygons)this.elevatedStructures.addPortalCandidates(C.elevationFeature.id,V,P,C.elevationFeature,k)}C.elevationFeature.constantHeight==null&&(C.polygons=this.prepareElevatedPolygons(C.polygons,C.elevationFeature,C.elevationTileID));const M=new Bn(a,C.elevationTileID);this.addElevatedGeometry(C.polygons,M,C.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,c,S)}}addElevatedGeometry(e,i,a,c,m,g){const x={elevation:a,elevationSampler:i,bias:c,index:m,featureInfo:g},[S,C]=this.addGeometry(e,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:S,max:C}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,S),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,C))}addGeometry(e,i,a){let c=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,g=null;a&&(g=a.elevationSampler.constantElevation(a.elevation,a.bias),g!=null&&(c=g,m=g));const x=(S,C,M)=>{if(a!=null)if(C.push(S),g!=null)i.elevatedLayoutVertexArray.emplaceBack(g),M.push(g);else{const P=a.elevationSampler.pointElevation(S,a.elevation,a.bias);i.elevatedLayoutVertexArray.emplaceBack(P),M.push(P),c=Math.min(c,P),m=Math.max(m,P)}};for(const S of e){let C=0;for(const le of S)C+=le.length;const M=i.triangleSegments.prepareSegment(C,i.layoutVertexArray,i.indexArray),P=M.vertexLength,k=[],V=[],U=[],q=[],J=[],ee=i.layoutVertexArray.length;for(const le of S){if(le.length===0)continue;le!==S[0]&&V.push(k.length/2);const fe=i.lineSegments.prepareSegment(le.length,i.layoutVertexArray,i.lineIndexArray),Ie=fe.vertexLength;a&&J.push(i.layoutVertexArray.length-ee),x(le[0],U,q),i.layoutVertexArray.emplaceBack(le[0].x,le[0].y),i.lineIndexArray.emplaceBack(Ie+le.length-1,Ie),k.push(le[0].x),k.push(le[0].y);for(let Se=1;Se<le.length;Se++)x(le[Se],U,q),i.layoutVertexArray.emplaceBack(le[Se].x,le[Se].y),i.lineIndexArray.emplaceBack(Ie+Se-1,Ie+Se),k.push(le[Se].x),k.push(le[Se].y);fe.vertexLength+=le.length,fe.primitiveLength+=le.length}const oe=Zp(k,V);for(let le=0;le<oe.length;le+=3)i.indexArray.emplaceBack(P+oe[le],P+oe[le+1],P+oe[le+2]);if(oe.length>0&&a&&this.elevationMode==="hd-road-base"){const le=a.elevation.isTunnel(),fe=a.elevation.safeArea,Ie=this.elevatedStructures.addVertices(U,q);this.elevatedStructures.addTriangles(oe,Ie,le);const Se=J.length;if(Se>0){for(let Pe=0;Pe<Se-1;Pe++)this.elevatedStructures.addRenderableRing(a.index,J[Pe]+Ie,J[Pe+1]-J[Pe],le,fe,a.featureInfo);this.elevatedStructures.addRenderableRing(a.index,J[Se-1]+Ie,U.length-J[Se-1],le,fe,a.featureInfo)}}M.vertexLength+=C,M.primitiveLength+=oe.length/3}return[c,m]}prepareElevatedPolygons(e,i,a){const c=1/De(a),m=[];for(const g of e){const x=aS(g,new zr(i,c));m.push(...x)}return m}clipPolygonsToTile(e,i){const a=-i,c=-i,m=Bt+i,g=Bt+i;let x=0;const S=[],C=[];for(;x<e.length;x++){const k=e[x],V=xp(k);(V.min.x>=a&&V.max.x<=m&&V.min.y>=c&&V.max.y<=g?S:C).push(k)}if(S.length===e.length)return e;const M=[new Tt(a,c),new Tt(m,c),new Tt(m,g),new Tt(a,g),new Tt(a,c)],P=S;for(const k of C)P.push(...oS(k,M));return P}}let h1,lS,Dy,cS;li(kg,"FillBucket",{omit:["layers","patternFeatures"]}),li(Og,"FillBufferData"),li(Vs,"ElevatedStructures");class Dx{constructor(e,i,a,c){if(this.triangleCount=i.length/3,this.min=new Tt(0,0),this.max=new Tt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[m,g]=[e[0].clone(),e[0].clone()];for(let P=1;P<e.length;++P){const k=e[P];m.x=Math.min(m.x,k.x),m.y=Math.min(m.y,k.y),g.x=Math.max(g.x,k.x),g.y=Math.max(g.y,k.y)}if(c){const P=Math.ceil(Math.max(g.x-m.x,g.y-m.y)/c);a=Math.max(a,P)}if(a===0)return;this.min=m,this.max=g;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const S=Math.max(x.x,x.y)/a;this.cellsX=Math.max(1,Math.ceil(x.x/S)),this.cellsY=Math.max(1,Math.ceil(x.y/S)),this.xScale=1/S,this.yScale=1/S;const C=[];for(let P=0;P<this.triangleCount;P++){const k=e[i[3*P+0]].sub(this.min),V=e[i[3*P+1]].sub(this.min),U=e[i[3*P+2]].sub(this.min),q=Bh(Math.floor(Math.min(k.x,V.x,U.x)),this.xScale,this.cellsX),J=Bh(Math.floor(Math.max(k.x,V.x,U.x)),this.xScale,this.cellsX),ee=Bh(Math.floor(Math.min(k.y,V.y,U.y)),this.yScale,this.cellsY),oe=Bh(Math.floor(Math.max(k.y,V.y,U.y)),this.yScale,this.cellsY),le=new Tt(0,0),fe=new Tt(0,0),Ie=new Tt(0,0),Se=new Tt(0,0);for(let Pe=ee;Pe<=oe;++Pe){le.y=fe.y=Pe*S,Ie.y=Se.y=(Pe+1)*S;for(let ke=q;ke<=J;++ke)le.x=Ie.x=ke*S,fe.x=Se.x=(ke+1)*S,(Bo(k,V,U,le,fe,Se)||Bo(k,V,U,le,Se,Ie))&&C.push({cellIdx:Pe*this.cellsX+ke,triIdx:P})}}if(C.length===0)return;C.sort((P,k)=>P.cellIdx-k.cellIdx||P.triIdx-k.triIdx);let M=0;for(;M<C.length;){const P=C[M].cellIdx,k={start:this.payload.length,len:0};for(;M<C.length&&C[M].cellIdx===P;)++k.len,this.payload.push(C[M++].triIdx);this.cells[P]=k}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const a=Bh(e.x-this.min.x,this.xScale,this.cellsX),c=Bh(e.y-this.min.y,this.yScale,this.cellsY),m=this.cells[c*this.cellsX+a];if(m){this._lazyInitLookup();for(let g=0;g<m.len;g++){const x=this.payload[m.start+g],S=Math.floor(x/8),C=1<<x%8;if(!(this.lookup[S]&C)&&(this.lookup[S]|=C,i.push(x),i.length===this.triangleCount))return}}}query(e,i,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const c=Bh(e.x-this.min.x,this.xScale,this.cellsX),m=Bh(i.x-this.min.x,this.xScale,this.cellsX),g=Bh(e.y-this.min.y,this.yScale,this.cellsY),x=Bh(i.y-this.min.y,this.yScale,this.cellsY);for(let S=g;S<=x;S++)for(let C=c;C<=m;C++){const M=this.cells[S*this.cellsX+C];if(M)for(let P=0;P<M.len;P++){const k=this.payload[M.start+P],V=Math.floor(k/8),U=1<<k%8;if(!(this.lookup[V]&U)&&(this.lookup[V]|=U,a.push(k),a.length===this.triangleCount))return}}}}function Bh(n,e,i){return Math.max(0,Math.min(i-1,Math.floor(n*e)))}li(Dx,"TriangleGridIndex");class uS{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}updateAppearances(e,i,a,c){}populate(e,i,a,c){const m=[];for(const{feature:g,id:x,index:S,sourceLayerIndex:C}of e){const M=this.layers[0]._featureFilter.needGeometry,P=et(g,M);if(!this.layers[0]._featureFilter.filter(new Ar(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),P,a))continue;const k={id:x,properties:g.properties,type:g.type,sourceLayerIndex:C,index:S,geometry:M?P.geometry:ct(g,a,c),patterns:{}};m.push(k)}for(const g of m){const{geometry:x,index:S,sourceLayerIndex:C}=g;this.addFeature(g,x,S,a,{},i.availableImages,i.brightness),i.featureIndex.insert(e[S].feature,x,S,C,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,a,c,m,g,x){}destroy(){}addFeature(e,i,a,c,m,g=[],x){for(const S of Rs(i,2)){const C=[],M=[],P=[],k=new Tt(1/0,1/0),V=new Tt(-1/0,-1/0);for(const J of S)if(J.length!==0){J!==S[0]&&P.push(M.length/2);for(let ee=0;ee<J.length;ee++)M.push(J[ee].x),M.push(J[ee].y),C.push(J[ee]),k.x=Math.min(k.x,J[ee].x),k.y=Math.min(k.y,J[ee].y),V.x=Math.max(V.x,J[ee].x),V.y=Math.max(V.y,J[ee].y)}const U=Zp(M,P),q=new Dx(C,U,8,256);this.footprints.push({vertices:C,indices:U,grid:q,min:k,max:V})}}}li(uS,"ClipBucket",{omit:["layers"]});const sC=gn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),lC=gn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),cC=gn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),uC=gn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),hC=gn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),dC=gn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),d1=gn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:f1}=sC,Jp=Number.MAX_SAFE_INTEGER,Mx=Jp-1;function hS(n,e,i,a){return n.order<e||n.order===Jp||!(n.clipMask&i)||function(c,m){return m.length!==0&&m.find(g=>g===c)===void 0}(a,n.clipScope)}function If(n,e){return n.x-e.x||n.y-e.y}function Fg(n,e){return If(n.min,e.min)===0&&If(n.max,e.max)===0}function p1(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function My(n,e){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(n[i].sourceId!==e[i].sourceId||!Fg(n[i],e[i])||n[i].order!==e[i].order||n[i].clipMask!==e[i].clipMask||!Ta(n[i].clipScope,e[i].clipScope))return!1;return!0}function dS(n,e,i){const a=1/Bt,c=1/(1<<i.canonical.z),m=(e.x*a+i.canonical.x)*c+i.wrap,g=(e.y*a+i.canonical.y)*c;return{min:new Tt((n.x*a+i.canonical.x)*c+i.wrap,(n.y*a+i.canonical.y)*c),max:new Tt(m,g)}}function fC(n,e,i){const a=1<<i.canonical.z,c=((e.x-i.wrap)*a-i.canonical.x)*Bt,m=(e.y*a-i.canonical.y)*Bt;return{min:new Tt(((n.x-i.wrap)*a-i.canonical.x)*Bt,(n.y*a-i.canonical.y)*Bt),max:new Tt(c,m)}}function Px(n,e,i,a,c,m,g){const x=n.indices,S=n.vertices,C=[];for(let M=a;M<a+c;M+=3){const P=e[i[M+0]+m],k=e[i[M+1]+m],V=e[i[M+2]+m],U=Math.min(P.x,k.x,V.x),q=Math.max(P.x,k.x,V.x),J=Math.min(P.y,k.y,V.y),ee=Math.max(P.y,k.y,V.y);C.length=0,n.grid.query(new Tt(U,J),new Tt(q,ee),C);for(let oe=0;oe<C.length;oe++){const le=C[oe];if(Bo(S[x[3*le+0]],S[x[3*le+1]],S[x[3*le+2]],P,k,V,g))return!0}}return!1}function fS(n,e,i,a){if(!n||!i)return!1;let c=n.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(i.vertices.length<n.vertices.length)return fS(i,a,n,e);const m=e.canonical,g=a.canonical,x=Math.pow(2,g.z-m.z);c=n.vertices.map(S=>new Tt((S.x+m.x*Bt)*x-g.x*Bt,(S.y+m.y*Bt)*x-g.y*Bt))}return Px(i,c,n.indices,0,n.indices.length,0,0)}function pS(n,e,i,a){const c=Math.pow(2,a.z-i.z);return new Tt((n+i.x*Bt)*c-a.x*Bt,(e+i.y*Bt)*c-a.y*Bt)}function Ox(n,e){const i=[];e.grid.queryPoint(n,i);const a=e.indices,c=e.vertices;for(let m=0;m<i.length;m++){const g=i[m];if(Ca([c[a[3*g+0]],c[a[3*g+1]],c[a[3*g+2]]],n))return!0}return!1}const Lg=[new Tt(0,0),new Tt(Bt,0),new Tt(Bt,Bt),new Tt(0,Bt)];function Py(n,e){const i=[];let a=[];if(!e||n.length<2)return[n];if(n.length===2)return Mo(n[0],n[1],Lg)?[n]:[];for(let c=0;c<n.length+2;c++){const m=n[c%n.length],g=n[(c+1)%n.length],x=Mo(c===0?n[n.length-1]:n[(c-1)%n.length],m,Lg),S=Mo(m,g,Lg),C=x||S;C&&a.push(m),C&&S||a.length>0&&(a.length>1&&i.push(a),a=[])}return a.length>1&&i.push(a),i}const zg=At.types,Oy=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],ky=["fill-extrusion-flood-light-ground-radius"],pC=Math.pow(2,13),m1=Math.pow(2,15)-1,kx=new Tt(0,1),Rf=2147483648,mS=7,mC=450;function Fy(n,e,i,a,c,m,g,x){n.emplaceBack((e<<1)+g,(i<<1)+m,(Math.floor(a*pC)<<1)+c,Math.round(x))}function Ly(n,e,i){n.emplaceBack(e.x*Bt,e.y*Bt,i?1:0)}function Fx(n,e,i,a,c,m){n.emplaceBack(e.x,e.y,(i.x<<1)+a,(i.y<<1)+c,m)}function zy(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class gS{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class _S{constructor(){this.centroidXY=new Tt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Tt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Tt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Tt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Lx{constructor(){this.acc=new Tt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,a){this.accCount++,this.acc._add(i);let c=!!this.borders;i.x<e.min.x?(e.min.x=i.x,c=!0):i.x>e.max.x&&(e.max.x=i.x,c=!0),i.y<e.min.y?(e.min.y=i.y,c=!0):i.y>e.max.y&&(e.max.y=i.y,c=!0),((i.x===0||i.x===Bt)&&i.x===a.x)!=((i.y===0||i.y===Bt)&&i.y===a.y)&&this.processBorderOverlap(i,a),c&&this.checkBorderIntersection(i,a)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Si(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Bt!=e.x>Bt&&this.addBorderIntersection(1,Si(i.y,e.y,(Bt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Si(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Bt!=e.y>Bt&&this.addBorderIntersection(3,Si(i.x,e.x,(Bt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new Tt(0,0):new Tt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function yS(n,e){const i=n.add(e)._unit(),a=Y(n.x*i.x+n.y*i.y,-1,1);var c,m,g;return c=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(c)))/4*m1*((m=n).x*(g=e).y-m.y*g.x<0?-1:1)}const gC=[n=>n.x<0,n=>n.x>Bt,n=>n.y<0,n=>n.y>Bt];function g1(n,e,i,a){const c=[4];if(a===0)return c;i._mult(a);const m=n.sub(i),g=e.sub(i),x=[n,e,m,g];for(let S=0;S<4;S++)for(const C of x)if(gC[S](C)){c.push(S);break}return c}class _1{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new gf,this.indexArray=new lr,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut},i=>ky.includes(i)),this._segments=new oo,this.hiddenByLandmarkVertexArray=new Gp,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new oo}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,a,c=!1){const m=e.length;if(m>2){let g=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let S;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const C=e[0],M=e[1];S=yS(C.sub(e[m-1])._perp()._unit(),M.sub(C)._perp()._unit())}for(let C=0;C<m;C++){const M=C===m-1?0:C+1,P=e[C],k=e[M],V=e[M===m-1?0:M+1],U=k.sub(P)._perp()._unit(),q=yS(U,V.sub(k)._perp()._unit()),J=S,ee=q;if(v1(P,k,i)||c&&xS(P,i)&&xS(k,i)){S=q;continue}const oe=x.vertexLength;Fx(this.vertexArray,P,k,1,1,J),Fx(this.vertexArray,P,k,1,0,J),Fx(this.vertexArray,P,k,0,1,ee),Fx(this.vertexArray,P,k,0,0,ee),x.vertexLength+=4;const le=g1(P,k,U,a);for(const fe of le)this._segmentToGroundQuads[g].push({id:oe,region:fe}),this._segmentToRegionTriCounts[g][fe]+=2,x.primitiveLength+=2;S=q}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let a=0;a<i;a++)this._segmentToGroundQuads[a].sort((c,m)=>c.region-m.region);for(let a=0;a<i;a++){const c=this._segmentToGroundQuads[a],m=e[a],g=this._segmentToRegionTriCounts[a];g.reduce((S,C)=>S+C,0);let x=0;for(let S=0;S<=4;S++){const C=g[S];if(C!==0){let M=this.regionSegments[S];M||(M=this.regionSegments[S]=new oo);const P={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+x,vertexLength:m.vertexLength,primitiveLength:C};M.get().push(P)}x+=C}for(let S=0;S<c.length;S++){const C=c[S].id;this.indexArray.emplaceBack(C,C+1,C+3),this.indexArray.emplaceBack(C,C+3,C+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,a,c,m,g,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,a,c,m,g,void 0,x)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,lC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,cC.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,a,c,m,g,x,S){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,a,c,m,g,x,S)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Rf))}updateHiddenByLandmarkRange(e,i,a){if(!this.hasData())return;const c=i+e;if(i!==0){for(let m=e;m<c;++m)this.hiddenByLandmarkVertexArray.emplace(m,a?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,dC.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Ng{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new lr,this.footprintVertices=new Wa,this.footprintSegments=[],this.layoutVertexArray=new mf,this.centroidVertexArray=new _x,this.wallVertexArray=new Tg,this.indexArray=new lr,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut},i=>Oy.includes(i)),this.segments=new oo,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new _1(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,c){}populate(e,i,a,c){this.features=[],this.hasPattern=Nh("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=De(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:m,id:g,index:x,sourceLayerIndex:S}of e){const C=this.layers[0]._featureFilter.needGeometry,M=et(m,C);if(!this.layers[0]._featureFilter.filter(new Ar(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),M,a))continue;const P={id:g,sourceLayerIndex:S,index:x,geometry:C?M.geometry:ct(m,a,c),properties:m.properties,type:m.type,patterns:{}},k=this.layoutVertexArray.length,V=zg[P.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:m.id,feature:Ix("fill-extrusion",this.layers,P,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const U of P.geometry)for(const q of Py(U,V))this.addFeature(m.id,P,[q],x,a,{},i.availableImages,c,i.brightness);else this.addFeature(m.id,P,P.geometry,x,a,{},i.availableImages,c,i.brightness);i.featureIndex.insert(m,P.geometry,x,S,this.index,k)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,a,c,m,g){for(const{featureId:x,feature:S}of this.features){const C=zg[S.type]==="Polygon",{geometry:M}=S;if(this.wallMode)for(const P of M)for(const k of Py(P,C))this.addFeature(x,S,[k],S.index,i,a,c,m,g);else this.addFeature(x,S,M,S.index,i,a,c,m,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,a,c,m,g,x){this.programConfigurations.updatePaintArrays(e,i,m,a,c,g,x,this.worldview),this.groundEffect.update(e,i,m,a,c,g,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,f1),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,hC.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,d1.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,uC.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,c,m,g,x,S,C){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,P=[new Tt(0,0),new Tt(Bt,Bt)],k=S.projection,V=k.name==="globe",U=this.wallMode||zg[i.type]==="Polygon",q=new Lx;q.centroidDataIndex=this.centroidData.length;const J=new _S;J.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(J.buildingId=i.properties.building_id);const ee=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},m)<=0,oe=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},m);let le;if(J.height=oe,J.vertexArrayOffset=this.layoutVertexArray.length,J.groundVertexArrayOffset=this.groundEffect.vertexArray.length,V&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new vg),this.wallMode){if(V)return void ei("Non zero fill-extrusion-line-width is not yet supported on globe.");if(a.length!==1)return;le=function(Ze){const st=Ze[0].x===Ze[Ze.length-1].x&&Ze[0].y===Ze[Ze.length-1].y;(function(Yt){let Wt=0;const ji=Yt.length;for(let Kt=0;Kt<ji;Kt++)Wt+=(Yt[(Kt+1)%ji].x-Yt[Kt].x)*(Yt[(Kt+1)%ji].y+Yt[Kt].y);return Wt>=0})(Ze)||(Ze=Ze.reverse());const wt={geometry:[],joinNormals:[],indices:[]},Rt=[],Mt=[],yt=[];let Dt=Ze.length;for(;Dt>=2&&Ze[Dt-1].equals(Ze[Dt-2]);)Dt--;if(Dt<(st?3:2))return wt;let nt,tt,St,It,bt,vt=0;for(;vt<Dt-1&&Ze[vt].equals(Ze[vt+1]);)vt++;st&&(nt=Ze[Dt-2],bt=Ze[vt].sub(nt)._unit()._perp());for(let Yt=vt;Yt<Dt;Yt++){if(St=Yt===Dt-1?st?Ze[vt+1]:void 0:Ze[Yt+1],St&&Ze[Yt].equals(St))continue;bt&&(It=bt),nt&&(tt=nt),nt=Ze[Yt],bt=St?St.sub(nt)._unit()._perp():It,It=It||bt;let Wt=It.add(bt);Wt.x===0&&Wt.y===0||Wt._unit();const ji=Wt.x*bt.x+Wt.y*bt.y,Kt=ji!==0?1/ji:1/0,Ai=It.x*bt.y-It.y*bt.x>0;let qi="miter";const fn=2;qi==="miter"&&Kt>fn&&(qi="bevel"),qi==="bevel"&&(Kt>100&&(qi="flipbevel"),Kt<fn&&(qi="miter"));const En=(Zi,$n,Jn,eo)=>{const Ee=new Tt(Zi.x,Zi.y),be=new Tt(Zi.x,Zi.y);Ee.x+=$n.x*eo,Ee.y+=$n.y*eo,be.x-=$n.x*Math.max(Jn,1),be.y-=$n.y*Math.max(Jn,1),yt.push($n),Rt.push(Ee),Mt.push(be)};if(qi==="miter")Wt._mult(Kt),En(nt,Wt,0,0);else if(qi==="flipbevel")Wt=bt.mult(-1),En(nt,Wt,0,0),En(nt,Wt.mult(-1),0,0);else{const Zi=-Math.sqrt(Kt*Kt-1),$n=Ai?Zi:0,Jn=Ai?0:Zi;tt&&En(nt,It,$n,Jn),St&&En(nt,bt,$n,Jn)}}wt.geometry=[...Rt,...Mt.reverse(),Rt[0]],wt.joinNormals=[...yt,...yt.reverse(),yt[yt.length-1]];const ci=wt.geometry.length-1;for(let Yt=0;Yt<ci/2;Yt++)if(Yt+1<ci/2){let Wt=Yt,ji=Yt+1,Kt=ci-1-Yt,Ai=ci-2-Yt;Wt=Wt===0?ci-1:Wt-1,ji=ji===0?ci-1:ji-1,Kt=Kt===0?ci-1:Kt-1,Ai=Ai===0?ci-1:Ai-1,wt.indices.push(Kt),wt.indices.push(ji),wt.indices.push(Wt),wt.indices.push(Kt),wt.indices.push(Ai),wt.indices.push(ji)}return wt}(a[0]),a=[le.geometry]}const fe=(Ze,st)=>Ze<(st.length-1)/2||Ze===st.length-1,Ie=this.wallMode?[a]:Rs(a,500);for(let Ze=Ie.length-1;Ze>=0;Ze--){const st=Ie[Ze];(st.length===0||(Se=st[0]).every(dt=>dt.x<=0)||Se.every(dt=>dt.x>=Bt)||Se.every(dt=>dt.y<=0)||Se.every(dt=>dt.y>=Bt))&&Ie.splice(Ze,1)}var Se;let Pe;if(V)Pe=TS(Ie,P,m);else{Pe=[];for(const Ze of Ie)Pe.push({polygon:Ze,bounds:P})}const ke=U?this.edgeRadius:0,Be=ke>0&&this.zoom<17,ot=(Ze,st)=>{if(Ze.length===0)return!1;const dt=Ze[Ze.length-1];return st.x===dt.x&&st.y===dt.y};for(const{polygon:Ze,bounds:st}of Pe){let dt=0,wt=0;for(const Dt of Ze)U&&!Dt[0].equals(Dt[Dt.length-1])&&Dt.push(Dt[0]),wt+=U?Dt.length-1:Dt.length;const Rt=this.segments.prepareSegment((U?5:4)*wt,this.layoutVertexArray,this.indexArray);J.footprintSegIdx<0&&(J.footprintSegIdx=this.footprintSegments.length),J.polygonSegIdx<0&&(J.polygonSegIdx=this.polygonSegments.length);const Mt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},yt=new gS;if(yt.vertexOffset=this.footprintVertices.length,yt.indexOffset=3*this.footprintIndices.length,yt.ringIndices=[],U){const Dt=[],nt=[];dt=Rt.vertexLength;for(let St=0;St<Ze.length;St++){const It=Ze[St];It.length&&St!==0&&nt.push(Dt.length/2);const bt=[];let vt,ci;vt=It[1].sub(It[0])._perp()._unit(),yt.ringIndices.push(It.length-1);for(let Yt=1;Yt<It.length;Yt++){const Wt=It[Yt],ji=It[Yt===It.length-1?1:Yt+1],Kt=Wt.clone();if(ke){ci=ji.sub(Wt)._perp()._unit();const Ai=vt.add(ci)._unit(),qi=ke*Math.min(4,1/(vt.x*Ai.x+vt.y*Ai.y));Kt.x+=qi*Ai.x,Kt.y+=qi*Ai.y,Kt.x=Math.round(Kt.x),Kt.y=Math.round(Kt.y),vt=ci}if(!ee||ke!==0&&!Be||ot(bt,Kt)||bt.push(Kt),Fy(this.layoutVertexArray,Kt.x,Kt.y,0,0,1,1,0),this.wallMode){const Ai=fe(Yt,It);Ly(this.wallVertexArray,le.joinNormals[Yt],!Ai)}Rt.vertexLength++,this.footprintVertices.emplaceBack(Wt.x,Wt.y),Dt.push(Wt.x,Wt.y),V&&zy(this.layoutVertexExtArray,k.projectTilePoint(Kt.x,Kt.y,m),k.upVector(m,Kt.x,Kt.y))}ee&&(ke===0||Be)&&(bt.length!==0&&ot(bt,bt[0])&&bt.pop(),this.groundEffect.addData(bt,st,M))}const tt=this.wallMode?le.indices:Zp(Dt,nt);for(let St=0;St<tt.length;St+=3)this.footprintIndices.emplaceBack(yt.vertexOffset+tt[St+0],yt.vertexOffset+tt[St+1],yt.vertexOffset+tt[St+2]),this.indexArray.emplaceBack(dt+tt[St],dt+tt[St+2],dt+tt[St+1]),Rt.primitiveLength++;yt.indexCount+=tt.length,yt.vertexCount+=this.footprintVertices.length-yt.vertexOffset}for(let Dt=0;Dt<Ze.length;Dt++){const nt=Ze[Dt];q.startRing(J,nt[0]);let tt=nt.length>4&&x1(nt[nt.length-2],nt[0],nt[1]),St=ke?_C(nt[nt.length-2],nt[0],nt[1],ke):0;const It=[];let bt,vt,ci;vt=nt[1].sub(nt[0])._perp()._unit();let Yt=!0;for(let Wt=1,ji=0;Wt<nt.length;Wt++){let Kt=nt[Wt-1],Ai=nt[Wt];const qi=nt[Wt===nt.length-1?1:Wt+1];if(q.appendEdge(J,Ai,Kt),v1(Ai,Kt,st)){ke&&(vt=qi.sub(Ai)._perp()._unit(),Yt=!Yt);continue}const fn=Ai.sub(Kt)._perp(),En=fn.x/(Math.abs(fn.x)+Math.abs(fn.y)),Zi=fn.y>0?1:0,$n=Kt.dist(Ai);if(ji+$n>32768&&(ji=0),ke){ci=qi.sub(Ai)._perp()._unit();let be=vS(Kt,Ai,qi,y1(vt,ci),ke);isNaN(be)&&(be=0);const at=Ai.sub(Kt)._unit();Kt=Kt.add(at.mult(St))._round(),Ai=Ai.add(at.mult(-be))._round(),St=be,vt=ci,ee&&this.zoom>=17&&(ot(It,Kt)||It.push(Kt),ot(It,Ai)||It.push(Ai))}const Jn=Rt.vertexLength,eo=nt.length>4&&x1(Kt,Ai,qi);let Ee=bS(ji,tt,Yt);if(Fy(this.layoutVertexArray,Kt.x,Kt.y,En,Zi,0,0,Ee),Fy(this.layoutVertexArray,Kt.x,Kt.y,En,Zi,0,1,Ee),this.wallMode){const be=fe(Wt-1,nt),at=le.joinNormals[Wt-1];Ly(this.wallVertexArray,at,be),Ly(this.wallVertexArray,at,be)}if(ji+=$n,Ee=bS(ji,eo,!Yt),tt=eo,Fy(this.layoutVertexArray,Ai.x,Ai.y,En,Zi,0,0,Ee),Fy(this.layoutVertexArray,Ai.x,Ai.y,En,Zi,0,1,Ee),this.wallMode){const be=fe(Wt,nt),at=le.joinNormals[Wt];Ly(this.wallVertexArray,at,be),Ly(this.wallVertexArray,at,be)}if(Rt.vertexLength+=4,this.indexArray.emplaceBack(Jn+0,Jn+1,Jn+2),this.indexArray.emplaceBack(Jn+1,Jn+3,Jn+2),Rt.primitiveLength+=2,ke){const be=dt+(Wt===1?nt.length-2:Wt-2),at=Wt===1?dt:be+1;if(this.indexArray.emplaceBack(Jn+1,be,Jn+3),this.indexArray.emplaceBack(be,at,Jn+3),Rt.primitiveLength+=2,bt===void 0&&(bt=Jn),!v1(qi,nt[Wt],st)){const Gt=Wt===nt.length-1?bt:Rt.vertexLength;this.indexArray.emplaceBack(Jn+2,Jn+3,Gt),this.indexArray.emplaceBack(Jn+3,Gt+1,Gt),this.indexArray.emplaceBack(Jn+3,at,Gt+1),Rt.primitiveLength+=3}Yt=!Yt}if(V){const be=this.layoutVertexExtArray,at=k.projectTilePoint(Kt.x,Kt.y,m),Gt=k.projectTilePoint(Ai.x,Ai.y,m),ut=k.upVector(m,Kt.x,Kt.y),qt=k.upVector(m,Ai.x,Ai.y);zy(be,at,ut),zy(be,at,ut),zy(be,Gt,qt),zy(be,Gt,qt)}}U&&(dt+=nt.length-1),ee&&ke&&this.zoom>=17&&(It.length!==0&&ot(It,It[0])&&It.pop(),this.groundEffect.addData(It,st,M,ke>0))}this.footprintSegments.push(yt),Mt.triangleCount=this.indexArray.length-Mt.triangleArrayOffset,this.polygonSegments.push(Mt),++J.footprintSegLen,++J.polygonSegLen}if(J.vertexCount=this.layoutVertexArray.length-J.vertexArrayOffset,J.groundVertexCount=this.groundEffect.vertexArray.length-J.groundVertexArrayOffset,J.vertexCount!==0){if(J.centroidXY=q.borders?kx:this.encodeCentroid(q,J),this.centroidData.push(J),q.borders){this.featuresOnBorder.push(q);const Ze=this.featuresOnBorder.length-1;for(let st=0;st<q.borders.length;st++)q.borders[st][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[st].push(Ze)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,g,x,m,C,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,c,g,x,m,C,this.worldview),this.maxHeight=Math.max(this.maxHeight,oe)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let x=0;x<this.centroidData.length;x++){const S=this.centroidData[x],C=+(S.min.y+S.max.y>Bt),M=2*C+(+(S.min.x+S.max.x>Bt)^C);for(let P=0;P<S.polygonSegLen;P++){const k=S.polygonSegIdx+P;e.push({centroidIdx:x,subtile:M,polygonSegmentIdx:k,triangleSegmentIdx:this.polygonSegments[k].triangleSegIdx})}}const i=new lr;e.sort((x,S)=>x.triangleSegmentIdx===S.triangleSegmentIdx?x.subtile-S.subtile:x.triangleSegmentIdx-S.triangleSegmentIdx);let a=0,c=0,m=0;for(const x of e){if(x.triangleSegmentIdx!==a)break;m++}const g=e.length;for(;c!==e.length;){a=e[c].triangleSegmentIdx;let x=0,S=c,C=c;for(let M=S;M<m&&e[M].subtile===x;M++)C++;for(;S!==m;){const M=e[S];x=M.subtile;const P=this.centroidData[M.centroidIdx].min.clone(),k=this.centroidData[M.centroidIdx].max.clone(),V={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let U=S;U<C;U++){const q=e[U],J=this.polygonSegments[q.polygonSegmentIdx],ee=this.centroidData[q.centroidIdx].min,oe=this.centroidData[q.centroidIdx].max,le=this.indexArray.uint16;for(let fe=J.triangleArrayOffset;fe<J.triangleArrayOffset+J.triangleCount;fe++)i.emplaceBack(le[3*fe],le[3*fe+1],le[3*fe+2]);V.primitiveLength+=J.triangleCount,P.x=Math.min(P.x,ee.x),P.y=Math.min(P.y,ee.y),k.x=Math.max(k.x,oe.x),k.y=Math.max(k.y,oe.y)}V.primitiveLength>0&&this.triangleSubSegments.push({segment:V,min:P,max:k}),S=C;for(let U=S;U<m&&e[U].subtile===e[S].subtile;U++)C++}c=m;for(let M=c;M<g&&e[M].triangleSegmentIdx===e[c].triangleSegmentIdx;M++)m++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,a){const c=new oo;if(this.wallMode){for(const q of this.triangleSubSegments)c.segments.push(q.segment);return c}let m=0,g=0;const x=1<<e.canonical.z;if(i){const q=i.getMinMaxForTile(e);q&&(m=q.min,g=q.max)}g+=this.maxHeight;const S=e.toUnwrapped();let C;const M=[S.canonical.x/x+S.wrap,S.canonical.y/x],P=[(S.canonical.x+1)/x+S.wrap,(S.canonical.y+1)/x],k=(q,J,ee)=>[q[0]*(1-ee[0])+J[0]*ee[0],q[1]*(1-ee[1])+J[1]*ee[1]],V=[],U=[];for(const q of this.triangleSubSegments){V[0]=q.min.x/Bt,V[1]=q.min.y/Bt,U[0]=q.max.x/Bt,U[1]=q.max.y/Bt;const J=k(M,P,V),ee=k(M,P,U);if(new dn([J[0],J[1],m],[ee[0],ee[1],g]).intersectsPrecise(a)===0){C&&(c.segments.push(C),C=void 0);continue}const oe=q.segment;C&&C.vertexOffset!==oe.vertexOffset&&(c.segments.push(C),C=void 0),C?(C.vertexLength+=oe.vertexLength,C.primitiveLength+=oe.primitiveLength):C={vertexOffset:oe.vertexOffset,primitiveLength:oe.primitiveLength,vertexLength:oe.vertexLength,primitiveOffset:oe.primitiveOffset,sortKey:void 0,vaos:{}}}return C&&c.segments.push(C),c}encodeCentroid(e,i){const a=e.centroid(),c=i.span(),m=Math.min(7,Math.round(c.x*this.tileToMeter/10)),g=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new Tt(Y(a.x,1,Bt-1)<<3|m,Y(a.y,1,Bt-1)<<3|g)}encodeBorderCentroid(e){if(!e.borders)return new Tt(0,0);const i=e.borders,a=Number.MAX_VALUE;if(i[0][0]!==a||i[1][0]!==a){const c=i[0][0]!==a?0:1;return new Tt(6|(i[0][0]!==a?0:65528),(i[c][0]+i[c][1])/2<<3|6)}{const c=i[2][0]!==a?2:3;return new Tt((i[c][0]+i[c][1])/2<<3|6,6|(i[2][0]!==a?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,c=e.flags&Rf?kx:e.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==c.y||m!==c.x){for(let g=i;g<a;++g)this.centroidVertexArray.emplace(g,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const c=i.getReplacementRegionsForTile(e.toUnwrapped());if(My(this.activeReplacements,c))return;if(this.activeReplacements=c,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const m=[];for(const g of this.activeReplacements){if(g.order<a)continue;const x=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));if(g.footprint.buildingId){const S=g.footprint.buildingId;for(const C of this.centroidData)C.buildingId===S&&(C.flags|=Rf)}else for(const S of this.centroidData)if(!(S.flags&Rf||g.min.x>S.max.x||S.min.x>g.max.x||g.min.y>S.max.y||S.min.y>g.max.y))for(let C=0;C<S.footprintSegLen;C++){const M=this.footprintSegments[S.footprintSegIdx+C];if(m.length=0,yC(this.footprintVertices,M.vertexOffset,M.vertexCount,g.footprintTileId.canonical,e.canonical,m),Px(g.footprint,m,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-x)){S.flags|=Rf;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,a){let c=!1;for(let m=0;m<a.footprintSegLen;m++){const g=this.footprintSegments[a.footprintSegIdx+m];let x=0;for(const S of g.ringIndices){for(let C=x,M=S+x-1;C<S+x;M=C++){const P=this.footprintVertices.int16[2*(C+g.vertexOffset)+0],k=this.footprintVertices.int16[2*(C+g.vertexOffset)+1],V=this.footprintVertices.int16[2*(M+g.vertexOffset)+1];k>i!=V>i&&e<(this.footprintVertices.int16[2*(M+g.vertexOffset)+0]-P)*(i-k)/(V-k)+P&&(c=!c)}x=S}}return c}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,c=!0;const m=4*(e+Bt)*Bt+(i+Bt);if(this.partLookup.hasOwnProperty(m)){const g=this.partLookup[m];return g?{height:g.height,hidden:!!(g.flags&Rf)}:void 0}for(const g of this.centroidData)e>g.max.x||g.min.x>e||i>g.max.y||g.min.y>i||g.height<=a||this.footprintContainsPoint(e,i,g)&&(a=g.height,this.partLookup[m]=g,c=!!(g.flags&Rf));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:c};this.partLookup[m]=void 0}}function y1(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function _C(n,e,i,a){const c=e.sub(n)._perp()._unit(),m=i.sub(e)._perp()._unit();return vS(n,e,i,y1(c,m),a)}function vS(n,e,i,a,c){const m=Math.sqrt(1-a*a);return Math.min(n.dist(e)/3,e.dist(i)/3,c*m/a)}function v1(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function xS(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function x1(n,e,i){if(n.x<0||n.x>=Bt||e.x<0||e.x>=Bt||i.x<0||i.x>=Bt)return!1;const a=i.sub(e),c=a.perp(),m=n.sub(e);return(a.x*m.x+a.y*m.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(m.x*m.x+m.y*m.y))>-.866&&c.x*m.x+c.y*m.y<0}function bS(n,e,i){const a=e?2|n:-3&n;return i?1|a:-2&a}function wS(){const n=Math.PI/32,e=Math.tan(n),i=F;return i*Math.sqrt(1+2*e*e)-i}function TS(n,e,i){const a=1<<i.z,c=me(i.x/a),m=me((i.x+1)/a),g=ce(i.y/a),x=ce((i.y+1)/a);return function(S,C,M,P,k=0,V){const U=[];if(!S.length||!M||!P)return U;const q=(Se,Pe)=>{for(const ke of Se)U.push({polygon:ke,bounds:Pe})},J=Math.ceil(Math.log2(M)),ee=Math.ceil(Math.log2(P)),oe=J-ee,le=[];for(let Se=0;Se<Math.abs(oe);Se++)le.push(oe>0?0:1);for(let Se=0;Se<Math.min(J,ee);Se++)le.push(0),le.push(1);let fe=S;if(fe=Kp(fe,C[0].y-k,C[1].y+k,1),fe=Kp(fe,C[0].x-k,C[1].x+k,0),!fe.length)return U;const Ie=[];for(le.length?Ie.push({polygons:fe,bounds:C,depth:0}):q(fe,C);Ie.length;){const Se=Ie.pop(),Pe=Se.depth,ke=le[Pe],Be=Se.bounds[0],ot=Se.bounds[1],Ze=ke===0?Be.x:Be.y,st=ke===0?ot.x:ot.y,dt=V?V(ke,Ze,st):.5*(Ze+st),wt=Kp(Se.polygons,Ze-k,dt+k,ke),Rt=Kp(Se.polygons,dt-k,st+k,ke);if(wt.length){const Mt=[Be,new Tt(ke===0?dt:ot.x,ke===1?dt:ot.y)];le.length>Pe+1?Ie.push({polygons:wt,bounds:Mt,depth:Pe+1}):q(wt,Mt)}if(Rt.length){const Mt=[new Tt(ke===0?dt:Be.x,ke===1?dt:Be.y),ot];le.length>Pe+1?Ie.push({polygons:Rt,bounds:Mt,depth:Pe+1}):q(Rt,Mt)}}return U}(n,e,Math.ceil((m-c)/11.25),Math.ceil((g-x)/11.25),1,(S,C,M)=>{if(S===0)return .5*(C+M);{const P=ce((i.y+C/Bt)/a);return(te(.5*(ce((i.y+M/Bt)/a)+P))*a-i.y)*Bt}})}function yC(n,e,i,a,c,m){const g=Math.pow(2,a.z-c.z);for(let x=0;x<i;x++){let S=n.int16[2*(x+e)+0],C=n.int16[2*(x+e)+1];S=(S+c.x*Bt)*g-a.x*Bt,C=(C+c.y*Bt)*g-a.y*Bt,m.push(new Tt(S,C))}}let SS,ES;li(Ng,"FillExtrusionBucket",{omit:["layers","features"]}),li(_S,"PartData"),li(gS,"FootprintSegment"),li(Lx,"BorderCentroidData"),li(_1,"GroundEffect");class Qp extends Tt{constructor(e,i,a){super(e,i),this.z=a}}class zx extends Qp{constructor(e,i,a,c){super(e,i,a),this.w=c}}function AS(n,e,i,a){const c=i==="x"?"y":"x",m=(a-n[i])/(e[i]-n[i]);n[c]=Math.round(n[c]+(e[c]-n[c])*m),n[i]=a,n.hasOwnProperty("z")&&(n.z=Si(n.z,e.z,m)),n.hasOwnProperty("w")&&(n.w=Si(n.w,e.w,m))}function CS(n,e,i,a){const c=i,m=a;for(const g of["x","y"]){let x=n,S=e;x[g]>=S[g]&&(x=e,S=n),x[g]<c&&S[g]>c&&AS(x,S,g,c),x[g]<m&&S[g]>m&&AS(S,x,g,m)}}function Nx(n,e,i,a,c,m){const g=[];for(let x=0;x<n.length;x++){const S=n[x];let C;const M=g.length;let P=0;for(let k=0;k<S.length-1;k++){let V=S[k],U=S[k+1],q=0;const J=P;let ee,oe;m&&(q=Math.hypot(U.x-V.x,U.y-V.y),P+=q,ee=V,oe=U),V.x<e&&U.x<e||(V.x<e?V=new Tt(e,V.y+(e-V.x)/(U.x-V.x)*(U.y-V.y))._round():U.x<e&&(U=new Tt(e,V.y+(e-V.x)/(U.x-V.x)*(U.y-V.y))._round()),V.y<i&&U.y<i||(V.y<i?V=new Tt(V.x+(i-V.y)/(U.y-V.y)*(U.x-V.x),i)._round():U.y<i&&(U=new Tt(V.x+(i-V.y)/(U.y-V.y)*(U.x-V.x),i)._round()),V.x>=a&&U.x>=a||(V.x>=a?V=new Tt(a,V.y+(a-V.x)/(U.x-V.x)*(U.y-V.y))._round():U.x>=a&&(U=new Tt(a,V.y+(a-V.x)/(U.x-V.x)*(U.y-V.y))._round()),V.y>=c&&U.y>=c||(V.y>=c?V=new Tt(V.x+(c-V.y)/(U.y-V.y)*(U.x-V.x),c)._round():U.y>=c&&(U=new Tt(V.x+(c-V.y)/(U.y-V.y)*(U.x-V.x),c)._round()),C&&V.equals(C[C.length-1])||(C=[V],g.push(C),m&&m.push({progress:{min:J+IS(ee,oe,V)*q,max:1},parentIndex:x,prevPoint:ee,nextPoint:oe})),C.push(U),m&&(m[m.length-1].progress.max=J+IS(ee,oe,U)*q,m[m.length-1].nextPoint=oe)))))}if(m&&P>0)for(let k=M;k<g.length;k++)m[k].progress.min/=P,m[k].progress.max/=P}return g}function vC(n,e,i,a,c){if(n.length<2)return void a.push(n);const m=[];for(;e.valid();){const[C,M]=e.get();for(let P=0;P<n.length-1;P++){const k=n[P],V=n[P+1],U=nl(k,V,C,M);if(U){const[q]=U,J=new Tt(Si(k.x,V.x,q),Si(k.y,V.y,q));m.push({t:P+q,distance:0,point:J})}}e.next()}if(m.length===0)return void a.push(n);m.sort((C,M)=>C.t-M.t);let g=0,x=0,S=[];for(a.push(S);g!==n.length;){if(x===m.length){for(;g!==n.length;)S.length!==0&&S[S.length-1].equals(n[g])||S.push(n[g]),g++;break}m[x].t<=g?(S.length!==0&&S[S.length-1].equals(m[x].point)||S.push(m[x].point),Math.trunc(m[x].t),x++):(S.length!==0&&S[S.length-1].equals(n[g])||S.push(n[g]),g++)}}function IS(n,e,i){return n.x!==e.x?(i.x-n.x)/(e.x-n.x):n.y!==e.y?(i.y-n.y)/(e.y-n.y):0}function Ny(n,e){return n.x*e.x+n.y*e.y}function RS(n,e){if(n.length===1){let i=0;const a=e[i++];let c;for(;!c||a.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const m=e[i],g=n[0],x=c.sub(a),S=m.sub(a),C=g.sub(a),M=Ny(x,x),P=Ny(x,S),k=Ny(S,S),V=Ny(C,x),U=Ny(C,S),q=M*k-P*P,J=(k*V-P*U)/q,ee=(M*U-P*V)/q,oe=a.z*(1-J-ee)+c.z*J+m.z*ee;if(isFinite(oe))return oe}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}function DS(n,e,i){let a=1/0;xo(i,e)&&(a=RS(i,e[0]));for(let c=0;c<e.length;c++){const m=e[c],g=n[c];for(let x=0;x<m.length-1;x++){const S=m[x],C=[S,m[x+1],g[x+1],g[x],S];Eo(i,C)&&(a=Math.min(a,RS(i,C)))}}return a!==1/0&&a}function MS(n,e,i,a,c,m,g,x,S,C,M){return n.projection.name==="globe"?function(P,k,V,U,q,J,ee,oe,le,fe,Ie){const Se=[],Pe=[],ke=P.projection.upVectorScale(Ie,P.center.lat,P.worldSize).metersToTile,Be=[0,0,0,1],ot=[0,0,0,1],Ze=(dt,wt,Rt,Mt)=>{dt[0]=wt,dt[1]=Rt,dt[2]=Mt,dt[3]=1},st=wS();V>0&&(V+=st),U+=st;for(const dt of k){const wt=[],Rt=[];for(const Mt of dt){const yt=Mt.x+q.x,Dt=Mt.y+q.y,nt=P.projection.projectTilePoint(yt,Dt,Ie),tt=P.projection.upVector(Ie,Mt.x,Mt.y);let St=V,It=U;if(ee){const bt=b1(yt,Dt,V,U,ee,oe,le,fe);St+=bt.base,It+=bt.top}V!==0?Ze(Be,nt.x+tt[0]*ke*St,nt.y+tt[1]*ke*St,nt.z+tt[2]*ke*St):Ze(Be,nt.x,nt.y,nt.z),Ze(ot,nt.x+tt[0]*ke*It,nt.y+tt[1]*ke*It,nt.z+tt[2]*ke*It),on(Be,Be,J),on(ot,ot,J),wt.push(new Qp(Be[0],Be[1],Be[2])),Rt.push(new Qp(ot[0],ot[1],ot[2]))}Se.push(wt),Pe.push(Rt)}return[Se,Pe]}(n,e,i,a,c,m,g,x,S,C,M):g?function(P,k,V,U,q,J,ee,oe,le){const fe=[],Ie=[],Se=[0,0,0,1];for(const Pe of P){const ke=[],Be=[];for(const ot of Pe){const Ze=ot.x+U.x,st=ot.y+U.y,dt=b1(Ze,st,k,V,J,ee,oe,le);Se[0]=Ze,Se[1]=st,Se[2]=dt.base,Se[3]=1,Uo(Se,Se,q),Se[3]=Math.max(Se[3],1e-5);const wt=new Qp(Se[0]/Se[3],Se[1]/Se[3],Se[2]/Se[3]);Se[0]=Ze,Se[1]=st,Se[2]=dt.top,Se[3]=1,Uo(Se,Se,q),Se[3]=Math.max(Se[3],1e-5);const Rt=new Qp(Se[0]/Se[3],Se[1]/Se[3],Se[2]/Se[3]);ke.push(wt),Be.push(Rt)}fe.push(ke),Ie.push(Be)}return[fe,Ie]}(e,i,a,c,m,g,x,S,C):function(P,k,V,U,q){const J=[],ee=[],oe=q[8]*k,le=q[9]*k,fe=q[10]*k,Ie=q[11]*k,Se=q[8]*V,Pe=q[9]*V,ke=q[10]*V,Be=q[11]*V;for(const ot of P){const Ze=[],st=[];for(const dt of ot){const wt=dt.x+U.x,Rt=dt.y+U.y,Mt=q[0]*wt+q[4]*Rt+q[12],yt=q[1]*wt+q[5]*Rt+q[13],Dt=q[2]*wt+q[6]*Rt+q[14],nt=q[3]*wt+q[7]*Rt+q[15],tt=Mt+oe,St=yt+le,It=Dt+fe,bt=Math.max(nt+Ie,1e-5),vt=Mt+Se,ci=yt+Pe,Yt=Dt+ke,Wt=Math.max(nt+Be,1e-5);Ze.push(new Qp(tt/bt,St/bt,It/bt)),st.push(new Qp(vt/Wt,ci/Wt,Yt/Wt))}J.push(Ze),ee.push(st)}return[J,ee]}(e,i,a,c,m)}function b1(n,e,i,a,c,m,g,x){const S=g*c.getElevationAt(n,e,!0,!0),C=m[0]!==0,M=C?m[1]===0?g*(m[0]/mS-mC):g*function(P,k,V){const U=Math.floor(k[0]/8),q=Math.floor(k[1]/8),J=10*(k[0]-8*U),ee=10*(k[1]-8*q),oe=P.getElevationAt(U,q,!0,!0),le=P.getMeterToDEM(V),fe=Math.floor(.5*(J*le-1)),Ie=Math.floor(.5*(ee*le-1)),Se=P.tileCoordToPixel(U,q),Pe=2*fe+1,ke=2*Ie+1,Be=function(Rt,Mt,yt,Dt,nt){return[Rt.getElevationAtPixel(Mt,yt,!0),Rt.getElevationAtPixel(Mt+nt,yt,!0),Rt.getElevationAtPixel(Mt,yt+nt,!0),Rt.getElevationAtPixel(Mt+Dt,yt+nt,!0)]}(P,Se.x-fe,Se.y-Ie,Pe,ke),ot=Math.abs(Be[0]-Be[1]),Ze=Math.abs(Be[2]-Be[3]),st=Math.abs(Be[0]-Be[2])+Math.abs(Be[1]-Be[3]),dt=Math.min(.25,.5*le*(ot+Ze)/Pe),wt=Math.min(.25,.5*le*st/ke);return oe+Math.max(dt*J,wt*ee)}(c,m,x):S;return{base:S+(i===0?-1:i),top:C?Math.max(M+a,S+i+2):S+a}}class w1{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class xC{constructor(){this.tasks={},this.taskQueue=[],We(["process"],this),this.invoker=new w1(this.process),this.nextId=0}add(e,i){const a=this.nextId++,c=function({type:m,isSymbolTile:g,zoom:x}){return x=x||0,m==="message"?0:m!=="maybePrepare"||g?m!=="parseTile"||g?m==="parseTile"&&g?300-x:m==="maybePrepare"&&g?400-x:500:200-x:100-x}(i);if(c===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:i,priority:c,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const m=this.tasks[this.taskQueue[c]];m.priority<i&&(i=m.priority,e=c)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class PS{constructor(e,i,a){this.target=e,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},We(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new xC}send(e,i,a,c,m=!1,g){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=g,this.callbacks[x]=a);const S=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!a,targetMapId:c,mustQueue:m,sourceMapId:this.mapId,data:zu(i,S)},S),{cancel:()=>{a&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const c=this.cancelCallbacks[a];delete this.cancelCallbacks[a],c&&c.cancel()}else if(i.mustQueue||Lr(self)){const c=this.callbacks[a],m=this.scheduler.add(()=>this.processTask(a,i),c&&c.metadata||{type:"message"});m&&(this.cancelCallbacks[a]=m)}else this.processTask(a,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(i.error?a(Sh(i.error)):a(null,Sh(i.data)))}else{const a=new Set,c=i.hasCallback?(g,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:g?zu(g):null,data:zu(x,a)},a)}:()=>{},m=Sh(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,m,c);else if(this.parent.getWorkerSource){const g=i.type.split("."),{source:x,scope:S}=m;this.parent.getWorkerSource(i.sourceMapId,g[0],x,S)[g[1]](m,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Df={workerUrl:"",workerClass:null,workerParams:void 0};const em="mapboxgl_preloaded_worker_pool";class tm{constructor(){this.active={}}acquire(e,i=tm.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(Df.workerClass!=null?new Df.workerClass:new self.Worker(Df.workerUrl,Df.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[em]}numActive(){return Object.keys(this.active).length}}tm.workerCount=2;class Bg{constructor(e,i,a="Worker",c=tm.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=je();const m=this.workerPool.acquire(this.id,c);for(let g=0;g<m.length;g++){const x=new Bg.Actor(m[g],i,this.id);x.name=`${a} ${g}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,a){ye(this.actors,(c,m)=>{c.send(e,i,m)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let By,T1;function Bx(){return By||(By=new tm),By}Bg.Actor=PS;class bC{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),a=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,a/i.BYTES_PER_ELEMENT),a}createFloatArray(e){const i=new Float32Array(e),a=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,a/i.BYTES_PER_ELEMENT),a}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let a=0;a<e.length;++a)this.module.heapU8[i+a]=e.charCodeAt(a);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,a=e.facadeGlazingColorRgb,c=e.roofColorRgb,m=e.wallColorRgb,g=e.normalScale;this.module.setStyle(i[0],i[1],i[2],a[0],a[1],a[2],c[0],c[1],c[2],m[0],m[1],m[2],g[0],g[1],g[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,a){this.module.setFauxFacadeOptions(e?1:0,i?1:0,a)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){for(const x of e){const S=this.createStringBuffer(x.roofType),C=[0],M=[];for(const V of x.coordinates)if(Array.isArray(V)){for(const U of V)M.push(U.x),M.push(U.y);C.push(M.length)}const P=this.createIntArray(C),k=this.createFloatArray(M);this.module.addFeature(x.id,x.sourceId,x.minHeight,x.height,S,x.roofType.length,k,P,C.length-1),this.module.free(S),this.module.free(P),this.module.free(k)}for(const x of i){let S;S=x.entrances?JSON.parse(x.entrances):[];const C=this.createFloatArray(S),M=[];for(const k of x.coordinates)M.push(k.x),M.push(k.y);const P=this.createFloatArray(M);this.module.addFacade(x.sourceId,x.crossPerc,x.distanceToRoad,C,S.length,P,M.length),this.module.free(C),this.module.free(P)}if(!this.module.generateMesh()){const x=this.module.getLastError();return this.readStringBuffer(x)}const a=this.module.getMeshCount(),c=new Array(a);for(let x=0;x<a;x++){const S=this.module.getPositionsPtr(x),C=this.module.getPositionsLength(x),M=new Float32Array(this.module.heapF32.buffer,S,C),P=this.module.getNormalsPtr(x),k=this.module.getNormalsLength(x),V=new Float32Array(this.module.heapF32.buffer,P,k),U=this.module.getColorsPtr(x),q=this.module.getColorsLength(x),J=new Uint8Array(this.module.heapU8.buffer,U,q),ee=this.module.getAOPtr(x),oe=this.module.getAOLength(x),le=new Float32Array(this.module.heapF32.buffer,ee,oe),fe=this.module.getUVPtr(x),Ie=this.module.getUVLength(x),Se=new Float32Array(this.module.heapF32.buffer,fe,Ie),Pe=this.module.getFauxFacadePtr(x),ke=this.module.getFauxFacadeLength(x),Be=new Uint8Array(this.module.heapU8.buffer,Pe,ke),ot=this.module.getIndicesPtr(x),Ze=this.module.getIndicesLength(x),st=new Int32Array(this.module.heap32.buffer,ot,Ze),dt=this.module.getBuildingPart(x),wt=this.readStringBuffer(dt);c[x]={positions:M,normals:V,colors:J,ao:le,uv:Se,isFauxFacade:Be,indices:st,buildingPart:wt}}const m=this.module.getRingCount(),g=[];for(let x=0;x<m;x++){const S=this.module.getRingPtr(x),C=this.module.getRingLength(x),M=new Float32Array(this.module.heapF32.buffer,S,C);g.push(M)}return{meshes:c,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:g}}}let Vy,Vx,Wu,Vg,S1,Ug=null,jg=null,OS=null,Ux=null;function kS(){return Lr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Vx||Sr.DRACO_URL}function FS(){if(Lr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Vg)return Vg;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Vg=WebAssembly.validate(n)?Sr.MESHOPT_SIMD_URL:Sr.MESHOPT_URL,Vg}function wC(){return Ux}const jx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},TC={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Uy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function LS(n,e,i){const a=i.json.bufferViews.length,c=i.buffers.length;e.bufferView=a,i.json.bufferViews[a]={buffer:c,byteLength:n.byteLength},i.buffers[c]=n}const E1="KHR_draco_mesh_compression";function SC(n,e){const i=n.extensions&&n.extensions[E1];if(!i)return;const a=new Wu.Decoder,c=zS(e,i.bufferView),m=new Wu.Mesh;if(!a.DecodeArrayToMesh(c,c.byteLength,m))throw new Error("Failed to decode Draco mesh");const g=e.json.accessors[n.indices],x=jx[g.componentType],S=g.count*x.BYTES_PER_ELEMENT,C=Wu._malloc(S);x===Uint16Array?a.GetTrianglesUInt16Array(m,S,C):a.GetTrianglesUInt32Array(m,S,C),LS(Wu.memory.buffer.slice(C,C+S),g,e),Wu._free(C);for(const M of Object.keys(i.attributes)){const P=a.GetAttributeByUniqueId(m,i.attributes[M]),k=e.json.accessors[n.attributes[M]],V=TC[k.componentType],U=k.count*Uy[k.type]*jx[k.componentType].BYTES_PER_ELEMENT,q=Wu._malloc(U);a.GetAttributeDataArrayForAllPoints(m,P,Wu[V],U,q),LS(Wu.memory.buffer.slice(q,q+U),k,e),Wu._free(q)}a.destroy(),m.destroy(),delete n.extensions[E1]}const Pd="EXT_meshopt_compression";function Gg(n,e){if(!n.extensions||!n.extensions[Pd])return;const i=n.extensions[Pd],a=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),c=new Uint8Array(i.count*i.byteStride);S1.decodeGltfBuffer(c,i.count,i.byteStride,a,i.mode,i.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=c.buffer,delete n.extensions[Pd]}const Gx=1179937895,Hg=new TextDecoder("utf8");function Hx(n,e){return new URL(n,e).href}function EC(n,e,i,a){return fetch(Hx(n.uri,a)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[i]=c})}function zS(n,e){const i=n.json.bufferViews[e];return new Uint8Array(n.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function AC(n,e,i,a){if(n.uri){const c=Hx(n.uri,a);return fetch(c).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{e.images[i]=m})}if(n.bufferView!==void 0){const c=zS(e,n.bufferView),m=new Blob([c],{type:n.mimeType});return createImageBitmap(m).then(g=>{e.images[i]=g})}}function $g(n,e=0,i){const a={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===Gx){const M=new Uint32Array(n,e);let P=2;const k=(M[P++]>>2)-3,V=M[P++]>>2;if(P++,a.json=JSON.parse(Hg.decode(M.subarray(P,P+V))),P+=V,P<k){const U=M[P++];P++;const q=e+(P<<2);a.buffers[0]=n.slice(q,q+U)}}else a.json=JSON.parse(Hg.decode(new Uint8Array(n,e)));const{buffers:c,images:m,meshes:g,extensionsUsed:x,bufferViews:S}=a.json;let C=Promise.resolve();if(c){const M=[];for(let P=0;P<c.length;P++){const k=c[P];k.uri?M.push(EC(k,a,P,i)):a.buffers[P]||(a.buffers[P]=null)}C=Promise.all(M)}return C.then(()=>{const M=[],P=x&&x.includes(E1),k=x&&x.includes(Pd);if(P&&M.push(function(){if(!Wu)return Vy??(Vy=function(V){let U,q=null;function J(){U=new Uint8Array(q.buffer)}function ee(){throw new Error("Unexpected Draco error.")}const oe={a:{a:ee,d:function(le,fe,Ie){return U.copyWithin(le,fe,fe+Ie)},c:function(le){const fe=U.length,Ie=Math.max(le>>>0,Math.ceil(1.2*fe)),Se=Math.ceil((Ie-fe)/65536);try{return q.grow(Se),J(),!0}catch{return!1}},b:ee}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(V,oe):V.then(le=>le.arrayBuffer()).then(le=>WebAssembly.instantiate(le,oe))).then(le=>{const{Rb:fe,Qb:Ie,P:Se,T:Pe,X:ke,Ja:Be,La:ot,Qa:Ze,Va:st,Wa:dt,eb:wt,jb:Rt,f:Mt,e:yt,yb:Dt,zb:nt,Ab:tt,Bb:St,Db:It,Gb:bt}=le.instance.exports;q=yt;const vt=(()=>{let ci=0,Yt=0,Wt=0,ji=0;return Kt=>{Wt&&(fe(ji),fe(ci),Yt+=Wt,Wt=ci=0),ci||(Yt+=128,ci=Ie(Yt));const Ai=Kt.length+7&-8;let qi=ci;Ai>=Yt&&(Wt=Ai,qi=ji=Ie(Ai));for(let fn=0;fn<Kt.length;fn++)U[qi+fn]=Kt[fn];return qi}})();return J(),Mt(),{memory:yt,_free:fe,_malloc:Ie,Mesh:class{constructor(){this.ptr=Se()}destroy(){Pe(this.ptr)}},Decoder:class{constructor(){this.ptr=Be()}destroy(){Rt(this.ptr)}DecodeArrayToMesh(ci,Yt,Wt){const ji=vt(ci),Kt=ot(this.ptr,ji,Yt,Wt.ptr);return!!ke(Kt)}GetAttributeByUniqueId(ci,Yt){return{ptr:Ze(this.ptr,ci.ptr,Yt)}}GetTrianglesUInt16Array(ci,Yt,Wt){st(this.ptr,ci.ptr,Yt,Wt)}GetTrianglesUInt32Array(ci,Yt,Wt){dt(this.ptr,ci.ptr,Yt,Wt)}GetAttributeDataArrayForAllPoints(ci,Yt,Wt,ji,Kt){wt(this.ptr,ci.ptr,Yt.ptr,Wt,ji,Kt)}},DT_INT8:Dt(),DT_UINT8:nt(),DT_INT16:tt(),DT_UINT16:St(),DT_UINT32:It(),DT_FLOAT32:bt()}})}(fetch(kS())),Vy.then(V=>{Wu=V,Vy=void 0}))}()),k&&M.push(function(){if(S1)return;const V=function(U){let q;const J=WebAssembly.instantiateStreaming(U,{}).then(le=>{q=le.instance,q.exports.__wasm_call_ctors()}),ee={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},oe={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:J,supported:!0,decodeGltfBuffer(le,fe,Ie,Se,Pe,ke){(function(Be,ot,Ze,st,dt,wt,Rt){const Mt=Be.exports.sbrk,yt=st+3&-4,Dt=Mt(yt*dt),nt=Mt(wt.length),tt=new Uint8Array(Be.exports.memory.buffer);tt.set(wt,nt);const St=ot(Dt,st,dt,nt,wt.length);if(St===0&&Rt&&Rt(Dt,yt,dt),Ze.set(tt.subarray(Dt,Dt+st*dt)),Mt(Dt-Mt(0)),St!==0)throw new Error(`Malformed buffer data: ${St}`)})(q,q.exports[oe[Pe]],le,fe,Ie,Se,q.exports[ee[ke]])}}}(fetch(FS()));return V.ready.then(()=>{S1=V})}()),m)for(let V=0;V<m.length;V++)M.push(AC(m[V],a,V,i));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(P&&g)for(const{primitives:V}of g)for(const U of V)SC(U,a);if(k&&g&&S)for(const V of S)Gg(V,a);return a})})}function jy(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>$g(e,0,n))}function $x(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function im(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Od{constructor(e,i,a,c){this.context=e,this.format=a,this.useMipmap=c&&c.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:c&&c.premultiply})}update(e,i){const a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,c=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:m}=this,{gl:g}=m,{x,y:S}=i&&i.position?i.position:{x:0,y:0},C=x+a,M=S+c;!this.size||this.size[0]===C&&this.size[1]===M||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!i||i.premultiply!==!1));const P=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&C>0&&M>0){const k=this.useMipmap?Math.floor(Math.log2(Math.max(C,M)))+1:1;g.texStorage2D(g.TEXTURE_2D,k,this.format,C,M),this.size=[C,M]}this.size&&(P?g.texSubImage2D(g.TEXTURE_2D,0,x,S,$x(this.format),im(this.format),e):"data"in e&&e.data&&g.texSubImage2D(g.TEXTURE_2D,0,x,S,a,c,$x(this.format),im(this.format),e.data)),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,i,a=!1){const{context:c}=this,{gl:m}=c;m.bindTexture(m.TEXTURE_2D,this.texture),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,a,c,m){const{context:g}=this,{gl:x}=g;x.bindTexture(x.TEXTURE_2D,this.texture),i!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?e===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,a),this.wrapS=a),c!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,c),this.wrapT=c),m!==this.compareMode&&(m?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.COMPARE_REF_TO_TEXTURE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_FUNC,m)):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.NONE),this.compareMode=m)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Jc{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrapS=i)}}const Wg=gn([{name:"a_pos_3f",components:3,type:"Float32"}]),Wx=gn([{name:"a_color_3f",components:3,type:"Float32"}]),A1=gn([{name:"a_color_4f",components:4,type:"Float32"}]),CC=gn([{name:"a_uv_2f",components:2,type:"Float32"}]),NS=gn([{name:"a_normal_3f",components:3,type:"Float32"}]),BS=gn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),qx=gn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function Qc(n,e){const i=nm(n.projection,n.zoom,n.width,n.height),a=function(m,g,x,S,C){const M=new j(x.lng-180*ol,x.lat),P=new j(x.lng+180*ol,x.lat),k=m.project(M.lng,M.lat),V=m.project(P.lng,P.lat),U=-Math.atan2(V.y-k.y,V.x-k.x),q=He.fromLngLat(x);q.y=Y(q.y,-1+ol,1-ol);const J=q.toLngLat(),ee=m.project(J.lng,J.lat),oe=He.fromLngLat(J);oe.x+=ol;const le=oe.toLngLat(),fe=m.project(le.lng,le.lat),Ie=Us(fe.x-ee.x,fe.y-ee.y,U),Se=He.fromLngLat(J);Se.y+=ol;const Pe=Se.toLngLat(),ke=m.project(Pe.lng,Pe.lat),Be=Us(ke.x-ee.x,ke.y-ee.y,U),ot=Math.abs(Ie.x)/Math.abs(Be.y),Ze=xe([]);Ct(Ze,Ze,-U*(1-(C?0:S)));const st=xe([]);return Ge(st,st,[1,1-(1-ot)*S,1]),st[4]=-Be.x/Be.y*S,Ct(st,st,U),Le(st,Ze,st),st}(n.projection,0,n.center,i,e),c=Zx(n);return Ge(a,a,[c,c,1]),a}function Zx(n){const e=n.projection,i=nm(n.projection,n.zoom,n.width,n.height),a=Vh(e,n.center),c=Vh(e,j.convert(e.center));return Math.pow(2,a*i+(1-i)*c)}function nm(n,e,i,a,c=1/0){const m=n.range;if(!m)return 0;const g=Math.min(c,Math.max(i,a)),x=Math.log2(g/1024);return ue(m[0]+x,m[1]+x,e)}const ol=1/4e4;function Vh(n,e){const i=Y(e.lat,-_e,_e),a=new j(e.lng-180*ol,i),c=new j(e.lng+180*ol,i),m=n.project(a.lng,i),g=n.project(c.lng,i),x=He.fromLngLat(a),S=He.fromLngLat(c),C=g.x-m.x,M=g.y-m.y,P=S.x-x.x,k=S.y-x.y,V=Math.sqrt((P*P+k*k)/(C*C+M*M));return Math.log2(V)}function Us(n,e,i){const a=Math.cos(i),c=Math.sin(i);return{x:n*a-e*c,y:n*c+e*a}}function js(n,e,i){xe(n),Ct(n,n,hn(e[2])),Ye(n,n,hn(e[0])),mt(n,n,hn(e[1])),Ge(n,n,i),Le(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function qg(n,e,i,a,c,m,g,x){const S=[i[0]-e[0],i[1]-e[1],0],C=[a[0]-e[0],a[1]-e[1],0];if(Qt(S)<1e-12||Qt(C)<1e-12)return jo(n);const M=Xi([],S,C);mn(M,M),rn(C,a,e),S[2]=(m-c)*x,C[2]=(g-c)*x;const P=S;return Xi(P,S,C),mn(P,P),jr(n,M,P)}function al(n,e,i=!1){const a=Rd(e.zoom),c=function(m,g,x){const S=g.worldSize,C=[m[12],m[13],m[14]],M=ce(C[1]/S),P=me(C[0]/S),k=xe([]),V=se(1,M)*S,U=se(1,0)*S*Ae(M,g.zoom),q=1/Jb(S);let J=U*q;if(x){const fe=nm(g.projection,g.zoom,g.width,g.height,1024);J=q*g.projection.pixelSpaceConversion(g.center.lat,S,fe)}const ee=D(M,P);fi(ee,ee,pn([],mn([],ee),V*J*C[2]));const oe=function(fe){const Ie=[fe[0],fe[1],fe[2]];let Se=[0,1,0];const Pe=Xi([],Se,Ie);return Xi(Se,Ie,Pe),kr(Se)===0&&(Se=[0,1,0],Xi(Pe,Ie,Se)),mn(Pe,Pe),mn(Se,Se),mn(Ie,Ie),[Pe[0],Pe[1],Pe[2],0,Se[0],Se[1],Se[2],0,Ie[0],Ie[1],Ie[2],0,fe[0],fe[1],fe[2],1]}(ee);Ge(k,k,[J,J,J*V]),Ke(k,k,[-C[0],-C[1],-C[2]]);const le=Le([],g.globeMatrix,oe);return Le(le,le,k),Le(le,le,m),le}(n,e,i);if(a>0){const m=function(g,x){const S=x.worldSize,C=se(1,0)*S*Ae(x.center.lat,x.zoom)/Jb(S),M=se(1,x.center.lat)*S,P=xe([]);mt(P,P,hn(x.center.lng)),Ye(P,P,hn(x.center.lat)),Ke(P,P,[0,0,Bs]),Ge(P,P,[C,C,C*M]);const k=x.point;return Ke(P,P,[-k.x,-k.y,0]),Le(P,P,g),Le(P,x.globeMatrix,P)}(n,e);return function(g,x,S){const C=(U,q,J)=>{const ee=Qt(U),oe=Qt(q),le=Cd(U,q,J);return pn(le,le,1/Qt(le)*Si(ee,oe,J))},M=C([g[0],g[1],g[2]],[x[0],x[1],x[2]],S),P=C([g[4],g[5],g[6]],[x[4],x[5],x[6]],S),k=C([g[8],g[9],g[10]],[x[8],x[9],x[10]],S),V=Cd([g[12],g[13],g[14]],[x[12],x[13],x[14]],S);return[M[0],M[1],M[2],0,P[0],P[1],P[2],0,k[0],k[1],k[2],0,V[0],V[1],V[2],1]}(c,m,a)}return c}function qu(n,e,i,a){const c=dn.projectAabbCorners(a,i);let m=Number.MAX_VALUE;for(let x=0;x<c.length;++x){const S=c[x];S[0]=(.5*S[0]+.5)*e.width,S[1]=(.5-.5*S[1])*e.height,S[2]<m&&(m=S[2])}const g=function(x){const S=[];let C=0;for(let V=1;V<x.length;V++)(x[V][0]<x[C][0]||x[V][0]===x[C][0]&&x[V][1]<x[C][1])&&(C=V);let M,P=C;const k=new Uint8Array(x.length);do{if(k[P])break;S.push(new Tt(x[P][0],x[P][1])),k[P]=1,M=(P+1)%x.length;for(let V=0;V<x.length;V++){if(x[V][0]===x[M][0]&&x[V][1]===x[M][1]||x[V][0]===x[P][0]&&x[V][1]===x[P][1])continue;const U=[x[V][0]-x[P][0],x[V][1]-x[P][1]],q=[x[M][0]-x[P][0],x[M][1]-x[P][1]],J=U[0]*q[1]-U[1]*q[0];(J>0||J===0&&U[0]*q[0]+U[1]*q[1]>=0&&U[0]*U[0]+U[1]*U[1]>q[0]*q[0]+q[1]*q[1])&&(M=V)}P=M}while(P!==C);return S.length>0&&S.push(S[0]),S}(c);if(Eo(n,g))return m}const sl=64,Mf={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function kd(n,e,i,a,c,m,g,x,S,C=!1){const M=i.zoom,P=i.project(a),k=Ae(a.lat,M),V=1/k;xe(n),Ke(n,n,[P.x+g[0]*V,P.y+g[1]*V,g[2]]);let U=1,q=1;const J=i.worldSize;if(C){if(i.projection.name==="mercator"){let fe=0;i.elevation&&(fe=i.elevation.getAtPointOrZero(new He(P.x/J,P.y/J),0));const Ie=Uo([],[P.x,P.y,fe,1],i.projMatrix)[3]/i.cameraToCenterDistance;U=Ie,q=Ie*Ae(i.center.lat,M)}else if(i.projection.name==="globe"){const fe=al(n,i),Ie=[0,0,0,1];Uo(Ie,Ie,Le([],i.projMatrix,fe));const Se=Ie[3]/i.cameraToCenterDistance,Pe=Rd(M),ke=i.projection.pixelsPerMeter(a.lat,J)*Ae(a.lat,M),Be=i.projection.pixelsPerMeter(i.center.lat,J)*Ae(i.center.lat,M);U=Se/Si(ke,Re(i.center.lat),Pe),q=Se*k/ke,U*=Be,q*=Be}}else U=V;Ge(n,n,[U,U,q]);const ee=[...n],oe=e.orientation,le=[];if(js(le,[oe[0]+(c?c[0]:0),oe[1]+(c?c[1]:0),oe[2]+(c?c[2]:0)],m),Le(n,ee,le),x&&i.elevation){let fe=0;const Ie=[];if(S&&i.elevation){fe=function(Pe,ke,Be,ot,Ze){const st=ke.elevation;if(!st)return 0;const dt=dn.projectAabbCorners(Be,ot),wt=se(1,Ze.lat)*ke.worldSize,Rt=function(Yt,Wt){const ji=[0,0,1],Kt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ai of Kt){const qi=Yt[Ai.corners[0]],fn=Yt[Ai.corners[1]],En=Yt[Ai.corners[2]],Zi=[fn[0]-qi[0],fn[1]-qi[1],Wt*(fn[2]-qi[2])],$n=Xi(Zi,Zi,[En[0]-qi[0],En[1]-qi[1],Wt*(En[2]-qi[2])]);mn($n,$n),Ai.dotProductWithUp=Ei($n,ji)}return Kt.sort((Ai,qi)=>Ai.dotProductWithUp-qi.dotProductWithUp),Kt[0].corners}(dt,wt),Mt=dt[Rt[0]],yt=dt[Rt[1]],Dt=dt[Rt[2]],nt=dt[Rt[3]],tt=st.getAtPointOrZero(new He(Mt[0]/ke.worldSize,Mt[1]/ke.worldSize),0),St=st.getAtPointOrZero(new He(yt[0]/ke.worldSize,yt[1]/ke.worldSize),0),It=st.getAtPointOrZero(new He(Dt[0]/ke.worldSize,Dt[1]/ke.worldSize),0),bt=st.getAtPointOrZero(new He(nt[0]/ke.worldSize,nt[1]/ke.worldSize),0),vt=(tt+bt)/2,ci=(St+It)/2;return vt>ci?St<It?qg(Pe,yt,nt,Mt,St,bt,tt,wt):qg(Pe,Dt,Mt,nt,It,tt,bt,wt):tt<bt?qg(Pe,Mt,yt,Dt,tt,St,It,wt):qg(Pe,nt,Dt,yt,bt,It,St,wt),Math.max(vt,ci)}(Ie,i,e.aabb,n,a);const Se=Le([],si([],Ie),le);Le(n,ee,Se)}else fe=i.elevation.getAtPointOrZero(new He(P.x/J,P.y/J),0);fe!==0&&(n[14]+=fe)}}class C1{constructor(e,i,a,c,m){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=i,this.position=a!=null?new j(a[0],a[1]):new j(0,0),this.orientation=c??[0,0,0],this.nodes=m,this.uploaded=!1,this.aabb=new dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){Le(e.globalMatrix,i,e.localMatrix);const a=this.nodeOverrides.get(e.name);if(a!==void 0){const g=[];m=a.orientation,xe(c=g),mt(c,c,hn(m[1])),Ct(c,c,hn(m[2])),Ye(c,c,hn(m[0])),Le(e.globalMatrix,e.globalMatrix,g)}var c,m;if(e.meshes)for(const g of e.meshes){const x=dn.applyTransformFast(g.aabb,e.globalMatrix);this.aabb.encapsulate(x)}if(e.children)for(const g of e.children)this._applyTransformations(g,e.globalMatrix)}computeBoundsAndApplyParent(){const e=xe([]);this.aabb=new dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.nodes)this._applyTransformations(i,e)}computeModelMatrix(e,i,a,c,m,g,x=!1){kd(this.matrix,this,e.transform,this.position,i,a,c,m,g,x)}upload(e){if(!this.uploaded){for(const i of this.nodes)eu(i,e);for(const i of this.nodes)rm(i);this.uploaded=!0}}destroy(){for(const e of this.nodes)Gy(e)}}function Uh(n,e,i=!1){n.uploaded||(n.gfxTexture=new Od(e,n.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function Xx(n,e,i){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,Wg.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,NS.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,CC.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?Wx:A1).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,qx.members,!0)),n.segments=oo.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const a=n.material;a.pbrMetallicRoughness.baseColorTexture&&Uh(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&Uh(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&Uh(a.normalTexture,e),a.occlusionTexture&&Uh(a.occlusionTexture,e,i),a.emissionTexture&&Uh(a.emissionTexture,e)}function eu(n,e,i){if(n.meshes)for(const a of n.meshes)Xx(a,e,i);if(n.children)for(const a of n.children)eu(a,e,i)}function rm(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)rm(e)}function Gy(n){if(n.meshes)for(const i of n.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const i of n.children)Gy(i)}function Pf(n,e){const i=n.json.bufferViews[e.bufferView],a=jx[e.componentType];return new a(n.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Uy[e.type]*a.BYTES_PER_ELEMENT?i.byteStride/a.BYTES_PER_ELEMENT:Uy[e.type]))}function Yx(n,e,i,a){const c=jx[e.componentType],m=function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),g=n.json.bufferViews[e.bufferView],x=g.byteStride?g.byteStride/c.BYTES_PER_ELEMENT:Uy[e.type],S=i.float32,C=S.length/i.capacity;for(let M=0,P=0;M<e.count*x;M+=x,P+=C)for(let k=0;k<C;k++)S[P+k]=a[M+k]*m;i._trim()}function Kx(n,e,i){const a=n.indices,c=n.attributes,m={};m.indexArray=new lr;const g=e.json.accessors[a],x=g.count/3;m.indexArray.reserve(x);const S=Pf(e,g);for(let k=0;k<x;k++)m.indexArray.emplaceBack(S[3*k],S[3*k+1],S[3*k+2]);m.indexArray._trim(),m.vertexArray=new zs;const C=e.json.accessors[c.POSITION];m.vertexArray.reserve(C.count);const M=Pf(e,C);for(let k=0;k<C.count;k++)m.vertexArray.emplaceBack(M[3*k],M[3*k+1],M[3*k+2]);if(m.vertexArray._trim(),m.aabb=new dn(C.min,C.max),m.centroid=function(k,V){const U=[0,0,0],q=k.length;if(q>0){for(let J=0;J<q;J++){const ee=3*k[J];U[0]+=V[ee],U[1]+=V[ee+1],U[2]+=V[ee+2]}U[0]/=q,U[1]/=q,U[2]/=q}return U}(S,M),c.COLOR_0!==void 0){const k=e.json.accessors[c.COLOR_0],V=Uy[k.type],U=Pf(e,k);m.colorArray=V===3?new zs:new ju,m.colorArray.resize(k.count),Yx(e,k,m.colorArray,U)}if(c.NORMAL!==void 0){m.normalArray=new zs;const k=e.json.accessors[c.NORMAL];m.normalArray.resize(k.count);const V=Pf(e,k);Yx(e,k,m.normalArray,V)}if(c.TEXCOORD_0!==void 0&&i.length>0){m.texcoordArray=new Hl;const k=e.json.accessors[c.TEXCOORD_0];m.texcoordArray.resize(k.count);const V=Pf(e,k);Yx(e,k,m.texcoordArray,V)}if(c._FEATURE_ID_RGBA4444!==void 0){const k=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=Pf(e,k))}c._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(Pf(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));const P=n.material;return m.material=function(k,V){const{emissiveFactor:U=[0,0,0],alphaMode:q="OPAQUE",alphaCutoff:J=.5,normalTexture:ee,occlusionTexture:oe,emissiveTexture:le,doubleSided:fe,name:Ie}=k,{baseColorFactor:Se=[1,1,1,1],metallicFactor:Pe=1,roughnessFactor:ke=1,baseColorTexture:Be,metallicRoughnessTexture:ot}=k.pbrMetallicRoughness||{},Ze=oe?V[oe.index]:void 0;if(oe&&oe.extensions&&oe.extensions.KHR_texture_transform&&Ze){const st=oe.extensions.KHR_texture_transform;Ze.offsetScale=[st.offset[0],st.offset[1],st.scale[0],st.scale[1]]}return{name:Ie,pbrMetallicRoughness:{baseColorFactor:new Qi(...Se),metallicFactor:Pe,roughnessFactor:ke,baseColorTexture:Be?V[Be.index]:void 0,metallicRoughnessTexture:ot?V[ot.index]:void 0},doubleSided:fe,emissiveFactor:new Qi(...U),alphaMode:q,alphaCutoff:J,normalTexture:ee?V[ee.index]:void 0,occlusionTexture:Ze,emissionTexture:le?V[le.index]:void 0,defined:k.defined===void 0}}(P!==void 0?e.json.materials[P]:{defined:!1},i),m}function I1(n,e,i){const{matrix:a,rotation:c,translation:m,scale:g,mesh:x,extras:S,children:C,name:M}=n,P={};if(P.name=M,P.localMatrix=a||function(k,V,U,q){var J=V[0],ee=V[1],oe=V[2],le=V[3],fe=J+J,Ie=ee+ee,Se=oe+oe,Pe=J*fe,ke=J*Ie,Be=J*Se,ot=ee*Ie,Ze=ee*Se,st=oe*Se,dt=le*fe,wt=le*Ie,Rt=le*Se,Mt=q[0],yt=q[1],Dt=q[2];return k[0]=(1-(ot+st))*Mt,k[1]=(ke+Rt)*Mt,k[2]=(Be-wt)*Mt,k[3]=0,k[4]=(ke-Rt)*yt,k[5]=(1-(Pe+st))*yt,k[6]=(Ze+dt)*yt,k[7]=0,k[8]=(Be+wt)*Dt,k[9]=(Ze-dt)*Dt,k[10]=(1-(Pe+ot))*Dt,k[11]=0,k[12]=U[0],k[13]=U[1],k[14]=U[2],k[15]=1,k}([],c||[0,0,0,1],m||[0,0,0],g||[1,1,1]),P.globalMatrix=ve(P.localMatrix),x!==void 0){P.meshes=i[x];const k=P.anchor=[0,0];for(const V of P.meshes){const{min:U,max:q}=V.aabb;k[0]+=U[0]+q[0],k[1]+=U[1]+q[1]}k[0]=Math.floor(k[0]/P.meshes.length/2),k[1]=Math.floor(k[1]/P.meshes.length/2)}if(S&&(S.id&&(P.id=S.id),S.lights&&(P.lights=function(k){if(!k.length)return[];const V=function(oe){const le=atob(oe),fe=new Uint8Array(le.length);for(let Ie=0;Ie<le.length;Ie++)fe[Ie]=le.codePointAt(Ie);return fe}(k),U=[],q=V.length/24,J=new Uint16Array(V.buffer),ee=new Float32Array(V.buffer);for(let oe=0;oe<q;oe++){const le=J[2*oe*6]/30,fe=J[2*oe*6+1]/30,Ie=J[2*oe*6+10]/100,Se=ee[6*oe+1],Pe=ee[6*oe+2],ke=ee[6*oe+3],Be=ee[6*oe+4],ot=ke-Se,Ze=Be-Pe,st=Math.hypot(ot,Ze);U.push({pos:[Se+.5*ot,Pe+.5*Ze,fe],normal:[Ze/st,-ot/st,0],width:st,height:le,depth:Ie,points:[Se,Pe,ke,Be]})}return U}(S.lights)),S.MAPBOX_geometry_bloom&&(P.isGeometryBloom=S.MAPBOX_geometry_bloom)),C){const k=[];for(const V of C)k.push(I1(e.json.nodes[V],e,i));P.children=k}return P}function IC(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new Dx(n.vertices,n.indices,8,256),[i,a]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:i,max:a}}function Of(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const a=[];for(const g of i){if(!Array.isArray(g)||g.length!==2)continue;const x=g[0],S=g[1];typeof x=="number"&&typeof S=="number"&&a.push(new Tt(x,S))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let c=0;for(let g=0;g<a.length;g++){const x=a[g],S=a[(g+1)%a.length],C=a[(g+2)%a.length];c+=(x.x-S.x)*(C.y-S.y)-(C.x-S.x)*(x.y-S.y)}c>0&&a.reverse();const m=Zp(a.flatMap(g=>[g.x,g.y]),[]);return m.length===0?null:{vertices:a,indices:m}}function Jx(n,e){const i=[],a=[];let c=0;const m=[];for(const g of n){c=i.length;const x=g.vertexArray.float32,S=g.indexArray.uint16;for(let C=0;C<g.vertexArray.length;C++)m[0]=x[3*C+0],m[1]=x[3*C+1],m[2]=x[3*C+2],on(m,m,e),i.push(new Tt(m[0],m[1]));for(let C=0;C<3*g.indexArray.length;C++)a.push(S[C]+c)}if(a.length%3!=0)return null;for(let g=0;g<a.length;g+=3){const x=i[a[g+0]],S=i[a[g+1]],C=i[a[g+2]];(x.x-S.x)*(C.y-S.y)-(C.x-S.x)*(x.y-S.y)>0&&([a[g+1],a[g+2]]=[a[g+2],a[g+1]])}return{vertices:i,indices:a}}function Zu(n){const e=function(S,C){const M=[],P=WebGL2RenderingContext;if(S.json.textures)for(const k of S.json.textures){const V={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};k.sampler!==void 0&&Object.assign(V,S.json.samplers[k.sampler]),M.push({image:C[k.source],sampler:V,uploaded:!1})}return M}(n,n.images),i=function(S,C){const M=[];for(const P of S.json.meshes){const k=[];for(const V of P.primitives)k.push(Kx(V,S,C));M.push(k)}return M}(n,e),{scenes:a,scene:c,nodes:m}=n.json,g=a?a[c||0].nodes:[...m.keys()],x=[];for(const S of g)x.push(I1(m[S],n,i));return function(S,C,M){const P={},k=new Set;for(let V=0;V<S.length;V++){const U=M[C[V]];if(!U.extras)continue;const q=U.extras["mapbox:footprint:version"],J=U.extras["mapbox:footprint:id"];(q||J)&&k.add(V),q==="1.0.0"&&J&&(P[J]=V)}for(let V=0;V<S.length;V++){if(k.has(V))continue;const U=S[V],q=M[C[V]];if(!q.extras)continue;let J=null;U.id in P&&(J=Jx(S[P[U.id]].meshes,U.localMatrix)),J||(J=Of(q)),J&&(U.footprint=IC(J))}if(k.size>0){const V=Array.from(k.values()).sort((U,q)=>U-q);for(let U=V.length-1;U>=0;U--)S.splice(V[U],1)}}(x,g,n.json.nodes),x}function R1(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,i=n.aabb.min[0]-1,a=n.aabb.min[1]-1,c=sl/(n.aabb.max[0]-i+2),m=sl/(n.aabb.max[1]-a+2);for(let g=0;g<e.length;g+=3){const x=e[g+2],S=(e[g+0]-i)*c|0,C=(e[g+1]-a)*m|0;x>n.heightmap[C*sl+S]&&(n.heightmap[C*sl+S]=x)}}function Qx(n,e,i,a,c){i.reserve(i.length+4*n.length),a.reserve(a.length+10*n.length),c.reserve(c.length+10*n.length);let m=a.length;for(const g of n){const x=Math.min(10,Math.max(4,1.3*g.height))*e,S=[-g.normal[1],g.normal[0],0],C=Math.min(.29,.1*g.width/g.depth),M=g.width-2*g.depth*e*(C+.01),P=pr([],g.pos,S,M/2),k=pr([],g.pos,S,-M/2),V=[P[0],P[1],P[2]+g.height],U=[k[0],k[1],k[2]+g.height],q=pr([],g.normal,S,C);pn(q,q,x);const J=pr([],g.normal,S,-C);pn(J,J,x),fi(q,P,q),fi(J,k,J),P[2]+=.1,k[2]+=.1,a.emplaceBack(q[0],q[1],q[2]),a.emplaceBack(J[0],J[1],J[2]),a.emplaceBack(P[0],P[1],P[2]),a.emplaceBack(k[0],k[1],k[2]),a.emplaceBack(V[0],V[1],V[2]),a.emplaceBack(U[0],U[1],U[2]),a.emplaceBack(P[0],P[1],P[2]),a.emplaceBack(k[0],k[1],k[2]),a.emplaceBack(q[0],q[1],q[2]),a.emplaceBack(J[0],J[1],J[2]);const ee=M/x/2;c.emplaceBack(-ee-C,-1,ee,.8),c.emplaceBack(ee+C,-1,ee,.8),c.emplaceBack(-ee,0,ee,1.3),c.emplaceBack(ee,0,ee,1.3),c.emplaceBack(ee+C,-.8,ee,.7),c.emplaceBack(ee+C,-.8,ee,.7),c.emplaceBack(0,0,ee,1.3),c.emplaceBack(0,0,ee,1.3),c.emplaceBack(ee+C,-1.2,ee,.8),c.emplaceBack(ee+C,-1.2,ee,.8),i.emplaceBack(6+m,4+m,8+m),i.emplaceBack(7+m,9+m,5+m),i.emplaceBack(0+m,1+m,2+m),i.emplaceBack(1+m,3+m,2+m),m+=10}}function VS(n,e){const i={};i.indexArray=new lr,i.vertexArray=new zs,i.colorArray=new ju,Qx(n,e,i.indexArray,i.vertexArray,i.colorArray);const a={defined:!0};a.emissiveFactor=Qi.black;const c={};return c.baseColorFactor=Qi.white,a.pbrMetallicRoughness=c,i.material=a,i.aabb=new dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const US=gn([{name:"a_pos_3f",components:3,type:"Float32"}]),jS=gn([{name:"a_normal_3",components:3,type:"Int16"}]),kf=gn([{name:"a_centroid_3",components:3,type:"Int16"}]),om=gn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Zg=gn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),e0=gn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),t0=gn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),tu=gn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),iu=gn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),Ff=At.types,nu=32767;function Fd(n,e){const i=Bt+e;for(const a of n)for(const c of a)if(c.x<-e||c.x>i||c.y<-e||c.y>i)return!1;return!0}class GS{constructor(){this.layoutVertexArray=new zs,this.layoutAttenuationArray=new ju,this.layoutColorArray=new jl,this.indexArray=new lr,this.indexArrayForConflation=new lr,this.segmentsBucket=new oo}}class D1{constructor(){this.layoutVertexArray=new zs,this.layoutNormalArray=new qc,this.layoutCentroidArray=new qc,this.layoutColorArray=new jl,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new jp,this.layoutAOArray=new Vu,this.indexArray=new lr,this.indexArrayForConflation=new lr,this.segmentsBucket=new oo,this.entranceBloom=new GS}}class HS{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new D1,this.buildingWithFacade=new D1,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new jl,this.buildingWithFacade.layoutFacadeDataArray=new wd,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new jl,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.groundEffect=new _1(e),this.groundEffect.groundRadiusArray=new Vu,this.hasAppearances=null}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}updateAppearances(e,i,a,c){}prepare(){return function(){if(Ux!=null||OS!=null)return null;if(jg!=null)return jg;const e=fetch(Sr.BUILDING_GEN_URL);return jg=function(i){let a,c,m,g;function x(){a=new Uint8Array(g.buffer),c=new Int32Array(g.buffer),m=new Float32Array(g.buffer)}function S(){throw new Error("Unexpected BuildingGen error.")}const C=()=>{},M={a:{a:S,f:function(P){const k=a.length,V=Math.max(P>>>0,Math.ceil(1.2*k)),U=Math.ceil((V-k)/65536);try{return g.grow(U),x(),!0}catch{return!1}},g:S,b:C,c:C,d:C,e:C}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,M):i.then(P=>P.arrayBuffer()).then(P=>WebAssembly.instantiate(P,M))).then(P=>{const k=P.instance.exports;return(0,k.g)(),g=k.f,x(),new bC({setStyle:k.h,setAOOptions:k.i,setMetricOptions:k.j,setStructuralOptions:k.k,setFacadeOptions:k.l,setFauxFacadeOptions:k.m,setFacadeClassifierOptions:k.n,addFeature:k.o,addFacade:k.p,generateMesh:k.q,getLastError:k.r,getOuterRingLength:k.s,getMeshCount:k.t,getPositionsPtr:k.u,getPositionsLength:k.v,getNormalsPtr:k.w,getNormalsLength:k.x,getColorsPtr:k.y,getColorsLength:k.z,getAOPtr:k.A,getAOLength:k.B,getUVPtr:k.C,getUVLength:k.D,getFauxFacadePtr:k.E,getFauxFacadeLength:k.F,getIndicesPtr:k.G,getIndicesLength:k.H,getBuildingPart:k.I,getRingCount:k.J,getRingPtr:k.K,getRingLength:k.L,free:k.M,malloc:k.N,heapU8:a,heap32:c,heapF32:m})})}(e).then(i=>(jg=null,Ux=i,Ux)).catch(i=>{ei("Could not load building-gen"),jg=null,OS=i}),jg}()}populate(e,i,a,c){const m=wC();if(!m)return;const g=De(a);this.tileToMeter=g,this.brightness=i.brightness,m.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,g],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:g,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),m.setAOOptions(!1,.3),m.setMetricOptions(!1,16),m.setStructuralOptions(!0),m.setFacadeClassifierOptions(3);const x=new Map,S=new Map;for(const{feature:C}of e){if(Ff[C.type]!=="LineString"){x.set(C.id,C.properties.source_id);continue}const M=this.layers[0]._featureFilter.needGeometry,P=et(C,M);if(!this.layers[0]._featureFilter.filter(new Ar(this.zoom),P,a))continue;const k=M?P.geometry:ct(C,a,c),V=[];for(const ee of k)for(const oe of ee)V.push({x:oe.x,y:oe.y});const U={coordinates:V,crossPerc:C.properties.cross_perc,distanceToRoad:C.properties.distance_to_road,entrances:C.properties.entrances,sourceId:0},q=C.properties.source_id;let J=S.get(q);J||(J=[],S.set(q,J)),J.push(U)}this.maxHeight=0;for(const{feature:C,id:M,index:P,sourceLayerIndex:k}of e){if(Ff[C.type]==="LineString")continue;const V=this.layers[0]._featureFilter.needGeometry,U=et(C,V);if(!this.layers[0]._featureFilter.filter(new Ar(this.zoom),U,a))continue;const q=V?U.geometry:ct(C,a,c),J=Rs(q,500);if(!Fd(q,163))continue;const ee=this.layers[0],oe=ee.layout.get("building-roof-shape").evaluate(C,{},a);if(oe==="flat")continue;const le=ee.layout.get("building-base").evaluate(C,{},a),fe=ee.layout.get("building-height").evaluate(C,{},a),Ie=ee.layout.get("building-flood-light-ground-radius").evaluate(C,{},a),Se=ee.paint.get("building-ambient-occlusion-intensity"),Pe=Ie/this.tileToMeter;let ke=ee.layout.get("building-flood-light-wall-radius").evaluate(C,{},a);ke=Y(ke,0,2048);const Be=ke/2048*nu,ot=x.get(M);let Ze;Ze=S.has(ot)?S.get(ot):[];const st=Ze.length!==0&&ee.layout.get("building-facade").evaluate(C,{},a);m.setFacadeOptions(4,!0),m.setFauxFacadeOptions(st,!1,1);let dt=0,wt=0,Rt=0,Mt=0,yt=0,Dt=0;if(st){let ut=Math.round(ee.layout.get("building-facade-floors").evaluate(C,{},a));if(le===0){ut=Math.max(1,ut-(Ze.length>0?1:0));let wi=4;if(fe>100){const vi=[10,13,15];wi=vi[C.id?C.id%vi.length:0],m.setFacadeOptions(wi,!0)}yt=1.6803*wi/g}else yt=le/g;Dt=fe/g,yt=Math.min(yt,Dt),Rt=ee.layout.get("building-facade-unit-width").evaluate(C,{},a)/g,Mt=(Dt-yt)/ut,m.setFauxFacadeOptions(!0,!0,Rt);const qt=ee.layout.get("building-facade-window").evaluate(C,{},a);dt=qt[0],wt=qt[1]}const nt=[],tt=new Tt(1/0,1/0),St=new Tt(-1/0,-1/0),It=new Tt(0,0);let bt=0;for(const ut of J)if(ut.length>0){const qt=[];for(const wi of ut){const vi=[];for(let Ki=wi.length-1;Ki>=0;Ki--){const Li=wi[Ki];vi.push({x:Li.x,y:Li.y}),tt.x=Math.min(tt.x,Li.x),tt.y=Math.min(tt.y,Li.y),St.x=Math.max(St.x,Li.x),St.y=Math.max(St.y,Li.y),It.x+=Li.x,It.y+=Li.y,bt++}qt.push(vi)}nt.push({id:C.id?C.id:0,height:fe,minHeight:le,sourceId:0,roofType:oe,coordinates:qt})}It.x/=bt||1,It.y/=bt||1;const vt=m.generateMesh(nt,Ze);if(typeof vt=="string"){ei(`Unable to generate building ${C.id}: ${vt}`);continue}if(vt.meshes.length===0||vt.modifiedPolygonRings.length===0)continue;let ci=0;for(const ut of vt.meshes)ci+=ut.positions.length/3;const Yt=st?this.buildingWithFacade:this.buildingWithoutFacade,Wt=Yt.segmentsBucket.prepareSegment(ci,Yt.layoutVertexArray,Yt.indexArray),ji=[];let Kt=null,Ai=0,qi=-1;const fn=Yt.layoutVertexArray.length,En=Yt.indexArray.length;let Zi=0;for(const ut of vt.meshes){const qt=Yt.layoutVertexArray.length;if(ut.buildingPart==="entrance"){const gi=new Array;for(let Fn=0;Fn<ut.positions.length;Fn+=12){const yr=ut.positions[Fn+0],or=ut.positions[Fn+1],ar=ut.positions[Fn+3],fr=ut.positions[Fn+4],Mr=ut.positions[Fn+2],Un=ut.positions[Fn+8]-Mr,qn=1,en=ar-yr,Qn=fr-or,Ir=Math.hypot(en,Qn);gi.push({pos:[yr+.5*en,or+.5*Qn,Mr],normal:[Qn/Ir,-en/Ir,0],width:Ir,height:Un,depth:qn,points:[yr,or,ar,fr]})}const Wn=Yt.entranceBloom.segmentsBucket.prepareSegment(10*gi.length,Yt.entranceBloom.layoutVertexArray,Yt.entranceBloom.indexArray),xr=Yt.entranceBloom.layoutVertexArray.length;Ai=Yt.entranceBloom.indexArray.length,Qx(gi,.5/this.tileToMeter,Yt.entranceBloom.indexArray,Yt.entranceBloom.layoutVertexArray,Yt.entranceBloom.layoutAttenuationArray);const zi=Yt.entranceBloom.layoutVertexArray.length-xr;qi=Yt.entranceBloom.indexArray.length-Ai;for(let Fn=0;Fn<zi;Fn++)Yt.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Wn.vertexLength+=zi,Wn.primitiveLength+=qi,Kt={part:ut.buildingPart,vertexOffset:xr,vertexLength:zi}}for(let gi=0;gi<ut.positions.length;gi+=3)Zi=Math.max(Zi,ut.positions[gi+2]),Yt.layoutVertexArray.emplaceBack(ut.positions[gi],ut.positions[gi+1],ut.positions[gi+2]);const wi=Math.floor(It.x),vi=Math.floor(It.y),Ki=Math.floor(Zi);for(let gi=0;gi<ut.positions.length;gi+=3)Yt.layoutCentroidArray.emplaceBack(wi,vi,Ki),Yt.layoutFloodLightDataArray.emplaceBack(ut.buildingPart==="wall"?Be:0);for(let gi=0;gi<ut.normals.length;gi+=3)Yt.layoutNormalArray.emplaceBack(ut.normals[gi+0]*nu,ut.normals[gi+1]*nu,ut.normals[gi+2]*nu);for(let gi=0;gi<ut.ao.length;gi++)Yt.layoutAOArray.emplaceBack(ut.ao[gi]);for(let gi=0;gi<ut.colors.length;gi+=3){const Wn=1+(ut.ao[gi/3]-1)*Se;Yt.layoutColorArray.emplaceBack(ut.colors[gi]*Wn<<8|ut.colors[gi+1]*Wn,ut.colors[gi+2]*Wn<<8)}if(st){for(let gi=0;gi<ut.positions.length;gi+=3)Yt.layoutFacadePaintArray.emplaceBack(65535,255);for(let gi=0;gi<ut.isFauxFacade.length;gi++)if(ut.isFauxFacade[gi]){const Wn=1|Math.min(65535,Math.floor(ut.uv[2*gi]*vt.outerRingLength)),xr=Math.floor(255*dt)<<8|Math.floor(255*wt),zi=Math.floor(65535*Math.min(1,Rt/Bt)),Fn=Math.floor(65535*Math.min(1,Mt/Bt));Yt.layoutFacadeDataArray.emplaceBack(Wn,xr,zi,Fn);const yr=Math.floor(65535*Math.min(1,yt/Bt)),or=Math.floor(65535*Math.min(1,Dt/Bt));Yt.layoutFacadeVerticalRangeArray.emplaceBack(yr,or)}else Yt.layoutFacadeDataArray.emplaceBack(0,0,0,0),Yt.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Li=Wt.vertexLength;for(let gi=0;gi<ut.indices.length;gi+=3)Yt.indexArray.emplaceBack(Li+ut.indices[gi],Li+ut.indices[gi+1],Li+ut.indices[gi+2]);Wt.vertexLength+=ut.positions.length/3,Wt.primitiveLength+=ut.indices.length/3,(ut.buildingPart==="roof"||ut.buildingPart==="wall"||ut.buildingPart==="facade_glazing"||ut.buildingPart==="entrance")&&ji.push({part:ut.buildingPart,vertexOffset:qt,vertexLength:ut.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Zi),this.buildingFeatures.push({promoteId:M,feature:U,hasFauxFacade:st,segment:Wt,parts:ji,buildingBloom:Kt});const $n=Yt.indexArray.length-En,Jn=[],eo=[],Ee=new Tt(1/0,1/0),be=new Tt(-1/0,-1/0),at=this.groundEffect.vertexArray.length;for(const ut of vt.modifiedPolygonRings){const qt=[],wi=new Tt(1/0,1/0),vi=new Tt(-1/0,-1/0);for(let Ki=0;Ki<ut.length;Ki+=2){const Li=ut.length-Ki-2;wi.x=Math.min(wi.x,ut[Li]),wi.y=Math.min(wi.y,ut[Li+1]),vi.x=Math.max(vi.x,ut[Li]),vi.y=Math.max(vi.y,ut[Li+1]);const gi=new Tt(ut[Li],ut[Li+1]);qt.push(gi),Jn.push(gi.x,gi.y),eo.push(gi.clone())}Ee.x=Math.min(Ee.x,wi.x),Ee.y=Math.min(Ee.y,wi.y),be.x=Math.max(be.x,vi.x),be.y=Math.max(be.y,vi.y),this.groundEffect.addData(qt,[wi,vi],Pe)}const Gt=this.groundEffect.vertexArray.length-at;for(let ut=0;ut<Gt;ut++)this.groundEffect.groundRadiusArray.emplaceBack(Ie);(tt.x<0||St.x>Bt||tt.y<0||St.y>Bt)&&this.featuresOnBorder.push({featureId:C.id,footprintIndex:this.footprints.length});{const ut=Zp(Jn,null,2),qt=new Dx(eo,ut,8,256);let wi=C.id;C.properties&&C.properties.hasOwnProperty("building_id")&&(wi=C.properties.building_id);const vi={vertices:eo,indices:ut,grid:qt,min:Ee,max:be,buildingId:wi,hiddenFlags:0,indicesOffset:En,indicesLength:$n,bloomIndicesOffset:Ai,bloomIndicesLength:qi,groundEffectVertexOffset:at,groundEffectVertexLength:Gt,hasFauxFacade:st,segment:Wt,height:Zi};C.id!==void 0&&this.featureFootprintLookup.set(C.id,this.footprints.length),this.footprints.push(vi)}this.programConfigurations.populatePaintArrays(Yt.layoutVertexArray.length,C,P,{},i.availableImages,a,i.brightness),this.groundEffect.addPaintPropertiesData(C,P,{},i.availableImages,a,i.brightness),i.featureIndex.insert(C,q,P,k,this.index,fn)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,i,a,c,m,g,x){this.programConfigurations.updatePaintArrays(e,i,m,a,c,g,x),this.groundEffect.update(e,i,m,a,c,g,x),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=a=>{a.layoutVertexBuffer=e.createVertexBuffer(a.layoutVertexArray,US.members),a.layoutNormalBuffer=e.createVertexBuffer(a.layoutNormalArray,jS.members),a.layoutCentroidBuffer=e.createVertexBuffer(a.layoutCentroidArray,kf.members),a.layoutFloodLightDataBuffer=e.createVertexBuffer(a.layoutFloodLightDataArray,iu.members),a.layoutFacadeDataArray&&a.layoutFacadeDataArray.length&&(a.layoutFacadeDataBuffer=e.createVertexBuffer(a.layoutFacadeDataArray,e0.members)),a.layoutFacadeVerticalRangeArray&&a.layoutFacadeVerticalRangeArray.length&&(a.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(a.layoutFacadeVerticalRangeArray,t0.members)),a.entranceBloom.layoutVertexArray.length&&(a.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(a.entranceBloom.layoutVertexArray,US.members),a.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(a.entranceBloom.layoutAttenuationArray,tu.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,a=!0){let c=!1;const m=a?i:0,g=0|(a?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const x of e){const S=this.footprints[x],C=S.hiddenFlags&g|m;S.hiddenFlags!==C&&(S.hiddenFlags=C,c=!0,this.groundEffect.updateHiddenByLandmarkRange(S.groundEffectVertexOffset,S.groundEffectVertexLength,S.hiddenFlags!==0))}return c&&(this.indexArrayForConflationUploaded=!1),c}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=c=>{c.indexArray.length!==0&&(c.indexArrayForConflation.resize(c.indexArray.length),c.indexArrayForConflation.uint16.set(c.indexArray.uint16),c.entranceBloom.indexArrayForConflation.resize(c.entranceBloom.indexArray.length),c.entranceBloom.indexArrayForConflation.uint16.set(c.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const c of this.footprints){const m=c.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,g=c.indicesOffset+c.indicesLength;if(c.hiddenFlags!==0){for(let S=c.indicesOffset;S<g;S++)m.indexArrayForConflation.uint16[3*S+0]=0,m.indexArrayForConflation.uint16[3*S+1]=0,m.indexArrayForConflation.uint16[3*S+2]=0;const x=c.bloomIndicesOffset+c.bloomIndicesLength;for(let S=c.bloomIndicesOffset;S<x;S++)m.entranceBloom.indexArrayForConflation.uint16[3*S+0]=0,m.entranceBloom.indexArrayForConflation.uint16[3*S+1]=0,m.entranceBloom.indexArrayForConflation.uint16[3*S+2]=0}}const a=c=>{c.indexArray.length!==0&&(c.indexBuffer?c.indexBuffer.updateData(c.indexArrayForConflation):c.indexBuffer=e.createIndexBuffer(c.indexArrayForConflation,!0),c.entranceBloom.indexBuffer?c.entranceBloom.indexBuffer.updateData(c.entranceBloom.indexArrayForConflation):c.entranceBloom.indexBuffer=e.createIndexBuffer(c.entranceBloom.indexArrayForConflation,!0))};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=a=>{a.layoutColorBuffer?a.layoutColorBuffer.updateData(a.layoutColorArray):a.layoutColorBuffer=e.createVertexBuffer(a.layoutColorArray,om.members,!0),a.layoutFacadePaintArray&&(a.layoutFacadePaintBuffer?a.layoutFacadePaintBuffer.updateData(a.layoutFacadePaintArray):a.layoutFacadePaintBuffer=e.createVertexBuffer(a.layoutFacadePaintArray,Zg.members,!0)),a.entranceBloom.layoutColorBuffer?a.entranceBloom.layoutColorBuffer.updateData(a.entranceBloom.layoutColorArray):a.entranceBloom.layoutColorBuffer=e.createVertexBuffer(a.entranceBloom.layoutColorArray,om.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const a=e.paint.get("building-ambient-occlusion-intensity");for(const c of this.buildingFeatures){const m=i[c.promoteId],g=c.feature;g.properties["building-part"]="roof";const x=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),S=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="wall";const C=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),M=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="window";const P=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),k=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="door";const V=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),U=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical),q=c.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const ee of c.parts){let oe,le=x;ee.part==="roof"?(le=x,oe=S):ee.part==="wall"?(le=C,oe=M):ee.part==="facade_glazing"?(le=P,oe=k):ee.part==="entrance"&&(le=V,oe=U),oe=Y(oe,0,1);for(let fe=0;fe<ee.vertexLength;fe++){const Ie=ee.vertexOffset+fe,Se=1+(q.layoutAOArray.float32[Ie]-1)*a;q.layoutColorArray.emplace(Ie,le.r*Se*255<<8|le.g*Se*255,le.b*Se*255<<8|255*oe),c.hasFauxFacade&&q.layoutFacadePaintArray.emplace(Ie,255*P.r<<8|255*P.g,255*P.b<<8|255*k)}}const J=c.buildingBloom;if(J)for(let ee=0;ee<J.vertexLength;ee++)q.entranceBloom.layoutColorArray.emplace(J.vertexOffset+ee,255*V.r<<8|255*V.g,255*V.b<<8|51*U)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const c=i.getReplacementRegionsForTile(e.toUnwrapped());if(My(this.activeReplacements,c))return;this.activeReplacements=c;for(const g of this.footprints)g.hiddenFlags&=-2;const m=[];for(const g of this.activeReplacements){if(g.order<=Mx)continue;const x=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));for(const S of this.footprints)S.min.x>g.max.x||S.max.x<g.min.x||S.min.y>g.max.y||S.max.y<g.min.y||(m.length=0,am(S.vertices,0,S.vertices.length,g.footprintTileId.canonical,e.canonical,m),Px(g.footprint,m,S.indices,0,S.indices.length,0,-x)&&(S.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const g of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(g.groundEffectVertexOffset,g.groundEffectVertexLength,g.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const i=this.featureFootprintLookup.get(e.id);return this.footprints[i]}return null}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,c=!0;const m=4*(e+Bt)*Bt+(i+Bt);if(this.footprintLookup.hasOwnProperty(m)){const x=this.footprintLookup[m];return x?{height:x.height,hidden:x.hiddenFlags!==0}:void 0}const g=new Tt(e,i);for(const x of this.footprints)e>x.max.x||x.min.x>e||i>x.max.y||x.min.y>i||x.height<=a||Ox(g,x)&&(a=x.height,this.footprintLookup[m]=x,c=x.hiddenFlags!==0);if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:c};this.footprintLookup[m]=void 0}}function am(n,e,i,a,c,m){const g=Math.pow(2,a.z-c.z);for(let x=0;x<i;x++){let S=n[x+e].x,C=n[x+e].y;S=(S+c.x*Bt)*g-a.x*Bt,C=(C+c.y*Bt)*g-a.y*Bt,m.push(new Tt(S,C))}}let M1,i0;li(HS,"BuildingBucket",{omit:["layers"]}),li(D1,"BuildingGeometry"),li(GS,"BuildingBloomGeometry");const n0=gn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),RC=gn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:P1}=n0,DC=gn([{name:"a_packed",components:3,type:"Float32"}]),{members:MC}=DC,sm=gn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Gs}=sm;class gc{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Lh({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const a=this.getKey(e,i);return this.positions[a]}trim(){const e=this.width,i=this.height=ze(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){const c=[];let m=e.length%2==1?-e[e.length-1]*a:0,g=e[0]*a,x=!0;c.push({left:m,right:g,isDash:x,zeroLength:e[0]===0});let S=e[0];for(let C=1;C<e.length;C++){x=!x;const M=e[C];m=S*a,S+=M,g=S*a,c.push({left:m,right:g,isDash:x,zeroLength:M===0})}return c}addRoundDash(e,i,a){const c=i/2;for(let m=-a;m<=a;m++){const g=this.width*(this.nextRow+a+m);let x=0,S=e[x];for(let C=0;C<this.width;C++){C/S.right>1&&(S=e[++x]);const M=Math.abs(C-S.left),P=Math.abs(C-S.right),k=Math.min(M,P);let V;const U=m/a*(c+1);if(S.isDash){const q=c-Math.abs(U);V=Math.sqrt(k*k+q*q)}else V=c-Math.sqrt(k*k+U*U);this.image.data[g+C]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(e,i){for(let S=e.length-1;S>=0;--S){const C=e[S],M=e[S+1];C.zeroLength?e.splice(S,1):M&&M.isDash===C.isDash&&(M.left=C.left,e.splice(S,1))}const a=e[0],c=e[e.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const m=this.width*this.nextRow;let g=0,x=e[g];for(let S=0;S<this.width;S++){S/x.right>1&&(x=e[++g]);const C=Math.abs(S-x.left),M=Math.abs(S-x.right),P=Math.min(C,M);this.image.data[m+S]=Math.max(0,Math.min(255,(x.isDash?P:-P)+i+128))}}addDash(e,i){const a=this.getKey(e,i);if(this.positions[a])return this.positions[a];const c=i==="round",m=c?7:0,g=2*m+1;if(this.nextRow+g>this.height)return ei("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let M=0;M<e.length;M++)e[M]<0&&(ei("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),x+=e[M];if(x!==0){const M=this.width/x,P=this.getDashRanges(e,this.width,M);c?this.addRoundDash(P,M,m):this.addRegularDash(P,i==="square"?.5*M:0)}const S=this.nextRow+m;this.nextRow+=g;const C={tl:[S,m],br:[x,0]};return this.positions[a]=C,C}}li(gc,"LineAtlas");const Xu=At.types,lm=Math.cos(Math.PI/180*37.5),Lf=Math.cos(Math.PI/180*5);class O1{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new yg,this.layoutVertexArray2=new zs,this.patternVertexArray=new zs,this.indexArray=new lr,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new oo,this.maxLineLength=0,this.zOffsetVertexArray=new zs,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Bt/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,c){}populate(e,i,a,c){this.hasPattern=Nh("line",this.layers,this.pixelRatio,i);const m=this.layers[0].layout.get("line-sort-key");this.tileToMeter=De(a);const g=this.layers[0].layout.get("line-elevation-reference");if(g==="hd-road-markup")this.elevationType="road";else{const k=this.layers[0].layout.get("line-z-offset"),V=k.isConstant()&&!k.constantOr(0);this.elevationType=g!=="sea"&&g!=="ground"&&V?"none":"offset",this.elevationType==="offset"&&g==="none"&&ei(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&x!==void 0;const S=[];for(const{feature:k,id:V,index:U,sourceLayerIndex:q}of e){const J=this.layers[0]._featureFilter.needGeometry,ee=et(k,J);if(!this.layers[0]._featureFilter.filter(new Ar(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),ee,a))continue;const oe=m?m.evaluate(ee,{},a):void 0,le={id:V,properties:k.properties,type:k.type,sourceLayerIndex:q,index:U,geometry:J?ee.geometry:ct(k,a,c),patterns:{},sortKey:oe};S.push(le)}m&&S.sort((k,V)=>k.sortKey-V.sortKey);const{lineAtlas:C,featureIndex:M}=i,P=this.addConstantDashes(C);for(const k of S){const{geometry:V,index:U,sourceLayerIndex:q}=k;if(P&&this.addFeatureDashes(k,C),this.hasPattern){const J=Ix("line",this.layers,k,this.zoom,this.pixelRatio,i);this.patternFeatures.push(J)}else this.addFeature(k,V,U,a,C.positions,i.availableImages,i.brightness,i.elevationFeatures);M.insert(e[U].feature,V,U,q,this.index)}}addConstantDashes(e){let i=!1;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,m=a.layout.get("line-cap").value;if(c.kind!=="constant"||m.kind!=="constant")i=!0;else{const g=m.value,x=c.value;if(!x)continue;e.addDash(x,g)}}return i}addFeatureDashes(e,i){const a=this.zoom;for(const c of this.layers){const m=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if(m.kind==="constant"&&g.kind==="constant")continue;let x,S;if(m.kind==="constant"){if(x=m.value,!x)continue}else x=m.evaluate({zoom:a},e);S=g.kind==="constant"?g.value:g.evaluate({zoom:a},e),i.addDash(x,S),e.patterns[c.id]=[i.getKey(x,S)]}}update(e,i,a,c,m,g,x,S){this.programConfigurations.updatePaintArrays(e,i,m,a,c,g,x,S)}addFeatures(e,i,a,c,m,g){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,a,c,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,MC)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Gs)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,RC.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,P1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let a,c;if(i&&i>0?(a=`mapbox_clip_start_${i}`,c=`mapbox_clip_end_${i}`):(a="mapbox_clip_start",c="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(a)&&e.properties.hasOwnProperty(c))return{start:+e.properties[a],end:+e.properties[c]}}addFeature(e,i,a,c,m,g,x,S){const C=this.layers[0].layout,M=C.get("line-join").evaluate(e,{}),P=C.get("line-cap").evaluate(e,{}),k=C.get("line-miter-limit"),V=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const U=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=C.get("line-z-offset").value;const q=this.layers[0].paint.get("line-width").value;if(q.kind!=="constant"&&q.isLineProgressConstant===!1&&(this.variableWidthValue=q),this.elevationType==="road"){const J=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,c,S,M,P,k,V)){const[ee,oe]=this.clipRuntimeLinesToTile(i,1);for(let le=0;le<ee.length;le++){const fe=ee[le],Ie=oe[le],Se={progress:{min:Ie.progress.min,max:Ie.progress.max},nextDir:this.computeSegNextDir(Ie,fe),prevDir:this.computeSegPrevDir(Ie,fe)};this.addLine(fe,e,c,M,P,k,V,Se,U&&Ie.parentIndex>0?Ie.parentIndex:null)}this.fillNonElevatedRoadSegment(J)}}else for(let J=0;J<i.length;J++)this.addLine(i[J],e,c,M,P,k,V,void 0,U&&J>0?J:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,g,c,x,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return Nx(e,-i,-i,Bt+i,Bt+i)}clipRuntimeLinesToTile(e,i){const a=[];return[Nx(e,-i,-i,Bt+i,Bt+i,a),a]}addElevatedRoadFeature(e,i,a,c,m,g,x,S){const C=[],M=Bi.getElevationFeature(e,c);if(M){const P=this.clipLinesToTile(i,1),k=this.prepareElevatedLines(P,M,a);for(const V of k)C.push({geometry:V,elevation:M,elevationTileID:a,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(C.length===0)return!1;for(const P of C){const k=this.layoutVertexArray.length;this.addLine(P.geometry,e,a,m,g,x,S);const V=new Bn(a,P.elevationTileID);if(P.elevation)for(let U=k;U<this.layoutVertexArray.length;U++){const q=new Tt(this.layoutVertexArray.int16[6*U]>>1,this.layoutVertexArray.int16[6*U+1]>>1),J=V.pointElevation(q,P.elevation,.05);this.updateHeightRange(J),this.zOffsetVertexArray.emplaceBack(J,0,0)}else this.fillNonElevatedRoadSegment(k)}return!0}prepareElevatedLines(e,i,a){if(i.constantHeight!=null)return e;const c=[],m=1/De(a);for(const g of e)vC(g,new zr(i,m),0,c);return c}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,a,c,m,g,x,S,C){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=C?this.lineFeatureClips(i,C):this.lineClips;const M=c==="none";this.patternJoinNone=this.hasPattern&&M,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const P=S&&S.progress.min>0,k=S&&S.progress.max<1;if(this.lineClips){let Be={min:this.lineClips.start,max:this.lineClips.end},ot=1;if(S){const dt=this.lineClips.end-this.lineClips.start;Be=function(wt,Rt,Mt){return{min:sr(wt.min,Rt,Mt),max:sr(wt.max,Rt,Mt)}}(S.progress,{min:0,max:1},Be),dt>0&&(ot=(Be.max-Be.min)/dt)}const Ze=+i.properties.mapbox_clip_feature_len,st=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Ze)||Number.isNaN(st)){for(let wt=0;wt<e.length-1;wt++)this.totalDistance+=e[wt].dist(e[wt+1]);const dt=this.totalDistance/(Be.max-Be.min);this.totalFeatureLength=Number.isFinite(dt)?dt:0,this.lineClips.start=Be.min,this.lineClips.end=Be.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ze,this.distance=st*ot,this.lineClips.start=Be.min,this.lineClips.end=Be.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const V=Xu[i.type]==="Polygon";let U=e.length;for(;U>=2&&e[U-1].equals(e[U-2]);)U--;let q=0;for(;q<U-1&&e[q].equals(e[q+1]);)q++;if(U<(V?3:2))return;c==="bevel"&&(g=1.05);const J=this.segments.prepareSegment(10*U,this.layoutVertexArray,this.indexArray);let ee,oe,le,fe,Ie,Se,Pe,ke;S&&S.prevDir&&(Se=S.prevDir.perp()),S&&S.nextDir&&(Pe=S.nextDir.perp()),this.e1=this.e2=-1,V&&(ee=e[U-2],Ie=e[q].sub(ee)._unit()._perp());for(let Be=q;Be<U;Be++){if(le=Be===U-1?V?e[q+1]:void 0:e[Be+1],le&&e[Be].equals(le))continue;Ie&&(fe=Ie),ee&&(oe=ee),ee=e[Be],ke=this.evaluateLineProgressFeatures(oe?oe.dist(ee):0),Ie=le?le.sub(ee)._unit()._perp():fe,fe=fe||Ie;const ot=oe&&le;let Ze=ot?c:V||M?"butt":m;const st=fe.x*Ie.x+fe.y*Ie.y;if(M){const tt=function(St){if(St.patternJoinNone){const It=St.segmentPoints.length/2,bt=St.lineSoFar-St.segmentStart;for(let vt=0;vt<It;++vt){const ci=St.segmentPoints[2*vt+1],Yt=Math.round(St.segmentPoints[2*vt])+.5+.25*ci;St.patternVertexArray.emplaceBack(Yt,bt,St.segmentStart),St.patternVertexArray.emplaceBack(Yt,bt,St.segmentStart)}St.segmentPoints.length=0}St.e1=St.e2=-1};if(ot&&st<Lf){this.updateDistance(oe,ee),this.addCurrentVertex(ee,fe,1,1,J,ke),tt(this),this.addCurrentVertex(ee,Ie,-1,-1,J,ke);continue}if(oe){if(!le){this.updateDistance(oe,ee),this.addCurrentVertex(ee,fe,1,1,J,ke),tt(this);continue}Ze="miter"}}let dt=fe.add(Ie);dt.x===0&&dt.y===0||dt._unit();const wt=dt.x*Ie.x+dt.y*Ie.y,Rt=wt!==0?1/wt:1/0,Mt=2*Math.sqrt(2-2*wt),yt=wt<lm&&oe&&le,Dt=fe.x*Ie.y-fe.y*Ie.x>0,nt=this.overscaling<=16?15*Bt/(512*this.overscaling):0;if(ot&&Ze==="round"){if(Rt<x)Ze="miter";else if(Rt<=2){const tt=r0(ee,-10,Bt+10);Ze=this.elevationType==="offset"&&(tt||this.hasCrossSlope)?"miter":"fakeround"}}if(Ze==="miter"&&Rt>g&&(Ze="bevel"),Ze==="bevel"&&(Rt>2&&(Ze="flipbevel"),Rt<g&&(Ze="miter")),oe&&!(Ze==="miter"&&yt)&&this.updateDistance(oe,ee),Ze==="miter")if(yt){const tt=ee.dist(oe);if(tt>2*nt){const It=ee.sub(ee.sub(oe)._mult(nt/tt)._round());this.updateDistance(oe,It),this.addCurrentVertex(It,fe,0,0,J,ke),oe=It}this.updateDistance(oe,ee),dt._mult(Rt),this.addCurrentVertex(ee,dt,0,0,J,ke);const St=ee.dist(le);if(St>2*nt){const It=ee.add(le.sub(ee)._mult(nt/St)._round());this.updateDistance(ee,It),this.addCurrentVertex(It,Ie,0,0,J,ke),ee=It}}else dt._mult(Rt),this.addCurrentVertex(ee,dt,0,0,J,ke);else if(Ze==="flipbevel"){if(Rt>100)dt=Ie.mult(-1);else{const tt=Rt*fe.add(Ie).mag()/fe.sub(Ie).mag();dt._perp()._mult(tt*(Dt?-1:1))}this.addCurrentVertex(ee,dt,0,0,J,ke),this.addCurrentVertex(ee,dt.mult(-1),0,0,J,ke)}else if(Ze==="bevel"||Ze==="fakeround"){ke!=null&&oe&&this.addCurrentVertex(ee,Pe||fe,-1,-1,J,ke);const tt=ee.dist(oe)<=2*nt&&Ze!=="bevel",St=dt.mult(Dt?1:-1);St._mult(Rt);const It=Ie.mult(Dt?-1:1),bt=fe.mult(Dt?-1:1),vt=this.evaluateLineProgressFeatures(this.distance);if(ke==null&&(this.addHalfVertex(ee,St.x,St.y,!1,!Dt,0,J,vt),tt||this.addHalfVertex(ee,St.x+2*bt.x,St.y+2*bt.y,!1,Dt,0,J,vt)),Ze==="fakeround"){const ci=Math.round(180*Mt/Math.PI/20);this.addHalfVertex(ee,bt.x,bt.y,!1,Dt,0,J,vt);for(let Yt=0;Yt<ci;Yt++){let Wt=Yt/ci;if(Wt!==.5){const Kt=Wt-.5;Wt+=Wt*Kt*(Wt-1)*((1.0904+st*(st*(3.55645-1.43519*st)-3.2452))*Kt*Kt+(.848013+st*(.215638*st-1.06021)))}const ji=It.sub(bt)._mult(Wt)._add(bt)._unit();this.addHalfVertex(ee,ji.x,ji.y,!1,Dt,0,J,vt)}this.addHalfVertex(ee,It.x,It.y,!1,Dt,0,J,vt)}tt||ke!=null||this.addHalfVertex(ee,St.x+2*It.x,St.y+2*It.y,!1,Dt,0,J,vt),ke!=null&&le&&this.addCurrentVertex(ee,Se||Ie,1,1,J,ke)}else if(Ze==="butt")this.addCurrentVertex(ee,dt,0,0,J,ke);else if(Ze==="square"){if(!oe){const tt=P?0:-1;this.addCurrentVertex(ee,dt,tt,tt,J,ke)}if(this.addCurrentVertex(ee,dt,0,0,J,ke),oe){const tt=k?0:1;this.addCurrentVertex(ee,dt,tt,tt,J,ke)}}else if(Ze==="round"){if(oe){const tt=!ot&&Pe?Pe:fe;this.addCurrentVertex(ee,tt,0,0,J,ke),!ot&&k||this.addCurrentVertex(ee,tt,1,1,J,ke,!0)}if(le){const tt=!ot&&Se?Se:Ie;!ot&&P||this.addCurrentVertex(ee,tt,-1,-1,J,ke,!0),this.addCurrentVertex(ee,tt,0,0,J,ke)}}}}addVerticesTo(e,i,a,c,m,g,x,S,C,M){const P=(i.w-e.w)/this.tessellationStep|0;let k=0;const V=this.scaledDistance;if(P>1){this.lineSoFar=e.w;const q=(i.x-e.x)/P,J=(i.y-e.y)/P,ee=(i.z-e.z)/P,oe=(i.w-e.w)/P;for(let le=1;le<P;++le){e.x+=q,e.y+=J,e.z+=ee,this.lineSoFar+=oe,k+=oe;const fe=this.evaluateLineProgressFeatures(this.prevDistance+k);this.scaledDistance=(this.prevDistance+k)/this.totalDistance,this.addHalfVertex(e,a,c,M,!1,x,C,fe),this.addHalfVertex(e,m,g,M,!0,-S,C,fe)}}this.lineSoFar=i.w,this.scaledDistance=V;const U=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,a,c,M,!1,x,C,U),this.addHalfVertex(i,m,g,M,!0,-S,C,U)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):ei(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,a,c,m,g,x=!1){const S=i.x+i.y*a,C=i.y-i.x*a,M=i.y*c-i.x,P=-i.y-i.x*c;if(g!=null){const k=this.elevationType==="offset",V=-10,U=Bt+10,q=g.zOffset,J=new zx(e.x,e.y,q,this.lineSoFar),ee=!!k&&r0(e,V,U),oe=this.lineSoFar,le=this.distance;if(this.currentVertex)if(ee){const fe=this.currentVertexIsOutside,Ie=this.currentVertex,Se=new zx(e.x,e.y,q,this.lineSoFar);if(CS(Ie,Se,V,U),!r0(Se,V,U)){if(fe){this.e1=this.e2=-1,this.distance-=Ie.dist(J),this.lineSoFar=Ie.w;const Pe=this.evaluateLineProgressFeatures(Ie.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ie,S,C,x,!1,a,m,Pe),this.addHalfVertex(Ie,M,P,x,!0,-c,m,Pe),this.prevDistance=this.distance}this.distance=this.prevDistance+Ie.dist(Se),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ie,Se,S,C,M,P,a,c,m,x),this.distance=le,this.scaledDistance=this.distance/this.totalDistance}}else{const fe=this.currentVertex;if(this.currentVertexIsOutside){CS(fe,J,V,U),this.e1=this.e2=-1,this.distance-=fe.dist(J),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=fe.w;const Ie=this.evaluateLineProgressFeatures(fe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(fe,S,C,x,!1,a,m,Ie),this.addHalfVertex(fe,M,P,x,!0,-c,m,Ie),this.prevDistance=this.distance,this.distance=le,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(fe,J,S,C,M,P,a,c,m,x)}else ee||(this.addHalfVertex(e,S,C,x,!1,a,m,g),this.addHalfVertex(e,M,P,x,!0,-c,m,g));this.currentVertex=J,this.currentVertexIsOutside=ee,this.lineSoFar=oe}else this.addHalfVertex(e,S,C,x,!1,a,m,g),this.addHalfVertex(e,M,P,x,!0,-c,m,g)}addHalfVertex({x:e,y:i},a,c,m,g,x,S,C){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(i<<1)+(g?1:0),Math.round(63*a)+128,Math.round(63*c)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const P=Si(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,P)}const M=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),S.primitiveLength++),g?this.e2=M:this.e1=M,C!=null&&this.zOffsetVertexArray.emplaceBack(C.zOffset,C.variableWidth,C.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function r0(n,e,i){return n.x<e||n.x>i||n.y<e||n.y>i}let $S,WS;function qS(n,e,i){return e*(Bt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}li(O1,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const k1=(n,e,i)=>(1-i)*n+i*e;function F1(n,e){return 1/qS(n,1,e.tileZoom)}function o0(n,e,i,a){return n.translatePosMatrix(a||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const L1=n=>{const e=[];z1(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=n.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const a=n.layout.get("line-join").constantOr("miter")==="none",c=!!n.paint.get("line-pattern").constantOr(1);return a&&c&&e.push("LINE_JOIN_NONE"),e};function z1(n){const e=n.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let Hy;const a0=()=>Hy||(Hy={layout:$S||($S=new ro({"line-cap":new Xt(qe.layout_line["line-cap"]),"line-join":new Xt(qe.layout_line["line-join"]),"line-miter-limit":new Pt(qe.layout_line["line-miter-limit"]),"line-round-limit":new Pt(qe.layout_line["line-round-limit"]),"line-sort-key":new Xt(qe.layout_line["line-sort-key"]),"line-z-offset":new Xt(qe.layout_line["line-z-offset"]),"line-elevation-reference":new Pt(qe.layout_line["line-elevation-reference"]),"line-cross-slope":new Pt(qe.layout_line["line-cross-slope"]),visibility:new Pt(qe.layout_line.visibility),"line-width-unit":new Pt(qe.layout_line["line-width-unit"])})),paint:WS||(WS=new ro({"line-opacity":new Xt(qe.paint_line["line-opacity"]),"line-color":new Xt(qe.paint_line["line-color"]),"line-translate":new Pt(qe.paint_line["line-translate"]),"line-translate-anchor":new Pt(qe.paint_line["line-translate-anchor"]),"line-width":new Xt(qe.paint_line["line-width"]),"line-gap-width":new Xt(qe.paint_line["line-gap-width"]),"line-offset":new Xt(qe.paint_line["line-offset"]),"line-blur":new Xt(qe.paint_line["line-blur"]),"line-dasharray":new Xt(qe.paint_line["line-dasharray"]),"line-pattern":new Xt(qe.paint_line["line-pattern"]),"line-pattern-cross-fade":new Pt(qe.paint_line["line-pattern-cross-fade"]),"line-gradient":new Eh(qe.paint_line["line-gradient"]),"line-trim-offset":new Pt(qe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Pt(qe.paint_line["line-trim-fade-range"]),"line-trim-color":new Pt(qe.paint_line["line-trim-color"]),"line-emissive-strength":new Pt(qe.paint_line["line-emissive-strength"]),"line-border-width":new Xt(qe.paint_line["line-border-width"]),"line-border-color":new Xt(qe.paint_line["line-border-color"]),"line-occlusion-opacity":new Pt(qe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},Hy);class N1 extends Xt{possiblyEvaluate(e,i){return i=new Ar(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,a,c){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,a,c)}}let $y;function ZS(n,e){return e>0?e+2*n:n}const PC=gn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),OC=gn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),XS=gn([{name:"a_projected_pos",components:4,type:"Float32"}],4);gn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const s0=gn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),kC=gn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),YS=gn([{name:"a_texb",components:2,type:"Uint16"}]),Xg=gn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),KS=gn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);gn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ds=gn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),B1=gn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);gn([{name:"triangle",components:3,type:"Uint16"}]),gn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),gn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),gn([{type:"Float32",name:"offsetX"}]),gn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var La=24;function FC(n,e,i){return n.sections.forEach(a=>{a.text=function(c,m,g){const x=m.layout.get("text-transform").evaluate(g,{});return x==="uppercase"?c=c.toLocaleUpperCase():x==="lowercase"&&(c=c.toLocaleLowerCase()),tl.applyArabicShaping&&(c=tl.applyArabicShaping(c)),c}(a.text,e,i)}),n}const Wy={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Yu(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}function LC(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}const Ld=4294967296,Yg=1/Ld,Kg=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let zf=class{constructor(n=new Uint8Array(16)){this.buf=ArrayBuffer.isView(n)?n:new Uint8Array(n),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(n,e,i=this.length){for(;this.pos<i;){const a=this.readVarint(),c=a>>3,m=this.pos;this.type=7&a,n(c,e,this),this.pos===m&&this.skip(a)}return e}readMessage(n,e){return this.readFields(n,e,this.readVarint()+this.pos)}readFixed32(){const n=this.dataView.getUint32(this.pos,!0);return this.pos+=4,n}readSFixed32(){const n=this.dataView.getInt32(this.pos,!0);return this.pos+=4,n}readFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Ld;return this.pos+=8,n}readSFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Ld;return this.pos+=8,n}readFloat(){const n=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,n}readDouble(){const n=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,n}readVarint(n){const e=this.buf;let i,a;return a=e[this.pos++],i=127&a,a<128?i:(a=e[this.pos++],i|=(127&a)<<7,a<128?i:(a=e[this.pos++],i|=(127&a)<<14,a<128?i:(a=e[this.pos++],i|=(127&a)<<21,a<128?i:(a=e[this.pos],i|=(15&a)<<28,function(c,m,g){const x=g.buf;let S,C;if(C=x[g.pos++],S=(112&C)>>4,C<128||(C=x[g.pos++],S|=(127&C)<<3,C<128)||(C=x[g.pos++],S|=(127&C)<<10,C<128)||(C=x[g.pos++],S|=(127&C)<<17,C<128)||(C=x[g.pos++],S|=(127&C)<<24,C<128)||(C=x[g.pos++],S|=(1&C)<<31,C<128))return jh(c,S,m);throw new Error("Expected varint not more than 10 bytes")}(i,n,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const n=this.readVarint();return n%2==1?(n+1)/-2:n/2}readBoolean(){return!!this.readVarint()}readString(){const n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&Kg?Kg.decode(this.buf.subarray(e,n)):function(i,a,c){let m="",g=a;for(;g<c;){const x=i[g];let S,C,M,P=null,k=x>239?4:x>223?3:x>191?2:1;if(g+k>c)break;k===1?x<128&&(P=x):k===2?(S=i[g+1],(192&S)==128&&(P=(31&x)<<6|63&S,P<=127&&(P=null))):k===3?(S=i[g+1],C=i[g+2],(192&S)==128&&(192&C)==128&&(P=(15&x)<<12|(63&S)<<6|63&C,(P<=2047||P>=55296&&P<=57343)&&(P=null))):k===4&&(S=i[g+1],C=i[g+2],M=i[g+3],(192&S)==128&&(192&C)==128&&(192&M)==128&&(P=(15&x)<<18|(63&S)<<12|(63&C)<<6|63&M,(P<=65535||P>=1114112)&&(P=null))),P===null?(P=65533,k=1):P>65535&&(P-=65536,m+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),m+=String.fromCharCode(P),g+=k}return m}(this.buf,e,n)}readBytes(){const n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e}readPackedVarint(n=[],e){const i=this.readPackedEnd();for(;this.pos<i;)n.push(this.readVarint(e));return n}readPackedSVarint(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSVarint());return n}readPackedBoolean(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readBoolean());return n}readPackedFloat(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFloat());return n}readPackedDouble(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readDouble());return n}readPackedFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed32());return n}readPackedSFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed32());return n}readPackedFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed64());return n}readPackedSFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed64());return n}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(n){const e=7&n;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(n,e){this.writeVarint(n<<3|e)}realloc(n){let e=this.length||16;for(;e<this.pos+n;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeSFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*Yg),!0),this.pos+=8}writeSFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*Yg),!0),this.pos+=8}writeVarint(n){(n=+n||0)>268435455||n<0?function(e,i){let a,c;if(e>=0?(a=e%4294967296|0,c=e/4294967296|0):(a=~(-e%4294967296),c=~(-e/4294967296),4294967295^a?a=a+1|0:(a=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(m,g,x){x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7)}(a,0,i),function(m,g){const x=(7&m)<<4;g.buf[g.pos++]|=x|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(c,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))}writeSVarint(n){this.writeVarint(n<0?2*-n-1:2*n)}writeBoolean(n){this.writeVarint(+n)}writeString(n){n=String(n),this.realloc(4*n.length),this.pos++;const e=this.pos;this.pos=function(a,c,m){for(let g,x,S=0;S<c.length;S++){if(g=c.charCodeAt(S),g>55295&&g<57344){if(!x){g>56319||S+1===c.length?(a[m++]=239,a[m++]=191,a[m++]=189):x=g;continue}if(g<56320){a[m++]=239,a[m++]=191,a[m++]=189,x=g;continue}g=x-55296<<10|g-56320|65536,x=null}else x&&(a[m++]=239,a[m++]=191,a[m++]=189,x=null);g<128?a[m++]=g:(g<2048?a[m++]=g>>6|192:(g<65536?a[m++]=g>>12|224:(a[m++]=g>>18|240,a[m++]=g>>12&63|128),a[m++]=g>>6&63|128),a[m++]=63&g|128)}return m}(this.buf,n,this.pos);const i=this.pos-e;i>=128&&Jg(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(n){this.realloc(4),this.dataView.setFloat32(this.pos,n,!0),this.pos+=4}writeDouble(n){this.realloc(8),this.dataView.setFloat64(this.pos,n,!0),this.pos+=8}writeBytes(n){const e=n.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=n[i]}writeRawMessage(n,e){this.pos++;const i=this.pos;n(e,this);const a=this.pos-i;a>=128&&Jg(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a}writeMessage(n,e,i){this.writeTag(n,2),this.writeRawMessage(e,i)}writePackedVarint(n,e){e.length&&this.writeMessage(n,qy,e)}writePackedSVarint(n,e){e.length&&this.writeMessage(n,cm,e)}writePackedBoolean(n,e){e.length&&this.writeMessage(n,V1,e)}writePackedFloat(n,e){e.length&&this.writeMessage(n,l0,e)}writePackedDouble(n,e){e.length&&this.writeMessage(n,JS,e)}writePackedFixed32(n,e){e.length&&this.writeMessage(n,U1,e)}writePackedSFixed32(n,e){e.length&&this.writeMessage(n,j1,e)}writePackedFixed64(n,e){e.length&&this.writeMessage(n,G1,e)}writePackedSFixed64(n,e){e.length&&this.writeMessage(n,H1,e)}writeBytesField(n,e){this.writeTag(n,2),this.writeBytes(e)}writeFixed32Field(n,e){this.writeTag(n,5),this.writeFixed32(e)}writeSFixed32Field(n,e){this.writeTag(n,5),this.writeSFixed32(e)}writeFixed64Field(n,e){this.writeTag(n,1),this.writeFixed64(e)}writeSFixed64Field(n,e){this.writeTag(n,1),this.writeSFixed64(e)}writeVarintField(n,e){this.writeTag(n,0),this.writeVarint(e)}writeSVarintField(n,e){this.writeTag(n,0),this.writeSVarint(e)}writeStringField(n,e){this.writeTag(n,2),this.writeString(e)}writeFloatField(n,e){this.writeTag(n,5),this.writeFloat(e)}writeDoubleField(n,e){this.writeTag(n,1),this.writeDouble(e)}writeBooleanField(n,e){this.writeVarintField(n,+e)}};function jh(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function Jg(n,e,i){const a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(a);for(let c=i.pos-1;c>=n;c--)i.buf[c+a]=i.buf[c]}function qy(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function cm(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function l0(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function JS(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function V1(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function U1(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function j1(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function G1(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function H1(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}const c0=3;function zC(n,e,i){e.glyphs=[],n===1&&i.readMessage(Zy,e)}function Zy(n,e,i){if(n===3){const{id:a,bitmap:c,width:m,height:g,left:x,top:S,advance:C}=i.readMessage(u0,{});e.glyphs.push({id:a,bitmap:new Lh({width:m+2*c0,height:g+2*c0},c),metrics:{width:m,height:g,left:x,top:S,advance:C}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function u0(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const Xy=c0,ll={horizontal:1,vertical:2,horizontalOnly:3};class Qg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const a=new Qg;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new Qg;return i.image=e,i}}class Ku{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,a){const c=new Ku;for(let m=0;m<e.sections.length;m++){const g=e.sections[m];g.image?c.addImageSection(g,a):c.addTextSection(g,i)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,a){let c="";for(let m=0;m<i.length;m++){const g=i.charCodeAt(m+1)||null,x=i.charCodeAt(m-1)||null;c+=!a&&(g&&fg(g)&&!Wy[i[m+1]]||x&&fg(x)&&!Wy[i[m-1]])||!Wy[i[m]]?i[m]:Wy[i[m]]}return c}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&d0[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&d0[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new Ku;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Qg.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(a)}addImageSection(e,i){const a=e.image?e.image.getPrimary():null;if(!a)return void ei("Can't add FormattedSection with an empty image.");a.scaleSelf(i);const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(Qg.forImage(a)),this.sectionIndex.push(this.sections.length-1)):ei("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function h0(n,e,i,a,c,m,g,x,S,C,M,P,k,V,U,q=1){const J=Ku.fromFeature(n,c,q);P===ll.vertical&&J.verticalizePunctuation(k);let ee=[];const oe=function(Pe,ke,Be,ot,Ze,st){if(!Pe)return[];const dt=[],wt=function(Dt,nt,tt,St,It,bt){let vt=0;for(let ci=0;ci<Dt.length();ci++){const Yt=Dt.getSection(ci);vt+=f0(Dt.getCodePoint(ci),Yt,St,It,nt,bt)}return vt/Math.max(1,Math.ceil(vt/tt))}(Pe,ke,Be,ot,Ze,st),Rt=Pe.text.indexOf("")>=0;let Mt=0;for(let Dt=0;Dt<Pe.length();Dt++){const nt=Pe.getSection(Dt),tt=Pe.getCodePoint(Dt);if(d0[tt]||(Mt+=f0(tt,nt,ot,Ze,ke,st)),Dt<Pe.length()-1){const St=!((yt=tt)<11904||!(Pi["Bopomofo Extended"](yt)||Pi.Bopomofo(yt)||Pi["CJK Compatibility Forms"](yt)||Pi["CJK Compatibility Ideographs"](yt)||Pi["CJK Compatibility"](yt)||Pi["CJK Radicals Supplement"](yt)||Pi["CJK Strokes"](yt)||Pi["CJK Symbols and Punctuation"](yt)||Pi["CJK Unified Ideographs Extension A"](yt)||Pi["CJK Unified Ideographs"](yt)||Pi["Enclosed CJK Letters and Months"](yt)||Pi["Halfwidth and Fullwidth Forms"](yt)||Pi.Hiragana(yt)||Pi["Ideographic Description Characters"](yt)||Pi["Kangxi Radicals"](yt)||Pi["Katakana Phonetic Extensions"](yt)||Pi.Katakana(yt)||Pi["Vertical Forms"](yt)||Pi["Yi Radicals"](yt)||Pi["Yi Syllables"](yt)));(NC[tt]||St||nt.image)&&dt.push(um(Dt+1,Mt,wt,dt,m0(tt,Pe.getCodePoint(Dt+1),St&&Rt),!1))}}var yt;return g0(um(Pe.length(),Mt,wt,dt,0,!0))}(J,C,m,e,a,V),{processBidirectionalText:le,processStyledBidirectionalText:fe}=tl;if(le&&J.sections.length===1){const Pe=le(J.toString(),oe);for(const ke of Pe){const Be=new Ku;Be.text=ke,Be.sections=J.sections;for(let ot=0;ot<ke.length;ot++)Be.sectionIndex.push(0);ee.push(Be)}}else if(fe){const Pe=fe(J.text,J.sectionIndex,oe);for(const ke of Pe){const Be=new Ku;Be.text=ke[0],Be.sectionIndex=ke[1],Be.sections=J.sections,ee.push(Be)}}else ee=function(Pe,ke){const Be=[],ot=Pe.text;let Ze=0;for(const st of ke)Be.push(Pe.substring(Ze,st)),Ze=st;return Ze<ot.length&&Be.push(Pe.substring(Ze,ot.length)),Be}(J,oe);const Ie=[],Se={positionedLines:Ie,text:J.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Pe,ke,Be,ot,Ze,st,dt,wt,Rt,Mt,yt,Dt){let nt=0,tt=0,St=0;const It=wt==="right"?1:wt==="left"?0:.5;let bt=!1;for(const Kt of Ze){const Ai=Kt.getSections();for(const qi of Ai){if(qi.image)continue;const fn=ke[qi.fontStack];if(fn&&(bt=fn.ascender!==void 0&&fn.descender!==void 0,!bt))break}if(!bt)break}let vt=0;for(const Kt of Ze){Kt.trim();const Ai=Kt.getMaxScale(),qi=(Ai-1)*La,fn={positionedGlyphs:[],lineOffset:0};Pe.positionedLines[vt]=fn;const En=fn.positionedGlyphs;let Zi=0;if(!Kt.length()){tt+=st,++vt;continue}let $n=0,Jn=0;for(let Ee=0;Ee<Kt.length();Ee++){const be=Kt.getSection(Ee),at=Kt.getSectionIndex(Ee),Gt=Kt.getCodePoint(Ee);let ut=be.scale,qt=null,wi=null,vi=null,Ki=La,Li=0,gi=Rt;gi===ll.vertical&&((ci=Gt)===12312||ci===12313||ci===12316||ci===12540||ci===12448)&&(gi=ll.horizontal);const Wn=!(gi===ll.horizontal||!yt&&!dg(Gt)||yt&&(d0[Gt]||ey(Gt)));if(be.image){const xr=ot.get(be.image.toString());if(!xr)continue;vi=be.image,Pe.iconsInText=Pe.iconsInText||!0,wi=xr.paddedRect;const zi=xr.displaySize;ut=ut*La/Dt,qt={width:zi[0],height:zi[1],left:0,top:-Xy,advance:Wn?zi[1]:zi[0],localGlyph:!1},Li=bt?-qt.height*ut:Ai*La-17-zi[1]*ut,Ki=qt.advance;const Fn=(Wn?zi[0]:zi[1])*ut-La*Ai;Fn>0&&Fn>Zi&&(Zi=Fn)}else{const xr=Be[be.fontStack];if(!xr)continue;xr[Gt]&&(wi=xr[Gt]);const zi=ke[be.fontStack];if(!zi)continue;const Fn=zi.glyphs[Gt];if(!Fn)continue;if(qt=Fn.metrics,Ki=Gt!==8203?La:0,bt){const yr=zi.ascender!==void 0?Math.abs(zi.ascender):0,or=zi.descender!==void 0?Math.abs(zi.descender):0,ar=(yr+or)*ut;$n<ar&&($n=ar,Jn=(yr-or)/2*ut),Li=-yr*ut}else Li=(Ai-ut)*La-17}Wn?(Pe.verticalizable=!0,En.push({glyph:Gt,image:vi,x:nt,y:tt+Li,vertical:Wn,scale:ut,localGlyph:qt.localGlyph,fontStack:be.fontStack,sectionIndex:at,metrics:qt,rect:wi}),nt+=Ki*ut+Mt):(En.push({glyph:Gt,image:vi,x:nt,y:tt+Li,vertical:Wn,scale:ut,localGlyph:qt.localGlyph,fontStack:be.fontStack,sectionIndex:at,metrics:qt,rect:wi}),nt+=qt.advance*ut+Mt)}En.length!==0&&(St=Math.max(nt-Mt,St),bt?Yy(En,It,Zi,Jn,st*Ai/2):Yy(En,It,Zi,0,st/2)),nt=0;const eo=st*Ai+Zi;fn.lineOffset=Math.max(Zi,qi),tt+=eo,++vt}var ci;const Yt=tt,{horizontalAlign:Wt,verticalAlign:ji}=e_(dt);(function(Kt,Ai,qi,fn,En,Zi){const $n=(Ai-qi)*En,Jn=-Zi*fn;for(const eo of Kt)for(const Ee of eo.positionedGlyphs)Ee.x+=$n,Ee.y+=Jn})(Pe.positionedLines,It,Wt,ji,St,Yt),Pe.top+=-ji*Yt,Pe.bottom=Pe.top+Yt,Pe.left+=-Wt*St,Pe.right=Pe.left+St,Pe.hasBaseline=bt}(Se,e,i,a,ee,g,x,S,P,C,k,U),!function(Pe){for(const ke of Pe)if(ke.positionedGlyphs.length!==0)return!1;return!0}(Ie))return Se}const d0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},NC={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function f0(n,e,i,a,c,m){if(e.image){const g=a.get(e.image.toString());return g?g.displaySize[0]*e.scale*La/m+c:0}{const g=i[e.fontStack],x=g&&g.glyphs[n];return x?x.metrics.advance*e.scale+c:0}}function p0(n,e,i,a){const c=Math.pow(n-e,2);return a?n<e?c/2:2*c:c+Math.abs(i)*i}function m0(n,e,i){let a=0;return n===10&&(a-=1e4),i&&(a+=150),n!==40&&n!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function um(n,e,i,a,c,m){let g=null,x=p0(e,i,c,m);for(const S of a){const C=p0(e-S.x,i,c,m)+S.badness;C<=x&&(g=S,x=C)}return{index:n,x:e,priorBreak:g,badness:x}}function g0(n){return n?g0(n.priorBreak).concat(n.index):[]}function e_(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Yy(n,e,i,a,c){if(!(e||i||a||c))return;const m=n.length-1,g=n[m],x=(g.x+g.metrics.advance*g.scale)*e;for(let S=0;S<=m;S++)n[S].x-=x,n[S].y+=i+a+c}function $1(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function Ky(n,e,i,a){const{horizontalAlign:c,verticalAlign:m}=e_(a),g=i[0]-n.displaySize[0]*c,x=i[1]-n.displaySize[1]*m;return{imagePrimary:n,imageSecondary:e,top:x,bottom:x+n.displaySize[1],left:g,right:g+n.displaySize[0]}}function _0(n,e,i,a,c,m){const g=n.imagePrimary;let x;if(g.content){const J=g.content,ee=g.pixelRatio||1;x=[J[0]/ee,J[1]/ee,g.displaySize[0]-J[2]/ee,g.displaySize[1]-J[3]/ee]}const S=e.left*m,C=e.right*m;let M,P,k,V;i==="width"||i==="both"?(V=c[0]+S-a[3],P=c[0]+C+a[1]):(V=c[0]+(S+C-g.displaySize[0])/2,P=V+g.displaySize[0]);const U=e.top*m,q=e.bottom*m;return i==="height"||i==="both"?(M=c[1]+U-a[0],k=c[1]+q+a[2]):(M=c[1]+(U+q-g.displaySize[1])/2,k=M+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:M,right:P,bottom:k,left:V,collisionPadding:x}}function y0(n){return!n.imagePrimary.stretchX}function v0(n){return!n.imagePrimary.stretchY}function QS(n){return{width:n.right-n.left,height:n.bottom-n.top}}const Ju=128;function Qu(n,e,i){const{expression:a}=e;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new Ar(n+1,{worldview:i}))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:m}=a;let g=0;for(;g<c.length&&c[g]<=n;)g++;g=Math.max(0,g-1);let x=g;for(;x<c.length&&c[x]<n+1;)x++;x=Math.min(c.length-1,x);const S=c[g],C=c[x];return a.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:C,interpolationType:m}:{kind:"camera",minZoom:S,maxZoom:C,minSize:a.evaluate(new Ar(S,{worldview:i})),maxSize:a.evaluate(new Ar(C,{worldview:i})),interpolationType:m}}}function za(n,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:c}){return n.kind==="source"?a/Ju:n.kind==="composite"?Si(a/Ju,c/Ju,i):e}function ru(n,e,i=1){let a=0,c=0;if(n.kind==="constant")c=n.layoutSize*i;else if(n.kind!=="source"){const{interpolationType:m,minZoom:g,maxZoom:x}=n,S=m?Y(Ts.interpolationFactor(m,e,g,x),0,1):0;n.kind==="camera"?c=Si(n.minSize,n.maxSize,S)*i:a=S*i}return{uSizeT:a,uSize:c}}class eh extends Tt{constructor(e,i,a,c,m){super(e,i),this.angle=c,this.z=a,m!==void 0&&(this.segment=m)}clone(){return new eh(this.x,this.y,this.z,this.angle,this.segment)}}function eE(n,e,i,a,c){if(e.segment===void 0)return!0;let m=e,g=e.segment+1,x=0;for(;x>-i/2;){if(g--,g<0)return!1;x-=n[g].dist(m),m=n[g]}x+=n[g].dist(n[g+1]),g++;const S=[];let C=0;for(;x<i/2;){const M=n[g],P=n[g+1];if(!P)return!1;let k=n[g-1].angleTo(M)-M.angleTo(P);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:x,angleDelta:k}),C+=k;x-S[0].distance>a;)C-=S.shift().angleDelta;if(C>c)return!1;g++,x+=M.dist(P)}return!0}function W1(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function tE(n,e,i){return n?.6*e*i:0}function iE(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function Xl(n,e,i,a,c,m){const g=tE(i,c,m),x=iE(i,a)*m;let S=0;const C=W1(n)/2;for(let M=0;M<n.length-1;M++){const P=n[M],k=n[M+1],V=P.dist(k);if(S+V>C){const U=(C-S)/V,q=Si(P.x,k.x,U),J=Si(P.y,k.y,U),ee=new eh(q,J,0,k.angleTo(P),M);return!g||eE(n,ee,x,g,e)?ee:void 0}S+=V}}function BC(n,e,i,a,c,m,g,x,S){const C=tE(a,m,g),M=iE(a,c),P=M*g,k=n[0].x===0||n[0].x===S||n[0].y===0||n[0].y===S;return e-P<e/4&&(e=P+e/4),Jy(n,k?e/2*x%e:(M/2+2*m)*g*x%e,e,C,i,P,k,!1,S)}function Jy(n,e,i,a,c,m,g,x,S){const C=m/2,M=W1(n);let P=0,k=e-i,V=[];for(let U=0;U<n.length-1;U++){const q=n[U],J=n[U+1],ee=q.dist(J),oe=J.angleTo(q);for(;k+i<P+ee;){k+=i;const le=(k-P)/ee,fe=Si(q.x,J.x,le),Ie=Si(q.y,J.y,le);if(fe>=0&&fe<S&&Ie>=0&&Ie<S&&k-C>=0&&k+C<=M){const Se=new eh(fe,Ie,0,oe,U);a&&!eE(n,Se,m,a,c)||V.push(Se)}}P+=ee}return x||V.length||g||(V=Jy(n,P/2,i,a,c,m,g,!0,S)),V}function q1(n){let e=0,i=0;for(const g of n)e+=g.w*g.h,i=Math.max(i,g.w);n.sort((g,x)=>x.h-g.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,m=0;for(const g of n)for(let x=a.length-1;x>=0;x--){const S=a[x];if(!(g.w>S.w||g.h>S.h)){if(g.x=S.x,g.y=S.y,m=Math.max(m,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===S.w&&g.h===S.h){const C=a.pop();C&&x<a.length&&(a[x]=C)}else g.h===S.h?(S.x+=g.w,S.w-=g.w):g.w===S.w?(S.y+=g.h,S.h-=g.h):(a.push({x:S.x+g.w,y:S.y,w:S.w-g.w,h:g.h}),S.y+=g.h,S.h-=g.h);break}}return{w:c,h:m,fill:e/(c*m)||0}}li(eh,"Anchor");const Nf=1;class Bf{static getImagePositionScale(e,i,a){if(i&&e&&e.options&&e.options.transform){const c=e.options.transform;return{x:c.a,y:c.d}}return{x:a,y:a}}constructor(e,i,a,c){this.paddedRect=e;const{pixelRatio:m,version:g,stretchX:x,stretchY:S,content:C,sdf:M,usvg:P}=i;this.pixelRatio=m,this.stretchX=x,this.stretchY=S,this.content=C,this.version=g,this.padding=a,this.sdf=M,this.usvg=P,this.scale=Bf.getImagePositionScale(c,P,m)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Qy(n,e,i){const a=zo.parse(n),c=function(m,g,x=[1,1]){return{x:0,y:0,w:(m.data?m.data.width:m.width*x[0])+2*g,h:(m.data?m.data.height:m.height*x[1])+2*g}}(e,i,[a.options.transform.a,a.options.transform.d]);return{bin:c,imagePosition:new Bf(c,e,i,a),imageVariant:a}}class ev{constructor(e,i,a){const c=new Map,m=new Map;this.haveRenderCallbacks=[];const g=[];this.addImages(e,c,Nf,g),this.addImages(i,m,2,g);const{w:x,h:S}=q1(g),C=new Xa({width:x||1,height:S||1});for(const[M,P]of e.entries()){const k=c.get(M).paddedRect;Xa.copy(P.data,C,{x:0,y:0},{x:k.x+Nf,y:k.y+Nf},P.data,null,P.sdf)}for(const[M,P]of i.entries()){const k=m.get(M),V=k.paddedRect;let U=k.padding;const q=V.x+U,J=V.y+U,ee=P.data.width,oe=P.data.height;U=U>1?U-1:U,Xa.copy(P.data,C,{x:0,y:0},{x:q,y:J},P.data,a),Xa.copy(P.data,C,{x:0,y:oe-U},{x:q,y:J-U},{width:ee,height:U},a),Xa.copy(P.data,C,{x:0,y:0},{x:q,y:J+oe},{width:ee,height:U},a),Xa.copy(P.data,C,{x:ee-U,y:0},{x:q-U,y:J},{width:U,height:oe},a),Xa.copy(P.data,C,{x:0,y:0},{x:q+ee,y:J},{width:U,height:oe},a),Xa.copy(P.data,C,{x:ee-U,y:oe-U},{x:q-U,y:J-U},{width:U,height:U},a),Xa.copy(P.data,C,{x:0,y:oe-U},{x:q+ee,y:J-U},{width:U,height:U},a),Xa.copy(P.data,C,{x:0,y:0},{x:q+ee,y:J+oe},{width:U,height:U},a),Xa.copy(P.data,C,{x:ee-U,y:0},{x:q-U,y:J+oe},{width:U,height:U},a)}this.lut=a,this.image=C,this.iconPositions=c,this.patternPositions=m}addImages(e,i,a,c){for(const[m,g]of e.entries()){const{bin:x,imagePosition:S,imageVariant:C}=Qy(m,g,a);i.set(m,S),c.push(x),g.hasRenderCallback&&this.haveRenderCallbacks.push(C.id)}}patchUpdatedImages(e,i,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const c of e.getUpdatedImages(a)){for(const m of this.iconPositions.keys()){const g=zo.parse(m);if(ki.isEqual(g.id,c)){const x=e.getImage(c,a);this.patchUpdatedImage(this.iconPositions.get(m),x,i,null)}}for(const m of this.patternPositions.keys()){const g=zo.parse(m);if(ki.isEqual(g.id,c)){const x=e.getImage(c,a);this.patchUpdatedImage(this.patternPositions.get(m),x,i,this.lut)}}}}patchUpdatedImage(e,i,a,c=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[m,g]=e.tl,x=e.sdf;if(this.lut||x){const S={width:i.data.width,height:i.data.height},C=new Xa(S);Xa.copy(i.data,C,{x:0,y:0},{x:0,y:0},S,c,x),a.update(C,{position:{x:m,y:g}})}else a.update(i.data,{position:{x:m,y:g}})}}li(Bf,"ImagePosition"),li(ev,"ImageAtlas");const hm=1e20;function tv(n,e,i,a,c,m,g,x,S){for(let C=e;C<e+a;C++)x0(n,i*m+C,m,c,g,x,S);for(let C=i;C<i+c;C++)x0(n,C*m+e,1,a,g,x,S)}function x0(n,e,i,a,c,m,g){m[0]=0,g[0]=-hm,g[1]=hm,c[0]=n[e];for(let x=1,S=0,C=0;x<a;x++){c[x]=n[e+x*i];const M=x*x;do{const P=m[S];C=(c[x]-c[P]+M-P*P)/(x-P)/2}while(C<=g[S]&&--S>-1);S++,m[S]=x,g[S]=C,g[S+1]=hm}for(let x=0,S=0;x<a;x++){for(;g[S+1]<x;)S++;const C=m[S],M=x-C;n[e+x*i]=c[C]+M*M}}const ou=2,th={none:0,ideographs:1,all:2};class _c{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const a=[],c=this.url||Sr.GLYPHS_URL;for(const m in e)for(const g of e[m])a.push({stack:m,id:g});ye(a,({stack:m,id:g},x)=>{let S=this.entries[m];S||(S=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=S.glyphs[g];if(C!==void 0)return void x(null,{stack:m,id:g,glyph:C});if(C=this._tinySDF(S,m,g),C)return S.glyphs[g]=C,void x(null,{stack:m,id:g,glyph:C});const M=Math.floor(g/256);if(256*M>65535)return ei("glyphs > 65535 not supported"),void x(null,{stack:m,id:g,glyph:C});if(S.ranges[M])return void x(null,{stack:m,id:g,glyph:C});let P=S.requests[M];P||(P=S.requests[M]=[],_c.loadGlyphRange(m,M,c,this.requestManager,(k,V)=>{if(V){S.ascender=V.ascender,S.descender=V.descender;for(const U in V.glyphs)this._doesCharSupportLocalGlyph(+U)||(S.glyphs[+U]=V.glyphs[+U]);S.ranges[M]=!0}for(const U of P)U(k,V);delete S.requests[M]})),P.push((k,V)=>{k?x(k):V&&x(null,{stack:m,id:g,glyph:V.glyphs[g]||null})})},(m,g)=>{if(m)i(m);else if(g){const x={};for(const{stack:S,id:C,glyph:M}of g)x[S]===void 0&&(x[S]={}),x[S].glyphs===void 0&&(x[S].glyphs={}),x[S].glyphs[C]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},x[S].ascender=this.entries[S].ascender,x[S].descender=this.entries[S].descender;i(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==th.none&&(this.localGlyphMode===th.all?!!this.localFontFamily:!!this.localFontFamily&&(Pi["CJK Unified Ideographs"](e)||Pi["Hangul Syllables"](e)||Pi.Hiragana(e)||Pi.Katakana(e)||Pi["CJK Symbols and Punctuation"](e)||Pi["CJK Unified Ideographs Extension A"](e)||Pi["CJK Unified Ideographs Extension B"](e)||Pi.Osage(e)))}_tinySDF(e,i,a){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let m=e.tinySDF;if(!m){let q="400";/bold/i.test(i)?q="900":/medium/i.test(i)?q="500":/light/i.test(i)&&(q="200"),m=e.tinySDF=new _c.TinySDF({fontFamily:c,fontWeight:q,fontSize:24*ou,buffer:3*ou,radius:8*ou}),m.fontWeight=q}if(this.localGlyphs[m.fontWeight][a])return this.localGlyphs[m.fontWeight][a];const g=String.fromCodePoint(a),{data:x,width:S,height:C,glyphWidth:M,glyphHeight:P,glyphLeft:k,glyphTop:V,glyphAdvance:U}=m.draw(g);return this.localGlyphs[m.fontWeight][a]={id:a,bitmap:new Lh({width:S,height:C},x),metrics:{width:M/ou,height:P/ou,left:k/ou,top:V/ou-27,advance:U/ou,localGlyph:!0}}}}_c.loadGlyphRange=function(n,e,i,a,c){const m=256*e,g=m+255,x=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${m}-${g}`),bu.Glyphs);oc(x,(S,C)=>{if(S)c(S);else if(C){const M={},P=function(k){return new zf(k).readFields(zC,{})}(C);for(const k of P.glyphs)M[k.id]=k;c(null,{glyphs:M,ascender:P.ascender,descender:P.descender})}})},_c.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:m="normal",fontStyle:g="normal",lang:x=null}={}){this.buffer=e,this.cutoff=a,this.radius=i,this.lang=x;const S=this.size=n+4*e,C=this._createCanvas(S),M=this.ctx=C.getContext("2d",{willReadFrequently:!0});M.font=`${g} ${m} ${n}px ${c}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:m}=this.ctx.measureText(n),g=Math.ceil(i),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-c))),S=Math.min(this.size-this.buffer,g+Math.ceil(a)),C=x+2*this.buffer,M=S+2*this.buffer,P=Math.max(C*M,0),k=new Uint8ClampedArray(P),V={data:k,width:C,height:M,glyphWidth:x,glyphHeight:S,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(x===0||S===0)return V;const{ctx:U,buffer:q,gridInner:J,gridOuter:ee}=this;this.lang&&(U.lang=this.lang),U.clearRect(q,q,x,S),U.fillText(n,q,q+g);const oe=U.getImageData(q,q,x,S);ee.fill(hm,0,P),J.fill(0,0,P);for(let le=0;le<S;le++)for(let fe=0;fe<x;fe++){const Ie=oe.data[4*(le*x+fe)+3]/255;if(Ie===0)continue;const Se=(le+q)*C+fe+q;if(Ie===1)ee[Se]=0,J[Se]=hm;else{const Pe=.5-Ie;ee[Se]=Pe>0?Pe*Pe:0,J[Se]=Pe<0?Pe*Pe:0}}tv(ee,0,0,C,M,C,this.f,this.v,this.z),tv(J,q,q,x,S,C,this.f,this.v,this.z);for(let le=0;le<P;le++){const fe=Math.sqrt(ee[le])-Math.sqrt(J[le]);k[le]=Math.round(255-255*(fe/this.radius+this.cutoff))}return V}};const yc=Nf;function b0(n,e){return n+e[1]-e[0]}function Z1(n,e,i,a,c=1){const m=[],g=n.imagePrimary,x=g.pixelRatio,S=g.paddedRect.w-2*yc,C=g.paddedRect.h-2*yc,M=(n.right-n.left)*c,P=(n.bottom-n.top)*c,k=g.stretchX||[[0,S]],V=g.stretchY||[[0,C]],U=k.reduce(b0,0),q=V.reduce(b0,0),J=S-U,ee=C-q;let oe=0,le=U,fe=0,Ie=q,Se=0,Pe=J,ke=0,Be=ee;if(g.content&&a){const Ze=g.content;oe=T0(k,0,Ze[0]),fe=T0(V,0,Ze[1]),le=T0(k,Ze[0],Ze[2]),Ie=T0(V,Ze[1],Ze[3]),Se=Ze[0]-oe,ke=Ze[1]-fe,Pe=Ze[2]-Ze[0]-le,Be=Ze[3]-Ze[1]-Ie}const ot=(Ze,st,dt,wt)=>{const Rt=nv(Ze.stretch-oe,le,M,n.left*c),Mt=Vf(Ze.fixed-Se,Pe,Ze.stretch,U),yt=nv(st.stretch-fe,Ie,P,n.top*c),Dt=Vf(st.fixed-ke,Be,st.stretch,q),nt=nv(dt.stretch-oe,le,M,n.left*c),tt=Vf(dt.fixed-Se,Pe,dt.stretch,U),St=nv(wt.stretch-fe,Ie,P,n.top*c),It=Vf(wt.fixed-ke,Be,wt.stretch,q),bt=new Tt(Rt,yt),vt=new Tt(nt,yt),ci=new Tt(nt,St),Yt=new Tt(Rt,St),Wt=new Tt(Mt/x,Dt/x),ji=new Tt(tt/x,It/x),Kt=e*Math.PI/180;if(Kt){const $n=Math.sin(Kt),Jn=Math.cos(Kt),eo=[Jn,-$n,$n,Jn];bt._matMult(eo),vt._matMult(eo),Yt._matMult(eo),ci._matMult(eo)}const Ai=Ze.stretch+Ze.fixed,qi=dt.stretch+dt.fixed,fn=st.stretch+st.fixed,En=wt.stretch+wt.fixed,Zi=n.imageSecondary;return{tl:bt,tr:vt,bl:Yt,br:ci,texPrimary:{x:g.paddedRect.x+yc+Ai,y:g.paddedRect.y+yc+fn,w:qi-Ai,h:En-fn},texSecondary:Zi?{x:Zi.paddedRect.x+yc+Ai,y:Zi.paddedRect.y+yc+fn,w:qi-Ai,h:En-fn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Wt,pixelOffsetBR:ji,minFontScaleX:Pe/x/M,minFontScaleY:Be/x/P,isSDF:i}};if(a&&(g.stretchX||g.stretchY)){const Ze=X1(k,J,U),st=X1(V,ee,q);for(let dt=0;dt<Ze.length-1;dt++){const wt=Ze[dt],Rt=Ze[dt+1];for(let Mt=0;Mt<st.length-1;Mt++)m.push(ot(wt,st[Mt],Rt,st[Mt+1]))}}else m.push(ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:C+1}));return m}function w0(n,e){const i=n.stretchY||[[0,n.paddedRect.h-2*yc]];return e&&(n.stretchX||n.stretchY)?iv(n.stretchX||[[0,n.paddedRect.w-2*yc]])*iv(i):1}function T0(n,e,i){let a=0;for(const c of n)a+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return a}function X1(n,e,i){const a=[{fixed:-yc,stretch:0}];for(const[c,m]of n){const g=a[a.length-1];a.push({fixed:c-g.stretch,stretch:g.stretch}),a.push({fixed:c-g.stretch,stretch:g.stretch+(m-c)})}return a.push({fixed:e+yc,stretch:i}),a}function iv(n){return 2*n.length+1}function nv(n,e,i,a){return n/e*i+a}function Vf(n,e,i,a){return n-e*i/a}function Uf(n,e,i,a){const c=e+n.positionedLines[a].lineOffset;return a===0?i+c/2:i+(c+(e+n.positionedLines[a-1].lineOffset))/2}function rv(n,e=1,i=!1){let a=1/0,c=1/0,m=-1/0,g=-1/0;const x=n[0];for(let V=0;V<x.length;V++){const U=x[V];(!V||U.x<a)&&(a=U.x),(!V||U.y<c)&&(c=U.y),(!V||U.x>m)&&(m=U.x),(!V||U.y>g)&&(g=U.y)}const S=Math.min(m-a,g-c);let C=S/2;const M=new Hm([],S0);if(S===0)return new Tt(a,c);for(let V=a;V<m;V+=S)for(let U=c;U<g;U+=S)M.push(new zd(V+C,U+C,C,n));let P=function(V){let U=0,q=0,J=0;const ee=V[0];for(let oe=0,le=ee.length,fe=le-1;oe<le;fe=oe++){const Ie=ee[oe],Se=ee[fe],Pe=Ie.x*Se.y-Se.x*Ie.y;q+=(Ie.x+Se.x)*Pe,J+=(Ie.y+Se.y)*Pe,U+=3*Pe}return new zd(q/U,J/U,0,V)}(n),k=M.length;for(;M.length;){const V=M.pop();(V.d>P.d||!P.d)&&(P=V,i&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,k)),V.max-P.d<=e||(C=V.h/2,M.push(new zd(V.p.x-C,V.p.y-C,C,n)),M.push(new zd(V.p.x+C,V.p.y-C,C,n)),M.push(new zd(V.p.x-C,V.p.y+C,C,n)),M.push(new zd(V.p.x+C,V.p.y+C,C,n)),k+=4)}return i&&(console.log(`num probes: ${k}`),console.log(`best distance: ${P.d}`)),P.p}function S0(n,e){return e.max-n.max}class zd{constructor(e,i,a,c){this.p=new Tt(e,i),this.h=a,this.d=function(m,g){let x=!1,S=1/0;for(let C=0;C<g.length;C++){const M=g[C];for(let P=0,k=M.length,V=k-1;P<k;V=P++){const U=M[P],q=M[V];U.y>m.y!=q.y>m.y&&m.x<(q.x-U.x)*(m.y-U.y)/(q.y-U.y)+U.x&&(x=!x),S=Math.min(S,rl(m,U,q))}}return(x?1:-1)*Math.sqrt(S)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const nE=Object.keys,ov=Number.POSITIVE_INFINITY,t_=Math.sqrt(2);function i_(n,e,i,a){const c=n.collisionPadding||[0,0,0,0],m={top:n.top-c[1],bottom:n.bottom+c[3],left:n.left-c[0],right:n.right+c[2],scaled:!1};return a!==void 0&&function(g,x){g.top*=x,g.bottom*=x,g.left*=x,g.right*=x,g.scaled=!0}(m,a),i&&function(g,x){if(!x)return;const S=hn(x),C=new Tt(g.left,g.top),M=new Tt(g.right,g.top),P=new Tt(g.left,g.bottom),k=new Tt(g.right,g.bottom);C._rotateAround(S,new Tt(0,0)),M._rotateAround(S,new Tt(0,0)),P._rotateAround(S,new Tt(0,0)),k._rotateAround(S,new Tt(0,0)),g.left=Math.min(C.x,M.x,P.x,k.x),g.right=Math.max(C.x,M.x,P.x,k.x),g.top=Math.min(C.y,M.y,P.y,k.y),g.bottom=Math.max(C.y,M.y,P.y,k.y)}(m,i),e?{top:Math.min(e.top,m.top),bottom:Math.max(e.bottom,m.bottom),left:Math.min(e.left,m.left),right:Math.max(e.right,m.right),scaled:e.scaled||m.scaled}:m}function Y1(n,[e,i]){let a=0,c=0;if(i===ov){e<0&&(e=0);const m=e/t_;switch(n){case"top-right":case"top-left":c=m-7;break;case"bottom-right":case"bottom-left":c=7-m;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(n){case"top-right":case"bottom-right":a=-m;break;case"top-left":case"bottom-left":a=m;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":c=i-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-i}switch(n){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,c]}function K1(n,e,i,a,c,m,g,x,S,C,M){const P=n.layers[0],k=P.appearances;if(k.length===0)return{iconBBox:null,iconVerticalBBox:null};let V=null,U=null;const q=a.get("icon-rotate").evaluate(c,{},m);e&&(V=i_(e,V,q,g),i)&&(U=i_(i,U,q+90,g));const[J,ee]=a.get("icon-size-scale-range"),oe=Y(1,J,ee);for(const le of k){const fe=le.getUnevaluatedProperties(),Ie=fe._values["icon-image"].value!==void 0,Se=fe._values["icon-size"].value!==void 0,Pe=fe._values["icon-offset"].value!==void 0,ke=fe._values["icon-rotate"].value!==void 0;if(Ie||Se||Pe||ke){const Be=Pe?P.getAppearanceValueAndResolveTokens(le,"icon-offset",c,m,[]):null,ot=Be&&Array.isArray(Be)?Be:x,Ze=ke?P.getAppearanceValueAndResolveTokens(le,"icon-rotate",c,m,[]):null,st=typeof Ze=="number"?Ze:q,dt=Se?P.getAppearanceValueAndResolveTokens(le,"icon-size",c,m,[]):null,wt=typeof dt=="number"?dt*S.iconScaleFactor:g;let Rt=null,Mt=null,yt=null;if(Ie){const Dt=P.getAppearanceValueAndResolveTokens(le,"icon-image",c,m,[]);if(Dt){const nt=n.getResolvedImageFromTokens(Dt),tt=fe._values["icon-size"],St=n_(nt,Qu(n.zoom,tt,n.worldview),tt,m,n.zoom,c,n.pixelRatio,oe,n.worldview);yt=C.get(St.iconPrimary.toString())}}else e&&(yt=e.imagePrimary);yt&&(Rt=Ky(yt,null,ot,M),n.allowVerticalPlacement&&(Mt=Ky(yt,null,ot,M))),Rt&&(V=i_(Rt,V,st,wt)),Mt&&(U=i_(Mt,U,st+90,wt))}}return{iconBBox:V,iconVerticalBBox:U}}function E0(n,e,i,a,c,m,g,x,S){if(!e||!e.usvg)return;const C=QS(a),M=QS(c),P=m!=="both"&&m!=="width"||!y0(a)?1:M.width/C.width,k=m!=="both"&&m!=="height"||!v0(a)?1:M.height/C.height;i.scaleSelf(P,k);const V=i.toString();g.set(V,i),x.set(V,e);const{imagePosition:U}=Qy(V,e,Nf);S.set(V,U)}function J1(n,e,i,a,c,m,g,x,S){if(!n)return;const C=function(M,P,k,V,U,q){if(M.kind==="camera")return M.maxSize;if(M.kind==="composite"){const J=P.possiblyEvaluate(new Ar(M.maxZoom,{worldview:q}),k).evaluate(U,{},k),ee=P.possiblyEvaluate(new Ar(M.minZoom,{worldview:q}),k).evaluate(U,{},k);return Math.max(J,ee)}return P.possiblyEvaluate(new Ar(V,{worldview:q})).evaluate(U,{},k)}(e,i,a,c,m,S);return n.scaleSelf(C*x*g)}function n_(n,e,i,a,c,m,g,x,S){return{iconPrimary:J1(n.getPrimary(),e,i,a,c,m,g,x,S),iconSecondary:J1(n.getSecondary(),e,i,a,c,m,g,x,S)}}function av(n,e,i){if(!e)return;const a=i.get(n.toString()),c=i.get(e.toString());a&&c&&(a.paddedRect.w===c.paddedRect.w&&a.paddedRect.h===c.paddedRect.h||ei(`Mismatch in icon variant sizes: ${n.toString()} and ${e.toString()}`),a.usvg!==c.usvg&&ei(`Mismatch in icon variant image types: ${n.id} and ${e.id}`))}function au(n,e,i,a){if(!n)return;const c=e.get(i.toString());if(n.imagePrimary=c,a){const m=e.get(a.toString());n.imageSecondary=m}}function Q1(n,e){for(const i in n.horizontal)dm(n.horizontal[i],e);dm(n.vertical,e)}function dm(n,e){if(n){for(const i of n.positionedLines)for(const a of i.positionedGlyphs)if(a.image!==null){const c=a.image.toString();a.rect=e.get(c).paddedRect}}}function sv(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function VC(n,e,i,a,c,m,g,x,S){const C=cl(m.horizontal)||m.vertical,M=i.get("icon-text-fit-padding").evaluate(a,{},c);let P,k=e;return e&&S!=="none"&&(n.allowVerticalPlacement&&m.vertical&&(P=_0(e,m.vertical,S,M,x,g)),C&&(k=_0(e,C,S,M,x,g))),{defaultShapedIcon:k,verticallyShapedIcon:P}}function jf(n,e,i,a,c,m,g,x,S,C,M,P,k,V,U,q,J,ee,oe,le,fe,Ie){let Se=g.textMaxSize.evaluate(e,{},k);Se===void 0?Se=x*g.textScaleFactor:Se*=g.textScaleFactor;const Pe=n.layers[0].layout,ke=La,Be=x*g.textScaleFactor/ke,ot=cl(i.horizontal)||i.vertical;if(J!=="none"&&n.appearanceFeatureData&&e.index<n.appearanceFeatureData.length){const bt=n.appearanceFeatureData[e.index];bt&&(bt.textShaping=ot,bt.iconTextFitPadding=Pe.get("icon-text-fit-padding").evaluate(e,{},k),bt.fontScale=Be)}const Ze=V.name==="globe",st=n.tilePixelRatio*Se/ke,dt=(nt=n.overscaling,n.zoom>18&&nt>2&&(nt>>=1),Math.max(Bt/(512*nt),1)*Pe.get("symbol-spacing")),wt=Pe.get("text-padding")*n.tilePixelRatio,Rt=Pe.get("icon-padding")*n.tilePixelRatio,Mt=hn(Pe.get("text-max-angle")),yt=Pe.get("icon-rotation-alignment")==="map"&&le!=="point",Dt=dt/2;var nt;n.hasAnyIconTextFit===!1&&J!=="none"&&(n.hasAnyIconTextFit=!0);const tt=e.properties?+e.properties[ii]:null,St=tt&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(tt):65535,It=(bt,vt,ci)=>{if(vt.x<0||vt.x>=Bt||vt.y<0||vt.y>=Bt)return;let Yt=null;if(Ze){const{x:Wt,y:ji,z:Kt}=V.projectTilePoint(vt.x,vt.y,ci);Yt={anchor:new eh(Wt,ji,Kt,0,void 0),up:V.upVector(ci,vt.x,vt.y)}}(function(Wt,ji,Kt,Ai,qi,fn,En,Zi,$n,Jn,eo,Ee,be,at,Gt,ut,qt,wi,vi,Ki,Li,gi,Wn,xr,zi,Fn,yr,or,ar,fr,Mr){const Un=Wt.addToLineVertexArray(ji,Ai);let qn,en,Qn,Ir,Ni,_n,$r,Pr=0,Vo=0,ea=0,Nr=0,ta=-1,$s=-1;const ia={};let dl=ge("");const ts=Kt?Kt.anchor:ji,xc=or!=="none";let fl=0,Dl=0;if($n._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Va=$n.layout.get("text-offset").evaluate(Li,{},zi);fl=Va[0]*La,Dl=Va[1]*La}else fl=$n.layout.get("text-radial-offset").evaluate(Li,{},zi)*La,Dl=ov;if(Wt.allowVerticalPlacement&&qi.vertical){const Va=qi.vertical;if(Gt)_n=su(Va),Zi&&($r=su(Zi));else{const Ps=$n.layout.get("text-rotate").evaluate(Li,{},zi)+90;Qn=Na(Jn,ts,ji,eo,Ee,be,Va,at,Ps,ut),Zi&&(Ir=Na(Jn,ts,ji,eo,Ee,be,Zi,wi,Ps,null,Mr))}}if(fn){const Va=Wt.iconSizeData,Ps=$n.layout.get("icon-rotate").evaluate(Li,{},zi),Qh=Z1(fn,Ps,Wn,xc,gi.iconScaleFactor),Kf=Zi?Z1(Zi,Ps,Wn,xc,gi.iconScaleFactor):void 0;en=Na(Jn,ts,ji,eo,Ee,be,fn,wi,Ps,null,fr);const b_=function(ed,sb,td,oI,ME,PE,aI,OE){const kE=ed.layers[0],lb=kE.appearances;let Qf=sb.length;if(td&&(Qf=Math.max(Qf,td.length)),lb.length===0)return Qf;const[Ws,rh]=oI.get("icon-size-scale-range"),gs=Y(1,Ws,rh);for(const Ow of lb){const Os=Ow.getUnevaluatedProperties();if(Os._values["icon-image"].value!==void 0){const wc=kE.getAppearanceValueAndResolveTokens(Ow,"icon-image",ME,PE,[]);if(wc){const id=ed.getResolvedImageFromTokens(wc);if(id){const w_=Os._values["icon-size"],Em=n_(id,Qu(ed.zoom,w_,ed.worldview),w_,PE,ed.zoom,ME,ed.pixelRatio,gs,ed.worldview),cb=aI.get(Em.iconPrimary.toString());Qf=Math.max(Qf,w0(cb,OE))}}}}return Qf}(Wt,Qh,Kf,$n.layout,Li,zi,Wt.iconAtlasPositions,xc);Pr=4*b_;let Jf=null;Va.kind==="source"?(Jf=[Ju*$n.layout.get("icon-size").evaluate(Li,{},zi)*gi.iconScaleFactor],Jf[0]>Nd&&ei(`${Wt.layerIds[0]}: Value for "icon-size" is >= ${Gh}. Reduce your "icon-size".`)):Va.kind==="composite"&&(Jf=[Ju*gi.compositeIconSizes[0].evaluate(Li,{},zi)*gi.iconScaleFactor,Ju*gi.compositeIconSizes[1].evaluate(Li,{},zi)*gi.iconScaleFactor],(Jf[0]>Nd||Jf[1]>Nd)&&ei(`${Wt.layerIds[0]}: Value for "icon-size" is >= ${Gh}. Reduce your "icon-size".`)),Wt.addSymbols(Wt.icon,Qh,Jf,Ki,vi,Li,void 0,Kt,ji,Un.lineStartIndex,Un.lineLength,-1,xr,zi,Fn,yr,Wt.symbolInstances.length,b_),ta=Wt.icon.placedSymbolArray.length-1,Kf&&(Vo=4*b_,Wt.addSymbols(Wt.icon,Kf,Jf,Ki,vi,Li,ll.vertical,Kt,ji,Un.lineStartIndex,Un.lineLength,-1,xr,zi,Fn,yr,Wt.symbolInstances.length,b_),$s=Wt.icon.placedSymbolArray.length-1)}for(const Va in qi.horizontal){const Ps=Va,Qh=qi.horizontal[Ps];qn||(dl=ge(Qh.text),Gt?Ni=su(Qh):qn=Na(Jn,ts,ji,eo,Ee,be,Qh,at,$n.layout.get("text-rotate").evaluate(Li,{},zi),ut));const Kf=Qh.positionedLines.length===1;if(ea+=lv(Wt,Kt,ji,Qh,En,$n,Gt,Li,ut,Un,qi.vertical?ll.horizontal:ll.horizontalOnly,Kf?nE(qi.horizontal):[Ps],ia,ta,gi,xr,zi,Wt.symbolInstances.length,Fn),Kf)break}qi.vertical&&(Nr+=lv(Wt,Kt,ji,qi.vertical,En,$n,Gt,Li,ut,Un,ll.vertical,["vertical"],ia,$s,gi,xr,zi,Wt.symbolInstances.length,Fn));let is=-1;const Ml=(Va,Ps)=>Va?Math.max(Va,Ps):Ps;is=Ml(Ni,is),is=Ml(_n,is),is=Ml($r,is);const bc=is>-1?1:0;Wt.glyphOffsetArray.length>=65535&&ei("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Li.sortKey!==void 0&&Wt.addToSortKeyRanges(Wt.symbolInstances.length,Li.sortKey),Wt.symbolInstances.emplaceBack(ji.x,ji.y,ts.x,ts.y,ts.z,ia.right>=0?ia.right:-1,ia.center>=0?ia.center:-1,ia.left>=0?ia.left:-1,ia.vertical>=0?ia.vertical:-1,ta,$s,dl,qn!==void 0?qn:Wt.collisionBoxArray.length,qn!==void 0?qn+1:Wt.collisionBoxArray.length,Qn!==void 0?Qn:Wt.collisionBoxArray.length,Qn!==void 0?Qn+1:Wt.collisionBoxArray.length,en!==void 0?en:Wt.collisionBoxArray.length,en!==void 0?en+1:Wt.collisionBoxArray.length,Ir||Wt.collisionBoxArray.length,Ir?Ir+1:Wt.collisionBoxArray.length,eo,ea,Nr,Pr,Vo,bc,0,fl,Dl,is,0,xc?1:0,ar)})(n,vt,Yt,bt,i,a,m,c,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,wt,oe,C,0,Rt,yt,ee,e,g,M,P,k,U,q,J,St,fe,Ie)};if(le==="line")for(const bt of Nx(e.geometry,0,0,Bt,Bt)){const vt=BC(bt,dt,Mt,i.vertical||ot,a,ke,st,n.overscaling,Bt);for(const ci of vt)ot&&ps(n,ot.text,Dt,ci)||It(bt,ci,k)}else if(le==="line-center"){for(const bt of e.geometry)if(bt.length>1){const vt=Xl(bt,Mt,i.vertical||ot,a,ke,st);vt&&It(bt,vt,k)}}else if(e.type==="Polygon")for(const bt of Rs(e.geometry,0)){const vt=rv(bt,16);It(bt[0],new eh(vt.x,vt.y,0,0,void 0),k)}else if(e.type==="LineString")for(const bt of e.geometry)It(bt,new eh(bt[0].x,bt[0].y,0,0,void 0),k);else if(e.type==="Point")for(const bt of e.geometry)for(const vt of bt)It([vt],new eh(vt.x,vt.y,0,0,void 0),k)}const Gh=255,Nd=Gh*Ju;function lv(n,e,i,a,c,m,g,x,S,C,M,P,k,V,U,q,J,ee,oe){const le=function(Se,Pe,ke,Be,ot,Ze,st,dt){const wt=[];if(Pe.positionedLines.length===0)return wt;const Rt=Be.layout.get("text-rotate").evaluate(Ze,{})*Math.PI/180,Mt=function(St){const It=St[0],bt=St[1],vt=It*bt;return vt>0?[It,-bt]:vt<0?[-It,bt]:It===0?[bt,It]:[bt,-It]}(ke);let yt=Math.abs(Pe.top-Pe.bottom);for(const St of Pe.positionedLines)yt-=St.lineOffset;const Dt=Pe.positionedLines.length,nt=yt/Dt;let tt=Pe.top-ke[1];for(let St=0;St<Dt;++St){const It=Pe.positionedLines[St];tt=Uf(Pe,nt,tt,St);for(const bt of It.positionedGlyphs){if(!bt.rect)continue;const vt=bt.rect||{};let ci=Xy+1,Yt=!0,Wt=1,ji=0;if(bt.image){const vi=st.get(bt.image.toString());if(!vi)continue;if(vi.sdf){ei("SDF images are not supported in formatted text and will be ignored.");continue}Yt=!1,Wt=vi.pixelRatio,ci=Nf/Wt}const Kt=(ot||dt)&&bt.vertical,Ai=bt.metrics.advance*bt.scale/2,qi=bt.metrics,fn=bt.rect;if(fn===null)continue;dt&&Pe.verticalizable&&(ji=bt.image?Ai-bt.metrics.width*bt.scale/2:0);const En=ot?[bt.x+Ai,bt.y]:[0,0];let Zi=[0,0],$n=[0,0],Jn=!1;ot||(Kt?($n=[bt.x+Ai+Mt[0],bt.y+Mt[1]-ji],Jn=!0):Zi=[bt.x+Ai+ke[0],bt.y+ke[1]-ji]);const eo=fn.w*bt.scale/(Wt*(bt.localGlyph?ou:1)),Ee=fn.h*bt.scale/(Wt*(bt.localGlyph?ou:1));let be,at,Gt,ut;if(Kt){const vi=bt.y-tt,Ki=new Tt(-Ai,Ai-vi),Li=-Math.PI/2,gi=new Tt(...$n);be=new Tt(-Ai+Zi[0],Zi[1]),be._rotateAround(Li,Ki)._add(gi),be.x+=-vi+Ai,be.y-=(qi.left-ci)*bt.scale;const Wn=bt.image?qi.advance*bt.scale:La*bt.scale,xr=String.fromCodePoint(bt.glyph);Yu(xr)?be.x+=(1-ci)*bt.scale:LC(xr)?be.x+=Wn-qi.height*bt.scale+(-ci-1)*bt.scale:be.x+=bt.image||qi.width+2*ci===fn.w&&qi.height+2*ci===fn.h?(Wn-Ee)/2:(Wn-(qi.height+2*ci)*bt.scale)/2,at=new Tt(be.x,be.y-eo),Gt=new Tt(be.x+Ee,be.y),ut=new Tt(be.x+Ee,be.y-eo)}else{const vi=(qi.left-ci)*bt.scale-Ai+Zi[0],Ki=(-qi.top-ci)*bt.scale+Zi[1],Li=vi+eo,gi=Ki+Ee;be=new Tt(vi,Ki),at=new Tt(Li,Ki),Gt=new Tt(vi,gi),ut=new Tt(Li,gi)}if(Rt){let vi;vi=ot?new Tt(0,0):Jn?new Tt(Mt[0],Mt[1]):new Tt(ke[0],ke[1]),be._rotateAround(Rt,vi),at._rotateAround(Rt,vi),Gt._rotateAround(Rt,vi),ut._rotateAround(Rt,vi)}const qt=new Tt(0,0),wi=new Tt(0,0);wt.push({tl:be,tr:at,bl:Gt,br:ut,texPrimary:vt,texSecondary:void 0,writingMode:Pe.writingMode,glyphOffset:En,sectionIndex:bt.sectionIndex,isSDF:Yt,pixelOffsetTL:qt,pixelOffsetBR:wi,minFontScaleX:0,minFontScaleY:0})}}return wt}(0,a,S,m,g,x,c,n.allowVerticalPlacement),fe=n.textSizeData;let Ie=null;fe.kind==="source"?(Ie=[Ju*m.layout.get("text-size").evaluate(x,{},J)*U.textScaleFactor],Ie[0]>Nd&&ei(`${n.layerIds[0]}: Value for "text-size" is >= ${Gh}. Reduce your "text-size".`)):fe.kind==="composite"&&(Ie=[Ju*U.compositeTextSizes[0].evaluate(x,{},J)*U.textScaleFactor,Ju*U.compositeTextSizes[1].evaluate(x,{},J)*U.textScaleFactor],(Ie[0]>Nd||Ie[1]>Nd)&&ei(`${n.layerIds[0]}: Value for "text-size" is >= ${Gh}. Reduce your "text-size".`)),n.addSymbols(n.text,le,Ie,S,g,x,M,e,i,C.lineStartIndex,C.lineLength,V,q,J,oe,!1,ee,le.length);for(const Se of P)k[Se]=n.text.placedSymbolArray.length-1;return 4*le.length}function cl(n){for(const e in n)return n[e];return null}function Na(n,e,i,a,c,m,g,x,S,C,M){let P,k,V,U;if(P=M?M.top:g.top,k=M?M.bottom:g.bottom,V=M?M.left:g.left,U=M?M.right:g.right,$1(g)&&g.collisionPadding){const q=g.collisionPadding;V-=q[0],P-=q[1],U+=q[2],k+=q[3]}if(S){const q=new Tt(V,P),J=new Tt(U,P),ee=new Tt(V,k),oe=new Tt(U,k),le=hn(S);let fe=new Tt(0,0);C&&(fe=new Tt(C[0],C[1])),q._rotateAround(le,fe),J._rotateAround(le,fe),ee._rotateAround(le,fe),oe._rotateAround(le,fe),V=Math.min(q.x,J.x,ee.x,oe.x),U=Math.max(q.x,J.x,ee.x,oe.x),P=Math.min(q.y,J.y,ee.y,oe.y),k=Math.max(q.y,J.y,ee.y,oe.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,V,P,U,k,x,a,c,m),n.length-1}function su(n){$1(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function ps(n,e,i,a){const c=n.compareText;if(e in c){const m=c[e];for(let g=m.length-1;g>=0;g--)if(a.dist(m[g])<i)return!0}else c[e]=[];return c[e].push(a),!1}function Ms(n,e){const i=n.fovAboveCenter,a=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,c=(n._camera.position[2]*n.worldSize-a)/Math.cos(n._pitch),m=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01));let g=Math.sin(n._pitch)*m+c;const x=c*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let S=Math.max(n.zoom-17,0);n.isOrthographic&&(S/=10),g*=1+S}return Math.min(1.01*g,x)}function fm(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),a=n.x*i,c=(n.x+1)*i,m=n.y*i,g=(n.y+1)*i,x=me(a),S=me(c),C=ce(m),M=ce(g),P=e.project(x,C),k=e.project(S,C),V=e.project(S,M),U=e.project(x,M);let q=Math.min(P.x,k.x,V.x,U.x),J=Math.min(P.y,k.y,V.y,U.y),ee=Math.max(P.x,k.x,V.x,U.x),oe=Math.max(P.y,k.y,V.y,U.y);const le=i/16;function fe(Se,Pe,ke,Be,ot,Ze){const st=(ke+ot)/2,dt=(Be+Ze)/2,wt=e.project(me(st),ce(dt)),Rt=Math.max(0,q-wt.x,J-wt.y,wt.x-ee,wt.y-oe);q=Math.min(q,wt.x),ee=Math.max(ee,wt.x),J=Math.min(J,wt.y),oe=Math.max(oe,wt.y),Rt>le&&(fe(Se,wt,ke,Be,st,dt),fe(wt,Pe,st,dt,ot,Ze))}fe(P,k,a,m,c,m),fe(k,V,c,m,c,g),fe(V,U,c,g,a,g),fe(U,P,a,g,a,m),q-=le,J-=le,ee+=le,oe+=le;const Ie=1/Math.max(ee-q,oe-J);return{scale:Ie,x:q*Ie,y:J*Ie,x2:ee*Ie,y2:oe*Ie,projection:e}}function A0(n,{x:e,y:i},a=0){return new Tt(((e-a)*n.scale-n.x)*Bt,(i*n.scale-n.y)*Bt)}const UC=xe(new Float32Array(16));class $i{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new j(0,0)}projectTilePoint(e,i,a){return{x:e,y:i,z:0}}locationPoint(e,i,a,c=!0){return e._coordinatePoint(e.locationCoordinate(i,a),c)}pixelsPerMeter(e,i){return se(1,e)*i}pixelSpaceConversion(e,i,a){return 1}farthestPixelDistance(e){return Ms(e,e.pixelsPerMeter)}pointCoordinate(e,i,a,c){const m=e.horizonLineFromTop(!1),g=new Tt(i,Math.max(m,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,c))}pointCoordinate3D(e,i,a){const c=new Tt(i,a);if(e.elevation)return e.elevation.pointCoordinate(c);{const m=this.pointCoordinate(e,c.x,c.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const a=e.horizonLineFromTop();return i.y<a}createInversionMatrix(e,i){return UC}createTileMatrix(e,i,a){let c,m,g;const x=a.canonical,S=xe(new Float64Array(16));if(this.isReprojectedInTileSpace){const C=fm(x,this);c=1,m=C.x+a.wrap*C.scale,g=C.y,Ge(S,S,[c/C.scale,c/C.scale,e.pixelsPerMeter/i])}else c=i/e.zoomScale(x.z),m=(x.x+Math.pow(2,x.z)*a.wrap)*c,g=x.y*c;return Ke(S,S,[m,g,0]),Ge(S,S,[c/Bt,c/Bt,1]),S}upVector(e,i,a){return[0,0,1]}upVectorScale(e,i,a){return{metersToTile:1}}}class cv extends $i{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,a]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(hn(i));this.n=(c+Math.sin(hn(a)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:a,c,r0:m}=this,g=hn(e-this.center[0]),x=hn(i),S=Math.sqrt(c-2*a*Math.sin(x))/a;return{x:S*Math.sin(g*a),y:S*Math.cos(g*a)-m,z:0}}unproject(e,i){const{n:a,c,r0:m}=this,g=m+i;let x=Math.atan2(e,Math.abs(g))*Math.sign(g);g*a<0&&(x-=Math.PI*Math.sign(e)*Math.sign(g));const S=hn(this.center[0])*a;x=we(x,-Math.PI-S,Math.PI-S);const C=Y(Ko(x/a)+this.center[0],-180,180),M=Math.asin(Y((c-(e*e+g*g)*a*a)/(2*a),-1,1)),P=Y(Ko(M),-_e,_e);return new j(C,P)}}const pm=1.340264,Hh=-.081106,ih=893e-6,go=.003796,Ba=Math.sqrt(3)/2;class ms extends $i{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(Ba*Math.sin(i)),c=a*a,m=c*c*c;return{x:.5*(e*Math.cos(a)/(Ba*(pm+3*Hh*c+m*(7*ih+9*go*c)))/Math.PI+.5),y:1-.5*(a*(pm+Hh*c+m*(ih+go*c))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,c=a*a,m=c*c*c;for(let M,P,k,V=0;V<12&&(P=a*(pm+Hh*c+m*(ih+go*c))-i,k=pm+3*Hh*c+m*(7*ih+9*go*c),M=P/k,a=Y(a-M,-Math.PI/3,Math.PI/3),c=a*a,m=c*c*c,!(Math.abs(M)<1e-12));++V);const g=Ba*e*(pm+3*Hh*c+m*(7*ih+9*go*c))/Math.cos(a),x=Math.asin(Math.sin(a)/Ba),S=Y(180*g/Math.PI,-180,180),C=Y(180*x/Math.PI,-_e,_e);return new j(S,C)}}class C0 extends $i{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const a=360*(e-.5),c=Y(360*(.5-i),-_e,_e);return new j(a,c)}}const $h=Math.PI/2;function Gf(n){return Math.tan(($h+n)/2)}class jC extends $i{constructor(e){super(e),this.center=e.center||[0,30];const[i,a]=this.parallels=e.parallels||[30,30];let c=hn(i),m=hn(a);this.southernCenter=c+m<0,this.southernCenter&&(c=-c,m=-m);const g=Math.cos(c),x=Gf(c);this.n=c===m?Math.sin(c):Math.log(g/Math.cos(m))/Math.log(Gf(m)/x),this.f=g*Math.pow(Gf(c),this.n)/this.n}project(e,i){i=hn(i),this.southernCenter&&(i=-i),e=hn(e-this.center[0]);const a=1e-6,{n:c,f:m}=this;m>0?i<-$h+a&&(i=-$h+a):i>$h-a&&(i=$h-a);const g=m/Math.pow(Gf(i),c);let x=g*Math.sin(c*e),S=m-g*Math.cos(c*e);return x=.5*(x/Math.PI+.5),S=.5*(S/Math.PI+.5),{x,y:this.southernCenter?S:1-S,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:a,f:c}=this,m=c-i,g=Math.sign(m),x=Math.sign(a)*Math.sqrt(e*e+m*m);let S=Math.atan2(e,Math.abs(m))*g;m*a<0&&(S-=Math.PI*Math.sign(e)*g);const C=Y(Ko(S/a)+this.center[0],-180,180),M=Y(Ko(2*Math.atan(Math.pow(c/x,1/a))-$h),-_e,_e);return new j(C,this.southernCenter?-M:M)}}class rE extends $i{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:ne(e),y:te(i),z:0}}unproject(e,i){const a=me(e),c=ce(i);return new j(a,c)}}const hi=hn(_e);class lu extends $i{project(e,i){const a=(i=hn(i))*i,c=a*a;return{x:.5*((e=hn(e))*(.8707-.131979*a+c*(c*(.003971*a-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+c*(.028874*a-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,c=25,m=0,g=a*a;do{g=a*a;const C=g*g;m=(a*(1.007226+g*(.015085+C*(.028874*g-.044475-.005916*C)))-i)/(1.007226+g*(.045255+C*(.259866*g-.311325-.005916*11*C))),a=Y(a-m,-hi,hi)}while(Math.abs(m)>1e-6&&--c>0);g=a*a;const x=Y(Ko(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),S=Ko(a);return new j(x,S)}}const Bd=hn(_e);class ew extends $i{project(e,i){i=hn(i),e=hn(e);const a=Math.cos(i),c=2/Math.PI,m=Math.acos(a*Math.cos(e/2)),g=Math.sin(m)/m,x=.5*(e*c+2*a*Math.sin(e/2)/g)||0,S=.5*(i+Math.sin(i)/g)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(e,i){let a=e=(2*e-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,m=25;const g=1e-6;let x=0,S=0;do{const C=Math.cos(c),M=Math.sin(c),P=2*M*C,k=M*M,V=C*C,U=Math.cos(a/2),q=Math.sin(a/2),J=2*U*q,ee=q*q,oe=1-V*U*U,le=oe?1/oe:0,fe=oe?Math.acos(C*U)*Math.sqrt(1/oe):0,Ie=.5*(2*fe*C*q+2*a/Math.PI)-e,Se=.5*(fe*M+c)-i,Pe=.5*le*(V*ee+fe*C*U*k)+1/Math.PI,ke=le*(J*P/4-fe*M*q),Be=.125*le*(P*q-fe*M*V*J),ot=.5*le*(k*U+fe*ee*C)+.5,Ze=ke*Be-ot*Pe;x=(Se*ke-Ie*ot)/Ze,S=(Ie*Be-Se*Pe)/Ze,a=Y(a-x,-Math.PI,Math.PI),c=Y(c-S,-Bd,Bd)}while((Math.abs(x)>g||Math.abs(S)>g)&&--m>0);return new j(Ko(a),Ko(c))}}class bo extends $i{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(hn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:a,cosPhi:c}=this;return{x:hn(e)*c*a+.5,y:-Math.sin(hn(i))/c*a+.5,z:0}}unproject(e,i){const{scale:a,cosPhi:c}=this,m=-(i-.5)/a,g=Y(Ko((e-.5)/a)/c,-180,180),x=Math.asin(Y(m*c,-1,1)),S=Y(Ko(x),-_e,_e);return new j(g,S)}}class Hi extends rE{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,a){const c=Id(e,i,a);return on(c,c,xy(Fh(a))),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,i,a){const c=D(i.lat,i.lng),m=mn([],c),g=a?e._centerAltitude+a:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;pr(c,c,m,se(1,0)*Bt*g);const x=xe(new Float64Array(16));return Le(x,e.pixelMatrix,e.globeMatrix),on(c,c,x),new Tt(c[0],c[1])}pixelsPerMeter(e,i){return se(1,0)*i}pixelSpaceConversion(e,i,a){const c=se(1,e)*i,m=Si(se(1,45)*i,c,a);return this.pixelsPerMeter(e,i)/m}createTileMatrix(e,i,a){const c=Kb(Fh(a.canonical));return Le(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,i){const{center:a}=e,c=xy(Fh(i));return mt(c,c,hn(a.lng)),Ye(c,c,hn(a.lat)),Ge(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,i,a,c){return BT(e,i,a,!0)||new He(0,0)}pointCoordinate3D(e,i,a){const c=this.pointCoordinate(e,i,a,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,i){return!BT(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(c,m){const g=c.cameraToCenterDistance,x=c._centerAltitude*m,S=c._camera,C=c._camera.forward(),M=fi([],pn([],C,-g),[0,0,x]),P=c.worldSize/(2*Math.PI),k=[0,0,-P],V=c.width/c.height,U=Math.tan(c.fovAboveCenter),q=pn([],S.up(),U),J=pn([],S.right(),U*V),ee=mn([],fi([],fi([],C,q),J)),oe=[];let le;if(new tn(M,ee).closestPointOnSphere(k,P,oe)){const fe=fi([],oe,k),Ie=Fr([],fe,M);le=Math.cos(c.fovAboveCenter)*Qt(Ie)}else{const fe=Fr([],M,k),Ie=Fr([],k,M);mn(Ie,Ie);const Se=Qt(fe)-P;le=Math.sqrt(Se*(Se+2*P));const Pe=Math.acos(le/(P+Se))-Math.acos(Ei(C,Ie));le*=Math.cos(Pe)}return 1.01*le}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Rd(e.zoom);if(a>0){const c=Ms(e,se(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Si(i,c+m*(1-Math.cos(g)),Math.pow(a,10))}return i}upVector(e,i,a){return Id(i,a,e,1)}upVectorScale(e){return{metersToTile:Sx(vy(Fh(e)))}}}function mm(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new rE(n);case"equirectangular":return new C0(n);case"naturalEarth":return new lu(n);case"equalEarth":return new ms(n);case"winkelTripel":return new ew(n);case"albers":return i?new bo(n):new cv(n);case"lambertConformalConic":return i?new bo(n):new jC(n);case"globe":return new Hi(n)}throw new Error(`Invalid projection name: ${n.name}`)}const GC=At.types,ul=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function gm(n,e,i,a,c,m,g,x,S,C,M,P,k){const V=x?Math.min(Nd,Math.round(x[0])):0,U=x?Math.min(Nd,Math.round(x[1])):0;n.emplaceBack(e,i,Math.round(32*a),Math.round(32*c),m,g,(V<<1)+(S?1:0),0+(U<<1),16*C,16*M,256*P,256*k)}function Wh(n,e,i){n.emplaceBack(e,i)}function qh(n,e,i,a,c,m,g){n.emplaceBack(e,i,a,c,m,g)}const uv=(n,e,i,a)=>{for(let c=0;c<e;c++)n.emplaceBack(i[0],i[1],i[2],a[0],a[1],a[2])};function _m(n,e,i,a,c){n.emplaceBack(e,i,a,c),n.emplaceBack(e,i,a,c),n.emplaceBack(e,i,a,c),n.emplaceBack(e,i,a,c)}function Zh(n){for(const e of n.sections)if(Wb(e.text))return!0;return!1}class Yl{constructor(e){this.layoutVertexArray=new Td,this.indexArray=new lr,this.programConfigurations=e,this.segments=new oo,this.dynamicLayoutVertexArray=new ju,this.opacityVertexArray=new xg,this.placedSymbolArray=new Tl,this.iconTransitioningVertexArray=new jl,this.globeExtVertexArray=new _f,this.zOffsetVertexArray=new Vu,this.orientationVertexArray=new yf,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,i){const a=[],c=this.layoutVertexArray.uint16;for(let m=0;m<i;++m){const g=12*(e+m);a.push(...c.slice(g,g+12))}return a}updateIconVertexData(e,i,a,c,m,g,x,S,C,M,P,k,V){const U=this.layoutVertexArray.uint16,q=12*e;U[q]=i,U[q+1]=a,U[q+2]=c,U[q+3]=m,U[q+4]=g,U[q+5]=x,U[q+6]=S,U[q+7]=C,U[q+8]=M,U[q+9]=P,U[q+10]=k,U[q+11]=V}upload(e,i,a,c,m,g){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,PC.members,!!g),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,XS.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ul,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,YS.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,OC.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,s0.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,kC.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}li(Yl,"SymbolBuffers");class I0{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new oo,this.collisionVertexArray=new Mh,this.collisionVertexArrayExt=new ju}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Xg.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,KS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}li(I0,"CollisionBuffers");class r_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=xe([]),this.placementViewportMatrix=xe([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=Qu(this.zoom,i["text-size"],this.worldview),this.iconSizeData=Qu(this.zoom,i["icon-size"],this.worldview);const a=this.layers[0].layout,c=a.get("symbol-sort-key"),m=a.get("symbol-z-order");this.lut=e.lut,this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(g=>ll[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(e){const i=this.layers[0].getAppearances();return!(!i||i.length===0)&&i.some(a=>a.getProperty(e)!=null)}createArrays(){this.text=new Yl(new Ns(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Yl(new Ns(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Sd,this.lineVertexArray=new $l,this.symbolInstances=new Hp}calculateGlyphDependencies(e,i,a,c,m){for(const g of e){const x=g.codePointAt(0);if(x===void 0)break;if(i[x]=!0,c&&m&&x<=65535){const S=Wy[g];S&&(i[S.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,i,a,c,m,g){let x=1;const S=e.getUnevaluatedProperties()._values["icon-size"],C=Qu(this.zoom,S,this.worldview),M=ru(C,i);if(C.kind!=="constant"&&C.kind!=="camera"||(x=M.uSize),C.kind==="composite"){const{minZoom:P,maxZoom:k}=C,V=S.possiblyEvaluate(new Ar(P,{worldview:this.worldview}),c),U=S.possiblyEvaluate(new Ar(k,{worldview:this.worldview}),c),q=V.evaluate(a,{},c,m);x=q+(U.evaluate(a,{},c,m)-q)*M.uSizeT}return C.kind==="source"&&(x=S.possiblyEvaluate(new Ar(this.zoom,{worldview:this.worldview}),c).evaluate(a,{},c,m)),x*g}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!My(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?sa.build(e):e}populate(e,i,a,c){const m=this.layers[0],g=m.layout,x=this.projection.name==="globe",S=g.get("text-font"),C=g.get("text-field"),M=g.get("icon-image"),[P,k]=g.get("icon-size-scale-range"),V=Y(i.scaleFactor||1,P,k),U=(C.value.kind!=="constant"||C.value.value instanceof Do&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),q=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,J=this.hasAnyAppearanceProperty("icon-image"),ee=g.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!U&&!q&&!J)return;const oe=i.iconDependencies,le=i.glyphDependencies,fe=i.availableImages,Ie=new Ar(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),Se=Pe=>{const ke=Pe.id.toString();oe.has(ke)?oe.get(ke).push(Pe):oe.set(ke,[Pe])};for(const Pe of e){const{feature:ke,id:Be,index:ot,sourceLayerIndex:Ze}=Pe,st=m._featureFilter.needGeometry,dt=et(ke,st);if(!m._featureFilter.filter(Ie,dt,a))continue;if(st||(dt.geometry=ct(ke,a,c)),x&&ke.type!==1&&a.z<=5){const St=dt.geometry,It=.98078528056,bt=(vt,ci)=>Ei(Id(vt.x,vt.y,a,1),Id(ci.x,ci.y,a,1))<It;for(let vt=0;vt<St.length;vt++)St[vt]=lt(St[vt],bt)}let wt,Rt;if(U){const St=m.getValueAndResolveTokens("text-field",dt,a,fe),It=Do.factory(St);Zh(It)&&(this.hasRTLText=!0),(!this.hasRTLText||iy()==="unavailable"||this.hasRTLText&&tl.isParsed())&&(wt=FC(It,m,dt))}if(q){const St=m.getValueAndResolveTokens("icon-image",dt,a,fe);Rt=this.getResolvedImageFromTokens(St)}const Mt=this.layers[0];let yt=!1;if(!Rt&&J){const St=Mt.getAppearances();for(const It of St)if(It.getProperty("icon-image")){const bt=Mt.getAppearanceValueAndResolveTokens(It,"icon-image",dt,a,fe);if(bt){Rt=this.getResolvedImageFromTokens(bt),yt=!0;break}}}if(!wt&&!Rt)continue;const Dt=this.sortFeaturesByKey?ee.evaluate(dt,{},a):void 0,nt={id:Be,text:wt,icon:Rt,index:ot,sourceLayerIndex:Ze,geometry:dt.geometry,properties:ke.properties,type:GC[ke.type],sortKey:Dt};if(this.features.push(nt),this.appearanceFeatureData.push({id:Be,properties:ke.properties,usesAppearanceIconAsPlaceholder:yt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Rt){const St=Mt._unevaluatedLayout._values,{iconPrimary:It,iconSecondary:bt}=n_(Rt,this.iconSizeData,St["icon-size"],a,this.zoom,nt,this.pixelRatio,V,this.worldview);Se(It),bt&&(this.hasAnySecondaryIcon=!0,Se(bt))}const tt=Mt.getAppearances();if(tt.length!==0&&tt.forEach(St=>{if(!St.getProperty("icon-image"))return;const It=this.getCombinedIconPrimary(St,Mt,dt,a,fe,nt,V);It&&Se(It)}),wt){const St=S.evaluate(dt,{},a).join(","),It=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ll.vertical)>=0;for(const bt of wt.sections)if(bt.image){const vt=bt.image.getPrimary().scaleSelf(this.pixelRatio),ci=vt.id.toString(),Yt=oe.get(ci)||[];Yt.push(vt),oe.set(ci,Yt)}else{const vt=Q_(wt.toString()),ci=bt.fontStack||St,Yt=le[ci]=le[ci]||{};this.calculateGlyphDependencies(bt.text,Yt,It,this.allowVerticalPlacement,vt)}}}if(g.get("symbol-placement")==="line"&&(this.features=function(Pe){const ke={},Be={},ot=[];let Ze=0;function st(Mt){ot.push(Pe[Mt]),Ze++}function dt(Mt,yt,Dt){const nt=Be[Mt];return delete Be[Mt],Be[yt]=nt,ot[nt].geometry[0].pop(),ot[nt].geometry[0]=ot[nt].geometry[0].concat(Dt[0]),nt}function wt(Mt,yt,Dt){const nt=ke[yt];return delete ke[yt],ke[Mt]=nt,ot[nt].geometry[0].shift(),ot[nt].geometry[0]=Dt[0].concat(ot[nt].geometry[0]),nt}function Rt(Mt,yt,Dt){const nt=Dt?yt[0][yt[0].length-1]:yt[0][0];return`${Mt}:${nt.x}:${nt.y}`}for(let Mt=0;Mt<Pe.length;Mt++){const yt=Pe[Mt],Dt=yt.geometry,nt=yt.text?yt.text.toString():null;if(!nt){st(Mt);continue}const tt=Rt(nt,Dt),St=Rt(nt,Dt,!0);if(tt in Be&&St in ke&&Be[tt]!==ke[St]){const It=wt(tt,St,Dt),bt=dt(tt,St,ot[It].geometry);delete ke[tt],delete Be[St],Be[Rt(nt,ot[bt].geometry,!0)]=bt,ot[It].geometry=null}else tt in Be?dt(tt,St,Dt):St in ke?wt(tt,St,Dt):(st(Mt),ke[tt]=Ze-1,Be[St]=Ze-1)}return ot.filter(Mt=>Mt.geometry)}(this.features)),g.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Pe of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Pe.id,this.elevationFeatures.length),this.elevationFeatures.push(Pe)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Pe,ke)=>Pe.sortKey-ke.sortKey)}getCombinedIconPrimary(e,i,a,c,m,g,x){let S,C;const M=e.getUnevaluatedProperties();if(M._values["icon-image"].value!==void 0){const P=i.getAppearanceValueAndResolveTokens(e,"icon-image",a,c,m);S=this.getResolvedImageFromTokens(P)}else{const P=i.getValueAndResolveTokens("icon-image",a,c,m);S=this.getResolvedImageFromTokens(P)}if(S){const P=M._values["icon-size"]||i._unevaluatedLayout._values["icon-size"];C=n_(S,Qu(this.zoom,P,this.worldview),P,c,this.zoom,g,this.pixelRatio,x,this.worldview).iconPrimary}return C}updateAppearanceBasedIconTextures(e,i,a,c){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const m=this.layers[0];let g=!1,x=0;const S=m.layout,[C,M]=S.get("icon-size-scale-range"),P=Y(1,C,M);for(let k=0;k<this.symbolInstances.length;k++){const V=this.symbolInstances.get(k),U=this.appearanceFeatureData[V.featureIndex];if(U&&V.placedIconSymbolIndex>=0){const q=U.id,J=i&&q!==void 0?i[String(q)]:void 0,ee={type:"Point",id:U.id,properties:U.properties,geometry:[]},oe=this.layers[0].appearances&&this.layers[0].appearances.find(le=>le.isActive({globals:c,feature:ee,canonical:e,featureState:J}));if(U.activeAppearance===oe)continue;if(oe){U.activeAppearance=oe;const le={sortKey:void 0,text:void 0,icon:null,index:V.featureIndex,sourceLayerIndex:V.featureIndex,geometry:[],properties:U.properties,type:"Point",id:U.id};if(!oe.hasCachedIconPrimary()){const Pe=this.getCombinedIconPrimary(oe,m,ee,e,a,le,P);oe.setCachedIconPrimary(Pe)}const fe=oe.getCachedIconPrimary();if(!fe)continue;const Ie=fe.toString(),Se=this.iconAtlasPositions&&this.iconAtlasPositions.get(Ie);if(Se){const Pe=m.getAppearanceValueAndResolveTokens(oe,"icon-offset",ee,e,a),ke=Pe&&Array.isArray(Pe)?Pe:[0,0];let Be=Ky(Se,void 0,ke,m.layout.get("icon-anchor").evaluate(ee,{},e));const ot=m.getAppearanceValueAndResolveTokens(oe,"icon-rotate",ee,e,a),Ze=typeof ot=="number"?ot:0,st=Se.sdf,dt=m.layout.get("icon-text-fit").constantOr("none");dt!=="none"&&U.textShaping&&U.iconTextFitPadding&&U.fontScale&&(Be=_0(Be,U.textShaping,dt,U.iconTextFitPadding,ke,U.fontScale));const wt=this.calculateEffectiveAppearanceIconSize(oe,c.zoom,ee,e,a,P),Rt=0,Mt=1+(Math.min(Nd,Math.round(wt*Ju))<<1),yt=Z1(Be,Ze,st,dt!=="none",P);U.isUsingAppearanceVertexData||(U.isUsingAppearanceVertexData=!0,U.layoutBasedVertexData=this.icon.getIconVertexData(x,V.numIconVertices));for(let nt=0;nt<yt.length;++nt){const tt=yt[nt],St=U.layoutBasedVertexData[0]||V.tileAnchorX,It=U.layoutBasedVertexData[1]||V.tileAnchorY,bt=16*tt.pixelOffsetTL.x,vt=16*tt.pixelOffsetTL.y,ci=16*tt.pixelOffsetBR.x,Yt=16*tt.pixelOffsetBR.y,Wt=16*tt.minFontScaleX,ji=16*tt.minFontScaleY;this.icon.updateIconVertexData(x,St,It,Math.round(32*tt.tl.x),Math.round(32*tt.tl.y),tt.texPrimary.x,tt.texPrimary.y,Rt,Mt,bt,vt,Wt,ji),this.icon.updateIconVertexData(x+1,St,It,Math.round(32*tt.tr.x),Math.round(32*tt.tr.y),tt.texPrimary.x+tt.texPrimary.w,tt.texPrimary.y,Rt,Mt,ci,vt,Wt,ji),this.icon.updateIconVertexData(x+2,St,It,Math.round(32*tt.bl.x),Math.round(32*tt.bl.y),tt.texPrimary.x,tt.texPrimary.y+tt.texPrimary.h,Rt,Mt,bt,Yt,Wt,ji),this.icon.updateIconVertexData(x+3,St,It,Math.round(32*tt.br.x),Math.round(32*tt.br.y),tt.texPrimary.x+tt.texPrimary.w,tt.texPrimary.y+tt.texPrimary.h,Rt,Mt,ci,Yt,Wt,ji),x+=4}const Dt=V.numIconVertices-4*yt.length;for(let nt=0;nt<Dt;++nt)this.icon.updateIconVertexData(x+nt,0,0,0,0,0,0,0,0,0,0,0,0);g=!0}else x+=V.numIconVertices}else if(U.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(x,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+3,0,0,0,0,0,0,0,0,0,0,0,0),g=!0),x+=V.numIconVertices,U.activeAppearance=null;else if(U.isUsingAppearanceVertexData){const fe=U.layoutBasedVertexData.length/12;for(let Ie=0;Ie<fe;++Ie){const Se=Ie*12;this.icon.updateIconVertexData(x+Ie,U.layoutBasedVertexData[Se+0],U.layoutBasedVertexData[Se+1],U.layoutBasedVertexData[Se+2],U.layoutBasedVertexData[Se+3],U.layoutBasedVertexData[Se+4],U.layoutBasedVertexData[Se+5],U.layoutBasedVertexData[Se+6],U.layoutBasedVertexData[Se+7],U.layoutBasedVertexData[Se+8],U.layoutBasedVertexData[Se+9],U.layoutBasedVertexData[Se+10],U.layoutBasedVertexData[Se+11])}x+=fe,U.isUsingAppearanceVertexData=!1,U.activeAppearance=null,g=!0}else x+=V.numIconVertices,U.activeAppearance=null}}return g}update(e,i,a,c,m,g,x){this.text.programConfigurations.updatePaintArrays(e,i,m,a,c,g,x,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,m,a,c,g,x,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const a=De(e),c=1/a;let m=!1,g=!1;for(let x=0;x<this.symbolInstances.length;x++){const S=this.symbolInstances.get(x),C=_t(1,0,0),M=_t(0,1,0),{numHorizontalGlyphVertices:P,numVerticalGlyphVertices:k,numIconVertices:V,numVerticalIconVertices:U}=S,q=P>0||k>0,J=V>0,ee=this.elevationFeatures[S.elevationFeatureIndex];if(ee){const oe=new Tt(S.tileAnchorX,S.tileAnchorY),le=.075+ee.pointElevation(oe);S.zOffset!==le&&(i=!0,S.zOffset=le),le!==0&&(this.hasAnyZOffset=!0);const fe=ee.computeSlopeNormal(oe,c),Ie=jr(Io(),_t(0,0,1),fe);gr(C,C,Ie),gr(M,M,Ie),C[2]*=a,M[2]*=a,C[0]===1&&C[1]===0&&C[2]===0&&M[0]===0&&M[1]===1&&M[2]===0||(m=m||q,g=g||J)}if(q&&(uv(this.text.orientationVertexArray,P,C,M),uv(this.text.orientationVertexArray,k,C,M)),J){const{placedIconSymbolIndex:oe,verticalPlacedIconSymbolIndex:le}=S;oe>=0&&uv(this.icon.orientationVertexArray,V,C,M),le>=0&&uv(this.icon.orientationVertexArray,U,C,M)}}m||(this.text.orientationVertexArray=void 0),g||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(m,g,x)=>{a+=g,a>m.length&&m.resize(a);for(let S=-g;S<0;S++)m.emplace(S+a,x)},i=(m,g,x)=>{c+=g,c>m.length&&m.resize(c);for(let S=-g;S<0;S++)m.emplace(S+c,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,c=0;for(let m=0;m<this.symbolInstances.length;m++){const g=this.symbolInstances.get(m),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:S,numIconVertices:C}=g,M=g.zOffset,P=C>0;if((x>0||S>0)&&(e(this.text.zOffsetVertexArray,x,M),e(this.text.zOffsetVertexArray,S,M)),P){const{placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:V}=g;k>=0&&i(this.icon.zOffsetVertexArray,C,M),V>=0&&i(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,i,a,c,m){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(g=>g.appearances&&g.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,i,a,c){return!!(e&&i&&a)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,i,a,c)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=mm(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:c,y:m}of i)this.lineVertexArray.emplaceBack(c,m);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,c,m,g,x,S,C,M,P,k,V,U,q,J,ee,oe){const le=e.indexArray,fe=e.layoutVertexArray,Ie=e.globeExtVertexArray,Se=e.segments.prepareSegment(4*oe,fe,le,this.canOverlap?g.sortKey:void 0),Pe=this.glyphOffsetArray.length,ke=Se.vertexLength,Be=this.allowVerticalPlacement&&x===ll.vertical?Math.PI/2:0,ot=g.text&&g.text.sections;for(let dt=0;dt<i.length;dt++){const{tl:wt,tr:Rt,bl:Mt,br:yt,texPrimary:Dt,texSecondary:nt,pixelOffsetTL:tt,pixelOffsetBR:St,minFontScaleX:It,minFontScaleY:bt,glyphOffset:vt,isSDF:ci,sectionIndex:Yt}=i[dt],Wt=Se.vertexLength,ji=vt[1];if(gm(fe,C.x,C.y,wt.x,ji+wt.y,Dt.x,Dt.y,a,ci,tt.x,tt.y,It,bt),gm(fe,C.x,C.y,Rt.x,ji+Rt.y,Dt.x+Dt.w,Dt.y,a,ci,St.x,tt.y,It,bt),gm(fe,C.x,C.y,Mt.x,ji+Mt.y,Dt.x,Dt.y+Dt.h,a,ci,tt.x,St.y,It,bt),gm(fe,C.x,C.y,yt.x,ji+yt.y,Dt.x+Dt.w,Dt.y+Dt.h,a,ci,St.x,St.y,It,bt),S){const{x:Kt,y:Ai,z:qi}=S.anchor,[fn,En,Zi]=S.up;qh(Ie,Kt,Ai,qi,fn,En,Zi),qh(Ie,Kt,Ai,qi,fn,En,Zi),qh(Ie,Kt,Ai,qi,fn,En,Zi),qh(Ie,Kt,Ai,qi,fn,En,Zi),_m(e.dynamicLayoutVertexArray,Kt,Ai,qi,Be)}else _m(e.dynamicLayoutVertexArray,C.x,C.y,C.z,Be);if(J){const Kt=nt||Dt;Wh(e.iconTransitioningVertexArray,Kt.x,Kt.y),Wh(e.iconTransitioningVertexArray,Kt.x+Kt.w,Kt.y),Wh(e.iconTransitioningVertexArray,Kt.x,Kt.y+Kt.h),Wh(e.iconTransitioningVertexArray,Kt.x+Kt.w,Kt.y+Kt.h)}le.emplaceBack(Wt,Wt+1,Wt+2),le.emplaceBack(Wt+1,Wt+2,Wt+3),Se.vertexLength+=4,Se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(vt[0]),dt!==i.length-1&&Yt===i[dt+1].sectionIndex||e.programConfigurations.populatePaintArrays(fe.length,g,g.index,{},V,U,q,ot&&ot[Yt],this.worldview)}const Ze=oe-i.length;Ze!==0&&this._addNullVertices(Ze,fe,a,S,Ie,e,J,Se,le);const st=S?S.anchor:C;e.placedSymbolArray.emplaceBack(st.x,st.y,st.z,C.x,C.y,Pe,this.glyphOffsetArray.length-Pe,ke,M,P,C.segment,a?a[0]:0,a?a[1]:0,c[0],c[1],x,0,0,0,k,0),e.symbolInstanceIndices.push(ee)}_addNullVertices(e,i,a,c,m,g,x,S,C){for(let M=0;M<e;M++){for(let k=0;k<4;k++)gm(i,0,0,0,0,0,0,a,!1,0,0,0,0),c&&qh(m,0,0,0,0,0,0),_m(g.dynamicLayoutVertexArray,0,0,0,0),x&&Wh(g.iconTransitioningVertexArray,0,0);const P=S.vertexLength;C.emplaceBack(P,P+1,P+2),C.emplaceBack(P+1,P+2,P+3),S.vertexLength+=4,S.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,i,a,c,m,g,x){e.emplaceBack(i,a,c,m,g,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,a,c,m,g,x){const S=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),C=S.vertexLength,M=x.tileAnchorX,P=x.tileAnchorY;for(let V=0;V<4;V++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,i,e.padding,x.zOffset),this._commitLayoutVertex(a.layoutVertexArray,c,m,g,M,P,new Tt(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,m,g,M,P,new Tt(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,c,m,g,M,P,new Tt(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,c,m,g,M,P,new Tt(e.x1,e.y2)),S.vertexLength+=4;const k=a.indexArray;k.emplaceBack(C,C+1),k.emplaceBack(C+1,C+2),k.emplaceBack(C+2,C+3),k.emplaceBack(C+3,C),S.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,c,m,g){for(let x=c;x<m;x++){const S=a.get(x),C=this.getSymbolInstanceTextSize(e,g,i,x);this._addCollisionDebugVertices(S,C,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,i,a,c,m,g){for(let x=c;x<m;x++){const S=a.get(x),C=this.getSymbolInstanceIconSize(e,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(S,C,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,i,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new I0(Dh,Ds.members,jl),this.iconCollisionBox=new I0(Dh,Ds.members,jl);const c=ru(this.iconSizeData,e),m=ru(this.textSizeData,e,a);for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(m,e,i,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(m,e,i,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(c,e,i,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(c,e,i,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,i,a,c){const m=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),g=za(this.textSizeData,e,m)/La;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,i,a){const c=this.icon.placedSymbolArray.get(a),m=za(this.iconSizeData,e,c);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,i,a,c){e.emplaceBack(i,-a,-a,c),e.emplaceBack(i,a,-a,c),e.emplaceBack(i,a,a,c),e.emplaceBack(i,-a,a,c)}_updateTextDebugCollisionBoxes(e,i,a,c,m,g,x){for(let S=c;S<m;S++){const C=a.get(S),M=this.getSymbolInstanceTextSize(e,g,i,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,C.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(e,i,a,c,m,g,x){for(let S=c;S<m;S++){const C=a.get(S),M=this.getSymbolInstanceIconSize(e,i,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,C.padding,g.zOffset)}}updateCollisionDebugBuffers(e,i,a,c){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const m=ru(this.iconSizeData,e,c),g=ru(this.textSizeData,e,a);for(let x=0;x<this.symbolInstances.length;x++){const S=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(g,e,i,S.textBoxStartIndex,S.textBoxEndIndex,S,a),this._updateTextDebugCollisionBoxes(g,e,i,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,a),this._updateIconDebugCollisionBoxes(m,e,i,S.iconBoxStartIndex,S.iconBoxEndIndex,S,c),this._updateIconDebugCollisionBoxes(m,e,i,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,c)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,c,m,g,x,S,C){const M={};if(i<a){const{x1:P,y1:k,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:fe,featureIndex:Ie}=e.get(i);M.textBox={x1:P,y1:k,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:fe},M.textFeatureIndex=Ie}if(c<m){const{x1:P,y1:k,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:fe,featureIndex:Ie}=e.get(c);M.verticalTextBox={x1:P,y1:k,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:fe},M.verticalTextFeatureIndex=Ie}if(g<x){const{x1:P,y1:k,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:fe,featureIndex:Ie}=e.get(g);M.iconBox={x1:P,y1:k,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:fe},M.iconFeatureIndex=Ie}if(S<C){const{x1:P,y1:k,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:fe,featureIndex:Ie}=e.get(S);M.verticalIconBox={x1:P,y1:k,x2:V,y2:U,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:oe,tileAnchorX:le,tileAnchorY:fe},M.verticalIconFeatureIndex=Ie}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),c=a.vertexStartIndex+4*a.numGlyphs;for(let m=a.vertexStartIndex;m<c;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),c=[],m=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const S=this.symbolInstances.get(x);c.push(0|Math.round(i*S.tileAnchorX+a*S.tileAnchorY)),m.push(S.featureIndex)}return g.sort((x,S)=>c[x]-c[S]||m[S]-m[x]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:C}=a;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),m>=0&&m!==c&&this.addIndicesForPlacedSymbol(this.text,m),g>=0&&g!==m&&g!==c&&this.addIndicesForPlacedSymbol(this.text,g),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const i=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let a;return this.elevationFeatures&&i<this.elevationFeatures.length&&(a=this.elevationFeatures[i]),a}}function R0(n,e){return e.replace(/{([^{}]+)}/g,(i,a)=>a in n?String(n[a]):"")}let D0,M0,oE;li(r_,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),r_.addDynamicAttributes=_m;class HC{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:kc,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}li(HC,"FormatSectionOverride",{omit:["defaultValue"]});const hv=()=>oE||(oE={layout:D0||(D0=new ro({"symbol-placement":new Pt(qe.layout_symbol["symbol-placement"]),"symbol-spacing":new Pt(qe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Pt(qe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Xt(qe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Pt(qe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Pt(qe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Pt(qe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Pt(qe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Pt(qe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Pt(qe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Pt(qe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Xt(qe.layout_symbol["icon-size"]),"icon-size-scale-range":new Pt(qe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Xt(qe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xt(qe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Xt(qe.layout_symbol["icon-image"]),"icon-image-use-theme":new Pt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Xt(qe.layout_symbol["icon-rotate"]),"icon-padding":new Pt(qe.layout_symbol["icon-padding"]),"icon-keep-upright":new Pt(qe.layout_symbol["icon-keep-upright"]),"icon-offset":new Xt(qe.layout_symbol["icon-offset"]),"icon-anchor":new Xt(qe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Pt(qe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Pt(qe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Pt(qe.layout_symbol["text-rotation-alignment"]),"text-field":new Xt(qe.layout_symbol["text-field"]),"text-font":new Xt(qe.layout_symbol["text-font"]),"text-size":new Xt(qe.layout_symbol["text-size"]),"text-size-scale-range":new Pt(qe.layout_symbol["text-size-scale-range"]),"text-max-width":new Xt(qe.layout_symbol["text-max-width"]),"text-line-height":new Xt(qe.layout_symbol["text-line-height"]),"text-letter-spacing":new Xt(qe.layout_symbol["text-letter-spacing"]),"text-justify":new Xt(qe.layout_symbol["text-justify"]),"text-radial-offset":new Xt(qe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Pt(qe.layout_symbol["text-variable-anchor"]),"text-anchor":new Xt(qe.layout_symbol["text-anchor"]),"text-max-angle":new Pt(qe.layout_symbol["text-max-angle"]),"text-writing-mode":new Pt(qe.layout_symbol["text-writing-mode"]),"text-rotate":new Xt(qe.layout_symbol["text-rotate"]),"text-padding":new Pt(qe.layout_symbol["text-padding"]),"text-keep-upright":new Pt(qe.layout_symbol["text-keep-upright"]),"text-transform":new Xt(qe.layout_symbol["text-transform"]),"text-offset":new Xt(qe.layout_symbol["text-offset"]),"text-allow-overlap":new Pt(qe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Pt(qe.layout_symbol["text-ignore-placement"]),"text-optional":new Pt(qe.layout_symbol["text-optional"]),visibility:new Pt(qe.layout_symbol.visibility)})),paint:M0||(M0=new ro({"icon-opacity":new Xt(qe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Xt(qe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Xt(qe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Xt(qe.paint_symbol["text-emissive-strength"]),"icon-color":new Xt(qe.paint_symbol["icon-color"]),"icon-halo-color":new Xt(qe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Xt(qe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Xt(qe.paint_symbol["icon-halo-blur"]),"icon-translate":new Pt(qe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Pt(qe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Pt(qe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Xt(qe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Xt(qe.paint_symbol["text-occlusion-opacity"]),"text-color":new Xt(qe.paint_symbol["text-color"],{runtimeType:ks,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Xt(qe.paint_symbol["text-halo-color"]),"text-halo-width":new Xt(qe.paint_symbol["text-halo-width"]),"text-halo-blur":new Xt(qe.paint_symbol["text-halo-blur"]),"text-translate":new Pt(qe.paint_symbol["text-translate"]),"text-translate-anchor":new Pt(qe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Pt(qe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Pt(qe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Pt(qe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Pt(qe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Xt(qe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},oE);class ym extends ha{constructor(e,i,a,c){super(e,hv(),i,a,c,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=xe([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.appearances&&this.appearances.forEach(c=>{c.recalculate(e,i,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const c=[];for(const m of a)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,a,c){return this._saturation===e&&this._contrast===i&&this._brightnessMin===a&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(m,g,x,S){m=Zr(m),g=Rr(g);const C=de(),M=m/3,P=1-2*M,k=[P,M,M,0,M,P,M,0,M,M,P,0,0,0,0,1],V=.5-.5*g,U=S-x;return Le(C,[U,0,0,0,0,U,0,0,0,0,U,0,x,x,x,1],[g,0,0,0,0,g,0,0,0,0,g,0,V,V,V,1]),Le(C,C,k),C}(e,i,a,c),this._saturation=e,this._contrast=i,this._brightnessMin=a,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,a,c){const m=this.layout.get(e).evaluate(i,{},a,c),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||cg(g.value)||!m?m:R0(i.properties,m)}getAppearanceValueAndResolveTokens(e,i,a,c,m){const g=e.getProperty(i);if(!g)return;const x=g.evaluate(a,{},c,m),S=e.getUnevaluatedProperties()._values[i];return S.isDataDriven()||cg(S.value)||!x||typeof x!="string"?x:R0(a.properties,x)}createBucket(e){return new r_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of hv().paint.overridableProperties){if(!ym.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new HC(i),c=new lg(a,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let m=null;m=i.value.kind==="constant"||i.value.kind==="source"?new Op("source",c):new wh("composite",c,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Ea(i.property,m,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&ym.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),c=hv().paint.properties[i];let m=!1;const g=x=>{for(const S of x)if(c.overrides&&c.overrides.hasOverride(S))return void(m=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Do)g(a.value.value.sections);else if(a.value.kind==="source"){const x=C=>{m||(C instanceof Eu&&_a(C.value)===dh?g(C.value.sections):C instanceof ud?g(C.sections):C.eachChild(x))},S=a.value;S._styleExpression&&x(S._styleExpression.expression)}return m}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,a){return{config:new $u(this,{zoom:i,lut:a}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let tw,iw,nw,rw;var P0=gn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function vm(n,e,i,a,c,m,g,x){const S=[n,e,1,i,a,1,c,m,1],C=[g,x,1],M=re([],S),[P,k,V]=Ur(C,C,M);return he(S,S,[P,0,0,0,k,0,0,0,V])}function O0(n,e,i,a,c,m,g,x){const S=function(C,M,P,k,V,U,q,J){const ee=vm(0,0,1,0,1,1,0,1),oe=vm(C,M,P,k,V,U,q,J);return he(oe,oe,re([],ee))}(n,e,i,a,c,m,g,x);return[S[2]/S[8]/Bt,S[5]/S[8]/Bt]}function o_(n){return[n[0],Math.min(Math.max(n[1],-_e),_e)]}class a_ extends vn{constructor(e,i,a,c){super(),this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Je("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=sc(this.map._requestManager.transformRequest(this.url,bu.Image),(a,c)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Ut(a)):c&&(this.image=c instanceof HTMLImageElement?bs.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Jc(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Je("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Jc||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],a=e[0][1];for(const m of e)m[1]>a&&(a=m[1]),m[1]<i&&(i=m[1]);const c=(a+i)/2;if(c>_e?this.onNorthPole=!0:c<-_e&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const m=e.map(He.fromLngLat);this.tileID=function(g){let x=1/0,S=1/0,C=-1/0,M=-1/0;for(const q of g)x=Math.min(x,q.x),S=Math.min(S,q.y),C=Math.max(C,q.x),M=Math.max(M,q.y);const P=Math.max(C-x,M-S),k=Math.max(0,Math.floor(-Math.log2(P))),V=Math.pow(2,k);let U=Math.floor((x+C)/2*V);return U>1&&(U-=1),new Al(k,U,Math.floor((S+M)/2*V))}(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Je("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Jc||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const ee in this.tiles){const oe=this.tiles[ee];oe.state!=="loaded"&&(oe.state="loaded",oe.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=fm(new Al(0,0,0),this.map.transform.projection),a=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ee){const oe=ee[1].x-ee[0].x,le=ee[1].y-ee[0].y,fe=ee[2].x-ee[1].x,Ie=ee[2].y-ee[1].y,Se=ee[3].x-ee[2].x,Pe=ee[3].y-ee[2].y,ke=ee[0].x-ee[3].x,Be=ee[0].y-ee[3].y,ot=oe*Ie-fe*le,Ze=fe*Pe-Se*Ie,st=Se*Be-ke*Pe,dt=ke*le-oe*Be;return ot>0&&Ze>0&&st>0&&dt>0||ot<0&&Ze<0&&st<0&&dt<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const c=fm(this.tileID,this.map.transform.projection),[m,g,x,S]=this.coordinates.map(ee=>{const oe=c.projection.project(ee[0],ee[1]);return A0(c,oe)._round()});this.perspectiveTransform=O0(m.x,m.y,g.x,g.y,x.x,x.y,S.x,S.y);const C=this._boundsArray=new mf;C.emplaceBack(m.x,m.y,0,0),C.emplaceBack(g.x,g.y,Bt,0),C.emplaceBack(S.x,S.y,0,Bt),C.emplaceBack(x.x,x.y,Bt,Bt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(C,P0.members),this.boundsSegments=oo.simpleSegment(0,0,4,2);const M=[],P=[o_((k=this.coordinates)[0]),o_(k[1]),o_(k[2]),o_(k[3])];var k;const[V,U,q,J]=function(ee){let oe=ee[0][0],le=oe,fe=ee[0][1],Ie=fe;for(let Se=1;Se<ee.length;Se++)ee[Se][0]<oe?oe=ee[Se][0]:ee[Se][0]>le&&(le=ee[Se][0]),ee[Se][1]<fe?fe=ee[Se][1]:ee[Se][1]>Ie&&(Ie=ee[Se][1]);return[oe,fe,le-oe,Ie-fe]}(P);{const ee=new mf,[oe,le,fe,Ie]=function(yt){let Dt=yt[0].x,nt=Dt,tt=yt[0].y,St=tt;for(let It=1;It<yt.length;It++)yt[It].x<Dt?Dt=yt[It].x:yt[It].x>nt&&(nt=yt[It].x),yt[It].y<tt?tt=yt[It].y:yt[It].y>St&&(St=yt[It].y);return[Dt,tt,nt-Dt,St-tt]}(a),Se=yt=>[(yt.x-oe)/fe,(yt.y-le)/Ie],[Pe,ke,Be,ot]=a.map(Se),Ze=function(yt,Dt,nt,tt,St,It,bt,vt){const ci=vm(0,0,1,0,1,1,0,1);return he(ci,ci,re([],vm(yt,Dt,nt,tt,St,It,bt,vt)))}(Pe[0],Pe[1],ke[0],ke[1],Be[0],Be[1],ot[0],ot[1]);this.elevatedGlobePerspectiveTransform=O0(Pe[0],Pe[1],ke[0],ke[1],Be[0],Be[1],ot[0],ot[1]);const st=(yt,Dt)=>{M.push(yt.lng);const nt=Math.round((yt.lng-V)/q*Bt),tt=Math.round((yt.lat-U)/J*Bt),St=Se(Dt),It=Ur([],[St[0],St[1],1],Ze),bt=Math.round(It[0]/It[2]*Bt),vt=Math.round(It[1]/It[2]*Bt);ee.emplaceBack(nt,tt,bt,vt)},dt=a[3].x-a[0].x,wt=a[3].y-a[0].y,Rt=a[2].x-a[1].x,Mt=a[2].y-a[1].y;for(let yt=0;yt<65;yt++){const Dt=yt/64,nt=[a[0].x+Dt*dt,a[0].y+Dt*wt],tt=[a[1].x+Dt*Rt,a[1].y+Dt*Mt],St=tt[0]-nt[0],It=tt[1]-nt[1];for(let bt=0;bt<65;bt++){const vt=bt/64,ci={x:nt[0]+St*vt,y:nt[1]+It*vt};st(i.projection.unproject(ci.x,ci.y),ci)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(ee,P0.members)}{this.maxLongitudeTriangleSize=0;let ee=[],oe=new lr;const le=(fe,Ie,Se)=>{oe.emplaceBack(fe,Ie,Se);const Pe=M[fe],ke=M[Ie],Be=M[Se],ot=Math.min(Math.min(Pe,ke),Be),Ze=Math.max(Math.max(Pe,ke),Be)-ot;Ze>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ze),ee.push(ot+Ze/2)};for(let fe=0;fe<64;fe++)for(let Ie=0;Ie<64;Ie++){const Se=65*fe+Ie,Pe=Se+1,ke=Se+65,Be=ke+1;le(Se,ke,Pe),le(Pe,ke,Be)}[ee,oe]=function(fe,Ie){const Se=Array.from({length:fe.length},(Be,ot)=>ot);Se.sort((Be,ot)=>fe[Be]-fe[ot]);const Pe=[],ke=new lr;for(let Be=0;Be<Se.length;Be++){const ot=Se[Be];Pe.push(fe[ot]);const Ze=3*ot,st=Ze+1;ke.emplaceBack(Ie.uint16[Ze],Ie.uint16[st],Ie.uint16[st+1])}return[Pe,ke]}(ee,oe),this.elevatedGlobeTrianglesCenterLongitudes=ee,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(oe)}this.elevatedGlobeSegments=oo.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,q/Bt,0,J/Bt,0,0,U,V,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,a=i.gl;!this._dirty||this.texture instanceof Jc||(this.texture?this.texture.update(this.image):(this.texture=new Od(i,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let c=(m=e+180)+360*Math.round((a[0]-m)/360);var m;const g=new oo,x=(P,k)=>{g.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:i.segments[0].vertexLength,primitiveLength:k,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-c)<=S){const P=Sn(a,0,a.length,c+S);return P===a.length||x(P,nr(a,P+1,a.length,c+360-S)-P),g}c<a[0]&&(c+=360);const C=nr(a,0,a.length,c-S);if(C===a.length)return x(0,a.length),g;x(0,C-0);const M=Sn(a,C+1,a.length,c+S);return M!==a.length&&x(M,a.length-M),g}}const ow=(Math.pow(256,2)-1)/16907520;class dv extends ha{constructor(e,i,a,c){super(e,{layout:nw||(nw=new ro({visibility:new Pt(qe.layout_raster.visibility)})),paint:rw||(rw=new ro({"raster-opacity":new Pt(qe.paint_raster["raster-opacity"]),"raster-color":new Eh(qe.paint_raster["raster-color"]),"raster-color-mix":new Pt(qe.paint_raster["raster-color-mix"]),"raster-color-range":new Pt(qe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Pt(qe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Pt(qe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Pt(qe.paint_raster["raster-brightness-max"]),"raster-saturation":new Pt(qe.paint_raster["raster-saturation"]),"raster-contrast":new Pt(qe.paint_raster["raster-contrast"]),"raster-resampling":new Pt(qe.paint_raster["raster-resampling"]),"raster-fade-duration":new Pt(qe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Pt(qe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Pt(qe.paint_raster["raster-array-band"]),"raster-elevation":new Pt(qe.paint_raster["raster-elevation"]),"raster-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,c),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof a_&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[a,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(c)||a===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=Dg({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,c])}}let s_,fv,pv,l_,k0;class mv extends ha{constructor(e,i,a,c){super(e,{layout:s_||(s_=new ro({visibility:new Pt(qe["layout_raster-particle"].visibility)})),paint:fv||(fv=new ro({"raster-particle-array-band":new Pt(qe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Pt(qe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Eh(qe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Pt(qe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Pt(qe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Pt(qe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Pt(qe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Pt(qe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,c),this._updateColorRamp(),this.lastInvalidatedAt=bs.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Dg({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=bs.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class aw extends ha{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function c_(n,e,i){const a=[0,0,1],c=jo([]);return xs(c,c,i?-hn(n)+Math.PI:hn(n)),Yo(c,c,-hn(e)),gr(a,a,c),mn(a,a)}const sw={None:0,Model:1,Symbol:2,FillExtrusion:4};class u_{constructor(e,i,a,c){this.message=(e?`${e}: `:"")+a,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function h_(n,e){const i=n.indexOf("://")===-1;try{return new URL(n,i&&e?"http://example.com":void 0),!0}catch{return!1}}class aE{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class gv{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new bg,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const i=16*e,a=this.instancedDataArray.float32;let c=Math.floor(a[i+2]);const m=1.05*(a[i+2]-c);return c/=100,[a[i]%1*1.05,a[i+1]%1*1.05,m,c]}tileCoordinatesForInstance(e){const i=16*e,a=this.instancedDataArray.float32;let c=a[i+0];return c=c>Bt?c-Bt:c,new Tt(Math.trunc(c),Math.trunc(a[i+1]))}translationForInstance(e){const i=16*e,a=this.instancedDataArray.float32;return[a[i+4],a[i+5],a[i+6]]}rotationScaleForInstance(e){const i=16*e,a=this.instancedDataArray.float32;return[a[i+7],a[i+8],a[i+9],a[i+10],a[i+11],a[i+12],a[i+13],a[i+14],a[i+15]]}transformForInstance(e){const i=16*e,a=this.instancedDataArray.float32;return[a[i+7],a[i+8],a[i+9],a[i+4],a[i+10],a[i+11],a[i+12],a[i+5],a[i+13],a[i+14],a[i+15],a[i+6],0,0,0,1]}}class _v{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,c){}populate(e,i,a,c){this.tileToMeter=De(a);const m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:x,index:S,sourceLayerIndex:C}of e){const M=x??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),P=et(g,m);if(!this.layers[0]._featureFilter.filter(new Ar(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),P,a))continue;const k={id:M,sourceLayerIndex:C,index:S,geometry:m?P.geometry:ct(g,a,c),properties:g.properties,type:g.type,patterns:{}},V=this.addFeature(k,k.geometry,P);V&&i.featureIndex.insert(g,k.geometry,S,C,this.index,this.instancesPerModel[V].instancedDataArray.length,Bt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,i=this.layers[0].scope;let a=0;for(const c of this.modelUris){const m=e.getModel(c,i);if(!m)continue;const g=this.instancesPerModel[c];if(g){const x=.5*Vr(m.aabb.max,m.aabb.min)*g.maxScale+g.maxXYTranslationDistance,S=Math.min(Bt,Math.max(x/this.tileToMeter,Bt/32));a=Math.max(S,a)}}return a}update(e,i,a,c){for(const m in this.instancesPerModel){const g=this.instancesPerModel[m];for(const x in e)g.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(g.features[g.idToFeaturesIndex[x]],e[x],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];for(const c of a.features){const m=this.layers[0],g=c.feature,x=this.canonical,S=m.paint.get("model-rotation").evaluate(g,{},x),C=m.paint.get("model-scale").evaluate(g,{},x),M=m.paint.get("model-translation").evaluate(g,{},x);co(c.rotation,S)&&co(c.scale,C)&&co(c.translation,M)||(this.evaluate(c,c.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,i,a,c){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const m=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(My(this.activeReplacements,m))return!1;this.activeReplacements=m;let g=!1;for(const x in this.instancesPerModel){const S=this.instancesPerModel[x],C=S.instancedDataArray;for(const M of S.features){const P=M.instancedDataOffset,k=M.instancedDataCount;for(let V=0;V<k;V++){const U=16*(V+P);let q=C.float32[U+0];const J=q>Bt;q=J?q-Bt:q;const ee=Math.floor(q),oe=Math.floor(C.float32[U+1]);let le=!1;for(const fe of this.activeReplacements)if(!hS(fe,a,sw.Model,c)&&!(fe.min.x>ee||ee>fe.max.x||fe.min.y>oe||oe>fe.max.y)&&(le=Ox(pS(ee,oe,e.canonical,fe.footprintTileId.canonical),fe.footprint),le))break;C.float32[U]=le?q+Bt:q,g=g||le!==J}}}return g}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,BS.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,a){const c=this.layers[0],m=c.layout.get("model-id").evaluate(a,{},this.canonical);if(!m)return ei(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),m;(h_(m,!1)||this.styleDefinedModelURLs[m]!==void 0)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new gv);const g=this.instancesPerModel[m],x=g.instancedDataArray,S=new aE(a,x.length);for(const C of i)for(const M of C){if(M.x<0||M.x>=Bt||M.y<0||M.y>=Bt)continue;if(this.lookupDim!==0){const k=(this.lookupDim-1)/Bt,V=this.lookupDim*(M.y*k|0)+M.x*k|0;if(this.lookup){if(this.lookup[V]!==0)continue;this.lookup[V]=1}}this.instanceCount++;const P=x.length;x.resize(P+1),g.instancesEvaluatedElevation.push(0),x.float32[16*P]=M.x,x.float32[16*P+1]=M.y}return S.instancedDataCount=g.instancedDataArray.length-S.instancedDataOffset,S.instancedDataCount>0&&(e.id&&(g.idToFeaturesIndex[e.id]=g.features.length),g.features.push(S),this.evaluate(S,{},g,!1)),m}getModelUris(){return this.modelUris}evaluate(e,i,a,c){const m=this.layers[0],g=e.feature,x=this.canonical,S=e.rotation=m.paint.get("model-rotation").evaluate(g,i,x),C=e.scale=m.paint.get("model-scale").evaluate(g,i,x),M=e.translation=m.paint.get("model-translation").evaluate(g,i,x),P=Object.assign({},m.paint.get("model-color").evaluate(g,i,x));P.a=m.paint.get("model-color-mix-intensity").evaluate(g,i,x);const k=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]);const V=M[0]*M[0]+M[1]*M[1],U=V>0?Math.sqrt(V):0;a.maxScale=Math.max(Math.max(a.maxScale,C[0]),Math.max(C[1],C[2])),a.maxXYTranslationDistance=Math.max(a.maxXYTranslationDistance,U),this.maxScale=Math.max(Math.max(this.maxScale,C[0]),Math.max(C[1],C[2])),js(k,S,C);const q=Math.round(100*P.a)+P.b/1.05;for(let J=0;J<e.instancedDataCount;++J){const ee=e.instancedDataOffset+J,oe=16*ee,le=a.instancedDataArray.float32;let fe=0;c&&(fe=le[oe+6]-a.instancesEvaluatedElevation[ee]);const Ie=0|le[oe+1];le[oe]=(0|le[oe])+P.r/1.05,le[oe+1]=Ie+P.g/1.05,le[oe+2]=q,le[oe+3]=1/(x.z>10?this.tileToMeter:De(x,Ie)),le[oe+4]=M[0],le[oe+5]=M[1],le[oe+6]=M[2]+fe,le[oe+7]=k[0],le[oe+8]=k[1],le[oe+9]=k[2],le[oe+10]=k[4],le[oe+11]=k[5],le[oe+12]=k[6],le[oe+13]=k[8],le[oe+14]=k[9],le[oe+15]=k[10],a.instancesEvaluatedElevation[ee]=M[2]}}}let yv,F0;li(_v,"ModelBucket",{omit:["layers"]}),li(gv,"PerModelAttributes"),li(aE,"ModelFeature");class Vd{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){const c=a||e.findDEMTileFor(i);if(!c||!c.dem)return;const m=c.dem,g=c.tileID,x=1<<i.canonical.z-g.canonical.z;return new Vd(c,m.dim/Bt/x,[(i.canonical.x/x-g.canonical.x)*m.dim,(i.canonical.y/x-g.canonical.y)*m.dim])}tileCoordToPixel(e,i){const a=i*this._scale+this._offset[1];return new Tt(Math.floor(e*this._scale+this._offset[0]),Math.floor(a))}getElevationAt(e,i,a,c){const m=e*this._scale+this._offset[0],g=i*this._scale+this._offset[1],x=Math.floor(m),S=Math.floor(g),C=this._dem;return c=!!c,a?Si(Si(C.get(x,S,c),C.get(x,S+1,c),g-S),Si(C.get(x+1,S,c),C.get(x+1,S+1,c),g-S),m-x):C.get(x,S,c)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*se(1,e)*this._dem.stride}}const vv=new Float32Array(262144),Hf=new Uint8Array(262144);function lw(n){let e=0;if(n.meshes)for(const i of n.meshes)e=Math.max(e,i.aabb.max[2]);if(n.children)for(const i of n.children)e=Math.max(e,lw(i));return e}function cw(n,e,i){if(n.meshes)for(const a of n.meshes){if(a.aabb.min[0]===1/0)continue;const c=dn.applyTransform(a.aabb,n.globalMatrix);i.insert(e,c.min[0],c.min[1],c.max[0],c.max[1])}if(n.children)for(const a of n.children)cw(a,e,i)}const sE=["","wall","door","roof","window","lamp","logo"];class L0{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:lw(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new dn([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=dn.applyTransformFast(a.aabb,this.node.globalMatrix),i.encapsulate(a.transformedAabb)),e++;this.aabb=i}return this.aabb}}class xv{constructor(e,i,a,c,m,g,x,S){this.id=a,this.layers=e,this.layerIds=this.layers.map(C=>C.fqid),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.modelTraits|=Mf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,c&&(this.modelTraits|=Mf.HasMapboxMeshFeatures),m&&(this.modelTraits|=Mf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.worldview=S,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const C of i)this.nodesInfo.push(new L0(C)),cw(C,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,i){for(const a of this.getNodesInfo()){const c=a.node;c.footprint&&i.push({footprint:c.footprint,id:e})}}updateAppearances(e,i,a,c){}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const a=i?this.stateDependentLayers:this.layers;if(!Ta(e,this.states))for(const c of a)this.evaluate(c,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const a of i){const c=a.node;this.uploaded?this.updatePbrBuffer(c):eu(c,e,!0)}for(const a of i)rm(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),i=!0);return i}needsReEvaluation(e,i,a){const c=e.transform.projectionOptions,m=e.style.getBrightness(),g=this.brightness!==m;if(!this.uploaded||this.dirty||c.name!==this.projection.name||d_(a.paint.get("model-color").value,g)||d_(a.paint.get("model-color-mix-intensity").value,g)||d_(a.paint.get("model-roughness").value,g)||d_(a.paint.get("model-emissive-strength").value,g)||d_(a.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=c,this.brightness=m;const x=this.getNodesInfo();for(const S of x)S.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),c=this.id.canonical;for(const m of a){const g=m.feature;m.evaluatedTranslation=i.paint.get("model-translation").evaluate(g,{},c),m.evaluatedScale=i.paint.get("model-scale").evaluate(g,{},c)}}evaluate(e,i){const a=this.getNodesInfo();for(const c of a){if(!c.node.meshes)continue;const m=c.feature,g=i&&i[m.id];if(Ta(g,c.state))continue;c.state=structuredClone(g);const x=c.node.meshes&&c.node.meshes[0].featureData,S=c.evaluatedColor[2],C=c.evaluatedRMEA[2],M=this.id.canonical;if(c.hasTranslucentParts=!1,x){for(let P=0;P<sE.length;P++){const k=sE[P];k.length&&(m.properties.part=k);const V=e.paint.get("model-color").evaluate(m,g,M).toPremultipliedRenderColor(null),U=e.paint.get("model-color-mix-intensity").evaluate(m,g,M);c.evaluatedColor[P]=[V.r,V.g,V.b,U],c.evaluatedRMEA[P][0]=e.paint.get("model-roughness").evaluate(m,g,M),c.evaluatedRMEA[P][2]=e.paint.get("model-emissive-strength").evaluate(m,g,M),c.evaluatedRMEA[P][3]=V.a,c.emissionHeightBasedParams[P]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,g,M),!c.hasTranslucentParts&&V.a<1&&(c.hasTranslucentParts=!0)}delete m.properties.part,$C(c,S!==c.evaluatedColor[2]||C!==c.evaluatedRMEA[2],this.modelTraits)}else c.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(m,g,M);c.evaluatedTranslation=e.paint.get("model-translation").evaluate(m,g,M),c.evaluatedScale=e.paint.get("model-scale").evaluate(m,g,M),this.updatePbrBuffer(c.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,a,c){const m=e.findDEMTileFor(a);if(m&&(m.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;const g=Vd.create(e,a,m);if(!g)return;this.modelTraits&Mf.HasMapboxMeshFeatures&&this.updateDEM(e,g,a,c);for(const x of this.getNodesInfo()){const S=x.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const C=S.footprint.vertices;let M=g.getElevationAt(C[0].x,C[0].y,!0,!0);for(let P=1;P<C.length;P++)M=Math.min(M,g.getElevationAt(C[P].x,C[P].y,!0,!0));S.elevation=M}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,a,c){let m=i._dem._modifiedForSources[c];if(m===void 0&&(i._dem._modifiedForSources[c]=[],m=i._dem._modifiedForSources[c]),m.includes(a.canonical))return;const g=i._dem.dim;m.push(a.canonical);let x=!1;for(const S of this.getNodesInfo()){const C=S.node;if(!C.footprint||!C.footprint.grid)continue;const M=C.footprint.grid,P=i.tileCoordToPixel(M.min.x,M.min.y),k=i.tileCoordToPixel(M.max.x,M.max.y),V=Math.min(Math.min(g-k.y,P.x),Math.min(P.y,g-k.x));if(V<0)continue;const U=Y(V,2,5);let q=Math.max(0,P.x-U),J=Math.max(0,P.y-U),ee=Math.min(k.x+U,g-1),oe=Math.min(k.y+U,g-1);for(let Se=J;Se<=oe;++Se)for(let Pe=q;Pe<=ee;++Pe)Hf[Se*g+Pe]=255;let le=0,fe=0;for(let Se=0;Se<M.cellsY;++Se)for(let Pe=0;Pe<M.cellsX;++Pe){if(!M.cells[Se*M.cellsX+Pe])continue;const ke=i.tileCoordToPixel(M.min.x+Pe/M.xScale,M.min.y+Se/M.yScale),Be=i.tileCoordToPixel(M.min.x+(Pe+1)/M.xScale,M.min.y+(Se+1)/M.yScale);for(let ot=ke.y;ot<=Math.min(Be.y+1,g-1);++ot)for(let Ze=ke.x;Ze<=Math.min(Be.x+1,g-1);++Ze)Hf[ot*g+Ze]===255&&(Hf[ot*g+Ze]=0,le+=i.getElevationAtPixel(Ze,ot),fe++)}const Ie=le/fe;q=Math.max(1,P.x-U),J=Math.max(1,P.y-U),ee=Math.min(k.x+U,g-2),oe=Math.min(k.y+U,g-2),x=!0;for(let Se=J;Se<=oe;++Se)for(let Pe=q;Pe<=ee;++Pe)Hf[Se*g+Pe]===0&&(vv[Se*g+Pe]=i._dem.set(Pe,Se,Ie));for(let Se=1;Se<U;++Se){q=Math.max(1,P.x-Se),J=Math.max(1,P.y-Se),ee=Math.min(k.x+Se,g-2),oe=Math.min(k.y+Se,g-2);for(let Pe=J;Pe<=oe;++Pe)for(let ke=q;ke<=ee;++ke){const Be=Pe*g+ke;if(Hf[Be]===255){let ot=0,Ze=0,st=-1,dt=-1;for(let wt=-1;wt<=1;++wt)for(let Rt=-1;Rt<=1;++Rt){const Mt=(Pe+wt)*g+ke+Rt;if(Hf[Mt]>=Se)continue;const yt=vv[Mt],Dt=Math.abs(yt);Dt>Ze&&(ot=yt,Ze=Dt,st=Rt,dt=wt)}if(Ze>.1){const wt=1-(Se+.5*Math.abs(st*dt))/U;let Rt=i._dem.get(ke,Pe)+ot*wt;const Mt=i._dem.get(ke+st,Pe+dt),yt=i._dem.get(ke-st,Pe-dt,!0);(Rt-Mt)*(Rt-yt)>0&&(Rt=(Mt+yt)/2),vv[Be]=i._dem.set(ke,Pe,Rt),Hf[Be]=Se}}}}}x&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=bs.now())}setFilter(e){this.filter=e?uf(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Ar(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)rm(i.node),Gy(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());for(const c of this.getNodesInfo()){const m=c.node.footprint;c.hiddenByReplacement=!!m&&!a.find(g=>g.footprint===m)}}getHeightAtTileCoord(e,i){const a=[],c=[0,0,0],m=xe([]);for(const g of this.getNodesInfo()){const x=g.node.meshes[0],S=x.transformedAabb;if(e<S.min[0]||i<S.min[1]||e>S.max[0]||i>S.max[1])continue;if(g.node.hidden===!0)return{height:1/0,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};$e(m,g.node.globalMatrix),c[0]=e,c[1]=i,on(c,c,m);const C=(c[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*sl|0,M=Math.min(63,(c[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*sl|0)*sl+Math.min(63,C),P=x.heightmap[M];if(!(P<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:P,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new Tt(e,i),new Tt(e,i),a),a.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function d_(n,e){return n instanceof Op&&!n.isLightConstant&&e}function lE(n,e,i,a,c,m,g,x){let S=(61440&e|(61440&e)>>4)>>8,C=(3840&e|(3840&e)>>4)>>4,M=240&e|(240&e)>>4;i[3]>0&&(S=Si(S,255*i[0],i[3]),C=Si(C,255*i[1],i[3]),M=Si(M,255*i[2],i[3]));const P=S<<8|C,k=M<<8|Math.floor(255*a[3]),V=function(Se){const Pe=Y(Se,0,2);return Math.min(Math.round(.5*Pe*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],U=Y(c[0],0,1),q=Y(c[1],0,1),J=Y(c[2],0,1),ee=Y(c[3],0,1);let oe,le,fe,Ie;if(U!==q&&g!==m&&q!==U){const Se=g-m;le=1/(Se*(q-U)),fe=-(m+Se*U)/(Se*(q-U));const Pe=Y(c[4],-1,1);Ie=Math.pow(10,Pe),oe=255*J<<8|255*ee}else oe=65535,le=0,fe=1,Ie=1;if(n.emplaceBack(P,k,V,oe,le,fe,Ie),x){const Se=x.length;x.clear();for(let Pe=0;Pe<Se;Pe++)x.emplaceBack(P,k,V,oe,le,fe,Ie)}}function $C(n,e,i){const a=n.node;let c=0;const m=i&Mf.HasMeshoptCompression;for(const g of a.meshes){if(a.lights&&a.lightMeshIndex===c||!g.featureData)continue;g.featureArray=new Oh,g.featureArray.reserve(g.featureData.length);let x=e;for(const S of g.featureData){const C=m?65535&S:S>>16&65535,M=m?S>>16&65535:65535&S,P=(15&M)<8?15&M:0,k=n.evaluatedRMEA[P],V=n.evaluatedColor[P],U=n.emissionHeightBasedParams[P];let q;if(x&&P===2&&a.lights&&(q=new Oh,q.resize(10*a.lights.length)),lE(g.featureArray,C,V,k,U,g.aabb.min[2],g.aabb.max[2],q),q&&x){x=!1;const J=a.meshes[a.lightMeshIndex];J.featureArray=q,J.featureArray._trim()}}g.featureArray._trim(),c++}}li(xv,"Tiled3dModelBucket",{omit:["layers"]}),li(L0,"Tiled3dModelFeature");const uw=["id","tile","layer","source","sourceLayer","state"];class Xh{constructor(e,i,a,c,m){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=a,this._y=c,this.properties=e?e.properties:{},this.id=m}clone(){const e=new Xh(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of uw)this[i]!==void 0&&(e[i]=this[i]);return e}}class xm extends vn{constructor(e,i,a,c){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=i,this._modelsInfo=new Map}load(){const e=[];for(const i in this._options.models){const a=this._options.models[i],c=this._modelsInfo.get(i);if(c){const m=c.model;m.position=a.position!=null?new j(a.position[0],a.position[1]):new j(0,0),m.orientation=a.orientation!=null?a.orientation:[0,0,0],c.modelSpec=a,xm.applyModelSpecification(m,a),m.computeBoundsAndApplyParent(),this.models.push(m)}else{const m=jy(this.map._requestManager.transformRequest(a.uri,bu.Model).url).then(g=>{if(!g)return;const x=Zu(g),S=new C1(i,a.uri,a.position,a.orientation,x);xm.applyModelSpecification(S,a),S.computeBoundsAndApplyParent(),this.models.push(S),this._modelsInfo.set(i,{modelSpec:a,model:S})}).catch(g=>{this.fire(new Ut(new Error(`Could not load model ${i} from ${a.uri}: ${g.message}`)))});e.push(m)}}Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new Je("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this._loaded=!0,this.fire(new Ut(new Error(`Could not load models: ${i.message}`)))})}static applyModelSpecification(e,i){i.nodeOverrides&&xm.convertNodeOverrides(e,i.nodeOverrides),i.materialOverrides&&xm.convertMaterialOverrides(e,i.materialOverrides),i.nodeOverrideNames&&(e.nodeOverrideNames=[...i.nodeOverrideNames]),i.materialOverrideNames&&(e.materialOverrideNames=[...i.materialOverrideNames]),i.featureProperties&&(e.featureProperties=i.featureProperties)}static convertNodeOverrides(e,i){if(Array.isArray(i)&&i.every(a=>typeof a=="string")){e.nodeOverrideNames=[];for(const a of i)e.nodeOverrideNames.push(a)}else Object.entries(i).forEach(([a,c])=>{const m={orientation:[0,0,0]};if(c.hasOwnProperty("orientation")){const g=c.orientation;g&&(m.orientation=g)}e.nodeOverrides.set(a,m)})}static convertMaterialOverrides(e,i){if(Array.isArray(i)&&i.every(a=>typeof a=="string")){e.materialOverrideNames=[];for(const a of i)e.materialOverrideNames.push(a)}else Object.entries(i).forEach(([a,c])=>{const m={color:new Qi(1,1,1),colorMix:0,emissionStrength:0,opacity:1},g=c["model-color"];g!==void 0&&(m.color.r=g[0],m.color.g=g[1],m.color.b=g[2]);const x=c["model-color-mix-intensity"];x!==void 0&&(m.colorMix=x);const S=c["model-emissive-strength"];S!==void 0&&(m.emissionStrength=S);const C=c["model-opacity"];C!==void 0&&(m.opacity=C),e.materialOverrides.set(a,m)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,i){}serialize(){return this._options}setProperty(e,i){return!1}reload(){const e=Bu(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const i=new Map;for(const a in e){const c=e[a];if(this._modelsInfo.has(a)){const m=this._modelsInfo.get(a);m&&m.modelSpec.uri===c.uri&&i.set(a,m)}}this._modelsInfo=i,this._options.models=e,this._loaded=!1,this.load()}}function hw(n,e,i,a){const c=1<<n.z;e.lat=ce((a/Bt+n.y)/c),e.lng=me((i/Bt+n.x)/c)}function cE(n,e,i,a){const c=n.getNodesInfo()[e];if(!c||c.hiddenByReplacement||!c.node.meshes)return;let m=Number.MAX_VALUE;const g=c.node,x=i.tile,S=a.calculatePosMatrix(x.tileID.toUnwrapped(),a.worldSize),C=c.evaluatedScale;let M=0;a.elevation&&g.elevation&&(M=g.elevation*a.elevation.exaggeration()),Ke(S,S,[(g.anchor?g.anchor[0]:0)*(C[0]-1),(g.anchor?g.anchor[1]:0)*(C[1]-1),M]),Ge(S,S,C);const P=i.queryGeometry,k=P.isPointQuery()?P.screenBounds:P.screenGeometry,V=function(q){const J=Le([],S,q.globalMatrix);Le(J,a.expandedFarZProjMatrix,J);for(let ee=0;ee<q.meshes.length;++ee){const oe=q.meshes[ee];if(ee===q.lightMeshIndex)continue;const le=qu(k,a,J,oe.aabb);le!=null&&(m=Math.min(le,m))}if(q.children)for(const ee of q.children)V(ee)};if(V(g),m===Number.MAX_VALUE)return;const U=new j(0,0);return hw(x.tileID.canonical,U,c.node.anchor[0],c.node.anchor[1]),{intersectionZ:m,position:U,feature:c.feature}}const uE={circle:class extends ha{constructor(n,e,i,a){super(n,{layout:Zc||(Zc=new ro({"circle-sort-key":new Xt(qe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Pt(qe.layout_circle["circle-elevation-reference"]),visibility:new Pt(qe.layout_circle.visibility)})),paint:Xc||(Xc=new ro({"circle-radius":new Xt(qe.paint_circle["circle-radius"]),"circle-color":new Xt(qe.paint_circle["circle-color"]),"circle-blur":new Xt(qe.paint_circle["circle-blur"]),"circle-opacity":new Xt(qe.paint_circle["circle-opacity"]),"circle-translate":new Pt(qe.paint_circle["circle-translate"]),"circle-translate-anchor":new Pt(qe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Pt(qe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Pt(qe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Xt(qe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Xt(qe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Xt(qe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Pt(qe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}createBucket(n){return new Yr(n)}queryRadius(n){const e=n;return Ia("circle-radius",this,e)+Ia("circle-stroke-width",this,e)+ao(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,a,c,m,g,x){const S=Sf(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,n.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return WT(n,a,m,g,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,C)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,i){const a=$T(this);return{config:new $u(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}is3D(n){return!n&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends ha{createBucket(n){return new Rg(n)}constructor(n,e,i,a){super(n,{layout:Ax||(Ax=new ro({visibility:new Pt(qe.layout_heatmap.visibility)})),paint:ZT||(ZT=new ro({"heatmap-radius":new Xt(qe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Xt(qe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Pt(qe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Eh(qe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Pt(qe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Dg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(n){return Ia("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,a,c,m,g,x){const S=this.paint.get("heatmap-radius").evaluate(e,i);return WT(n,a,m,g,x,!0,!0,new Tt(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,i){return n==="heatmap"?{config:new $u(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends ha{constructor(n,e,i,a){super(n,{layout:XT||(XT=new ro({visibility:new Pt(qe.layout_hillshade.visibility)})),paint:r1||(r1=new ro({"hillshade-illumination-direction":new Pt(qe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Pt(qe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Pt(qe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Pt(qe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Pt(qe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Pt(qe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Pt(qe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}},fill:class extends ha{constructor(n,e,i,a){super(n,{layout:h1||(h1=new ro({"fill-sort-key":new Xt(qe.layout_fill["fill-sort-key"]),visibility:new Pt(qe.layout_fill.visibility),"fill-elevation-reference":new Pt(qe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Xt(qe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:lS||(lS=new ro({"fill-antialias":new Pt(qe.paint_fill["fill-antialias"]),"fill-opacity":new Xt(qe.paint_fill["fill-opacity"]),"fill-color":new Xt(qe.paint_fill["fill-color"]),"fill-outline-color":new Xt(qe.paint_fill["fill-outline-color"]),"fill-translate":new Pt(qe.paint_fill["fill-translate"]),"fill-translate-anchor":new Pt(qe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Xt(qe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Pt(qe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Pt(qe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Xt(qe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Xt(qe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Xt(qe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(n,e,i){return{config:new $u(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new kg(n)}queryRadius(){return ao(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,a,c,m){return!n.queryGeometry.isAboveHorizon&&xo(El(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,n.pixelToTileUnitsFactor),a)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends ha{constructor(n,e,i,a){super(n,{layout:SS||(SS=new ro({visibility:new Pt(qe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Pt(qe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:ES||(ES=new ro({"fill-extrusion-opacity":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Xt(qe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Pt(qe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new Ng(n)}queryRadius(){return ao(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,i,a,c,m,g,x,S){const C=Sf(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,n.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,i),P=this.paint.get("fill-extrusion-base").evaluate(e,i),k=[0,0],V=x&&m.elevation,U=m.elevation?m.elevation.exaggeration():1,q=n.tile.getBucket(this);if(V&&q instanceof Ng){const fe=q.centroidVertexArray,Ie=S+1;Ie<fe.length&&(k[0]=fe.geta_centroid_pos0(Ie),k[1]=fe.geta_centroid_pos1(Ie))}if(k[0]===0&&k[1]===1)return!1;m.projection.name==="globe"&&(a=TS([a],[new Tt(0,0),new Tt(Bt,Bt)],n.tileID.canonical).map(fe=>fe.polygon).flat());const J=V?x:null,[ee,oe]=MS(m,a,P,M,C,g,J,k,U,m.center.lat,n.tileID.canonical),le=n.queryGeometry;return DS(ee,oe,le.isPointQuery()?le.screenBounds:le.screenGeometry)}},building:class extends ha{constructor(n,e,i,a){super(n,{layout:M1||(M1=new ro({visibility:new Pt(qe.layout_building.visibility),"building-facade":new Xt(qe.layout_building["building-facade"]),"building-facade-floors":new Xt(qe.layout_building["building-facade-floors"]),"building-facade-unit-width":new Xt(qe.layout_building["building-facade-unit-width"]),"building-facade-window":new Xt(qe.layout_building["building-facade-window"]),"building-roof-shape":new Xt(qe.layout_building["building-roof-shape"]),"building-height":new Xt(qe.layout_building["building-height"]),"building-base":new Xt(qe.layout_building["building-base"]),"building-flood-light-wall-radius":new Xt(qe.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Xt(qe.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Xt(qe.layout_building["building-flip-roof-orientation"])})),paint:i0||(i0=new ro({"building-opacity":new Pt(qe.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Pt(qe.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Pt(qe.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Pt(qe.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Pt(qe.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Pt(qe.paint_building["building-vertical-scale"]),"building-cast-shadows":new Pt(qe.paint_building["building-cast-shadows"]),"building-color":new Xt(qe.paint_building["building-color"]),"building-emissive-strength":new Xt(qe.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Pt(qe.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Pt(qe.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Pt(qe.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Pt(qe.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Pt(qe.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new HS(n)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(n){return!0}queryRadius(n){return 0}queryIntersectsFeature(n,e,i,a,c,m,g,x,S){let C=this.layout.get("building-height").evaluate(e,i);const M=this.layout.get("building-base").evaluate(e,i),P=n.tile.getBucket(this).getFootprint(e);if(P){if(P.hiddenFlags!==0)return!1;C=P.height}const[k,V]=MS(m,a,M,C,new Tt(0,0),g,null,[0,0],1,m.center.lat,n.tileID.canonical),U=n.queryGeometry;return DS(k,V,U.isPointQuery()?U.screenBounds:U.screenGeometry)}},line:class extends ha{constructor(n,e,i,a){const c=a0();super(n,c,e,i,a),c.layout&&(this.layout=new fc(c.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Nc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if($y)return $y;const i=a0();return $y=new N1(i.paint.properties["line-width"].specification),$y.useIntegerZoom=!0,$y})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new O1(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,i){const a=L1(this);return{config:new $u(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}queryRadius(n){const e=n,i=ZS(Ia("line-width",this,e),Ia("line-gap-width",this,e)),a=Ia("line-offset",this,e);return i/2+Math.abs(a)+ao(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,a,c,m){if(n.queryGeometry.isAboveHorizon)return!1;const g=El(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,n.pixelToTileUnitsFactor),x=n.pixelToTileUnitsFactor/2*ZS(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),S=this.paint.get("line-offset").evaluate(e,i);return S&&(a=function(C,M){const P=[],k=new Tt(0,0);for(let V=0;V<C.length;V++){const U=C[V],q=[];for(let J=0;J<U.length;J++){const ee=U[J],oe=U[J+1],le=J===0?k:ee.sub(U[J-1])._unit()._perp(),fe=J===U.length-1?k:oe.sub(ee)._unit()._perp(),Ie=le._add(fe)._unit();Ie._mult(1/(Ie.x*fe.x+Ie.y*fe.y)),q.push(Ie._mult(M)._add(ee))}P.push(q)}return P}(a,S*n.pixelToTileUnitsFactor)),function(C,M,P){for(let k=0;k<M.length;k++){const V=M[k];if(C.length>=3){for(let U=0;U<V.length;U++)if(Ca(C,V[U]))return!0}if(As(C,V,P))return!0}return!1}(g,a,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:ym,background:class extends ha{constructor(n,e,i,a){super(n,{layout:tw||(tw=new ro({visibility:new Pt(qe.layout_background.visibility)})),paint:iw||(iw=new ro({"background-pitch-alignment":new Pt(qe.paint_background["background-pitch-alignment"]),"background-color":new Pt(qe.paint_background["background-color"]),"background-pattern":new Pt(qe.paint_background["background-pattern"]),"background-opacity":new Pt(qe.paint_background["background-opacity"]),"background-emissive-strength":new Pt(qe.paint_background["background-emissive-strength"]),"background-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:dv,"raster-particle":mv,sky:class extends ha{constructor(n,e,i,a){super(n,{layout:pv||(pv=new ro({visibility:new Pt(qe.layout_sky.visibility)})),paint:l_||(l_=new ro({"sky-type":new Pt(qe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Pt(qe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Pt(qe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Pt(qe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Pt(qe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Eh(qe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Pt(qe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Pt(qe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Pt(qe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Dg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),c=!a,m=n.style.light,g=m.properties.get("position");return c&&m.properties.get("anchor")==="viewport"&&ei("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?c_(g.azimuthal,90-g.polar,e):c_(a[0],90-a[1],e)}const i=this.paint.get("sky-gradient-center");return c_(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends ha{constructor(n,e,i,a){super(n,{paint:k0||(k0=new ro({}))},e,null)}},model:class extends ha{constructor(n,e,i,a){super(n,{layout:yv||(yv=new ro({visibility:new Pt(qe.layout_model.visibility),"model-id":new Xt(qe.layout_model["model-id"])})),paint:F0||(F0=new ro({"model-opacity":new Xt(qe.paint_model["model-opacity"]),"model-rotation":new Xt(qe.paint_model["model-rotation"]),"model-scale":new Xt(qe.paint_model["model-scale"]),"model-translation":new Xt(qe.paint_model["model-translation"]),"model-color":new Xt(qe.paint_model["model-color"]),"model-color-mix-intensity":new Xt(qe.paint_model["model-color-mix-intensity"]),"model-type":new Pt(qe.paint_model["model-type"]),"model-cast-shadows":new Pt(qe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Pt(qe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Pt(qe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Xt(qe.paint_model["model-emissive-strength"]),"model-roughness":new Xt(qe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Xt(qe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Pt(qe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Pt(qe.paint_model["model-front-cutoff"]),"model-elevation-reference":new Pt(qe.paint_model["model-elevation-reference"]),"model-color-use-theme":new Xt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this.layer=n,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new _v(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof xv?Bt-1:0}queryRenderedFeatures(n,e,i){const a=e.getSource();if(!(a&&a instanceof xm))return{};const c=a,m={};m[this.id]=[];const g=m[this.id];let x=0;for(const S of c.models){const C=e.getFeatureState(this.sourceLayer,S.id),M={type:"Unknown",id:S.id,properties:S.featureProperties},P=this.paint.get("model-rotation").evaluate(M,C),k=this.paint.get("model-scale").evaluate(M,C),V=this.paint.get("model-translation").evaluate(M,C),U=this.paint.get("model-elevation-reference");let q=[];kd(q,S,i,S.position,P,k,V,U==="ground",U==="ground",!1),i.projection.name==="globe"&&(q=al(q,i));const J=Le([],i.projMatrix,q),ee=qu(n.isPointQuery()?n.screenBounds:n.screenGeometry,i,J,S.aabb);if(ee!=null){const oe=new Xh(void 0,0,0,0,S.id);oe.layer=this.layer,oe.properties=structuredClone(S.featureProperties),oe.properties.layer=this.id,oe.properties.uri=S.uri,oe.properties.orientation=S.orientation,oe.sourceLayer=this.sourceLayer,oe.geometry={type:"Point",coordinates:[S.position.lng,S.position.lat]},oe.state=C,oe.source=this.source,g.push({featureIndex:x,feature:oe,intersectionZ:ee})}++x}return m}queryIntersectsFeature(n,e,i,a,c,m){if(!this.modelManager)return!1;const g=this.modelManager,x=n.tile.getBucket(this);if(!(x&&x instanceof _v))return!1;for(const S in x.instancesPerModel){const C=x.instancesPerModel[S],M=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(C.idToFeaturesIndex.hasOwnProperty(M)){const P=C.features[C.idToFeaturesIndex[M]],k=g.getModel(S,this.scope);if(!k)return!1;let V=[];const U=new j(0,0),q=x.canonical;let J=Number.MAX_VALUE;for(let ee=0;ee<P.instancedDataCount;++ee){const oe=16*(P.instancedDataOffset+ee),le=C.instancedDataArray.float32,fe=[le[oe+4],le[oe+5],le[oe+6]];hw(q,U,Math.floor(le[oe]),Math.floor(le[oe+1])),kd(V,k,m,U,P.rotation,P.scale,fe,!1,!1,!1),m.projection.name==="globe"&&(V=al(V,m));const Ie=Le([],m.projMatrix,V),Se=n.queryGeometry,Pe=qu(Se.isPointQuery()?Se.screenBounds:Se.screenGeometry,m,Ie,k.aabb);Pe!=null&&(J=Math.min(Pe,J))}return J!==Number.MAX_VALUE&&J}}return!1}_handleOverridablePaintPropertyUpdate(n,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof wh}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends ha{constructor(n,e,i,a){super(n,{layout:Dy||(Dy=new ro({"clip-layer-types":new Pt(qe.layout_clip["clip-layer-types"]),"clip-layer-scope":new Pt(qe.layout_clip["clip-layer-scope"])})),paint:cS||(cS=new ro({}))},e,i,a)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new uS(n)}is3D(n){return!0}}},z0=new Qi(0,0,0),N0={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},f_={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},bv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},hE={PAINT_ORDER_FILL_AND_STROKE:1},p_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},dw={MASK_TYPE_LUMINANCE:1};function Yh(n,e,i){n===1&&e.icons.push(function(a,c){return function(m){if(m.usvg_tree.height||(m.usvg_tree.height=m.usvg_tree.width),!m.metadata)return m;const{metadata:g}=m;if(g.content_area){const{content_area:x}=g;x.left==null&&(x.left=0),x.top==null&&(x.top=x.left),x.width==null&&(x.width=m.usvg_tree.width),x.height==null&&(x.height=x.width)}if(g.text_placeholder){const{text_placeholder:x}=g;x.top==null&&(x.top=x.left),x.height==null&&(x.height=x.width)}return g.stretch_x&&g.stretch_x.length&&cu(g,"x"),g.stretch_y&&g.stretch_y.length&&cu(g,"y"),m}(a.readFields(B0,{name:void 0},c))}(i,i.readVarint()+i.pos))}function cu(n,e){const i=[],a=n[`stretch_${e}`];let c=null;for(let m=0;m<a.length;m++)c===null?c=i.length===0?a[0]:i[i.length-1][1]+a[m]:(i.push([c,c+a[m]]),c=null);n[`stretch_${e}_areas`]=i}function B0(n,e,i){n===1?e.name=i.readString():n===2?e.metadata=function(a,c){return a.readFields(fw,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},c)}(i,i.readVarint()+i.pos):n===3&&(e.usvg_tree=function(a,c){return a.readFields(V0,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},c)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function fw(n,e,i){n===1?e.stretch_x=i.readPackedVarint():n===2?e.stretch_y=i.readPackedVarint():n===3?e.content_area=cr(i,i.readVarint()+i.pos):n===4?e.variables.push(function(a,c){return a.readFields(dE,{name:void 0},c)}(i,i.readVarint()+i.pos)):n===5&&(e.text_placeholder=cr(i,i.readVarint()+i.pos))}function cr(n,e){return n.readFields($f,{},e)}function $f(n,e,i){n===1?e.left=i.readVarint():n===2?e.width=i.readVarint():n===3?e.top=i.readVarint():n===4&&(e.height=i.readVarint())}function dE(n,e,i){n===1?e.name=i.readString():n===2&&(e.rgb_color=j0(i.readVarint()),e.value="rgb_color")}function V0(n,e,i){n===1?e.width=e.height=i.readVarint():n===2?e.height=i.readVarint():n===3?e.children.push(Wf(i,i.readVarint()+i.pos)):n===4?e.linear_gradients.push(function(a,c){return a.readFields(mE,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},c)}(i,i.readVarint()+i.pos)):n===5?e.radial_gradients.push(function(a,c){return a.readFields(H0,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},c)}(i,i.readVarint()+i.pos)):n===7?e.clip_paths.push(function(a,c){return a.readFields(Kh,{children:[]},c)}(i,i.readVarint()+i.pos)):n===8&&e.masks.push(function(a,c){const m=a.readFields(mw,{left:0,width:20,mask_type:dw.MASK_TYPE_LUMINANCE,children:[]},c);return m.height==null&&(m.height=m.width),m.top==null&&(m.top=m.left),m}(i,i.readVarint()+i.pos))}function Wf(n,e){return n.readFields(U0,{},e)}function U0(n,e,i){n===1?(e.group=function(a,c){return a.readFields(pw,{opacity:255,children:[]},c)}(i,i.readVarint()+i.pos),e.node="group"):n===2&&(e.path=function(a,c){return a.readFields(WC,{paint_order:1,commands:[],step:1,diffs:[],rule:N0.PATH_RULE_NON_ZERO},c)}(i,i.readVarint()+i.pos),e.node="path")}function pw(n,e,i){n===1?e.transform=bm(i,i.readVarint()+i.pos):n===2?e.opacity=i.readVarint():n===5?e.clip_path_idx=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(Wf(i,i.readVarint()+i.pos))}function bm(n,e){return n.readFields(fE,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function fE(n,e,i){n===1?e.sx=i.readFloat():n===2?e.ky=i.readFloat():n===3?e.kx=i.readFloat():n===4?e.sy=i.readFloat():n===5?e.tx=i.readFloat():n===6&&(e.ty=i.readFloat())}function WC(n,e,i){n===1?e.fill=function(a,c){return a.readFields(qC,{rgb_color:z0,paint:"rgb_color",opacity:255},c)}(i,i.readVarint()+i.pos):n===2?e.stroke=function(a,c){return a.readFields(pE,{rgb_color:z0,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},c)}(i,i.readVarint()+i.pos):n===3?e.paint_order=i.readVarint():n===5?i.readPackedVarint(e.commands):n===6?e.step=i.readFloat():n===7?i.readPackedSVarint(e.diffs):n===8&&(e.rule=i.readVarint())}function qC(n,e,i){n===1?(e.rgb_color=j0(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=i.readVarint())}function j0(n){return new Qi((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function pE(n,e,i){n===1?(e.rgb_color=j0(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5?i.readPackedFloat(e.dasharray):n===6?e.dashoffset=i.readFloat():n===7?e.miterlimit=i.readFloat():n===8?e.opacity=i.readVarint():n===9?e.width=i.readFloat():n===10?e.linecap=i.readVarint():n===11&&(e.linejoin=i.readVarint())}function mE(n,e,i){n===1?e.transform=bm(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(G0(i,i.readVarint()+i.pos)):n===4?e.x1=i.readFloat():n===5?e.y1=i.readFloat():n===6?e.x2=i.readFloat():n===7&&(e.y2=i.readFloat())}function G0(n,e){return n.readFields(gE,{offset:0,opacity:255,rgb_color:z0},e)}function gE(n,e,i){n===1?e.offset=i.readFloat():n===2?e.opacity=i.readVarint():n===3&&(e.rgb_color=j0(i.readVarint()))}function H0(n,e,i){n===1?e.transform=bm(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(G0(i,i.readVarint()+i.pos)):n===4?e.cx=i.readFloat():n===5?e.cy=i.readFloat():n===6?e.r=i.readFloat():n===7?e.fx=i.readFloat():n===8?e.fy=i.readFloat():n===9&&(e.fr=i.readFloat())}function Kh(n,e,i){n===1?e.transform=bm(i,i.readVarint()+i.pos):n===2?e.clip_path_idx=i.readVarint():n===3&&e.children.push(Wf(i,i.readVarint()+i.pos))}function mw(n,e,i){n===1?e.left=e.top=i.readFloat():n===2?e.width=e.height=i.readFloat():n===3?e.top=i.readFloat():n===4?e.height=i.readFloat():n===5?e.mask_type=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(Wf(i,i.readVarint()+i.pos))}class Jh{static calculate(e={},i=[]){const a=new Map,c=new Map;if(Object.keys(e).length===0)return a;i.forEach(m=>{c.set(m.name,m.rgb_color||new Qi(0,0,0))});for(const[m,g]of Object.entries(e))c.has(m)?a.set(c.get(m).toString(),g):console.warn(`Ignoring unknown image variable "${m}"`);return a}}function qf(n,e=255,i){const a=e/255,c=n.toString(),m=i.has(c)?i.get(c).clone():n.clone();return m.a*=a,m.toString()}function wm(n,e){if(!Ka()){const i=document.createElement("canvas");return i.width=n,i.height=e,i}return new OffscreenCanvas(n,e)}function nh(n,e){const i=Jh.calculate(e.params,n.metadata?n.metadata.variables:[]),a=n.usvg_tree,c=a.width,m=a.height,g=e.transform?e.transform:new DOMMatrix,x=Math.max(1,Math.round(c*g.a)),S=Math.max(1,Math.round(m*g.d)),C=new DOMMatrix([x/c,0,0,S/m,0,0]),M=wm(x,S).getContext("2d");return wv(M,C,a,a,i),M.getImageData(0,0,x,S)}function wv(n,e,i,a,c){for(const m of a.children)$0(n,e,i,m,c)}function $0(n,e,i,a,c){a.group?(n.save(),function(m,g,x,S,C){const M=S.mask_idx!=null?x.masks[S.mask_idx]:null,P=S.clip_path_idx!=null?x.clip_paths[S.clip_path_idx]:null;if(S.transform&&(g=Zf(S.transform).preMultiplySelf(g)),!function(U,q,J){return U.opacity!==255||q||J}(S,P!=null,M!=null))return void wv(m,g,x,S,C);const k=wm(m.canvas.width,m.canvas.height),V=k.getContext("2d");wv(V,g,x,S,C),P&&Y0(V,g,x,P),M&&K0(V,g,x,M,C),m.globalAlpha=S.opacity/255,m.drawImage(k,0,0)}(n,e,i,a.group,c),n.restore()):a.path&&(n.save(),function(m,g,x,S,C){m.setTransform(g),S.paint_order===hE.PAINT_ORDER_FILL_AND_STROKE?(W0(m,x,S,C),Z0(m,x,S,C)):(Z0(m,x,S,C),W0(m,x,S,C))}(n,e,i,a.path,c),n.restore())}function W0(n,e,i,a){const c=i.fill;if(!c)return;const m=c.opacity/255;switch(n.save(),n.beginPath(),m_(i,n),c.paint){case"rgb_color":n.fillStyle=qf(c.rgb_color,c.opacity,a);break;case"linear_gradient_idx":{const g=e.linear_gradients[c.linear_gradient_idx];g.transform&&n.setTransform(Zf(g.transform).preMultiplySelf(n.getTransform())),n.fillStyle=X0(n,g,m,a);break}case"radial_gradient_idx":{const g=e.radial_gradients[c.radial_gradient_idx];g.transform&&n.setTransform(Zf(g.transform).preMultiplySelf(n.getTransform())),n.fillStyle=gw(n,g,m,a)}}n.fill(q0(i)),n.restore()}function q0(n){return n.rule===N0.PATH_RULE_NON_ZERO?"nonzero":n.rule===N0.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Z0(n,e,i,a){const c=i.stroke;if(!c)return;const m=_w(i);n.lineWidth=c.width,n.miterLimit=c.miterlimit,n.setLineDash(c.dasharray),n.lineDashOffset=c.dashoffset;const g=c.opacity/255;switch(c.paint){case"rgb_color":n.strokeStyle=qf(c.rgb_color,c.opacity,a);break;case"linear_gradient_idx":n.strokeStyle=X0(n,e.linear_gradients[c.linear_gradient_idx],g,a,!0);break;case"radial_gradient_idx":n.strokeStyle=gw(n,e.radial_gradients[c.radial_gradient_idx],g,a,!0)}switch(c.linejoin){case bv.LINE_JOIN_MITER_CLIP:case bv.LINE_JOIN_MITER:n.lineJoin="miter";break;case bv.LINE_JOIN_ROUND:n.lineJoin="round";break;case bv.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(c.linecap){case f_.LINE_CAP_BUTT:n.lineCap="butt";break;case f_.LINE_CAP_ROUND:n.lineCap="round";break;case f_.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(m)}function X0(n,e,i,a,c=!1){if(e.stops.length===1){const k=e.stops[0];return qf(k.rgb_color,k.opacity*i,a)}const{x1:m,y1:g,x2:x,y2:S}=e;let C=new DOMPoint(m,g),M=new DOMPoint(x,S);if(c){const k=Zf(e.transform);C=k.transformPoint(C),M=k.transformPoint(M)}const P=n.createLinearGradient(C.x,C.y,M.x,M.y);for(const k of e.stops)P.addColorStop(k.offset,qf(k.rgb_color,k.opacity*i,a));return P}function gw(n,e,i,a,c=!1){if(e.stops.length===1){const ee=e.stops[0];return qf(ee.rgb_color,ee.opacity*i,a)}const m=Zf(e.transform),{fx:g,fy:x,fr:S,cx:C,cy:M,r:P}=e;let k=new DOMPoint(g,x),V=new DOMPoint(C,M),U=S,q=P;if(c){k=m.transformPoint(k),V=m.transformPoint(V);const ee=(m.a+m.d)/2;U=S*ee,q=e.r*ee}const J=n.createRadialGradient(k.x,k.y,U,V.x,V.y,q);for(const ee of e.stops)J.addColorStop(ee.offset,qf(ee.rgb_color,ee.opacity*i,a));return J}function Tv(n,e,i,a){const c=a.transform?Zf(a.transform).preMultiplySelf(e):e,m=wm(n.canvas.width,n.canvas.height),g=m.getContext("2d");for(const S of a.children)if(S.group)Tv(g,c,i,S.group);else if(S.path){const C=S.path,M=new Path2D;M.addPath(_w(C),c),g.fill(M,q0(C))}const x=a.clip_path_idx!=null?i.clip_paths[a.clip_path_idx]:null;x&&Y0(g,c,i,x),n.globalCompositeOperation="source-over",n.drawImage(m,0,0)}function Y0(n,e,i,a){const c=wm(n.canvas.width,n.canvas.height);Tv(c.getContext("2d"),e,i,a),n.globalCompositeOperation="destination-in",n.drawImage(c,0,0)}function K0(n,e,i,a,c){if(a.children.length===0)return;const m=a.mask_idx!=null?i.masks[a.mask_idx]:null;m&&K0(n,e,i,m,c);const g=n.canvas.width,x=n.canvas.height,S=wm(g,x),C=S.getContext("2d"),M=a.width,P=a.height,k=a.left,V=a.top,U=new Path2D,q=new Path2D;q.rect(k,V,M,P),U.addPath(q,e),C.clip(U);for(const oe of a.children)$0(C,e,i,oe,c);const J=C.getImageData(0,0,g,x),ee=J.data;if(a.mask_type===dw.MASK_TYPE_LUMINANCE)for(let oe=0;oe<ee.length;oe+=4)ee[oe+3]=ee[oe+3]/255*(.2126*ee[oe]+.7152*ee[oe+1]+.0722*ee[oe+2]);C.putImageData(J,0,0),n.globalCompositeOperation="destination-in",n.drawImage(S,0,0)}function Zf(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function m_(n,e){const i=n.step;let a=n.diffs[0]*i,c=n.diffs[1]*i;e.moveTo(a,c);for(let m=0,g=2;m<n.commands.length;m++)switch(n.commands[m]){case p_.PATH_COMMAND_MOVE:a+=n.diffs[g++]*i,c+=n.diffs[g++]*i,e.moveTo(a,c);break;case p_.PATH_COMMAND_LINE:a+=n.diffs[g++]*i,c+=n.diffs[g++]*i,e.lineTo(a,c);break;case p_.PATH_COMMAND_QUAD:{const x=a+n.diffs[g++]*i,S=c+n.diffs[g++]*i;a=x+n.diffs[g++]*i,c=S+n.diffs[g++]*i,e.quadraticCurveTo(x,S,a,c);break}case p_.PATH_COMMAND_CUBIC:{const x=a+n.diffs[g++]*i,S=c+n.diffs[g++]*i,C=x+n.diffs[g++]*i,M=S+n.diffs[g++]*i;a=C+n.diffs[g++]*i,c=M+n.diffs[g++]*i,e.bezierCurveTo(x,S,C,M,a,c);break}case p_.PATH_COMMAND_CLOSE:e.closePath()}return e}function _w(n){return m_(n,new Path2D)}class g_{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}li(g_,"LRUCache");class Sv{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Xa(e,e.data)}getFromCache(e,i,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new g_(150)),this.cacheMap.get(a).get(Bu(e.toString(),i))}setInCache(e,i,a,c){this.cacheDependenciesMap.has(c)||this.cacheDependenciesMap.set(c,new Map),this.cacheMap.has(c)||this.cacheMap.set(c,new g_(150));const m=this.cacheDependenciesMap.get(c),g=Bu(e.id.toString(),a);m.get(g)||m.set(g,new Set);const x=this.cacheMap.get(c),S=e.toString();m.get(g).add(S),x.put(Bu(e.toString(),a),i)}removeImagesFromCacheByIds(e,i,a=0){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;const c=this.cacheMap.get(a),m=this.cacheDependenciesMap.get(a);for(const g of e){const x=Bu(g.toString(),i);if(m.has(x)){for(const S of m.get(x))c.delete(S);m.delete(x)}}}rasterize(e,i,a,c,m=nh){const g=this.getFromCache(e,a,c);if(g)return g.clone();const x=m(i.icon,e.options),S=Sv._getImage(x);return this.setInCache(e,S,a,c),S.clone()}}class yw{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function _E(n,e,i,a){let c=0,m=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(a[g])<1e-15){if(i[g]<n[g]||i[g]>e[g])return null}else{const x=1/a[g];let S=(n[g]-i[g])*x,C=(e[g]-i[g])*x;if(S>C){const M=S;S=C,C=M}if(S>c&&(c=S),C<m&&(m=C),c>m)return null}return c}function vw(n,e,i,a,c,m,g,x,S,C,M){const P=a-n,k=c-e,V=m-i,U=g-n,q=x-e,J=S-i,ee=M[1]*J-M[2]*q,oe=M[2]*U-M[0]*J,le=M[0]*q-M[1]*U,fe=P*ee+k*oe+V*le;if(Math.abs(fe)<1e-15)return null;const Ie=1/fe,Se=C[0]-n,Pe=C[1]-e,ke=C[2]-i,Be=(Se*ee+Pe*oe+ke*le)*Ie;if(Be<0||Be>1)return null;const ot=Pe*V-ke*k,Ze=ke*P-Se*V,st=Se*k-Pe*P,dt=(M[0]*ot+M[1]*Ze+M[2]*st)*Ie;return dt<0||Be+dt>1?null:(U*ot+q*Ze+J*st)*Ie}function xw(n,e,i){return(n-e)/(i-e)}function yE(n,e,i,a,c,m,g,x,S){const C=1<<i,M=m-a,P=g-c,k=(n+1)/C*M+a,V=(e+0)/C*P+c,U=(e+1)/C*P+c;x[0]=(n+0)/C*M+a,x[1]=V,S[0]=k,S[1]=U}class bw{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(m){const g=Math.ceil(Math.log2(m.dim/8)),x=[];let S=Math.ceil(Math.pow(2,g));const C=1/S,M=(V,U,q,J,ee)=>{const oe=J?1:0,le=(V+1)*q-oe,fe=U*q,Ie=(U+1)*q-oe;ee[0]=V*q,ee[1]=fe,ee[2]=le,ee[3]=Ie};let P=new yw(S);const k=[];for(let V=0;V<S*S;V++){M(V%S,Math.floor(V/S),C,!1,k);const U=Xf(k[0],k[1],m),q=Xf(k[2],k[1],m),J=Xf(k[2],k[3],m),ee=Xf(k[0],k[3],m);P.minimums.push(Math.min(U,q,J,ee)),P.maximums.push(Math.max(U,q,J,ee)),P.leaves.push(1)}for(x.push(P),S/=2;S>=1;S/=2){const V=x[x.length-1];P=new yw(S);for(let U=0;U<S*S;U++){M(U%S,Math.floor(U/S),2,!0,k);const q=V.getElevation(k[0],k[1]),J=V.getElevation(k[2],k[1]),ee=V.getElevation(k[2],k[3]),oe=V.getElevation(k[0],k[3]),le=V.isLeaf(k[0],k[1]),fe=V.isLeaf(k[2],k[1]),Ie=V.isLeaf(k[2],k[3]),Se=V.isLeaf(k[0],k[3]),Pe=Math.min(q.min,J.min,ee.min,oe.min),ke=Math.max(q.max,J.max,ee.max,oe.max),Be=le&&fe&&Ie&&Se;P.maximums.push(ke),P.minimums.push(Pe),P.leaves.push(ke-Pe<=5&&Be?1:0)}x.push(P)}return x}(this.dem),a=i.length-1,c=i[a];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,c,m,g,x=1){return _E([e,i,-100],[a,c,this.maximums[0]*x],m,g)}raycast(e,i,a,c,m,g,x=1){if(!this.nodeCount)return null;const S=this.raycastRoot(e,i,a,c,m,g,x);if(S==null)return null;const C=[],M=[],P=[],k=[],V=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:U,t:q,nodex:J,nodey:ee,depth:oe}=V.pop();if(this.leaves[U]){yE(J,ee,oe,e,i,a,c,P,k);const fe=1<<oe,Ie=(J+0)/fe,Se=(J+1)/fe,Pe=(ee+0)/fe,ke=(ee+1)/fe,Be=Xf(Ie,Pe,this.dem)*x,ot=Xf(Se,Pe,this.dem)*x,Ze=Xf(Se,ke,this.dem)*x,st=Xf(Ie,ke,this.dem)*x,dt=vw(P[0],P[1],Be,k[0],P[1],ot,k[0],k[1],Ze,m,g),wt=vw(k[0],k[1],Ze,P[0],k[1],st,P[0],P[1],Be,m,g),Rt=Math.min(dt!==null?dt:Number.MAX_VALUE,wt!==null?wt:Number.MAX_VALUE);if(Rt!==Number.MAX_VALUE)return Rt;{const Mt=pr([],m,g,q);if(J0(Be,ot,st,Ze,xw(Mt[0],P[0],k[0]),xw(Mt[1],P[1],k[1]))>=Mt[2])return q}continue}let le=0;for(let fe=0;fe<this._siblingOffset.length;fe++){yE((J<<1)+this._siblingOffset[fe][0],(ee<<1)+this._siblingOffset[fe][1],oe+1,e,i,a,c,P,k),P[2]=-100,k[2]=this.maximums[this.childOffsets[U]+fe]*x;const Ie=_E(P,k,m,g);if(Ie!=null){const Se=Ie;C[fe]=Se;let Pe=!1;for(let ke=0;ke<le&&!Pe;ke++)Se>=C[M[ke]]&&(M.splice(ke,0,fe),Pe=!0);Pe||(M[le]=fe),le++}}for(let fe=0;fe<le;fe++){const Ie=M[fe];V.push({idx:this.childOffsets[U]+Ie,t:C[Ie],nodex:(J<<1)+this._siblingOffset[Ie][0],nodey:(ee<<1)+this._siblingOffset[Ie][1],depth:oe+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,c,m){if(e[c].isLeaf(i,a)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const g=c-1,x=e[g];let S=0,C=0;for(let M=0;M<this._siblingOffset.length;M++){const P=2*i+this._siblingOffset[M][0],k=2*a+this._siblingOffset[M][1],V=x.getElevation(P,k),U=x.isLeaf(P,k),q=this._addNode(V.min,V.max,U);U&&(S|=1<<M),C||(C=q)}for(let M=0;M<this._siblingOffset.length;M++)S&1<<M||this._construct(e,2*i+this._siblingOffset[M][0],2*a+this._siblingOffset[M][1],g,C+M)}}function J0(n,e,i,a,c,m){return Si(Si(n,i,m),Si(e,a,m),c)}function Xf(n,e,i){const a=i.dim,c=Y(n*a-.5,0,a-1),m=Y(e*a-.5,0,a-1),g=Math.floor(c),x=Math.floor(m),S=Math.min(g+1,a-1),C=Math.min(x+1,a-1);return J0(i.get(g,x),i.get(S,x),i.get(g,C),i.get(S,C),c-g,m-x)}const ZC={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Tm(n,e,i){return(256*n*256+256*e+i)/10-1e4}function ww(n,e,i){return 256*n+e+i/256-32768}class Q0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,c=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void ei(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const m=this.dim=i.height-2,g=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let S=0;S<m;S++)g[this._idx(-1,S)]=g[this._idx(0,S)],g[this._idx(m,S)]=g[this._idx(m-1,S)],g[this._idx(S,-1)]=g[this._idx(S,0)],g[this._idx(S,m)]=g[this._idx(S,m-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(m,-1)]=g[this._idx(m-1,0)],g[this._idx(-1,m)]=g[this._idx(0,m-1)],g[this._idx(m,m)]=g[this._idx(m-1,m-1)]}const x=a==="terrarium"?ww:Tm;for(let S=0;S<g.length;++S){const C=4*S;this.floatView[S]=x(this.pixels[C],this.pixels[C+1],this.pixels[C+2])}this._timestamp=bs.now()}_buildQuadTree(){this._tree=new bw(this)}get(e,i,a=!1){a&&(e=Y(e,-1,this.dim),i=Y(i,-1,this.dim));const c=this._idx(e,i);return this.floatView[c]}set(e,i,a){const c=this._idx(e,i),m=this.floatView[c];return this.floatView[c]=a,a-m}static getUnpackVector(e){return ZC[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const a=[0,0,0,0],c=Q0.getUnpackVector(i);let m=Math.floor((e+c[3])/c[2]);return a[2]=m%256,m=Math.floor(m/256),a[1]=m%256,m=Math.floor(m/256),a[0]=m,a}getPixels(){return new wy({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,m=i*this.dim+this.dim,g=a*this.dim,x=a*this.dim+this.dim;switch(i){case-1:c=m-1;break;case 1:m=c+1}switch(a){case-1:g=x-1;break;case 1:x=g+1}const S=-i*this.dim,C=-a*this.dim;for(let M=g;M<x;M++)for(let P=c;P<m;P++){const k=4*this._idx(P,M),V=4*this._idx(P+S,M+C);this.pixels[k+0]=e.pixels[V+0],this.pixels[k+1]=e.pixels[V+1],this.pixels[k+2]=e.pixels[V+2],this.pixels[k+3]=e.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function Tw(n,e,i){n===1?e.headerLength=i.readFixed32():n===2?e.x=i.readVarint():n===3?e.y=i.readVarint():n===4?e.z=i.readVarint():n===5&&e.layers.push(function(a,c){return a.readFields(YC,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},c)}(i,i.readVarint()+i.pos))}function XC(n,e,i){n===1?(e.delta_filter=function(a,c){return a.readFields(vE,{blockSize:0},c)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):n===2?(i.readVarint(),e.filter="zigzag_filter"):n===3?(i.readVarint(),e.filter="bitshuffle_filter"):n===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function vE(n,e,i){n===1&&(e.blockSize=i.readVarint())}function Sw(n,e,i){n===1?(i.readVarint(),e.codec="gzip_data"):n===2?(i.readVarint(),e.codec="jpeg_image"):n===3?(i.readVarint(),e.codec="webp_image"):n===4&&(i.readVarint(),e.codec="png_image")}function xE(n,e,i){let a=0,c=0;n===1?e.firstByte=i.readFixed64():n===2?e.lastByte=i.readFixed64():n===3?e.filters.push(function(m,g){return m.readFields(XC,{},g)}(i,i.readVarint()+i.pos)):n===4?e.codec=function(m,g){return m.readFields(Sw,{},g)}(i,i.readVarint()+i.pos):n===5?c=i.readFloat():n===6?a=i.readFloat():n===7?e.bands.push(i.readString()):n===8?e.offset=i.readDouble():n===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=c),e.scale===0&&(e.scale=a)}function YC(n,e,i){n===1?e.version=i.readVarint():n===2?e.name=i.readString():n===3?e.units=i.readString():n===4?e.tileSize=i.readVarint():n===5?e.buffer=i.readVarint():n===6?e.pixelFormat=i.readVarint():n===7&&e.dataIndex.push(function(a,c){return a.readFields(xE,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},c)}(i,i.readVarint()+i.pos))}function KC(n,e,i){if(n===2)(function(a,c,m){a.readFields(bE,m,c)})(i,i.readVarint()+i.pos,e);else if(n===3)throw new Error("Not implemented")}function bE(n,e,i){if(n===1){let a=0;const c=i.readVarint()+i.pos;for(;i.pos<c;)e[a++]=i.readVarint()}}function wE(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let a=2;a>=1;a--){const c=a===1?1:0,m=a===2?1:0;for(let g=0;g<e[0];g++){const x=e[1]*g;for(let S=c;S<e[1];S++){const C=e[2]*(S+x);for(let M=m;M<e[2];M++){const P=e[3]*(M+C);for(let k=0;k<e[3];k++){const V=P+k;n[V]+=n[V-i]}}}}i*=e[a]}return n}function JC(n){for(let e=0,i=n.length;e<i;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function QC(n,e){switch(e){case"uint32":return n;case"uint16":for(let i=0;i<n.length;i+=2){const a=n[i],c=n[i+1];n[i]=(240&a)>>4|(61440&a)>>8|(240&c)<<4|61440&c,n[i+1]=15&a|(3840&a)>>4|(15&c)<<8|(3840&c)<<4}return n;case"uint8":for(let i=0;i<n.length;i+=4){const a=n[i],c=n[i+1],m=n[i+2],g=n[i+3];n[i+0]=(192&a)>>6|(192&c)>>4|(192&m)>>2|192&g,n[i+1]=(48&a)>>4|(48&c)>>2|48&m|(48&g)<<2,n[i+2]=(12&a)>>2|12&c|(12&m)<<2|(12&g)<<4,n[i+3]=3&a|(3&c)<<2|(3&m)<<4|(3&g)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}li(Q0,"DEMData"),li(bw,"DemMinMaxQuadTree",{omit:["dem"]});var Hs=Uint8Array,Rl=Uint16Array,Ew=Int32Array,__=new Hs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),eb=new Hs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Aw=new Hs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),tb=function(n,e){for(var i=new Rl(31),a=0;a<31;++a)i[a]=e+=1<<n[a-1];var c=new Ew(i[30]);for(a=1;a<30;++a)for(var m=i[a];m<i[a+1];++m)c[m]=m-i[a]<<5|a;return{b:i,r:c}},Yf=tb(__,2),ib=Yf.b,nb=Yf.r;ib[28]=258,nb[258]=28;for(var Ev=tb(eb,0).b,hl=new Rl(32768),da=0;da<32768;++da){var Sm=(43690&da)>>1|(21845&da)<<1;hl[da]=((65280&(Sm=(61680&(Sm=(52428&Sm)>>2|(13107&Sm)<<2))>>4|(3855&Sm)<<4))>>8|(255&Sm)<<8)>>1}var y_=function(n,e,i){for(var a=n.length,c=0,m=new Rl(e);c<a;++c)n[c]&&++m[n[c]-1];var g,x=new Rl(e);for(c=1;c<e;++c)x[c]=x[c-1]+m[c-1]<<1;g=new Rl(1<<e);var S=15-e;for(c=0;c<a;++c)if(n[c])for(var C=c<<4|n[c],M=e-n[c],P=x[n[c]-1]++<<M,k=P|(1<<M)-1;P<=k;++P)g[hl[P]>>S]=C;return g},v_=new Hs(288);for(da=0;da<144;++da)v_[da]=8;for(da=144;da<256;++da)v_[da]=9;for(da=256;da<280;++da)v_[da]=7;for(da=280;da<288;++da)v_[da]=8;var Cw=new Hs(32);for(da=0;da<32;++da)Cw[da]=5;var eI=y_(v_,9),tI=y_(Cw,5),Iw=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},uu=function(n,e,i){var a=e/8|0;return(n[a]|n[a+1]<<8)>>(7&e)&i},Av=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(7&e)},TE=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],vc=function(n,e,i){var a=new Error(e||TE[n]);if(a.code=n,Error.captureStackTrace&&Error.captureStackTrace(a,vc),!i)throw a;return a},SE=new Hs(0),iI=typeof TextDecoder<"u"&&new TextDecoder;try{iI.decode(SE,{stream:!0})}catch{}const EE={gzip_data:"gzip"};class hu extends Error{constructor(e){super(e),this.name="MRTError"}}const nI={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},AE={uint32:1,uint16:2,uint8:4},rI={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Rw;class x_{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new hu(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),a=new DataView(e);if(i[0]!==13)throw new hu("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),a=this.getHeaderLength(e);if(i.length<a)throw new hu(`Expected header with length >= ${a} but got buffer of length ${i.length}`);const c=new Rw(i.subarray(0,a)).readFields(Tw,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==c.x||this.y!==c.y||this.z!==c.z))throw new hu(`Invalid attempt to parse header ${c.z}/${c.x}/${c.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=c.x,this.y=c.y,this.z=c.z;for(const m of c.layers)this.layers[m.name]=new rb(m,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],a=this.getLayer(e.layerName);for(let c of e.blockIndices){const m=a.dataIndex[c],g=m.firstByte-e.firstByte,x=m.lastByte-e.firstByte;if(a._blocksInProgress.has(c))continue;const S={layerName:a.name,firstByte:g,lastByte:x,pixelFormat:a.pixelFormat,blockIndex:c,blockShape:[m.bands.length].concat(a.bandShape),buffer:a.buffer,codec:m.codec.codec,filters:m.filters.map(C=>C.filter)};a._blocksInProgress.add(c),i.push(S)}return new ob(i,()=>{i.forEach(c=>a._blocksInProgress.delete(c.blockIndex))},(c,m)=>{if(i.forEach(g=>a._blocksInProgress.delete(g.blockIndex)),c)throw c;m.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class rb{constructor({version:e,name:i,units:a,tileSize:c,pixelFormat:m,buffer:g,dataIndex:x},S){if(this.version=e,this.version!==1)throw new hu(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=a,this.tileSize=c,this.buffer=g,this.pixelFormat=nI[m],this.dataIndex=x,this.bandShape=[c+2*g,c+2*g,AE[this.pixelFormat]],this._decodedBlocks=new g_(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return AE[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[a,c]of this.dataIndex.entries()){for(const[m,g]of c.bands.entries())if(g===e)return{bandIndex:i+m,blockIndex:a,blockBandIndex:m};i+=c.bands.length}break;case"number":for(const[a,c]of this.dataIndex.entries()){if(e>=i&&e<i+c.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-i};i+=c.bands.length}break;default:throw new hu(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,a=-1/0;const c=[],m=new Set;for(const g of e){const{blockIndex:x}=this.getBlockForBand(g);if(x<0)throw new hu(`Invalid band: ${JSON.stringify(g)}`);const S=this.dataIndex[x];c.includes(x)||c.push(x),m.add(x),i=Math.min(i,S.firstByte),a=Math.max(a,S.lastByte)}if(m.size>this.cacheSize)throw new hu(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:a,blockIndices:c}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:a}=this.getBlockForBand(e);if(i<0)throw new hu(`Band not found: ${JSON.stringify(e)}`);const c=this._decodedBlocks.get(i.toString());if(!c)throw new hu(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const m=this.dataIndex[i],g=this.bandShape.reduce((C,M)=>C*M,1),x=a*g,S=c.subarray(x,x+g);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:m.offset,scale:m.scale}}}x_.setPbf=function(n){Rw=n};class ob{constructor(e,i,a){this.tasks=e,this._onCancel=i,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}x_.performDecoding=function(n,e){const i=new Uint8Array(n);return Promise.all(e.tasks.map(a=>{const{layerName:c,firstByte:m,lastByte:g,pixelFormat:x,blockShape:S,blockIndex:C,filters:M,codec:P}=a,k=i.subarray(m,g+1),V=new Uint32Array(S[0]*S[1]*S[2]);let U;if(P!=="gzip_data")throw new hu(`Unhandled codec: ${P}`);return U=function(q,J){if(!globalThis.DecompressionStream&&J==="gzip_data")return Promise.resolve(((fe=function(Pe){Pe[0]==31&&Pe[1]==139&&Pe[2]==8||vc(6,"invalid gzip data");var ke=Pe[3],Be=10;4&ke&&(Be+=2+(Pe[10]|Pe[11]<<8));for(var ot=(ke>>3&1)+(ke>>4&1);ot>0;ot-=!Pe[Be++]);return Be+(2&ke)}(le=q))+8>le.length&&vc(6,"invalid gzip data"),function(Pe,ke,Be,ot){var Ze=Pe.length;if(!Ze||ke.f&&!ke.l)return Be||new Hs(0);var st=!Be,dt=st||ke.i!=2,wt=ke.i;st&&(Be=new Hs(3*Ze));var Rt,Mt,yt=function(ar){var fr=Be.length;if(ar>fr){var Mr=new Hs(Math.max(2*fr,ar));Mr.set(Be),Be=Mr}},Dt=ke.f||0,nt=ke.p||0,tt=ke.b||0,St=ke.l,It=ke.d,bt=ke.m,vt=ke.n,ci=8*Ze;do{if(!St){Dt=uu(Pe,nt,1);var Yt=uu(Pe,nt+1,3);if(nt+=3,!Yt){var Wt=Pe[(Ee=4+((nt+7)/8|0))-4]|Pe[Ee-3]<<8,ji=Ee+Wt;if(ji>Ze){wt&&vc(0);break}dt&&yt(tt+Wt),Be.set(Pe.subarray(Ee,ji),tt),ke.b=tt+=Wt,ke.p=nt=8*ji,ke.f=Dt;continue}if(Yt==1)St=eI,It=tI,bt=9,vt=5;else if(Yt==2){var Kt=uu(Pe,nt,31)+257,Ai=uu(Pe,nt+10,15)+4,qi=Kt+uu(Pe,nt+5,31)+1;nt+=14;for(var fn=new Hs(qi),En=new Hs(19),Zi=0;Zi<Ai;++Zi)En[Aw[Zi]]=uu(Pe,nt+3*Zi,7);nt+=3*Ai;var $n=Iw(En),Jn=(1<<$n)-1,eo=y_(En,$n);for(Zi=0;Zi<qi;){var Ee,be=eo[uu(Pe,nt,Jn)];if(nt+=15&be,(Ee=be>>4)<16)fn[Zi++]=Ee;else{var at=0,Gt=0;for(Ee==16?(Gt=3+uu(Pe,nt,3),nt+=2,at=fn[Zi-1]):Ee==17?(Gt=3+uu(Pe,nt,7),nt+=3):Ee==18&&(Gt=11+uu(Pe,nt,127),nt+=7);Gt--;)fn[Zi++]=at}}var ut=fn.subarray(0,Kt),qt=fn.subarray(Kt);bt=Iw(ut),vt=Iw(qt),St=y_(ut,bt),It=y_(qt,vt)}else vc(1);if(nt>ci){wt&&vc(0);break}}dt&&yt(tt+131072);for(var wi=(1<<bt)-1,vi=(1<<vt)-1,Ki=nt;;Ki=nt){var Li=(at=St[Av(Pe,nt)&wi])>>4;if((nt+=15&at)>ci){wt&&vc(0);break}if(at||vc(2),Li<256)Be[tt++]=Li;else{if(Li==256){Ki=nt,St=null;break}var gi=Li-254;Li>264&&(gi=uu(Pe,nt,(1<<(zi=__[Zi=Li-257]))-1)+ib[Zi],nt+=zi);var Wn=It[Av(Pe,nt)&vi],xr=Wn>>4;if(Wn||vc(3),nt+=15&Wn,qt=Ev[xr],xr>3){var zi=eb[xr];qt+=Av(Pe,nt)&(1<<zi)-1,nt+=zi}if(nt>ci){wt&&vc(0);break}dt&&yt(tt+131072);var Fn=tt+gi;if(tt<qt){var yr=0-qt,or=Math.min(qt,Fn);for(yr+tt<0&&vc(3);tt<or;++tt)Be[tt]=(void 0)[yr+tt]}for(;tt<Fn;++tt)Be[tt]=Be[tt-qt]}}ke.l=St,ke.p=Ki,ke.b=tt,ke.f=Dt,St&&(Dt=1,ke.m=bt,ke.d=It,ke.n=vt)}while(!Dt);return tt!=Be.length&&st?(Rt=Be,((Mt=tt)==null||Mt>Rt.length)&&(Mt=Rt.length),new Hs(Rt.subarray(0,Mt))):Be.subarray(0,tt)}(le.subarray(fe,-8),{i:2},new Hs(((ee=le)[(oe=ee.length)-4]|ee[oe-3]<<8|ee[oe-2]<<16|ee[oe-1]<<24)>>>0))));var ee,oe,le,fe;const Ie=EE[J];if(!Ie)throw new Error(`Unhandled codec: ${J}`);const Se=new globalThis.DecompressionStream(Ie);return new Response(new Blob([q]).stream().pipeThrough(Se)).arrayBuffer().then(Pe=>new Uint8Array(Pe))}(k,P).then(q=>(function(J,ee){J.readFields(KC,ee)}(new Rw(q),V),new rI[x](V.buffer))),U.then(q=>{for(let J=M.length-1;J>=0;J--)switch(M[J]){case"delta_filter":wE(q,S);break;case"zigzag_filter":JC(q);break;case"bitshuffle_filter":QC(q,x);break;default:throw new hu(`Unhandled filter "${M[J]}"`)}return{layerName:c,blockIndex:C,data:q}}).catch(q=>{throw q})}))},li(ob,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),li(x_,"MapboxRasterTile"),li(rb,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class CE{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class IE{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new yd(Bt,16,0),this.featureIndexArray=new gx,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,a,c,m,g=0,x=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,c,m,g);const C=this.grid;for(let M=0;M<i.length;M++){const P=i[M],k=[1/0,1/0,-1/0,-1/0];for(let V=0;V<P.length;V++){const U=P[V];k[0]=Math.min(k[0],U.x),k[1]=Math.min(k[1],U.y),k[2]=Math.max(k[2],U.x),k[3]=Math.max(k[3],U.y)}x!==0&&(k[0]-=x,k[1]-=x,k[2]+=x,k[3]+=x),k[0]<Bt&&k[1]<Bt&&k[2]>=0&&k[3]>=0&&C.insert(S,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new mi(new zf(this.rawTileData)).layers,this.sourceLayerCoder=new CE(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:a,transform:c,tileTransform:m,pixelPosMatrix:g,availableImages:x,worldview:S}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const C=i.queryRadius?i.queryRadius:0,M=a.bufferedTilespaceBounds,P=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(q,J,ee,oe)=>mo(a.bufferedTilespaceGeometry,q-C,J-C,ee+C,oe+C));P.sort(DE);let k=null;c.elevation&&P.length>0&&(k=Vd.create(c.elevation,this.tileID));const V={};let U;for(let q=0;q<P.length;q++){const J=P[q];if(J===U)continue;U=J;const ee=this.featureIndexArray.get(J);let oe=null;this.is3DTile?this.loadMatchingModelFeature(V,ee,e,a,c,S):this.loadMatchingFeature(V,ee,e,x,S,(le,fe,Ie,Se=0)=>(oe||(oe=ct(le,this.tileID.canonical,m)),fe.queryIntersectsFeature(a,le,Ie,oe,this.z,c,g,k,Se)))}return V}loadMatchingFeature(e,i,a,c,m,g){const{featureIndex:x,bucketIndex:S,sourceLayerIndex:C,layoutVertexArrayOffset:M}=i,P=this.bucketLayerIDs[S],k=a.layers,V=Object.keys(k);if(V.length&&!Ri(V,P))return;const U=a.sourceCache,q=this.sourceLayerCoder.decode(C),J=this.vtLayers[q].feature(x),ee=this.getId(J,q);for(let oe=0;oe<P.length;oe++){const le=P[oe];if(!k[le])continue;const{styleLayer:fe,targets:Ie}=k[le];let Se={};ee!==void 0&&(Se=U.getFeatureState(fe.sourceLayer,ee));const Pe=!g||g(J,fe,Se,M);if(!Pe)continue;const ke=new Xh(J,this.z,this.x,this.y,ee);ke.tile=this.tileID.canonical,ke.state=Se;let Be=this.serializedLayersCache.get(le);Be||(Be=fe.serialize(),Be.id=le,this.serializedLayersCache.set(le,Be)),ke.source=Be.source,ke.sourceLayer=Be["source-layer"],ke.layer=Object.assign({},Be),ke.layer.paint=RE(Be.paint,fe.paint,J,Se,c),ke.layer.layout=RE(Be.layout,fe.layout,J,Se,c);let ot=!1;for(const Ze of Ie){this.updateFeatureProperties(ke,Ze);const{filter:st}=Ze;if(st){if(J.properties=ke.properties,st.needGeometry){const dt=et(J,!0);if(!st.filter(new Ar(this.tileID.overscaledZ,{worldview:m}),dt,this.tileID.canonical))continue}else if(!st.filter(new Ar(this.tileID.overscaledZ,{worldview:m}),J))continue}ot=!0,Ze.targetId&&this.addFeatureVariant(ke,Ze)}ot&&this.appendToResult(e,le,x,ke,Pe)}}loadMatchingModelFeature(e,i,a,c,m,g){const{featureIndex:x,bucketIndex:S}=i,C=this.bucketLayerIDs[S],M=a.layers,P=Object.keys(M);if(!P.length||Ri(P,C))for(let k=0;k<C.length;k++){const V=C[k],{styleLayer:U,targets:q}=M[V];if(U.type!=="model")continue;const J=c.tile,ee=J.getBucket(U);if(!(ee&&ee instanceof xv))continue;const oe=cE(ee,x,c,m);if(!oe)continue;const{z:le,x:fe,y:Ie}=J.tileID.canonical,{feature:Se,intersectionZ:Pe,position:ke}=oe;let Be={};Se.id!==void 0&&(Be=a.sourceCache.getFeatureState(U.sourceLayer,Se.id));const ot=new Xh({},le,fe,Ie,Se.id);ot.tile=this.tileID.canonical,ot.state=Be,ot.properties=Se.properties,ot.geometry={type:"Point",coordinates:[ke.lng,ke.lat]};let Ze=this.serializedLayersCache.get(V);Ze||(Ze=U.serialize(),Ze.id=V,this.serializedLayersCache.set(V,Ze)),ot.source=Ze.source,ot.sourceLayer=Ze["source-layer"],ot.layer=Object.assign({},Ze);let st=!1;for(const dt of q){this.updateFeatureProperties(ot,dt);const{filter:wt}=dt;if(wt){if(Se.properties=ot.properties,wt.needGeometry){if(!wt.filter(new Ar(this.tileID.overscaledZ,{worldview:g}),Se,this.tileID.canonical))continue}else if(!wt.filter(new Ar(this.tileID.overscaledZ,{worldview:g}),Se))continue}st=!0,dt.targetId&&this.addFeatureVariant(ot,dt)}st&&this.appendToResult(e,V,x,ot,Pe)}}updateFeatureProperties(e,i,a){if(i.properties){const c={};for(const m in i.properties){const g=i.properties[m].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);g!=null&&(c[m]=g)}e.properties=c}}addFeatureVariant(e,i,a){const c={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(c.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(c)}appendToResult(e,i,a,c,m){let g=e[i];g===void 0&&(g=e[i]=[]),g.push({featureIndex:a,feature:c,intersectionZ:m})}lookupSymbolFeatures(e,i,a,c,m,g){const x={};this.loadVTLayers();for(const S of e)this.loadMatchingFeature(x,{bucketIndex:i,sourceLayerIndex:a,featureIndex:S,layoutVertexArrayOffset:0},c,m,g);return x}loadFeature(e){const{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(a),m=this.vtFeatures[c];if(m[i])return m[i];const g=this.vtLayers[c].feature(i);return m[i]=g,g}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;if(this.promoteId){const c=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(c!=null)if(Array.isArray(c)){if(!this.promoteIdExpression){const m=Ho(c);if(m.result!=="success"){const g=m.value.map(x=>`${x.key}: ${x.message}`).join(", ");return void ei(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=m.value}a=this.promoteIdExpression.evaluate({zoom:0},e)}else a=e.properties[c];typeof a=="boolean"&&(a=Number(a))}return a}}function RE(n,e,i,a,c){return xt(n,(m,g)=>{const x=e instanceof fc?e.get(g):null;return x&&x.evaluate?x.evaluate(i,a,void 0,c):x})}function DE(n,e){return e-n}li(IE,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const ab=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Dw{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=a>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const m=ab[15&a];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new Dw(x,g,m,e)}constructor(e,i=64,a=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=ab.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-x%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${a}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+x+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=i,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Cv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,a,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:x}=this,S=[0,m.length-1,0],C=[];for(;S.length;){const M=S.pop()||0,P=S.pop()||0,k=S.pop()||0;if(P-k<=x){for(let J=k;J<=P;J++){const ee=g[2*J],oe=g[2*J+1];ee>=e&&ee<=a&&oe>=i&&oe<=c&&C.push(m[J])}continue}const V=k+P>>1,U=g[2*V],q=g[2*V+1];U>=e&&U<=a&&q>=i&&q<=c&&C.push(m[V]),(M===0?e<=U:i<=q)&&(S.push(k),S.push(V-1),S.push(1-M)),(M===0?a>=U:c>=q)&&(S.push(V+1),S.push(P),S.push(1-M))}return C}within(e,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:m,nodeSize:g}=this,x=[0,c.length-1,0],S=[],C=a*a;for(;x.length;){const M=x.pop()||0,P=x.pop()||0,k=x.pop()||0;if(P-k<=g){for(let J=k;J<=P;J++)Rv(m[2*J],m[2*J+1],e,i)<=C&&S.push(c[J]);continue}const V=k+P>>1,U=m[2*V],q=m[2*V+1];Rv(U,q,e,i)<=C&&S.push(c[V]),(M===0?e-a<=U:i-a<=q)&&(x.push(k),x.push(V-1),x.push(1-M)),(M===0?e+a>=U:i+a>=q)&&(x.push(V+1),x.push(P),x.push(1-M))}return S}}function Cv(n,e,i,a,c,m){if(c-a<=i)return;const g=a+c>>1;Mw(n,e,g,a,c,m),Cv(n,e,i,a,g-1,1-m),Cv(n,e,i,g+1,c,1-m)}function Mw(n,e,i,a,c,m){for(;c>a;){if(c-a>600){const C=c-a+1,M=i-a+1,P=Math.log(C),k=.5*Math.exp(2*P/3),V=.5*Math.sqrt(P*k*(C-k)/C)*(M-C/2<0?-1:1);Mw(n,e,i,Math.max(a,Math.floor(i-M*k/C+V)),Math.min(c,Math.floor(i+(C-M)*k/C+V)),m)}const g=e[2*i+m];let x=a,S=c;for(Iv(n,e,a,i),e[2*c+m]>g&&Iv(n,e,a,c);x<S;){for(Iv(n,e,x,S),x++,S--;e[2*x+m]<g;)x++;for(;e[2*S+m]>g;)S--}e[2*a+m]===g?Iv(n,e,a,S):(S++,Iv(n,e,S,c)),S<=i&&(a=S+1),i<=S&&(c=S-1)}}function Iv(n,e,i,a){Pw(n,i,a),Pw(e,2*i,2*a),Pw(e,2*i+1,2*a+1)}function Pw(n,e,i){const a=n[e];n[e]=n[i],n[i]=a}function Rv(n,e,i,a){const c=n-i,m=e-a;return c*c+m*m}r.$=_p,r.A=zo,r.B=Bu,r.C=2,r.D=Bg,r.E=vn,r.F=Bf,r.G=q1,r.H=Nm,r.I=ki,r.J=Fp,r.K=hd,r.L=gp,r.M=sg,r.N=ag,r.O=Y_,r.P=Tt,r.Q=cg,r.R=bu,r.S=Ah,r.T=Od,r.U=Ho,r.V=u_,r.W=K_,r.X=Mu,r.Y=tf,r.Z=zc,r._=ls,r.a=function(n){return Sr.API_CDN_URL_REGEX.test(n)},r.a$=mf,r.a0=Vi,r.a1=po,r.a2=Ch,r.a3=class extends u_{},r.a4=Lu,r.a5=Pp,r.a6=qe,r.a7=function(n){const e=n.value;return e?Vi(e)?h_(e,!0)?[]:[new u_(n.key,e,`invalid url "${e}"`)]:[new u_(n.key,e,`string expected, "${hd(e)}" found`)]:[]},r.a8=Yn,r.a9=ro,r.aA=Y,r.aB=Le,r.aC=Uo,r.aD=Bs,r.aE=Ca,r.aF=ne,r.aG=rt,r.aH=function(n,e){const i={};for(let a=0;a<e.length;a++){const c=e[a];c in n&&(i[c]=n[c])}return i},r.aI=B,r.aJ=te,r.aK=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,i,a){const c=this.entries[n]=this.entries[n]||{callbacks:[]};if(c.result){const[m,g]=c.result;return this.scheduler?this.scheduler.add(()=>{a(m,g)},e):a(m,g),()=>{}}return c.callbacks.push(a),c.cancel||(c.cancel=i((m,g)=>{c.result=[m,g];for(const x of c.callbacks)this.scheduler?this.scheduler.add(()=>{x(m,g)},e):x(m,g);setTimeout(()=>delete this.entries[n],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(m=>m!==a),c.callbacks.length||(c.cancel(),delete this.entries[n]))}}},r.aL=function(n,e,i){const a=JSON.stringify(n.request);return n.data&&(this.deduped.entries[a]={result:[null,n.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},c=>{const m=oc(n.request,(g,x,S)=>{g?c(g):x&&c(null,{vectorTile:i?void 0:new mi(new zf(x)),rawData:x,responseHeaders:new Map(S.entries())})});return()=>{m.cancel(),c()}},e)},r.aM=function(n){return n?{cacheControl:n.get("Cache-Control"),expires:n.get("Expires")}:{cacheControl:void 0,expires:void 0}},r.aN=function(n){nc++,nc>as&&(n.getActor().send("enforceCacheSizeLimit",Gr),nc=0)},r.aO=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log2(n)))},r.aP=va,r.aQ=dv,r.aR=mv,r.aS=j,r.aT=a_,r.aU=function(n,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<n.length;a++){const c=document.createElement("source");Gn(n[a])||(i.crossOrigin="Anonymous"),c.src=n[a],i.appendChild(c)}return{cancel:()=>{}}},r.aV=Jc,r.aW=xm,r.aX=We,r.aY=fm,r.aZ=me,r.a_=ce,r.aa=Pt,r.ab=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return hr(n.expression.evaluate(e))}interpolate(n,e,i){return{x:Si(n.x,e.x,i),y:Si(n.y,e.y,i),z:Si(n.z,e.z,i),azimuthal:Si(n.azimuthal,e.azimuthal,i),polar:Si(n.polar,e.polar,i)}}},r.ac=Ar,r.ad=wh,r.ae=He,r.af=on,r.ag=Qt,r.ah=ue,r.ai=fc,r.aj=Rd,r.ak=Si,r.al=Bt,r.am=lc,r.an=hn,r.ao=Qi,r.ap=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return function([i,a]){const c=hr([1,i,a]);return{x:c.x,y:c.y,z:c.z}}(n.expression.evaluate(e))}interpolate(n,e,i){return{x:Si(n.x,e.x,i),y:Si(n.y,e.y,i),z:Si(n.z,e.z,i)}}},r.aq=function(n,e,i=0,a=!0){const c=new Tt(i,i),m=n.sub(c),g=e.add(c),x=[m,new Tt(g.x,m.y),g,new Tt(m.x,g.y)];return a&&x.push(m.clone()),x},r.ar=function(n,e){const i=[];for(let a=0;a<n.length;a++){const c=we(a-1,-1,n.length-1),m=we(a+1,-1,n.length-1),g=n[a],x=n[m],S=n[c].sub(g).unit(),C=x.sub(g).unit(),M=C.angleWithSep(S.x,S.y),P=S.add(C).unit().mult(-1*e/Math.sin(M/2));i.push(g.add(P))}return i},r.as=A0,r.at=mo,r.au=function(n,e,i=0){return _t(((e.x-i)*n.scale-n.x)*Bt,(e.y*n.scale-n.y)*Bt,Ce(e.z,e.y))},r.av=Fr,r.aw=mn,r.ax=tn,r.ay=qS,r.az=function(n){let e=1/0,i=1/0,a=-1/0,c=-1/0;for(const m of n)e=Math.min(e,m.x),i=Math.min(i,m.y),a=Math.max(a,m.x),c=Math.max(c,m.y);return{min:new Tt(e,i),max:new Tt(a,c)}},r.b=function(n){return Sr.API_FONTS_REGEX.test(n)},r.b$=Ox,r.b0=lr,r.b1=je,r.b2=hy,r.b3=r_,r.b4=function(){tl.isLoading()||tl.isLoaded()||iy()!=="deferred"||ny()},r.b5=uf,r.b6=et,r.b7=Xh,r.b8=Ro,r.b9=O1,r.bA=Ct,r.bB=de,r.bC=function(n,e){const{x:i,y:a}=n.point,c=Qb(i,a,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Le(c,c,Kb(Fh(e)))},r.bD=H,r.bE=tr,r.bF=Vr,r.bG=pr,r.bH=Xi,r.bI=Ei,r.bJ=ru,r.bK=ll,r.bL=za,r.bM=function(n,e,i,a,c){const m=5*e+2;n.float32[m+0]=i,n.float32[m+1]=a,n.float32[m+2]=c},r.bN=_m,r.bO=yo,r.bP=wr,r.bQ=Wo,r.bR=tc,r.bS=we,r.bT=function(n,e,i,a){var c=new N(4);return c[0]=n,c[1]=e,c[2]=i,c[3]=a,c},r.bU=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,a=1<<i,c=Math.floor(n.x),m=Math.floor((n.x-c)*a),g=Math.floor(n.y*a),x=this.findDEMTileFor(new va(i,c,i,m,g));return!(!x||!x.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||n.y<0||n.y>1)return e;const c=a.getSource().maxzoom,m=1<<c,g=Math.floor(n.x),x=n.x-g,S=new va(c,g,c,Math.floor(x*m),Math.floor(n.y*m)),C=this.findDEMTileFor(S);if(!C||!C.dem)return e;const M=C.dem,P=1<<C.tileID.canonical.z,k=(x*P-C.tileID.canonical.x)*M.dim,V=(n.y*P-C.tileID.canonical.y)*M.dim,U=Math.floor(k),q=Math.floor(V);return(i?this.exaggeration():1)*Si(Si(M.get(U,q),M.get(U,q+1),V-q),Si(M.get(U+1,q),M.get(U+1,q+1),V-q),k-U)}static getAtTileOffset(n,e,i,a){const c=1<<n.canonical.z;return a?a.pointElevation(e):i?i.getAtPointOrZero(new He(n.wrap+(n.canonical.x+e.x/Bt)/c,(n.canonical.y+e.y/Bt)/c)):0}static getAtTileOffsetFunc(n,e,i,a){return(c,m,g)=>{const x=this.getAtTileOffset(n,c,m,g),S=a.upVector(n.canonical,c.x,c.y);return pn(S,S,x*a.upVectorScale(n.canonical,e,i).metersToTile),S}}getForTilePoints(n,e,i,a){if(this.isUsingMockSource())return!1;const c=Vd.create(this,n,a);return!!c&&(e.forEach(m=>{m[2]=this.exaggeration()*c.getElevationAt(m[0],m[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,a=e.tileID,c=1<<n.canonical.z-a.canonical.z;let m=n.canonical.x/c-a.canonical.x,g=n.canonical.y/c-a.canonical.y,x=0;for(let S=0;S<n.canonical.z-a.canonical.z&&!i.leaves[x];S++){m*=2,g*=2;const C=2*Math.floor(g)+Math.floor(m);x=i.childOffsets[x]+C,m%=1,g%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,i=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const c of n){const m=this.getMinMaxForTile(c.tileID);m&&(i=Math.min(i,m.min),a=Math.max(a,m.max),e=!0)}return e?{min:i,max:a}:null}},r.bV=Nx,r.bW=Eo,r.bX=La,r.bY=hS,r.bZ=sw,r.b_=pS,r.ba=kg,r.bb=ct,r.bc=Wa,r.bd=jp,r.be=Xb,r.bf=oo,r.bg=Zp,r.bh=P0,r.bi=function(n,e){const i=Rd(e.zoom);if(i===0)return Fh(n);const a=Ex(n),c=Cl(a),m=ne(a.getWest())*e.worldSize,g=ne(a.getEast())*e.worldSize,x=te(a.getNorth())*e.worldSize,S=te(a.getSouth())*e.worldSize,C=[m,x,0],M=[g,x,0],P=[m,S,0],k=[g,S,0],V=$e([],e.globeMatrix);return on(C,C,V),on(M,M,V),on(P,P,V),on(k,k,V),c[0]=Cd(c[0],P,i),c[1]=Cd(c[1],k,i),c[2]=Cd(c[2],M,i),c[3]=Cd(c[3],C,i),dn.fromPoints(c)},r.bj=xy,r.bk=$e,r.bl=Id,r.bm=Cd,r.bn=qc,r.bo=NT,r.bp=Vt,r.bq=Ke,r.br=x_,r.bs=zf,r.bt=oc,r.bu=function(n,e){const i=[];for(const a in n)a in e||i.push(a);return i},r.bv=ye,r.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bx=Ta,r.by=ve,r.bz=xe,r.c=oa,r.c$=function(n){return n*n*n*n*n},r.c0=e_,r.c1=Y1,r.c2=sv,r.c3=Dw,r.c4=pn,r.c5=ma,r.c6=jo,r.c7=function(n,e,i){i*=.5;var a=e[0],c=e[1],m=e[2],g=e[3],x=Math.sin(i),S=Math.cos(i);return n[0]=a*S+c*x,n[1]=c*S-a*x,n[2]=m*S+g*x,n[3]=g*S-m*x,n},r.c8=Yo,r.c9=to,r.cA=rr,r.cB=Zx,r.cC=Al,r.cD=UT,r.cE=function(n,e,i,a,c,m,g,x,S){if(S.name==="globe")return UT(n,e,new Al(i,a,c),!1);const C=fm({z:i,x:a,y:c},S);return new dn([(m+C.x/C.scale)*e,e*(C.y/C.scale),g],[(m+C.x2/C.scale)*e,e*(C.y2/C.scale),x])},r.cF=function(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n[3]=Math.min(e[3],i[3]),n},r.cG=function(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n[3]=Math.max(e[3],i[3]),n},r.cH=function(n){const e=Math.round((n+45+360)%360/90)%4;return it[e]},r.cI=_e,r.cJ=Oo,r.cK=t,r.cL=function(n){const e=xe(new Float64Array(16));Le(e,n.pixelMatrix,n.globeMatrix);const i=[0,b,0],a=[0,T,0];return on(i,i,e),on(a,a,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!e1(n,new j(n.center.lat,90)),a[0]>0&&a[0]<=n.width&&a[1]>0&&a[1]<=n.height&&!e1(n,new j(n.center.lat,-90))]},r.cM=function(n,e){const{scale:i}=n.tileTransform,a=i*Bt/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return function(c,m,g){var x=m[1],S=m[2],C=m[3],M=g[0],P=g[1];return c[0]=m[0]*M,c[1]=x*M,c[2]=S*P,c[3]=C*P,c}(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},r.cN=nm,r.cO=di,r.cP=Qc,r.cQ=function(n){const e=Qc(n,!0);return H([],[e[0],e[1],e[4],e[5]])},r.cR=Ge,r.cS=mr,r.cT=Ye,r.cU=function(n){const{x:e,y:i}=n.point,{lng:a,lat:c}=n._center;return Qb(e,i,n.worldSize,a,c)},r.cV=zn,r.cW=Ko,r.cX=Is,r.cY=Mo,r.cZ=f,r.c_=function(n,e,i){let a=0;for(let c=0;c<2;++c)n[c]>0&&(a+=(n[c]-0)*(n[c]-0)),e[c]<0&&(a+=(0-e[c])*(0-e[c]));return a},r.ca=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},r.cb=si,r.cc=function(n,e,i,a,c){var m=1/Math.tan(e/2);if(n[0]=m/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,c!=null&&c!==1/0){var g=1/(a-c);n[10]=(c+a)*g,n[14]=2*c*a*g}else n[10]=-1,n[14]=-2*a;return n},r.cd=function(n,e,i,a,c,m,g){var x=1/(e-i),S=1/(a-c),C=1/(m-g);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*S,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*C,n[11]=0,n[12]=(e+i)*x,n[13]=(c+a)*S,n[14]=(g+m)*C,n[15]=1,n},r.ce=se,r.cf=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},r.cg=xf,r.ch=Sl,r.ci=So,r.cj=ds,r.ck=Zl,r.cl=mm,r.cm=function(){var n=new N(4);return N!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},r.cn=function(n,e,i){var a=e[0],c=e[1],m=e[2],g=e[3],x=Math.sin(i),S=Math.cos(i);return n[0]=a*S+m*x,n[1]=c*S+g*x,n[2]=a*-x+m*S,n[3]=c*-x+g*S,n},r.co=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},r.cp=co,r.cq=function(n){var e=n[0],i=n[1],a=n[2],c=n[3];return Math.sqrt(e*e+i*i+a*a+c*c)},r.cr=ir,r.cs=gr,r.ct=Kc,r.cu=3,r.cv=2,r.cw=7,r.cx=6,r.cy=Rn,r.cz=Nt,r.d=function(n){return Sr.API_TILEJSON_REGEX.test(n)},r.d$=$T,r.d0=Q,r.d1=45,r.d2=ql,r.d3=function(n,e,i){const a=Math.sqrt(n*n+e*e+i*i),c=a>0?Math.acos(i/a)*Ma:0;let m=n!==0||e!==0?Math.atan2(-e,-n)*Ma+90:0;return m<0&&(m+=360),[a,m,c]},r.d4=_t,r.d5=hr,r.d6=De,r.d7=fi,r.d8=dn,r.d9=rn,r.dA=Ed,r.dB=class extends Wl{constructor(n){super(n),this.current=Zb}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.dC=bi,r.dD=function(n,e,i){const a=Rd(i.zoom),c=n.style.map._antialias,m=n.terrain&&n.terrain.exaggeration()>0;return a===0&&!c&&!m},r.dE=function(n){const e=n.pixelsPerMeter,i=e/se(1,n.center.lat),a=xe(new Float64Array(16));return Ke(a,a,[n.point.x,n.point.y,0]),Ge(a,a,[i,i,e]),Float32Array.from(a)},r.dF=Ex,r.dG=function(n){const e=_e-5;n=Y(n,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(hn(n))),3);return Math.round(i*(y.length-1))},r.dH=function(n,e,i,a){const c=e.getNorth(),m=e.getSouth(),g=e.getWest(),x=e.getEast(),S=1<<n.z,C=x-g,M=c-m,P=C/p,k=-M/y[i],V=[0,P,0,k,0,0,c,g,0];if(n.z>0){const U=180/a;he(V,V,[U/C+1,0,0,0,U/M+1,0,-.5*U/P,.5*U/k,1])}return V[2]=S,V[5]=n.x,V[8]=n.y,V},r.dI=Fh,r.dJ=function(n,e,i){const a=xe(new Float64Array(16)),c=(e/(1<<n)-.5)*Math.PI*2;return mt(a,i.globeMatrix,c),Float32Array.from(a)},r.dK=wy,r.dL=Sx,r.dM=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},r.dN=X,r.dO=function(n,e){var i=Math.sin(e),a=Math.cos(e);return n[0]=a,n[1]=i,n[2]=0,n[3]=-i,n[4]=a,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},r.dP=Ur,r.dQ=GT,r.dR=Rr,r.dS=Zr,r.dT=256,r.dU=function(n,e){const i=[0,0,0];return on(i,i,xy(Fh(e.canonical))),on(i,i,n),i},r.dV=n=>({u_matrix:new Zl(n),u_texsize:new ds(n),u_pixels_to_tile_units:new my(n),u_device_pixel_ratio:new So(n),u_width_scale:new So(n),u_floor_width_scale:new So(n),u_image:new xf(n),u_units_to_pixels:new ds(n),u_tile_units_to_pixels:new So(n),u_alpha_discard_threshold:new So(n),u_trim_offset:new ds(n),u_trim_fade_range:new ds(n),u_trim_color:new ql(n),u_emissive_strength:new So(n),u_zbias_factor:new So(n),u_tile_to_meter:new So(n),u_ground_shadow_factor:new Sl(n),u_pattern_transition:new So(n)}),r.dW=n=>({u_matrix:new Zl(n),u_pixels_to_tile_units:new my(n),u_device_pixel_ratio:new So(n),u_width_scale:new So(n),u_floor_width_scale:new So(n),u_units_to_pixels:new ds(n),u_dash_image:new xf(n),u_gradient_image:new xf(n),u_image_height:new So(n),u_texsize:new ds(n),u_tile_units_to_pixels:new So(n),u_alpha_discard_threshold:new So(n),u_trim_offset:new ds(n),u_trim_fade_range:new ds(n),u_trim_color:new ql(n),u_emissive_strength:new So(n),u_zbias_factor:new So(n),u_tile_to_meter:new So(n),u_ground_shadow_factor:new Sl(n)}),r.dX=n=>({u_camera_to_center_distance:new So(n),u_extrude_scale:new my(n),u_device_pixel_ratio:new So(n),u_matrix:new Zl(n),u_inv_rot_matrix:new Zl(n),u_merc_center:new ds(n),u_tile_id:new Sl(n),u_zoom_transition:new So(n),u_up_dir:new Sl(n),u_emissive_strength:new So(n)}),r.dY=Gl,r.dZ=B1,r.d_=class{constructor(n,e,i,a){this.context=n,this.format=a,this.size=i,this.texture=n.gl.createTexture();const[c,m,g]=this.size,{gl:x}=n;x.bindTexture(x.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&x.texImage3D(x.TEXTURE_3D,0,this.format,c,m,g,0,$x(this.format),im(this.format),e.data)}bind(n,e){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_3D,this.texture),n!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,n),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},r.da=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},r.db=jy,r.dc=Zu,r.dd=C1,r.de=h_,r.df=function(n,e){return n.readFields(Yh,{icons:[]},e)},r.dg=Bx,r.dh=_c,r.di=th,r.dj=qd,r.dk=ca,r.dl=ch,r.dm=ge,r.dn=ti,r.dp=function(n){const e=n.indexOf(bd);return e>=0?n.slice(0,e):n},r.dq=function(n){return n.indexOf(bd)>=0},r.dr=function(n){const e=n.lastIndexOf(bd);return e>=0?n.slice(e+1):""},r.ds=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.dt=function(n,e,i,a){return n.type==="custom"?new aw(n,e):new uE[n.type](n,e,i,a)},r.du=ht,r.dv=function(n){const e=n.indexOf(bd);return e>=0?n.slice(e+1):""},r.dw=class extends Xh{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},r.dx=pg,r.dy=wu,r.dz=function(n){return n({pluginStatus:Nn,pluginURL:Hr}),pg.on("pluginStateChange",n),n},r.e=Sr,r.e$=function([n,e,i]){const a=Math.hypot(n,e,i),c=Math.atan2(n,i),m=.5*Math.PI-Math.acos(-e/a);return new j(Ko(c),Ko(m))},r.e0=(n,e,i,a,c,m)=>{const g=n.transform,x=g.projection.name==="globe";let S;if(m.paint.get("circle-pitch-alignment")==="map")if(x){const M=GT(g.zoom,e.canonical)*g._pixelsPerMercatorPixel;S=Float32Array.from([M,0,0,M])}else S=g.calculatePixelsToTileUnitsMatrix(i);else S=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const C={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(g.projection),u_matrix:n.translatePosMatrix(e.projMatrix,i,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:bs.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:iC,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(x){C.u_inv_rot_matrix=a,C.u_merc_center=c,C.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],C.u_zoom_transition=Rd(g.zoom);const M=c[0]*Bt,P=c[1]*Bt;C.u_up_dir=g.projection.upVector(new Al(0,0,0),M,P)}return C},r.e1=L1,r.e2=sa,r.e3=(n,e,i,a,c,m,g,x,S,C)=>{const M=n.transform,P=M.pitch<15?k1(.07,.7,Y((14-M.zoom)/5,0,1)):.07,k=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:o0(n,e,i,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_width_scale:m,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:F1(e,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(k?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:De(e.tileID.canonical,0),u_ground_shadow_factor:S,u_pattern_transition:C}},r.e4=(n,e,i,a,c,m,g,x,S,C)=>{const M=n.transform,P=M.calculatePixelsToTileUnitsMatrix(e),k=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",V=M.pitch<15?k1(.07,.7,Y((14-M.zoom)/5,0,1)):.07;return{u_matrix:o0(n,e,i,a),u_pixels_to_tile_units:P,u_device_pixel_ratio:m,u_width_scale:g,u_floor_width_scale:x,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:z1(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:F1(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(k?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:V,u_tile_to_meter:De(e.tileID.canonical,0),u_ground_shadow_factor:C}},r.e5=ze,r.e6=Dg,r.e7=Ce,r.e8=Ad,r.e9=Ng,r.eA=hw,r.eB=kd,r.eC=al,r.eD=[1,1,1],r.eE=Vd,r.eF=_o,r.eG=function(n,e,i,a){var c=e[0],m=e[1],g=e[2],x=e[3];return n[0]=c+a*(i[0]-c),n[1]=m+a*(i[1]-m),n[2]=g+a*(i[2]-g),n[3]=x+a*(i[3]-x),n},r.eH=Mf,r.eI=jl,r.eJ=Hl,r.eK=function(n,e,i,a,c,m,g,x,S,C,M,P,k,V,U,q){var J=new N(16);return J[0]=n,J[1]=e,J[2]=i,J[3]=a,J[4]=c,J[5]=m,J[6]=g,J[7]=x,J[8]=S,J[9]=C,J[10]=M,J[11]=P,J[12]=k,J[13]=V,J[14]=U,J[15]=q,J},r.eL=F,r.eM=Up,r.eN=Vp,r.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Tt(1/0,1/0),max:new Tt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const i=dS(new Tt(0,0),new Tt(Bt,Bt),n),a=[];if(e&&!p1(i,this._globalClipBounds))return a;for(const c of this._activeRegions){if(c.hiddenByOverlap||!p1(i,c))continue;const m=fC(c.min,c.max,n);a.push({min:m.min,max:m.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId,order:c.order,clipMask:c.clipMask,clipScope:c.clipScope})}return a}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const a of e.cache.getVisibleCoordinates()){const c=e.cache.getTile(a).buckets[e.layer];c&&c.updateFootprints(a.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const i=n.getOrder(),a=n.getClipMask(),c=n.getClipScope();for(const m of e){if(!m.footprint)continue;const g=dS(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:i,clipMask:a,clipScope:c})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||If(e.min,i.min)||If(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(a,c){const m=(g,x)=>g+x;return a.length-c.length||a.reduce(m,"").localeCompare(c.reduce(m,""))}(e.clipScope,i.clipScope));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const i=this._activeRegions[e],a=this._prevRegions[e];n=i.priority!==a.priority||!Fg(i,a)||i.order!==a.order||i.clipMask!==a.clipMask||!Ta(i.clipScope,a.clipScope),this._activeRegions[e].hiddenByOverlap=a.hiddenByOverlap,++e}}if(n){++this._updateTime;for(const i of this._activeRegions)i.order!==Jp&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const a=this._activeRegions;if(i>=a.length)return i;const c=a[i].priority;for(;i<a.length&&a[i].priority===c;)++i;return i};if(this._sourceIds.length>1){let i=0,a=e(i);for(;i!==a;){let c=i;const m=i;for(;c!==a;){const g=this._activeRegions[c];g.hiddenByOverlap=!1;for(let x=0;x<m;x++){const S=this._activeRegions[x];if(!S.hiddenByOverlap&&g.order===Jp&&p1(g,S)&&(g.hiddenByOverlap=fS(g.footprint,g.tileId,S.footprint,S.tileId),g.hiddenByOverlap))break}++c}i=a,a=e(i)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},r.eP=Jp,r.eQ=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const i=new Wa,a=new lr,c=[],m=n+1+2,g=e[0]+1,x=e[0]+1+(1+e.length),S=(C,M,P)=>{let k=C===m-1?C-2:C===0?C:C-1;return k+=P?24575:0,[k,M]};for(let C=0;C<m;++C)i.emplaceBack(...S(C,0,!0));for(let C=0;C<g;++C)for(let M=0;M<m;++M)i.emplaceBack(...S(M,C,(M===0||M===m-1)&&!0));for(let C=0;C<e.length;++C){const M=e[C];for(let P=0;P<m;++P)i.emplaceBack(...S(P,M,!0))}for(let C=0;C<e.length;++C){const M=a.length,P=e[C]+1+2,k=new lr;for(let q=0;q<P-1;q++){const J=q===P-2,ee=J?m*(x-e.length+C-q):m;for(let oe=0;oe<m-1;oe++){const le=q*m+oe;q===0||J||oe===0||oe===m-2?(k.emplaceBack(le+1,le,le+ee),k.emplaceBack(le+ee,le+ee+1,le+1)):(a.emplaceBack(le+1,le,le+ee),a.emplaceBack(le+ee,le+ee+1,le+1))}}const V=oo.simpleSegment(0,M,i.length,a.length-M);for(let q=0;q<k.uint16.length;q+=3)a.emplaceBack(k.uint16[q],k.uint16[q+1],k.uint16[q+2]);const U=oo.simpleSegment(0,M,i.length,a.length-M);c.push({withoutSkirts:V,withSkirts:U})}return{vertices:i,indices:a,segments:c}}_createGrid(n){const e=this._fillGridMeshWithLods(p,y);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,Xb.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new lr;for(let g=0;g<=p;g++)e.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new Ph,a=new Ph,c=new Ph,m=new Ph;this._poleSegments=[];for(let g=0,x=0;g<f;g++){const S=360/(1<<g);i.emplaceBack(0,-Bs,0,.5,0),a.emplaceBack(0,-Bs,0,.5,1),c.emplaceBack(0,-Bs,0,.5,.5),m.emplaceBack(0,-Bs,0,.5,.5);for(let C=0;C<=p;C++){let M=C/p,P=0;const k=Si(0,S,M),[V,U,q]=I(i1,tC,k,Bs);i.emplaceBack(V,U,q,M,P),a.emplaceBack(V,U,q,M,1-P);const J=hn(k);M=.5+.5*Math.sin(J),P=.5+.5*Math.cos(J),c.emplaceBack(V,U,q,M,P),m.emplaceBack(V,U,q,M,1-P)}this._poleSegments.push(oo.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,Cg,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(a,Cg,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(c,Cg,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(m,Cg,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},r.eR=Mx,r.eS=ie,r.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.eU=W,r.eV=Te,r.eW=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},r.eX=Da,r.eY=D,r.eZ=kr,r.e_=Et,r.ea=wS,r.eb=Rf,r.ec=mC,r.ed=mS,r.ee=Ae,r.ef=function(n,e){if(n===e){var i=e[1],a=e[2],c=e[3],m=e[6],g=e[7],x=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=i,n[6]=e[9],n[7]=e[13],n[8]=a,n[9]=m,n[11]=e[14],n[12]=c,n[13]=g,n[14]=x}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},r.eg=ow,r.eh=gn,r.ei=uy,r.ej=256,r.ek=Kb,r.el=zs,r.em=mt,r.en=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},r.eo=Ph,r.ep=mx,r.eq=Z_,r.er=function(n,e,i,a,c){return Y((n-e)/(i-e)*(c-a)+a,a,c)},r.es=xs,r.et=function(n,e){var i=e[0],a=e[1],c=e[2],m=e[3],g=e[4],x=e[5],S=e[6],C=e[7],M=e[8],P=M*g-x*C,k=-M*m+x*S,V=C*m-g*S,U=i*P+a*k+c*V;return U?(n[0]=P*(U=1/U),n[1]=(-M*a+c*C)*U,n[2]=(x*a-c*g)*U,n[3]=k*U,n[4]=(M*i-c*S)*U,n[5]=(-x*i+c*m)*U,n[6]=V*U,n[7]=(-C*i+a*S)*U,n[8]=(g*i-a*m)*U,n):null},r.eu=2,r.ev=Wr,r.ew=Io,r.ex=Di,r.ey=function(n,e){var i=new N(3);Di(i,e);var a=1/i[0],c=1/i[1],m=1/i[2],g=e[0]*a,x=e[1]*c,S=e[2]*m,C=e[4]*a,M=e[5]*c,P=e[6]*m,k=e[8]*a,V=e[9]*c,U=e[10]*m,q=g+M+U,J=0;return q>0?(J=2*Math.sqrt(q+1),n[3]=.25*J,n[0]=(P-V)/J,n[1]=(k-S)/J,n[2]=(x-C)/J):g>M&&g>U?(J=2*Math.sqrt(1+g-M-U),n[3]=(P-V)/J,n[0]=.25*J,n[1]=(x+C)/J,n[2]=(k+S)/J):M>U?(J=2*Math.sqrt(1+M-g-U),n[3]=(k-S)/J,n[0]=(x+C)/J,n[1]=.25*J,n[2]=(P+V)/J):(J=2*Math.sqrt(1+U-g-M),n[3]=(x-C)/J,n[0]=(k+S)/J,n[1]=(P+V)/J,n[2]=.25*J),n},r.ez=function(n,e){var i=2*Math.acos(e[3]),a=Math.sin(i/2);return a>L?(n[0]=e[0]/a,n[1]=e[1]/a,n[2]=e[2]/a):(n[0]=1,n[1]=0,n[2]=0),i},r.f=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},r.f0=ba,r.f1=Vh,r.f2=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!function(i){if(ho==null){const a=i.navigator?i.navigator.userAgent:null;ho=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return ho}(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},r.f3=function(n,e){Gr=n,as=e},r.f4=e1,r.f5=HT,r.f6=function(n){const e=[0,0,0],i=xe(new Float64Array(16));return Le(i,n.pixelMatrix,n.globeMatrix),on(e,e,i),new Tt(e[0],e[1])},r.f7=function(){const n=By;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(em),By=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.f8=function(){Bx().acquire(em)},r.f9=iy,r.fA=At,r.fB=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==Gx){const i=new Uint32Array(n,0,7),[,,a,c,m,g]=i;e=i.byteLength+c+m+g+m,(a!==n.byteLength||e>=n.byteLength)&&ei("Invalid b3dm header information.")}return $g(n,e)},r.fC=function(n,e){const i=Zu(n);for(const a of i){for(const c of a.meshes)R1(c);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(VS(a.lights,e)))}return i},r.fD=xv,r.fE=Lr,r.fF=PS,r.fG=tl,r.fH=Ss,r.fI=function(n){gl(),yn!=null&&yn.then(e=>{e.keys().then(i=>{for(let a=0;a<i.length-n;a++)e.delete(i[a]).catch(c=>ei(c.message))}).catch(i=>ei(i.message))}).catch(e=>ei(e.message))},r.fa=function(n,e,i=!1){if(Nn===Ss.deferred||Nn===Ss.loading||Nn===Ss.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Hr=bs.resolveURL(n),Nn=Ss.deferred,Cn=e,Ul(),i||ny()},r.fb=function(n){Vg=bs.resolveURL(n),Ug||(Ug=new Bg(Bx(),new vn)),Ug.broadcast("setMeshoptUrl",Vg)},r.fc=FS,r.fd=function(n){Vx=bs.resolveURL(n),Ug||(Ug=new Bg(Bx(),new vn)),Ug.broadcast("setDracoUrl",Vx)},r.fe=kS,r.ff=Df,r.fg=function(n){const e=aa();if(!e)return;const i=e.delete(xu);n&&i.then(()=>n()).catch(n)},r.fh=tm,r.fi=li,r.fj=Lh,r.fk=ou,r.fl=CE,r.fm=IE,r.fn=gc,r.fo=ii,r.fp="hd_road_elevation",r.fq=Bi,r.fr=xt,r.fs=Il,r.ft=Qy,r.fu=Nf,r.fv=function(n,e,i,a,c,m,g,x=1,S,C,M){n.createArrays(),n.tilePixelRatio=Bt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const P=n.layers[0].layout,k=n.layers[0]._unevaluatedLayout._values,V={};V.scaleFactor=x,V.textSizeScaleRange=P.get("text-size-scale-range"),V.iconSizeScaleRange=P.get("icon-size-scale-range");const[U,q]=V.textSizeScaleRange,[J,ee]=V.iconSizeScaleRange;V.textScaleFactor=Y(V.scaleFactor,U,q),V.iconScaleFactor=Y(V.scaleFactor,J,ee);const oe=k["text-size"],le=k["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:Be,maxZoom:ot}=n.textSizeData;V.compositeTextSizes=[oe.possiblyEvaluate(new Ar(Be,{worldview:M}),m),oe.possiblyEvaluate(new Ar(ot,{worldview:M}),m)]}if(n.iconSizeData.kind==="composite"){const{minZoom:Be,maxZoom:ot}=n.iconSizeData;V.compositeIconSizes=[le.possiblyEvaluate(new Ar(Be,{worldview:M}),m),le.possiblyEvaluate(new Ar(ot,{worldview:M}),m)]}V.layoutTextSize=oe.possiblyEvaluate(new Ar(g+1,{worldview:M}),m),V.layoutIconSize=le.possiblyEvaluate(new Ar(g+1,{worldview:M}),m),V.textMaxSize=oe.possiblyEvaluate(new Ar(18,{worldview:M}),m);const fe=P.get("symbol-placement"),Ie=P.get("text-rotation-alignment")==="map"&&fe!=="point",Se=P.get("text-size");let Pe=!1;const ke=[];for(const Be of n.features){const ot=P.get("text-font").evaluate(Be,{},m).join(","),Ze=Se.evaluate(Be,{},m)*V.textScaleFactor,st=V.layoutTextSize.evaluate(Be,{},m)*V.textScaleFactor,dt=V.layoutIconSize.evaluate(Be,{},m)*V.iconScaleFactor,wt={horizontal:{},vertical:void 0},Rt=Be.text;let Mt,yt=[0,0];if(Rt){const fn=Rt.toString(),En=P.get("text-letter-spacing").evaluate(Be,{},m)*La,Zi=P.get("text-line-height").evaluate(Be,{},m)*La,$n=px(fn)?En:0,Jn=P.get("text-anchor").evaluate(Be,{},m),eo=P.get("text-variable-anchor");if(!eo){const ut=P.get("text-radial-offset").evaluate(Be,{},m);if(ut)yt=Y1(Jn,[ut*La,ov]);else{const qt=P.get("text-offset").evaluate(Be,{},m);yt=[qt[0]*La,qt[1]*La]}}let Ee=Ie?"center":P.get("text-justify").evaluate(Be,{},m);const be=fe==="point",at=be?P.get("text-max-width").evaluate(Be,{},m)*La:1/0,Gt=ut=>{n.allowVerticalPlacement&&Q_(fn)&&(wt.vertical=h0(Rt,e,i,c,ot,at,Zi,Jn,ut,$n,yt,ll.vertical,!0,st,Ze,S))};if(!Ie&&eo){const ut=Ee==="auto"?eo.map(wi=>sv(wi)):[Ee];let qt=!1;for(let wi=0;wi<ut.length;wi++){const vi=ut[wi];if(!wt.horizontal[vi])if(qt)wt.horizontal[vi]=wt.horizontal[0];else{const Ki=h0(Rt,e,i,c,ot,at,Zi,"center",vi,$n,yt,ll.horizontal,!1,st,Ze,S);Ki&&(wt.horizontal[vi]=Ki,qt=Ki.positionedLines.length===1)}}Gt("left")}else{if(Ee==="auto"&&(Ee=sv(Jn)),be||P.get("text-writing-mode").indexOf("horizontal")>=0||!Q_(fn)){const ut=h0(Rt,e,i,c,ot,at,Zi,Jn,Ee,$n,yt,ll.horizontal,!1,st,Ze,S);ut&&(wt.horizontal[Ee]=ut)}Gt(be?"left":Ee)}}let Dt,nt,tt,St,It,bt,vt=!1;const ci=P.get("icon-text-fit").evaluate(Be,{},m);if(Be.icon&&Be.icon.hasPrimary()){const fn=n_(Be.icon,n.iconSizeData,k["icon-size"],m,n.zoom,Be,S,V.iconScaleFactor,M);Dt=fn.iconPrimary,tt=fn.iconSecondary;const En=Dt.toString();if(nt=a.get(En),nt&&(It=P.get("icon-offset").evaluate(Be,{},m),bt=P.get("icon-anchor").evaluate(Be,{},m),Mt=Ky(c.get(En),tt?c.get(tt.toString()):void 0,It,bt),vt=nt.sdf,n.sdfIcons===void 0?n.sdfIcons=nt.sdf:n.sdfIcons!==nt.sdf&&ei("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(nt.pixelRatio!==n.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),tt){const Zi=tt.toString();St=a.get(Zi)}}Pe=Pe||!(!Be.icon||!Be.icon.hasSecondary());const Yt=cl(wt.horizontal)||wt.vertical;n.iconsInText||(n.iconsInText=!!Yt&&Yt.iconsInText);const Wt=st*V.textScaleFactor/La,{defaultShapedIcon:ji,verticallyShapedIcon:Kt}=VC(n,Mt,P,Be,m,wt,Wt,It,ci);ci!=="none"&&Mt&&(y0(Mt)||v0(Mt))&&(E0(0,nt,Dt,Mt,ji,ci,C,a,c),E0(0,St,tt,Mt,ji,ci,C,a,c),Kt&&(E0(0,nt,Dt,Mt,Kt,ci,C,a,c),E0(0,St,tt,Mt,Kt,ci,C,a,c))),Mt=ji;const{iconBBox:Ai,iconVerticalBBox:qi}=K1(n,Mt,Kt,P,Be,m,dt,It,V,c,bt);ke.push({feature:Be,shapedTextOrientations:wt,shapedText:Yt,shapedIcon:Mt,iconPrimary:Dt,iconSecondary:tt,iconOffset:It,iconAnchor:bt,verticallyShapedIcon:Kt,layoutTextSize:st,layoutIconSize:dt,textOffset:yt,isSDFIcon:vt,iconTextFit:ci,iconCollisionBounds:Ai,iconVerticalCollisionBounds:qi})}return{featureData:ke,sizes:V,hasAnySecondaryIcon:Pe,textAlongLine:Ie,symbolPlacement:fe}},r.fw=ev,r.fx=function(n,e,i,a,c,m,g,x,S,C){n.iconAtlasPositions=C.iconPositions;const{featureData:M,hasAnySecondaryIcon:P,sizes:k,textAlongLine:V,symbolPlacement:U}=e;for(const q of M){const{shapedIcon:J,verticallyShapedIcon:ee,feature:oe,shapedTextOrientations:le,shapedText:fe,layoutTextSize:Ie,textOffset:Se,isSDFIcon:Pe,iconPrimary:ke,iconSecondary:Be,iconTextFit:ot,iconOffset:Ze,iconCollisionBounds:st,iconVerticalCollisionBounds:dt}=q;au(J,C.iconPositions,ke,Be),au(ee,C.iconPositions,ke,Be),Q1(le,C.iconPositions),av(ke,Be,C.iconPositions),(fe||J)&&jf(n,oe,le,J,ee,S,k,Ie,0,Se,Pe,a,c,g,x,P,ot,Ze,V,U,st,dt)}i&&n.generateCollisionDebugBuffers(m,n.collisionBoxArray,k.textScaleFactor)},r.fy=mi,r.fz=Q0,r.g=function(n,e){return wu(Object.assign(n,{method:"GET"}),e)},r.h=function(n){return n.indexOf("mapbox:")===0},r.i=function(n){return Sr.API_STYLE_REGEX.test(n)&&!oa(n)},r.j=fo,r.k=$d,r.l=function(n){return decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.m=function(n,e){return wu(Object.assign(n,{type:"json"}),e)},r.n=sc,r.o=bs,r.p=function(n,e){return wu(Object.assign(n,{method:"POST"}),e)},r.q=Xa,r.r=Ka,r.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=function(){return T1||(T1=new tm),T1},r.u=function(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()},r.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},r.w=ei,r.x=Sv,r.y=Ut,r.z=Je}),E(["./shared"],function(r){function L(ie){const W=ie?ie.url.toString():void 0;return W?performance.getEntriesByName(W):[]}function N(ie){if(typeof ie=="number"||typeof ie=="boolean"||typeof ie=="string"||ie==null)return JSON.stringify(ie);if(Array.isArray(ie)){let Y="[";for(const ue of ie)Y+=`${N(ue)},`;return`${Y}]`}let W="{";for(const Y of Object.keys(ie).sort())W+=`${Y}:${N(ie[Y])},`;return`${W}}`}function H(ie){let W="";for(const Y of r.bw)W+=`/${N(ie[Y])}`;return W}class X{constructor(W){this.keyCache={},this._layers={},this._layerConfigs={},W&&this.replace(W)}replace(W,Y){this._layerConfigs={},this._layers={},this.update(W,[],Y)}update(W,Y,ue){this._options=ue;for(const ye of W)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=r.dt(ye,this.scope,null,this._options)).compileFilter(ue),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(const ye of Y)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const we=function(ye,Me){const je={};for(let We=0;We<ye.length;We++){const xt=ye[We];let ht=Me&&Me[xt.id];ht||(xt.type==="symbol"?ht=xt.id:(ht=H(xt),xt.type==="line"&&xt.paint&&function Ri(xi){return typeof xi=="string"&&xi==="line-progress"||(Array.isArray(xi)?xi.some(Ri):!(!xi||typeof xi!="object")&&Object.values(xi).some(Ri))}(xt.paint["line-width"])&&(ht+=`/${N(xt.paint["line-width"])}`))),Me&&(Me[xt.id]=ht);let ti=je[ht];ti||(ti=je[ht]=[]),ti.push(xt)}const ze=[];for(const We in je)ze.push(je[We]);return ze}(Object.values(this._layerConfigs),this.keyCache);for(const ye of we){const Me=ye.map(ti=>this._layers[ti.id]),je=Me[0];if(je.visibility==="none")continue;const ze=je.source||"";let We=this.familiesBySource[ze];We||(We=this.familiesBySource[ze]={});const xt=je.sourceLayer||"_geojsonTileLayer";let ht=We[xt];ht||(ht=We[xt]=[]),ht.push(Me)}}}const re=1*r.fk;class he{constructor(W){const Y={},ue=[];for(const je in W){const ze=W[je],We=Y[je]={};for(const xt in ze.glyphs){const ht=ze.glyphs[+xt];if(!ht||ht.bitmap.width===0||ht.bitmap.height===0)continue;const ti=ht.metrics.localGlyph?re:1,Ri={x:0,y:0,w:ht.bitmap.width+2*ti,h:ht.bitmap.height+2*ti};ue.push(Ri),We[xt]=Ri}}const{w:we,h:ye}=r.G(ue),Me=new r.fj({width:we||1,height:ye||1});for(const je in W){const ze=W[je];for(const We in ze.glyphs){const xt=ze.glyphs[+We];if(!xt||xt.bitmap.width===0||xt.bitmap.height===0)continue;const ht=Y[je][We],ti=xt.metrics.localGlyph?re:1;r.fj.copy(xt.bitmap,Me,{x:0,y:0},{x:ht.x+ti,y:ht.y+ti},xt.bitmap)}}this.image=Me,this.positions=Y}}function de(ie,W,Y){ie[W]?Y&&(ie[W].center=Y):ie[W]={floorIds:new Set,center:Y||[0,0],floors:{}}}function ve(ie,W,Y,ue){for(const we of W)de(ie,we),ie[we].floors[Y]=ue,ie[we].floorIds.add(Y)}function xe(ie){return{id:ie.properties.id.toString(),center:ie.properties.center.toString().split(";").map(Number)}}function $e(ie){return{id:ie.properties.id.toString(),isDefault:!!ie.properties.is_default&&ie.properties.is_default,connections:ie.properties.connected_floor_ids?new Set(ie.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:ie.properties.conflicted_floor_ids?new Set(ie.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:ie.properties.building_ids?new Set(ie.properties.building_ids.toString().split(";")):new Set,name:ie.properties.name.toString(),zIndex:ie.properties.z_index}}function Le(ie,W){return W.every(Y=>ie.properties&&ie.properties[Y]!=null)}function Ke(ie){return Le(ie,["type","id","name"])&&ie.properties.type==="building"}function Ge(ie){return Le(ie,["type","id","name","z_index"])&&ie.properties.type==="floor"}r.fi(he,"GlyphAtlas");class Ye{constructor(W){this.tileID=new r.aP(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.tileZoom=W.tileZoom,this.uid=W.uid,this.zoom=W.zoom,this.lut=W.lut,this.canonical=W.tileID.canonical,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.scope=W.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.request&&W.request.collectResourceTiming,this.promoteId=W.promoteId,this.isSymbolTile=W.isSymbolTile,this.tileTransform=r.aY(W.tileID.canonical,W.projection),this.projection=W.projection,this.worldview=W.worldview,this.localizableLayerIds=W.localizableLayerIds,this.brightness=W.brightness,this.extraShadowCaster=!!W.extraShadowCaster,this.tessellationStep=W.tessellationStep,this.scaleFactor=W.scaleFactor,this.worldview=W.worldview,this.indoor=W.indoor}parse(W,Y,ue,we,ye,Me){this.status="parsing",this.data=W,this.collisionBoxArray=new r.b2;const je=new r.fl(Object.keys(W.layers).sort()),ze=new r.fm(this.tileID,this.promoteId);ze.bucketLayerIDs=[];const We={},xt=new r.fn(256,256),ht={featureIndex:ze,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:xt,availableImages:ue,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const ei=this.indoor.indoorState.activeFloorsVisible,Yi=function(un,hr,Lr){const Ro=function(nr,Sn){if(!nr)return r.w("No source layers defined in indoor specification"),Sn;if(nr.size===0)return Sn;const Rr=nr.difference(Sn);for(const Zr of Rr)r.w(`Missing source layer required in indoor specification: ${Zr}`);return Sn.intersection(Sn)}(hr.sourceLayers,new Set(Object.keys(un.layers))),ho=hr.indoorState,to=function(nr,Sn,Rr,Zr){const sr=new Set,Sr=new Set,fo=new Set,oa=new Map,Ha={},Fl=ko=>{const os=oa.get(ko)||new Set;for(const Pa of sr)if((oa.get(Pa)||new Set).has(ko)||os.has(Pa))return!0;return!1};for(const ko of Sn){const os=nr.layers[ko];if(os)for(let Pa=0;Pa<os.length;Pa++){const Js=os.feature(Pa);if(Ke(Js)){const{id:Ka,center:bs}=xe(Js);de(Ha,Ka,bs),sr.add(Ka)}else if(Ge(Js)){const{id:Ka,isDefault:bs,connections:Ic,conflicts:ch,buildings:xu,name:Gr,zIndex:as}=$e(Js);ve(Ha,xu,Ka,{name:Gr,zIndex:as}),oa.set(Ka,ch),(Ka===Zr||Ic.has(Zr))&&sr.add(Ka),Sr.add(Ka),bs&&fo.add(Ka)}}else r.w(`indoor source layer not found: ${ko}`)}if(Rr)for(const ko of Rr)Sr.has(ko)&&(Fl(ko)||sr.add(ko));for(const ko of fo)sr.has(ko)||Fl(ko)||sr.add(ko);return{buildings:Ha,activeFloors:sr}}(un,Ro,ho.lastActiveFloors,ho.selectedFloorId);return Lr.send("setIndoorData",to),to}(W,this.indoor,ye);ht.activeFloors=ei?Yi.activeFloors:void 0}const ti=[],Ri=Y.familiesBySource[this.source];for(const ei in Ri){const Yi=W.layers[ei];if(!Yi)continue;let un=!1,hr=!1,Lr=!1;for(const nr of Ri[ei])nr[0].type==="symbol"?un=!0:hr=!0,nr[0].is3D()&&nr[0].type!=="model"&&(Lr=!0);if(this.extraShadowCaster&&!Lr||this.isSymbolTile===!0&&!un||this.isSymbolTile===!1&&!hr)continue;Yi.version===1&&r.w(`Vector tile source "${this.source}" layer "${ei}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ro=je.encode(ei),ho=[];let to=!1;for(let nr=0,Sn=0;nr<Yi.length;nr++){const Rr=Yi.feature(nr),Zr=ze.getId(Rr,ei);if(this.localizableLayerIds&&this.localizableLayerIds.has(ei)){const sr=Rr.properties?Rr.properties.worldview:null;if(this.worldview&&typeof sr=="string")if(sr==="all")Rr.properties.$localized=!0;else{if(!sr.split(",").includes(this.worldview))continue;Rr.properties.$localized=!0,Rr.properties.worldview=this.worldview}}!to&&Rr.properties&&Rr.properties.hasOwnProperty(r.fo)&&(to=!0),ho.push({feature:Rr,id:Zr,index:Sn,sourceLayerIndex:Ro}),Sn++}to&&!ht.elevationFeatures&&W.layers.hasOwnProperty(r.fp)&&(ht.elevationFeatures=r.fq.parseFrom(W.layers[r.fp],this.canonical));for(const nr of Ri[ei]){const Sn=nr[0];if(this.extraShadowCaster&&(!Sn.is3D()||Sn.type==="model")||this.isSymbolTile!==void 0&&Sn.type==="symbol"!==this.isSymbolTile||Sn.minzoom&&this.zoom<Math.floor(Sn.minzoom)||Sn.maxzoom&&this.zoom>=Sn.maxzoom||Sn.visibility==="none")continue;mt(nr,this.zoom,ht.brightness,ue,this.worldview);const Rr=We[Sn.id]=Sn.createBucket({index:ze.bucketLayerIDs.length,layers:nr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ro,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:we,worldview:this.worldview});ze.bucketLayerIDs.push(nr.map(sr=>r.B(sr.id,sr.scope)));let Zr=Rr.prepare?Rr.prepare():null;Zr!=null?(Zr=Zr.then(()=>Rr.populate(ho,ht,this.tileID.canonical,this.tileTransform)),ti.push(Zr)):Rr.populate(ho,ht,this.tileID.canonical,this.tileTransform)}}const xi=()=>{let ei,Yi,un,hr,Lr,Ro;xt.trim();const ho={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},to=()=>{if(ei)return this.status="done",Me(ei);if(this.extraShadowCaster)this.status="done",Me(null,{buckets:Object.values(We).filter(Sn=>!Sn.isEmpty()),featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ht.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Yi&&un&&hr){const Sn=new he(Yi),Rr=new Map;for(const[Sr,fo]of un.entries()){const{imagePosition:oa}=r.ft(Sr,fo,r.fu);Rr.set(Sr,oa)}const Zr={};for(const Sr in We){const fo=We[Sr];fo instanceof r.b3&&(mt(fo.layers,this.zoom,ht.brightness,ue,this.worldview),Zr[Sr]=r.fv(fo,Yi,Sn.positions,un,Rr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Lr,this.worldview))}const sr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ye,un,Lr,()=>{sr.iconsPending=!1,nr(Zr,Sn,sr)}),this.rasterizeIfNeeded(ye,hr,Ro,()=>{sr.patternsPending=!1,nr(Zr,Sn,sr)})}},nr=(Sn,Rr,Zr,sr)=>{if(Zr.iconsPending||Zr.patternsPending)return;const Sr=new r.fw(un,hr,this.lut);for(const fo in We){const oa=We[fo];if(fo in Sn)r.fx(oa,Sn[fo],this.showCollisionBoxes,ue,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,un,Sr);else if(oa.hasPattern&&(oa instanceof r.b9||oa instanceof r.ba||oa instanceof r.e9)){mt(oa.layers,this.zoom,ht.brightness,ue,this.worldview);const Ha=Object.fromEntries(Sr.patternPositions);oa.addFeatures(ht,this.tileID.canonical,Ha,ue,this.tileTransform,this.brightness)}}this.status="done",Me(null,{buckets:Object.values(We).filter(fo=>!fo.isEmpty()),featureIndex:ze,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Rr.image,lineAtlas:xt,imageAtlas:Sr,brightness:ht.brightness})};if(!this.extraShadowCaster){const Sn=r.fr(ht.glyphDependencies,sr=>Object.keys(sr).map(Number));Object.keys(Sn).length?ye.send("getGlyphs",{uid:this.uid,stacks:Sn},(sr,Sr)=>{ei||(ei=sr,Yi=Sr,to())},void 0,!1,ho):Yi={};const Rr=Array.from(ht.iconDependencies.keys()).map(sr=>r.I.parse(sr));Rr.length?ye.send("getImages",{images:Rr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(sr,Sr)=>{ei||(ei=sr,un=new Map,Lr=this.updateImageMapAndGetImageTaskQueue(un,Sr,ht.iconDependencies),to())},void 0,!1,ho):(un=new Map,Lr=new Map);const Zr=Array.from(ht.patternDependencies.keys()).map(sr=>r.I.parse(sr));Zr.length?ye.send("getImages",{images:Zr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(sr,Sr)=>{ei||(ei=sr,hr=new Map,Ro=this.updateImageMapAndGetImageTaskQueue(hr,Sr,ht.patternDependencies),to())},void 0,!1,ho):(hr=new Map,Ro=new Map)}if(ht.elevationFeatures&&ht.elevationFeatures.length>0){const Sn=[];for(const Zr of Object.values(We))if(Zr instanceof r.ba){const sr=Zr.getUnevaluatedPortalGraph();sr&&Sn.push(sr)}const Rr=r.fs.evaluate(Sn);for(const Zr of Object.values(We))if(Zr instanceof r.ba){const sr=W.layers[je.decode(Zr.sourceLayerIndex)];Zr.setEvaluatedPortalGraph(Rr,sr,this.tileID.canonical,ht.availableImages,ht.brightness)}}to()};ti.length>0?Promise.allSettled(ti).then(xi).catch(Me):xi()}updateParameters(W){this.scaleFactor=W.scaleFactor,this.showCollisionBoxes=W.showCollisionBoxes,this.projection=W.projection,this.brightness=W.brightness,this.tileTransform=r.aY(W.tileID.canonical,W.projection),this.extraShadowCaster=W.extraShadowCaster,this.lut=W.lut,this.worldview=W.worldview,this.indoor=W.indoor}rasterizeIfNeeded(W,Y,ue,we){Array.from(Y.values()).some(ye=>ye.usvg)?this.rasterize(W,Y,ue,we):we()}updateImageMapAndGetImageTaskQueue(W,Y,ue){const we=new Map;for(const ye of Y.keys()){const Me=ue.get(ye)||[];for(const je of Me){const ze=je.toString(),We=Y.get(je.id.toString());We.usvg?we.has(ze)||(we.set(ze,je),W.set(ze,Object.assign({},We))):W.set(ze,We)}}return we}rasterize(W,Y,ue,we){this.rasterizeTask=W.send("rasterizeImages",{scope:this.scope,tasks:ue},(ye,Me)=>{if(!ye)for(const[je,ze]of Me.entries()){const We=Object.assign(Y.get(je),{data:ze});Y.set(je,We)}we()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function mt(ie,W,Y,ue,we){const ye=new r.ac(W,{brightness:Y,worldview:we});for(const Me of ie)Me.recalculate(ye,ue)}class Ct extends r.E{constructor(W,Y,ue,we,ye,Me,je){super(),this.actor=W,this.layerIndex=Y,this.availableImages=ue,this.availableModels=we,this.loadVectorData=Me||r.aL,this.loading={},this.loaded={},this.deduped=new r.aK(W.scheduler),this.isSpriteLoaded=ye,this.scheduler=W.scheduler,this.brightness=je}loadTile(W,Y){const ue=W.uid,we=W&&W.request,ye=we&&we.collectResourceTiming,Me=this.loading[ue]=new Ye(W);Me.abort=this.loadVectorData(W,(je,ze)=>{const We=!this.loading[ue];if(delete this.loading[ue],Me.cancelRasterize(),We||je||!ze)return Me.status="done",We||(this.loaded[ue]=Me),Y(je);const xt=ze.rawData,ht={},ti=r.aM(ze.responseHeaders);ti&&ti.expires&&(ht.expires=ti.expires),ti&&ti.cacheControl&&(ht.cacheControl=ti.cacheControl),Me.vectorTile=ze.vectorTile||new r.fy(new r.bs(xt));const Ri=()=>{Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(xi,ei)=>{if(xi||!ei)return Y(xi);const Yi={};if(ye){const un=L(we);un.length>0&&(Yi.resourceTiming=JSON.parse(JSON.stringify(un)))}Y(null,Object.assign({rawTileData:xt.slice(0),responseHeaders:ze.responseHeaders},ei,ht,Yi))})};this.isSpriteLoaded?Ri():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Ri,{type:"parseTile",isSymbolTile:W.isSymbolTile,zoom:W.tileZoom}):Ri()}),this.loaded=this.loaded||{},this.loaded[ue]=Me})}reloadTile(W,Y){const ue=this.loaded,we=W.uid;if(ue&&ue[we]){const ye=ue[we];ye.updateParameters(W);const Me=(je,ze)=>{const We=ye.reloadCallback;We&&(delete ye.reloadCallback,ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,We)),Y(je,ze)};ye.status==="parsing"?ye.reloadCallback=Me:ye.status==="done"&&(ye.vectorTile?ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Me):Me())}else Y(null,void 0)}abortTile(W,Y){const ue=W.uid,we=this.loading[ue];we&&(we.abort&&we.abort(),delete this.loading[ue]),Y()}removeTile(W,Y){const ue=this.loaded,we=W.uid;ue&&ue[we]&&delete ue[we],Y()}}class Vt{loadTile(W,Y){const{uid:ue,encoding:we,rawImageData:ye,padding:Me}=W,je=ImageBitmap&&ye instanceof ImageBitmap?this.getImageData(ye,Me):ye;Y(null,new r.fz(ue,je,we,Me<1))}reloadTile(W,Y){Y(null,null)}abortTile(W,Y){Y()}removeTile(W,Y){Y()}getImageData(W,Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);const ue=this.offscreenCanvasContext.getImageData(-Y,-Y,W.width+2*Y,W.height+2*Y);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ue}}r.br.setPbf(r.bs);class ui{constructor(W){this._mrt=new r.br(W.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=W.uid,this.tileID=W.tileID,this.source=W.source}parse(W,Y){const ue=this._mrt;this.status="parsing",this._entireBuffer=W;try{ue.parseHeader(W),this._isHeaderLoaded=!0;const we=[];for(const ye in ue.layers){const Me=ue.getLayer(ye),je=Me.getDataRange(Me.getBandList()),ze=ue.createDecodingTask(je),We=W.slice(je.firstByte,je.lastByte+1),xt=r.br.performDecoding(We,ze).then(ht=>ze.complete(null,ht)).catch(ht=>ze.complete(ht,null));we.push(xt)}Promise.allSettled(we).then(()=>Y(null,ue)).catch(ye=>Y(ye))}catch(we){Y(we)}}}class Di{constructor(W){this.actor=W,this.loading={},this.loaded={}}loadTile(W,Y){const ue=W.uid,we=W.request,ye=this.loading[ue]=new ui(W),{cancel:Me}=r.bt(we,(je,ze,We)=>{const xt=!this.loading[ue];if(delete this.loading[ue],xt||je||!ze)return ye.status="done",xt||(this.loaded[ue]=ye),Y(je);ye.parse(ze,(ht,ti)=>{if(ht||!ti)return Y(ht);Y(null,ti,We)}),this.loaded[ue]=ye});ye.abort=Me}reloadTile(W,Y){Y(null,void 0)}abortTile(W,Y){const ue=W.uid,we=this.loading[ue];we&&(we.abort&&we.abort(),delete this.loading[ue]),Y()}removeTile(W,Y){const ue=W.uid;this.loaded[ue]&&delete this.loaded[ue],Y()}decodeRasterArray(W,Y){r.br.performDecoding(W.buffer,W.task).then(ue=>Y(null,ue)).catch(ue=>Y(ue))}}const si=r.fA.prototype.toGeoJSON;class di{constructor(W){this._feature=W,this.extent=r.al,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))}loadGeometry(){if(this._feature.type===1){const W=[];for(const Y of this._feature.geometry)W.push([new r.P(Y[0],Y[1])]);return W}{const W=[];for(const Y of this._feature.geometry){const ue=[];for(const we of Y)ue.push(new r.P(we[0],we[1]));W.push(ue)}return W}}toGeoJSON(W,Y,ue){return si.call(this,W,Y,ue)}}class Nt{constructor(W,Y){this.name=W,this.extent=r.al,this.length=Y.length,this._jsonFeatures=Y}feature(W){return new di(this._jsonFeatures[W])}}class Ii{constructor(W){this.layers={},this.extent=r.al;for(const Y of Object.keys(W))this.layers[Y]=new Nt(Y,W[Y])}}const Qt=64/4096,_t=128;class Et{constructor(){this.features=new Map}clear(){this.features.clear()}load(W=[],Y){for(const ue of W){const we=ue.id;if(we==null)continue;let ye=this.features.get(we);ye&&this.updateCache(ye,Y),ue.geometry?(ye=rn(ue),this.updateCache(ye,Y),this.features.set(we,ye)):this.features.delete(we),this.updateCache(ye,Y)}}updateCache(W,Y){for(const{canonical:ue,uid:we}of Object.values(Y)){const{z:ye,x:Me,y:je}=ue;fi(W,Math.pow(2,ye),Me,je)&&delete Y[we]}}getTile(W,Y,ue){const we=Math.pow(2,W),ye=[];for(const Me of this.features.values())fi(Me,we,Y,ue)&&ye.push(pn(Me,we,Y,ue));return{features:ye}}getFeatures(){return[...this.features.values()]}}function fi({minX:ie,minY:W,maxX:Y,maxY:ue},we,ye,Me){return ie<(ye+1+Qt)/we&&W<(Me+1+Qt)/we&&Y>(ye-Qt)/we&&ue>(Me-Qt)/we}function rn(ie){const{id:W,geometry:Y,properties:ue}=ie;if(!Y)return;if(Y.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:we,coordinates:ye}=Y,Me={id:W,type:1,geometry:[],tags:ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},je=Me.geometry;if(we==="Point")zn(ye,je,Me);else if(we==="MultiPoint")for(const ze of ye)zn(ze,je,Me);else if(we==="LineString")Me.type=2,er(ye,je,Me);else if(we==="MultiLineString")Me.type=2,Mn(ye,je,Me);else if(we==="Polygon")Me.type=3,Mn(ye,je,Me,!0);else{if(we!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Me.type=3;for(const ze of ye)Mn(ze,je,Me,!0)}return Me}function zn([ie,W],Y,ue){const we=r.aF(ie);let ye=r.aJ(W);ye=ye<0?0:ye>1?1:ye,Y.push(we,ye),ue.minX=Math.min(ue.minX,we),ue.minY=Math.min(ue.minY,ye),ue.maxX=Math.max(ue.maxX,we),ue.maxY=Math.max(ue.maxY,ye)}function er(ie,W,Y,ue=!1,we=!1){const ye=[];for(const Me of ie)zn(Me,ye,Y);W.push(ye),ue&&function(Me,je){let ze=0;for(let We=0,xt=Me.length,ht=xt-2;We<xt;ht=We,We+=2)ze+=(Me[We]-Me[ht])*(Me[We+1]+Me[ht+1]);if(ze>0===je)for(let We=0,xt=Me.length;We<xt/2;We+=2){const ht=Me[We],ti=Me[We+1];Me[We]=Me[xt-2-We],Me[We+1]=Me[xt-1-We],Me[xt-2-We]=ht,Me[xt-1-We]=ti}}(ye,we)}function Mn(ie,W,Y,ue=!1){for(let we=0;we<ie.length;we++)er(ie[we],W,Y,ue,we===0)}function pn(ie,W,Y,ue){const{id:we,type:ye,geometry:Me,tags:je}=ie,ze=[];if(ye===1)(function(We,xt,ht,ti,Ri){for(let xi=0;xi<We.length;xi+=2){const ei=Math.round(r.al*(We[xi+0]*xt-ht)),Yi=Math.round(r.al*(We[xi+1]*xt-ti));Ri.push([ei,Yi])}})(Me,W,Y,ue,ze);else for(const We of Me)pr(We,W,Y,ue,ze);return{id:we,type:ye,geometry:ze,tags:je}}function pr(ie,W,Y,ue,we){const ye=-_t,Me=r.al+_t;let je;for(let ze=0;ze<ie.length-2;ze+=2){let We=Math.round(r.al*(ie[ze+0]*W-Y)),xt=Math.round(r.al*(ie[ze+1]*W-ue)),ht=Math.round(r.al*(ie[ze+2]*W-Y)),ti=Math.round(r.al*(ie[ze+3]*W-ue));const Ri=ht-We,xi=ti-xt;We<ye&&ht<ye||(We<ye?(xt+=Math.round(xi*((ye-We)/Ri)),We=ye):ht<ye&&(ti=xt+Math.round(xi*((ye-We)/Ri)),ht=ye),xt<ye&&ti<ye||(xt<ye?(We+=Math.round(Ri*((ye-xt)/xi)),xt=ye):ti<ye&&(ht=We+Math.round(Ri*((ye-xt)/xi)),ti=ye),We>=Me&&ht>=Me||(We>=Me?(xt+=Math.round(xi*((Me-We)/Ri)),We=Me):ht>=Me&&(ti=xt+Math.round(xi*((Me-We)/Ri)),ht=Me),xt>=Me&&ti>=Me||(xt>=Me?(We+=Math.round(Ri*((Me-xt)/xi)),xt=Me):ti>=Me&&(ht=We+Math.round(Ri*((Me-xt)/xi)),ti=Me),je&&We===je[je.length-1][0]&&xt===je[je.length-1][1]||(je=[[We,xt]],we.push(je)),je.push([ht,ti])))))}}function Vr({name:ie,features:W},Y){Y.writeStringField(1,ie),Y.writeVarintField(5,r.al);const ue=new Map,we=new Map,ye={keys:ue,values:we,feature:null};for(const Me of W)ye.feature=Me,Y.writeMessage(2,Or,ye);for(const Me of ue.keys())Y.writeStringField(3,Me);for(const Me of we.keys())Y.writeMessage(4,Xi,Me)}function Or(ie,W){const Y=ie.feature;Y.id!==void 0&&Number.isSafeInteger(+Y.id)&&W.writeVarintField(1,+Y.id),Y.tags&&W.writeMessage(2,kr,ie),W.writeVarintField(3,Y.type),W.writeMessage(4,Ei,Y)}function kr({keys:ie,values:W,feature:Y},ue){for(const we of Object.keys(Y.tags)){let ye=Y.tags[we];if(ye===null)continue;let Me=ie.get(we);Me===void 0&&(Me=ie.size,ie.set(we,Me)),ue.writeVarint(Me);const je=typeof ye;je!=="string"&&je!=="boolean"&&je!=="number"&&(ye=JSON.stringify(ye));let ze=W.get(ye);ze===void 0&&(ze=W.size,W.set(ye,ze)),ue.writeVarint(ze)}}function Wr(ie,W){return(W<<3)+(7&ie)}function mn(ie){return ie<<1^ie>>31}function Ei(ie,W){const{geometry:Y,type:ue}=ie;let we=0,ye=0;if(ue===1){W.writeVarint(Wr(1,Y.length));for(const Me of Y){const je=Me[0]-we,ze=Me[1]-ye;W.writeVarint(mn(je)),W.writeVarint(mn(ze)),we+=je,ye+=ze}}else for(const Me of Y){W.writeVarint(Wr(1,1));const je=Me.length-(ue===3?1:0);for(let ze=0;ze<je;ze++){ze===1&&W.writeVarint(Wr(2,je-1));const We=Me[ze][0]-we,xt=Me[ze][1]-ye;W.writeVarint(mn(We)),W.writeVarint(mn(xt)),we+=We,ye+=xt}ue===3&&W.writeVarint(Wr(7,1))}}function Xi(ie,W){const Y=typeof ie;Y==="string"?W.writeStringField(1,ie):Y==="boolean"?W.writeBooleanField(7,ie):Y==="number"&&(ie%1!=0?W.writeDoubleField(3,ie):ie<0?W.writeSVarintField(6,ie):W.writeVarintField(5,ie))}const Rn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},on=Math.fround||(Ur=new Float32Array(1),ie=>(Ur[0]=+ie,Ur[0]));var Ur;const gr=3,tr=5,co=6;class Fr{constructor(W){this.options=Object.assign(Object.create(Rn),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:Y,minZoom:ue,maxZoom:we}=this.options;Y&&console.time("total time");const ye=`prepare ${W.length} points`;Y&&console.time(ye),this.points=W;const Me=[];for(let ze=0;ze<W.length;ze++){const We=W[ze];if(!We.geometry)continue;const[xt,ht]=We.geometry.coordinates,ti=on(_o(xt)),Ri=on(Oo(ht));Me.push(ti,Ri,1/0,ze,-1,1),this.options.reduce&&Me.push(0)}let je=this.trees[we+1]=this._createTree(Me);Y&&console.timeEnd(ye);for(let ze=we;ze>=ue;ze--){const We=+Date.now();je=this.trees[ze]=this._createTree(this._cluster(je,ze)),Y&&console.log("z%d: %d clusters in %dms",ze,je.numItems,+Date.now()-We)}return Y&&console.timeEnd("total time"),this}getClusters(W,Y){let ue=((W[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,W[1]));let ye=W[2]===180?180:((W[2]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)ue=-180,ye=180;else if(ue>ye){const ht=this.getClusters([ue,we,180,Me],Y),ti=this.getClusters([-180,we,ye,Me],Y);return ht.concat(ti)}const je=this.trees[this._limitZoom(Y)],ze=je.range(_o(ue),Oo(Me),_o(ye),Oo(we)),We=je.data,xt=[];for(const ht of ze){const ti=this.stride*ht;xt.push(We[ti+tr]>1?Da(We,ti,this.clusterProps):this.points[We[ti+gr]])}return xt}getChildren(W){const Y=this._getOriginId(W),ue=this._getOriginZoom(W),we="No cluster with the specified id.",ye=this.trees[ue];if(!ye)throw new Error(we);const Me=ye.data;if(Y*this.stride>=Me.length)throw new Error(we);const je=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),ze=ye.within(Me[Y*this.stride],Me[Y*this.stride+1],je),We=[];for(const xt of ze){const ht=xt*this.stride;Me[ht+4]===W&&We.push(Me[ht+tr]>1?Da(Me,ht,this.clusterProps):this.points[Me[ht+gr]])}if(We.length===0)throw new Error(we);return We}getLeaves(W,Y,ue){const we=[];return this._appendLeaves(we,W,Y=Y||10,ue=ue||0,0),we}getTile(W,Y,ue){const we=this.trees[this._limitZoom(W)],ye=Math.pow(2,W),{extent:Me,radius:je}=this.options,ze=je/Me,We=(ue-ze)/ye,xt=(ue+1+ze)/ye,ht={features:[]};return this._addTileFeatures(we.range((Y-ze)/ye,We,(Y+1+ze)/ye,xt),we.data,Y,ue,ye,ht),Y===0&&this._addTileFeatures(we.range(1-ze/ye,We,1,xt),we.data,ye,ue,ye,ht),Y===ye-1&&this._addTileFeatures(we.range(0,We,ze/ye,xt),we.data,-1,ue,ye,ht),ht.features.length?ht:null}getClusterExpansionZoom(W){let Y=this._getOriginZoom(W)-1;for(;Y<=this.options.maxZoom;){const ue=this.getChildren(W);if(Y++,ue.length!==1)break;W=ue[0].properties.cluster_id}return Y}_appendLeaves(W,Y,ue,we,ye){const Me=this.getChildren(Y);for(const je of Me){const ze=je.properties;if(ze&&ze.cluster?ye+ze.point_count<=we?ye+=ze.point_count:ye=this._appendLeaves(W,ze.cluster_id,ue,we,ye):ye<we?ye++:W.push(je),W.length===ue)break}return ye}_createTree(W){const Y=new r.c3(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ue=0;ue<W.length;ue+=this.stride)Y.add(W[ue],W[ue+1]);return Y.finish(),Y.data=W,Y}_addTileFeatures(W,Y,ue,we,ye,Me){for(const je of W){const ze=je*this.stride,We=Y[ze+tr]>1;let xt,ht,ti;if(We)xt=ma(Y,ze,this.clusterProps),ht=Y[ze],ti=Y[ze+1];else{const ei=this.points[Y[ze+gr]];xt=ei.properties;const[Yi,un]=ei.geometry.coordinates;ht=_o(Yi),ti=Oo(un)}const Ri={type:1,geometry:[[Math.round(this.options.extent*(ht*ye-ue)),Math.round(this.options.extent*(ti*ye-we))]],tags:xt};let xi;xi=We||this.options.generateId?Y[ze+gr]:this.points[Y[ze+gr]].id,xi!==void 0&&(Ri.id=xi),Me.features.push(Ri)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,Y){const{radius:ue,extent:we,reduce:ye,minPoints:Me}=this.options,je=ue/(we*Math.pow(2,Y)),ze=W.data,We=[],xt=this.stride;for(let ht=0;ht<ze.length;ht+=xt){if(ze[ht+2]<=Y)continue;ze[ht+2]=Y;const ti=ze[ht],Ri=ze[ht+1],xi=W.within(ze[ht],ze[ht+1],je),ei=ze[ht+tr];let Yi=ei;for(const un of xi){const hr=un*xt;ze[hr+2]>Y&&(Yi+=ze[hr+tr])}if(Yi>ei&&Yi>=Me){let un,hr=ti*ei,Lr=Ri*ei,Ro=-1;const ho=(ht/xt<<5)+(Y+1)+this.points.length;for(const to of xi){const nr=to*xt;if(ze[nr+2]<=Y)continue;ze[nr+2]=Y;const Sn=ze[nr+tr];hr+=ze[nr]*Sn,Lr+=ze[nr+1]*Sn,ze[nr+4]=ho,ye&&(un||(un=this._map(ze,ht,!0),Ro=this.clusterProps.length,this.clusterProps.push(un)),ye(un,this._map(ze,nr)))}ze[ht+4]=ho,We.push(hr/Yi,Lr/Yi,1/0,ho,-1,Yi),ye&&We.push(Ro)}else{for(let un=0;un<xt;un++)We.push(ze[ht+un]);if(Yi>1)for(const un of xi){const hr=un*xt;if(!(ze[hr+2]<=Y)){ze[hr+2]=Y;for(let Lr=0;Lr<xt;Lr++)We.push(ze[hr+Lr])}}}}return We}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,Y,ue){if(W[Y+tr]>1){const Me=this.clusterProps[W[Y+co]];return ue?Object.assign({},Me):Me}const we=this.points[W[Y+gr]].properties,ye=this.options.map(we);return ue&&ye===we?Object.assign({},ye):ye}}function Da(ie,W,Y){return{type:"Feature",id:ie[W+gr],properties:ma(ie,W,Y),geometry:{type:"Point",coordinates:[(ue=ie[W],360*(ue-.5)),ba(ie[W+1])]}};var ue}function ma(ie,W,Y){const ue=ie[W+tr],we=ue>=1e4?`${Math.round(ue/1e3)}k`:ue>=1e3?Math.round(ue/100)/10+"k":ue,ye=ie[W+co],Me=ye===-1?{}:Object.assign({},Y[ye]);return Object.assign(Me,{cluster:!0,cluster_id:ie[W+gr],point_count:ue,point_count_abbreviated:we})}function _o(ie){return ie/360+.5}function Oo(ie){const W=Math.sin(ie*Math.PI/180),Y=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return Y<0?0:Y>1?1:Y}function ba(ie){const W=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Uo(ie,W,Y,ue){let we=ue;const ye=W+(Y-W>>1);let Me,je=Y-W;const ze=ie[W],We=ie[W+1],xt=ie[Y],ht=ie[Y+1];for(let ti=W+3;ti<Y;ti+=3){const Ri=Io(ie[ti],ie[ti+1],ze,We,xt,ht);if(Ri>we)Me=ti,we=Ri;else if(Ri===we){const xi=Math.abs(ti-ye);xi<je&&(Me=ti,je=xi)}}we>ue&&(Me-W>3&&Uo(ie,W,Me,ue),ie[Me+2]=we,Y-Me>3&&Uo(ie,Me,Y,ue))}function Io(ie,W,Y,ue,we,ye){let Me=we-Y,je=ye-ue;if(Me!==0||je!==0){const ze=((ie-Y)*Me+(W-ue)*je)/(Me*Me+je*je);ze>1?(Y=we,ue=ye):ze>0&&(Y+=Me*ze,ue+=je*ze)}return Me=ie-Y,je=W-ue,Me*Me+je*je}function jo(ie,W,Y,ue){const we={id:ie??null,type:W,geometry:Y,tags:ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(W==="Point"||W==="MultiPoint"||W==="LineString")Yo(we,Y);else if(W==="Polygon")Yo(we,Y[0]);else if(W==="MultiLineString")for(const ye of Y)Yo(we,ye);else if(W==="MultiPolygon")for(const ye of Y)Yo(we,ye[0]);return we}function Yo(ie,W){for(let Y=0;Y<W.length;Y+=3)ie.minX=Math.min(ie.minX,W[Y]),ie.minY=Math.min(ie.minY,W[Y+1]),ie.maxX=Math.max(ie.maxX,W[Y]),ie.maxY=Math.max(ie.maxY,W[Y+1])}function xs(ie,W,Y,ue){if(!W.geometry)return;const we=W.geometry.coordinates;if(we&&we.length===0)return;const ye=W.geometry.type,Me=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2);let je=[],ze=W.id;if(Y.promoteId?ze=W.properties[Y.promoteId]:Y.generateId&&(ze=ue||0),ye==="Point")$o(we,je);else if(ye==="MultiPoint")for(const We of we)$o(We,je);else if(ye==="LineString")Fi(we,je,Me,!1);else if(ye==="MultiLineString"){if(Y.lineMetrics){for(const We of we)je=[],Fi(We,je,Me,!1),ie.push(jo(ze,"LineString",je,W.properties));return}an(we,je,Me,!1)}else if(ye==="Polygon")an(we,je,Me,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(const We of W.geometry.geometries)xs(ie,{id:ze,geometry:We,properties:W.properties},Y,ue);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const We of we){const xt=[];an(We,xt,Me,!0),je.push(xt)}}ie.push(jo(ze,ye,je,W.properties))}function $o(ie,W){W.push(ir(ie[0]),jr(ie[1]),0)}function Fi(ie,W,Y,ue){let we,ye,Me=0;for(let ze=0;ze<ie.length;ze++){const We=ir(ie[ze][0]),xt=jr(ie[ze][1]);W.push(We,xt,0),ze>0&&(Me+=ue?(we*xt-We*ye)/2:Math.sqrt(Math.pow(We-we,2)+Math.pow(xt-ye,2))),we=We,ye=xt}const je=W.length-3;W[2]=1,Uo(W,0,je,Y),W[je+2]=1,W.size=Math.abs(Me),W.start=0,W.end=W.size}function an(ie,W,Y,ue){for(let we=0;we<ie.length;we++){const ye=[];Fi(ie[we],ye,Y,ue),W.push(ye)}}function ir(ie){return ie/360+.5}function jr(ie){const W=Math.sin(ie*Math.PI/180),Y=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return Y<0?0:Y>1?1:Y}function jn(ie,W,Y,ue,we,ye,Me,je){if(ue/=W,ye>=(Y/=W)&&Me<ue)return ie;if(Me<Y||ye>=ue)return null;const ze=[];for(const We of ie){const xt=We.geometry;let ht=We.type;const ti=we===0?We.minX:We.minY,Ri=we===0?We.maxX:We.maxY;if(ti>=Y&&Ri<ue){ze.push(We);continue}if(Ri<Y||ti>=ue)continue;let xi=[];if(ht==="Point"||ht==="MultiPoint")yo(xt,xi,Y,ue,we);else if(ht==="LineString")To(xt,xi,Y,ue,we,!1,je.lineMetrics);else if(ht==="MultiLineString")qr(xt,xi,Y,ue,we,!1);else if(ht==="Polygon")qr(xt,xi,Y,ue,we,!0);else if(ht==="MultiPolygon")for(const ei of xt){const Yi=[];qr(ei,Yi,Y,ue,we,!0),Yi.length&&xi.push(Yi)}if(xi.length){if(je.lineMetrics&&ht==="LineString"){for(const ei of xi)ze.push(jo(We.id,ht,ei,We.tags));continue}ht!=="LineString"&&ht!=="MultiLineString"||(xi.length===1?(ht="LineString",xi=xi[0]):ht="MultiLineString"),ht!=="Point"&&ht!=="MultiPoint"||(ht=xi.length===3?"Point":"MultiPoint"),ze.push(jo(We.id,ht,xi,We.tags))}}return ze.length?ze:null}function yo(ie,W,Y,ue,we){for(let ye=0;ye<ie.length;ye+=3){const Me=ie[ye+we];Me>=Y&&Me<=ue&&wr(W,ie[ye],ie[ye+1],ie[ye+2])}}function To(ie,W,Y,ue,we,ye,Me){let je=Wo(ie);const ze=we===0?bn:uo;let We,xt,ht=ie.start;for(let Yi=0;Yi<ie.length-3;Yi+=3){const un=ie[Yi],hr=ie[Yi+1],Lr=ie[Yi+2],Ro=ie[Yi+3],ho=ie[Yi+4],to=we===0?un:hr,nr=we===0?Ro:ho;let Sn=!1;Me&&(We=Math.sqrt(Math.pow(un-Ro,2)+Math.pow(hr-ho,2))),to<Y?nr>Y&&(xt=ze(je,un,hr,Ro,ho,Y),Me&&(je.start=ht+We*xt)):to>ue?nr<ue&&(xt=ze(je,un,hr,Ro,ho,ue),Me&&(je.start=ht+We*xt)):wr(je,un,hr,Lr),nr<Y&&to>=Y&&(xt=ze(je,un,hr,Ro,ho,Y),Sn=!0),nr>ue&&to<=ue&&(xt=ze(je,un,hr,Ro,ho,ue),Sn=!0),!ye&&Sn&&(Me&&(je.end=ht+We*xt),W.push(je),je=Wo(ie)),Me&&(ht+=We)}let ti=ie.length-3;const Ri=ie[ti],xi=ie[ti+1],ei=we===0?Ri:xi;ei>=Y&&ei<=ue&&wr(je,Ri,xi,ie[ti+2]),ti=je.length-3,ye&&ti>=3&&(je[ti]!==je[0]||je[ti+1]!==je[1])&&wr(je,je[0],je[1],je[2]),je.length&&W.push(je)}function Wo(ie){const W=[];return W.size=ie.size,W.start=ie.start,W.end=ie.end,W}function qr(ie,W,Y,ue,we,ye){for(const Me of ie)To(Me,W,Y,ue,we,ye,!1)}function wr(ie,W,Y,ue){ie.push(W,Y,ue)}function bn(ie,W,Y,ue,we,ye){const Me=(ye-W)/(ue-W);return wr(ie,ye,Y+(we-Y)*Me,1),Me}function uo(ie,W,Y,ue,we,ye){const Me=(ye-Y)/(we-Y);return wr(ie,W+(ue-W)*Me,ye,1),Me}function wa(ie,W){const Y=[];for(let ue=0;ue<ie.length;ue++){const we=ie[ue],ye=we.type;let Me;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Me=ga(we.geometry,W);else if(ye==="MultiLineString"||ye==="Polygon"){Me=[];for(const je of we.geometry)Me.push(ga(je,W))}else if(ye==="MultiPolygon"){Me=[];for(const je of we.geometry){const ze=[];for(const We of je)ze.push(ga(We,W));Me.push(ze)}}Y.push(jo(we.id,ye,Me,we.tags))}return Y}function ga(ie,W){const Y=[];Y.size=ie.size,ie.start!==void 0&&(Y.start=ie.start,Y.end=ie.end);for(let ue=0;ue<ie.length;ue+=3)Y.push(ie[ue]+W,ie[ue+1],ie[ue+2]);return Y}function ra(ie,W){if(ie.transformed)return ie;const Y=1<<ie.z,ue=ie.x,we=ie.y;for(const ye of ie.features){const Me=ye.geometry,je=ye.type;if(ye.geometry=[],je===1)for(let ze=0;ze<Me.length;ze+=2)ye.geometry.push(tc(Me[ze],Me[ze+1],W,Y,ue,we));else for(let ze=0;ze<Me.length;ze++){const We=[];for(let xt=0;xt<Me[ze].length;xt+=2)We.push(tc(Me[ze][xt],Me[ze][xt+1],W,Y,ue,we));ye.geometry.push(We)}}return ie.transformed=!0,ie}function tc(ie,W,Y,ue,we,ye){return[Math.round(Y*(ie*ue-we)),Math.round(Y*(W*ue-ye))]}function ml(ie,W,Y,ue,we){const ye=W===we.maxZoom?0:we.tolerance/((1<<W)*we.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:ie.length,source:null,x:Y,y:ue,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const je of ie)ic(Me,je,ye,we);return Me}function ic(ie,W,Y,ue){const we=W.geometry,ye=W.type,Me=[];if(ie.minX=Math.min(ie.minX,W.minX),ie.minY=Math.min(ie.minY,W.minY),ie.maxX=Math.max(ie.maxX,W.maxX),ie.maxY=Math.max(ie.maxY,W.maxY),ye==="Point"||ye==="MultiPoint")for(let je=0;je<we.length;je+=3)Me.push(we[je],we[je+1]),ie.numPoints++,ie.numSimplified++;else if(ye==="LineString")Ks(Me,we,ie,Y,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(let je=0;je<we.length;je++)Ks(Me,we[je],ie,Y,ye==="Polygon",je===0);else if(ye==="MultiPolygon")for(let je=0;je<we.length;je++){const ze=we[je];for(let We=0;We<ze.length;We++)Ks(Me,ze[We],ie,Y,!0,We===0)}if(Me.length){let je=W.tags||null;if(ye==="LineString"&&ue.lineMetrics){je={};for(const We in W.tags)je[We]=W.tags[We];je.mapbox_clip_start=we.start/we.size,je.mapbox_clip_end=we.end/we.size}const ze={geometry:Me,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:je};W.id!==null&&(ze.id=W.id),ie.features.push(ze)}}function Ks(ie,W,Y,ue,we,ye){const Me=ue*ue;if(ue>0&&W.size<(we?Me:ue))return void(Y.numPoints+=W.length/3);const je=[];for(let ze=0;ze<W.length;ze+=3)(ue===0||W[ze+2]>Me)&&(Y.numSimplified++,je.push(W[ze],W[ze+1])),Y.numPoints++;we&&function(ze,We){let xt=0;for(let ht=0,ti=ze.length,Ri=ti-2;ht<ti;Ri=ht,ht+=2)xt+=(ze[ht]-ze[Ri])*(ze[ht+1]+ze[Ri+1]);if(xt>0===We)for(let ht=0,ti=ze.length;ht<ti/2;ht+=2){const Ri=ze[ht],xi=ze[ht+1];ze[ht]=ze[ti-2-ht],ze[ht+1]=ze[ti-1-ht],ze[ti-2-ht]=Ri,ze[ti-1-ht]=xi}}(je,ye),ie.push(je)}const Tt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ta{constructor(W,Y){const ue=(Y=this.options=function(ye,Me){for(const je in Me)ye[je]=Me[je];return ye}(Object.create(Tt),Y)).debug;if(ue&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");let we=function(ye,Me){const je=[];if(ye.type==="FeatureCollection")for(let ze=0;ze<ye.features.length;ze++)xs(je,ye.features[ze],Me,ze);else xs(je,ye.type==="Feature"?ye:{geometry:ye},Me);return je}(W,Y);this.tiles={},this.tileCoords=[],ue&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),we=function(ye,Me){const je=Me.buffer/Me.extent;let ze=ye;const We=jn(ye,1,-1-je,je,0,-1,2,Me),xt=jn(ye,1,1-je,2+je,0,-1,2,Me);return(We||xt)&&(ze=jn(ye,1,-je,1+je,0,-1,2,Me)||[],We&&(ze=wa(We,1).concat(ze)),xt&&(ze=ze.concat(wa(xt,-1)))),ze}(we,Y),we.length&&this.splitTile(we,0,0,0),ue&&(we.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,Y,ue,we,ye,Me,je){const ze=[W,Y,ue,we],We=this.options,xt=We.debug;for(;ze.length;){we=ze.pop(),ue=ze.pop(),Y=ze.pop(),W=ze.pop();const ht=1<<Y,ti=Ga(Y,ue,we);let Ri=this.tiles[ti];if(!Ri&&(xt>1&&console.time("creation"),Ri=this.tiles[ti]=ml(W,Y,ue,we,We),this.tileCoords.push({z:Y,x:ue,y:we}),xt)){xt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,ue,we,Ri.numFeatures,Ri.numPoints,Ri.numSimplified),console.timeEnd("creation"));const Sn=`z${Y}`;this.stats[Sn]=(this.stats[Sn]||0)+1,this.total++}if(Ri.source=W,ye==null){if(Y===We.indexMaxZoom||Ri.numPoints<=We.indexMaxPoints)continue}else{if(Y===We.maxZoom||Y===ye)continue;if(ye!=null){const Sn=ye-Y;if(ue!==Me>>Sn||we!==je>>Sn)continue}}if(Ri.source=null,W.length===0)continue;xt>1&&console.time("clipping");const xi=.5*We.buffer/We.extent,ei=.5-xi,Yi=.5+xi,un=1+xi;let hr=null,Lr=null,Ro=null,ho=null,to=jn(W,ht,ue-xi,ue+Yi,0,Ri.minX,Ri.maxX,We),nr=jn(W,ht,ue+ei,ue+un,0,Ri.minX,Ri.maxX,We);W=null,to&&(hr=jn(to,ht,we-xi,we+Yi,1,Ri.minY,Ri.maxY,We),Lr=jn(to,ht,we+ei,we+un,1,Ri.minY,Ri.maxY,We),to=null),nr&&(Ro=jn(nr,ht,we-xi,we+Yi,1,Ri.minY,Ri.maxY,We),ho=jn(nr,ht,we+ei,we+un,1,Ri.minY,Ri.maxY,We),nr=null),xt>1&&console.timeEnd("clipping"),ze.push(hr||[],Y+1,2*ue,2*we),ze.push(Lr||[],Y+1,2*ue,2*we+1),ze.push(Ro||[],Y+1,2*ue+1,2*we),ze.push(ho||[],Y+1,2*ue+1,2*we+1)}}getTile(W,Y,ue){W=+W,Y=+Y,ue=+ue;const we=this.options,{extent:ye,debug:Me}=we;if(W<0||W>24)return null;const je=1<<W,ze=Ga(W,Y=Y+je&je-1,ue);if(this.tiles[ze])return ra(this.tiles[ze],ye);Me>1&&console.log("drilling down to z%d-%d-%d",W,Y,ue);let We,xt=W,ht=Y,ti=ue;for(;!We&&xt>0;)xt--,ht>>=1,ti>>=1,We=this.tiles[Ga(xt,ht,ti)];return We&&We.source?(Me>1&&(console.log("found parent tile z%d-%d-%d",xt,ht,ti),console.time("drilling down")),this.splitTile(We.source,xt,ht,ti,W,Y,ue),Me>1&&console.timeEnd("drilling down"),this.tiles[ze]?ra(this.tiles[ze],ye):null):null}}function Ga(ie,W,Y){return 32*((1<<ie)*Y+W)+ie}function Ma(ie,W){const Y=ie.tileID.canonical;if(!this._geoJSONIndex)return void W(null,null);const ue=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!ue)return void W(null,null);const we=We=>We.tags&&"3d_elevation_id"in We.tags&&"source"in We.tags&&We.tags.source==="elevation",ye=ue.features.filter(We=>we(We));let Me={_geojsonTileLayer:ue.features};ye.length>0&&(Me={_geojsonTileLayer:ue.features.filter(We=>!we(We)),hd_road_elevation:ye});const je=new Ii(Me),ze=function(We){const xt=new r.bs;for(const ht of Object.keys(We))xt.writeMessage(3,Vr,{name:ht,features:We[ht]});return xt.finish()}(Me).buffer;W(null,{vectorTile:je,rawData:ze})}class hn extends Ct{constructor(W,Y,ue,we,ye,Me,je){super(W,Y,ue,we,ye,Ma,je),Me&&(this.loadGeoJSON=Me),this._dynamicIndex=new Et}loadData(W,Y){const ue=W&&W.request,we=ue&&ue.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(W,(ye,Me)=>{if(ye||!Me)return Y(ye);if(typeof Me!="object")return Y(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));{try{if(W.filter){const ze=r.U(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ze.result==="error")throw new Error(ze.value.map(We=>`${We.key}: ${We.message}`).join(", "));Me.features=Me.features.filter(We=>ze.value.evaluate({zoom:0},We))}W.dynamic?(Me.type==="Feature"&&(Me={type:"FeatureCollection",features:[Me]}),W.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Me.features,this.loaded),W.cluster&&(Me.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=W.cluster?new Fr(function({superclusterOptions:ze,clusterProperties:We}){if(!We||!ze)return ze;const xt={},ht={},ti={accumulated:null,zoom:0},Ri={properties:null},xi=Object.keys(We);for(const ei of xi){const[Yi,un]=We[ei],hr=r.U(un),Lr=r.U(typeof Yi=="string"?[Yi,["accumulated"],["get",ei]]:Yi);xt[ei]=hr.value,ht[ei]=Lr.value}return ze.map=ei=>{Ri.properties=ei;const Yi={};for(const un of xi)Yi[un]=xt[un].evaluate(ti,Ri);return Yi},ze.reduce=(ei,Yi)=>{Ri.properties=Yi;for(const un of xi)ti.accumulated=ei[un],ei[un]=ht[un].evaluate(ti,Ri)},ze}(W)).load(Me.features):W.dynamic?this._dynamicIndex:function(ze,We){return new Ta(ze,We)}(Me,W.geojsonVtOptions)}catch(ze){return Y(ze)}const je={};if(we){const ze=L(ue);ze&&(je.resourceTiming={},je.resourceTiming[W.source]=JSON.parse(JSON.stringify(ze)))}Y(null,je)}})}reloadTile(W,Y){const ue=this.loaded;return ue&&ue[W.uid]?W.partial?Y(null,void 0):super.reloadTile(W,Y):this.loadTile(W,Y)}loadGeoJSON(W,Y){if(W.request)r.m(W.request,Y);else{if(typeof W.data!="string")return Y(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return Y(null,JSON.parse(W.data))}catch{return Y(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(W,Y){try{Y(null,this._geoJSONIndex.getClusterExpansionZoom(W.clusterId))}catch(ue){Y(ue)}}getClusterChildren(W,Y){try{Y(null,this._geoJSONIndex.getChildren(W.clusterId))}catch(ue){Y(ue)}}getClusterLeaves(W,Y){try{Y(null,this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset))}catch(ue){Y(ue)}}}class Ko{constructor(W,Y,ue){this.tileID=new r.aP(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.tileZoom=W.tileZoom,this.uid=W.uid,this.zoom=W.zoom,this.canonical=W.tileID.canonical,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=W.projection,this.brightness=Y,this.worldview=ue}parse(W,Y,ue,we){this.status="parsing";const ye=new r.aP(ue.tileID.overscaledZ,ue.tileID.wrap,ue.tileID.canonical.z,ue.tileID.canonical.x,ue.tileID.canonical.y),Me=[],je=Y.familiesBySource[ue.source],ze=new r.fm(ye,ue.promoteId);ze.bucketLayerIDs=[],ze.is3DTile=!0,r.fB(W).then(We=>{if(!We)return we(new Error("Could not parse tile"));const xt=We.json.extensionsUsed&&We.json.extensionsUsed.includes("MAPBOX_mesh_features")||We.json.asset.extras&&We.json.asset.extras.MAPBOX_mesh_features,ht=We.json.extensionsUsed&&We.json.extensionsUsed.includes("EXT_meshopt_compression"),ti=new r.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Ri in je)for(const xi of je[Ri]){const ei=xi[0];ze.bucketLayerIDs.push(xi.map(hr=>r.B(hr.id,hr.scope))),ei.recalculate(ti,[]);const Yi=r.fC(We,1/r.d6(ue.tileID.canonical)),un=new r.fD(xi,Yi,ye,xt,ht,this.brightness,ze,this.worldview);xt||(un.needsUpload=!0),Me.push(un),un.evaluate(ei)}this.status="done",we(null,{buckets:Me,featureIndex:ze,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(We=>we(new Error(We.message)))}}class it{constructor(W,Y,ue,we,ye,Me,je,ze){this.actor=W,this.layerIndex=Y,this.availableImages=ue,this.availableModels=we,this.brightness=je,this.loading={},this.loaded={},this.worldview=ze}loadTile(W,Y){const ue=W.uid,we=this.loading[ue]=new Ko(W,this.brightness,this.worldview);r.bt(W.request,(ye,Me)=>{const je=!this.loading[ue];return delete this.loading[ue],je||ye?(we.status="done",je||(this.loaded[ue]=we),Y(ye)):Me&&Me.byteLength!==0?void we.parse(Me,this.layerIndex,W,(ze,We)=>{we.status="done",this.loaded=this.loaded||{},this.loaded[ue]=we,ze||!We?Y(ze):Y(null,We)}):(we.status="done",this.loaded[ue]=we,Y())})}reloadTile(W,Y){const ue=this.loaded,we=W.uid;if(ue&&ue[we]){const ye=ue[we];ye.projection=W.projection,ye.brightness=W.brightness;const Me=(je,ze)=>{ye.reloadCallback&&(delete ye.reloadCallback,this.loadTile(W,Y)),Y(je,ze)};ye.status==="parsing"?ye.reloadCallback=Me:ye.status==="done"&&this.loadTile(W,Y)}}abortTile(W,Y){const ue=W.uid;this.loading[ue]&&delete this.loading[ue],Y()}removeTile(W,Y){const ue=this.loaded,we=W.uid;ue&&ue[we]&&delete ue[we],Y()}}class bi{constructor(W){this.self=W,this.actor=new r.fF(W,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new r.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=r.cl({name:"mercator"}),this.workerSourceTypes={vector:Ct,geojson:hn,"raster-dem":Vt,"raster-array":Di,"batched-model":it},this.workerSources={},this.self.registerWorkerSource=(Y,ue)=>{if(this.workerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.workerSourceTypes[Y]=ue},this.self.registerRTLTextPlugin=Y=>{if(r.fG.isParsed())throw new Error("RTL text plugin already registered.");r.fG.setState({pluginStatus:r.fH.parsed,pluginURL:r.fG.getPluginURL()}),r.fG.applyArabicShaping=Y.applyArabicShaping,r.fG.processBidirectionalText=Y.processBidirectionalText,r.fG.processStyledBidirectionalText=Y.processStyledBidirectionalText;for(const ue of this.rtlPluginParsingListeners)ue(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(W,Y,ue){delete this.layerIndexes[W],delete this.availableImages[W],delete this.availableModels[W],delete this.workerSources[W],ue()}checkIfReady(W,Y,ue){ue()}setReferrer(W,Y){this.referrer=Y}spriteLoaded(W,Y){this.isSpriteLoaded[W]||(this.isSpriteLoaded[W]={});const{scope:ue,isLoaded:we}=Y;if(this.isSpriteLoaded[W][ue]=we,this.workerSources[W]&&this.workerSources[W][ue])for(const ye in this.workerSources[W][ue]){const Me=this.workerSources[W][ue][ye];for(const je in Me){const ze=Me[je];ze instanceof Ct&&(ze.isSpriteLoaded=we,ze.fire(new r.z("isSpriteLoaded")))}}}setImages(W,Y,ue){this.availableImages[W]||(this.availableImages[W]={});const{scope:we,images:ye}=Y;if(this.availableImages[W][we]=ye,this.workerSources[W]&&this.workerSources[W][we]){for(const Me in this.workerSources[W][we]){const je=this.workerSources[W][we][Me];for(const ze in je)je[ze].availableImages=ye}ue()}else ue()}setModels(W,{scope:Y,models:ue},we){if(this.availableModels[W]||(this.availableModels[W]={}),this.availableModels[W][Y]=ue,this.workerSources[W]&&this.workerSources[W][Y]){for(const ye in this.workerSources[W][Y]){const Me=this.workerSources[W][Y][ye];for(const je in Me)Me[je].availableModels=ue}we()}else we()}setProjection(W,Y){this.projections[W]=r.cl(Y)}setBrightness(W,Y,ue){this.brightness=Y,ue()}setWorldview(W,Y,ue){this.worldview=Y,ue()}setLayers(W,Y,ue){this.getLayerIndex(W,Y.scope).replace(Y.layers,Y.options),ue()}updateLayers(W,Y,ue){this.getLayerIndex(W,Y.scope).update(Y.layers,Y.removedIds,Y.options),ue()}loadTile(W,Y,ue){Y.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,Y.type,Y.source,Y.scope).loadTile(Y,ue)}decodeRasterArray(W,Y,ue){this.getWorkerSource(W,Y.type,Y.source,Y.scope).decodeRasterArray(Y,ue)}reloadTile(W,Y,ue){Y.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,Y.type,Y.source,Y.scope).reloadTile(Y,ue)}abortTile(W,Y,ue){this.getWorkerSource(W,Y.type,Y.source,Y.scope).abortTile(Y,ue)}removeTile(W,Y,ue){this.getWorkerSource(W,Y.type,Y.source,Y.scope).removeTile(Y,ue)}removeSource(W,Y,ue){if(!(this.workerSources[W]&&this.workerSources[W][Y.scope]&&this.workerSources[W][Y.scope][Y.type]&&this.workerSources[W][Y.scope][Y.type][Y.source]))return;const we=this.workerSources[W][Y.scope][Y.type][Y.source];delete this.workerSources[W][Y.scope][Y.type][Y.source],we.removeSource!==void 0?we.removeSource(Y,ue):ue()}loadWorkerSource(W,Y,ue){try{this.self.importScripts(Y.url),ue()}catch(we){ue(we.toString())}}syncRTLPluginState(W,Y,ue){if(r.fG.isParsed())ue(null,!0);else if(r.fG.isParsing())this.rtlPluginParsingListeners.push(ue);else try{r.fG.setState(Y);const we=r.fG.getPluginURL();!r.fG.isLoaded()||r.fG.isParsed()||r.fG.isParsing()||we==null||(r.fG.setState({pluginStatus:r.fH.parsing,pluginURL:r.fG.getPluginURL()}),this.self.importScripts(we),r.fG.isParsed()?ue(null,!0):this.rtlPluginParsingListeners.push(ue))}catch(we){ue(we.toString())}}setDracoUrl(W,Y){this.dracoUrl=Y}getAvailableImages(W,Y){this.availableImages[W]||(this.availableImages[W]={});let ue=this.availableImages[W][Y];return ue||(ue=[]),ue}getAvailableModels(W,Y){this.availableModels[W]||(this.availableModels[W]={});let ue=this.availableModels[W][Y];return ue||(ue={}),ue}getLayerIndex(W,Y){this.layerIndexes[W]||(this.layerIndexes[W]={});let ue=this.layerIndexes[W][Y];return ue||(ue=this.layerIndexes[W][Y]=new X,ue.scope=Y),ue}getWorkerSource(W,Y,ue,we){const ye=this.workerSources;return ye[W]||(ye[W]={}),ye[W][we]||(ye[W][we]={}),ye[W][we][Y]||(ye[W][we][Y]={}),this.isSpriteLoaded[W]||(this.isSpriteLoaded[W]={}),ye[W][we][Y][ue]||(ye[W][we][Y][ue]=new this.workerSourceTypes[Y]({send:(Me,je,ze,We,xt,ht)=>this.actor.send(Me,je,ze,W,xt,ht),scheduler:this.actor.scheduler},this.getLayerIndex(W,we),this.getAvailableImages(W,we),this.getAvailableModels(W,we),this.isSpriteLoaded[W][we],void 0,this.brightness,this.worldview)),ye[W][we][Y][ue]}rasterizeImagesWorker(W,Y,ue){const we=new Map;for(const[ye,{image:Me,imageVariant:je}]of Y.tasks.entries()){const ze=this.imageRasterizer.rasterize(je,Me,Y.scope,W);we.set(ye,ze)}ue(void 0,we)}removeRasterizedImages(W,Y,ue){this.imageRasterizer.removeImagesFromCacheByIds(Y.imageIds,Y.scope,W),ue()}enforceCacheSizeLimit(W,Y){r.fI(Y)}getWorkerPerformanceMetrics(W,Y,ue){ue(void 0,void 0)}}return r.fE(self)&&(self.worker=new bi(self)),bi}),E(["./shared"],function(r){var L="3.16.0";const N={create:"create",load:"load",fullLoad:"fullLoad"},H={mark(f){performance.mark(f)},measure(f,t,o){performance.measure(f,t,o)}};function X(f){const t=f.name.split("?")[0];return r.a(t)&&t.includes("mapbox-gl.js")?"javascript":r.a(t)&&t.includes("mapbox-gl.css")?"css":r.b(t)?"fontRange":r.c(t)?"sprite":r.i(t)?"style":r.d(t)?"tilejson":"other"}var re,he={},de=function(){if(re)return he;function f(p){return!t(p)}function t(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,T,I=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(I);try{T=new Worker(D),b=!0}catch{b=!1}return T&&T.terminate(),URL.revokeObjectURL(D),b}()?function(){var b=document.createElement("canvas");b.width=b.height=1;var T=b.getContext("2d");if(!T)return!1;var I=T.getImageData(0,0,1,1);return I&&I.width===b.width}()?(o[y=p&&p.failIfMajorPerformanceCaveat]===void 0&&(o[y]=function(b){var T,I=function(D){var F=document.createElement("canvas"),z=Object.create(f.webGLContextAttributes);return z.failIfMajorPerformanceCaveat=D,F.getContext("webgl2",z)}(b);if(!I)return!1;try{T=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!T||I.isContextLost())&&(I.shaderSource(T,"void main() {}"),I.compileShader(T),I.getShaderParameter(T,I.COMPILE_STATUS)===!0)}(y)),o[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}re=1,he.supported=f,he.notSupportedReason=t;var o={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},he}();function ve(f,t,o){const p=document.createElement(f);return t!=null&&(p.className=t),o&&o.appendChild(p),p}function xe(f,t,o){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const y of Object.keys(t))p.setAttributeNS(null,y,String(t[y]));return o&&o.appendChild(p),p}const $e=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Le=$e&&$e.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ke;function Ge(){$e&&Le&&(Ke=$e[Le],$e[Le]="none")}function Ye(){$e&&Le&&($e[Le]=Ke)}function mt(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",mt,!0)}function Ct(){window.addEventListener("click",mt,!0),window.setTimeout(()=>{window.removeEventListener("click",mt,!0)},0)}function Vt(f,t){const o=f.getBoundingClientRect();return si(f,o,t)}function ui(f,t){const o=f.getBoundingClientRect(),p=[];for(let y=0;y<t.length;y++)p.push(si(f,o,t[y]));return p}function Di(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function si(f,t,o){const p=f.offsetWidth===t.width?1:f.offsetWidth/t.width;return new r.P((o.clientX-t.left)*p,(o.clientY-t.top)*p)}const di="01",Nt="NO_ACCESS_TOKEN";class Ii{constructor(t,o,p){this._transformRequestFn=t,this._customAccessToken=o,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const t=function(){let o="";for(let p=0;p<10;p++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",di,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}}normalizeStyleURL(t,o){if(!r.h(t))return t;const p=_t(t);return p.params.push(`sdk=js-${L}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||o)}normalizeGlyphsURL(t,o){if(!r.h(t))return t;const p=_t(t);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||o)}normalizeModelURL(t,o){if(!r.h(t))return t;const p=_t(t);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||o)}normalizeSourceURL(t,o,p,y){if(!r.h(t))return t;const b=_t(t);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),p&&b.params.push(`language=${p}`),y&&b.params.push(`worldview=${y}`),this._makeAPIURL(b,this._customAccessToken||o)}normalizeIconsetURL(t,o){const p=_t(t);return r.h(t)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||o)):Et(p)}normalizeSpriteURL(t,o,p,y){const b=_t(t);return r.h(t)?(b.path=`/styles/v1${b.path}/sprite${o}${p}`,this._makeAPIURL(b,this._customAccessToken||y)):(b.path+=`${o}${p}`,Et(b))}normalizeTileURL(t,o,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!r.h(t))return t;const y=_t(t);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||p&&y.authority!=="raster"&&p===512?"@2x":""}${r.k.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${r.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${r.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${r.e.TILE_URL_VERSION}${y.path}`);const b=this._customAccessToken||function(T){for(const I of T){const D=I.match(/^access_token=(.*)$/);if(D)return D[1]}return null}(y.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,b)}canonicalizeTileURL(t,o){const p=_t(t);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return t;let y="mapbox://";p.path.match(/^\/raster\/v1\//)?y+=`raster/${p.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${p.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${p.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let b=p.params;return o&&(b=b.filter(T=>!T.match(/^access_token=/))),b.length&&(y+=`?${b.join("&")}`),y}canonicalizeTileset(t,o){const p=!!o&&r.h(o),y=[];for(const b of t.tiles||[])r.j(b)?y.push(this.canonicalizeTileURL(b,p)):y.push(b);return y}_makeAPIURL(t,o){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=_t(r.e.API_URL);if(t.protocol=y.protocol,t.authority=y.authority,t.protocol==="http"){const b=t.params.indexOf("secure");b>=0&&t.params.splice(b,1)}if(y.path!=="/"&&(t.path=`${y.path}${t.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return Et(t);if(o=o||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return t.params=t.params.filter(b=>b.indexOf("access_token")===-1),t.params.push(`access_token=${o||""}`),Et(t)}}const Qt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function _t(f){const t=f.match(Qt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Et(f){const t=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${t}`}const fi="mapbox.eventData";function rn(f){if(!f)return null;const t=f.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(r.l(t[1]))}catch{return null}}class zn{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const o=rn(r.e.ACCESS_TOKEN);let p="";return p=o&&o.u?r.f(o.u):r.e.ACCESS_TOKEN||"",t?`${fi}.${t}:${p}`:`${fi}:${p}`}fetchEventData(){const t=r.s("localStorage"),o=this.getStorageKey(),p=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp");if(t)try{const b=localStorage.getItem(o);b&&(this.eventData=JSON.parse(b));const T=localStorage.getItem(p);T&&(this.anonId=T);const I=localStorage.getItem(y);I&&(this.anonIdTimestamp=Number(I));const D=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<D)&&this.refreshUUID()}catch{r.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=r.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=r.s("localStorage"),o=this.getStorageKey(),p=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp"),b=this.anonId,T=this.anonIdTimestamp;if(t&&b)try{localStorage.setItem(p,b),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData)),T&&localStorage.setItem(y,T.toString())}catch{r.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,o,p,y){if(!r.e.EVENTS_URL)return;const b=_t(r.e.EVENTS_URL);b.params.push(`access_token=${y||r.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(t).toISOString()},I=o?Object.assign(T,o):T,D={url:Et(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=r.p(D,F=>{this.pendingRequest=null,p(F),this.saveEventData(),this.processRequests(y)})}queueRequest(t,o){this.queue.push(t),this.processRequests(o)}}const er=new class extends zn{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,t){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(o=>r.h(o)||r.j(o))&&this.queueRequest(Date.now(),t)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=rn(r.e.ACCESS_TOKEN),o=t?t.u:r.e.ACCESS_TOKEN;let p=o!==this.eventData.tokenU;r.v(this.anonId)||(this.refreshUUID(),p=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),T=new Date(y),I=(y-this.eventData.lastSuccess)/864e5;p=p||I>=1||I<-1||b.getDate()!==T.getDate()}else p=!0;p?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:L,skuId:di,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=y,this.eventData.tokenU=o)},f):this.processRequests()}},Mn=er.postTurnstileEvent.bind(er),pn=new class extends zn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,t,o,p){this.skuToken=t,this.errorCb=p,r.e.EVENTS_URL&&(o||r.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},o):this.errorCb(new Error(Nt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),r.v(this.anonId)||this.refreshUUID(),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:L,skuId:di,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):t&&(this.success[t]=!0)},f))}remove(){this.errorCb=null}},pr=pn.postMapLoadEvent.bind(pn),Vr=new class extends zn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let t=this.mapInstanceIdMap.get(f);return t||(t=r.u(),this.mapInstanceIdMap.set(f,t)),t}getEventId(f){const t=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,t+1),t}postStyleLoadEvent(f,t){const{map:o,style:p,importedStyles:y}=t;if(!r.e.EVENTS_URL||!f&&!r.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(o),T={mapInstanceId:b,eventId:this.getEventId(b),style:p};y.length&&(T.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:T},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:o}=this.queue.shift();this.postEvent(t,o,()=>{},f)}},Or=Vr.postStyleLoadEvent.bind(Vr),kr=new class extends zn{constructor(f){super("metrics"),f&&(this.data=f)}postMetricsEvent(f){if(!r.e.EVENTS_URL||!f&&!r.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),r.v(this.anonId)||this.refreshUUID();const t=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:t},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:o}=this.queue.shift();this.postEvent(t,o,()=>{},f)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Wr=kr.postMetricsEvent.bind(kr),mn=new class extends zn{constructor(){super("gljs.performance")}postPerformanceEvent(f,t){r.e.EVENTS_URL&&(f||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:o}=this.queue.shift(),p=function(y){const b=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),I=function($){const Z={};if($){for(const Q in $)if(Q!=="other")for(const ne of $[Q]){const te=`${Q}ResolveRangeMin`,se=`${Q}ResolveRangeMax`,me=`${Q}RequestCount`,ce=`${Q}RequestCachedCount`;Z[te]=Math.min(Z[te]||1/0,ne.startTime),Z[se]=Math.max(Z[se]||-1/0,ne.responseEnd);const Ce=_e=>{Z[_e]===void 0&&(Z[_e]=0),++Z[_e]};ne.transferSize!==void 0&&ne.transferSize===0&&Ce(ce),Ce(me)}}return Z}(function($,Z){const Q={};if($)for(const ne of $){const te=Z(ne);Q[te]===void 0&&(Q[te]=[]),Q[te].push(ne)}return Q}(b,X)),D=window.devicePixelRatio,F=navigator.connection||navigator.mozConnection||navigator.webkitConnection,z=F?F.effectiveType:void 0,j={counters:[],metadata:[],attributes:[]},B=($,Z,Q)=>{Q!=null&&$.push({name:Z,value:Q.toString()})};for(const $ in I)B(j.counters,$,I[$]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(B(j.counters,"interactionRangeMin",y.interactionRange[0]),B(j.counters,"interactionRangeMax",y.interactionRange[1])),T)for(const $ of Object.values(N)){const Z=T.find(Q=>Q.name===$);Z&&B(j.counters,$,Z.startTime)}return B(j.counters,"visibilityHidden",y.visibilityHidden),B(j.attributes,"style",function($){if($)for(const Z of $){const Q=Z.name.split("?")[0];if(r.i(Q)){const ne=Q.split("/").slice(-2);if(ne.length===2)return`mapbox://styles/${ne[0]}/${ne[1]}`}}}(b)),B(j.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),B(j.attributes,"fogEnabled",y.fogEnabled?"true":"false"),B(j.attributes,"projection",y.projection),B(j.attributes,"zoom",y.zoom),B(j.metadata,"devicePixelRatio",D),B(j.metadata,"connectionEffectiveType",z),B(j.metadata,"navigatorUserAgent",navigator.userAgent),B(j.metadata,"screenWidth",window.screen.width),B(j.metadata,"screenHeight",window.screen.height),B(j.metadata,"windowWidth",window.innerWidth),B(j.metadata,"windowHeight",window.innerHeight),B(j.metadata,"mapWidth",y.width/D),B(j.metadata,"mapHeight",y.height/D),B(j.metadata,"webglRenderer",y.renderer),B(j.metadata,"webglVendor",y.vendor),B(j.metadata,"sdkVersion",L),B(j.metadata,"sdkIdentifier","mapbox-gl-js"),j}(o);for(const y of p.metadata);for(const y of p.counters);for(const y of p.attributes);this.postEvent(t,p,()=>{},f)}},Ei=mn.postPerformanceEvent.bind(mn),Xi=new class extends zn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,t,o,p){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const y=_t(r.e.API_URL+r.e.SESSION_PATH);y.params.push(`sku=${t||""}`),y.params.push(`access_token=${p||r.e.ACCESS_TOKEN||""}`);const b={url:Et(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(b,T=>{this.pendingRequest=null,o(T),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,t,o,p){this.skuToken=t,this.errorCb=p,r.e.SESSION_PATH&&r.e.API_URL&&(o||r.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},o):this.errorCb(new Error(Nt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||this.getSession(o,this.skuToken,p=>{p?this.errorCb(p):t&&(this.success[t]=!0)},f)}remove(){this.errorCb=null}},Rn=Xi.getSessionAPI.bind(Xi),on=new Set;function Ur(f,t){t?on.add(f):on.delete(f)}class gr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,o){this._updatedSourceCaches[t]=o,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const o=t.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(t.id),this.setDirty()}removeLayer(t){const o=t.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][t.id]=t,this._updatedLayers[o].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const o in this._updatedLayers)t[o]=t[o]||{},t[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)t[o]=t[o]||{},t[o].removedIds=Object.keys(this._removedLayers[o]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,o){this._updatedImages[o]=this._updatedImages[o]||new Set,this._updatedImages[o].add(r.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function tr(f){const{userImage:t}=f;return!!(t&&t.render&&t.render())&&(f.data.replace(new Uint8Array(t.data.buffer)),!0)}class co extends r.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&r.r()&&(this.imageRasterizerDispatcher=new r.D(r.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new r.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const o=this.atlasTexture.get(t);o&&(o.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,o){this.imageProviders.has(o)||this.imageProviders.set(o,new Map),this.imageProviders.get(o).set(t.id,t)}removeImageProvider(t,o){this.imageProviders.has(o)&&this.imageProviders.get(o).delete(t)}getPendingImageProviders(){const t=[];for(const o of this.imageProviders.values())for(const p of o.values())p.hasPendingRequests()&&t.push(p);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,o){if(this.loaded.get(o)!==t&&(this.loaded.set(o,t),t)){for(const{ids:p,callback:y}of this.requestors)this._notify(p,o,y);this.requestors=[]}}hasImage(t,o){return!!this.getImage(t,o)}getImage(t,o){return this.images.get(o).get(t.toString())}addImage(t,o,p){this._validate(t,p)&&this.images.get(o).set(t.toString(),p)}_validate(t,o){let p=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new r.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new r.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(o.content,o)||(this.fire(new r.y(new Error(`Image "${t.name}" has invalid "content" value`))),p=!1),p}_validateStretch(t,o){if(!t)return!0;let p=0;for(const y of t){if(y[0]<p||y[1]<y[0]||o<y[1])return!1;p=y[1]}return!0}_validateContent(t,o){return t?t.length!==4||!o.usvg&&(t[0]<0||o.data.width<t[0]||t[1]<0||o.data.height<t[1]||t[2]<0||o.data.width<t[2]||t[3]<0||o.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,o,p){const y=this.images.get(o).get(t.toString());p.version=y.version+1,this.images.get(o).set(t.toString(),p),this.updatedImages.get(o).add(t),this.removeFromImageRasterizerCache(t,o)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,o){this.spriteFormat!=="raster"&&(r.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:o}):this.imageRasterizer.removeImagesFromCacheByIds([t],o))}removeImage(t,o){const p=this.images.get(o),y=p.get(t.toString());p.delete(t.toString()),this.patterns.get(o).delete(t.toString()),this.removeFromImageRasterizerCache(t,o),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(o=>r.I.from(o))}getImages(t,o,p){const y=[],b=[],T=this.imageProviders.get(o);for(const z of t){if(!z.iconsetId){y.push(z);continue}const j=T.get(z.iconsetId);j&&(this.getImage(z,o)?b.push(z):j.addPendingRequest(z))}if(y.length===0)return void this._notify(b,o,p);let I=!0;const D=!!this.loaded.get(o),F=this.images.get(o);if(!D)for(const z of y)F.has(z.toString())||(I=!1);D||I?this._notify(y,o,p):this.requestors.push({ids:y,scope:o,callback:p})}rasterizeImages(t,o){const p=new Map,{tasks:y,scope:b}=t;for(const[T,I]of y.entries()){const D=this.getImage(I.id,b);D&&p.set(T,{image:D,imageVariant:I})}this._rasterizeImages(b,p,o)}_rasterizeImages(t,o,p){if(r.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:o,scope:t},p);else{const y=new Map;for(const[b,{image:T,imageVariant:I}]of o.entries())y.set(b,this.imageRasterizer.rasterize(I,T,t,0));p(void 0,y)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,o,p){const y=this.images.get(o),b=new Map;for(const T of t){if(!y.get(T.toString())){if(T.iconsetId)continue;this.fire(new r.z("styleimagemissing",{id:T.name}))}const I=y.get(T.toString());if(!I){r.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const D={data:I.usvg?null:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,usvg:I.usvg,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)};I.usvg&&Object.assign(D,{width:I.icon.usvg_tree.width,height:I.icon.usvg_tree.height}),b.set(r.I.toString(T),D)}p(null,b)}getPixelSize(t){const{width:o,height:p}=this.atlasImage.get(t);return{width:o,height:p}}getPattern(t,o,p){const y=t.toString(),b=this.patterns.get(o),T=b.get(y),I=this.getImage(t,o);if(!I)return null;if(T){if(T.position.version===I.version)return T.position;T.position.version=I.version}else{if(I.usvg&&!I.data){const D=this.getPatternInFlightId(y,o);if(this.patternsInFlight.has(D))return null;this.patternsInFlight.add(D);const F=new r.A(t).scaleSelf(r.o.devicePixelRatio),z=new Map([[F.toString(),{image:I,imageVariant:F}]]);return this._rasterizeImages(o,z,(j,B)=>this.storePatternImage(F,o,I,p,B)),null}this.storePattern(t,o,I)}return this._updatePatternAtlas(o,p),b.get(y).position}getPatternInFlightId(t,o){return r.B(t,o)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,o,p,y,b){const T=t.toString(),I=b?b.get(T):void 0;I&&(p.data=I,this.storePattern(t.id,o,p),this._updatePatternAtlas(o,y),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),o)))}storePattern(t,o,p){const y={w:p.data.width+2*r.C,h:p.data.height+2*r.C,x:0,y:0},b=new r.F(y,p,r.C);this.patterns.get(o).set(t.toString(),{bin:y,position:b})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,o){const p=t.gl;let y=this.atlasTexture.get(o);y?this.dirty&&(y.update(this.atlasImage.get(o)),this.dirty=!1):(y=new r.T(t,this.atlasImage.get(o),p.RGBA8),this.atlasTexture.set(o,y)),y.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(t,o){const p=this.patterns.get(t),y=Array.from(p.values()).map(({bin:F})=>F),{w:b,h:T}=r.G(y),I=this.atlasImage.get(t);I.resize({width:b||1,height:T||1});const D=this.images.get(t);for(const[F,{bin:z,position:j}]of p.entries()){let B=j.padding;const $=z.x+B,Z=z.y+B,Q=D.get(F).data,ne=Q.width,te=Q.height;B=B>1?B-1:B,r.q.copy(Q,I,{x:0,y:0},{x:$,y:Z},{width:ne,height:te},o),r.q.copy(Q,I,{x:0,y:te-B},{x:$,y:Z-B},{width:ne,height:B},o),r.q.copy(Q,I,{x:0,y:0},{x:$,y:Z+te},{width:ne,height:B},o),r.q.copy(Q,I,{x:ne-B,y:0},{x:$-B,y:Z},{width:B,height:te},o),r.q.copy(Q,I,{x:0,y:0},{x:$+ne,y:Z},{width:B,height:te},o),r.q.copy(Q,I,{x:ne-B,y:te-B},{x:$-B,y:Z-B},{width:B,height:B},o),r.q.copy(Q,I,{x:0,y:te-B},{x:$+ne,y:Z-B},{width:B,height:B},o),r.q.copy(Q,I,{x:0,y:0},{x:$+ne,y:Z+te},{width:B,height:B},o),r.q.copy(Q,I,{x:ne-B,y:0},{x:$-B,y:Z+te},{width:B,height:B},o)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,o){const p=this.images.get(o);for(const y of t){if(this.callbackDispatchedThisFrame.get(o).has(y.toString()))continue;this.callbackDispatchedThisFrame.get(o).add(y.toString());const b=p.get(y.toString());tr(b)&&this.updateImage(y,o,b)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Fr(f){const t=f.value,o=f.valueSpec,p=f.style,y=f.styleSpec,b=f.key,T=f.arrayElementValidator||bn;if(!Array.isArray(t))return[new r.V(b,t,`array expected, ${r.K(t)} found`)];if(o.length&&t.length!==o.length)return[new r.V(b,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new r.V(b,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let I={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};y.$version<7&&(I.function=o.function),r.H(o.value)&&(I=o.value);let D=[];for(let F=0;F<t.length;F++)D=D.concat(T({array:t,arrayIndex:F,value:t[F],valueSpec:I,style:p,styleSpec:y,key:`${b}[${F}]`},!0));return D}function Da(f){const t=f.key,o=f.value,p=f.valueSpec;if(!r.L(o))return[new r.V(t,o,`number expected, ${r.K(o)} found`)];if(o!=o)return[new r.V(t,o,"number expected, NaN found")];if("minimum"in p){let y=p.minimum;if(Array.isArray(p.minimum)&&(y=p.minimum[f.arrayIndex]),o<y)return[new r.V(t,o,`${o} is less than the minimum value ${y}`)]}if("maximum"in p){let y=p.maximum;if(Array.isArray(p.maximum)&&(y=p.maximum[f.arrayIndex]),o>y)return[new r.V(t,o,`${o} is greater than the maximum value ${y}`)]}return[]}function ma(f){const t=f.key,o=f.value;if(!r.H(o))return[new r.V(t,o,`object expected, ${r.K(o)} found`)];const p=f.valueSpec,y=r.J(o.type);let b,T,I,D={};const F=y!=="categorical"&&o.property===void 0,z=!F,j=function(Q){const ne=Q.stops;return Array.isArray(ne)&&Array.isArray(ne[0])&&r.H(ne[0][0])}(o),B=uo({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(Q){if(y==="identity")return[new r.V(Q.key,Q.value,'identity function may not have a "stops" property')];let ne=[];const te=Q.value;return ne=ne.concat(Fr({key:Q.key,value:te,valueSpec:Q.valueSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:$})),Array.isArray(te)&&te.length===0&&ne.push(new r.V(Q.key,te,"array must have at least one stop")),ne},default:function(Q){return bn({key:Q.key,value:Q.value,valueSpec:p,style:Q.style,styleSpec:Q.styleSpec})}}});return y==="identity"&&F&&B.push(new r.V(f.key,f.value,'missing required property "property"')),y==="identity"||o.stops||B.push(new r.V(f.key,f.value,'missing required property "stops"')),y==="exponential"&&p.expression&&!r.M(p)&&B.push(new r.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(z&&!r.N(p)?B.push(new r.V(f.key,f.value,"property functions not supported")):F&&!r.O(p)&&B.push(new r.V(f.key,f.value,"zoom functions not supported"))),y!=="categorical"&&!j||o.property!==void 0||B.push(new r.V(f.key,f.value,'"property" property is required')),B;function $(Q){let ne=[];const te=Q.value,se=Q.key;if(!Array.isArray(te))return[new r.V(se,te,`array expected, ${r.K(te)} found`)];if(te.length!==2)return[new r.V(se,te,`array length 2 expected, length ${te.length} found`)];if(j){if(!r.H(te[0]))return[new r.V(se,te,`object expected, ${r.K(te[0])} found`)];const me=te[0];if(me.zoom===void 0)return[new r.V(se,te,"object stop key must have zoom")];if(me.value===void 0)return[new r.V(se,te,"object stop key must have value")];const ce=r.J(me.zoom);if(typeof ce!="number")return[new r.V(se,me.zoom,"stop zoom values must be numbers")];if(I&&I>ce)return[new r.V(se,me.zoom,"stop zoom values must appear in ascending order")];ce!==I&&(I=ce,T=void 0,D={}),ne=ne.concat(uo({key:`${se}[0]`,value:te[0],valueSpec:{zoom:{}},style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:Da,value:Z}}))}else ne=ne.concat(Z({key:`${se}[0]`,value:te[0],style:Q.style,styleSpec:Q.styleSpec},te));return r.Q(r.S(te[1]))?ne.concat([new r.V(`${se}[1]`,te[1],"expressions are not allowed in function stops.")]):ne.concat(bn({key:`${se}[1]`,value:te[1],valueSpec:p,style:Q.style,styleSpec:Q.styleSpec}))}function Z(Q,ne){const te=r.K(Q.value),se=r.J(Q.value),me=Q.value!==null?Q.value:ne;if(b){if(te!==b)return[new r.V(Q.key,me,`${te} stop domain type must match previous stop domain type ${b}`)]}else b=te;if(te!=="number"&&te!=="string"&&te!=="boolean"&&typeof se!="number"&&typeof se!="string"&&typeof se!="boolean")return[new r.V(Q.key,me,"stop domain value must be a number, string, or boolean")];if(te!=="number"&&y!=="categorical"){let ce=`number expected, ${te} found`;return r.N(p)&&y===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(Q.key,me,ce)]}return y!=="categorical"||te!=="number"||typeof se=="number"&&isFinite(se)&&Math.floor(se)===se?y!=="categorical"&&te==="number"&&typeof se=="number"&&typeof T=="number"&&T!==void 0&&se<T?[new r.V(Q.key,me,"stop domain values must appear in ascending order")]:(T=se,y==="categorical"&&se in D?[new r.V(Q.key,me,"stop domain values must be unique")]:(D[se]=!0,[])):[new r.V(Q.key,me,`integer expected, found ${String(se)}`)]}}function _o(f){const t=(f.expressionContext==="property"?r.W:r.U)(r.S(f.value),f.valueSpec);if(t.result==="error")return t.value.map(p=>new r.V(`${f.key}${p.key}`,f.value,p.message));const o=t.value.expression||t.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!o.outputDefined())return[new r.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!r.Z(o))return[new r.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Oo(o,f);if(f.expressionContext==="appearance")return ba(o,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!r.X(o,["zoom","feature-state"]))return[new r.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!r.Y(o))return[new r.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Oo(f,t){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const y of t.valueSpec.expression.parameters)o.delete(y);if(o.size===0)return[];const p=[];return f instanceof r._&&o.has(f.name)?[new r.V(t.key,t.value,`["${f.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(f.eachChild(y=>{p.push(...Oo(y,t))}),p)}function ba(f,t){const o=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const y of t.valueSpec.expression.parameters)o.add(y);if(o.size===0)return[];const p=[];return f instanceof r._&&!o.has(f.name)?[new r.V(t.key,t.value,`["${f.name}"] is not an allowed parameter`)]:(f.eachChild(y=>{p.push(...ba(y,t))}),p)}function Uo(f){const t=f.key,o=f.value,p=f.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(r.J(o))===-1&&y.push(new r.V(t,o,`expected one of [${p.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(p.values).indexOf(r.J(o))===-1&&y.push(new r.V(t,o,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(o)} found`)),y}function Io(f){return r.a2(r.S(f.value))?_o(Object.assign({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):jo(f)}function jo(f){const t=f.value,o=f.key;if(!Array.isArray(t))return[new r.V(o,t,`array expected, ${r.K(t)} found`)];if(t.length<1)return[new r.V(o,t,"filter array must have at least 1 element")];const p=f.styleSpec;let y=Uo({key:`${o}[0]`,value:t[0],valueSpec:p.filter_operator});switch(r.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&r.J(t[1])==="$type"&&y.push(new r.V(o,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new r.V(o,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(r.a0(t[1])||y.push(new r.V(`${o}[1]`,t[1],`string expected, ${r.K(t[1])} found`)));for(let b=2;b<t.length;b++)r.J(t[1])==="$type"?y=y.concat(Uo({key:`${o}[${b}]`,value:t[b],valueSpec:p.geometry_type})):r.a0(t[b])||r.L(t[b])||r.$(t[b])||y.push(new r.V(`${o}[${b}]`,t[b],`string, number, or boolean expected, ${r.K(t[b])} found.`));break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)y=y.concat(jo({key:`${o}[${b}]`,value:t[b],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":t.length!==2?y.push(new r.V(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):r.a0(t[1])||y.push(new r.V(`${o}[1]`,t[1],`string expected, ${r.K(t[1])} found`))}return y}function Yo(f,t){const o=f.key,p=f.style,y=f.layer,b=f.styleSpec,T=f.value,I=f.objectKey,D=b[`${t}_${f.layerType}`];if(!D)return[];const F=I.match(/^(.*)-use-theme$/);if(F&&D[F[1]])return r.Q(r.S(T))?[].concat(bn({key:o,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:I})):bn({key:o,value:T,valueSpec:{type:"string"},style:p,styleSpec:b});const z=I.match(/^(.*)-transition$/);if(t==="paint"&&z&&D[z[1]]&&D[z[1]].transition)return bn({key:o,value:T,valueSpec:b.transition,style:p,styleSpec:b});const j=f.valueSpec||D[I];if(!j)return[new r.a3(o,T,`unknown property "${I}"`)];let B;if(r.a0(T)&&r.N(j)&&!j.tokens&&(B=/^{([^}]+)}$/.exec(T))){const Z=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new r.V(o,T,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${Z}.`)]}const $=[];if(f.layerType==="symbol")I!=="text-field"||!p||p.glyphs||p.imports||$.push(new r.V(o,T,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&r.a4(r.S(T))&&r.J(T.type)==="identity"&&$.push(new r.V(o,T,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&t==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&r.N(j)&&(r.a5(j)||r.O(j))){const Z=r.W(r.S(T),j).value,Q="expression"in Z&&Z.expression||"_styleExpression"in Z&&Z._styleExpression&&Z._styleExpression.expression;Q&&!r.X(Q,["measure-light"])&&(I==="model-emissive-strength"&&r.Y(Q)&&r.Z(Q)||$.push(new r.V(o,T,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return $.concat(bn({key:f.key,value:T,valueSpec:j,style:p,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:I}))}function xs(f){return Yo(f,"paint")}function $o(f){return Yo(f,"layout")}function Fi(f){let t=[];const o=f.value,p=f.key,y=f.style,b=f.styleSpec;if(!r.H(o))return[new r.V(p,o,"object expected")];o.type||o.ref||t.push(new r.V(p,o,'either "type" or "ref" is required'));let T=r.J(o.type);const I=r.J(o.ref);if(o.id){const D=r.J(o.id);for(let F=0;F<f.arrayIndex;F++){const z=y.layers[F];r.J(z.id)===D&&t.push(new r.V(p,o.id,`duplicate layer id "${D}", previously used at line ${z.id.__line__}`))}}if("ref"in o){let D;["type","source","source-layer","filter","layout"].forEach(F=>{F in o&&t.push(new r.V(p,o[F],`"${F}" is prohibited for ref layers`))}),y.layers.forEach(F=>{r.J(F.id)===I&&(D=F)}),D?D.ref?t.push(new r.V(p,o.ref,"ref cannot reference another ref layer")):T=r.J(D.type):typeof I=="string"&&t.push(new r.V(p,o.ref,`ref layer "${I}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(o.source)if(r.a0(o.source)){const D=y.sources&&y.sources[o.source],F=D&&r.J(D.type);D?F==="vector"&&T==="raster"?t.push(new r.V(p,o.source,`layer "${o.id}" requires a raster source`)):F==="raster"&&T!=="raster"?t.push(new r.V(p,o.source,`layer "${o.id}" requires a vector source`)):F!=="vector"||o["source-layer"]?F==="raster-dem"&&T!=="hillshade"?t.push(new r.V(p,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):F!=="raster-array"||["raster","raster-particle"].includes(T)?T==="line"&&o.paint&&(o.paint["line-gradient"]||o.paint["line-trim-offset"])&&F==="geojson"&&!D.lineMetrics?t.push(new r.V(p,o,`layer "${o.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):T==="raster-particle"&&F!=="raster-array"&&t.push(new r.V(p,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):t.push(new r.V(p,o.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new r.V(p,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new r.V(p,o.source,`source "${o.source}" not found`))}else t.push(new r.V(`${p}.source`,o.source,'"source" must be a string'));else t.push(new r.V(p,o,'missing required property "source"'));return t=t.concat(uo({key:p,value:o,valueSpec:b.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>bn({key:`${p}.type`,value:o.type,valueSpec:b.layer.type,style:f.style,styleSpec:f.styleSpec,object:o,objectKey:"type"}),filter:D=>Io(Object.assign({layerType:T},D)),layout:D=>uo({layer:o,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":F=>$o(Object.assign({layerType:T},F))}}),paint:D=>uo({layer:o,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":F=>xs(Object.assign({layerType:T,layer:o},F))}}),appearances(D){const F=Fr({key:D.key,value:D.value,valueSpec:D.valueSpec,style:D.style,styleSpec:D.styleSpec,arrayElementValidator:B=>function($){const{key:Z,layer:Q,layerType:ne}=$,te=r.J($.value),se=r.J(te.name),me=r.J(te.condition),ce=uo({key:Z,value:te,valueSpec:$.styleSpec.appearance,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{condition:Ce=>function(_e){const Re=[];return Re.push(..._o({key:_e.key,value:_e.object.condition,valueSpec:r.a6.appearance.condition,expressionContext:"appearance"})),Re}(Object.assign({layer:Q,layerType:ne},Ce)),properties:Ce=>function(_e){const Re=[],{styleSpec:Ae,layer:Te,layerType:De}=_e,He=Ae[`paint_${De}`],Ue=Ae[`layout_${De}`],rt=_e.object[_e.objectKey];for(const Qe in rt){const lt=Qe in He?"paint":Qe in Ue?"layout":void 0;if(!lt){Re.push(new r.V(_e.key,Qe,`unknown property "${Qe}" for layer type "${De}"`));continue}const Lt=Object.assign({},_e,{key:`${_e.key}.${Qe}`,object:rt,objectKey:Qe,layer:Te,layerType:De,value:rt[Qe],valueSpec:lt==="paint"?He[Qe]:Ue[Qe]});Re.push(...Yo(Lt,lt))}return Re}(Object.assign({layer:Q,layerType:ne},Ce))}});return se!=="hidden"&&me===void 0&&ce.push(new r.V($.key,"name",'Appearance with name different than "hidden" must have a condition')),ce}(Object.assign({layerType:T,layer:o},B))}),z=Array.isArray(D.value)?D.value:[],j=new Set;return z.forEach((B,$)=>{const Z=r.J(B.name);if(Z)if(j.has(Z)){const Q=r.J(o.id);F.push(new r.V(D.key,Z,`Duplicated appearance name "${Z}" for layer "${Q}"`))}else j.add(Z)}),F}}})),t}function an({key:f,value:t}){return r.a0(t)?[]:[new r.V(f,t,`string expected, ${r.K(t)} found`)]}const ir={promoteId:function f({key:t,value:o}){if(r.a0(o))return an({key:t,value:o});if(Array.isArray(o)){const y=[],b=r.S(o),T=r.U(b);return T.result==="error"&&T.value.forEach(I=>{y.push(new r.V(`${t}${I.key}`,null,`${I.message}`))}),r.X(T.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||y.push(new r.V(`${t}`,null,"promoteId expression should be only feature dependent")),y}if(!r.H(o))return[new r.V(t,o,`string, expression or object expected, "${r.K(o)}" found`)];const p=[];for(const y in o)p.push(...f({key:`${t}.${y}`,value:o[y]}));return p}};function jr(f){const t=f.value,o=f.key,p=f.styleSpec,y=f.style;if(!r.H(t))return[new r.V(o,t,`object expected, ${r.K(t)} found`)];if(!("type"in t))return[new r.V(o,t,'"type" is required')];const b=r.J(t.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&("url"in t||"tiles"in t||T.push(new r.a3(o,t,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(uo({key:o,value:t,valueSpec:p[`source_${b.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:ir})),T;case"geojson":if(T=uo({key:o,value:t,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:ir}),"cluster"in t&&"clusterProperties"in t){if(!r.H(t.clusterProperties))return[new r.V(`${o}.clusterProperties`,t,`object expected, ${r.K(t)} found`)];for(const I in t.clusterProperties){const D=t.clusterProperties[I];if(!Array.isArray(D))return[new r.V(`${o}.clusterProperties.${I}`,D,"array expected")];const[F,z]=D,j=typeof F=="string"?[F,["accumulated"],["get",I]]:F;T.push(..._o({key:`${o}.${I}.map`,value:z,expressionContext:"cluster-map"})),T.push(..._o({key:`${o}.${I}.reduce`,value:j,expressionContext:"cluster-reduce"}))}}return T;case"video":return uo({key:o,value:t,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return uo({key:o,value:t,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new r.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Uo({key:`${o}.type`,value:t.type,valueSpec:{values:jn(p)}})}}function jn(f){return f.source.reduce((t,o)=>{const p=f[o];return p.type.type==="enum"&&(t=t.concat(Object.keys(p.type.values||{}))),t},[])}function yo(f){const t=f.value,o=f.styleSpec,p=o.light,y=f.style;if(t===void 0)return[];if(!r.H(t))return[new r.V("light",t,`object expected, ${r.K(t)} found`)];let b=[];for(const T in t){const I=T.match(/^(.*)-transition$/),D=T.match(/^(.*)-use-theme$/);b=b.concat(D&&p[D[1]]?bn({key:T,value:t[T],valueSpec:{type:"string"},style:y,styleSpec:o}):I&&p[I[1]]&&p[I[1]].transition?bn({key:T,value:t[T],valueSpec:o.transition,style:y,styleSpec:o}):p[T]?bn({key:T,value:t[T],valueSpec:p[T],style:y,styleSpec:o}):[new r.V(T,t[T],`unknown property "${T}"`)])}return b}function To(f){const t=f.value;if(!t)return[];const o=f.key;if(!r.H(t))return[new r.V(o,t,`object expected, ${r.K(t)} found`)];let p=[];const y=f.styleSpec,b=y["light-3d"],T=f.style,I=f.style.lights;for(const z of["type","id"])if(!(z in t))return p=p.concat([new r.V(o,t,`missing property "${z}"`)]),p;if(!r.a0(t.type))return p=p.concat([new r.V(`${o}.type`,t.type,"string expected")]),p;if(I)for(let z=0;z<f.arrayIndex;z++){const j=r.J(t.type),B=I[z];r.J(B.type)===j&&p.push(new r.V(o,t.id,`duplicate light type "${t.type}", previously defined at line ${B.id.__line__}`))}const D=`properties_light_${t.type}`;if(!(D in y))return p=p.concat([new r.V(`${o}.type`,t,`Invalid light type ${t.type}`)]),p;const F=y[D];for(const z in t)if(z==="properties"){const j=t[z];if(!r.H(j))return p=p.concat([new r.V("properties",j,`object expected, ${r.K(j)} found`)]),p;for(const B in j){const $=B.match(/^(.*)-transition$/),Z=B.match(/^(.*)-use-theme$/);p=p.concat(Z&&F[Z[1]]?bn({key:z,value:j[B],valueSpec:{type:"string"},style:T,styleSpec:y}):$&&F[$[1]]&&F[$[1]].transition?bn({key:z,value:t[z],valueSpec:y.transition,style:T,styleSpec:y}):F[B]?bn({key:B,value:j[B],valueSpec:F[B],style:T,styleSpec:y}):[new r.a3(f.key,j[B],`unknown property "${B}"`)])}}else p=p.concat(b[z]?bn({key:z,value:t[z],valueSpec:b[z],style:T,styleSpec:y}):[new r.a3(z,t[z],`unknown property "${z}"`)]);return p}function Wo(f){const t=f.value,o=f.key,p=f.style,y=f.styleSpec,b=y.terrain;if(t==null)return[];if(!r.H(t))return[new r.V("terrain",t,`object expected, ${r.K(t)} found`)];let T=[];for(const I in t){const D=I.match(/^(.*)-transition$/),F=I.match(/^(.*)-use-theme$/);T=T.concat(F&&b[F[1]]?bn({key:I,value:t[I],valueSpec:{type:"string"},style:p,styleSpec:y}):D&&b[D[1]]&&b[D[1]].transition?bn({key:I,value:t[I],valueSpec:y.transition,style:p,styleSpec:y}):b[I]?bn({key:I,value:t[I],valueSpec:b[I],style:p,styleSpec:y}):[new r.a3(I,t[I],`unknown property "${I}"`)])}if(t.source)if(r.a0(t.source)){const I=p.sources&&p.sources[t.source],D=I&&r.J(I.type);I?D!=="raster-dem"&&T.push(new r.V(`${o}.source`,t.source,`terrain cannot be used with a source of type ${D}, it only be used with a "raster-dem" source type`)):T.push(new r.V(`${o}.source`,t.source,`source "${t.source}" not found`))}else T.push(new r.V(`${o}.source`,t.source,"source must be a string"));else T.push(new r.V(o,t,'terrain is missing required property "source"'));return T}function qr(f){const t=f.value,o=f.style,p=f.styleSpec,y=p.fog;if(t===void 0)return[];if(!r.H(t))return[new r.V("fog",t,`object expected, ${r.K(t)} found`)];let b=[];for(const T in t){const I=T.match(/^(.*)-transition$/),D=T.match(/^(.*)-use-theme$/);b=b.concat(D&&y[D[1]]?bn({key:T,value:t[T],valueSpec:{type:"string"},style:o,styleSpec:p}):I&&y[I[1]]&&y[I[1]].transition?bn({key:T,value:t[T],valueSpec:p.transition,style:o,styleSpec:p}):y[T]?bn({key:T,value:t[T],valueSpec:y[T],style:o,styleSpec:p}):[new r.a3(T,t[T],`unknown property "${T}"`)])}return b}const wr={"*":()=>[],array:Fr,boolean:function(f){const t=f.value,o=f.key;return r.$(t)?[]:[new r.V(o,t,`boolean expected, ${r.K(t)} found`)]},number:Da,color:function({key:f,value:t}){return r.a0(t)?r.a1.parseCSSColor(t)===null?[new r.V(f,t,`color expected, "${t}" found`)]:[]:[new r.V(f,t,`color expected, ${r.K(t)} found`)]},enum:Uo,filter:Io,function:ma,layer:Fi,object:uo,source:jr,model:r.a7,light:yo,"light-3d":To,terrain:Wo,fog:qr,string:an,formatted:function(f){return an(f).length===0?[]:_o(f)},resolvedImage:function(f){return an(f).length===0?[]:_o(f)},projection:function(f){const t=f.value,o=f.styleSpec,p=o.projection,y=f.style;if(r.H(t)){let b=[];for(const T in t)b=b.concat(bn({key:T,value:t[T],valueSpec:p[T],style:y,styleSpec:o}));return b}return r.a0(t)?[]:[new r.V("projection",t,`object or string expected, ${r.K(t)} found`)]},import:function(f){const t=f.key,{value:o,styleSpec:p}=f;if(!r.H(o))return[new r.V(t,o,"import must be an object")];const{data:y,...b}=o;Object.defineProperty(b,"__line__",{value:o.__line__,enumerable:!1});let T=uo(Object.assign({},f,{value:b,valueSpec:p.import}));return r.J(b.id)===""&&T.push(new r.V(`${f.key}.id`,b,"import id can't be an empty string")),y&&(T=T.concat(ga(y,p,{key:`${f.key}.data`}))),T},iconset:function(f){const t=f.value,o=f.key,p=f.styleSpec,y=f.style;if(!r.H(t))return[new r.V(o,t,"object expected")];if(!t.type)return[new r.V(o,t,'"type" is required')];const b=r.J(t.type);let T=[];if(T=T.concat(uo({key:o,value:t,valueSpec:p[`iconset_${b}`],style:y,styleSpec:p})),function(I,D){return!(I!=="source"||!D.source)}(b,t)){const I=y.sources&&y.sources[t.source],D=I&&r.J(I.type);I?D!=="raster-array"&&T.push(new r.V(o,t.source,`iconset cannot be used with a source of type ${String(D)}, it only be used with a "raster-array" source type`)):T.push(new r.V(o,t.source,`source "${t.source}" not found`))}return T}};function bn(f,t=!1){const o=f.value,p=f.valueSpec,y=f.styleSpec;if(p.expression){if(r.a4(r.J(o)))return ma(f);if(r.Q(r.S(o)))return _o(f)}if(p.type&&wr[p.type]){const b=wr[p.type](f);return t===!0&&b.length>0&&Array.isArray(f.value)?_o(f):b}return uo(Object.assign({},f,{valueSpec:p.type?y[p.type]:p}))}function uo(f){const t=f.key,o=f.value,p=f.valueSpec||{},y=f.objectElementValidators||{},b=f.style,T=f.styleSpec;if(!r.H(o))return[new r.V(t,o,`object expected, ${r.K(o)} found`)];let I=[];for(const D in o){const F=D.split(".")[0];let z;y[F]?z=y[F]:p[F]?z=bn:y["*"]?z=y["*"]:p["*"]&&(z=bn),z?I=I.concat(z({key:(t&&`${t}.`)+D,value:o[D],valueSpec:p[F]||p["*"],style:b,styleSpec:T,object:o,objectKey:D},o)):I.push(new r.a3(t,o[D],`unknown property "${D}"`))}for(const D in p){if(y[D])continue;const F=p[D];F.required&&F.default===void 0&&o[D]===void 0&&I.push(new r.V(t,o,`missing required property "${D}"`))}return I}function wa({key:f,value:t}){const o=an({key:f,value:t});if(o.length)return o;const p=t;return p.indexOf("{fontstack}")===-1&&o.push(new r.V(f,t,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&o.push(new r.V(f,t,'"glyphs" url must include a "{range}" token')),o}function ga(f,t=r.a6,o={}){return uo({key:o.key||"",value:f,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:f,objectElementValidators:{glyphs:wa}})}function ra(f,t=r.a6){return ie(ga(f,t))}const tc=f=>ie(jr(f)),ml=f=>ie(yo(f)),ic=f=>ie(To(f)),Ks=f=>ie(Wo(f)),Tt=f=>ie(qr(f)),Ta=f=>ie(function(t){const o=t.value,p=t.style,y=t.styleSpec,b=y.snow;if(o===void 0)return[];if(!r.H(o))return[new r.V("snow",o,`object expected, ${r.K(o)} found`)];let T=[];for(const I in o){const D=I.match(/^(.*)-transition$/);T=T.concat(D&&b[D[1]]&&b[D[1]].transition?bn({key:I,value:o[I],valueSpec:y.transition,style:p,styleSpec:y}):b[I]?bn({key:I,value:o[I],valueSpec:b[I],style:p,styleSpec:y}):[new r.a3(I,o[I],`unknown property "${I}"`)])}return T}(f)),Ga=f=>ie(function(t){const o=t.value,p=t.style,y=t.styleSpec,b=y.rain;if(o===void 0)return[];if(!r.H(o))return[new r.V("rain",o,`object expected, ${r.K(o)} found`)];let T=[];for(const I in o){const D=I.match(/^(.*)-transition$/);T=T.concat(D&&b[D[1]]&&b[D[1]].transition?bn({key:I,value:o[I],valueSpec:y.transition,style:p,styleSpec:y}):b[I]?bn({key:I,value:o[I],valueSpec:b[I],style:p,styleSpec:y}):[new r.a3(I,o[I],`unknown property "${I}"`)])}return T}(f)),Ma=f=>ie(Fi(f)),hn=f=>ie(Io(f)),Ko=f=>ie(xs(f)),it=f=>ie($o(f)),bi=f=>ie(r.a7(f));function ie(f){return f.slice().sort((t,o)=>t.line&&o.line?t.line-o.line:0)}function W(f,t){let o=!1;if(t&&t.length)for(const p of t)p instanceof r.a3?r.w(p.message):(f.fire(new r.y(new Error(p.message))),o=!0);return o}const Y=r.a6.light;let ue;class we extends r.E{constructor(t,o="flat"){super(),this._transitionable=new r.a8(ue||(ue=new r.a9({anchor:new r.aa(Y.anchor),position:new r.ab(Y.position),color:new r.aa(Y.color),intensity:new r.aa(Y.intensity)}))),this.setLight(t,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o,p={}){this._validate(ml,t,p)||(this._transitionable.setTransitionOrValue(t),this.id=o)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,p){return(!p||p.validate!==!1)&&W(this,t.call(ra,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}const ye=r.a6.terrain;let Me=class extends r.E{constructor(f,t,o,p,y){super(),this.scope=o,this._transitionable=new r.a8(new r.a9({source:new r.aa(ye.source),exaggeration:new r.aa(ye.exaggeration)}),o,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=y}get(){return this._transitionable.serialize()}set(f,t){this._transitionable.setTransitionOrValue(f,t)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new r.ac(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const t=f.value.expression;if(!t)return null;let o=-1,p=-1,y=1;for(const b of t.zoomStops)y=t.evaluate(new r.ac(b,{worldview:this.worldview})),y>.01?(o=b,p=-1):p=b;return y<.01&&o>0&&p>o?[o,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof r.ad}};const je=45,ze=65,We=.05;function xt(f,t,o,p){const y=r.ah(je,ze,o),[b,T]=ht(f,p);let I=1-Math.min(1,Math.exp((t-b)/(T-b)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*y*f.alpha}function ht(f,t){const o=.5/Math.tan(.5*t);return[f.range[0]+o,f.range[1]+o]}function ti(f,t,o,p,y){const b=r.af([],[t,o,p],y.mercatorFogMatrix);return xt(f,r.ag(b),y.pitch,y._fov)}function Ri(f,t,o,p,y,b,T){const I=[[o,p,0],[y,p,0],[y,b,0],[o,b,0]];let D=Number.MAX_VALUE,F=-Number.MAX_VALUE;for(const z of I){const j=r.af([],z,t),B=r.ag(j);D=Math.min(D,B),F=Math.max(F,B)}return[xt(f,D,T.pitch,T._fov),xt(f,F,T.pitch,T._fov)]}const xi=r.a6.fog;class ei extends r.E{constructor(t,o,p,y){super();const b=new r.a9({range:new r.aa(xi.range),color:new r.aa(xi.color),"color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.aa(xi["high-color"]),"high-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.aa(xi["space-color"]),"space-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.aa(xi["horizon-blend"]),"star-intensity":new r.aa(xi["star-intensity"]),"vertical-range":new r.aa(xi["vertical-range"])});this._transitionable=new r.a8(b,p,new Map(y)),this.set(t,y),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new r.ai(b),this.scope=p}get state(){const t=this._transform,o=t.projection.name==="globe",p=r.aj(t.zoom),y=this.properties.get("range"),b=[.5,3];return{range:o?[r.ak(b[0],y[0],p),r.ak(b[1],y[1],p)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,o,p={}){if(this._validate(Tt,t,p))return;const y=Object.assign({},t);for(const b of Object.keys(xi))y[b]===void 0&&(y[b]=xi[b].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ah(je,ze,t))*o.a}getOpacityAtLatLng(t,o){return this._transform.projection.supportsFog?function(p,y,b){const T=r.ae.fromLngLat(y),I=b.elevation?b.elevation.getAtPointOrZero(T):0;return ti(p,T.x,T.y,I,b)}(this.state,t,o):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ri(this.state,o,0,0,r.al,r.al,this._transform)}getOpacityForBounds(t,o,p,y,b){return this._transform.projection.supportsFog?Ri(this.state,t,o,p,y,b,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?ht(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const p of o){const y=t.points[p];let b;if(y[2]>=0)b=y;else{const T=t.points[p-4];b=r.am(T,y,T[2]/(T[2]-y[2]))}if(ti(this.state,b[0],b[1],0,this._transform)>=We)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,p){return(!p||p.validate!==!1)&&W(this,t.call(ra,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let Yi,un,hr,Lr,Ro=class extends r.E{constructor(f,t,o,p){super();const y=Yi||(Yi=new r.a9({density:new r.aa(r.a6.snow.density),intensity:new r.aa(r.a6.snow.intensity),color:new r.aa(r.a6.snow.color),opacity:new r.aa(r.a6.snow.opacity),vignette:new r.aa(r.a6.snow.vignette),"vignette-color":new r.aa(r.a6.snow["vignette-color"]),"center-thinning":new r.aa(r.a6.snow["center-thinning"]),direction:new r.aa(r.a6.snow.direction),"flake-size":new r.aa(r.a6.snow["flake-size"])}));this._transitionable=new r.a8(y,o,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(y),this.scope=o}get state(){const f=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),p=r.an(o[0]),y=-Math.max(r.an(o[1]),.01),b=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],T=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(t.r,t.g,t.b,t.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(f,t,o={}){if(this._validate(Ta,f,o))return;const p=Object.assign({},f),y=r.a6.snow;for(const b of Object.keys(y))p[b]===void 0&&(p[b]=y[b].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,t,o){return(!o||o.validate!==!1)&&W(this,f.call(ra,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}},ho=class extends r.E{constructor(f,t,o,p){super();const y=un||(un=new r.a9({density:new r.aa(r.a6.rain.density),intensity:new r.aa(r.a6.rain.intensity),color:new r.aa(r.a6.rain.color),opacity:new r.aa(r.a6.rain.opacity),vignette:new r.aa(r.a6.rain.vignette),"vignette-color":new r.aa(r.a6.rain["vignette-color"]),"center-thinning":new r.aa(r.a6.rain["center-thinning"]),direction:new r.aa(r.a6.rain.direction),"droplet-size":new r.aa(r.a6.rain["droplet-size"]),"distortion-strength":new r.aa(r.a6.rain["distortion-strength"])}));this._transitionable=new r.a8(y,o,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(y),this.scope=o}get state(){const f=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),p=r.an(o[0]),y=-Math.max(r.an(o[1]),.01),b=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(t.r,t.g,t.b,t.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(f,t,o={}){if(this._validate(Ga,f,o))return;const p=Object.assign({},f),y=r.a6.rain;for(const b of Object.keys(y))p[b]===void 0&&(p[b]=y[b].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,t,o){return(!o||o.validate!==!1)&&W(this,f.call(ra,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}};class to extends r.E{constructor(t,o,p,y){super(),this.scope=p,this._options=t,this.properties=new r.ai(o),this._transitionable=new r.a8(o,p,new Map(y)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,o){this._options=t,this._transitionable.setTransitionOrValue(t.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class nr{constructor(t,o,p){this.screenBounds=t,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=o,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(t,o){let p,y;if(t instanceof r.P||typeof t[0]=="number"){const b=r.P.convert(t);p=[b],y=o.isPointAboveHorizon(b)}else{const b=r.P.convert(t[0]),T=r.P.convert(t[1]),I=b.add(T)._div(2);p=[b,T],y=r.aq(b,T).every(D=>o.isPointAboveHorizon(D))&&o.isPointAboveHorizon(I)}return new nr(p,y,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return r.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const o=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],y=r.aq(o,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<p.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?y[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(y[3]=this.cameraPoint)),r.ar(y,t)}bufferedCameraGeometryGlobe(t){const o=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],y=r.aq(o,p,t),b=this.cameraPoint.clone();switch(3*((b.y>o.y)+(b.y>p.y))+((b.x>o.x)+(b.x>p.x))){case 0:y[0]=b,y[4]=b.clone();break;case 1:y.splice(1,0,b);break;case 2:y[1]=b;break;case 3:y.splice(4,0,b);break;case 5:y.splice(2,0,b);break;case 6:y[3]=b;break;case 7:y.splice(3,0,b);break;case 8:y[2]=b}return y}containsTile(t,o,p,y=0){const b=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/o._pixelsPerMercatorPixel+1,T=p?this._bufferedCameraMercator(b,o):this._bufferedScreenMercator(b,o);let I=t.tileID.wrap+(T.unwrapped?y:0);const D=T.polygon.map(ne=>r.as(t.tileTransform,ne,I));if(!r.at(D,0,0,r.al,r.al))return;I=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const F=this.screenGeometryMercator.polygon.map(ne=>r.au(t.tileTransform,ne,I)),z=F.map(ne=>new r.P(ne[0],ne[1])),j=o.getFreeCameraOptions().position||new r.ae(0,0,0),B=r.au(t.tileTransform,j,I),$=F.map(ne=>{const te=r.av(ne,ne,B);return r.aw(te,te),new r.ax(B,te)}),Z=r.ay(t,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:$,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(Q=r.az(D),Q.min.x=r.aA(Q.min.x,0,r.al),Q.min.y=r.aA(Q.min.y,0,r.al),Q.max.x=r.aA(Q.max.x,0,r.al),Q.max.y=r.aA(Q.max.y,0,r.al),Q),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Z};var Q}_bufferedScreenMercator(t,o){const p=Zr(t);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let y;return y=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),o):{polygon:this.bufferedScreenGeometry(t).map(b=>o.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[p]=y,y}}_bufferedCameraMercator(t,o){const p=Zr(t);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let y;return y=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),o):{polygon:this.bufferedCameraGeometry(t).map(b=>o.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[p]=y,y}}_projectAndResample(t,o){const p=function(b,T){const I=r.aB([],T.pixelMatrix,T.globeMatrix),D=[0,-r.aD,0,1],F=[0,r.aD,0,1],z=[0,0,0,1];r.aC(D,D,I),r.aC(F,F,I),r.aC(z,z,I);const j=new r.P(D[0]/D[3],D[1]/D[3]),B=new r.P(F[0]/F[3],F[1]/F[3]),$=r.aE(b,j)&&D[3]<z[3],Z=r.aE(b,B)&&F[3]<z[3];if(!$&&!Z)return null;const Q=function(Re,Ae,Te){for(let De=1;De<Re.length;De++){const He=Rr(Ae.pointCoordinate3D(Re[De-1]).x),Ue=Rr(Ae.pointCoordinate3D(Re[De]).x);if(Te<0){if(He<Ue)return{idx:De,t:-He/(Ue-1-He)}}else if(Ue<He)return{idx:De,t:(1-He)/(Ue+1-He)}}return null}(b,T,$?-1:1);if(!Q)return null;const{idx:ne,t:te}=Q;let se=ne>1?Sn(b.slice(0,ne),T):[],me=ne<b.length?Sn(b.slice(ne),T):[];se=se.map(Re=>new r.P(Rr(Re.x),Re.y)),me=me.map(Re=>new r.P(Rr(Re.x),Re.y));const ce=[...se];ce.length===0&&ce.push(me[me.length-1]);const Ce=r.ak(ce[ce.length-1].y,(me.length===0?se[0]:me[0]).y,te);let _e;return _e=$?[new r.P(0,Ce),new r.P(0,0),new r.P(1,0),new r.P(1,Ce)]:[new r.P(1,Ce),new r.P(1,1),new r.P(0,1),new r.P(0,Ce)],ce.push(..._e),me.length===0?ce.push(se[0]):ce.push(...me),{polygon:ce.map(Re=>new r.ae(Re.x,Re.y)),unwrapped:!1}}(t,o);if(p)return p;const y=function(b,T){let I=!1,D=-1/0,F=0;for(let j=0;j<b.length-1;j++)b[j].x>D&&(D=b[j].x,F=j);for(let j=0;j<b.length-1;j++){const B=(F+j)%(b.length-1),$=b[B],Z=b[B+1];Math.abs($.x-Z.x)>.5&&($.x<Z.x?($.x+=1,B===0&&(b[b.length-1].x+=1)):(Z.x+=1,B+1===b.length-1&&(b[0].x+=1)),I=!0)}const z=r.aF(T.center.lng);return I&&z<Math.abs(z-1)&&b.forEach(j=>{j.x-=1}),{polygon:b,unwrapped:I}}(Sn(t,o).map(b=>new r.P(Rr(b.x),b.y)),o);return{polygon:y.polygon.map(b=>new r.ae(b.x,b.y)),unwrapped:y.unwrapped}}}function Sn(f,t){return r.aG(f,o=>{const p=t.pointCoordinate3D(o);o.x=p.x,o.y=p.y},1/256)}function Rr(f){return f<0?1+f%1:f%1}function Zr(f){return 100*f|0}function sr(f,t,o,p,y){const b=function(I,D){if(I)return y(I);if(D){if(f.url&&D.tiles&&f.tiles&&delete f.tiles,D.variants){if(!Array.isArray(D.variants))return y(new Error("variants must be an array"));for(const z of D.variants){if(z==null||typeof z!="object"||z.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(z.capabilities))return y(new Error("capabilities must be an array"));if(z.capabilities.length===1&&z.capabilities[0]==="meshopt"){D=Object.assign(D,z);break}}}const F=r.aH(Object.assign({},D,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);F.tiles=t.canonicalizeTileset(F,f.url),y(null,F)}},T=function(I,D,F){if(!I)return null;if(!D&&!F)return I;F=F||I.worldview_default;const z=Object.values(I.language||{});if(z.length===0)return null;const j=Object.values(I.worldview||{});if(j.length===0)return null;const B=z.every(Z=>Z===D),$=j.every(Z=>Z===F);return B&&$?I:D in(I.language_options||{})||F in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(f.data,o,p);return T?r.o.frame(()=>b(null,T)):f.url?r.m(t.transformRequest(t.normalizeSourceURL(f.url,null,o,p),r.R.Source),b):r.o.frame(()=>{const{data:I,...D}=f;b(null,D)})}function Sr(f,t){const o=Math.pow(2,t.z),p=Math.floor(r.aF(f.getWest())*o),y=Math.floor(r.aJ(f.getNorth())*o),b=Math.ceil(r.aF(f.getEast())*o),T=Math.ceil(r.aJ(f.getSouth())*o);return t.x>=p&&t.x<b&&t.y>=y&&t.y<T}class fo{constructor(t,o,p){this.bounds=t?r.aI.convert(this.validateBounds(t)):null,this.minzoom=o||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const o of t)this.extraBounds.push(r.aI.convert(this.validateBounds(o)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Sr(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const o of this.extraBounds)if(Sr(o,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const o=new fo(t.bounds,t.minzoom,t.maxzoom);return o.addExtraBounds(t.extra_bounds),o}}class oa extends r.E{constructor(t,o,p,y){if(super(),this.id=t,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,r.aH(o,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new r.aK}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=sr(this._options,this.map._requestManager,o,p,(y,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new r.y(y));else if(b){if(Object.assign(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of b.vector_layers)this.vectorLayerIds.push(T.id),b.worldview&&b.worldview[T.source]&&this.localizableLayerIds.add(T.id)}this.tileBounds=fo.fromTileJSON(b),Mn(b.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(y)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,o){const p=t.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(p),b=this.map._requestManager.transformRequest(y,r.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,I=T?{image:T.image.clone()}:null,D={request:b,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&r.h(p)&&(D.localizableLayerIds=this.localizableLayerIds),D.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=o:t.request=t.actor.send("reloadTile",D,F.bind(this));else if(t.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",D,F.bind(this),void 0,!0);else{const z=r.aL.call({deduped:this._deduped},D,(j,B)=>{if(j||!B)F.call(this,j);else{const $=r.aM(B.responseHeaders);D.data={cacheControl:$.cacheControl,expires:$.expires,rawData:B.rawData.slice(0)},t.actor&&t.actor.send("loadTile",D,F.bind(this),void 0,!0)}},!0);t.request={cancel:z}}function F(z,j){return delete t.request,t.aborted?o(null):z&&z.status!==404?o(z):(j&&j.resourceTiming&&(t.resourceTiming=j.resourceTiming),this.map._refreshExpiredTiles&&j&&t.setExpiryData(j),t.loadVectorData(j,this.map.painter),r.aN(this.dispatcher),o(null,j),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ha extends r.E{constructor(t,o,p,y){super(),this.id=t,this.dispatcher=p,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},o),Object.assign(this,r.aH(o,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const o=this.map.getWorldview();this._tileJSONRequest=sr(this._options,this.map._requestManager,null,o,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new r.y(p)):y&&(Object.assign(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map(b=>b.id)),this.tileBounds=fo.fromTileJSON(y),Mn(y.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(p)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){const p=r.o.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);t.request=r.n(this.map._requestManager.transformRequest(y,r.R.Tile),(b,T,I)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(b)return t.state="errored",o(b);if(!T)return o(null);const D=r.aM(I);this.map._refreshExpiredTiles&&t.setExpiryData(D),t.setTexture(T,this.map.painter),t.state="loaded",r.aN(this.dispatcher),o(null)})}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o&&o()}unloadTile(t,o){t.texture&&t.texture instanceof r.T?(t.destroy(!0),t.texture&&t.texture instanceof r.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),o&&o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Fl([f,t],o,p,{scaled:y=!0}={}){const{tileSize:b,buffer:T}=p,{x:I,y:D,z:F}=o;if(!isFinite(I)||!isFinite(D)||!isFinite(F))throw new Error("Invalid MRT header");const z=2**F,j=z*r.aF(f),B=z*r.aJ(t);return function([$,Z],Q,{scaled:ne=!0}={}){if(!Q)throw new Error("bandView is undefined");const{data:te,tileSize:se,buffer:me,offset:ce,scale:Ce,dimension:_e}=Q;if($<-me||$>se+me||Z<-me||Z>se+me)throw new Error(`Point (${$}, ${Z}) out of bounds for tileSize=${se}, buffer=${me}`);const Re=(Z+me)*(se+2*me)+($+me);if(new Uint32Array(te.buffer)[Re]===4294967295)return null;let Ae=[];Ae=ne?[]:new Q.data.constructor(_e);for(let Te=0;Te<_e;Te++)Ae[Te]=Math.round(1e12*(te[_e*Re+Te]*Ce+ce))/1e12;return Ae}([Math.min(Math.max(-T,Math.floor((j-I)*b)),b-1+T),Math.min(Math.max(-T,Math.floor((B-D)*b)),b-1+T)],p,{scaled:y})}class ko extends Ha{constructor(t,o,p,y){super(t,o,p,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},o)}triggerRepaint(t){const o=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);o&&o.enabled&&p&&o._clearRenderCacheForTile(p.id,t.tileID),this.map.triggerRepaint()}loadTile(t,o){const p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(p,r.R.Tile),b={request:y,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=y,t.actor||(t.actor=this.dispatcher.getActor());const T=(I,D,F)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(I)return I.name==="AbortError"?void 0:(t.state="errored",o(I));if(this.map._refreshExpiredTiles&&D){const z=r.aM(F);t.setExpiryData(z)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!D)return o(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=D}o(null)};t.request=this.partial?t.fetchHeader(void 0,T.bind(this)):t.actor.send("loadTile",b,T.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){const p=t.texturePerLayer;if(t.flushAllQueues(),p.size){t.destroy(!0);for(const y of p.values())this.map.painter.saveTileTexture(y)}else t.destroy()}prepareTile(t,o,p,y){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(o,p,y,(b,T)=>{if(b)return t.state="errored",this.fire(new r.y(b)),void this.triggerRepaint(t);T&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(p,T,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find(({id:b})=>b===t),p=o&&o.fields,y=p&&p.bands&&p.bands;return y?y[0]:0}getTextureDescriptor(t,o,p){if(!t)return;const y=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let b=null;o instanceof r.aQ?b=o.paint.get("raster-array-band"):o instanceof r.aR&&(b=o.paint.get("raster-particle-array-band"));const T=b||this.getInitialBand(y);if(T==null)return;if(!t.textureDescriptorPerLayer.get(o.id))return void this.prepareTile(t,y,o.id,T);if(t.updateNeeded(o.id,T)&&!p)return;const I=t.textureDescriptorPerLayer.get(o.id);return Object.assign({},I,{texture:t.texturePerLayer.get(o.id)})}getImages(t,o){const p=new Map;for(const y of t)for(const b of o){const[T,I]=b.split("/"),D=y.getLayer(T);if(!D||!D.hasBand(I)||!D.hasDataForBand(I))continue;const{bytes:F,tileSize:z,buffer:j}=D.getBandView(I),B=z+2*j,$={data:new r.q({width:B,height:B},F),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(b,$)}return p}queryRasterArrayValueByBandId(t,o,p){const y=o._mrt;return new Promise(b=>{const T={},I=new Set;for(const[D,F]of Object.entries(y.layers)){if(p.layerName&&D!==p.layerName)continue;const z={};T[D]=z;for(const{bands:j}of F.dataIndex)for(const B of j)p.bands&&!p.bands.includes(B)||(I.add(r.B(D,B)),o.fetchBand(D,null,B,$=>{r.o.frame(()=>{z[B]=$?null:Fl([t.lng,t.lat],y,F.getBandView(B)),I.delete(r.B(D,B)),I.size===0&&b(T)})},!1))}I.size===0&&b(T)})}_loadTileForQuery(t,o){if(this._loadTileLoaded[t.uid])return void o(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(o);this._loadTilePending[t.uid]=[o];const p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(p,r.R.Tile);t.actor.send("loadTile",{request:y,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(b,T,I)=>{if(b)return this._loadTilePending[t.uid].forEach(D=>D(b,null)),void delete this._loadTilePending[t.uid];if(!T)return this._loadTilePending[t.uid].forEach(D=>D(null,null)),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&T){const D=r.aM(I);t.setExpiryData(D)}t._mrt=T,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach(D=>D(null,T)),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]},void 0,!0)}queryRasterArrayValueByAllBands(t,o,p){return new Promise((y,b)=>{this._loadTileForQuery(o,(T,I)=>{T?b(T):y(I?this.queryRasterArrayValueByBandId(t,o,p):null)})})}queryRasterArrayValue(t,o){const p=r.aS.convert(t),y=this.findLoadedParent(p);return y&&y._mrt?o.bands||!this.partial?this.queryRasterArrayValueByBandId(p,y,o):this.queryRasterArrayValueByAllBands(p,y,o):Promise.resolve(null)}findLoadedParent(t){const o=r.ae.fromLngLat(t,this.map.transform.tileSize),p=this.maxzoom+1,y=1<<p,b=Math.floor(o.x),T=Math.floor((o.x-b)*y),I=Math.floor(o.y*y),D=this.map.style.getSourceCache(this.id),F=new r.aP(p,b,p,T,I);return D.findLoadedParent(F,this.minzoom)}}const os={vector:oa,raster:Ha,"raster-dem":class extends Ha{constructor(f,t,o,p){super(f,t,o,p),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(f,t){const o=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(y,b){y&&(f.state="errored",t(y)),b&&(f.dem=b,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",t(null))}f.request=r.n(this.map._requestManager.transformRequest(o,r.R.Tile),(function(y,b,T){if(delete f.request,f.aborted)f.state="unloaded",t(null);else if(y)f.state="errored",t(y);else if(b){const I=r.aM(T);this.map._refreshExpiredTiles&&f.setExpiryData(I);const D=ImageBitmap&&b instanceof ImageBitmap&&r.r(),F=1-(b.width-r.aO(b.width))/2;F<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const z=D?b:r.o.getImageData(b,F),j={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:z,encoding:this.encoding,padding:F};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",j,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const t=f.canonical,o=Math.pow(2,t.z),p=(t.x-1+o)%o,y=t.x===0?f.wrap-1:f.wrap,b=(t.x+1+o)%o,T=t.x+1===o?f.wrap+1:f.wrap,I={};return I[new r.aP(f.overscaledZ,y,t.z,p,t.y).key]={backfilled:!1},I[new r.aP(f.overscaledZ,T,t.z,b,t.y).key]={backfilled:!1},t.y>0&&(I[new r.aP(f.overscaledZ,y,t.z,p,t.y-1).key]={backfilled:!1},I[new r.aP(f.overscaledZ,f.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},I[new r.aP(f.overscaledZ,T,t.z,b,t.y-1).key]={backfilled:!1}),t.y+1<o&&(I[new r.aP(f.overscaledZ,y,t.z,p,t.y+1).key]={backfilled:!1},I[new r.aP(f.overscaledZ,f.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},I[new r.aP(f.overscaledZ,T,t.z,b,t.y+1).key]={backfilled:!1}),I}},"raster-array":ko,geojson:class extends r.E{constructor(f,t,o,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(p),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const y=r.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*y,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*y,extent:r.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:r.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*y,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const o of this._data.features)t.set(o.id,o);for(const o of f.features)t.set(o.id,o);this._data.features=[...t.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},t),this}getClusterChildren(f,t){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},t),this}getClusterLeaves(f,t,o,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:t,offset:o},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:f},this.workerOptions);t.scope=this.scope;const o=this._data;typeof o=="string"?(t.request=this.map._requestManager.transformRequest(r.o.resolveURL(o),r.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(p,y)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new r.y(p));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(b.resourceTiming=y.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new r.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=r.B(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,t){const o=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,y=p?{image:p.image.clone()}:null,b=this._partialReload,T={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:b,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};f.request=this.actor.send(o,T,(I,D)=>b&&!D?(f.state="loaded",t(null)):(delete f.request,f.destroy(),f.aborted?t(null):I?t(I):(f.loadVectorData(D,this.map.painter,o==="reloadTile"),t(null))),void 0,o==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,t){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aT{constructor(f,t,o,p){super(f,t,o,p),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const t of f.urls)this.urls.push(this.map._requestManager.transformRequest(t,r.R.Source).url);r.aU(this.urls,(t,o)=>{this._loaded=!0,t?this.fire(new r.y(t)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const t=this.video.seekable;f<t.start(0)||f>t.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,t=f.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(f,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aT,model:r.aW,"batched-model":class extends r.E{constructor(f,t,o,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=sr(this._options,this.map._requestManager,t,o,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new r.y(p))):y&&(Object.assign(this,y),y.bounds&&(this.tileBounds=new fo(y.bounds,this.minzoom,this.maxzoom)),Mn(y.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,t){const o=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(o,r.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.o.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=t;else{if(f.buckets){const b=Object.values(f.buckets);for(const T of b)T.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,y.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,y.bind(this),void 0,!0);function y(b,T){return f.aborted?t(null):b&&b.status!==404?t(b):(this.map._refreshExpiredTiles&&T&&f.setExpiryData(T),f.loadModelData(T,this.map.painter),f.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends r.aT{constructor(f,t,o,p){super(f,t,o,p),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(b=>typeof b!="number"))||this.fire(new r.y(new r.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${f}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof r.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends r.E{constructor(f,t,o,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=t,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new fo(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,r.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:t,y:o,z:p}=f.canonical;return this._implementation.hasTile({x:t,y:o,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,t){const{x:o,y:p,z:y}=f.tileID.canonical,b=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:o,y:p,z:y},{signal:b.signal})).then((function(T){return delete f.request,f.aborted?(f.state="unloaded",t(null)):T===void 0?(f.state="errored",t(null)):T===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",t(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(T)?(this.loadTileData(f,T),f.state="loaded",void t(null)):(f.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.name!=="AbortError"&&(f.state="errored",t(T))}),f.request.cancel=()=>b.abort()}loadTileData(f,t){f.setTexture(t,this.map.painter)}unloadTile(f,t){if(f.texture&&f.texture instanceof r.T?(f.destroy(!0),f.texture&&f.texture instanceof r.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:o,y:p,z:y}=f.tileID.canonical;this._implementation.unloadTile({x:o,y:p,z:y})}t&&t()}abortTile(f,t){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=r.B(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},Pa=function(f,t,o,p){const y=new os[t.type](f,t,o,p);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return r.aX(["load","abort","unload","serialize","prepare"],y),y};function Js(f,t,o=""){return`${o}:${t.id||""}:${t.layer.id}:${function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:y,importId:b}=p;return`featureset:${y}${b?`:import:${b}`:""}`}}(f.target)}`}function Ka(f,t,o,p=""){if(f.uniqueFeatureID){const y=Js(f,t,p);if(o.has(y))return!0;o.add(y)}return!1}function bs(f,t,o,p,y=!1){const b=t.sourceCache.transform,T=t.sourceCache.tilesIn(f,t.has3DLayers,y);T.sort(xu);const I=[];for(const D of T){const F=D.tile.queryRenderedFeatures(t,D,o,p,b,y);Object.keys(F).length&&I.push({wrappedTileID:D.tile.tileID.wrapped().key,queryResults:F})}for(const D in t.layers){const F=t.layers[D];if(F.styleLayer){const z=F.styleLayer.queryRenderedFeatures(f,t.sourceCache,p);Object.keys(z).length&&I.push({wrappedTileID:0,queryResults:z})}}return I.length===0?{}:function(D){const F={},z={};for(const j of D){const B=j.queryResults,$=j.wrappedTileID,Z=z[$]=z[$]||{};for(const Q in B){const ne=B[Q],te=Z[Q]=Z[Q]||{},se=F[Q]=F[Q]||[];for(const me of ne)te[me.featureIndex]||(te[me.featureIndex]=!0,se.push(me))}}return F}(I)}function Ic(f,t,o,p,y,b){const T={},I=p.queryRenderedSymbols(f),D=[];for(const F of Object.keys(I).map(Number))D.push(y[F]);D.sort(xu);for(const F of D){const z=F.featureIndex.lookupSymbolFeatures(I[F.bucketInstanceId],F.bucketIndex,F.sourceLayerIndex,t,o,b);for(const j in z){const B=T[j]=T[j]||[],$=z[j];$.sort((Z,Q)=>{const ne=F.featureSortOrder;if(ne){const te=ne.indexOf(Z.featureIndex);return ne.indexOf(Q.featureIndex)-te}return Q.featureIndex-Z.featureIndex});for(const Z of $)B.push(Z)}}return T}function ch(f,t){const o=f.getRenderableIds().map(b=>f.getTileByID(b)),p=[],y={};for(let b=0;b<o.length;b++){const T=o[b],I=T.tileID.canonical.key;y[I]||(y[I]=!0,T.querySourceFeatures(p,t))}return p}function xu(f,t){const o=f.tileID,p=t.tileID;return o.overscaledZ-p.overscaledZ||o.canonical.y-p.canonical.y||o.wrap-p.wrap||o.canonical.x-p.canonical.x}function Gr(f,t){const o={};if(!t)return o;for(const p of f){const y=p.layerIds.map(b=>t.getLayer(b)).filter(Boolean);if(y.length!==0){p.layers=y,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(b=>y.filter(T=>T.id===b)[0]));for(const b of y)o[b.fqid]=p}}return o}const as=32,$a=33,yn=new Uint16Array(8184);for(let f=0;f<2046;f++){let t=f+2,o=0,p=0,y=0,b=0,T=0,I=0;for(1&t?y=b=T=as:o=p=I=as;(t>>=1)>1;){const F=o+y>>1,z=p+b>>1;1&t?(y=o,b=p,o=T,p=I):(o=y,p=b,y=T,b=I),T=F,I=z}const D=4*f;yn[D+0]=o,yn[D+1]=p,yn[D+2]=y,yn[D+3]=b}const ss=new Uint16Array(2178),aa=new Uint8Array(1089),gl=new Uint16Array(1089);function nc(f){return f===0?-.03125:f===32?.03125:0}const $d={type:2,extent:r.al,loadGeometry:()=>[[new r.P(0,0),new r.P(r.al+1,0),new r.P(r.al+1,r.al+1),new r.P(0,r.al+1),new r.P(0,0)]]};class Go{constructor(t,o,p,y,b,T){this.tileID=t,this.uid=r.b1(),this.uses=0,this.tileSize=o,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection),this.worldview=T,this._hasAppearances=null}registerFadeDuration(t){const o=t+this.timeAdded;o<r.o.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,o,p){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Gr(t.buckets,o.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const b=this.buckets[y];if(b instanceof r.b3){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const b=this.buckets[y];if(b instanceof r.b3&&b.hasRTLText){this.hasRTLText=!0,r.b4();break}}this.queryPadding=0;for(const y in this.buckets){const b=this.buckets[y],T=o.style.getOwnLayer(y);if(!T)continue;const I=T.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,I)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new r.b2}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,o,p){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Gr(t.buckets,o.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,o){for(const b in this.buckets){const T=this.buckets[b];if(T.uploadPending()){let I={},D=[],F={zoom:0,pitch:0,brightness:0,worldview:""};if(o){if(o.style){D=o.style.listImages();const z=T.layers[0],j=z.sourceLayer||"_geojsonTileLayer",B=o.style.getLayerSourceCache(z);B&&(I=B._state.getState(j,void 0))}F={zoom:o.transform.zoom||0,pitch:o.transform.pitch||0,brightness:o.style.getBrightness()||0,worldview:o.worldview||""}}T.upload(t,this.tileID.canonical,I,D,F)}}const p=t.gl,y=this.imageAtlas;y&&!y.uploaded&&(this.imageAtlasTexture=new r.T(t,y.image,p.RGBA8,{useMipmap:!!y.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(t,this.glyphAtlasImage,p.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(t,this.lineAtlas.image,p.R8),this.lineAtlas.uploaded=!0)}prepare(t,o,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,p),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=o.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(o)),(this._lastUpdatedBrightness||y||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(o,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const o in this.buckets){const p=this.buckets[o];p.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,p.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,o,p,y,b,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=this.evaluateQueryRenderedFeaturePadding(),D=function(F,z){const j=r.bp([],[.5*F.width,.5*-F.height,1]);return r.bq(j,j,[1,-1,0]),r.aB(j,j,F.calculateProjMatrix(z.toUnwrapped())),Float32Array.from(j)}(b,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:o,pixelPosMatrix:D,transform:y,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:I})}querySourceFeatures(t,o){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const y=p.loadVTLayers(),b=o?o.sourceLayer:"",T=y._geojsonTileLayer||y[b];if(!T)return;const I=r.b5(o&&o.filter),{z:D,x:F,y:z}=this.tileID.canonical,j={z:D,x:F,y:z};for(let B=0;B<T.length;B++){const $=T.feature(B);if(I.needGeometry){const ne=r.b6($,!0);if(!I.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ne,this.tileID.canonical))continue}else if(!I.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),$))continue;const Z=p.getId($,b),Q=new r.b7($,D,F,z,Z);Q.tile=j,t.push(Q)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const o=this.expirationTime;if(t.cacheControl){const p=r.b8(t.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const p=Date.now();let y=!1;if(this.expirationTime>p)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{const b=this.expirationTime-o;b?this.expirationTime=p+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const o in this.buckets)if(t.style.hasLayer(o)&&this.buckets[o].layers.some(p=>p.appearances&&p.appearances.length>0))return!0;return!1}updateBuckets(t,o){if(!this.latestFeatureIndex||!t.style)return;const p=this.latestFeatureIndex.loadVTLayers(),y=t.style.listImages(),b=t.style.getBrightness();for(const T in this.buckets){if(!t.style.hasLayer(T))continue;const I=this.buckets[T],D=I.layers[0],F=D.sourceLayer||"_geojsonTileLayer",z=p[F],j=t.style.getLayerSourceCache(D);let B={};j&&(B=j._state.getState(F,void 0));const $=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Z=Object.keys(B).length>0&&!o;if(I.hasAppearances=I.layers.some(ne=>ne.appearances&&ne.appearances.length>0),(Z&&I.stateDependentLayers.length!==0||o)&&I.update(B,z,y,$,Z?I.stateDependentLayers:I.layers,o,b),Z&&I.stateDependentLayers.length!==0||o||I.hasAppearances){const ne={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};I.updateAppearances(this.tileID.canonical,B,y,ne)}(I instanceof r.b9||I instanceof r.ba)&&t._terrain&&t._terrain.enabled&&j&&I.uploadPending()&&t._terrain._clearRenderCacheForTile(j.id,this.tileID);const Q=t&&t.style&&t.style.getOwnLayer(T);Q&&(this.queryPadding=Math.max(this.queryPadding,Q.queryRadius(I)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=r.o.now()+t}setTexture(t,o){const p=o.context,y=p.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t):(this.texture=new r.T(p,t,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(t,o){const p={};for(const y of o)p[y]=!0;this.dependencies[t]=p}hasDependency(t,o){for(const p of t){const y=this.dependencies[p];if(y){for(const b of o)if(y[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const p=r.bb($d,this.tileID.canonical,this.tileTransform)[0],y=new r.bc,b=new r.bd;for(let T=0;T<p.length;T++){const{x:I,y:D}=p[T];y.emplaceBack(I,D),b.emplaceBack(T)}b.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(b),this._tileDebugBuffer=t.createVertexBuffer(y,r.be.members),this._tileDebugSegments=r.bf.simpleSegment(0,0,y.length,b.length)}_makeTileBoundsBuffers(t,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const p=r.bb($d,this.tileID.canonical,this.tileTransform)[0];let y,b;if(this.isRaster){const T=function(I,D){const F=r.aY(I,D),z=Math.pow(2,I.z);for(let ne=0;ne<$a;ne++)for(let te=0;te<$a;te++){const se=r.aZ((I.x+(te+nc(te))/as)/z),me=r.a_((I.y+(ne+nc(ne))/as)/z),ce=D.project(se,me),Ce=ne*$a+te;ss[2*Ce+0]=Math.round((ce.x*F.scale-F.x)*r.al),ss[2*Ce+1]=Math.round((ce.y*F.scale-F.y)*r.al)}aa.fill(0),gl.fill(0);for(let ne=2045;ne>=0;ne--){const te=4*ne,se=yn[te+0],me=yn[te+1],ce=yn[te+2],Ce=yn[te+3],_e=se+ce>>1,Re=me+Ce>>1,Ae=_e+Re-me,Te=Re+se-_e,De=me*$a+se,He=Ce*$a+ce,Ue=Re*$a+_e,rt=Math.hypot((ss[2*De+0]+ss[2*He+0])/2-ss[2*Ue+0],(ss[2*De+1]+ss[2*He+1])/2-ss[2*Ue+1])>=16;aa[Ue]=aa[Ue]||(rt?1:0),ne<1022&&(aa[Ue]=aa[Ue]||aa[(me+Te>>1)*$a+(se+Ae>>1)]||aa[(Ce+Te>>1)*$a+(ce+Ae>>1)])}const j=new r.a$,B=new r.b0;let $=0;function Z(ne,te){const se=te*$a+ne;return gl[se]===0&&(j.emplaceBack(ss[2*se+0],ss[2*se+1],ne*r.al/as,te*r.al/as),gl[se]=++$),gl[se]-1}function Q(ne,te,se,me,ce,Ce){const _e=ne+se>>1,Re=te+me>>1;if(Math.abs(ne-ce)+Math.abs(te-Ce)>1&&aa[Re*$a+_e])Q(ce,Ce,ne,te,_e,Re),Q(se,me,ce,Ce,_e,Re);else{const Ae=Z(ne,te),Te=Z(se,me),De=Z(ce,Ce);B.emplaceBack(Ae,Te,De)}}return Q(0,0,as,as,as,0),Q(as,as,0,0,0,as),{vertices:j,indices:B}}(this.tileID.canonical,o);y=T.vertices,b=T.indices}else{y=new r.a$,b=new r.b0;for(const{x:I,y:D}of p)y.emplaceBack(I,D,0,0);const T=r.bg(y.int16.subarray(0,4*y.length),void 0,4);for(let I=0;I<T.length;I+=3)b.emplaceBack(T[I],T[I+1],T[I+2])}this._tileBoundsBuffer=t.createVertexBuffer(y,r.bh.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(b),this._tileBoundsSegments=r.bf.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugBuffers(t,o){const p=o.projection;if(!p||p.name!=="globe"||o.freezeTileCoverage)return;const y=this.tileID.canonical,b=r.bi(y,o),T=r.bj(b),I=r.aj(o.zoom);let D;I>0&&(D=r.bk(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,y,o,T,D,I),this._makeGlobeTileDebugTextBuffer(t,y,o,T,D,I)}_globePoint(t,o,p,y,b,T,I){let D=r.bl(t,o,p);if(T){const F=1<<p.z,z=r.aF(y.center.lng),j=r.aJ(y.center.lat),B=(p.x+.5)/F-z;let $=0;B>.5?$=-1:B<-.5&&($=1);let Z=(t/r.al+p.x)/F+$,Q=(o/r.al+p.y)/F;Z=(Z-z)*y._pixelsPerMercatorPixel+z,Q=(Q-j)*y._pixelsPerMercatorPixel+j;const ne=[Z*y.worldSize,Q*y.worldSize,0];r.af(ne,ne,T),D=r.bm(D,ne,I)}return r.af(D,D,b)}_makeGlobeTileDebugBorderBuffer(t,o,p,y,b,T){const I=new r.bc,D=new r.bd,F=new r.bn,z=(B,$,Z,Q,ne)=>{const te=(Z-B)/(ne-1),se=(Q-$)/(ne-1),me=I.length;for(let ce=0;ce<ne;ce++){const Ce=B+ce*te,_e=$+ce*se;I.emplaceBack(Ce,_e);const Re=this._globePoint(Ce,_e,o,p,y,b,T);F.emplaceBack(Re[0],Re[1],Re[2]),D.emplaceBack(me+ce)}},j=r.al;z(0,0,j,0,16),z(j,0,j,j,16),z(j,j,0,j,16),z(0,j,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(D),this._tileDebugBuffer=t.createVertexBuffer(I,r.be.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(F,r.bo.members),this._tileDebugSegments=r.bf.simpleSegment(0,0,I.length,D.length)}_makeGlobeTileDebugTextBuffer(t,o,p,y,b,T){const I=r.al/4,D=new r.bc,F=new r.b0,z=new r.bn,j=25;F.reserve(32),D.reserve(j),z.reserve(j);const B=($,Z)=>j*$+Z;for(let $=0;$<j;$++){const Z=$*I;for(let Q=0;Q<j;Q++){const ne=Q*I;D.emplaceBack(ne,Z);const te=this._globePoint(ne,Z,o,p,y,b,T);z.emplaceBack(te[0],te[1],te[2])}}for(let $=0;$<4;$++)for(let Z=0;Z<4;Z++){const Q=B($,Z),ne=B($,Z+1),te=B($+1,Z),se=B($+1,Z+1);F.emplaceBack(Q,ne,te),F.emplaceBack(te,ne,se)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(F),this._tileDebugTextBuffer=t.createVertexBuffer(D,r.be.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(z,r.bo.members),this._tileDebugTextSegments=r.bf.simpleSegment(0,0,j,32)}destroy(t=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.br.setPbf(r.bs);class vo extends Go{constructor(t,o,p,y,b){super(t,o,p,y,b),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,o,p){const y=p.context,b=y.gl;let T=this.texturePerLayer.get(t)||p.getTileTexture(o.width);T&&T instanceof r.T?T.update(o,{premultiply:!1}):T=new r.T(y,o,b.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,T)}flushQueues(t){const o=this._workQueuePerLayer.get(t)||[],p=this._fetchQueuePerLayer.get(t)||[];for(;o.length;)o.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const o=this._workQueuePerLayer.get(t)||[];for(;o.length;)o.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const o=this._fetchQueuePerLayer.get(t)||[];for(;o.length;)o.pop()()}}fetchHeader(t=16384,o){const p=this._mrt=new r.br(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=r.bt(y,(b,T,I)=>{if(b)o(b);else try{const D=p.getHeaderLength(T);if(D>t)return void(this.request=this.fetchHeader(D,o));p.parseHeader(T),this._isHeaderLoaded=!0;let F=0;for(const z of Object.values(p.layers))F=Math.max(F,z.dataIndex[z.dataIndex.length-1].lastByte);T.byteLength>=F&&(this.entireBuffer=T),o(null,this.entireBuffer||T,I)}catch(D){o(D)}}),this.request}fetchBandForRender(t,o,p,y){this.fetchBand(t,o,p,b=>{if(b)return void y(b);this.updateTextureDescriptor(t,o,p);const T=this.textureDescriptorPerLayer.get(o);y(null,T?T.img:null)})}fetchBand(t,o,p,y,b=!0){const T=this._mrt;if(!this._isHeaderLoaded||!T)return void y(new Error("Tile header is not ready"));const I=this.actor;if(!I)return void y(new Error("Can't fetch tile band without an actor"));let D;const F=r.B(String(p),r.B(this.tileID.key,t));let z=this._taskQueue.get(F);z?z.add(y):(z=new Set,z.add(y),this._taskQueue.set(F,z));const j=(Q,ne)=>{D.complete(Q,ne),Q?y(Q):(z.values().forEach(te=>te(null,ne)),this._taskQueue.delete(F))},B=(Q,ne)=>{if(Q)return y(Q);const te=I.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ne,task:D},j,void 0,!0);if(o!==null){const se=this._workQueuePerLayer.get(o)||[];se.push(()=>{te&&te.cancel(),D.cancel()}),this._workQueuePerLayer.has(o)||this._workQueuePerLayer.set(o,se)}};let $;try{$=T.getLayer(t)}catch(Q){if(this.state==="reloading")return;throw Q}if(!$)return void y(new Error(`Unknown sourceLayer "${t}"`));if($.hasDataForBand(p))return z.values().forEach(Q=>Q(null,null)),void this._taskQueue.delete(F);const Z=$.getDataRange([p]);if(D=T.createDecodingTask(Z),!D||D.tasks.length)if(o!==null&&this.flushQueues(o),this.entireBuffer)B(null,this.entireBuffer.slice(Z.firstByte,Z.lastByte+1));else{const Q=Object.assign({},this.requestParams,{headers:{Range:`bytes=${Z.firstByte}-${Z.lastByte}`}}),ne=r.bt(Q,B);if(o!==null){const te=this._fetchQueuePerLayer.get(o)||[];te.push(()=>{ne.cancel(),D.cancel()}),this._fetchQueuePerLayer.has(o)||this._fetchQueuePerLayer.set(o,te)}}}updateNeeded(t,o){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==o||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,o,p){if(!this._mrt)return;const y=this._mrt.getLayer(t);if(!y||!y.hasBand(p)||!y.hasDataForBand(p))return;const{bytes:b,tileSize:T,buffer:I,offset:D,scale:F}=y.getBandView(p),z=T+2*I,j=new r.q({width:z,height:z},b),B=this.texturePerLayer.get(o);B&&B instanceof r.T&&B.update(j,{premultiply:!1}),this.textureDescriptorPerLayer.set(o,{layer:t,band:p,img:j,buffer:I,offset:D,tileSize:T,format:y.pixelFormat,mix:[F,256*F,65536*F,16777216*F]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const o of this.texturePerLayer.values())o&&o instanceof r.T&&o.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Wd{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(const t in this.data)for(const o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,p){const y=t.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const b={value:o,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(t,b)},p)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){const o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;const p=t.wrapped().key,y=o===void 0?0:this.data[p].indexOf(o),b=this.data[p][y];return this.data[p].splice(y,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){const o=[];for(const p in this.data)for(const y of this.data[p])t(y.value)||o.push(y);for(const p of o)this.remove(p.value.tileID,p)}}class _l{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,p){const y=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][y]=this.stateChanges[t][y]||{},Object.assign(this.stateChanges[t][y],p),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==y&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][y]===null){this.deletedStates[t][y]={};for(const b in this.state[t][y])p[b]||(this.deletedStates[t][y][b]=null)}else for(const b in p)this.deletedStates[t]&&this.deletedStates[t][y]&&this.deletedStates[t][y][b]===null&&delete this.deletedStates[t][y][b]}removeFeatureState(t,o,p){if(this.deletedStates[t]===null)return;const y=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},p&&o!==void 0)this.deletedStates[t][y]!==null&&(this.deletedStates[t][y]=this.deletedStates[t][y]||{},this.deletedStates[t][y][p]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][y])for(p in this.deletedStates[t][y]={},this.stateChanges[t][y])this.deletedStates[t][y][p]=null;else this.deletedStates[t][y]=null;else this.deletedStates[t]=null}getState(t,o){const p=this.state[t]||{},y=this.stateChanges[t]||{},b=this.deletedStates[t];if(b===null)return{};if(o!==void 0){const I=String(o),D=Object.assign({},p[I],y[I]);if(b){const F=b[o];if(F===null)return{};for(const z in F)delete D[z]}return D}const T=Object.assign({},p,y);if(b)for(const I in b)delete T[I];return T}initializeTileState(t,o){t.refreshFeatureState(o)}coalesceChanges(t,o){const p={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const b={};for(const T in this.stateChanges[y])this.state[y][T]||(this.state[y][T]={}),Object.assign(this.state[y][T],this.stateChanges[y][T]),b[T]=this.state[y][T];p[y]=b}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const b={};if(this.deletedStates[y]===null)for(const T in this.state[y])b[T]={},this.state[y][T]={};else for(const T in this.deletedStates[y]){if(this.deletedStates[y][T]===null)this.state[y][T]={};else if(this.state[y][T])for(const I of Object.keys(this.deletedStates[y][T]))delete this.state[y][T][I];b[T]=this.state[y][T]}p[y]=p[y]||{},Object.assign(p[y],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const y in t)t[y].refreshFeatureState(o)}}class qo extends r.E{constructor(t,o,p){super(),this.id=t,this._onlySymbols=p,o.on("data",y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new Wd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new _l,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,o){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,o)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const p=this._tiles[o];p.upload(t,this.map?this.map.painter:void 0),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(yl).map(t=>t.key)}getRenderableIds(t,o){const p=[];for(const y in this._tiles)this._isIdRenderable(+y,t,o)&&p.push(this._tiles[y]);return t?p.sort((y,b)=>{const T=y.tileID,I=b.tileID,D=new r.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),F=new r.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-I.overscaledZ||F.y-D.y||F.x-D.x}).map(y=>y.tileID.key):p.map(y=>y.tileID).sort(yl).map(y=>y.key)}hasRenderableParent(t){const o=this.findLoadedParent(t,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(t,o,p){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())&&(p||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,o){const p=this._tiles[t];p&&(p.state!=="loading"&&(p.state=o),this._loadTile(p,this._tileLoaded.bind(this,p,t,o)))}_tileLoaded(t,o,p,y,b){if(y){if(t.state="errored",y.status!==404)this._source.fire(new r.y(y,{tile:t}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const I=this.map.painter.terrain;this.update(this.transform,I.getScaledDemTileSize(),!0),I.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=r.o.now(),p==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let T=new Map;b&&b.responseHeaders&&(T=b.responseHeaders),this._source.fire(new r.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:T}))}_backfillDEM(t){const o=this.getRenderableIds();for(let y=0;y<o.length;y++){const b=o[y];if(t.neighboringTiles&&t.neighboringTiles[b]){const T=this.getTileByID(b);p(t,T),p(T,t)}}function p(y,b){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let T=b.tileID.canonical.x-y.tileID.canonical.x;const I=b.tileID.canonical.y-y.tileID.canonical.y,D=Math.pow(2,y.tileID.canonical.z),F=b.tileID.key;T===0&&I===0||Math.abs(I)>1||(Math.abs(T)>1&&(Math.abs(T+D)===1?T+=D:Math.abs(T-D)===1&&(T-=D)),b.dem&&y.dem&&(y.dem.backfillBorder(b.dem,T,I),y.neighboringTiles&&y.neighboringTiles[F]&&(y.neighboringTiles[F].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o,p,y){for(const b in this._tiles){let T=this._tiles[b];if(y[b]||!T.hasData()||T.tileID.overscaledZ<=o||T.tileID.overscaledZ>p)continue;let I=T.tileID;for(;T&&T.tileID.overscaledZ>o+1;){const F=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[F.key],T&&T.hasData()&&(I=F)}let D=I;for(;D.overscaledZ>o;)if(D=D.scaledTo(D.overscaledZ-1),t[D.key]){y[I.key]=I;break}}}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){const p=this._loadedParentTiles[t.key];return p&&p.tileID.overscaledZ>=o?p:null}for(let p=t.overscaledZ-1;p>=o;p--){const y=t.scaledTo(p),b=this._getLoadedTile(y);if(b)return b}}_getLoadedTile(t){const o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,o){o=o||this._source.tileSize;const p=Math.ceil(t.width/o)+1,y=Math.ceil(t.height/o)+1,b=Math.floor(p*y*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(I)}handleWrapJump(t){const o=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,o){const p={};for(const y in this._tiles){const b=this._tiles[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+o),p[b.tileID.key]=b}this._tiles=p;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(t,o,p,y,b){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(t,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const T=this._source.type==="batched-model";let I,D=this._source.maxzoom;const F=this.map&&this.map.painter?this.map.painter._terrain:null;if(F&&F.sourceCache===this&&F.attenuationRange()){const B=F.attenuationRange()[0],$=Math.floor(B)-Math.log2(F.getDemUpscale());D>$&&(D=$)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(B=>new r.aP(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y));else if(this.tileCoverLift!==0){const B=t.clone();B.tileCoverLift=this.tileCoverLift,I=B.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.minzoom<=1&&t.projection.name==="globe"&&(I.push(new r.aP(1,0,1,0,0)),I.push(new r.aP(1,0,1,1,0)),I.push(new r.aP(1,0,1,0,1)),I.push(new r.aP(1,0,1,1,1)))}else if(I=t.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.hasTile){const B=this._source.hasTile.bind(this._source);I=I.filter($=>B($))}}else I=[];if(I.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!bu(this._source.type)){const B=t.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),$=Math.min(B,this._source.maxzoom);if(T){const Z=t.extendTileCover(I,$);for(const Q of Z)I.push(Q)}else if(b){const Z=t.extendTileCoverToNearPlane(I,this.transform.getFrustum($),$);for(const Q of Z)I.push(Q)}else if(this.castsShadows&&y){const Z=t.extendTileCover(I,$,y);for(const Q of Z)this._shadowCasterTiles[Q.key]=!0,I.push(Q)}}const z=this._updateRetainedTiles(I);if(bu(this._source.type)&&I.length!==0){const B={},$={},Z=Object.keys(z);for(const ne of Z){const te=z[ne],se=this._tiles[ne];if(!se||se.fadeEndTime&&se.fadeEndTime<=r.o.now())continue;const me=this.findLoadedParent(te,Math.max(te.overscaledZ-qo.maxOverzooming,this._source.minzoom));me&&(this._addTile(me.tileID),B[me.tileID.key]=me.tileID),$[ne]=te}const Q=I[I.length-1].overscaledZ;for(const ne in this._tiles){const te=this._tiles[ne];if(z[ne]||!te.hasData())continue;let se=te.tileID;for(;se.overscaledZ>Q;){se=se.scaledTo(se.overscaledZ-1);const me=this._tiles[se.key];if(me&&me.hasData()&&$[se.key]){z[ne]=te.tileID;break}}}for(const ne in B)z[ne]||(this._coveredTiles[ne]=!0,z[ne]=B[ne])}for(const B in z)this._tiles[B].clearFadeHold();const j=r.bu(this._tiles,z);for(const B of j){const $=this._tiles[B];$.hasSymbolBuckets&&!$.holdingForFade()?$.setHoldDuration(this.map._fadeDuration):$.hasSymbolBuckets&&!$.symbolFadeFinished()||this._removeTile(+B)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const o={};if(t.length===0)return o;const p={},y=t.reduce((F,z)=>Math.min(F,z.overscaledZ),1/0),b=t[0].overscaledZ,T=Math.max(b-qo.maxOverzooming,this._source.minzoom),I=Math.max(b+qo.maxUnderzooming,this._source.minzoom),D={};for(const F of t){const z=this._addTile(F);o[F.key]=F,z.hasData()||y<this._source.maxzoom&&(D[F.key]=F)}this._retainLoadedChildren(D,y,I,o);for(const F of t){let z=this._tiles[F.key];if(z.hasData())continue;if(F.canonical.z>=this._source.maxzoom){const B=F.children(this._source.maxzoom)[0],$=this.getTile(B);if($&&$.hasData()){o[B.key]=B;continue}}else{const B=F.children(this._source.maxzoom);if(o[B[0].key]&&o[B[1].key]&&o[B[2].key]&&o[B[3].key])continue}let j=z.wasRequested();for(let B=F.overscaledZ-1;B>=T;--B){const $=F.scaledTo(B);if(p[$.key]||(p[$.key]=!0,z=this.getTile($),!z&&j&&(z=this._addTile($)),z&&(o[$.key]=$,j=z.wasRequested(),z.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const o=[];let p,y=this._tiles[t].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){p=this._loadedParentTiles[y.key];break}o.push(y.key);const b=y.scaledTo(y.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;y=b}for(const b of o)this._loadedParentTiles[b]=p}}_addTile(t){let o=this._tiles[t.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));const p=!!o;if(!p){const y=this.map?this.map.painter:null,b=this._source.tileSize*t.overscaleFactor();o=this._source.type==="raster-array"?new vo(t,b,this.transform.tileZoom,y,this._isRaster):new Go(t,b,this.transform.tileZoom,y,this._isRaster,this._source.worldview),this._loadTile(o,this._tileLoaded.bind(this,o,t.key,o.state))}return o.uses++,this._tiles[t.key]=o,p||this._source.fire(new r.z("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const p=o.getExpiryTimeout();p&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},p))}_removeTile(t){const o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,o,p){const y=[],b=this.transform;if(!b)return y;const T=b.projection.name==="globe",I=r.aF(b.center.lng);for(const D in this._tiles){const F=this._tiles[D];if(p&&F.clearQueryDebugViz(),F.holdingForFade())continue;let z;if(T){const j=F.tileID.canonical;if(j.z===0){const B=[Math.abs(r.aA(I,...rc(j,-1))-I),Math.abs(r.aA(I,...rc(j,1))-I)];z=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(r.aA(I,...rc(j,-1))-I),Math.abs(r.aA(I,...rc(j,0))-I),Math.abs(r.aA(I,...rc(j,1))-I)];z=[B.indexOf(Math.min(...B))-1]}}else z=[0];for(const j of z){const B=t.containsTile(F,b,o,j);B&&y.push(B)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,o){const p=this.getRenderableIds(t,o).map(b=>this._tiles[b].tileID),y=this.transform.projection.name==="globe";for(const b of p)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=y?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return p}sortCoordinatesByDistance(t){const o=t.slice(),p=this.transform._camera.position,y=this.transform._camera.forward(),b={};for(const T of o){const I=1/(1<<T.canonical.z);b[T.key]=((T.canonical.x+.5)*I+T.wrap-p[0])*y[0]+((T.canonical.y+.5)*I-p[1])*y[1]-p[2]*y[2]}return o.sort((T,I)=>b[T.key]-b[I.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(bu(this._source.type))for(const t in this._tiles){const o=this._tiles[t];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=r.o.now())return!0}return!1}setFeatureState(t,o,p){this._state.updateState(t=t||"_geojsonTileLayer",o,p)}removeFeatureState(t,o,p){this._state.removeFeatureState(t=t||"_geojsonTileLayer",o,p)}getFeatureState(t,o){return this._state.getState(t=t||"_geojsonTileLayer",o)}setDependencies(t,o,p){const y=this._tiles[t];y&&y.setDependencies(o,p)}reloadTilesForDependencies(t,o){for(const p in this._tiles)this._tiles[p].hasDependency(t,o)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(t,o))}_preloadTiles(t,o){if(!this._sourceLoaded){const D=()=>{this._sourceLoaded&&(this._source.off("data",D),this._preloadTiles(t,o))};return void this._source.on("data",D)}const p=new Map,y=Array.isArray(t)?t:[t],b=this.map.painter.terrain,T=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const D of y){const F=D.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const z of F)p.set(z.key,z);this.usedForTerrain&&D.updateElevation(!1)}const I=Array.from(p.values());r.bv(I,(D,F)=>{const z=new Go(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(z,j=>{this._source.type==="raster-dem"&&z.dem&&this._backfillDEM(z),F(j,z)})},o)}}function yl(f,t){const o=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*t.wrap)-+(t.wrap<0);return f.overscaledZ-t.overscaledZ||p-o||t.canonical.y-f.canonical.y||t.canonical.x-f.canonical.x}function bu(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function rc(f,t){const o=1<<f.z;return[f.x/o+t,(f.x+1)/o+t]}qo.maxOverzooming=10,qo.maxUnderzooming=3;class qd{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,o=!1;for(const p in this.style._mergedLayers){const y=this.style._mergedLayers[p];if(y.type==="fill-extrusion"||y.type==="building")this.layers.push({layer:y,visible:t,visibilityChanged:o});else if(y.type==="model"){const b=this.style.getLayerSource(y);b&&b.type==="batched-model"&&this.layers.push({layer:y,visible:t,visibilityChanged:o})}}}onNewFrame(t){this.layersGotHidden=!1;for(const o of this.layers){const p=o.layer;let y=!1;p.type==="fill-extrusion"?y=!p.isHidden(t)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?y=!p.isHidden(t)&&p.paint.get("building-opacity")>0:p.type==="model"&&(y=!p.isHidden(t)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&o.visible,o.visible=y}}updateZOffset(t,o){this.currentBuildingBuckets=[];for(const y of this.layers){const b=y.layer,T=this.style.getLayerSourceCache(b);let I=1;b.type==="fill-extrusion"?I=y.visible?b.paint.get("fill-extrusion-vertical-scale"):0:b.type==="building"&&(I=y.visible?b.paint.get("building-vertical-scale"):0);let D=T?T.getTile(o):null;if(!D&&T)for(const F in T._tiles){const z=T._tiles[F];if(o.canonical.isChildOf(z.tileID.canonical)){D=z;break}}this.currentBuildingBuckets.push({bucket:D?D.getBucket(b):null,tileID:D?D.tileID:o,verticalScale:I})}t.hasAnyZOffset=!1;let p=!1;for(let y=0;y<t.symbolInstances.length;y++){const b=t.symbolInstances.get(y),T=b.zOffset,I=this._getHeightAtTileOffset(o,b.tileAnchorX,b.tileAnchorY);b.zOffset=I!==Number.NEGATIVE_INFINITY?I:T,p||T===b.zOffset||(p=!0),t.hasAnyZOffset||b.zOffset===0||(t.hasAnyZOffset=!0)}p&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,o,p,y){let b=o,T=p;if(t.canonical.z!==y.canonical.z){const I=y.canonical,D=1/(1<<t.canonical.z-I.z);b=(o+t.canonical.x*r.al)*D-I.x*r.al|0,T=(p+t.canonical.y*r.al)*D-I.y*r.al|0}return{tileX:b,tileY:T}}_getHeightAtTileOffset(t,o,p){let y,b;for(let T=0;T<this.layers.length;++T){const I=this.layers[T].layer;if(I.type!=="fill-extrusion"&&I.type!=="building")continue;const{bucket:D,tileID:F,verticalScale:z}=this.currentBuildingBuckets[T];if(!D)continue;const{tileX:j,tileY:B}=this._mapCoordToOverlappingTile(t,o,p,F),$=D.getHeightAtTileCoord(j,B);$&&$.height!==void 0&&($.hidden?y=$.height:b=Math.max($.height*z,b||0))}if(b!==void 0)return b;for(let T=0;T<this.layers.length;++T){const I=this.layers[T];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:D,tileID:F}=this.currentBuildingBuckets[T];if(!D)continue;const{tileX:z,tileY:j}=this._mapCoordToOverlappingTile(t,o,p,F),B=D.getHeightAtTileCoord(z,j);if(B&&!B.hidden)return B.height===void 0&&y!==void 0?Math.min(B.maxHeight,y)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function wu(f,t){const o={};for(const p in f)p!=="ref"&&(o[p]=f[p]);return r.bw.forEach(p=>{p in t&&(o[p]=t[p])}),o}function oc(f){f=f.slice();const t=Object.create(null);for(let o=0;o<f.length;o++)t[f[o].id]=f[o];for(let o=0;o<f.length;o++)"ref"in f[o]&&(f[o]=wu(f[o],t[f[o].ref]));return f}const Gn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Rc(f,t,o){o.push({command:Gn.addSource,args:[f,t[f]]})}function ac(f,t,o){t.push({command:Gn.removeSource,args:[f]}),o[f]=!0}function Tu(f,t,o,p){ac(f,o,p),Rc(f,t,o)}function sc(f,t,o){let p;for(p in f[o])if(f[o].hasOwnProperty(p)&&p!=="data"&&!r.bx(f[o][p],t[o][p]))return!1;for(p in t[o])if(t[o].hasOwnProperty(p)&&p!=="data"&&!r.bx(f[o][p],t[o][p]))return!1;return!0}function Dc(f,t,o,p,y,b){let T;for(T in t=t||{},f=f||{})f.hasOwnProperty(T)&&(r.bx(f[T],t[T])||o.push({command:b,args:[p,T,t[T],y]}));for(T in t)t.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(r.bx(f[T],t[T])||o.push({command:b,args:[p,T,t[T],y]}))}function Mc(f){return f.id}function Pc(f,t){return f[t.id]=t,f}function Oc(f,t,o){const p=t.createTileMatrix(f,f.worldSize,o.toUnwrapped());return r.aB(new Float32Array(16),f.projMatrix,p)}function dp(f,t,o){if(t.projection.name===o.projection.name)return f.projMatrix;const p=o.clone();return p.setProjection(t.projection),Oc(p,t.getProjection(),f)}function uh(f,t,o){return t.name===o.projection.name?f.projMatrix:Oc(o,t,f)}class Lm{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=r.aA(t,0,1);let o=1,p=this._distances[o];const y=t*this.paddedLength+this.padding;for(;p<y&&o<this._distances.length;)p=this._distances[++o];const b=o-1,T=this._distances[b],I=p-T,D=I>0?(y-T)/I:0;return this.points[b].mult(1-D).add(this.points[o].mult(D))}}class ge{constructor(t,o,p){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(o/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,p,y,b){this._forEachCell(o,p,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(t,o,p,y){this._forEachCell(o-y,p-y,o+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(p),this.circles.push(y)}_insertBoxCell(t,o,p,y,b,T){this.boxCells[b].push(T)}_insertCircleCell(t,o,p,y,b,T){this.circleCells[b].push(T)}_query(t,o,p,y,b,T){if(p<0||t>this.width||y<0||o>this.height)return!b&&[];const I=[];if(t<=0&&o<=0&&this.width<=p&&this.height<=y){if(b)return!0;for(let D=0;D<this.boxKeys.length;D++)I.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const F=this.circles[3*D],z=this.circles[3*D+1],j=this.circles[3*D+2];I.push({key:this.circleKeys[D],x1:F-j,y1:z-j,x2:F+j,y2:z+j})}return T?I.filter(T):I}return this._forEachCell(t,o,p,y,this._queryCell,I,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?I.length>0:I}_queryCircle(t,o,p,y,b){const T=t-p,I=t+p,D=o-p,F=o+p;if(I<0||T>this.width||F<0||D>this.height)return!y&&[];const z=[];return this._forEachCell(T,D,I,F,this._queryCellCircle,z,{hitTest:y,circle:{x:t,y:o,radius:p},seenUids:{box:{},circle:{}}},b),y?z.length>0:z}query(t,o,p,y,b){return this._query(t,o,p,y,!1,b)}hitTest(t,o,p,y,b){return this._query(t,o,p,y,!0,b)}hitTestCircle(t,o,p,y){return this._queryCircle(t,o,p,!0,y)}_queryCell(t,o,p,y,b,T,I,D){const F=I.seenUids,z=this.boxCells[b];if(z!==null){const B=this.bboxes;for(const $ of z)if(!F.box[$]){F.box[$]=!0;const Z=4*$;if(t<=B[Z+2]&&o<=B[Z+3]&&p>=B[Z+0]&&y>=B[Z+1]&&(!D||D(this.boxKeys[$]))){if(I.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[$],x1:B[Z],y1:B[Z+1],x2:B[Z+2],y2:B[Z+3]})}}}const j=this.circleCells[b];if(j!==null){const B=this.circles;for(const $ of j)if(!F.circle[$]){F.circle[$]=!0;const Z=3*$;if(this._circleAndRectCollide(B[Z],B[Z+1],B[Z+2],t,o,p,y)&&(!D||D(this.circleKeys[$]))){if(I.hitTest)return T.push(!0),!0;{const Q=B[Z],ne=B[Z+1],te=B[Z+2];T.push({key:this.circleKeys[$],x1:Q-te,y1:ne-te,x2:Q+te,y2:ne+te})}}}}}_queryCellCircle(t,o,p,y,b,T,I,D){const F=I.circle,z=I.seenUids,j=this.boxCells[b];if(j!==null){const $=this.bboxes;for(const Z of j)if(!z.box[Z]){z.box[Z]=!0;const Q=4*Z;if(this._circleAndRectCollide(F.x,F.y,F.radius,$[Q+0],$[Q+1],$[Q+2],$[Q+3])&&(!D||D(this.boxKeys[Z])))return T.push(!0),!0}}const B=this.circleCells[b];if(B!==null){const $=this.circles;for(const Z of B)if(!z.circle[Z]){z.circle[Z]=!0;const Q=3*Z;if(this._circlesCollide($[Q],$[Q+1],$[Q+2],F.x,F.y,F.radius)&&(!D||D(this.circleKeys[Z])))return T.push(!0),!0}}}_forEachCell(t,o,p,y,b,T,I,D){const F=this._convertToXCellCoord(t),z=this._convertToYCellCoord(o),j=this._convertToXCellCoord(p),B=this._convertToYCellCoord(y);for(let $=F;$<=j;$++)for(let Z=z;Z<=B;Z++)if(b.call(this,t,o,p,y,this.xCellCount*Z+$,T,I,D))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,p,y,b,T){const I=y-t,D=b-o,F=p+T;return F*F>I*I+D*D}_circleAndRectCollide(t,o,p,y,b,T,I){const D=(T-y)/2,F=Math.abs(t-(y+D));if(F>D+p)return!1;const z=(I-b)/2,j=Math.abs(o-(b+z));if(j>z+p)return!1;if(F<=D||j<=z)return!0;const B=F-D,$=j-z;return B*B+$*$<=p*p}}const Je={unknown:0,flipRequired:1,flipNotRequired:2},Ut=Math.tan(85*Math.PI/180);function Jt(f,t,o,p,y,b,T){const I=r.bB();if(o)if(b.name==="globe"){const D=r.bC(y,t);r.aB(I,I,D)}else{const D=r.bD([],T);I[0]=D[0],I[1]=D[1],I[4]=D[2],I[5]=D[3],p||r.bA(I,I,y.angle)}else r.aB(I,y.labelPlaneMatrix,f);return I}function Mi(f,t,o,p,y,b,T){const I=Jt(f,t,o,p,y,b,T);return b.name==="globe"&&o||(I[2]=I[6]=I[10]=I[14]=0),I}function vn(f,t,o,p,y,b,T){if(o){if(b.name==="globe"){const I=Jt(f,t,o,p,y,b,T);return r.bk(I,I),r.aB(I,f,I),I}{const I=r.by(f),D=r.bz([]);return D[0]=T[0],D[1]=T[1],D[4]=T[2],D[5]=T[3],r.aB(I,I,D),p||r.bA(I,I,-y.angle),I}}return y.glCoordMatrix}function ki(f,t,o,p){const y=[f,t,o,1];o?r.aC(y,y,p):Oa(y,y,p);const b=y[3];return y[0]/=b,y[1]/=b,y[2]/=b,y}function Zn(f,t){return Math.min(.5+f/t*.5,1.5)}function Dr(f,t){const o=f[0]/f[3],p=f[1]/f[3];return o>=-t[0]&&o<=t[0]&&p>=-t[1]&&p<=t[1]}function po(f,t,o,p,y,b,T,I,D,F,z=1){const j=o.transform,B=p?f.textSizeData:f.iconSizeData,$=r.bJ(B,o.transform.zoom,z),Z=j.projection.name==="globe",Q=[256/o.width*2+1,256/o.height*2+1],ne=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ne.clear();let te=null;Z&&(te=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const se=f.lineVertexArray,me=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ce=o.transform.width/o.transform.height;let Ce,_e=!1;for(let Re=0;Re<me.length;Re++){const Ae=me.get(Re),{numGlyphs:Te,writingMode:De}=Ae;if(De!==r.bK.vertical||_e||Ce===r.bK.horizontal||(_e=!0),Ce=De,(Ae.hidden||De===r.bK.vertical)&&!_e){vl(Te,ne);continue}_e=!1;const He=new r.P(Ae.tileAnchorX,Ae.tileAnchorY),Ue=f.elevationType==="road",rt=!!j.elevation||Ue;let{x:Qe,y:lt,z:Lt}=j.projection.projectTilePoint(He.x,He.y,F.canonical),Xe=null;if(rt){const ri=Ue?f.getElevationFeatureForText(Re):null;Xe={getElevation:D,elevation:j.elevation,elevationFeature:ri};const[Oi,wn,In]=D(He,j.elevation,ri);Qe+=Oi,lt+=wn,Lt+=In}const Ne=[Qe,lt,Lt,1];if(r.aC(Ne,Ne,t),!Dr(Ne,Q)){vl(Te,ne);continue}const ct=Ne[3],et=Zn(o.transform.getCameraToCenterDistance(j.projection),ct),At=r.bL(B,$,Ae),jt=T?At/et:At*et,pi=ki(Qe,lt,Lt,y);if(pi[3]<=0){vl(Te,ne);continue}let Ft={};const zt=r.an(f.layers[0].layout.get("text-max-angle")),mi=Math.cos(zt),ni=T?null:Xe,ii=Er(Ae,jt,!1,I,t,y,b,f.glyphOffsetArray,se,ne,te,pi,He,Ft,ce,ni,j.projection,F,T,mi);_e=ii.useVertical,ni&&ii.needsFlipping&&(Ft={}),(ii.notEnoughRoom||_e||ii.needsFlipping&&Er(Ae,jt,!0,I,t,y,b,f.glyphOffsetArray,se,ne,te,pi,He,Ft,ce,ni,j.projection,F,T,mi).notEnoughRoom)&&vl(Te,ne)}p?(f.text.dynamicLayoutVertexBuffer.updateData(ne),te&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(te)):(f.icon.dynamicLayoutVertexBuffer.updateData(ne),te&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(te))}function Qi(f,t,o,p,y,b,T,I,D,F,z,j,B,$,Z,Q,ne){const{lineStartIndex:te,glyphStartIndex:se,segment:me}=I,ce=se+I.numGlyphs,Ce=te+I.lineLength,_e=t.getoffsetX(se),Re=t.getoffsetX(ce-1),Ae=lc(f*_e,o,p,y,b,T,me,te,Ce,D,F,z,j,B,!0,$,Z,Q,ne);if(!Ae)return null;const Te=lc(f*Re,o,p,y,b,T,me,te,Ce,D,F,z,j,B,!0,$,Z,Q,ne);return Te?{first:Ae,last:Te}:null}function Fo(f,t,o,p){return f===r.bK.horizontal&&Math.abs(p)>Math.abs(o)?{useVertical:!0}:f===r.bK.vertical?p>0?{needsFlipping:!0}:null:t!==Je.unknown&&function(y,b){return y===0||Math.abs(b/y)>Ut}(o,p)?t===Je.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function Er(f,t,o,p,y,b,T,I,D,F,z,j,B,$,Z,Q,ne,te,se,me){const ce=t/24,Ce=f.lineOffsetX*ce,_e=f.lineOffsetY*ce,{lineStartIndex:Re,glyphStartIndex:Ae,numGlyphs:Te,segment:De,writingMode:He,flipState:Ue}=f,rt=Re+f.lineLength,Qe=lt=>{if(z){const[ct,et,At]=lt.up,jt=F.length;r.bM(z,jt+0,ct,et,At),r.bM(z,jt+1,ct,et,At),r.bM(z,jt+2,ct,et,At),r.bM(z,jt+3,ct,et,At)}const[Lt,Xe,Ne]=lt.point;r.bN(F,Lt,Xe,Ne,lt.angle)};if(Te>1){const lt=Qi(ce,I,Ce,_e,o,j,B,f,D,b,$,Q,!1,ne,te,se,me);if(!lt)return{notEnoughRoom:!0};if(p&&!o){let[Lt,Xe,Ne]=lt.first.point,[ct,et,At]=lt.last.point;[Lt,Xe]=ki(Lt,Xe,Ne,T),[ct,et]=ki(ct,et,At,T);const jt=Fo(He,Ue,(ct-Lt)*Z,et-Xe);if(f.flipState=jt&&jt.needsFlipping?Je.flipRequired:Je.flipNotRequired,jt)return jt}Qe(lt.first);for(let Lt=Ae+1;Lt<Ae+Te-1;Lt++){const Xe=lc(ce*I.getoffsetX(Lt),Ce,_e,o,j,B,De,Re,rt,D,b,$,Q,!1,!1,ne,te,se,me);if(!Xe)return F.length-=4*(Lt-Ae),{notEnoughRoom:!0};Qe(Xe)}Qe(lt.last)}else{if(p&&!o){const Lt=ki(B.x,B.y,0,y),Xe=Re+De+1,Ne=new r.P(D.getx(Xe),D.gety(Xe)),ct=ki(Ne.x,Ne.y,0,y),et=ct[3]>0?ct:Si(B,Ne,Lt,1,y,void 0,ne,te.canonical),At=Fo(He,Ue,(et[0]-Lt[0])*Z,et[1]-Lt[1]);if(f.flipState=At&&At.needsFlipping?Je.flipRequired:Je.flipNotRequired,At)return At}const lt=lc(ce*I.getoffsetX(Ae),Ce,_e,o,j,B,De,Re,rt,D,b,$,Q,!1,!1,ne,te,se,me);if(!lt)return{notEnoughRoom:!0};Qe(lt)}return{}}function Jo(f,t,o,p,y){const{x:b,y:T,z:I}=p.projectTilePoint(f.x,f.y,t);if(!y)return ki(b,T,I,o);const[D,F,z]=y.getElevation(f,y.elevation,y.elevationFeature);return ki(b+D,T+F,I+z,o)}function Si(f,t,o,p,y,b,T,I){const D=Jo(f.sub(t)._unit()._add(f),I,y,T,b);return r.av(D,o,D),r.aw(D,D),r.bG(D,o,D,p)}function lc(f,t,o,p,y,b,T,I,D,F,z,j,B,$,Z,Q,ne,te,se){const me=p?f-t:f+t;let ce=me>0?1:-1,Ce=0;p&&(ce*=-1,Ce=Math.PI),ce<0&&(Ce+=Math.PI);let _e=I+T+(ce>0?0:1)|0,Re=y,Ae=y,Te=0,De=0;const He=Math.abs(me),Ue=[],rt=[];let Qe=b,lt=Qe,Lt=r.bE([]);const Xe=()=>Si(lt,Qe,Ae,He-Te+1,z,B,Q,ne.canonical);for(;Te+De<=He;){if(_e+=ce,_e<I||_e>=D)return null;if(Ae=Re,lt=Qe,Ue.push(Ae),$&&rt.push(lt),Qe=new r.P(F.getx(_e),F.gety(_e)),Re=j[_e],!Re){const ni=Jo(Qe,ne.canonical,z,Q,B);Re=ni[3]>0?j[_e]=ni:Xe()}Te+=De;const zt=r.av([],Re,Ae),mi=r.bF(Ae,Re);if(o&&mi>0&&De>0&&r.bI(Lt,zt)/(De*mi)<se)return null;De=mi,Lt=zt}Z&&B&&(j[_e]&&(Re=Xe(),De=r.bF(Ae,Re),Lt=r.av([],Re,Ae)),j[_e]=Re);const Ne=(He-Te)/De,ct=Qe.sub(lt)._mult(Ne)._add(lt),et=r.bG([],Ae,Lt,Ne);let At=[0,0,1],jt=Lt[0],pi=Lt[1];if(te&&(At=Q.upVector(ne.canonical,ct.x,ct.y),At[0]!==0||At[1]!==0||At[2]!==1)){const zt=[At[2],0,-At[0]],mi=r.bH([],At,zt);r.aw(zt,zt),r.aw(mi,mi),jt=r.bI(Lt,zt),pi=r.bI(Lt,mi)}if(o){const zt=r.bH([],At,Lt);r.aw(zt,zt),r.bG(et,et,zt,o*ce)}const Ft=Ce+Math.atan2(pi,jt);return Ue.push(et),$&&rt.push(ct),{point:et,angle:Ft,path:Ue,tilePath:rt,up:At}}function vl(f,t){const o=t.length,p=o+4*f;t.resize(p),t.float32.fill(-1/0,4*o,4*p)}function Oa(f,t,o){const p=t[0],y=t[1];return f[0]=o[0]*p+o[4]*y+o[12],f[1]=o[1]*p+o[5]*y+o[13],f[3]=o[3]*p+o[7]*y+o[15],f}const ws=100;class kc{constructor(t,o,p=new ge(t.width+200,t.height+200,25),y=new ge(t.width+200,t.height+200,25)){this.transform=t,this.grid=p,this.ignoredGrid=y,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ws,this.screenBottomBoundary=t.height+ws,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=o}placeCollisionBox(t,o,p,y,b,T,I,D,F,z,j){let B=p.projectedAnchorX,$=p.projectedAnchorY,Z=p.projectedAnchorZ;const Q=p.tileAnchorX,ne=p.tileAnchorY,te=p.elevation,se=p.tileID,me=t.getProjection();if(te&&se){const[rt,Qe,lt]=me.upVector(se.canonical,p.tileAnchorX,p.tileAnchorY),Lt=me.upVectorScale(se.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=rt*te*Lt,$+=Qe*te*Lt,Z+=lt*te*Lt}const ce=t.projection.name==="globe",Ce=t.projection.name==="globe"?r.aj(this.transform.zoom):0;if(se&&ce&&Ce<1&&!T){const rt=1<<se.canonical.z,Qe=r.bO(Q,ne);r.bP(Qe,Qe,1/r.al),r.bQ(Qe,Qe,r.bO(se.canonical.x,se.canonical.y)),r.bP(Qe,Qe,1/rt),r.bR(Qe,Qe,r.bO(y[0],y[1])),Qe[0]=r.bS(Qe[0],-.5,.5),r.bP(Qe,Qe,r.al);const lt=r.bT(Qe[0],Qe[1],r.al/(2*Math.PI),1);r.aC(lt,lt,b),B=r.ak(B,lt[0],Ce),$=r.ak($,lt[1],Ce),Z=r.ak(Z,lt[2],Ce)}const _e=this.projectAndGetPerspectiveRatio(z,B,$,Z,p.tileID,me.name==="globe"||!!te||this.transform.pitch>0,me),Re=F*_e.perspectiveRatio,Ae=(p.x1*o+I.x-p.padding)*Re+_e.point.x,Te=(p.y1*o+I.y-p.padding)*Re+_e.point.y,De=(p.x2*o+I.x+p.padding)*Re+_e.point.x,He=(p.y2*o+I.y+p.padding)*Re+_e.point.y,Ue=_e.perspectiveRatio<=.55||_e.occluded;return!this.isInsideGrid(Ae,Te,De,He)||!D&&this.grid.hitTest(Ae,Te,De,He,j)||Ue?{box:[],offscreen:!1,occluded:_e.occluded}:{box:[Ae,Te,De,He],offscreen:this.isOffscreen(Ae,Te,De,He),occluded:!1}}placeCollisionCircles(t,o,p,y,b,T,I,D,F,z,j,B,$,Z,Q,ne){const te=[],se=this.transform.elevation,me=t.getProjection(),ce=t.elevationType==="road",Ce=!!se||ce,_e=r.bU.getAtTileOffsetFunc(ne,this.transform.center.lat,this.transform.worldSize,me),Re=new r.P(p.tileAnchorX,p.tileAnchorY),Ae=new r.P(p.tileAnchorX,p.tileAnchorY);let{x:Te,y:De,z:He}=me.projectTilePoint(Ae.x,Ae.y,ne.canonical),Ue=null;if(Ce){const mi=ce?t.getElevationFeatureForText(y):null;Ue={getElevation:_e,elevation:se,elevationFeature:mi};const[ni,ii,ri]=_e(Re,se,mi);Te+=ni,De+=ii,He+=ri}const rt=me.name==="globe",Qe=this.projectAndGetPerspectiveRatio(D,Te,De,He,ne,rt||!!se||this.transform.pitch>0,me),{perspectiveRatio:lt}=Qe,Lt=(B?I/lt:I*lt)/r.bX,Xe=ki(Te,De,He,F),Ne=p.lineOffsetX*Lt,ct=p.lineOffsetY*Lt,et=r.an(t.layers[0].layout.get("text-max-angle")),At=Math.cos(et),jt=Qe.signedDistanceFromCamera>0?Qi(Lt,T,Ne,ct,ce&&p.flipState===1,Xe,Ae,p,b,F,{},Ce&&!B?Ue:null,B&&Ce,me,ne,B,At):null;let pi=!1,Ft=!1,zt=!0;if(jt&&!Qe.occluded){const mi=.5*Z*lt+Q,ni=new r.P(-100,-100),ii=new r.P(this.screenRightBoundary,this.screenBottomBoundary),ri=new Lm,{first:Oi,last:wn}=jt,In=Oi.path.length;let vr=[];for(let tn=In-1;tn>=1;tn--)vr.push(Oi.path[tn]);for(let tn=1;tn<wn.path.length;tn++)vr.push(wn.path[tn]);const Ui=2.5*mi;z&&(vr=vr.map(([tn,mr,kn],Cr)=>(Ce&&!rt&&(kn=_e(Cr<In-1?Oi.tilePath[In-1-Cr]:wn.tilePath[Cr-In+2],se,Ue.elevationFeature)[2]),ki(tn,mr,kn,z))),vr.some(tn=>tn[3]<=0)&&(vr=[]));let Dn=[];if(vr.length>0){let tn=1/0,mr=-1/0,kn=1/0,Cr=-1/0;for(const Hn of vr)tn=Math.min(tn,Hn[0]),kn=Math.min(kn,Hn[1]),mr=Math.max(mr,Hn[0]),Cr=Math.max(Cr,Hn[1]);mr>=ni.x&&tn<=ii.x&&Cr>=ni.y&&kn<=ii.y&&(Dn=[vr.map(Hn=>new r.P(Hn[0],Hn[1]))],(tn<ni.x||mr>ii.x||kn<ni.y||Cr>ii.y)&&(Dn=r.bV(Dn,ni.x,ni.y,ii.x,ii.y)))}for(const tn of Dn){ri.reset(tn,.25*mi);let mr=0;mr=ri.length<=.5*mi?1:Math.ceil(ri.paddedLength/Ui)+1;for(let kn=0;kn<mr;kn++){const Cr=kn/Math.max(mr-1,1),Hn=ri.lerp(Cr),ln=Hn.x+ws,rr=Hn.y+ws;te.push(ln,rr,mi,0);const dn=ln-mi,zr=rr-mi,Kn=ln+mi,Bi=rr+mi;if(zt=zt&&this.isOffscreen(dn,zr,Kn,Bi),Ft=Ft||this.isInsideGrid(dn,zr,Kn,Bi),!o&&this.grid.hitTestCircle(ln,rr,mi,$)&&(pi=!0,!j))return{circles:[],offscreen:!1,collisionDetected:pi,occluded:!1}}}}return{circles:!j&&pi||!Ft?[]:te,offscreen:zt,collisionDetected:pi,occluded:Qe.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let p=1/0,y=1/0,b=-1/0,T=-1/0;for(const z of t){const j=new r.P(z.x+ws,z.y+ws);p=Math.min(p,j.x),y=Math.min(y,j.y),b=Math.max(b,j.x),T=Math.max(T,j.y),o.push(j)}const I=this.grid.query(p,y,b,T).concat(this.ignoredGrid.query(p,y,b,T)),D={},F={};for(const z of I){const j=z.key;if(D[j.bucketInstanceId]===void 0&&(D[j.bucketInstanceId]={}),D[j.bucketInstanceId][j.featureIndex])continue;const B=[new r.P(z.x1,z.y1),new r.P(z.x2,z.y1),new r.P(z.x2,z.y2),new r.P(z.x1,z.y2)];r.bW(o,B)&&(D[j.bucketInstanceId][j.featureIndex]=!0,F[j.bucketInstanceId]===void 0&&(F[j.bucketInstanceId]=[]),F[j.bucketInstanceId].push(j.featureIndex))}return F}insertCollisionBox(t,o,p,y,b){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:b},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,p,y,b){const T=o?this.ignoredGrid:this.grid,I={bucketInstanceId:p,featureIndex:y,collisionGroupID:b};for(let D=0;D<t.length;D+=4)T.insertCircle(I,t[D],t[D+1],t[D+2])}projectAndGetPerspectiveRatio(t,o,p,y,b,T,I){const D=[o,p,y,1];let F=!1;y||this.transform.pitch>0?(r.aC(D,D,t),this.fogState&&b&&I.name!=="globe"&&(F=function(B,$,Z,Q,ne,te){const se=te.calculateFogTileMatrix(ne),me=[$,Z,Q];return r.af(me,me,se),xt(B,r.ag(me),te.pitch,te._fov)}(this.fogState,o,p,y,b.toUnwrapped(),this.transform)>.9)):Oa(D,D,t);const z=D[3];return{point:new r.P((D[0]/z+1)/2*this.transform.width+ws,(-D[1]/z+1)/2*this.transform.height+ws),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/z*.5,1.5),signedDistanceFromCamera:z,occluded:T&&D[2]>z||F}}isOffscreen(t,o,p,y){return p<ws||t>=this.screenRightBoundary||y<ws||o>this.screenBottomBoundary}isInsideGrid(t,o,p,y){return p>=0&&t<this.gridRightBoundary&&y>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const t=r.bz([]);return r.bq(t,t,[-100,-100,0]),t}}class Ti{constructor(t,o,p,y){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):y&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Pn{constructor(t,o,p,y,b,T=!1){this.text=new Ti(t?t.text:null,o,p,b),this.icon=new Ti(t?t.icon:null,o,y,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xn{constructor(t,o,p,y=!1){this.text=t,this.icon=o,this.skipFade=p,this.clipped=y}}class ks{constructor(){this.invProjMatrix=r.bB(),this.viewportMatrix=r.bB(),this.circles=[]}}class hh{constructor(t,o,p,y,b){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=b}}class dr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:p=>p.collisionGroupID===o}}return this.collisionGroups[t]}}function Zd(f,t,o,p,y){const{horizontalAlign:b,verticalAlign:T}=r.c0(f),I=-(b-.5)*t,D=-(T-.5)*o,F=r.c1(f,p);return new r.P(I+F[0]*y,D+F[1]*y)}function dh(f,t,o,p,y){const b=new r.P(f,t);return o&&b._rotate(p?y:-y),b}class fp{constructor(t,o,p,y,b,T){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new kc(this.transform,b),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new dr(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,o,p,y,b=1){const T=p.getBucket(o),I=p.latestFeatureIndex;if(!T||!I||o.fqid!==T.layerIds[0])return;const D=T.layers[0].layout,F=T.layers[0].paint,z=p.collisionBoxArray,j=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),B=p.tileSize/r.al,$=p.tileID.toUnwrapped();this.transform.setProjection(T.projection);const Z=(Q=p.tileID,ne=T.getProjection(),te=this.transform,ne.name===this.projection?te.calculateProjMatrix(Q.toUnwrapped()):Oc(te,ne,Q));var Q,ne,te;const se=D.get("text-pitch-alignment")==="map",me=D.get("text-rotation-alignment")==="map";o.compileFilter(o.options);const ce=o.dynamicFilter(),Ce=o.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(p),Re=Mi(Z,p.tileID.canonical,se,me,this.transform,T.getProjection(),_e);let Ae=null;const Te=T.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(se){const Ne=vn(Z,p.tileID.canonical,se,me,this.transform,T.getProjection(),_e);Ae=r.aB([],this.transform.labelPlaneMatrix,Ne)}let De=null;ce&&p.latestFeatureIndex&&(De={unwrappedTileID:$,dynamicFilter:ce,dynamicFilterNeedsFeature:Ce}),this.retainedQueryData[T.bucketInstanceId]=new hh(T.bucketInstanceId,I,T.sourceLayerIndex,T.index,p.tileID);const[He,Ue]=T.layers[0].layout.get("text-size-scale-range"),rt=r.aA(b,He,Ue),[Qe,lt]=D.get("icon-size-scale-range"),Lt=r.aA(b,Qe,lt),Xe={bucket:T,layout:D,paint:F,posMatrix:Z,invMatrix:Te,mercatorCenter:[r.aF(this.transform.center.lng),r.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Re,labelToScreenMatrix:Ae,clippingData:De,scale:j,textPixelRatio:B,holdingForFade:p.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:r.bJ(T.textSizeData,this.transform.zoom,rt),partiallyEvaluatedIconSize:r.bJ(T.iconSizeData,this.transform.zoom,Lt),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(y)for(const Ne of T.sortKeyRanges){const{sortKey:ct,symbolInstanceStart:et,symbolInstanceEnd:At}=Ne;t.push({sortKey:ct,symbolInstanceStart:et,symbolInstanceEnd:At,parameters:Xe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Xe})}attemptAnchorPlacement(t,o,p,y,b,T,I,D,F,z,j,B,$,Z,Q,ne,te,se,me,ce,Ce){const{textOffset0:_e,textOffset1:Re,crossTileID:Ae}=Q,Te=[_e,Re],De=Zd(t,T,I,Te,D),He=this.collisionIndex.placeCollisionBox(te,D,o,p,y,b,dh(De.x,De.y,F,z,this.transform.angle),Z,j,B,$.predicate);if(me){const Ue=te.getSymbolInstanceIconSize(Ce,this.transform.zoom,Q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(te,Ue,me,p,y,b,dh(De.x,De.y,F,z,this.transform.angle),Z,j,B,$.predicate).box.length===0)return}if(He.box.length>0){let Ue;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ae]&&this.prevPlacement.placements[Ae]&&this.prevPlacement.placements[Ae].text&&(Ue=this.prevPlacement.variableOffsets[Ae].anchor),this.variableOffsets[Ae]={textOffset:Te,width:T,height:I,anchor:t,textScale:D,prevAnchor:Ue},this.markUsedJustification(te,t,Q,se),te.allowVerticalPlacement&&(this.markUsedOrientation(te,se,Q),this.placedOrientations[Ae]=se),{shift:De,placedGlyphBoxes:He}}}placeLayerBucketPart(t,o,p,y,b=1){const{bucket:T,layout:I,paint:D,posMatrix:F,textLabelPlaneMatrix:z,labelToScreenMatrix:j,clippingData:B,textPixelRatio:$,mercatorCenter:Z,invMatrix:Q,holdingForFade:ne,collisionBoxArray:te,partiallyEvaluatedTextSize:se,partiallyEvaluatedIconSize:me,collisionGroup:ce,latestFeatureIndex:Ce}=t.parameters,_e=I.get("text-optional"),Re=I.get("icon-optional"),Ae=I.get("text-allow-overlap"),Te=I.get("icon-allow-overlap"),De=I.get("text-rotation-alignment")==="map",He=I.get("icon-rotation-alignment")==="map",Ue=I.get("text-pitch-alignment")==="map",rt=D.get("symbol-z-offset"),Qe=I.get("symbol-elevation-reference")==="sea",lt=I.get("symbol-placement"),[Lt,Xe]=I.get("text-size-scale-range"),[Ne,ct]=I.get("icon-size-scale-range"),et=r.aA(b,Lt,Xe),At=r.aA(b,Ne,ct),jt=I.get("text-variable-anchor"),pi=De&&lt!=="point",Ft=He&&lt!=="point",zt=jt&&T.hasTextData(),mi=T.hasIconTextFit()&&zt&&T.hasIconData();this.transform.setProjection(T.projection);const ni=zt||pi,ii=Ft||mi;let ri=Ae&&(Te||!T.hasIconData()||Re),Oi=Te&&(Ae||!T.hasTextData()||_e);const wn=!rt.isConstant();!T.collisionArrays&&te&&T.deserializeCollisionBoxes(te),p&&y&&T.updateCollisionDebugBuffers(this.transform.zoom,te,et,At);const In=(Ui,Dn,tn)=>{const{crossTileID:mr,numVerticalGlyphVertices:kn}=Ui;let Cr=null;if(B&&B.dynamicFilterNeedsFeature||wn){const mo=this.retainedQueryData[T.bucketInstanceId];Cr=Ce.loadFeature({featureIndex:Ui.featureIndex,bucketIndex:mo.bucketIndex,sourceLayerIndex:mo.sourceLayerIndex,layoutVertexArrayOffset:0})}if(B&&!(0,B.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:T.worldview},Cr,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new r.P(Ui.tileAnchorX,Ui.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[mr]=new Xn(!1,!1,!1,!0),void o.add(mr);const Hn=rt.evaluate(Cr,{});if(o.has(mr))return;if(ne)return void(this.placements[mr]=new Xn(!1,!1,!1));let ln=!1,rr=!1,dn=!0,zr=!1,Kn=!1,Bi=null,Bn={box:null,offscreen:null,occluded:null},Yr={box:null},Eo=null,Qr=null,xo=null,As=0,Cs=0,Za=0;tn.textFeatureIndex?As=tn.textFeatureIndex:Ui.useRuntimeCollisionCircles&&(As=Ui.featureIndex),tn.verticalTextFeatureIndex&&(Cs=tn.verticalTextFeatureIndex);const es=T.elevationFeatures?T.elevationFeatures[Ui.elevationFeatureIndex]:void 0,nl=mo=>{mo.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Mo=this.transform.elevation;mo.elevation=Qe?Hn:Hn+r.bU.getAtTileOffset(mo.tileID,new r.P(mo.tileAnchorX,mo.tileAnchorY),Mo,es),mo.elevation+=Ui.zOffset},Fa=tn.textBox;if(Fa){nl(Fa);const mo=Tr=>{let Bo=r.bK.horizontal;if(T.allowVerticalPlacement&&!Tr&&this.prevPlacement){const Ia=this.prevPlacement.placedOrientations[mr];Ia&&(this.placedOrientations[mr]=Ia,Bo=Ia,this.markUsedOrientation(T,Bo,Ui))}return Bo},Mo=(Tr,Bo)=>{if(T.allowVerticalPlacement&&kn>0&&tn.verticalTextBox){for(const Ia of T.writingModes)if(Ia===r.bK.vertical?(Bn=Bo(),Yr=Bn):Bn=Tr(),Bn&&Bn.box&&Bn.box.length)break}else Bn=Tr()};if(jt){let Tr=jt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[mr]){const ao=this.prevPlacement.variableOffsets[mr];Tr.indexOf(ao.anchor)>0&&(Tr=Tr.filter(El=>El!==ao.anchor),Tr.unshift(ao.anchor))}const Bo=(ao,El,Sf)=>{const Zc=T.getSymbolInstanceTextSize(se,Ui,this.transform.zoom,Dn),Xc=(ao.x2-ao.x1)*Zc+2*ao.padding,Yc=(ao.y2-ao.y1)*Zc+2*ao.padding,Al=Ui.hasIconTextFit&&!Te?El:null;Al&&nl(Al);let Kc={box:[],offscreen:!1,occluded:!1};const va=Ae?2*Tr.length:Tr.length;for(let Is=0;Is<va;++Is){const Ad=this.attemptAnchorPlacement(Tr[Is%Tr.length],ao,Z,Q,ni,Xc,Yc,Zc,De,Ue,$,F,ce,Is>=Tr.length,Ui,Dn,T,Sf,Al,se,me);if(Ad&&(Kc=Ad.placedGlyphBoxes,Kc&&Kc.box&&Kc.box.length)){ln=!0,Bi=Ad.shift;break}}return Kc};Mo(()=>Bo(Fa,tn.iconBox,r.bK.horizontal),()=>{const ao=tn.verticalTextBox;return ao&&nl(ao),T.allowVerticalPlacement&&!(Bn&&Bn.box&&Bn.box.length)&&kn>0&&ao?Bo(ao,tn.verticalIconBox,r.bK.vertical):{box:null,offscreen:null,occluded:null}}),Bn&&(ln=Bn.box,dn=Bn.offscreen,zr=Bn.occluded);const Ia=mo(!(!Bn||!Bn.box));if(!ln&&this.prevPlacement){const ao=this.prevPlacement.variableOffsets[mr];ao&&(this.variableOffsets[mr]=ao,this.markUsedJustification(T,ao.anchor,Ui,Ia))}}else{const Tr=(Bo,Ia)=>{const ao=T.getSymbolInstanceTextSize(se,Ui,this.transform.zoom,Dn),El=this.collisionIndex.placeCollisionBox(T,ao,Bo,Z,Q,ni,new r.P(0,0),Ae,$,F,ce.predicate);return El&&El.box&&El.box.length&&(this.markUsedOrientation(T,Ia,Ui),this.placedOrientations[mr]=Ia),El};Mo(()=>Tr(Fa,r.bK.horizontal),()=>{const Bo=tn.verticalTextBox;return T.allowVerticalPlacement&&kn>0&&Bo?(nl(Bo),Tr(Bo,r.bK.vertical)):{box:null,offscreen:null,occluded:null}}),mo(!!(Bn&&Bn.box&&Bn.box.length))}}if(Eo=Bn,ln=Eo&&Eo.box&&Eo.box.length>0,dn=Eo&&Eo.offscreen,zr=Eo&&Eo.occluded,Ui.useRuntimeCollisionCircles){const mo=Ui.centerJustifiedTextSymbolIndex>=0?Ui.centerJustifiedTextSymbolIndex:Ui.verticalPlacedTextSymbolIndex,Mo=T.text.placedSymbolArray.get(mo),Tr=r.bL(T.textSizeData,se,Mo),Bo=I.get("text-padding");Qr=this.collisionIndex.placeCollisionCircles(T,Ae,Mo,mo,T.lineVertexArray,T.glyphOffsetArray,Tr,F,z,j,p,Ue,ce.predicate,Ui.collisionCircleDiameter*Tr/r.bX,Bo,this.retainedQueryData[T.bucketInstanceId].tileID),ln=Ae||Qr.circles.length>0&&!Qr.collisionDetected,dn=dn&&Qr.offscreen,zr=Qr.occluded}if(tn.iconFeatureIndex&&(Za=tn.iconFeatureIndex),tn.iconBox){const mo=Mo=>{nl(Mo);const Tr=Ui.hasIconTextFit&&Bi?dh(Bi.x,Bi.y,De,Ue,this.transform.angle):new r.P(0,0),Bo=T.getSymbolInstanceIconSize(me,this.transform.zoom,Ui.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,Bo,Mo,Z,Q,ii,Tr,Te,$,F,ce.predicate)};Yr&&Yr.box&&Yr.box.length&&tn.verticalIconBox?(xo=mo(tn.verticalIconBox),rr=xo.box.length>0):(xo=mo(tn.iconBox),rr=xo.box.length>0),dn=dn&&xo.offscreen,Kn=xo.occluded}const rl=_e||Ui.numHorizontalGlyphVertices===0&&kn===0,fs=Re||Ui.numIconVertices===0;if(rl||fs?fs?rl||(rr=rr&&ln):ln=rr&&ln:rr=ln=rr&&ln,ln&&Eo&&Eo.box&&this.collisionIndex.insertCollisionBox(Eo.box,I.get("text-ignore-placement"),T.bucketInstanceId,Yr&&Yr.box&&Cs?Cs:As,ce.ID),rr&&xo&&this.collisionIndex.insertCollisionBox(xo.box,I.get("icon-ignore-placement"),T.bucketInstanceId,Za,ce.ID),Qr&&(ln&&this.collisionIndex.insertCollisionCircles(Qr.circles,I.get("text-ignore-placement"),T.bucketInstanceId,As,ce.ID),p)){const mo=T.bucketInstanceId;let Mo=this.collisionCircleArrays[mo];Mo===void 0&&(Mo=this.collisionCircleArrays[mo]=new ks);for(let Tr=0;Tr<Qr.circles.length;Tr+=4)Mo.circles.push(Qr.circles[Tr+0]),Mo.circles.push(Qr.circles[Tr+1]),Mo.circles.push(Qr.circles[Tr+2]),Mo.circles.push(Qr.collisionDetected?1:0)}const Ca=T.projection.name!=="globe";ri=ri&&(Ca||!zr),Oi=Oi&&(Ca||!Kn),this.placements[mr]=new Xn(ln||ri,rr||Oi,dn||T.justReloaded),o.add(mr)},vr=this.retainedQueryData[T.bucketInstanceId].tileID;if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,vr),T.elevationType==="road"&&T.updateRoadElevation(vr.canonical),T.updateZOffset(),T.sortFeaturesByY){const Ui=T.getSortedSymbolIndexes(this.transform.angle);for(let Dn=Ui.length-1;Dn>=0;--Dn){const tn=Ui[Dn];In(T.symbolInstances.get(tn),tn,T.collisionArrays[tn])}T.hasAnyZOffset&&r.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Ui=T.getSortedIndexesByZOffset();for(let Dn=0;Dn<Ui.length;++Dn){const tn=Ui[Dn];In(T.symbolInstances.get(tn),tn,T.collisionArrays[tn])}}else for(let Ui=t.symbolInstanceStart;Ui<t.symbolInstanceEnd;Ui++)In(T.symbolInstances.get(Ui),Ui,T.collisionArrays[Ui]);if(p&&T.bucketInstanceId in this.collisionCircleArrays){const Ui=this.collisionCircleArrays[T.bucketInstanceId];r.bk(Ui.invProjMatrix,F),Ui.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(t,o,p,y){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:D,crossTileID:F}=p,z=r.c2(o),j=y===r.bK.vertical?D:z==="left"?b:z==="center"?T:z==="right"?I:-1;b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=j>=0&&b!==j?0:F),T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=j>=0&&T!==j?0:F),I>=0&&(t.text.placedSymbolArray.get(I).crossTileID=j>=0&&I!==j?0:F),D>=0&&(t.text.placedSymbolArray.get(D).crossTileID=j>=0&&D!==j?0:F)}markUsedOrientation(t,o,p){const y=o===r.bK.horizontal||o===r.bK.horizontalOnly?o:0,b=o===r.bK.vertical?o:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:F}=p,z=t.text.placedSymbolArray;T>=0&&(z.get(T).placedOrientation=y),I>=0&&(z.get(I).placedOrientation=y),D>=0&&(z.get(D).placedOrientation=y),F>=0&&(z.get(F).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let p=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const y=o?o.symbolFadeChange(t):1,b=o?o.opacities:{},T=o?o.variableOffsets:{},I=o?o.placedOrientations:{};for(const D in this.placements){const F=this.placements[D],z=b[D];z?(this.opacities[D]=new Pn(z,y,F.text,F.icon,null,F.clipped),p=p||F.text!==z.text.placed||F.icon!==z.icon.placed):(this.opacities[D]=new Pn(null,y,F.text,F.icon,F.skipFade,F.clipped),p=p||F.text||F.icon)}for(const D in b){const F=b[D];if(!this.opacities[D]){const z=new Pn(F,y,!1,!1);z.isHidden()||(this.opacities[D]=z,p=p||F.text.placed||F.icon.placed)}}for(const D in T)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=T[D]);for(const D in I)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=I[D]);p?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o,p,y){const b=new Set;for(const T of o){const I=T.getBucket(t);I&&T.latestFeatureIndex&&t.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,b,T,T.collisionBoxArray,p,y,T.tileID,t.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,T.tileID),I.elevationType==="road"&&I.updateRoadElevation(T.tileID.canonical),I.updateZOffset())}}updateBucketOpacities(t,o,p,y,b,T,I,D){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const F=t.layers[0].layout,z=t.layers[0].paint,j=!!t.layers[0].dynamicFilter(),B=new Pn(null,0,!1,!1,!0),$=F.get("text-allow-overlap"),Z=F.get("icon-allow-overlap"),Q=F.get("text-variable-anchor"),ne=F.get("text-rotation-alignment")==="map",te=F.get("text-pitch-alignment")==="map",se=z.get("symbol-z-offset"),me=F.get("symbol-elevation-reference")==="sea",ce=!se.isConstant(),Ce=new Pn(null,0,$&&(Z||!t.hasIconData()||F.get("icon-optional")),Z&&($||!t.hasTextData()||F.get("text-optional")),!0);!t.collisionArrays&&y&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(y);const _e=(Ae,Te,De)=>{for(let He=0;He<Te/4;He++)Ae.opacityVertexArray.emplaceBack(De)};let Re=0;T&&t.updateReplacement(I,T);for(let Ae=0;Ae<t.symbolInstances.length;Ae++){const Te=t.symbolInstances.get(Ae),{numHorizontalGlyphVertices:De,numVerticalGlyphVertices:He,crossTileID:Ue,numIconVertices:rt,tileAnchorX:Qe,tileAnchorY:lt}=Te;let Lt=null;const Xe=this.retainedQueryData[t.bucketInstanceId];ce&&Te&&Xe&&(Lt=p.latestFeatureIndex.loadFeature({featureIndex:Te.featureIndex,bucketIndex:Xe.bucketIndex,sourceLayerIndex:Xe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ne=se.evaluate(Lt,{}),ct=o.has(Ue);let et=this.opacities[Ue];ct?et=B:et||(et=Ce,this.opacities[Ue]=et),o.add(Ue);const At=De>0||He>0,jt=rt>0,pi=this.placedOrientations[Ue],Ft=pi===r.bK.vertical,zt=pi===r.bK.horizontal||pi===r.bK.horizontalOnly;!At&&!jt||et.isHidden()||Re++;let mi=!1;if((At||jt)&&T)for(const ni of t.activeReplacements){if(r.bY(ni,b,r.bZ.Symbol,D)||ni.min.x>Qe||Qe>ni.max.x||ni.min.y>lt||lt>ni.max.y)continue;const ii=r.b_(Qe,lt,I.canonical,ni.footprintTileId.canonical);if(mi=r.b$(ii,ni.footprint),mi)break}if(At){const ni=mi?Do:Ja(et.text);_e(t.text,De,Ft?Do:ni),_e(t.text,He,zt?Do:ni);const ii=et.text.isHidden(),{leftJustifiedTextSymbolIndex:ri,centerJustifiedTextSymbolIndex:Oi,rightJustifiedTextSymbolIndex:wn,verticalPlacedTextSymbolIndex:In}=Te,vr=t.text.placedSymbolArray,Ui=ii||Ft?1:0;ri>=0&&(vr.get(ri).hidden=Ui),Oi>=0&&(vr.get(Oi).hidden=Ui),wn>=0&&(vr.get(wn).hidden=Ui),In>=0&&(vr.get(In).hidden=ii||zt?1:0);const Dn=this.variableOffsets[Ue];Dn&&this.markUsedJustification(t,Dn.anchor,Te,pi);const tn=this.placedOrientations[Ue];tn&&(this.markUsedJustification(t,"left",Te,tn),this.markUsedOrientation(t,tn,Te))}if(jt){const ni=mi?Do:Ja(et.icon),{placedIconSymbolIndex:ii,verticalPlacedIconSymbolIndex:ri}=Te,Oi=t.icon.placedSymbolArray,wn=et.icon.isHidden()?1:0;ii>=0&&(_e(t.icon,rt,Ft?Do:ni),Oi.get(ii).hidden=wn),ri>=0&&(_e(t.icon,Te.numVerticalIconVertices,zt?Do:ni),Oi.get(ri).hidden=wn)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ni=t.collisionArrays[Ae];if(ni){let ii=new r.P(0,0),ri=!0;if(ni.textBox||ni.verticalTextBox){if(Q){const wn=this.variableOffsets[Ue];wn?(ii=Zd(wn.anchor,wn.width,wn.height,wn.textOffset,wn.textScale),ne&&ii._rotate(te?this.transform.angle:-this.transform.angle)):ri=!1}j&&(ri=!et.clipped),ni.textBox&&Lo(t.textCollisionBox.collisionVertexArray,et.text.placed,!ri||Ft,Ne,me,ii.x,ii.y),ni.verticalTextBox&&Lo(t.textCollisionBox.collisionVertexArray,et.text.placed,!ri||zt,Ne,me,ii.x,ii.y)}const Oi=ri&&!!(!zt&&ni.verticalIconBox);ni.iconBox&&Lo(t.iconCollisionBox.collisionVertexArray,et.icon.placed,Oi,Ne,me,Te.hasIconTextFit?ii.x:0,Te.hasIconTextFit?ii.y:0),ni.verticalIconBox&&Lo(t.iconCollisionBox.collisionVertexArray,et.icon.placed,!Oi,Ne,me,Te.hasIconTextFit?ii.x:0,Te.hasIconTextFit?ii.y:0)}}}if(t.fullyClipped=Re===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Ae.invProjMatrix,t.placementViewportMatrix=Ae.viewportMatrix,t.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){const p=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*p>t}setStale(){this.stale=!0}}function Lo(f,t,o,p,y,b,T){f.emplaceBack(t?1:0,o?1:0,b||0,T||0,p,y?1:0),f.emplaceBack(t?1:0,o?1:0,b||0,T||0,p,y?1:0),f.emplaceBack(t?1:0,o?1:0,b||0,T||0,p,y?1:0),f.emplaceBack(t?1:0,o?1:0,b||0,T||0,p,y?1:0)}const na=Math.pow(2,25),N_=Math.pow(2,24),ld=Math.pow(2,17),pp=Math.pow(2,16),mp=Math.pow(2,9),cd=Math.pow(2,8),zm=Math.pow(2,1);function Ja(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const t=f.placed?1:0,o=Math.floor(127*f.opacity);return o*na+t*N_+o*ld+t*pp+o*mp+t*cd+o*zm+t}const Do=0;class zo{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,o,p,y,b,T){const I=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(I,y,t[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((D,F)=>D.sortKey-F.sortKey));this._currentPartIndex<I.length;){const D=I[this._currentPartIndex];if(o.placeLayerBucketPart(D,this._seenCrossTileIDs,p,D.symbolInstanceStart===0,T),this._currentPartIndex++,b())return!0}return!1}}class sa{constructor(t,o,p,y,b,T,I,D,F){this.placement=new fp(t,b,T,I,D,F),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(t,o,p,y,b){const T=r.o.now(),I=()=>{const D=r.o.now()-T;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=o[t[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&(!D.minzoom||D.minzoom<=F)&&(!D.maxzoom||D.maxzoom>F)){const z=D,j=z.layout.get("symbol-z-elevate"),B=z.layout.get("symbol-sort-key").constantOr(1)!==void 0,$=z.layout.get("symbol-z-order"),Z=$==="viewport-y"||$==="auto"&&!($!=="viewport-y"&&B),Q=z.layout.get("text-allow-overlap")||z.layout.get("icon-allow-overlap")||z.layout.get("text-ignore-placement")||z.layout.get("icon-ignore-placement"),ne=Z&&Q,te=this._inProgressLayer=this._inProgressLayer||new zo(z),se=r.B(D.source,D.scope);if(te.continuePlacement(j||ne?y[se]:p[se],this.placement,this._showCollisionBoxes,D,I,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Xd=512/r.al/2;class Su{constructor(t,o,p){this.tileID=t,this.bucketInstanceId=p,this.index=new r.c3(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=t.canonical.x*r.al,b=t.canonical.y*r.al;for(let T=0;T<o.length;T++){const{key:I,crossTileID:D,tileAnchorX:F,tileAnchorY:z}=o.get(T),j=Math.floor((y+F)*Xd),B=Math.floor((b+z)*Xd);this.index.add(j,B),this.keys.push(I),this.crossTileIDs.push(D)}this.index.finish()}findMatches(t,o,p){const y=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),b=Xd/Math.pow(2,o.canonical.z-this.tileID.canonical.z),T=o.canonical.x*r.al,I=o.canonical.y*r.al;for(let D=0;D<t.length;D++){const F=t.get(D);if(F.crossTileID)continue;const{key:z,tileAnchorX:j,tileAnchorY:B}=F,$=Math.floor((T+j)*b),Z=Math.floor((I+B)*b),Q=this.index.range($-y,Z-y,$+y,Z+y).sort((ne,te)=>ne-te);for(const ne of Q){const te=this.crossTileIDs[ne];if(this.keys[ne]===z&&!p.has(te)){p.add(te),F.crossTileID=te;break}}}}}class _a{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Qs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const o=Math.round((t-this.lng)/360);if(o!==0)for(const p in this.indexes){const y=this.indexes[p],b={};for(const T in y){const I=y[T];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+o),b[I.tileID.key]=I}this.indexes[p]=b}this.lng=t}addBucket(t,o,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<o.symbolInstances.length;b++)o.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const y=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>t.overscaledZ)for(const I in T){const D=T[I];D.tileID.isChildOf(t)&&D.findMatches(o.symbolInstances,t,y)}else{const I=T[t.scaledTo(Number(b)).key];I&&I.findMatches(o.symbolInstances,t,y)}}for(let b=0;b<o.symbolInstances.length;b++){const T=o.symbolInstances.get(b);T.crossTileID||(T.crossTileID=p.generate(),y.add(T.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Su(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(const p of o.crossTileIDs)this.usedCrossTileIDs[t].delete(p)}removeStaleBuckets(t){let o=!1;for(const p in this.indexes){const y=this.indexes[p];for(const b in y)t[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[b]),delete y[b],o=!0)}return o}}class Eu{constructor(){this.layerIndexes={},this.crossTileIDs=new _a,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,p,y){let b=this.layerIndexes[t.fqid];b===void 0&&(b=this.layerIndexes[t.fqid]=new Qs);let T=!1;const I={};y.name!=="globe"&&b.handleWrapJump(p);for(const D of o){const F=D.getBucket(t);F&&t.fqid===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(D.tileID,F,this.crossTileIDs)&&(T=!0),I[F.bucketInstanceId]=!0)}return b.removeStaleBuckets(I)&&(T=!0),T}pruneUnusedLayers(t){const o={};t.forEach(p=>{o[p]=!0});for(const p in this.layerIndexes)o[p]||delete this.layerIndexes[p]}}const No=771;class sn{constructor(t,o,p,y){this.blendFunction=t,this.blendColor=o.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=y}}sn.Replace=[1,0,1,0],sn.disabled=new sn(sn.Replace,r.ao.transparent,[!1,!1,!1,!1]),sn.unblended=new sn(sn.Replace,r.ao.transparent,[!0,!0,!0,!0]),sn.alphaBlended=new sn([1,No,1,No],r.ao.transparent,[!0,!0,!0,!0]),sn.alphaBlendedNonPremultiplied=new sn([770,No,770,No],r.ao.transparent,[!0,!0,!0,!0]),sn.multiply=new sn([774,0,774,0],r.ao.transparent,[!0,!0,!0,!0]),sn.additive=new sn([1,1,1,1],r.ao.transparent,[!0,!0,!0,!0]);class _i{constructor(t,o,p){this.func=t,this.mask=o,this.range=p}}_i.ReadOnly=!1,_i.ReadWrite=!0,_i.disabled=new _i(519,_i.ReadOnly,[0,1]);const ud=7680;class Gi{constructor(t,o,p,y,b,T){this.test=t,this.ref=o,this.mask=p,this.fail=y,this.depthFail=b,this.pass=T}}Gi.disabled=new Gi({func:519,mask:0},0,0,ud,ud,ud);const hd=1029,Nm=2305;class Vi{constructor(t,o,p){this.enable=t,this.mode=o,this.frontFace=p}}function gp(f,t){const o=r.c9(f,3);r.cb(f,t),r.cf(f,3,o)}function _p(f,t){const o=r.c6([]);return r.c7(o,o,-t),r.c8(o,o,-f),o}function dd(f,t){const o=[f[0],f[1],0],p=[t[0],t[1],0];if(r.ag(o)>=1e-15){const T=r.aw([],o);r.c4(p,T,r.bI(p,T)),t[0]=p[0],t[1]=p[1]}const y=r.bH([],t,f);if(r.c5(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return _p(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),b)}Vi.disabled=new Vi(!1,hd,Nm),Vi.backCCW=new Vi(!0,hd,Nm),Vi.backCW=new Vi(!0,hd,2304),Vi.frontCW=new Vi(!0,1028,2304),Vi.frontCCW=new Vi(!0,1028,Nm);class Ll{constructor(t,o){this.position=t,this.orientation=o}get position(){return this._position}set position(t){if(t){const o=t instanceof r.ae?t:new r.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(o.x=r.bS(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(t,o,p){if(this.orientation=null,!this.position)return;const y=this.position,b=p||(this._elevation?this._elevation.getAtPointOrZero(r.ae.fromLngLat(t)):0),T=r.ae.fromLngLat(t,b),I=[T.x-y.x,T.y-y.y,T.z-y.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=dd(I,o)}setPitchBearing(t,o){this.orientation=_p(r.an(t),r.an(-o))}}class yp{constructor(t,o){this._transform=r.bz([]),this.orientation=o,this.position=t}get mercatorPosition(){const t=this.position;return new r.ae(t[0],t[1],t[2])}get position(){const t=r.c9(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var o;t&&r.cf(this._transform,3,[(o=t)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||r.c6([]),t&&gp(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,o){this._orientation=_p(t,o),gp(this._transform,this._orientation)}forward(){const t=r.c9(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=r.c9(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=r.c9(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,o){const p=new Float64Array(16);return r.bk(p,this.getWorldToCamera(t,o)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,o,p){const y=this.position;r.c4(y,y,-t);const b=new Float64Array(16);return r.bp(b,[p,p,p]),r.bq(b,b,y),b[10]*=o,b}getWorldToCamera(t,o){const p=new Float64Array(16),y=new Float64Array(4),b=this.position;return r.ca(y,this._orientation),r.c4(b,b,-t),r.cb(p,y),r.bq(p,p,b),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=o,p[9]*=o,p[10]*=o,p[11]*=o,p}getCameraToClipPerspective(t,o,p,y){const b=new Float64Array(16);return r.cc(b,t,o,p,y),b}getCameraToClipOrthographic(t,o,p,y,b,T){const I=new Float64Array(16);return r.cd(I,t,o,p,y,b,T),I}getDistanceToElevation(t,o=!1){const p=t===0?0:r.ce(t,o?r.a_(this.position[1]):this.position[1]),y=this.forward();return(p-this.position[2])/y[2]}clone(){return new yp([...this.position],[...this.orientation])}}const Sa={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ls{constructor(t=0,o=0,p=0,y=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(p)||p<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=p,this.right=y}interpolate(t,o,p){return o.top!=null&&t.top!=null&&(this.top=r.ak(t.top,o.top,p)),o.bottom!=null&&t.bottom!=null&&(this.bottom=r.ak(t.bottom,o.bottom,p)),o.left!=null&&t.left!=null&&(this.left=r.ak(t.left,o.left,p)),o.right!=null&&t.right!=null&&(this.right=r.ak(t.right,o.right,p)),this}getCenter(t,o){const p=r.aA((this.left+t-this.right)/2,0,t),y=r.aA((this.top+o-this.bottom)/2,0,o);return new r.P(p,y)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ls(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const fd=15;class Yd{constructor(t,o,p,y,b,T,I){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=p??0,this._maxPitch=y??60,this.setProjection(T),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new r.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ls,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new yp,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Yd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<fd}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,o=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(t||p)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return r.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=r.cl(this.projectionOptions);const p=this.getProjection(),y=!r.bx(o,p);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.cl({name:"mercator"});const o=t!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bS(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const o=-t*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=r.cm(),r.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const o=r.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=r.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let y=0,b=0;for(let T=0;T<o.length;T++){const I=new r.P(o[T][0]*this.width,p+o[T][1]*(this.height-p)),D=t.pointCoordinate(I);if(!D)continue;const F=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);y+=D[3]*F,b+=F}return b===0?NaN:y/b}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*o,y=this._mercatorZfromZoom(t),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(y-p,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let p;p=t.z<this._camera.position[2]?[o.x,o.y,o.z]:[t.x,t.y,t.z];const y=r.ag(r.av([],this._camera.position,p));return r.aA(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let o=!1;if(t.orientation&&!r.co(t.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(t.orientation)),t.position){const p=[t.position.x,t.position.y,t.position.z];r.cp(p,this._camera.position)||(this._setCameraPosition(p),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,o=new Ll;return o.position=new r.ae(t[0],t[1],t[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(t){if(!r.cq(t))return!1;r.cr(t,t);const o=r.cs([],[0,0,-1],t),p=r.cs([],[0,-1,0],t);if(p[2]<0)return!1;const y=dd(o,p);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(t){const o=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;t[2]=r.aA(t[2],y/p,y/o),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,p){this._unmodified=!1,this._edgeInsets.interpolate(t,o,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){const o=[new r.ct(0,t)];if(this.renderWorldCopies){const p=this.pointCoordinate(new r.P(0,0)),y=this.pointCoordinate(new r.P(this.width,0)),b=this.pointCoordinate(new r.P(this.width,this.height)),T=this.pointCoordinate(new r.P(0,this.height)),I=Math.floor(Math.min(p.x,y.x,b.x,T.x)),D=Math.floor(Math.max(p.x,y.x,b.x,T.x)),F=1;for(let z=I-F;z<=D+F;z++)z!==0&&o.push(new r.ct(z,t))}return o}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,o,p){let y=[];const b=p!=null,T=!b;if(T&&this.zoom<o||b&&p[0]===0&&p[1]===0)return y;const I=new Set,D=(z,j,B,$,Z)=>{const Q=r.cX(j,z,B,$,Z);I.has(Q)||(y.push(new r.aP(z,j,B,$,Z)),I.add(Q))};for(let z=0;z<t.length;z++){const j=t[z];if(T&&j.canonical.z!==o)continue;const B=j.canonical,$=j.overscaledZ,Z=j.wrap,Q=1<<B.z,ne=B.x+1<Q,te=B.x>0,se=B.y+1<Q,me=B.y>0,ce=j.wrap-(te?0:1),Ce=j.wrap+(ne?0:1),_e=te?B.x-1:Q-1,Re=ne?B.x+1:0;if(b)p[0]<0?(D($,Ce,B.z,Re,B.y),p[1]<0&&se&&(D($,Z,B.z,B.x,B.y+1),D($,Ce,B.z,Re,B.y+1)),p[1]>0&&me&&(D($,Z,B.z,B.x,B.y-1),D($,Ce,B.z,Re,B.y-1))):p[0]>0?(D($,ce,B.z,_e,B.y),p[1]<0&&se&&(D($,Z,B.z,B.x,B.y+1),D($,ce,B.z,_e,B.y+1)),p[1]>0&&me&&(D($,Z,B.z,B.x,B.y-1),D($,ce,B.z,_e,B.y-1))):p[1]<0&&se?D($,Z,B.z,B.x,B.y+1):me&&D($,Z,B.z,B.x,B.y-1);else{const Ae=j.visibleQuadrants;1&Ae&&(D($,ce,B.z,_e,B.y),me&&(D($,Z,B.z,B.x,B.y-1),D($,ce,B.z,_e,B.y-1))),2&Ae&&(D($,Ce,B.z,Re,B.y),me&&(D($,Z,B.z,B.x,B.y-1),D($,Ce,B.z,Re,B.y-1))),4&Ae&&(D($,ce,B.z,_e,B.y),se&&(D($,Z,B.z,B.x,B.y+1),D($,ce,B.z,_e,B.y+1))),8&Ae&&(D($,Ce,B.z,Re,B.y),se&&(D($,Z,B.z,B.x,B.y+1),D($,Ce,B.z,Re,B.y+1)))}}const F=[];for(const z of y)y.some(j=>z.isChildOf(j))||F.push(z);if(y=F.filter(z=>!t.some(j=>!!(z.overscaledZ<o&&j.isChildOf(z))||z.equals(j)||z.isChildOf(j))),T){const z=1<<o,j=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),B=[z*j.x,z*j.y],$=4,Z=$*$;y=y.filter(Q=>{const ne=Q.canonical.x+.5-B[0],te=Q.canonical.y+.5-B[1];return ne*ne+te*te<Z})}return y}extendTileCoverToNearPlane(t,o,p){const y=[],b=new Set;for(const se of t)b.add(se.key);const T=(se,me,ce,Ce,_e)=>{const Re=r.cX(me,se,ce,Ce,_e);b.has(Re)||(y.push(new r.aP(se,me,ce,Ce,_e)),b.add(Re))},I=t.reduce((se,me)=>Math.max(se,me.overscaledZ),p),D=1<<p,F=[new r.P(0,0),new r.P(r.al,0),new r.P(r.al,r.al),new r.P(0,r.al)],z=new r.P(0,0),j=new r.P(0,0),B=(se,me)=>{const ce=Math.floor(se[0]),Ce=Math.floor(se[1]),_e=(se[0]-ce)*r.al,Re=(se[1]-Ce)*r.al,Ae=Math.floor(me[0]),Te=Math.floor(me[1]),De=(me[0]-Ae)*r.al,He=(me[1]-Te)*r.al;for(let Ue=-1;Ue<=1;Ue++){const rt=ce+Ue;if(!(rt<0||rt>=D)){z.x=_e-Ue*r.al,j.x=De-(rt-Ae)*r.al;for(let Qe=-1;Qe<=1;Qe++){const lt=Ce+Qe;z.y=Re-Qe*r.al,j.y=He-(lt-Te)*r.al,r.cY(z,j,F)&&T(I,0,p,rt,lt)}}}},$=o.points,Z=$[r.cu],Q=$[r.cv],ne=this._projectToGround(Z,$[r.cw]),te=this._projectToGround(Q,$[r.cx]);return B(Z,ne),B(Q,te),y}_projectToGround(t,o){return r.cy(r.cz(),t,o,t[2]/(t[2]-o[2]))}coveringTiles(t){let o=this.coveringZoomLevel(t);const p=o,y=this.elevation&&this.elevation.exaggeration(),b=y&&!t.isTerrainDEM,T=this.projection.name==="mercator";if(t.minzoom!==void 0&&o<t.minzoom)return[];t.maxzoom!==void 0&&o>t.maxzoom&&(o=t.maxzoom);const I=this.locationCoordinate(this.center),D=this.center.lat,F=1<<o,z=[F*I.x,F*I.y,0],j=this.projection.name==="globe",B=!j,$=r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,B),Z=j?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=F*r.ce(1,this.center.lat),ne=this._camera.position[2]/r.ce(1,this.center.lat),te=[F*Z.x,F*Z.y,ne*(B?1:Q)],se=j||y,me=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ce=this.isLODDisabled(!0)?o:0;let Ce;if(this._elevation&&t.isTerrainDEM)Ce=1e4*this._elevation.exaggeration();else if(this._elevation){const Ne=this._elevation.getMinMaxForVisibleTiles();Ce=Ne?Ne.max:this._centerAltitude}else Ce=this._centerAltitude;const _e=t.isTerrainDEM?-Ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,Re=this.projection.isReprojectedInTileSpace?r.cB(this):1,Ae=Ne=>{const et=new r.ae(Ne.x+25e-6,Ne.y,Ne.z),At=new r.ae(Ne.x,Ne.y+25e-6,Ne.z),jt=Ne.toLngLat(),pi=et.toLngLat(),Ft=At.toLngLat(),zt=this.locationCoordinate(jt),mi=this.locationCoordinate(pi),ni=this.locationCoordinate(Ft),ii=Math.hypot(mi.x-zt.x,mi.y-zt.y),ri=Math.hypot(ni.x-zt.x,ni.y-zt.y);return Math.sqrt(ii*ri)*Re/25e-6},Te=Ne=>{const ct=Ce,et=_e;return{aabb:r.cE(this,F,0,0,0,Ne,et,ct,this.projection),zoom:0,x:0,y:0,minZ:et,maxZ:ct,wrap:Ne,fullyVisible:!1}},De=[];let He=[];const Ue=o,rt=t.reparseOverscaled?p:o,Qe=(ne-this._centerAltitude)*Q,lt=Ne=>{if(!this._elevation||!Ne.tileID||!T)return;const ct=this._elevation.getMinMaxForTile(Ne.tileID),et=Ne.aabb;ct?(et.min[2]=ct.min,et.max[2]=ct.max,et.center[2]=(et.min[2]+et.max[2])/2):(Ne.shouldSplit=Xe(Ne),Ne.shouldSplit||(et.min[2]=et.max[2]=et.center[2]=this._centerAltitude))},Lt=(Ne,ct)=>{if(.707*ct<Ne)return 1;const et=ct/Ne;return et/(1.4144271570014144+(Math.pow(1.1,et-1.4144271570014144+1)-1)/(1.1-1)-1)},Xe=Ne=>{if(Ne.zoom<ce)return!0;if(Ne.zoom===Ue)return!1;if(Ne.shouldSplit!=null)return Ne.shouldSplit;const ct=Ne.aabb.distanceX(te),et=Ne.aabb.distanceY(te);let At=Qe,jt=1;if(j){At=Ne.aabb.distanceZ(te);const ri=Math.pow(2,Ne.zoom),Oi=r.a_((Ne.y+1)/ri),wn=r.a_(Ne.y/ri),In=Math.min(Math.max(D,Oi),wn),vr=r.d0(In)/r.d0(D);if(jt=In===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,vr/this._mercatorScaleRatio),this.zoom<=r.cZ&&Ne.zoom===Ue-1&&vr>=.9)return!0}else if(b&&(At=Ne.aabb.distanceZ(te)*Q),this.projection.isReprojectedInTileSpace&&p<=5){const ri=Math.pow(2,Ne.zoom),Oi=Ae(new r.ae((Ne.x+.5)/ri,(Ne.y+.5)/ri));jt=Oi>.85?1:Oi}if(!T&&!j){const ri=Math.sqrt(ct*ct+et*et+At*At);let Oi=(1<<Ue-Ne.zoom)*me*jt;return Oi*=Lt(Math.max(At,Qe),ri),ri<Oi}let pi=Number.MAX_VALUE,Ft=0;const zt=Ne.aabb.getCorners(),mi=[];for(const ri of zt){r.av(mi,ri,te),j||(b?mi[2]*=Q:mi[2]=Qe);const Oi=r.bI(mi,this._camera.forward());Oi<pi&&(pi=Oi,Ft=Math.abs(mi[2]))}let ni=(1<<Ue-Ne.zoom)*me*jt;if(ni*=Lt(Math.max(Ft,Qe),pi),pi<ni)return!0;const ii=Ne.aabb.closestPoint(z);return ii[0]===z[0]&&ii[1]===z[1]};if(this.renderWorldCopies)for(let Ne=1;Ne<=3;Ne++)De.push(Te(-Ne)),De.push(Te(Ne));for(De.push(Te(0));De.length>0;){const Ne=De.pop(),ct=Ne.x,et=Ne.y;let At=Ne.fullyVisible;const jt=()=>this.projection.name==="globe"&&(Ne.y===0||Ne.y===(1<<Ne.zoom)-1);if(!At){let pi=se?Ne.aabb.intersects($):Ne.aabb.intersectsFlat($);if(pi===0&&jt()){const Ft=new r.cC(Ne.zoom,ct,et);pi=r.cD(this,F,Ft,!0).intersects($)}if(pi===0)continue;At=pi===2}if(Ne.zoom!==Ue&&Xe(Ne))for(let pi=0;pi<4;pi++){const Ft=(ct<<1)+pi%2,zt=(et<<1)+(pi>>1),mi={aabb:T?Ne.aabb.quadrant(pi):r.cE(this,F,Ne.zoom+1,Ft,zt,Ne.wrap,Ne.minZ,Ne.maxZ,this.projection),zoom:Ne.zoom+1,x:Ft,y:zt,wrap:Ne.wrap,fullyVisible:At,tileID:void 0,shouldSplit:void 0,minZ:Ne.minZ,maxZ:Ne.maxZ};b&&!j&&(mi.tileID=new r.aP(Ne.zoom+1===Ue?rt:Ne.zoom+1,Ne.wrap,Ne.zoom+1,Ft,zt),lt(mi)),De.push(mi)}else{const pi=Ne.zoom===Ue?rt:Ne.zoom;if(t.minzoom&&t.minzoom>pi)continue;let Ft=0;if(!At){let ii=se?Ne.aabb.intersectsPrecise($):Ne.aabb.intersectsPreciseFlat($);if(ii===0&&jt()){const ri=new r.cC(Ne.zoom,ct,et);ii=r.cD(this,F,ri,!0).intersectsPrecise($)}if(ii===0)continue;if(t.calculateQuadrantVisibility)if($.containsPoint(Ne.aabb.center))Ft=15;else for(let ri=0;ri<4;ri++)Ne.aabb.quadrant(ri).intersects($)!==0&&(Ft|=1<<ri)}const zt=z[0]-(.5+ct+(Ne.wrap<<Ne.zoom))*(1<<o-Ne.zoom),mi=z[1]-.5-et,ni=Ne.tileID?Ne.tileID:new r.aP(pi,Ne.wrap,Ne.zoom,ct,et);t.calculateQuadrantVisibility&&(ni.visibleQuadrants=Ft),He.push({tileID:ni,distanceSq:zt*zt+mi*mi})}}if(this.fogCullDistSq){const Ne=this.fogCullDistSq,ct=this.horizonLineFromTop();He=He.filter(et=>{const At=[0,0,0,1],jt=[r.al,r.al,0,1],pi=this.calculateFogTileMatrix(et.tileID.toUnwrapped());r.aC(At,At,pi),r.aC(jt,jt,pi);const Ft=r.cF([],At,jt),zt=r.cG([],At,jt),mi=r.c_(Ft,zt);if(mi===0)return!0;let ni=!1;const ii=this._elevation;if(ii&&mi>Ne&&ct!==0){const ri=this.calculateProjMatrix(et.tileID.toUnwrapped());let Oi;t.isTerrainDEM||(Oi=ii.getMinMaxForTile(et.tileID)),Oi||(Oi={min:_e,max:Ce});const wn=r.cH(this.rotation),In=[wn[0]*r.al,wn[1]*r.al,Oi.max];r.af(In,In,ri),ni=(1-In[1])*this.height*.5<ct}return mi<Ne||ni})}return He.sort((Ne,ct)=>Ne.distanceSq-ct.distanceSq).map(Ne=>Ne.tileID)}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const o=r.aA(t.lat,-r.cI,r.cI),p=this.projection.project(t.lng,o);return new r.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,o){let p,y;const b=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;p=(o.x-b.x)/I,y=(o.y-b.y)/I}else{const I=this.pointCoordinate(o),D=this.pointCoordinate(b);p=I.x-D.x,y=I.y-D.y}const T=this.locationCoordinate(t);this.setLocation(new r.ae(T.x-p,T.y-y))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,o){return this.projection.locationPoint(this,t,o)}locationPoint3D(t,o){return this.projection.locationPoint(this,t,o,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,o){return this.coordinateLocation(this.pointCoordinate3D(t,o))}locationCoordinate(t,o){const p=o?r.ce(o,t.lat):void 0,y=this.projection.project(t.lng,t.lat);return new r.ae(y.x,y.y,p)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,o){const p=o??this._centerAltitude,y=[t.x,t.y,0,1],b=[t.x,t.y,1,1];r.aC(y,y,this.pixelMatrixInverse),r.aC(b,b,this.pixelMatrixInverse);const T=b[3];r.cJ(y,y,1/y[3]),r.cJ(b,b,1/T);const I=y[2],D=b[2];return{p0:y,p1:b,t:I===D?0:(p-I)/(D-I)}}screenPointToMercatorRay(t){const o=[t.x,t.y,0,1],p=[t.x,t.y,1,1];return r.aC(o,o,this.pixelMatrixInverse),r.aC(p,p,this.pixelMatrixInverse),r.cJ(o,o,1/o[3]),r.cJ(p,p,1/p[3]),o[2]=r.ce(o[2],this._center.lat)*this.worldSize,p[2]=r.ce(p[2],this._center.lat)*this.worldSize,r.cJ(o,o,1/this.worldSize),r.cJ(p,p,1/this.worldSize),new r.ax([o[0],o[1],o[2]],r.aw([],r.av([],p,o)))}rayIntersectionCoordinate(t){const{p0:o,p1:p,t:y}=t,b=r.ce(o[2],this._center.lat),T=r.ce(p[2],this._center.lat);return new r.ae(r.ak(o[0],p[0],y)/this.worldSize,r.ak(o[1],p[1],y)/this.worldSize,r.ak(b,T,y))}pointCoordinate(t,o=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,o)}pointCoordinate3D(t,o){if(!this.elevation)return this.pointCoordinate(t,o);let p=this.projection.pointCoordinate3D(this,t.x,t.y);if(p)return new r.ae(p[0],p[1],p[2]);let y=0,b=this.horizonLineFromTop();if(t.y>b)return this.pointCoordinate(t,o);const T=.02*b,I=t.clone();for(let D=0;D<10&&b-y>T;D++){I.y=r.ak(y,b,.66);const F=this.projection.pointCoordinate3D(this,I.x,I.y);F?(b=I.y,p=F):y=I.y}return p?new r.ae(p[0],p[1],p[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=r.cK)return!this.isPointAboveHorizon(t);const o=this.pointCoordinate(t);return o.y>=0&&o.y<=1}_coordinatePoint(t,o){const p=o&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,y=[t.x*this.worldSize,t.y*this.worldSize,p+t.toAltitude(),1];return r.aC(y,y,this.pixelMatrix),y[3]>0?new r.P(y[0]/y[3],y[1]/y[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:o}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=this.pointLocation3D(new r.P(o,t)),T=this.pointLocation3D(new r.P(y,t)),I=this.pointLocation3D(new r.P(y,p)),D=this.pointLocation3D(new r.P(o,p));let F=Math.min(b.lng,T.lng,I.lng,D.lng),z=Math.max(b.lng,T.lng,I.lng,D.lng),j=Math.min(b.lat,T.lat,I.lat,D.lat),B=Math.max(b.lat,T.lat,I.lat,D.lat);const $=Math.pow(2,-this.zoom)/16*270,Z=this.projection.name==="globe"?1:4,Q=(ne,te,se,me,ce)=>{const Ce=(ne+se)/2,_e=(te+me)/2,Re=new r.P(Ce,_e),{lng:Ae,lat:Te}=this.pointLocation3D(Re),De=Math.max(0,F-Ae,j-Te,Ae-z,Te-B);F=Math.min(F,Ae),z=Math.max(z,Ae),j=Math.min(j,Te),B=Math.max(B,Te),(ce<Z||De>$)&&(Q(ne,te,Ce,_e,ce+1),Q(Ce,_e,se,me,ce+1))};if(Q(o,t,y,t,1),Q(y,t,y,p,1),Q(y,p,o,p,1),Q(o,p,o,t,1),this.projection.name==="globe"){const[ne,te]=r.cL(this);ne?(B=90,z=180,F=-180):te&&(j=-90,z=180,F=-180)}return new r.aI(new r.aS(F,j),new r.aS(z,B))}_getBoundsRectangular(t,o){const{top:p,left:y}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,I=new r.P(y,p),D=new r.P(T,p),F=new r.P(T,b),z=new r.P(y,b);let j=this.pointCoordinate(I,t),B=this.pointCoordinate(D,t);const $=this.pointCoordinate(F,o),Z=this.pointCoordinate(z,o),Q=(ne,te)=>(te.y-ne.y)/(te.x-ne.x);return j.y>1&&B.y>=0?j=new r.ae((1-Z.y)/Q(Z,j)+Z.x,1):j.y<0&&B.y<=1&&(j=new r.ae(-Z.y/Q(Z,j)+Z.x,0)),B.y>1&&j.y>=0?B=new r.ae((1-$.y)/Q($,B)+$.x,1):B.y<0&&j.y<=1&&(B=new r.ae(-$.y/Q($,B)+$.x,0)),new r.aI().extend(this.coordinateLocation(j)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation($))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=t.visibleDemTiles.reduce((p,y)=>{if(y.dem){const b=y.dem.tree;p.min=Math.min(p.min,b.minimums[0]),p.max=Math.max(p.max,b.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*t.exaggeration(),o.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-o*(1-this._horizonShift);return t?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-r.cI,this.maxLat=r.cI,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aF(this.minLng)*this.tileSize,this.worldMaxX=r.aF(this.maxLng)*this.tileSize,this.worldMinY=r.aJ(this.maxLat)*this.tileSize,this.worldMaxY=r.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,o){return this.projection.createTileMatrix(this,o,t)}calculateDistanceTileData(t){const o=t.key,p=this._distanceTileDataCache;if(p[o])return p[o];const y=t.canonical,b=1/this.height,T=this.cameraWorldSize,I=T/this.zoomScale(y.z),D=(y.x+Math.pow(2,y.z)*t.wrap)*I,F=y.y*I,z=this.point;z.x*=T/this.worldSize,z.y*=T/this.worldSize;const j=this.angle,B=Math.sin(-j),$=-Math.cos(-j);return p[o]={bearing:[B,$],center:[(z.x-D)*b,(z.y-F)*b],scale:I/r.al*b},p[o]}calculateFogTileMatrix(t){const o=t.key,p=this._fogTileMatrixCache;if(p[o])return p[o];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return r.aB(y,this.worldToFogMatrix,y),p[o]=new Float32Array(y),p[o]}calculateProjMatrix(t,o=!1,p=!1){const y=t.key;let b;if(b=p?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,b[y])return b[y];const T=this.calculatePosMatrix(t,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,r.aB(T,I,T),b[y]=new Float32Array(T),b[y]}calculatePixelsToTileUnitsMatrix(t){const o=t.tileID.key,p=this._pixelsToTileUnitsCache;if(p[o])return p[o];const y=r.cM(t,this);return p[o]=y,p[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,o=r.bp([],[t,t,t]);return r.aB(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const o=r.ce(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(o),y=this._camera.forward(),b=r.ce(1,this._center.lat);p[2]/=b,y[2]/=b,r.aw(y,y);const T=t.raycast(p,y,t.exaggeration());if(T){const I=r.bG([],p,y,T),D=new r.ae(I[0],I[1],r.ce(I[2],r.a_(I[1]))),F=(D.z+r.ag([D.x-p[0],D.y-p[1],D.z-p[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(F),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const o=this._elevation,p=r.ce(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(p),b=o.getAtPointOrZero(new r.ae(...y)),T=this.pixelsPerMeter/this.worldSize*b,I=this._minimumHeightOverTerrain(),D=y[2]-T;if(D<=I)if(D<0||t){const F=this.locationCoordinate(this._center,this._centerAltitude),z=[y[0],y[1],F.z-y[2]],j=r.ag(z);z[2]-=(I-D)/this._pixelsPerMercatorPixel;const B=r.ag(z);if(B===0)return;r.c4(z,z,j/B*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],F.z*this._pixelsPerMercatorPixel-z[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const B=this.center;return B.lat=r.aA(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(B.lng=r.aA(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const o=this._unmodified,{x:p,y}=this.point;let b=0,T=p,I=y;const D=this.width/2,F=this.height/2,z=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(y-F<z&&(I=z+F),y+F>j&&(I=j-F),j-z<this.height&&(b=Math.max(b,this.height/(j-z)),I=(j+z)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,$=this.worldMaxX*this.scale,Z=this.worldSize/2-(B+$)/2;T=(p+Z+this.worldSize)%this.worldSize-Z,T-D<B&&(T=B+D),T+D>$&&(T=$-D),$-B<this.width&&(b=Math.max(b,this.width/($-B)),T=($+B)/2)}T===p&&I===y||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(T,I))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,o=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.ce(1,this.center.lat)/r.ce(1,r.d1));const y=r.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?p:1,T=this._camera.getWorldToCamera(this.worldSize,b);let I;const D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-t.x/this.width,D[9]=2*t.y/this.height,this.isOrthographic){let Te=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),De=Te*this.aspect,He=-De,Ue=-Te;De-=t.x,He-=t.x,Te+=t.y,Ue+=t.y,I=this._camera.getCameraToClipOrthographic(He,De,Ue,Te,this._nearZ,this._farZ),((rt,Qe,lt,Lt)=>{for(let Xe=0;Xe<16;Xe++)rt[Xe]=r.ak(Qe[Xe],lt[Xe],Lt)})(I,I,D,r.c$(this.pitch>=fd?1:this.pitch/fd))}else I=D;const F=r.cO([],D,T);let z=r.cO([],I,T);if(this.projection.isReprojectedInTileSpace){const Te=this.locationCoordinate(this.center),De=r.bz([]);r.bq(De,De,[Te.x*this.worldSize,Te.y*this.worldSize,0]),r.aB(De,De,r.cP(this)),r.bq(De,De,[-Te.x*this.worldSize,-Te.y*this.worldSize,0]),r.aB(z,z,De),r.aB(F,F,De),this.inverseAdjustmentMatrix=r.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.cR([],z,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=z,this.invProjMatrix=r.bk(new Float64Array(16),this.projMatrix),o){const Te=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Te[8]=2*-t.x/this.width,Te[9]=2*t.y/this.height,this.expandedFarZProjMatrix=r.cO([],Te,T)}else this.expandedFarZProjMatrix=this.projMatrix;const j=r.bk([],I);this.frustumCorners=r.cS.fromInvProjectionMatrix(j,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const B=new Float32Array(16);r.bz(B),r.cR(B,B,[1,-1,1]),r.cT(B,B,this._pitch),r.bA(B,B,this.angle);const $=r.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.by($);const Z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$[8]=2*-t.x/this.width,$[9]=2*(t.y+Z)/this.height,this.skyboxMatrix=r.aB(B,$,B);const Q=this.point,ne=Q.x,te=Q.y,se=this.width%2/2,me=this.height%2/2,ce=Math.cos(this.angle),Ce=Math.sin(this.angle),_e=ne-Math.round(ne)+ce*se+Ce*me,Re=te-Math.round(te)+ce*me+Ce*se,Ae=new Float64Array(z);if(r.bq(Ae,Ae,[_e>.5?_e-1:_e,Re>.5?Re-1:Re,0]),this.alignedProjMatrix=Ae,z=r.bB(),r.cR(z,z,[this.width/2,-this.height/2,1]),r.bq(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=r.bB(),r.cR(z,z,[1,-1,1]),r.bq(z,z,[-1,-1,0]),r.cR(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=r.aB(new Float64Array(16),this.labelPlaneMatrix,F),this._calcFogMatrices(),this._distanceTileDataCache={},z=r.bk(new Float64Array(16),this.pixelMatrix),!z)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=z,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.cU(this);const Te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.af(Te,Te,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=z;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,p=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,b=[t,t,o];r.c4(b,b,y),r.c4(p,p,-1),r.cV(p,p,b);const T=r.bB();r.bq(T,T,p),r.cR(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,o,y)}_computeCameraPosition(t){const o=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-t/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-p[0]*b,y.y/this.worldSize-p[1]*b,t/this.worldSize*this._centerAltitude-p[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],y=t[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(b=Math.min((o-p)/y,1)),this._camera.position=r.bG([],this._camera.position,t,b),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,o=this._camera.forward(),{pitch:p,bearing:y}=this._camera.getPitchBearing(),b=r.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.an(this._maxPitch)),I=Math.max((t[2]-b)/Math.cos(p),T),D=this._zoomFromMercatorZ(I);r.bG(t,t,o,I),this._pitch=r.aA(p,r.an(this.minPitch),r.an(this.maxPitch)),this.angle=r.bS(y,-Math.PI,Math.PI),this._setZoom(r.aA(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let o=0,p=r.cK,y=0,b=1/0;for(;p-o>1e-6&&p>o;){const T=o+.5*(p-o),I=this.tileSize*Math.pow(2,T),D=this.getCameraToCenterDistance(this.projection,T,I),F=this.scaleZoom(D/(Math.max(0,t)*this.tileSize)),z=Math.abs(T-F);z<b&&(b=z,y=T),T<F?o=T:p=T}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,o){const p=Math.min(t.x,o.x),y=Math.max(t.x,o.x),b=Math.min(t.y,o.y),T=Math.max(t.y,o.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new r.P(p,b),new r.P(y,T),new r.P(p,T),new r.P(y,b)],D=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const z of I){const j=this.pointRayIntersection(z);if(j.t<0)return!0;const B=this.rayIntersectionCoordinate(j);if(B.x<D||B.y<0||B.x>F||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(t,o){const p=r.ag(r.av([],this._camera.position,t)),y=this._zoomFromMercatorZ(p)+o;return p-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([o,p,y],b){const T=[o,p,y,1];r.aC(T,T,b);const I=T[3]=Math.max(T[3],1e-6);return T[0]/=I,T[1]/=I,T[2]/=I,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,t))}}getCameraToCenterDistance(t,o=this.zoom,p=this.worldSize){const y=r.cN(t,o,this.width,this.height,1024),b=t.pixelSpaceConversion(this.center.lat,p,y);let T=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(T=r.ak(1,T,r.c$(this.pitch>=fd?1:this.pitch/fd))),T}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.aB(t,t,this.globeMatrix),t}getFrustum(t){return r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Au=(f,t)=>{if(t>0&&f.terrain&&r.w("Cutoff is currently disabled on terrain"),t<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=f.transform,p=Math.max(Math.abs(o._zoom-(f.minCutoffZoom-1)),1),y=o.isLODDisabled(!1)?r.ah(60,45,o.pitch):r.ah(30,15,o.pitch),b=o._farZ-o._nearZ,T=t*o.height,I=((1-(D=y))*o.cameraToCenterDistance+D*(o._farZ+T))*p;var D;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(I-o._nearZ)/b,(I-T-o._nearZ)/b]}}},ka={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Nb{constructor(t,o){this.aabb=t,this.lastCascade=o}}class Bb{add(t,o){const p=this.receivers[t.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],o.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],o.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],o.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],o.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],o.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],o.max[2])):this.receivers[t.key]=new Nb(o,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,o,p){const y=r.d8.fromPoints(t.points);let b=0;for(const T in this.receivers){const I=this.receivers[T];if(!I||!y.intersectsAabb(I.aabb))continue;I.aabb.min=y.closestPoint(I.aabb.min),I.aabb.max=y.closestPoint(I.aabb.max);const D=I.aabb.getCorners();for(let F=0;F<p.length;F++){let z=!0;for(const j of D){const B=[j[0]*o,j[1]*o,j[2]];if(r.af(B,B,p[F].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){z=!1;break}}if(I.lastCascade=F,b=Math.max(b,F),z)break}}return b+1}}class vp{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Bb,this._depthMode=new _i(t.context.gl.LEQUAL,_i.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(ka,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(ka,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(ka,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,o){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;const y=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||y<=0||(this._shadowLayerCount=p.style.order.reduce((Z,Q)=>{const ne=p.style._mergedLayers[Q];return Z+(ne.hasShadowPass()&&!ne.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=p.context,T=ka.shadowMapResolution,I=ka.shadowMapResolution;if(this._cascades.length===0||ka.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Z=0;Z<ka.cascadeCount;++Z){const Q=p._shadowMapDebug,ne=b.gl,te=b.createFramebuffer(T,I,Q,"texture"),se=new r.T(b,{width:T,height:I,data:null},ne.DEPTH_COMPONENT16);if(te.depthAttachment.set(se.texture),Q){const me=new r.T(b,{width:T,height:I,data:null},ne.RGBA8);te.colorAttachment.set(me.texture)}this._cascades.push({framebuffer:te,texture:se,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.cA,scale:0})}}this.shadowDirection=ex(o);let D=0;if(t.elevation){const Z=t.elevation,Q=[1e4,-1e4];Z.visibleDemTiles.filter(ne=>ne.dem).forEach(ne=>{const te=ne.dem.tree;Q[0]=Math.min(Q[0],te.minimums[0]),Q[1]=Math.max(Q[1],te.maximums[0])}),Q[0]!==1e4&&(D=(Q[1]-Q[0])*Z.exaggeration())}const F=1.5*t.cameraToCenterDistance,z=3*F,j=new Float64Array(16);for(let Z=0;Z<this._cascades.length;++Z){const Q=this._cascades[Z];let ne=t.height/50,te=1;ka.cascadeCount===1?te=z:Z===0?te=F:(ne=F,te=z);const[se,me]=tx(t,this.shadowDirection,ne,te,ka.shadowMapResolution,D);Q.scale=t.scale,Q.matrix=se,Q.boundingSphereRadius=me,r.bk(j,Q.matrix),Q.frustum=r.cA.fromInvProjectionMatrix(j,1,0,!0),Q.far=te}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ka.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ka.shadowMapResolution,this._uniformValues.u_shadowmap_0=Sa.ShadowMap0,this._uniformValues.u_shadowmap_1=Sa.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const $=p.transform.elevation;for(const Z of this._groundShadowTiles){let Q={min:0,max:0};if($){const ne=$.getMinMaxForTile(Z);ne&&(Q=ne)}this.addShadowReceiver(Z.toUnwrapped(),Q.min,Q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,o){if(!this.enabled)return;const p=this.painter,y=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),y.viewport.set([0,0,ka.shadowMapResolution,ka.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){p.currentShadowCascade=b,y.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),y.clear({color:r.ao.white,depth:1});for(const T of t.order){const I=t._mergedLayers[T];if(!I.hasShadowPass()||I.isHidden(p.transform.zoom))continue;const D=t.getLayerSourceCache(I),F=D?o[D.id]:void 0;(I.type==="model"||F&&F.length)&&p.renderLayer(p,D,I,F)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,o=t.style,p=t.context,y=p.gl,b=o.directionalLight,T=o.ambientLight;if(!b||!T)return;const I=[],D=Au(t,t.longestCutoffRange);D.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const F=xl(o,b,T),z=new _i(y.LEQUAL,_i.ReadOnly,t.depthRangeFor3D),j=new Gi({func:y.EQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.KEEP);for(const B of this._groundShadowTiles){const $=B.toUnwrapped(),Z=t.isTileAffectedByFog(B),Q=t.getOrCreateProgram("groundShadow",{defines:I,overrideFog:Z});this.setupShadows($,Q),t.uploadCommonUniforms(p,Q,$,null,D);const ne={u_matrix:t.transform.calculateProjMatrix($),u_ground_shadow_factor:F};Q.draw(t,y.TRIANGLES,z,j,sn.multiply,Vi.disabled,ne,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?sn.unblended:sn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const o=this.painter.transform,p=o.calculatePosMatrix(t,o.worldSize);return r.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(t){const o=r.by(t);return r.aB(o,this._cascades[this.painter.currentShadowCascade].matrix,t),o}setupShadows(t,o,p){if(!this.enabled)return;const y=this.painter.transform,b=this.painter.context,T=b.gl,I=this._uniformValues,D=new Float64Array(16),F=y.calculatePosMatrix(t,y.worldSize);for(let z=0;z<this._cascades.length;z++)r.aB(D,this._cascades[z].matrix,F),I[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),b.activeTexture.set(T.TEXTURE0+Sa.ShadowMap0+z),this._cascades[z].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const z=r.d6(t.canonical),j=2/y.tileSize*r.al/ka.shadowMapResolution,B=j*this._cascades[0].boundingSphereRadius,$=j*this._cascades[this._cascades.length-1].boundingSphereRadius,Z=(p==="vector-tile"?1:3)*function(Q,ne,te,se,me){const ce=r.aA((Q-22)/-22,0,1);return .125*(1-ce)+4*ce}(y.zoom);I.u_shadow_normal_offset=[z,B*Z,$*Z],I.u_shadow_bias=[1e-4,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(b,I)}setupShadowsFromMatrix(t,o,p=!1){if(!this.enabled)return;const y=this.painter.context,b=y.gl,T=this._uniformValues,I=new Float64Array(16);for(let D=0;D<ka.cascadeCount;D++)r.aB(I,this._cascades[D].matrix,t),T[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),y.activeTexture.set(b.TEXTURE0+Sa.ShadowMap0+D),this._cascades[D].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);if(this.useNormalOffset=p,p){const D=ka.normalOffset;T.u_shadow_normal_offset=[1,D,D],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(y,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,o,p,y){if(y[2]>=0)return{};const b=function(D,F,z){const j=z/(1<<D.canonical.z);return new r.d8([D.canonical.x*j+D.wrap*z,D.canonical.y*j+D.wrap*z,0],[(D.canonical.x+1)*j+D.wrap*z,(D.canonical.y+1)*j+D.wrap*z,F])}(t,o,p).getCorners(),T=o/-y[2];y[0]<0?(r.d7(b[0],b[0],[y[0]*T,0,0]),r.d7(b[3],b[3],[y[0]*T,0,0])):y[0]>0&&(r.d7(b[1],b[1],[y[0]*T,0,0]),r.d7(b[2],b[2],[y[0]*T,0,0])),y[1]<0?(r.d7(b[0],b[0],[0,y[1]*T,0]),r.d7(b[1],b[1],[0,y[1]*T,0])):y[1]>0&&(r.d7(b[2],b[2],[0,y[1]*T,0]),r.d7(b[3],b[3],[0,y[1]*T,0]));const I={};return I.vertices=b,I.planes=[Cu(b[1],b[0],b[4]),Cu(b[2],b[1],b[5]),Cu(b[3],b[2],b[6]),Cu(b[0],b[3],b[7])],I}addShadowReceiver(t,o,p){this._receivers.add(t,r.d8.fromTileIdAndHeight(t,o,p))}getMaxCascadeForTile(t){const o=this._receivers.get(t);return o&&o.lastCascade?o.lastCascade:0}}function Cu(f,t,o){const p=r.av([],o,t),y=r.av([],f,t),b=r.bH([],p,y),T=r.ag(b);return T===0?[0,0,1,0]:(r.c4(b,b,1/T),[b[0],b[1],b[2],-r.bI(b,t)])}function ex(f){const t=f.properties.get("direction"),o=r.d3(t.x,t.y,t.z);o[2]=r.aA(o[2],0,75);const p=r.d5([o[0],o[1],o[2]]);return r.d4(p.x,p.y,p.z)}function xl(f,t,o){const p=t.properties.get("color-use-theme")==="none",y=t.properties.get("color"),b=t.properties.get("intensity"),T=t.properties.get("direction"),I=[T.x,T.y,T.z],D=o.properties.get("color-use-theme")==="none",F=o.properties.get("color"),z=o.properties.get("intensity"),j=Math.max(r.bI([0,0,1],I),0),B=[0,0,0];r.c4(B,F.toPremultipliedRenderColor(D?null:f.getLut(t.scope)).toArray01Linear().slice(0,3),z);const $=[0,0,0];return r.c4($,y.toPremultipliedRenderColor(p?null:f.getLut(o.scope)).toArray01Linear().slice(0,3),j*b),r.da([B[0]>0?B[0]/(B[0]+$[0]):0,B[1]>0?B[1]/(B[1]+$[1]):0,B[2]>0?B[2]/(B[2]+$[2]):0])}function tx(f,t,o,p,y,b){const T=f.zoom,I=f.scale,D=f.worldSize,F=1/D,z=f.aspect,j=Math.sqrt(1+z*z)*Math.tan(.5*f.fovX),B=j*j,$=p-o,Z=p+o;let Q,ne;B>$/Z?(Q=p,ne=p*j):(Q=.5*Z*(1+B),ne=.5*Math.sqrt($*$+2*(p*p+o*o)*B+Z*Z*B*B));const te=f.projection.pixelsPerMeter(f.center.lat,D),se=f._camera.getCameraToWorldMercator(),me=[0,0,-Q*F];r.af(me,me,se);let ce=ne*F;const Ce=f._edgeInsets;if(!(Ce.left===0&&Ce.top===0&&Ce.right===0&&Ce.bottom===0||Ce.left===Ce.right&&Ce.top===Ce.bottom)){const At=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?te:1),jt=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,o,p);jt[8]=2*-f.centerOffset.x/f.width,jt[9]=2*f.centerOffset.y/f.height;const pi=new Float64Array(16);r.cO(pi,jt,At);const Ft=new Float64Array(16);r.bk(Ft,pi);const zt=r.cA.fromInvProjectionMatrix(Ft,D,T,!0);for(const mi of zt.points){const ni=((_e=mi)[0]/=I,_e[1]/=I,_e[2]=r.ce(_e[2],f._center.lat),_e);ce=Math.max(ce,r.c5(r.d9([],me,ni)))}}var _e;ce*=y/(y-1);const Re=Math.acos(t[2]),Ae=Math.atan2(-t[0],-t[1]),Te=new yp;Te.position=me,Te.setPitchBearing(Re,Ae);const De=Te.getWorldToCamera(D,te),He=ce*D,Ue=Math.min(f._mercatorZfromZoom(17)*D*-2,-2*He),rt=Te.getCameraToClipOrthographic(-He,He,-He,He,Ue,(He+b*te)/t[2]),Qe=new Float64Array(16);r.aB(Qe,rt,De);const lt=r.d4(Math.floor(1e6*me[0])/1e6*D,Math.floor(1e6*me[1])/1e6*D,0),Lt=.5*y,Xe=[0,0,0];r.af(Xe,lt,Qe),r.c4(Xe,Xe,Lt);const Ne=[Math.floor(Xe[0]),Math.floor(Xe[1]),Math.floor(Xe[2])],ct=[0,0,0];r.av(ct,Xe,Ne),r.c4(ct,ct,-1/Lt);const et=new Float64Array(16);return r.bz(et),r.bq(et,et,ct),r.aB(Qe,et,Qe),[Qe,He]}class Bm extends r.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,o){return r.db(this.requestManager.transformRequest(o,r.R.Model).url).then(p=>{if(!p)return;const y=r.dc(p),b=new r.dd(t,o,void 0,void 0,y);return b.computeBoundsAndApplyParent(),b}).catch(p=>{if(p&&p.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${t} from ${o}: ${p.message}`)))})}load(t,o,p={forceReload:!1}){this.models[o]||(this.models[o]={});const y=Object.keys(t),b=[],T=[];for(const I of y){const D=t[I];this.hasURLBeenRequested(D)&&!p.forceReload||(this.modelByURL[D]={modelId:I,scope:o},b.push(this.loadModel(I,D)),T.push(I)),this.models[o][I]||(this.models[o][I]={model:null,numReferences:1})}this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+T.length,Promise.allSettled(b).then(I=>{for(let D=0;D<I.length;D++){const{status:F}=I[D];if(F==="rejected")continue;const{value:z}=I[D];this.models[o][T[D]]||(this.models[o][T[D]]={model:null,numReferences:1}),this.models[o][T[D]].model=z}this.numModelsLoading[o]-=T.length,this.fire(new r.z("data",{dataType:"style"}))}).catch(I=>{this.fire(new r.y(new Error(`Could not load models: ${I.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,o,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(t,o):this.getModelByURL(this.modelUris[o][t]))}getModel(t,o){return this.models[o]||(this.models[o]={}),this.models[o][t]?this.models[o][t].model:void 0}getModelByURL(t){if(!t)return null;const o=this.modelByURL[t];return o?this.models[o.scope][o.modelId].model:null}hasModelBeenAdded(t,o){return this.models[o]&&this.models[o][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,o,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const y=this.requestManager.normalizeModelURL(o);if((this.hasModel(t,p,{exactIdMatch:!0})||this.hasModelBeenAdded(t,p))&&this.modelUris[p][t]===y)this.models[p][t].numReferences++;else if(this.hasURLBeenRequested(y)){const{scope:b,modelId:T}=this.modelByURL[y];this.models[b][T].numReferences++}else this.modelUris[p][t]=y,this.load({[t]:this.modelUris[p][t]},p)}addModelURLs(t,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const p=this.modelUris[o];for(const y in t)p[y]=this.requestManager.normalizeModelURL(t[y])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const p={};for(const y of t)this.hasModel(y,o,{exactIdMatch:!0})||this.hasURLBeenRequested(y)?this.models[o][y].numReferences++:this.modelUris[o][y]&&!this.hasURLBeenRequested(y)?p[y]=this.modelUris[o][y]:!this.hasURLBeenRequested(y)&&r.de(y,!1)&&(this.modelUris[o][y]=this.requestManager.normalizeModelURL(y),p[y]=this.modelUris[o][y]);this.load(p,o)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,o,p=!1,y=!1){if(this.models[o]&&this.models[o][t]&&(this.models[o][t].numReferences--,this.models[o][t].numReferences===0||y)){const b=this.modelUris[o][t];p||delete this.modelUris[o][t],delete this.modelByURL[b];const T=this.models[o][t].model;if(!T)return;delete this.models[o][t],T.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const o of Object.keys(this.models[t])){const p=this.models[t][o].model;delete this.models[t][o],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,o){this.models[o]||(this.models[o]={});for(const p in this.models[o])this.models[o][p].model&&this.models[o][p].model.upload(t.context)}}const xp=r.a6.colorTheme,fh=new r.a9({data:new r.aa(xp.data)});function B_(f){if(!f.metadata||!f.metadata.content_area)return;const t=r.o.devicePixelRatio,{left:o,top:p,width:y,height:b}=f.metadata.content_area,T=o*t,I=p*t;return[T,I,T+y*t,I+b*t]}function ph(f){if(f)return f.map(([t,o])=>[t*r.o.devicePixelRatio,o*r.o.devicePixelRatio])}class Vm{constructor(t,o,p){this.id=t,this.scope=o,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const o=this.sourceCache.getVisibleCoordinates();if(o.length===0)return t;const p=this.sourceCache.getSource();if(!(p instanceof ko))return t;const y=o.map(T=>this.sourceCache.getTile(T)),b=p.getImages(y,Array.from(this.pendingRequests));for(const[T,I]of b)t.set(r.I.from({name:T,iconsetId:this.id}),I),this.pendingRequests.delete(T);for(const T of this.pendingRequests)this.missingRequests.add(T);return this.pendingRequests.clear(),t}}const Iu=(f,t)=>W(f,t&&t.filter(o=>o.identifier!=="source.canvas")),Kd=r.aH(Gn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),V_=r.aH(Gn,["setCenter","setZoom","setBearing","setPitch"]),Um=new Set(["background","sky","slot","custom"]),U_={version:8,layers:[],sources:{}},j_={duration:300,delay:0};class zl extends r.E{constructor(t,o={}){super(),this.map=t,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=Object.assign({},j_),this._buildingIndex=new qd(this),this.crossTileSymbolIndex=new Eu,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=o.styleChanges||new gr,this.dispatcher=o.dispatcher?o.dispatcher:new r.D(r.dg(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new co(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new r.dh(t._requestManager,o.localFontFamily?r.di.all:o.localIdeographFontFamily?r.di.ideographs:r.di.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new Bm(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._indoorDependentLayers=o.indoorDependentLayers?o.indoorDependentLayers:new Set,this._config=o.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:o.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",r.dj());const p=this;this._rtlTextPluginCallback=zl.registerForPluginStateChange(y=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(b,T)=>{if(r.dk(b),T&&T.every(I=>I))for(const I in p._sourceCaches){const D=p._sourceCaches[I],F=D.getSource().type;F!=="vector"&&F!=="geojson"||D.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.getOwnSource(y.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const I=this._layers[T];I.source===b.id&&this._validateLayer(I)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(r.h(t))return t;const o=r.dl(t);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${r.dm(JSON.stringify(t))}`}_diffStyle(t,o,p){this.globalId=this._getGlobalId(t);const y=(b,T)=>{try{T(null,this.setState(b,p))}catch(I){T(I,!1)}};if(typeof t=="string"){const b=this.map._requestManager.normalizeStyleURL(t),T=this.map._requestManager.transformRequest(b,r.R.Style);r.m(T,(I,D)=>{I?this.fire(new r.y(I)):D&&y(D,o)})}else typeof t=="object"&&y(t,o)}loadURL(t,o={}){this.fire(new r.z("dataloading",{dataType:"style"}));const p=typeof o.validate=="boolean"?o.validate:!r.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,o.accessToken),this.resolvedImports.add(t);const y=this.importsCache.get(t);if(y)return this._load(y,p);const b=this.map._requestManager.transformRequest(t,r.R.Style);this._request=r.m(b,(T,I)=>{if(this._request=null,T)this.fire(new r.y(T));else if(I)return this.importsCache.set(t,I),this._load(I,p)})}loadJSON(t,o={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=r.o.frame(()=>{this._request=null,this._load(t,o.validate!==!1)})}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(U_,!1)}_loadImports(t,o,p){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const b of t){const T=this._createFragmentStyle(b),I=new Promise(z=>{T.once("style.import.load",z),T.once("error",z)}).then(()=>this.mergeAll());if(y.push(I),this.resolvedImports.has(b.url)){T.loadEmpty();continue}const D=b.data||this.importsCache.get(b.url);D?(T.loadJSON(D,{validate:o}),this._isInternalStyle(D)&&(T.globalId=null)):b.url?T.loadURL(b.url,{validate:o}):T.loadEmpty();const F={style:T,id:b.id,config:b.config};if(p){const z=this.fragments.findIndex(({id:j})=>j===p);this.fragments=this.fragments.slice(0,z).concat(F).concat(this.fragments.slice(z))}else this.fragments.push(F)}return Promise.allSettled(y)}getImportGlobalIds(t=this,o=new Set){for(const p of t.fragments)p.style.globalId&&o.add(p.style.globalId),this.getImportGlobalIds(p.style,o);return[...o.values()]}_createFragmentStyle(t){const o=this.scope?r.B(t.id,this.scope):t.id;let p;const y=this._initialConfig&&this._initialConfig[o];(t.config||y)&&(p=Object.assign({},t.config,y));const b=new zl(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,o){if(this._isInternalStyle(t)){const b=Object.assign({},U_,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(b,o)}if(this.updateConfig(this._config,t.schema),o&&Iu(this,ra(t)))return;this._loaded=!0,this.stylesheet=r.dn(t);const p=()=>{for(const D in t.sources)this.addSource(D,t.sources[D],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const D in t.iconsets)this.addIconset(D,t.iconsets[D]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const b=oc(this.stylesheet.layers);if(this._order=b.map(D=>D.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const D=this.stylesheet.lights[0];this.light=new we(D.properties,D.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new we(this.stylesheet.light)),this._layers={};for(const D of b){const F=r.dt(D,this.scope,this._styleColorTheme.lut,this.options);F.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(F.fqid),F.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(F.fqid),this._hasAppearances=this._hasAppearances||F.getAppearances().length!==0,F.setEventedParent(this,{layer:{id:F.id}}),this._layers[F.id]=F;const z=this.getOwnLayerSourceCache(F),j=!!this.directionalLight&&this.directionalLight.shadowsEnabled();z&&F.canCastShadows()&&j&&(z.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const T=this.stylesheet.terrain;T&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const I=this.isRootStyle();t.imports?this._loadImports(t.imports,o).then(()=>{this._reloadImports(),this.fire(new r.z(I?"style.load":"style.import.load"))}).catch(D=>{this.fire(new r.y(new Error("Failed to load imports",D))),this.fire(new r.z(I?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.z(I?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const b=this._evaluateColorThemeData(y);this._loadColorTheme(b).then(()=>{p()}).catch(T=>{r.w(`Couldn't load color theme from the stylesheet: ${T}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let t,o,p,y,b,T,I,D,F,z;const j={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(t=B.light),B.stylesheet.lights)for(const $ of B.stylesheet.lights)$.type==="ambient"&&B.ambientLight!=null&&(o=B.ambientLight),$.type==="directional"&&B.directionalLight!=null&&(p=B.directionalLight);y=this._prioritizeTerrain(y,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(b=B.fog),B.stylesheet.snow&&B.snow!=null&&(T=B.snow),B.stylesheet.rain&&B.rain!=null&&(I=B.rain),B.stylesheet.camera!=null&&(z=B.stylesheet.camera),B.stylesheet.projection!=null&&(D=B.stylesheet.projection),B.stylesheet.transition!=null&&(F=B.stylesheet.transition),j[B.scope]=B._styleColorTheme}}),this.light=t,this.ambientLight=o,this.directionalLight=p,this.fog=b,this.snow=T,this.rain=I,this._styleColorThemeForScope=j,y===null?delete this.terrain:this.terrain=y,this.camera=z||{"camera-projection":"perspective"},this.projection=D||{name:"mercator"},this.transition=Object.assign({},j_,F),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const o=p=>{for(const y of p.fragments)o(y.style);t(p)};o(this)}_prioritizeTerrain(t,o,p){const y=t&&t.drapeRenderMode===0;return p===null?o&&o.drapeRenderMode===0?o:y?t:null:o!=null&&(!t||y||o&&o.drapeRenderMode===1)?o:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{t=this._prioritizeTerrain(t,o.terrain,o.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(o=>{o.stylesheet.projection!=null&&(t=o.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},o={},p={};this.forEachFragmentStyle(y=>{for(const b in y._sourceCaches){const T=r.B(b,y.scope);t[T]=y._sourceCaches[b]}for(const b in y._otherSourceCaches){const T=r.B(b,y.scope);o[T]=y._otherSourceCaches[b]}for(const b in y._symbolSourceCaches){const T=r.B(b,y.scope);p[T]=y._symbolSourceCaches[b]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=p}mergeIndoor(){this.forEachFragmentStyle(t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const o of Object.values(t.stylesheet.indoor)){const p=o,y=r.B(p.sourceId,t.scope);this._mergedIndoor[y]=new Set(p.sourceLayers||[])}})}mergeLayers(){const t={},o=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(T=>{for(const I of T._order){const D=T._layers[I];if(D.type==="slot"){const F=r.dp(I);if(t[F])continue;t[F]=[]}D.slot&&t[D.slot]?t[D.slot].push(D):o.push(D)}}),this._mergedOrder=[];let y=-1;const b=(T=[])=>{for(const I of T)if(I.type==="slot"){const D=r.dp(I.id);t[D]&&b(t[D]),this._mergedSlots.push(D)}else{const D=r.B(I.id,I.scope);this._mergedOrder.push(D),p[D]=I,I.is3D(!!this.terrain)&&(this._has3DLayers=!0,y=this._mergedOrder.length-1),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&(this._clipLayerPresent=!0)}};if(b(o),this._has3DLayers){const T={};for(let I=0;I<this._mergedOrder.length;++I){const D=this._mergedOrder[I];T[D]=I===y?1:I<y?p[D].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((I,D)=>T[I]-T[D])}this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(o,p,y,b){const T=Object.assign({},p);for(const D of Object.keys(xp))T[D]===void 0&&(T[D]=xp[D].default);const I=new r.a8(fh,o,new Map(y));return I.setTransitionOrValue(T,y),I.untransitioned().possiblyEvaluate(new r.ac(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const o=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,y)=>{const b="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let T=t;T.startsWith(b)||(T=b+T);const I=r.I.from("mapbox-reserved-lut"),D=new Image;D.src=T,D.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},D.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==o)return void p();this._styleColorTheme.lutLoading=!1;const{width:F,height:z,data:j}=r.o.getImageData(D);if(z>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(F!==z*z)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new r.q({width:F,height:z},j),pixelRatio:1,sdf:!1,usvg:!1,version:0});const B=this.imageManager.getImage(I,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:t},p()):y(new Error("Missing LUT image."))}})}getLut(t){const o=this._styleColorThemeForScope[t];return o?o.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(o,p,y){let b,T,I;const D=r.o.devicePixelRatio>1?"@2x":"";let F=r.m(p.transformRequest(p.normalizeSpriteURL(o,D,".json"),r.R.SpriteJSON),(B,$)=>{F=null,I||(I=B,b=$,j())}),z=r.n(p.transformRequest(p.normalizeSpriteURL(o,D,".png"),r.R.SpriteImage),(B,$)=>{z=null,I||(I=B,T=$,j())});function j(){if(I)y(I);else if(b&&T){const B=r.o.getImageData(T),$={};for(const Z in b){const{width:Q,height:ne,x:te,y:se,sdf:me,pixelRatio:ce,stretchX:Ce,stretchY:_e,content:Re}=b[Z],Ae=new r.q({width:Q,height:ne});r.q.copy(B,Ae,{x:te,y:se},{x:0,y:0},{width:Q,height:ne},null),$[Z]={data:Ae,pixelRatio:ce!==void 0?ce:1,sdf:me!==void 0&&me,stretchX:Ce,stretchY:_e,content:Re,usvg:!1,version:0}}y(null,$)}}return{cancel(){F&&(F.cancel(),F=null),z&&(z.cancel(),z=null)}}}(t,this.map._requestManager,(o,p)=>{if(this._spriteRequest=null,o)this.fire(new r.y(o));else if(p){const y=new Map;for(const b in p)y.set(r.I.from(b),p[b]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))})}addIconset(t,o){if(o.type==="sprite")return void this._loadSprite(o.url);const p=this.getOwnSourceCache(o.source);if(!p)return void this.fire(new r.y(new Error(`Source "${o.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const y=p.getSource();if(y.type!=="raster-array")return void this.fire(new r.y(new Error(`Source "${o.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));y.partial=!1;const b=new Vm(t,this.scope,p);this.imageManager.addImageProvider(b,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!r.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const o=this.map._spriteFormat==="auto";var p,y;this._spriteRequest=(y=(b,T)=>{if(this._spriteRequest=null,b)o?this._loadSprite(t):this.fire(new r.y(b));else if(T){const I=new Map;for(const D in T)I.set(r.I.from(D),T[D]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bt((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(t),r.R.Iconset),(b,T)=>{if(b)return void y(b);const I={},D=r.df(new r.bs(T));for(const F of D.icons){const z={version:1,pixelRatio:r.o.devicePixelRatio,content:B_(F),stretchX:F.metadata?ph(F.metadata.stretch_x_areas):void 0,stretchY:F.metadata?ph(F.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:F};I[F.name]=z}y(null,I)}))}_validateLayer(t){const o=this.getOwnSource(t.source);if(!o)return;const p=t.sourceLayer;p&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(p)===-1)&&this.fire(new r.y(new Error(`Source layer "${p}" does not exist on source "${o.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,o)=>{const p=this.fragments[o];return p&&p.style&&(t.data=p.style.serialize()),t})}_serializeSources(){const t={};for(const o in this._sourceCaches){const p=this._sourceCaches[o].getSource();t[p.id]||(t[p.id]=p.serialize())}return t}_serializeLayers(t){const o=[];for(const p of t){const y=this._layers[p];y&&y.type!=="custom"&&o.push(y.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const o=this.getOwnLayer(t);if(o)return o;this.fire(new r.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const o=this.getOwnSource(t);if(o)return o;this.fire(new r.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,o){const p=this.map.painter;if(p)for(let y=t.minzoom||0;y<(t.maxzoom||25.5);y++){const b=t.getProgramIds();if(b)for(const T of b){const I=t.getDefaultProgramParams(T,o.zoom,this._styleColorTheme.lut);I&&(p.style=this,this.fog&&(p._fogVisible=!0,I.overrideFog=!0,p.getOrCreateProgram(T,I)),p._fogVisible=!1,I.overrideFog=!1,p.getOrCreateProgram(T,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,p.getOrCreateProgram(T,I)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const o=this.calculateLightsBrightness();t.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const D in I){const{updatedIds:F,removedIds:z}=I[D];(F||z)&&(this._updateWorkerLayers(D,F,z),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const b={};for(const I in this._mergedSourceCaches){const D=this._mergedSourceCaches[I];b[I]=D.used,D.used=!1,D.tileCoverLift=0}for(const I of this._mergedOrder){const D=this._mergedLayers[I];if(D.recalculate(t,this._availableImages),!D.isHidden(t.zoom)){const F=this.getLayerSourceCache(D);F&&(F.used=!0,F.tileCoverLift=Math.max(F.tileCoverLift,D.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(D,t)}):this.precompilePrograms(D,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();const T=this.imageManager.getPendingImageProviders();for(const I of T)I.sourceCache.used=!0;for(const I in b){const D=this._mergedSourceCaches[I];b[I]!==D.used&&D.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:D.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new r.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const o of t){const p=o.resolvePendingRequests(),y=this.getFragmentStyle(o.scope);y&&y.addImages(p)}}_updateTilesForChangedImages(){const t={};for(const o in this._mergedSourceCaches){const p=this._mergedSourceCaches[o].getSource().scope;t[p]=t[p]||this._changes.getUpdatedImages(p),t[p].length!==0&&this._mergedSourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t[p])}for(const o in t)this._changes.resetUpdatedImages(o)}_updateWorkerLayers(t,o,p){const y=this.getFragmentStyle(t);y&&this.dispatcher.broadcast("updateLayers",{layers:o?y._serializeLayers(o):[],scope:t,removedIds:p||[],options:y.options})}setState(t,o){if(this._checkLoaded(),Iu(this,ra(t)))return!1;(t=r.dn(t)).layers=oc(t.layers);const p=function(T,I){if(!T)return[{command:Gn.setStyle,args:[I]}];let D=[];try{if(!r.bx(T.version,I.version))return[{command:Gn.setStyle,args:[I]}];if(r.bx(T.center,I.center)||D.push({command:Gn.setCenter,args:[I.center]}),r.bx(T.zoom,I.zoom)||D.push({command:Gn.setZoom,args:[I.zoom]}),r.bx(T.bearing,I.bearing)||D.push({command:Gn.setBearing,args:[I.bearing]}),r.bx(T.pitch,I.pitch)||D.push({command:Gn.setPitch,args:[I.pitch]}),r.bx(T.sprite,I.sprite)||D.push({command:Gn.setSprite,args:[I.sprite]}),r.bx(T.glyphs,I.glyphs)||D.push({command:Gn.setGlyphs,args:[I.glyphs]}),r.bx(T.imports,I.imports)||function($=[],Z=[],Q){Z=Z||[];const ne=($=$||[]).map(Mc),te=Z.map(Mc),se=$.reduce(Pc,{}),me=Z.reduce(Pc,{}),ce=ne.slice();let Ce,_e,Re,Ae;for(Ce=0,_e=0;Ce<ne.length;Ce++)Re=ne[Ce],me.hasOwnProperty(Re)?_e++:(Q.push({command:Gn.removeImport,args:[Re]}),ce.splice(ce.indexOf(Re,_e),1));for(Ce=0,_e=0;Ce<te.length;Ce++)Re=te[te.length-1-Ce],ce[ce.length-1-Ce]!==Re&&(se.hasOwnProperty(Re)?(Q.push({command:Gn.removeImport,args:[Re]}),ce.splice(ce.lastIndexOf(Re,ce.length-_e),1)):_e++,Ae=ce[ce.length-Ce],Q.push({command:Gn.addImport,args:[me[Re],Ae]}),ce.splice(ce.length-Ce,0,Re));for(const Te of Z){const De=se[Te.id];De&&(delete De.data,r.bx(De,Te)||Q.push({command:Gn.updateImport,args:[Te.id,Te]}))}}(T.imports,I.imports,D),r.bx(T.transition,I.transition)||D.push({command:Gn.setTransition,args:[I.transition]}),r.bx(T.light,I.light)||D.push({command:Gn.setLight,args:[I.light]}),r.bx(T.fog,I.fog)||D.push({command:Gn.setFog,args:[I.fog]}),r.bx(T.snow,I.snow)||D.push({command:Gn.setSnow,args:[I.snow]}),r.bx(T.rain,I.rain)||D.push({command:Gn.setRain,args:[I.rain]}),r.bx(T.projection,I.projection)||D.push({command:Gn.setProjection,args:[I.projection]}),r.bx(T.lights,I.lights)||D.push({command:Gn.setLights,args:[I.lights]}),r.bx(T.camera,I.camera)||D.push({command:Gn.setCamera,args:[I.camera]}),r.bx(T.iconsets,I.iconsets)||function($,Z,Q){let ne;for(ne in Z=Z||{},$=$||{})$.hasOwnProperty(ne)&&(Z.hasOwnProperty(ne)||Q.push({command:Gn.removeIconset,args:[ne]}));for(ne in Z){if(!Z.hasOwnProperty(ne))continue;const te=Z[ne];$.hasOwnProperty(ne)?r.bx($[ne],te)||(Q.push({command:Gn.removeIconset,args:[ne]}),Q.push({command:Gn.addIconset,args:[ne,te]})):Q.push({command:Gn.addIconset,args:[ne,te]})}}(T.iconsets,I.iconsets,D),!r.bx(T["color-theme"],I["color-theme"]))return[{command:Gn.setStyle,args:[I]}];const F={},z=[];(function($,Z,Q,ne){let te;for(te in Z=Z||{},$=$||{})$.hasOwnProperty(te)&&(Z.hasOwnProperty(te)||ac(te,Q,ne));for(te in Z){if(!Z.hasOwnProperty(te))continue;const se=Z[te];$.hasOwnProperty(te)?r.bx($[te],se)||($[te].type==="geojson"&&se.type==="geojson"&&sc($,Z,te)?Q.push({command:Gn.setGeoJSONSourceData,args:[te,se.data]}):Tu(te,Z,Q,ne)):Rc(te,Z,Q)}})(T.sources,I.sources,z,F);const j=[];T.layers&&T.layers.forEach($=>{$.source&&F[$.source]?D.push({command:Gn.removeLayer,args:[$.id]}):j.push($)});let B=T.terrain;B&&F[B.source]&&(D.push({command:Gn.setTerrain,args:[void 0]}),B=void 0),D=D.concat(z),r.bx(B,I.terrain)||D.push({command:Gn.setTerrain,args:[I.terrain]}),function($,Z,Q){Z=Z||[];const ne=($=$||[]).map(Mc),te=Z.map(Mc),se=$.reduce(Pc,{}),me=Z.reduce(Pc,{}),ce=ne.slice(),Ce=Object.create(null);let _e,Re,Ae,Te,De,He,Ue;for(_e=0,Re=0;_e<ne.length;_e++)Ae=ne[_e],me.hasOwnProperty(Ae)?Re++:(Q.push({command:Gn.removeLayer,args:[Ae]}),ce.splice(ce.indexOf(Ae,Re),1));for(_e=0,Re=0;_e<te.length;_e++)Ae=te[te.length-1-_e],ce[ce.length-1-_e]!==Ae&&(se.hasOwnProperty(Ae)?(Q.push({command:Gn.removeLayer,args:[Ae]}),ce.splice(ce.lastIndexOf(Ae,ce.length-Re),1)):Re++,He=ce[ce.length-_e],Q.push({command:Gn.addLayer,args:[me[Ae],He]}),ce.splice(ce.length-_e,0,Ae),Ce[Ae]=!0);for(_e=0;_e<te.length;_e++)if(Ae=te[_e],Te=se[Ae],De=me[Ae],!Ce[Ae]&&!r.bx(Te,De))if(r.bx(Te.source,De.source)&&r.bx(Te["source-layer"],De["source-layer"])&&r.bx(Te.type,De.type)){for(Ue in Dc(Te.layout,De.layout,Q,Ae,null,Gn.setLayoutProperty),Dc(Te.paint,De.paint,Q,Ae,null,Gn.setPaintProperty),r.bx(Te.slot,De.slot)||Q.push({command:Gn.setSlot,args:[Ae,De.slot]}),r.bx(Te.filter,De.filter)||Q.push({command:Gn.setFilter,args:[Ae,De.filter]}),r.bx(Te.minzoom,De.minzoom)&&r.bx(Te.maxzoom,De.maxzoom)||Q.push({command:Gn.setLayerZoomRange,args:[Ae,De.minzoom,De.maxzoom]}),Te)Te.hasOwnProperty(Ue)&&Ue!=="layout"&&Ue!=="paint"&&Ue!=="filter"&&Ue!=="metadata"&&Ue!=="minzoom"&&Ue!=="maxzoom"&&Ue!=="slot"&&(Ue.indexOf("paint.")===0?Dc(Te[Ue],De[Ue],Q,Ae,Ue.slice(6),Gn.setPaintProperty):r.bx(Te[Ue],De[Ue])||Q.push({command:Gn.setLayerProperty,args:[Ae,Ue,De[Ue]]}));for(Ue in De)De.hasOwnProperty(Ue)&&!Te.hasOwnProperty(Ue)&&Ue!=="layout"&&Ue!=="paint"&&Ue!=="filter"&&Ue!=="metadata"&&Ue!=="minzoom"&&Ue!=="maxzoom"&&Ue!=="slot"&&(Ue.indexOf("paint.")===0?Dc(Te[Ue],De[Ue],Q,Ae,Ue.slice(6),Gn.setPaintProperty):r.bx(Te[Ue],De[Ue])||Q.push({command:Gn.setLayerProperty,args:[Ae,Ue,De[Ue]]}))}else Q.push({command:Gn.removeLayer,args:[Ae]}),He=ce[ce.lastIndexOf(Ae)+1],Q.push({command:Gn.addLayer,args:[De,He]})}(j,I.layers,D)}catch(F){console.warn("Unable to compute style diff:",F),D=[{command:Gn.setStyle,args:[I]}]}return D}(this.serialize(),t).filter(T=>!(T.command in V_));if(p.length===0)return!1;const y=p.filter(T=>!(T.command in Kd));if(y.length>0)throw new Error(`Unimplemented: ${y.map(T=>T.command).join(", ")}.`);const b=[];return p.forEach(T=>{b.push(this[T.command](...T.args))}),o&&Promise.all(b).then(o).catch(o),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[o,p]of t.entries()){if(this.getImage(o))return this.fire(new r.y(new Error(`An image with the name "${o.name}" already exists.`)));this.imageManager.addImage(o,this.scope,p),this._changes.updateImage(o,this.scope)}return this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this}addImage(t,o){return this.getImage(t)?this.fire(new r.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,o),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this)}updateImage(t,o,p=!1){this.imageManager.updateImage(t,this.scope,o),p&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new r.z("data",{dataType:"style"})),this}addModel(t,o,p={}){return this._checkLoaded(),this._validate(bi,`models.${t}`,o,null,p)||(this.modelManager.addModel(t,o,this.scope),this.fire(new r.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,o,p={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(tc,`sources.${t}`,o,null,p))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const y=Pa(t,o,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id}));const b=T=>{const I=(T?"symbol:":"other:")+y.id,D=r.B(I,this.scope),F=this._sourceCaches[I]=new qo(D,y,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=F,F.onAdd(this.map)};b(!1),o.type!=="vector"&&o.type!=="geojson"||b(!0),y.onAdd&&y.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const o=this.getOwnSource(t);if(!o)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const y=Object.entries(this.stylesheet.iconsets).find(([b,T])=>T.type==="source"&&T.source===t);if(y)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while iconset "${y[0]}" is using it.`)))}const p=this.getOwnSourceCaches(t);for(const y of p){const b=r.dp(y.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(y.id),y.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,o){this._checkLoaded(),this.getOwnSource(t).setData(o),this._changes.setDirty()}getOwnSource(t){const o=this.getOwnSourceCache(t);return o&&o.getSource()}getOwnSources(){const t=[];for(const o in this._otherSourceCaches){const p=this.getOwnSourceCache(o);p&&t.push(p.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const o in t){const p=t[o]._tiles;for(const y in p){const b=p[y];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const b of t){if(this._validate(ic,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(b),T.updateTransitions(o)}else this.ambientLight=new to(b,hr||(hr=new r.a9({color:new r.aa(r.a6.properties_light_ambient.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(b),T.updateTransitions(o)}else this.directionalLight=new to(b,Lr||(Lr=new r.a9({direction:new r.ap(r.a6.properties_light_directional.direction),color:new r.aa(r.a6.properties_light_directional.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_directional.intensity),"cast-shadows":new r.aa(r.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new r.aa(r.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.aa(r.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=Object.assign(o,{worldview:this.map.getWorldview()}),y=new r.ac(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,o=this.ambientLight;if(!t||!o)return;const p=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),y=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),b=t.properties.get("intensity"),T=t.properties.get("direction"),I=1-r.d3(T.x,T.y,T.z)[2]/90,D=p(y)*b*I,F=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),z=o.properties.get("intensity"),j=p(F)*z;return Number(((D+j)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(r.dq(t)){const o=r.dr(t),p=this.fragments.find(({id:b})=>b===o);if(!p)return;const y=r.dp(t);return p.style.getFragmentStyle(y)}{const o=this.fragments.find(({id:p})=>p===t);return o?o.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const o={},p=(y,b="")=>`${y}::${b}`;this._featuresetSelectors={};for(const y in t){const b=this._featuresetSelectors[y]=[];for(const T of t[y].selectors){if(T.featureNamespace){const D=this.getOwnLayer(T.layer);if(!D){r.w(`Layer is undefined for selector: ${T.layer}`);continue}const F=p(D.source,D.sourceLayer);if(F in o&&o[F]!==T.featureNamespace){r.w(`"featureNamespace ${T.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}o[F]=T.featureNamespace}let I;if(T.properties)for(const D in T.properties){const F=r.U(T.properties[D]);F.result==="success"&&(I=I||{},I[D]=F.value)}b.push({layerId:T.layer,namespace:T.featureNamespace,properties:I,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const o=this.getFragmentStyle(t);if(!o||!o.stylesheet.featuresets)return[];const p=[];for(const y in o.stylesheet.featuresets)p.push({featuresetId:y,importId:o.scope?o.scope:void 0});return p}getFeaturesetLayers(t,o){const p=this.getFragmentStyle(o),y=p.stylesheet.featuresets;if(!y||!y[t])return this.fire(new r.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const T of y[t].selectors){const I=p.getOwnLayer(T.layer);I&&b.push(I)}return b}getConfigProperty(t,o){const p=this.getFragmentStyle(t);if(!p)return null;const y=r.B(o,p.scope),b=p.options.get(y),T=b?b.value||b.default:null;return T?T.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,o){const p=r.B(t,o);return this._mergedIndoor[p]}setIndoorData(t,o){this.map.indoor.setIndoorData(o)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,o,p){const y=this.getFragmentStyle(t);if(!y)return;const b=y.stylesheet.schema;if(!b||!b[o])return;const T=r.U(p);if(T.result!=="success")return void Iu(this,T.value);const I=T.value.expression,D=r.B(o,y.scope),F=y.options.get(D);if(!F)return;let z;const{minValue:j,maxValue:B,stepValue:$,type:Z,values:Q}=b[o],ne=r.U(b[o].default);ne.result==="success"&&(z=ne.value.expression),z?(this.options.set(D,Object.assign({},F,{value:I,default:z,minValue:j,maxValue:B,stepValue:$,type:Z,values:Q})),this.updateConfigDependencies(o)):this.fire(new r.y(new Error(`No schema defined for the config option "${o}" in the "${t}" fragment.`)))}getConfig(t){const o=this.getFragmentStyle(t);if(!o)return null;const p=o.stylesheet.schema;if(!p)return null;const y={};for(const b in p){const T=r.B(b,o.scope),I=o.options.get(T),D=I?I.value||I.default:null;y[b]=D?D.serialize():null}return y}setConfig(t,o){const p=this.getFragmentStyle(t);p&&(p.updateConfig(o,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const o=this.getFragmentStyle(t);return o?o.stylesheet.schema:null}setSchema(t,o){const p=this.getFragmentStyle(t);p&&(p.stylesheet.schema=o,p.updateConfig(p._config,o),this.updateConfigDependencies())}updateConfig(t,o){if(this._config=t,t||o)if(o)for(const p in o){let y,b;const T=r.U(o[p].default);if(T.result==="success"&&(y=T.value.expression),t&&t[p]!==void 0){const B=r.U(t[p]);B.result==="success"&&(b=B.value.expression)}const{minValue:I,maxValue:D,stepValue:F,type:z,values:j}=o[p];if(y){const B=r.B(p,this.scope);this.options.set(B,{default:y,value:b,minValue:I,maxValue:D,stepValue:F,type:z,values:j})}else this.fire(new r.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,o=()=>!0){for(const p of t){const y=this.getLayer(p);y&&o(y)&&(y.possiblyEvaluateVisibility(),this._updateLayer(y),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,o=>!t||o.expressionDependencies.configDependencies.has(t)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(o=>{const p=o._styleColorTheme.colorThemeOverride?o._styleColorTheme.colorThemeOverride:o._styleColorTheme.colorTheme;if(p){const y=o._evaluateColorThemeData(p);(!o._styleColorTheme.lut&&y!==""||o._styleColorTheme.lut&&y!==o._styleColorTheme.lut.data)&&o.setColorTheme(p)}}),this._changes.setDirty()}addLayer(t,o,p={}){this._checkLoaded();const y=t.id;if(this._layers[y])return void this.fire(new r.y(new Error(`Layer with id "${y}" already exists on this map`)));let b;if(t.type==="custom"){if(Iu(this,r.ds(t)))return;b=r.dt(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(y,t.source),t=r.dn(t),t=Object.assign(t,{source:y})),this._validate(Ma,`layers.${y}`,t,{arrayIndex:-1},p))return;b=r.dt(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}})}const T=r.B(b.source,b.scope);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T);let I=this._order.length;if(o){const j=this._order.indexOf(o);if(j===-1)return void this.fire(new r.y(new Error(`Layer with id "${o}" does not exist on this map.`)));b.slot===this._layers[o].slot?I=j:r.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(I,0,y),this._layerOrderChanged=!0,this._layers[y]=b;const D=this.getOwnLayerSourceCache(b),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&b.canCastShadows()&&F&&(D.castsShadows=!0);const z=this._changes.getRemovedLayer(b);if(z&&b.source&&D&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const j=r.B(b.source,b.scope);z.type!==b.type?this._changes.updateSourceCache(j,"clear"):(this._changes.updateSourceCache(j,"reload"),D.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(t,o){this._checkLoaded();const p=this._checkLayer(t);if(!p||t===o)return;const y=this._order.indexOf(t);this._order.splice(y,1);let b=this._order.length;if(o){const T=this._order.indexOf(o);if(T===-1)return void this.fire(new r.y(new Error(`Layer with id "${o}" does not exist on this map.`)));p.slot===this._layers[o].slot?b=T:r.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const o=this._checkLayer(t);if(!o)return;o.setEventedParent(null);const p=this._order.indexOf(t);this._order.splice(p,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._indoorDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const y=this.getOwnLayerSourceCache(o);if(y&&y.castsShadows){let b=!1;for(const T in this._layers)if(this._layers[T].source===o.source&&this._layers[T].canCastShadows()){b=!0;break}y.castsShadows=b}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const o in this._layers)if(this._layers[o].type===t)return!0;return!1}setLayerZoomRange(t,o,p){this._checkLoaded();const y=this._checkLayer(t);y&&(y.minzoom===o&&y.maxzoom===p||(o!=null&&(y.minzoom=o),p!=null&&(y.maxzoom=p),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,o){this._checkLoaded();const p=this._checkLayer(t);p&&p.slot!==o&&(p.slot=o,this._updateLayer(p))}setFilter(t,o,p={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!r.bx(y.filter,o))return o==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(hn,`layers.${y.id}.filter`,o,{layerType:y.type},p)||(y.filter=r.dn(o),this._updateLayer(y)))}getFilter(t){const o=this._checkLayer(t);if(o)return r.dn(o.filter)}setLayoutProperty(t,o,p,y={}){this._checkLoaded();const b=this._checkLayer(t);if(b&&!r.bx(b.getLayoutProperty(o),p)){if(p!=null&&(!y||y.validate!==!1)&&Iu(b,it.call(ra,{key:`layers.${t}.layout.${o}`,layerType:b.type,objectKey:o,value:p,styleSpec:r.a6,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(o,p),b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),this._updateLayer(b)}}setLayerProperty(t,o,p,y={}){this._checkLoaded();const b=this._checkLayer(t);b&&(o==="appearances"?(b.setAppearances(p),this._changes.setDirty()):b.isPaintProperty(o)?this.setPaintProperty(t,o,p,y):this.setLayoutProperty(t,o,p,y))}getLayoutProperty(t,o){const p=this._checkLayer(t);if(p)return p.getLayoutProperty(o)}setPaintProperty(t,o,p,y={}){this._checkLoaded();const b=this._checkLayer(t);if(!b||r.bx(b.getPaintProperty(o),p)||p!=null&&(!y||y.validate!==!1)&&Iu(b,Ko.call(ra,{key:`layers.${t}.paint.${o}`,layerType:b.type,objectKey:o,value:p,styleSpec:r.a6})))return;const T=b.setPaintProperty(o,p);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),T&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(t,o){const p=this._checkLayer(t);if(p)return p.getPaintProperty(o)}setFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:D,importId:F}=t.target,z=this.getFragmentStyle(F),j=z.getFeaturesetLayers(D);for(const{source:B,sourceLayer:$}of j)z.setFeatureState({id:t.id,source:B,sourceLayer:$},o)}else if("layerId"in t.target){const{layerId:D}=t.target,F=this.getLayer(D);this.setFeatureState({id:t.id,source:F.source,sourceLayer:F.sourceLayer},o)}return}const p=t.source,y=t.sourceLayer,b=this._checkSource(p);if(!b)return;const T=b.type;if(T==="geojson"&&y)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!y)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(p);for(const D of I)D.setFeatureState(y,t.id,o)}removeFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:D,importId:F}=t.target,z=this.getFragmentStyle(F),j=z.getFeaturesetLayers(D);for(const{source:B,sourceLayer:$}of j)z.removeFeatureState({id:t.id,source:B,sourceLayer:$},o)}else if("layerId"in t.target){const{layerId:D}=t.target,F=this.getLayer(D);this.removeFeatureState({id:t.id,source:F.source,sourceLayer:F.sourceLayer},o)}return}const p=t.source,y=this._checkSource(p);if(!y)return;const b=y.type,T=b==="vector"?t.sourceLayer:void 0;if(b==="vector"&&!T)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(p);for(const D of I)D.removeFeatureState(T,t.id,o)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let b;if("featuresetId"in t.target){const{featuresetId:T,importId:I}=t.target,D=this.getFragmentStyle(I),F=D.getFeaturesetLayers(T);for(const{source:z,sourceLayer:j}of F){const B=D.getFeatureState({id:t.id,source:z,sourceLayer:j});if(B&&!b)b=B;else if(!r.bx(b,B))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:T}=t.target,I=this.getLayer(T);b=this.getFeatureState({id:t.id,source:I.source,sourceLayer:I.sourceLayer})}return b}const o=t.source,p=t.sourceLayer,y=this._checkSource(o);if(y){if(y.type!=="vector"||p)return t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(p,t.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),o=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return r.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(t){for(const o of Object.values(this._mergedLayers))t(o)&&this._updateLayer(o)}_updateLayer(t){this._changes.updateLayer(t);const o=this.getLayerSourceCache(t),p=r.B(t.source,t.scope),y=this._changes.getUpdatedSourceCaches();t.source&&!y[p]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),o.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const o=I=>this._mergedLayers[I].is3D(!!this.terrain),p=this.order,y={},b=[];for(let I=p.length-1;I>=0;I--){const D=p[I];if(o(D)){y[D]=I;for(const F of t){const z=F[D];if(z)for(const j of z)b.push(j)}}}b.sort((I,D)=>D.intersectionZ-I.intersectionZ);const T=[];for(let I=p.length-1;I>=0;I--){const D=p[I];if(o(D))for(let F=b.length-1;F>=0;F--){const z=b[F].feature;if(z.layer&&y[z.layer.id]<I)break;T.push(z),b.pop()}else for(const F of t){const z=F[D];if(z)for(const j of z)T.push(j.feature)}}return T}queryRasterValue(t,o,p){const y=this.getOwnSource(t);return y?y.type!=="raster-array"?(this.fire(new r.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):y.queryRasterArrayValue(o,p):(this.fire(new r.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,o,p){let y;o&&!Array.isArray(o)&&o.filter&&(this._validate(hn,"queryRenderedFeatures.filter",o.filter,null,o),y=r.b5(o.filter));const b={},T=z=>{if(Um.has(z.type))return;const j=this.getOwnLayerSourceCache(z),B=b[j.id]=b[j.id]||{sourceCache:j,layers:{},has3DLayers:!1};z.is3D(!!this.terrain)&&(B.has3DLayers=!0),B.layers[z.fqid]=B.layers[z.fqid]||{styleLayer:z,targets:[]},B.layers[z.fqid].targets.push({filter:y})};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const z of o.layers){const j=this._layers[z];if(!j)return this.fire(new r.y(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];T(j)}}else for(const z in this._layers)T(this._layers[z]);const I=this._queryRenderedFeatures(t,b,p),D=this._flattenAndSortRenderedFeatures(I),F=[];for(const z of D)r.dv(z.layer.id)===this.scope&&F.push(z);return F}queryRenderedFeatureset(t,o,p){let y;o&&!Array.isArray(o)&&o.filter&&(this._validate(hn,"queryRenderedFeatures.filter",o.filter,null,o),y=r.b5(o.filter));const b="mock",T=[];if(o&&o.target)T.push(Object.assign({},o,{targetId:b,filter:y}));else{const z=this.getFeaturesetDescriptors();for(const j of z)T.push({targetId:b,filter:y,target:j});for(const{style:j}of this.fragments){const B=j.getFeaturesetDescriptors();for(const $ of B)T.push({targetId:b,filter:y,target:$})}}const I=this.queryRenderedTargets(t,T,p),D=[],F=new Set;for(const z of I)for(const j of z.variants[b])Ka(j,z,F)||D.push(new r.dw(z,j));return D}queryRenderedTargets(t,o,p){const y={},b=(I,D,F,z)=>{const j=y[D.id]=y[D.id]||{sourceCache:D,layers:{},has3DLayers:!1};if(j.layers[I.fqid]=j.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(j.has3DLayers=!0),!z)return F.uniqueFeatureID=!1,void j.layers[I.fqid].targets.push(F);j.layers[I.fqid].targets.push(Object.assign({},F,{namespace:z.namespace,properties:z.properties,uniqueFeatureID:z.uniqueFeatureID}))};for(const I of o)if("featuresetId"in I.target){const{featuresetId:D,importId:F}=I.target,z=this.getFragmentStyle(F);if(!z||!z._featuresetSelectors)continue;const j=z._featuresetSelectors[D];if(!j){this.fire(new r.y(new Error(`The featureset '${D}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const B of j){const $=z.getOwnLayer(B.layerId);$&&!Um.has($.type)&&b($,z.getOwnLayerSourceCache($),I,B)}}else if("layerId"in I.target){const{layerId:D}=I.target,F=this.getLayer(D);if(!F||Um.has(F.type))continue;b(F,this.getLayerSourceCache(F),I)}const T=this._queryRenderedFeatures(t,y,p);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(t,o,p){const y=[],b=!!this.map._showQueryGeometry,T=nr.createFromScreenPoints(t,p);for(const I in o){const D=bs(T,o[I],this._availableImages,p,b);Object.keys(D).length&&y.push(D)}if(this.placement)for(const I in o){if(!o[I].sourceCache._onlySymbols)continue;const D=Ic(T.screenGeometry,o[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(D).length&&y.push(D)}return y}querySourceFeatures(t,o){const p=o&&o.filter;p&&this._validate(hn,"querySourceFeatures.filter",p,null,o);let y=[];const b=this.getOwnSourceCaches(t);for(const T of b)y=y.concat(ch(T,o));return y}addSourceType(t,o,p){return zl.getSourceType(t)?p(new Error(`A source type called "${t}" already exists.`)):(zl.setSourceType(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,o,p={}){this._checkLoaded();const y=this.light.getLight();let b=!1;for(const I in t)if(!r.bx(t[I],y[I])){b=!0;break}if(!b)return;const T=this._getTransitionParameters();this.light.setLight(t,o,p),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,o=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),o===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=t;const y=t.source==null;if(o===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const I="terrain-dem-src";this.addSource(I,p.source),p=r.dn(p),p=Object.assign(p,{source:I})}const b=Object.assign({},p),T={};if(this.terrain&&y){b.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(T.style=I.serialize())}if(this._validate(Ks,"terrain",b,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&o!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,o),this.fire(new r.z("data",{dataType:"style"}))}else{const b=this.terrain,T=b.get();for(const I of Object.keys(r.a6.terrain))!p.hasOwnProperty(I)&&r.a6.terrain[I].default&&(p[I]=r.a6.terrain[I].default);for(const I in t)if(!r.bx(t[I],T[I])){b.set(t,this.options),this.stylesheet.terrain=t;const D=this._getTransitionParameters({duration:0});b.updateTransitions(D),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const o=this.fog=new ei(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}_createSnow(t){const o=this.snow=new Ro(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}_createRain(t){const o=this.rain=new ho(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!r.bx(o.get(),t)){o.set(t,this.options),this.stylesheet.fog=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const o=this.snow;if(!r.bx(o.get(),t)){o.set(t,this.options),this.stylesheet.snow=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const o=this.rain;if(!r.bx(o.get(),t)){o.set(t,this.options),this.stylesheet.rain=o.get();const p=this._getTransitionParameters({duration:0});o.updateTransitions(p)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},o=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!o)return this._styleColorTheme.lut=null,void t();const p=this._evaluateColorThemeData(o);this._loadColorTheme(p).then(()=>{this.fire(new r.z("colorthemeset")),t()}).catch(y=>{r.w(`Couldn't set color theme: ${y}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,o){const p=this.getFragmentStyle(t);p&&(p._styleColorTheme.colorThemeOverride=o,p._reloadColorTheme())}_getTransitionParameters(t){return{now:r.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],o=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?t.push(p):o.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...o)}_createTerrain(t,o){const p=this.terrain=new Me(t,o,this.scope,this.options,this.map.getWorldview());o===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});p.updateTransitions(y)}_force3DLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="symbol"&&this._updateLayer(o)}}_validate(t,o,p,y,b={}){if(b&&b.validate===!1)return!1;const T=Object.assign({},this.serialize());return Iu(this,t.call(ra,Object.assign({key:o,style:T,value:p,styleSpec:r.a6},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const o=this.getSourceCaches(t);for(const p of o)p.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const o=this._mergedLayers[t];o._clear&&o._clear()}}reloadSource(t){const o=this.getSourceCaches(t);for(const p of o)p.resume(),p.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let o;this.directionalLight&&(o=ex(this.directionalLight));const p=new Set;for(const y in this._mergedLayers){const b=this._mergedLayers[y];b.hasElevation()&&!p.has(b.source)&&p.add(b.source)}for(const y in this._mergedSourceCaches){const b=this._mergedSourceCaches[y],T=p.has(b._source.id);b.update(t,void 0,void 0,o,T)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const o=this._sourceCaches[t];o.resume(),o.reload()}}_updatePlacement(t,o,p,y,b,T,I=!1){let D=!1,F=!1;const z={},j={};for(const B of this._mergedOrder){const $=this._mergedLayers[B];if($.type!=="symbol")continue;const Z=r.B($.source,$.scope);let Q=z[Z];if(!Q){const te=this.getLayerSourceCache($);if(!te)continue;const se=te.getRenderableIds(!0).map(me=>te.getTileByID(me));j[Z]=se.slice(),Q=z[Z]=se.sort((me,ce)=>ce.tileID.overscaledZ-me.tileID.overscaledZ||(me.tileID.isLessThan(ce.tileID)?-1:1))}const ne=this.crossTileSymbolIndex.addLayer($,Q,o.center.lng,o.projection);D=D||ne}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new r.z("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.o.now(),o.zoom))&&(this.pauseablePlacement=new sa(o,this._mergedOrder,I,p,y,b,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,z,j,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.o.now()),F=!0),D&&this.pauseablePlacement.placement.setStale()),F||D){this._buildingIndex.onNewFrame(o.zoom);for(let B=0;B<this._mergedOrder.length;B++){const $=this._mergedLayers[this._mergedOrder[B]];if($.type!=="symbol")continue;const Z=this.isLayerClipped($);this.placement.updateLayerOpacities($,z[r.B($.source,$.scope)],B,Z?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,o){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:b})=>b===t.id)!==-1)return void this.fire(new r.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!o)return p.push(t),this._loadImports([t],!0);const y=p.findIndex(({id:b})=>b===o);return y===-1&&this.fire(new r.y(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,y).concat(t).concat(p.slice(y)),this._loadImports([t],!0,o)}updateImport(t,o){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(t);return y===-1?this:typeof o=="string"?(this.setImportUrl(t,o),this):(o.url&&o.url!==p[y].url&&this.setImportUrl(t,o.url),r.bx(o.config,p[y].config)||this.setImportConfig(t,o.config,o.data.schema),r.bx(o.data,p[y].data)||this.setImportData(t,o.data),this)}moveImport(t,o){this._checkLoaded();let p=this.stylesheet.imports||[];const y=this.getImportIndex(t);if(y===-1)return this;const b=this.getImportIndex(o);if(b===-1)return this;const T=p[y],I=this.fragments[y];return p=p.filter(({id:D})=>D!==t),this.fragments=this.fragments.filter(({id:D})=>D!==t),this.stylesheet.imports=p.slice(0,b).concat(T).concat(p.slice(b)),this.fragments=this.fragments.slice(0,b).concat(I).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(t,o){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(t);if(y===-1)return this;p[y].url=o;const b=this.fragments[y];return b.style=this._createFragmentStyle(p[y]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(o),this}setImportData(t,o){this._checkLoaded();const p=this.getImportIndex(t),y=this.stylesheet.imports||[];return p===-1?this:o?(this.fragments[p].style.setState(o),this._reloadImports(),this):(delete y[p].data,this.setImportUrl(t,y[p].url))}setImportConfig(t,o,p){this._checkLoaded();const y=this.getImportIndex(t),b=this.stylesheet.imports||[];if(y===-1)return this;o?b[y].config=o:delete b[y].config;const T=this.fragments[y];p&&T.style.stylesheet&&(T.style.stylesheet.schema=p);const I=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=o,T.style.updateConfig(o,I),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const o=this.stylesheet.imports||[],p=this.getImportIndex(t);p!==-1&&(o.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(t){const o=(this.stylesheet.imports||[]).findIndex(p=>p.id===t);return o===-1&&this.fire(new r.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),o}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const o in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[o];p&&t.push(p.getSource())}return t}getSource(t,o){const p=this.getSourceCache(t,o);return p&&p.getSource()}getLayerSource(t){const o=this.getLayerSourceCache(t);return o&&o.getSource()}getSourceCache(t,o){const p=r.B(t,o);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(t){const o=r.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const o=[];return this._mergedOtherSourceCaches[t]&&o.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&o.push(this._mergedSymbolSourceCaches[t]),o}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const o in t){const p=t[o];p==="reload"?this.reloadSource(o):p==="clear"&&this.clearSource(o)}}updateLayers(t){const o=this._changes.getUpdatedPaintProperties();for(const p of o){const y=this.getLayer(p);y&&y.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,o,p){this.imageManager.getImages(o.images,o.scope,p),this._updateTilesForChangedImages();const y=T=>{if(T){const I=o.images.map(D=>r.I.toString(D));T.setDependencies(o.tileID.key,o.type,I)}},b=r.B(o.source,o.scope);y(this._mergedOtherSourceCaches[b]),y(this._mergedSymbolSourceCaches[b]),o.images.some(T=>T.iconsetId)&&this.fire(new r.z("data",{dataType:"style"}))}rasterizeImages(t,o,p){this.imageManager.rasterizeImages(o,p)}getGlyphs(t,o,p){this.glyphManager.getGlyphs(o.stacks,p)}getResource(t,o,p){return r.dy(o,p)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const o=[];return this._otherSourceCaches[t]&&o.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&o.push(this._symbolSourceCaches[t]),o}_isSourceCacheLoaded(t){const o=this.getOwnSourceCaches(t);return o.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${t}'`))),!1):o.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,o){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const p=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),y=t.type==="building";if(t.is3D(!!this.terrain)){if(p||y||o&&o.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}zl.getSourceType=function(f){return os[f]},zl.setSourceType=function(f,t){os[f]=t},zl.registerForPluginStateChange=r.dz;class mh extends r.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},r.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[o,p]of Object.entries(t.buildings))if(this._buildings[o])for(const y of p.floorIds)this._buildings[o].floors[y]||(this._buildings[o].floors[y]=p.floors[y]);else this._buildings[o]=p;for(const o of t.activeFloors)this._activeFloors.add(o);this._updateIndoorSelector()}getIndoorTileOptions(t,o){const p=this._style.getIndoorSourceLayers(t,o);return p&&this._indoorState?{sourceLayers:p,indoorState:this._indoorState}:null}_updateUI(t,o,p){const y=function(b,T,I,D){let F=null,z=Number.MAX_SAFE_INTEGER;if(D<16)return null;for(const[j,B]of Object.entries(b)){const $=B.center;if($){const Z=T.distanceTo(r.aS.convert($));Z<z&&I.contains($)&&(z=Z,F=j)}}return F}(this._buildings,o,p,t);y!==this._closestBuildingId&&(this._closestBuildingId=y,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,o=this._closestBuildingId,p=o&&t?t[o]:void 0;if(!p)return void this.fire(new r.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let y=null;for(const T of p.floorIds)if(this._activeFloors&&this._activeFloors.has(T)){y=T;break}const b=Array.from(p.floorIds).map(T=>({id:T,name:p.floors[T].name,zIndex:p.floors[T].zIndex})).sort((T,I)=>I.zIndex-T.zIndex);this.fire(new r.z("selector-update",{selectedFloorId:y,activeFloorsVisible:this._activeFloorsVisible,floors:b}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var bp=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,jm=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,cs=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,pd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Jd=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,G_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Gm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,bl=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Hm=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Bt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,wp=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Fc=[];el(bp,Fc),el(cs,Fc),el(jm,Fc);const Qd={"_prelude_fog.vertex.glsl":G_,"_prelude_terrain.vertex.glsl":Jd,"_prelude_shadow.vertex.glsl":Bt,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Gm,"_prelude_shadow.fragment.glsl":wp,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":bl,"_prelude_raster_particle.glsl":Hm},Ru={};Tn("",Jd),Tn(Gm,G_),Tn(wp,Bt),Tn(bl,""),Tn(Hm,"");const Tp=Tn(jm,cs),Lc=bp;var $m={background:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Tn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Tn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Tn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Tn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Tn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Tn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Tn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Tn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Tn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Tn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Tn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Tn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Tn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Tn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Tn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Tn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Tn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Tn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Tn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Tn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,pd),skyboxGradient:Tn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,pd),skyboxCapture:Tn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Tn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Tn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Tn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Tn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Tn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Tn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Tn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Tn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function el(f,t){const o=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of o)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=p.split(" ");for(const b of y)t.includes(b)||t.push(b)}}function Tn(f,t){const o=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,y={},b=[],T=[];if(f=f.replace(o,(D,F)=>(T.push(F),"")),(t=t.replace(o,(D,F)=>(b.push(F),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let I=[...Fc];el(f,I),el(t,I);for(const D of[...b,...T])Qd[D]||console.error(`Undefined include: ${D}`),Ru[D]||(Ru[D]=[],el(Qd[D],Ru[D])),I=[...I,...Ru[D]];return{fragmentSource:f=f.replace(p,(D,F,z,j,B)=>(y[B]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${B}
in ${z} ${j} ${B};
#else
uniform ${z} ${j} u_${B};
#endif
`:F==="initialize"?`
#ifdef HAS_UNIFORM_u_${B}
    ${z} ${j} ${B} = u_${B};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${z} ${j} ${B};
#endif
`:F==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(p,(D,F,z,j,B)=>{const $=`MATERIAL_ATTRIBUTE_OFFSET_${B}`,Z=j==="float"?"vec2":j,Q=`GET_ATTRIBUTE_${Z}(a_${B}, materialInfo, ${$})`,ne=B.match(/color/)?"color":Z;return F==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${B}
in ${z} ${j} a_${B};
#endif
`:y[B]?F==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
    #if !defined(${$})
        in ${z} ${Z} a_${B};
    #endif
out ${z} ${j} ${B};
#else
uniform ${z} ${j} u_${B};
#endif
`:F==="initialize"?ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${z} ${j} ${B} = u_${B};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${B}) 
    #ifdef ${$}
        ${B} = unpack_mix_${ne}(${Q}, u_${B}_t);
    #else
        ${B} = unpack_mix_${ne}(a_${B}, u_${B}_t);
    #endif
#else
    ${z} ${j} ${B} = u_${B};
#endif
`:F==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${z} ${j} a_${B};
    out ${z} ${j} ${B};
#endif
`:F==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${B} = a_${B};
#endif
`:void 0:F==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
    #if !defined(${$})
        in ${z} ${Z} a_${B};
    #endif  
#else
uniform ${z} ${j} u_${B};
#endif
`:F==="define-instanced"?ne==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${B}0;
in vec4 a_${B}1;
in vec4 a_${B}2;
in vec4 a_${B}3;
#else
uniform ${z} ${j} u_${B};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${z} ${Z} a_${B};
#else
uniform ${z} ${j} u_${B};
#endif
`:F==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${z} ${j} ${B} = a_${B};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    #ifdef ${$}
        ${z} ${j} ${B} = ${Q};
    #else
        ${z} ${j} ${B} = a_${B};
    #endif
#else
    ${z} ${j} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    #ifdef ${$}
        ${z} ${j} ${B} = unpack_mix_${ne}(${Q}, u_${B}_t);
    #else
        ${z} ${j} ${B} = unpack_mix_${ne}(a_${B}, u_${B}_t);
    #endif
#else
    ${z} ${j} ${B} = u_${B};
#endif
`}),usedDefines:I,vertexIncludes:b,fragmentIncludes:T}}class cc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,o,p,y,b,T,I,D){this.context=t;let F=this.boundPaintVertexBuffers.length!==y.length;for(let j=0;!F&&j<y.length;j++)this.boundPaintVertexBuffers[j]!==y[j]&&(F=!0);let z=this.boundDynamicVertexBuffers.length!==I.length;for(let j=0;!z&&j<I.length;j++)this.boundDynamicVertexBuffers[j]!==I[j]&&(z=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==p||F||z||this.boundIndexBuffer!==b||this.boundVertexOffset!==T)this.freshBind(o,p,y,b,T,I,D);else{t.bindVertexArrayOES.set(this.vao);for(const j of I)j&&(j.bind(),D&&j.instanceCount&&j.setVertexAttribDivisor(t.gl,o,D));b&&b.dynamicDraw&&b.bind()}}freshBind(t,o,p,y,b,T,I){const D=this.context,F=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=T,o.enableAttributes(F,t),o.bind(),o.setVertexAttribPointers(F,t,b);for(const z of p)z.enableAttributes(F,t),z.bind(),z.setVertexAttribPointers(F,t,b);for(const z of T)z&&(z.enableAttributes(F,t),z.bind(),z.setVertexAttribPointers(F,t,b),I&&z.instanceCount&&z.setVertexAttribDivisor(F,t,I));y&&y.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ef(f,t){const o=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new r.ae(0,p/o).toLngLat().lat,new r.ae(0,(p+1)/o).toLngLat().lat]}function ix(f,t,o,p,y,b,T){const I=f.context,D=I.gl,F=o.hillshadeFBO;if(!F)return;f.prepareDrawTile();const z=f.isTileAffectedByFog(t),j=f.getOrCreateProgram("hillshade",{overrideFog:z});I.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,F.colorAttachment.get());const B=((ne,te,se,me)=>{const ce=se.paint.get("hillshade-shadow-color"),Ce=se.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",_e=se.paint.get("hillshade-highlight-color"),Re=se.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Ae=se.paint.get("hillshade-accent-color"),Te=se.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",De=se.paint.get("hillshade-emissive-strength");let He=r.an(se.paint.get("hillshade-illumination-direction"));if(se.paint.get("hillshade-illumination-anchor")==="viewport")He-=ne.transform.angle;else if(ne.style&&ne.style.enable3dLights()&&ne.style.directionalLight){const rt=ne.style.directionalLight.properties.get("direction"),Qe=r.d3(rt.x,rt.y,rt.z);He=r.an(Qe[1])}const Ue=!ne.options.moving;return{u_matrix:me||ne.transform.calculateProjMatrix(te.tileID.toUnwrapped(),Ue),u_image:0,u_latrange:ef(0,te.tileID),u_light:[se.paint.get("hillshade-exaggeration"),He],u_shadow:ce.toPremultipliedRenderColor(Ce?null:se.lut),u_highlight:_e.toPremultipliedRenderColor(Re?null:se.lut),u_emissive_strength:De,u_accent:Ae.toPremultipliedRenderColor(Te?null:se.lut)}})(f,o,p,f.terrain?t.projMatrix:null);f.uploadCommonUniforms(I,j,t.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:Z,tileBoundsSegments:Q}=f.getTileBoundsBuffers(o);j.draw(f,D.TRIANGLES,y,b,T,Vi.disabled,B,p.id,$,Z,Q)}function Wm(f,t,o){if(!t.needsDEMTextureUpload)return;const p=f.context,y=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||f.getTileTexture(o.stride);const b=o.getPixels();t.demTexture?t.demTexture.update(b,{premultiply:!1}):t.demTexture=new r.T(p,b,y.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function nx(f,t,o){const p=f.context,y=p.gl;if(!t.dem)return;const b=t.dem;if(p.activeTexture.set(y.TEXTURE1),Wm(f,t,b),!t.demTexture)return;t.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const T=b.dim;p.activeTexture.set(y.TEXTURE0);let I=t.hillshadeFBO;if(!I){const B=new r.T(p,{width:T,height:T,data:null},y.RGBA8);B.bind(y.LINEAR,y.CLAMP_TO_EDGE),I=t.hillshadeFBO=p.createFramebuffer(T,T,!0,"renderbuffer"),I.colorAttachment.set(B.texture)}p.bindFramebuffer.set(I.framebuffer),p.viewport.set([0,0,T,T]);const{tileBoundsBuffer:D,tileBoundsIndexBuffer:F,tileBoundsSegments:z}=f.getMercatorTileBoundsBuffers(),j=[];f.linearFloatFilteringSupported()&&j.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:j}).draw(f,y.TRIANGLES,_i.disabled,Gi.disabled,sn.unblended,Vi.disabled,((B,$)=>{const Z=$.stride,Q=r.bB();return r.cd(Q,0,r.al,-r.al,0,0,1),r.bq(Q,Q,[0,-r.al,0]),{u_matrix:Q,u_image:1,u_dimension:[Z,Z],u_zoom:B.overscaledZ}})(t.tileID,b),o.id,D,F,z),t.needsHillshadePrepare=!1}class io{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class H_ extends io{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class qm extends io{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class rx extends io{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class $_ extends io{getDefault(){return[!0,!0,!0,!0]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Vb extends io{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class ox extends io{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class ax extends io{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Ub extends io{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Zm extends io{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class Sp extends io{getDefault(){return[0,1]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Xm extends io{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class md extends io{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ep extends io{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class Ym extends io{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Du extends io{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class tf extends io{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class zc extends io{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class Mu extends io{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ap extends io{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Cp=class extends io{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class sx extends io{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class gh extends io{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Km extends io{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Jm extends io{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class W_ extends io{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class nf extends io{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Nc extends io{getDefault(){return null}set(t){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class lx extends io{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class cx extends io{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class On extends io{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class uc extends io{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class la extends io{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class no extends la{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class _h extends la{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ip extends la{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Qm extends _h{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Xr=(f,t,o)=>({u_matrix:f,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:o}),Nl=(f,t,o,p,y,b,T,I,D,F,z,j,B,$,Z,Q)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:o,u_zoom_transition:y,u_merc_center:b,u_image0:0,u_frustum_tl:T,u_frustum_tr:I,u_frustum_br:D,u_frustum_bl:F,u_globe_pos:z,u_globe_radius:j,u_viewport:B,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9),u_skirt_height:$,u_far_z_cutoff:Z});function Bc(f,t){return f!=null&&t!=null&&!(!f.hasData()||!t.hasData())&&f.demTexture!=null&&t.demTexture!=null&&f.tileID.key!==t.tileID.key}const Bl=new class{constructor(){this.operations={}}newMorphing(f,t,o,p,y){if(f in this.operations){const b=this.operations[f];b.to.tileID.key!==o.tileID.key&&(b.queued=o)}else this.operations[f]={startTime:p,phase:0,duration:y,from:t,to:o,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const t=this.operations[f];return{from:t.from,to:t.to,phase:t.phase}}update(f){for(const t in this.operations){const o=this.operations[t];for(o.phase=(f-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,f)){delete this.operations[t];break}}}_nextOp(f,t){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=t,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Vc={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Uc(f,t,o){if(t===0)return 0;const p=t<1&&o===514?.25/t:1;return 6*Math.pow(1.5,22-f)*Math.max(t,1)*p}function hc(f,t){const o=1<<f.z;return!t&&(f.x===0||f.x===o-1)||f.y===0||f.y===o-1}const Pu=f=>({u_matrix:f});function eg(f,t,o,p,y){if(y>0){const b=r.o.now(),T=(b-f.timeAdded)/y,I=t?(b-t.timeAdded)/y:-1,D=o.getSource(),F=p.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),z=!t||Math.abs(t.tileID.overscaledZ-F)>Math.abs(f.tileID.overscaledZ-F),j=z&&f.refreshedUponExpiration?1:r.aA(z?T:1-I,0,1);return t?{opacity:1,mix:1-j,isFading:T<1}:{opacity:j,mix:0,isFading:T<1}}return{opacity:1,mix:0,isFading:!1}}class Ts extends qo{constructor(t){const o=Pa("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",o,!1),o.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,o){t.state="loaded",o(null)}}class us extends qo{constructor(t){const o=Pa("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,o,p){if(t.freezeTileCoverage)return;this.transform=t;const y=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const I=new Go(T,this._source.tileSize*T.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);I.state="loaded",this._tiles[T.key]=I}return b},{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(t){const o=this.proxyCachedFBO[t];if(o!==void 0){const p=Object.values(o);this.renderCachePool.push(...p),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class gd extends r.aP{constructor(t,o,p){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=o,this.projMatrix=p}}class rf extends r.bU{constructor(t,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,y,b]=function(D){const F=new r.bc,z=new r.b0,j=131;F.reserve(17161),z.reserve(33800);const B=r.al/128,$=r.al+B/2,Z=$+B;for(let ne=-B;ne<Z;ne+=B)for(let te=-B;te<Z;te+=B){const se=te<0||te>$||ne<0||ne>$?24575:0,me=r.aA(Math.round(te),0,r.al),ce=r.aA(Math.round(ne),0,r.al);F.emplaceBack(me+se,ce)}const Q=(ne,te)=>{const se=te*j+ne;z.emplaceBack(se+1,se,se+j),z.emplaceBack(se+j,se+j+1,se+1)};for(let ne=1;ne<129;ne++)for(let te=1;te<129;te++)Q(te,ne);return[0,129].forEach(ne=>{for(let te=0;te<130;te++)Q(te,ne),Q(ne,te)}),[F,z,32768]}(),T=t.context;this.gridBuffer=T.createVertexBuffer(p,r.be.members),this.gridIndexBuffer=T.createIndexBuffer(y),this.gridSegments=r.bf.simpleSegment(0,0,p.length,y.length),this.gridNoSkirtSegments=r.bf.simpleSegment(0,0,p.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new us(o.map),this.orthoMatrix=r.bB(),r.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.al,0,r.al,0,1);const I=T.gl;this._overlapStencilMode=new Gi({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ts(o.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,o,p){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const y=t.terrain.properties,b=t.terrain.drapeRenderMode===0,T=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.o.now();const I=t.terrain&&t.terrain.scope,D=y.get("source"),F=b?this._mockSourceCache:t.getSourceCache(D,I);if(!F)return void r.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=F,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(o):y.get("exaggeration"),!o.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const z=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const j=this.getScaledDemTileSize();this.sourceCache.update(o,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,z(),this._initializing=!0),z(),o.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const o=this._previousCameraAltitude,p=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=p;const y=o!=null?p-o:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const b=t.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(b);let I=b-this._previousZoom;const D=this._previousUpdateTimestamp;let F=b;this._evaluationZoom!=null&&(F=this._evaluationZoom,Math.abs(b-F)>.5&&(I=.5*(b-F+I)),I*y<0&&(F+=I)),this._evaluationZoom=F;const z=T.getExaggeration(F),j=z===T.getExaggeration(Math.max(0,F-.1));if(j&&Math.abs(z-this._exaggeration)<.01)return z;let B=Math.min(.1,.00375*(this._updateTimestamp-D));return(j||z<.1||Math.abs(I)<1e-4)&&(B=Math.min(.2,4*B)),r.ak(this._exaggeration,z,B)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(r.ae.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=o.getIds().map(D=>{const F=o.getTileByID(D).tileID;return F.projMatrix=p.calculateProjMatrix(F.toUnwrapped()),F});(function(D,F){const z=F.transform.pointCoordinate(F.transform.getCameraPoint()),j=new r.P(z.x,z.y);D.sort((B,$)=>{if($.overscaledZ-B.overscaledZ)return $.overscaledZ-B.overscaledZ;const Z=new r.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),Q=new r.P($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),ne=j.mult(1<<B.canonical.z);return ne.x-=.5,ne.y-=.5,ne.distSqr(Z)-ne.distSqr(Q)})})(y,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},y.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const D in T){const F=T[D];if(!F.used||(F!==this.sourceCache&&this.resetTileLookupCache(F.id),this._setupProxiedCoordsForOrtho(F,t[D],b),F.usedForTerrain))continue;const z=t[D];F.getSource().reparseOverscaled&&this._assignTerrainTiles(z)}this.proxiedCoords[o.id]=y.map(D=>new gd(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const F=this.terrainTileForTile[D.key];if(!F)continue;const z=F.tileID.key;z in I||(this._visibleDemTiles.push(F),I[z]=z)}}_assignTerrainTiles(t){this._initializing||t.forEach(o=>{if(this.terrainTileForTile[o.key])return;const p=this._findTileCoveringTileID(o,this.sourceCache);p&&(this.terrainTileForTile[o.key]=p)})}_prepareDEMTextures(){const t=this.painter.context,o=t.gl;for(const p in this.terrainTileForTile){const y=this.terrainTileForTile[p],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(t.activeTexture.set(o.TEXTURE1),Wm(this.painter,y,b))}}_prepareDemTileUniforms(t,o,p,y){if(!o||o.demTexture==null)return!1;const b=t.tileID.canonical,T=Math.pow(2,o.tileID.canonical.z-b.z),I=y||"";return p[`u_dem_tl${I}`]=[b.x*T%1,b.y*T%1],p[`u_dem_scale${I}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const o=this._visibleDemTiles.reduce((p,y)=>{if(!y.dem)return p;const b=y.dem.tree.minimums[0];return b>0&&t++,p+b},0);return t?o/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,o=t.gl;t.activeTexture.set(o.TEXTURE2);const p=this._getLoadedAreaMinimum(),y=new r.dK({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new r.T(t,y,o.R32F,{premultiply:!1}),b}setupElevationDraw(t,o,p){const y=this.painter.context,b=y.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let I=null,D=null,F=1;if(p&&p.morphing&&this._useVertexMorphing){const $=p.morphing.srcDemTile,Z=p.morphing.dstDemTile;F=p.morphing.phase,$&&Z&&(this._prepareDemTileUniforms(t,$,T,"_prev")&&(D=$),this._prepareDemTileUniforms(t,Z,T)&&(I=Z))}const z=$=>$&&$.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let j=null;var B;if(this.enabled?D&&I?(j=I.demTexture,y.activeTexture.set(b.TEXTURE4),D.demTexture.bind(z(D),b.CLAMP_TO_EDGE),T.u_dem_lerp=F):(I=this.terrainTileForTile[t.tileID.key],j=this._prepareDemTileUniforms(t,I,T)?I.demTexture:this.emptyDEMTexture):j=this.emptyDEMTexture,y.activeTexture.set(b.TEXTURE2),j&&(T.u_dem_size=(B=j).size[0]===1?1:B.size[0]-2,j.bind(z(I),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,o,T),p&&p.useMeterToDem&&I){const $=(1<<I.tileID.canonical.z)*r.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=$}if(p&&p.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),o.setTerrainUniformValues(y,T),this.painter.transform.projection.name==="globe"){const $=this.globeUniformValues(this.painter.transform,t.tileID.canonical,p&&p.useDenormalizedUpVectorScale);o.setGlobeUniformValues(y,$)}}globeUniformValues(t,o,p){const y=t.projection;return{u_tile_tl_up:y.upVector(o,0,0),u_tile_tr_up:y.upVector(o,r.al,0),u_tile_br_up:y.upVector(o,r.al,r.al),u_tile_bl_up:y.upVector(o,0,r.al),u_tile_up_scale:p?r.dL(1):y.upVectorScale(o,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const o=this.painter,p=this.painter.context;t.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,b,T,I,D){if(y.transform.projection.name==="globe")(function(F,z,j,B,$){const Z=F.context,Q=Z.gl;let ne,te;const se=F.transform,me=r.dD(F,Z,se),ce=(rt,Qe)=>{if(te===Qe)return;const lt=[Vc[Qe],"PROJECTION_GLOBE_VIEW"];me&&lt.push("CUSTOM_ANTIALIASING");const Lt=F.isTileAffectedByFog(rt);ne=F.getOrCreateProgram("globeRaster",{defines:lt,overrideFog:Lt}),te=Qe},Ce=F.colorModeForRenderPass(),_e=new _i(Q.LEQUAL,_i.ReadWrite,F.depthRangeFor3D);Bl.update($);const Re=r.dE(se),Ae=[r.aF(se.center.lng),r.aJ(se.center.lat)],Te=F.globeSharedBuffers,De=[se.width*r.o.devicePixelRatio,se.height*r.o.devicePixelRatio],He=Float32Array.from(se.globeMatrix),Ue={useDenormalizedUpVectorScale:!0};{const rt=F.transform,Qe=Uc(rt.zoom,z.exaggeration(),z.sourceCache._source.tileSize);te=-1;const lt=Q.TRIANGLES;for(const Lt of B){const Xe=j.getTile(Lt),Ne=Gi.disabled,ct=z.prevTerrainTileForTile[Lt.key],et=z.terrainTileForTile[Lt.key];Bc(ct,et)&&Bl.newMorphing(Lt.key,ct,et,$,250),Z.activeTexture.set(Q.TEXTURE0),Xe.texture&&Xe.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const At=Bl.getMorphValuesForProxy(Lt.key),jt=At?1:0;At&&Object.assign(Ue,{morphing:{srcDemTile:At.from,dstDemTile:At.to,phase:r.dC(At.phase)}});const pi=r.dF(Lt.canonical),Ft=r.dG(pi.getCenter().lat),zt=r.dH(Lt.canonical,pi,Ft,rt.worldSize/rt._pixelsPerMercatorPixel),mi=r.bj(r.dI(Lt.canonical)),ni=Nl(rt.expandedFarZProjMatrix,He,Re,mi,r.aj(rt.zoom),Ae,rt.frustumCorners.TL,rt.frustumCorners.TR,rt.frustumCorners.BR,rt.frustumCorners.BL,rt.globeCenterInViewSpace,rt.globeRadius,De,Qe,rt._farZ,zt);if(ce(Lt,jt),ne&&(z.setupElevationDraw(Xe,ne,Ue),F.uploadCommonUniforms(Z,ne,Lt.toUnwrapped()),Te)){const[ii,ri,Oi]=Te.getGridBuffers(Ft,Qe!==0);ne.draw(F,lt,_e,Ne,Ce,Vi.backCCW,ni,"globe_raster",ii,ri,Oi)}}}if(Te&&(F.renderDefaultNorthPole||F.renderDefaultSouthPole)){const rt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];me&&rt.push("CUSTOM_ANTIALIASING"),ne=F.getOrCreateProgram("globeRaster",{defines:rt});for(const Qe of B){const{x:lt,y:Lt,z:Xe}=Qe.canonical,Ne=Lt===0,ct=Lt===(1<<Xe)-1,[et,At,jt,pi]=Te.getPoleBuffers(Xe,!1);if(pi&&(Ne||ct)){const Ft=j.getTile(Qe);Z.activeTexture.set(Q.TEXTURE0),Ft.texture&&Ft.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let zt=r.dJ(Xe,lt,se);const mi=r.bj(r.dI(Qe.canonical)),ni=(ii,ri)=>ii.draw(F,Q.TRIANGLES,_e,Gi.disabled,Ce,Vi.disabled,Nl(se.expandedFarZProjMatrix,zt,zt,mi,0,Ae,se.frustumCorners.TL,se.frustumCorners.TR,se.frustumCorners.BR,se.frustumCorners.BL,se.globeCenterInViewSpace,se.globeRadius,De,0,se._farZ),"globe_pole_raster",ri,jt,pi);z.setupElevationDraw(Ft,ne,Ue),F.uploadCommonUniforms(Z,ne,Qe.toUnwrapped()),Ne&&F.renderDefaultNorthPole&&ni(ne,et),ct&&F.renderDefaultSouthPole&&(zt=r.cR(r.bB(),zt,[1,-1,1]),ni(ne,At))}}}})(y,b,T,I,D);else{const F=y.context,z=F.gl;let j,B;const $=y.shadowRenderer,Z=Au(y,y.longestCutoffRange),Q=Ce=>{if(B===Ce)return;const _e=[];_e.push(Vc[Ce]),Z.shouldRenderCutoff&&_e.push("RENDER_CUTOFF"),$&&(_e.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$.useNormalOffset&&_e.push("NORMAL_OFFSET")),j=y.getOrCreateProgram("terrainRaster",{defines:_e}),B=Ce},ne=y.colorModeForRenderPass(),te=new _i(z.LEQUAL,_i.ReadWrite,y.depthRangeFor3D);Bl.update(D);const se=y.transform,me=Uc(se.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let ce=[0,0,0];if($){const Ce=y.style.directionalLight,_e=y.style.ambientLight;Ce&&_e&&(ce=xl(y.style,Ce,_e))}{B=-1;const Ce=z.TRIANGLES,[_e,Re]=[b.gridIndexBuffer,b.gridSegments];for(const Ae of I){const Te=T.getTile(Ae),De=Gi.disabled,He=b.prevTerrainTileForTile[Ae.key],Ue=b.terrainTileForTile[Ae.key];Bc(He,Ue)&&Bl.newMorphing(Ae.key,He,Ue,D,250),F.activeTexture.set(z.TEXTURE0),Te.texture&&Te.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const rt=Bl.getMorphValuesForProxy(Ae.key),Qe=rt?1:0;let lt;rt&&(lt={morphing:{srcDemTile:rt.from,dstDemTile:rt.to,phase:r.dC(rt.phase)}});const Lt=Xr(Ae.projMatrix,hc(Ae.canonical,se.renderWorldCopies)?me/10:me,ce);if(Q(Qe),!j)continue;b.setupElevationDraw(Te,j,lt);const Xe=Ae.toUnwrapped();$&&$.setupShadows(Xe,j),y.uploadCommonUniforms(F,j,Xe,null,Z),j.draw(y,Ce,te,De,ne,Vi.backCCW,Lt,"terrain_raster",b.gridBuffer,_e,Re)}}}}(o,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const o=this.painter,p=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],T=this._drapedRenderBatches.shift(),I=o.style.order,D=[];let F=0;for(const z of b){const j=y.getTileByID(z.proxyTileKey),B=y.proxyCachedFBO[z.key]?y.proxyCachedFBO[z.key][t]:void 0,$=B!==void 0?y.renderCache[B]:this.pool[F++],Z=B!==void 0;if(j.texture=$.tex,Z&&!$.dirty){D.push(j.tileID);continue}let Q;p.bindFramebuffer.set($.fb.framebuffer),this.renderedToTile=!1,$.dirty&&(p.clear({color:r.ao.transparent,stencil:0}),$.dirty=!1);for(let ne=T.start;ne<=T.end;++ne){const te=o.style._mergedLayers[I[ne]];if(te.isHidden(o.transform.zoom))continue;const se=o.style.getLayerSourceCache(te),me=se?this.proxyToSource[z.key][se.id]:[z];if(!me)continue;const ce=me;p.viewport.set([0,0,$.fb.width,$.fb.height]),Q!==(se?se.id:null)&&(this._setupStencil($,me,te,se),Q=se?se.id:null),o.renderLayer(o,se,te,ce)}if(this._drapedRenderBatches.length===0)for(const ne of this._pendingGroundEffectLayers){const te=o.style._mergedLayers[I[ne]];if(te.isHidden(o.transform.zoom))continue;const se=o.style.getLayerSourceCache(te),me=se?this.proxyToSource[z.key][se.id]:[z];if(!me)continue;const ce=me;p.viewport.set([0,0,$.fb.width,$.fb.height]),Q!==(se?se.id:null)&&(this._setupStencil($,me,te,se),Q=se?se.id:null),o.renderLayer(o,se,te,ce)}this.renderedToTile?($.dirty=!0,D.push(j.tileID)):Z||--F,F===5&&(F=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,o.width,o.height]),T.end+1}postRender(){}isLayerOrderingCorrect(t){const o=t.order.length;let p=-1,y=o;for(let b=0;b<o;++b)this._style.isLayerDraped(t._mergedLayers[t.order[b]])?p=Math.max(p,b):y=Math.min(y,b);return y>p}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{t=Math.min(t,o.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,o,p){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const T=b.tileID,I=1<<T.overscaledZ,{x:D,y:F}=T.canonical,z=D/I,j=(D+1)/I,B=F/I,$=(F+1)/I;return{minx:z,miny:B,maxx:j,maxy:$,t:b.dem.tree.raycastRoot(z,B,j,$,t,o,p),tile:b}});y.sort((b,T)=>(b.t!==null?b.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const b of y){if(b.t==null)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,t,o,p);if(T!=null)return T}return null}_createFBO(){const t=this.painter.context,o=t.gl,p=this.drapeBufferSize;t.activeTexture.set(o.TEXTURE0);const y=new r.T(t,{width:p[0],height:p[1],data:null},o.RGBA8);y.bind(o.LINEAR,o.CLAMP_TO_EDGE);const b=t.createFramebuffer(p[0],p[1],!0,null);return b.colorAttachment.set(y.texture),b.depthAttachment=new Qm(t,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:b,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const o=this._style._mergedLayers[t],p=o.isHidden(this.painter.transform.zoom);return o.type==="hillshade"||o.type==="custom"?!p&&o.shouldRedrape():!p&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const p of this._style.getSources())if(p instanceof oa){t=!0;break}if(!t)return;const o={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(y);if(b&&!o[b.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof r.ad){o[b.id]=!0;for(const T of this.proxyCoords){const I=this.proxyToSource[T.key][b.id];if(I)for(const D of I)this._clearRenderCacheForTile(b.id,D)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof Ha){t=!0;break}if(!t)return;const o={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(y);if(!b||o[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const T=y.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const D=this.proxyToSource[I.key][b.id];if(D)for(const F of D){const z=eg(b.getTile(F),b.findLoadedParent(F,0),b,this.painter.transform,T);(z.opacity!==1||z.mix!==0)&&this._clearRenderCacheForTile(b.id,F)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,o=t.length;if(o===0)return;const p=[];this._pendingGroundEffectLayers=[];let y,b=0,T=this._style._mergedLayers[t[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<o;)T=this._style._mergedLayers[t[b]];for(;b<o;++b){const I=this._style._mergedLayers[t[b]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?y===void 0&&(y=b):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),y!==void 0&&(p.push({start:y,end:b-1}),y=void 0)))}if(y!==void 0&&p.push({start:y,end:b-1}),p.length!==0){const I=p[p.length-1];this._pendingGroundEffectLayers.every(D=>D>I.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(t){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const T=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let I=0;I<T.length;++I){const D=Object.values(T[I]);o.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,y=this._tilesDirty;for(let T=p.length-1;T>=0;T--){const I=p[T];if(o.getTileByID(I.key),o.proxyCachedFBO[I.key]!==void 0){const D=t[I.key],F=this.proxyToSource[I.key];let z=0;for(const j in F){const B=F[j],$=D[j];if(!$||$.length!==B.length||B.some((Z,Q)=>Z!==$[Q]||y[j]&&y[j].hasOwnProperty(Z.key))){z=-1;break}++z}for(const j in o.proxyCachedFBO[I.key])o.renderCache[o.proxyCachedFBO[I.key][j]].dirty=z<0||z!==Object.values(D).length}}const b=[...this._drapedRenderBatches];b.sort((T,I)=>I.end-I.start-(T.end-T.start));for(const T of b)for(const I of p){if(o.proxyCachedFBO[I.key])continue;let D=o.renderCachePool.pop();D===void 0&&o.renderCache.length<50&&(D=o.renderCache.length,o.renderCache.push(this._createFBO())),D!==void 0&&(o.proxyCachedFBO[I.key]={},o.proxyCachedFBO[I.key][T.start]=D,o.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(t,o,p,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let I;if(p.isTileClipped())I=o.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Gi.disabled}_renderTileClippingMasks(t,o){const p=this.painter,y=this.painter.context,b=y.gl;p._tileClippingMaskIDs={},y.setColorMode(sn.disabled),y.setDepthMode(_i.disabled);const T=p.getOrCreateProgram("clippingMask");for(const I of t){const D=p._tileClippingMaskIDs[I.key]=--o;T.draw(p,b.TRIANGLES,_i.disabled,new Gi({func:b.ALWAYS,mask:0},D,255,b.KEEP,b.KEEP,b.REPLACE),sn.disabled,Vi.disabled,Pu(I.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(t){const o=this.painter.transform;if(t.x<0||t.x>o.width||t.y<0||t.y>o.height)return null;const p=[t.x,t.y,1,1];r.aC(p,p,o.pixelMatrixInverse),r.cJ(p,p,1/p[3]),p[0]/=o.worldSize,p[1]/=o.worldSize;const y=o._camera.position,b=r.ce(1,o.center.lat),T=[y[0],y[1],y[2]/b,0],I=r.d9([],p.slice(0,3),T);r.aw(I,I);const D=this.raycast(T,I,this._exaggeration);return D!==null&&D?(r.bG(T,T,I,D),T[3]=T[2],T[2]*=b,T):null}_setupProxiedCoordsForOrtho(t,o,p){if(t.getSource()instanceof r.aT)return this._setupProxiedCoordsForImageSource(t,o,p);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const y=this.proxiedCoords[t.id]=[],b=this.proxyCoords;for(let D=0;D<b.length;D++){const F=b[D],z=this._findTileCoveringTileID(F,t);if(z){const j=this._createProxiedId(F,z,p[F.key]&&p[F.key][t.id]);y.push(j),this.proxyToSource[F.key][t.id]=[j]}}let T=!1;const I=new Set;for(let D=0;D<o.length;D++){const F=t.getTile(o[D]);if(!F||!F.hasData())continue;const z=this._findTileCoveringTileID(F.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==F.tileID.canonical.z){const j=this.proxyToSource[z.tileID.key][t.id],B=this._createProxiedId(z.tileID,F,p[z.tileID.key]&&p[z.tileID.key][t.id]);j?j.splice(j.length-1,0,B):this.proxyToSource[z.tileID.key][t.id]=[B];const $=this.proxyToSource[z.tileID.key][t.id];I.has($)||I.add($),y.push(B),T=!0}}if(this._sourceTilesOverlap[t.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const D of I)D.sort((F,z)=>z.overscaledZ-F.overscaledZ)}_setupProxiedCoordsForImageSource(t,o,p){if(!t.getSource().loaded())return;const y=this.proxiedCoords[t.id]=[],b=this.proxyCoords,T=t.getSource(),I=T.tileID;if(!I)return;const D=new r.P(I.x,I.y)._div(1<<I.z),F=T.coordinates.map(r.ae.fromLngLat).reduce((j,B)=>(j.min.x=Math.min(j.min.x,B.x-D.x),j.min.y=Math.min(j.min.y,B.y-D.y),j.max.x=Math.max(j.max.x,B.x-D.x),j.max.y=Math.max(j.max.y,B.y-D.y),j),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(j,B)=>{const $=j.wrap+j.canonical.x/(1<<j.canonical.z),Z=j.canonical.y/(1<<j.canonical.z),Q=r.al/(1<<j.canonical.z),ne=B.wrap+B.canonical.x/(1<<B.canonical.z),te=B.canonical.y/(1<<B.canonical.z);return $+Q<ne+F.min.x||$>ne+F.max.x||Z+Q<te+F.min.y||Z>te+F.max.y};for(let j=0;j<b.length;j++){const B=b[j];for(let $=0;$<o.length;$++){const Z=t.getTile(o[$]);if(!Z||!Z.hasData()||z(B,Z.tileID))continue;const Q=this._createProxiedId(B,Z,p[B.key]&&p[B.key][t.id]),ne=this.proxyToSource[B.key][t.id];ne?ne.push(Q):this.proxyToSource[B.key][t.id]=[Q],y.push(Q)}}}_createProxiedId(t,o,p){let y=this.orthoMatrix;if(p){const b=p.find(T=>T.key===o.tileID.key);if(b)return b}if(o.tileID.key!==t.key){const b=t.canonical.z-o.tileID.canonical.z;let T,I,D;y=r.bB();const F=o.tileID.wrap-t.wrap<<t.overscaledZ;b>0?(T=r.al>>b,I=T*((o.tileID.canonical.x<<b)-t.canonical.x+F),D=T*((o.tileID.canonical.y<<b)-t.canonical.y)):(T=r.al<<-b,I=r.al*(o.tileID.canonical.x-(t.canonical.x+F<<-b)),D=r.al*(o.tileID.canonical.y-(t.canonical.y<<-b))),r.cd(y,0,T,0,T,0,1),r.bq(y,y,[I,D,0])}return new gd(o.tileID,t.key,y)}_findTileCoveringTileID(t,o){let p=o.getTile(t);if(p&&p.hasData())return p;const y=this._findCoveringTileCache[o.id],b=y[t.key];if(p=b?o.getTileByID(b):null,p&&p.hasData()||b===null)return p;let T=p?p.tileID:t,I=T.overscaledZ;const D=o.getSource().minzoom,F=[];if(!b){const j=o.getSource().maxzoom;if(t.canonical.z>=j){const B=t.canonical.z-j;o.getSource().reparseOverscaled?(I=Math.max(t.canonical.z+2,o.transform.tileZoom),T=new r.aP(I,t.wrap,j,t.canonical.x>>B,t.canonical.y>>B)):B!==0&&(I=j,T=new r.aP(I,t.wrap,j,t.canonical.x>>B,t.canonical.y>>B))}T.key!==t.key&&(F.push(T.key),p=o.getTile(T))}const z=j=>{F.forEach(B=>{y[B]=j}),F.length=0};for(I-=1;I>=D&&(!p||!p.hasData());I--){p&&z(p.tileID.key);const j=T.calculateScaledKey(I);if(p=o.getTileByID(j),p&&p.hasData())break;const B=y[j];if(B===null)break;B===void 0?F.push(j):p=o.getTileByID(B)}return z(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,o){let p=this._tilesDirty[t];p||(p=this._tilesDirty[t]={}),p[o.key]=!0}}function Rp(f,t,o){const p=function(I,D,F){const z=r.bI(D,I),j=r.bI(F,[.2126,.7152,.0722]),B=(Z,Q,ne)=>(1-ne)*Z+ne*Q,$=B(1-.3*Math.min(j,1),1,Math.min(z+1,1));return B(.92,1,Math.asin(r.aA(D[2],-1,1))/Math.PI+.5)*$}(f,[0,0,1],t),y=[0,0,0];r.c4(y,o.slice(0,3),p);const b=[0,0,0];r.c4(b,t.slice(0,3),f[2]);const T=[0,0,0];return r.d7(T,y,b),r.da(T)}const Ou=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Dp=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Vl{static cacheKey(t,o,p,y){let b=`${o}${y?y.cacheKey:""}`;for(const T of p)t.usedDefines.includes(T)&&(b+=`/${T}`);return b}constructor(t,o,p,y,b,T){const I=t.gl;this.program=I.createProgram(),this.configuration=y,this.name=o,this.fixedDefines=[...T];let D=y?y.defines():[];D=D.concat(T.map(Z=>`#define ${Z}`));const F=`#version 300 es
`;let z=F+D.concat("precision mediump float;",Lc,Tp.fragmentSource).join(`
`);for(const Z of p.fragmentIncludes)z+=`
${Qd[Z]}`;z+=`
${p.fragmentSource}`;let j=F+D.concat("precision highp float;",Lc,Tp.vertexSource).join(`
`);for(const Z of p.vertexIncludes)j+=`
${Qd[Z]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(j+=`
uniform int u_instanceID;
`),j+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(j=j.replaceAll("gl_InstanceID","u_instanceID"));const B=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(B,z),I.compileShader(B),I.attachShader(this.program,B);const $=I.createShader(I.VERTEX_SHADER);I.isContextLost()?this.failedToCreate=!0:(I.shaderSource($,j),I.compileShader($),I.attachShader(this.program,$),this.attributes={},I.linkProgram(this.program),I.deleteShader($),I.deleteShader(B),this.fixedUniforms=b(t),this.binderUniforms=y?y.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Z=>({u_instanceID:new r.cg(Z)}))(t)),(T.includes("TERRAIN")||o.indexOf("symbol")!==-1||o.indexOf("circle")!==-1)&&(this.terrainUniforms=(Z=>({u_dem:new r.cg(Z),u_dem_prev:new r.cg(Z),u_dem_tl:new r.cj(Z),u_dem_scale:new r.ci(Z),u_dem_tl_prev:new r.cj(Z),u_dem_scale_prev:new r.ci(Z),u_dem_size:new r.ci(Z),u_dem_lerp:new r.ci(Z),u_exaggeration:new r.ci(Z),u_depth:new r.cg(Z),u_depth_size_inv:new r.cj(Z),u_depth_range_unpack:new r.cj(Z),u_occluder_half_size:new r.ci(Z),u_occlusion_depth_offset:new r.ci(Z),u_meter_to_dem:new r.ci(Z),u_label_plane_matrix_inv:new r.ck(Z)}))(t)),T.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new r.ch(Z),u_tile_tr_up:new r.ch(Z),u_tile_br_up:new r.ch(Z),u_tile_bl_up:new r.ch(Z),u_tile_up_scale:new r.ci(Z)}))(t)),T.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new r.ck(Z),u_fog_range:new r.cj(Z),u_fog_color:new r.d2(Z),u_fog_horizon_blend:new r.ci(Z),u_fog_vertical_limit:new r.cj(Z),u_fog_temporal_offset:new r.ci(Z),u_frustum_tl:new r.ch(Z),u_frustum_tr:new r.ch(Z),u_frustum_br:new r.ch(Z),u_frustum_bl:new r.ch(Z),u_globe_pos:new r.ch(Z),u_globe_radius:new r.ci(Z),u_globe_transition:new r.ci(Z),u_is_globe:new r.cg(Z),u_viewport:new r.cj(Z)}))(t)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Z=>({u_cutoff_params:new r.d2(Z)}))(t)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Z=>({u_lighting_ambient_color:new r.ch(Z),u_lighting_directional_dir:new r.ch(Z),u_lighting_directional_color:new r.ch(Z),u_ground_radiance:new r.ch(Z)}))(t)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Z=>({u_light_matrix_0:new r.ck(Z),u_light_matrix_1:new r.ck(Z),u_fade_range:new r.cj(Z),u_shadow_normal_offset:new r.ch(Z),u_shadow_intensity:new r.ci(Z),u_shadow_texel_size:new r.ci(Z),u_shadow_map_resolution:new r.ci(Z),u_shadow_direction:new r.ch(Z),u_shadow_bias:new r.ch(Z),u_shadowmap_0:new r.cg(Z),u_shadowmap_1:new r.cg(Z)}))(t)))}getAttributeLocation(t,o){let p=this.attributes[o];return p===void 0&&(p=this.attributes[o]=t.getAttribLocation(this.program,o)),p}setTerrainUniformValues(t,o){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in o)p[y]&&p[y].set(this.program,y,o[y])}}setGlobeUniformValues(t,o){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in o)p[y]&&p[y].set(this.program,y,o[y])}}setFogUniformValues(t,o){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in o)p[y].set(this.program,y,o[y])}}setCutoffUniformValues(t,o){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in o)p[y].set(this.program,y,o[y])}}setLightsUniformValues(t,o){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in o)p[y].set(this.program,y,o[y])}}setShadowUniformValues(t,o){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;t.program.set(this.program);for(const y in o)p[y].set(this.program,y,o[y])}_drawDebugWireframe(t,o,p,y,b,T,I,D,F,z){const j=t.options.wireframe;if(j.terrain===!1&&j.layers2D===!1&&j.layers3D===!1)return;const B=t.context;if(!(!(!j.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!j.layers2D||t._terrain&&t._terrain.renderingToTexture||!Ou.includes(this.name))||!(!j.layers3D||!Dp.includes(this.name))))return;const $=B.gl,Z=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,b,B);if(!Z)return;const Q=[...this.fixedDefines];Q.push("DEBUG_WIREFRAME");const ne=t.getOrCreateProgram(this.name,{config:this.configuration,defines:Q});B.program.set(ne.program);const te=(ce,Ce,_e)=>{if(Ce[ce]&&_e[ce])for(const Re in Ce[ce])_e[ce][Re]&&_e[ce][Re].set(_e.program,Re,Ce[ce][Re].current)};F&&F.setUniforms(ne.program,B,ne.binderUniforms,I,{zoom:D}),te("fixedUniforms",this,ne),te("terrainUniforms",this,ne),te("globeUniforms",this,ne),te("fogUniforms",this,ne),te("lightsUniforms",this,ne),te("shadowUniforms",this,ne),Z.bind(),B.setColorMode(new sn([$.ONE,$.ONE_MINUS_SRC_ALPHA,$.ZERO,$.ONE],r.ao.transparent,[!0,!0,!0,!1])),B.setDepthMode(new _i(o.func===$.LESS?$.LEQUAL:o.func,_i.ReadOnly,o.range)),B.setStencilMode(Gi.disabled);const se=3*T.primitiveLength*2,me=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ce=z||1;for(let Ce=0;Ce<ce;++Ce)ne.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ce),$.drawElements($.LINES,se,$.UNSIGNED_SHORT,me)}else z&&z>1?$.drawElementsInstanced($.LINES,se,$.UNSIGNED_SHORT,me,z):$.drawElements($.LINES,se,$.UNSIGNED_SHORT,me);b.bind(),B.program.set(this.program),B.setDepthMode(o),B.setStencilMode(p),B.setColorMode(y)}checkUniforms(t,o,p){if(this.fixedDefines.includes(o)){for(const y of Object.keys(p))if(!p[y].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${y} not set but required by ${o} being defined`)}}draw(t,o,p,y,b,T,I,D,F,z,j,B,$,Z,Q,ne){const te=t.context,se=te.gl;if(this.failedToCreate)return;te.program.set(this.program),te.setDepthMode(p),te.setStencilMode(y),te.setColorMode(b),te.setCullFace(T);for(const Ce of Object.keys(this.fixedUniforms))this.fixedUniforms[Ce].set(this.program,Ce,I[Ce]);Z&&Z.setUniforms(this.program,te,this.binderUniforms,B,{zoom:$});const me={[se.POINTS]:1,[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[o];this.checkUniforms(D,"RENDER_SHADOWS",this.shadowUniforms);const ce=ne&&ne>0?1:void 0;for(const Ce of j.get()){const _e=Ce.vaos||(Ce.vaos={});if((_e[D]||(_e[D]=new cc)).bind(te,this,F,Z?Z.getPaintVertexBuffers():[],z,Ce.vertexOffset,Q||[],ce),this.forceManualRenderingForInstanceIDShaders){const Re=ne||1;for(let Ae=0;Ae<Re;++Ae)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ae),z?se.drawElements(o,Ce.primitiveLength*me,se.UNSIGNED_SHORT,Ce.primitiveOffset*me*2):se.drawArrays(o,Ce.vertexOffset,Ce.vertexLength)}else ne&&ne>1?se.drawElementsInstanced(o,Ce.primitiveLength*me,se.UNSIGNED_SHORT,Ce.primitiveOffset*me*2,ne):z?se.drawElements(o,Ce.primitiveLength*me,se.UNSIGNED_SHORT,Ce.primitiveOffset*me*2):se.drawArrays(o,Ce.vertexOffset,Ce.vertexLength);o===se.TRIANGLES&&z&&this._drawDebugWireframe(t,p,y,b,z,Ce,B,$,Z,ne)}}}function of(f,t,o=0){const p=Math.pow(2,t.tileID.overscaledZ),y=t.tileSize*Math.pow(2,f.transform.tileZoom)/p,b=y*(t.tileID.canonical.x+t.tileID.wrap*p),T=y*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ay(t,1,f.transform.tileZoom),u_pixel_coord_upper:[b>>16,T>>16],u_pixel_coord_lower:[65535&b,65535&T],u_pattern_transition:o}}const yh={terrain:0,flat:1},af=r.bB(),vh=(f,t,o,p,y,b,T,I,D,F,z,j,B,$,Z,Q,ne,te)=>{const se=t.style.light,me=se.properties.get("position"),ce=[me.x,me.y,me.z],Ce=r.dN();se.properties.get("anchor")==="viewport"&&(r.dO(Ce,-t.transform.angle),r.dP(ce,ce,Ce));const _e=se.properties.get("color").toPremultipliedRenderColor(null),Re=t.transform,Ae={u_matrix:f,u_lightpos:ce,u_lightintensity:se.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_vertical_gradient:+o,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:af,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:yh[F],u_base_type:yh[z],u_ao:y,u_edge_radius:b,u_width_scale:T,u_flood_light_color:Z,u_vertical_scale:Q,u_flood_light_intensity:ne,u_ground_shadow_factor:te};return Re.projection.name==="globe"&&(Ae.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],Ae.u_zoom_transition=j,Ae.u_inv_rot_matrix=$,Ae.u_merc_center=B,Ae.u_up_dir=Re.projection.upVector(new r.cC(0,0,0),B[0]*r.al,B[1]*r.al),Ae.u_height_lift=D),Ae},_d=(f,t,o,p,y,b)=>({u_matrix:f,u_edge_radius:t,u_width_scale:o,u_vertical_scale:p,u_height_type:yh[y],u_base_type:yh[b]}),jc=(f,t,o,p,y,b,T,I,D,F,z,j,B,$,Z,Q,ne,te)=>{const se=vh(f,t,o,p,y,b,T,I,F,z,j,B,$,Z,Q,ne,1,[0,0,0]),me={u_height_factor:-Math.pow(2,I.overscaledZ)/D.tileSize/8};return Object.assign(se,of(t,D,te),me)},sf=(f,t,o,p,y,b,T,I,D,F,z)=>({u_matrix:t,u_opacity:o,u_ao_pass:p?1:0,u_meter_to_tile:y,u_ao:b,u_flood_light_intensity:T,u_flood_light_color:I,u_attenuation:D,u_edge_radius:F,u_fb:0,u_fb_size:z,u_dynamic_offset:1}),xh=(f,t,o)=>({u_matrix:f,u_emissive_strength:t,u_ground_shadow_factor:o}),q_=(f,t,o,p,y,b=0)=>Object.assign(xh(f,t,y),of(o,p,b)),ux=(f,t,o,p)=>({u_matrix:f,u_world:o,u_emissive_strength:t,u_ground_shadow_factor:p}),jb=(f,t,o,p,y,b,T=0)=>Object.assign(q_(f,t,o,p,b,T),{u_world:y}),Gb=(f,t)=>({u_matrix:f,u_ground_shadow_factor:t}),Mp=(f,t,o,p,y)=>({u_matrix:f,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:o,u_height_scale:p,u_reset_depth:y}),tg=(f,t,o,p,y,b,T,I,D)=>({u_matrix:f,u_normal_matrix:t,u_opacity:o,u_faux_facade_ao_intensity:p,u_camera_pos:y,u_tile_to_meter:b,u_facade_emissive_chance:T,u_flood_light_color:I,u_flood_light_intensity:D}),ig=f=>({u_matrix:f}),Z_=f=>({u_matrix:f}),lf=(f,t,o,p,y,b,T,I)=>{const D=r.al/b.tileSize;return{u_matrix:f,u_inv_rot_matrix:t,u_camera_to_center_distance:o.getCameraToCenterDistance(I),u_extrude_scale:[o.pixelsToGLUnits[0]/D,o.pixelsToGLUnits[1]/D],u_zoom_transition:p,u_tile_id:T,u_merc_center:y}},ng=(f,t,o=1)=>({u_matrix:f,u_color:t,u_overlay:0,u_overlay_scale:o}),X_=r.bB(),hx=(f,t,o,p,y,b,T)=>{const I=f.transform,D=I.projection.name==="globe",F=D?r.dQ(I.zoom,t.canonical)*I._pixelsPerMercatorPixel:r.ay(o,1,b),z={u_matrix:t.projMatrix,u_extrude_scale:F,u_intensity:T,u_inv_rot_matrix:X_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){z.u_inv_rot_matrix=p,z.u_merc_center=y,z.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],z.u_zoom_transition=r.aj(I.zoom);const j=y[0]*r.al,B=y[1]*r.al;z.u_up_dir=I.projection.upVector(new r.cC(0,0,0),j,B)}return z};function rg(f,[t,o,p,y],[b,T]){if(b===T)return[0,0,0,0];const I=255*(f-1)/(f*(T-b));return[t*I,o*I,p*I,y*I]}function ku(f,t,[o,p]){return o===p?0:.5/f+(t-o)*(f-1)/(f*(p-o))}const ya=(f,t,o,p,y,b,T,I,D,F,z,j,B,$,Z,Q,ne,te,se,me,ce)=>({u_matrix:f,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:F,u_fade_t:z.mix,u_opacity:z.opacity*j.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:j.paint.get("raster-brightness-min"),u_brightness_high:j.paint.get("raster-brightness-max"),u_saturation_factor:r.dS(j.paint.get("raster-saturation")),u_contrast_factor:r.dR(j.paint.get("raster-contrast")),u_spin_weights:og(j.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:$,u_zoom_transition:T,u_merc_center:I,u_cutoff_params:D,u_colorization_mix:rg(r.dT,Q,te),u_colorization_offset:ku(r.dT,ne,te),u_color_ramp:Z,u_texture_offset:[me/(se+2*me),se/(se+2*me)],u_texture_res:[se+2*me,se+2*me],u_emissive_strength:ce});function og(f){f*=Math.PI/180;const t=Math.sin(f),o=Math.cos(f);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}const Gc=.05,Hc=(f,t,o,p,y,b,T,I,D,F,z,j)=>({u_matrix:f,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:F,u_fade_t:z.mix,u_opacity:z.opacity,u_image0:0,u_image1:1,u_raster_elevation:j,u_zoom_transition:T,u_merc_center:I,u_cutoff_params:D}),Fu=(f,t,o,p,y,b,T,I,D,F)=>({u_particle_texture:f,u_particle_texture_side_len:t,u_tile_offset:o,u_velocity:p,u_color_ramp:b,u_velocity_res:y,u_max_speed:T,u_uv_offset:I,u_data_scale:[255*D[0],255*D[1]],u_data_offset:F,u_particle_pos_scale:1.1,u_particle_pos_offset:[Gc,Gc]}),ag=(f,t,o,p,y,b,T,I,D,F)=>({u_particle_texture:f,u_particle_texture_side_len:t,u_velocity:o,u_velocity_res:p,u_max_speed:y,u_speed_factor:b,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*D[0],255*D[1]],u_data_offset:F,u_particle_pos_scale:1.1,u_particle_pos_offset:[Gc,Gc]}),Pp=r.bB(),Y_=(f,t,o,p,y,b,T,I,D,F,z,j,B,$,Z,Q,ne,te,se,me,ce,Ce,_e,Re)=>{const Ae=y.transform,Te={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Ae.getCameraToCenterDistance(se),u_rotate_symbol:+o,u_aspect_ratio:Ae.width/Ae.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:I,u_is_text:+F,u_elevation_from_sea:D?1:0,u_pitch_with_map:+p,u_texsize:z,u_texsize_icon:j,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Pp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Pp,u_up_vector:[0,-1,0],u_color_adj_mat:Ce,u_icon_transition:_e||0,u_gamma_scale:p?y.transform.getCameraToCenterDistance(se)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:r.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Re||1,u_ground_shadow_factor:me,u_inv_matrix:r.bk(r.bB(),T),u_normal_scale:ce,u_lutTexture:Sa.LUT};return se.name==="globe"&&(Te.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],Te.u_zoom_transition=Z,Te.u_inv_rot_matrix=ne,Te.u_merc_center=Q,Te.u_camera_forward=Ae._camera.forward(),Te.u_ecef_origin=r.dU(Ae.globeMatrix,$.toUnwrapped()),Te.u_tile_matrix=Float32Array.from(Ae.globeMatrix),Te.u_up_vector=te),Te},sg=(f,t,o,p)=>({u_matrix:f,u_emissive_strength:t,u_opacity:o,u_color:p}),Lu=(f,t,o,p,y,b,T,I,D)=>Object.assign(function(F,z,j,B,$,Z){const{width:Q,height:ne}=B.imageManager.getPixelSize(z),te=Math.pow(2,Z.tileID.overscaledZ),se=Z.tileSize*Math.pow(2,B.transform.tileZoom)/te,me=se*(Z.tileID.canonical.x+Z.tileID.wrap*te),ce=se*Z.tileID.canonical.y;return{u_image:0,u_pattern_tl:j.tl,u_pattern_br:j.br,u_texsize:[Q,ne],u_pattern_size:j.displaySize,u_pattern_units_to_pixels:$?[B.transform.width,-1*B.transform.height]:[1/r.ay(Z,1,B.transform.tileZoom),1/r.ay(Z,1,B.transform.tileZoom)],u_pixel_coord_upper:[me>>16,ce>>16],u_pixel_coord_lower:[65535&me,65535&ce]}}(0,b,T,p,I,D),{u_matrix:f,u_emissive_strength:t,u_opacity:o}),Qa=new Float32Array(r.bz([])),Wi=(f,t,o,p,y,b,T,I,D,F,z,j,B,$=[0,0,0],Z,Q,ne)=>{const te=y.style.light,se=te.properties.get("position"),me=[-se.x,-se.y,se.z],ce=r.dN();te.properties.get("anchor")==="viewport"&&(r.dO(ce,-y.transform.angle),r.dP(me,me,ce));const Ce=z.alphaMode==="MASK",_e=te.properties.get("color").toNonPremultipliedRenderColor(null),Re=B.paint.get("model-ambient-occlusion-intensity"),Ae=B.paint.get("model-color").constantOr(r.ao.white).toNonPremultipliedRenderColor(null);return Ae.a=B.paint.get("model-color-mix-intensity").constantOr(0),ne&&(Ae.r=ne[0],Ae.g=ne[1],Ae.b=ne[2],Ae.a=ne[3]),Q&&(Ae.r=Q.color.r,Ae.g=Q.color.g,Ae.b=Q.color.b,Ae.a=Q.colorMix,j=Q.emissionStrength,b=Q.opacity),{u_matrix:f,u_lighting_matrix:t,u_normal_matrix:o,u_node_matrix:p||Qa,u_lightpos:me,u_lightintensity:te.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_camera_pos:$,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+Ce,u_alphaCutoff:z.alphaCutoff,u_baseColorFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:I.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:D,u_roughnessFactor:F,u_baseColorTexture:Sa.BaseColor,u_metallicRoughnessTexture:Sa.MetallicRoughness,u_normalTexture:Sa.Normal,u_occlusionTexture:Sa.Occlusion,u_emissionTexture:Sa.Emission,u_lutTexture:Sa.LUT,u_color_mix:Ae.toArray01(),u_aoIntensity:Re,u_emissive_strength:j,u_occlusionTextureTransform:Z||[0,0,0,0]}},Fs=(f,t=Qa,o=Qa)=>({u_matrix:f,u_instance:t,u_node_matrix:o}),dc={fillExtrusion:f=>({u_matrix:new r.ck(f),u_lightpos:new r.ch(f),u_lightintensity:new r.ci(f),u_lightcolor:new r.ch(f),u_vertical_gradient:new r.ci(f),u_opacity:new r.ci(f),u_edge_radius:new r.ci(f),u_width_scale:new r.ci(f),u_ao:new r.cj(f),u_height_type:new r.cg(f),u_base_type:new r.cg(f),u_tile_id:new r.ch(f),u_zoom_transition:new r.ci(f),u_inv_rot_matrix:new r.ck(f),u_merc_center:new r.cj(f),u_up_dir:new r.ch(f),u_height_lift:new r.ci(f),u_flood_light_color:new r.ch(f),u_vertical_scale:new r.ci(f),u_flood_light_intensity:new r.ci(f),u_ground_shadow_factor:new r.ch(f)}),fillExtrusionDepth:f=>({u_matrix:new r.ck(f),u_edge_radius:new r.ci(f),u_width_scale:new r.ci(f),u_vertical_scale:new r.ci(f),u_height_type:new r.cg(f),u_base_type:new r.cg(f)}),fillExtrusionPattern:f=>({u_matrix:new r.ck(f),u_lightpos:new r.ch(f),u_lightintensity:new r.ci(f),u_lightcolor:new r.ch(f),u_vertical_gradient:new r.ci(f),u_height_factor:new r.ci(f),u_edge_radius:new r.ci(f),u_width_scale:new r.ci(f),u_ao:new r.cj(f),u_height_type:new r.cg(f),u_base_type:new r.cg(f),u_tile_id:new r.ch(f),u_zoom_transition:new r.ci(f),u_inv_rot_matrix:new r.ck(f),u_merc_center:new r.cj(f),u_up_dir:new r.ch(f),u_height_lift:new r.ci(f),u_image:new r.cg(f),u_texsize:new r.cj(f),u_pixel_coord_upper:new r.cj(f),u_pixel_coord_lower:new r.cj(f),u_tile_units_to_pixels:new r.ci(f),u_opacity:new r.ci(f),u_pattern_transition:new r.ci(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new r.ck(f),u_opacity:new r.ci(f),u_ao_pass:new r.ci(f),u_meter_to_tile:new r.ci(f),u_ao:new r.cj(f),u_flood_light_intensity:new r.ci(f),u_flood_light_color:new r.ch(f),u_attenuation:new r.ci(f),u_edge_radius:new r.ci(f),u_fb:new r.cg(f),u_fb_size:new r.ci(f),u_dynamic_offset:new r.ci(f)}),fill:f=>({u_matrix:new r.ck(f),u_emissive_strength:new r.ci(f),u_ground_shadow_factor:new r.ch(f)}),fillPattern:f=>({u_matrix:new r.ck(f),u_emissive_strength:new r.ci(f),u_image:new r.cg(f),u_texsize:new r.cj(f),u_pixel_coord_upper:new r.cj(f),u_pixel_coord_lower:new r.cj(f),u_tile_units_to_pixels:new r.ci(f),u_ground_shadow_factor:new r.ch(f),u_pattern_transition:new r.ci(f)}),fillOutline:f=>({u_matrix:new r.ck(f),u_emissive_strength:new r.ci(f),u_world:new r.cj(f),u_ground_shadow_factor:new r.ch(f)}),fillOutlinePattern:f=>({u_matrix:new r.ck(f),u_emissive_strength:new r.ci(f),u_world:new r.cj(f),u_image:new r.cg(f),u_texsize:new r.cj(f),u_pixel_coord_upper:new r.cj(f),u_pixel_coord_lower:new r.cj(f),u_tile_units_to_pixels:new r.ci(f),u_ground_shadow_factor:new r.ch(f),u_pattern_transition:new r.ci(f)}),building:f=>({u_matrix:new r.ck(f),u_normal_matrix:new r.ck(f),u_opacity:new r.ci(f),u_faux_facade_ao_intensity:new r.ci(f),u_camera_pos:new r.ch(f),u_tile_to_meter:new r.ci(f),u_facade_emissive_chance:new r.ci(f),u_flood_light_color:new r.ch(f),u_flood_light_intensity:new r.ci(f)}),buildingBloom:f=>({u_matrix:new r.ck(f)}),buildingDepth:f=>({u_matrix:new r.ck(f)}),elevatedStructuresDepth:f=>({u_matrix:new r.ck(f),u_depth_bias:new r.ci(f)}),elevatedStructures:f=>({u_matrix:new r.ck(f),u_ground_shadow_factor:new r.ch(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new r.ck(f),u_camera_pos:new r.ch(f),u_depth_bias:new r.ci(f),u_height_scale:new r.ci(f),u_reset_depth:new r.ci(f)}),circle:r.dX,collisionBox:f=>({u_matrix:new r.ck(f),u_inv_rot_matrix:new r.ck(f),u_camera_to_center_distance:new r.ci(f),u_extrude_scale:new r.cj(f),u_zoom_transition:new r.ci(f),u_merc_center:new r.cj(f),u_tile_id:new r.ch(f)}),collisionCircle:f=>({u_matrix:new r.ck(f),u_inv_matrix:new r.ck(f),u_camera_to_center_distance:new r.ci(f),u_viewport_size:new r.cj(f)}),debug:f=>({u_color:new r.dA(f),u_matrix:new r.ck(f),u_overlay:new r.cg(f),u_overlay_scale:new r.ci(f)}),clippingMask:f=>({u_matrix:new r.ck(f)}),heatmap:f=>({u_extrude_scale:new r.ci(f),u_intensity:new r.ci(f),u_matrix:new r.ck(f),u_inv_rot_matrix:new r.ck(f),u_merc_center:new r.cj(f),u_tile_id:new r.ch(f),u_zoom_transition:new r.ci(f),u_up_dir:new r.ch(f)}),heatmapTexture:f=>({u_image:new r.cg(f),u_color_ramp:new r.cg(f),u_opacity:new r.ci(f)}),hillshade:f=>({u_matrix:new r.ck(f),u_image:new r.cg(f),u_latrange:new r.cj(f),u_light:new r.cj(f),u_shadow:new r.dA(f),u_highlight:new r.dA(f),u_emissive_strength:new r.ci(f),u_accent:new r.dA(f)}),hillshadePrepare:f=>({u_matrix:new r.ck(f),u_image:new r.cg(f),u_dimension:new r.cj(f),u_zoom:new r.ci(f)}),line:r.dW,linePattern:r.dV,raster:f=>({u_matrix:new r.ck(f),u_normalize_matrix:new r.ck(f),u_globe_matrix:new r.ck(f),u_merc_matrix:new r.ck(f),u_grid_matrix:new r.dB(f),u_tl_parent:new r.cj(f),u_scale_parent:new r.ci(f),u_fade_t:new r.ci(f),u_opacity:new r.ci(f),u_image0:new r.cg(f),u_image1:new r.cg(f),u_brightness_low:new r.ci(f),u_brightness_high:new r.ci(f),u_saturation_factor:new r.ci(f),u_contrast_factor:new r.ci(f),u_spin_weights:new r.ch(f),u_perspective_transform:new r.cj(f),u_raster_elevation:new r.ci(f),u_zoom_transition:new r.ci(f),u_merc_center:new r.cj(f),u_cutoff_params:new r.d2(f),u_colorization_mix:new r.d2(f),u_colorization_offset:new r.ci(f),u_color_ramp:new r.cg(f),u_texture_offset:new r.cj(f),u_texture_res:new r.cj(f),u_emissive_strength:new r.ci(f)}),rasterParticle:f=>({u_matrix:new r.ck(f),u_normalize_matrix:new r.ck(f),u_globe_matrix:new r.ck(f),u_merc_matrix:new r.ck(f),u_grid_matrix:new r.dB(f),u_tl_parent:new r.cj(f),u_scale_parent:new r.ci(f),u_fade_t:new r.ci(f),u_opacity:new r.ci(f),u_image0:new r.cg(f),u_image1:new r.cg(f),u_raster_elevation:new r.ci(f),u_zoom_transition:new r.ci(f),u_merc_center:new r.cj(f),u_cutoff_params:new r.d2(f)}),rasterParticleTexture:f=>({u_texture:new r.cg(f),u_opacity:new r.ci(f)}),rasterParticleDraw:f=>({u_particle_texture:new r.cg(f),u_particle_texture_side_len:new r.ci(f),u_tile_offset:new r.cj(f),u_velocity:new r.cg(f),u_color_ramp:new r.cg(f),u_velocity_res:new r.cj(f),u_max_speed:new r.ci(f),u_uv_offset:new r.cj(f),u_data_scale:new r.cj(f),u_data_offset:new r.ci(f),u_particle_pos_scale:new r.ci(f),u_particle_pos_offset:new r.cj(f)}),rasterParticleUpdate:f=>({u_particle_texture:new r.cg(f),u_particle_texture_side_len:new r.ci(f),u_velocity:new r.cg(f),u_velocity_res:new r.cj(f),u_max_speed:new r.ci(f),u_speed_factor:new r.ci(f),u_reset_rate:new r.ci(f),u_rand_seed:new r.ci(f),u_uv_offset:new r.cj(f),u_data_scale:new r.cj(f),u_data_offset:new r.ci(f),u_particle_pos_scale:new r.ci(f),u_particle_pos_offset:new r.cj(f)}),symbol:f=>({u_is_size_zoom_constant:new r.cg(f),u_is_size_feature_constant:new r.cg(f),u_size_t:new r.ci(f),u_size:new r.ci(f),u_camera_to_center_distance:new r.ci(f),u_rotate_symbol:new r.cg(f),u_aspect_ratio:new r.ci(f),u_fade_change:new r.ci(f),u_matrix:new r.ck(f),u_label_plane_matrix:new r.ck(f),u_coord_matrix:new r.ck(f),u_is_text:new r.cg(f),u_elevation_from_sea:new r.cg(f),u_pitch_with_map:new r.cg(f),u_texsize:new r.cj(f),u_texsize_icon:new r.cj(f),u_texture:new r.cg(f),u_texture_icon:new r.cg(f),u_gamma_scale:new r.ci(f),u_device_pixel_ratio:new r.ci(f),u_tile_id:new r.ch(f),u_zoom_transition:new r.ci(f),u_inv_rot_matrix:new r.ck(f),u_merc_center:new r.cj(f),u_camera_forward:new r.ch(f),u_tile_matrix:new r.ck(f),u_up_vector:new r.ch(f),u_ecef_origin:new r.ch(f),u_is_halo:new r.cg(f),u_icon_transition:new r.ci(f),u_color_adj_mat:new r.ck(f),u_scale_factor:new r.ci(f),u_ground_shadow_factor:new r.ch(f),u_inv_matrix:new r.ck(f),u_normal_scale:new r.ci(f),u_lutTexture:new r.cg(f)}),background:f=>({u_matrix:new r.ck(f),u_emissive_strength:new r.ci(f),u_opacity:new r.ci(f),u_color:new r.dA(f)}),backgroundPattern:f=>({u_matrix:new r.ck(f),u_emissive_strength:new r.ci(f),u_opacity:new r.ci(f),u_image:new r.cg(f),u_pattern_tl:new r.cj(f),u_pattern_br:new r.cj(f),u_texsize:new r.cj(f),u_pattern_size:new r.cj(f),u_pixel_coord_upper:new r.cj(f),u_pixel_coord_lower:new r.cj(f),u_pattern_units_to_pixels:new r.cj(f)}),terrainRaster:f=>({u_matrix:new r.ck(f),u_image0:new r.cg(f),u_skirt_height:new r.ci(f),u_ground_shadow_factor:new r.ch(f)}),skybox:f=>({u_matrix:new r.ck(f),u_sun_direction:new r.ch(f),u_cubemap:new r.cg(f),u_opacity:new r.ci(f),u_temporal_offset:new r.ci(f)}),skyboxGradient:f=>({u_matrix:new r.ck(f),u_color_ramp:new r.cg(f),u_center_direction:new r.ch(f),u_radius:new r.ci(f),u_opacity:new r.ci(f),u_temporal_offset:new r.ci(f)}),skyboxCapture:f=>({u_matrix_3f:new r.dB(f),u_sun_direction:new r.ch(f),u_sun_intensity:new r.ci(f),u_color_tint_r:new r.d2(f),u_color_tint_m:new r.d2(f),u_luminance:new r.ci(f)}),globeRaster:f=>({u_proj_matrix:new r.ck(f),u_globe_matrix:new r.ck(f),u_normalize_matrix:new r.ck(f),u_merc_matrix:new r.ck(f),u_zoom_transition:new r.ci(f),u_merc_center:new r.cj(f),u_image0:new r.cg(f),u_grid_matrix:new r.dB(f),u_skirt_height:new r.ci(f),u_far_z_cutoff:new r.ci(f),u_frustum_tl:new r.ch(f),u_frustum_tr:new r.ch(f),u_frustum_br:new r.ch(f),u_frustum_bl:new r.ch(f),u_globe_pos:new r.ch(f),u_globe_radius:new r.ci(f),u_viewport:new r.cj(f)}),globeAtmosphere:f=>({u_frustum_tl:new r.ch(f),u_frustum_tr:new r.ch(f),u_frustum_br:new r.ch(f),u_frustum_bl:new r.ch(f),u_horizon:new r.ci(f),u_transition:new r.ci(f),u_fadeout_range:new r.ci(f),u_atmosphere_fog_color:new r.d2(f),u_high_color:new r.d2(f),u_space_color:new r.d2(f),u_temporal_offset:new r.ci(f),u_horizon_angle:new r.ci(f)}),model:f=>({u_matrix:new r.ck(f),u_lighting_matrix:new r.ck(f),u_normal_matrix:new r.ck(f),u_node_matrix:new r.ck(f),u_lightpos:new r.ch(f),u_lightintensity:new r.ci(f),u_lightcolor:new r.ch(f),u_camera_pos:new r.ch(f),u_opacity:new r.ci(f),u_baseColorFactor:new r.d2(f),u_emissiveFactor:new r.d2(f),u_metallicFactor:new r.ci(f),u_roughnessFactor:new r.ci(f),u_baseTextureIsAlpha:new r.cg(f),u_alphaMask:new r.cg(f),u_alphaCutoff:new r.ci(f),u_baseColorTexture:new r.cg(f),u_metallicRoughnessTexture:new r.cg(f),u_normalTexture:new r.cg(f),u_occlusionTexture:new r.cg(f),u_emissionTexture:new r.cg(f),u_lutTexture:new r.cg(f),u_color_mix:new r.d2(f),u_aoIntensity:new r.ci(f),u_emissive_strength:new r.ci(f),u_occlusionTextureTransform:new r.d2(f)}),modelDepth:f=>({u_matrix:new r.ck(f),u_instance:new r.ck(f),u_node_matrix:new r.ck(f)}),groundShadow:f=>({u_matrix:new r.ck(f),u_ground_shadow_factor:new r.ch(f)}),stars:f=>({u_matrix:new r.ck(f),u_up:new r.ch(f),u_right:new r.ch(f),u_intensity_multiplier:new r.ci(f)}),snowParticle:f=>({u_modelview:new r.ck(f),u_projection:new r.ck(f),u_time:new r.ci(f),u_cam_pos:new r.ch(f),u_velocityConeAperture:new r.ci(f),u_velocity:new r.ci(f),u_horizontalOscillationRadius:new r.ci(f),u_horizontalOscillationRate:new r.ci(f),u_boxSize:new r.ci(f),u_billboardSize:new r.ci(f),u_simpleShapeParameters:new r.cj(f),u_screenSize:new r.cj(f),u_thinningCenterPos:new r.cj(f),u_thinningShape:new r.ch(f),u_thinningAffectedRatio:new r.ci(f),u_thinningParticleOffset:new r.ci(f),u_particleColor:new r.d2(f),u_direction:new r.ch(f)}),rainParticle:f=>({u_modelview:new r.ck(f),u_projection:new r.ck(f),u_time:new r.ci(f),u_cam_pos:new r.ch(f),u_texScreen:new r.cg(f),u_velocityConeAperture:new r.ci(f),u_velocity:new r.ci(f),u_boxSize:new r.ci(f),u_rainDropletSize:new r.cj(f),u_distortionStrength:new r.ci(f),u_rainDirection:new r.ch(f),u_color:new r.d2(f),u_screenSize:new r.cj(f),u_thinningCenterPos:new r.cj(f),u_thinningShape:new r.ch(f),u_thinningAffectedRatio:new r.ci(f),u_thinningParticleOffset:new r.ci(f),u_shapeDirectionalPower:new r.ci(f),u_shapeNormalPower:new r.ci(f),u_mode:new r.ci(f)}),vignette:f=>({u_vignetteShape:new r.ch(f),u_vignetteColor:new r.d2(f)}),occlusion:f=>({u_matrix:new r.ck(f),u_anchorPos:new r.ch(f),u_screenSizePx:new r.cj(f),u_occluderSizePx:new r.cj(f),u_color:new r.d2(f)})};class bh{constructor(t,o,p,y){this.id=bh.uniqueIdxCounter,bh.uniqueIdxCounter++,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||y||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=bh.uniqueIdxCounter,bh.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}bh.uniqueIdxCounter=0;const dx={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Hb{constructor(t,o,p,y,b,T){this.length=o.length,this.attributes=p,this.itemSize=o.bytesPerElement,this.dynamicDraw=y,this.instanceCount=T,this.context=t;const I=t.gl;this.buffer=I.createBuffer(),t.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||b||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let p=0;p<this.attributes.length;p++){const y=o.getAttributeLocation(t,this.attributes[p].name);y!==-1&&t.enableVertexAttribArray(y)}}setVertexAttribPointers(t,o,p){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],T=o.getAttributeLocation(t,b.name);T!==-1&&t.vertexAttribPointer(T,b.components,t[dx[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(t,o,p){for(let y=0;y<this.attributes.length;y++){const b=o.getAttributeLocation(t,this.attributes[y].name);b!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(b,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class lg{constructor(t,o,p,y,b){this.context=t,this.width=o,this.height=p;const T=this.framebuffer=t.gl.createFramebuffer();y&&(this.colorAttachment=new no(t,T)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new _h(t,T):new Ip(t,T))}destroy(){const t=this.context.gl;if(this.colorAttachment){const o=this.colorAttachment.get();o&&t.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&t.deleteTexture(o)}t.deleteFramebuffer(this.framebuffer)}}class cg{constructor(t,o){this.gl=t,this.clearColor=new H_(this),this.clearDepth=new qm(this),this.clearStencil=new rx(this),this.colorMask=new $_(this),this.depthMask=new Vb(this),this.stencilMask=new ox(this),this.stencilFunc=new ax(this),this.stencilOp=new Ub(this),this.stencilTest=new Zm(this),this.depthRange=new Sp(this),this.depthTest=new Xm(this),this.depthFunc=new md(this),this.blend=new Ep(this),this.blendFunc=new Ym(this),this.blendColor=new Du(this),this.blendEquation=new tf(this),this.cullFace=new zc(this),this.cullFaceSide=new Mu(this),this.frontFace=new Ap(this),this.program=new Cp(this),this.activeTexture=new sx(this),this.viewport=new gh(this),this.bindFramebuffer=new Km(this),this.bindRenderbuffer=new Jm(this),this.bindTexture=new W_(this),this.bindVertexBuffer=new nf(this),this.bindElementBuffer=new Nc(this),this.bindVertexArrayOES=new lx(this),this.pixelStoreUnpack=new cx(this),this.pixelStoreUnpackPremultiplyAlpha=new On(this),this.pixelStoreUnpackFlipY=new uc(this),this.options=o?Object.assign({},o):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=o&&!!o.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o,p){return new bh(this,t,o,p)}createVertexBuffer(t,o,p,y,b){return new Hb(this,t,o,p,y,b)}createRenderbuffer(t,o,p){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,t,o,p),this.bindRenderbuffer.set(null),b}createFramebuffer(t,o,p,y){return new lg(this,t,o,p,y)}clear({color:t,depth:o,stencil:p,colorMask:y}){const b=this.gl;let T=0;t&&(T|=b.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(y||[!0,!0,!0,!0])),o!==void 0&&(T|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),p!==void 0&&(T|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),b.clear(T)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r.bx(t.blendFunction,sn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ho;function Op(f,t,o,p,y,b,T){const I=f.context,D=I.gl,F=f.transform,z=[r.aF(F.center.lng),r.aJ(F.center.lat)],j=o.layout.get("symbol-placement"),B=o.layout.get("text-variable-anchor"),$=o.layout.get("icon-rotation-alignment")==="map",Z=o.layout.get("text-rotation-alignment")==="map",Q=j!=="point",ne=[];let te=0,se=0;for(let Te=0;Te<p.length;Te++){const De=p[Te],He=t.getTile(De),Ue=He.getBucket(o);if(!Ue)continue;const rt=Ue.getProjection().createInversionMatrix(F,De.canonical),Qe=[],lt=dp(De,Ue,F),Lt=!T&&$&&Q,Xe=T&&Z&&Q,Ne=B&&Ue.hasTextData(),ct=Ue.hasIconTextFit()&&Ne&&Ue.hasIconData(),et=Lt||Xe||T&&Ne||ct,At=Ue.projection.name==="globe",jt=At?r.aj(F.zoom):0;At&&(Qe.push("PROJECTION_GLOBE_VIEW"),et&&Qe.push("PROJECTED_POS_ON_VIEWPORT"));const pi=f.getOrCreateProgram("collisionBox",{defines:Qe});let Ft=lt;y[0]===0&&y[1]===0||(Ft=f.translatePosMatrix(lt,He,y,b));const zt=T?Ue.textCollisionBox:Ue.iconCollisionBox,mi=Ue.collisionCircleArray;if(mi.length>0){const ii=r.bB(),ri=Ft;r.cO(ii,Ue.placementInvProjMatrix,F.glCoordMatrix),r.cO(ii,ii,Ue.placementViewportMatrix),ne.push({circleArray:mi,circleOffset:se,transform:ri,invTransform:ii,projection:Ue.getProjection()}),te+=mi.length/4,se=te}if(!zt)continue;f.terrain&&f.terrain.setupElevationDraw(He,pi);const ni=At?[De.canonical.x,De.canonical.y,1<<De.canonical.z]:[0,0,0];pi.draw(f,D.LINES,_i.disabled,Gi.disabled,f.colorModeForRenderPass(),Vi.disabled,lf(Ft,rt,F,jt,z,He,ni,Ue.getProjection()),o.id,zt.layoutVertexBuffer,zt.indexBuffer,zt.segments,null,F.zoom,null,[zt.collisionVertexBuffer,zt.collisionVertexBufferExt])}if(!T||!ne.length)return;const me=f.getOrCreateProgram("collisionCircle"),ce=new r.dY;ce.resize(4*te),ce._trim();let Ce=0;for(const Te of ne)for(let De=0;De<Te.circleArray.length/4;De++){const He=4*De,Ue=Te.circleArray[He+0],rt=Te.circleArray[He+1],Qe=Te.circleArray[He+2],lt=Te.circleArray[He+3];ce.emplace(Ce++,Ue,rt,Qe,lt,0),ce.emplace(Ce++,Ue,rt,Qe,lt,1),ce.emplace(Ce++,Ue,rt,Qe,lt,2),ce.emplace(Ce++,Ue,rt,Qe,lt,3)}(!Ho||Ho.length<2*te)&&(Ho=function(Te){const De=2*Te,He=new r.b0;He.resize(De),He._trim();for(let Ue=0;Ue<De;Ue++){const rt=6*Ue;He.uint16[rt+0]=4*Ue+0,He.uint16[rt+1]=4*Ue+1,He.uint16[rt+2]=4*Ue+2,He.uint16[rt+3]=4*Ue+2,He.uint16[rt+4]=4*Ue+3,He.uint16[rt+5]=4*Ue+0}return He}(te));const _e=I.createIndexBuffer(Ho,!0),Re=I.createVertexBuffer(ce,r.dZ.members,!0);for(const Te of ne){const De={u_matrix:Te.transform,u_inv_matrix:Te.invTransform,u_camera_to_center_distance:(Ae=F).getCameraToCenterDistance(Te.projection),u_viewport_size:[Ae.width,Ae.height]};me.draw(f,D.TRIANGLES,_i.disabled,Gi.disabled,f.colorModeForRenderPass(),Vi.disabled,De,o.id,Re,_e,r.bf.simpleSegment(0,2*Te.circleOffset,Te.circleArray.length,Te.circleArray.length/2),null,F.zoom)}var Ae;Re.destroy(),_e.destroy()}const wh=r.bB();function K_(f){const t=f._camera.getWorldToCamera(f.worldSize,1),o=r.aB([],t,f.globeMatrix);r.bk(o,o);const p=[0,0,0],y=[0,1,0,0];return r.aC(y,y,o),p[0]=y[0],p[1]=y[1],p[2]=y[2],r.aw(p,p),p}function kp({width:f,height:t,anchor:o,textOffset:p,textScale:y},b){const{horizontalAlign:T,verticalAlign:I}=r.c0(o),D=-(T-.5)*f,F=-(I-.5)*t,z=r.c1(o,p);return new r.P((D/y+z[0])*b,(F/y+z[1])*b)}function Th(f,t,o,p,y,b,T,I,D,F){const z=f.text.placedSymbolArray,j=f.text.dynamicLayoutVertexArray,B=f.icon.dynamicLayoutVertexArray,$={},Z=f.getProjection(),Q=uh(T,Z,y),ne=y.elevation,te=Z.upVectorScale(T.canonical,y.center.lat,y.worldSize).metersToTile;j.clear();for(let se=0;se<z.length;se++){const me=z.get(se),{tileAnchorX:ce,tileAnchorY:Ce,numGlyphs:_e}=me,Re=me.hidden||!me.crossTileID||f.allowVerticalPlacement&&!me.placedOrientation?null:p[me.crossTileID];if(Re){let Ae=0,Te=0,De=0;const He=f.elevationType==="road";if(ne||He){const et=He?f.getElevationFeatureForText(se):null,At=r.bU.getAtTileOffset(T,new r.P(ce,Ce),ne,et),[jt,pi,Ft]=Z.upVector(T.canonical,ce,Ce);Ae=At*jt*te,Te=At*pi*te,De=At*Ft*te}let[Ue,rt,Qe,lt]=ki(me.projectedAnchorX+Ae,me.projectedAnchorY+Te,me.projectedAnchorZ+De,o?Q:b);const Lt=Zn(y.getCameraToCenterDistance(Z),lt);let Xe=r.bL(f.textSizeData,D,me)*Lt/r.bX;o&&(Xe*=f.tilePixelRatio/I);const Ne=kp(Re,Xe);o?({x:Ue,y:rt,z:Qe}=Z.projectTilePoint(ce+Ne.x,Ce+Ne.y,T.canonical),[Ue,rt,Qe]=ki(Ue+Ae,rt+Te,Qe+De,b)):(t&&Ne._rotate(-y.angle),Ue+=Ne.x,rt+=Ne.y,Qe=0);const ct=f.allowVerticalPlacement&&me.placedOrientation===r.bK.vertical?Math.PI/2:0;for(let et=0;et<_e;et++)r.bN(j,Ue,rt,Qe,ct);F&&me.associatedIconIndex>=0&&($[me.associatedIconIndex]={x:Ue,y:rt,z:Qe,angle:ct})}else vl(_e,j)}if(F){B.clear();const se=f.icon.placedSymbolArray;for(let me=0;me<se.length;me++){const ce=se.get(me),{numGlyphs:Ce}=ce,_e=$[me];if(ce.hidden||!_e)vl(Ce,B);else{const{x:Re,y:Ae,z:Te,angle:De}=_e;for(let He=0;He<Ce;He++)r.bN(B,Re,Ae,Te,De)}}f.icon.dynamicLayoutVertexBuffer.updateData(B)}f.text.dynamicLayoutVertexBuffer.updateData(j)}function $c(f,t,o,p,y,b,T={}){const I=o.paint.get("icon-translate"),D=o.paint.get("text-translate"),F=o.paint.get("icon-translate-anchor"),z=o.paint.get("text-translate-anchor"),j=o.layout.get("icon-rotation-alignment"),B=o.layout.get("text-rotation-alignment"),$=o.layout.get("icon-pitch-alignment"),Z=o.layout.get("text-pitch-alignment"),Q=o.layout.get("icon-keep-upright"),ne=o.layout.get("text-keep-upright"),te=o.paint.get("icon-color-saturation"),se=o.paint.get("icon-color-contrast"),me=o.paint.get("icon-color-brightness-min"),ce=o.paint.get("icon-color-brightness-max"),Ce=o.layout.get("symbol-elevation-reference")==="sea",_e=o.layout.get("icon-image-use-theme")==="none",Re=f.context,Ae=Re.gl,Te=f.transform,De=j==="map",He=B==="map",Ue=$==="map",rt=Z==="map",Qe=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let lt=!1;const Lt=f.depthModeForSublayer(0,_i.ReadOnly),Xe=new _i(f.context.gl.LEQUAL,_i.ReadOnly,f.depthRangeFor3D),Ne=[r.aF(Te.center.lng),r.aJ(Te.center.lat)],ct=o.layout.get("text-variable-anchor"),et=Te.projection.name==="globe",At=[],jt=[0,-1,0];for(const pi of p){const Ft=t.getTile(pi),zt=Ft.getBucket(o);if(!zt||zt.projection.name==="mercator"&&et||zt.fullyClipped)continue;const mi=zt.projection.name==="globe",ni=mi?r.aj(Te.zoom):0,ii=uh(pi,zt.getProjection(),Te),ri=Te.calculatePixelsToTileUnitsMatrix(Ft),Oi=ct&&zt.hasTextData(),wn=zt.hasIconTextFit()&&Oi&&zt.hasIconData(),In=zt.getProjection().createInversionMatrix(Te,pi.canonical),vr=(1<<Ft.tileID.canonical.z)*r.al/f.transform.worldSize,Ui=Kn=>{let Bi=[0,0,0];if(Kn){const Bn=f.style.directionalLight,Yr=f.style.ambientLight;Bn&&Yr&&(Bi=xl(f.style,Bn,Yr))}return Bi},Dn=Kn=>{Te.depthOcclusionForSymbolsAndCircles&&(o.hasOcclusionOpacityProperties||f.terrain)&&(Kn.push("DEPTH_D24"),Kn.push("DEPTH_OCCLUSION"))},tn=Kn=>{o.lut&&!_e&&(o.lut.texture||(o.lut.texture=new r.d_(f.context,o.lut.image,[o.lut.image.height,o.lut.image.height,o.lut.image.height],Re.gl.RGBA8)),Re.activeTexture.set(Re.gl.TEXTURE0+Sa.LUT),o.lut.texture&&o.lut.texture.bind(Re.gl.LINEAR,Re.gl.CLAMP_TO_EDGE),Kn.push("APPLY_LUT_ON_GPU"))},mr=()=>{const Kn=De&&o.layout.get("symbol-placement")!=="point",Bi=[];Dn(Bi),tn(Bi);const Bn=Kn||wn,Yr=zt.elevationType==="road",Eo=f.shadowRenderer,Qr=Yr&&Ue&&!!Eo&&Eo.enabled,xo=Ui(Qr),As=Yr&&Ue&&!f.terrain?Xe:Lt,Cs=o.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&Ue&&Bi.push("PITCH_WITH_MAP_TERRAIN"),mi&&(Bi.push("PROJECTION_GLOBE_VIEW"),Bn&&Bi.push("PROJECTED_POS_ON_VIEWPORT")),Cs>0&&zt.hasAnySecondaryIcon&&Bi.push("ICON_TRANSITION"),!zt.icon.zOffsetVertexBuffer||Yr&&f.terrain||Bi.push("Z_OFFSET"),te===0&&se===0&&me===0&&ce===1||Bi.push("COLOR_ADJUSTMENT"),zt.sdfIcons&&Bi.push("RENDER_SDF"),Qr&&Bi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Yr&&Ue&&!f.terrain&&zt.icon.orientationVertexBuffer&&Bi.push("ELEVATED_ROADS");const Za=zt.icon.programConfigurations.get(o.id),es=f.getOrCreateProgram("symbol",{config:Za,defines:Bi}),nl=Ft.imageAtlasTexture?Ft.imageAtlasTexture.size:[0,0],Fa=zt.iconSizeData,rl=r.bJ(Fa,Te.zoom),fs=Ue||!Te.isOrthographic,Ca=Jt(ii,Ft.tileID.canonical,Ue,De,Te,zt.getProjection(),ri),mo=vn(ii,Ft.tileID.canonical,Ue,De,Te,zt.getProjection(),ri),Mo=f.translatePosMatrix(mo,Ft,I,F,!0),Tr=f.translatePosMatrix(ii,Ft,I,F),Bo=Bn?wh:Ca,Ia=De&&!Ue&&!Kn;let ao=jt;!et&&!Te.mercatorFromTransition||De||(ao=K_(Te));const El=mi?ao:jt,Sf=o.getColorAdjustmentMatrix(te,se,me,ce),Zc=Y_(Fa.kind,rl,Ia,Ue,f,Tr,Bo,Mo,Ce,!1,nl,[0,0],0,pi,ni,Ne,In,El,zt.getProjection(),xo,vr,Sf,Cs,null),Xc=Ft.imageAtlasTexture?Ft.imageAtlasTexture:null,Yc=o.layout.get("icon-size").constantOr(0)!==1||zt.iconsNeedLinear,Al=zt.sdfIcons||f.options.rotating||f.options.zooming||Yc||fs?Ae.LINEAR:Ae.NEAREST,Kc=zt.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,va=f.terrain&&Ue&&Kn?r.bk(r.bB(),Ca):wh;if(Kn&&zt.icon){const Is=r.bU.getAtTileOffsetFunc(pi,Te.center.lat,Te.worldSize,zt.getProjection()),Ad=Mi(ii,Ft.tileID.canonical,Ue,De,Te,zt.getProjection(),ri),yy=o.layout.get("icon-size-scale-range"),Cg=r.aA(f.scaleFactor,yy[0],yy[1]);po(zt,ii,f,!1,Ad,mo,Ue,Q,Is,pi,Cg)}return{program:es,buffers:zt.icon,uniformValues:Zc,atlasTexture:Xc,atlasTextureIcon:null,atlasInterpolation:Al,atlasInterpolationIcon:null,isSDF:zt.sdfIcons,hasHalo:Kc,depthMode:As,tile:Ft,renderWithShadows:Qr,labelPlaneMatrixInv:va}},kn=()=>{const Kn=He&&o.layout.get("symbol-placement")!=="point",Bi=[],Bn=Kn||ct||wn,Yr=zt.elevationType==="road",Eo=f.shadowRenderer,Qr=Yr&&rt&&!!Eo&&Eo.enabled,xo=Ui(Qr),As=Yr&&rt&&!f.terrain?Xe:Lt;f.terrainRenderModeElevated()&&rt&&Bi.push("PITCH_WITH_MAP_TERRAIN"),mi&&(Bi.push("PROJECTION_GLOBE_VIEW"),Bn&&Bi.push("PROJECTED_POS_ON_VIEWPORT")),!zt.text.zOffsetVertexBuffer||Yr&&f.terrain||Bi.push("Z_OFFSET"),zt.iconsInText&&Bi.push("RENDER_TEXT_AND_SYMBOL"),Bi.push("RENDER_SDF"),Qr&&Bi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Yr&&rt&&!f.terrain&&zt.text.orientationVertexBuffer&&Bi.push("ELEVATED_ROADS"),Dn(Bi);const Cs=zt.text.programConfigurations.get(o.id),Za=f.getOrCreateProgram("symbol",{config:Cs,defines:Bi});let es,nl=[0,0],Fa=null;const rl=zt.textSizeData;zt.iconsInText&&(nl=Ft.imageAtlasTexture?Ft.imageAtlasTexture.size:[0,0],Fa=Ft.imageAtlasTexture?Ft.imageAtlasTexture:null,es=rt||!Te.isOrthographic||f.options.rotating||f.options.zooming||rl.kind==="composite"||rl.kind==="camera"?Ae.LINEAR:Ae.NEAREST);const fs=Ft.glyphAtlasTexture?Ft.glyphAtlasTexture.size:[0,0],Ca=o.layout.get("text-size-scale-range"),mo=r.aA(f.scaleFactor,Ca[0],Ca[1]),Mo=r.bJ(rl,Te.zoom,mo),Tr=Jt(ii,Ft.tileID.canonical,rt,He,Te,zt.getProjection(),ri),Bo=vn(ii,Ft.tileID.canonical,rt,He,Te,zt.getProjection(),ri),Ia=f.translatePosMatrix(Bo,Ft,D,z,!0),ao=f.translatePosMatrix(ii,Ft,D,z),El=Bn?wh:Tr,Sf=He&&!rt&&!Kn;let Zc=jt;!et&&!Te.mercatorFromTransition||He||(Zc=K_(Te));const Xc=Y_(rl.kind,Mo,Sf,rt,f,ao,El,Ia,Ce,!0,fs,nl,0,pi,ni,Ne,In,mi?Zc:jt,zt.getProjection(),xo,vr,null,null,mo),Yc=Ft.glyphAtlasTexture?Ft.glyphAtlasTexture:null,Al=Ae.LINEAR,Kc=o.paint.get("text-halo-width").constantOr(1)!==0,va=f.terrain&&rt&&Kn?r.bk(r.bB(),Tr):wh;if(Kn&&zt.text){const Is=r.bU.getAtTileOffsetFunc(pi,Te.center.lat,Te.worldSize,zt.getProjection()),Ad=Mi(ii,Ft.tileID.canonical,rt,He,Te,zt.getProjection(),ri);po(zt,ii,f,!0,Ad,Bo,rt,ne,Is,pi,mo)}return{program:Za,buffers:zt.text,uniformValues:Xc,atlasTexture:Yc,atlasTextureIcon:Fa,atlasInterpolation:Al,atlasInterpolationIcon:es,isSDF:!0,hasHalo:Kc,depthMode:As,tile:Ft,renderWithShadows:Qr,labelPlaneMatrixInv:va}},Cr=zt.icon.segments.get().length,Hn=zt.text.segments.get().length,ln=Cr&&!T.onlyText?mr():null,rr=Hn&&!T.onlyIcons?kn():null,dn=o.paint.get("icon-opacity").constantOr(1),zr=o.paint.get("text-opacity").constantOr(1);if(Qe&&zt.canOverlap){lt=!0;const Kn=dn&&!T.onlyText?zt.icon.segments.get():[],Bi=zr&&!T.onlyIcons?zt.text.segments.get():[];for(const Bn of Kn)At.push({segments:new r.bf([Bn]),sortKey:Bn.sortKey,state:ln});for(const Bn of Bi)At.push({segments:new r.bf([Bn]),sortKey:Bn.sortKey,state:rr})}else T.onlyText||At.push({segments:dn?zt.icon.segments:new r.bf([]),sortKey:0,state:ln}),T.onlyIcons||At.push({segments:zr?zt.text.segments:new r.bf([]),sortKey:0,state:rr})}lt&&At.sort((pi,Ft)=>pi.sortKey-Ft.sortKey);for(const pi of At){const Ft=pi.state;if(Ft)if(f.terrain?f.terrain.setupElevationDraw(Ft.tile,Ft.program,{useDepthForOcclusion:Te.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ft.labelPlaneMatrixInv}):f.setupDepthForOcclusion(Te.depthOcclusionForSymbolsAndCircles,Ft.program),Re.activeTexture.set(Ae.TEXTURE0),Ft.atlasTexture&&Ft.atlasTexture.bind(Ft.atlasInterpolation,Ae.CLAMP_TO_EDGE,!0),Ft.atlasTextureIcon&&(Re.activeTexture.set(Ae.TEXTURE1),Ft.atlasTextureIcon&&Ft.atlasTextureIcon.bind(Ft.atlasInterpolationIcon,Ae.CLAMP_TO_EDGE,!0)),Ft.renderWithShadows&&f.shadowRenderer.setupShadows(Ft.tile.tileID.toUnwrapped(),Ft.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,Ft.program),Ft.hasHalo){const zt=Ft.uniformValues;zt.u_is_halo=1,ug(Ft.buffers,pi.segments,o,f,Ft.program,Ft.depthMode,y,b,zt,2),zt.u_is_halo=0}else{if(Ft.isSDF){const zt=Ft.uniformValues;Ft.hasHalo&&(zt.u_is_halo=1,ug(Ft.buffers,pi.segments,o,f,Ft.program,Ft.depthMode,y,b,zt,1)),zt.u_is_halo=0}ug(Ft.buffers,pi.segments,o,f,Ft.program,Ft.depthMode,y,b,Ft.uniformValues,1)}}}function ug(f,t,o,p,y,b,T,I,D,F){const z=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];y.draw(p,p.context.gl.TRIANGLES,b,T,I,Vi.disabled,D,o.id,f.layoutVertexBuffer,f.indexBuffer,t,o.paint,p.transform.zoom,f.programConfigurations.get(o.id),z,F)}function fx(f,t){const o=1<<f.canonical.z,p=(t.x*o-f.canonical.x-f.wrap*o)*r.al,y=(t.y*o-f.canonical.y)*r.al,b=r.e7(t.z,t.y);return r.d4(p,y,b)}function yd(f,t,o,p,y){if(!o.layout||o.layout.get("fill-elevation-reference")==="none"||o.paint.get("fill-opacity").constantOr(1)===0)return;const b=f.context.gl,T=new _i(f.context.gl.LEQUAL,_i.ReadWrite,f.depthRangeFor3D),I=new _i(f.context.gl.GREATER,_i.ReadWrite,f.depthRangeFor3D),D=function($){let Z=.01;return $.isOrthographic&&(Z=r.ak(1e-4,Z,r.c$($.pitch>=fd?1:$.pitch/fd))),2*Z}(f.transform),F=f.transform.getFreeCameraOptions().position,z="elevatedStructuresDepthReconstruct",j=f.getOrCreateProgram(z,{defines:["DEPTH_RECONSTRUCTION"]}),B=f.getOrCreateProgram(z);for(const $ of p){const Z=t.getTile($),Q=Z.getBucket(o);if(!Q)continue;const ne=Q.elevatedStructures;if(!ne)continue;const te=Q.elevationBufferData.heightRange,se=fx($.toUnwrapped(),F),me=f.translatePosMatrix($.projMatrix,Z,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));let ce,Ce,_e,Re;if(y==="initialize"){if(!te||te.min>=1||ne.depthSegments.segments[0].primitiveLength===0)continue;ce=Mp(me,se,D,1,0),Ce=T,_e=ne.depthSegments,Re=j}else if(y==="reset"){if(!te||te.min>=0||ne.maskSegments.segments[0].primitiveLength===0)continue;ce=Mp(me,se,0,0,1),Ce=I,_e=ne.maskSegments,Re=j}else if(y==="geometry"){if(ne.depthSegments.segments[0].primitiveLength===0)continue;ce=Mp(me,se,D,1,0),Ce=T,_e=ne.depthSegments,Re=B}Re.draw(f,b.TRIANGLES,Ce,Gi.disabled,sn.disabled,Vi.disabled,ce,o.id,ne.vertexBuffer,ne.indexBuffer,_e,o.paint,f.transform.zoom)}}function cf(f,t,o){const{painter:p,sourceCache:y,layer:b,coords:T,colorMode:I,elevationType:D,terrainEnabled:F,pass:z}=f,j=p.context.gl,B=b.paint.get("fill-pattern"),$=b.paint.get("fill-pattern-cross-fade"),Z=B.constantOr(null);let Q=D;D!=="road"||t&&!F||(Q="none");const ne=Q==="road",te=f.painter.shadowRenderer,se=ne&&!!te&&te.enabled,me=new _i(p.context.gl.LEQUAL,_i.ReadOnly,p.depthRangeFor3D);let ce=[0,0,0];if(se){const Re=p.style.directionalLight,Ae=p.style.ambientLight;Re&&Ae&&(ce=xl(p.style,Re,Ae))}const Ce=B&&B.constantOr(1),_e=(Re,Ae)=>{let Te,De,He,Ue,rt;Ae?(Te=Ce&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",He=j.LINES):(Te=Ce?"fillPattern":"fill",He=j.TRIANGLES);for(const Qe of T){const lt=y.getTile(Qe);if(Ce&&!lt.patternsLoaded())continue;const Lt=lt.getBucket(b);if(!Lt)continue;const Xe=t?Lt.elevationBufferData:Lt.bufferData;if(Xe.isEmpty())continue;p.prepareDrawTile();const Ne=Xe.programConfigurations.get(b.id),ct=p.isTileAffectedByFog(Qe),et=[],At=[];ne&&(et.push("ELEVATED_ROADS"),At.push(Xe.elevatedLayoutVertexBuffer)),se&&et.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ce&&(p.context.activeTexture.set(j.TEXTURE0),lt.imageAtlasTexture&&lt.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Ne.updatePaintBuffers());let jt=!1;if(Z&&lt.imageAtlas){const ni=lt.imageAtlas,ii=r.e2.from(Z),ri=ii.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),Oi=ii.getSecondary(),wn=ni.patternPositions.get(ri),In=Oi?ni.patternPositions.get(Oi.scaleSelf(r.o.devicePixelRatio).toString()):null;jt=!!wn&&!!In,wn&&Ne.setConstantPatternPositions(wn,In)}$>0&&(jt||Ne.getPatternTransitionVertexBuffer("fill-pattern"))&&et.push("FILL_PATTERN_TRANSITION");const pi=p.getOrCreateProgram(Te,{config:Ne,overrideFog:ct,defines:et}),Ft=p.translatePosMatrix(Qe.projMatrix,lt,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor"));se&&te.setupShadows(lt.tileID.toUnwrapped(),pi,"vector-tile");const zt=b.paint.get("fill-emissive-strength");if(Ae){Ue=Xe.lineIndexBuffer,rt=Xe.lineSegments;const ni=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[j.drawingBufferWidth,j.drawingBufferHeight];De=Te==="fillOutlinePattern"&&Ce?jb(Ft,zt,p,lt,ni,ce,$):ux(Ft,zt,ni,ce)}else Ue=Xe.indexBuffer,rt=Xe.triangleSegments,De=Ce?q_(Ft,zt,p,lt,ce,$):xh(Ft,zt,ce);p.uploadCommonUniforms(p.context,pi,Qe.toUnwrapped());let mi=Re;(D==="road"&&!F||D==="offset")&&(mi=me),pi.draw(p,He,mi,o||p.stencilModeForClipping(Qe),I,Vi.disabled,De,b.id,Xe.layoutVertexBuffer,Ue,rt,b.paint,p.transform.zoom,Ne,At)}};p.renderPass===z&&_e(p.depthModeForSublayer(1,p.renderPass==="opaque"?_i.ReadWrite:_i.ReadOnly),!1),Q==="none"&&p.renderPass==="translucent"&&b.paint.get("fill-antialias")&&_e(p.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,_i.ReadOnly),!0)}function li(f,t,o,p,y,b,T,I){o.resetLayerRenderingStats(f);const D=f.context,F=D.gl,z=f.transform,j=o.paint.get("fill-extrusion-pattern"),B=o.paint.get("fill-extrusion-pattern-cross-fade"),$=j.constantOr(null),Z=j.constantOr(1),Q=o.paint.get("fill-extrusion-opacity"),ne=f.style.enable3dLights(),te=o.paint.get(ne&&!Z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),se=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),te],me=o.layout.get("fill-extrusion-edge-radius"),ce=me>0&&!o.paint.get("fill-extrusion-rounded-roof"),Ce=ce?0:me,_e=z.projection.name==="globe"?r.ea():0,Re=z.projection.name==="globe",Ae=Re?r.aj(z.zoom):0,Te=[r.aF(z.center.lng),r.aJ(z.center.lat)],De=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",He=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(De?null:o.lut).toArray01().slice(0,3),Ue=o.paint.get("fill-extrusion-flood-light-intensity"),rt=o.paint.get("fill-extrusion-vertical-scale"),Qe=o.paint.get("fill-extrusion-line-width").constantOr(1)!==0,lt=o.paint.get("fill-extrusion-height-alignment"),Lt=o.paint.get("fill-extrusion-base-alignment"),Xe=Au(f,o.paint.get("fill-extrusion-cutoff-fade-range")),Ne=[];let ct;Re&&Ne.push("PROJECTION_GLOBE_VIEW"),se[0]>0&&Ne.push("FAUX_AO"),ce&&Ne.push("ZERO_ROOF_RADIUS"),I&&Ne.push("HAS_CENTROID"),Ue>0&&Ne.push("FLOOD_LIGHT"),Xe.shouldRenderCutoff&&Ne.push("RENDER_CUTOFF"),Qe&&Ne.push("RENDER_WALL_MODE");const et=f.renderPass==="shadow",At=f.shadowRenderer,jt=et&&!!At,pi=et?Vi.disabled:Vi.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Ft=[0,0,0];if(At){const ni=f.style.directionalLight,ii=f.style.ambientLight;ni&&ii&&(Ft=xl(f.style,ni,ii)),et||(Ne.push("RENDER_SHADOWS","DEPTH_TEXTURE"),At.useNormalOffset&&Ne.push("NORMAL_OFFSET")),ct=Ne.concat(["SHADOWS_SINGLE_CASCADE"])}const zt=jt?"fillExtrusionDepth":Z?"fillExtrusionPattern":"fillExtrusion",mi=o.getLayerRenderingStats();for(const ni of p){const ii=t.getTile(ni),ri=ii.getBucket(o);if(!ri||ri.projection.name!==z.projection.name)continue;let Oi=!1;At&&(Oi=At.getMaxCascadeForTile(ni.toUnwrapped())===0);const wn=f.isTileAffectedByFog(ni),In=ri.programConfigurations.get(o.id);let vr=!1;if($&&ii.imageAtlas){const Hn=ii.imageAtlas,ln=r.e2.from($),rr=ln.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),dn=ln.getSecondary(),zr=Hn.patternPositions.get(rr),Kn=dn?Hn.patternPositions.get(dn.scaleSelf(r.o.devicePixelRatio).toString()):null;vr=!!zr&&!!Kn,zr&&In.setConstantPatternPositions(zr,Kn)}B>0&&(vr||In.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ne.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Ui=f.getOrCreateProgram(zt,{config:In,defines:Oi?ct:Ne,overrideFog:wn});if(f.terrain&&f.terrain.setupElevationDraw(ii,Ui,{useMeterToDem:!0}),!ri.centroidVertexBuffer){const Hn=Ui.getAttributeLocation(F,"a_centroid_pos");Hn!==-1&&F.vertexAttrib2f(Hn,0,0)}!et&&At&&At.setupShadows(ii.tileID.toUnwrapped(),Ui,"vector-tile"),Z&&(f.context.activeTexture.set(F.TEXTURE0),ii.imageAtlasTexture&&ii.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),In.updatePaintBuffers());const Dn=o.paint.get("fill-extrusion-vertical-gradient"),tn=1/ri.tileToMeter;let mr;if(et&&At){if(px(ii.tileID,ri.maxHeight,f))continue;const Hn=At.calculateShadowPassMatrixFromTile(ii.tileID.toUnwrapped());mr=_d(Hn,Ce,tn,rt,lt,Lt)}else{const Hn=f.translatePosMatrix(ni.expandedProjMatrix,ii,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),ln=z.projection.createInversionMatrix(z,ni.canonical);mr=Z?jc(Hn,f,Dn,Q,se,Ce,tn,ni,ii,_e,lt,Lt,Ae,Te,ln,He,rt,B):vh(Hn,f,Dn,Q,se,Ce,tn,ni,_e,lt,Lt,Ae,Te,ln,He,rt,Ue,Ft)}f.uploadCommonUniforms(D,Ui,ni.toUnwrapped(),null,Xe);let kn=ri.segments;if(z.projection.name==="mercator"&&!et&&(kn=ri.getVisibleSegments(ii.tileID,f.terrain,f.transform.getFrustum(0)),!kn.get().length))continue;if(mi)if(et)for(const Hn of kn.get())mi.numRenderedVerticesInShadowPass+=Hn.primitiveLength;else for(const Hn of kn.get())mi.numRenderedVerticesInTransparentPass+=Hn.primitiveLength;const Cr=[];(f.terrain||I)&&Cr.push(ri.centroidVertexBuffer),Re&&Cr.push(ri.layoutVertexExtBuffer),Qe&&Cr.push(ri.wallVertexBuffer),Ui.draw(f,D.gl.TRIANGLES,y,b,T,pi,mr,o.id,ri.layoutVertexBuffer,ri.indexBuffer,kn,o.paint,f.transform.zoom,In,Cr)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class J_{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Wc(f,t,o,p,y,b,T,I,D,F,z,j,B,$,Z,Q,ne,te,se,me){const ce=t.context,Ce=ce.gl,_e=t.transform,Re=t.transform.zoom,Ae=[],Te=f.translate,De=f.translateAnchor,He=f.edgeRadius,Ue=Au(t,f.cutoffFadeRange);z==="clear"?(Ae.push("CLEAR_SUBPASS"),me&&(Ae.push("CLEAR_FROM_TEXTURE"),ce.activeTexture.set(Ce.TEXTURE0),me.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE))):z==="sdf"&&Ae.push("SDF_SUBPASS"),te&&Ae.push("HAS_CENTROID"),Ue.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF");const rt=(Qe,lt,Lt,Xe,Ne)=>{let ct=Ae;lt.groundRadiusBuffer!=null&&(ct=Ae.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const et=lt.programConfigurations.get(p.id),At=t.isTileAffectedByFog(Qe),jt=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:et,defines:ct,overrideFog:At}),pi=sf(t,Xe,j,F,Ne,[B,$*Ne],Z,Q,ne,Re>=17?0:He*Ne,me?me.size[0]:0),Ft=[];te&&Ft.push(lt.hiddenByLandmarkVertexBuffer),lt.groundRadiusBuffer!=null&&Ft.push(lt.groundRadiusBuffer),t.uploadCommonUniforms(ce,jt,Qe.toUnwrapped(),null,Ue),jt.draw(t,ce.gl.TRIANGLES,b,T,I,D,pi,p.id,lt.vertexBuffer,lt.indexBuffer,Lt,p.paint,Re,et,Ft)};for(const Qe of y){const lt=o.getTile(Qe),Lt=lt.getBucket(p);if(!Lt||Lt.projection.name!==_e.projection.name||!Lt.groundEffect||Lt.groundEffect&&!Lt.groundEffect.hasData())continue;const Xe=Lt.groundEffect,Ne=1/Lt.tileToMeter;{const ct=t.translatePosMatrix(Qe.projMatrix,lt,Te,De),et=Xe.getDefaultSegment();rt(Qe,Xe,et,ct,Ne)}if(se)for(let ct=0;ct<4;ct++){const et=r.e8[ct](Qe),At=o.getTile(et);if(!At)continue;const jt=At.getBucket(p);if(!jt||jt.projection.name!==_e.projection.name||!jt.groundEffect||jt.groundEffect&&!jt.groundEffect.hasData())continue;const pi=jt.groundEffect;let Ft,zt;ct===0?(Ft=[-r.al,0,0],zt=1):ct===1?(Ft=[r.al,0,0],zt=0):ct===2?(Ft=[0,-r.al,0],zt=3):(Ft=[0,r.al,0],zt=2);const mi=pi.regionSegments[zt];if(!mi)continue;const ni=new Float32Array(16);r.bq(ni,Qe.projMatrix,Ft),rt(Qe,pi,mi,t.translatePosMatrix(ni,lt,Te,De),Ne)}}}function zu(f,t,o,p,y,b,T){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const I=b?b.findDEMTileFor(o):null;if(!(I&&I.dem||T))return;b&&I&&I.dem&&p.selfDEMTileTimestamp!==I.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=I.dem._timestamp);const D=te=>new r.P(Math.ceil((te+r.ec)*r.ed),0),F=te=>{const se=t.getSource().minzoom,me=Ce=>{const _e=t.getTileByID(Ce);if(_e&&_e.hasData())return _e.getBucket(y)},ce=[0,-1,1];for(const Ce of ce){if(te.overscaledZ+Ce<se)continue;const _e=me(te.calculateScaledKey(te.overscaledZ+Ce));if(_e)return _e}},z=[0,0,0],j=(te,se)=>(z[0]=Math.min(te.min.y,se.min.y),z[1]=Math.max(te.max.y,se.max.y),z[2]=r.al-se.min.x>te.max.x?se.min.x-r.al:te.max.x,z),B=(te,se)=>(z[0]=Math.min(te.min.x,se.min.x),z[1]=Math.max(te.max.x,se.max.x),z[2]=r.al-se.min.y>te.max.y?se.min.y-r.al:te.max.y,z),$=[(te,se)=>j(te,se),(te,se)=>j(se,te),(te,se)=>B(te,se),(te,se)=>B(se,te)],Z=(te,se,me,ce,Ce,_e,Re)=>{if(!b)return 0;const Ae=[[_e?me:te,_e?te:me,0],[_e?me:se,_e?se:me,0]],Te=Re<0?r.al+Re:Re,De=[_e?Te:(te+se)/2,_e?(te+se)/2:Te,0];return me===0&&Re<0||me!==0&&Re>0?b.getForTilePoints(Ce,[De],!0,ce):Ae.push(De),b.getForTilePoints(o,Ae,!0,I),Math.max(Ae[0][2],Ae[1][2],De[2])/b.exaggeration()};for(let te=0;te<4;te++){const se=p.borderFeatureIndices[te];if(se.length===0)continue;const me=r.e8[te](o),ce=F(me);if(!(ce&&ce instanceof r.e9))continue;const Ce=b?b.findDEMTileFor(me):null;if(!(Ce&&Ce.dem||T)||(b&&Ce&&Ce.dem&&p.borderDEMTileTimestamp[te]!==Ce.dem._timestamp&&(p.borderDoneWithNeighborZ[te]=-1,p.borderDEMTileTimestamp[te]=Ce.dem._timestamp),p.borderDoneWithNeighborZ[te]===ce.canonical.z))continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();const _e=(te<2?1:5)-te,Re=ce.borderDoneWithNeighborZ[_e]!==p.canonical.z,Ae=ce.borderFeatureIndices[_e];let Te=0;if(p.canonical.z!==ce.canonical.z){for(const De of se)p.showCentroid(p.featuresOnBorder[De]);if(Re)for(const De of Ae)ce.showCentroid(ce.featuresOnBorder[De]);p.borderDoneWithNeighborZ[te]=ce.canonical.z,ce.borderDoneWithNeighborZ[_e]=p.canonical.z}for(const De of se){const He=p.featuresOnBorder[De],Ue=p.centroidData[He.centroidDataIndex],rt=He.borders[te];let Qe;for(;Te<Ae.length;){Qe=ce.featuresOnBorder[Ae[Te]];const lt=Qe.borders[_e];if(lt[1]>rt[0]+3||lt[0]>rt[0]-3)break;ce.showCentroid(Qe),Te++}if(Qe&&Te<Ae.length){const lt=Te;let Lt=0;for(;!(Qe.borders[_e][0]>rt[1]-3)&&(Lt++,++Te!==Ae.length);)Qe=ce.featuresOnBorder[Ae[Te]];Qe=ce.featuresOnBorder[Ae[lt]];let Xe=!1;if(Lt>=1){const et=Qe.borders[_e];Math.abs(rt[0]-et[0])<3&&Math.abs(rt[1]-et[1])<3&&(Lt=1,Xe=!0,Te=lt+1)}else if(Lt===0){p.showCentroid(He);continue}const Ne=ce.centroidData[Qe.centroidDataIndex];T&&Xe&&(((Q=Ue).flags|(ne=Ne).flags)&r.eb?(Q.flags|=r.eb,ne.flags|=r.eb):(Q.flags&=~r.eb,ne.flags&=~r.eb));const ct=He.intersectsCount()>1||Qe.intersectsCount()>1;if(Lt>1)Te=lt,Ue.centroidXY=Ne.centroidXY=new r.P(0,0);else if(Ce&&Ce.dem&&!ct){const et=$[te](Ue,Ne),At=te%2?r.al-1:0,jt=Z(et[0],Math.min(r.al-1,et[1]),At,Ce,me,te<2,et[2]);Ue.centroidXY=Ne.centroidXY=D(jt)}else ct?Ue.centroidXY=Ne.centroidXY=new r.P(0,0):(Ue.centroidXY=p.encodeBorderCentroid(He),Ne.centroidXY=ce.encodeBorderCentroid(Qe));p.writeCentroidToBuffer(Ue),ce.writeCentroidToBuffer(Ne)}else p.showCentroid(He)}p.borderDoneWithNeighborZ[te]=ce.canonical.z,ce.borderDoneWithNeighborZ[_e]=p.canonical.z}var Q,ne;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const Sh=[1,0,0],Pi=[0,1,0],Q_=[0,0,1];function px(f,t,o){const p=o.transform,y=o.shadowRenderer;if(!y)return!0;const b=f.toUnwrapped(),T=p.tileSize*y._cascades[o.currentShadowCascade].scale;let I=t;if(p.elevation){const Q=p.elevation.getMinMaxForTile(f);Q&&(I+=Q.max)}const D=[...y.shadowDirection];D[2]=-D[2];const F=y.computeSimplifiedTileShadowVolume(b,I,T,D);if(!F)return!1;const z=[Sh,Pi,Q_,D,[D[0],0,D[2]],[0,D[1],D[2]]],j=p.projection.name==="globe",B=p.scaleZoom(T),$=r.cA.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,B,!j),Z=y.getCurrentCascadeFrustum();return $.intersectsPrecise(F.vertices,F.planes,z)===0||Z.intersectsPrecise(F.vertices,F.planes,z)===0}function hg(f){const{painter:t,source:o,layer:p,coords:y}=f;let b=f.defines;const T=t.context,I=t.renderPass==="shadow",D=t.renderPass==="light-beam",F=t.shadowRenderer,z=r.ee(t.transform.center.lat,t.transform.zoom),j=Au(t,p.paint.get("building-cutoff-fade-range"));j.shouldRenderCutoff&&(b=b.concat("RENDER_CUTOFF")),f.floodLightIntensity>0&&(b=b.concat("FLOOD_LIGHT"));for(const B of y){const $=o.getTile(B),Z=$.getBucket(p);if(!Z)continue;F&&F.getMaxCascadeForTile(B.toUnwrapped())===0&&(b=b.concat("SHADOWS_SINGLE_CASCADE"));const Q=Z.programConfigurations.get(p.id);let ne,te,se,me=t.translatePosMatrix(B.expandedProjMatrix,$,[0,0],"map");if(me=r.cR(r.bB(),me,[1,1,f.verticalScale]),I&&F){if(px($.tileID,Z.maxHeight*z,t))continue;let Ce=F.calculateShadowPassMatrixFromTile($.tileID.toUnwrapped());Ce=r.cR(r.bB(),Ce,[1,1,f.verticalScale]),se=Z_(Ce),ne=te=t.getOrCreateProgram("buildingDepth",{config:Q,defines:b,overrideFog:!1})}else if(D)ne=te=t.getOrCreateProgram("buildingBloom",{config:Q,defines:b,overrideFog:!1}),se=ig(me);else{const Ce=t.transform.calculatePosMatrix(B.toUnwrapped(),t.transform.worldSize);r.cR(Ce,Ce,[1,1,f.verticalScale]);const _e=r.bB();r.cR(_e,Ce,[1,-1,1/z]),r.bk(_e,_e),r.ef(_e,_e);const Re=t.transform.getFreeCameraOptions().position,Ae=1<<B.canonical.z;if(se=tg(me,_e,f.opacity,f.facadeAOIntensity,[((Re.x-B.wrap)*Ae-B.canonical.x)*r.al,(Re.y*Ae-B.canonical.y)*r.al,Re.z*Ae*r.al],Z.tileToMeter,f.facadeEmissiveChance,f.floodLightColor,f.floodLightIntensity),te=t.getOrCreateProgram("building",{config:Q,defines:b,overrideFog:!1}),f.depthOnly===!0)ne=te;else{const Te=b.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ne=t.getOrCreateProgram("building",{config:Q,defines:Te,overrideFog:!1})}F&&(F.setupShadowsFromMatrix(Ce,te,!0),ne!==te&&F.setupShadowsFromMatrix(Ce,ne,!0))}const ce=(Ce,_e)=>{if(D){const Re=Ce.entranceBloom;_e.draw(t,T.gl.TRIANGLES,f.depthMode,Gi.disabled,f.blendMode,Vi.disabled,se,p.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segmentsBucket,p.paint,t.transform.zoom,Q,[Re.layoutAttenuationBuffer,Re.layoutColorBuffer])}else{const Re=Ce.segmentsBucket;let Ae=[Ce.layoutNormalBuffer,Ce.layoutCentroidBuffer,Ce.layoutColorBuffer,Ce.layoutFloodLightDataBuffer];Ce.layoutFacadePaintBuffer&&(Ae=Ae.concat([Ce.layoutFacadeDataBuffer,Ce.layoutFacadeVerticalRangeBuffer,Ce.layoutFacadePaintBuffer])),_e.draw(t,T.gl.TRIANGLES,f.depthMode,Gi.disabled,f.blendMode,I?Vi.disabled:Vi.backCW,se,p.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Re,p.paint,t.transform.zoom,Q,Ae)}};t.uploadCommonUniforms(T,te,B.toUnwrapped(),null,j),Z.buildingWithoutFacade&&ce(Z.buildingWithoutFacade,te),Z.buildingWithFacade&&(ne!==te&&t.uploadCommonUniforms(T,ne,B.toUnwrapped(),null,j),ce(Z.buildingWithFacade,ne))}}function dg(f,t,o,p,y,b,T,I,D,F,z,j,B){const $=f.context.gl,Z=f.depthModeForSublayer(1,_i.ReadOnly,$.LEQUAL,!0),Q=.1*(1-(ne=z))+3*ne;var ne;const te=f._showOverdrawInspector,se=j,me=new J_;te||Wc(me,f,t,o,p,Z,new Gi({func:$.ALWAYS,mask:255},255,255,$.KEEP,$.KEEP,$.REPLACE),new sn([$.ONE,$.ONE,$.ONE,$.ONE],r.ao.transparent,[!1,!1,!1,!0],$.MIN),Vi.disabled,y,"sdf",b,T,I,D,F,Q,se,!1);{const ce=te?Gi.disabled:new Gi({func:$.EQUAL,mask:255},255,255,$.KEEP,$.DECR,$.DECR),Ce=te?f.colorModeForRenderPass():new sn([$.ONE_MINUS_DST_ALPHA,$.DST_ALPHA,$.ONE,$.ONE],r.ao.transparent,[!0,!0,!0,!0]);Wc(me,f,t,o,p,Z,ce,Ce,Vi.disabled,y,"color",b,T,I,D,F,Q,se,!1)}}function fg(f){return[f[0]*r.eg,f[1]*r.eg,f[2]*r.eg,0]}function ey(f,t,o,p,y,b,T,I,D){const F=p.getSource(),z=o.globeSharedBuffers;if(!z)return;let j,B,$;if(t&&(j=p.getTile(t)),F instanceof r.aT?(B=F.texture,$=r.dJ(0,0,o.transform)):j&&t&&(B=j.texture,$=r.dJ(t.canonical.z,t.canonical.x,o.transform)),!B||!$)return;f||($=r.cR(r.bB(),$,[1,-1,1]));const Z=o.context,Q=Z.gl,ne=y.paint.get("raster-resampling")==="nearest"?Q.NEAREST:Q.LINEAR,te=o.colorModeForDrapableLayerRenderPass(b),se=T.defines;se.push("GLOBE_POLES");const me=new _i(Q.LEQUAL,_i.ReadWrite,o.depthRangeFor3D),ce=Float32Array.from(o.transform.expandedFarZProjMatrix),Ce=Float32Array.from(r.bj(r.dI(new r.cC(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),Z.activeTexture.set(Q.TEXTURE0),B.bind(ne,Q.CLAMP_TO_EDGE),Z.activeTexture.set(Q.TEXTURE1),B.bind(ne,Q.CLAMP_TO_EDGE),"useMipmap"in B&&Z.extTextureFilterAnisotropic&&o.transform.pitch>20&&Q.texParameterf(Q.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const[_e,Re,Ae,Te]=t?z.getPoleBuffers(t.canonical.z,!1):z.getPoleBuffers(0,!0),De=y.paint.get("raster-elevation");let He;f?(He=_e,o.renderDefaultNorthPole=De!==0):(He=Re,o.renderDefaultSouthPole=De!==0);const Ue=fg(T.mix),rt=((lt,Lt,Xe,Ne,ct,et,At,jt,pi,Ft,zt,mi,ni)=>ya(lt,Lt,Xe,new Float32Array(16),new Float32Array(9),[0,0],Ne,[0,0],[0,0,0,0],1,{opacity:1,mix:0},et,[0,0],jt,2,Ft,zt,mi,1,0,ni))(ce,Ce,$,r.aj(o.transform.zoom),0,y,0,De,0,Ue,T.offset,T.range,b),Qe=o.getOrCreateProgram("raster",{defines:se});o.uploadCommonUniforms(Z,Qe,null),Qe.draw(o,Q.TRIANGLES,me,D,te,I,rt,y.id,He,Ae,Te)}function ty(f){const t=f._nearZ,o=f.projection.farthestPixelDistance(f),p=o-t,y=.2*f.height,b=t+y;return[t,o,(b-y-t)/p,(b-t)/p]}function $b(f,t,o,p){if(f)return t instanceof ko&&f instanceof vo?t.getTextureDescriptor(f,o,!0):{texture:f.texture,mix:fg(p.mix),offset:p.offset,buffer:0,tileSize:1}}var Wb=r.eh([{name:"a_index",type:"Int16",components:1}]);class Ss{constructor(t,o,p,y){const b={width:p[0],height:p[1],data:null},T=t.gl;this.targetColorTexture=new r.T(t,b,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(t,b,T.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(o,y),this.lastInvalidatedAt=0}updateParticleTexture(t,o){if(this.particleTextureDimension===o.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,y=o.width*o.height;this.particleTexture0=new r.T(this.context,o,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,o,p.RGBA8,{premultiply:!1,useMipmap:!1});const b=new r.ei;b.reserve(y);for(let T=0;T<y;T++)b.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(b,Wb.members,!0),this.particleSegment=r.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=r.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Cn(f,t,o){if(!f)return null;const p=t.getTextureDescriptor(f,o,!0);if(!p)return null;let{texture:y,mix:b,offset:T,tileSize:I,buffer:D,format:F}=p;if(!y||!F)return null;let z=!1;return F==="uint32"&&(z=!0,b[3]=0,b=rg(r.ej,b,[0,o.paint.get("raster-particle-max-speed")]),T=ku(r.ej,T,[0,o.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[D/(I+2*D),I/(I+2*D)],tileSize:I,scalarData:z,scale:b,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[F]]}}function Nn(f){const t=f._nearZ,o=f.projection.farthestPixelDistance(f),p=o-t,y=.2*f.height,b=t+y;return[t,o,(b-y-t)/p,(b-t)/p]}const Hr=new r.ao(1,0,0,1),ca=new r.ao(0,1,0,1),Ul=new r.ao(0,0,1,1),pg=new r.ao(1,0,1,1),iy=new r.ao(0,1,1,1);function ny(f,t,o,p,y,b){for(let T=0;T<o.length;T++)if(y){const F=new r.ao(p.r*.8,p.g*.8,p.b*.8,1);tl(f,t,o[T],p,-1,-1,b),tl(f,t,o[T],p,-1,1,b),tl(f,t,o[T],p,1,1,b),tl(f,t,o[T],p,1,-1,b),tl(f,t,o[T],F,0,0,b)}else tl(f,t,o[T],p,0,0,b)}function tl(f,t,o,p,y,b,T){const I=f.context,D=f.transform,F=I.gl,z=D.projection.name==="globe",j=z?["PROJECTION_GLOBE_VIEW"]:[];let B=r.by(o.projMatrix);if(z&&r.aj(D.zoom)>0){const Ue=r.bi(o.canonical,D),rt=r.ek(Ue);B=r.aB(new Float32Array(16),D.globeMatrix,rt),r.aB(B,D.projMatrix,B)}const $=r.bB();$[12]+=2*y/(r.o.devicePixelRatio*D.width),$[13]+=2*b/(r.o.devicePixelRatio*D.height),r.aB(B,$,B);const Z=f.getOrCreateProgram("debug",{defines:j}),Q=t.getTileByID(o.key);f.terrain&&f.terrain.setupElevationDraw(Q,Z);const ne=_i.disabled,te=Gi.disabled,se=f.colorModeForRenderPass(),me="$debug";I.activeTexture.set(F.TEXTURE0),f.emptyTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),z?Q._makeGlobeTileDebugBuffers(f.context,D):Q._makeDebugTileBoundsBuffers(f.context,D.projection);const ce=Q._tileDebugBuffer||f.debugBuffer,Ce=Q._tileDebugIndexBuffer||f.debugIndexBuffer,_e=Q._tileDebugSegments||f.debugSegments;if(Z.draw(f,F.LINE_STRIP,ne,te,se,Vi.disabled,ng(B,p.toPremultipliedRenderColor(null)),me,ce,Ce,_e,null,null,null,[Q._globeTileDebugBorderBuffer]),T){const Ue=Q.latestRawTileData,rt=Math.floor((Ue&&Ue.byteLength||0)/1024);let Qe=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Qe+=` => ${o.overscaledZ}`),Qe+=` ${Q.state}`,Qe+=` ${rt}kb`,function(lt,Lt){lt.initDebugOverlayCanvas();const Xe=lt.debugOverlayCanvas,Ne=lt.context.gl,ct=lt.debugOverlayCanvas.getContext("2d");ct.clearRect(0,0,Xe.width,Xe.height),ct.shadowColor="white",ct.shadowBlur=2,ct.lineWidth=1.5,ct.strokeStyle="white",ct.textBaseline="top",ct.font="bold 36px Open Sans, sans-serif",ct.fillText(Lt,5,5),ct.strokeText(Lt,5,5),lt.debugOverlayTexture.update(Xe),lt.debugOverlayTexture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE)}(f,Qe)}const Re=t.getTile(o).tileSize,Ae=512/Math.min(Re,512)*(o.overscaledZ/D.zoom)*.5,Te=Q._tileDebugTextBuffer||f.debugBuffer,De=Q._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,He=Q._tileDebugTextSegments||f.debugSegments;Z.draw(f,F.TRIANGLES,ne,te,sn.alphaBlended,Vi.disabled,ng(B,r.ao.transparent.toPremultipliedRenderColor(null),Ae),me,Te,De,He,null,null,null,[Q._globeTileDebugTextBuffer])}function Ar(f,t,o,p){ua(f,0,t+o/2,f.transform.width,o,p)}function yi(f,t,o,p){ua(f,t-o/2,0,o,f.transform.height,p)}function ua(f,t,o,p,y,b){const T=f.context,I=T.gl;I.enable(I.SCISSOR_TEST),I.scissor(t*r.o.devicePixelRatio,o*r.o.devicePixelRatio,p*r.o.devicePixelRatio,y*r.o.devicePixelRatio),T.clear({color:b}),I.disable(I.SCISSOR_TEST)}const Yn=r.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:vd}=Yn;function hs(f,t,o,p){f.emplaceBack(t,o,p)}class Nu{constructor(t){this.vertexArray=new r.el,this.indices=new r.b0,hs(this.vertexArray,-1,-1,1),hs(this.vertexArray,1,-1,1),hs(this.vertexArray,-1,1,1),hs(this.vertexArray,1,1,1),hs(this.vertexArray,-1,-1,-1),hs(this.vertexArray,1,-1,-1),hs(this.vertexArray,-1,1,-1),hs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,vd),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=r.bf.simpleSegment(0,0,36,12)}}function Ea(f,t,o,p,y,b){const T=f.context.gl,I=t.paint.get("sky-atmosphere-color"),D=t.paint.get("sky-atmosphere-halo-color"),F=t.paint.get("sky-atmosphere-sun-intensity"),z=((j,B,$,Z,Q)=>({u_matrix_3f:j,u_sun_direction:B,u_sun_intensity:$,u_color_tint_r:[Z.r,Z.g,Z.b,Z.a],u_color_tint_m:[Q.r,Q.g,Q.b,Q.a],u_luminance:5e-5}))(r.en(r.dN(),p),y,F,I.toPremultipliedRenderColor(null),D.toPremultipliedRenderColor(null));T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,t.skyboxTexture,0),o.draw(f,T.TRIANGLES,_i.disabled,Gi.disabled,sn.unblended,Vi.frontCW,z,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const fc=r.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Pt{constructor(t){const o=new r.eo;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const p=new r.b0;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(o,fc.members),this.indexBuffer=t.createIndexBuffer(p),this.segments=r.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Xt=r.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Eh{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class ro{constructor(t){this.colorModeAlphaBlendedWriteRGB=new sn([1,No,1,No],r.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new sn([1,0,1,0],r.ao.transparent,[!1,!1,!1,!0]),this.params=new Eh,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const o=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Pt(o);const p=this.params.sizeRange,y=this.params.intensityRange,b=function(z){const j=r.eq(30),B=[];for(let $=0;$<z;++$){const Z=2*Math.PI*j(),Q=Math.acos(1-2*j())-.5*Math.PI;B.push(r.d4(Math.cos(Q)*Math.cos(Z),Math.cos(Q)*Math.sin(Z),Math.sin(Q)))}return B}(this.params.starsCount),T=r.eq(300),I=new r.ep,D=new r.b0;let F=0;for(let z=0;z<b.length;++z){const j=r.c4([],b[z],200),B=Math.max(0,1+.01*p*(1*T()-.5)),$=Math.max(0,1+.01*y*(1*T()-.5));I.emplaceBack(j[0],j[1],j[2],-1,-1,B,$),I.emplaceBack(j[0],j[1],j[2],1,-1,B,$),I.emplaceBack(j[0],j[1],j[2],1,1,B,$),I.emplaceBack(j[0],j[1],j[2],-1,1,B,$),D.emplaceBack(F+0,F+1,F+2),D.emplaceBack(F+0,F+2,F+3),F+=4}this.starsVx=o.createVertexBuffer(I,Xt.members),this.starsIdx=o.createIndexBuffer(D),this.starsSegments=r.bf.simpleSegment(0,0,I.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,o){const p=t.context,y=p.gl,b=t.transform,T=new _i(y.LEQUAL,_i.ReadOnly,[0,1]),I=r.aj(b.zoom),D=t.style.getLut(o.scope),F=o.properties.get("color-use-theme")==="none",z=o.properties.get("color").toNonPremultipliedRenderColor(F?null:D),j=o.properties.get("high-color-use-theme")==="none",B=o.properties.get("high-color").toNonPremultipliedRenderColor(j?null:D),$=o.properties.get("space-color-use-theme")==="none",Z=o.properties.get("space-color").toNonPremultipliedRenderColor($?null:D),Q=5e-4,ne=r.er(o.properties.get("horizon-blend"),0,1,Q,.25),te=r.dD(t,p,b)&&ne===Q?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,se=t.frameCounter/1e3%1,me=r.ag(b.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(me,2)-Math.pow(te,2)),Ce=Math.acos(ce/me),_e=Re=>{const Ae=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Re&&Ae.push("ALPHA_PASS");const Te=t.getOrCreateProgram("globeAtmosphere",{defines:Ae}),De=((Ue,rt,Qe,lt,Lt,Xe,Ne,ct,et,At,jt,pi)=>({u_frustum_tl:Ue,u_frustum_tr:rt,u_frustum_br:Qe,u_frustum_bl:lt,u_horizon:Lt,u_transition:Xe,u_fadeout_range:Ne,u_atmosphere_fog_color:ct.toArray01(),u_high_color:et.toArray01(),u_space_color:At.toArray01(),u_temporal_offset:jt,u_horizon_angle:pi}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,I,ne,z,B,Z,se,Ce);t.uploadCommonUniforms(p,Te);const He=this.atmosphereBuffer;He&&Te.draw(t,y.TRIANGLES,T,Gi.disabled,Re?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Vi.backCW,De,Re?"atmosphere_glow_alpha":"atmosphere_glow",He.vertexBuffer,He.indexBuffer,He.segments)};_e(!1),_e(!0)}drawStars(t,o){const p=r.aA(o.properties.get("star-intensity"),0,1);if(p===0)return;const y=t.context,b=y.gl,T=t.transform,I=t.getOrCreateProgram("stars"),D=r.c6([]);r.c8(D,D,-T._pitch),r.c7(D,D,-T.angle),r.c8(D,D,r.an(T._center.lat)),r.es(D,D,-r.an(T._center.lng));const F=r.cb(new Float32Array(16),D),z=r.aB([],T.starsProjMatrix,F),j=r.en([],F),B=r.et([],j),$=[0,1,0];r.dP($,$,B),r.c4($,$,this.params.sizeMultiplier);const Z=[1,0,0];r.dP(Z,Z,B),r.c4(Z,Z,this.params.sizeMultiplier);const Q=(ne=$,te=Z,se=p,{u_matrix:Float32Array.from(z),u_up:ne,u_right:te,u_intensity_multiplier:se});var ne,te,se;t.uploadCommonUniforms(y,I),this.starsVx&&this.starsIdx&&I.draw(t,b.TRIANGLES,_i.disabled,Gi.disabled,this.colorModeAlphaBlendedWriteRGB,Vi.disabled,Q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class qe{constructor(){this.visibleTiles=[]}updateBorders(t,o){const p=[],y=[],b=t._getRenderableCoordinates(!1,!0);for(const D of b){const F=t.getTile(D);if(!F.hasData())continue;const z=F.getBucket(o);z&&(z.isEmpty()||(p.push(D.key),y.push({bucket:z,tileID:D.canonical})))}let T=p.length!==this.visibleTiles.length;if(!T){p.sort();for(let D=0;D<p.length;D++)if(p[D]!==this.visibleTiles[D]){T=!0;break}}if(!T)return;const I=new Set;this.visibleTiles=p,y.sort((D,F)=>D.tileID.z-F.tileID.z||D.tileID.x-F.tileID.x||D.tileID.y-F.tileID.y);for(const D of y){const F=new Array,z=new Array,j=D.bucket;for(const B of j.featuresOnBorder)I.has(B.featureId)?z.push(B.footprintIndex):(I.add(B.featureId),F.push(B.footprintIndex));j.updateFootprintHiddenFlags(F,r.eu,!1),j.updateFootprintHiddenFlags(z,r.eu,!0)}}}function Fp(f,t){const o=[...f],p=t.cameraWorldSizeForFog/t.worldSize,y=r.bz([]);return r.cR(y,y,[p,p,1]),r.aB(o,y,o),r.aB(o,t.worldToFogMatrix,o),o}function Ah(f,t,o,p,y){const b=o.material,T=p.context,{baseColorTexture:I,metallicRoughnessTexture:D}=b.pbrMetallicRoughness,{normalTexture:F,occlusionTexture:z,emissionTexture:j}=b;function B(Z,Q,ne){if(Z&&(f.push(Q),T.activeTexture.set(T.gl.TEXTURE0+ne),Z.gfxTexture)){const{minFilter:te,magFilter:se,wrapS:me,wrapT:ce}=Z.sampler;Z.gfxTexture.bindExtraParam(te,se,me,ce)}}B(I,"HAS_TEXTURE_u_baseColorTexture",Sa.BaseColor),B(D,"HAS_TEXTURE_u_metallicRoughnessTexture",Sa.MetallicRoughness),B(F,"HAS_TEXTURE_u_normalTexture",Sa.Normal),B(z,"HAS_TEXTURE_u_occlusionTexture",Sa.Occlusion),B(j,"HAS_TEXTURE_u_emissionTexture",Sa.Emission),y&&(y.texture||(y.texture=new r.d_(p.context,y.image,[y.image.height,y.image.height,y.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+Sa.LUT),y.texture&&y.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(o.texcoordBuffer)),o.colorBuffer&&(f.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(o.colorBuffer)),o.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(o.normalBuffer)),o.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(o.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||f.push("DIFFUSE_SHADED");const $=p.shadowRenderer;$&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$.useNormalOffset&&f.push("NORMAL_OFFSET"))}function Ch(f,t,o,p,y,b){const T=o.paint.get("model-opacity").constantOr(1),I=t.context,D=new _i(t.context.gl.LEQUAL,f.isLightMesh?_i.ReadOnly:_i.ReadWrite,t.depthRangeFor3D),F=t.transform,z=f.mesh,j=z.material,B=j.pbrMetallicRoughness,$=t.style.fog;let Z;Z=t.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:r.aB([],p.zScaleMatrix,f.nodeModelMatrix),r.aB(Z,p.negCameraPosMatrix,Z);const Q=r.bk([],Z);r.ef(Q,Q);const ne=o.paint.get("model-color-use-theme").constantOr("default")==="none",te=o.paint.get("model-emissive-strength").constantOr(0),se=Wi(new Float32Array(f.worldViewProjection),new Float32Array(Z),new Float32Array(Q),null,t,T,B.baseColorFactor,j.emissiveFactor,B.metallicFactor,B.roughnessFactor,j,te,o,void 0,void 0,f.materialOverride,f.modelColor),me={defines:[]},ce=[],Ce=t.shadowRenderer;Ce&&(Ce.useNormalOffset=!1),Ah(me.defines,ce,z,t,ne?null:o.lut);let _e=null;if($){const Te=Fp(f.nodeModelMatrix,t.transform);if(_e=new Float32Array(Te),F.projection.name!=="globe"){const De=z.aabb.min,He=z.aabb.max,[Ue,rt]=$.getOpacityForBounds(Te,De[0],De[1],He[0],He[1]);me.overrideFog=Ue>=We||rt>=We}}const Re=Au(t,o.paint.get("model-cutoff-fade-range"));Re.shouldRenderCutoff&&me.defines.push("RENDER_CUTOFF");const Ae=t.getOrCreateProgram("model",me);t.uploadCommonUniforms(I,Ae,null,_e,Re),t.renderPass!=="shadow"&&Ce&&Ce.setupShadowsFromMatrix(f.nodeModelMatrix,Ae),Ae.draw(t,I.gl.TRIANGLES,D,y,b,z.material.doubleSided?Vi.disabled:Vi.backCCW,se,o.id,z.vertexBuffer,z.indexBuffer,z.segments,o.paint,t.transform.zoom,void 0,ce)}function uf(f,t,o){return f.type==="vector"?t.scope:o?"basemap":""}function hf(f,t,o,p,y,b,T,I,D){const F=f.transform,z=!!t.isGeometryBloom&&t.isGeometryBloom;if(z&&f.renderPass==="shadow")return;const j=F.projection.name==="globe"?r.eC(o,F):[...o];r.aB(j,j,t.globalMatrix);const B=r.aB([],p,j);if(t.meshes)for(const $ of t.meshes){const Z=I.get($.material.name);if(Z&&Z.opacity<=0)continue;if($.material.alphaMode!=="BLEND"){T.push({mesh:$,depth:0,modelIndex:y,worldViewProjection:B,nodeModelMatrix:j,isLightMesh:z,materialOverride:Z,modelColor:D});continue}const Q=r.af([],$.centroid,B);!F.isOrthographic&&Q[2]<=0||b.push({mesh:$,depth:Q[2],modelIndex:y,worldViewProjection:B,nodeModelMatrix:j,isLightMesh:z,materialOverride:Z,modelColor:D})}if(t.children)for(const $ of t.children)hf(f,$,o,p,y,b,T,I,D)}function Ih(f,t,o,p){const y=o.shadowRenderer;if(!y)return;const b=y.getShadowPassDepthMode(),T=y.getShadowPassColorMode(),I=y.calculateShadowPassMatrixFromMatrix(t),D=Fs(I);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,b,Gi.disabled,T,Vi.disabled,D,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,o.transform.zoom,void 0,void 0)}function Rh(f,t,o,p,y,b){for(const T of y){const I=Object.assign({},p);I.part=T;const D={type:"Unknown",id:t,properties:I},F={orientation:f.paint.get("model-rotation").evaluate(D,o)};b.set(T,F)}}function ry(f,t,o,p,y,b){for(const T of y){const I=Object.assign({},p);I.part=T;const D={type:"Unknown",id:t,properties:I},F={color:f.paint.get("model-color").evaluate(D,o),colorMix:f.paint.get("model-color-mix-intensity").evaluate(D,o),opacity:f.paint.get("model-opacity").evaluate(D,o),emissionStrength:f.paint.get("model-emissive-strength").evaluate(D,o)};b.set(T,F)}}function mg(f,t,o,p,y,b){if(o===1)for(const I of y)Ch(I,f,t,b[I.modelIndex],Gi.disabled,f.colorModeForRenderPass());else{for(const I of y)Ch(I,f,t,b[I.modelIndex],Gi.disabled,sn.disabled);for(const I of y)Ch(I,f,t,b[I.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}const T=sn.additive;for(const I of p)Ch(I,f,t,b[I.modelIndex],Gi.disabled,I.isLightMesh?T:f.colorModeForRenderPass())}function gg(f,t,o){const p=t.updateZoomBasedPaintProperties(),y=function(b,T,I){let D,F,z,j=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&j>0){const B=b.terrain,$=B.findDEMTileFor(I);$&&$.dem?D=r.eE.create(B,I,$):j=0}if(j===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),j===T.validForExaggeration&&(j===0||D&&D._demTile&&D._demTile.tileID===T.validForDEMTile.id&&D._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const B in T.instancesPerModel){const $=T.instancesPerModel[B];for(let Z=0;Z<$.instancedDataArray.length;++Z){const Q=(D?j*D.getElevationAt(0|$.instancedDataArray.float32[16*Z],0|$.instancedDataArray.float32[16*Z+1],!0,!0):0)+$.instancesEvaluatedElevation[Z];$.instancedDataArray.float32[16*Z+6]=Q,F=F?Math.min(T.terrainElevationMin,Q):Q,z=z?Math.max(T.terrainElevationMax,Q):Q}}return T.terrainElevationMin=F||0,T.terrainElevationMax=z||0,T.validForExaggeration=j,T.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,t,o);(p||y)&&(t.uploaded=!1,t.upload(f.context))}const Ls={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.d8([0,0,0],[r.al,r.al,0])};function Lp(f,t){const o=1<<f.canonical.z,p=t.getFreeCameraOptions().position,y=t.elevation,b=f.canonical.x/o,T=(f.canonical.x+1)/o,I=f.canonical.y/o,D=(f.canonical.y+1)/o;let F=t._centerAltitude;if(y){const $=y.getMinMaxForTile(f);$&&$.max>F&&(F=$.max)}const z=r.aA(p.x,b,T)-p.x,j=r.aA(p.y,I,D)-p.y,B=r.ce(F,t.center.lat)-p.z;return t._zoomFromMercatorZ(Math.sqrt(z*z+j*j+B*B))}function df(f,t,o,p,y,b,T){const I=f.context,D=f.renderPass==="shadow",F=f.shadowRenderer,z=D&&F?F.getShadowPassDepthMode():new _i(I.gl.LEQUAL,_i.ReadWrite,f.depthRangeFor3D),j=f.isTileAffectedByFog(b),B=f.transform.projection.name==="globe";if(o.meshes)for(const $ of o.meshes){const Z=B?[]:["MODEL_POSITION_ON_GPU"],Q=[];let ne,te,se;const me=!B&&p.instancedDataArray.length>20;me&&Z.push("INSTANCED_ARRAYS");const ce=Au(f,t.paint.get("model-cutoff-fade-range"));if(ce.shouldRenderCutoff&&Z.push("RENDER_CUTOFF"),D&&F)ne=f.getOrCreateProgram("modelDepth",{defines:Z}),te=Fs(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(o.globalMatrix)),se=F.getShadowPassColorMode();else{Ah(Z,Q,$,f,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),ne=f.getOrCreateProgram("model",{defines:Z,overrideFog:j});const _e=$.material,Re=_e.pbrMetallicRoughness,Ae=t.paint.get("model-opacity").constantOr(1),Te=t.paint.get("model-emissive-strength").constantOr(0);te=Wi(b.expandedProjMatrix,Float32Array.from(o.globalMatrix),new Float32Array(16),null,f,Ae,Re.baseColorFactor,_e.emissiveFactor,Re.metallicFactor,Re.roughnessFactor,_e,Te,t,y),F&&(T.shadowUniformsInitialized?ne.setShadowUniformValues(I,F.getShadowUniformValues()):(F.setupShadows(b.toUnwrapped(),ne,"model-tile"),T.shadowUniformsInitialized=!0)),se=ce.shouldRenderCutoff||Ae<1||_e.alphaMode!=="OPAQUE"?sn.alphaBlended:sn.unblended}f.uploadCommonUniforms(I,ne,b.toUnwrapped(),null,ce);const Ce=$.material.doubleSided?Vi.disabled:Vi.backCCW;if(me)Q.push(p.instancedDataBuffer),ne.draw(f,I.gl.TRIANGLES,z,Gi.disabled,se,Ce,te,t.id,$.vertexBuffer,$.indexBuffer,$.segments,t.paint,f.transform.zoom,void 0,Q,p.instancedDataArray.length);else{const _e=D?"u_instance":"u_normal_matrix";for(let Re=0;Re<p.instancedDataArray.length;++Re)te[_e]=new Float32Array(p.instancedDataArray.arrayBuffer,64*Re,16),ne.draw(f,I.gl.TRIANGLES,z,Gi.disabled,se,Ce,te,t.id,$.vertexBuffer,$.indexBuffer,$.segments,t.paint,f.transform.zoom,void 0,Q)}}if(o.children)for(const $ of o.children)df(f,t,$,p,y,b,T)}const xd=[1,-1,1];function ff(f,t,o,p){if(!o.modelManager)return!0;const y=o.modelManager;if(!o.shadowRenderer)return!0;const b=o.shadowRenderer,T=t.aabb;let I=!0,D=f.maxHeight;if(D===0){let z=0;for(const j in f.instancesPerModel){const B=y.getModel(j,p);B?z=Math.max(z,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):I=!1}D=f.maxScale*z*1.41+f.maxVerticalOffset,I&&(f.maxHeight=D)}T.max[2]=D,T.min[2]+=f.terrainElevationMin,T.max[2]+=f.terrainElevationMax,r.af(T.min,T.min,t.tileMatrix),r.af(T.max,T.max,t.tileMatrix);const F=T.intersects(b.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=F===2),F===0}function bd(f,t){const o=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],y=f.uniformValues.u_cutoff_params[2],b=f.uniformValues.u_cutoff_params[3];return p===o||b===y?1:r.aA(((t-o)/(p-o)-y)/(b-y),0,1)}function Bu(f,t,o,p){if(t.pitch<20)return 1;const y=t.getWorldToCameraMatrix();r.aB(y,y,f);const b=r.bT(o.min[0],o.min[1],o.min[2],1);let T=r.aC(r.eF(),b,y),I=T,D=T;b[1]=o.max[1],T=r.aC(r.eF(),b,y),I=T[1]<I[1]?T:I,D=T[1]>D[1]?T:D,b[0]=o.max[0],T=r.aC(r.eF(),b,y),I=T[1]<I[1]?T:I,D=T[1]>D[1]?T:D,b[1]=o.min[1],T=r.aC(r.eF(),b,y),I=T[1]<I[1]?T:I,D=T[1]>D[1]?T:D;const F=r.aA(p[0],0,1),z=100*t.pixelsPerMeter*r.aA(p[1],0,1),j=r.aA(p[2],0,1),B=r.eG(r.eF(),I,D,F),$=Math.tan(.5*t.fovX),Z=-B[2]*$;if(z===0)return B[1]<-Math.abs(Z)?j:1;const Q=(-Math.abs(Z)-B[1])/z,ne=(se,me,ce)=>(1-ce)*se+ce*me,te=r.aA(ne(1,j,Q),j,1);return ne(1,te,r.aA((t.pitch-20)/20,0,1))}class _g{}class oy{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,o,p){{const j=this._storage.get(o.id);if(j)return j.lastUsedFrameIdx=t,j.buf}const y=p.gl,b=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),T=new ArrayBuffer(b),I=new Int16Array(T);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const D=new r.eI;for(let j=0;j<b/2;j+=3){const B=I[j],$=I[j+1],Z=I[j+2];D.emplaceBack(B,$),D.emplaceBack($,Z),D.emplaceBack(Z,B)}const F=p.bindVertexArrayOES.current,z=new _g;return z.buf=new bh(p,D),z.lastUsedFrameIdx=t,this._storage.set(o.id,z),p.bindVertexArrayOES.set(F),z.buf}update(t){for(const[o,p]of this._storage)t-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(o))}destroy(){for(const[t,o]of this._storage)o.buf.destroy(),this._storage.delete(t)}}class zp{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const ay=r.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Np{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class ha{constructor(t,o){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...o,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...o,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const wl=r.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class Bp{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,o){const p=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new r.eJ,I=new r.b0;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(T,wl.members),this.vignetteIdx=t.context.createIndexBuffer(I)}const y=r.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,p);const T={u_vignetteShape:(b={vignetteShape:[o.start,o.range,Math.pow(10,o.fadePower)],vignetteColor:[o.color.r,o.color.g,o.color.b,o.color.a*o.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};p.draw(t,t.context.gl.TRIANGLES,_i.disabled,Gi.disabled,sn.alphaBlended,Vi.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,y)}var b}}class xn{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,o){const p=t.getFreeCameraOptions().position,y=p.toAltitude(),b=p.toLngLat(),T=r.an(b.lng),I=r.an(b.lat),D=t.pixelsPerMeter/o,F=T*r.eL,z=r.eL*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const j=-this._offsetYPrev+z,B=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+F)*D,this._accumulatedOffsetY+=j*D,this._accumulatedElevation+=B*D,this._offsetXPrev=F,this._offsetYPrev=z,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function gn(f,t){return[-(f[0]-Math.floor(f[0]/t)*t),-(f[1]-Math.floor(f[1]/t)*t),-(f[2]-Math.floor(f[2]/t)*t)]}function pf(f){const t=r.eq(1323123451230),o=[];for(let p=0;p<f;++p){const y=2*t()-1,b=2*t()-1,T=2*t()-1;o.push(r.d4(y,b,T))}return o}function Wa(f,t,o,p,y){const b=r.aA((y-o)/(p-o),0,1);return(1-b)*f+b*t}class qc{constructor(t){this._movement=new xn,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Bp,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,o){const p=t.transform;this._movement.update(p,this._ppmScaleFactor);const y=p.starsProjMatrix,b=r.c6([]);r.c8(b,b,r.an(90)-p._pitch),r.c7(b,b,-p.angle);const T=r.cb(new Float32Array(16),b),I=r.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),D=r.ef([],I),F=r.aB([],D,T),z=Date.now()/1e3;return this._accumulatedTimeFromStart+=(z-this._prevTime)*o,this._prevTime=z,{projectionMatrix:y,modelviewMatrix:F}}}class mf extends qc{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new ha(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const o=t.context;if(!this.particlesVx){const p=pf(this.particlesCount),y=new r.eM,b=new r.b0;let T=0;const I=r.eq(1323123451230);for(let D=0;D<p.length;++D){const F=p[D],z=[2*I()-1,I(),I(),I()];y.emplaceBack(F[0],F[1],F[2],-1,-1,...z),y.emplaceBack(F[0],F[1],F[2],1,-1,...z),y.emplaceBack(F[0],F[1],F[2],1,1,...z),y.emplaceBack(F[0],F[1],F[2],-1,1,...z),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=o.createVertexBuffer(y,ay.members),this.particlesIdx=o.createIndexBuffer(b)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const o=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=t.transform.zoom;if(o.revealStart>p)return;const y=Wa(0,1,o.revealStart,o.revealStart+o.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let T=[-b.direction.x,b.direction.y,-100];r.aw(T,T);const I=structuredClone(this._vignetteParams);I.strength*=y,b.overrideStyleParameters||(b.intensity=t.style.rain.state.density,b.timeFactor=t.style.rain.state.intensity,b.color=structuredClone(t.style.rain.state.color),T=structuredClone(t.style.rain.state.direction),b.screenThinning.intensity=t.style.rain.state.centerThinning,b.dropletSizeX=t.style.rain.state.dropletSize[0],b.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],b.distortionStrength=100*t.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(t.style.rain.state.vignetteColor));const D=this.updateOnRender(t,b.timeFactor),F=t.context,z=F.gl,j=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new r.T(F,{width:t.width,height:t.height,data:null},z.RGBA8)),b.distortionStrength>0&&(F.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),z.copyTexSubImage2D(z.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const B=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(F,B),F.activeTexture.set(z.TEXTURE0),this.screenTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const $=[b.color.r,b.color.g,b.color.b,b.color.a],Z=(Q,ne)=>{const te=gn(this._movement.getPosition(),Q),se=b.dropletSizeX,me=b.dropletSizeX*b.dropletSizeYScale,ce=t.width/2,Ce=t.height/2,_e=Wa(0,b.screenThinning.start,0,1,b.screenThinning.intensity),Re=Wa(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),Ae=Wa(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),Te=(De={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:Q,rainDropletSize:[se,me],distortionStrength:b.distortionStrength,rainDirection:T,color:$,screenSize:[j.width,j.height],thinningCenterPos:[ce,Ce],thinningShape:[_e,Re,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:Ae,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:ne?0:1},{u_modelview:Float32Array.from(De.modelview),u_projection:Float32Array.from(De.projection),u_time:De.time,u_cam_pos:De.camPos,u_texScreen:0,u_velocityConeAperture:De.velocityConeAperture,u_velocity:De.velocity,u_boxSize:De.boxSize,u_rainDropletSize:De.rainDropletSize,u_distortionStrength:De.distortionStrength,u_rainDirection:De.rainDirection,u_color:De.color,u_screenSize:De.screenSize,u_thinningCenterPos:De.thinningCenterPos,u_thinningShape:De.thinningShape,u_thinningAffectedRatio:De.thinningAffectedRatio,u_thinningParticleOffset:De.thinningParticleOffset,u_shapeDirectionalPower:De.shapeDirectionalPower,u_shapeNormalPower:De.shapeNormalPower,u_mode:De.mode});var De;const He=Math.round(b.intensity*this.particlesCount),Ue=r.bf.simpleSegment(0,0,4*He,2*He);B.draw(t,z.TRIANGLES,_i.disabled,Gi.disabled,sn.alphaBlended,Vi.disabled,Te,"rain_particles",this.particlesVx,this.particlesIdx,Ue)};b.distortionStrength>0&&Z(b.boxSize,!0),Z(b.boxSize,!1),this._vignette.draw(t,I)}}const Vu=r.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class sy extends qc{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new ha(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const o=t.context;if(!this.particlesVx){const p=pf(this.particlesCount),y=new r.eN,b=new r.b0;let T=0;const I=r.eq(1323123451230);for(let D=0;D<p.length;++D){const F=p[D],z=I(),j=I(),B=I(),$=[D/p.length,z,j,B],Z=[I(),I()];y.emplaceBack(F[0],F[1],F[2],-1,-1,...$,...Z),y.emplaceBack(F[0],F[1],F[2],1,-1,...$,...Z),y.emplaceBack(F[0],F[1],F[2],1,1,...$,...Z),y.emplaceBack(F[0],F[1],F[2],-1,1,...$,...Z),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=o.createVertexBuffer(y,Vu.members),this.particlesIdx=o.createIndexBuffer(b)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const o=structuredClone(this._params);let p=[-o.direction.x,o.direction.y,-100];r.aw(p,p);const y=structuredClone(this._vignetteParams),b=o.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=t.transform.zoom;if(b.revealStart>T)return;const I=Wa(0,1,b.revealStart,b.revealStart+b.revealRange,T);y.strength*=I,o.overrideStyleParameters||(o.intensity=t.style.snow.state.density,o.timeFactor=t.style.snow.state.intensity,o.color=structuredClone(t.style.snow.state.color),p=structuredClone(t.style.snow.state.direction),o.screenThinning.intensity=t.style.snow.state.centerThinning,o.billboardSize=2.79*t.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(t.style.snow.state.vignetteColor));const D=this.updateOnRender(t,o.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const F=t.context,z=F.gl,j=t.transform,B=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(F,B),(($,Z,Q)=>{const ne=gn(this._movement.getPosition(),$),te=j.width/2,se=j.height/2,me=Wa(0,Q.screenThinning.start,0,1,Q.screenThinning.intensity),ce=Wa(.001,Q.screenThinning.range,0,1,Q.screenThinning.intensity),Ce=Wa(0,Q.screenThinning.particleOffset,0,1,Q.screenThinning.intensity),_e=(Re={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ne,velocityConeAperture:Q.velocityConeAperture,velocity:Q.velocity,horizontalOscillationRadius:Q.horizontalOscillationRadius,horizontalOscillationRate:Q.horizontalOscillationRate,boxSize:$,billboardSize:1*Q.billboardSize,simpleShapeParameters:[Q.shapeFadeStart,Q.shapeFadePower],screenSize:[j.width,j.height],thinningCenterPos:[te,se],thinningShape:[me,ce,Math.pow(10,Q.screenThinning.fadePower)],thinningAffectedRatio:Q.screenThinning.affectedRatio,thinningParticleOffset:Ce,color:[Q.color.r,Q.color.g,Q.color.b,Q.color.a],direction:p},{u_modelview:Float32Array.from(Re.modelview),u_projection:Float32Array.from(Re.projection),u_time:Re.time,u_cam_pos:Re.camPos,u_velocityConeAperture:Re.velocityConeAperture,u_velocity:Re.velocity,u_horizontalOscillationRadius:Re.horizontalOscillationRadius,u_horizontalOscillationRate:Re.horizontalOscillationRate,u_boxSize:Re.boxSize,u_billboardSize:Re.billboardSize,u_simpleShapeParameters:Re.simpleShapeParameters,u_screenSize:Re.screenSize,u_thinningCenterPos:Re.thinningCenterPos,u_thinningShape:Re.thinningShape,u_thinningAffectedRatio:Re.thinningAffectedRatio,u_thinningParticleOffset:Re.thinningParticleOffset,u_particleColor:Re.color,u_direction:Re.direction});var Re;const Ae=Math.round(Q.intensity*this.particlesCount),Te=r.bf.simpleSegment(0,0,4*Ae,2*Ae);this.particlesVx&&this.particlesIdx&&B.draw(t,z.TRIANGLES,_i.disabled,Gi.disabled,sn.alphaBlended,Vi.disabled,_e,"snow_particles",this.particlesVx,this.particlesIdx,Te)})(o.boxSize,0,o),this._vignette.draw(t,y)}}const ly={symbol:function(f,t,o,p,y){if(f.renderPass!=="translucent")return;const b=Gi.disabled,T=f.colorModeForRenderPass(),I=o.layout.get("text-variable-anchor"),D=o.layout.get("text-size-scale-range"),F=r.aA(f.scaleFactor,D[0],D[1]);I&&function(B,$,Z,Q,ne,te,se,me){const ce=$.transform,Ce=ne==="map",_e=te==="map";for(const Re of B){const Ae=Q.getTile(Re),Te=Ae.getBucket(Z);if(!Te||!Te.text||!Te.text.segments.get().length)continue;const De=r.bJ(Te.textSizeData,ce.zoom,me),He=uh(Re,Te.getProjection(),ce),Ue=ce.calculatePixelsToTileUnitsMatrix(Ae),rt=Jt(He,Ae.tileID.canonical,_e,Ce,ce,Te.getProjection(),Ue),Qe=Te.hasIconTextFit()&&Te.hasIconData();De&&Th(Te,Ce,_e,se,ce,rt,Re,Math.pow(2,ce.zoom-Ae.tileID.overscaledZ),De,Qe)}}(p,f,o,t,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),y,F);const z=o.paint.get("icon-opacity").constantOr(1)!==0,j=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(z||j)?$c(f,t,o,p,b,T):(z&&$c(f,t,o,p,b,T,{onlyIcons:!0}),j&&$c(f,t,o,p,b,T,{onlyText:!0})),t.map.showCollisionBoxes&&(Op(f,t,o,p,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Op(f,t,o,p,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(f,t,o,p){if(f.renderPass!=="translucent")return;const y=o.paint.get("circle-opacity"),b=o.paint.get("circle-stroke-width"),T=o.paint.get("circle-stroke-opacity"),I=o.layout.get("circle-sort-key").constantOr(1)!==void 0,D=o.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(b.constantOr(1)===0||T.constantOr(1)===0))return;const F=f.context,z=F.gl,j=f.transform,B=!(!f.terrain||!f.terrain.enabled),$=o.layout.get("circle-elevation-reference"),Z=f.depthModeForSublayer(0,_i.ReadOnly),Q=new _i(f.context.gl.LEQUAL,_i.ReadOnly,f.depthRangeFor3D),ne=$==="none"||B?Z:Q,te=Gi.disabled,se=f.colorModeForDrapableLayerRenderPass(D),me=j.projection.name==="globe",ce=[r.aF(j.center.lng),r.aJ(j.center.lat)],Ce=[];for(let Re=0;Re<p.length;Re++){const Ae=p[Re],Te=t.getTile(Ae),De=Te.getBucket(o);if(!De||De.projection.name!==j.projection.name)continue;const He=De.programConfigurations.get(o.id),Ue=De.layoutVertexBuffer,rt=De.globeExtVertexBuffer,Qe=De.indexBuffer,lt=r.d$(o),Lt=[rt],Xe=f.isTileAffectedByFog(Ae);me&&lt.push("PROJECTION_GLOBE_VIEW"),lt.push("DEPTH_D24"),f.terrain&&j.depthOcclusionForSymbolsAndCircles&&lt.push("DEPTH_OCCLUSION"),De.hasElevation&&!f.terrain&&(lt.push("ELEVATED_ROADS"),Lt.push(De.elevatedLayoutVertexBuffer));const Ne=f.getOrCreateProgram("circle",{config:He,defines:lt,overrideFog:Xe}),ct=j.projection.createInversionMatrix(j,Ae.canonical),et={programConfiguration:He,program:Ne,layoutVertexBuffer:Ue,dynamicBuffers:Lt,indexBuffer:Qe,uniformValues:r.e0(f,Ae,Te,ct,ce,o),tile:Te};if(I){const At=De.segments.get();for(const jt of At)Ce.push({segments:new r.bf([jt]),sortKey:jt.sortKey,state:et})}else Ce.push({segments:De.segments,sortKey:0,state:et})}I&&Ce.sort((Re,Ae)=>Re.sortKey-Ae.sortKey);const _e={useDepthForOcclusion:j.depthOcclusionForSymbolsAndCircles};for(const Re of Ce){const{programConfiguration:Ae,program:Te,layoutVertexBuffer:De,dynamicBuffers:He,indexBuffer:Ue,uniformValues:rt,tile:Qe}=Re.state,lt=Re.segments;f.terrain&&f.terrain.setupElevationDraw(Qe,Te,_e),f.uploadCommonUniforms(F,Te,Qe.tileID.toUnwrapped()),Te.draw(f,z.TRIANGLES,ne,te,se,Vi.disabled,rt,o.id,De,Ue,lt,o.paint,j.zoom,Ae,He)}},heatmap:function(f,t,o,p){if(o.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const y=f.context,b=y.gl,T=Gi.disabled,I=new sn([b.ONE,b.ONE,b.ONE,b.ONE],r.ao.transparent,[!0,!0,!0,!0]);(function($,Z,Q,ne){const te=$.gl,se=Z.width*ne,me=Z.height*ne;$.activeTexture.set(te.TEXTURE1),$.viewport.set([0,0,se,me]);let ce=Q.heatmapFbo;if(!ce||ce&&(ce.width!==se||ce.height!==me)){ce&&ce.destroy();const Ce=te.createTexture();te.bindTexture(te.TEXTURE_2D,Ce),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MAG_FILTER,te.LINEAR),ce=Q.heatmapFbo=$.createFramebuffer(se,me,!0,null),function(_e,Re,Ae,Te,De,He){const Ue=_e.gl;Ue.texImage2D(Ue.TEXTURE_2D,0,_e.extRenderToTextureHalfFloat?Ue.RGBA16F:Ue.RGBA,De,He,0,Ue.RGBA,_e.extRenderToTextureHalfFloat?Ue.HALF_FLOAT:Ue.UNSIGNED_BYTE,null),Te.colorAttachment.set(Ae)}($,0,Ce,ce,se,me)}else te.bindTexture(te.TEXTURE_2D,ce.colorAttachment.get()),$.bindFramebuffer.set(ce.framebuffer)})(y,f,o,f.transform.projection.name==="globe"?.5:.25),y.clear({color:r.ao.transparent});const D=f.transform,F=D.projection.name==="globe",z=F?["PROJECTION_GLOBE_VIEW"]:[],j=F?Vi.frontCCW:Vi.disabled,B=[r.aF(D.center.lng),r.aJ(D.center.lat)];for(let $=0;$<p.length;$++){const Z=p[$];if(t.hasRenderableParent(Z))continue;const Q=t.getTile(Z),ne=Q.getBucket(o);if(!ne||ne.projection.name!==D.projection.name)continue;const te=f.isTileAffectedByFog(Z),se=ne.programConfigurations.get(o.id),me=f.getOrCreateProgram("heatmap",{config:se,defines:z,overrideFog:te}),{zoom:ce}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Q,me),f.uploadCommonUniforms(y,me,Z.toUnwrapped());const Ce=D.projection.createInversionMatrix(D,Z.canonical);me.draw(f,b.TRIANGLES,_i.disabled,T,I,j,hx(f,Z,Q,Ce,B,ce,o.paint.get("heatmap-intensity")),o.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,o.paint,f.transform.zoom,se,F?[ne.globeExtVertexBuffer]:null)}y.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(y,b){const T=y.context,I=T.gl,D=b.heatmapFbo;if(!D)return;T.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,D.colorAttachment.get()),T.activeTexture.set(I.TEXTURE1);let F=b.colorRampTexture;F||(F=b.colorRampTexture=new r.T(T,b.colorRamp,I.RGBA8)),F.bind(I.LINEAR,I.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,I.TRIANGLES,_i.disabled,Gi.disabled,y.colorModeForRenderPass(),Vi.disabled,((z,j,B,$)=>({u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}))(0,b),b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)}(f,o))},line:function(f,t,o,p){if(f.renderPass!=="translucent")return;const y=o.paint.get("line-opacity"),b=o.paint.get("line-width");if(y.constantOr(1)===0||b.constantOr(1)===0)return;const T=o.paint.get("line-emissive-strength"),I=o.paint.get("line-occlusion-opacity"),D=o.layout.get("line-elevation-reference"),F=o.layout.get("line-width-unit")==="meters",z=D==="sea",j=!(!f.terrain||!f.terrain.enabled),B=f.context,$=B.gl;if(o.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const Z=o.layout.get("line-cross-slope"),Q=Z!==void 0,ne=Z<1,te=f.colorModeForDrapableLayerRenderPass(T),se=f.terrain&&f.terrain.renderingToTexture,me=se?1:r.o.devicePixelRatio,ce=o.paint.get("line-dasharray"),Ce=ce.constantOr(1),_e=o.layout.get("line-cap"),Re=ce.constantOr(null),Ae=_e.constantOr(null),Te=o.paint.get("line-pattern"),De=Te.constantOr(1),He=o.paint.get("line-pattern-cross-fade"),Ue=Te.constantOr(null),rt=o.paint.get("line-opacity").constantOr(1);let Qe=!De&&rt!==1||f.depthOcclusion&&I>0&&I<1;const lt=o.paint.get("line-gradient"),Lt=De?"linePattern":"line",Xe=r.e1(o);let Ne;if(se&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(Qe=!1),I!==0&&f.depthOcclusion){const jt=o.paint._values["line-opacity"];jt&&jt.value&&jt.value.kind==="constant"?Ne=jt.value:r.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&Xe.push("VARIABLE_LINE_WIDTH");const ct=(jt,pi,Ft,zt,mi,ni)=>{for(const ii of jt){const ri=t.getTile(ii);if(De&&!ri.patternsLoaded())continue;const Oi=ri.getBucket(o);if(!Oi||Oi.elevationType!=="none"&&!mi||Oi.elevationType==="none"&&mi)continue;f.prepareDrawTile();const wn=[...pi],In=f.shadowRenderer,vr=Oi.elevationType==="road"&&!!In&&In.enabled;let Ui=[0,0,0];if(vr){const Bi=f.style.directionalLight,Bn=f.style.ambientLight;Bi&&Bn&&(Ui=xl(f.style,Bi,Bn)),wn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Dn=Oi.programConfigurations.get(o.id);let tn=!1;if(Ue&&ri.imageAtlas){const Bi=r.e2.from(Ue),Bn=Bi.getPrimary().scaleSelf(me).toString(),Yr=ri.imageAtlas.patternPositions.get(Bn),Eo=Bi.getSecondary(),Qr=Eo?ri.imageAtlas.patternPositions.get(Eo.scaleSelf(me).toString()):null;tn=!!Yr&&!!Qr,Yr&&Dn.setConstantPatternPositions(Yr,Qr)}He>0&&(tn||Dn.getPatternTransitionVertexBuffer("line-pattern"))&&wn.push("LINE_PATTERN_TRANSITION");const mr=f.isTileAffectedByFog(ii),kn=f.getOrCreateProgram(Lt,{config:Dn,defines:wn,overrideFog:mr});if(!De&&Re&&Ae&&ri.lineAtlas){const Bi=ri.lineAtlas.getDash(Re,Ae);Bi&&Dn.setConstantPatternPositions(Bi)}vr&&In.setupShadows(ri.tileID.toUnwrapped(),kn,"vector-tile");let[Cr,Hn]=o.paint.get("line-trim-offset");(Ae==="round"||Ae==="square")&&Cr!==Hn&&(Cr===0&&(Cr-=1),Hn===1&&(Hn+=1));const ln=se?ii.projMatrix:null,rr=F?1/Oi.tileToMeter/r.ay(ri,1,f.transform.zoom):1,dn=F?1/Oi.tileToMeter/r.ay(ri,1,Math.floor(f.transform.zoom)):1,zr=De?r.e3(f,ri,o,ln,me,rr,dn,[Cr,Hn],Ui,He):r.e4(f,ri,o,ln,Oi.lineClipsArray.length,me,rr,dn,[Cr,Hn],Ui);if(lt){const Bi=Oi.gradients[o.id];let Bn=Bi.texture;if(o.gradientVersion!==Bi.version){let Yr=256;if(o.stepInterpolant){const Eo=t.getSource().maxzoom,Qr=ii.canonical.z===Eo?Math.ceil(1<<f.transform.maxZoom-ii.canonical.z):1;Yr=r.aA(r.e5(Oi.maxLineLength/r.al*1024*Qr),256,B.maxTextureSize)}Bi.gradient=r.e6({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Yr,image:Bi.gradient||void 0,clips:Oi.lineClipsArray}),Bi.texture?Bi.texture.update(Bi.gradient):Bi.texture=new r.T(B,Bi.gradient,$.RGBA8),Bi.version=o.gradientVersion,Bn=Bi.texture}B.activeTexture.set($.TEXTURE1),Bn.bind(o.stepInterpolant?$.NEAREST:$.LINEAR,$.CLAMP_TO_EDGE)}Ce&&(B.activeTexture.set($.TEXTURE0),ri.lineAtlasTexture&&ri.lineAtlasTexture.bind($.LINEAR,$.REPEAT),Dn.updatePaintBuffers()),De&&(B.activeTexture.set($.TEXTURE0),ri.imageAtlasTexture&&ri.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),Dn.updatePaintBuffers()),mi&&!z&&f.terrain.setupElevationDraw(ri,kn),f.uploadCommonUniforms(B,kn,ii.toUnwrapped());const Kn=Bi=>{Ne!=null&&(Ne.value=rt*I),kn.draw(f,$.TRIANGLES,Ft,Bi,te,Vi.disabled,zr,o.id,Oi.layoutVertexBuffer,Oi.indexBuffer,Oi.segments,o.paint,f.transform.zoom,Dn,[Oi.layoutVertexBuffer2,Oi.patternVertexBuffer,Oi.zOffsetVertexBuffer]),Ne!=null&&(Ne.value=rt)};if(Qe&&!mi){const Bi=f.stencilModeForClipping(ii).ref;Bi===0&&se&&B.clear({stencil:0});const Bn={func:$.EQUAL,mask:255};zr.u_alpha_discard_threshold=.8,Kn(new Gi(Bn,Bi,255,$.KEEP,$.KEEP,$.INVERT)),zr.u_alpha_discard_threshold=0,Kn(new Gi(Bn,Bi,255,$.KEEP,$.KEEP,$.KEEP))}else zr.u_alpha_discard_threshold=Qe&&mi&&ni?.8:0,Kn(mi?zt:f.stencilModeForClipping(ii))}};let et=f.depthModeForSublayer(0,_i.ReadOnly);const At=new _i(f.depthOcclusion?$.GREATER:$.LEQUAL,_i.ReadOnly,f.depthRangeFor3D);if(o.hasNonElevatedBuckets){const jt=!se&&f.terrain;I!==0&&jt?r.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`):jt?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${o.id}.`):ct(p,Xe,et,Gi.disabled,!1,!0)}if(o.hasElevatedBuckets){D==="hd-road-markup"?j||(et=At,Xe.push("ELEVATED_ROADS")):(Xe.push("ELEVATED"),et=At,Q&&Xe.push(ne?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),z&&Xe.push("ELEVATION_REFERENCE_SEA"));const jt=Qe?f.stencilModeFor3D():Gi.disabled;f.forceTerrainMode=!0,ct(p,Xe,et,jt,!0,!0),Qe&&ct(p,Xe,et,jt,!0,!1),f.forceTerrainMode=!1}Qe&&(f.resetStencilClippingMasks(),se&&B.clear({stencil:0})),I===0||f.depthOcclusion||se||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,t,o,p){const y=o.paint.get("fill-color"),b=o.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const T=o.paint.get("fill-emissive-strength"),I=f.colorModeForDrapableLayerRenderPass(T),D=o.paint.get("fill-pattern"),F=f.opaquePassEnabledForLayer()&&!D.constantOr(1)&&y.constantOr(r.ao.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let z="none";o.layout.get("fill-elevation-reference")!=="none"?z="road":o.paint.get("fill-z-offset").constantOr(1)!==0&&(z="offset");const j=!(!f.terrain||!f.terrain.enabled),B={painter:f,sourceCache:t,layer:o,coords:p,colorMode:I,elevationType:z,terrainEnabled:j,pass:F};if(f.renderPass!=="shadow")if(z!=="offset"){if(cf(B,!1),z==="road"){const $=!j&&f.renderPass==="translucent";$&&yd(f,t,o,p,"geometry"),cf(B,!0,Gi.disabled),$&&function(Z){const{painter:Q,sourceCache:ne,layer:te,coords:se,colorMode:me}=Z,ce=Q.context.gl,Ce=Z.painter.shadowRenderer,_e=!!Ce&&Ce.enabled,Re=new _i(Q.context.gl.LEQUAL,_i.ReadOnly,Q.depthRangeFor3D);let Ae=[0,0,0];if(_e){const De=Q.style.directionalLight,He=Q.style.ambientLight;De&&He&&(Ae=xl(Q.style,De,He))}const Te=De=>{for(const He of se){const Ue=ne.getTile(He),rt=Ue.getBucket(te);if(!rt)continue;const Qe=rt.elevatedStructures;if(!Qe)continue;let lt,Lt;if(De?(lt=Qe.renderableBridgeSegments,Lt=Qe.bridgeProgramConfigurations.get(te.id)):(lt=Qe.renderableTunnelSegments,Lt=Qe.tunnelProgramConfigurations.get(te.id)),!lt||lt.segments[0].primitiveLength===0)continue;Lt.updatePaintBuffers(),Q.prepareDrawTile();const Xe=Q.isTileAffectedByFog(He),Ne=[];_e&&Ne.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ct=Q.getOrCreateProgram("elevatedStructures",{config:Lt,overrideFog:Xe,defines:Ne}),et=Q.translatePosMatrix(He.projMatrix,Ue,te.paint.get("fill-translate"),te.paint.get("fill-translate-anchor"));_e&&Ce.setupShadows(Ue.tileID.toUnwrapped(),ct,"vector-tile");const At=Gb(et,Ae);Q.uploadCommonUniforms(Q.context,ct,He.toUnwrapped()),ct.draw(Q,ce.TRIANGLES,Re,Gi.disabled,me,Vi.backCCW,At,te.id,Qe.vertexBuffer,Qe.indexBuffer,lt,te.paint,Q.transform.zoom,Lt,[Qe.vertexBufferNormal])}};Te(!0),Te(!1)}(B)}}else cf(B,!1,f.stencilModeFor3D());else f.shadowRenderer&&z==="road"&&!j&&function($){const{painter:Z,sourceCache:Q,layer:ne,coords:te}=$,se=Z.context.gl,me=$.painter.shadowRenderer;for(const ce of te){const Ce=Q.getTile(ce),_e=Ce.getBucket(ne);if(!_e)continue;const Re=_e.elevatedStructures;if(!Re||!Re.shadowCasterSegments||Re.shadowCasterSegments.segments[0].primitiveLength===0)continue;Z.prepareDrawTile();const Ae=_e.bufferData.programConfigurations.get(ne.id),Te=Z.isTileAffectedByFog(ce),De=Z.getOrCreateProgram("elevatedStructuresDepth",{config:Ae,overrideFog:Te}),He=me.calculateShadowPassMatrixFromTile(Ce.tileID.toUnwrapped());Z.uploadCommonUniforms(Z.context,De,ce.toUnwrapped());const Ue={u_matrix:He,u_depth_bias:0};De.draw(Z,se.TRIANGLES,me.getShadowPassDepthMode(),Gi.disabled,me.getShadowPassColorMode(),Vi.disabled,Ue,ne.id,Re.vertexBuffer,Re.indexBuffer,Re.shadowCasterSegments,ne.paint,Z.transform.zoom,Ae)}}(B)},"fill-extrusion":function(f,t,o,p){const y=o.paint.get("fill-extrusion-opacity"),b=f.context,T=b.gl,I=f.terrain,D=I&&I.renderingToTexture;if(y===0)return;const F=f.conflationActive&&f.style.isLayerClipped(o,t.getSource()),z=f.style.order.indexOf(o.fqid);if(F&&function(j,B,$,Z,Q){for(const ne of Z){const te=B.getTile(ne).getBucket($);te&&(te.updateReplacement(ne,j.replacementSource,Q),te.uploadCentroid(j.context))}}(f,t,o,p,z),I||F)for(const j of p){const B=t.getTile(j).getBucket(o);B&&zu(f.context,t,j,B,o,I,F)}if(f.renderPass==="shadow"&&f.shadowRenderer){const j=f.shadowRenderer;if(I&&y<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ad)return;const B=j.getShadowPassDepthMode(),$=j.getShadowPassColorMode();li(f,t,o,p,B,Gi.disabled,$,F)}else if(f.renderPass==="translucent"){const j=!o.paint.get("fill-extrusion-pattern").constantOr(1),B=o.paint.get("fill-extrusion-color").constantOr(r.ao.white);if(!D&&B.a!==0){const $=new _i(f.context.gl.LEQUAL,_i.ReadWrite,f.depthRangeFor3D);y===1&&j?li(f,t,o,p,$,Gi.disabled,sn.unblended,F):(li(f,t,o,p,$,Gi.disabled,sn.disabled,F),li(f,t,o,p,$,f.stencilModeFor3D(),f.colorModeForRenderPass(),F),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&j&&(!I&&f.transform.projection.name!=="globe"||D)){const $=o.paint.get("fill-extrusion-opacity"),Z=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),Q=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ne=o.paint.get("fill-extrusion-flood-light-intensity"),te=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",se=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(te?null:o.lut).toArray01().slice(0,3),me=Z>0&&Q>0,ce=ne>0,Ce=(Ae,Te,De)=>(1-De)*Ae+De*Te,_e=new J_;_e.translate=o.paint.get("fill-extrusion-translate"),_e.translateAnchor=o.paint.get("fill-extrusion-translate-anchor"),_e.edgeRadius=o.layout.get("fill-extrusion-edge-radius"),_e.cutoffFadeRange=o.paint.get("fill-extrusion-cutoff-fade-range");const Re=Ae=>{const Te=f.depthModeForSublayer(1,_i.ReadOnly,T.LEQUAL,!0),De=o.paint.get(Ae?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),He=Ce(.1,3,De),Ue=f._showOverdrawInspector;if(!Ue){const rt=new Gi({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Qe=new sn([T.ONE,T.ONE,T.ONE,T.ONE],r.ao.transparent,[!1,!1,!1,!0],T.MIN);Wc(_e,f,t,o,p,Te,rt,Qe,Vi.disabled,Ae,"sdf",$,Z,Q,ne,se,He,F,!1)}{const rt=Ue?Gi.disabled:new Gi({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),Qe=Ue?f.colorModeForRenderPass():new sn([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],r.ao.transparent,[!0,!0,!0,!0]);Wc(_e,f,t,o,p,Te,rt,Qe,Vi.disabled,Ae,"color",$,Z,Q,ne,se,He,F,!1)}};if(D){const Ae=(Te,De,He)=>{const Ue=f.depthModeForSublayer(1,_i.ReadOnly,T.LEQUAL,!1),rt=o.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Qe=Ce(.1,3,rt);{const lt=new sn([T.ONE,T.ONE,T.ONE,T.ONE],r.ao.transparent,[!1,!1,!1,!0]);Wc(_e,f,t,o,p,Ue,Gi.disabled,lt,Vi.disabled,Te,"clear",$,Z,Q,ne,se,Qe,F,De)}{const lt=new Gi({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Lt=new sn([T.ONE,T.ONE,T.ONE,T.ONE],r.ao.transparent,[!1,!1,!1,!0],T.MIN);Wc(_e,f,t,o,p,Ue,lt,Lt,Vi.disabled,Te,"sdf",$,Z,Q,ne,se,Qe,F,De)}{const lt=Te?T.ZERO:T.ONE_MINUS_DST_ALPHA,Lt=new Gi({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),Xe=new sn([lt,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],r.ao.transparent,[!0,!0,!0,!0]);Wc(_e,f,t,o,p,Ue,Lt,Xe,Vi.disabled,Te,"color",$,Z,Q,ne,se,Qe,F,De)}{const lt=new sn([T.ONE,T.ONE,T.ONE,Te?T.ZERO:T.ONE],r.ao.transparent,[!1,!1,!1,!0],Te?T.FUNC_ADD:T.MAX);Wc(_e,f,t,o,p,Ue,Gi.disabled,lt,Vi.disabled,Te,"clear",$,Z,Q,ne,se,Qe,F,De,He)}};if(me||ce){let Te;if(f.prepareDrawTile(),I){const De=I.drapeBufferSize[0],He=I.drapeBufferSize[1];Te=I.framebufferCopyTexture,Te&&(!Te||Te.size[0]===De&&Te.size[1]===He)||(Te&&Te.destroy(),Te=I.framebufferCopyTexture=new r.T(b,new r.q({width:De,height:He}),T.RGBA8)),Te.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,De,He)}me&&Ae(!0,!1,Te),ce&&Ae(!1,!0,Te)}}else me&&Re(!0),ce&&Re(!1),(me||ce)&&f.resetStencilClippingMasks()}}},building:function(f,t,o,p){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const y=o.paint.get("building-ambient-occlusion-ground-intensity"),b=o.paint.get("building-ambient-occlusion-ground-radius"),T=o.paint.get("building-ambient-occlusion-ground-attenuation"),I=o.paint.get("building-opacity");if(I<=0)return;let D=y>0&&b>0,F=!0;const z=o.paint.get("building-vertical-scale");if(z<=0)return;(!f.shadowRenderer||z<1)&&(F=!1);const j=f.conflationActive&&f.style.isLayerClipped(o,t.getSource()),B=f.style.order.indexOf(o.fqid);if(function($,Z,Q,ne,te,se){for(const me of se){const ce=Z.getTile(me).getBucket(Q);ce&&(te&&ce.updateReplacement(me,$.replacementSource,ne),ce.uploadUpdatedIndexBuffer($.context))}}(f,t,o,B,j,p),function($,Z,Q,ne){for(const te of ne){const se=Z.getTile(te).getBucket(Q);se&&se.needsEvaluation()&&se.uploadUpdatedColorBuffer($.context)}}(f,t,o,p),o.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){const $=f.shadowRenderer,Z=[],Q=$.getShadowPassDepthMode();hg({painter:f,source:t,layer:o,coords:p,defines:Z,blendMode:$.getShadowPassColorMode(),depthMode:Q,opacity:I,verticalScale:z,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(f.renderPass==="translucent"){let $=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];F&&($=$.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer&&f.shadowRenderer.useNormalOffset&&($=$.concat("NORMAL_OFFSET"));const Z=o.paint.get("building-facade-emissive-chance"),Q=o.paint.get("building-ambient-occlusion-intensity"),ne=o.paint.get("building-flood-light-intensity"),te=o.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",se=o.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(te?null:o.lut).toArray01().slice(0,3),me=o.paint.get("building-flood-light-ground-attenuation"),ce=ne>0,Ce=new _i(f.context.gl.LEQUAL,_i.ReadWrite,f.depthRangeFor3D);I<1&&hg({painter:f,source:t,layer:o,coords:p,defines:$,blendMode:sn.disabled,depthMode:Ce,opacity:I,verticalScale:z,facadeEmissiveChance:Z,facadeAOIntensity:Q,floodLightIntensity:ne,floodLightColor:se,depthOnly:!0});const _e=f.colorModeForRenderPass();hg({painter:f,source:t,layer:o,coords:p,defines:$,blendMode:_e,depthMode:Ce,opacity:I,verticalScale:z,facadeEmissiveChance:Z,facadeAOIntensity:Q,floodLightIntensity:ne,floodLightColor:se}),D&&dg(f,t,o,p,!0,I,y,b,ne,se,T,j),ce&&dg(f,t,o,p,!1,I,y,b,ne,se,me,j)}else if(f.renderPass==="light-beam"){const $=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],Z=new _i(f.context.gl.LEQUAL,_i.ReadOnly,f.depthRangeFor3D);hg({painter:f,source:t,layer:o,coords:p,defines:$,blendMode:sn.alphaBlended,depthMode:Z,opacity:I,verticalScale:z,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,t,o,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const y=f.context,b=f.terrain&&f.terrain.renderingToTexture,[T,I]=f.renderPass!=="translucent"||b?[{},p]:f.stencilConfigForOverlap(p);for(const D of I){const F=t.getTile(D);if(F.needsHillshadePrepare&&f.renderPass==="offscreen")nx(f,F,o);else if(f.renderPass==="translucent"){const z=f.depthModeForSublayer(0,_i.ReadOnly),j=o.paint.get("hillshade-emissive-strength"),B=f.colorModeForDrapableLayerRenderPass(j),$=b&&f.terrain?f.terrain.stencilModeForRTTOverlap(D):T[D.overscaledZ];ix(f,D,F,o,z,$,B)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,t,o,p,y,b){if(f.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;const T=f.transform.projection.name==="globe",I=o.paint.get("raster-elevation")!==0,D=I&&T;if(f.renderElevatedRasterBackface&&!D)return;const F=f.context,z=F.gl,j=t.getSource(),B=function(_e,Re,Ae,Te){const De=Re.paint.get("raster-color"),He=_e.type==="raster-array",Ue=[],rt=Re.paint.get("raster-resampling"),Qe=Re.paint.get("raster-color-mix");let lt=Re.paint.get("raster-color-range");const Lt=[Qe[0],Qe[1],Qe[2],0],Xe=Qe[3];let Ne=rt==="nearest"?Te.NEAREST:Te.LINEAR;if(He&&(Ue.push("RASTER_ARRAY"),De||Ue.push("RASTER_COLOR"),rt==="linear"&&Ue.push("RASTER_ARRAY_LINEAR"),Ne=Te.NEAREST,!lt&&_e.rasterLayers)){const ct=_e.rasterLayers.find(({id:et})=>et===Re.sourceLayer);ct&&ct.fields&&ct.fields.range&&(lt=ct.fields.range)}if(lt=lt||[0,1],De){Ue.push("RASTER_COLOR"),Ae.activeTexture.set(Te.TEXTURE2),Re.updateColorRamp(lt);let ct=Re.colorRampTexture;ct||(ct=Re.colorRampTexture=new r.T(Ae,Re.colorRamp,Te.RGBA8)),ct.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}return{mix:Lt,range:lt,offset:Xe,defines:Ue,resampling:Ne}}(j,o,F,z);if(j instanceof r.aT&&!p.length&&!T)return;const $=o.paint.get("raster-emissive-strength"),Z=f.colorModeForDrapableLayerRenderPass($),Q=f.terrain&&f.terrain.renderingToTexture,ne=!f.options.moving,te=o.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;if(j instanceof r.aT&&!p.length&&(j.onNorthPole||j.onSouthPole)){const _e=I?f.stencilModeFor3D():Gi.disabled;return void ey(!!j.onNorthPole,null,f,t,o,$,B,Vi.disabled,_e)}if(!p.length)return;const[se,me]=j instanceof r.aT||Q?[{},p]:f.stencilConfigForOverlap(p),ce=me[me.length-1].overscaledZ;D&&B.defines.push("PROJECTION_GLOBE_VIEW"),I&&B.defines.push("RENDER_CUTOFF");const Ce=(_e,Re,Ae)=>{for(const Te of _e){const De=Te.toUnwrapped(),He=t.getTile(Te);if(Q&&(!He||!He.hasData()))continue;F.activeTexture.set(z.TEXTURE0);const Ue=$b(He,j,o,B);if(!Ue||!Ue.texture)continue;const{texture:rt,mix:Qe,offset:lt,tileSize:Lt,buffer:Xe}=Ue;let Ne,ct;Q?(Ne=_i.disabled,ct=Te.projMatrix):I?(Ne=new _i(z.LEQUAL,_i.ReadWrite,f.depthRangeFor3D),ct=T?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(De,ne)):(Ne=f.depthModeForSublayer(Te.overscaledZ-ce,o.paint.get("raster-opacity")===1?_i.ReadWrite:_i.ReadOnly,z.LESS),ct=f.transform.calculateProjMatrix(De,ne));const et=f.terrain&&Q?f.terrain.stencilModeForRTTOverlap(Te):se[Te.overscaledZ],At=b?0:o.paint.get("raster-fade-duration");He.registerFadeDuration(At);const jt=t.findLoadedParent(Te,0),pi=eg(He,jt,t,f.transform,At);let Ft,zt;!pi.isFading&&He.refreshedUponExpiration&&(He.refreshedUponExpiration=!1),f.terrain&&f.terrain.prepareDrawTile(),F.activeTexture.set(z.TEXTURE0),rt.bind(te,z.CLAMP_TO_EDGE),F.activeTexture.set(z.TEXTURE1),jt?(jt.texture&&jt.texture.bind(te,z.CLAMP_TO_EDGE),Ft=Math.pow(2,jt.tileID.overscaledZ-He.tileID.overscaledZ),zt=[He.tileID.canonical.x*Ft%1,He.tileID.canonical.y*Ft%1]):rt.bind(te,z.CLAMP_TO_EDGE),"useMipmap"in rt&&F.extTextureFilterAnisotropic&&f.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,F.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,F.extTextureFilterAnisotropicMax);const mi=f.transform;let ni;const ii=I?ty(mi):[0,0,0,0];let ri,Oi,wn,In,vr,Ui=0;if(D&&j instanceof r.aT&&j.coordinates.length>3)ri=Float32Array.from(r.bj(r.dI(new r.cC(0,0,0)))),Oi=Float32Array.from(mi.globeMatrix),wn=Float32Array.from(r.dE(mi)),In=[r.aF(mi.center.lng),r.aJ(mi.center.lat)],ni=j.elevatedGlobePerspectiveTransform,vr=j.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){const kn=r.dF(Te.canonical);Ui=r.dG(kn.getCenter().lat),ri=Float32Array.from(r.bj(r.dI(Te.canonical))),Oi=Float32Array.from(mi.globeMatrix),wn=Float32Array.from(r.dE(mi)),In=[r.aF(mi.center.lng),r.aJ(mi.center.lat)],ni=[0,0],vr=Float32Array.from(r.dH(Te.canonical,kn,Ui,mi.worldSize/mi._pixelsPerMercatorPixel))}else ni=j instanceof r.aT?j.perspectiveTransform:[0,0],ri=new Float32Array(16),Oi=new Float32Array(9),wn=new Float32Array(16),In=[0,0],vr=new Float32Array(9);const Dn=ya(ct,ri,Oi,wn,vr,zt||[0,0],r.aj(f.transform.zoom),In,ii,Ft||1,pi,o,ni,I?o.paint.get("raster-elevation"):0,2,Qe,lt,B.range,Lt,Xe,$),tn=f.isTileAffectedByFog(Te),mr=f.getOrCreateProgram("raster",{defines:B.defines,overrideFog:tn});if(f.uploadCommonUniforms(F,mr,De),j instanceof r.aT){const kn=j.elevatedGlobeVertexBuffer,Cr=j.elevatedGlobeIndexBuffer;if(Q||!T)j.boundsBuffer&&j.boundsSegments&&mr.draw(f,z.TRIANGLES,Ne,Gi.disabled,Z,Vi.disabled,Dn,o.id,j.boundsBuffer,f.quadTriangleIndexBuffer,j.boundsSegments);else if(kn&&Cr){const Hn=mi.zoom<=r.cZ?j.elevatedGlobeSegments:j.getSegmentsForLongitude(mi.center.lng);Hn&&mr.draw(f,z.TRIANGLES,Ne,Gi.disabled,Z,Re,Dn,o.id,kn,Cr,Hn)}}else if(D){Ne=new _i(z.LEQUAL,_i.ReadOnly,f.depthRangeFor3D);const kn=f.globeSharedBuffers;if(kn){const[Cr,Hn,ln]=kn.getGridBuffers(Ui,!1);mr.draw(f,z.TRIANGLES,Ne,Ae||et,f.colorModeForRenderPass(),Re,Dn,o.id,Cr,Hn,ln)}}else{const{tileBoundsBuffer:kn,tileBoundsIndexBuffer:Cr,tileBoundsSegments:Hn}=f.getTileBoundsBuffers(He);mr.draw(f,z.TRIANGLES,Ne,et,Z,Vi.disabled,Dn,o.id,kn,Cr,Hn)}}if(!(j instanceof r.aT)&&D)for(const Te of _e){const De=Te.canonical.y===(1<<Te.canonical.z)-1;Te.canonical.y===0&&ey(!0,Te,f,t,o,$,B,Re,Ae||Gi.disabled),De&&ey(!1,Te,f,t,o,$,B,Re===Vi.frontCW?Vi.backCW:Vi.frontCW,Ae||Gi.disabled)}};D?Ce(me,f.renderElevatedRasterBackface?Vi.backCW:Vi.frontCW,f.stencilModeFor3D()):Ce(me,Vi.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,t,o,p,y,b){f.renderPass==="offscreen"&&function(T,I,D,F){if(!F.length)return;const z=T.context,j=z.gl,B=I.getSource();if(!(B instanceof ko))return;const $=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count")));let Z=D.particlePositionRGBAImage;if(!Z||Z.width!==$){const me=function(ce){const Ce=ce*ce,_e=new Uint8Array(4*Ce),Re=function(Te){return Te|=0,Te=Math.imul(2747636419^Te,2654435769),Te=Math.imul(Te^Te>>>16,2654435769),((Te=Math.imul(Te^Te>>>16,2654435769))>>>0)/4294967296},Ae=1/1.1;for(let Te=0;Te<Ce;Te++){const De=Ae*(Re(2*Te+0)+Gc),He=Ae*(Re(2*Te+1)+Gc),Ue=255*De%1,rt=255*He%1,Qe=Ue,lt=He-rt/255,Lt=rt;_e[4*Te+0]=255*(De-Ue/255),_e[4*Te+1]=255*Qe,_e[4*Te+2]=255*lt,_e[4*Te+3]=255*Lt}return _e}($);Z=D.particlePositionRGBAImage=new r.q({width:$,height:$},me)}let Q=D.particleFramebuffer;Q?Q.width!==$&&(Q.destroy(),Q=D.particleFramebuffer=z.createFramebuffer($,$,!0,null)):Q=D.particleFramebuffer=z.createFramebuffer($,$,!0,null);const ne=[];for(const me of F){const ce=I.getTile(me);if(!(ce instanceof vo))continue;const Ce=Cn(ce,B,D);if(!Ce)continue;const _e=[ce.tileSize,ce.tileSize];let Re=D.tileFramebuffer;Re||(Re=D.tileFramebuffer=z.createFramebuffer(_e[0],_e[1],!0,null));let Ae=ce.rasterParticleState;Ae||(Ae=ce.rasterParticleState=new Ss(z,me,_e,Z));const Te=Ae.update(D.lastInvalidatedAt);Ae.particleTextureDimension!==$&&Ae.updateParticleTexture(me,Z);const De=Ae.targetColorTexture;Ae.targetColorTexture=Ae.backgroundColorTexture,Ae.backgroundColorTexture=De;const He=Ae.particleTexture0;Ae.particleTexture0=Ae.particleTexture1,Ae.particleTexture1=He,ne.push([me,Ce,Ae,Te])}if(ne.length===0)return;const te=r.o.now(),se=D.previousDrawTimestamp?.001*(te-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=te,D.hasColorMap()){z.activeTexture.set(j.TEXTURE0+2);let me=D.colorRampTexture;me||(me=D.colorRampTexture=new r.T(z,D.colorRamp,j.RGBA8)),me.bind(j.LINEAR,j.CLAMP_TO_EDGE)}z.bindFramebuffer.set(D.tileFramebuffer.framebuffer),function(me,ce,Ce){const _e=me.context,Re=_e.gl,Ae=ce.tileFramebuffer;_e.activeTexture.set(Re.TEXTURE0);const Te={u_texture:0,u_opacity:1.05*(He=ce.paint.get("raster-particle-fade-opacity-factor"))/(He+.05)},De=me.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var He;for(const Ue of Ce){const[,,rt,Qe]=Ue;Ae.colorAttachment.set(rt.targetColorTexture.texture),_e.viewport.set([0,0,Ae.width,Ae.height]),_e.clear({color:r.ao.transparent}),Qe&&(rt.backgroundColorTexture.bind(Re.NEAREST,Re.CLAMP_TO_EDGE),De.draw(me,Re.TRIANGLES,_i.disabled,Gi.disabled,sn.alphaBlended,Vi.disabled,Te,ce.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments))}}(T,D,ne),function(me,ce,Ce,_e){const Re=me.context,Ae=Re.gl,Te=Ce.tileFramebuffer,De=me.transform.projection.name==="globe",He=Ce.paint.get("raster-particle-max-speed");for(const Ue of _e){const[rt,Qe,lt]=Ue;Re.activeTexture.set(Ae.TEXTURE0+0),Qe.texture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Te.colorAttachment.set(lt.targetColorTexture.texture);const Lt=me.getOrCreateProgram("rasterParticleDraw",{defines:Qe.defines,overrideFog:!1});Re.activeTexture.set(Ae.TEXTURE0+1);const Xe=Qe.scalarData?[]:[0,1,2,3].map(et=>r.e8[et](rt));Xe.push(rt);const Ne=rt.canonical.x,ct=rt.canonical.y;for(const et of Xe){const At=ce.getTile(De?et.wrapped():et);if(!At)continue;const jt=At.rasterParticleState;if(!jt)continue;const pi=et.canonical.x+(1<<et.canonical.z)*(et.wrap-rt.wrap),Ft=et.canonical.y;jt.particleTexture0.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);const zt=Fu(1,jt.particleTexture0.size[0],[pi-Ne,Ft-ct],0,Qe.texture.size,2,He,Qe.textureOffset,Qe.scale,Qe.offset);Lt.draw(me,Ae.POINTS,_i.disabled,Gi.disabled,sn.alphaBlended,Vi.disabled,zt,Ce.id,jt.particleIndexBuffer,void 0,jt.particleSegment)}}}(T,I,D,ne),z.bindFramebuffer.set(D.particleFramebuffer.framebuffer),function(me,ce,Ce,_e){const Re=me.context,Ae=Re.gl,Te=ce.paint.get("raster-particle-max-speed"),De=_e*ce.paint.get("raster-particle-speed-factor")*.15,He=function(rt){return Math.pow(rt,6)}(.01+1*ce.paint.get("raster-particle-reset-rate-factor")),Ue=ce.particleFramebuffer;Re.viewport.set([0,0,Ue.width,Ue.height]);for(const rt of Ce){const[,Qe,lt]=rt;Re.activeTexture.set(Ae.TEXTURE0+0),Qe.texture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),Re.activeTexture.set(Ae.TEXTURE0+1);const Lt=lt.particleTexture0;Lt.bind(Ae.NEAREST,Ae.CLAMP_TO_EDGE);const Xe=ag(1,Lt.size[0],0,Qe.texture.size,Te,De,He,Qe.textureOffset,Qe.scale,Qe.offset);Ue.colorAttachment.set(lt.particleTexture1.texture),Re.clear({color:r.ao.transparent}),me.getOrCreateProgram("rasterParticleUpdate",{defines:Qe.defines}).draw(me,Ae.TRIANGLES,_i.disabled,Gi.disabled,sn.unblended,Vi.disabled,Xe,ce.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments)}}(T,D,ne,se)}(f,t,o,p),f.renderPass==="translucent"&&(function(T,I,D,F,z){const j=T.context,B=j.gl,$=I.getSource().tileSize,Z=5*(1-r.ah(r.cK,r.cK+1,T.transform.zoom))*$+D.paint.get("raster-particle-elevation"),Q=!T.options.moving,ne=T.transform.projection.name==="globe";if(!F.length)return;const[te,se]=T.stencilConfigForOverlap(F),me=[];ne&&me.push("PROJECTION_GLOBE_VIEW");const ce=T.stencilModeFor3D();for(const Ce of se){const _e=Ce.toUnwrapped(),Re=I.getTile(Ce);if(!Re.rasterParticleState)continue;const Ae=Re.rasterParticleState,Te=100;Re.registerFadeDuration(Te);const De=I.findLoadedParent(Ce,0),He=eg(Re,De,I,T.transform,Te);let Ue,rt;T.terrain&&T.terrain.prepareDrawTile(),j.activeTexture.set(B.TEXTURE0),Ae.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),j.activeTexture.set(B.TEXTURE1),De&&De.rasterParticleState?(De.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Ue=Math.pow(2,De.tileID.overscaledZ-Re.tileID.overscaledZ),rt=[Re.tileID.canonical.x*Ue%1,Re.tileID.canonical.y*Ue%1]):Ae.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const Qe=ne?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(_e,Q),lt=T.transform,Lt=Nn(lt),Xe=r.dF(Ce.canonical),Ne=r.dG(Xe.getCenter().lat);let ct,et,At,jt,pi;ne?(ct=Float32Array.from(r.bj(r.dI(Ce.canonical))),et=Float32Array.from(lt.globeMatrix),At=Float32Array.from(r.dE(lt)),jt=[r.aF(lt.center.lng),r.aJ(lt.center.lat)],pi=Float32Array.from(r.dH(Ce.canonical,Xe,Ne,lt.worldSize/lt._pixelsPerMercatorPixel))):(ct=new Float32Array(16),et=new Float32Array(9),At=new Float32Array(16),jt=[0,0],pi=new Float32Array(9));const Ft=Hc(Qe,ct,et,At,pi,rt||[0,0],r.aj(T.transform.zoom),jt,Lt,Ue||1,He,Z),zt=T.isTileAffectedByFog(Ce),mi=T.getOrCreateProgram("rasterParticle",{defines:me,overrideFog:zt});if(T.uploadCommonUniforms(j,mi,_e),ne){const ni=new _i(B.LEQUAL,_i.ReadOnly,T.depthRangeFor3D),ii=0,ri=T.globeSharedBuffers;if(ri){const[Oi,wn,In]=ri.getGridBuffers(Ne,ii!==0);mi.draw(T,B.TRIANGLES,ni,ce,sn.alphaBlended,T.renderElevatedRasterBackface?Vi.frontCCW:Vi.backCCW,Ft,D.id,Oi,wn,In)}}else{const ni=T.depthModeForSublayer(0,_i.ReadOnly),ii=te[Ce.overscaledZ],{tileBoundsBuffer:ri,tileBoundsIndexBuffer:Oi,tileBoundsSegments:wn}=T.getTileBoundsBuffers(Re);mi.draw(T,B.TRIANGLES,ni,ii,sn.alphaBlended,Vi.disabled,Ft,D.id,ri,Oi,wn)}}T.resetStencilClippingMasks()}(f,t,o,p),f.style.map.triggerRepaint())},background:function(f,t,o,p){const y=o.paint.get("background-color"),b=o.paint.get("background-color-use-theme").constantOr("default")==="none",T=o.paint.get("background-opacity"),I=o.paint.get("background-emissive-strength"),D=o.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const F=f.context,z=F.gl,j=f.transform,B=j.tileSize,$=o.paint.get("background-pattern");let Z;if($!==void 0&&($===null||(Z=f.imageManager.getPattern(r.I.from($.toString()),o.scope,f.style.getLut(o.scope)),!Z)))return;const Q=!$&&y.a===1&&T===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==Q)return;const ne=Gi.disabled,te=f.depthModeForSublayer(0,Q==="opaque"?_i.ReadWrite:_i.ReadOnly),se=f.colorModeForDrapableLayerRenderPass(I),me=$?"backgroundPattern":"background";let ce,Ce=p;if(Ce||(ce=f.getBackgroundTiles(),Ce=Object.values(ce).map(_e=>_e.tileID)),$&&(F.activeTexture.set(z.TEXTURE0),f.imageManager.bind(f.context,o.scope)),D){const _e=f.getOrCreateProgram(me,{overrideFog:!1,overrideRtt:!0}),Re=new Float32Array(r.bz([])),Ae=new r.aP(0,0,0,0,0),Te=$?Lu(Re,I,T,f,0,o.scope,Z,D,{tileID:Ae,tileSize:B}):sg(Re,I,T,y.toPremultipliedRenderColor(b?null:o.lut));_e.draw(f,z.TRIANGLES,te,ne,se,Vi.disabled,Te,o.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const _e of Ce){const Re=f.isTileAffectedByFog(_e),Ae=f.getOrCreateProgram(me,{overrideFog:Re}),Te=_e.toUnwrapped(),De=p?_e.projMatrix:f.transform.calculateProjMatrix(Te);f.prepareDrawTile();const He=t?t.getTile(_e):ce?ce[_e.key]:new Go(_e,B,j.zoom,f),Ue=$?Lu(De,I,T,f,0,o.scope,Z,D,{tileID:_e,tileSize:B}):sg(De,I,T,y.toPremultipliedRenderColor(b?null:o.lut));f.uploadCommonUniforms(F,Ae,Te);const{tileBoundsBuffer:rt,tileBoundsIndexBuffer:Qe,tileBoundsSegments:lt}=f.getTileBoundsBuffers(He);Ae.draw(f,z.TRIANGLES,te,ne,se,Vi.disabled,Ue,o.id,rt,Qe,lt)}},sky:function(f,t,o){const p=f._atmosphere?r.aj(f.transform.zoom):1,y=o.paint.get("sky-opacity")*p;if(y===0)return;const b=f.context,T=o.paint.get("sky-type"),I=new _i(b.gl.LEQUAL,_i.ReadOnly,[0,1]),D=f.frameCounter/1e3%1;T==="atmosphere"?f.renderPass==="offscreen"?o.needsSkyboxCapture(f)&&(function(F,z,j,B){const $=F.context,Z=$.gl;let Q=z.skyboxFbo;if(!Q){Q=z.skyboxFbo=$.createFramebuffer(32,32,!0,null),z.skyboxGeometry=new Nu($),z.skyboxTexture=$.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,z.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let me=0;me<6;++me)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+me,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}$.bindFramebuffer.set(Q.framebuffer),$.viewport.set([0,0,32,32]);const ne=z.getCenter(F,!0),te=F.getOrCreateProgram("skyboxCapture"),se=new Float64Array(16);r.bz(se),r.em(se,se,.5*-Math.PI),Ea(F,z,te,se,ne,0),r.bz(se),r.em(se,se,.5*Math.PI),Ea(F,z,te,se,ne,1),r.bz(se),r.cT(se,se,.5*-Math.PI),Ea(F,z,te,se,ne,2),r.bz(se),r.cT(se,se,.5*Math.PI),Ea(F,z,te,se,ne,3),r.bz(se),Ea(F,z,te,se,ne,4),r.bz(se),r.em(se,se,Math.PI),Ea(F,z,te,se,ne,5),$.viewport.set([0,0,F.width,F.height])}(f,o),o.markSkyboxValid(f)):f.renderPass==="sky"&&function(F,z,j,B,$){const Z=F.context,Q=Z.gl,ne=F.transform,te=F.getOrCreateProgram("skybox");Z.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_CUBE_MAP,z.skyboxTexture);const se=((me,ce,Ce,_e,Re)=>({u_matrix:me,u_sun_direction:ce,u_cubemap:0,u_opacity:_e,u_temporal_offset:Re}))(ne.skyboxMatrix,z.getCenter(F,!1),0,B,$);F.uploadCommonUniforms(Z,te),te.draw(F,Q.TRIANGLES,j,Gi.disabled,F.colorModeForRenderPass(),Vi.backCW,se,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(f,o,I,y,D):T==="gradient"&&f.renderPass==="sky"&&function(F,z,j,B,$){const Z=F.context,Q=Z.gl,ne=F.transform,te=F.getOrCreateProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new Nu(Z)),Z.activeTexture.set(Q.TEXTURE0);let se=z.colorRampTexture;se||(se=z.colorRampTexture=new r.T(Z,z.colorRamp,Q.RGBA8)),se.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const me=((ce,Ce,_e,Re,Ae)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:Ce,u_radius:r.an(_e),u_opacity:Re,u_temporal_offset:Ae}))(ne.skyboxMatrix,z.getCenter(F,!1),z.paint.get("sky-gradient-radius"),B,$);F.uploadCommonUniforms(Z,te),te.draw(F,Q.TRIANGLES,j,Gi.disabled,F.colorModeForRenderPass(),Vi.backCW,me,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(f,o,I,y,D)},custom:function(f,t,o,p){const y=f.context,b=o.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&o.isDraped(t)){if(f.renderPass==="offscreen"){const T=b.prerender;if(T){if(f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const I=f.transform.pointMerc;T.call(b,y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),r.aj(f.transform.zoom),[I.x,I.y],f.transform.pixelsPerMeterRatio)}else T.call(b,y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const I=b.renderToTile;if(I){const D=p[0].canonical,F={x:D.x+p[0].wrap*(b.wrapTileId?0:1<<D.z),y:D.y,z:D.z};y.setDepthMode(_i.disabled),y.setStencilMode(Gi.disabled),y.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),I.call(b,y.gl,F),y.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),y.setStencilMode(Gi.disabled);const T=b.renderingMode==="3d"?new _i(f.context.gl.LEQUAL,_i.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,_i.ReadOnly);if(y.setDepthMode(T),f.transform.projection.name==="globe"){const I=f.transform.pointMerc;b.render(y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),r.aj(f.transform.zoom),[I.x,I.y],f.transform.pixelsPerMeterRatio)}else b.render(y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState(),y.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,t,o,p){if(f.renderPass==="opaque")return;const y=o.paint.get("model-opacity").constantOr(1),b=o.paint.get("model-elevation-reference"),T=b==="ground",I=b==="ground";if(y===0)return;const D=o.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!D||f.terrain&&y<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof r.ad))return;const F=f.shadowRenderer,z=o.paint.get("model-receive-shadows");F&&(F.useNormalOffset=!0,z||(F.enabled=!1));const j=()=>{F&&(F.useNormalOffset=!0,z||(F.enabled=!0))},B=t.getSource();if(f.renderPass==="light-beam"&&B.type!=="batched-model")return;if(B.type==="vector"||B.type==="geojson")return function(ce,Ce,_e,Re,Ae){const Te=ce.transform,De=Te.projection.name==="globe",He=Te.getFreeCameraOptions().position;if(!ce.modelManager)return;const Ue=ce.modelManager;_e.modelManager=Ue;const rt=ce.shadowRenderer;if(!_e._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Qe=_e._unevaluatedLayout._values["model-id"],lt=Object.assign({},_e.layout.get("model-id").parameters),Lt=ce.style.order.indexOf(_e.fqid);for(const Xe of Re){const Ne=Ce.getTile(Xe).getBucket(_e);if(!Ne||Ne.projection.name!==Te.projection.name)continue;const ct=Ne.getModelUris();if(ct&&!Ne.modelsRequested&&(Ue.addModelsFromBucket(ct,Ae),Ne.modelsRequested=!0),De)lt.zoom=Xe.overscaledZ;else{const ni=Lp(Xe,Te);lt.zoom=ni}const et=Qe.possiblyEvaluate(lt);if(gg(ce,Ne,Xe),Ls.shadowUniformsInitialized=!1,Ls.useSingleShadowCascade=!!rt&&rt.getMaxCascadeForTile(Xe.toUnwrapped())===0,ce.renderPass==="shadow"&&rt){if(ce.currentShadowCascade===1&&Ne.isInsideFirstShadowMapFrustum)continue;const ni=Te.calculatePosMatrix(Xe.toUnwrapped(),Te.worldSize);if(Ls.tileMatrix.set(ni),Ls.shadowTileMatrix=Float32Array.from(rt.calculateShadowPassMatrixFromMatrix(ni)),Ls.aabb.min=[0,0,0],Ls.aabb.max[0]=Ls.aabb.max[1]=r.al,Ls.aabb.max[2]=0,ff(Ne,Ls,ce,_e.scope))continue}const At=1<<Xe.canonical.z,jt=[((He.x-Xe.wrap)*At-Xe.canonical.x)*r.al,(He.y*At-Xe.canonical.y)*r.al,He.z*At*r.al];ce.conflationActive&&Object.keys(Ne.instancesPerModel).length>0&&ce.style.isLayerClipped(_e,Ce.getSource())&&Ne.updateReplacement(Xe,ce.replacementSource,Lt,Ae)&&(Ne.uploaded=!1,Ne.upload(ce.context));let pi=0;const Ft=new Array,zt=new Array,mi=new Array;for(let ni in Ne.instancesPerModel){const ii=Ne.instancesPerModel[ni];ii.features.length>0&&!De&&(ni=et.evaluate(ii.features[0].feature,{}));const ri=Ue.getModel(ni,Ae);if(ri||Ue.hasURLBeenRequested(ni)||Ne.modelUris.includes(ni)||(Ne.modelUris.push(ni),Ne.modelsRequested=!1),ri&&ri.uploaded)if(De){const Oi=r.c4([],[He.x,He.y,He.z],ce.transform.worldSize);r.ev(Oi,Oi);for(let wn=0;wn<ii.instancedDataArray.length;++wn){const In=[0,0,0],vr=[1,1,1],Ui=r.ew(),Dn=ii.tileCoordinatesForInstance(wn),tn=ii.transformForInstance(wn);r.ex(vr,tn),r.ey(Ui,tn),r.ez(In,Ui);const mr=ii.translationForInstance(wn),kn=new r.aS(0,0);r.eA(Ne.canonical,kn,Dn.x,Dn.y);const Cr=r.bB();r.eB(Cr,ri,ce.transform,kn,In,vr,mr,!0,!1,!1);const Hn=ii.colorForInstance(wn),ln=r.bz([]),rr=r.ee(kn.lat,ce.transform.zoom),dn=r.bp([],[1,1,1/rr]);r.bq(ln,ln,Oi),mi.push({zScaleMatrix:dn,negCameraPosMatrix:ln});for(const zr of ri.nodes)hf(ce,zr,Cr,ce.transform.expandedFarZProjMatrix,pi,Ft,zt,ri.materialOverrides,Hn);++pi}}else for(const Oi of ri.nodes)df(ce,_e,Oi,ii,jt,Xe,Ls)}if(De)if(ce.renderPass==="shadow"){for(const ni of zt)Ih(ni.mesh,ni.nodeModelMatrix,ce,_e);for(const ni of Ft)Ih(ni.mesh,ni.nodeModelMatrix,ce,_e)}else mg(ce,_e,1,Ft,zt,mi)}}(f,t,o,p,uf(B,o,f.style._importedAsBasemap)),void j();if(!B.loaded())return;if(B.type==="batched-model")return function(ce,Ce,_e,Re){_e.resetLayerRenderingStats(ce);const Ae=ce.context,Te=ce.transform,De=ce.style.fog,He=ce.shadowRenderer;if(Te.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${Te.projection.name} projection is not yet implemented`);const Ue=ce.transform.getFreeCameraOptions().position,rt=r.c4([],[Ue.x,Ue.y,Ue.z],ce.transform.worldSize),Qe=r.ev([],rt),lt=r.bz([]),Lt=r.ee(Te.center.lat,Te.zoom),Xe=r.bp([],[1,1,1/Lt]);r.bq(lt,lt,Qe);const Ne=_e.paint.get("model-opacity").constantOr(1),ct=new _i(Ae.gl.LEQUAL,_i.ReadWrite,ce.depthRangeFor3D),et=new _i(Ae.gl.LEQUAL,_i.ReadOnly,ce.depthRangeFor3D),At=new r.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),jt=ce.renderPass==="shadow",pi=jt&&He?He.getCurrentCascadeFrustum():Te.getFrustum(Te.scaleZoom(Te.worldSize)),Ft=_e.paint.get("model-front-cutoff"),zt=Ft[2]<1,mi=Au(ce,_e.paint.get("model-cutoff-fade-range")),ni=_e.getLayerRenderingStats();(function(ii,ri,Oi,wn){const In=ii.terrain?ii.terrain.exaggeration():0,vr=ii.transform.zoom;for(const Ui of wn){const Dn=ri.getTile(Ui).getBucket(Oi);Dn&&(Dn.setFilter(Oi.filter),ii.conflationActive&&Dn.updateReplacement(Ui,ii.replacementSource),Dn.evaluateTransform(ii,Oi),ii.terrain&&In>0&&Dn.elevationUpdate(ii.terrain,In,Ui,Oi.source),Dn.needsReEvaluation(ii,vr,Oi)&&Dn.evaluate(Oi))}})(ce,Ce,_e,Re),function(){let ii,ri,Oi;zt?(ii=Re.length-1,ri=-1,Oi=-1):(ii=0,ri=Re.length,Oi=1);const wn=new Float64Array(16),In=r.cz(),vr=new r.P(0,0);for(let Ui=ii;Ui!==ri;Ui+=Oi){const Dn=Re[Ui],tn=Ce.getTile(Dn).getBucket(_e);if(!tn||!tn.uploaded)continue;let mr=!1;He&&(mr=He.getMaxCascadeForTile(Dn.toUnwrapped())===0);const kn=Te.calculatePosMatrix(Dn.toUnwrapped(),Te.worldSize),Cr=tn.modelTraits;!jt&&zt&&(r.bk(wn,kn),r.af(In,rt,wn),vr.x=In[0],vr.y=In[1]);const Hn=[];tn.setFilter(_e.filter);for(const ln of tn.getNodesInfo()){if(ln.hiddenByReplacement||!ln.node.meshes)continue;const rr=ln.node;let dn=0;ce.terrain&&rr.elevation&&(dn=rr.elevation*ce.terrain.exaggeration());const zr=(()=>{const es=ln.aabb;return At.min=[...es.min],At.max=[...es.max],At.min[2]+=dn,At.max[2]+=dn,r.af(At.min,At.min,kn),r.af(At.max,At.max,kn),At})(),Kn=ln.evaluatedScale;if(Kn[0]<=1&&Kn[1]<=1&&Kn[2]<=1&&zr.intersects(pi)===0)continue;if(!jt&&zt){const es=.16666666666666666;ln.cameraCollisionOpacity=rt[0]>zr.min[0]&&rt[0]<zr.max[0]&&rt[1]>zr.min[1]&&rt[1]<zr.max[1]&&rt[2]*Lt<zr.max[2]&&rr.footprint&&r.b$(vr,rr.footprint)?Math.max(ln.cameraCollisionOpacity-es,0):Math.min(1,ln.cameraCollisionOpacity+es)}const Bi=[...kn],Bn=1/r.d6(Dn.canonical),Yr=rr.anchor?rr.anchor[0]:0,Eo=rr.anchor?rr.anchor[1]:0;r.bq(Bi,Bi,[Yr*(Kn[0]-1)+ln.evaluatedTranslation[0]*Bn,Eo*(Kn[1]-1)+ln.evaluatedTranslation[1]*Bn,dn+ln.evaluatedTranslation[2]]),r.cp(Kn,r.eD)||r.cR(Bi,Bi,Kn);const Qr=r.aB([],Bi,rr.globalMatrix),xo=r.aB([],Te.expandedFarZProjMatrix,Qr),As=r.aB([],Te.expandedFarZProjMatrix,Bi),Cs=r.aC([],[Yr,Eo,dn,1],xo)[2];rr.hidden=!1;let Za=Ne;jt||(zt&&(Za*=ln.cameraCollisionOpacity,Za*=Bu(Bi,Te,ln.aabb,Ft)),Za*=bd(mi,Cs)),Za!==0?Hn.push({nodeInfo:ln,depth:Cs,opacity:Za,wvpForNode:xo,wvpForTile:As,nodeModelMatrix:Qr,tileModelMatrix:Bi}):rr.hidden=!0}jt||Hn.sort((ln,rr)=>!zt||ln.opacity===1&&rr.opacity===1?ln.depth<rr.depth?-1:1:ln.opacity===1?-1:rr.opacity===1?1:ln.depth>rr.depth?-1:1);for(const ln of Hn){const rr=ln.nodeInfo,dn=rr.node;let zr=r.aB([],Xe,ln.tileModelMatrix);r.aB(zr,lt,zr);const Kn=r.bk([],zr);r.ef(Kn,Kn),r.cR(Kn,Kn,xd),zr=r.aB(zr,zr,dn.globalMatrix);const Bi=ce.renderPass==="light-beam",Bn=_e.paint.get("model-color-use-theme").constantOr("default")==="none",Yr=Cr&r.eH.HasMapboxMeshFeatures,Eo=Yr?0:rr.evaluatedRMEA[0][2];for(let Qr=0;Qr<dn.meshes.length;++Qr){const xo=dn.meshes[Qr],As=Qr===dn.lightMeshIndex;let Cs=ln.wvpForNode;if(As){if(!Bi&&!ce.terrain&&ce.shadowRenderer){ce.currentLayer<ce.firstLightBeamLayer&&(ce.firstLightBeamLayer=ce.currentLayer);continue}Cs=ln.wvpForTile}else if(Bi)continue;const Za={defines:[]},es=[];if(!jt&&He&&(He.useNormalOffset=!!xo.normalBuffer),Ah(Za.defines,es,xo,ce,Bn?null:_e.lut),Yr||Za.defines.push("DIFFUSE_SHADED"),mr&&Za.defines.push("SHADOWS_SINGLE_CASCADE"),ni&&(jt?ni.numRenderedVerticesInShadowPass+=xo.vertexArray.length:ni.numRenderedVerticesInTransparentPass+=xo.vertexArray.length),jt){Ih(xo,ln.nodeModelMatrix,ce,_e);continue}let nl=null;if(De){const Mo=Fp(ln.nodeModelMatrix,ce.transform);if(nl=new Float32Array(Mo),Te.projection.name!=="globe"){const Tr=xo.aabb.min,Bo=xo.aabb.max,[Ia,ao]=De.getOpacityForBounds(Mo,Tr[0],Tr[1],Bo[0],Bo[1]);Za.overrideFog=Ia>=We||ao>=We}}const Fa=xo.material;let rl;Fa.occlusionTexture&&Fa.occlusionTexture.offsetScale&&(rl=Fa.occlusionTexture.offsetScale,Za.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const fs=ce.getOrCreateProgram("model",Za);!jt&&He&&He.setupShadowsFromMatrix(ln.tileModelMatrix,fs,He.useNormalOffset),ce.uploadCommonUniforms(Ae,fs,null,nl);const Ca=Fa.pbrMetallicRoughness;Ca.metallicFactor=.9,Ca.roughnessFactor=.5;const mo=Wi(new Float32Array(Cs),new Float32Array(zr),new Float32Array(Kn),new Float32Array(dn.globalMatrix),ce,ln.opacity,Ca.baseColorFactor,Fa.emissiveFactor,Ca.metallicFactor,Ca.roughnessFactor,Fa,Eo,_e,[0,0,0],rl);!As&&(rr.hasTranslucentParts||ln.opacity<1)&&fs.draw(ce,Ae.gl.TRIANGLES,ct,Gi.disabled,sn.disabled,Vi.backCCW,mo,_e.id,xo.vertexBuffer,xo.indexBuffer,xo.segments,_e.paint,ce.transform.zoom,void 0,es),fs.draw(ce,Ae.gl.TRIANGLES,As?et:ct,Gi.disabled,As||ln.opacity<1||rr.hasTranslucentParts?sn.alphaBlended:sn.unblended,Vi.backCCW,mo,_e.id,xo.vertexBuffer,xo.indexBuffer,xo.segments,_e.paint,ce.transform.zoom,void 0,es)}}}}()}(f,t,o,p),void j();if(B.type!=="model")return;const $=B.getModels(),Z=[],Q=f.transform.getFreeCameraOptions().position,ne=r.c4([],[Q.x,Q.y,Q.z],f.transform.worldSize);r.ev(ne,ne);const te=[],se=[];let me=0;for(const ce of $){const Ce=t.getFeatureState("",ce.id),_e={type:"Unknown",id:ce.id,properties:ce.featureProperties},Re=o.paint.get("model-rotation").evaluate(_e,Ce),Ae=o.paint.get("model-scale").evaluate(_e,Ce),Te=o.paint.get("model-translation").evaluate(_e,Ce);Rh(o,ce.id,Ce,ce.featureProperties,ce.nodeOverrideNames,ce.nodeOverrides),ry(o,ce.id,Ce,ce.featureProperties,ce.materialOverrideNames,ce.materialOverrides),ce.nodeOverrides.size>0&&ce.computeBoundsAndApplyParent(),ce.computeModelMatrix(f,Re,Ae,Te,I,T,!1);const De=r.bz([]),He=r.ee(ce.position.lat,f.transform.zoom),Ue=r.bp([],[1,1,1/He]);r.bq(De,De,ne),Z.push({zScaleMatrix:Ue,negCameraPosMatrix:De});for(const rt of ce.nodes)hf(f,rt,ce.matrix,f.transform.expandedFarZProjMatrix,me,te,se,ce.materialOverrides);me++}if(te.sort((ce,Ce)=>Ce.depth-ce.depth),f.renderPass!=="shadow")mg(f,o,y,te,se,Z),j();else{for(const ce of se)Ih(ce.mesh,ce.nodeModelMatrix,f,o);for(const ce of te)Ih(ce.mesh,ce.nodeModelMatrix,f,o);j()}}},gf={line:function(f,t,o){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const p=t.getVisibleCoordinates();for(const y of p){const b=t.getTile(y).getBucket(f);if(b&&(b.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,t,o){const p=t.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson"){const b=uf(p,f,o.style._importedAsBasemap);return void(o.modelManager&&o.modelManager.upload(o,b))}if(p.type==="batched-model"||p.type!=="model")return;const y=p.getModels();for(const b of y)b.upload(o.context)},raster:function(f,t,o){const p=t.getSource();if(!(p instanceof ko&&p.loaded()))return;const y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const b=f.paint.get("raster-array-band")||p.getInitialBand(y);if(b==null)return;const T=t.getIds().map(I=>t.getTileByID(I));for(const I of T)I.updateNeeded(f.id,b)&&p.prepareTile(I,y,f.id,b)},"raster-particle":function(f,t,o){const p=t.getSource();if(!(p instanceof ko&&p.loaded()))return;const y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const b=f.paint.get("raster-particle-array-band")||p.getInitialBand(y);if(b==null)return;const T=t.getIds().map(I=>t.getTileByID(I));for(const I of T)I.updateNeeded(f.id,b)&&p.prepareTile(I,y,f.id,b)}},yg={fill:yd},zs={fill:function(f,t,o,p){if(!o.layout||o.layout.get("fill-elevation-reference")==="none"||o.paint.get("fill-opacity").constantOr(1)===0)return;const y=f.context.gl,b=new _i(y.LEQUAL,_i.ReadOnly,f.depthRangeFor3D),T=new Gi({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),I=f.transform.getFreeCameraOptions().position,D=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const F of p){const z=t.getTile(F),j=z.getBucket(o);if(!j)continue;const B=j.elevatedStructures;if(!B||B.depthSegments.segments[0].primitiveLength===0)continue;const $=fx(F.toUnwrapped(),I),Z=f.translatePosMatrix(F.projMatrix,z,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),Q=Mp(Z,$,0,1,0);D.draw(f,y.TRIANGLES,b,T,sn.disabled,Vi.disabled,Q,o.id,B.vertexBuffer,B.indexBuffer,B.depthSegments,o.paint,f.transform.zoom)}}};class Uu{constructor(t,o,p,y,b,T){this.context=new cg(t,o),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=r.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const I=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const F of I)this._debugParams.enabledLayers[F]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const F of I)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],F);this.occlusionParams=new zp(b),this.setup(),this.numSublayers=qo.maxUnderzooming+qo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new vp(this),this._wireframeDebugCache=new oy,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const D=new r.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,D,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y,this.worldview=T}updateTerrain(t,o){const p=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new rf(this,t));const y=this._terrain;this.transform.elevation=p?y:null,y.update(t,this.transform,o),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(t){const o=t.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,y]=o.getFovAdjustedRange(this.transform._fov);if(p>y)return void(this.transform.fogCullDistSq=null);const b=p+.78*(y-p);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new rf(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,o){if(this.width=t*r.o.devicePixelRatio,this.height=o*r.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const t=this.context,o=new r.bc;o.emplaceBack(0,0),o.emplaceBack(r.al,0),o.emplaceBack(0,r.al),o.emplaceBack(r.al,r.al),this.tileExtentBuffer=t.createVertexBuffer(o,r.be.members),this.tileExtentSegments=r.bf.simpleSegment(0,0,4,2);const p=new r.bc;p.emplaceBack(0,0),p.emplaceBack(r.al,0),p.emplaceBack(0,r.al),p.emplaceBack(r.al,r.al),this.debugBuffer=t.createVertexBuffer(p,r.be.members),this.debugSegments=r.bf.simpleSegment(0,0,4,5);const y=new r.bc;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(y,r.be.members),this.viewportSegments=r.bf.simpleSegment(0,0,4,2);const b=new r.a$;b.emplaceBack(0,0,0,0),b.emplaceBack(r.al,0,r.al,0),b.emplaceBack(0,r.al,0,r.al),b.emplaceBack(r.al,r.al,r.al,r.al),this.mercatorBoundsBuffer=t.createVertexBuffer(b,r.bh.members),this.mercatorBoundsSegments=r.bf.simpleSegment(0,0,4,2);const T=new r.b0;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(T);const I=new r.bd;for(const F of[0,1,3,2,0])I.emplaceBack(F);this.debugIndexBuffer=t.createIndexBuffer(I),this.emptyTexture=new r.T(t,new r.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=r.bB();const D=this.context.gl;this.stencilClearMode=new Gi({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,_i.disabled,this.stencilClearMode,sn.disabled,Vi.disabled,Pu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,o,p){if(!o||this.currentStencilSource===o.id||!t.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const D of p)if(this._tileClippingMaskIDs[D.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=o.id;const y=this.context,b=y.gl;this.nextStencilID+p.length>256&&this.clearStencil(),y.setColorMode(sn.disabled),y.setDepthMode(_i.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of p){const D=o.getTile(I),F=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:z,tileBoundsIndexBuffer:j,tileBoundsSegments:B}=this.getTileBoundsBuffers(D);T.draw(this,b.TRIANGLES,_i.disabled,new Gi({func:b.ALWAYS,mask:0},F,255,b.KEEP,b.KEEP,b.REPLACE),sn.disabled,Vi.disabled,Pu(I.projMatrix),"$clipping",z,j,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,o=this.context.gl;return new Gi({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const o=this.context.gl;return new Gi({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){const o=this.context.gl,p=t.sort((T,I)=>I.overscaledZ-T.overscaledZ),y=p[p.length-1].overscaledZ,b=p[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let I=0;I<b;I++)T[I+y]=new Gi({func:o.GEQUAL,mask:255},I+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=b,[T,p]}return[{[y]:Gi.disabled},p]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new sn([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new r.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?sn.unblended:sn.alphaBlended}colorModeForDrapableLayerRenderPass(t){const o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new sn([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new r.ao(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,o,p,y=!1){if(this.depthOcclusion)return new _i(this.context.gl.GREATER,_i.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return _i.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new _i(p||this.context.gl.LEQUAL,o,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,o=Math.ceil(this.width),p=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),b=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===o&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),o!==0&&p!==0&&(this.depthFBO=new lg(this.context,o,p,!1,"texture"),this.depthTexture=new r.T(this.context,{width:o,height:p,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),t.bindTexture(t.TEXTURE_2D,b),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,o,p,0,0,o,p,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,o)=>t+o/this._fpsHistory.length,0))}render(t,o){const p=r.o.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=o;const y=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(b).filter(Xe=>{const Ne=y[Xe];return!(Ne.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ne.type]});let I=T(),D=!1,F=!1,z=null;for(const Xe of I){const Ne=y[Xe];Ne.type==="circle"?D=!0:Ne.type==="building"?z=Ne:Ne.type==="symbol"&&(Ne.hasOcclusionOpacityProperties?F=!0:D=!0)}let j=I.map(Xe=>y[Xe]);const B=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(r.o.now()),this.imageManager.beginFrame();let $=0,Z=!1;for(const Xe in B){const Ne=B[Xe];Ne.used&&(Ne.prepare(this.context),Ne.getSource().usedInConflation&&++$)}let Q=!1;for(const Xe of j)Xe.isHidden(this.transform.zoom)||(Xe.type==="clip"&&(Q=!0),this.prepareLayer(Xe));const ne={},te={},se={},me={},ce={};for(const Xe in B){const Ne=B[Xe];ne[Xe]=Ne.getVisibleCoordinates(),te[Xe]=ne[Xe].slice().reverse(),se[Xe]=Ne.getVisibleCoordinates(!0).reverse(),me[Xe]=Ne.getShadowCasterCoordinates(),ce[Xe]=Ne.sortCoordinatesByDistance(ne[Xe])}const Ce=Xe=>{const Ne=this.style.getLayerSourceCache(Xe);return Ne&&Ne.used?Ne.getSource():null};if($||Q||this._clippingActiveLastFrame){const Xe=[],Ne=[];let ct=0;for(const et of j)this.isSourceForClippingOrConflation(et,Ce(et))&&(Xe.push(et),Ne.push(ct)),ct++;if(Xe&&(Q||Xe.length>1)||this._clippingActiveLastFrame){Q=!1;const et=[];for(let At=0;At<Xe.length;At++){const jt=Xe[At],pi=Ne[At],Ft=this.style.getLayerSourceCache(jt);if(!Ft||!Ft.used||!Ft.getSource().usedInConflation&&jt.type!=="clip"&&jt.type!=="building")continue;let zt=r.eP,mi=r.bZ.None;const ni=[];let ii=!0;if(jt.type==="building")zt=r.eR;else if(jt.type==="clip"){zt=pi;for(const ri of jt.layout.get("clip-layer-types"))mi|=ri==="model"?r.bZ.Model:ri==="symbol"?r.bZ.Symbol:r.bZ.FillExtrusion;for(const ri of jt.layout.get("clip-layer-scope"))ni.push(ri);jt.isHidden(this.transform.zoom)?ii=!1:Q=!0}ii&&et.push({layer:jt.fqid,cache:Ft,order:zt,clipMask:mi,clipScope:ni})}this.replacementSource.setSources(et),Z=!0}}this._clippingActiveLastFrame=Q,Z||this.replacementSource.clear(),this.conflationActive=Z,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Xe=0;Xe<j.length;Xe++){const Ne=j[Xe],ct=Ne.cutoffRange();if(this.longestCutoffRange=Math.max(ct,this.longestCutoffRange),ct>0){const et=Ce(Ne);et&&(this.minCutoffZoom=Math.max(et.minzoom,this.minCutoffZoom)),Ne.minzoom&&(this.minCutoffZoom=Math.max(Ne.minzoom,this.minCutoffZoom))}Ne.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Xe),this._lastOcclusionLayer=Xe)}const _e=this.style&&this.style.fog;_e?(this._fogVisible=_e.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=_e.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(se),this.opaquePassCutoff=0,I=T(),j=I.map(Xe=>y[Xe]));const Re=this._shadowRenderer;if(Re){Re.updateShadowParameters(this.transform,this.style.directionalLight);for(const Xe in B)for(const Ne of ne[Xe]){let ct={min:0,max:0};this.terrain&&(ct=this.terrain.getMinMaxForTile(Ne)||ct),Re.addShadowReceiver(Ne.toUnwrapped(),ct.min,ct.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new ro(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Ae=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Ae&&!this._snow&&(this._snow=new sy(this)),!Ae&&this._snow&&(this._snow.destroy(),delete this._snow),Te&&!this._rain&&(this._rain=new mf(this)),!Te&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),z){this.buildingTileBorderManager||(this.buildingTileBorderManager=new qe);const Xe=this.style.getLayerSourceCache(z);this.buildingTileBorderManager.updateBorders(Xe,z)}if(!on.has(this.context.gl))return;this.renderPass="offscreen";for(const Xe of j){const Ne=t.getLayerSourceCache(Xe);if(!Xe.hasOffscreenPass()||Xe.isHidden(this.transform.zoom))continue;const ct=Ne?te[Ne.id]:void 0;(Xe.type==="custom"||Xe.type==="raster"||Xe.type==="raster-particle"||Xe.isSky()||ct&&ct.length)&&this.renderLayer(this,Ne,Xe,ct)}this.depthRangeFor3D=[0,1-(j.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,me)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const De=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),He=(()=>{if(o.showOverdrawInspector)return r.ao.black;const Xe=this.style.fog;if(Xe&&this.transform.projection.supportsFog){const Ne=this.style.getLut(Xe.scope);if(!De){const ct=Xe.properties.get("color-use-theme")==="none",et=Xe.properties.get("color").toNonPremultipliedRenderColor(ct?null:Ne).toArray01();return new r.ao(...et)}if(De){const ct=Xe.properties.get("space-color-use-theme")==="none",et=Xe.properties.get("space-color").toNonPremultipliedRenderColor(ct?null:Ne).toArray01();return new r.ao(...et)}}return r.ao.transparent})();if(this.context.clear({color:He,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&De&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const Xe=j[this.currentLayer],Ne=t.getLayerSourceCache(Xe);if(Xe.isSky())continue;const ct=Ne?(Xe.is3D(b)?ce:te)[Ne.id]:void 0;this._renderTileClippingMasks(Xe,Ne,ct),this.renderLayer(this,Ne,Xe,ct)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&De&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const Xe=j[this.currentLayer],Ne=t.getLayerSourceCache(Xe);Xe.isSky()&&this.renderLayer(this,Ne,Xe,Ne?te[Ne.id]:void 0)}function Ue(Xe,Ne){let ct;return Ne&&(ct=(Xe.type==="symbol"?se:Xe.is3D(b)?ce:te)[Ne.id]),ct}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const Xe=j[this.currentLayer];if(Xe.type==="raster"||Xe.type==="raster-particle"){const Ne=t.getLayerSourceCache(Xe);this.renderLayer(this,Ne,Xe,Ue(Xe,Ne))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let rt=0;Re&&(rt=Re.getShadowCastingLayerCount());let Qe=!1,lt=-1;for(let Xe=0;Xe<I.length;++Xe){const Ne=j[Xe];Ne.isHidden(this.transform.zoom)||Ne.is3D(b)&&(lt=Xe)}F&&lt===-1&&(D=!0);let Lt=!1;for(;this.currentLayer<I.length;){const Xe=j[this.currentLayer],Ne=t.getLayerSourceCache(Xe);if(Xe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Xe)){if(Xe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Lt&&Xe.is3D(b)&&!b){const ct=this.currentLayer,et=At=>{for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const jt=j[this.currentLayer];if(yg[jt.type]){const pi=this.style.getLayerSourceCache(jt);yg[jt.type](this,pi,jt,Ue(jt,pi),At)}}};et("initialize"),et("reset"),this.currentLayer=ct,Lt=!0}if(D&&!Qe&&this.terrain&&!this.transform.isOrthographic&&(Qe=!0,this.blitDepth()),F&&lt!==-1&&this.currentLayer===lt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Xe,Ne,Ne?ne[Ne.id]:void 0),this.renderLayer(this,Ne,Xe,Ue(Xe,Ne)),!this.terrain&&Re&&rt>0&&Xe.hasShadowPass()&&--rt==0){{this.clearStencil(),this.resetStencilClippingMasks();const ct=this.currentLayer;for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const et=j[this.currentLayer];if(zs[et.type]){const At=this.style.getLayerSourceCache(et);zs[et.type](this,At,et,Ue(et,At))}}this.currentLayer=ct}if(Re.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const ct=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ct;this.currentLayer++){const et=j[this.currentLayer];if(!et.hasLightBeamPass())continue;const At=t.getLayerSourceCache(et);this.renderLayer(this,At,et,At?te[At.id]:void 0)}this.currentLayer=ct,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ct=this.currentLayer;this.depthOcclusion=!0;for(const et of this.layersWithOcclusionOpacity){this.currentLayer=et;const At=j[this.currentLayer],jt=t.getLayerSourceCache(At),pi=jt?te[jt.id]:void 0;this.terrain||this._renderTileClippingMasks(At,jt,jt?ne[jt.id]:void 0),this.renderLayer(this,jt,At,pi)}this.depthOcclusion=!1,this.currentLayer=ct,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Xe=null;j.forEach(Ne=>{const ct=t.getLayerSourceCache(Ne);ct&&!Ne.isHidden(this.transform.zoom)&&ct.getVisibleCoordinates().length&&(!Xe||Xe.getSource().maxzoom<ct.getSource().maxzoom)&&(Xe=ct)}),Xe&&this.options.showTileBoundaries&&ny(this,Xe,Xe.getVisibleCoordinates(),r.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ny(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Xe){const Ne=Xe.transform.padding;Ar(Xe,Xe.transform.height-(Ne.top||0),3,Hr),Ar(Xe,Ne.bottom||0,3,ca),yi(Xe,Ne.left||0,3,Ul),yi(Xe,Xe.transform.width-(Ne.right||0),3,pg);const ct=Xe.transform.centerPoint;(function(et,At,jt,pi){ua(et,At-1,jt-10,2,20,pi),ua(et,At-10,jt-1,20,2,pi)})(Xe,ct.x,Xe.transform.height-ct.y,iy)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Z||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:o}=this.transform.projection,p=!o||!o.includes(t.type);if(gf[t.type]&&(p||this.terrain&&t.type==="custom")){const y=this.style.getLayerSourceCache(t);gf[t.type](t,y,this)}this.gpuTimingEnd()}renderLayer(t,o,p,y){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||y&&y.length)&&(this.id=p.id,this.gpuTimingStart(p),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(p.type)&&(!t.terrain||p.type!=="custom")||p.type==="clip"||ly[p.type](t,o,p,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,p=this.context.gl;let y=this.gpuTimers[t.id];y||(y=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:p.createQuery()}),y.calls++,p.beginQuery(o.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,o=this.context.gl,p=o.createQuery();this.deferredRenderGpuTimeQueries.push(p),o.beginQuery(t.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const o={};for(const p in t){const y=t[p],b=this.context.extTimerQuery,T=b.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(y.query),o[p]=T}return o}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.gl;let p=0;for(const y of t)p+=o.getQueryParameter(y,o.QUERY_RESULT)/1e6,o.deleteQuery(y);return p}translatePosMatrix(t,o,p,y,b){if(!p[0]&&!p[1])return t;const T=b?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(T){const F=Math.sin(T),z=Math.cos(T);p=[p[0]*z-p[1]*F,p[0]*F+p[1]*z]}const I=[b?p[0]:r.ay(o,p[0],this.transform.zoom),b?p[1]:r.ay(o,p[1],this.transform.zoom),0],D=new Float32Array(16);return r.bq(D,t,I),D}saveTileTexture(t){if(t.context!==this.context)return;const o=t.size[0],p=this._tileTextures[o];p?p.push(t):this._tileTextures[o]=[t]}getTileTexture(t){const o=this._tileTextures[t];return o&&o.length>0?o.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,o,p){const y=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,b=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||y||o!==void 0&&!o||b.push("FOG","FOG_DITHERING"),y&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(t,o){this.cache=this.cache||{};const p=o&&o.defines||[],y=o&&o.config,b=this.currentGlobalDefines(t,o&&o.overrideFog,o&&o.overrideRtt).concat(p),T=Vl.cacheKey($m[t],t,b,y);return this.cache[T]||(this.cache[T]=new Vl(this.context,t,$m[t],y,dc[t],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,o){if(this.style.enable3dLights()){const p=this.style.directionalLight,y=this.style.ambientLight;if(p&&y){const b=((T,I,D)=>{const F=T.properties.get("direction"),z=T.properties.get("color-use-theme")==="none",j=T.properties.get("color").toNonPremultipliedRenderColor(z?null:D.getLut(T.scope)).toArray01(),B=T.properties.get("intensity"),$=I.properties.get("color-use-theme")==="none",Z=I.properties.get("color").toNonPremultipliedRenderColor($?null:D.getLut(I.scope)).toArray01(),Q=I.properties.get("intensity"),ne=[F.x,F.y,F.z],te=r.dM(Z,Q),se=r.dM(j,B);return{u_lighting_ambient_color:te,u_lighting_directional_dir:ne,u_lighting_directional_color:se,u_ground_radiance:Rp(ne,se,te)}})(p,y,this.style);o.setLightsUniformValues(t,b)}}}uploadCommonUniforms(t,o,p,y,b){if(this.uploadCommonLightUniforms(t,o),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const I=T.getOpacity(this.transform.pitch),D=((F,z,j,B,$,Z,Q,ne,te,se,me,ce)=>{const Ce=F.transform,_e=z.properties.get("color-use-theme")==="none",Re=z.properties.get("color").toNonPremultipliedRenderColor(_e?null:F.style.getLut(z.scope)).toArray01();Re[3]=B;const Ae=F.frameCounter/1e3%1,[Te,De]=z.properties.get("vertical-range");return{u_fog_matrix:j?Ce.calculateFogTileMatrix(j):ce||F.identityMat,u_fog_range:z.getFovAdjustedRange(Ce._fov),u_fog_color:Re,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Te,De),De],u_fog_temporal_offset:Ae,u_frustum_tl:$,u_frustum_tr:Z,u_frustum_br:Q,u_frustum_bl:ne,u_globe_pos:te,u_globe_radius:se,u_viewport:me,u_globe_transition:r.aj(Ce.zoom),u_is_globe:+(Ce.projection.name==="globe")}})(this,T,p,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.o.devicePixelRatio,this.transform.height*r.o.devicePixelRatio],y);o.setFogUniformValues(t,D)}b&&o.setCutoffUniformValues(t,b.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,o=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const y of p)o[y.key]=t[y.key]||new Go(y,512,this.transform.tileZoom,this,void 0,this.worldview);return o}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,o){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!o||o.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[t.key];return o||(this._cachedTileFogOpacities[t.key]=o=this.style.fog.getOpacityForTile(t)),o[0]>=We||o[1]>=We}setupDepthForOcclusion(t,o,p){const y=this.context,b=y.gl,T=!!p;var I;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(b.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),y.activeTexture.set(b.TEXTURE0),T||o.setTerrainUniformValues(y,p)}}function wd(f,t){let o=!1,p=null;const y=()=>{p=null,o&&(f(),p=setTimeout(y,t),o=!1)};return()=>(o=!0,p||y(),p)}class vg{constructor(t){this._hashName=t&&encodeURIComponent(t),r.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=wd(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const o=Td(t);if(this._hashName){const p=this._hashName;let y=!1;const b=location.hash.slice(1).split("&").map(T=>{const I=T.split("=")[0];return I===p?(y=!0,`${I}=${o}`):T}).filter(T=>T);return y||b.push(`${p}=${o}`),`#${b.join("&")}`}return`#${o}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let o;return t.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(o=p)}),(o&&o[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(p=>isNaN(Number(p)))){const p=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(o[3]||0):t.getBearing();return t.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:p,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Td(f,t){const o=f.getCenter(),p=Math.round(100*f.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),T=Math.round(o.lng*b)/b,I=Math.round(o.lat*b)/b,D=f.getBearing(),F=f.getPitch();let z=t?`/${T}/${I}/${p}`:`${p}/${I}/${T}`;return(D||F)&&(z+="/"+Math.round(10*D)/10),F&&(z+=`/${Math.round(F)}`),z}const _f={linearity:.3,easing:r.eS(0,0,.3,1)},ju=Object.assign({deceleration:2500,maxSpeed:1400},_f),xg=Object.assign({deceleration:20,maxSpeed:1400},_f),jl=Object.assign({deceleration:1e3,maxSpeed:360},_f),Gu=Object.assign({deceleration:1e3,maxSpeed:90},_f);class Dh{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,o=r.o.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)o.zoom+=b.zoomDelta||0,o.bearing+=b.bearingDelta||0,o.pitch+=b.pitchDelta||0,b.panDelta&&o.pan._add(b.panDelta),b.around&&(o.around=b.around),b.pinchAround&&(o.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(o.pan.mag()){const b=Mh(o.pan.mag(),p,Object.assign({},ju,t||{}));y.offset=o.pan.mult(b.amount/o.pan.mag()),y.center=this._map.transform.center,Gl(y,b)}if(o.zoom){const b=Mh(o.zoom,p,xg);y.zoom=this._map.transform.zoom+b.amount,Gl(y,b)}if(o.bearing){const b=Mh(o.bearing,p,jl);y.bearing=this._map.transform.bearing+r.aA(b.amount,-179,179),Gl(y,b)}if(o.pitch){const b=Mh(o.pitch,p,Gu);y.pitch=this._map.transform.pitch+b.amount,Gl(y,b)}if(y.zoom||y.bearing){const b=o.pinchAround===void 0?o.around:o.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Gl(f,t){(!f.duration||f.duration<t.duration)&&(f.duration=t.duration,f.easing=t.easing)}function Mh(f,t,o){const{maxSpeed:p,linearity:y,deceleration:b}=o,T=r.aA(f*y/(t/1e3),-p,p),I=Math.abs(T)/(b*y);return{easing:o.easing,duration:1e3*I,amount:T*(I/2)}}class lr extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,p,y={}){const b=Vt(o.getCanvasContainer(),p),T=o.unproject(b);super(t,Object.assign({point:b,lngLat:T,originalEvent:p},y)),this._defaultPrevented=!1,this.target=o}}class pc extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,p){const y=t==="touchend"?p.changedTouches:p.touches,b=ui(o.getCanvasContainer(),y),T=b.map(D=>o.unproject(D)),I=b.reduce((D,F,z,j)=>D.add(F.div(j.length)),new r.P(0,0));super(t,{points:b,point:I,lngLats:T,lngLat:o.unproject(I),originalEvent:p}),this._defaultPrevented=!1}}class _r extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o){super("wheel",{originalEvent:o}),this._defaultPrevented=!1}}class yf{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new _r(this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new lr(t.type,this._map,t))}mouseup(t){this._map.fire(new lr(t.type,this._map,t))}preclick(t){const o=new MouseEvent("preclick",t);this._map.fire(new lr(o.type,this._map,o))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(t),this._map.fire(new lr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new lr(t.type,this._map,t))}mouseover(t){this._map.fire(new lr(t.type,this._map,t))}mouseout(t){this._map.fire(new lr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new pc(t.type,this._map,t))}touchmove(t){this._map.fire(new pc(t.type,this._map,t))}touchend(t){this._map.fire(new pc(t.type,this._map,t))}touchcancel(t){this._map.fire(new pc(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ph{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new lr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new lr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new lr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mx{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ge(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;const p=o,y=this._startPos,b=this._lastPos;if(!y||!b||b.equals(p)||!this._box&&p.dist(y)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=ve("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const T=Math.min(y.x,p.x),I=Math.max(y.x,p.x),D=Math.min(y.y,p.y),F=Math.max(y.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${D}px)`,this._box.style.width=I-T+"px",this._box.style.height=F-D+"px")})}mouseupWindow(t,o){if(!this._active)return;const p=this._startPos,y=o;if(p&&t.button===0){if(this.reset(),Ct(),p.x!==y.x||p.y!==y.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(p,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ye(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new r.z(t,{originalEvent:o}))}}function Vp(f,t){const o={};for(let p=0;p<f.length;p++)o[f[p].identifier]=t[p];return o}class Up{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,o,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=function(y){const b=new r.P(0,0);for(const T of y)b._add(T);return b.div(y.length)}(o),this.touches=Vp(p,o)))}touchmove(t,o,p){if(this.aborted||!this.centroid)return;const y=Vp(p,o);for(const b in this.touches){const T=y[b];(!T||T.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(t,o,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Hl{constructor(t){this.singleTap=new Up(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,o,p){this.singleTap.touchstart(t,o,p)}touchmove(t,o,p){this.singleTap.touchmove(t,o,p)}touchend(t,o,p){const y=this.singleTap.touchend(t,o,p);if(y){const b=t.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(y)<30;if(b&&T||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class cy{constructor(){this._zoomIn=new Hl({numTouches:1,numTaps:2}),this._zoomOut=new Hl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,p){this._zoomIn.touchstart(t,o,p),this._zoomOut.touchstart(t,o,p)}touchmove(t,o,p){this._zoomIn.touchmove(t,o,p),this._zoomOut.touchmove(t,o,p)}touchend(t,o,p){const y=this._zoomIn.touchend(t,o,p),b=this._zoomOut.touchend(t,o,p);return y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const jp={0:1,2:2},bg={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Oh{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,o){return!1}_move(t,o){return{}}mousedown(t,o){if(this._lastPoint)return;const p=Di(t);this._correctButton(t,p)&&(this._lastPoint=o,this._eventButton=p)}mousemoveWindow(t,o){const p=this._lastPoint;if(p){if(t.preventDefault(),this._eventButton!=null&&function(y,b){const T=jp[b];return y.buttons===void 0||(y.buttons&T)!==T}(t,this._eventButton))this.reset();else if(this._moved||!(o.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(p,o)}}mouseupWindow(t){this._lastPoint&&Di(t)===this._eventButton&&(this._moved&&Ct(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uy extends Oh{mousedown(t,o){super.mousedown(t,o),this._lastPoint&&(this._active=!0)}_correctButton(t,o){return o===0&&!t.ctrlKey}_move(t,o){return{around:o,panDelta:o.sub(t)}}}class Gp extends Oh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?bg[t.pitchRotateKey]:void 0}_correctButton(t,o){return this._pitchRotateKey?o===0&&t[this._pitchRotateKey]:o===0&&t.ctrlKey||o===2}_move(t,o){const p=.8*(o.x-t.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class wg extends Oh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?bg[t.pitchRotateKey]:void 0}_correctButton(t,o){return this._pitchRotateKey?o===0&&t[this._pitchRotateKey]:o===0&&t.ctrlKey||o===2}_move(t,o){const p=-.5*(o.y-t.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class hy{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),r.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(t,o,p){return this._calculateTransform(t,o,p)}touchmove(t,o,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!r.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,o,p)}}touchend(t,o,p){this._calculateTransform(t,o,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,p){p.length>0&&(this._active=!0);const y=Vp(p,o),b=new r.P(0,0),T=new r.P(0,0);let I=0;for(const F in y){const z=y[F],j=this._touches[F];j&&(b._add(z),T._add(z.sub(j)),I++,y[F]=z)}if(this._touches=y,I<this._minTouches||!T.mag())return;const D=T.div(I);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(I),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ve("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Es{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,o,p){return{}}touchstart(t,o,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,p){const y=this._firstTwoTouches;if(!y)return;t.preventDefault();const[b,T]=y,I=Tl(p,o,b),D=Tl(p,o,T);if(!I||!D)return;const F=this._aroundCenter?null:I.add(D).div(2);return this._move([I,D],F,t)}touchend(t,o,p){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,T=Tl(p,o,y),I=Tl(p,o,b);T&&I||(this._active&&Ct(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Tl(f,t,o){for(let p=0;p<f.length;p++)if(f[p].identifier===o)return t[p]}function mc(f,t){return Math.log2(f/t)}class Hp extends Es{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){const p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(mc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:mc(this._distance,p),pinchAround:o}}}function Sd(f,t){return 180*f.angleWith(t)/Math.PI}class $l extends Es{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){const p=this._vector;if(this._vector=t[0].sub(t[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Sd(this._vector,p),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const o=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const y=Sd(t,p);return Math.abs(y)<o}}function Aa(f){return Math.abs(f.y)>Math.abs(f.x)}class gx extends Es{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Aa(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,p){const y=this._lastPoints;if(!y)return;const b=t[0].sub(y[0]),T=t[1].sub(y[1]);return this._map._cooperativeGestures&&!r.eT()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(b,T,p.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5})}gestureBeginsVertically(t,o,p){if(this._valid!==void 0)return this._valid;const y=t.mag()>=2,b=o.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=t.y>0==o.y>0;return Aa(t)&&Aa(o)&&T}}const _x={panStep:100,bearingStep:15,pitchStep:10};class yx{constructor(){const t=_x;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,p=0,y=0,b=0,T=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?y=1:(t.preventDefault(),T=-1);break;case 40:t.shiftKey?y=-1:(t.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,y=0),{cameraAnimation:I=>{const D=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Tg,zoom:o?Math.round(D)+o*(t.shiftKey?2:1):D,bearing:I.getBearing()+p*this._bearingStep,pitch:I.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:I.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Tg(f){return f*(2-f)}const dy=4.000244140625,Sg=1/450;class vx{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Sg,r.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||r.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const p=r.o.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,o!==0&&o%dy==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=o,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(y*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=Vt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const F=this._type==="wheel"&&Math.abs(this._delta)>dy?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&z!==0&&(z=1/z);const j=o(),B=Math.pow(2,j),$=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom($*z))),this._type==="wheel"&&(this._startZoom=j,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:o(),y=this._startZoom,b=this._easing;let T,I=!1;if(this._type==="wheel"&&y&&b){const F=Math.min((r.o.now()-this._lastWheelEventTime)/200,1),z=b(F);T=r.ak(y,p,z),F<1?this._frameId||(this._frameId=!0):I=!0}else T=p,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let D=T-o();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=r.eU;if(this._prevEase){const p=this._prevEase,y=(r.o.now()-p.start)/p.duration,b=p.easing(y+.01)-p.easing(y),T=.27/Math.sqrt(b*b+1e-4)*.01,I=Math.sqrt(.0729-T*T);o=r.eS(T,I,.25,1)}return this._prevEase={start:r.o.now(),duration:t,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ve("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class oo{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class xx{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,o){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(t.shiftKey?-1:1),around:p.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fy{constructor(){this._tap=new Hl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,o,p){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=o[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(t,o,p))}touchmove(t,o,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const y=o[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,o,p)}touchend(t,o,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(t,o,p)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qb{constructor(t,o,p){this._el=t,this._mousePan=o,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class bx{constructor(t,o,p){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class $p{constructor(t,o,p,y){this._el=t,this._touchZoom=o,this._touchRotate=p,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const vf=f=>f.zoom||f.drag||f.pitch||f.rotate;class py extends r.z{}class Wp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,o){const p=r.av([],o,t);this.radius=r.ag(p[2]<0?r.eW([],p,this.constants):[p[0],p[1],0])}projectRay(t){r.eW(t,t,this.constants),r.aw(t,t),r.eX(t,t,this.constants);const o=r.c4([],t,this.radius);if(o[2]>0){const p=r.c4([],[0,0,1],r.bI(o,[0,0,1])),y=r.c4([],r.aw([],[o[0],o[1],0]),this.radius),b=r.d7([],o,r.c4([],r.av([],r.d7([],y,p),o),2));o[0]=b[0],o[1]=b[1]}return o}}function Wl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class xf{constructor(t,o){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Dh(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Wp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),r.aX(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,b,T]of this._listeners){const I=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(b,I,T)}}destroy(){for(const[t,o,p]of this._listeners){const y=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(o,y,p)}}_addDefaultHandlers(t){const o=this._map,p=o.getCanvasContainer();this._add("mapEvent",new yf(o,t));const y=o.boxZoom=new mx(o,t);this._add("boxZoom",y);const b=new cy,T=new xx;o.doubleClickZoom=new oo(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const I=new fy;this._add("tapDragZoom",I);const D=o.touchPitch=new gx(o);this._add("touchPitch",D);const F=new Gp(t),z=new wg(t);o.dragRotate=new bx(t,F,z),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);const j=new uy(t),B=new hy(o,t);o.dragPan=new qb(p,j,B),this._add("mousePan",j),this._add("touchPan",B,["touchZoom","touchRotate"]);const $=new $l,Z=new Hp;o.touchZoomRotate=new $p(p,Z,$,I),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ph(o));const Q=o.scrollZoom=new vx(o,this);this._add("scrollZoom",Q,["mousePan"]);const ne=o.keyboard=new yx;this._add("keyboard",ne);for(const te of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[te]&&o[te].enable(t[te])}_add(t,o,p){this._handlers.push({handlerName:t,handler:o,allowed:p}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vf(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,o,p){for(const y in t)if(y!==p&&(!o||o.indexOf(y)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const o=[];for(const p of t)this._el.contains(p.target)&&o.push(p);return o}handleEvent(t,o){this._updatingCamera=!0;const p=t.type==="renderFrame",y=p?void 0:t,b={needsRenderFrame:!1},T={},I={},D=t.touches?this._getMapTouches(t.touches):void 0,F=D?ui(this._el,D):p?void 0:Vt(this._el,t);for(const{handlerName:B,handler:$,allowed:Z}of this._handlers){if(!$.isEnabled())continue;let Q;this._blockedByActive(I,Z,B)?$.reset():$[o||t.type]&&(Q=$[o||t.type](t,F,D),this.mergeHandlerResult(b,T,Q,B,y),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||$.isActive())&&(I[B]=$)}const z={};for(const B in this._previousActiveHandlers)I[B]||(z[B]=y);this._previousActiveHandlers=I,(Object.keys(z).length||Wl(b))&&(this._changes.push([b,T,z]),this._triggerRenderFrame()),(Object.keys(I).length||Wl(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=b;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(t,o,p,y,b){if(!p)return;Object.assign(t,p);const T={handlerName:y,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(o.zoom=T),p.panDelta!==void 0&&(o.drag=T),p.pitchDelta!==void 0&&(o.pitch=T),p.bearingDelta!==void 0&&(o.rotate=T)}_applyChanges(){const t={},o={},p={};for(const[y,b,T]of this._changes)y.panDelta&&(t.panDelta=(t.panDelta||new r.P(0,0))._add(y.panDelta)),y.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(t.around=y.around),y.aroundCoord!==void 0&&(t.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(t.pinchAround=y.pinchAround),y.noInertia&&(t.noInertia=y.noInertia),Object.assign(o,b),Object.assign(p,T);this._updateMapTransform(t,o,p),this._changes=[]}_updateMapTransform(t,o,p){const y=this._map,b=y.transform,T=se=>[se.x,se.y,se.z];if((se=>{const me=this._eventsInProgress.drag;return me&&!this._handlersById[me.handlerName].isActive()})()&&!Wl(t)){const se=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),se!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&y._stop(!0),!Wl(t))return void this._fireEvents(o,p,!0);let{panDelta:I,zoomDelta:D,bearingDelta:F,pitchDelta:z,around:j,aroundCoord:B,pinchAround:$}=t;b._isCameraConstrained&&(D>0&&(D=0),b._isCameraConstrained=!1),$!==void 0&&(j=$),(D||(se=>o[se]&&!this._eventsInProgress[se])("drag"))&&j&&(this._dragOrigin=T(b.pointCoordinate3D(j)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),j=j||y.transform.centerPoint,F&&(b.bearing+=F),z&&(b.pitch+=z),b._updateCameraState();const Z=[0,0,0];if(I)if(b.projection.name==="mercator"){const se=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(j).dir),me=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(j.sub(I)).dir);Z[0]=me[0]-se[0],Z[1]=me[1]-se[1]}else{const se=b.pointCoordinate(j);if(b.projection.name==="globe"){I=I.rotate(-b.angle);const me=b._pixelsPerMercatorPixel/b.worldSize;Z[0]=-I.x*r.eV(r.a_(se.y))*me,Z[1]=-I.y*r.eV(b.center.lat)*me}else{const me=b.pointCoordinate(j.sub(I));se&&me&&(Z[0]=me.x-se.x,Z[1]=me.y-se.y)}}const Q=b.zoom,ne=[0,0,0];if(D){const se=T(B||b.pointCoordinate3D(j)),me={dir:r.aw([],r.av([],se,b._camera.position))};if(me.dir[2]<0){const ce=b.zoomDeltaToMovement(se,D);r.c4(ne,me.dir,ce)}}const te=r.d7(Z,Z,ne);b._translateCameraConstrained(te),D&&Math.abs(b.zoom-Q)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,p,!0)}_fireEvents(t,o,p){const y=vf(this._eventsInProgress),b=vf(t),T={};for(const z in t){const{originalEvent:j}=t[z];this._eventsInProgress[z]||(T[`${z}start`]=j),this._eventsInProgress[z]=t[z]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const z in T)this._fireEvent(z,T[z]);b&&this._fireEvent("move",b.originalEvent);for(const z in t){const{originalEvent:j}=t[z];this._fireEvent(z,j)}const I={};let D;for(const z in this._eventsInProgress){const{handlerName:j,originalEvent:B}=this._eventsInProgress[z];this._handlersById[j].isActive()||(delete this._eventsInProgress[z],D=o[j]||B,I[`${z}end`]=D)}for(const z in I)this._fireEvent(z,I[z]);const F=vf(this._eventsInProgress);if(p&&(y||b)&&!F){this._updatingCamera=!0;const z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;z?(j(z.bearing||this._map.getBearing())&&(z.bearing=0),this._map.easeTo(z,{originalEvent:D})):(this._map.fire(new r.z("moveend",{originalEvent:D})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new r.z(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new py("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const So="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ds extends r.E{constructor(t,o){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,r.aX(["_renderFrameCallback"],this)}getCenter(){return new r.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,p){return t=r.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},o),p)}panTo(t,o,p){return this.easeTo(Object.assign({center:t},o),p)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,p){return this.easeTo(Object.assign({zoom:t},o),p)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,p){return this.easeTo(Object.assign({bearing:t},o),p)}resetNorth(t,o){return this.rotateTo(0,Object.assign({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=r.aI.convert(t);const p=o&&o.bearing||0,y=o&&o.pitch||0,b=t.getNorthWest(),T=t.getSouthEast();return this._cameraForBounds(this.transform,b,T,p,y,o)}_extendPadding(t){const o={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},o,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},o,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,o){const p=o.max[0]-o.min[0],y=o.max[1]-o.min[1];return p/y>t.aspect?p/(2*Math.tan(.5*t.fovX)*t.aspect):y/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,o,p,y,b,T){const I=t.clone(),D=this._extendCameraOptions(T);I.bearing=y,I.pitch=b;const F=r.aS.convert(o),z=r.aS.convert(p),j=.5*(F.lat+z.lat),B=.5*(F.lng+z.lng),$=r.eY(j,B),Z=r.aw([],$),Q=r.aw([],r.bH([],Z,[0,1,0])),ne=r.bH([],Q,Z),te=[Q[0],Q[1],Q[2],0,ne[0],ne[1],ne[2],0,Z[0],Z[1],Z[2],0,0,0,0,1],se=[$,r.eY(F.lat,F.lng),r.eY(z.lat,F.lng),r.eY(z.lat,z.lng),r.eY(F.lat,z.lng),r.eY(j,F.lng),r.eY(j,z.lng),r.eY(F.lat,B),r.eY(z.lat,B)];let me=r.d8.fromPoints(se.map(et=>[r.bI(Q,et),r.bI(ne,et),r.bI(Z,et)]));const ce=r.af([],me.center,te);r.eZ(ce)===0&&r.e_(ce,0,0,1),r.aw(ce,ce),r.c4(ce,ce,r.aD),I.center=r.e$(ce);const Ce=I.getWorldToCameraMatrix(),_e=r.bk(new Float64Array(16),Ce);me=r.d8.applyTransform(me,r.aB([],Ce,te));const Re=this._extendAABB(me,I,D,y);if(!Re)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");me=Re,r.af(ce,ce,Ce);const Ae=.5*(me.max[2]-me.min[2]),Te=this._minimumAABBFrustumDistance(I,me),De=r.c4([],[0,0,1],Ae),He=r.d7(De,ce,De),Ue=Te+(I.pitch===0?0:r.bF(ce,He)),rt=I.globeCenterInViewSpace,Qe=r.av([],ce,[rt[0],rt[1],rt[2]]);r.aw(Qe,Qe),r.c4(Qe,Qe,Ue);const lt=r.d7([],ce,Qe);r.af(lt,lt,_e);const Lt=r.eL/r.aD,Xe=r.ag(lt),Ne=r.ce(Math.max(Xe*Lt-r.eL,Number.EPSILON),0),ct=Math.min(I.zoomFromMercatorZAdjusted(Ne),D.maxZoom);return ct>.5*(r.cZ+r.cK)?(I.setProjection({name:"mercator"}),I.zoom=ct,this._cameraForBounds(I,o,p,y,b,T)):{center:I.center,zoom:ct,bearing:y,pitch:b}}_extendAABB(t,o,p,y){const b=.5*((p.padding.left||0)+(p.padding.right||0)),T=.5*((p.padding.top||0)+(p.padding.bottom||0)),I=T,D=b,F=b,z=T,j=o.width-(D+F),B=o.height-(I+z),$=r.av([],t.max,t.min),Z=Math.min(j/$[0],B/$[1]),Q=Math.min(o.scaleZoom(o.scale*Z),p.maxZoom);if(isNaN(Q))return null;const ne=o.scale/o.zoomScale(Q),te=new r.d8([t.min[0]-D*ne,t.min[1]-z*ne,t.min[2]],[t.max[0]+F*ne,t.max[1]+I*ne,t.max[2]]),se=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new r.P(p.offset.x,p.offset.y):r.P.convert(p.offset)).rotate(-r.an(y));return te.center[0]-=se.x*ne,te.center[1]+=se.y*ne,te}queryTerrainElevation(t,o){const p=this.transform.elevation;return p?(o=Object.assign({},{exaggerated:!0},o),p.getAtPoint(r.ae.fromLngLat(t),null,o.exaggerated)):null}_cameraForBounds(t,o,p,y,b,T){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,o,p,y,b,T);const I=t.clone(),D=this._extendCameraOptions(T);I.bearing=y,I.pitch=b;const F=r.aS.convert(o),z=r.aS.convert(p),j=new r.aS(F.lng,z.lat),B=new r.aS(z.lng,F.lat),$=I.project(F),Z=I.project(z),Q=this.queryTerrainElevation(F),ne=this.queryTerrainElevation(z),te=this.queryTerrainElevation(j),se=this.queryTerrainElevation(B),me=[[$.x,$.y,Math.min(Q||0,ne||0,te||0,se||0)],[Z.x,Z.y,Math.max(Q||0,ne||0,te||0,se||0)]];let ce=r.d8.fromPoints(me);const Ce=I.getWorldToCameraMatrix(),_e=r.bk(new Float64Array(16),Ce);ce=r.d8.applyTransform(ce,Ce);const Re=this._extendAABB(ce,I,D,y);if(!Re)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=Re;const Ae=.5*r.av([],ce.max,ce.min)[2],Te=this._minimumAABBFrustumDistance(I,ce),De=[0,0,1,0];r.aC(De,De,Ce),r.f0(De,De);const He=r.c4([],De,Te+Ae),Ue=r.d7([],ce.center,He);r.af(ce.center,ce.center,_e),r.af(Ue,Ue,_e);const rt=I.unproject(new r.P(ce.center[0],ce.center[1])),Qe=r.f1(I.projection,rt),lt=Math.pow(2,Qe),Lt=Math.min(I._zoomFromMercatorZ(Ue[2]*I.pixelsPerMeter*lt/I.worldSize),D.maxZoom);return I.mercatorFromTransition&&Lt<.5*(r.cZ+r.cK)?(I.setProjection({name:"globe"}),I.zoom=Lt,this._cameraForBounds(I,o,p,y,b,T)):{center:rt,zoom:Lt,bearing:y,pitch:b}}fitBounds(t,o,p){const y=this.cameraForBounds(t,o);return this._fitInternal(y,o,p)}fitScreenCoordinates(t,o,p,y,b){const T=r.P.convert(t),I=r.P.convert(o),D=new r.P(Math.min(T.x,I.x),Math.min(T.y,I.y)),F=new r.P(Math.max(T.x,I.x),Math.max(T.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,I))return this;const z=this.transform.pointLocation3D(D),j=this.transform.pointLocation3D(F),B=this.transform.pointLocation3D(new r.P(D.x,F.y)),$=this.transform.pointLocation3D(new r.P(F.x,D.y)),Z=[Math.min(z.lng,j.lng,B.lng,$.lng),Math.min(z.lat,j.lat,B.lat,$.lat)],Q=[Math.max(z.lng,j.lng,B.lng,$.lng),Math.max(z.lat,j.lat,B.lat,$.lat)],ne=y&&y.pitch?y.pitch:this.getPitch(),te=this._cameraForBounds(this.transform,Z,Q,p,ne,y);return this._fitInternal(te,y,b)}_fitInternal(t,o,p){return t?(o=Object.assign(t,o)).linear?this.easeTo(o,p):this.flyTo(o,p):this}jumpTo(t,o){this.stop();const p=t.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,T=!1;"zoom"in t&&p.zoom!==+t.zoom&&(y=!0,p.zoom=+t.zoom),t.center!==void 0&&(p.center=r.aS.convert(t.center)),"bearing"in t&&p.bearing!==+t.bearing&&(b=!0,p.bearing=+t.bearing),"pitch"in t&&p.pitch!==+t.pitch&&(T=!0,p.pitch=+t.pitch);const I=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!p.isPaddingEqual(I))if(t.retainPadding===!1){const D=p.clone();D.padding=I,p.setLocationAtPoint(p.center,D.centerPoint)}else p.padding=I;return t.preloadOnly?(this._preloadTiles(p),this):(this.fire(new r.z("movestart",o)).fire(new r.z("move",o)),y&&this.fire(new r.z("zoomstart",o)).fire(new r.z("zoom",o)).fire(new r.z("zoomend",o)),b&&this.fire(new r.z("rotatestart",o)).fire(new r.z("rotate",o)).fire(new r.z("rotateend",o)),T&&this.fire(new r.z("pitchstart",o)).fire(new r.z("pitch",o)).fire(new r.z("pitchend",o)),this.fire(new r.z("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(So),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,o){const p=this.transform;if(!p.projection.supportsFreeCamera)return r.w(So),this;this.stop();const y=p.zoom,b=p.pitch,T=p.bearing;p.setFreeCameraOptions(t);const I=y!==p.zoom,D=b!==p.pitch,F=T!==p.bearing;return this.fire(new r.z("movestart",o)).fire(new r.z("move",o)),I&&this.fire(new r.z("zoomstart",o)).fire(new r.z("zoom",o)).fire(new r.z("zoomend",o)),F&&this.fire(new r.z("rotatestart",o)).fire(new r.z("rotate",o)).fire(new r.z("rotateend",o)),D&&this.fire(new r.z("pitchstart",o)).fire(new r.z("pitch",o)).fire(new r.z("pitchend",o)),this.fire(new r.z("moveend",o)),this}easeTo(t,o){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:r.eU},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const p=this.transform,y=this.getZoom(),b=this.getBearing(),T=this.getPitch(),I=this.getPadding(),D="zoom"in t?+t.zoom:y,F="bearing"in t?this._normalizeBearing(t.bearing,b):b,z="pitch"in t?+t.pitch:T,j=this._extendPadding(t.padding),B=r.P.convert(t.offset);let $,Z,Q;if(p.projection.name==="globe"){const De=r.ae.fromLngLat(p.center),He=B.rotate(-p.angle);De.x+=He.x/p.worldSize,De.y+=He.y/p.worldSize;const Ue=De.toLngLat(),rt=r.aS.convert(t.center||Ue);this._normalizeCenter(rt),$=p.centerPoint.add(He),Z=new r.P(De.x,De.y).mult(p.worldSize),Q=new r.P(r.aF(rt.lng),r.aJ(rt.lat)).mult(p.worldSize).sub(Z)}else{$=p.centerPoint.add(B);const De=p.pointLocation($),He=r.aS.convert(t.center||De);this._normalizeCenter(He),Z=p.project(De),Q=p.project(He).sub(Z)}const ne=p.zoomScale(D-y);let te,se;t.around&&(te=r.aS.convert(t.around),se=p.locationPoint(te));const me=this._zooming||D!==y,ce=this._rotating||b!==F,Ce=this._pitching||z!==T,_e=!p.isPaddingEqual(j),Re=t.retainPadding===!1?p.clone():p,Ae=De=>He=>{if(me&&(De.zoom=r.ak(y,D,He)),ce&&(De.bearing=r.ak(b,F,He)),Ce&&(De.pitch=r.ak(T,z,He)),_e&&(Re.interpolatePadding(I,j,He),$=Re.centerPoint.add(B)),te)De.setLocationAtPoint(te,se);else{const Ue=De.zoomScale(De.zoom-y),rt=D>y?Math.min(2,ne):Math.max(.5,ne),Qe=Math.pow(rt,1-He),lt=De.unproject(Z.add(Q.mult(He*Qe)).mult(Ue));De.setLocationAtPoint(De.renderWorldCopies?lt.wrap():lt,$)}return t.preloadOnly||this._fireMoveEvents(o),De};if(t.preloadOnly){const De=this._emulate(Ae,t.duration,p);return this._preloadTiles(De),this}const Te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=me,this._rotating=ce,this._pitching=Ce,this._padding=_e,this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,Te),this._ease(Ae(p),De=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(o,De)},t),this}_prepareEase(t,o,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||p.moving||this.fire(new r.z("movestart",t)),this._zooming&&!p.zooming&&this.fire(new r.z("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new r.z("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new r.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new r.z("move",t)),this._zooming&&this.fire(new r.z("zoom",t)),this._rotating&&this.fire(new r.z("rotate",t)),this._pitching&&this.fire(new r.z("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new r.z("zoomend",t)),y&&this.fire(new r.z("rotateend",t)),b&&this.fire(new r.z("pitchend",t)),this.fire(new r.z("moveend",t))}flyTo(t,o){if(this._prefersReducedMotion(t)){const et=r.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(et,o)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:r.eU},t);const p=this.transform,y=this.getZoom(),b=this.getBearing(),T=this.getPitch(),I=this.getPadding(),D="zoom"in t?r.aA(+t.zoom,p.minZoom,p.maxZoom):y,F="bearing"in t?this._normalizeBearing(t.bearing,b):b,z="pitch"in t?+t.pitch:T,j=this._extendPadding(t.padding),B=p.zoomScale(D-y),$=r.P.convert(t.offset);let Z=p.centerPoint.add($);const Q=p.pointLocation(Z),ne=r.aS.convert(t.center||Q);this._normalizeCenter(ne);const te=p.project(Q),se=p.project(ne).sub(te);let me=t.curve;const ce=Math.max(p.width,p.height),Ce=ce/B,_e=se.mag();if("minZoom"in t){const et=r.aA(Math.min(t.minZoom,y,D),p.minZoom,p.maxZoom),At=ce/p.zoomScale(et-y);me=Math.sqrt(At/_e*2)}const Re=me*me;function Ae(et){const At=(Ce*Ce-ce*ce+(et?-1:1)*Re*Re*_e*_e)/(2*(et?Ce:ce)*Re*_e);return Math.log(Math.sqrt(At*At+1)-At)}function Te(et){return(Math.exp(et)-Math.exp(-et))/2}function De(et){return(Math.exp(et)+Math.exp(-et))/2}const He=Ae(0);let Ue=function(et){return De(He)/De(He+me*et)},rt=function(et){return ce*((De(He)*(Te(At=He+me*et)/De(At))-Te(He))/Re)/_e;var At},Qe=(Ae(1)-He)/me;if(Math.abs(_e)<1e-6||!isFinite(Qe)){if(Math.abs(ce-Ce)<1e-6)return this.easeTo(t,o);const et=Ce<ce?-1:1;Qe=Math.abs(Math.log(Ce/ce))/me,rt=function(){return 0},Ue=function(At){return Math.exp(et*me*At)}}t.duration="duration"in t?+t.duration:1e3*Qe/("screenSpeed"in t?+t.screenSpeed/me:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const lt=b!==F,Lt=z!==T,Xe=!p.isPaddingEqual(j),Ne=t.retainPadding===!1?p.clone():p,ct=et=>At=>{const jt=At*Qe,pi=1/Ue(jt);et.zoom=At===1?D:y+et.scaleZoom(pi),lt&&(et.bearing=r.ak(b,F,At)),Lt&&(et.pitch=r.ak(T,z,At)),Xe&&(Ne.interpolatePadding(I,j,At),Z=Ne.centerPoint.add($));const Ft=At===1?ne:et.unproject(te.add(se.mult(rt(jt))).mult(pi));return et.setLocationAtPoint(et.renderWorldCopies?Ft.wrap():Ft,Z),et._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(o),et};if(t.preloadOnly){const et=this._emulate(ct,t.duration,p);return this._preloadTiles(et),this}return this._zooming=!0,this._rotating=lt,this._pitching=Lt,this._padding=Xe,this._prepareEase(o,!1),this._ease(ct(p),()=>this._afterEase(o),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,o)}if(!t){const p=this.handlers;p&&p.stop(!1)}return this}_ease(t,o,p){p.animate===!1||p.duration===0?(t(1),o()):(this._easeStart=r.o.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((r.o.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,o){t=r.bS(t,-180,180);const p=Math.abs(t-o);return Math.abs(t-360-o)<p&&(t-=360),Math.abs(t+360-o)<p&&(t+=360),t}_normalizeCenter(t){const o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;const p=t.lng-o.center.lng;t.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&r.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,o,p){const y=Math.ceil(15*o/1e3),b=[],T=t(p.clone());for(let I=0;I<=y;I++){const D=T(I/y);b.push(D.clone())}return b}_preloadTiles(t,o){}}class Sl{constructor(t={}){this.options=t,r.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const o=this.options&&this.options.compact,p=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=ve("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ve("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const y=ve("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",p),this._innerContainer=ve("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(t){const p=o.reduce((y,b,T)=>(b.value&&(y+=`${b.key}=${b.value}${T<o.length-1?"&":""}`),y),"?");t.href=`${r.e.FEEDBACK_URL}/${p}#${Td(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const o=this._map.style._mergedSourceCaches;for(const y in o){const b=o[y];if(b.used){const T=b.getSource();T.attribution&&t.indexOf(T.attribution)<0&&t.push(T.attribution)}}t.sort((y,b)=>y.length-b.length),t=t.filter((y,b)=>{for(let T=b+1;T<t.length;T++)if(t[T].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const p=t.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ql{constructor(){r.aX(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=ve("div","mapboxgl-ctrl");const o=ve("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const o in t){const p=t[o].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const o=t[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class Ed{constructor(){r.aX(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=ve("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",o=>this._onIndoorUpdate(o)),this._container}_createButton(t,o){const p=ve("button",t,this._container);return p.type="button",p.addEventListener("click",o),p}_createSeparator(){return ve("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,o){this._map&&(t.setAttribute("aria-label",o),t.textContent=o)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const o=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",o&&Array.from(this._container.children).forEach(p=>p.remove()),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const o=this._map;this._model&&o&&o._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});ve("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,o){for(let p=0;p<t.length;p++){const y=t[p],b=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(y.id)});this._setButtonTitle(b,y.zIndex.toString()),this._model&&y.id===this._model.selectedFloorId&&o&&b.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(b),p<t.length-1&&this._createSeparator()}}}class bf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){const o=this._currentlyRunning,p=o?this._queue.concat(o):this._queue;for(const y of p)if(y.id===t)return void(y.cancelled=!0)}run(t=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const p of o)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Zl{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const o=r.dC((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,o,p){this._start=this.getValue(o),this._end=t,this._startTime=o,this._endTime=o+p}}const Zb={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class wx extends r.z{constructor(t,o,p,y){const{point:b,lngLat:T,originalEvent:I,target:D}=t;super(t.type,{point:b,lngLat:T,originalEvent:I,target:D}),this.preventDefault=()=>{t.preventDefault()},this.id=o,this.interaction=p,this.feature=y}}class my{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,o){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const p=o.filter;let y=o.type;p&&this.filters.set(t,r.b5(p)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const b=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,o)):b.size===0&&this.map.on(y,this.handleType),b.size===0&&this.interactionsByType.set(y,b),b.set(t,o),this.typeById.set(t,y)}get(t){const o=this.typeById.get(t);if(!o)return;const p=this.interactionsByType.get(o);return p?p.get(t):void 0}remove(t){const o=this.typeById.get(t);if(!o)return;this.typeById.delete(t),this.filters.delete(t);const p=this.interactionsByType.get(o);p&&(p.delete(t),o==="mouseenter"||o==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(o,this.handleType))}queryTargets(t,o){const p=[];for(const[y,b]of o)b.target&&p.push({targetId:y,target:b.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(t,p,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const o=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());o.length&&(t.type="mouseenter",this.handleType(t,o));const p=new Map;for(const[y,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||p.set(b.id,b);p.size&&(t.type="mouseleave",this.handleType(t,Array.from(p.values())))}handleOut(t){const o=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);o.length&&(t.type="mouseleave",this.handleType(t,o)),this.hoveredFeatures.clear()}handleType(t,o){const p=t.type==="mouseenter";if(p&&!this.interactionsByType.has(t.type))return void r.w("mouseenter interaction required for mouseleave to work.");const y=Array.from(this.interactionsByType.get(t.type)).reverse(),b=!!o;o=o||this.queryTargets(t.point,y);let T=!1;const I=new Set;for(const D of o){for(const[F,z]of y){if(!z.target)continue;const j=D.variants?D.variants[F]:null;if(j){for(const B of j){if(Ka(B,D,I,F))continue;const $=new r.dw(D,B),Z=Js(B,D,F);b&&$.id!==void 0&&($.state=this.map.getFeatureState($));const Q=p?this.prevHoveredFeatures.get(Z):null,ne=new wx(t,F,z,$),te=Q?Q.stop:z.handler(ne);if(p&&this.hoveredFeatures.set(Z,{feature:D,stop:te}),te!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[D,F]of y){const{handler:z,target:j}=F;if(!j&&z(new wx(t,D,F,null))!==!1)break}}}function Eg(f,t){if(Array.isArray(f)&&Array.isArray(t)){const o=new Set(f),p=new Set(t);return o.size===p.size&&f.every(y=>p.has(y))}return r.bx(f,t)}const kh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Ag={showCompass:!0,showZoom:!0,visualizePitch:!1};class wf{constructor(t,o,p=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Gp({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,p&&(this.mousePitch=new wg({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),r.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(t,o){this.mouseRotate.mousedown(t,o),this.mousePitch&&this.mousePitch.mousedown(t,o),Ge()}move(t,o){const p=this.map,y=this.mouseRotate.mousemoveWindow(t,o),b=y&&y.bearingDelta;if(b&&p.setBearing(p.getBearing()+b),this.mousePitch){const T=this.mousePitch.mousemoveWindow(t,o),I=T&&T.pitchDelta;I&&p.setPitch(p.getPitch()+I)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ye(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Vt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Vt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ui(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=ui(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Hu(f,t,o){if(f=new r.aS(f.lng,f.lat),t){const p=new r.aS(f.lng-360,f.lat),y=new r.aS(f.lng+360,f.lat),b=360*Math.ceil(Math.abs(f.lng-o.center.lng)/360),T=o.locationPoint3D(f).distSqr(t),I=t.x<0||t.y<0||t.x>o.width||t.y>o.height;o.locationPoint3D(p).distSqr(t)<T&&(I||Math.abs(p.lng-o.center.lng)<b)?f=p:o.locationPoint3D(y).distSqr(t)<T&&(I||Math.abs(y.lng-o.center.lng)<b)&&(f=y)}for(;Math.abs(f.lng-o.center.lng)>180;){const p=o.locationPoint3D(f);if(p.x>=0&&p.y>=0&&p.x<=o.width&&p.y<=o.height)break;f.lng>o.center.lng?f.lng-=360:f.lng+=360}return f}const il={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},qa={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class $u extends r.E{constructor(t,o){super(),(t instanceof HTMLElement||o)&&(t=Object.assign({element:t},o)),r.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:y="#3FB1CE",scale:b=1,draggable:T=!1,clickTolerance:I=0,rotation:D=qa.rotation,rotationAlignment:F=qa.rotationAlignment,pitchAlignment:z=qa.pitchAlignment,occludedOpacity:j=qa.occludedOpacity,altitude:B=qa.altitude}=t||{};this._anchor=p,this._color=y,this._scale=b,this._draggable=T,this._clickTolerance=I,this._rotation=D,this._rotationAlignment=F,this._pitchAlignment=z,this._occludedOpacity=j,this._altitude=B,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=r.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Q=>{Q.preventDefault()}),this._element.addEventListener("mousedown",Q=>{Q.preventDefault()});const $=this._element.classList;for(const Q in il)$.remove(`mapboxgl-marker-anchor-${Q}`);$.add(`mapboxgl-marker-anchor-${this._anchor}`);const Z=t&&t.className?t.className.trim().split(/\s+/):[];$.add(...Z),this._popup=null}_createDefaultMarker(){const t=ve("div"),o=xe("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const p=xe("radialGradient",{id:"shadowGradient"},xe("defs",{},o));xe("stop",{offset:"10%","stop-opacity":.4},p),xe("stop",{offset:"100%","stop-opacity":.05},p),xe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},o)}return xe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},o),xe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},o),xe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},o),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=r.aS.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||qa.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const o=t.code,p=t.charCode||t.keyCode;o!=="Space"&&o!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(t){const o=t.originalEvent.target,p=this._element;this._popup&&(o===p||p.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,o=this._pos;if(!t||!o)return!1;const p=t.unproject(o,this._altitude),y=t.getFreeCameraOptions();if(!y.position)return!1;const b=y.position.toLngLat();return b.distanceTo(p)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const o=this._pos;if(!o||o.x<0||o.x>t.transform.width||o.y<0||o.y>t.transform.height)return void this._clearFadeTimer();const p=t.unproject(o,this._altitude);let y;t._showingGlobe()&&r.f4(t.transform,this._lngLat)?y=0:(y=1-t._queryFogOpacity(p),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${il[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const t=this._pos,o=this._map,p=this.getPitchAlignment();if(!o||!t||p!=="map")return"";if(!o._showingGlobe()){const D=o.getPitch();return D?`rotateX(${D}deg)`:""}const y=r.cW(r.f5(o.transform,this._lngLat)),b=t.sub(r.f6(o.transform)),T=Math.abs(b.x)+Math.abs(b.y);if(T===0)return"";const I=y/T;return`rotateX(${-b.y*I}deg) rotateY(${b.x*I}deg)`}_calculateZTransform(){const t=this._pos,o=this._map;if(!o||!t)return"";let p=0;const y=this.getRotationAlignment();if(y==="map")if(o._showingGlobe()){const b=o.project(new r.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=o.project(new r.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);p=r.cW(Math.atan2(T.y,T.x))-90}else p=-o.getBearing();else if(y==="horizon"){const b=r.ah(4,6,o.getZoom()),T=r.f6(o.transform);T.y+=b*o.transform.height;const I=t.sub(T),D=r.cW(Math.atan2(I.y,I.x));p=(D>90?D-270:D+90)*(1-b)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=Hu(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=r.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const o=this._map;if(!o)return;const p=this._pointerdownPos,y=this._positionDelta;if(p&&y){if(!this._isDragging){const b=this._clickTolerance||o._clickTolerance;if(t.point.dist(p)<b)return;this._isDragging=!0}this._pos=t.point.sub(y),this._lngLat=o.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(t){const o=this._map,p=this._pos;o&&p&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(p),this._pointerdownPos=t.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const o=this._map;return o&&(t?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||qa.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||qa.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||qa.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||qa.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ns={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},qp={maxWidth:100,unit:"metric"},Tf={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},gy={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Tx=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _y(f=new r.P(0,0),t="bottom"){if(typeof f=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(t){case"top":return new r.P(0,f);case"top-left":return new r.P(o,o);case"top-right":return new r.P(-o,o);case"bottom":return new r.P(0,-f);case"bottom-left":return new r.P(o,-o);case"bottom-right":return new r.P(-o,-o);case"left":return new r.P(f,0);case"right":return new r.P(-f,0)}return new r.P(0,0)}return f instanceof r.P||Array.isArray(f)?r.P.convert(f):r.P.convert(f[t]||[0,0])}return{version:L,supported:de.supported,setRTLTextPlugin:r.fa,getRTLTextPluginStatus:r.f9,Map:class extends ds{constructor(f){H.mark(N.create);const t=f;if((f=Object.assign({},kh,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&r.f2(window)&&(f.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Yd(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new bf,this._domRenderTaskQueue=new bf,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.b1(),this._locale=Object.assign({},Zb,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Zl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Ii(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const o=document.getElementById(f.container);if(!o)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=o}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,r.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Np),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new xf(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||r.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new vg(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const o=f.bounds;o&&(this.resize(),this.fitBounds(o,Object.assign({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Sl({customAttribution:f.customAttribution})),this._logoControl=new ql,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new r.z(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new r.z(`${o.dataType}dataloading`,o))}),this._interactions=new my(this)}_getMapId(){return this._mapId}addControl(f,t){if(t===void 0&&(t=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[t];return t.indexOf("bottom")!==-1?p.insertBefore(o,p.firstChild):p.appendChild(o),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(f);return t>-1&&this._controls.splice(t,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new r.z("movestart",f)).fire(new r.z("move",f)),this.fire(new r.z("resize",f)),t&&this.fire(new r.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(r.aI.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(t=>t==="auto"?navigator.language:t):f}setLanguage(f){const t=this._parseLanguage(f);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,t=f.projection.name;let o;t==="globe"&&f.zoom>=r.cK?(f.setMercatorFromTransition(),o=!0):t==="mercator"&&f.zoom<r.cK&&(f.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,t){return this._updateProjection(f||t||{name:"mercator"})}_updateProjection(f){let t;const o=this.transform.mercatorFromTransition;t=f.name==="globe"&&this.transform.zoom>=r.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate();const p=this.transform.getProjection().name==="mercator"&&o!==this.transform.mercatorFromTransition;return(t||p)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,t){return this.transform.locationPoint3D(r.aS.convert(f),t)}unproject(f,t){return this.transform.pointLocation3D(r.P.convert(f),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,t,o){const p=y=>{let b=[];if(Array.isArray(t)){const T=t.filter(I=>this.getLayer(I));b=T.length?this.queryRenderedFeatures(y,{layers:T}):[]}else b=this.queryRenderedFeatures(y,{target:t});return b};if(f==="mouseenter"||f==="mouseover"){let y=!1;return{listener:o,targets:t,delegates:{mousemove:T=>{const I=p(T.point);I.length?y||(y=!0,o.call(this,new lr(f,this,T.originalEvent,{features:I}))):y=!1},mouseout:()=>{y=!1}}}}if(f==="mouseleave"||f==="mouseout"){let y=!1;return{listener:o,targets:t,delegates:{mousemove:I=>{p(I.point).length?y=!0:y&&(y=!1,o.call(this,new lr(f,this,I.originalEvent)))},mouseout:I=>{y&&(y=!1,o.call(this,new lr(f,this,I.originalEvent)))}}}}{const y=b=>{const T=p(b.point);T.length&&(b.features=T,o.call(this,b),delete b.features)};return{listener:o,targets:t,delegates:{[f]:y}}}}on(f,t,o){if(typeof t=="function"||o===void 0)return super.on(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const p=this._createDelegatedListener(f,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const y in p.delegates)this.on(y,p.delegates[y]);return this}once(f,t,o){if(typeof t=="function"||o===void 0)return super.once(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const p=this._createDelegatedListener(f,t,o);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(f,t,o){if(typeof t=="function"||o===void 0)return super.off(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(y=>{for(let b=0;b<y.length;b++){const T=y[b];if(T.listener===o&&Eg(T.targets,t)){for(const I in T.delegates)this.off(I,T.delegates[I]);return y.splice(b,1),this}}})(p),this}queryRenderedFeatures(f,t){if(!this.style)return[];if(f===void 0||f instanceof r.P||Array.isArray(f)||t!==void 0||(t=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!t){const b=this.style.queryRenderedFeatures(f,void 0,this.transform),T=this.style.queryRenderedFeatureset(f,void 0,this.transform);return b.concat(T)}let o=!0;if(t.target&&(o=this._isTargetValid(t.target),o&&!t.layers))return this.style.queryRenderedFeatureset(f,t,this.transform);let p=!0;if(t.layers&&Array.isArray(t.layers)){for(const b of t.layers)if(!this._isValidId(b)){p=!1;break}if(p&&!t.target)return this.style.queryRenderedFeatures(f,t,this.transform)}let y=[];return p&&(y=y.concat(this.style.queryRenderedFeatures(f,t,this.transform))),o&&(y=y.concat(this.style.queryRenderedFeatureset(f,t,this.transform))),y}querySourceFeatures(f,t){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,t)}queryRasterValue(f,t,o){return this._isValidId(f)?this.style.queryRasterValue(f,t,o):Promise.resolve(null)}isPointOnSurface(f){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&r.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(f))}addInteraction(f,t){return this._interactions.add(f,t),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&f&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(f,(o,p)=>{if(o){const y=typeof o=="string"?o:o instanceof Error?o.message:o.error;r.w(`Unable to perform style diff: ${y}. Rebuilding the style from scratch.`),this._updateStyle(f,t)}else p&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(f,t))}_getUIString(f){const t=this._locale[f];if(t==null)throw new Error(`Missing UI string '${f}'`);return t}_updateStyle(f,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const o=Object.assign({},t);t&&t.config&&(o.initialConfig=t.config,delete o.config),this.style=new zl(this,o).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new zl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.dq(f)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const t of f)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(f)}addSource(f,t){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,t),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,t,o){this._lazyInitEmptyStyle(),this.style.addSourceType(f,t,o)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,t,{pixelRatio:o=1,sdf:p=!1,stretchX:y,stretchY:b,content:T}={}){this._lazyInitEmptyStyle();const I=r.I.from(f);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:D,height:F,data:z}=r.o.getImageData(t);this.style.addImage(I,{data:new r.q({width:D,height:F},z),pixelRatio:o,stretchX:y,stretchY:b,content:T,sdf:p,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:D,height:F}=t,z=t;this.style.addImage(I,{data:new r.q({width:D,height:F},new Uint8Array(z.data)),pixelRatio:o,stretchX:y,stretchY:b,content:T,sdf:p,usvg:!1,version:0,userImage:z}),z.onAdd&&z.onAdd(this,f)}}updateImage(f,t){this._lazyInitEmptyStyle();const o=r.I.from(f),p=this.style.getImage(o);if(!p)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?r.o.getImageData(t):t,{width:b,height:T,data:I}=y;if(b===void 0||T===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||T!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${b}, ${T})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const D=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let F=!1;p.usvg?(p.data=new r.q({width:b,height:T},new Uint8Array(I)),p.usvg=!1,p.icon=void 0,F=!0):p.data.replace(I,D),this.style.updateImage(o,p,F)}hasImage(f){return f?!!this.style&&!!this.style.getImage(r.I.from(f)):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(r.I.from(f))}loadImage(f,t){r.n(this._requestManager.transformRequest(f,r.R.Image),(o,p)=>{t(o,p instanceof HTMLImageElement?r.o.getImageData(p):p)})}listImages(){return this.style.listImages().map(f=>f.name)}addModel(f,t){this._lazyInitEmptyStyle(),this.style.addModel(f,t)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,t){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,t),this._update(!0)):this}getSlot(f){const t=this.getLayer(f);return t&&t.slot||null}setSlot(f,t){return this.style.setSlot(f,t),this.style.mergeLayers(),this._update(!0)}addImport(f,t){return this.style.addImport(f,t).catch(o=>this.fire(new r.y(new Error("Failed to add import",o)))),this}updateImport(f,t){return typeof t!="string"&&t.id!==f?(this.removeImport(f),this.addImport(t)):(this.style.updateImport(f,t),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,t){return this.style.moveImport(f,t),this._update(!0)}moveLayer(f,t){return this._isValidId(f)?(this.style.moveLayer(f,t),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const t=this.style.getOwnLayer(f);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,t,o){return this._isValidId(f)?(this.style.setLayerZoomRange(f,t,o),this._update(!0)):this}setFilter(f,t,o={}){return this._isValidId(f)?(this.style.setFilter(f,t,o),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,t,o,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,t,o,p),this._update(!0)):this}getPaintProperty(f,t){return this._isValidId(f)?this.style.getPaintProperty(f,t):null}setLayoutProperty(f,t,o,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,t,o,p),this._update(!0)):this}getLayoutProperty(f,t){return this._isValidId(f)?this.style.getLayoutProperty(f,t):null}setLayerProperty(f,t,o,p={}){return this._isValidId(f)?(this.style.setLayerProperty(f,t,o,p),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,t){return this.style.setSchema(f,t),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,t){return this.style.setConfig(f,t),this._update(!0)}getConfigProperty(f,t){return this.style.getConfigProperty(f,t)}setConfigProperty(f,t,o){return this.style.setConfigProperty(f,t,o),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const t=f[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,t),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aS.convert(f),this.transform):0}setFeatureState(f,t){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,t),this._update())}removeFeatureState(f,t){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,t),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.indoor.selectFloor(f)}_setIndoorActiveFloorsVisibility(f){this.indoor.setActiveFloorsVisibility(f)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Ed),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let o,p,y,b=this._container;for(;b&&(!p||!y);){const T=window.getComputedStyle(b).transform;T&&T!=="none"&&(o=T.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(p=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(y=o[3])),b=b.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=y?Math.abs(t/y):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new mh(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=ve("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=ve("div","mapboxgl-canvas-container",f);this._canvas=ve("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=ve("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(y=>{p[y]=ve("div",`mapboxgl-ctrl-${y}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,t){const o=r.o.devicePixelRatio||1;this._canvas.width=o*Math.ceil(f),this._canvas.height=o*Math.ceil(t),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${t}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const t=this._markers.indexOf(f);t!==-1&&this._markers.splice(t,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const t=this._popups.indexOf(f);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const f=Object.assign({},de.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",f);t?(Ur(t,!0),this.painter=new Uu(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.k.testSupport(t)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let t;this.fire(new r.z("renderstart")),++this._frameId;const o=this.painter.context.extTimerQuery,p=r.o.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=y.createQuery(),y.beginQuery(o.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,z=this.transform.pitch,j=r.o.now(),B=new r.ac(F,{now:j,fadeDuration:b,pitch:z,transition:this.style.transition,worldview:this._worldview});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(p);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,H.mark(N.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const F=r.o.now()-p;y.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{const z=y.getQueryParameter(t,y.QUERY_RESULT)/1e6;y.deleteQuery(t),this.fire(new r.z("gpu-timing-frame",{cpuTime:F,gpuTime:z}))},50)}if(this.listens("gpu-timing-layer")){const F=this.painter.collectGpuTimers();setTimeout(()=>{const z=this.painter.queryGpuTimers(F);this.fire(new r.z("gpu-timing-layer",{layerTimes:z}))},50)}if(this.listens("gpu-timing-deferred-render")){const F=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const z=this.painter.queryGpuTimeDeferredRender(F);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:z}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(D||this._repaint)this.triggerRepaint();else{const F=this.idle();if(F&&(T=this._updateAverageElevation(p,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),F&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const z=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:z})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,H.mark(N.fullLoad),this._performanceMetricsCollection&&Ei(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const t of this._markers)f&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!f||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(f,t=!1){const o=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(t||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const y=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=f;const T=Math.abs(y-b);if(T>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(b),o(b);this._averageElevation.easeTo(b,f,300)}else if(T>1e-4)return this._averageElevation.jumpTo(b),o(b)}return!!this._averageElevation.isEasing(f)&&o(this._averageElevation.getValue(f))}_authenticate(){Rn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Nt||f.status===401)){const t=this.painter.context.gl;Ur(t,!1),this._logoControl instanceof ql&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),pr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Or(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Wr(this._requestManager._customAccessToken)}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const o=this.painter.context.gl,p=o.createFramebuffer();function y(b){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,b,0);const T=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,T),T}return o.bindFramebuffer(o.FRAMEBUFFER,p),this._canvasPixelComparison(y(f),t.canvasCopies.map(y),t.timeStamps)}_canvasPixelComparison(f,t,o){let p=o[1]-o[0];const y=f.length/4;for(let b=0;b<t.length;b++){const T=t[b];let I=0;for(let D=0;D<T.length;D+=4)T[D]===f[D]&&T[D+1]===f[D+1]&&T[D+2]===f[D+2]&&T[D+3]===f[D+3]&&(I+=1);p+=(o[b+2]-o[b+1])*(1-I/y)}return p}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),on.delete(this.painter.context.gl),Xi.remove(),pn.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=r.o.frame(t=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(t)}))}_preloadTiles(f){const t=this.style?this.style.getSourceCaches():[];return r.bv(t,(o,p)=>o._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,t){r.f3(f,t)}get version(){return L}},NavigationControl:class{constructor(f={}){this.options=Object.assign({},Ag,f),this._container=ve("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(r.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),ve("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),ve("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:t}):o.resetNorth({},{originalEvent:t}))}),this._compassIcon=ve("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const t=f.getZoom(),o=t===f.getMaxZoom(),p=t===f.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wf(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,t){const o=ve("button",f,this._container);return o.type="button",o.addEventListener("click",t),o}_setButtonTitle(f,t){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${t}`);f.setAttribute("aria-label",o),f.firstElementChild&&f.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends r.E{constructor(f={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},Ns,f),r.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=wd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=ve("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const t=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,f(o)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(o=>t(o.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(f){const t=this._map.getMaxBounds(),o=f.coords;return!!t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",Object.assign({coords:f.coords,timestamp:f.timestamp},f.toJSON?{toJSON:f.toJSON.bind(f)}:{}))),this._finish()}}_updateCamera(f){const t=new r.aS(f.coords.longitude,f.coords.latitude),o=f.coords.accuracy,p=this._map.getBearing(),y=Object.assign({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(o),y,{geolocateSource:!0})}_updateMarker(f){if(f){const t=new r.aS(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,t=r.ce(1,f._center.lat)*f.worldSize,o=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=ve("button","mapboxgl-ctrl-geolocate",this._container),ve("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ve("div","mapboxgl-user-location"),this._dotElement.appendChild(ve("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ve("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new $u({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ve("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $u({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Sl,ScaleControl:class{constructor(f={}){this.options=Object.assign({},qp,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,t=this._map,o=t._containerHeight/2,p=t._containerWidth/2-f/2,y=t.unproject([p,o]),b=t.unproject([p+f,o]),T=y.distanceTo(b);if(this.options.unit==="imperial"){const I=3.2808*T;I>5280?this._setScale(f,I/5280,"mile"):this._setScale(f,I,"foot")}else this.options.unit==="nautical"?this._setScale(f,T/1852,"nautical-mile"):T>=1e3?this._setScale(f,T/1e3,"kilometer"):this._setScale(f,T,"meter")}_setScale(f,t,o){this._map._requestDomTask(()=>{const p=function(b){const T=Math.pow(10,`${Math.floor(b)}`.length-1);let I=b/T;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(D){const F=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*F)/F}(I),T*I}(t),y=p/t;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(p):`${p}&nbsp;${Tf[o]}`,this._container.style.width=f*y+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=ve("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:r.w("Full screen control 'container' must be a DOM element.")),r.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=ve("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=ve("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ve("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Ed,Popup:class extends r.E{constructor(f){super(),this.options=Object.assign(Object.create(gy),f),this._altitude=this.options.altitude,r.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=r.aS.convert(f),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const t=document.createDocumentFragment(),o=document.createElement("body");let p;for(o.innerHTML=f;p=o.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=ve("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(f),this.options.closeButton){const o=this._closeButton=ve("button","mapboxgl-popup-close-button",t);o.type="button",o.setAttribute("aria-label","Close popup"),o.innerHTML='<span aria-hidden="true">&#215;</span>',o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let t;return this._classList.delete(f)?t=!1:(this._classList.add(f),t=!0),this._updateClassList(),t}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const t=this._map,o=this._container,p=this._pos;if(!t||!o||!p)return"bottom";const y=o.offsetWidth,b=o.offsetHeight,T=p.x<y/2,I=p.x>t.transform.width-y/2;if(p.y+f<b)return T?"top-left":I?"top-right":"top";if(p.y>t.transform.height-b){if(T)return"bottom-left";if(I)return"bottom-right"}return T?"left":I?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),f.className=t.join(" ")}_update(f){const t=this._map,o=this._content;if(!t||!this._lngLat&&!this._trackPointer||!o)return;let p=this._container;if(p||(p=this._container=ve("div","mapboxgl-popup",t.getContainer()),this._tip=ve("div","mapboxgl-popup-tip",p),p.appendChild(o)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Hu(this._lngLat,this._pos,t.transform)),!this._trackPointer||f){const y=this._pos=this._trackPointer&&f instanceof r.P?f:t.project(this._lngLat,this._altitude),b=_y(this.options.offset),T=this._anchor=this._getAnchor(b.y),I=_y(this.options.offset,T),D=y.add(I).round();t._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${il[T]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&t._showingGlobe()){const y=r.f4(t.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Tx);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:$u,Style:zl,LngLat:r.aS,LngLatBounds:r.aI,Point:r.P,MercatorCoordinate:r.ae,FreeCameraOptions:Ll,Evented:r.E,config:r.e,prewarm:r.f8,clearPrewarmedResources:r.f7,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(f){r.e.ACCESS_TOKEN=f},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(f){r.e.API_URL=f},get workerCount(){return r.fh.workerCount},set workerCount(f){r.fh.workerCount=f},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){r.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){r.fg(f)},get workerUrl(){return r.ff.workerUrl},set workerUrl(f){r.ff.workerUrl=f},get workerClass(){return r.ff.workerClass},set workerClass(f){r.ff.workerClass=f},get workerParams(){return r.ff.workerParams},set workerParams(f){r.ff.workerParams=f},get dracoUrl(){return r.fe()},set dracoUrl(f){r.fd(f)},get meshoptUrl(){return r.fc()},set meshoptUrl(f){r.fb(f)},setNow:r.o.setNow,restoreNow:r.o.restoreNow}});var A=v;return A})})(D2);var dB=D2.exports;const bb=IO(dB),Jw={paltas:"#4CAF50",hass:"#4CAF50",gem:"#66BB6A",fuerte:"#1E88E5",zutano:"#FB8C00",cerezos:"#E91E63",bing:"#C2185B",nogales:"#8D6E63",chandler:"#A1887F",serr:"#6D4C41",avellanos:"#FF9800",giffoni:"#F57C00",yamhill:"#EF6C00",ctricos:"#FDD835",eureka:"#F9A825",murcott:"#F57F17",clemenules:"#FFD600",other:"#9E9E9E"};function XA(d){if(!d)return null;try{if(typeof d=="string")try{d=JSON.parse(d)}catch{return null}if(d.type==="Polygon"&&Array.isArray(d.coordinates))return d;if(d.coordinates&&Array.isArray(d.coordinates))return{type:"Polygon",coordinates:Array.isArray(d.coordinates[0])?d.coordinates:[d.coordinates]};if(Array.isArray(d)&&d.length>0){if(Array.isArray(d[0]))return{type:"Polygon",coordinates:[d]};if(d[0].length===2)return{type:"Polygon",coordinates:[d]}}return null}catch{return null}}function fB(d){var u,_;const s=XA(d);if(!s||!((_=(u=s.coordinates)==null?void 0:u[0])!=null&&_.length))return null;try{const v=s.coordinates[0],E=new bb.LngLatBounds([v[0][0],v[0][1]],[v[0][0],v[0][1]]);return v.forEach(A=>{Array.isArray(A)&&A.length>=2&&E.extend([A[0],A[1]])}),E}catch{return null}}function pB(d){var u,_;const s=XA(d);if(!s||!((_=(u=s.coordinates)==null?void 0:u[0])!=null&&_.length))return null;try{const v=s.coordinates[0];let E=0,A=0,r=0;return v.forEach(L=>{Array.isArray(L)&&L.length>=2&&(E+=L[0],A+=L[1],r++)}),r===0?null:[E/r,A/r]}catch{return null}}function aP(d){var u,_;const s=XA(d);if(!s||!((_=(u=s.coordinates)==null?void 0:u[0])!=null&&_.length))return 0;try{const v=s.coordinates[0];let E=0;for(let r=0;r<v.length-1;r++){const[L,N]=v[r],[H,X]=v[r+1];E+=L*X-H*N}E=Math.abs(E)/2;const A=E*111e3*111e3*Math.cos(-33*Math.PI/180)/1e4;return Math.round(A*100)/100}catch{return 0}}function mB(d){return`sector-${d.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]/g,"")}`}function gB(d){if(!d)return Jw.other;const s=d.toLowerCase().trim();if(Jw[s])return Jw[s];for(const[u,_]of Object.entries(Jw))if(s.includes(u)||u.includes(s))return _;return Jw.other}function _B(d){const s=d.match(/Equipo\s+\d+/i);return s?s[0]:d}const yB=({field:d,height:s="500px",filters:u,totalSectors:_})=>{const v=ft.useRef(null),E=ft.useRef(null),A=ft.useRef(null),r=ft.useRef({}),[L,N]=ft.useState(!1),[H,X]=ft.useState(!1),[re,he]=ft.useState("heatmap"),[de,ve]=ft.useState(!0),[xe,$e]=ft.useState(!0),[Le,Ke]=ft.useState(!1),[Ge,Ye]=ft.useState(!1),[mt,Ct]=ft.useState(!1),[Vt,ui]=ft.useState(new Set),[Di,si]=ft.useState("");ft.useMemo(()=>{if(_!==void 0)return _;const _t=(d.sectors??[]).filter(fi=>fi.polygon);return new Set(_t.map(fi=>fi.name.toLowerCase())).size},[d.sectors,_]);const di=ft.useMemo(()=>{let _t=(d.sectors??[]).filter(Et=>!!Et.polygon);return u!=null&&u.species&&(_t=_t.filter(Et=>{var fi;return((fi=Et.species)==null?void 0:fi.toLowerCase())===u.species.toLowerCase()})),_t},[d.sectors,u==null?void 0:u.species]);ft.useEffect(()=>{const _t=new Set(di.map(Et=>Et.name));ui(_t)},[di]);const Nt=ft.useMemo(()=>di.reduce((_t,Et)=>_t+(Et.kg_total??0),0),[di]),Ii=ft.useMemo(()=>Math.max(...di.map(_t=>{const Et=_t.hectares||aP(_t.polygon);return Et>0?(_t.kg_total??0)/Et:0}),1),[di]);ft.useEffect(()=>{const _t="pk.eyJ1IjoibWljaGFlbHJ0IiwiYSI6ImNtZ3V2dHk0czBnNzkyam9zcmM2MjlpcWYifQ.8wBT5b8zb0rxn4F5G9HpxQ";if(bb.accessToken=_t,!E.current){try{E.current=new bb.Map({container:v.current,style:"mapbox://styles/mapbox/satellite-streets-v12",center:[-70.65,-33.45],zoom:11}),E.current.scrollZoom.enable(),E.current.doubleClickZoom.enable(),E.current.addControl(new bb.NavigationControl,"top-right"),E.current.on("load",()=>{N(!0)}),A.current=new bb.Popup({closeButton:!1,closeOnClick:!1})}catch(Et){console.error("Error inicializando mapa:",Et)}return()=>{A.current&&A.current.remove(),Object.values(r.current).forEach(Et=>Et.remove())}}},[]),ft.useEffect(()=>{var rn,zn,er;const _t=E.current;if(!_t||!L)return;const Et=((rn=d.metadata)==null?void 0:rn.polygon)||((er=(zn=d.sectors)==null?void 0:zn[0])==null?void 0:er.polygon),fi=fB(Et);if(fi)try{_t.fitBounds(fi,{padding:60,duration:800})}catch(Mn){console.error("Error ajustando bounds:",Mn)}},[d,L]),ft.useEffect(()=>{const _t=E.current;if(!(!_t||!L)){try{const Et=_t.getStyle();Et!=null&&Et.sources&&Object.keys(Et.sources).forEach(fi=>{fi.startsWith("sector-")&&(_t.getLayer(`${fi}-fill`)&&_t.removeLayer(`${fi}-fill`),_t.getLayer(`${fi}-line`)&&_t.removeLayer(`${fi}-line`),_t.getSource(fi)&&_t.removeSource(fi))})}catch(Et){console.error("Error limpiando capas:",Et)}Object.values(r.current).forEach(Et=>Et.remove()),r.current={},di.forEach(Et=>{if(!Vt.has(Et.name))return;const fi=XA(Et.polygon);if(!fi)return;const rn=mB(Et.name),zn=Et.hectares||aP(Et.polygon),er=zn>0?Math.round((Et.kg_total??0)/zn):0,Mn=_B(Et.name);try{_t.addSource(rn,{type:"geojson",data:{type:"Feature",geometry:fi,properties:{name:Et.name,equipment:Mn,kg:Et.kg_total??0,kgPerHa:er,hectares:zn,species:Et.species??"Sin especie"}}});let pn="#66BB6A";re==="species"&&(pn=gB(Et.species)),re==="heatmap"&&(pn=["interpolate",["linear"],["get","kgPerHa"],0,"#E3F2FD",Ii*.25,"#90CAF9",Ii*.5,"#42A5F5",Ii*.75,"#FB8C00",Ii,"#E65100"]),_t.addLayer({id:`${rn}-fill`,type:"fill",source:rn,paint:{"fill-color":pn,"fill-opacity":re==="normal"?.35:.6}}),_t.addLayer({id:`${rn}-line`,type:"line",source:rn,paint:{"line-color":"#263238","line-width":1.2}});const pr=pB(Et.polygon);if(pr){const Vr=[];xe&&Vr.push(Mn),de&&Vr.push(`${er.toLocaleString("es-CL")} kg/ha`);const Or=Vr.join("<br/>"),kr=document.createElement("div");kr.className="sector-label",kr.style.cssText=`
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            pointer-events: none;
            text-align: center;
            line-height: 1.4;
          `,kr.innerHTML=Or;const Wr=new bb.Marker({element:kr,anchor:"center"}).setLngLat(pr).addTo(_t);r.current[rn]=Wr}_t.on("mouseenter",`${rn}-fill`,Vr=>{var Wr,mn;_t.getCanvas().style.cursor="pointer";const Or=(mn=(Wr=Vr.features)==null?void 0:Wr[0])==null?void 0:mn.properties;if(!Or||!A.current)return;const kr=[`<strong style="color: #000;">${Or.name}</strong>`];Le&&kr.push(`<span style="color: #000;">Especie: ${Or.species}</span>`),de&&kr.push(`<span style="color: #000;">Produccin: ${Number(Or.kgPerHa).toLocaleString("es-CL")} kg/ha</span>`),mt&&kr.push(`<span style="color: #000;">Total: ${Number(Or.kg).toLocaleString("es-CL")} kg</span>`),Ge&&kr.push(`<span style="color: #000;">rea: ${Number(Or.hectares).toFixed(2)} ha</span>`),A.current.setLngLat(Vr.lngLat).setHTML(`
              <div style="font-size:12px; padding: 6px;">
                ${kr.join("<br/>")}
              </div>
            `).addTo(_t)}),_t.on("mouseleave",`${rn}-fill`,()=>{var Vr;_t.getCanvas().style.cursor="",(Vr=A.current)==null||Vr.remove()})}catch(pn){console.error(`Error dibujando sector ${Et.name}:`,pn)}})}},[di,re,Ii,L,de,xe,Le,Ge,mt,Vt]);const Qt=()=>{var Et;const _t=(Et=v.current)==null?void 0:Et.parentElement;_t&&(H?document.exitFullscreen&&document.exitFullscreen():_t.requestFullscreen&&_t.requestFullscreen(),X(!H))};return Fe.jsxDEV("div",{style:{position:"relative",height:H?"100vh":s},children:[Fe.jsxDEV("div",{style:{position:"absolute",top:10,left:10,zIndex:10,background:"rgba(0,0,0,0.75)",color:"white",padding:"8px 12px",borderRadius:6,fontSize:13,fontWeight:600},children:[Fe.jsxDEV("strong",{children:"Total campo"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:562,columnNumber:9},void 0),Fe.jsxDEV("br",{},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:562,columnNumber:37},void 0),Nt.toLocaleString("es-CL")," kg",Fe.jsxDEV("br",{},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:564,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:548,columnNumber:7},void 0),re==="heatmap"&&Fe.jsxDEV("div",{style:{position:"absolute",bottom:30,left:10,zIndex:10,background:"rgba(255,255,255,0.95)",padding:"10px",borderRadius:6,fontSize:11},children:[Fe.jsxDEV("div",{style:{fontWeight:600,marginBottom:6,color:"#000"},children:"kg/ha"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:581,columnNumber:11},void 0),Fe.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:2},children:[Fe.jsxDEV("div",{style:{width:20,height:12,background:"#E3F2FD"}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:583,columnNumber:13},void 0),Fe.jsxDEV("span",{style:{color:"#000"},children:"0"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:584,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:582,columnNumber:11},void 0),Fe.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:2},children:[Fe.jsxDEV("div",{style:{width:20,height:12,background:"#90CAF9"}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:587,columnNumber:13},void 0),Fe.jsxDEV("span",{style:{color:"#000"},children:Math.round(Ii*.25).toLocaleString()},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:588,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:586,columnNumber:11},void 0),Fe.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:2},children:[Fe.jsxDEV("div",{style:{width:20,height:12,background:"#42A5F5"}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:591,columnNumber:13},void 0),Fe.jsxDEV("span",{style:{color:"#000"},children:Math.round(Ii*.5).toLocaleString()},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:592,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:590,columnNumber:11},void 0),Fe.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:4,marginBottom:2},children:[Fe.jsxDEV("div",{style:{width:20,height:12,background:"#FB8C00"}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:595,columnNumber:13},void 0),Fe.jsxDEV("span",{style:{color:"#000"},children:Math.round(Ii*.75).toLocaleString()},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:596,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:594,columnNumber:11},void 0),Fe.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:4},children:[Fe.jsxDEV("div",{style:{width:20,height:12,background:"#E65100"}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:599,columnNumber:13},void 0),Fe.jsxDEV("span",{style:{color:"#000"},children:Math.round(Ii).toLocaleString()},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:600,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:598,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:569,columnNumber:9},void 0),Fe.jsxDEV("div",{style:{position:"absolute",top:10,right:10,zIndex:10,display:"flex",flexDirection:"column",gap:6},children:[Fe.jsxDEV("div",{style:{display:"flex",gap:6},children:["normal","species","heatmap"].map(_t=>Fe.jsxDEV("button",{onClick:()=>he(_t),style:{padding:"6px 10px",borderRadius:6,border:"none",cursor:"pointer",background:re===_t?"#0D47A1":"#90CAF9",color:"white",fontWeight:600,fontSize:12},children:_t==="normal"?"NORMAL":_t==="species"?"ESPECIE":"CALOR"},_t,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:620,columnNumber:13},void 0))},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:618,columnNumber:9},void 0),Fe.jsxDEV("div",{style:{background:"rgba(255,255,255,0.95)",padding:"8px",borderRadius:6,fontSize:11,color:"#000",maxHeight:"400px",overflowY:"auto"},children:[Fe.jsxDEV("div",{style:{fontWeight:600,marginBottom:4},children:"Mostrar en mapa:"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:649,columnNumber:11},void 0),Fe.jsxDEV("label",{style:{display:"block",marginBottom:3},children:[Fe.jsxDEV("input",{type:"checkbox",checked:xe,onChange:_t=>$e(_t.target.checked)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:651,columnNumber:13},void 0)," ","Equipo"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:650,columnNumber:11},void 0),Fe.jsxDEV("label",{style:{display:"block",marginBottom:3},children:[Fe.jsxDEV("input",{type:"checkbox",checked:de,onChange:_t=>ve(_t.target.checked)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:659,columnNumber:13},void 0)," ","kg/ha"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:658,columnNumber:11},void 0),Fe.jsxDEV("div",{style:{fontWeight:600,marginTop:6,marginBottom:4},children:"Ventana de Informacin:"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:667,columnNumber:11},void 0),Fe.jsxDEV("label",{style:{display:"block",marginBottom:3},children:[Fe.jsxDEV("input",{type:"checkbox",checked:Le,onChange:_t=>Ke(_t.target.checked)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:669,columnNumber:13},void 0)," ","Especie"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:668,columnNumber:11},void 0),Fe.jsxDEV("label",{style:{display:"block",marginBottom:3},children:[Fe.jsxDEV("input",{type:"checkbox",checked:mt,onChange:_t=>Ct(_t.target.checked)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:677,columnNumber:13},void 0)," ","Total kg"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:676,columnNumber:11},void 0),Fe.jsxDEV("label",{style:{display:"block",marginBottom:6},children:[Fe.jsxDEV("input",{type:"checkbox",checked:Ge,onChange:_t=>Ye(_t.target.checked)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:685,columnNumber:13},void 0)," ","rea (ha)"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:684,columnNumber:11},void 0),Fe.jsxDEV("div",{style:{borderTop:"1px solid #ddd",paddingTop:6,marginTop:6},children:[Fe.jsxDEV("div",{style:{fontWeight:600,marginBottom:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[Fe.jsxDEV("span",{children:"Sectores visibles:"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:706,columnNumber:15},void 0),Fe.jsxDEV("button",{onClick:()=>{const _t=di.filter(Et=>Et.name.toLowerCase().includes(Di.toLowerCase()));if(Vt.size===_t.length){const Et=new Set(Vt);_t.forEach(fi=>Et.delete(fi.name)),ui(Et)}else{const Et=new Set(Vt);_t.forEach(fi=>Et.add(fi.name)),ui(Et)}},style:{fontSize:9,padding:"2px 6px",background:"#e0e0e0",border:"none",borderRadius:3,cursor:"pointer"},children:"Todos"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:707,columnNumber:15},void 0)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:699,columnNumber:13},void 0),Fe.jsxDEV("input",{type:"text",placeholder:"Buscar sector...",value:Di,onChange:_t=>si(_t.target.value),style:{width:"100%",padding:"4px 6px",marginBottom:6,border:"1px solid #ddd",borderRadius:3,fontSize:10}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:738,columnNumber:13},void 0),Fe.jsxDEV("div",{style:{maxHeight:"150px",overflowY:"auto"},children:di.filter(_t=>_t.name.toLowerCase().includes(Di.toLowerCase())).map(_t=>Fe.jsxDEV("label",{style:{display:"block",marginBottom:2,fontSize:10},children:[Fe.jsxDEV("input",{type:"checkbox",checked:Vt.has(_t.name),onChange:Et=>{const fi=new Set(Vt);Et.target.checked?fi.add(_t.name):fi.delete(_t.name),ui(fi)}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:767,columnNumber:21},void 0)," ",_t.name]},_t.name,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:759,columnNumber:19},void 0))},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:753,columnNumber:13},void 0)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:694,columnNumber:11},void 0)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:640,columnNumber:9},void 0),Fe.jsxDEV("button",{onClick:Qt,style:{padding:"6px 10px",borderRadius:6,border:"none",cursor:"pointer",background:"#424242",color:"white",fontWeight:600,fontSize:11},children:H?"Salir ":"Pantalla Completa "},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:788,columnNumber:9},void 0)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:606,columnNumber:7},void 0),!L&&Fe.jsxDEV("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:5,background:"rgba(255,255,255,0.9)",padding:"20px",borderRadius:8},children:"Cargando mapa..."},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:806,columnNumber:9},void 0),Fe.jsxDEV("div",{ref:v,style:{width:"100%",height:"100%"}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:822,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:546,columnNumber:5},void 0)};/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function zT(d){return d+.5|0}const D_=(d,s,u)=>Math.max(Math.min(d,u),s);function oT(d){return D_(zT(d*2.55),0,255)}function F_(d){return D_(zT(d*255),0,255)}function Om(d){return D_(zT(d/2.55)/100,0,1)}function sP(d){return D_(zT(d*100),0,100)}const rd={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},TR=[..."0123456789ABCDEF"],vB=d=>TR[d&15],xB=d=>TR[(d&240)>>4]+TR[d&15],QE=d=>(d&240)>>4===(d&15),bB=d=>QE(d.r)&&QE(d.g)&&QE(d.b)&&QE(d.a);function wB(d){var s=d.length,u;return d[0]==="#"&&(s===4||s===5?u={r:255&rd[d[1]]*17,g:255&rd[d[2]]*17,b:255&rd[d[3]]*17,a:s===5?rd[d[4]]*17:255}:(s===7||s===9)&&(u={r:rd[d[1]]<<4|rd[d[2]],g:rd[d[3]]<<4|rd[d[4]],b:rd[d[5]]<<4|rd[d[6]],a:s===9?rd[d[7]]<<4|rd[d[8]]:255})),u}const TB=(d,s)=>d<255?s(d):"";function SB(d){var s=bB(d)?vB:xB;return d?"#"+s(d.r)+s(d.g)+s(d.b)+TB(d.a,s):void 0}const EB=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function P2(d,s,u){const _=s*Math.min(u,1-u),v=(E,A=(E+d/30)%12)=>u-_*Math.max(Math.min(A-3,9-A,1),-1);return[v(0),v(8),v(4)]}function AB(d,s,u){const _=(v,E=(v+d/60)%6)=>u-u*s*Math.max(Math.min(E,4-E,1),0);return[_(5),_(3),_(1)]}function CB(d,s,u){const _=P2(d,1,.5);let v;for(s+u>1&&(v=1/(s+u),s*=v,u*=v),v=0;v<3;v++)_[v]*=1-s-u,_[v]+=s;return _}function IB(d,s,u,_,v){return d===v?(s-u)/_+(s<u?6:0):s===v?(u-d)/_+2:(d-s)/_+4}function eD(d){const u=d.r/255,_=d.g/255,v=d.b/255,E=Math.max(u,_,v),A=Math.min(u,_,v),r=(E+A)/2;let L,N,H;return E!==A&&(H=E-A,N=r>.5?H/(2-E-A):H/(E+A),L=IB(u,_,v,H,E),L=L*60+.5),[L|0,N||0,r]}function tD(d,s,u,_){return(Array.isArray(s)?d(s[0],s[1],s[2]):d(s,u,_)).map(F_)}function iD(d,s,u){return tD(P2,d,s,u)}function RB(d,s,u){return tD(CB,d,s,u)}function DB(d,s,u){return tD(AB,d,s,u)}function O2(d){return(d%360+360)%360}function MB(d){const s=EB.exec(d);let u=255,_;if(!s)return;s[5]!==_&&(u=s[6]?oT(+s[5]):F_(+s[5]));const v=O2(+s[2]),E=+s[3]/100,A=+s[4]/100;return s[1]==="hwb"?_=RB(v,E,A):s[1]==="hsv"?_=DB(v,E,A):_=iD(v,E,A),{r:_[0],g:_[1],b:_[2],a:u}}function PB(d,s){var u=eD(d);u[0]=O2(u[0]+s),u=iD(u),d.r=u[0],d.g=u[1],d.b=u[2]}function OB(d){if(!d)return;const s=eD(d),u=s[0],_=sP(s[1]),v=sP(s[2]);return d.a<255?`hsla(${u}, ${_}%, ${v}%, ${Om(d.a)})`:`hsl(${u}, ${_}%, ${v}%)`}const lP={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},cP={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function kB(){const d={},s=Object.keys(cP),u=Object.keys(lP);let _,v,E,A,r;for(_=0;_<s.length;_++){for(A=r=s[_],v=0;v<u.length;v++)E=u[v],r=r.replace(E,lP[E]);E=parseInt(cP[A],16),d[r]=[E>>16&255,E>>8&255,E&255]}return d}let eA;function FB(d){eA||(eA=kB(),eA.transparent=[0,0,0,0]);const s=eA[d.toLowerCase()];return s&&{r:s[0],g:s[1],b:s[2],a:s.length===4?s[3]:255}}const LB=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function zB(d){const s=LB.exec(d);let u=255,_,v,E;if(s){if(s[7]!==_){const A=+s[7];u=s[8]?oT(A):D_(A*255,0,255)}return _=+s[1],v=+s[3],E=+s[5],_=255&(s[2]?oT(_):D_(_,0,255)),v=255&(s[4]?oT(v):D_(v,0,255)),E=255&(s[6]?oT(E):D_(E,0,255)),{r:_,g:v,b:E,a:u}}}function NB(d){return d&&(d.a<255?`rgba(${d.r}, ${d.g}, ${d.b}, ${Om(d.a)})`:`rgb(${d.r}, ${d.g}, ${d.b})`)}const JI=d=>d<=.0031308?d*12.92:Math.pow(d,1/2.4)*1.055-.055,_b=d=>d<=.04045?d/12.92:Math.pow((d+.055)/1.055,2.4);function BB(d,s,u){const _=_b(Om(d.r)),v=_b(Om(d.g)),E=_b(Om(d.b));return{r:F_(JI(_+u*(_b(Om(s.r))-_))),g:F_(JI(v+u*(_b(Om(s.g))-v))),b:F_(JI(E+u*(_b(Om(s.b))-E))),a:d.a+u*(s.a-d.a)}}function tA(d,s,u){if(d){let _=eD(d);_[s]=Math.max(0,Math.min(_[s]+_[s]*u,s===0?360:1)),_=iD(_),d.r=_[0],d.g=_[1],d.b=_[2]}}function k2(d,s){return d&&Object.assign(s||{},d)}function uP(d){var s={r:0,g:0,b:0,a:255};return Array.isArray(d)?d.length>=3&&(s={r:d[0],g:d[1],b:d[2],a:255},d.length>3&&(s.a=F_(d[3]))):(s=k2(d,{r:0,g:0,b:0,a:1}),s.a=F_(s.a)),s}function VB(d){return d.charAt(0)==="r"?zB(d):MB(d)}class ET{constructor(s){if(s instanceof ET)return s;const u=typeof s;let _;u==="object"?_=uP(s):u==="string"&&(_=wB(s)||FB(s)||VB(s)),this._rgb=_,this._valid=!!_}get valid(){return this._valid}get rgb(){var s=k2(this._rgb);return s&&(s.a=Om(s.a)),s}set rgb(s){this._rgb=uP(s)}rgbString(){return this._valid?NB(this._rgb):void 0}hexString(){return this._valid?SB(this._rgb):void 0}hslString(){return this._valid?OB(this._rgb):void 0}mix(s,u){if(s){const _=this.rgb,v=s.rgb;let E;const A=u===E?.5:u,r=2*A-1,L=_.a-v.a,N=((r*L===-1?r:(r+L)/(1+r*L))+1)/2;E=1-N,_.r=255&N*_.r+E*v.r+.5,_.g=255&N*_.g+E*v.g+.5,_.b=255&N*_.b+E*v.b+.5,_.a=A*_.a+(1-A)*v.a,this.rgb=_}return this}interpolate(s,u){return s&&(this._rgb=BB(this._rgb,s._rgb,u)),this}clone(){return new ET(this.rgb)}alpha(s){return this._rgb.a=F_(s),this}clearer(s){const u=this._rgb;return u.a*=1-s,this}greyscale(){const s=this._rgb,u=zT(s.r*.3+s.g*.59+s.b*.11);return s.r=s.g=s.b=u,this}opaquer(s){const u=this._rgb;return u.a*=1+s,this}negate(){const s=this._rgb;return s.r=255-s.r,s.g=255-s.g,s.b=255-s.b,this}lighten(s){return tA(this._rgb,2,s),this}darken(s){return tA(this._rgb,2,-s),this}saturate(s){return tA(this._rgb,1,s),this}desaturate(s){return tA(this._rgb,1,-s),this}rotate(s){return PB(this._rgb,s),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Dm(){}const UB=(()=>{let d=0;return()=>d++})();function wo(d){return d==null}function Ys(d){if(Array.isArray&&Array.isArray(d))return!0;const s=Object.prototype.toString.call(d);return s.slice(0,7)==="[object"&&s.slice(-6)==="Array]"}function Po(d){return d!==null&&Object.prototype.toString.call(d)==="[object Object]"}function od(d){return(typeof d=="number"||d instanceof Number)&&isFinite(+d)}function np(d,s){return od(d)?d:s}function Jr(d,s){return typeof d>"u"?s:d}const jB=(d,s)=>typeof d=="string"&&d.endsWith("%")?parseFloat(d)/100*s:+d;function pa(d,s,u){if(d&&typeof d.call=="function")return d.apply(u,s)}function Xo(d,s,u,_){let v,E,A;if(Ys(d))for(E=d.length,v=0;v<E;v++)s.call(u,d[v],v);else if(Po(d))for(A=Object.keys(d),E=A.length,v=0;v<E;v++)s.call(u,d[A[v]],A[v])}function MA(d,s){let u,_,v,E;if(!d||!s||d.length!==s.length)return!1;for(u=0,_=d.length;u<_;++u)if(v=d[u],E=s[u],v.datasetIndex!==E.datasetIndex||v.index!==E.index)return!1;return!0}function PA(d){if(Ys(d))return d.map(PA);if(Po(d)){const s=Object.create(null),u=Object.keys(d),_=u.length;let v=0;for(;v<_;++v)s[u[v]]=PA(d[u[v]]);return s}return d}function F2(d){return["__proto__","prototype","constructor"].indexOf(d)===-1}function GB(d,s,u,_){if(!F2(d))return;const v=s[d],E=u[d];Po(v)&&Po(E)?cp(v,E,_):s[d]=PA(E)}function cp(d,s,u){const _=Ys(s)?s:[s],v=_.length;if(!Po(d))return d;u=u||{};const E=u.merger||GB;let A;for(let r=0;r<v;++r){if(A=_[r],!Po(A))continue;const L=Object.keys(A);for(let N=0,H=L.length;N<H;++N)E(L[N],d,A,u)}return d}function dT(d,s){return cp(d,s,{merger:HB})}function HB(d,s,u){if(!F2(d))return;const _=s[d],v=u[d];Po(_)&&Po(v)?dT(_,v):Object.prototype.hasOwnProperty.call(s,d)||(s[d]=PA(v))}const hP={"":d=>d,x:d=>d.x,y:d=>d.y};function $B(d){const s=d.split("."),u=[];let _="";for(const v of s)_+=v,_.endsWith("\\")?_=_.slice(0,-1)+".":(u.push(_),_="");return u}function WB(d){const s=$B(d);return u=>{for(const _ of s){if(_==="")break;u=u&&u[_]}return u}}function Rb(d,s){return(hP[s]||(hP[s]=WB(s)))(d)}function nD(d){return d.charAt(0).toUpperCase()+d.slice(1)}const AT=d=>typeof d<"u",z_=d=>typeof d=="function",dP=(d,s)=>{if(d.size!==s.size)return!1;for(const u of d)if(!s.has(u))return!1;return!0};function qB(d){return d.type==="mouseup"||d.type==="click"||d.type==="contextmenu"}const Ra=Math.PI,kl=2*Ra,ZB=kl+Ra,OA=Number.POSITIVE_INFINITY,XB=Ra/180,Ol=Ra/2,Fv=Ra/4,fP=Ra*2/3,L2=Math.log10,lp=Math.sign;function fT(d,s,u){return Math.abs(d-s)<u}function pP(d){const s=Math.round(d);d=fT(d,s,d/1e3)?s:d;const u=Math.pow(10,Math.floor(L2(d))),_=d/u;return(_<=1?1:_<=2?2:_<=5?5:10)*u}function YB(d){const s=[],u=Math.sqrt(d);let _;for(_=1;_<u;_++)d%_===0&&(s.push(_),s.push(d/_));return u===(u|0)&&s.push(u),s.sort((v,E)=>v-E).pop(),s}function KB(d){return typeof d=="symbol"||typeof d=="object"&&d!==null&&!(Symbol.toPrimitive in d||"toString"in d||"valueOf"in d)}function CT(d){return!KB(d)&&!isNaN(parseFloat(d))&&isFinite(d)}function JB(d,s){const u=Math.round(d);return u-s<=d&&u+s>=d}function QB(d,s,u){let _,v,E;for(_=0,v=d.length;_<v;_++)E=d[_][u],isNaN(E)||(s.min=Math.min(s.min,E),s.max=Math.max(s.max,E))}function $v(d){return d*(Ra/180)}function e5(d){return d*(180/Ra)}function mP(d){if(!od(d))return;let s=1,u=0;for(;Math.round(d*s)/s!==d;)s*=10,u++;return u}function z2(d,s){const u=s.x-d.x,_=s.y-d.y,v=Math.sqrt(u*u+_*_);let E=Math.atan2(_,u);return E<-.5*Ra&&(E+=kl),{angle:E,distance:v}}function SR(d,s){return Math.sqrt(Math.pow(s.x-d.x,2)+Math.pow(s.y-d.y,2))}function t5(d,s){return(d-s+ZB)%kl-Ra}function Ud(d){return(d%kl+kl)%kl}function rD(d,s,u,_){const v=Ud(d),E=Ud(s),A=Ud(u),r=Ud(E-v),L=Ud(A-v),N=Ud(v-E),H=Ud(v-A);return v===E||v===A||_&&E===A||r>L&&N<H}function ec(d,s,u){return Math.max(s,Math.min(u,d))}function i5(d){return ec(d,-32768,32767)}function M_(d,s,u,_=1e-6){return d>=Math.min(s,u)-_&&d<=Math.max(s,u)+_}function oD(d,s,u){u=u||(A=>d[A]<s);let _=d.length-1,v=0,E;for(;_-v>1;)E=v+_>>1,u(E)?v=E:_=E;return{lo:v,hi:_}}const Wv=(d,s,u,_)=>oD(d,u,_?v=>{const E=d[v][s];return E<u||E===u&&d[v+1][s]===u}:v=>d[v][s]<u),n5=(d,s,u)=>oD(d,u,_=>d[_][s]>=u);function r5(d,s,u){let _=0,v=d.length;for(;_<v&&d[_]<s;)_++;for(;v>_&&d[v-1]>u;)v--;return _>0||v<d.length?d.slice(_,v):d}const N2=["push","pop","shift","splice","unshift"];function o5(d,s){if(d._chartjs){d._chartjs.listeners.push(s);return}Object.defineProperty(d,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[s]}}),N2.forEach(u=>{const _="_onData"+nD(u),v=d[u];Object.defineProperty(d,u,{configurable:!0,enumerable:!1,value(...E){const A=v.apply(this,E);return d._chartjs.listeners.forEach(r=>{typeof r[_]=="function"&&r[_](...E)}),A}})})}function gP(d,s){const u=d._chartjs;if(!u)return;const _=u.listeners,v=_.indexOf(s);v!==-1&&_.splice(v,1),!(_.length>0)&&(N2.forEach(E=>{delete d[E]}),delete d._chartjs)}function B2(d){const s=new Set(d);return s.size===d.length?d:Array.from(s)}const V2=function(){return typeof window>"u"?function(d){return d()}:window.requestAnimationFrame}();function U2(d,s){let u=[],_=!1;return function(...v){u=v,_||(_=!0,V2.call(window,()=>{_=!1,d.apply(s,u)}))}}function a5(d,s){let u;return function(..._){return s?(clearTimeout(u),u=setTimeout(d,s,_)):d.apply(this,_),s}}const j2=d=>d==="start"?"left":d==="end"?"right":"center",lh=(d,s,u)=>d==="start"?s:d==="end"?u:(s+u)/2,s5=(d,s,u,_)=>d===(_?"left":"right")?u:d==="center"?(s+u)/2:s;function l5(d,s,u){const _=s.length;let v=0,E=_;if(d._sorted){const{iScale:A,vScale:r,_parsed:L}=d,N=d.dataset&&d.dataset.options?d.dataset.options.spanGaps:null,H=A.axis,{min:X,max:re,minDefined:he,maxDefined:de}=A.getUserBounds();if(he){if(v=Math.min(Wv(L,H,X).lo,u?_:Wv(s,H,A.getPixelForValue(X)).lo),N){const ve=L.slice(0,v+1).reverse().findIndex(xe=>!wo(xe[r.axis]));v-=Math.max(0,ve)}v=ec(v,0,_-1)}if(de){let ve=Math.max(Wv(L,A.axis,re,!0).hi+1,u?0:Wv(s,H,A.getPixelForValue(re),!0).hi+1);if(N){const xe=L.slice(ve-1).findIndex($e=>!wo($e[r.axis]));ve+=Math.max(0,xe)}E=ec(ve,v,_)-v}else E=_-v}return{start:v,count:E}}function c5(d){const{xScale:s,yScale:u,_scaleRanges:_}=d,v={xmin:s.min,xmax:s.max,ymin:u.min,ymax:u.max};if(!_)return d._scaleRanges=v,!0;const E=_.xmin!==s.min||_.xmax!==s.max||_.ymin!==u.min||_.ymax!==u.max;return Object.assign(_,v),E}const iA=d=>d===0||d===1,_P=(d,s,u)=>-(Math.pow(2,10*(d-=1))*Math.sin((d-s)*kl/u)),yP=(d,s,u)=>Math.pow(2,-10*d)*Math.sin((d-s)*kl/u)+1,pT={linear:d=>d,easeInQuad:d=>d*d,easeOutQuad:d=>-d*(d-2),easeInOutQuad:d=>(d/=.5)<1?.5*d*d:-.5*(--d*(d-2)-1),easeInCubic:d=>d*d*d,easeOutCubic:d=>(d-=1)*d*d+1,easeInOutCubic:d=>(d/=.5)<1?.5*d*d*d:.5*((d-=2)*d*d+2),easeInQuart:d=>d*d*d*d,easeOutQuart:d=>-((d-=1)*d*d*d-1),easeInOutQuart:d=>(d/=.5)<1?.5*d*d*d*d:-.5*((d-=2)*d*d*d-2),easeInQuint:d=>d*d*d*d*d,easeOutQuint:d=>(d-=1)*d*d*d*d+1,easeInOutQuint:d=>(d/=.5)<1?.5*d*d*d*d*d:.5*((d-=2)*d*d*d*d+2),easeInSine:d=>-Math.cos(d*Ol)+1,easeOutSine:d=>Math.sin(d*Ol),easeInOutSine:d=>-.5*(Math.cos(Ra*d)-1),easeInExpo:d=>d===0?0:Math.pow(2,10*(d-1)),easeOutExpo:d=>d===1?1:-Math.pow(2,-10*d)+1,easeInOutExpo:d=>iA(d)?d:d<.5?.5*Math.pow(2,10*(d*2-1)):.5*(-Math.pow(2,-10*(d*2-1))+2),easeInCirc:d=>d>=1?d:-(Math.sqrt(1-d*d)-1),easeOutCirc:d=>Math.sqrt(1-(d-=1)*d),easeInOutCirc:d=>(d/=.5)<1?-.5*(Math.sqrt(1-d*d)-1):.5*(Math.sqrt(1-(d-=2)*d)+1),easeInElastic:d=>iA(d)?d:_P(d,.075,.3),easeOutElastic:d=>iA(d)?d:yP(d,.075,.3),easeInOutElastic(d){return iA(d)?d:d<.5?.5*_P(d*2,.1125,.45):.5+.5*yP(d*2-1,.1125,.45)},easeInBack(d){return d*d*((1.70158+1)*d-1.70158)},easeOutBack(d){return(d-=1)*d*((1.70158+1)*d+1.70158)+1},easeInOutBack(d){let s=1.70158;return(d/=.5)<1?.5*(d*d*(((s*=1.525)+1)*d-s)):.5*((d-=2)*d*(((s*=1.525)+1)*d+s)+2)},easeInBounce:d=>1-pT.easeOutBounce(1-d),easeOutBounce(d){return d<1/2.75?7.5625*d*d:d<2/2.75?7.5625*(d-=1.5/2.75)*d+.75:d<2.5/2.75?7.5625*(d-=2.25/2.75)*d+.9375:7.5625*(d-=2.625/2.75)*d+.984375},easeInOutBounce:d=>d<.5?pT.easeInBounce(d*2)*.5:pT.easeOutBounce(d*2-1)*.5+.5};function aD(d){if(d&&typeof d=="object"){const s=d.toString();return s==="[object CanvasPattern]"||s==="[object CanvasGradient]"}return!1}function vP(d){return aD(d)?d:new ET(d)}function QI(d){return aD(d)?d:new ET(d).saturate(.5).darken(.1).hexString()}const u5=["x","y","borderWidth","radius","tension"],h5=["color","borderColor","backgroundColor"];function d5(d){d.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),d.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:s=>s!=="onProgress"&&s!=="onComplete"&&s!=="fn"}),d.set("animations",{colors:{type:"color",properties:h5},numbers:{type:"number",properties:u5}}),d.describe("animations",{_fallback:"animation"}),d.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:s=>s|0}}}})}function f5(d){d.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const xP=new Map;function p5(d,s){s=s||{};const u=d+JSON.stringify(s);let _=xP.get(u);return _||(_=new Intl.NumberFormat(d,s),xP.set(u,_)),_}function G2(d,s,u){return p5(s,u).format(d)}const m5={values(d){return Ys(d)?d:""+d},numeric(d,s,u){if(d===0)return"0";const _=this.chart.options.locale;let v,E=d;if(u.length>1){const N=Math.max(Math.abs(u[0].value),Math.abs(u[u.length-1].value));(N<1e-4||N>1e15)&&(v="scientific"),E=g5(d,u)}const A=L2(Math.abs(E)),r=isNaN(A)?1:Math.max(Math.min(-1*Math.floor(A),20),0),L={notation:v,minimumFractionDigits:r,maximumFractionDigits:r};return Object.assign(L,this.options.ticks.format),G2(d,_,L)}};function g5(d,s){let u=s.length>3?s[2].value-s[1].value:s[1].value-s[0].value;return Math.abs(u)>=1&&d!==Math.floor(d)&&(u=d-Math.floor(d)),u}var H2={formatters:m5};function _5(d){d.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(s,u)=>u.lineWidth,tickColor:(s,u)=>u.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:H2.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),d.route("scale.ticks","color","","color"),d.route("scale.grid","color","","borderColor"),d.route("scale.border","color","","borderColor"),d.route("scale.title","color","","color"),d.describe("scale",{_fallback:!1,_scriptable:s=>!s.startsWith("before")&&!s.startsWith("after")&&s!=="callback"&&s!=="parser",_indexable:s=>s!=="borderDash"&&s!=="tickBorderDash"&&s!=="dash"}),d.describe("scales",{_fallback:"scale"}),d.describe("scale.ticks",{_scriptable:s=>s!=="backdropPadding"&&s!=="callback",_indexable:s=>s!=="backdropPadding"})}const Yv=Object.create(null),ER=Object.create(null);function mT(d,s){if(!s)return d;const u=s.split(".");for(let _=0,v=u.length;_<v;++_){const E=u[_];d=d[E]||(d[E]=Object.create(null))}return d}function eR(d,s,u){return typeof s=="string"?cp(mT(d,s),u):cp(mT(d,""),s)}class y5{constructor(s,u){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=_=>_.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(_,v)=>QI(v.backgroundColor),this.hoverBorderColor=(_,v)=>QI(v.borderColor),this.hoverColor=(_,v)=>QI(v.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(s),this.apply(u)}set(s,u){return eR(this,s,u)}get(s){return mT(this,s)}describe(s,u){return eR(ER,s,u)}override(s,u){return eR(Yv,s,u)}route(s,u,_,v){const E=mT(this,s),A=mT(this,_),r="_"+u;Object.defineProperties(E,{[r]:{value:E[u],writable:!0},[u]:{enumerable:!0,get(){const L=this[r],N=A[v];return Po(L)?Object.assign({},N,L):Jr(L,N)},set(L){this[r]=L}}})}apply(s){s.forEach(u=>u(this))}}var rs=new y5({_scriptable:d=>!d.startsWith("on"),_indexable:d=>d!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[d5,f5,_5]);function v5(d){return!d||wo(d.size)||wo(d.family)?null:(d.style?d.style+" ":"")+(d.weight?d.weight+" ":"")+d.size+"px "+d.family}function bP(d,s,u,_,v){let E=s[v];return E||(E=s[v]=d.measureText(v).width,u.push(v)),E>_&&(_=E),_}function Lv(d,s,u){const _=d.currentDevicePixelRatio,v=u!==0?Math.max(u/2,.5):0;return Math.round((s-v)*_)/_+v}function wP(d,s){!s&&!d||(s=s||d.getContext("2d"),s.save(),s.resetTransform(),s.clearRect(0,0,d.width,d.height),s.restore())}function AR(d,s,u,_){$2(d,s,u,_,null)}function $2(d,s,u,_,v){let E,A,r,L,N,H,X,re;const he=s.pointStyle,de=s.rotation,ve=s.radius;let xe=(de||0)*XB;if(he&&typeof he=="object"&&(E=he.toString(),E==="[object HTMLImageElement]"||E==="[object HTMLCanvasElement]")){d.save(),d.translate(u,_),d.rotate(xe),d.drawImage(he,-he.width/2,-he.height/2,he.width,he.height),d.restore();return}if(!(isNaN(ve)||ve<=0)){switch(d.beginPath(),he){default:v?d.ellipse(u,_,v/2,ve,0,0,kl):d.arc(u,_,ve,0,kl),d.closePath();break;case"triangle":H=v?v/2:ve,d.moveTo(u+Math.sin(xe)*H,_-Math.cos(xe)*ve),xe+=fP,d.lineTo(u+Math.sin(xe)*H,_-Math.cos(xe)*ve),xe+=fP,d.lineTo(u+Math.sin(xe)*H,_-Math.cos(xe)*ve),d.closePath();break;case"rectRounded":N=ve*.516,L=ve-N,A=Math.cos(xe+Fv)*L,X=Math.cos(xe+Fv)*(v?v/2-N:L),r=Math.sin(xe+Fv)*L,re=Math.sin(xe+Fv)*(v?v/2-N:L),d.arc(u-X,_-r,N,xe-Ra,xe-Ol),d.arc(u+re,_-A,N,xe-Ol,xe),d.arc(u+X,_+r,N,xe,xe+Ol),d.arc(u-re,_+A,N,xe+Ol,xe+Ra),d.closePath();break;case"rect":if(!de){L=Math.SQRT1_2*ve,H=v?v/2:L,d.rect(u-H,_-L,2*H,2*L);break}xe+=Fv;case"rectRot":X=Math.cos(xe)*(v?v/2:ve),A=Math.cos(xe)*ve,r=Math.sin(xe)*ve,re=Math.sin(xe)*(v?v/2:ve),d.moveTo(u-X,_-r),d.lineTo(u+re,_-A),d.lineTo(u+X,_+r),d.lineTo(u-re,_+A),d.closePath();break;case"crossRot":xe+=Fv;case"cross":X=Math.cos(xe)*(v?v/2:ve),A=Math.cos(xe)*ve,r=Math.sin(xe)*ve,re=Math.sin(xe)*(v?v/2:ve),d.moveTo(u-X,_-r),d.lineTo(u+X,_+r),d.moveTo(u+re,_-A),d.lineTo(u-re,_+A);break;case"star":X=Math.cos(xe)*(v?v/2:ve),A=Math.cos(xe)*ve,r=Math.sin(xe)*ve,re=Math.sin(xe)*(v?v/2:ve),d.moveTo(u-X,_-r),d.lineTo(u+X,_+r),d.moveTo(u+re,_-A),d.lineTo(u-re,_+A),xe+=Fv,X=Math.cos(xe)*(v?v/2:ve),A=Math.cos(xe)*ve,r=Math.sin(xe)*ve,re=Math.sin(xe)*(v?v/2:ve),d.moveTo(u-X,_-r),d.lineTo(u+X,_+r),d.moveTo(u+re,_-A),d.lineTo(u-re,_+A);break;case"line":A=v?v/2:Math.cos(xe)*ve,r=Math.sin(xe)*ve,d.moveTo(u-A,_-r),d.lineTo(u+A,_+r);break;case"dash":d.moveTo(u,_),d.lineTo(u+Math.cos(xe)*(v?v/2:ve),_+Math.sin(xe)*ve);break;case!1:d.closePath();break}d.fill(),s.borderWidth>0&&d.stroke()}}function IT(d,s,u){return u=u||.5,!s||d&&d.x>s.left-u&&d.x<s.right+u&&d.y>s.top-u&&d.y<s.bottom+u}function sD(d,s){d.save(),d.beginPath(),d.rect(s.left,s.top,s.right-s.left,s.bottom-s.top),d.clip()}function lD(d){d.restore()}function x5(d,s,u,_,v){if(!s)return d.lineTo(u.x,u.y);if(v==="middle"){const E=(s.x+u.x)/2;d.lineTo(E,s.y),d.lineTo(E,u.y)}else v==="after"!=!!_?d.lineTo(s.x,u.y):d.lineTo(u.x,s.y);d.lineTo(u.x,u.y)}function b5(d,s,u,_){if(!s)return d.lineTo(u.x,u.y);d.bezierCurveTo(_?s.cp1x:s.cp2x,_?s.cp1y:s.cp2y,_?u.cp2x:u.cp1x,_?u.cp2y:u.cp1y,u.x,u.y)}function w5(d,s){s.translation&&d.translate(s.translation[0],s.translation[1]),wo(s.rotation)||d.rotate(s.rotation),s.color&&(d.fillStyle=s.color),s.textAlign&&(d.textAlign=s.textAlign),s.textBaseline&&(d.textBaseline=s.textBaseline)}function T5(d,s,u,_,v){if(v.strikethrough||v.underline){const E=d.measureText(_),A=s-E.actualBoundingBoxLeft,r=s+E.actualBoundingBoxRight,L=u-E.actualBoundingBoxAscent,N=u+E.actualBoundingBoxDescent,H=v.strikethrough?(L+N)/2:N;d.strokeStyle=d.fillStyle,d.beginPath(),d.lineWidth=v.decorationWidth||2,d.moveTo(A,H),d.lineTo(r,H),d.stroke()}}function S5(d,s){const u=d.fillStyle;d.fillStyle=s.color,d.fillRect(s.left,s.top,s.width,s.height),d.fillStyle=u}function kA(d,s,u,_,v,E={}){const A=Ys(s)?s:[s],r=E.strokeWidth>0&&E.strokeColor!=="";let L,N;for(d.save(),d.font=v.string,w5(d,E),L=0;L<A.length;++L)N=A[L],E.backdrop&&S5(d,E.backdrop),r&&(E.strokeColor&&(d.strokeStyle=E.strokeColor),wo(E.strokeWidth)||(d.lineWidth=E.strokeWidth),d.strokeText(N,u,_,E.maxWidth)),d.fillText(N,u,_,E.maxWidth),T5(d,u,_,N,E),_+=Number(v.lineHeight);d.restore()}function FA(d,s){const{x:u,y:_,w:v,h:E,radius:A}=s;d.arc(u+A.topLeft,_+A.topLeft,A.topLeft,1.5*Ra,Ra,!0),d.lineTo(u,_+E-A.bottomLeft),d.arc(u+A.bottomLeft,_+E-A.bottomLeft,A.bottomLeft,Ra,Ol,!0),d.lineTo(u+v-A.bottomRight,_+E),d.arc(u+v-A.bottomRight,_+E-A.bottomRight,A.bottomRight,Ol,0,!0),d.lineTo(u+v,_+A.topRight),d.arc(u+v-A.topRight,_+A.topRight,A.topRight,0,-Ol,!0),d.lineTo(u+A.topLeft,_)}const E5=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,A5=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function C5(d,s){const u=(""+d).match(E5);if(!u||u[1]==="normal")return s*1.2;switch(d=+u[2],u[3]){case"px":return d;case"%":d/=100;break}return s*d}const I5=d=>+d||0;function cD(d,s){const u={},_=Po(s),v=_?Object.keys(s):s,E=Po(d)?_?A=>Jr(d[A],d[s[A]]):A=>d[A]:()=>d;for(const A of v)u[A]=I5(E(A));return u}function W2(d){return cD(d,{top:"y",right:"x",bottom:"y",left:"x"})}function Tb(d){return cD(d,["topLeft","topRight","bottomLeft","bottomRight"])}function ad(d){const s=W2(d);return s.width=s.left+s.right,s.height=s.top+s.bottom,s}function Cc(d,s){d=d||{},s=s||rs.font;let u=Jr(d.size,s.size);typeof u=="string"&&(u=parseInt(u,10));let _=Jr(d.style,s.style);_&&!(""+_).match(A5)&&(console.warn('Invalid font style specified: "'+_+'"'),_=void 0);const v={family:Jr(d.family,s.family),lineHeight:C5(Jr(d.lineHeight,s.lineHeight),u),size:u,style:_,weight:Jr(d.weight,s.weight),string:""};return v.string=v5(v),v}function Ua(d,s,u,_){let v,E,A;for(v=0,E=d.length;v<E;++v)if(A=d[v],A!==void 0&&(s!==void 0&&typeof A=="function"&&(A=A(s)),u!==void 0&&Ys(A)&&(A=A[u%A.length]),A!==void 0))return A}function R5(d,s,u){const{min:_,max:v}=d,E=jB(s,(v-_)/2),A=(r,L)=>u&&r===0?0:r+L;return{min:A(_,-Math.abs(E)),max:A(v,E)}}function Qv(d,s){return Object.assign(Object.create(d),s)}function uD(d,s=[""],u,_,v=()=>d[0]){const E=u||d;typeof _>"u"&&(_=Y2("_fallback",d));const A={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:d,_rootScopes:E,_fallback:_,_getTarget:v,override:r=>uD([r,...d],s,E,_)};return new Proxy(A,{deleteProperty(r,L){return delete r[L],delete r._keys,delete d[0][L],!0},get(r,L){return Z2(r,L,()=>z5(L,s,d,r))},getOwnPropertyDescriptor(r,L){return Reflect.getOwnPropertyDescriptor(r._scopes[0],L)},getPrototypeOf(){return Reflect.getPrototypeOf(d[0])},has(r,L){return SP(r).includes(L)},ownKeys(r){return SP(r)},set(r,L,N){const H=r._storage||(r._storage=v());return r[L]=H[L]=N,delete r._keys,!0}})}function Db(d,s,u,_){const v={_cacheable:!1,_proxy:d,_context:s,_subProxy:u,_stack:new Set,_descriptors:q2(d,_),setContext:E=>Db(d,E,u,_),override:E=>Db(d.override(E),s,u,_)};return new Proxy(v,{deleteProperty(E,A){return delete E[A],delete d[A],!0},get(E,A,r){return Z2(E,A,()=>M5(E,A,r))},getOwnPropertyDescriptor(E,A){return E._descriptors.allKeys?Reflect.has(d,A)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(d,A)},getPrototypeOf(){return Reflect.getPrototypeOf(d)},has(E,A){return Reflect.has(d,A)},ownKeys(){return Reflect.ownKeys(d)},set(E,A,r){return d[A]=r,delete E[A],!0}})}function q2(d,s={scriptable:!0,indexable:!0}){const{_scriptable:u=s.scriptable,_indexable:_=s.indexable,_allKeys:v=s.allKeys}=d;return{allKeys:v,scriptable:u,indexable:_,isScriptable:z_(u)?u:()=>u,isIndexable:z_(_)?_:()=>_}}const D5=(d,s)=>d?d+nD(s):s,hD=(d,s)=>Po(s)&&d!=="adapters"&&(Object.getPrototypeOf(s)===null||s.constructor===Object);function Z2(d,s,u){if(Object.prototype.hasOwnProperty.call(d,s)||s==="constructor")return d[s];const _=u();return d[s]=_,_}function M5(d,s,u){const{_proxy:_,_context:v,_subProxy:E,_descriptors:A}=d;let r=_[s];return z_(r)&&A.isScriptable(s)&&(r=P5(s,r,d,u)),Ys(r)&&r.length&&(r=O5(s,r,d,A.isIndexable)),hD(s,r)&&(r=Db(r,v,E&&E[s],A)),r}function P5(d,s,u,_){const{_proxy:v,_context:E,_subProxy:A,_stack:r}=u;if(r.has(d))throw new Error("Recursion detected: "+Array.from(r).join("->")+"->"+d);r.add(d);let L=s(E,A||_);return r.delete(d),hD(d,L)&&(L=dD(v._scopes,v,d,L)),L}function O5(d,s,u,_){const{_proxy:v,_context:E,_subProxy:A,_descriptors:r}=u;if(typeof E.index<"u"&&_(d))return s[E.index%s.length];if(Po(s[0])){const L=s,N=v._scopes.filter(H=>H!==L);s=[];for(const H of L){const X=dD(N,v,d,H);s.push(Db(X,E,A&&A[d],r))}}return s}function X2(d,s,u){return z_(d)?d(s,u):d}const k5=(d,s)=>d===!0?s:typeof d=="string"?Rb(s,d):void 0;function F5(d,s,u,_,v){for(const E of s){const A=k5(u,E);if(A){d.add(A);const r=X2(A._fallback,u,v);if(typeof r<"u"&&r!==u&&r!==_)return r}else if(A===!1&&typeof _<"u"&&u!==_)return null}return!1}function dD(d,s,u,_){const v=s._rootScopes,E=X2(s._fallback,u,_),A=[...d,...v],r=new Set;r.add(_);let L=TP(r,A,u,E||u,_);return L===null||typeof E<"u"&&E!==u&&(L=TP(r,A,E,L,_),L===null)?!1:uD(Array.from(r),[""],v,E,()=>L5(s,u,_))}function TP(d,s,u,_,v){for(;u;)u=F5(d,s,u,_,v);return u}function L5(d,s,u){const _=d._getTarget();s in _||(_[s]={});const v=_[s];return Ys(v)&&Po(u)?u:v||{}}function z5(d,s,u,_){let v;for(const E of s)if(v=Y2(D5(E,d),u),typeof v<"u")return hD(d,v)?dD(u,_,d,v):v}function Y2(d,s){for(const u of s){if(!u)continue;const _=u[d];if(typeof _<"u")return _}}function SP(d){let s=d._keys;return s||(s=d._keys=N5(d._scopes)),s}function N5(d){const s=new Set;for(const u of d)for(const _ of Object.keys(u).filter(v=>!v.startsWith("_")))s.add(_);return Array.from(s)}const B5=Number.EPSILON||1e-14,Mb=(d,s)=>s<d.length&&!d[s].skip&&d[s],K2=d=>d==="x"?"y":"x";function V5(d,s,u,_){const v=d.skip?s:d,E=s,A=u.skip?s:u,r=SR(E,v),L=SR(A,E);let N=r/(r+L),H=L/(r+L);N=isNaN(N)?0:N,H=isNaN(H)?0:H;const X=_*N,re=_*H;return{previous:{x:E.x-X*(A.x-v.x),y:E.y-X*(A.y-v.y)},next:{x:E.x+re*(A.x-v.x),y:E.y+re*(A.y-v.y)}}}function U5(d,s,u){const _=d.length;let v,E,A,r,L,N=Mb(d,0);for(let H=0;H<_-1;++H)if(L=N,N=Mb(d,H+1),!(!L||!N)){if(fT(s[H],0,B5)){u[H]=u[H+1]=0;continue}v=u[H]/s[H],E=u[H+1]/s[H],r=Math.pow(v,2)+Math.pow(E,2),!(r<=9)&&(A=3/Math.sqrt(r),u[H]=v*A*s[H],u[H+1]=E*A*s[H])}}function j5(d,s,u="x"){const _=K2(u),v=d.length;let E,A,r,L=Mb(d,0);for(let N=0;N<v;++N){if(A=r,r=L,L=Mb(d,N+1),!r)continue;const H=r[u],X=r[_];A&&(E=(H-A[u])/3,r[`cp1${u}`]=H-E,r[`cp1${_}`]=X-E*s[N]),L&&(E=(L[u]-H)/3,r[`cp2${u}`]=H+E,r[`cp2${_}`]=X+E*s[N])}}function G5(d,s="x"){const u=K2(s),_=d.length,v=Array(_).fill(0),E=Array(_);let A,r,L,N=Mb(d,0);for(A=0;A<_;++A)if(r=L,L=N,N=Mb(d,A+1),!!L){if(N){const H=N[s]-L[s];v[A]=H!==0?(N[u]-L[u])/H:0}E[A]=r?N?lp(v[A-1])!==lp(v[A])?0:(v[A-1]+v[A])/2:v[A-1]:v[A]}U5(d,v,E),j5(d,E,s)}function nA(d,s,u){return Math.max(Math.min(d,u),s)}function H5(d,s){let u,_,v,E,A,r=IT(d[0],s);for(u=0,_=d.length;u<_;++u)A=E,E=r,r=u<_-1&&IT(d[u+1],s),E&&(v=d[u],A&&(v.cp1x=nA(v.cp1x,s.left,s.right),v.cp1y=nA(v.cp1y,s.top,s.bottom)),r&&(v.cp2x=nA(v.cp2x,s.left,s.right),v.cp2y=nA(v.cp2y,s.top,s.bottom)))}function $5(d,s,u,_,v){let E,A,r,L;if(s.spanGaps&&(d=d.filter(N=>!N.skip)),s.cubicInterpolationMode==="monotone")G5(d,v);else{let N=_?d[d.length-1]:d[0];for(E=0,A=d.length;E<A;++E)r=d[E],L=V5(N,r,d[Math.min(E+1,A-(_?0:1))%A],s.tension),r.cp1x=L.previous.x,r.cp1y=L.previous.y,r.cp2x=L.next.x,r.cp2y=L.next.y,N=r}s.capBezierPoints&&H5(d,u)}function fD(){return typeof window<"u"&&typeof document<"u"}function pD(d){let s=d.parentNode;return s&&s.toString()==="[object ShadowRoot]"&&(s=s.host),s}function LA(d,s,u){let _;return typeof d=="string"?(_=parseInt(d,10),d.indexOf("%")!==-1&&(_=_/100*s.parentNode[u])):_=d,_}const YA=d=>d.ownerDocument.defaultView.getComputedStyle(d,null);function W5(d,s){return YA(d).getPropertyValue(s)}const q5=["top","right","bottom","left"];function Zv(d,s,u){const _={};u=u?"-"+u:"";for(let v=0;v<4;v++){const E=q5[v];_[E]=parseFloat(d[s+"-"+E+u])||0}return _.width=_.left+_.right,_.height=_.top+_.bottom,_}const Z5=(d,s,u)=>(d>0||s>0)&&(!u||!u.shadowRoot);function X5(d,s){const u=d.touches,_=u&&u.length?u[0]:d,{offsetX:v,offsetY:E}=_;let A=!1,r,L;if(Z5(v,E,d.target))r=v,L=E;else{const N=s.getBoundingClientRect();r=_.clientX-N.left,L=_.clientY-N.top,A=!0}return{x:r,y:L,box:A}}function Bv(d,s){if("native"in d)return d;const{canvas:u,currentDevicePixelRatio:_}=s,v=YA(u),E=v.boxSizing==="border-box",A=Zv(v,"padding"),r=Zv(v,"border","width"),{x:L,y:N,box:H}=X5(d,u),X=A.left+(H&&r.left),re=A.top+(H&&r.top);let{width:he,height:de}=s;return E&&(he-=A.width+r.width,de-=A.height+r.height),{x:Math.round((L-X)/he*u.width/_),y:Math.round((N-re)/de*u.height/_)}}function Y5(d,s,u){let _,v;if(s===void 0||u===void 0){const E=d&&pD(d);if(!E)s=d.clientWidth,u=d.clientHeight;else{const A=E.getBoundingClientRect(),r=YA(E),L=Zv(r,"border","width"),N=Zv(r,"padding");s=A.width-N.width-L.width,u=A.height-N.height-L.height,_=LA(r.maxWidth,E,"clientWidth"),v=LA(r.maxHeight,E,"clientHeight")}}return{width:s,height:u,maxWidth:_||OA,maxHeight:v||OA}}const P_=d=>Math.round(d*10)/10;function K5(d,s,u,_){const v=YA(d),E=Zv(v,"margin"),A=LA(v.maxWidth,d,"clientWidth")||OA,r=LA(v.maxHeight,d,"clientHeight")||OA,L=Y5(d,s,u);let{width:N,height:H}=L;if(v.boxSizing==="content-box"){const re=Zv(v,"border","width"),he=Zv(v,"padding");N-=he.width+re.width,H-=he.height+re.height}return N=Math.max(0,N-E.width),H=Math.max(0,_?N/_:H-E.height),N=P_(Math.min(N,A,L.maxWidth)),H=P_(Math.min(H,r,L.maxHeight)),N&&!H&&(H=P_(N/2)),(s!==void 0||u!==void 0)&&_&&L.height&&H>L.height&&(H=L.height,N=P_(Math.floor(H*_))),{width:N,height:H}}function EP(d,s,u){const _=s||1,v=P_(d.height*_),E=P_(d.width*_);d.height=P_(d.height),d.width=P_(d.width);const A=d.canvas;return A.style&&(u||!A.style.height&&!A.style.width)&&(A.style.height=`${d.height}px`,A.style.width=`${d.width}px`),d.currentDevicePixelRatio!==_||A.height!==v||A.width!==E?(d.currentDevicePixelRatio=_,A.height=v,A.width=E,d.ctx.setTransform(_,0,0,_,0,0),!0):!1}const J5=function(){let d=!1;try{const s={get passive(){return d=!0,!1}};fD()&&(window.addEventListener("test",null,s),window.removeEventListener("test",null,s))}catch{}return d}();function AP(d,s){const u=W5(d,s),_=u&&u.match(/^(\d+)(\.\d+)?px$/);return _?+_[1]:void 0}function Vv(d,s,u,_){return{x:d.x+u*(s.x-d.x),y:d.y+u*(s.y-d.y)}}function Q5(d,s,u,_){return{x:d.x+u*(s.x-d.x),y:_==="middle"?u<.5?d.y:s.y:_==="after"?u<1?d.y:s.y:u>0?s.y:d.y}}function eV(d,s,u,_){const v={x:d.cp2x,y:d.cp2y},E={x:s.cp1x,y:s.cp1y},A=Vv(d,v,u),r=Vv(v,E,u),L=Vv(E,s,u),N=Vv(A,r,u),H=Vv(r,L,u);return Vv(N,H,u)}const tV=function(d,s){return{x(u){return d+d+s-u},setWidth(u){s=u},textAlign(u){return u==="center"?u:u==="right"?"left":"right"},xPlus(u,_){return u-_},leftForLtr(u,_){return u-_}}},iV=function(){return{x(d){return d},setWidth(d){},textAlign(d){return d},xPlus(d,s){return d+s},leftForLtr(d,s){return d}}};function Sb(d,s,u){return d?tV(s,u):iV()}function J2(d,s){let u,_;(s==="ltr"||s==="rtl")&&(u=d.canvas.style,_=[u.getPropertyValue("direction"),u.getPropertyPriority("direction")],u.setProperty("direction",s,"important"),d.prevTextDirection=_)}function Q2(d,s){s!==void 0&&(delete d.prevTextDirection,d.canvas.style.setProperty("direction",s[0],s[1]))}function ek(d){return d==="angle"?{between:rD,compare:t5,normalize:Ud}:{between:M_,compare:(s,u)=>s-u,normalize:s=>s}}function CP({start:d,end:s,count:u,loop:_,style:v}){return{start:d%u,end:s%u,loop:_&&(s-d+1)%u===0,style:v}}function nV(d,s,u){const{property:_,start:v,end:E}=u,{between:A,normalize:r}=ek(_),L=s.length;let{start:N,end:H,loop:X}=d,re,he;if(X){for(N+=L,H+=L,re=0,he=L;re<he&&A(r(s[N%L][_]),v,E);++re)N--,H--;N%=L,H%=L}return H<N&&(H+=L),{start:N,end:H,loop:X,style:d.style}}function rV(d,s,u){if(!u)return[d];const{property:_,start:v,end:E}=u,A=s.length,{compare:r,between:L,normalize:N}=ek(_),{start:H,end:X,loop:re,style:he}=nV(d,s,u),de=[];let ve=!1,xe=null,$e,Le,Ke;const Ge=()=>L(v,Ke,$e)&&r(v,Ke)!==0,Ye=()=>r(E,$e)===0||L(E,Ke,$e),mt=()=>ve||Ge(),Ct=()=>!ve||Ye();for(let Vt=H,ui=H;Vt<=X;++Vt)Le=s[Vt%A],!Le.skip&&($e=N(Le[_]),$e!==Ke&&(ve=L($e,v,E),xe===null&&mt()&&(xe=r($e,v)===0?Vt:ui),xe!==null&&Ct()&&(de.push(CP({start:xe,end:Vt,loop:re,count:A,style:he})),xe=null),ui=Vt,Ke=$e));return xe!==null&&de.push(CP({start:xe,end:X,loop:re,count:A,style:he})),de}function oV(d,s){const u=[],_=d.segments;for(let v=0;v<_.length;v++){const E=rV(_[v],d.points,s);E.length&&u.push(...E)}return u}function aV(d,s,u,_){let v=0,E=s-1;if(u&&!_)for(;v<s&&!d[v].skip;)v++;for(;v<s&&d[v].skip;)v++;for(v%=s,u&&(E+=v);E>v&&d[E%s].skip;)E--;return E%=s,{start:v,end:E}}function sV(d,s,u,_){const v=d.length,E=[];let A=s,r=d[s],L;for(L=s+1;L<=u;++L){const N=d[L%v];N.skip||N.stop?r.skip||(_=!1,E.push({start:s%v,end:(L-1)%v,loop:_}),s=A=N.stop?L:null):(A=L,r.skip&&(s=L)),r=N}return A!==null&&E.push({start:s%v,end:A%v,loop:_}),E}function lV(d,s){const u=d.points,_=d.options.spanGaps,v=u.length;if(!v)return[];const E=!!d._loop,{start:A,end:r}=aV(u,v,E,_);if(_===!0)return IP(d,[{start:A,end:r,loop:E}],u,s);const L=r<A?r+v:r,N=!!d._fullLoop&&A===0&&r===v-1;return IP(d,sV(u,A,L,N),u,s)}function IP(d,s,u,_){return!_||!_.setContext||!u?s:cV(d,s,u,_)}function cV(d,s,u,_){const v=d._chart.getContext(),E=RP(d.options),{_datasetIndex:A,options:{spanGaps:r}}=d,L=u.length,N=[];let H=E,X=s[0].start,re=X;function he(de,ve,xe,$e){const Le=r?-1:1;if(de!==ve){for(de+=L;u[de%L].skip;)de-=Le;for(;u[ve%L].skip;)ve+=Le;de%L!==ve%L&&(N.push({start:de%L,end:ve%L,loop:xe,style:$e}),H=$e,X=ve%L)}}for(const de of s){X=r?X:de.start;let ve=u[X%L],xe;for(re=X+1;re<=de.end;re++){const $e=u[re%L];xe=RP(_.setContext(Qv(v,{type:"segment",p0:ve,p1:$e,p0DataIndex:(re-1)%L,p1DataIndex:re%L,datasetIndex:A}))),uV(xe,H)&&he(X,re-1,de.loop,H),ve=$e,H=xe}X<re-1&&he(X,re-1,de.loop,H)}return N}function RP(d){return{backgroundColor:d.backgroundColor,borderCapStyle:d.borderCapStyle,borderDash:d.borderDash,borderDashOffset:d.borderDashOffset,borderJoinStyle:d.borderJoinStyle,borderWidth:d.borderWidth,borderColor:d.borderColor}}function uV(d,s){if(!s)return!1;const u=[],_=function(v,E){return aD(E)?(u.includes(E)||u.push(E),u.indexOf(E)):E};return JSON.stringify(d,_)!==JSON.stringify(s,_)}function rA(d,s,u){return d.options.clip?d[u]:s[u]}function hV(d,s){const{xScale:u,yScale:_}=d;return u&&_?{left:rA(u,s,"left"),right:rA(u,s,"right"),top:rA(_,s,"top"),bottom:rA(_,s,"bottom")}:s}function dV(d,s){const u=s._clip;if(u.disabled)return!1;const _=hV(s,d.chartArea);return{left:u.left===!1?0:_.left-(u.left===!0?0:u.left),right:u.right===!1?d.width:_.right+(u.right===!0?0:u.right),top:u.top===!1?0:_.top-(u.top===!0?0:u.top),bottom:u.bottom===!1?d.height:_.bottom+(u.bottom===!0?0:u.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class fV{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(s,u,_,v){const E=u.listeners[v],A=u.duration;E.forEach(r=>r({chart:s,initial:u.initial,numSteps:A,currentStep:Math.min(_-u.start,A)}))}_refresh(){this._request||(this._running=!0,this._request=V2.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(s=Date.now()){let u=0;this._charts.forEach((_,v)=>{if(!_.running||!_.items.length)return;const E=_.items;let A=E.length-1,r=!1,L;for(;A>=0;--A)L=E[A],L._active?(L._total>_.duration&&(_.duration=L._total),L.tick(s),r=!0):(E[A]=E[E.length-1],E.pop());r&&(v.draw(),this._notify(v,_,s,"progress")),E.length||(_.running=!1,this._notify(v,_,s,"complete"),_.initial=!1),u+=E.length}),this._lastDate=s,u===0&&(this._running=!1)}_getAnims(s){const u=this._charts;let _=u.get(s);return _||(_={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},u.set(s,_)),_}listen(s,u,_){this._getAnims(s).listeners[u].push(_)}add(s,u){!u||!u.length||this._getAnims(s).items.push(...u)}has(s){return this._getAnims(s).items.length>0}start(s){const u=this._charts.get(s);u&&(u.running=!0,u.start=Date.now(),u.duration=u.items.reduce((_,v)=>Math.max(_,v._duration),0),this._refresh())}running(s){if(!this._running)return!1;const u=this._charts.get(s);return!(!u||!u.running||!u.items.length)}stop(s){const u=this._charts.get(s);if(!u||!u.items.length)return;const _=u.items;let v=_.length-1;for(;v>=0;--v)_[v].cancel();u.items=[],this._notify(s,u,Date.now(),"complete")}remove(s){return this._charts.delete(s)}}var Mm=new fV;const DP="transparent",pV={boolean(d,s,u){return u>.5?s:d},color(d,s,u){const _=vP(d||DP),v=_.valid&&vP(s||DP);return v&&v.valid?v.mix(_,u).hexString():s},number(d,s,u){return d+(s-d)*u}};class mV{constructor(s,u,_,v){const E=u[_];v=Ua([s.to,v,E,s.from]);const A=Ua([s.from,E,v]);this._active=!0,this._fn=s.fn||pV[s.type||typeof A],this._easing=pT[s.easing]||pT.linear,this._start=Math.floor(Date.now()+(s.delay||0)),this._duration=this._total=Math.floor(s.duration),this._loop=!!s.loop,this._target=u,this._prop=_,this._from=A,this._to=v,this._promises=void 0}active(){return this._active}update(s,u,_){if(this._active){this._notify(!1);const v=this._target[this._prop],E=_-this._start,A=this._duration-E;this._start=_,this._duration=Math.floor(Math.max(A,s.duration)),this._total+=E,this._loop=!!s.loop,this._to=Ua([s.to,u,v,s.from]),this._from=Ua([s.from,v,u])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(s){const u=s-this._start,_=this._duration,v=this._prop,E=this._from,A=this._loop,r=this._to;let L;if(this._active=E!==r&&(A||u<_),!this._active){this._target[v]=r,this._notify(!0);return}if(u<0){this._target[v]=E;return}L=u/_%2,L=A&&L>1?2-L:L,L=this._easing(Math.min(1,Math.max(0,L))),this._target[v]=this._fn(E,r,L)}wait(){const s=this._promises||(this._promises=[]);return new Promise((u,_)=>{s.push({res:u,rej:_})})}_notify(s){const u=s?"res":"rej",_=this._promises||[];for(let v=0;v<_.length;v++)_[v][u]()}}class tk{constructor(s,u){this._chart=s,this._properties=new Map,this.configure(u)}configure(s){if(!Po(s))return;const u=Object.keys(rs.animation),_=this._properties;Object.getOwnPropertyNames(s).forEach(v=>{const E=s[v];if(!Po(E))return;const A={};for(const r of u)A[r]=E[r];(Ys(E.properties)&&E.properties||[v]).forEach(r=>{(r===v||!_.has(r))&&_.set(r,A)})})}_animateOptions(s,u){const _=u.options,v=_V(s,_);if(!v)return[];const E=this._createAnimations(v,_);return _.$shared&&gV(s.options.$animations,_).then(()=>{s.options=_},()=>{}),E}_createAnimations(s,u){const _=this._properties,v=[],E=s.$animations||(s.$animations={}),A=Object.keys(u),r=Date.now();let L;for(L=A.length-1;L>=0;--L){const N=A[L];if(N.charAt(0)==="$")continue;if(N==="options"){v.push(...this._animateOptions(s,u));continue}const H=u[N];let X=E[N];const re=_.get(N);if(X)if(re&&X.active()){X.update(re,H,r);continue}else X.cancel();if(!re||!re.duration){s[N]=H;continue}E[N]=X=new mV(re,s,N,H),v.push(X)}return v}update(s,u){if(this._properties.size===0){Object.assign(s,u);return}const _=this._createAnimations(s,u);if(_.length)return Mm.add(this._chart,_),!0}}function gV(d,s){const u=[],_=Object.keys(s);for(let v=0;v<_.length;v++){const E=d[_[v]];E&&E.active()&&u.push(E.wait())}return Promise.all(u)}function _V(d,s){if(!s)return;let u=d.options;if(!u){d.options=s;return}return u.$shared&&(d.options=u=Object.assign({},u,{$shared:!1,$animations:{}})),u}function MP(d,s){const u=d&&d.options||{},_=u.reverse,v=u.min===void 0?s:0,E=u.max===void 0?s:0;return{start:_?E:v,end:_?v:E}}function yV(d,s,u){if(u===!1)return!1;const _=MP(d,u),v=MP(s,u);return{top:v.end,right:_.end,bottom:v.start,left:_.start}}function vV(d){let s,u,_,v;return Po(d)?(s=d.top,u=d.right,_=d.bottom,v=d.left):s=u=_=v=d,{top:s,right:u,bottom:_,left:v,disabled:d===!1}}function ik(d,s){const u=[],_=d._getSortedDatasetMetas(s);let v,E;for(v=0,E=_.length;v<E;++v)u.push(_[v].index);return u}function PP(d,s,u,_={}){const v=d.keys,E=_.mode==="single";let A,r,L,N;if(s===null)return;let H=!1;for(A=0,r=v.length;A<r;++A){if(L=+v[A],L===u){if(H=!0,_.all)continue;break}N=d.values[L],od(N)&&(E||s===0||lp(s)===lp(N))&&(s+=N)}return!H&&!_.all?0:s}function xV(d,s){const{iScale:u,vScale:_}=s,v=u.axis==="x"?"x":"y",E=_.axis==="x"?"x":"y",A=Object.keys(d),r=new Array(A.length);let L,N,H;for(L=0,N=A.length;L<N;++L)H=A[L],r[L]={[v]:H,[E]:d[H]};return r}function tR(d,s){const u=d&&d.options.stacked;return u||u===void 0&&s.stack!==void 0}function bV(d,s,u){return`${d.id}.${s.id}.${u.stack||u.type}`}function wV(d){const{min:s,max:u,minDefined:_,maxDefined:v}=d.getUserBounds();return{min:_?s:Number.NEGATIVE_INFINITY,max:v?u:Number.POSITIVE_INFINITY}}function TV(d,s,u){const _=d[s]||(d[s]={});return _[u]||(_[u]={})}function OP(d,s,u,_){for(const v of s.getMatchingVisibleMetas(_).reverse()){const E=d[v.index];if(u&&E>0||!u&&E<0)return v.index}return null}function kP(d,s){const{chart:u,_cachedMeta:_}=d,v=u._stacks||(u._stacks={}),{iScale:E,vScale:A,index:r}=_,L=E.axis,N=A.axis,H=bV(E,A,_),X=s.length;let re;for(let he=0;he<X;++he){const de=s[he],{[L]:ve,[N]:xe}=de,$e=de._stacks||(de._stacks={});re=$e[N]=TV(v,H,ve),re[r]=xe,re._top=OP(re,A,!0,_.type),re._bottom=OP(re,A,!1,_.type);const Le=re._visualValues||(re._visualValues={});Le[r]=xe}}function iR(d,s){const u=d.scales;return Object.keys(u).filter(_=>u[_].axis===s).shift()}function SV(d,s){return Qv(d,{active:!1,dataset:void 0,datasetIndex:s,index:s,mode:"default",type:"dataset"})}function EV(d,s,u){return Qv(d,{active:!1,dataIndex:s,parsed:void 0,raw:void 0,element:u,index:s,mode:"default",type:"data"})}function Qw(d,s){const u=d.controller.index,_=d.vScale&&d.vScale.axis;if(_){s=s||d._parsed;for(const v of s){const E=v._stacks;if(!E||E[_]===void 0||E[_][u]===void 0)return;delete E[_][u],E[_]._visualValues!==void 0&&E[_]._visualValues[u]!==void 0&&delete E[_]._visualValues[u]}}}const nR=d=>d==="reset"||d==="none",FP=(d,s)=>s?d:Object.assign({},d),AV=(d,s,u)=>d&&!s.hidden&&s._stacked&&{keys:ik(u,!0),values:null};class Eb{constructor(s,u){this.chart=s,this._ctx=s.ctx,this.index=u,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const s=this._cachedMeta;this.configure(),this.linkScales(),s._stacked=tR(s.vScale,s),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(s){this.index!==s&&Qw(this._cachedMeta),this.index=s}linkScales(){const s=this.chart,u=this._cachedMeta,_=this.getDataset(),v=(X,re,he,de)=>X==="x"?re:X==="r"?de:he,E=u.xAxisID=Jr(_.xAxisID,iR(s,"x")),A=u.yAxisID=Jr(_.yAxisID,iR(s,"y")),r=u.rAxisID=Jr(_.rAxisID,iR(s,"r")),L=u.indexAxis,N=u.iAxisID=v(L,E,A,r),H=u.vAxisID=v(L,A,E,r);u.xScale=this.getScaleForId(E),u.yScale=this.getScaleForId(A),u.rScale=this.getScaleForId(r),u.iScale=this.getScaleForId(N),u.vScale=this.getScaleForId(H)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(s){return this.chart.scales[s]}_getOtherScale(s){const u=this._cachedMeta;return s===u.iScale?u.vScale:u.iScale}reset(){this._update("reset")}_destroy(){const s=this._cachedMeta;this._data&&gP(this._data,this),s._stacked&&Qw(s)}_dataCheck(){const s=this.getDataset(),u=s.data||(s.data=[]),_=this._data;if(Po(u)){const v=this._cachedMeta;this._data=xV(u,v)}else if(_!==u){if(_){gP(_,this);const v=this._cachedMeta;Qw(v),v._parsed=[]}u&&Object.isExtensible(u)&&o5(u,this),this._syncList=[],this._data=u}}addElements(){const s=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(s.dataset=new this.datasetElementType)}buildOrUpdateElements(s){const u=this._cachedMeta,_=this.getDataset();let v=!1;this._dataCheck();const E=u._stacked;u._stacked=tR(u.vScale,u),u.stack!==_.stack&&(v=!0,Qw(u),u.stack=_.stack),this._resyncElements(s),(v||E!==u._stacked)&&(kP(this,u._parsed),u._stacked=tR(u.vScale,u))}configure(){const s=this.chart.config,u=s.datasetScopeKeys(this._type),_=s.getOptionScopes(this.getDataset(),u,!0);this.options=s.createResolver(_,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(s,u){const{_cachedMeta:_,_data:v}=this,{iScale:E,_stacked:A}=_,r=E.axis;let L=s===0&&u===v.length?!0:_._sorted,N=s>0&&_._parsed[s-1],H,X,re;if(this._parsing===!1)_._parsed=v,_._sorted=!0,re=v;else{Ys(v[s])?re=this.parseArrayData(_,v,s,u):Po(v[s])?re=this.parseObjectData(_,v,s,u):re=this.parsePrimitiveData(_,v,s,u);const he=()=>X[r]===null||N&&X[r]<N[r];for(H=0;H<u;++H)_._parsed[H+s]=X=re[H],L&&(he()&&(L=!1),N=X);_._sorted=L}A&&kP(this,re)}parsePrimitiveData(s,u,_,v){const{iScale:E,vScale:A}=s,r=E.axis,L=A.axis,N=E.getLabels(),H=E===A,X=new Array(v);let re,he,de;for(re=0,he=v;re<he;++re)de=re+_,X[re]={[r]:H||E.parse(N[de],de),[L]:A.parse(u[de],de)};return X}parseArrayData(s,u,_,v){const{xScale:E,yScale:A}=s,r=new Array(v);let L,N,H,X;for(L=0,N=v;L<N;++L)H=L+_,X=u[H],r[L]={x:E.parse(X[0],H),y:A.parse(X[1],H)};return r}parseObjectData(s,u,_,v){const{xScale:E,yScale:A}=s,{xAxisKey:r="x",yAxisKey:L="y"}=this._parsing,N=new Array(v);let H,X,re,he;for(H=0,X=v;H<X;++H)re=H+_,he=u[re],N[H]={x:E.parse(Rb(he,r),re),y:A.parse(Rb(he,L),re)};return N}getParsed(s){return this._cachedMeta._parsed[s]}getDataElement(s){return this._cachedMeta.data[s]}applyStack(s,u,_){const v=this.chart,E=this._cachedMeta,A=u[s.axis],r={keys:ik(v,!0),values:u._stacks[s.axis]._visualValues};return PP(r,A,E.index,{mode:_})}updateRangeFromParsed(s,u,_,v){const E=_[u.axis];let A=E===null?NaN:E;const r=v&&_._stacks[u.axis];v&&r&&(v.values=r,A=PP(v,E,this._cachedMeta.index)),s.min=Math.min(s.min,A),s.max=Math.max(s.max,A)}getMinMax(s,u){const _=this._cachedMeta,v=_._parsed,E=_._sorted&&s===_.iScale,A=v.length,r=this._getOtherScale(s),L=AV(u,_,this.chart),N={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:H,max:X}=wV(r);let re,he;function de(){he=v[re];const ve=he[r.axis];return!od(he[s.axis])||H>ve||X<ve}for(re=0;re<A&&!(!de()&&(this.updateRangeFromParsed(N,s,he,L),E));++re);if(E){for(re=A-1;re>=0;--re)if(!de()){this.updateRangeFromParsed(N,s,he,L);break}}return N}getAllParsedValues(s){const u=this._cachedMeta._parsed,_=[];let v,E,A;for(v=0,E=u.length;v<E;++v)A=u[v][s.axis],od(A)&&_.push(A);return _}getMaxOverflow(){return!1}getLabelAndValue(s){const u=this._cachedMeta,_=u.iScale,v=u.vScale,E=this.getParsed(s);return{label:_?""+_.getLabelForValue(E[_.axis]):"",value:v?""+v.getLabelForValue(E[v.axis]):""}}_update(s){const u=this._cachedMeta;this.update(s||"default"),u._clip=vV(Jr(this.options.clip,yV(u.xScale,u.yScale,this.getMaxOverflow())))}update(s){}draw(){const s=this._ctx,u=this.chart,_=this._cachedMeta,v=_.data||[],E=u.chartArea,A=[],r=this._drawStart||0,L=this._drawCount||v.length-r,N=this.options.drawActiveElementsOnTop;let H;for(_.dataset&&_.dataset.draw(s,E,r,L),H=r;H<r+L;++H){const X=v[H];X.hidden||(X.active&&N?A.push(X):X.draw(s,E))}for(H=0;H<A.length;++H)A[H].draw(s,E)}getStyle(s,u){const _=u?"active":"default";return s===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(_):this.resolveDataElementOptions(s||0,_)}getContext(s,u,_){const v=this.getDataset();let E;if(s>=0&&s<this._cachedMeta.data.length){const A=this._cachedMeta.data[s];E=A.$context||(A.$context=EV(this.getContext(),s,A)),E.parsed=this.getParsed(s),E.raw=v.data[s],E.index=E.dataIndex=s}else E=this.$context||(this.$context=SV(this.chart.getContext(),this.index)),E.dataset=v,E.index=E.datasetIndex=this.index;return E.active=!!u,E.mode=_,E}resolveDatasetElementOptions(s){return this._resolveElementOptions(this.datasetElementType.id,s)}resolveDataElementOptions(s,u){return this._resolveElementOptions(this.dataElementType.id,u,s)}_resolveElementOptions(s,u="default",_){const v=u==="active",E=this._cachedDataOpts,A=s+"-"+u,r=E[A],L=this.enableOptionSharing&&AT(_);if(r)return FP(r,L);const N=this.chart.config,H=N.datasetElementScopeKeys(this._type,s),X=v?[`${s}Hover`,"hover",s,""]:[s,""],re=N.getOptionScopes(this.getDataset(),H),he=Object.keys(rs.elements[s]),de=()=>this.getContext(_,v,u),ve=N.resolveNamedOptions(re,he,de,X);return ve.$shared&&(ve.$shared=L,E[A]=Object.freeze(FP(ve,L))),ve}_resolveAnimations(s,u,_){const v=this.chart,E=this._cachedDataOpts,A=`animation-${u}`,r=E[A];if(r)return r;let L;if(v.options.animation!==!1){const H=this.chart.config,X=H.datasetAnimationScopeKeys(this._type,u),re=H.getOptionScopes(this.getDataset(),X);L=H.createResolver(re,this.getContext(s,_,u))}const N=new tk(v,L&&L.animations);return L&&L._cacheable&&(E[A]=Object.freeze(N)),N}getSharedOptions(s){if(s.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},s))}includeOptions(s,u){return!u||nR(s)||this.chart._animationsDisabled}_getSharedOptions(s,u){const _=this.resolveDataElementOptions(s,u),v=this._sharedOptions,E=this.getSharedOptions(_),A=this.includeOptions(u,E)||E!==v;return this.updateSharedOptions(E,u,_),{sharedOptions:E,includeOptions:A}}updateElement(s,u,_,v){nR(v)?Object.assign(s,_):this._resolveAnimations(u,v).update(s,_)}updateSharedOptions(s,u,_){s&&!nR(u)&&this._resolveAnimations(void 0,u).update(s,_)}_setStyle(s,u,_,v){s.active=v;const E=this.getStyle(u,v);this._resolveAnimations(u,_,v).update(s,{options:!v&&this.getSharedOptions(E)||E})}removeHoverStyle(s,u,_){this._setStyle(s,_,"active",!1)}setHoverStyle(s,u,_){this._setStyle(s,_,"active",!0)}_removeDatasetHoverStyle(){const s=this._cachedMeta.dataset;s&&this._setStyle(s,void 0,"active",!1)}_setDatasetHoverStyle(){const s=this._cachedMeta.dataset;s&&this._setStyle(s,void 0,"active",!0)}_resyncElements(s){const u=this._data,_=this._cachedMeta.data;for(const[r,L,N]of this._syncList)this[r](L,N);this._syncList=[];const v=_.length,E=u.length,A=Math.min(E,v);A&&this.parse(0,A),E>v?this._insertElements(v,E-v,s):E<v&&this._removeElements(E,v-E)}_insertElements(s,u,_=!0){const v=this._cachedMeta,E=v.data,A=s+u;let r;const L=N=>{for(N.length+=u,r=N.length-1;r>=A;r--)N[r]=N[r-u]};for(L(E),r=s;r<A;++r)E[r]=new this.dataElementType;this._parsing&&L(v._parsed),this.parse(s,u),_&&this.updateElements(E,s,u,"reset")}updateElements(s,u,_,v){}_removeElements(s,u){const _=this._cachedMeta;if(this._parsing){const v=_._parsed.splice(s,u);_._stacked&&Qw(_,v)}_.data.splice(s,u)}_sync(s){if(this._parsing)this._syncList.push(s);else{const[u,_,v]=s;this[u](_,v)}this.chart._dataChanges.push([this.index,...s])}_onDataPush(){const s=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-s,s])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(s,u){u&&this._sync(["_removeElements",s,u]);const _=arguments.length-2;_&&this._sync(["_insertElements",s,_])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}Ln(Eb,"defaults",{}),Ln(Eb,"datasetElementType",null),Ln(Eb,"dataElementType",null);function CV(d,s){if(!d._cache.$bar){const u=d.getMatchingVisibleMetas(s);let _=[];for(let v=0,E=u.length;v<E;v++)_=_.concat(u[v].controller.getAllParsedValues(d));d._cache.$bar=B2(_.sort((v,E)=>v-E))}return d._cache.$bar}function IV(d){const s=d.iScale,u=CV(s,d.type);let _=s._length,v,E,A,r;const L=()=>{A===32767||A===-32768||(AT(r)&&(_=Math.min(_,Math.abs(A-r)||_)),r=A)};for(v=0,E=u.length;v<E;++v)A=s.getPixelForValue(u[v]),L();for(r=void 0,v=0,E=s.ticks.length;v<E;++v)A=s.getPixelForTick(v),L();return _}function RV(d,s,u,_){const v=u.barThickness;let E,A;return wo(v)?(E=s.min*u.categoryPercentage,A=u.barPercentage):(E=v*_,A=1),{chunk:E/_,ratio:A,start:s.pixels[d]-E/2}}function DV(d,s,u,_){const v=s.pixels,E=v[d];let A=d>0?v[d-1]:null,r=d<v.length-1?v[d+1]:null;const L=u.categoryPercentage;A===null&&(A=E-(r===null?s.end-s.start:r-E)),r===null&&(r=E+E-A);const N=E-(E-Math.min(A,r))/2*L;return{chunk:Math.abs(r-A)/2*L/_,ratio:u.barPercentage,start:N}}function MV(d,s,u,_){const v=u.parse(d[0],_),E=u.parse(d[1],_),A=Math.min(v,E),r=Math.max(v,E);let L=A,N=r;Math.abs(A)>Math.abs(r)&&(L=r,N=A),s[u.axis]=N,s._custom={barStart:L,barEnd:N,start:v,end:E,min:A,max:r}}function nk(d,s,u,_){return Ys(d)?MV(d,s,u,_):s[u.axis]=u.parse(d,_),s}function LP(d,s,u,_){const v=d.iScale,E=d.vScale,A=v.getLabels(),r=v===E,L=[];let N,H,X,re;for(N=u,H=u+_;N<H;++N)re=s[N],X={},X[v.axis]=r||v.parse(A[N],N),L.push(nk(re,X,E,N));return L}function rR(d){return d&&d.barStart!==void 0&&d.barEnd!==void 0}function PV(d,s,u){return d!==0?lp(d):(s.isHorizontal()?1:-1)*(s.min>=u?1:-1)}function OV(d){let s,u,_,v,E;return d.horizontal?(s=d.base>d.x,u="left",_="right"):(s=d.base<d.y,u="bottom",_="top"),s?(v="end",E="start"):(v="start",E="end"),{start:u,end:_,reverse:s,top:v,bottom:E}}function kV(d,s,u,_){let v=s.borderSkipped;const E={};if(!v){d.borderSkipped=E;return}if(v===!0){d.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:A,end:r,reverse:L,top:N,bottom:H}=OV(d);v==="middle"&&u&&(d.enableBorderRadius=!0,(u._top||0)===_?v=N:(u._bottom||0)===_?v=H:(E[zP(H,A,r,L)]=!0,v=N)),E[zP(v,A,r,L)]=!0,d.borderSkipped=E}function zP(d,s,u,_){return _?(d=FV(d,s,u),d=NP(d,u,s)):d=NP(d,s,u),d}function FV(d,s,u){return d===s?u:d===u?s:d}function NP(d,s,u){return d==="start"?s:d==="end"?u:d}function LV(d,{inflateAmount:s},u){d.inflateAmount=s==="auto"?u===1?.33:0:s}class xA extends Eb{parsePrimitiveData(s,u,_,v){return LP(s,u,_,v)}parseArrayData(s,u,_,v){return LP(s,u,_,v)}parseObjectData(s,u,_,v){const{iScale:E,vScale:A}=s,{xAxisKey:r="x",yAxisKey:L="y"}=this._parsing,N=E.axis==="x"?r:L,H=A.axis==="x"?r:L,X=[];let re,he,de,ve;for(re=_,he=_+v;re<he;++re)ve=u[re],de={},de[E.axis]=E.parse(Rb(ve,N),re),X.push(nk(Rb(ve,H),de,A,re));return X}updateRangeFromParsed(s,u,_,v){super.updateRangeFromParsed(s,u,_,v);const E=_._custom;E&&u===this._cachedMeta.vScale&&(s.min=Math.min(s.min,E.min),s.max=Math.max(s.max,E.max))}getMaxOverflow(){return 0}getLabelAndValue(s){const u=this._cachedMeta,{iScale:_,vScale:v}=u,E=this.getParsed(s),A=E._custom,r=rR(A)?"["+A.start+", "+A.end+"]":""+v.getLabelForValue(E[v.axis]);return{label:""+_.getLabelForValue(E[_.axis]),value:r}}initialize(){this.enableOptionSharing=!0,super.initialize();const s=this._cachedMeta;s.stack=this.getDataset().stack}update(s){const u=this._cachedMeta;this.updateElements(u.data,0,u.data.length,s)}updateElements(s,u,_,v){const E=v==="reset",{index:A,_cachedMeta:{vScale:r}}=this,L=r.getBasePixel(),N=r.isHorizontal(),H=this._getRuler(),{sharedOptions:X,includeOptions:re}=this._getSharedOptions(u,v);for(let he=u;he<u+_;he++){const de=this.getParsed(he),ve=E||wo(de[r.axis])?{base:L,head:L}:this._calculateBarValuePixels(he),xe=this._calculateBarIndexPixels(he,H),$e=(de._stacks||{})[r.axis],Le={horizontal:N,base:ve.base,enableBorderRadius:!$e||rR(de._custom)||A===$e._top||A===$e._bottom,x:N?ve.head:xe.center,y:N?xe.center:ve.head,height:N?xe.size:Math.abs(ve.size),width:N?Math.abs(ve.size):xe.size};re&&(Le.options=X||this.resolveDataElementOptions(he,s[he].active?"active":v));const Ke=Le.options||s[he].options;kV(Le,Ke,$e,A),LV(Le,Ke,H.ratio),this.updateElement(s[he],he,Le,v)}}_getStacks(s,u){const{iScale:_}=this._cachedMeta,v=_.getMatchingVisibleMetas(this._type).filter(H=>H.controller.options.grouped),E=_.options.stacked,A=[],r=this._cachedMeta.controller.getParsed(u),L=r&&r[_.axis],N=H=>{const X=H._parsed.find(he=>he[_.axis]===L),re=X&&X[H.vScale.axis];if(wo(re)||isNaN(re))return!0};for(const H of v)if(!(u!==void 0&&N(H))&&((E===!1||A.indexOf(H.stack)===-1||E===void 0&&H.stack===void 0)&&A.push(H.stack),H.index===s))break;return A.length||A.push(void 0),A}_getStackCount(s){return this._getStacks(void 0,s).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const s=this.chart.scales,u=this.chart.options.indexAxis;return Object.keys(s).filter(_=>s[_].axis===u).shift()}_getAxis(){const s={},u=this.getFirstScaleIdForIndexAxis();for(const _ of this.chart.data.datasets)s[Jr(this.chart.options.indexAxis==="x"?_.xAxisID:_.yAxisID,u)]=!0;return Object.keys(s)}_getStackIndex(s,u,_){const v=this._getStacks(s,_),E=u!==void 0?v.indexOf(u):-1;return E===-1?v.length-1:E}_getRuler(){const s=this.options,u=this._cachedMeta,_=u.iScale,v=[];let E,A;for(E=0,A=u.data.length;E<A;++E)v.push(_.getPixelForValue(this.getParsed(E)[_.axis],E));const r=s.barThickness;return{min:r||IV(u),pixels:v,start:_._startPixel,end:_._endPixel,stackCount:this._getStackCount(),scale:_,grouped:s.grouped,ratio:r?1:s.categoryPercentage*s.barPercentage}}_calculateBarValuePixels(s){const{_cachedMeta:{vScale:u,_stacked:_,index:v},options:{base:E,minBarLength:A}}=this,r=E||0,L=this.getParsed(s),N=L._custom,H=rR(N);let X=L[u.axis],re=0,he=_?this.applyStack(u,L,_):X,de,ve;he!==X&&(re=he-X,he=X),H&&(X=N.barStart,he=N.barEnd-N.barStart,X!==0&&lp(X)!==lp(N.barEnd)&&(re=0),re+=X);const xe=!wo(E)&&!H?E:re;let $e=u.getPixelForValue(xe);if(this.chart.getDataVisibility(s)?de=u.getPixelForValue(re+he):de=$e,ve=de-$e,Math.abs(ve)<A){ve=PV(ve,u,r)*A,X===r&&($e-=ve/2);const Le=u.getPixelForDecimal(0),Ke=u.getPixelForDecimal(1),Ge=Math.min(Le,Ke),Ye=Math.max(Le,Ke);$e=Math.max(Math.min($e,Ye),Ge),de=$e+ve,_&&!H&&(L._stacks[u.axis]._visualValues[v]=u.getValueForPixel(de)-u.getValueForPixel($e))}if($e===u.getPixelForValue(r)){const Le=lp(ve)*u.getLineWidthForValue(r)/2;$e+=Le,ve-=Le}return{size:ve,base:$e,head:de,center:de+ve/2}}_calculateBarIndexPixels(s,u){const _=u.scale,v=this.options,E=v.skipNull,A=Jr(v.maxBarThickness,1/0);let r,L;const N=this._getAxisCount();if(u.grouped){const H=E?this._getStackCount(s):u.stackCount,X=v.barThickness==="flex"?DV(s,u,v,H*N):RV(s,u,v,H*N),re=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,he=this._getAxis().indexOf(Jr(re,this.getFirstScaleIdForIndexAxis())),de=this._getStackIndex(this.index,this._cachedMeta.stack,E?s:void 0)+he;r=X.start+X.chunk*de+X.chunk/2,L=Math.min(A,X.chunk*X.ratio)}else r=_.getPixelForValue(this.getParsed(s)[_.axis],s),L=Math.min(A,u.min*u.ratio);return{base:r-L/2,head:r+L/2,center:r,size:L}}draw(){const s=this._cachedMeta,u=s.vScale,_=s.data,v=_.length;let E=0;for(;E<v;++E)this.getParsed(E)[u.axis]!==null&&!_[E].hidden&&_[E].draw(this._ctx)}}Ln(xA,"id","bar"),Ln(xA,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),Ln(xA,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class bA extends Eb{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(s){const u=this._cachedMeta,{dataset:_,data:v=[],_dataset:E}=u,A=this.chart._animationsDisabled;let{start:r,count:L}=l5(u,v,A);this._drawStart=r,this._drawCount=L,c5(u)&&(r=0,L=v.length),_._chart=this.chart,_._datasetIndex=this.index,_._decimated=!!E._decimated,_.points=v;const N=this.resolveDatasetElementOptions(s);this.options.showLine||(N.borderWidth=0),N.segment=this.options.segment,this.updateElement(_,void 0,{animated:!A,options:N},s),this.updateElements(v,r,L,s)}updateElements(s,u,_,v){const E=v==="reset",{iScale:A,vScale:r,_stacked:L,_dataset:N}=this._cachedMeta,{sharedOptions:H,includeOptions:X}=this._getSharedOptions(u,v),re=A.axis,he=r.axis,{spanGaps:de,segment:ve}=this.options,xe=CT(de)?de:Number.POSITIVE_INFINITY,$e=this.chart._animationsDisabled||E||v==="none",Le=u+_,Ke=s.length;let Ge=u>0&&this.getParsed(u-1);for(let Ye=0;Ye<Ke;++Ye){const mt=s[Ye],Ct=$e?mt:{};if(Ye<u||Ye>=Le){Ct.skip=!0;continue}const Vt=this.getParsed(Ye),ui=wo(Vt[he]),Di=Ct[re]=A.getPixelForValue(Vt[re],Ye),si=Ct[he]=E||ui?r.getBasePixel():r.getPixelForValue(L?this.applyStack(r,Vt,L):Vt[he],Ye);Ct.skip=isNaN(Di)||isNaN(si)||ui,Ct.stop=Ye>0&&Math.abs(Vt[re]-Ge[re])>xe,ve&&(Ct.parsed=Vt,Ct.raw=N.data[Ye]),X&&(Ct.options=H||this.resolveDataElementOptions(Ye,mt.active?"active":v)),$e||this.updateElement(mt,Ye,Ct,v),Ge=Vt}}getMaxOverflow(){const s=this._cachedMeta,u=s.dataset,_=u.options&&u.options.borderWidth||0,v=s.data||[];if(!v.length)return _;const E=v[0].size(this.resolveDataElementOptions(0)),A=v[v.length-1].size(this.resolveDataElementOptions(v.length-1));return Math.max(_,E,A)/2}draw(){const s=this._cachedMeta;s.dataset.updateControlPoints(this.chart.chartArea,s.iScale.axis),super.draw()}}Ln(bA,"id","line"),Ln(bA,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),Ln(bA,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});function zv(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class mD{constructor(s){Ln(this,"options");this.options=s||{}}static override(s){Object.assign(mD.prototype,s)}init(){}formats(){return zv()}parse(){return zv()}format(){return zv()}add(){return zv()}diff(){return zv()}startOf(){return zv()}endOf(){return zv()}}var zV={_date:mD};function NV(d,s,u,_){const{controller:v,data:E,_sorted:A}=d,r=v._cachedMeta.iScale,L=d.dataset&&d.dataset.options?d.dataset.options.spanGaps:null;if(r&&s===r.axis&&s!=="r"&&A&&E.length){const N=r._reversePixels?n5:Wv;if(_){if(v._sharedOptions){const H=E[0],X=typeof H.getRange=="function"&&H.getRange(s);if(X){const re=N(E,s,u-X),he=N(E,s,u+X);return{lo:re.lo,hi:he.hi}}}}else{const H=N(E,s,u);if(L){const{vScale:X}=v._cachedMeta,{_parsed:re}=d,he=re.slice(0,H.lo+1).reverse().findIndex(ve=>!wo(ve[X.axis]));H.lo-=Math.max(0,he);const de=re.slice(H.hi).findIndex(ve=>!wo(ve[X.axis]));H.hi+=Math.max(0,de)}return H}}return{lo:0,hi:E.length-1}}function KA(d,s,u,_,v){const E=d.getSortedVisibleDatasetMetas(),A=u[s];for(let r=0,L=E.length;r<L;++r){const{index:N,data:H}=E[r],{lo:X,hi:re}=NV(E[r],s,A,v);for(let he=X;he<=re;++he){const de=H[he];de.skip||_(de,N,he)}}}function BV(d){const s=d.indexOf("x")!==-1,u=d.indexOf("y")!==-1;return function(_,v){const E=s?Math.abs(_.x-v.x):0,A=u?Math.abs(_.y-v.y):0;return Math.sqrt(Math.pow(E,2)+Math.pow(A,2))}}function oR(d,s,u,_,v){const E=[];return!v&&!d.isPointInArea(s)||KA(d,u,s,function(r,L,N){!v&&!IT(r,d.chartArea,0)||r.inRange(s.x,s.y,_)&&E.push({element:r,datasetIndex:L,index:N})},!0),E}function VV(d,s,u,_){let v=[];function E(A,r,L){const{startAngle:N,endAngle:H}=A.getProps(["startAngle","endAngle"],_),{angle:X}=z2(A,{x:s.x,y:s.y});rD(X,N,H)&&v.push({element:A,datasetIndex:r,index:L})}return KA(d,u,s,E),v}function UV(d,s,u,_,v,E){let A=[];const r=BV(u);let L=Number.POSITIVE_INFINITY;function N(H,X,re){const he=H.inRange(s.x,s.y,v);if(_&&!he)return;const de=H.getCenterPoint(v);if(!(!!E||d.isPointInArea(de))&&!he)return;const xe=r(s,de);xe<L?(A=[{element:H,datasetIndex:X,index:re}],L=xe):xe===L&&A.push({element:H,datasetIndex:X,index:re})}return KA(d,u,s,N),A}function aR(d,s,u,_,v,E){return!E&&!d.isPointInArea(s)?[]:u==="r"&&!_?VV(d,s,u,v):UV(d,s,u,_,v,E)}function BP(d,s,u,_,v){const E=[],A=u==="x"?"inXRange":"inYRange";let r=!1;return KA(d,u,s,(L,N,H)=>{L[A]&&L[A](s[u],v)&&(E.push({element:L,datasetIndex:N,index:H}),r=r||L.inRange(s.x,s.y,v))}),_&&!r?[]:E}var jV={modes:{index(d,s,u,_){const v=Bv(s,d),E=u.axis||"x",A=u.includeInvisible||!1,r=u.intersect?oR(d,v,E,_,A):aR(d,v,E,!1,_,A),L=[];return r.length?(d.getSortedVisibleDatasetMetas().forEach(N=>{const H=r[0].index,X=N.data[H];X&&!X.skip&&L.push({element:X,datasetIndex:N.index,index:H})}),L):[]},dataset(d,s,u,_){const v=Bv(s,d),E=u.axis||"xy",A=u.includeInvisible||!1;let r=u.intersect?oR(d,v,E,_,A):aR(d,v,E,!1,_,A);if(r.length>0){const L=r[0].datasetIndex,N=d.getDatasetMeta(L).data;r=[];for(let H=0;H<N.length;++H)r.push({element:N[H],datasetIndex:L,index:H})}return r},point(d,s,u,_){const v=Bv(s,d),E=u.axis||"xy",A=u.includeInvisible||!1;return oR(d,v,E,_,A)},nearest(d,s,u,_){const v=Bv(s,d),E=u.axis||"xy",A=u.includeInvisible||!1;return aR(d,v,E,u.intersect,_,A)},x(d,s,u,_){const v=Bv(s,d);return BP(d,v,"x",u.intersect,_)},y(d,s,u,_){const v=Bv(s,d);return BP(d,v,"y",u.intersect,_)}}};const rk=["left","top","right","bottom"];function eT(d,s){return d.filter(u=>u.pos===s)}function VP(d,s){return d.filter(u=>rk.indexOf(u.pos)===-1&&u.box.axis===s)}function tT(d,s){return d.sort((u,_)=>{const v=s?_:u,E=s?u:_;return v.weight===E.weight?v.index-E.index:v.weight-E.weight})}function GV(d){const s=[];let u,_,v,E,A,r;for(u=0,_=(d||[]).length;u<_;++u)v=d[u],{position:E,options:{stack:A,stackWeight:r=1}}=v,s.push({index:u,box:v,pos:E,horizontal:v.isHorizontal(),weight:v.weight,stack:A&&E+A,stackWeight:r});return s}function HV(d){const s={};for(const u of d){const{stack:_,pos:v,stackWeight:E}=u;if(!_||!rk.includes(v))continue;const A=s[_]||(s[_]={count:0,placed:0,weight:0,size:0});A.count++,A.weight+=E}return s}function $V(d,s){const u=HV(d),{vBoxMaxWidth:_,hBoxMaxHeight:v}=s;let E,A,r;for(E=0,A=d.length;E<A;++E){r=d[E];const{fullSize:L}=r.box,N=u[r.stack],H=N&&r.stackWeight/N.weight;r.horizontal?(r.width=H?H*_:L&&s.availableWidth,r.height=v):(r.width=_,r.height=H?H*v:L&&s.availableHeight)}return u}function WV(d){const s=GV(d),u=tT(s.filter(N=>N.box.fullSize),!0),_=tT(eT(s,"left"),!0),v=tT(eT(s,"right")),E=tT(eT(s,"top"),!0),A=tT(eT(s,"bottom")),r=VP(s,"x"),L=VP(s,"y");return{fullSize:u,leftAndTop:_.concat(E),rightAndBottom:v.concat(L).concat(A).concat(r),chartArea:eT(s,"chartArea"),vertical:_.concat(v).concat(L),horizontal:E.concat(A).concat(r)}}function UP(d,s,u,_){return Math.max(d[u],s[u])+Math.max(d[_],s[_])}function ok(d,s){d.top=Math.max(d.top,s.top),d.left=Math.max(d.left,s.left),d.bottom=Math.max(d.bottom,s.bottom),d.right=Math.max(d.right,s.right)}function qV(d,s,u,_){const{pos:v,box:E}=u,A=d.maxPadding;if(!Po(v)){u.size&&(d[v]-=u.size);const X=_[u.stack]||{size:0,count:1};X.size=Math.max(X.size,u.horizontal?E.height:E.width),u.size=X.size/X.count,d[v]+=u.size}E.getPadding&&ok(A,E.getPadding());const r=Math.max(0,s.outerWidth-UP(A,d,"left","right")),L=Math.max(0,s.outerHeight-UP(A,d,"top","bottom")),N=r!==d.w,H=L!==d.h;return d.w=r,d.h=L,u.horizontal?{same:N,other:H}:{same:H,other:N}}function ZV(d){const s=d.maxPadding;function u(_){const v=Math.max(s[_]-d[_],0);return d[_]+=v,v}d.y+=u("top"),d.x+=u("left"),u("right"),u("bottom")}function XV(d,s){const u=s.maxPadding;function _(v){const E={left:0,top:0,right:0,bottom:0};return v.forEach(A=>{E[A]=Math.max(s[A],u[A])}),E}return _(d?["left","right"]:["top","bottom"])}function aT(d,s,u,_){const v=[];let E,A,r,L,N,H;for(E=0,A=d.length,N=0;E<A;++E){r=d[E],L=r.box,L.update(r.width||s.w,r.height||s.h,XV(r.horizontal,s));const{same:X,other:re}=qV(s,u,r,_);N|=X&&v.length,H=H||re,L.fullSize||v.push(r)}return N&&aT(v,s,u,_)||H}function oA(d,s,u,_,v){d.top=u,d.left=s,d.right=s+_,d.bottom=u+v,d.width=_,d.height=v}function jP(d,s,u,_){const v=u.padding;let{x:E,y:A}=s;for(const r of d){const L=r.box,N=_[r.stack]||{placed:0,weight:1},H=r.stackWeight/N.weight||1;if(r.horizontal){const X=s.w*H,re=N.size||L.height;AT(N.start)&&(A=N.start),L.fullSize?oA(L,v.left,A,u.outerWidth-v.right-v.left,re):oA(L,s.left+N.placed,A,X,re),N.start=A,N.placed+=X,A=L.bottom}else{const X=s.h*H,re=N.size||L.width;AT(N.start)&&(E=N.start),L.fullSize?oA(L,E,v.top,re,u.outerHeight-v.bottom-v.top):oA(L,E,s.top+N.placed,re,X),N.start=E,N.placed+=X,E=L.right}}s.x=E,s.y=A}var O_={addBox(d,s){d.boxes||(d.boxes=[]),s.fullSize=s.fullSize||!1,s.position=s.position||"top",s.weight=s.weight||0,s._layers=s._layers||function(){return[{z:0,draw(u){s.draw(u)}}]},d.boxes.push(s)},removeBox(d,s){const u=d.boxes?d.boxes.indexOf(s):-1;u!==-1&&d.boxes.splice(u,1)},configure(d,s,u){s.fullSize=u.fullSize,s.position=u.position,s.weight=u.weight},update(d,s,u,_){if(!d)return;const v=ad(d.options.layout.padding),E=Math.max(s-v.width,0),A=Math.max(u-v.height,0),r=WV(d.boxes),L=r.vertical,N=r.horizontal;Xo(d.boxes,ve=>{typeof ve.beforeLayout=="function"&&ve.beforeLayout()});const H=L.reduce((ve,xe)=>xe.box.options&&xe.box.options.display===!1?ve:ve+1,0)||1,X=Object.freeze({outerWidth:s,outerHeight:u,padding:v,availableWidth:E,availableHeight:A,vBoxMaxWidth:E/2/H,hBoxMaxHeight:A/2}),re=Object.assign({},v);ok(re,ad(_));const he=Object.assign({maxPadding:re,w:E,h:A,x:v.left,y:v.top},v),de=$V(L.concat(N),X);aT(r.fullSize,he,X,de),aT(L,he,X,de),aT(N,he,X,de)&&aT(L,he,X,de),ZV(he),jP(r.leftAndTop,he,X,de),he.x+=he.w,he.y+=he.h,jP(r.rightAndBottom,he,X,de),d.chartArea={left:he.left,top:he.top,right:he.left+he.w,bottom:he.top+he.h,height:he.h,width:he.w},Xo(r.chartArea,ve=>{const xe=ve.box;Object.assign(xe,d.chartArea),xe.update(he.w,he.h,{left:0,top:0,right:0,bottom:0})})}};class ak{acquireContext(s,u){}releaseContext(s){return!1}addEventListener(s,u,_){}removeEventListener(s,u,_){}getDevicePixelRatio(){return 1}getMaximumSize(s,u,_,v){return u=Math.max(0,u||s.width),_=_||s.height,{width:u,height:Math.max(0,v?Math.floor(u/v):_)}}isAttached(s){return!0}updateConfig(s){}}class YV extends ak{acquireContext(s){return s&&s.getContext&&s.getContext("2d")||null}updateConfig(s){s.options.animation=!1}}const wA="$chartjs",KV={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},GP=d=>d===null||d==="";function JV(d,s){const u=d.style,_=d.getAttribute("height"),v=d.getAttribute("width");if(d[wA]={initial:{height:_,width:v,style:{display:u.display,height:u.height,width:u.width}}},u.display=u.display||"block",u.boxSizing=u.boxSizing||"border-box",GP(v)){const E=AP(d,"width");E!==void 0&&(d.width=E)}if(GP(_))if(d.style.height==="")d.height=d.width/(s||2);else{const E=AP(d,"height");E!==void 0&&(d.height=E)}return d}const sk=J5?{passive:!0}:!1;function QV(d,s,u){d&&d.addEventListener(s,u,sk)}function eU(d,s,u){d&&d.canvas&&d.canvas.removeEventListener(s,u,sk)}function tU(d,s){const u=KV[d.type]||d.type,{x:_,y:v}=Bv(d,s);return{type:u,chart:s,native:d,x:_!==void 0?_:null,y:v!==void 0?v:null}}function zA(d,s){for(const u of d)if(u===s||u.contains(s))return!0}function iU(d,s,u){const _=d.canvas,v=new MutationObserver(E=>{let A=!1;for(const r of E)A=A||zA(r.addedNodes,_),A=A&&!zA(r.removedNodes,_);A&&u()});return v.observe(document,{childList:!0,subtree:!0}),v}function nU(d,s,u){const _=d.canvas,v=new MutationObserver(E=>{let A=!1;for(const r of E)A=A||zA(r.removedNodes,_),A=A&&!zA(r.addedNodes,_);A&&u()});return v.observe(document,{childList:!0,subtree:!0}),v}const RT=new Map;let HP=0;function lk(){const d=window.devicePixelRatio;d!==HP&&(HP=d,RT.forEach((s,u)=>{u.currentDevicePixelRatio!==d&&s()}))}function rU(d,s){RT.size||window.addEventListener("resize",lk),RT.set(d,s)}function oU(d){RT.delete(d),RT.size||window.removeEventListener("resize",lk)}function aU(d,s,u){const _=d.canvas,v=_&&pD(_);if(!v)return;const E=U2((r,L)=>{const N=v.clientWidth;u(r,L),N<v.clientWidth&&u()},window),A=new ResizeObserver(r=>{const L=r[0],N=L.contentRect.width,H=L.contentRect.height;N===0&&H===0||E(N,H)});return A.observe(v),rU(d,E),A}function sR(d,s,u){u&&u.disconnect(),s==="resize"&&oU(d)}function sU(d,s,u){const _=d.canvas,v=U2(E=>{d.ctx!==null&&u(tU(E,d))},d);return QV(_,s,v),v}class lU extends ak{acquireContext(s,u){const _=s&&s.getContext&&s.getContext("2d");return _&&_.canvas===s?(JV(s,u),_):null}releaseContext(s){const u=s.canvas;if(!u[wA])return!1;const _=u[wA].initial;["height","width"].forEach(E=>{const A=_[E];wo(A)?u.removeAttribute(E):u.setAttribute(E,A)});const v=_.style||{};return Object.keys(v).forEach(E=>{u.style[E]=v[E]}),u.width=u.width,delete u[wA],!0}addEventListener(s,u,_){this.removeEventListener(s,u);const v=s.$proxies||(s.$proxies={}),A={attach:iU,detach:nU,resize:aU}[u]||sU;v[u]=A(s,u,_)}removeEventListener(s,u){const _=s.$proxies||(s.$proxies={}),v=_[u];if(!v)return;({attach:sR,detach:sR,resize:sR}[u]||eU)(s,u,v),_[u]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(s,u,_,v){return K5(s,u,_,v)}isAttached(s){const u=s&&pD(s);return!!(u&&u.isConnected)}}function cU(d){return!fD()||typeof OffscreenCanvas<"u"&&d instanceof OffscreenCanvas?YV:lU}class up{constructor(){Ln(this,"x");Ln(this,"y");Ln(this,"active",!1);Ln(this,"options");Ln(this,"$animations")}tooltipPosition(s){const{x:u,y:_}=this.getProps(["x","y"],s);return{x:u,y:_}}hasValue(){return CT(this.x)&&CT(this.y)}getProps(s,u){const _=this.$animations;if(!u||!_)return this;const v={};return s.forEach(E=>{v[E]=_[E]&&_[E].active()?_[E]._to:this[E]}),v}}Ln(up,"defaults",{}),Ln(up,"defaultRoutes");function uU(d,s){const u=d.options.ticks,_=hU(d),v=Math.min(u.maxTicksLimit||_,_),E=u.major.enabled?fU(s):[],A=E.length,r=E[0],L=E[A-1],N=[];if(A>v)return pU(s,N,E,A/v),N;const H=dU(E,s,v);if(A>0){let X,re;const he=A>1?Math.round((L-r)/(A-1)):null;for(aA(s,N,H,wo(he)?0:r-he,r),X=0,re=A-1;X<re;X++)aA(s,N,H,E[X],E[X+1]);return aA(s,N,H,L,wo(he)?s.length:L+he),N}return aA(s,N,H),N}function hU(d){const s=d.options.offset,u=d._tickSize(),_=d._length/u+(s?0:1),v=d._maxLength/u;return Math.floor(Math.min(_,v))}function dU(d,s,u){const _=mU(d),v=s.length/u;if(!_)return Math.max(v,1);const E=YB(_);for(let A=0,r=E.length-1;A<r;A++){const L=E[A];if(L>v)return L}return Math.max(v,1)}function fU(d){const s=[];let u,_;for(u=0,_=d.length;u<_;u++)d[u].major&&s.push(u);return s}function pU(d,s,u,_){let v=0,E=u[0],A;for(_=Math.ceil(_),A=0;A<d.length;A++)A===E&&(s.push(d[A]),v++,E=u[v*_])}function aA(d,s,u,_,v){const E=Jr(_,0),A=Math.min(Jr(v,d.length),d.length);let r=0,L,N,H;for(u=Math.ceil(u),v&&(L=v-_,u=L/Math.floor(L/u)),H=E;H<0;)r++,H=Math.round(E+r*u);for(N=Math.max(E,0);N<A;N++)N===H&&(s.push(d[N]),r++,H=Math.round(E+r*u))}function mU(d){const s=d.length;let u,_;if(s<2)return!1;for(_=d[0],u=1;u<s;++u)if(d[u]-d[u-1]!==_)return!1;return _}const gU=d=>d==="left"?"right":d==="right"?"left":d,$P=(d,s,u)=>s==="top"||s==="left"?d[s]+u:d[s]-u,WP=(d,s)=>Math.min(s||d,d);function qP(d,s){const u=[],_=d.length/s,v=d.length;let E=0;for(;E<v;E+=_)u.push(d[Math.floor(E)]);return u}function _U(d,s,u){const _=d.ticks.length,v=Math.min(s,_-1),E=d._startPixel,A=d._endPixel,r=1e-6;let L=d.getPixelForTick(v),N;if(!(u&&(_===1?N=Math.max(L-E,A-L):s===0?N=(d.getPixelForTick(1)-L)/2:N=(L-d.getPixelForTick(v-1))/2,L+=v<s?N:-N,L<E-r||L>A+r)))return L}function yU(d,s){Xo(d,u=>{const _=u.gc,v=_.length/2;let E;if(v>s){for(E=0;E<v;++E)delete u.data[_[E]];_.splice(0,v)}})}function iT(d){return d.drawTicks?d.tickLength:0}function ZP(d,s){if(!d.display)return 0;const u=Cc(d.font,s),_=ad(d.padding);return(Ys(d.text)?d.text.length:1)*u.lineHeight+_.height}function vU(d,s){return Qv(d,{scale:s,type:"scale"})}function xU(d,s,u){return Qv(d,{tick:u,index:s,type:"tick"})}function bU(d,s,u){let _=j2(d);return(u&&s!=="right"||!u&&s==="right")&&(_=gU(_)),_}function wU(d,s,u,_){const{top:v,left:E,bottom:A,right:r,chart:L}=d,{chartArea:N,scales:H}=L;let X=0,re,he,de;const ve=A-v,xe=r-E;if(d.isHorizontal()){if(he=lh(_,E,r),Po(u)){const $e=Object.keys(u)[0],Le=u[$e];de=H[$e].getPixelForValue(Le)+ve-s}else u==="center"?de=(N.bottom+N.top)/2+ve-s:de=$P(d,u,s);re=r-E}else{if(Po(u)){const $e=Object.keys(u)[0],Le=u[$e];he=H[$e].getPixelForValue(Le)-xe+s}else u==="center"?he=(N.left+N.right)/2-xe+s:he=$P(d,u,s);de=lh(_,A,v),X=u==="left"?-Ol:Ol}return{titleX:he,titleY:de,maxWidth:re,rotation:X}}class zb extends up{constructor(s){super(),this.id=s.id,this.type=s.type,this.options=void 0,this.ctx=s.ctx,this.chart=s.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(s){this.options=s.setContext(this.getContext()),this.axis=s.axis,this._userMin=this.parse(s.min),this._userMax=this.parse(s.max),this._suggestedMin=this.parse(s.suggestedMin),this._suggestedMax=this.parse(s.suggestedMax)}parse(s,u){return s}getUserBounds(){let{_userMin:s,_userMax:u,_suggestedMin:_,_suggestedMax:v}=this;return s=np(s,Number.POSITIVE_INFINITY),u=np(u,Number.NEGATIVE_INFINITY),_=np(_,Number.POSITIVE_INFINITY),v=np(v,Number.NEGATIVE_INFINITY),{min:np(s,_),max:np(u,v),minDefined:od(s),maxDefined:od(u)}}getMinMax(s){let{min:u,max:_,minDefined:v,maxDefined:E}=this.getUserBounds(),A;if(v&&E)return{min:u,max:_};const r=this.getMatchingVisibleMetas();for(let L=0,N=r.length;L<N;++L)A=r[L].controller.getMinMax(this,s),v||(u=Math.min(u,A.min)),E||(_=Math.max(_,A.max));return u=E&&u>_?_:u,_=v&&u>_?u:_,{min:np(u,np(_,u)),max:np(_,np(u,_))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const s=this.chart.data;return this.options.labels||(this.isHorizontal()?s.xLabels:s.yLabels)||s.labels||[]}getLabelItems(s=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(s))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){pa(this.options.beforeUpdate,[this])}update(s,u,_){const{beginAtZero:v,grace:E,ticks:A}=this.options,r=A.sampleSize;this.beforeUpdate(),this.maxWidth=s,this.maxHeight=u,this._margins=_=Object.assign({left:0,right:0,top:0,bottom:0},_),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+_.left+_.right:this.height+_.top+_.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=R5(this,E,v),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const L=r<this.ticks.length;this._convertTicksToLabels(L?qP(this.ticks,r):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),A.display&&(A.autoSkip||A.source==="auto")&&(this.ticks=uU(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),L&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let s=this.options.reverse,u,_;this.isHorizontal()?(u=this.left,_=this.right):(u=this.top,_=this.bottom,s=!s),this._startPixel=u,this._endPixel=_,this._reversePixels=s,this._length=_-u,this._alignToPixels=this.options.alignToPixels}afterUpdate(){pa(this.options.afterUpdate,[this])}beforeSetDimensions(){pa(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){pa(this.options.afterSetDimensions,[this])}_callHooks(s){this.chart.notifyPlugins(s,this.getContext()),pa(this.options[s],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){pa(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(s){const u=this.options.ticks;let _,v,E;for(_=0,v=s.length;_<v;_++)E=s[_],E.label=pa(u.callback,[E.value,_,s],this)}afterTickToLabelConversion(){pa(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){pa(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const s=this.options,u=s.ticks,_=WP(this.ticks.length,s.ticks.maxTicksLimit),v=u.minRotation||0,E=u.maxRotation;let A=v,r,L,N;if(!this._isVisible()||!u.display||v>=E||_<=1||!this.isHorizontal()){this.labelRotation=v;return}const H=this._getLabelSizes(),X=H.widest.width,re=H.highest.height,he=ec(this.chart.width-X,0,this.maxWidth);r=s.offset?this.maxWidth/_:he/(_-1),X+6>r&&(r=he/(_-(s.offset?.5:1)),L=this.maxHeight-iT(s.grid)-u.padding-ZP(s.title,this.chart.options.font),N=Math.sqrt(X*X+re*re),A=e5(Math.min(Math.asin(ec((H.highest.height+6)/r,-1,1)),Math.asin(ec(L/N,-1,1))-Math.asin(ec(re/N,-1,1)))),A=Math.max(v,Math.min(E,A))),this.labelRotation=A}afterCalculateLabelRotation(){pa(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){pa(this.options.beforeFit,[this])}fit(){const s={width:0,height:0},{chart:u,options:{ticks:_,title:v,grid:E}}=this,A=this._isVisible(),r=this.isHorizontal();if(A){const L=ZP(v,u.options.font);if(r?(s.width=this.maxWidth,s.height=iT(E)+L):(s.height=this.maxHeight,s.width=iT(E)+L),_.display&&this.ticks.length){const{first:N,last:H,widest:X,highest:re}=this._getLabelSizes(),he=_.padding*2,de=$v(this.labelRotation),ve=Math.cos(de),xe=Math.sin(de);if(r){const $e=_.mirror?0:xe*X.width+ve*re.height;s.height=Math.min(this.maxHeight,s.height+$e+he)}else{const $e=_.mirror?0:ve*X.width+xe*re.height;s.width=Math.min(this.maxWidth,s.width+$e+he)}this._calculatePadding(N,H,xe,ve)}}this._handleMargins(),r?(this.width=this._length=u.width-this._margins.left-this._margins.right,this.height=s.height):(this.width=s.width,this.height=this._length=u.height-this._margins.top-this._margins.bottom)}_calculatePadding(s,u,_,v){const{ticks:{align:E,padding:A},position:r}=this.options,L=this.labelRotation!==0,N=r!=="top"&&this.axis==="x";if(this.isHorizontal()){const H=this.getPixelForTick(0)-this.left,X=this.right-this.getPixelForTick(this.ticks.length-1);let re=0,he=0;L?N?(re=v*s.width,he=_*u.height):(re=_*s.height,he=v*u.width):E==="start"?he=u.width:E==="end"?re=s.width:E!=="inner"&&(re=s.width/2,he=u.width/2),this.paddingLeft=Math.max((re-H+A)*this.width/(this.width-H),0),this.paddingRight=Math.max((he-X+A)*this.width/(this.width-X),0)}else{let H=u.height/2,X=s.height/2;E==="start"?(H=0,X=s.height):E==="end"&&(H=u.height,X=0),this.paddingTop=H+A,this.paddingBottom=X+A}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){pa(this.options.afterFit,[this])}isHorizontal(){const{axis:s,position:u}=this.options;return u==="top"||u==="bottom"||s==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(s){this.beforeTickToLabelConversion(),this.generateTickLabels(s);let u,_;for(u=0,_=s.length;u<_;u++)wo(s[u].label)&&(s.splice(u,1),_--,u--);this.afterTickToLabelConversion()}_getLabelSizes(){let s=this._labelSizes;if(!s){const u=this.options.ticks.sampleSize;let _=this.ticks;u<_.length&&(_=qP(_,u)),this._labelSizes=s=this._computeLabelSizes(_,_.length,this.options.ticks.maxTicksLimit)}return s}_computeLabelSizes(s,u,_){const{ctx:v,_longestTextCache:E}=this,A=[],r=[],L=Math.floor(u/WP(u,_));let N=0,H=0,X,re,he,de,ve,xe,$e,Le,Ke,Ge,Ye;for(X=0;X<u;X+=L){if(de=s[X].label,ve=this._resolveTickFontOptions(X),v.font=xe=ve.string,$e=E[xe]=E[xe]||{data:{},gc:[]},Le=ve.lineHeight,Ke=Ge=0,!wo(de)&&!Ys(de))Ke=bP(v,$e.data,$e.gc,Ke,de),Ge=Le;else if(Ys(de))for(re=0,he=de.length;re<he;++re)Ye=de[re],!wo(Ye)&&!Ys(Ye)&&(Ke=bP(v,$e.data,$e.gc,Ke,Ye),Ge+=Le);A.push(Ke),r.push(Ge),N=Math.max(Ke,N),H=Math.max(Ge,H)}yU(E,u);const mt=A.indexOf(N),Ct=r.indexOf(H),Vt=ui=>({width:A[ui]||0,height:r[ui]||0});return{first:Vt(0),last:Vt(u-1),widest:Vt(mt),highest:Vt(Ct),widths:A,heights:r}}getLabelForValue(s){return s}getPixelForValue(s,u){return NaN}getValueForPixel(s){}getPixelForTick(s){const u=this.ticks;return s<0||s>u.length-1?null:this.getPixelForValue(u[s].value)}getPixelForDecimal(s){this._reversePixels&&(s=1-s);const u=this._startPixel+s*this._length;return i5(this._alignToPixels?Lv(this.chart,u,0):u)}getDecimalForPixel(s){const u=(s-this._startPixel)/this._length;return this._reversePixels?1-u:u}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:s,max:u}=this;return s<0&&u<0?u:s>0&&u>0?s:0}getContext(s){const u=this.ticks||[];if(s>=0&&s<u.length){const _=u[s];return _.$context||(_.$context=xU(this.getContext(),s,_))}return this.$context||(this.$context=vU(this.chart.getContext(),this))}_tickSize(){const s=this.options.ticks,u=$v(this.labelRotation),_=Math.abs(Math.cos(u)),v=Math.abs(Math.sin(u)),E=this._getLabelSizes(),A=s.autoSkipPadding||0,r=E?E.widest.width+A:0,L=E?E.highest.height+A:0;return this.isHorizontal()?L*_>r*v?r/_:L/v:L*v<r*_?L/_:r/v}_isVisible(){const s=this.options.display;return s!=="auto"?!!s:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(s){const u=this.axis,_=this.chart,v=this.options,{grid:E,position:A,border:r}=v,L=E.offset,N=this.isHorizontal(),X=this.ticks.length+(L?1:0),re=iT(E),he=[],de=r.setContext(this.getContext()),ve=de.display?de.width:0,xe=ve/2,$e=function(_t){return Lv(_,_t,ve)};let Le,Ke,Ge,Ye,mt,Ct,Vt,ui,Di,si,di,Nt;if(A==="top")Le=$e(this.bottom),Ct=this.bottom-re,ui=Le-xe,si=$e(s.top)+xe,Nt=s.bottom;else if(A==="bottom")Le=$e(this.top),si=s.top,Nt=$e(s.bottom)-xe,Ct=Le+xe,ui=this.top+re;else if(A==="left")Le=$e(this.right),mt=this.right-re,Vt=Le-xe,Di=$e(s.left)+xe,di=s.right;else if(A==="right")Le=$e(this.left),Di=s.left,di=$e(s.right)-xe,mt=Le+xe,Vt=this.left+re;else if(u==="x"){if(A==="center")Le=$e((s.top+s.bottom)/2+.5);else if(Po(A)){const _t=Object.keys(A)[0],Et=A[_t];Le=$e(this.chart.scales[_t].getPixelForValue(Et))}si=s.top,Nt=s.bottom,Ct=Le+xe,ui=Ct+re}else if(u==="y"){if(A==="center")Le=$e((s.left+s.right)/2);else if(Po(A)){const _t=Object.keys(A)[0],Et=A[_t];Le=$e(this.chart.scales[_t].getPixelForValue(Et))}mt=Le-xe,Vt=mt-re,Di=s.left,di=s.right}const Ii=Jr(v.ticks.maxTicksLimit,X),Qt=Math.max(1,Math.ceil(X/Ii));for(Ke=0;Ke<X;Ke+=Qt){const _t=this.getContext(Ke),Et=E.setContext(_t),fi=r.setContext(_t),rn=Et.lineWidth,zn=Et.color,er=fi.dash||[],Mn=fi.dashOffset,pn=Et.tickWidth,pr=Et.tickColor,Vr=Et.tickBorderDash||[],Or=Et.tickBorderDashOffset;Ge=_U(this,Ke,L),Ge!==void 0&&(Ye=Lv(_,Ge,rn),N?mt=Vt=Di=di=Ye:Ct=ui=si=Nt=Ye,he.push({tx1:mt,ty1:Ct,tx2:Vt,ty2:ui,x1:Di,y1:si,x2:di,y2:Nt,width:rn,color:zn,borderDash:er,borderDashOffset:Mn,tickWidth:pn,tickColor:pr,tickBorderDash:Vr,tickBorderDashOffset:Or}))}return this._ticksLength=X,this._borderValue=Le,he}_computeLabelItems(s){const u=this.axis,_=this.options,{position:v,ticks:E}=_,A=this.isHorizontal(),r=this.ticks,{align:L,crossAlign:N,padding:H,mirror:X}=E,re=iT(_.grid),he=re+H,de=X?-H:he,ve=-$v(this.labelRotation),xe=[];let $e,Le,Ke,Ge,Ye,mt,Ct,Vt,ui,Di,si,di,Nt="middle";if(v==="top")mt=this.bottom-de,Ct=this._getXAxisLabelAlignment();else if(v==="bottom")mt=this.top+de,Ct=this._getXAxisLabelAlignment();else if(v==="left"){const Qt=this._getYAxisLabelAlignment(re);Ct=Qt.textAlign,Ye=Qt.x}else if(v==="right"){const Qt=this._getYAxisLabelAlignment(re);Ct=Qt.textAlign,Ye=Qt.x}else if(u==="x"){if(v==="center")mt=(s.top+s.bottom)/2+he;else if(Po(v)){const Qt=Object.keys(v)[0],_t=v[Qt];mt=this.chart.scales[Qt].getPixelForValue(_t)+he}Ct=this._getXAxisLabelAlignment()}else if(u==="y"){if(v==="center")Ye=(s.left+s.right)/2-he;else if(Po(v)){const Qt=Object.keys(v)[0],_t=v[Qt];Ye=this.chart.scales[Qt].getPixelForValue(_t)}Ct=this._getYAxisLabelAlignment(re).textAlign}u==="y"&&(L==="start"?Nt="top":L==="end"&&(Nt="bottom"));const Ii=this._getLabelSizes();for($e=0,Le=r.length;$e<Le;++$e){Ke=r[$e],Ge=Ke.label;const Qt=E.setContext(this.getContext($e));Vt=this.getPixelForTick($e)+E.labelOffset,ui=this._resolveTickFontOptions($e),Di=ui.lineHeight,si=Ys(Ge)?Ge.length:1;const _t=si/2,Et=Qt.color,fi=Qt.textStrokeColor,rn=Qt.textStrokeWidth;let zn=Ct;A?(Ye=Vt,Ct==="inner"&&($e===Le-1?zn=this.options.reverse?"left":"right":$e===0?zn=this.options.reverse?"right":"left":zn="center"),v==="top"?N==="near"||ve!==0?di=-si*Di+Di/2:N==="center"?di=-Ii.highest.height/2-_t*Di+Di:di=-Ii.highest.height+Di/2:N==="near"||ve!==0?di=Di/2:N==="center"?di=Ii.highest.height/2-_t*Di:di=Ii.highest.height-si*Di,X&&(di*=-1),ve!==0&&!Qt.showLabelBackdrop&&(Ye+=Di/2*Math.sin(ve))):(mt=Vt,di=(1-si)*Di/2);let er;if(Qt.showLabelBackdrop){const Mn=ad(Qt.backdropPadding),pn=Ii.heights[$e],pr=Ii.widths[$e];let Vr=di-Mn.top,Or=0-Mn.left;switch(Nt){case"middle":Vr-=pn/2;break;case"bottom":Vr-=pn;break}switch(Ct){case"center":Or-=pr/2;break;case"right":Or-=pr;break;case"inner":$e===Le-1?Or-=pr:$e>0&&(Or-=pr/2);break}er={left:Or,top:Vr,width:pr+Mn.width,height:pn+Mn.height,color:Qt.backdropColor}}xe.push({label:Ge,font:ui,textOffset:di,options:{rotation:ve,color:Et,strokeColor:fi,strokeWidth:rn,textAlign:zn,textBaseline:Nt,translation:[Ye,mt],backdrop:er}})}return xe}_getXAxisLabelAlignment(){const{position:s,ticks:u}=this.options;if(-$v(this.labelRotation))return s==="top"?"left":"right";let v="center";return u.align==="start"?v="left":u.align==="end"?v="right":u.align==="inner"&&(v="inner"),v}_getYAxisLabelAlignment(s){const{position:u,ticks:{crossAlign:_,mirror:v,padding:E}}=this.options,A=this._getLabelSizes(),r=s+E,L=A.widest.width;let N,H;return u==="left"?v?(H=this.right+E,_==="near"?N="left":_==="center"?(N="center",H+=L/2):(N="right",H+=L)):(H=this.right-r,_==="near"?N="right":_==="center"?(N="center",H-=L/2):(N="left",H=this.left)):u==="right"?v?(H=this.left+E,_==="near"?N="right":_==="center"?(N="center",H-=L/2):(N="left",H-=L)):(H=this.left+r,_==="near"?N="left":_==="center"?(N="center",H+=L/2):(N="right",H=this.right)):N="right",{textAlign:N,x:H}}_computeLabelArea(){if(this.options.ticks.mirror)return;const s=this.chart,u=this.options.position;if(u==="left"||u==="right")return{top:0,left:this.left,bottom:s.height,right:this.right};if(u==="top"||u==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:s.width}}drawBackground(){const{ctx:s,options:{backgroundColor:u},left:_,top:v,width:E,height:A}=this;u&&(s.save(),s.fillStyle=u,s.fillRect(_,v,E,A),s.restore())}getLineWidthForValue(s){const u=this.options.grid;if(!this._isVisible()||!u.display)return 0;const v=this.ticks.findIndex(E=>E.value===s);return v>=0?u.setContext(this.getContext(v)).lineWidth:0}drawGrid(s){const u=this.options.grid,_=this.ctx,v=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(s));let E,A;const r=(L,N,H)=>{!H.width||!H.color||(_.save(),_.lineWidth=H.width,_.strokeStyle=H.color,_.setLineDash(H.borderDash||[]),_.lineDashOffset=H.borderDashOffset,_.beginPath(),_.moveTo(L.x,L.y),_.lineTo(N.x,N.y),_.stroke(),_.restore())};if(u.display)for(E=0,A=v.length;E<A;++E){const L=v[E];u.drawOnChartArea&&r({x:L.x1,y:L.y1},{x:L.x2,y:L.y2},L),u.drawTicks&&r({x:L.tx1,y:L.ty1},{x:L.tx2,y:L.ty2},{color:L.tickColor,width:L.tickWidth,borderDash:L.tickBorderDash,borderDashOffset:L.tickBorderDashOffset})}}drawBorder(){const{chart:s,ctx:u,options:{border:_,grid:v}}=this,E=_.setContext(this.getContext()),A=_.display?E.width:0;if(!A)return;const r=v.setContext(this.getContext(0)).lineWidth,L=this._borderValue;let N,H,X,re;this.isHorizontal()?(N=Lv(s,this.left,A)-A/2,H=Lv(s,this.right,r)+r/2,X=re=L):(X=Lv(s,this.top,A)-A/2,re=Lv(s,this.bottom,r)+r/2,N=H=L),u.save(),u.lineWidth=E.width,u.strokeStyle=E.color,u.beginPath(),u.moveTo(N,X),u.lineTo(H,re),u.stroke(),u.restore()}drawLabels(s){if(!this.options.ticks.display)return;const _=this.ctx,v=this._computeLabelArea();v&&sD(_,v);const E=this.getLabelItems(s);for(const A of E){const r=A.options,L=A.font,N=A.label,H=A.textOffset;kA(_,N,0,H,L,r)}v&&lD(_)}drawTitle(){const{ctx:s,options:{position:u,title:_,reverse:v}}=this;if(!_.display)return;const E=Cc(_.font),A=ad(_.padding),r=_.align;let L=E.lineHeight/2;u==="bottom"||u==="center"||Po(u)?(L+=A.bottom,Ys(_.text)&&(L+=E.lineHeight*(_.text.length-1))):L+=A.top;const{titleX:N,titleY:H,maxWidth:X,rotation:re}=wU(this,L,u,r);kA(s,_.text,0,0,E,{color:_.color,maxWidth:X,rotation:re,textAlign:bU(r,u,v),textBaseline:"middle",translation:[N,H]})}draw(s){this._isVisible()&&(this.drawBackground(),this.drawGrid(s),this.drawBorder(),this.drawTitle(),this.drawLabels(s))}_layers(){const s=this.options,u=s.ticks&&s.ticks.z||0,_=Jr(s.grid&&s.grid.z,-1),v=Jr(s.border&&s.border.z,0);return!this._isVisible()||this.draw!==zb.prototype.draw?[{z:u,draw:E=>{this.draw(E)}}]:[{z:_,draw:E=>{this.drawBackground(),this.drawGrid(E),this.drawTitle()}},{z:v,draw:()=>{this.drawBorder()}},{z:u,draw:E=>{this.drawLabels(E)}}]}getMatchingVisibleMetas(s){const u=this.chart.getSortedVisibleDatasetMetas(),_=this.axis+"AxisID",v=[];let E,A;for(E=0,A=u.length;E<A;++E){const r=u[E];r[_]===this.id&&(!s||r.type===s)&&v.push(r)}return v}_resolveTickFontOptions(s){const u=this.options.ticks.setContext(this.getContext(s));return Cc(u.font)}_maxDigits(){const s=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/s}}class sA{constructor(s,u,_){this.type=s,this.scope=u,this.override=_,this.items=Object.create(null)}isForType(s){return Object.prototype.isPrototypeOf.call(this.type.prototype,s.prototype)}register(s){const u=Object.getPrototypeOf(s);let _;EU(u)&&(_=this.register(u));const v=this.items,E=s.id,A=this.scope+"."+E;if(!E)throw new Error("class does not have id: "+s);return E in v||(v[E]=s,TU(s,A,_),this.override&&rs.override(s.id,s.overrides)),A}get(s){return this.items[s]}unregister(s){const u=this.items,_=s.id,v=this.scope;_ in u&&delete u[_],v&&_ in rs[v]&&(delete rs[v][_],this.override&&delete Yv[_])}}function TU(d,s,u){const _=cp(Object.create(null),[u?rs.get(u):{},rs.get(s),d.defaults]);rs.set(s,_),d.defaultRoutes&&SU(s,d.defaultRoutes),d.descriptors&&rs.describe(s,d.descriptors)}function SU(d,s){Object.keys(s).forEach(u=>{const _=u.split("."),v=_.pop(),E=[d].concat(_).join("."),A=s[u].split("."),r=A.pop(),L=A.join(".");rs.route(E,v,L,r)})}function EU(d){return"id"in d&&"defaults"in d}class AU{constructor(){this.controllers=new sA(Eb,"datasets",!0),this.elements=new sA(up,"elements"),this.plugins=new sA(Object,"plugins"),this.scales=new sA(zb,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...s){this._each("register",s)}remove(...s){this._each("unregister",s)}addControllers(...s){this._each("register",s,this.controllers)}addElements(...s){this._each("register",s,this.elements)}addPlugins(...s){this._each("register",s,this.plugins)}addScales(...s){this._each("register",s,this.scales)}getController(s){return this._get(s,this.controllers,"controller")}getElement(s){return this._get(s,this.elements,"element")}getPlugin(s){return this._get(s,this.plugins,"plugin")}getScale(s){return this._get(s,this.scales,"scale")}removeControllers(...s){this._each("unregister",s,this.controllers)}removeElements(...s){this._each("unregister",s,this.elements)}removePlugins(...s){this._each("unregister",s,this.plugins)}removeScales(...s){this._each("unregister",s,this.scales)}_each(s,u,_){[...u].forEach(v=>{const E=_||this._getRegistryForType(v);_||E.isForType(v)||E===this.plugins&&v.id?this._exec(s,E,v):Xo(v,A=>{const r=_||this._getRegistryForType(A);this._exec(s,r,A)})})}_exec(s,u,_){const v=nD(s);pa(_["before"+v],[],_),u[s](_),pa(_["after"+v],[],_)}_getRegistryForType(s){for(let u=0;u<this._typedRegistries.length;u++){const _=this._typedRegistries[u];if(_.isForType(s))return _}return this.plugins}_get(s,u,_){const v=u.get(s);if(v===void 0)throw new Error('"'+s+'" is not a registered '+_+".");return v}}var op=new AU;class CU{constructor(){this._init=void 0}notify(s,u,_,v){if(u==="beforeInit"&&(this._init=this._createDescriptors(s,!0),this._notify(this._init,s,"install")),this._init===void 0)return;const E=v?this._descriptors(s).filter(v):this._descriptors(s),A=this._notify(E,s,u,_);return u==="afterDestroy"&&(this._notify(E,s,"stop"),this._notify(this._init,s,"uninstall"),this._init=void 0),A}_notify(s,u,_,v){v=v||{};for(const E of s){const A=E.plugin,r=A[_],L=[u,v,E.options];if(pa(r,L,A)===!1&&v.cancelable)return!1}return!0}invalidate(){wo(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(s){if(this._cache)return this._cache;const u=this._cache=this._createDescriptors(s);return this._notifyStateChanges(s),u}_createDescriptors(s,u){const _=s&&s.config,v=Jr(_.options&&_.options.plugins,{}),E=IU(_);return v===!1&&!u?[]:DU(s,E,v,u)}_notifyStateChanges(s){const u=this._oldCache||[],_=this._cache,v=(E,A)=>E.filter(r=>!A.some(L=>r.plugin.id===L.plugin.id));this._notify(v(u,_),s,"stop"),this._notify(v(_,u),s,"start")}}function IU(d){const s={},u=[],_=Object.keys(op.plugins.items);for(let E=0;E<_.length;E++)u.push(op.getPlugin(_[E]));const v=d.plugins||[];for(let E=0;E<v.length;E++){const A=v[E];u.indexOf(A)===-1&&(u.push(A),s[A.id]=!0)}return{plugins:u,localIds:s}}function RU(d,s){return!s&&d===!1?null:d===!0?{}:d}function DU(d,{plugins:s,localIds:u},_,v){const E=[],A=d.getContext();for(const r of s){const L=r.id,N=RU(_[L],v);N!==null&&E.push({plugin:r,options:MU(d.config,{plugin:r,local:u[L]},N,A)})}return E}function MU(d,{plugin:s,local:u},_,v){const E=d.pluginScopeKeys(s),A=d.getOptionScopes(_,E);return u&&s.defaults&&A.push(s.defaults),d.createResolver(A,v,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function CR(d,s){const u=rs.datasets[d]||{};return((s.datasets||{})[d]||{}).indexAxis||s.indexAxis||u.indexAxis||"x"}function PU(d,s){let u=d;return d==="_index_"?u=s:d==="_value_"&&(u=s==="x"?"y":"x"),u}function OU(d,s){return d===s?"_index_":"_value_"}function XP(d){if(d==="x"||d==="y"||d==="r")return d}function kU(d){if(d==="top"||d==="bottom")return"x";if(d==="left"||d==="right")return"y"}function IR(d,...s){if(XP(d))return d;for(const u of s){const _=u.axis||kU(u.position)||d.length>1&&XP(d[0].toLowerCase());if(_)return _}throw new Error(`Cannot determine type of '${d}' axis. Please provide 'axis' or 'position' option.`)}function YP(d,s,u){if(u[s+"AxisID"]===d)return{axis:s}}function FU(d,s){if(s.data&&s.data.datasets){const u=s.data.datasets.filter(_=>_.xAxisID===d||_.yAxisID===d);if(u.length)return YP(d,"x",u[0])||YP(d,"y",u[0])}return{}}function LU(d,s){const u=Yv[d.type]||{scales:{}},_=s.scales||{},v=CR(d.type,s),E=Object.create(null);return Object.keys(_).forEach(A=>{const r=_[A];if(!Po(r))return console.error(`Invalid scale configuration for scale: ${A}`);if(r._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${A}`);const L=IR(A,r,FU(A,d),rs.scales[r.type]),N=OU(L,v),H=u.scales||{};E[A]=dT(Object.create(null),[{axis:L},r,H[L],H[N]])}),d.data.datasets.forEach(A=>{const r=A.type||d.type,L=A.indexAxis||CR(r,s),H=(Yv[r]||{}).scales||{};Object.keys(H).forEach(X=>{const re=PU(X,L),he=A[re+"AxisID"]||re;E[he]=E[he]||Object.create(null),dT(E[he],[{axis:re},_[he],H[X]])})}),Object.keys(E).forEach(A=>{const r=E[A];dT(r,[rs.scales[r.type],rs.scale])}),E}function ck(d){const s=d.options||(d.options={});s.plugins=Jr(s.plugins,{}),s.scales=LU(d,s)}function uk(d){return d=d||{},d.datasets=d.datasets||[],d.labels=d.labels||[],d}function zU(d){return d=d||{},d.data=uk(d.data),ck(d),d}const KP=new Map,hk=new Set;function lA(d,s){let u=KP.get(d);return u||(u=s(),KP.set(d,u),hk.add(u)),u}const nT=(d,s,u)=>{const _=Rb(s,u);_!==void 0&&d.add(_)};class NU{constructor(s){this._config=zU(s),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(s){this._config.type=s}get data(){return this._config.data}set data(s){this._config.data=uk(s)}get options(){return this._config.options}set options(s){this._config.options=s}get plugins(){return this._config.plugins}update(){const s=this._config;this.clearCache(),ck(s)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(s){return lA(s,()=>[[`datasets.${s}`,""]])}datasetAnimationScopeKeys(s,u){return lA(`${s}.transition.${u}`,()=>[[`datasets.${s}.transitions.${u}`,`transitions.${u}`],[`datasets.${s}`,""]])}datasetElementScopeKeys(s,u){return lA(`${s}-${u}`,()=>[[`datasets.${s}.elements.${u}`,`datasets.${s}`,`elements.${u}`,""]])}pluginScopeKeys(s){const u=s.id,_=this.type;return lA(`${_}-plugin-${u}`,()=>[[`plugins.${u}`,...s.additionalOptionScopes||[]]])}_cachedScopes(s,u){const _=this._scopeCache;let v=_.get(s);return(!v||u)&&(v=new Map,_.set(s,v)),v}getOptionScopes(s,u,_){const{options:v,type:E}=this,A=this._cachedScopes(s,_),r=A.get(u);if(r)return r;const L=new Set;u.forEach(H=>{s&&(L.add(s),H.forEach(X=>nT(L,s,X))),H.forEach(X=>nT(L,v,X)),H.forEach(X=>nT(L,Yv[E]||{},X)),H.forEach(X=>nT(L,rs,X)),H.forEach(X=>nT(L,ER,X))});const N=Array.from(L);return N.length===0&&N.push(Object.create(null)),hk.has(u)&&A.set(u,N),N}chartOptionScopes(){const{options:s,type:u}=this;return[s,Yv[u]||{},rs.datasets[u]||{},{type:u},rs,ER]}resolveNamedOptions(s,u,_,v=[""]){const E={$shared:!0},{resolver:A,subPrefixes:r}=JP(this._resolverCache,s,v);let L=A;if(VU(A,u)){E.$shared=!1,_=z_(_)?_():_;const N=this.createResolver(s,_,r);L=Db(A,_,N)}for(const N of u)E[N]=L[N];return E}createResolver(s,u,_=[""],v){const{resolver:E}=JP(this._resolverCache,s,_);return Po(u)?Db(E,u,void 0,v):E}}function JP(d,s,u){let _=d.get(s);_||(_=new Map,d.set(s,_));const v=u.join();let E=_.get(v);return E||(E={resolver:uD(s,u),subPrefixes:u.filter(r=>!r.toLowerCase().includes("hover"))},_.set(v,E)),E}const BU=d=>Po(d)&&Object.getOwnPropertyNames(d).some(s=>z_(d[s]));function VU(d,s){const{isScriptable:u,isIndexable:_}=q2(d);for(const v of s){const E=u(v),A=_(v),r=(A||E)&&d[v];if(E&&(z_(r)||BU(r))||A&&Ys(r))return!0}return!1}var UU="4.5.1";const jU=["top","bottom","left","right","chartArea"];function QP(d,s){return d==="top"||d==="bottom"||jU.indexOf(d)===-1&&s==="x"}function eO(d,s){return function(u,_){return u[d]===_[d]?u[s]-_[s]:u[d]-_[d]}}function tO(d){const s=d.chart,u=s.options.animation;s.notifyPlugins("afterRender"),pa(u&&u.onComplete,[d],s)}function GU(d){const s=d.chart,u=s.options.animation;pa(u&&u.onProgress,[d],s)}function dk(d){return fD()&&typeof d=="string"?d=document.getElementById(d):d&&d.length&&(d=d[0]),d&&d.canvas&&(d=d.canvas),d}const TA={},iO=d=>{const s=dk(d);return Object.values(TA).filter(u=>u.canvas===s).pop()};function HU(d,s,u){const _=Object.keys(d);for(const v of _){const E=+v;if(E>=s){const A=d[v];delete d[v],(u>0||E>s)&&(d[E+u]=A)}}}function $U(d,s,u,_){return!u||d.type==="mouseout"?null:_?s:d}var C_;let gD=(C_=class{static register(...s){op.add(...s),nO()}static unregister(...s){op.remove(...s),nO()}constructor(s,u){const _=this.config=new NU(u),v=dk(s),E=iO(v);if(E)throw new Error("Canvas is already in use. Chart with ID '"+E.id+"' must be destroyed before the canvas with ID '"+E.canvas.id+"' can be reused.");const A=_.createResolver(_.chartOptionScopes(),this.getContext());this.platform=new(_.platform||cU(v)),this.platform.updateConfig(_);const r=this.platform.acquireContext(v,A.aspectRatio),L=r&&r.canvas,N=L&&L.height,H=L&&L.width;if(this.id=UB(),this.ctx=r,this.canvas=L,this.width=H,this.height=N,this._options=A,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new CU,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=a5(X=>this.update(X),A.resizeDelay||0),this._dataChanges=[],TA[this.id]=this,!r||!L){console.error("Failed to create chart: can't acquire context from the given item");return}Mm.listen(this,"complete",tO),Mm.listen(this,"progress",GU),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:s,maintainAspectRatio:u},width:_,height:v,_aspectRatio:E}=this;return wo(s)?u&&E?E:v?_/v:null:s}get data(){return this.config.data}set data(s){this.config.data=s}get options(){return this._options}set options(s){this.config.options=s}get registry(){return op}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():EP(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return wP(this.canvas,this.ctx),this}stop(){return Mm.stop(this),this}resize(s,u){Mm.running(this)?this._resizeBeforeDraw={width:s,height:u}:this._resize(s,u)}_resize(s,u){const _=this.options,v=this.canvas,E=_.maintainAspectRatio&&this.aspectRatio,A=this.platform.getMaximumSize(v,s,u,E),r=_.devicePixelRatio||this.platform.getDevicePixelRatio(),L=this.width?"resize":"attach";this.width=A.width,this.height=A.height,this._aspectRatio=this.aspectRatio,EP(this,r,!0)&&(this.notifyPlugins("resize",{size:A}),pa(_.onResize,[this,A],this),this.attached&&this._doResize(L)&&this.render())}ensureScalesHaveIDs(){const u=this.options.scales||{};Xo(u,(_,v)=>{_.id=v})}buildOrUpdateScales(){const s=this.options,u=s.scales,_=this.scales,v=Object.keys(_).reduce((A,r)=>(A[r]=!1,A),{});let E=[];u&&(E=E.concat(Object.keys(u).map(A=>{const r=u[A],L=IR(A,r),N=L==="r",H=L==="x";return{options:r,dposition:N?"chartArea":H?"bottom":"left",dtype:N?"radialLinear":H?"category":"linear"}}))),Xo(E,A=>{const r=A.options,L=r.id,N=IR(L,r),H=Jr(r.type,A.dtype);(r.position===void 0||QP(r.position,N)!==QP(A.dposition))&&(r.position=A.dposition),v[L]=!0;let X=null;if(L in _&&_[L].type===H)X=_[L];else{const re=op.getScale(H);X=new re({id:L,type:H,ctx:this.ctx,chart:this}),_[X.id]=X}X.init(r,s)}),Xo(v,(A,r)=>{A||delete _[r]}),Xo(_,A=>{O_.configure(this,A,A.options),O_.addBox(this,A)})}_updateMetasets(){const s=this._metasets,u=this.data.datasets.length,_=s.length;if(s.sort((v,E)=>v.index-E.index),_>u){for(let v=u;v<_;++v)this._destroyDatasetMeta(v);s.splice(u,_-u)}this._sortedMetasets=s.slice(0).sort(eO("order","index"))}_removeUnreferencedMetasets(){const{_metasets:s,data:{datasets:u}}=this;s.length>u.length&&delete this._stacks,s.forEach((_,v)=>{u.filter(E=>E===_._dataset).length===0&&this._destroyDatasetMeta(v)})}buildOrUpdateControllers(){const s=[],u=this.data.datasets;let _,v;for(this._removeUnreferencedMetasets(),_=0,v=u.length;_<v;_++){const E=u[_];let A=this.getDatasetMeta(_);const r=E.type||this.config.type;if(A.type&&A.type!==r&&(this._destroyDatasetMeta(_),A=this.getDatasetMeta(_)),A.type=r,A.indexAxis=E.indexAxis||CR(r,this.options),A.order=E.order||0,A.index=_,A.label=""+E.label,A.visible=this.isDatasetVisible(_),A.controller)A.controller.updateIndex(_),A.controller.linkScales();else{const L=op.getController(r),{datasetElementType:N,dataElementType:H}=rs.datasets[r];Object.assign(L,{dataElementType:op.getElement(H),datasetElementType:N&&op.getElement(N)}),A.controller=new L(this,_),s.push(A.controller)}}return this._updateMetasets(),s}_resetElements(){Xo(this.data.datasets,(s,u)=>{this.getDatasetMeta(u).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(s){const u=this.config;u.update();const _=this._options=u.createResolver(u.chartOptionScopes(),this.getContext()),v=this._animationsDisabled=!_.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:s,cancelable:!0})===!1)return;const E=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let A=0;for(let N=0,H=this.data.datasets.length;N<H;N++){const{controller:X}=this.getDatasetMeta(N),re=!v&&E.indexOf(X)===-1;X.buildOrUpdateElements(re),A=Math.max(+X.getMaxOverflow(),A)}A=this._minPadding=_.layout.autoPadding?A:0,this._updateLayout(A),v||Xo(E,N=>{N.reset()}),this._updateDatasets(s),this.notifyPlugins("afterUpdate",{mode:s}),this._layers.sort(eO("z","_idx"));const{_active:r,_lastEvent:L}=this;L?this._eventHandler(L,!0):r.length&&this._updateHoverStyles(r,r,!0),this.render()}_updateScales(){Xo(this.scales,s=>{O_.removeBox(this,s)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const s=this.options,u=new Set(Object.keys(this._listeners)),_=new Set(s.events);(!dP(u,_)||!!this._responsiveListeners!==s.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:s}=this,u=this._getUniformDataChanges()||[];for(const{method:_,start:v,count:E}of u){const A=_==="_removeElements"?-E:E;HU(s,v,A)}}_getUniformDataChanges(){const s=this._dataChanges;if(!s||!s.length)return;this._dataChanges=[];const u=this.data.datasets.length,_=E=>new Set(s.filter(A=>A[0]===E).map((A,r)=>r+","+A.splice(1).join(","))),v=_(0);for(let E=1;E<u;E++)if(!dP(v,_(E)))return;return Array.from(v).map(E=>E.split(",")).map(E=>({method:E[1],start:+E[2],count:+E[3]}))}_updateLayout(s){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;O_.update(this,this.width,this.height,s);const u=this.chartArea,_=u.width<=0||u.height<=0;this._layers=[],Xo(this.boxes,v=>{_&&v.position==="chartArea"||(v.configure&&v.configure(),this._layers.push(...v._layers()))},this),this._layers.forEach((v,E)=>{v._idx=E}),this.notifyPlugins("afterLayout")}_updateDatasets(s){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:s,cancelable:!0})!==!1){for(let u=0,_=this.data.datasets.length;u<_;++u)this.getDatasetMeta(u).controller.configure();for(let u=0,_=this.data.datasets.length;u<_;++u)this._updateDataset(u,z_(s)?s({datasetIndex:u}):s);this.notifyPlugins("afterDatasetsUpdate",{mode:s})}}_updateDataset(s,u){const _=this.getDatasetMeta(s),v={meta:_,index:s,mode:u,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",v)!==!1&&(_.controller._update(u),v.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",v))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Mm.has(this)?this.attached&&!Mm.running(this)&&Mm.start(this):(this.draw(),tO({chart:this})))}draw(){let s;if(this._resizeBeforeDraw){const{width:_,height:v}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(_,v)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const u=this._layers;for(s=0;s<u.length&&u[s].z<=0;++s)u[s].draw(this.chartArea);for(this._drawDatasets();s<u.length;++s)u[s].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(s){const u=this._sortedMetasets,_=[];let v,E;for(v=0,E=u.length;v<E;++v){const A=u[v];(!s||A.visible)&&_.push(A)}return _}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const s=this.getSortedVisibleDatasetMetas();for(let u=s.length-1;u>=0;--u)this._drawDataset(s[u]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(s){const u=this.ctx,_={meta:s,index:s.index,cancelable:!0},v=dV(this,s);this.notifyPlugins("beforeDatasetDraw",_)!==!1&&(v&&sD(u,v),s.controller.draw(),v&&lD(u),_.cancelable=!1,this.notifyPlugins("afterDatasetDraw",_))}isPointInArea(s){return IT(s,this.chartArea,this._minPadding)}getElementsAtEventForMode(s,u,_,v){const E=jV.modes[u];return typeof E=="function"?E(this,s,_,v):[]}getDatasetMeta(s){const u=this.data.datasets[s],_=this._metasets;let v=_.filter(E=>E&&E._dataset===u).pop();return v||(v={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:u&&u.order||0,index:s,_dataset:u,_parsed:[],_sorted:!1},_.push(v)),v}getContext(){return this.$context||(this.$context=Qv(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(s){const u=this.data.datasets[s];if(!u)return!1;const _=this.getDatasetMeta(s);return typeof _.hidden=="boolean"?!_.hidden:!u.hidden}setDatasetVisibility(s,u){const _=this.getDatasetMeta(s);_.hidden=!u}toggleDataVisibility(s){this._hiddenIndices[s]=!this._hiddenIndices[s]}getDataVisibility(s){return!this._hiddenIndices[s]}_updateVisibility(s,u,_){const v=_?"show":"hide",E=this.getDatasetMeta(s),A=E.controller._resolveAnimations(void 0,v);AT(u)?(E.data[u].hidden=!_,this.update()):(this.setDatasetVisibility(s,_),A.update(E,{visible:_}),this.update(r=>r.datasetIndex===s?v:void 0))}hide(s,u){this._updateVisibility(s,u,!1)}show(s,u){this._updateVisibility(s,u,!0)}_destroyDatasetMeta(s){const u=this._metasets[s];u&&u.controller&&u.controller._destroy(),delete this._metasets[s]}_stop(){let s,u;for(this.stop(),Mm.remove(this),s=0,u=this.data.datasets.length;s<u;++s)this._destroyDatasetMeta(s)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:s,ctx:u}=this;this._stop(),this.config.clearCache(),s&&(this.unbindEvents(),wP(s,u),this.platform.releaseContext(u),this.canvas=null,this.ctx=null),delete TA[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...s){return this.canvas.toDataURL(...s)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const s=this._listeners,u=this.platform,_=(E,A)=>{u.addEventListener(this,E,A),s[E]=A},v=(E,A,r)=>{E.offsetX=A,E.offsetY=r,this._eventHandler(E)};Xo(this.options.events,E=>_(E,v))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const s=this._responsiveListeners,u=this.platform,_=(L,N)=>{u.addEventListener(this,L,N),s[L]=N},v=(L,N)=>{s[L]&&(u.removeEventListener(this,L,N),delete s[L])},E=(L,N)=>{this.canvas&&this.resize(L,N)};let A;const r=()=>{v("attach",r),this.attached=!0,this.resize(),_("resize",E),_("detach",A)};A=()=>{this.attached=!1,v("resize",E),this._stop(),this._resize(0,0),_("attach",r)},u.isAttached(this.canvas)?r():A()}unbindEvents(){Xo(this._listeners,(s,u)=>{this.platform.removeEventListener(this,u,s)}),this._listeners={},Xo(this._responsiveListeners,(s,u)=>{this.platform.removeEventListener(this,u,s)}),this._responsiveListeners=void 0}updateHoverStyle(s,u,_){const v=_?"set":"remove";let E,A,r,L;for(u==="dataset"&&(E=this.getDatasetMeta(s[0].datasetIndex),E.controller["_"+v+"DatasetHoverStyle"]()),r=0,L=s.length;r<L;++r){A=s[r];const N=A&&this.getDatasetMeta(A.datasetIndex).controller;N&&N[v+"HoverStyle"](A.element,A.datasetIndex,A.index)}}getActiveElements(){return this._active||[]}setActiveElements(s){const u=this._active||[],_=s.map(({datasetIndex:E,index:A})=>{const r=this.getDatasetMeta(E);if(!r)throw new Error("No dataset found at index "+E);return{datasetIndex:E,element:r.data[A],index:A}});!MA(_,u)&&(this._active=_,this._lastEvent=null,this._updateHoverStyles(_,u))}notifyPlugins(s,u,_){return this._plugins.notify(this,s,u,_)}isPluginEnabled(s){return this._plugins._cache.filter(u=>u.plugin.id===s).length===1}_updateHoverStyles(s,u,_){const v=this.options.hover,E=(L,N)=>L.filter(H=>!N.some(X=>H.datasetIndex===X.datasetIndex&&H.index===X.index)),A=E(u,s),r=_?s:E(s,u);A.length&&this.updateHoverStyle(A,v.mode,!1),r.length&&v.mode&&this.updateHoverStyle(r,v.mode,!0)}_eventHandler(s,u){const _={event:s,replay:u,cancelable:!0,inChartArea:this.isPointInArea(s)},v=A=>(A.options.events||this.options.events).includes(s.native.type);if(this.notifyPlugins("beforeEvent",_,v)===!1)return;const E=this._handleEvent(s,u,_.inChartArea);return _.cancelable=!1,this.notifyPlugins("afterEvent",_,v),(E||_.changed)&&this.render(),this}_handleEvent(s,u,_){const{_active:v=[],options:E}=this,A=u,r=this._getActiveElements(s,v,_,A),L=qB(s),N=$U(s,this._lastEvent,_,L);_&&(this._lastEvent=null,pa(E.onHover,[s,r,this],this),L&&pa(E.onClick,[s,r,this],this));const H=!MA(r,v);return(H||u)&&(this._active=r,this._updateHoverStyles(r,v,u)),this._lastEvent=N,H}_getActiveElements(s,u,_,v){if(s.type==="mouseout")return[];if(!_)return u;const E=this.options.hover;return this.getElementsAtEventForMode(s,E.mode,E,v)}},Ln(C_,"defaults",rs),Ln(C_,"instances",TA),Ln(C_,"overrides",Yv),Ln(C_,"registry",op),Ln(C_,"version",UU),Ln(C_,"getChart",iO),C_);function nO(){return Xo(gD.instances,d=>d._plugins.invalidate())}function WU(d,s,u){const{startAngle:_,x:v,y:E,outerRadius:A,innerRadius:r,options:L}=s,{borderWidth:N,borderJoinStyle:H}=L,X=Math.min(N/A,Ud(_-u));if(d.beginPath(),d.arc(v,E,A-N/2,_+X/2,u-X/2),r>0){const re=Math.min(N/r,Ud(_-u));d.arc(v,E,r+N/2,u-re/2,_+re/2,!0)}else{const re=Math.min(N/2,A*Ud(_-u));if(H==="round")d.arc(v,E,re,u-Ra/2,_+Ra/2,!0);else if(H==="bevel"){const he=2*re*re,de=-he*Math.cos(u+Ra/2)+v,ve=-he*Math.sin(u+Ra/2)+E,xe=he*Math.cos(_+Ra/2)+v,$e=he*Math.sin(_+Ra/2)+E;d.lineTo(de,ve),d.lineTo(xe,$e)}}d.closePath(),d.moveTo(0,0),d.rect(0,0,d.canvas.width,d.canvas.height),d.clip("evenodd")}function qU(d,s,u){const{startAngle:_,pixelMargin:v,x:E,y:A,outerRadius:r,innerRadius:L}=s;let N=v/r;d.beginPath(),d.arc(E,A,r,_-N,u+N),L>v?(N=v/L,d.arc(E,A,L,u+N,_-N,!0)):d.arc(E,A,v,u+Ol,_-Ol),d.closePath(),d.clip()}function ZU(d){return cD(d,["outerStart","outerEnd","innerStart","innerEnd"])}function XU(d,s,u,_){const v=ZU(d.options.borderRadius),E=(u-s)/2,A=Math.min(E,_*s/2),r=L=>{const N=(u-Math.min(E,L))*_/2;return ec(L,0,Math.min(E,N))};return{outerStart:r(v.outerStart),outerEnd:r(v.outerEnd),innerStart:ec(v.innerStart,0,A),innerEnd:ec(v.innerEnd,0,A)}}function yb(d,s,u,_){return{x:u+d*Math.cos(s),y:_+d*Math.sin(s)}}function NA(d,s,u,_,v,E){const{x:A,y:r,startAngle:L,pixelMargin:N,innerRadius:H}=s,X=Math.max(s.outerRadius+_+u-N,0),re=H>0?H+_+u+N:0;let he=0;const de=v-L;if(_){const Qt=H>0?H-_:0,_t=X>0?X-_:0,Et=(Qt+_t)/2,fi=Et!==0?de*Et/(Et+_):de;he=(de-fi)/2}const ve=Math.max(.001,de*X-u/Ra)/X,xe=(de-ve)/2,$e=L+xe+he,Le=v-xe-he,{outerStart:Ke,outerEnd:Ge,innerStart:Ye,innerEnd:mt}=XU(s,re,X,Le-$e),Ct=X-Ke,Vt=X-Ge,ui=$e+Ke/Ct,Di=Le-Ge/Vt,si=re+Ye,di=re+mt,Nt=$e+Ye/si,Ii=Le-mt/di;if(d.beginPath(),E){const Qt=(ui+Di)/2;if(d.arc(A,r,X,ui,Qt),d.arc(A,r,X,Qt,Di),Ge>0){const rn=yb(Vt,Di,A,r);d.arc(rn.x,rn.y,Ge,Di,Le+Ol)}const _t=yb(di,Le,A,r);if(d.lineTo(_t.x,_t.y),mt>0){const rn=yb(di,Ii,A,r);d.arc(rn.x,rn.y,mt,Le+Ol,Ii+Math.PI)}const Et=(Le-mt/re+($e+Ye/re))/2;if(d.arc(A,r,re,Le-mt/re,Et,!0),d.arc(A,r,re,Et,$e+Ye/re,!0),Ye>0){const rn=yb(si,Nt,A,r);d.arc(rn.x,rn.y,Ye,Nt+Math.PI,$e-Ol)}const fi=yb(Ct,$e,A,r);if(d.lineTo(fi.x,fi.y),Ke>0){const rn=yb(Ct,ui,A,r);d.arc(rn.x,rn.y,Ke,$e-Ol,ui)}}else{d.moveTo(A,r);const Qt=Math.cos(ui)*X+A,_t=Math.sin(ui)*X+r;d.lineTo(Qt,_t);const Et=Math.cos(Di)*X+A,fi=Math.sin(Di)*X+r;d.lineTo(Et,fi)}d.closePath()}function YU(d,s,u,_,v){const{fullCircles:E,startAngle:A,circumference:r}=s;let L=s.endAngle;if(E){NA(d,s,u,_,L,v);for(let N=0;N<E;++N)d.fill();isNaN(r)||(L=A+(r%kl||kl))}return NA(d,s,u,_,L,v),d.fill(),L}function KU(d,s,u,_,v){const{fullCircles:E,startAngle:A,circumference:r,options:L}=s,{borderWidth:N,borderJoinStyle:H,borderDash:X,borderDashOffset:re,borderRadius:he}=L,de=L.borderAlign==="inner";if(!N)return;d.setLineDash(X||[]),d.lineDashOffset=re,de?(d.lineWidth=N*2,d.lineJoin=H||"round"):(d.lineWidth=N,d.lineJoin=H||"bevel");let ve=s.endAngle;if(E){NA(d,s,u,_,ve,v);for(let xe=0;xe<E;++xe)d.stroke();isNaN(r)||(ve=A+(r%kl||kl))}de&&qU(d,s,ve),L.selfJoin&&ve-A>=Ra&&he===0&&H!=="miter"&&WU(d,s,ve),E||(NA(d,s,u,_,ve,v),d.stroke())}class sT extends up{constructor(u){super();Ln(this,"circumference");Ln(this,"endAngle");Ln(this,"fullCircles");Ln(this,"innerRadius");Ln(this,"outerRadius");Ln(this,"pixelMargin");Ln(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,u&&Object.assign(this,u)}inRange(u,_,v){const E=this.getProps(["x","y"],v),{angle:A,distance:r}=z2(E,{x:u,y:_}),{startAngle:L,endAngle:N,innerRadius:H,outerRadius:X,circumference:re}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],v),he=(this.options.spacing+this.options.borderWidth)/2,de=Jr(re,N-L),ve=rD(A,L,N)&&L!==N,xe=de>=kl||ve,$e=M_(r,H+he,X+he);return xe&&$e}getCenterPoint(u){const{x:_,y:v,startAngle:E,endAngle:A,innerRadius:r,outerRadius:L}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],u),{offset:N,spacing:H}=this.options,X=(E+A)/2,re=(r+L+H+N)/2;return{x:_+Math.cos(X)*re,y:v+Math.sin(X)*re}}tooltipPosition(u){return this.getCenterPoint(u)}draw(u){const{options:_,circumference:v}=this,E=(_.offset||0)/4,A=(_.spacing||0)/2,r=_.circular;if(this.pixelMargin=_.borderAlign==="inner"?.33:0,this.fullCircles=v>kl?Math.floor(v/kl):0,v===0||this.innerRadius<0||this.outerRadius<0)return;u.save();const L=(this.startAngle+this.endAngle)/2;u.translate(Math.cos(L)*E,Math.sin(L)*E);const N=1-Math.sin(Math.min(Ra,v||0)),H=E*N;u.fillStyle=_.backgroundColor,u.strokeStyle=_.borderColor,YU(u,this,H,A,r),KU(u,this,H,A,r),u.restore()}}Ln(sT,"id","arc"),Ln(sT,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),Ln(sT,"defaultRoutes",{backgroundColor:"backgroundColor"}),Ln(sT,"descriptors",{_scriptable:!0,_indexable:u=>u!=="borderDash"});function fk(d,s,u=s){d.lineCap=Jr(u.borderCapStyle,s.borderCapStyle),d.setLineDash(Jr(u.borderDash,s.borderDash)),d.lineDashOffset=Jr(u.borderDashOffset,s.borderDashOffset),d.lineJoin=Jr(u.borderJoinStyle,s.borderJoinStyle),d.lineWidth=Jr(u.borderWidth,s.borderWidth),d.strokeStyle=Jr(u.borderColor,s.borderColor)}function JU(d,s,u){d.lineTo(u.x,u.y)}function QU(d){return d.stepped?x5:d.tension||d.cubicInterpolationMode==="monotone"?b5:JU}function pk(d,s,u={}){const _=d.length,{start:v=0,end:E=_-1}=u,{start:A,end:r}=s,L=Math.max(v,A),N=Math.min(E,r),H=v<A&&E<A||v>r&&E>r;return{count:_,start:L,loop:s.loop,ilen:N<L&&!H?_+N-L:N-L}}function ej(d,s,u,_){const{points:v,options:E}=s,{count:A,start:r,loop:L,ilen:N}=pk(v,u,_),H=QU(E);let{move:X=!0,reverse:re}=_||{},he,de,ve;for(he=0;he<=N;++he)de=v[(r+(re?N-he:he))%A],!de.skip&&(X?(d.moveTo(de.x,de.y),X=!1):H(d,ve,de,re,E.stepped),ve=de);return L&&(de=v[(r+(re?N:0))%A],H(d,ve,de,re,E.stepped)),!!L}function tj(d,s,u,_){const v=s.points,{count:E,start:A,ilen:r}=pk(v,u,_),{move:L=!0,reverse:N}=_||{};let H=0,X=0,re,he,de,ve,xe,$e;const Le=Ge=>(A+(N?r-Ge:Ge))%E,Ke=()=>{ve!==xe&&(d.lineTo(H,xe),d.lineTo(H,ve),d.lineTo(H,$e))};for(L&&(he=v[Le(0)],d.moveTo(he.x,he.y)),re=0;re<=r;++re){if(he=v[Le(re)],he.skip)continue;const Ge=he.x,Ye=he.y,mt=Ge|0;mt===de?(Ye<ve?ve=Ye:Ye>xe&&(xe=Ye),H=(X*H+Ge)/++X):(Ke(),d.lineTo(Ge,Ye),de=mt,X=0,ve=xe=Ye),$e=Ye}Ke()}function RR(d){const s=d.options,u=s.borderDash&&s.borderDash.length;return!d._decimated&&!d._loop&&!s.tension&&s.cubicInterpolationMode!=="monotone"&&!s.stepped&&!u?tj:ej}function ij(d){return d.stepped?Q5:d.tension||d.cubicInterpolationMode==="monotone"?eV:Vv}function nj(d,s,u,_){let v=s._path;v||(v=s._path=new Path2D,s.path(v,u,_)&&v.closePath()),fk(d,s.options),d.stroke(v)}function rj(d,s,u,_){const{segments:v,options:E}=s,A=RR(s);for(const r of v)fk(d,E,r.style),d.beginPath(),A(d,s,r,{start:u,end:u+_-1})&&d.closePath(),d.stroke()}const oj=typeof Path2D=="function";function aj(d,s,u,_){oj&&!s.options.segment?nj(d,s,u,_):rj(d,s,u,_)}class lT extends up{constructor(s){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,s&&Object.assign(this,s)}updateControlPoints(s,u){const _=this.options;if((_.tension||_.cubicInterpolationMode==="monotone")&&!_.stepped&&!this._pointsUpdated){const v=_.spanGaps?this._loop:this._fullLoop;$5(this._points,_,s,v,u),this._pointsUpdated=!0}}set points(s){this._points=s,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=lV(this,this.options.segment))}first(){const s=this.segments,u=this.points;return s.length&&u[s[0].start]}last(){const s=this.segments,u=this.points,_=s.length;return _&&u[s[_-1].end]}interpolate(s,u){const _=this.options,v=s[u],E=this.points,A=oV(this,{property:u,start:v,end:v});if(!A.length)return;const r=[],L=ij(_);let N,H;for(N=0,H=A.length;N<H;++N){const{start:X,end:re}=A[N],he=E[X],de=E[re];if(he===de){r.push(he);continue}const ve=Math.abs((v-he[u])/(de[u]-he[u])),xe=L(he,de,ve,_.stepped);xe[u]=s[u],r.push(xe)}return r.length===1?r[0]:r}pathSegment(s,u,_){return RR(this)(s,this,u,_)}path(s,u,_){const v=this.segments,E=RR(this);let A=this._loop;u=u||0,_=_||this.points.length-u;for(const r of v)A&=E(s,this,r,{start:u,end:u+_-1});return!!A}draw(s,u,_,v){const E=this.options||{};(this.points||[]).length&&E.borderWidth&&(s.save(),aj(s,this,_,v),s.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}Ln(lT,"id","line"),Ln(lT,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),Ln(lT,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),Ln(lT,"descriptors",{_scriptable:!0,_indexable:s=>s!=="borderDash"&&s!=="fill"});function rO(d,s,u,_){const v=d.options,{[u]:E}=d.getProps([u],_);return Math.abs(s-E)<v.radius+v.hitRadius}class gT extends up{constructor(u){super();Ln(this,"parsed");Ln(this,"skip");Ln(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,u&&Object.assign(this,u)}inRange(u,_,v){const E=this.options,{x:A,y:r}=this.getProps(["x","y"],v);return Math.pow(u-A,2)+Math.pow(_-r,2)<Math.pow(E.hitRadius+E.radius,2)}inXRange(u,_){return rO(this,u,"x",_)}inYRange(u,_){return rO(this,u,"y",_)}getCenterPoint(u){const{x:_,y:v}=this.getProps(["x","y"],u);return{x:_,y:v}}size(u){u=u||this.options||{};let _=u.radius||0;_=Math.max(_,_&&u.hoverRadius||0);const v=_&&u.borderWidth||0;return(_+v)*2}draw(u,_){const v=this.options;this.skip||v.radius<.1||!IT(this,_,this.size(v)/2)||(u.strokeStyle=v.borderColor,u.lineWidth=v.borderWidth,u.fillStyle=v.backgroundColor,AR(u,v,this.x,this.y))}getRange(){const u=this.options||{};return u.radius+u.hitRadius}}Ln(gT,"id","point"),Ln(gT,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),Ln(gT,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function mk(d,s){const{x:u,y:_,base:v,width:E,height:A}=d.getProps(["x","y","base","width","height"],s);let r,L,N,H,X;return d.horizontal?(X=A/2,r=Math.min(u,v),L=Math.max(u,v),N=_-X,H=_+X):(X=E/2,r=u-X,L=u+X,N=Math.min(_,v),H=Math.max(_,v)),{left:r,top:N,right:L,bottom:H}}function k_(d,s,u,_){return d?0:ec(s,u,_)}function sj(d,s,u){const _=d.options.borderWidth,v=d.borderSkipped,E=W2(_);return{t:k_(v.top,E.top,0,u),r:k_(v.right,E.right,0,s),b:k_(v.bottom,E.bottom,0,u),l:k_(v.left,E.left,0,s)}}function lj(d,s,u){const{enableBorderRadius:_}=d.getProps(["enableBorderRadius"]),v=d.options.borderRadius,E=Tb(v),A=Math.min(s,u),r=d.borderSkipped,L=_||Po(v);return{topLeft:k_(!L||r.top||r.left,E.topLeft,0,A),topRight:k_(!L||r.top||r.right,E.topRight,0,A),bottomLeft:k_(!L||r.bottom||r.left,E.bottomLeft,0,A),bottomRight:k_(!L||r.bottom||r.right,E.bottomRight,0,A)}}function cj(d){const s=mk(d),u=s.right-s.left,_=s.bottom-s.top,v=sj(d,u/2,_/2),E=lj(d,u/2,_/2);return{outer:{x:s.left,y:s.top,w:u,h:_,radius:E},inner:{x:s.left+v.l,y:s.top+v.t,w:u-v.l-v.r,h:_-v.t-v.b,radius:{topLeft:Math.max(0,E.topLeft-Math.max(v.t,v.l)),topRight:Math.max(0,E.topRight-Math.max(v.t,v.r)),bottomLeft:Math.max(0,E.bottomLeft-Math.max(v.b,v.l)),bottomRight:Math.max(0,E.bottomRight-Math.max(v.b,v.r))}}}}function lR(d,s,u,_){const v=s===null,E=u===null,r=d&&!(v&&E)&&mk(d,_);return r&&(v||M_(s,r.left,r.right))&&(E||M_(u,r.top,r.bottom))}function uj(d){return d.topLeft||d.topRight||d.bottomLeft||d.bottomRight}function hj(d,s){d.rect(s.x,s.y,s.w,s.h)}function cR(d,s,u={}){const _=d.x!==u.x?-s:0,v=d.y!==u.y?-s:0,E=(d.x+d.w!==u.x+u.w?s:0)-_,A=(d.y+d.h!==u.y+u.h?s:0)-v;return{x:d.x+_,y:d.y+v,w:d.w+E,h:d.h+A,radius:d.radius}}class _T extends up{constructor(s){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,s&&Object.assign(this,s)}draw(s){const{inflateAmount:u,options:{borderColor:_,backgroundColor:v}}=this,{inner:E,outer:A}=cj(this),r=uj(A.radius)?FA:hj;s.save(),(A.w!==E.w||A.h!==E.h)&&(s.beginPath(),r(s,cR(A,u,E)),s.clip(),r(s,cR(E,-u,A)),s.fillStyle=_,s.fill("evenodd")),s.beginPath(),r(s,cR(E,u)),s.fillStyle=v,s.fill(),s.restore()}inRange(s,u,_){return lR(this,s,u,_)}inXRange(s,u){return lR(this,s,null,u)}inYRange(s,u){return lR(this,null,s,u)}getCenterPoint(s){const{x:u,y:_,base:v,horizontal:E}=this.getProps(["x","y","base","horizontal"],s);return{x:E?(u+v)/2:u,y:E?_:(_+v)/2}}getRange(s){return s==="x"?this.width/2:this.height/2}}Ln(_T,"id","bar"),Ln(_T,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),Ln(_T,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const oO=(d,s)=>{let{boxHeight:u=s,boxWidth:_=s}=d;return d.usePointStyle&&(u=Math.min(u,s),_=d.pointStyleWidth||Math.min(_,s)),{boxWidth:_,boxHeight:u,itemHeight:Math.max(s,u)}},dj=(d,s)=>d!==null&&s!==null&&d.datasetIndex===s.datasetIndex&&d.index===s.index;class aO extends up{constructor(s){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,u,_){this.maxWidth=s,this.maxHeight=u,this._margins=_,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const s=this.options.labels||{};let u=pa(s.generateLabels,[this.chart],this)||[];s.filter&&(u=u.filter(_=>s.filter(_,this.chart.data))),s.sort&&(u=u.sort((_,v)=>s.sort(_,v,this.chart.data))),this.options.reverse&&u.reverse(),this.legendItems=u}fit(){const{options:s,ctx:u}=this;if(!s.display){this.width=this.height=0;return}const _=s.labels,v=Cc(_.font),E=v.size,A=this._computeTitleHeight(),{boxWidth:r,itemHeight:L}=oO(_,E);let N,H;u.font=v.string,this.isHorizontal()?(N=this.maxWidth,H=this._fitRows(A,E,r,L)+10):(H=this.maxHeight,N=this._fitCols(A,v,r,L)+10),this.width=Math.min(N,s.maxWidth||this.maxWidth),this.height=Math.min(H,s.maxHeight||this.maxHeight)}_fitRows(s,u,_,v){const{ctx:E,maxWidth:A,options:{labels:{padding:r}}}=this,L=this.legendHitBoxes=[],N=this.lineWidths=[0],H=v+r;let X=s;E.textAlign="left",E.textBaseline="middle";let re=-1,he=-H;return this.legendItems.forEach((de,ve)=>{const xe=_+u/2+E.measureText(de.text).width;(ve===0||N[N.length-1]+xe+2*r>A)&&(X+=H,N[N.length-(ve>0?0:1)]=0,he+=H,re++),L[ve]={left:0,top:he,row:re,width:xe,height:v},N[N.length-1]+=xe+r}),X}_fitCols(s,u,_,v){const{ctx:E,maxHeight:A,options:{labels:{padding:r}}}=this,L=this.legendHitBoxes=[],N=this.columnSizes=[],H=A-s;let X=r,re=0,he=0,de=0,ve=0;return this.legendItems.forEach((xe,$e)=>{const{itemWidth:Le,itemHeight:Ke}=fj(_,u,E,xe,v);$e>0&&he+Ke+2*r>H&&(X+=re+r,N.push({width:re,height:he}),de+=re+r,ve++,re=he=0),L[$e]={left:de,top:he,col:ve,width:Le,height:Ke},re=Math.max(re,Le),he+=Ke+r}),X+=re,N.push({width:re,height:he}),X}adjustHitBoxes(){if(!this.options.display)return;const s=this._computeTitleHeight(),{legendHitBoxes:u,options:{align:_,labels:{padding:v},rtl:E}}=this,A=Sb(E,this.left,this.width);if(this.isHorizontal()){let r=0,L=lh(_,this.left+v,this.right-this.lineWidths[r]);for(const N of u)r!==N.row&&(r=N.row,L=lh(_,this.left+v,this.right-this.lineWidths[r])),N.top+=this.top+s+v,N.left=A.leftForLtr(A.x(L),N.width),L+=N.width+v}else{let r=0,L=lh(_,this.top+s+v,this.bottom-this.columnSizes[r].height);for(const N of u)N.col!==r&&(r=N.col,L=lh(_,this.top+s+v,this.bottom-this.columnSizes[r].height)),N.top=L,N.left+=this.left+v,N.left=A.leftForLtr(A.x(N.left),N.width),L+=N.height+v}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const s=this.ctx;sD(s,this),this._draw(),lD(s)}}_draw(){const{options:s,columnSizes:u,lineWidths:_,ctx:v}=this,{align:E,labels:A}=s,r=rs.color,L=Sb(s.rtl,this.left,this.width),N=Cc(A.font),{padding:H}=A,X=N.size,re=X/2;let he;this.drawTitle(),v.textAlign=L.textAlign("left"),v.textBaseline="middle",v.lineWidth=.5,v.font=N.string;const{boxWidth:de,boxHeight:ve,itemHeight:xe}=oO(A,X),$e=function(mt,Ct,Vt){if(isNaN(de)||de<=0||isNaN(ve)||ve<0)return;v.save();const ui=Jr(Vt.lineWidth,1);if(v.fillStyle=Jr(Vt.fillStyle,r),v.lineCap=Jr(Vt.lineCap,"butt"),v.lineDashOffset=Jr(Vt.lineDashOffset,0),v.lineJoin=Jr(Vt.lineJoin,"miter"),v.lineWidth=ui,v.strokeStyle=Jr(Vt.strokeStyle,r),v.setLineDash(Jr(Vt.lineDash,[])),A.usePointStyle){const Di={radius:ve*Math.SQRT2/2,pointStyle:Vt.pointStyle,rotation:Vt.rotation,borderWidth:ui},si=L.xPlus(mt,de/2),di=Ct+re;$2(v,Di,si,di,A.pointStyleWidth&&de)}else{const Di=Ct+Math.max((X-ve)/2,0),si=L.leftForLtr(mt,de),di=Tb(Vt.borderRadius);v.beginPath(),Object.values(di).some(Nt=>Nt!==0)?FA(v,{x:si,y:Di,w:de,h:ve,radius:di}):v.rect(si,Di,de,ve),v.fill(),ui!==0&&v.stroke()}v.restore()},Le=function(mt,Ct,Vt){kA(v,Vt.text,mt,Ct+xe/2,N,{strikethrough:Vt.hidden,textAlign:L.textAlign(Vt.textAlign)})},Ke=this.isHorizontal(),Ge=this._computeTitleHeight();Ke?he={x:lh(E,this.left+H,this.right-_[0]),y:this.top+H+Ge,line:0}:he={x:this.left+H,y:lh(E,this.top+Ge+H,this.bottom-u[0].height),line:0},J2(this.ctx,s.textDirection);const Ye=xe+H;this.legendItems.forEach((mt,Ct)=>{v.strokeStyle=mt.fontColor,v.fillStyle=mt.fontColor;const Vt=v.measureText(mt.text).width,ui=L.textAlign(mt.textAlign||(mt.textAlign=A.textAlign)),Di=de+re+Vt;let si=he.x,di=he.y;L.setWidth(this.width),Ke?Ct>0&&si+Di+H>this.right&&(di=he.y+=Ye,he.line++,si=he.x=lh(E,this.left+H,this.right-_[he.line])):Ct>0&&di+Ye>this.bottom&&(si=he.x=si+u[he.line].width+H,he.line++,di=he.y=lh(E,this.top+Ge+H,this.bottom-u[he.line].height));const Nt=L.x(si);if($e(Nt,di,mt),si=s5(ui,si+de+re,Ke?si+Di:this.right,s.rtl),Le(L.x(si),di,mt),Ke)he.x+=Di+H;else if(typeof mt.text!="string"){const Ii=N.lineHeight;he.y+=gk(mt,Ii)+H}else he.y+=Ye}),Q2(this.ctx,s.textDirection)}drawTitle(){const s=this.options,u=s.title,_=Cc(u.font),v=ad(u.padding);if(!u.display)return;const E=Sb(s.rtl,this.left,this.width),A=this.ctx,r=u.position,L=_.size/2,N=v.top+L;let H,X=this.left,re=this.width;if(this.isHorizontal())re=Math.max(...this.lineWidths),H=this.top+N,X=lh(s.align,X,this.right-re);else{const de=this.columnSizes.reduce((ve,xe)=>Math.max(ve,xe.height),0);H=N+lh(s.align,this.top,this.bottom-de-s.labels.padding-this._computeTitleHeight())}const he=lh(r,X,X+re);A.textAlign=E.textAlign(j2(r)),A.textBaseline="middle",A.strokeStyle=u.color,A.fillStyle=u.color,A.font=_.string,kA(A,u.text,he,H,_)}_computeTitleHeight(){const s=this.options.title,u=Cc(s.font),_=ad(s.padding);return s.display?u.lineHeight+_.height:0}_getLegendItemAt(s,u){let _,v,E;if(M_(s,this.left,this.right)&&M_(u,this.top,this.bottom)){for(E=this.legendHitBoxes,_=0;_<E.length;++_)if(v=E[_],M_(s,v.left,v.left+v.width)&&M_(u,v.top,v.top+v.height))return this.legendItems[_]}return null}handleEvent(s){const u=this.options;if(!gj(s.type,u))return;const _=this._getLegendItemAt(s.x,s.y);if(s.type==="mousemove"||s.type==="mouseout"){const v=this._hoveredItem,E=dj(v,_);v&&!E&&pa(u.onLeave,[s,v,this],this),this._hoveredItem=_,_&&!E&&pa(u.onHover,[s,_,this],this)}else _&&pa(u.onClick,[s,_,this],this)}}function fj(d,s,u,_,v){const E=pj(_,d,s,u),A=mj(v,_,s.lineHeight);return{itemWidth:E,itemHeight:A}}function pj(d,s,u,_){let v=d.text;return v&&typeof v!="string"&&(v=v.reduce((E,A)=>E.length>A.length?E:A)),s+u.size/2+_.measureText(v).width}function mj(d,s,u){let _=d;return typeof s.text!="string"&&(_=gk(s,u)),_}function gk(d,s){const u=d.text?d.text.length:0;return s*u}function gj(d,s){return!!((d==="mousemove"||d==="mouseout")&&(s.onHover||s.onLeave)||s.onClick&&(d==="click"||d==="mouseup"))}var _j={id:"legend",_element:aO,start(d,s,u){const _=d.legend=new aO({ctx:d.ctx,options:u,chart:d});O_.configure(d,_,u),O_.addBox(d,_)},stop(d){O_.removeBox(d,d.legend),delete d.legend},beforeUpdate(d,s,u){const _=d.legend;O_.configure(d,_,u),_.options=u},afterUpdate(d){const s=d.legend;s.buildLabels(),s.adjustHitBoxes()},afterEvent(d,s){s.replay||d.legend.handleEvent(s.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(d,s,u){const _=s.datasetIndex,v=u.chart;v.isDatasetVisible(_)?(v.hide(_),s.hidden=!0):(v.show(_),s.hidden=!1)},onHover:null,onLeave:null,labels:{color:d=>d.chart.options.color,boxWidth:40,padding:10,generateLabels(d){const s=d.data.datasets,{labels:{usePointStyle:u,pointStyle:_,textAlign:v,color:E,useBorderRadius:A,borderRadius:r}}=d.legend.options;return d._getSortedDatasetMetas().map(L=>{const N=L.controller.getStyle(u?0:void 0),H=ad(N.borderWidth);return{text:s[L.index].label,fillStyle:N.backgroundColor,fontColor:E,hidden:!L.visible,lineCap:N.borderCapStyle,lineDash:N.borderDash,lineDashOffset:N.borderDashOffset,lineJoin:N.borderJoinStyle,lineWidth:(H.width+H.height)/4,strokeStyle:N.borderColor,pointStyle:_||N.pointStyle,rotation:N.rotation,textAlign:v||N.textAlign,borderRadius:A&&(r||N.borderRadius),datasetIndex:L.index}},this)}},title:{color:d=>d.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:d=>!d.startsWith("on"),labels:{_scriptable:d=>!["generateLabels","filter","sort"].includes(d)}}};const cT={average(d){if(!d.length)return!1;let s,u,_=new Set,v=0,E=0;for(s=0,u=d.length;s<u;++s){const r=d[s].element;if(r&&r.hasValue()){const L=r.tooltipPosition();_.add(L.x),v+=L.y,++E}}return E===0||_.size===0?!1:{x:[..._].reduce((r,L)=>r+L)/_.size,y:v/E}},nearest(d,s){if(!d.length)return!1;let u=s.x,_=s.y,v=Number.POSITIVE_INFINITY,E,A,r;for(E=0,A=d.length;E<A;++E){const L=d[E].element;if(L&&L.hasValue()){const N=L.getCenterPoint(),H=SR(s,N);H<v&&(v=H,r=L)}}if(r){const L=r.tooltipPosition();u=L.x,_=L.y}return{x:u,y:_}}};function rp(d,s){return s&&(Ys(s)?Array.prototype.push.apply(d,s):d.push(s)),d}function Pm(d){return(typeof d=="string"||d instanceof String)&&d.indexOf(`
`)>-1?d.split(`
`):d}function yj(d,s){const{element:u,datasetIndex:_,index:v}=s,E=d.getDatasetMeta(_).controller,{label:A,value:r}=E.getLabelAndValue(v);return{chart:d,label:A,parsed:E.getParsed(v),raw:d.data.datasets[_].data[v],formattedValue:r,dataset:E.getDataset(),dataIndex:v,datasetIndex:_,element:u}}function sO(d,s){const u=d.chart.ctx,{body:_,footer:v,title:E}=d,{boxWidth:A,boxHeight:r}=s,L=Cc(s.bodyFont),N=Cc(s.titleFont),H=Cc(s.footerFont),X=E.length,re=v.length,he=_.length,de=ad(s.padding);let ve=de.height,xe=0,$e=_.reduce((Ge,Ye)=>Ge+Ye.before.length+Ye.lines.length+Ye.after.length,0);if($e+=d.beforeBody.length+d.afterBody.length,X&&(ve+=X*N.lineHeight+(X-1)*s.titleSpacing+s.titleMarginBottom),$e){const Ge=s.displayColors?Math.max(r,L.lineHeight):L.lineHeight;ve+=he*Ge+($e-he)*L.lineHeight+($e-1)*s.bodySpacing}re&&(ve+=s.footerMarginTop+re*H.lineHeight+(re-1)*s.footerSpacing);let Le=0;const Ke=function(Ge){xe=Math.max(xe,u.measureText(Ge).width+Le)};return u.save(),u.font=N.string,Xo(d.title,Ke),u.font=L.string,Xo(d.beforeBody.concat(d.afterBody),Ke),Le=s.displayColors?A+2+s.boxPadding:0,Xo(_,Ge=>{Xo(Ge.before,Ke),Xo(Ge.lines,Ke),Xo(Ge.after,Ke)}),Le=0,u.font=H.string,Xo(d.footer,Ke),u.restore(),xe+=de.width,{width:xe,height:ve}}function vj(d,s){const{y:u,height:_}=s;return u<_/2?"top":u>d.height-_/2?"bottom":"center"}function xj(d,s,u,_){const{x:v,width:E}=_,A=u.caretSize+u.caretPadding;if(d==="left"&&v+E+A>s.width||d==="right"&&v-E-A<0)return!0}function bj(d,s,u,_){const{x:v,width:E}=u,{width:A,chartArea:{left:r,right:L}}=d;let N="center";return _==="center"?N=v<=(r+L)/2?"left":"right":v<=E/2?N="left":v>=A-E/2&&(N="right"),xj(N,d,s,u)&&(N="center"),N}function lO(d,s,u){const _=u.yAlign||s.yAlign||vj(d,u);return{xAlign:u.xAlign||s.xAlign||bj(d,s,u,_),yAlign:_}}function wj(d,s){let{x:u,width:_}=d;return s==="right"?u-=_:s==="center"&&(u-=_/2),u}function Tj(d,s,u){let{y:_,height:v}=d;return s==="top"?_+=u:s==="bottom"?_-=v+u:_-=v/2,_}function cO(d,s,u,_){const{caretSize:v,caretPadding:E,cornerRadius:A}=d,{xAlign:r,yAlign:L}=u,N=v+E,{topLeft:H,topRight:X,bottomLeft:re,bottomRight:he}=Tb(A);let de=wj(s,r);const ve=Tj(s,L,N);return L==="center"?r==="left"?de+=N:r==="right"&&(de-=N):r==="left"?de-=Math.max(H,re)+v:r==="right"&&(de+=Math.max(X,he)+v),{x:ec(de,0,_.width-s.width),y:ec(ve,0,_.height-s.height)}}function cA(d,s,u){const _=ad(u.padding);return s==="center"?d.x+d.width/2:s==="right"?d.x+d.width-_.right:d.x+_.left}function uO(d){return rp([],Pm(d))}function Sj(d,s,u){return Qv(d,{tooltip:s,tooltipItems:u,type:"tooltip"})}function hO(d,s){const u=s&&s.dataset&&s.dataset.tooltip&&s.dataset.tooltip.callbacks;return u?d.override(u):d}const _k={beforeTitle:Dm,title(d){if(d.length>0){const s=d[0],u=s.chart.data.labels,_=u?u.length:0;if(this&&this.options&&this.options.mode==="dataset")return s.dataset.label||"";if(s.label)return s.label;if(_>0&&s.dataIndex<_)return u[s.dataIndex]}return""},afterTitle:Dm,beforeBody:Dm,beforeLabel:Dm,label(d){if(this&&this.options&&this.options.mode==="dataset")return d.label+": "+d.formattedValue||d.formattedValue;let s=d.dataset.label||"";s&&(s+=": ");const u=d.formattedValue;return wo(u)||(s+=u),s},labelColor(d){const u=d.chart.getDatasetMeta(d.datasetIndex).controller.getStyle(d.dataIndex);return{borderColor:u.borderColor,backgroundColor:u.backgroundColor,borderWidth:u.borderWidth,borderDash:u.borderDash,borderDashOffset:u.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(d){const u=d.chart.getDatasetMeta(d.datasetIndex).controller.getStyle(d.dataIndex);return{pointStyle:u.pointStyle,rotation:u.rotation}},afterLabel:Dm,afterBody:Dm,beforeFooter:Dm,footer:Dm,afterFooter:Dm};function mu(d,s,u,_){const v=d[s].call(u,_);return typeof v>"u"?_k[s].call(u,_):v}class DR extends up{constructor(s){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=s.chart,this.options=s.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(s){this.options=s,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const s=this._cachedAnimations;if(s)return s;const u=this.chart,_=this.options.setContext(this.getContext()),v=_.enabled&&u.options.animation&&_.animations,E=new tk(this.chart,v);return v._cacheable&&(this._cachedAnimations=Object.freeze(E)),E}getContext(){return this.$context||(this.$context=Sj(this.chart.getContext(),this,this._tooltipItems))}getTitle(s,u){const{callbacks:_}=u,v=mu(_,"beforeTitle",this,s),E=mu(_,"title",this,s),A=mu(_,"afterTitle",this,s);let r=[];return r=rp(r,Pm(v)),r=rp(r,Pm(E)),r=rp(r,Pm(A)),r}getBeforeBody(s,u){return uO(mu(u.callbacks,"beforeBody",this,s))}getBody(s,u){const{callbacks:_}=u,v=[];return Xo(s,E=>{const A={before:[],lines:[],after:[]},r=hO(_,E);rp(A.before,Pm(mu(r,"beforeLabel",this,E))),rp(A.lines,mu(r,"label",this,E)),rp(A.after,Pm(mu(r,"afterLabel",this,E))),v.push(A)}),v}getAfterBody(s,u){return uO(mu(u.callbacks,"afterBody",this,s))}getFooter(s,u){const{callbacks:_}=u,v=mu(_,"beforeFooter",this,s),E=mu(_,"footer",this,s),A=mu(_,"afterFooter",this,s);let r=[];return r=rp(r,Pm(v)),r=rp(r,Pm(E)),r=rp(r,Pm(A)),r}_createItems(s){const u=this._active,_=this.chart.data,v=[],E=[],A=[];let r=[],L,N;for(L=0,N=u.length;L<N;++L)r.push(yj(this.chart,u[L]));return s.filter&&(r=r.filter((H,X,re)=>s.filter(H,X,re,_))),s.itemSort&&(r=r.sort((H,X)=>s.itemSort(H,X,_))),Xo(r,H=>{const X=hO(s.callbacks,H);v.push(mu(X,"labelColor",this,H)),E.push(mu(X,"labelPointStyle",this,H)),A.push(mu(X,"labelTextColor",this,H))}),this.labelColors=v,this.labelPointStyles=E,this.labelTextColors=A,this.dataPoints=r,r}update(s,u){const _=this.options.setContext(this.getContext()),v=this._active;let E,A=[];if(!v.length)this.opacity!==0&&(E={opacity:0});else{const r=cT[_.position].call(this,v,this._eventPosition);A=this._createItems(_),this.title=this.getTitle(A,_),this.beforeBody=this.getBeforeBody(A,_),this.body=this.getBody(A,_),this.afterBody=this.getAfterBody(A,_),this.footer=this.getFooter(A,_);const L=this._size=sO(this,_),N=Object.assign({},r,L),H=lO(this.chart,_,N),X=cO(_,N,H,this.chart);this.xAlign=H.xAlign,this.yAlign=H.yAlign,E={opacity:1,x:X.x,y:X.y,width:L.width,height:L.height,caretX:r.x,caretY:r.y}}this._tooltipItems=A,this.$context=void 0,E&&this._resolveAnimations().update(this,E),s&&_.external&&_.external.call(this,{chart:this.chart,tooltip:this,replay:u})}drawCaret(s,u,_,v){const E=this.getCaretPosition(s,_,v);u.lineTo(E.x1,E.y1),u.lineTo(E.x2,E.y2),u.lineTo(E.x3,E.y3)}getCaretPosition(s,u,_){const{xAlign:v,yAlign:E}=this,{caretSize:A,cornerRadius:r}=_,{topLeft:L,topRight:N,bottomLeft:H,bottomRight:X}=Tb(r),{x:re,y:he}=s,{width:de,height:ve}=u;let xe,$e,Le,Ke,Ge,Ye;return E==="center"?(Ge=he+ve/2,v==="left"?(xe=re,$e=xe-A,Ke=Ge+A,Ye=Ge-A):(xe=re+de,$e=xe+A,Ke=Ge-A,Ye=Ge+A),Le=xe):(v==="left"?$e=re+Math.max(L,H)+A:v==="right"?$e=re+de-Math.max(N,X)-A:$e=this.caretX,E==="top"?(Ke=he,Ge=Ke-A,xe=$e-A,Le=$e+A):(Ke=he+ve,Ge=Ke+A,xe=$e+A,Le=$e-A),Ye=Ke),{x1:xe,x2:$e,x3:Le,y1:Ke,y2:Ge,y3:Ye}}drawTitle(s,u,_){const v=this.title,E=v.length;let A,r,L;if(E){const N=Sb(_.rtl,this.x,this.width);for(s.x=cA(this,_.titleAlign,_),u.textAlign=N.textAlign(_.titleAlign),u.textBaseline="middle",A=Cc(_.titleFont),r=_.titleSpacing,u.fillStyle=_.titleColor,u.font=A.string,L=0;L<E;++L)u.fillText(v[L],N.x(s.x),s.y+A.lineHeight/2),s.y+=A.lineHeight+r,L+1===E&&(s.y+=_.titleMarginBottom-r)}}_drawColorBox(s,u,_,v,E){const A=this.labelColors[_],r=this.labelPointStyles[_],{boxHeight:L,boxWidth:N}=E,H=Cc(E.bodyFont),X=cA(this,"left",E),re=v.x(X),he=L<H.lineHeight?(H.lineHeight-L)/2:0,de=u.y+he;if(E.usePointStyle){const ve={radius:Math.min(N,L)/2,pointStyle:r.pointStyle,rotation:r.rotation,borderWidth:1},xe=v.leftForLtr(re,N)+N/2,$e=de+L/2;s.strokeStyle=E.multiKeyBackground,s.fillStyle=E.multiKeyBackground,AR(s,ve,xe,$e),s.strokeStyle=A.borderColor,s.fillStyle=A.backgroundColor,AR(s,ve,xe,$e)}else{s.lineWidth=Po(A.borderWidth)?Math.max(...Object.values(A.borderWidth)):A.borderWidth||1,s.strokeStyle=A.borderColor,s.setLineDash(A.borderDash||[]),s.lineDashOffset=A.borderDashOffset||0;const ve=v.leftForLtr(re,N),xe=v.leftForLtr(v.xPlus(re,1),N-2),$e=Tb(A.borderRadius);Object.values($e).some(Le=>Le!==0)?(s.beginPath(),s.fillStyle=E.multiKeyBackground,FA(s,{x:ve,y:de,w:N,h:L,radius:$e}),s.fill(),s.stroke(),s.fillStyle=A.backgroundColor,s.beginPath(),FA(s,{x:xe,y:de+1,w:N-2,h:L-2,radius:$e}),s.fill()):(s.fillStyle=E.multiKeyBackground,s.fillRect(ve,de,N,L),s.strokeRect(ve,de,N,L),s.fillStyle=A.backgroundColor,s.fillRect(xe,de+1,N-2,L-2))}s.fillStyle=this.labelTextColors[_]}drawBody(s,u,_){const{body:v}=this,{bodySpacing:E,bodyAlign:A,displayColors:r,boxHeight:L,boxWidth:N,boxPadding:H}=_,X=Cc(_.bodyFont);let re=X.lineHeight,he=0;const de=Sb(_.rtl,this.x,this.width),ve=function(Vt){u.fillText(Vt,de.x(s.x+he),s.y+re/2),s.y+=re+E},xe=de.textAlign(A);let $e,Le,Ke,Ge,Ye,mt,Ct;for(u.textAlign=A,u.textBaseline="middle",u.font=X.string,s.x=cA(this,xe,_),u.fillStyle=_.bodyColor,Xo(this.beforeBody,ve),he=r&&xe!=="right"?A==="center"?N/2+H:N+2+H:0,Ge=0,mt=v.length;Ge<mt;++Ge){for($e=v[Ge],Le=this.labelTextColors[Ge],u.fillStyle=Le,Xo($e.before,ve),Ke=$e.lines,r&&Ke.length&&(this._drawColorBox(u,s,Ge,de,_),re=Math.max(X.lineHeight,L)),Ye=0,Ct=Ke.length;Ye<Ct;++Ye)ve(Ke[Ye]),re=X.lineHeight;Xo($e.after,ve)}he=0,re=X.lineHeight,Xo(this.afterBody,ve),s.y-=E}drawFooter(s,u,_){const v=this.footer,E=v.length;let A,r;if(E){const L=Sb(_.rtl,this.x,this.width);for(s.x=cA(this,_.footerAlign,_),s.y+=_.footerMarginTop,u.textAlign=L.textAlign(_.footerAlign),u.textBaseline="middle",A=Cc(_.footerFont),u.fillStyle=_.footerColor,u.font=A.string,r=0;r<E;++r)u.fillText(v[r],L.x(s.x),s.y+A.lineHeight/2),s.y+=A.lineHeight+_.footerSpacing}}drawBackground(s,u,_,v){const{xAlign:E,yAlign:A}=this,{x:r,y:L}=s,{width:N,height:H}=_,{topLeft:X,topRight:re,bottomLeft:he,bottomRight:de}=Tb(v.cornerRadius);u.fillStyle=v.backgroundColor,u.strokeStyle=v.borderColor,u.lineWidth=v.borderWidth,u.beginPath(),u.moveTo(r+X,L),A==="top"&&this.drawCaret(s,u,_,v),u.lineTo(r+N-re,L),u.quadraticCurveTo(r+N,L,r+N,L+re),A==="center"&&E==="right"&&this.drawCaret(s,u,_,v),u.lineTo(r+N,L+H-de),u.quadraticCurveTo(r+N,L+H,r+N-de,L+H),A==="bottom"&&this.drawCaret(s,u,_,v),u.lineTo(r+he,L+H),u.quadraticCurveTo(r,L+H,r,L+H-he),A==="center"&&E==="left"&&this.drawCaret(s,u,_,v),u.lineTo(r,L+X),u.quadraticCurveTo(r,L,r+X,L),u.closePath(),u.fill(),v.borderWidth>0&&u.stroke()}_updateAnimationTarget(s){const u=this.chart,_=this.$animations,v=_&&_.x,E=_&&_.y;if(v||E){const A=cT[s.position].call(this,this._active,this._eventPosition);if(!A)return;const r=this._size=sO(this,s),L=Object.assign({},A,this._size),N=lO(u,s,L),H=cO(s,L,N,u);(v._to!==H.x||E._to!==H.y)&&(this.xAlign=N.xAlign,this.yAlign=N.yAlign,this.width=r.width,this.height=r.height,this.caretX=A.x,this.caretY=A.y,this._resolveAnimations().update(this,H))}}_willRender(){return!!this.opacity}draw(s){const u=this.options.setContext(this.getContext());let _=this.opacity;if(!_)return;this._updateAnimationTarget(u);const v={width:this.width,height:this.height},E={x:this.x,y:this.y};_=Math.abs(_)<.001?0:_;const A=ad(u.padding),r=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;u.enabled&&r&&(s.save(),s.globalAlpha=_,this.drawBackground(E,s,v,u),J2(s,u.textDirection),E.y+=A.top,this.drawTitle(E,s,u),this.drawBody(E,s,u),this.drawFooter(E,s,u),Q2(s,u.textDirection),s.restore())}getActiveElements(){return this._active||[]}setActiveElements(s,u){const _=this._active,v=s.map(({datasetIndex:r,index:L})=>{const N=this.chart.getDatasetMeta(r);if(!N)throw new Error("Cannot find a dataset at index "+r);return{datasetIndex:r,element:N.data[L],index:L}}),E=!MA(_,v),A=this._positionChanged(v,u);(E||A)&&(this._active=v,this._eventPosition=u,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(s,u,_=!0){if(u&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const v=this.options,E=this._active||[],A=this._getActiveElements(s,E,u,_),r=this._positionChanged(A,s),L=u||!MA(A,E)||r;return L&&(this._active=A,(v.enabled||v.external)&&(this._eventPosition={x:s.x,y:s.y},this.update(!0,u))),L}_getActiveElements(s,u,_,v){const E=this.options;if(s.type==="mouseout")return[];if(!v)return u.filter(r=>this.chart.data.datasets[r.datasetIndex]&&this.chart.getDatasetMeta(r.datasetIndex).controller.getParsed(r.index)!==void 0);const A=this.chart.getElementsAtEventForMode(s,E.mode,E,_);return E.reverse&&A.reverse(),A}_positionChanged(s,u){const{caretX:_,caretY:v,options:E}=this,A=cT[E.position].call(this,s,u);return A!==!1&&(_!==A.x||v!==A.y)}}Ln(DR,"positioners",cT);var Ej={id:"tooltip",_element:DR,positioners:cT,afterInit(d,s,u){u&&(d.tooltip=new DR({chart:d,options:u}))},beforeUpdate(d,s,u){d.tooltip&&d.tooltip.initialize(u)},reset(d,s,u){d.tooltip&&d.tooltip.initialize(u)},afterDraw(d){const s=d.tooltip;if(s&&s._willRender()){const u={tooltip:s};if(d.notifyPlugins("beforeTooltipDraw",{...u,cancelable:!0})===!1)return;s.draw(d.ctx),d.notifyPlugins("afterTooltipDraw",u)}},afterEvent(d,s){if(d.tooltip){const u=s.replay;d.tooltip.handleEvent(s.event,u,s.inChartArea)&&(s.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(d,s)=>s.bodyFont.size,boxWidth:(d,s)=>s.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:_k},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:d=>d!=="filter"&&d!=="itemSort"&&d!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const Aj=(d,s,u,_)=>(typeof s=="string"?(u=d.push(s)-1,_.unshift({index:u,label:s})):isNaN(s)&&(u=null),u);function Cj(d,s,u,_){const v=d.indexOf(s);if(v===-1)return Aj(d,s,u,_);const E=d.lastIndexOf(s);return v!==E?u:v}const Ij=(d,s)=>d===null?null:ec(Math.round(d),0,s);function dO(d){const s=this.getLabels();return d>=0&&d<s.length?s[d]:d}class MR extends zb{constructor(s){super(s),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(s){const u=this._addedLabels;if(u.length){const _=this.getLabels();for(const{index:v,label:E}of u)_[v]===E&&_.splice(v,1);this._addedLabels=[]}super.init(s)}parse(s,u){if(wo(s))return null;const _=this.getLabels();return u=isFinite(u)&&_[u]===s?u:Cj(_,s,Jr(u,s),this._addedLabels),Ij(u,_.length-1)}determineDataLimits(){const{minDefined:s,maxDefined:u}=this.getUserBounds();let{min:_,max:v}=this.getMinMax(!0);this.options.bounds==="ticks"&&(s||(_=0),u||(v=this.getLabels().length-1)),this.min=_,this.max=v}buildTicks(){const s=this.min,u=this.max,_=this.options.offset,v=[];let E=this.getLabels();E=s===0&&u===E.length-1?E:E.slice(s,u+1),this._valueRange=Math.max(E.length-(_?0:1),1),this._startValue=this.min-(_?.5:0);for(let A=s;A<=u;A++)v.push({value:A});return v}getLabelForValue(s){return dO.call(this,s)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(s){return typeof s!="number"&&(s=this.parse(s)),s===null?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getPixelForTick(s){const u=this.ticks;return s<0||s>u.length-1?null:this.getPixelForValue(u[s].value)}getValueForPixel(s){return Math.round(this._startValue+this.getDecimalForPixel(s)*this._valueRange)}getBasePixel(){return this.bottom}}Ln(MR,"id","category"),Ln(MR,"defaults",{ticks:{callback:dO}});function Rj(d,s){const u=[],{bounds:v,step:E,min:A,max:r,precision:L,count:N,maxTicks:H,maxDigits:X,includeBounds:re}=d,he=E||1,de=H-1,{min:ve,max:xe}=s,$e=!wo(A),Le=!wo(r),Ke=!wo(N),Ge=(xe-ve)/(X+1);let Ye=pP((xe-ve)/de/he)*he,mt,Ct,Vt,ui;if(Ye<1e-14&&!$e&&!Le)return[{value:ve},{value:xe}];ui=Math.ceil(xe/Ye)-Math.floor(ve/Ye),ui>de&&(Ye=pP(ui*Ye/de/he)*he),wo(L)||(mt=Math.pow(10,L),Ye=Math.ceil(Ye*mt)/mt),v==="ticks"?(Ct=Math.floor(ve/Ye)*Ye,Vt=Math.ceil(xe/Ye)*Ye):(Ct=ve,Vt=xe),$e&&Le&&E&&JB((r-A)/E,Ye/1e3)?(ui=Math.round(Math.min((r-A)/Ye,H)),Ye=(r-A)/ui,Ct=A,Vt=r):Ke?(Ct=$e?A:Ct,Vt=Le?r:Vt,ui=N-1,Ye=(Vt-Ct)/ui):(ui=(Vt-Ct)/Ye,fT(ui,Math.round(ui),Ye/1e3)?ui=Math.round(ui):ui=Math.ceil(ui));const Di=Math.max(mP(Ye),mP(Ct));mt=Math.pow(10,wo(L)?Di:L),Ct=Math.round(Ct*mt)/mt,Vt=Math.round(Vt*mt)/mt;let si=0;for($e&&(re&&Ct!==A?(u.push({value:A}),Ct<A&&si++,fT(Math.round((Ct+si*Ye)*mt)/mt,A,fO(A,Ge,d))&&si++):Ct<A&&si++);si<ui;++si){const di=Math.round((Ct+si*Ye)*mt)/mt;if(Le&&di>r)break;u.push({value:di})}return Le&&re&&Vt!==r?u.length&&fT(u[u.length-1].value,r,fO(r,Ge,d))?u[u.length-1].value=r:u.push({value:r}):(!Le||Vt===r)&&u.push({value:Vt}),u}function fO(d,s,{horizontal:u,minRotation:_}){const v=$v(_),E=(u?Math.sin(v):Math.cos(v))||.001,A=.75*s*(""+d).length;return Math.min(s/E,A)}class Dj extends zb{constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(s,u){return wo(s)||(typeof s=="number"||s instanceof Number)&&!isFinite(+s)?null:+s}handleTickRangeOptions(){const{beginAtZero:s}=this.options,{minDefined:u,maxDefined:_}=this.getUserBounds();let{min:v,max:E}=this;const A=L=>v=u?v:L,r=L=>E=_?E:L;if(s){const L=lp(v),N=lp(E);L<0&&N<0?r(0):L>0&&N>0&&A(0)}if(v===E){let L=E===0?1:Math.abs(E*.05);r(E+L),s||A(v-L)}this.min=v,this.max=E}getTickLimit(){const s=this.options.ticks;let{maxTicksLimit:u,stepSize:_}=s,v;return _?(v=Math.ceil(this.max/_)-Math.floor(this.min/_)+1,v>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${_} would result generating up to ${v} ticks. Limiting to 1000.`),v=1e3)):(v=this.computeTickLimit(),u=u||11),u&&(v=Math.min(u,v)),v}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const s=this.options,u=s.ticks;let _=this.getTickLimit();_=Math.max(2,_);const v={maxTicks:_,bounds:s.bounds,min:s.min,max:s.max,precision:u.precision,step:u.stepSize,count:u.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:u.minRotation||0,includeBounds:u.includeBounds!==!1},E=this._range||this,A=Rj(v,E);return s.bounds==="ticks"&&QB(A,this,"value"),s.reverse?(A.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),A}configure(){const s=this.ticks;let u=this.min,_=this.max;if(super.configure(),this.options.offset&&s.length){const v=(_-u)/Math.max(s.length-1,1)/2;u-=v,_+=v}this._startValue=u,this._endValue=_,this._valueRange=_-u}getLabelForValue(s){return G2(s,this.chart.options.locale,this.options.ticks.format)}}class PR extends Dj{determineDataLimits(){const{min:s,max:u}=this.getMinMax(!0);this.min=od(s)?s:0,this.max=od(u)?u:1,this.handleTickRangeOptions()}computeTickLimit(){const s=this.isHorizontal(),u=s?this.width:this.height,_=$v(this.options.ticks.minRotation),v=(s?Math.sin(_):Math.cos(_))||.001,E=this._resolveTickFontOptions(0);return Math.ceil(u/Math.min(40,E.lineHeight/v))}getPixelForValue(s){return s===null?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getValueForPixel(s){return this._startValue+this.getDecimalForPixel(s)*this._valueRange}}Ln(PR,"id","linear"),Ln(PR,"defaults",{ticks:{callback:H2.formatters.numeric}});const JA={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},_u=Object.keys(JA);function pO(d,s){return d-s}function mO(d,s){if(wo(s))return null;const u=d._adapter,{parser:_,round:v,isoWeekday:E}=d._parseOpts;let A=s;return typeof _=="function"&&(A=_(A)),od(A)||(A=typeof _=="string"?u.parse(A,_):u.parse(A)),A===null?null:(v&&(A=v==="week"&&(CT(E)||E===!0)?u.startOf(A,"isoWeek",E):u.startOf(A,v)),+A)}function gO(d,s,u,_){const v=_u.length;for(let E=_u.indexOf(d);E<v-1;++E){const A=JA[_u[E]],r=A.steps?A.steps:Number.MAX_SAFE_INTEGER;if(A.common&&Math.ceil((u-s)/(r*A.size))<=_)return _u[E]}return _u[v-1]}function Mj(d,s,u,_,v){for(let E=_u.length-1;E>=_u.indexOf(u);E--){const A=_u[E];if(JA[A].common&&d._adapter.diff(v,_,A)>=s-1)return A}return _u[u?_u.indexOf(u):0]}function Pj(d){for(let s=_u.indexOf(d)+1,u=_u.length;s<u;++s)if(JA[_u[s]].common)return _u[s]}function _O(d,s,u){if(!u)d[s]=!0;else if(u.length){const{lo:_,hi:v}=oD(u,s),E=u[_]>=s?u[_]:u[v];d[E]=!0}}function Oj(d,s,u,_){const v=d._adapter,E=+v.startOf(s[0].value,_),A=s[s.length-1].value;let r,L;for(r=E;r<=A;r=+v.add(r,1,_))L=u[r],L>=0&&(s[L].major=!0);return s}function yO(d,s,u){const _=[],v={},E=s.length;let A,r;for(A=0;A<E;++A)r=s[A],v[r]=A,_.push({value:r,major:!1});return E===0||!u?_:Oj(d,_,v,u)}class BA extends zb{constructor(s){super(s),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(s,u={}){const _=s.time||(s.time={}),v=this._adapter=new zV._date(s.adapters.date);v.init(u),dT(_.displayFormats,v.formats()),this._parseOpts={parser:_.parser,round:_.round,isoWeekday:_.isoWeekday},super.init(s),this._normalized=u.normalized}parse(s,u){return s===void 0?null:mO(this,s)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const s=this.options,u=this._adapter,_=s.time.unit||"day";let{min:v,max:E,minDefined:A,maxDefined:r}=this.getUserBounds();function L(N){!A&&!isNaN(N.min)&&(v=Math.min(v,N.min)),!r&&!isNaN(N.max)&&(E=Math.max(E,N.max))}(!A||!r)&&(L(this._getLabelBounds()),(s.bounds!=="ticks"||s.ticks.source!=="labels")&&L(this.getMinMax(!1))),v=od(v)&&!isNaN(v)?v:+u.startOf(Date.now(),_),E=od(E)&&!isNaN(E)?E:+u.endOf(Date.now(),_)+1,this.min=Math.min(v,E-1),this.max=Math.max(v+1,E)}_getLabelBounds(){const s=this.getLabelTimestamps();let u=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY;return s.length&&(u=s[0],_=s[s.length-1]),{min:u,max:_}}buildTicks(){const s=this.options,u=s.time,_=s.ticks,v=_.source==="labels"?this.getLabelTimestamps():this._generate();s.bounds==="ticks"&&v.length&&(this.min=this._userMin||v[0],this.max=this._userMax||v[v.length-1]);const E=this.min,A=this.max,r=r5(v,E,A);return this._unit=u.unit||(_.autoSkip?gO(u.minUnit,this.min,this.max,this._getLabelCapacity(E)):Mj(this,r.length,u.minUnit,this.min,this.max)),this._majorUnit=!_.major.enabled||this._unit==="year"?void 0:Pj(this._unit),this.initOffsets(v),s.reverse&&r.reverse(),yO(this,r,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(s=>+s.value))}initOffsets(s=[]){let u=0,_=0,v,E;this.options.offset&&s.length&&(v=this.getDecimalForValue(s[0]),s.length===1?u=1-v:u=(this.getDecimalForValue(s[1])-v)/2,E=this.getDecimalForValue(s[s.length-1]),s.length===1?_=E:_=(E-this.getDecimalForValue(s[s.length-2]))/2);const A=s.length<3?.5:.25;u=ec(u,0,A),_=ec(_,0,A),this._offsets={start:u,end:_,factor:1/(u+1+_)}}_generate(){const s=this._adapter,u=this.min,_=this.max,v=this.options,E=v.time,A=E.unit||gO(E.minUnit,u,_,this._getLabelCapacity(u)),r=Jr(v.ticks.stepSize,1),L=A==="week"?E.isoWeekday:!1,N=CT(L)||L===!0,H={};let X=u,re,he;if(N&&(X=+s.startOf(X,"isoWeek",L)),X=+s.startOf(X,N?"day":A),s.diff(_,u,A)>1e5*r)throw new Error(u+" and "+_+" are too far apart with stepSize of "+r+" "+A);const de=v.ticks.source==="data"&&this.getDataTimestamps();for(re=X,he=0;re<_;re=+s.add(re,r,A),he++)_O(H,re,de);return(re===_||v.bounds==="ticks"||he===1)&&_O(H,re,de),Object.keys(H).sort(pO).map(ve=>+ve)}getLabelForValue(s){const u=this._adapter,_=this.options.time;return _.tooltipFormat?u.format(s,_.tooltipFormat):u.format(s,_.displayFormats.datetime)}format(s,u){const v=this.options.time.displayFormats,E=this._unit,A=u||v[E];return this._adapter.format(s,A)}_tickFormatFunction(s,u,_,v){const E=this.options,A=E.ticks.callback;if(A)return pa(A,[s,u,_],this);const r=E.time.displayFormats,L=this._unit,N=this._majorUnit,H=L&&r[L],X=N&&r[N],re=_[u],he=N&&X&&re&&re.major;return this._adapter.format(s,v||(he?X:H))}generateTickLabels(s){let u,_,v;for(u=0,_=s.length;u<_;++u)v=s[u],v.label=this._tickFormatFunction(v.value,u,s)}getDecimalForValue(s){return s===null?NaN:(s-this.min)/(this.max-this.min)}getPixelForValue(s){const u=this._offsets,_=this.getDecimalForValue(s);return this.getPixelForDecimal((u.start+_)*u.factor)}getValueForPixel(s){const u=this._offsets,_=this.getDecimalForPixel(s)/u.factor-u.end;return this.min+_*(this.max-this.min)}_getLabelSize(s){const u=this.options.ticks,_=this.ctx.measureText(s).width,v=$v(this.isHorizontal()?u.maxRotation:u.minRotation),E=Math.cos(v),A=Math.sin(v),r=this._resolveTickFontOptions(0).size;return{w:_*E+r*A,h:_*A+r*E}}_getLabelCapacity(s){const u=this.options.time,_=u.displayFormats,v=_[u.unit]||_.millisecond,E=this._tickFormatFunction(s,0,yO(this,[s],this._majorUnit),v),A=this._getLabelSize(E),r=Math.floor(this.isHorizontal()?this.width/A.w:this.height/A.h)-1;return r>0?r:1}getDataTimestamps(){let s=this._cache.data||[],u,_;if(s.length)return s;const v=this.getMatchingVisibleMetas();if(this._normalized&&v.length)return this._cache.data=v[0].controller.getAllParsedValues(this);for(u=0,_=v.length;u<_;++u)s=s.concat(v[u].controller.getAllParsedValues(this));return this._cache.data=this.normalize(s)}getLabelTimestamps(){const s=this._cache.labels||[];let u,_;if(s.length)return s;const v=this.getLabels();for(u=0,_=v.length;u<_;++u)s.push(mO(this,v[u]));return this._cache.labels=this._normalized?s:this.normalize(s)}normalize(s){return B2(s.sort(pO))}}Ln(BA,"id","time"),Ln(BA,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function uA(d,s,u){let _=0,v=d.length-1,E,A,r,L;u?(s>=d[_].pos&&s<=d[v].pos&&({lo:_,hi:v}=Wv(d,"pos",s)),{pos:E,time:r}=d[_],{pos:A,time:L}=d[v]):(s>=d[_].time&&s<=d[v].time&&({lo:_,hi:v}=Wv(d,"time",s)),{time:E,pos:r}=d[_],{time:A,pos:L}=d[v]);const N=A-E;return N?r+(L-r)*(s-E)/N:r}class vO extends BA{constructor(s){super(s),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const s=this._getTimestampsForTable(),u=this._table=this.buildLookupTable(s);this._minPos=uA(u,this.min),this._tableRange=uA(u,this.max)-this._minPos,super.initOffsets(s)}buildLookupTable(s){const{min:u,max:_}=this,v=[],E=[];let A,r,L,N,H;for(A=0,r=s.length;A<r;++A)N=s[A],N>=u&&N<=_&&v.push(N);if(v.length<2)return[{time:u,pos:0},{time:_,pos:1}];for(A=0,r=v.length;A<r;++A)H=v[A+1],L=v[A-1],N=v[A],Math.round((H+L)/2)!==N&&E.push({time:N,pos:A/(r-1)});return E}_generate(){const s=this.min,u=this.max;let _=super.getDataTimestamps();return(!_.includes(s)||!_.length)&&_.splice(0,0,s),(!_.includes(u)||_.length===1)&&_.push(u),_.sort((v,E)=>v-E)}_getTimestampsForTable(){let s=this._cache.all||[];if(s.length)return s;const u=this.getDataTimestamps(),_=this.getLabelTimestamps();return u.length&&_.length?s=this.normalize(u.concat(_)):s=u.length?u:_,s=this._cache.all=s,s}getDecimalForValue(s){return(uA(this._table,s)-this._minPos)/this._tableRange}getValueForPixel(s){const u=this._offsets,_=this.getDecimalForPixel(s)/u.factor-u.end;return uA(this._table,_*this._tableRange+this._minPos,!0)}}Ln(vO,"id","timeseries"),Ln(vO,"defaults",BA.defaults);/*!
 * chartjs-plugin-datalabels v2.2.0
 * https://chartjs-plugin-datalabels.netlify.app
 * (c) 2017-2022 chartjs-plugin-datalabels contributors
 * Released under the MIT license
 */var xO=function(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var d=window.screen;if(d)return(d.deviceXDPI||1)/(d.logicalXDPI||1)}return 1}(),yT={toTextLines:function(d){var s=[],u;for(d=[].concat(d);d.length;)u=d.pop(),typeof u=="string"?s.unshift.apply(s,u.split(`
`)):Array.isArray(u)?d.push.apply(d,u):wo(d)||s.unshift(""+u);return s},textSize:function(d,s,u){var _=[].concat(s),v=_.length,E=d.font,A=0,r;for(d.font=u.string,r=0;r<v;++r)A=Math.max(d.measureText(_[r]).width,A);return d.font=E,{height:v*u.lineHeight,width:A}},bound:function(d,s,u){return Math.max(d,Math.min(s,u))},arrayDiff:function(d,s){var u=d.slice(),_=[],v,E,A,r;for(v=0,A=s.length;v<A;++v)r=s[v],E=u.indexOf(r),E===-1?_.push([r,1]):u.splice(E,1);for(v=0,A=u.length;v<A;++v)_.push([u[v],-1]);return _},rasterize:function(d){return Math.round(d*xO)/xO}};function uR(d,s){var u=s.x,_=s.y;if(u===null)return{x:0,y:-1};if(_===null)return{x:1,y:0};var v=d.x-u,E=d.y-_,A=Math.sqrt(v*v+E*E);return{x:A?v/A:0,y:A?E/A:-1}}function kj(d,s,u,_,v){switch(v){case"center":u=_=0;break;case"bottom":u=0,_=1;break;case"right":u=1,_=0;break;case"left":u=-1,_=0;break;case"top":u=0,_=-1;break;case"start":u=-u,_=-_;break;case"end":break;default:v*=Math.PI/180,u=Math.cos(v),_=Math.sin(v);break}return{x:d,y:s,vx:u,vy:_}}var Fj=0,yk=1,vk=2,xk=4,bk=8;function hA(d,s,u){var _=Fj;return d<u.left?_|=yk:d>u.right&&(_|=vk),s<u.top?_|=bk:s>u.bottom&&(_|=xk),_}function Lj(d,s){for(var u=d.x0,_=d.y0,v=d.x1,E=d.y1,A=hA(u,_,s),r=hA(v,E,s),L,N,H;!(!(A|r)||A&r);)L=A||r,L&bk?(N=u+(v-u)*(s.top-_)/(E-_),H=s.top):L&xk?(N=u+(v-u)*(s.bottom-_)/(E-_),H=s.bottom):L&vk?(H=_+(E-_)*(s.right-u)/(v-u),N=s.right):L&yk&&(H=_+(E-_)*(s.left-u)/(v-u),N=s.left),L===A?(u=N,_=H,A=hA(u,_,s)):(v=N,E=H,r=hA(v,E,s));return{x0:u,x1:v,y0:_,y1:E}}function dA(d,s){var u=s.anchor,_=d,v,E;return s.clamp&&(_=Lj(_,s.area)),u==="start"?(v=_.x0,E=_.y0):u==="end"?(v=_.x1,E=_.y1):(v=(_.x0+_.x1)/2,E=(_.y0+_.y1)/2),kj(v,E,d.vx,d.vy,s.align)}var fA={arc:function(d,s){var u=(d.startAngle+d.endAngle)/2,_=Math.cos(u),v=Math.sin(u),E=d.innerRadius,A=d.outerRadius;return dA({x0:d.x+_*E,y0:d.y+v*E,x1:d.x+_*A,y1:d.y+v*A,vx:_,vy:v},s)},point:function(d,s){var u=uR(d,s.origin),_=u.x*d.options.radius,v=u.y*d.options.radius;return dA({x0:d.x-_,y0:d.y-v,x1:d.x+_,y1:d.y+v,vx:u.x,vy:u.y},s)},bar:function(d,s){var u=uR(d,s.origin),_=d.x,v=d.y,E=0,A=0;return d.horizontal?(_=Math.min(d.x,d.base),E=Math.abs(d.base-d.x)):(v=Math.min(d.y,d.base),A=Math.abs(d.base-d.y)),dA({x0:_,y0:v+A,x1:_+E,y1:v,vx:u.x,vy:u.y},s)},fallback:function(d,s){var u=uR(d,s.origin);return dA({x0:d.x,y0:d.y,x1:d.x+(d.width||0),y1:d.y+(d.height||0),vx:u.x,vy:u.y},s)}},km=yT.rasterize;function zj(d){var s=d.borderWidth||0,u=d.padding,_=d.size.height,v=d.size.width,E=-v/2,A=-_/2;return{frame:{x:E-u.left-s,y:A-u.top-s,w:v+u.width+s*2,h:_+u.height+s*2},text:{x:E,y:A,w:v,h:_}}}function Nj(d,s){var u=s.chart.getDatasetMeta(s.datasetIndex).vScale;if(!u)return null;if(u.xCenter!==void 0&&u.yCenter!==void 0)return{x:u.xCenter,y:u.yCenter};var _=u.getBasePixel();return d.horizontal?{x:_,y:null}:{x:null,y:_}}function Bj(d){return d instanceof sT?fA.arc:d instanceof gT?fA.point:d instanceof _T?fA.bar:fA.fallback}function Vj(d,s,u,_,v,E){var A=Math.PI/2;if(E){var r=Math.min(E,v/2,_/2),L=s+r,N=u+r,H=s+_-r,X=u+v-r;d.moveTo(s,N),L<H&&N<X?(d.arc(L,N,r,-Math.PI,-A),d.arc(H,N,r,-A,0),d.arc(H,X,r,0,A),d.arc(L,X,r,A,Math.PI)):L<H?(d.moveTo(L,u),d.arc(H,N,r,-A,A),d.arc(L,N,r,A,Math.PI+A)):N<X?(d.arc(L,N,r,-Math.PI,0),d.arc(L,X,r,0,Math.PI)):d.arc(L,N,r,-Math.PI,Math.PI),d.closePath(),d.moveTo(s,u)}else d.rect(s,u,_,v)}function Uj(d,s,u){var _=u.backgroundColor,v=u.borderColor,E=u.borderWidth;!_&&(!v||!E)||(d.beginPath(),Vj(d,km(s.x)+E/2,km(s.y)+E/2,km(s.w)-E,km(s.h)-E,u.borderRadius),d.closePath(),_&&(d.fillStyle=_,d.fill()),v&&E&&(d.strokeStyle=v,d.lineWidth=E,d.lineJoin="miter",d.stroke()))}function jj(d,s,u){var _=u.lineHeight,v=d.w,E=d.x,A=d.y+_/2;return s==="center"?E+=v/2:(s==="end"||s==="right")&&(E+=v),{h:_,w:v,x:E,y:A}}function Gj(d,s,u){var _=d.shadowBlur,v=u.stroked,E=km(u.x),A=km(u.y),r=km(u.w);v&&d.strokeText(s,E,A,r),u.filled&&(_&&v&&(d.shadowBlur=0),d.fillText(s,E,A,r),_&&v&&(d.shadowBlur=_))}function Hj(d,s,u,_){var v=_.textAlign,E=_.color,A=!!E,r=_.font,L=s.length,N=_.textStrokeColor,H=_.textStrokeWidth,X=N&&H,re;if(!(!L||!A&&!X))for(u=jj(u,v,r),d.font=r.string,d.textAlign=v,d.textBaseline="middle",d.shadowBlur=_.textShadowBlur,d.shadowColor=_.textShadowColor,A&&(d.fillStyle=E),X&&(d.lineJoin="round",d.lineWidth=H,d.strokeStyle=N),re=0,L=s.length;re<L;++re)Gj(d,s[re],{stroked:X,filled:A,w:u.w,x:u.x,y:u.y+u.h*re})}var wk=function(d,s,u,_){var v=this;v._config=d,v._index=_,v._model=null,v._rects=null,v._ctx=s,v._el=u};cp(wk.prototype,{_modelize:function(d,s,u,_){var v=this,E=v._index,A=Cc(Ua([u.font,{}],_,E)),r=Ua([u.color,rs.color],_,E);return{align:Ua([u.align,"center"],_,E),anchor:Ua([u.anchor,"center"],_,E),area:_.chart.chartArea,backgroundColor:Ua([u.backgroundColor,null],_,E),borderColor:Ua([u.borderColor,null],_,E),borderRadius:Ua([u.borderRadius,0],_,E),borderWidth:Ua([u.borderWidth,0],_,E),clamp:Ua([u.clamp,!1],_,E),clip:Ua([u.clip,!1],_,E),color:r,display:d,font:A,lines:s,offset:Ua([u.offset,4],_,E),opacity:Ua([u.opacity,1],_,E),origin:Nj(v._el,_),padding:ad(Ua([u.padding,4],_,E)),positioner:Bj(v._el),rotation:Ua([u.rotation,0],_,E)*(Math.PI/180),size:yT.textSize(v._ctx,s,A),textAlign:Ua([u.textAlign,"start"],_,E),textShadowBlur:Ua([u.textShadowBlur,0],_,E),textShadowColor:Ua([u.textShadowColor,r],_,E),textStrokeColor:Ua([u.textStrokeColor,r],_,E),textStrokeWidth:Ua([u.textStrokeWidth,0],_,E)}},update:function(d){var s=this,u=null,_=null,v=s._index,E=s._config,A,r,L,N=Ua([E.display,!0],d,v);N&&(A=d.dataset.data[v],r=Jr(pa(E.formatter,[A,d]),A),L=wo(r)?[]:yT.toTextLines(r),L.length&&(u=s._modelize(N,L,E,d),_=zj(u))),s._model=u,s._rects=_},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(d,s){var u=this,_=d.ctx,v=u._model,E=u._rects,A;this.visible()&&(_.save(),v.clip&&(A=v.area,_.beginPath(),_.rect(A.left,A.top,A.right-A.left,A.bottom-A.top),_.clip()),_.globalAlpha=yT.bound(0,v.opacity,1),_.translate(km(s.x),km(s.y)),_.rotate(v.rotation),Uj(_,E.frame,v),Hj(_,v.lines,E.text,v),_.restore())}});var $j=Number.MIN_SAFE_INTEGER||-9007199254740991,Wj=Number.MAX_SAFE_INTEGER||9007199254740991;function rT(d,s,u){var _=Math.cos(u),v=Math.sin(u),E=s.x,A=s.y;return{x:E+_*(d.x-E)-v*(d.y-A),y:A+v*(d.x-E)+_*(d.y-A)}}function bO(d,s){var u=Wj,_=$j,v=s.origin,E,A,r,L,N;for(E=0;E<d.length;++E)A=d[E],r=A.x-v.x,L=A.y-v.y,N=s.vx*r+s.vy*L,u=Math.min(u,N),_=Math.max(_,N);return{min:u,max:_}}function pA(d,s){var u=s.x-d.x,_=s.y-d.y,v=Math.sqrt(u*u+_*_);return{vx:(s.x-d.x)/v,vy:(s.y-d.y)/v,origin:d,ln:v}}var Tk=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};cp(Tk.prototype,{center:function(){var d=this._rect;return{x:d.x+d.w/2,y:d.y+d.h/2}},update:function(d,s,u){this._rotation=u,this._rect={x:s.x+d.x,y:s.y+d.y,w:s.w,h:s.h}},contains:function(d){var s=this,u=1,_=s._rect;return d=rT(d,s.center(),-s._rotation),!(d.x<_.x-u||d.y<_.y-u||d.x>_.x+_.w+u*2||d.y>_.y+_.h+u*2)},intersects:function(d){var s=this._points(),u=d._points(),_=[pA(s[0],s[1]),pA(s[0],s[3])],v,E,A;for(this._rotation!==d._rotation&&_.push(pA(u[0],u[1]),pA(u[0],u[3])),v=0;v<_.length;++v)if(E=bO(s,_[v]),A=bO(u,_[v]),E.max<A.min||A.max<E.min)return!1;return!0},_points:function(){var d=this,s=d._rect,u=d._rotation,_=d.center();return[rT({x:s.x,y:s.y},_,u),rT({x:s.x+s.w,y:s.y},_,u),rT({x:s.x+s.w,y:s.y+s.h},_,u),rT({x:s.x,y:s.y+s.h},_,u)]}});function Sk(d,s,u){var _=s.positioner(d,s),v=_.vx,E=_.vy;if(!v&&!E)return{x:_.x,y:_.y};var A=u.w,r=u.h,L=s.rotation,N=Math.abs(A/2*Math.cos(L))+Math.abs(r/2*Math.sin(L)),H=Math.abs(A/2*Math.sin(L))+Math.abs(r/2*Math.cos(L)),X=1/Math.max(Math.abs(v),Math.abs(E));return N*=v*X,H*=E*X,N+=s.offset*v,H+=s.offset*E,{x:_.x+N,y:_.y+H}}function qj(d,s){var u,_,v,E;for(u=d.length-1;u>=0;--u)for(v=d[u].$layout,_=u-1;_>=0&&v._visible;--_)E=d[_].$layout,E._visible&&v._box.intersects(E._box)&&s(v,E);return d}function Zj(d){var s,u,_,v,E,A,r;for(s=0,u=d.length;s<u;++s)_=d[s],v=_.$layout,v._visible&&(r=new Proxy(_._el,{get:(L,N)=>L.getProps([N],!0)[N]}),E=_.geometry(),A=Sk(r,_.model(),E),v._box.update(A,E,_.rotation()));return qj(d,function(L,N){var H=L._hidable,X=N._hidable;H&&X||X?N._visible=!1:H&&(L._visible=!1)})}var vT={prepare:function(d){var s=[],u,_,v,E,A;for(u=0,v=d.length;u<v;++u)for(_=0,E=d[u].length;_<E;++_)A=d[u][_],s.push(A),A.$layout={_box:new Tk,_hidable:!1,_visible:!0,_set:u,_idx:A._index};return s.sort(function(r,L){var N=r.$layout,H=L.$layout;return N._idx===H._idx?H._set-N._set:H._idx-N._idx}),this.update(s),s},update:function(d){var s=!1,u,_,v,E,A;for(u=0,_=d.length;u<_;++u)v=d[u],E=v.model(),A=v.$layout,A._hidable=E&&E.display==="auto",A._visible=v.visible(),s|=A._hidable;s&&Zj(d)},lookup:function(d,s){var u,_;for(u=d.length-1;u>=0;--u)if(_=d[u].$layout,_&&_._visible&&_._box.contains(s))return d[u];return null},draw:function(d,s){var u,_,v,E,A,r;for(u=0,_=s.length;u<_;++u)v=s[u],E=v.$layout,E._visible&&(A=v.geometry(),r=Sk(v._el,v.model(),A),E._box.update(r,A,v.rotation()),v.draw(d,r))}},Xj=function(d){if(wo(d))return null;var s=d,u,_,v;if(Po(d))if(!wo(d.label))s=d.label;else if(!wo(d.r))s=d.r;else for(s="",u=Object.keys(d),v=0,_=u.length;v<_;++v)s+=(v!==0?", ":"")+u[v]+": "+d[u[v]];return""+s},Yj={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:Xj,labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},gu="$datalabels",Ek="$default";function Kj(d,s){var u=d.datalabels,_={},v=[],E,A;return u===!1?null:(u===!0&&(u={}),s=cp({},[s,u]),E=s.labels||{},A=Object.keys(E),delete s.labels,A.length?A.forEach(function(r){E[r]&&v.push(cp({},[s,E[r],{_key:r}]))}):v.push(s),_=v.reduce(function(r,L){return Xo(L.listeners||{},function(N,H){r[H]=r[H]||{},r[H][L._key||Ek]=N}),delete L.listeners,r},{}),{labels:v,listeners:_})}function OR(d,s,u,_){if(s){var v=u.$context,E=u.$groups,A;s[E._set]&&(A=s[E._set][E._key],A&&pa(A,[v,_])===!0&&(d[gu]._dirty=!0,u.update(v)))}}function Jj(d,s,u,_,v){var E,A;!u&&!_||(u?_?u!==_&&(A=E=!0):A=!0:E=!0,A&&OR(d,s.leave,u,v),E&&OR(d,s.enter,_,v))}function Qj(d,s){var u=d[gu],_=u._listeners,v,E;if(!(!_.enter&&!_.leave)){if(s.type==="mousemove")E=vT.lookup(u._labels,s);else if(s.type!=="mouseout")return;v=u._hovered,u._hovered=E,Jj(d,_,v,E,s)}}function e4(d,s){var u=d[gu],_=u._listeners.click,v=_&&vT.lookup(u._labels,s);v&&OR(d,_,v,s)}var t4={id:"datalabels",defaults:Yj,beforeInit:function(d){d[gu]={_actives:[]}},beforeUpdate:function(d){var s=d[gu];s._listened=!1,s._listeners={},s._datasets=[],s._labels=[]},afterDatasetUpdate:function(d,s,u){var _=s.index,v=d[gu],E=v._datasets[_]=[],A=d.isDatasetVisible(_),r=d.data.datasets[_],L=Kj(r,u),N=s.meta.data||[],H=d.ctx,X,re,he,de,ve,xe,$e,Le;for(H.save(),X=0,he=N.length;X<he;++X)if($e=N[X],$e[gu]=[],A&&$e&&d.getDataVisibility(X)&&!$e.skip)for(re=0,de=L.labels.length;re<de;++re)ve=L.labels[re],xe=ve._key,Le=new wk(ve,H,$e,X),Le.$groups={_set:_,_key:xe||Ek},Le.$context={active:!1,chart:d,dataIndex:X,dataset:r,datasetIndex:_},Le.update(Le.$context),$e[gu].push(Le),E.push(Le);H.restore(),cp(v._listeners,L.listeners,{merger:function(Ke,Ge,Ye){Ge[Ke]=Ge[Ke]||{},Ge[Ke][s.index]=Ye[Ke],v._listened=!0}})},afterUpdate:function(d){d[gu]._labels=vT.prepare(d[gu]._datasets)},afterDatasetsDraw:function(d){vT.draw(d,d[gu]._labels)},beforeEvent:function(d,s){if(d[gu]._listened){var u=s.event;switch(u.type){case"mousemove":case"mouseout":Qj(d,u);break;case"click":e4(d,u);break}}},afterEvent:function(d){var s=d[gu],u=s._actives,_=s._actives=d.getActiveElements(),v=yT.arrayDiff(u,_),E,A,r,L,N,H,X;for(E=0,A=v.length;E<A;++E)if(N=v[E],N[1])for(X=N[0].element[gu]||[],r=0,L=X.length;r<L;++r)H=X[r],H.$context.active=N[1]===1,H.update(H.$context);(s._dirty||v.length)&&(vT.update(s._labels),d.render()),delete s._dirty}},Ak={exports:{}},SA={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){var d=ft,s=Symbol.for("react.element"),u=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),r=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),X=Symbol.for("react.memo"),re=Symbol.for("react.lazy"),he=Symbol.for("react.offscreen"),de=Symbol.iterator,ve="@@iterator";function xe(ie){if(ie===null||typeof ie!="object")return null;var W=de&&ie[de]||ie[ve];return typeof W=="function"?W:null}var $e=d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Le(ie){{for(var W=arguments.length,Y=new Array(W>1?W-1:0),ue=1;ue<W;ue++)Y[ue-1]=arguments[ue];Ke("error",ie,Y)}}function Ke(ie,W,Y){{var ue=$e.ReactDebugCurrentFrame,we=ue.getStackAddendum();we!==""&&(W+="%s",Y=Y.concat([we]));var ye=Y.map(function(Me){return String(Me)});ye.unshift("Warning: "+W),Function.prototype.apply.call(console[ie],console,ye)}}var Ge=!1,Ye=!1,mt=!1,Ct=!1,Vt=!1,ui;ui=Symbol.for("react.module.reference");function Di(ie){return!!(typeof ie=="string"||typeof ie=="function"||ie===_||ie===E||Vt||ie===v||ie===N||ie===H||Ct||ie===he||Ge||Ye||mt||typeof ie=="object"&&ie!==null&&(ie.$$typeof===re||ie.$$typeof===X||ie.$$typeof===A||ie.$$typeof===r||ie.$$typeof===L||ie.$$typeof===ui||ie.getModuleId!==void 0))}function si(ie,W,Y){var ue=ie.displayName;if(ue)return ue;var we=W.displayName||W.name||"";return we!==""?Y+"("+we+")":Y}function di(ie){return ie.displayName||"Context"}function Nt(ie){if(ie==null)return null;if(typeof ie.tag=="number"&&Le("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof ie=="function")return ie.displayName||ie.name||null;if(typeof ie=="string")return ie;switch(ie){case _:return"Fragment";case u:return"Portal";case E:return"Profiler";case v:return"StrictMode";case N:return"Suspense";case H:return"SuspenseList"}if(typeof ie=="object")switch(ie.$$typeof){case r:var W=ie;return di(W)+".Consumer";case A:var Y=ie;return di(Y._context)+".Provider";case L:return si(ie,ie.render,"ForwardRef");case X:var ue=ie.displayName||null;return ue!==null?ue:Nt(ie.type)||"Memo";case re:{var we=ie,ye=we._payload,Me=we._init;try{return Nt(Me(ye))}catch{return null}}}return null}var Ii=Object.assign,Qt=0,_t,Et,fi,rn,zn,er,Mn;function pn(){}pn.__reactDisabledLog=!0;function pr(){{if(Qt===0){_t=console.log,Et=console.info,fi=console.warn,rn=console.error,zn=console.group,er=console.groupCollapsed,Mn=console.groupEnd;var ie={configurable:!0,enumerable:!0,value:pn,writable:!0};Object.defineProperties(console,{info:ie,log:ie,warn:ie,error:ie,group:ie,groupCollapsed:ie,groupEnd:ie})}Qt++}}function Vr(){{if(Qt--,Qt===0){var ie={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Ii({},ie,{value:_t}),info:Ii({},ie,{value:Et}),warn:Ii({},ie,{value:fi}),error:Ii({},ie,{value:rn}),group:Ii({},ie,{value:zn}),groupCollapsed:Ii({},ie,{value:er}),groupEnd:Ii({},ie,{value:Mn})})}Qt<0&&Le("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Or=$e.ReactCurrentDispatcher,kr;function Wr(ie,W,Y){{if(kr===void 0)try{throw Error()}catch(we){var ue=we.stack.trim().match(/\n( *(at )?)/);kr=ue&&ue[1]||""}return`
`+kr+ie}}var mn=!1,Ei;{var Xi=typeof WeakMap=="function"?WeakMap:Map;Ei=new Xi}function Rn(ie,W){if(!ie||mn)return"";{var Y=Ei.get(ie);if(Y!==void 0)return Y}var ue;mn=!0;var we=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var ye;ye=Or.current,Or.current=null,pr();try{if(W){var Me=function(){throw Error()};if(Object.defineProperty(Me.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Me,[])}catch(xi){ue=xi}Reflect.construct(ie,[],Me)}else{try{Me.call()}catch(xi){ue=xi}ie.call(Me.prototype)}}else{try{throw Error()}catch(xi){ue=xi}ie()}}catch(xi){if(xi&&ue&&typeof xi.stack=="string"){for(var je=xi.stack.split(`
`),ze=ue.stack.split(`
`),We=je.length-1,xt=ze.length-1;We>=1&&xt>=0&&je[We]!==ze[xt];)xt--;for(;We>=1&&xt>=0;We--,xt--)if(je[We]!==ze[xt]){if(We!==1||xt!==1)do if(We--,xt--,xt<0||je[We]!==ze[xt]){var ht=`
`+je[We].replace(" at new "," at ");return ie.displayName&&ht.includes("<anonymous>")&&(ht=ht.replace("<anonymous>",ie.displayName)),typeof ie=="function"&&Ei.set(ie,ht),ht}while(We>=1&&xt>=0);break}}}finally{mn=!1,Or.current=ye,Vr(),Error.prepareStackTrace=we}var ti=ie?ie.displayName||ie.name:"",Ri=ti?Wr(ti):"";return typeof ie=="function"&&Ei.set(ie,Ri),Ri}function on(ie,W,Y){return Rn(ie,!1)}function Ur(ie){var W=ie.prototype;return!!(W&&W.isReactComponent)}function gr(ie,W,Y){if(ie==null)return"";if(typeof ie=="function")return Rn(ie,Ur(ie));if(typeof ie=="string")return Wr(ie);switch(ie){case N:return Wr("Suspense");case H:return Wr("SuspenseList")}if(typeof ie=="object")switch(ie.$$typeof){case L:return on(ie.render);case X:return gr(ie.type,W,Y);case re:{var ue=ie,we=ue._payload,ye=ue._init;try{return gr(ye(we),W,Y)}catch{}}}return""}var tr=Object.prototype.hasOwnProperty,co={},Fr=$e.ReactDebugCurrentFrame;function Da(ie){if(ie){var W=ie._owner,Y=gr(ie.type,ie._source,W?W.type:null);Fr.setExtraStackFrame(Y)}else Fr.setExtraStackFrame(null)}function ma(ie,W,Y,ue,we){{var ye=Function.call.bind(tr);for(var Me in ie)if(ye(ie,Me)){var je=void 0;try{if(typeof ie[Me]!="function"){var ze=Error((ue||"React class")+": "+Y+" type `"+Me+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof ie[Me]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw ze.name="Invariant Violation",ze}je=ie[Me](W,Me,ue,Y,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(We){je=We}je&&!(je instanceof Error)&&(Da(we),Le("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",ue||"React class",Y,Me,typeof je),Da(null)),je instanceof Error&&!(je.message in co)&&(co[je.message]=!0,Da(we),Le("Failed %s type: %s",Y,je.message),Da(null))}}}var _o=Array.isArray;function Oo(ie){return _o(ie)}function ba(ie){{var W=typeof Symbol=="function"&&Symbol.toStringTag,Y=W&&ie[Symbol.toStringTag]||ie.constructor.name||"Object";return Y}}function Uo(ie){try{return Io(ie),!1}catch{return!0}}function Io(ie){return""+ie}function jo(ie){if(Uo(ie))return Le("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",ba(ie)),Io(ie)}var Yo=$e.ReactCurrentOwner,xs={key:!0,ref:!0,__self:!0,__source:!0},$o,Fi;function an(ie){if(tr.call(ie,"ref")){var W=Object.getOwnPropertyDescriptor(ie,"ref").get;if(W&&W.isReactWarning)return!1}return ie.ref!==void 0}function ir(ie){if(tr.call(ie,"key")){var W=Object.getOwnPropertyDescriptor(ie,"key").get;if(W&&W.isReactWarning)return!1}return ie.key!==void 0}function jr(ie,W){typeof ie.ref=="string"&&Yo.current}function jn(ie,W){{var Y=function(){$o||($o=!0,Le("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",W))};Y.isReactWarning=!0,Object.defineProperty(ie,"key",{get:Y,configurable:!0})}}function yo(ie,W){{var Y=function(){Fi||(Fi=!0,Le("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",W))};Y.isReactWarning=!0,Object.defineProperty(ie,"ref",{get:Y,configurable:!0})}}var To=function(ie,W,Y,ue,we,ye,Me){var je={$$typeof:s,type:ie,key:W,ref:Y,props:Me,_owner:ye};return je._store={},Object.defineProperty(je._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(je,"_self",{configurable:!1,enumerable:!1,writable:!1,value:ue}),Object.defineProperty(je,"_source",{configurable:!1,enumerable:!1,writable:!1,value:we}),Object.freeze&&(Object.freeze(je.props),Object.freeze(je)),je};function Wo(ie,W,Y,ue,we){{var ye,Me={},je=null,ze=null;Y!==void 0&&(jo(Y),je=""+Y),ir(W)&&(jo(W.key),je=""+W.key),an(W)&&(ze=W.ref,jr(W,we));for(ye in W)tr.call(W,ye)&&!xs.hasOwnProperty(ye)&&(Me[ye]=W[ye]);if(ie&&ie.defaultProps){var We=ie.defaultProps;for(ye in We)Me[ye]===void 0&&(Me[ye]=We[ye])}if(je||ze){var xt=typeof ie=="function"?ie.displayName||ie.name||"Unknown":ie;je&&jn(Me,xt),ze&&yo(Me,xt)}return To(ie,je,ze,we,ue,Yo.current,Me)}}var qr=$e.ReactCurrentOwner,wr=$e.ReactDebugCurrentFrame;function bn(ie){if(ie){var W=ie._owner,Y=gr(ie.type,ie._source,W?W.type:null);wr.setExtraStackFrame(Y)}else wr.setExtraStackFrame(null)}var uo;uo=!1;function wa(ie){return typeof ie=="object"&&ie!==null&&ie.$$typeof===s}function ga(){{if(qr.current){var ie=Nt(qr.current.type);if(ie)return`

Check the render method of \``+ie+"`."}return""}}function ra(ie){return""}var tc={};function ml(ie){{var W=ga();if(!W){var Y=typeof ie=="string"?ie:ie.displayName||ie.name;Y&&(W=`

Check the top-level render call using <`+Y+">.")}return W}}function ic(ie,W){{if(!ie._store||ie._store.validated||ie.key!=null)return;ie._store.validated=!0;var Y=ml(W);if(tc[Y])return;tc[Y]=!0;var ue="";ie&&ie._owner&&ie._owner!==qr.current&&(ue=" It was passed a child from "+Nt(ie._owner.type)+"."),bn(ie),Le('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',Y,ue),bn(null)}}function Ks(ie,W){{if(typeof ie!="object")return;if(Oo(ie))for(var Y=0;Y<ie.length;Y++){var ue=ie[Y];wa(ue)&&ic(ue,W)}else if(wa(ie))ie._store&&(ie._store.validated=!0);else if(ie){var we=xe(ie);if(typeof we=="function"&&we!==ie.entries)for(var ye=we.call(ie),Me;!(Me=ye.next()).done;)wa(Me.value)&&ic(Me.value,W)}}}function Tt(ie){{var W=ie.type;if(W==null||typeof W=="string")return;var Y;if(typeof W=="function")Y=W.propTypes;else if(typeof W=="object"&&(W.$$typeof===L||W.$$typeof===X))Y=W.propTypes;else return;if(Y){var ue=Nt(W);ma(Y,ie.props,"prop",ue,ie)}else if(W.PropTypes!==void 0&&!uo){uo=!0;var we=Nt(W);Le("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",we||"Unknown")}typeof W.getDefaultProps=="function"&&!W.getDefaultProps.isReactClassApproved&&Le("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Ta(ie){{for(var W=Object.keys(ie.props),Y=0;Y<W.length;Y++){var ue=W[Y];if(ue!=="children"&&ue!=="key"){bn(ie),Le("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",ue),bn(null);break}}ie.ref!==null&&(bn(ie),Le("Invalid attribute `ref` supplied to `React.Fragment`."),bn(null))}}var Ga={};function Ma(ie,W,Y,ue,we,ye){{var Me=Di(ie);if(!Me){var je="";(ie===void 0||typeof ie=="object"&&ie!==null&&Object.keys(ie).length===0)&&(je+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var ze=ra();ze?je+=ze:je+=ga();var We;ie===null?We="null":Oo(ie)?We="array":ie!==void 0&&ie.$$typeof===s?(We="<"+(Nt(ie.type)||"Unknown")+" />",je=" Did you accidentally export a JSX literal instead of a component?"):We=typeof ie,Le("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",We,je)}var xt=Wo(ie,W,Y,we,ye);if(xt==null)return xt;if(Me){var ht=W.children;if(ht!==void 0)if(ue)if(Oo(ht)){for(var ti=0;ti<ht.length;ti++)Ks(ht[ti],ie);Object.freeze&&Object.freeze(ht)}else Le("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else Ks(ht,ie)}if(tr.call(W,"key")){var Ri=Nt(ie),xi=Object.keys(W).filter(function(un){return un!=="key"}),ei=xi.length>0?"{key: someKey, "+xi.join(": ..., ")+": ...}":"{key: someKey}";if(!Ga[Ri+ei]){var Yi=xi.length>0?"{"+xi.join(": ..., ")+": ...}":"{}";Le(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,ei,Ri,Yi,Ri),Ga[Ri+ei]=!0}}return ie===_?Ta(xt):Tt(xt),xt}}function hn(ie,W,Y){return Ma(ie,W,Y,!0)}function Ko(ie,W,Y){return Ma(ie,W,Y,!1)}var it=Ko,bi=hn;SA.Fragment=_,SA.jsx=it,SA.jsxs=bi})();Ak.exports=SA;var i4=Ak.exports;const Ck="label";function wO(d,s){typeof d=="function"?d(s):d&&(d.current=s)}function n4(d,s){const u=d.options;u&&s&&Object.assign(u,s)}function Ik(d,s){d.labels=s}function Rk(d,s,u=Ck){const _=[];d.datasets=s.map(v=>{const E=d.datasets.find(A=>A[u]===v[u]);return!E||!v.data||_.includes(E)?{...v}:(_.push(E),Object.assign(E,v),E)})}function r4(d,s=Ck){const u={labels:[],datasets:[]};return Ik(u,d.labels),Rk(u,d.datasets,s),u}function o4(d,s){const{height:u=150,width:_=300,redraw:v=!1,datasetIdKey:E,type:A,data:r,options:L,plugins:N=[],fallbackContent:H,updateMode:X,...re}=d,he=ft.useRef(null),de=ft.useRef(null),ve=()=>{he.current&&(de.current=new gD(he.current,{type:A,data:r4(r,E),options:L&&{...L},plugins:N}),wO(s,de.current))},xe=()=>{wO(s,null),de.current&&(de.current.destroy(),de.current=null)};return ft.useEffect(()=>{!v&&de.current&&L&&n4(de.current,L)},[v,L]),ft.useEffect(()=>{!v&&de.current&&Ik(de.current.config.data,r.labels)},[v,r.labels]),ft.useEffect(()=>{!v&&de.current&&r.datasets&&Rk(de.current.config.data,r.datasets,E)},[v,r.datasets]),ft.useEffect(()=>{de.current&&(v?(xe(),setTimeout(ve)):de.current.update(X))},[v,L,r.labels,r.datasets,X]),ft.useEffect(()=>{de.current&&(xe(),setTimeout(ve))},[A]),ft.useEffect(()=>(ve(),()=>xe()),[]),i4.jsx("canvas",{ref:he,role:"img",height:u,width:_,...re,children:H})}const TO=ft.forwardRef(o4);function a4(d,s){const{getAccessTokenSilently:u}=kb(),[_,v]=ft.useState([]),[E,A]=ft.useState([]),[r,L]=ft.useState([]),[N,H]=ft.useState(!1),[X,re]=ft.useState(null);return ft.useEffect(()=>{if(!d){v([]),A([]),L([]),H(!1);return}let he=!1;return H(!0),re(null),(async()=>{var ve,xe,$e,Le,Ke,Ge,Ye,mt,Ct,Vt,ui,Di,si,di,Nt,Ii;try{const Qt=await u(),_t={fieldId:d};s!=null&&s.specie&&(_t.specie=s.specie),s!=null&&s.variety&&(_t.variety=s.variety),s!=null&&s.startDate&&(_t.startDate=s.startDate),s!=null&&s.endDate&&(_t.endDate=s.endDate),s!=null&&s.harvestName&&(_t.harvestName=s.harvestName),console.log(" Loading harvest summary with params:",_t);const Et={Authorization:`Bearer ${Qt}`},[fi,rn,zn]=await Promise.all([sp.get("/analytics/harvests/summary",{params:_t,headers:Et}),sp.get("/analytics/harvests/summary/timeline",{params:_t,headers:Et}),sp.get("/analytics/harvests/summary/payments/timeline",{params:_t,headers:Et})]);if(he)return;console.log(" SUMMARY DATA:",(ve=fi.data)==null?void 0:ve.data),console.log(" TIMELINE DATA:",(xe=rn.data)==null?void 0:xe.data),console.log(" PAYMENTS DATA:",($e=zn.data)==null?void 0:$e.data),((Ke=(Le=fi.data)==null?void 0:Le.data)==null?void 0:Ke.length)>0?(console.log(" Summary tiene",fi.data.data.length,"registros"),console.log("   Primer registro:",fi.data.data[0])):console.warn(" Summary est VACO"),((Ye=(Ge=rn.data)==null?void 0:Ge.data)==null?void 0:Ye.length)>0?(console.log(" Timeline tiene",rn.data.data.length,"registros"),console.log("   Primer registro:",rn.data.data[0]),console.log("   ltimo registro:",rn.data.data[rn.data.data.length-1])):console.warn(" Timeline est VACO"),((Ct=(mt=zn.data)==null?void 0:mt.data)==null?void 0:Ct.length)>0?(console.log(" Payments tiene",zn.data.data.length,"registros"),console.log("   Primer registro:",zn.data.data[0]),console.log("   ltimo registro:",zn.data.data[zn.data.data.length-1])):console.warn(" Payments est VACO"),v(((Vt=fi.data)==null?void 0:Vt.data)??[]),A(((ui=rn.data)==null?void 0:ui.data)??[]),L(((Di=zn.data)==null?void 0:Di.data)??[])}catch(Qt){he||(console.error(" Error loading harvest summary:",Qt),console.error(" Error details:",{message:Qt==null?void 0:Qt.message,response:(si=Qt==null?void 0:Qt.response)==null?void 0:si.data,status:(di=Qt==null?void 0:Qt.response)==null?void 0:di.status}),re(((Ii=(Nt=Qt==null?void 0:Qt.response)==null?void 0:Nt.data)==null?void 0:Ii.message)??"Error al cargar datos"),v([]),A([]),L([]))}finally{he||H(!1)}})(),()=>{he=!0}},[d,s==null?void 0:s.specie,s==null?void 0:s.variety,s==null?void 0:s.startDate,s==null?void 0:s.endDate,s==null?void 0:s.harvestName,u]),{summary:_,timeline:E,payments:r,loading:N,error:X}}gD.register(MR,PR,xA,bA,_T,lT,gT,Ej,_j,t4);function SO(d){const s=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],u=d.map(r=>{try{let L;if(r.match(/^\d{1,2}\/\d{1,2}\/\d{4}/)){const[X]=r.split(" "),[re,he,de]=X.split("/").map(Number);L=new Date(de,re-1,he)}else r.includes("T")?L=new Date(r):r.match(/^\d{4}-\d{2}-\d{2}$/)?L=new Date(r+"T12:00:00Z"):L=new Date(r);if(isNaN(L.getTime()))return console.warn("Fecha invlida:",r),{day:0,month:0,valid:!1};const N=r.match(/^\d{1,2}\/\d{1,2}\/\d{4}/)?L.getDate():L.getUTCDate(),H=r.match(/^\d{1,2}\/\d{1,2}\/\d{4}/)?L.getMonth():L.getUTCMonth();return{day:N,month:H,valid:!isNaN(N)&&!isNaN(H)&&N>0&&N<=31&&H>=0&&H<=11}}catch(L){return console.error("Error parseando fecha:",r,L),{day:0,month:0,valid:!1}}}),_=[],v=[];let E=-1,A=0;if(u.forEach((r,L)=>{if(!r.valid){_.push("?");return}if(_.push(r.day.toString()),r.month!==E){if(E!==-1){const N=Math.floor((A+L-1)/2);v.push({index:N,label:s[E]})}E=r.month,A=L}}),E!==-1){const r=Math.floor((A+u.length-1)/2);v.push({index:r,label:s[E]})}return{labels:_,months:v}}function s4({fieldId:d,fieldName:s,filters:u}){const[_,v]=ft.useState(!0),[E,A]=ft.useState(""),[r,L]=ft.useState("");ft.useEffect(()=>{A((u==null?void 0:u.initialStartDate)??""),L((u==null?void 0:u.initialEndDate)??"")},[u==null?void 0:u.initialStartDate,u==null?void 0:u.initialEndDate]);const{summary:N,timeline:H,payments:X,loading:re,error:he}=a4(d,{specie:u==null?void 0:u.specie,variety:u==null?void 0:u.variety,startDate:E||void 0,endDate:r||void 0,harvestName:u==null?void 0:u.harvestName});ft.useMemo(()=>{var di,Nt,Ii,Qt,_t,Et;if(!N.length)return{kg_totales:0,superficie_ha:0,kg_por_ha:0,kg_por_cosechero:0,pct_exportacion_campo:0,pct_mercado_interno:0,pct_exportacion_procesos:0,pct_exportacion_final:0};const Ge=N.reduce((fi,rn)=>fi+Number(rn.kg_totales??0),0),Ye=Number(((di=N[0])==null?void 0:di.superficie_ha)??0),mt=Ye>0?Ge/Ye:0,Ct=Number(((Nt=N[0])==null?void 0:Nt.kg_por_cosechero)??0),Vt=Number(((Ii=N[0])==null?void 0:Ii.pct_exportacion_campo)??0),ui=Number(((Qt=N[0])==null?void 0:Qt.pct_mercado_interno)??0),Di=Number(((_t=N[0])==null?void 0:_t.pct_exportacion_procesos)??0),si=Number(((Et=N[0])==null?void 0:Et.pct_exportacion_final)??0);return{kg_totales:Ge,superficie_ha:Ye,kg_por_ha:mt,kg_por_cosechero:Ct,pct_exportacion_campo:Vt,pct_mercado_interno:ui,pct_exportacion_procesos:Di,pct_exportacion_final:si}},[N]);const de=ft.useMemo(()=>{if(!H.length)return null;const{labels:Ge,months:Ye}=SO(H.map(Ct=>Ct.fecha)),mt=H.map(Ct=>{const Vt=Number(Ct.kg_exportacion)+Number(Ct.kg_mercado_interno);if(Vt===0)return{exp:0,int:0};const ui=Math.round(Number(Ct.kg_exportacion)/Vt*100),Di=Math.round(Number(Ct.kg_mercado_interno)/Vt*100);return{exp:ui,int:Di}});return{labels:Ge,datasets:[{type:"bar",label:"Kg Exportacin Campo",data:H.map(Ct=>Number(Ct.kg_exportacion)),backgroundColor:"#FF8C42",stack:"stack0",yAxisID:"y",barThickness:"flex",maxBarThickness:35,order:2,datalabels:{display:Ct=>mt[Ct.dataIndex].exp>=5,color:"#000",font:{size:8,weight:"bold"},formatter:(Ct,Vt)=>`${mt[Vt.dataIndex].exp}%`,anchor:"center",align:"center"}},{type:"bar",label:"Kg Mercado Interno",data:H.map(Ct=>Number(Ct.kg_mercado_interno)),backgroundColor:"#90C695",stack:"stack0",yAxisID:"y",barThickness:"flex",maxBarThickness:35,order:2,datalabels:{display:Ct=>mt[Ct.dataIndex].int>=5,color:"#000",font:{size:8,weight:"bold"},formatter:(Ct,Vt)=>`${mt[Vt.dataIndex].int}%`,anchor:"center",align:"center"}},{type:"line",label:"Cosecheros",data:H.map(Ct=>Number(Ct.cosecheros??0)),borderColor:"#F4C430",backgroundColor:"#F4C430",borderWidth:2,pointRadius:6,pointHoverRadius:8,pointStyle:"circle",yAxisID:"y1",tension:0,order:1,datalabels:{display:!0,color:"#000",backgroundColor:"#F4C430",borderRadius:3,font:{size:8,weight:"bold"},padding:2,formatter:Ct=>Ct>0?Ct:"",anchor:"end",align:"top",offset:2}}],months:Ye,originalDates:H.map(Ct=>Ct.fecha)}},[H]),ve=ft.useMemo(()=>{if(!X.length)return null;const{labels:Ge,months:Ye}=SO(X.map(mt=>mt.fecha));return{labels:Ge,datasets:[{type:"bar",label:"Kg/Cosechero",data:X.map(mt=>Number(mt.kg_por_cosechero)),backgroundColor:"#90C695",yAxisID:"y",barThickness:"flex",maxBarThickness:40,order:2,datalabels:{display:mt=>mt.dataset.data[mt.dataIndex]>0,color:"#fff",font:{size:9,weight:"bold"},formatter:mt=>mt===0?"":mt>=1e3?Math.round(mt/100)/10+"k":Math.round(mt),anchor:"center",align:"center"}},{type:"line",label:"Pago/Kg",data:X.map(mt=>Number(mt.pago_kg??0)),borderColor:"#4A90E2",backgroundColor:"#4A90E2",borderWidth:2,pointRadius:6,pointHoverRadius:8,pointStyle:"circle",yAxisID:"y1",tension:0,order:1,datalabels:{display:!0,color:"#fff",backgroundColor:"#4A90E2",borderRadius:3,font:{size:8,weight:"bold"},padding:2,formatter:mt=>mt>0?Math.round(mt):"",anchor:"end",align:"top",offset:2}}],months:Ye,originalDates:X.map(mt=>mt.fecha)}},[X]),xe=ft.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{y:{type:"linear",display:!0,position:"left",stacked:!0,title:{display:!1},ticks:{callback:function(Ge){return Ge>=1e3?(Ge/1e3).toFixed(0)+"k":Ge.toLocaleString()}},grid:{color:"#e0e0e0"}},y1:{type:"linear",display:!0,position:"right",grid:{drawOnChartArea:!1},title:{display:!1},ticks:{stepSize:20}},x:{stacked:!0,grid:{display:!1},ticks:{font:{size:10,weight:"bold"},maxRotation:0,minRotation:0,autoSkip:!1,color:"#374151"}}},plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:15,font:{size:12,weight:"bold"},color:"#1f2937"}},tooltip:{callbacks:{title:function(Ge){var Ct;const Ye=Ge[0].dataIndex,mt=(Ct=de==null?void 0:de.originalDates)==null?void 0:Ct[Ye];if(!mt)return"";try{let Vt;if(mt.match(/^\d{1,2}\/\d{1,2}\/\d{4}/)){const[ui]=mt.split(" "),[Di,si,di]=ui.split("/").map(Number);Vt=new Date(di,Di-1,si)}else mt.includes("T")?Vt=new Date(mt):Vt=new Date(mt+"T12:00:00Z");return Vt.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch{return mt}},label:function(Ge){let Ye=Ge.dataset.label||"";return Ye&&(Ye+=": "),Ge.parsed.y!==null&&(Ye+=Ge.parsed.y.toLocaleString()),Ye}}}},layout:{padding:{top:10,right:10,bottom:60,left:10}},categoryPercentage:.9,barPercentage:.85}),[de]),$e=ft.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{y:{type:"linear",display:!0,position:"left",title:{display:!1},ticks:{callback:function(Ge){return Ge>=1e3?(Ge/1e3).toFixed(1)+"k":Ge.toLocaleString()}},grid:{color:"#e0e0e0"}},y1:{type:"linear",display:!0,position:"right",grid:{drawOnChartArea:!1},title:{display:!1},ticks:{callback:function(Ge){return"$"+Ge.toLocaleString()}}},x:{grid:{display:!1},ticks:{font:{size:10,weight:"bold"},maxRotation:0,minRotation:0,color:"#374151"}}},plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:15,font:{size:12,weight:"bold"},color:"#1f2937"}},tooltip:{callbacks:{title:function(Ge){var Ct;const Ye=Ge[0].dataIndex,mt=(Ct=ve==null?void 0:ve.originalDates)==null?void 0:Ct[Ye];if(!mt)return"";try{let Vt;if(mt.match(/^\d{1,2}\/\d{1,2}\/\d{4}/)){const[ui]=mt.split(" "),[Di,si,di]=ui.split("/").map(Number);Vt=new Date(di,Di-1,si)}else mt.includes("T")?Vt=new Date(mt):Vt=new Date(mt+"T12:00:00Z");return Vt.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}catch{return mt}},label:function(Ge){let Ye=Ge.dataset.label||"";return Ye&&(Ye+=": "),Ge.parsed.y!==null&&(Ge.datasetIndex===1?Ye+="$"+Ge.parsed.y.toLocaleString():Ye+=Ge.parsed.y.toLocaleString()),Ye}}}},layout:{padding:{top:10,right:10,bottom:60,left:10}},categoryPercentage:.8,barPercentage:.9}),[ve]),Le=ft.useMemo(()=>({id:"timelineMonthsPlugin",afterDraw(Ge){const{ctx:Ye,chartArea:mt,scales:Ct}=Ge,Vt=de==null?void 0:de.months;!Vt||Vt.length===0||(Ye.save(),Ye.font="bold 14px Arial",Ye.fillStyle="#1f2937",Ye.textAlign="center",Vt.forEach(ui=>{const Di=Ct.x.getPixelForValue(ui.index),si=mt.bottom+40;Ye.fillText(ui.label,Di,si)}),Ye.restore())}}),[de]),Ke=ft.useMemo(()=>({id:"paymentsMonthsPlugin",afterDraw(Ge){const{ctx:Ye,chartArea:mt,scales:Ct}=Ge,Vt=ve==null?void 0:ve.months;!Vt||Vt.length===0||(Ye.save(),Ye.font="bold 14px Arial",Ye.fillStyle="#1f2937",Ye.textAlign="center",Vt.forEach(ui=>{const Di=Ct.x.getPixelForValue(ui.index),si=mt.bottom+40;Ye.fillText(ui.label,Di,si)}),Ye.restore())}}),[ve]);return Fe.jsxDEV("div",{className:"box",style:{backgroundColor:"#fff"},children:[Fe.jsxDEV("header",{className:"is-flex is-justify-content-space-between is-align-items-center",onClick:()=>v(Ge=>!Ge),style:{cursor:"pointer",borderBottom:"2px solid #f0f0f0",paddingBottom:"1rem"},children:[Fe.jsxDEV("div",{children:[Fe.jsxDEV("h3",{className:"title is-5",style:{marginBottom:"0.25rem"},children:" Informe de Cosecha"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:624,columnNumber:11},this),Fe.jsxDEV("p",{className:"is-size-7 has-text-grey",children:["Campo: ",s]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:625,columnNumber:11},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:623,columnNumber:9},this),Fe.jsxDEV("button",{className:"button is-small is-ghost",children:_?"":""},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:627,columnNumber:9},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:618,columnNumber:7},this),_&&Fe.jsxDEV("div",{className:"mt-4",children:[re&&Fe.jsxDEV("progress",{className:"progress is-primary",max:"100",children:"Cargando..."},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:636,columnNumber:13},this),he&&Fe.jsxDEV("div",{className:"notification is-danger",children:Fe.jsxDEV("p",{children:[Fe.jsxDEV("strong",{children:"Error:"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:643,columnNumber:18},this)," ",he]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:643,columnNumber:15},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:642,columnNumber:13},this),!re&&!he&&N.length===0&&Fe.jsxDEV("div",{className:"notification is-warning",children:[Fe.jsxDEV("p",{className:"has-text-weight-bold mb-2",children:"No hay datos disponibles."},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:649,columnNumber:15},this),Fe.jsxDEV("details",{className:"mt-3",children:[Fe.jsxDEV("summary",{style:{cursor:"pointer",fontWeight:"bold"},children:" Ver informacin de debug"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:651,columnNumber:17},this),Fe.jsxDEV("div",{className:"content mt-2",style:{fontSize:"0.85rem"},children:[Fe.jsxDEV("p",{children:[Fe.jsxDEV("strong",{children:"Campo ID:"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:655,columnNumber:22},this)," ",d]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:655,columnNumber:19},this),Fe.jsxDEV("p",{children:[Fe.jsxDEV("strong",{children:"Campo:"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:656,columnNumber:22},this)," ",s]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:656,columnNumber:19},this),Fe.jsxDEV("p",{children:[Fe.jsxDEV("strong",{children:"Cosecha:"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:657,columnNumber:22},this)," ",(u==null?void 0:u.harvestName)||"No especificada"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:657,columnNumber:19},this),Fe.jsxDEV("p",{children:[Fe.jsxDEV("strong",{children:"Especie:"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:658,columnNumber:22},this)," ",(u==null?void 0:u.specie)||"Todas"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:658,columnNumber:19},this),Fe.jsxDEV("p",{children:[Fe.jsxDEV("strong",{children:"Variedad:"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:659,columnNumber:22},this)," ",(u==null?void 0:u.variety)||"Todas"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:659,columnNumber:19},this),Fe.jsxDEV("p",{children:[Fe.jsxDEV("strong",{children:"Fecha inicio:"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:660,columnNumber:22},this)," ",E||"No especificada"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:660,columnNumber:19},this),Fe.jsxDEV("p",{children:[Fe.jsxDEV("strong",{children:"Fecha fin:"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:661,columnNumber:22},this)," ",r||"No especificada"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:661,columnNumber:19},this),Fe.jsxDEV("p",{className:"mt-3",children:[Fe.jsxDEV("strong",{children:"Sugerencias:"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:663,columnNumber:21},this),Fe.jsxDEV("br",{},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:663,columnNumber:50},this)," Revisa la consola del navegador (F12) para ver los logs detallados",Fe.jsxDEV("br",{},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:664,columnNumber:89},this)," Verifica que el campo y cosecha seleccionados tengan datos",Fe.jsxDEV("br",{},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:665,columnNumber:81},this)," Intenta ampliar el rango de fechas"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:662,columnNumber:19},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:654,columnNumber:17},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:650,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:648,columnNumber:13},this),!re&&!he&&N.length>0&&Fe.jsxDEV(Fe.Fragment,{children:[Fe.jsxDEV("div",{className:"box",style:{backgroundColor:"#fff",border:"1px solid #dee2e6"},children:Fe.jsxDEV("div",{className:"table-container",children:Fe.jsxDEV("table",{className:"table is-fullwidth is-bordered is-hoverable",style:{fontSize:"0.9rem"},children:[Fe.jsxDEV("thead",{children:Fe.jsxDEV("tr",{style:{backgroundColor:"#1f2937",color:"#fff"},children:[Fe.jsxDEV("th",{children:"Variedad"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:681,columnNumber:25},this),Fe.jsxDEV("th",{children:"Kg Totales"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:682,columnNumber:25},this),Fe.jsxDEV("th",{children:"Superficie"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:683,columnNumber:25},this),Fe.jsxDEV("th",{children:"Kg/ha"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:684,columnNumber:25},this),Fe.jsxDEV("th",{children:"Costo/Kg"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:685,columnNumber:25},this),Fe.jsxDEV("th",{children:"Pago/Kg"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:686,columnNumber:25},this),Fe.jsxDEV("th",{children:"Kg/Cosechero"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:687,columnNumber:25},this),Fe.jsxDEV("th",{children:"% M. Interno"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:688,columnNumber:25},this),Fe.jsxDEV("th",{children:"% Exp. Campo"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:689,columnNumber:25},this),Fe.jsxDEV("th",{children:"% Exp. Procesos"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:690,columnNumber:25},this),Fe.jsxDEV("th",{children:"% Exp. Final"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:691,columnNumber:25},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:680,columnNumber:23},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:679,columnNumber:21},this),Fe.jsxDEV("tbody",{children:N.map((Ge,Ye)=>Fe.jsxDEV("tr",{children:[Fe.jsxDEV("td",{children:Fe.jsxDEV("strong",{children:Ge.variety??""},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:697,columnNumber:31},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:697,columnNumber:27},this),Fe.jsxDEV("td",{children:Number(Ge.kg_totales??0).toLocaleString()},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:698,columnNumber:27},this),Fe.jsxDEV("td",{children:Number(Ge.superficie_ha??0).toFixed(2)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:699,columnNumber:27},this),Fe.jsxDEV("td",{children:Number(Ge.kg_por_ha??0).toLocaleString()},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:700,columnNumber:27},this),Fe.jsxDEV("td",{children:Ge.costo_total_kg?Number(Ge.costo_total_kg).toFixed(2):""},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:701,columnNumber:27},this),Fe.jsxDEV("td",{children:Ge.pago_kg?Number(Ge.pago_kg).toLocaleString():""},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:702,columnNumber:27},this),Fe.jsxDEV("td",{children:Number(Ge.kg_por_cosechero??0).toLocaleString()},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:703,columnNumber:27},this),Fe.jsxDEV("td",{children:[Number(Ge.pct_mercado_interno??0).toFixed(0),"%"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:704,columnNumber:27},this),Fe.jsxDEV("td",{children:[Number(Ge.pct_exportacion_campo??0).toFixed(0),"%"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:705,columnNumber:27},this),Fe.jsxDEV("td",{children:[Number(Ge.pct_exportacion_procesos??0).toFixed(0),"%"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:706,columnNumber:27},this),Fe.jsxDEV("td",{children:[Number(Ge.pct_exportacion_final??0).toFixed(0),"%"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:707,columnNumber:27},this)]},Ye,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:696,columnNumber:25},this))},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:694,columnNumber:21},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:678,columnNumber:19},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:677,columnNumber:17},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:676,columnNumber:15},this),de&&Fe.jsxDEV("div",{className:"box",style:{backgroundColor:"#fff",border:"1px solid #dee2e6"},children:[Fe.jsxDEV("h4",{className:"title is-5 mb-4",style:{textTransform:"uppercase",fontSize:"1.1rem",fontWeight:"bold",color:"#1f2937",textAlign:"center",letterSpacing:"0.5px"},children:"KILOS COSECHADOS Y CANTIDAD COSECHEROS"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:718,columnNumber:19},this),Fe.jsxDEV("div",{style:{height:"500px"},children:Fe.jsxDEV(TO,{type:"bar",data:de,options:xe,plugins:[Le]},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:732,columnNumber:21},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:731,columnNumber:19},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:717,columnNumber:17},this),ve&&Fe.jsxDEV("div",{className:"box",style:{backgroundColor:"#fff",border:"1px solid #dee2e6"},children:[Fe.jsxDEV("h4",{className:"title is-5 mb-4",style:{textTransform:"uppercase",fontSize:"1.1rem",fontWeight:"bold",color:"#1f2937",textAlign:"center",letterSpacing:"0.5px"},children:"KG/PERSONA Y PAGO/KG"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:745,columnNumber:19},this),Fe.jsxDEV("div",{style:{height:"500px"},children:Fe.jsxDEV(TO,{type:"bar",data:ve,options:$e,plugins:[Ke]},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:759,columnNumber:21},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:758,columnNumber:19},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:744,columnNumber:17},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:674,columnNumber:13},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:634,columnNumber:9},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:616,columnNumber:5},this)}const Dk=()=>{const{user:d,isAuthenticated:s,getAccessTokenSilently:u}=kb(),[_,v]=ft.useState(null),[E,A]=ft.useState(null),[r,L]=ft.useState(!0),[N,H]=ft.useState(null);return ft.useEffect(()=>{(async()=>{if(!s||!(d!=null&&d.email)){L(!1);return}try{const re=await u(),he=await fetch("http://localhost:3000/api/api/users",{headers:{Authorization:`Bearer ${re}`}});if(!he.ok)throw new Error("Error al obtener usuarios");const de=await he.json();let ve;if(Array.isArray(de))ve=de;else if(de.users&&Array.isArray(de.users))ve=de.users;else if(de.data&&Array.isArray(de.data))ve=de.data;else throw console.error(" Formato de respuesta inesperado:",de),new Error("Formato de respuesta invlido del servidor");console.log(" Usuarios obtenidos:",ve.length);const xe=ve.find($e=>$e.email===d.email);xe?(console.log(" Usuario encontrado:",{email:xe.email,role:xe.role,name:xe.name}),A(xe),v(xe.role)):(console.warn(" Usuario no encontrado en la lista. Email buscado:",d.email),console.warn("Emails disponibles:",ve.map($e=>$e.email)),v("pending"))}catch(re){console.error(" Error al obtener rol del usuario:",re),H(re.message||"Error al cargar rol"),v("pending")}finally{L(!1)}})()},[s,d,u]),{userRole:_,userData:E,loading:r,error:N,isAdmin:_==="admin",isGerencia:_==="gerencia",isCampo:_==="campo",isPending:_==="pending"}};function l4(d){if(!d)return{start:void 0,end:void 0};const s=d.match(/\d{4}/g);if(s&&s.length>=1){s.sort();const u=s[0],_=s[s.length-1];return{start:`${u}-01-01`,end:`${_}-12-31`}}return{start:void 0,end:void 0}}function EO(d){const s=new Date,u=new Date;return u.setDate(u.getDate()-d),{start:u.toISOString().split("T")[0],end:s.toISOString().split("T")[0]}}function AO(d){if(!d||!d.coordinates||!d.coordinates[0])return 0;try{const s=d.coordinates[0];let u=0;for(let v=0;v<s.length-1;v++){const[E,A]=s[v],[r,L]=s[v+1];u+=E*L-r*A}u=Math.abs(u)/2;const _=u*111e3*111e3*Math.cos(-33*Math.PI/180)/1e4;return Math.round(_*100)/100}catch{return 0}}function c4(){const{user:d,getAccessTokenSilently:s,logout:u}=kb(),{isAdmin:_,userRole:v}=Dk(),[E,A]=ft.useState(!0),[r,L]=ft.useState([]),[N,H]=ft.useState(null),[X,re]=ft.useState(null),[he,de]=ft.useState([]),[ve,xe]=ft.useState([]),[$e,Le]=ft.useState([]),[Ke,Ge]=ft.useState(null),[Ye,mt]=ft.useState(null),[Ct,Vt]=ft.useState(null),[ui,Di]=ft.useState(!1),[si,di]=ft.useState(""),[Nt,Ii]=ft.useState(""),[Qt,_t]=ft.useState("20days"),[Et,fi]=ft.useState([]),[rn,zn]=ft.useState(5),[er,Mn]=ft.useState("desc");ft.useEffect(()=>{(async()=>{try{const Xi=await s(),Rn=await sp.get("/fields",{headers:{Authorization:`Bearer ${Xi}`}});L(Rn.data)}catch(Xi){console.error("Error cargando fields:",Xi)}finally{A(!1)}})()},[s]);const pn=async Ei=>{const Xi=await s(),Rn=await sp.get(`/fields/${Ei}`,{headers:{Authorization:`Bearer ${Xi}`}});H(Rn.data)},pr=async Ei=>{try{const Xi=await s(),[Rn,on]=await Promise.all([sp.get(`/analytics/field/${Ei}/harvests`,{headers:{Authorization:`Bearer ${Xi}`}}),sp.get(`/analytics/field/${Ei}/species-list`,{headers:{Authorization:`Bearer ${Xi}`}})]),Ur=(Rn.data.data??[]).sort((tr,co)=>tr.localeCompare(co,"es",{sensitivity:"base"})),gr=(on.data.data??[]).sort((tr,co)=>tr.localeCompare(co,"es",{sensitivity:"base"}));de(Ur),xe(gr),Ge(Ur[0]??null),mt(gr[0]??null),Vt(null),re(null),_t("20days")}catch(Xi){console.error("Error cargando filtros:",Xi),de([]),xe([]),Ge(null),mt(null)}};ft.useEffect(()=>{if(!N||!Ke){Le([]);return}(async()=>{var Xi;try{const Rn=await s(),on=await sp.get("/analytics/harvests/summary",{headers:{Authorization:`Bearer ${Rn}`},params:{fieldId:N.id,harvestName:Ke,specie:Ye}});if((Xi=on.data)!=null&&Xi.data){const gr=[...new Set(on.data.data.map(tr=>tr.variety).filter(tr=>tr&&tr!=="Sin Variedad"))].sort((tr,co)=>tr.localeCompare(co,"es",{sensitivity:"base"}));Le(gr),gr.length>0&&!Ct&&Vt(gr[0])}}catch(Rn){console.error("Error cargando variedades:",Rn),Le([])}})()},[N==null?void 0:N.id,Ke,Ye,s]),ft.useEffect(()=>{if(!N||!Ke){fi([]);return}(async()=>{try{const Xi=await s(),Rn=await sp.get(`/analytics/field/${N.name}/sectors/production`,{headers:{Authorization:`Bearer ${Xi}`},params:{harvest:Ke,species:Ye||void 0}});fi(Rn.data.data??[])}catch(Xi){console.error("Error cargando produccin de sectores:",Xi),fi([])}})()},[N==null?void 0:N.name,Ke,Ye,s]);const Vr=ft.useMemo(()=>Qt==="custom"?{start:si,end:Nt}:Qt==="20days"?EO(20):Qt==="30days"?EO(30):l4(Ke),[Qt,si,Nt,Ke]),Or=ft.useMemo(()=>[...Et.map(Rn=>{var tr;const on=(tr=N==null?void 0:N.sectors)==null?void 0:tr.find(co=>co.name.toLowerCase()===Rn.sector.toLowerCase()),Ur=on?AO(on.polygon):0,gr=Ur>0?Number(Rn.kg_total)/Ur:0;return{...Rn,hectares:Ur,kg_per_ha:Math.round(gr)}})].sort((Rn,on)=>er==="desc"?on.kg_per_ha-Rn.kg_per_ha:Rn.kg_per_ha-on.kg_per_ha).slice(0,rn),[Et,N==null?void 0:N.sectors,rn,er]),kr=Math.max(...Or.map(Ei=>Ei.kg_per_ha),1),Wr=ft.useMemo(()=>{if(!N||!N.sectors)return null;const Ei=N.sectors.filter((Xi,Rn,on)=>Xi.polygon&&Rn===on.findIndex(Ur=>Ur.name.toLowerCase()===Xi.name.toLowerCase()));return{...N,sectors:Ei.map(Xi=>{const Rn=Et.find(on=>{var Ur;return((Ur=on.sector)==null?void 0:Ur.toLowerCase())===Xi.name.toLowerCase()});return{...Xi,kg_total:Number((Rn==null?void 0:Rn.kg_total)??0),species:(Rn==null?void 0:Rn.specie)??Ye??"other",hectares:AO(Xi.polygon)}})}},[N,Et,Ye]),mn=ft.useMemo(()=>N!=null&&N.sectors?new Set(N.sectors.filter(Xi=>Xi.polygon).map(Xi=>Xi.name.toLowerCase())).size:0,[N==null?void 0:N.sectors]);return Fe.jsxDEV("section",{style:{backgroundColor:"#f5f7fa",minHeight:"100vh",padding:"2rem 0"},children:Fe.jsxDEV("div",{className:"container",children:[Fe.jsxDEV("div",{className:"box",style:{backgroundColor:"#64748b",border:"none",marginBottom:"2rem",padding:"1.5rem 2rem"},children:[Fe.jsxDEV("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[Fe.jsxDEV("div",{children:[Fe.jsxDEV("h1",{className:"title is-3",style:{color:"#ffffff",marginBottom:"0.5rem",fontWeight:700},children:" AFT Gestin Agrcola"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:347,columnNumber:15},this),Fe.jsxDEV("p",{style:{color:"rgba(255,255,255,0.9)",fontSize:"0.95rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[Fe.jsxDEV(kN,{size:16},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:351,columnNumber:17},this),d==null?void 0:d.email,"  ",Fe.jsxDEV("span",{className:"tag is-light is-small",children:v},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:352,columnNumber:33},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:350,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:346,columnNumber:13},this),Fe.jsxDEV("button",{className:"button",onClick:()=>u({logoutParams:{returnTo:window.location.origin}}),style:{backgroundColor:"rgba(255,255,255,0.2)",color:"#ffffff",border:"1px solid rgba(255,255,255,0.3)"},children:[Fe.jsxDEV("span",{className:"icon",children:Fe.jsxDEV(r2,{size:18},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:371,columnNumber:17},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:370,columnNumber:15},this),Fe.jsxDEV("span",{children:"Cerrar sesin"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:373,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:355,columnNumber:13},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:345,columnNumber:11},this),Fe.jsxDEV("div",{style:{display:"flex",gap:"0.75rem",borderTop:"1px solid rgba(255,255,255,0.2)",paddingTop:"1rem"},children:[Fe.jsxDEV(Cb,{to:"/dashboard",style:{color:"#ffffff",padding:"0.5rem 1rem",borderRadius:"6px",backgroundColor:"rgba(255,255,255,0.15)",textDecoration:"none",fontSize:"0.9rem",fontWeight:500},children:"Dashboard"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:379,columnNumber:13},this),_&&Fe.jsxDEV(Cb,{to:"/usuarios",style:{color:"#ffffff",padding:"0.5rem 1rem",borderRadius:"6px",backgroundColor:"rgba(139, 92, 246, 0.3)",textDecoration:"none",fontSize:"0.9rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.5rem"},children:[Fe.jsxDEV(o2,{size:16},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:410,columnNumber:17},this)," Usuarios"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:395,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:378,columnNumber:11},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:336,columnNumber:9},this),E&&Fe.jsxDEV("progress",{className:"progress is-primary",max:"100"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:416,columnNumber:21},this),Fe.jsxDEV("div",{className:"box",style:{backgroundColor:"#ffffff"},children:[Fe.jsxDEV("label",{className:"label",style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#1e293b"},children:[Fe.jsxDEV(GM,{size:18},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:421,columnNumber:13},this),"Seleccionar Campo"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:420,columnNumber:11},this),Fe.jsxDEV("div",{className:"select is-fullwidth is-medium",children:Fe.jsxDEV("select",{value:(N==null?void 0:N.id)??"",onChange:async Ei=>{const Xi=r.find(Rn=>String(Rn.id)===Ei.target.value);Xi&&(H(null),fi([]),await pn(Xi.id),await pr(Xi.name))},style:{backgroundColor:"#ffffff",color:"#1e293b",fontWeight:500},children:[Fe.jsxDEV("option",{value:"",style:{color:"#64748b"},children:"-- Selecciona un campo --"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:442,columnNumber:15},this),r.map(Ei=>Fe.jsxDEV("option",{value:Ei.id,style:{color:"#1e293b"},children:Ei.name},Ei.id,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:444,columnNumber:17},this))]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:425,columnNumber:13},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:424,columnNumber:11},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:419,columnNumber:9},this),N&&Fe.jsxDEV("div",{className:"box",style:{backgroundColor:"#ffffff"},children:[Fe.jsxDEV("h3",{className:"title is-5",style:{marginBottom:"1.5rem",color:"#1e293b"},children:"Filtros de Anlisis"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:455,columnNumber:13},this),Fe.jsxDEV("div",{className:"columns",children:[Fe.jsxDEV("div",{className:"column",children:[Fe.jsxDEV("label",{className:"label",style:{color:"#1e293b"},children:"Cosecha"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:458,columnNumber:17},this),Fe.jsxDEV("div",{className:"select is-fullwidth",children:Fe.jsxDEV("select",{value:Ke??"",onChange:Ei=>{Ge(Ei.target.value||null),Vt(null)},style:{backgroundColor:"#ffffff",color:"#1e293b"},children:he.map(Ei=>Fe.jsxDEV("option",{value:Ei,style:{color:"#1e293b"},children:Ei},Ei,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:469,columnNumber:23},this))},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:460,columnNumber:19},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:459,columnNumber:17},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:457,columnNumber:15},this),Fe.jsxDEV("div",{className:"column",children:[Fe.jsxDEV("label",{className:"label",style:{color:"#1e293b"},children:"Especie"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:478,columnNumber:17},this),Fe.jsxDEV("div",{className:"select is-fullwidth",children:Fe.jsxDEV("select",{value:Ye??"",onChange:Ei=>{mt(Ei.target.value||null),Vt(null)},style:{backgroundColor:"#ffffff",color:"#1e293b"},children:ve.map(Ei=>Fe.jsxDEV("option",{value:Ei,style:{color:"#1e293b"},children:Ei},Ei,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:489,columnNumber:23},this))},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:480,columnNumber:19},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:479,columnNumber:17},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:477,columnNumber:15},this),Fe.jsxDEV("div",{className:"column",children:[Fe.jsxDEV("label",{className:"label",style:{color:"#1e293b"},children:"Variedad"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:498,columnNumber:17},this),Fe.jsxDEV("div",{className:"select is-fullwidth",children:Fe.jsxDEV("select",{value:Ct??"",onChange:Ei=>Vt(Ei.target.value||null),disabled:$e.length===0,style:{backgroundColor:"#ffffff",color:"#1e293b"},children:[Fe.jsxDEV("option",{value:"",style:{color:"#64748b"},children:"Todas"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:508,columnNumber:21},this),$e.map(Ei=>Fe.jsxDEV("option",{value:Ei,style:{color:"#1e293b"},children:Ei},Ei,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:510,columnNumber:23},this))]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:500,columnNumber:19},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:499,columnNumber:17},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:497,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:456,columnNumber:13},this),Fe.jsxDEV("div",{style:{borderTop:"1px solid #e2e8f0",paddingTop:"1.5rem",marginTop:"1rem"},children:[Fe.jsxDEV("label",{className:"label",style:{marginBottom:"0.75rem",color:"#1e293b"},children:"Perodo de Anlisis"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:520,columnNumber:15},this),Fe.jsxDEV("div",{className:"field is-grouped",children:[Fe.jsxDEV("p",{className:"control",children:Fe.jsxDEV("button",{className:`button ${Qt==="20days"?"is-info":"is-light"}`,onClick:()=>_t("20days"),children:"ltimos 20 das"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:523,columnNumber:19},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:522,columnNumber:17},this),Fe.jsxDEV("p",{className:"control",children:Fe.jsxDEV("button",{className:`button ${Qt==="30days"?"is-info":"is-light"}`,onClick:()=>_t("30days"),children:"ltimos 30 das"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:531,columnNumber:19},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:530,columnNumber:17},this),Fe.jsxDEV("p",{className:"control",children:Fe.jsxDEV("button",{className:`button ${Qt==="harvest"?"is-info":"is-light"}`,onClick:()=>_t("harvest"),children:"Rango de cosecha"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:539,columnNumber:19},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:538,columnNumber:17},this),Fe.jsxDEV("p",{className:"control",children:Fe.jsxDEV("button",{className:`button ${Qt==="custom"?"is-info":"is-light"}`,onClick:()=>{_t("custom"),Di(!ui)},children:[Fe.jsxDEV("span",{className:"icon",children:Fe.jsxDEV(AN,{size:18},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:555,columnNumber:23},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:554,columnNumber:21},this),Fe.jsxDEV("span",{children:"Personalizar"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:557,columnNumber:21},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:547,columnNumber:19},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:546,columnNumber:17},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:521,columnNumber:15},this),ui&&Qt==="custom"&&Fe.jsxDEV("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px"},children:Fe.jsxDEV("div",{className:"columns",children:[Fe.jsxDEV("div",{className:"column",children:[Fe.jsxDEV("label",{className:"label is-small",style:{color:"#1e293b"},children:"Fecha Inicio"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:566,columnNumber:23},this),Fe.jsxDEV("input",{type:"date",className:"input",value:si,onChange:Ei=>di(Ei.target.value),style:{backgroundColor:"#ffffff",color:"#1e293b"}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:567,columnNumber:23},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:565,columnNumber:21},this),Fe.jsxDEV("div",{className:"column",children:[Fe.jsxDEV("label",{className:"label is-small",style:{color:"#1e293b"},children:"Fecha Fin"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:576,columnNumber:23},this),Fe.jsxDEV("input",{type:"date",className:"input",value:Nt,onChange:Ei=>Ii(Ei.target.value),style:{backgroundColor:"#ffffff",color:"#1e293b"}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:577,columnNumber:23},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:575,columnNumber:21},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:564,columnNumber:19},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:563,columnNumber:17},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:519,columnNumber:13},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:454,columnNumber:11},this),Wr&&Wr.sectors.length>0&&Ke&&Fe.jsxDEV("div",{className:"columns",children:[Fe.jsxDEV("div",{className:"column is-7",children:Fe.jsxDEV("div",{className:"box",style:{backgroundColor:"#ffffff"},children:[Fe.jsxDEV("h3",{className:"title is-5",style:{marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#1e293b"},children:[Fe.jsxDEV(GM,{size:20},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:598,columnNumber:19},this),"Mapa del Campo"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:597,columnNumber:17},this),Fe.jsxDEV(yB,{field:Wr,height:"450px",filters:{harvest:Ke,species:Ye},totalSectors:mn},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:601,columnNumber:17},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:596,columnNumber:15},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:595,columnNumber:13},this),Fe.jsxDEV("div",{className:"column is-5",children:Fe.jsxDEV("div",{className:"box",style:{backgroundColor:"#ffffff"},children:[Fe.jsxDEV("h3",{className:"title is-5",style:{marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",color:"#1e293b"},children:[Fe.jsxDEV(PN,{size:20},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:616,columnNumber:19},this),"Ranking de Sectores (kg/ha)"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:615,columnNumber:17},this),Fe.jsxDEV("div",{className:"columns is-mobile mb-3",children:[Fe.jsxDEV("div",{className:"column",children:[Fe.jsxDEV("label",{className:"label is-small",style:{color:"#1e293b"},children:"Mostrar Top"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:622,columnNumber:21},this),Fe.jsxDEV("input",{type:"number",min:1,max:20,className:"input",value:rn,onChange:Ei=>zn(Number(Ei.target.value)),style:{backgroundColor:"#ffffff",color:"#1e293b"}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:623,columnNumber:21},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:621,columnNumber:19},this),Fe.jsxDEV("div",{className:"column",children:[Fe.jsxDEV("label",{className:"label is-small",style:{color:"#1e293b"},children:"Ordenar por"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:635,columnNumber:21},this),Fe.jsxDEV("div",{className:"select is-fullwidth",children:Fe.jsxDEV("select",{value:er,onChange:Ei=>Mn(Ei.target.value),style:{backgroundColor:"#ffffff",color:"#1e293b"},children:[Fe.jsxDEV("option",{value:"desc",style:{color:"#1e293b"},children:"Mayor  Menor"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:644,columnNumber:25},this),Fe.jsxDEV("option",{value:"asc",style:{color:"#1e293b"},children:"Menor  Mayor"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:645,columnNumber:25},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:637,columnNumber:23},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:636,columnNumber:21},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:634,columnNumber:19},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:620,columnNumber:17},this),Or.length===0?Fe.jsxDEV("div",{className:"notification is-warning",children:"No hay datos de produccin para los filtros seleccionados"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:652,columnNumber:19},this):Fe.jsxDEV("div",{style:{maxHeight:"400px",overflowY:"auto"},children:Or.map((Ei,Xi)=>{const Rn=Ei.kg_per_ha/kr*100,on=(X==null?void 0:X.name)===Ei.sector;return Fe.jsxDEV("div",{className:"box",style:{cursor:"pointer",marginBottom:"0.75rem",backgroundColor:on?"#eff6ff":"#ffffff",border:on?"2px solid #3b82f6":"1px solid #e2e8f0",transition:"all 0.2s ease"},onClick:()=>re({name:Ei.sector}),children:[Fe.jsxDEV("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[Fe.jsxDEV("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[Fe.jsxDEV("span",{style:{backgroundColor:"#f1f5f9",padding:"0.25rem 0.5rem",borderRadius:"4px",fontSize:"0.75rem",fontWeight:"600",color:"#64748b"},children:["#",Xi+1]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:676,columnNumber:31},this),Fe.jsxDEV("strong",{style:{fontSize:"0.95rem",color:"#1e293b"},children:Ei.sector},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:686,columnNumber:31},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:675,columnNumber:29},this),Fe.jsxDEV("span",{style:{fontWeight:"700",color:"#1a202c"},children:[Ei.kg_per_ha.toLocaleString()," kg/ha"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:688,columnNumber:29},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:674,columnNumber:27},this),Fe.jsxDEV("div",{style:{fontSize:"0.8rem",color:"#64748b",marginBottom:"0.5rem"},children:[Ei.hectares.toFixed(2)," ha  Total: ",Number(Ei.kg_total).toLocaleString()," kg"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:692,columnNumber:27},this),Fe.jsxDEV("progress",{className:"progress is-info",value:Rn,max:100,style:{height:"8px"}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:695,columnNumber:27},this)]},Ei.sector,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:662,columnNumber:25},this)})},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:656,columnNumber:19},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:614,columnNumber:15},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:613,columnNumber:13},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:594,columnNumber:11},this),N&&Ke&&Fe.jsxDEV(s4,{fieldId:N.id,fieldName:N.name,filters:{specie:Ye,variety:Ct,initialStartDate:Vr.start,initialEndDate:Vr.end,harvestName:Ke}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:713,columnNumber:11},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:334,columnNumber:7},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:333,columnNumber:5},this)}function u4(){return Fe.jsxDEV("div",{className:"h-screen flex items-center justify-center text-xl",children:"Tu cuenta est en estado pendiente. Contacta al administrador."},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Pending.tsx",lineNumber:3,columnNumber:5},this)}function h4(){const{getAccessTokenSilently:d,logout:s,user:u}=kb(),{isAdmin:_,loading:v,userRole:E}=Dk(),A=VA(),[r,L]=ft.useState([]),[N,H]=ft.useState(!0),[X,re]=ft.useState(null),[he,de]=ft.useState(null);ft.useEffect(()=>{!v&&!_&&(alert(" No tienes permisos para acceder a esta pgina"),A("/"))},[_,v,A]),ft.useEffect(()=>{(async()=>{if(_)try{const Ke=await d(),Ge=await fetch("http://localhost:3000/api/api/users",{headers:{Authorization:`Bearer ${Ke}`}});if(!Ge.ok)throw new Error("Error al cargar usuarios");const Ye=await Ge.json();let mt;Array.isArray(Ye)?mt=Ye:Ye.users&&Array.isArray(Ye.users)?mt=Ye.users:Ye.data&&Array.isArray(Ye.data)?mt=Ye.data:(console.error(" Formato inesperado:",Ye),mt=[]),console.log(" Usuarios cargados:",mt),L(mt)}catch(Ke){console.error("Error:",Ke),re(Ke.message||"Error al cargar usuarios")}finally{H(!1)}})()},[_,d]);const ve=async(Le,Ke)=>{if(window.confirm(`Cambiar rol a ${Ke}?`))try{de(Le);const Ge=await d();if(!(await fetch(`http://localhost:3000/api/api/users/${Le}/role`,{method:"PATCH",headers:{Authorization:`Bearer ${Ge}`,"Content-Type":"application/json"},body:JSON.stringify({role:Ke})})).ok)throw new Error("Error al actualizar rol");L(r.map(mt=>mt.id===Le?{...mt,role:Ke}:mt)),alert(" Rol actualizado exitosamente")}catch(Ge){console.error("Error:",Ge),alert(" "+(Ge.message||"Error al actualizar rol"))}finally{de(null)}},xe=async(Le,Ke)=>{if(window.confirm(` Eliminar a ${Ke}?

Esta accin no se puede deshacer.`))try{const Ge=await d();if(!(await fetch(`http://localhost:3000/api/api/users/${Le}`,{method:"DELETE",headers:{Authorization:`Bearer ${Ge}`}})).ok)throw new Error("Error al eliminar usuario");L(r.filter(mt=>mt.id!==Le)),alert(" Usuario eliminado exitosamente")}catch(Ge){console.error("Error:",Ge),alert(" "+(Ge.message||"Error al eliminar usuario"))}},$e=Le=>({admin:"is-purple",gerencia:"is-info",campo:"is-success",pending:"is-warning"})[Le]||"is-light";return v||N?Fe.jsxDEV("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f7fa"},children:Fe.jsxDEV("div",{style:{textAlign:"center"},children:[Fe.jsxDEV("progress",{className:"progress is-primary",max:"100",style:{width:"200px"}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:165,columnNumber:11},this),Fe.jsxDEV("p",{className:"mt-4",style:{color:"#64748b"},children:"Cargando usuarios..."},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:166,columnNumber:11},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:164,columnNumber:9},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:163,columnNumber:7},this):_?Fe.jsxDEV("section",{style:{backgroundColor:"#f5f7fa",minHeight:"100vh",padding:"2rem 0"},children:Fe.jsxDEV("div",{className:"container",children:[Fe.jsxDEV("div",{className:"box",style:{backgroundColor:"#64748b",border:"none",marginBottom:"2rem",padding:"1.5rem 2rem"},children:[Fe.jsxDEV("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[Fe.jsxDEV("div",{children:[Fe.jsxDEV("h1",{className:"title is-3",style:{color:"#ffffff",marginBottom:"0.5rem",fontWeight:700},children:" AFT Gestin Agrcola"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:189,columnNumber:15},this),Fe.jsxDEV("p",{style:{color:"rgba(255,255,255,0.9)",fontSize:"0.95rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[u==null?void 0:u.email,"  ",Fe.jsxDEV("span",{className:"tag is-light is-small",children:E},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:193,columnNumber:33},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:192,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:188,columnNumber:13},this),Fe.jsxDEV("button",{className:"button",onClick:()=>s({logoutParams:{returnTo:window.location.origin}}),style:{backgroundColor:"rgba(255,255,255,0.2)",color:"#ffffff",border:"1px solid rgba(255,255,255,0.3)"},children:[Fe.jsxDEV("span",{className:"icon",children:Fe.jsxDEV(r2,{size:18},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:206,columnNumber:17},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:205,columnNumber:15},this),Fe.jsxDEV("span",{children:"Cerrar sesin"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:208,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:196,columnNumber:13},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:187,columnNumber:11},this),Fe.jsxDEV("div",{style:{display:"flex",gap:"0.75rem",borderTop:"1px solid rgba(255,255,255,0.2)",paddingTop:"1rem"},children:[Fe.jsxDEV(Cb,{to:"/dashboard",style:{color:"#ffffff",padding:"0.5rem 1rem",borderRadius:"6px",backgroundColor:"rgba(255,255,255,0.15)",textDecoration:"none",fontSize:"0.9rem",fontWeight:500},children:"Dashboard"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:214,columnNumber:13},this),Fe.jsxDEV(Cb,{to:"/usuarios",style:{color:"#ffffff",padding:"0.5rem 1rem",borderRadius:"6px",backgroundColor:"rgba(139, 92, 246, 0.3)",textDecoration:"none",fontSize:"0.9rem",fontWeight:500,display:"flex",alignItems:"center",gap:"0.5rem"},children:[Fe.jsxDEV(o2,{size:16},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:244,columnNumber:15},this)," Usuarios"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:229,columnNumber:13},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:213,columnNumber:11},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:178,columnNumber:9},this),Fe.jsxDEV("div",{className:"box",style:{backgroundColor:"#ffffff"},children:[Fe.jsxDEV("div",{style:{marginBottom:"1.5rem"},children:[Fe.jsxDEV("h2",{className:"title is-4",style:{color:"#1e293b",marginBottom:"0.5rem"},children:"Gestin de Usuarios"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:252,columnNumber:13},this),Fe.jsxDEV("p",{style:{color:"#64748b"},children:"Administra los roles y permisos de los usuarios del sistema"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:255,columnNumber:13},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:251,columnNumber:11},this),X&&Fe.jsxDEV("div",{className:"notification is-danger is-light",children:X},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:261,columnNumber:13},this),Fe.jsxDEV("div",{className:"table-container",children:[Fe.jsxDEV("table",{className:"table is-fullwidth is-hoverable",style:{backgroundColor:"#ffffff"},children:[Fe.jsxDEV("thead",{style:{backgroundColor:"#f8fafc"},children:Fe.jsxDEV("tr",{children:[Fe.jsxDEV("th",{style:{color:"#1e293b"},children:"Usuario"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:271,columnNumber:19},this),Fe.jsxDEV("th",{style:{color:"#1e293b"},children:"Email"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:272,columnNumber:19},this),Fe.jsxDEV("th",{style:{color:"#1e293b"},children:"Rol Actual"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:273,columnNumber:19},this),Fe.jsxDEV("th",{style:{color:"#1e293b"},children:"Cambiar Rol"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:274,columnNumber:19},this),Fe.jsxDEV("th",{style:{color:"#1e293b"},children:"Acciones"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:275,columnNumber:19},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:270,columnNumber:17},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:269,columnNumber:15},this),Fe.jsxDEV("tbody",{children:r.map(Le=>Fe.jsxDEV("tr",{children:[Fe.jsxDEV("td",{children:[Fe.jsxDEV("div",{style:{color:"#1e293b",fontWeight:600},children:Le.name},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:282,columnNumber:23},this),Fe.jsxDEV("div",{style:{color:"#64748b",fontSize:"0.85rem"},children:["ID: ",Le.id]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:283,columnNumber:23},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:281,columnNumber:21},this),Fe.jsxDEV("td",{style:{color:"#1e293b"},children:Le.email},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:285,columnNumber:21},this),Fe.jsxDEV("td",{children:Fe.jsxDEV("span",{className:`tag ${$e(Le.role)}`,children:Le.role},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:287,columnNumber:23},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:286,columnNumber:21},this),Fe.jsxDEV("td",{children:Fe.jsxDEV("div",{className:"select",children:Fe.jsxDEV("select",{value:Le.role,onChange:Ke=>ve(Le.id,Ke.target.value),disabled:he===Le.id,style:{backgroundColor:"#ffffff",color:"#1e293b",cursor:he===Le.id?"not-allowed":"pointer"},children:[Fe.jsxDEV("option",{value:"pending",children:"Pending"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:303,columnNumber:27},this),Fe.jsxDEV("option",{value:"campo",children:"Campo"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:304,columnNumber:27},this),Fe.jsxDEV("option",{value:"gerencia",children:"Gerencia"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:305,columnNumber:27},this),Fe.jsxDEV("option",{value:"admin",children:"Admin"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:306,columnNumber:27},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:293,columnNumber:25},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:292,columnNumber:23},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:291,columnNumber:21},this),Fe.jsxDEV("td",{children:Fe.jsxDEV("button",{onClick:()=>xe(Le.id,Le.name),className:"button is-small is-danger is-light",children:"Eliminar"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:311,columnNumber:23},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:310,columnNumber:21},this)]},Le.id,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:280,columnNumber:19},this))},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:278,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:268,columnNumber:13},this),r.length===0&&Fe.jsxDEV("div",{className:"notification is-light",style:{textAlign:"center"},children:Fe.jsxDEV("p",{style:{color:"#64748b"},children:"No hay usuarios registrados"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:325,columnNumber:17},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:324,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:267,columnNumber:11},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:250,columnNumber:9},this),Fe.jsxDEV("div",{className:"columns is-multiline mt-4",children:[Fe.jsxDEV("div",{className:"column is-3",children:Fe.jsxDEV("div",{className:"box",style:{backgroundColor:"#ffffff",textAlign:"center"},children:[Fe.jsxDEV("p",{className:"heading",style:{color:"#64748b"},children:"Total Usuarios"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:335,columnNumber:15},this),Fe.jsxDEV("p",{className:"title",style:{color:"#1e293b"},children:r.length},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:336,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:334,columnNumber:13},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:333,columnNumber:11},this),Fe.jsxDEV("div",{className:"column is-3",children:Fe.jsxDEV("div",{className:"box",style:{backgroundColor:"#ffffff",textAlign:"center"},children:[Fe.jsxDEV("p",{className:"heading",style:{color:"#64748b"},children:"Admins"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:341,columnNumber:15},this),Fe.jsxDEV("p",{className:"title",style:{color:"#9333ea"},children:r.filter(Le=>Le.role==="admin").length},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:342,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:340,columnNumber:13},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:339,columnNumber:11},this),Fe.jsxDEV("div",{className:"column is-3",children:Fe.jsxDEV("div",{className:"box",style:{backgroundColor:"#ffffff",textAlign:"center"},children:[Fe.jsxDEV("p",{className:"heading",style:{color:"#64748b"},children:"Gerencia"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:349,columnNumber:15},this),Fe.jsxDEV("p",{className:"title",style:{color:"#3b82f6"},children:r.filter(Le=>Le.role==="gerencia").length},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:350,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:348,columnNumber:13},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:347,columnNumber:11},this),Fe.jsxDEV("div",{className:"column is-3",children:Fe.jsxDEV("div",{className:"box",style:{backgroundColor:"#ffffff",textAlign:"center"},children:[Fe.jsxDEV("p",{className:"heading",style:{color:"#64748b"},children:"Pendientes"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:357,columnNumber:15},this),Fe.jsxDEV("p",{className:"title",style:{color:"#eab308"},children:r.filter(Le=>Le.role==="pending").length},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:358,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:356,columnNumber:13},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:355,columnNumber:11},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:332,columnNumber:9},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:176,columnNumber:7},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Usuarios.tsx",lineNumber:175,columnNumber:5},this):null}function CO({children:d}){const{isAuthenticated:s,isLoading:u}=kb();return u?Fe.jsxDEV("div",{className:"min-h-screen flex items-center justify-center",children:Fe.jsxDEV("div",{className:"text-center",children:[Fe.jsxDEV("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:20,columnNumber:11},this),Fe.jsxDEV("p",{className:"mt-4 text-gray-600",children:"Cargando..."},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:21,columnNumber:11},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:19,columnNumber:9},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:18,columnNumber:7},this):s?d:Fe.jsxDEV(UO,{to:"/",replace:!0},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:27,columnNumber:39},this)}function d4(){return Fe.jsxDEV(tz,{children:[Fe.jsxDEV(vb,{path:"/",element:Fe.jsxDEV(LN,{},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:34,columnNumber:32},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:34,columnNumber:7},this),Fe.jsxDEV(vb,{path:"/dashboard",element:Fe.jsxDEV(CO,{children:Fe.jsxDEV(c4,{},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:41,columnNumber:13},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:40,columnNumber:11},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:37,columnNumber:7},this),Fe.jsxDEV(vb,{path:"/usuarios",element:Fe.jsxDEV(CO,{children:Fe.jsxDEV(h4,{},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:51,columnNumber:13},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:50,columnNumber:11},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:47,columnNumber:7},this),Fe.jsxDEV(vb,{path:"/pendiente",element:Fe.jsxDEV(u4,{},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:57,columnNumber:41},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:57,columnNumber:7},this),Fe.jsxDEV(vb,{path:"*",element:Fe.jsxDEV(UO,{to:"/",replace:!0},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:60,columnNumber:32},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:60,columnNumber:7},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:32,columnNumber:5},this)}dR.createRoot(document.getElementById("root")).render(Fe.jsxDEV(kR.StrictMode,{children:Fe.jsxDEV(gz,{children:Fe.jsxDEV(vN,{domain:"dev-2c7hbbihiefpum6a.us.auth0.com",clientId:"rk3uUebq6trvBQAHxT2LUNHARjNXe2fZ",authorizationParams:{redirect_uri:window.location.origin,audience:"https://aft-gestion/api",scope:"openid profile email"},cacheLocation:"localstorage",useRefreshTokens:!0,useRefreshTokensFallback:!0,children:Fe.jsxDEV(d4,{},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/main.tsx",lineNumber:24,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/main.tsx",lineNumber:12,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/main.tsx",lineNumber:11,columnNumber:5},void 0)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/main.tsx",lineNumber:10,columnNumber:3},void 0));
