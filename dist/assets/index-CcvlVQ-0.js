var XL=Object.defineProperty;var YL=(d,s,h)=>s in d?XL(d,s,{enumerable:!0,configurable:!0,writable:!0,value:h}):d[s]=h;var kn=(d,s,h)=>YL(d,typeof s!="symbol"?s+"":s,h);function KL(d,s){for(var h=0;h<s.length;h++){const _=s[h];if(typeof _!="string"&&!Array.isArray(_)){for(const v in _)if(v!=="default"&&!(v in d)){const E=Object.getOwnPropertyDescriptor(_,v);E&&Object.defineProperty(d,v,E.get?E:{enumerable:!0,get:()=>_[v]})}}}return Object.freeze(Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))_(v);new MutationObserver(v=>{for(const E of v)if(E.type==="childList")for(const C of E.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&_(C)}).observe(document,{childList:!0,subtree:!0});function h(v){const E={};return v.integrity&&(E.integrity=v.integrity),v.referrerPolicy&&(E.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?E.credentials="include":v.crossOrigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function _(v){if(v.ep)return;v.ep=!0;const E=h(v);fetch(v.href,E)}})();var JL=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xO(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var bO={exports:{}},oI={},wO={exports:{}},bC={exports:{}};bC.exports;(function(d,s){/**
 * @license React
 * react.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var h="18.3.1",_=Symbol.for("react.element"),v=Symbol.for("react.portal"),E=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),N=Symbol.for("react.context"),H=Symbol.for("react.forward_ref"),K=Symbol.for("react.suspense"),ne=Symbol.for("react.suspense_list"),ue=Symbol.for("react.memo"),pe=Symbol.for("react.lazy"),xe=Symbol.for("react.offscreen"),be=Symbol.iterator,je="@@iterator";function Be(ge){if(ge===null||typeof ge!="object")return null;var Ye=be&&ge[be]||ge[je];return typeof Ye=="function"?Ye:null}var He={current:null},Xe={transition:null},it={current:null,isBatchingLegacy:!1,didScheduleLegacyUpdate:!1},kt={current:null},Nt={},oi=null;function yi(ge){oi=ge}Nt.setExtraStackFrame=function(ge){oi=ge},Nt.getCurrentStack=null,Nt.getStackAddendum=function(){var ge="";oi&&(ge+=oi);var Ye=Nt.getCurrentStack;return Ye&&(ge+=Ye()||""),ge};var Ui=!1,hi=!1,Ti=!1,Dt=!1,Di=!1,Qt={ReactCurrentDispatcher:He,ReactCurrentBatchConfig:Xe,ReactCurrentOwner:kt};Qt.ReactDebugCurrentFrame=Nt,Qt.ReactCurrentActQueue=it;function ui(ge){{for(var Ye=arguments.length,zt=new Array(Ye>1?Ye-1:0),Xt=1;Xt<Ye;Xt++)zt[Xt-1]=arguments[Xt];zi("warn",ge,zt)}}function ri(ge){{for(var Ye=arguments.length,zt=new Array(Ye>1?Ye-1:0),Xt=1;Xt<Ye;Xt++)zt[Xt-1]=arguments[Xt];zi("error",ge,zt)}}function zi(ge,Ye,zt){{var Xt=Qt.ReactDebugCurrentFrame,Ai=Xt.getStackAddendum();Ai!==""&&(Ye+="%s",zt=zt.concat([Ai]));var mn=zt.map(function(Mi){return String(Mi)});mn.unshift("Warning: "+Ye),Function.prototype.apply.call(console[ge],console,mn)}}var En={};function hr(ge,Ye){{var zt=ge.constructor,Xt=zt&&(zt.displayName||zt.name)||"ReactClass",Ai=Xt+"."+Ye;if(En[Ai])return;ri("Can't call %s on a component that is not yet mounted. This is a no-op, but it might indicate a bug in your application. Instead, assign to `this.state` directly or define a `state = {};` class property with the desired state in the %s component.",Ye,Xt),En[Ai]=!0}}var wr={isMounted:function(ge){return!1},enqueueForceUpdate:function(ge,Ye,zt){hr(ge,"forceUpdate")},enqueueReplaceState:function(ge,Ye,zt,Xt){hr(ge,"replaceState")},enqueueSetState:function(ge,Ye,zt,Xt){hr(ge,"setState")}},Jn=Object.assign,xn={};Object.freeze(xn);function mr(ge,Ye,zt){this.props=ge,this.context=Ye,this.refs=xn,this.updater=zt||wr}mr.prototype.isReactComponent={},mr.prototype.setState=function(ge,Ye){if(typeof ge!="object"&&typeof ge!="function"&&ge!=null)throw new Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ge,Ye,"setState")},mr.prototype.forceUpdate=function(ge){this.updater.enqueueForceUpdate(this,ge,"forceUpdate")};{var Va={isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in componentWillUnmount to prevent memory leaks."],replaceState:["replaceState","Refactor your code to use setState instead (see https://github.com/facebook/react/issues/3236)."]},Aa=function(ge,Ye){Object.defineProperty(mr.prototype,ge,{get:function(){ui("%s(...) is deprecated in plain JavaScript React classes. %s",Ye[0],Ye[1])}})};for(var Gi in Va)Va.hasOwnProperty(Gi)&&Aa(Gi,Va[Gi])}function Cn(){}Cn.prototype=mr.prototype;function Vi(ge,Ye,zt){this.props=ge,this.context=Ye,this.refs=xn,this.updater=zt||wr}var Rn=Vi.prototype=new Cn;Rn.constructor=Vi,Jn(Rn,mr.prototype),Rn.isPureReactComponent=!0;function gr(){var ge={current:null};return Object.seal(ge),ge}var za=Array.isArray;function Bn(ge){return za(ge)}function eo(ge){{var Ye=typeof Symbol=="function"&&Symbol.toStringTag,zt=Ye&&ge[Symbol.toStringTag]||ge.constructor.name||"Object";return zt}}function jr(ge){try{return Zr(ge),!1}catch{return!0}}function Zr(ge){return""+ge}function to(ge){if(jr(ge))return ri("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",eo(ge)),Zr(ge)}function Pr(ge,Ye,zt){var Xt=ge.displayName;if(Xt)return Xt;var Ai=Ye.displayName||Ye.name||"";return Ai!==""?zt+"("+Ai+")":zt}function Do(ge){return ge.displayName||"Context"}function mo(ge){if(ge==null)return null;if(typeof ge.tag=="number"&&ri("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof ge=="function")return ge.displayName||ge.name||null;if(typeof ge=="string")return ge;switch(ge){case E:return"Fragment";case v:return"Portal";case r:return"Profiler";case C:return"StrictMode";case K:return"Suspense";case ne:return"SuspenseList"}if(typeof ge=="object")switch(ge.$$typeof){case N:var Ye=ge;return Do(Ye)+".Consumer";case z:var zt=ge;return Do(zt._context)+".Provider";case H:return Pr(ge,ge.render,"ForwardRef");case ue:var Xt=ge.displayName||null;return Xt!==null?Xt:mo(ge.type)||"Memo";case pe:{var Ai=ge,mn=Ai._payload,Mi=Ai._init;try{return mo(Mi(mn))}catch{return null}}}return null}var ha=Object.prototype.hasOwnProperty,Ra={key:!0,ref:!0,__self:!0,__source:!0},bo,Fa,wa;wa={};function Na(ge){if(ha.call(ge,"ref")){var Ye=Object.getOwnPropertyDescriptor(ge,"ref").get;if(Ye&&Ye.isReactWarning)return!1}return ge.ref!==void 0}function qa(ge){if(ha.call(ge,"key")){var Ye=Object.getOwnPropertyDescriptor(ge,"key").get;if(Ye&&Ye.isReactWarning)return!1}return ge.key!==void 0}function xs(ge,Ye){var zt=function(){bo||(bo=!0,ri("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",Ye))};zt.isReactWarning=!0,Object.defineProperty(ge,"key",{get:zt,configurable:!0})}function ja(ge,Ye){var zt=function(){Fa||(Fa=!0,ri("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",Ye))};zt.isReactWarning=!0,Object.defineProperty(ge,"ref",{get:zt,configurable:!0})}function Pi(ge){if(typeof ge.ref=="string"&&kt.current&&ge.__self&&kt.current.stateNode!==ge.__self){var Ye=mo(kt.current.type);wa[Ye]||(ri('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',Ye,ge.ref),wa[Ye]=!0)}}var rn=function(ge,Ye,zt,Xt,Ai,mn,Mi){var Wn={$$typeof:_,type:ge,key:Ye,ref:zt,props:Mi,_owner:mn};return Wn._store={},Object.defineProperty(Wn._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(Wn,"_self",{configurable:!1,enumerable:!1,writable:!1,value:Xt}),Object.defineProperty(Wn,"_source",{configurable:!1,enumerable:!1,writable:!1,value:Ai}),Object.freeze&&(Object.freeze(Wn.props),Object.freeze(Wn)),Wn};function Qn(ge,Ye,zt){var Xt,Ai={},mn=null,Mi=null,Wn=null,Ir=null;if(Ye!=null){Na(Ye)&&(Mi=Ye.ref,Pi(Ye)),qa(Ye)&&(to(Ye.key),mn=""+Ye.key),Wn=Ye.__self===void 0?null:Ye.__self,Ir=Ye.__source===void 0?null:Ye.__source;for(Xt in Ye)ha.call(Ye,Xt)&&!Ra.hasOwnProperty(Xt)&&(Ai[Xt]=Ye[Xt])}var la=arguments.length-2;if(la===1)Ai.children=zt;else if(la>1){for(var Qi=Array(la),Da=0;Da<la;Da++)Qi[Da]=arguments[Da+2];Object.freeze&&Object.freeze(Qi),Ai.children=Qi}if(ge&&ge.defaultProps){var Sr=ge.defaultProps;for(Xt in Sr)Ai[Xt]===void 0&&(Ai[Xt]=Sr[Xt])}if(mn||Mi){var Xa=typeof ge=="function"?ge.displayName||ge.name||"Unknown":ge;mn&&xs(Ai,Xa),Mi&&ja(Ai,Xa)}return rn(ge,mn,Mi,Wn,Ir,kt.current,Ai)}function Fr(ge,Ye){var zt=rn(ge.type,Ye,ge.ref,ge._self,ge._source,ge._owner,ge.props);return zt}function Un(ge,Ye,zt){if(ge==null)throw new Error("React.cloneElement(...): The argument must be a React element, but you passed "+ge+".");var Xt,Ai=Jn({},ge.props),mn=ge.key,Mi=ge.ref,Wn=ge._self,Ir=ge._source,la=ge._owner;if(Ye!=null){Na(Ye)&&(Mi=Ye.ref,la=kt.current),qa(Ye)&&(to(Ye.key),mn=""+Ye.key);var Qi;ge.type&&ge.type.defaultProps&&(Qi=ge.type.defaultProps);for(Xt in Ye)ha.call(Ye,Xt)&&!Ra.hasOwnProperty(Xt)&&(Ye[Xt]===void 0&&Qi!==void 0?Ai[Xt]=Qi[Xt]:Ai[Xt]=Ye[Xt])}var Da=arguments.length-2;if(Da===1)Ai.children=zt;else if(Da>1){for(var Sr=Array(Da),Xa=0;Xa<Da;Xa++)Sr[Xa]=arguments[Xa+2];Ai.children=Sr}return rn(ge.type,mn,Mi,Wn,Ir,la,Ai)}function da(ge){return typeof ge=="object"&&ge!==null&&ge.$$typeof===_}var _a=".",Ga=":";function Vr(ge){var Ye=/[=:]/g,zt={"=":"=0",":":"=2"},Xt=ge.replace(Ye,function(Ai){return zt[Ai]});return"$"+Xt}var xr=!1,_n=/\/+/g;function aa(ge){return ge.replace(_n,"$&/")}function wo(ge,Ye){return typeof ge=="object"&&ge!==null&&ge.key!=null?(to(ge.key),Vr(""+ge.key)):Ye.toString(36)}function go(ge,Ye,zt,Xt,Ai){var mn=typeof ge;(mn==="undefined"||mn==="boolean")&&(ge=null);var Mi=!1;if(ge===null)Mi=!0;else switch(mn){case"string":case"number":Mi=!0;break;case"object":switch(ge.$$typeof){case _:case v:Mi=!0}}if(Mi){var Wn=ge,Ir=Ai(Wn),la=Xt===""?_a+wo(Wn,0):Xt;if(Bn(Ir)){var Qi="";la!=null&&(Qi=aa(la)+"/"),go(Ir,Ye,Qi,"",function(qn){return qn})}else Ir!=null&&(da(Ir)&&(Ir.key&&(!Wn||Wn.key!==Ir.key)&&to(Ir.key),Ir=Fr(Ir,zt+(Ir.key&&(!Wn||Wn.key!==Ir.key)?aa(""+Ir.key)+"/":"")+la)),Ye.push(Ir));return 1}var Da,Sr,Xa=0,wi=Xt===""?_a:Xt+Ga;if(Bn(ge))for(var lc=0;lc<ge.length;lc++)Da=ge[lc],Sr=wi+wo(Da,lc),Xa+=go(Da,Ye,zt,Sr,Ai);else{var vl=Be(ge);if(typeof vl=="function"){var Oo=ge;vl===Oo.entries&&(xr||ui("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),xr=!0);for(var ws=vl.call(Oo),kc,bi=0;!(kc=ws.next()).done;)Da=kc.value,Sr=wi+wo(Da,bi++),Xa+=go(Da,Ye,zt,Sr,Ai)}else if(mn==="object"){var Dn=String(ge);throw new Error("Objects are not valid as a React child (found: "+(Dn==="[object Object]"?"object with keys {"+Object.keys(ge).join(", ")+"}":Dn)+"). If you meant to render a collection of children, use an array instead.")}}return Xa}function no(ge,Ye,zt){if(ge==null)return ge;var Xt=[],Ai=0;return go(ge,Xt,"","",function(mn){return Ye.call(zt,mn,Ai++)}),Xt}function tc(ge){var Ye=0;return no(ge,function(){Ye++}),Ye}function ml(ge,Ye,zt){no(ge,function(){Ye.apply(this,arguments)},zt)}function ic(ge){return no(ge,function(Ye){return Ye})||[]}function Ks(ge){if(!da(ge))throw new Error("React.Children.only expected to receive a single React element child.");return ge}function vt(ge){var Ye={$$typeof:N,_currentValue:ge,_currentValue2:ge,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null};Ye.Provider={$$typeof:z,_context:Ye};var zt=!1,Xt=!1,Ai=!1;{var mn={$$typeof:N,_context:Ye};Object.defineProperties(mn,{Provider:{get:function(){return Xt||(Xt=!0,ri("Rendering <Context.Consumer.Provider> is not supported and will be removed in a future major release. Did you mean to render <Context.Provider> instead?")),Ye.Provider},set:function(Mi){Ye.Provider=Mi}},_currentValue:{get:function(){return Ye._currentValue},set:function(Mi){Ye._currentValue=Mi}},_currentValue2:{get:function(){return Ye._currentValue2},set:function(Mi){Ye._currentValue2=Mi}},_threadCount:{get:function(){return Ye._threadCount},set:function(Mi){Ye._threadCount=Mi}},Consumer:{get:function(){return zt||(zt=!0,ri("Rendering <Context.Consumer.Consumer> is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?")),Ye.Consumer}},displayName:{get:function(){return Ye.displayName},set:function(Mi){Ai||(ui("Setting `displayName` on Context.Consumer has no effect. You should set it directly on the context with Context.displayName = '%s'.",Mi),Ai=!0)}}}),Ye.Consumer=mn}return Ye._currentRenderer=null,Ye._currentRenderer2=null,Ye}var To=-1,Go=0,Mo=1,cn=2;function Za(ge){if(ge._status===To){var Ye=ge._result,zt=Ye();if(zt.then(function(mn){if(ge._status===Go||ge._status===To){var Mi=ge;Mi._status=Mo,Mi._result=mn}},function(mn){if(ge._status===Go||ge._status===To){var Mi=ge;Mi._status=cn,Mi._result=mn}}),ge._status===To){var Xt=ge;Xt._status=Go,Xt._result=zt}}if(ge._status===Mo){var Ai=ge._result;return Ai===void 0&&ri(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))

Did you accidentally put curly braces around the import?`,Ai),"default"in Ai||ri(`lazy: Expected the result of a dynamic import() call. Instead received: %s

Your code should look like: 
  const MyComponent = lazy(() => import('./MyComponent'))`,Ai),Ai.default}else throw ge._result}function et(ge){var Ye={_status:To,_result:ge},zt={$$typeof:pe,_payload:Ye,_init:Za};{var Xt,Ai;Object.defineProperties(zt,{defaultProps:{configurable:!0,get:function(){return Xt},set:function(mn){ri("React.lazy(...): It is not supported to assign `defaultProps` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),Xt=mn,Object.defineProperty(zt,"defaultProps",{enumerable:!0})}},propTypes:{configurable:!0,get:function(){return Ai},set:function(mn){ri("React.lazy(...): It is not supported to assign `propTypes` to a lazy component import. Either specify them where the component is defined, or create a wrapping component around it."),Ai=mn,Object.defineProperty(zt,"propTypes",{enumerable:!0})}}})}return zt}function vi(ge){ge!=null&&ge.$$typeof===ue?ri("forwardRef requires a render function but received a `memo` component. Instead of forwardRef(memo(...)), use memo(forwardRef(...))."):typeof ge!="function"?ri("forwardRef requires a render function but was given %s.",ge===null?"null":typeof ge):ge.length!==0&&ge.length!==2&&ri("forwardRef render functions accept exactly two parameters: props and ref. %s",ge.length===1?"Did you forget to use the ref parameter?":"Any additional parameter will be undefined."),ge!=null&&(ge.defaultProps!=null||ge.propTypes!=null)&&ri("forwardRef render functions do not support propTypes or defaultProps. Did you accidentally pass a React component?");var Ye={$$typeof:H,render:ge};{var zt;Object.defineProperty(Ye,"displayName",{enumerable:!1,configurable:!0,get:function(){return zt},set:function(Xt){zt=Xt,!ge.name&&!ge.displayName&&(ge.displayName=Xt)}})}return Ye}var ie;ie=Symbol.for("react.module.reference");function W(ge){return!!(typeof ge=="string"||typeof ge=="function"||ge===E||ge===r||Di||ge===C||ge===K||ge===ne||Dt||ge===xe||Ui||hi||Ti||typeof ge=="object"&&ge!==null&&(ge.$$typeof===pe||ge.$$typeof===ue||ge.$$typeof===z||ge.$$typeof===N||ge.$$typeof===H||ge.$$typeof===ie||ge.getModuleId!==void 0))}function X(ge,Ye){W(ge)||ri("memo: The first argument must be a component. Instead received: %s",ge===null?"null":typeof ge);var zt={$$typeof:ue,type:ge,compare:Ye===void 0?null:Ye};{var Xt;Object.defineProperty(zt,"displayName",{enumerable:!1,configurable:!0,get:function(){return Xt},set:function(Ai){Xt=Ai,!ge.name&&!ge.displayName&&(ge.displayName=Ai)}})}return zt}function he(){var ge=He.current;return ge===null&&ri(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.`),ge}function we(ge){var Ye=he();if(ge._context!==void 0){var zt=ge._context;zt.Consumer===ge?ri("Calling useContext(Context.Consumer) is not supported, may cause bugs, and will be removed in a future major release. Did you mean to call useContext(Context) instead?"):zt.Provider===ge&&ri("Calling useContext(Context.Provider) is not supported. Did you mean to call useContext(Context) instead?")}return Ye.useContext(ge)}function ye(ge){var Ye=he();return Ye.useState(ge)}function Me(ge,Ye,zt){var Xt=he();return Xt.useReducer(ge,Ye,zt)}function Ve(ge){var Ye=he();return Ye.useRef(ge)}function Le(ge,Ye){var zt=he();return zt.useEffect(ge,Ye)}function $e(ge,Ye){var zt=he();return zt.useInsertionEffect(ge,Ye)}function gt(ge,Ye){var zt=he();return zt.useLayoutEffect(ge,Ye)}function ut(ge,Ye){var zt=he();return zt.useCallback(ge,Ye)}function Kt(ge,Ye){var zt=he();return zt.useMemo(ge,Ye)}function Ci(ge,Ye,zt){var Xt=he();return Xt.useImperativeHandle(ge,Ye,zt)}function _i(ge,Ye){{var zt=he();return zt.useDebugValue(ge,Ye)}}function Yt(){var ge=he();return ge.useTransition()}function Yi(ge){var Ye=he();return Ye.useDeferredValue(ge)}function ln(){var ge=he();return ge.useId()}function lr(ge,Ye,zt){var Xt=he();return Xt.useSyncExternalStore(ge,Ye,zt)}var Or=0,Ta,oa,Kr,er,bn,Rr,Gr;function rr(){}rr.__reactDisabledLog=!0;function Tr(){{if(Or===0){Ta=console.log,oa=console.info,Kr=console.warn,er=console.error,bn=console.group,Rr=console.groupCollapsed,Gr=console.groupEnd;var ge={configurable:!0,enumerable:!0,value:rr,writable:!0};Object.defineProperties(console,{info:ge,log:ge,warn:ge,error:ge,group:ge,groupCollapsed:ge,groupEnd:ge})}Or++}}function sa(){{if(Or--,Or===0){var ge={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Jn({},ge,{value:Ta}),info:Jn({},ge,{value:oa}),warn:Jn({},ge,{value:Kr}),error:Jn({},ge,{value:er}),group:Jn({},ge,{value:bn}),groupCollapsed:Jn({},ge,{value:Rr}),groupEnd:Jn({},ge,{value:Gr})})}Or<0&&ri("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var ro=Qt.ReactCurrentDispatcher,Ho;function Ll(ge,Ye,zt){{if(Ho===void 0)try{throw Error()}catch(Ai){var Xt=Ai.stack.trim().match(/\n( *(at )?)/);Ho=Xt&&Xt[1]||""}return`
`+Ho+ge}}var Ia=!1,as;{var Po=typeof WeakMap=="function"?WeakMap:Map;as=new Po}function Js(ge,Ye){if(!ge||Ia)return"";{var zt=as.get(ge);if(zt!==void 0)return zt}var Xt;Ia=!0;var Ai=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var mn;mn=ro.current,ro.current=null,Tr();try{if(Ye){var Mi=function(){throw Error()};if(Object.defineProperty(Mi.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Mi,[])}catch(wi){Xt=wi}Reflect.construct(ge,[],Mi)}else{try{Mi.call()}catch(wi){Xt=wi}ge.call(Mi.prototype)}}else{try{throw Error()}catch(wi){Xt=wi}ge()}}catch(wi){if(wi&&Xt&&typeof wi.stack=="string"){for(var Wn=wi.stack.split(`
`),Ir=Xt.stack.split(`
`),la=Wn.length-1,Qi=Ir.length-1;la>=1&&Qi>=0&&Wn[la]!==Ir[Qi];)Qi--;for(;la>=1&&Qi>=0;la--,Qi--)if(Wn[la]!==Ir[Qi]){if(la!==1||Qi!==1)do if(la--,Qi--,Qi<0||Wn[la]!==Ir[Qi]){var Da=`
`+Wn[la].replace(" at new "," at ");return ge.displayName&&Da.includes("<anonymous>")&&(Da=Da.replace("<anonymous>",ge.displayName)),typeof ge=="function"&&as.set(ge,Da),Da}while(la>=1&&Qi>=0);break}}}finally{Ia=!1,ro.current=mn,sa(),Error.prepareStackTrace=Ai}var Sr=ge?ge.displayName||ge.name:"",Xa=Sr?Ll(Sr):"";return typeof ge=="function"&&as.set(ge,Xa),Xa}function Ko(ge,Ye,zt){return Js(ge,!1)}function bs(ge){var Ye=ge.prototype;return!!(Ye&&Ye.isReactComponent)}function Rc(ge,Ye,zt){if(ge==null)return"";if(typeof ge=="function")return Js(ge,bs(ge));if(typeof ge=="string")return Ll(ge);switch(ge){case K:return Ll("Suspense");case ne:return Ll("SuspenseList")}if(typeof ge=="object")switch(ge.$$typeof){case H:return Ko(ge.render);case ue:return Rc(ge.type,Ye,zt);case pe:{var Xt=ge,Ai=Xt._payload,mn=Xt._init;try{return Rc(mn(Ai),Ye,zt)}catch{}}}return""}var ch={},xu=Qt.ReactDebugCurrentFrame;function Nr(ge){if(ge){var Ye=ge._owner,zt=Rc(ge.type,ge._source,Ye?Ye.type:null);xu.setExtraStackFrame(zt)}else xu.setExtraStackFrame(null)}function os(ge,Ye,zt,Xt,Ai){{var mn=Function.call.bind(ha);for(var Mi in ge)if(mn(ge,Mi)){var Wn=void 0;try{if(typeof ge[Mi]!="function"){var Ir=Error((Xt||"React class")+": "+zt+" type `"+Mi+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof ge[Mi]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw Ir.name="Invariant Violation",Ir}Wn=ge[Mi](Ye,Mi,Xt,zt,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(la){Wn=la}Wn&&!(Wn instanceof Error)&&(Nr(Ai),ri("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",Xt||"React class",zt,Mi,typeof Wn),Nr(null)),Wn instanceof Error&&!(Wn.message in ch)&&(ch[Wn.message]=!0,Nr(Ai),ri("Failed %s type: %s",zt,Wn.message),Nr(null))}}}function $o(ge){if(ge){var Ye=ge._owner,zt=Rc(ge.type,ge._source,Ye?Ye.type:null);yi(zt)}else yi(null)}var pn;pn=!1;function ss(){if(kt.current){var ge=mo(kt.current.type);if(ge)return`

Check the render method of \``+ge+"`."}return""}function ao(ge){if(ge!==void 0){var Ye=ge.fileName.replace(/^.*[\\\/]/,""),zt=ge.lineNumber;return`

Check your code at `+Ye+":"+zt+"."}return""}function gl(ge){return ge!=null?ao(ge.__source):""}var nc={};function $d(ge){var Ye=ss();if(!Ye){var zt=typeof ge=="string"?ge:ge.displayName||ge.name;zt&&(Ye=`

Check the top-level render call using <`+zt+">.")}return Ye}function Ba(ge,Ye){if(!(!ge._store||ge._store.validated||ge.key!=null)){ge._store.validated=!0;var zt=$d(Ye);if(!nc[zt]){nc[zt]=!0;var Xt="";ge&&ge._owner&&ge._owner!==kt.current&&(Xt=" It was passed a child from "+mo(ge._owner.type)+"."),$o(ge),ri('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',zt,Xt),$o(null)}}}function fa(ge,Ye){if(typeof ge=="object"){if(Bn(ge))for(var zt=0;zt<ge.length;zt++){var Xt=ge[zt];da(Xt)&&Ba(Xt,Ye)}else if(da(ge))ge._store&&(ge._store.validated=!0);else if(ge){var Ai=Be(ge);if(typeof Ai=="function"&&Ai!==ge.entries)for(var mn=Ai.call(ge),Mi;!(Mi=mn.next()).done;)da(Mi.value)&&Ba(Mi.value,Ye)}}}function Wd(ge){{var Ye=ge.type;if(Ye==null||typeof Ye=="string")return;var zt;if(typeof Ye=="function")zt=Ye.propTypes;else if(typeof Ye=="object"&&(Ye.$$typeof===H||Ye.$$typeof===ue))zt=Ye.propTypes;else return;if(zt){var Xt=mo(Ye);os(zt,ge.props,"prop",Xt,ge)}else if(Ye.PropTypes!==void 0&&!pn){pn=!0;var Ai=mo(Ye);ri("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",Ai||"Unknown")}typeof Ye.getDefaultProps=="function"&&!Ye.getDefaultProps.isReactClassApproved&&ri("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function _l(ge){{for(var Ye=Object.keys(ge.props),zt=0;zt<Ye.length;zt++){var Xt=Ye[zt];if(Xt!=="children"&&Xt!=="key"){$o(ge),ri("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",Xt),$o(null);break}}ge.ref!==null&&($o(ge),ri("Invalid attribute `ref` supplied to `React.Fragment`."),$o(null))}}function Ha(ge,Ye,zt){var Xt=W(ge);if(!Xt){var Ai="";(ge===void 0||typeof ge=="object"&&ge!==null&&Object.keys(ge).length===0)&&(Ai+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var mn=gl(Ye);mn?Ai+=mn:Ai+=ss();var Mi;ge===null?Mi="null":Bn(ge)?Mi="array":ge!==void 0&&ge.$$typeof===_?(Mi="<"+(mo(ge.type)||"Unknown")+" />",Ai=" Did you accidentally export a JSX literal instead of a component?"):Mi=typeof ge,ri("React.createElement: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",Mi,Ai)}var Wn=Qn.apply(this,arguments);if(Wn==null)return Wn;if(Xt)for(var Ir=2;Ir<arguments.length;Ir++)fa(arguments[Ir],ge);return ge===E?_l(Wn):Wd(Wn),Wn}var yl=!1;function bu(ge){var Ye=Ha.bind(null,ge);return Ye.type=ge,yl||(yl=!0,ui("React.createFactory() is deprecated and will be removed in a future major release. Consider using JSX or use React.createElement() directly instead.")),Object.defineProperty(Ye,"type",{enumerable:!1,get:function(){return ui("Factory.type is deprecated. Access the class directly before passing it to createFactory."),Object.defineProperty(this,"type",{value:ge}),ge}}),Ye}function rc(ge,Ye,zt){for(var Xt=Un.apply(this,arguments),Ai=2;Ai<arguments.length;Ai++)fa(arguments[Ai],Xt.type);return Wd(Xt),Xt}function qd(ge,Ye){var zt=Xe.transition;Xe.transition={};var Xt=Xe.transition;Xe.transition._updatedFibers=new Set;try{ge()}finally{if(Xe.transition=zt,zt===null&&Xt._updatedFibers){var Ai=Xt._updatedFibers.size;Ai>10&&ui("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),Xt._updatedFibers.clear()}}}var wu=!1,ac=null;function Vn(ge){if(ac===null)try{var Ye=("require"+Math.random()).slice(0,7),zt=d&&d[Ye];ac=zt.call(d,"timers").setImmediate}catch{ac=function(Ai){wu===!1&&(wu=!0,typeof MessageChannel>"u"&&ri("This browser does not have a MessageChannel implementation, so enqueuing tasks via await act(async () => ...) will fail. Please file an issue at https://github.com/facebook/react/issues if you encounter this warning."));var mn=new MessageChannel;mn.port1.onmessage=Ai,mn.port2.postMessage(void 0)}}return ac(ge)}var Ic=0,oc=!1;function Tu(ge){{var Ye=Ic;Ic++,it.current===null&&(it.current=[]);var zt=it.isBatchingLegacy,Xt;try{if(it.isBatchingLegacy=!0,Xt=ge(),!zt&&it.didScheduleLegacyUpdate){var Ai=it.current;Ai!==null&&(it.didScheduleLegacyUpdate=!1,Pc(Ai))}}catch(Sr){throw sc(Ye),Sr}finally{it.isBatchingLegacy=zt}if(Xt!==null&&typeof Xt=="object"&&typeof Xt.then=="function"){var mn=Xt,Mi=!1,Wn={then:function(Sr,Xa){Mi=!0,mn.then(function(wi){sc(Ye),Ic===0?Dc(wi,Sr,Xa):Sr(wi)},function(wi){sc(Ye),Xa(wi)})}};return!oc&&typeof Promise<"u"&&Promise.resolve().then(function(){}).then(function(){Mi||(oc=!0,ri("You called act(async () => ...) without await. This could lead to unexpected testing behaviour, interleaving multiple act calls and mixing their scopes. You should - await act(async () => ...);"))}),Wn}else{var Ir=Xt;if(sc(Ye),Ic===0){var la=it.current;la!==null&&(Pc(la),it.current=null);var Qi={then:function(Sr,Xa){it.current===null?(it.current=[],Dc(Ir,Sr,Xa)):Sr(Ir)}};return Qi}else{var Da={then:function(Sr,Xa){Sr(Ir)}};return Da}}}}function sc(ge){ge!==Ic-1&&ri("You seem to have overlapping act() calls, this is not supported. Be sure to await previous act() calls before making a new one. "),Ic=ge}function Dc(ge,Ye,zt){{var Xt=it.current;if(Xt!==null)try{Pc(Xt),Vn(function(){Xt.length===0?(it.current=null,Ye(ge)):Dc(ge,Ye,zt)})}catch(Ai){zt(Ai)}else Ye(ge)}}var Mc=!1;function Pc(ge){if(!Mc){Mc=!0;var Ye=0;try{for(;Ye<ge.length;Ye++){var zt=ge[Ye];do zt=zt(!0);while(zt!==null)}ge.length=0}catch(Xt){throw ge=ge.slice(Ye+1),Xt}finally{Mc=!1}}}var Oc=Ha,dp=rc,uh=bu,zm={map:no,forEach:ml,count:tc,toArray:ic,only:Ks};s.Children=zm,s.Component=mr,s.Fragment=E,s.Profiler=r,s.PureComponent=Vi,s.StrictMode=C,s.Suspense=K,s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Qt,s.act=Tu,s.cloneElement=dp,s.createContext=vt,s.createElement=Oc,s.createFactory=uh,s.createRef=gr,s.forwardRef=vi,s.isValidElement=da,s.lazy=et,s.memo=X,s.startTransition=qd,s.unstable_act=Tu,s.useCallback=ut,s.useContext=we,s.useDebugValue=_i,s.useDeferredValue=Yi,s.useEffect=Le,s.useId=ln,s.useImperativeHandle=Ci,s.useInsertionEffect=$e,s.useLayoutEffect=gt,s.useMemo=Kt,s.useReducer=Me,s.useRef=Ve,s.useState=ye,s.useSyncExternalStore=lr,s.useTransition=Yt,s.version=h,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)})()})(bC,bC.exports);var QL=bC.exports;wO.exports=QL;var Ct=wO.exports;const II=xO(Ct),ez=KL({__proto__:null,default:II},[Ct]);/**
 * @license React
 * react-jsx-dev-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){var d=Ct,s=Symbol.for("react.element"),h=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),r=Symbol.for("react.context"),z=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),K=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),ue=Symbol.for("react.offscreen"),pe=Symbol.iterator,xe="@@iterator";function be(et){if(et===null||typeof et!="object")return null;var vi=pe&&et[pe]||et[xe];return typeof vi=="function"?vi:null}var je=d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Be(et){{for(var vi=arguments.length,ie=new Array(vi>1?vi-1:0),W=1;W<vi;W++)ie[W-1]=arguments[W];He("error",et,ie)}}function He(et,vi,ie){{var W=je.ReactDebugCurrentFrame,X=W.getStackAddendum();X!==""&&(vi+="%s",ie=ie.concat([X]));var he=ie.map(function(we){return String(we)});he.unshift("Warning: "+vi),Function.prototype.apply.call(console[et],console,he)}}var Xe=!1,it=!1,kt=!1,Nt=!1,oi=!1,yi;yi=Symbol.for("react.module.reference");function Ui(et){return!!(typeof et=="string"||typeof et=="function"||et===_||et===E||oi||et===v||et===N||et===H||Nt||et===ue||Xe||it||kt||typeof et=="object"&&et!==null&&(et.$$typeof===ne||et.$$typeof===K||et.$$typeof===C||et.$$typeof===r||et.$$typeof===z||et.$$typeof===yi||et.getModuleId!==void 0))}function hi(et,vi,ie){var W=et.displayName;if(W)return W;var X=vi.displayName||vi.name||"";return X!==""?ie+"("+X+")":ie}function Ti(et){return et.displayName||"Context"}function Dt(et){if(et==null)return null;if(typeof et.tag=="number"&&Be("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof et=="function")return et.displayName||et.name||null;if(typeof et=="string")return et;switch(et){case _:return"Fragment";case h:return"Portal";case E:return"Profiler";case v:return"StrictMode";case N:return"Suspense";case H:return"SuspenseList"}if(typeof et=="object")switch(et.$$typeof){case r:var vi=et;return Ti(vi)+".Consumer";case C:var ie=et;return Ti(ie._context)+".Provider";case z:return hi(et,et.render,"ForwardRef");case K:var W=et.displayName||null;return W!==null?W:Dt(et.type)||"Memo";case ne:{var X=et,he=X._payload,we=X._init;try{return Dt(we(he))}catch{return null}}}return null}var Di=Object.assign,Qt=0,ui,ri,zi,En,hr,wr,Jn;function xn(){}xn.__reactDisabledLog=!0;function mr(){{if(Qt===0){ui=console.log,ri=console.info,zi=console.warn,En=console.error,hr=console.group,wr=console.groupCollapsed,Jn=console.groupEnd;var et={configurable:!0,enumerable:!0,value:xn,writable:!0};Object.defineProperties(console,{info:et,log:et,warn:et,error:et,group:et,groupCollapsed:et,groupEnd:et})}Qt++}}function Va(){{if(Qt--,Qt===0){var et={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Di({},et,{value:ui}),info:Di({},et,{value:ri}),warn:Di({},et,{value:zi}),error:Di({},et,{value:En}),group:Di({},et,{value:hr}),groupCollapsed:Di({},et,{value:wr}),groupEnd:Di({},et,{value:Jn})})}Qt<0&&Be("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Aa=je.ReactCurrentDispatcher,Gi;function Cn(et,vi,ie){{if(Gi===void 0)try{throw Error()}catch(X){var W=X.stack.trim().match(/\n( *(at )?)/);Gi=W&&W[1]||""}return`
`+Gi+et}}var Vi=!1,Rn;{var gr=typeof WeakMap=="function"?WeakMap:Map;Rn=new gr}function za(et,vi){if(!et||Vi)return"";{var ie=Rn.get(et);if(ie!==void 0)return ie}var W;Vi=!0;var X=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var he;he=Aa.current,Aa.current=null,mr();try{if(vi){var we=function(){throw Error()};if(Object.defineProperty(we.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(we,[])}catch(Kt){W=Kt}Reflect.construct(et,[],we)}else{try{we.call()}catch(Kt){W=Kt}et.call(we.prototype)}}else{try{throw Error()}catch(Kt){W=Kt}et()}}catch(Kt){if(Kt&&W&&typeof Kt.stack=="string"){for(var ye=Kt.stack.split(`
`),Me=W.stack.split(`
`),Ve=ye.length-1,Le=Me.length-1;Ve>=1&&Le>=0&&ye[Ve]!==Me[Le];)Le--;for(;Ve>=1&&Le>=0;Ve--,Le--)if(ye[Ve]!==Me[Le]){if(Ve!==1||Le!==1)do if(Ve--,Le--,Le<0||ye[Ve]!==Me[Le]){var $e=`
`+ye[Ve].replace(" at new "," at ");return et.displayName&&$e.includes("<anonymous>")&&($e=$e.replace("<anonymous>",et.displayName)),typeof et=="function"&&Rn.set(et,$e),$e}while(Ve>=1&&Le>=0);break}}}finally{Vi=!1,Aa.current=he,Va(),Error.prepareStackTrace=X}var gt=et?et.displayName||et.name:"",ut=gt?Cn(gt):"";return typeof et=="function"&&Rn.set(et,ut),ut}function Bn(et,vi,ie){return za(et,!1)}function eo(et){var vi=et.prototype;return!!(vi&&vi.isReactComponent)}function jr(et,vi,ie){if(et==null)return"";if(typeof et=="function")return za(et,eo(et));if(typeof et=="string")return Cn(et);switch(et){case N:return Cn("Suspense");case H:return Cn("SuspenseList")}if(typeof et=="object")switch(et.$$typeof){case z:return Bn(et.render);case K:return jr(et.type,vi,ie);case ne:{var W=et,X=W._payload,he=W._init;try{return jr(he(X),vi,ie)}catch{}}}return""}var Zr=Object.prototype.hasOwnProperty,to={},Pr=je.ReactDebugCurrentFrame;function Do(et){if(et){var vi=et._owner,ie=jr(et.type,et._source,vi?vi.type:null);Pr.setExtraStackFrame(ie)}else Pr.setExtraStackFrame(null)}function mo(et,vi,ie,W,X){{var he=Function.call.bind(Zr);for(var we in et)if(he(et,we)){var ye=void 0;try{if(typeof et[we]!="function"){var Me=Error((W||"React class")+": "+ie+" type `"+we+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof et[we]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw Me.name="Invariant Violation",Me}ye=et[we](vi,we,W,ie,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(Ve){ye=Ve}ye&&!(ye instanceof Error)&&(Do(X),Be("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",W||"React class",ie,we,typeof ye),Do(null)),ye instanceof Error&&!(ye.message in to)&&(to[ye.message]=!0,Do(X),Be("Failed %s type: %s",ie,ye.message),Do(null))}}}var ha=Array.isArray;function Ra(et){return ha(et)}function bo(et){{var vi=typeof Symbol=="function"&&Symbol.toStringTag,ie=vi&&et[Symbol.toStringTag]||et.constructor.name||"Object";return ie}}function Fa(et){try{return wa(et),!1}catch{return!0}}function wa(et){return""+et}function Na(et){if(Fa(et))return Be("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",bo(et)),wa(et)}var qa=je.ReactCurrentOwner,xs={key:!0,ref:!0,__self:!0,__source:!0},ja,Pi,rn;rn={};function Qn(et){if(Zr.call(et,"ref")){var vi=Object.getOwnPropertyDescriptor(et,"ref").get;if(vi&&vi.isReactWarning)return!1}return et.ref!==void 0}function Fr(et){if(Zr.call(et,"key")){var vi=Object.getOwnPropertyDescriptor(et,"key").get;if(vi&&vi.isReactWarning)return!1}return et.key!==void 0}function Un(et,vi){if(typeof et.ref=="string"&&qa.current&&vi&&qa.current.stateNode!==vi){var ie=Dt(qa.current.type);rn[ie]||(Be('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. This case cannot be automatically converted to an arrow function. We ask you to manually fix this case by using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',Dt(qa.current.type),et.ref),rn[ie]=!0)}}function da(et,vi){{var ie=function(){ja||(ja=!0,Be("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",vi))};ie.isReactWarning=!0,Object.defineProperty(et,"key",{get:ie,configurable:!0})}}function _a(et,vi){{var ie=function(){Pi||(Pi=!0,Be("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",vi))};ie.isReactWarning=!0,Object.defineProperty(et,"ref",{get:ie,configurable:!0})}}var Ga=function(et,vi,ie,W,X,he,we){var ye={$$typeof:s,type:et,key:vi,ref:ie,props:we,_owner:he};return ye._store={},Object.defineProperty(ye._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(ye,"_self",{configurable:!1,enumerable:!1,writable:!1,value:W}),Object.defineProperty(ye,"_source",{configurable:!1,enumerable:!1,writable:!1,value:X}),Object.freeze&&(Object.freeze(ye.props),Object.freeze(ye)),ye};function Vr(et,vi,ie,W,X){{var he,we={},ye=null,Me=null;ie!==void 0&&(Na(ie),ye=""+ie),Fr(vi)&&(Na(vi.key),ye=""+vi.key),Qn(vi)&&(Me=vi.ref,Un(vi,X));for(he in vi)Zr.call(vi,he)&&!xs.hasOwnProperty(he)&&(we[he]=vi[he]);if(et&&et.defaultProps){var Ve=et.defaultProps;for(he in Ve)we[he]===void 0&&(we[he]=Ve[he])}if(ye||Me){var Le=typeof et=="function"?et.displayName||et.name||"Unknown":et;ye&&da(we,Le),Me&&_a(we,Le)}return Ga(et,ye,Me,X,W,qa.current,we)}}var xr=je.ReactCurrentOwner,_n=je.ReactDebugCurrentFrame;function aa(et){if(et){var vi=et._owner,ie=jr(et.type,et._source,vi?vi.type:null);_n.setExtraStackFrame(ie)}else _n.setExtraStackFrame(null)}var wo;wo=!1;function go(et){return typeof et=="object"&&et!==null&&et.$$typeof===s}function no(){{if(xr.current){var et=Dt(xr.current.type);if(et)return`

Check the render method of \``+et+"`."}return""}}function tc(et){{if(et!==void 0){var vi=et.fileName.replace(/^.*[\\\/]/,""),ie=et.lineNumber;return`

Check your code at `+vi+":"+ie+"."}return""}}var ml={};function ic(et){{var vi=no();if(!vi){var ie=typeof et=="string"?et:et.displayName||et.name;ie&&(vi=`

Check the top-level render call using <`+ie+">.")}return vi}}function Ks(et,vi){{if(!et._store||et._store.validated||et.key!=null)return;et._store.validated=!0;var ie=ic(vi);if(ml[ie])return;ml[ie]=!0;var W="";et&&et._owner&&et._owner!==xr.current&&(W=" It was passed a child from "+Dt(et._owner.type)+"."),aa(et),Be('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',ie,W),aa(null)}}function vt(et,vi){{if(typeof et!="object")return;if(Ra(et))for(var ie=0;ie<et.length;ie++){var W=et[ie];go(W)&&Ks(W,vi)}else if(go(et))et._store&&(et._store.validated=!0);else if(et){var X=be(et);if(typeof X=="function"&&X!==et.entries)for(var he=X.call(et),we;!(we=he.next()).done;)go(we.value)&&Ks(we.value,vi)}}}function To(et){{var vi=et.type;if(vi==null||typeof vi=="string")return;var ie;if(typeof vi=="function")ie=vi.propTypes;else if(typeof vi=="object"&&(vi.$$typeof===z||vi.$$typeof===K))ie=vi.propTypes;else return;if(ie){var W=Dt(vi);mo(ie,et.props,"prop",W,et)}else if(vi.PropTypes!==void 0&&!wo){wo=!0;var X=Dt(vi);Be("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",X||"Unknown")}typeof vi.getDefaultProps=="function"&&!vi.getDefaultProps.isReactClassApproved&&Be("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Go(et){{for(var vi=Object.keys(et.props),ie=0;ie<vi.length;ie++){var W=vi[ie];if(W!=="children"&&W!=="key"){aa(et),Be("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",W),aa(null);break}}et.ref!==null&&(aa(et),Be("Invalid attribute `ref` supplied to `React.Fragment`."),aa(null))}}var Mo={};function cn(et,vi,ie,W,X,he){{var we=Ui(et);if(!we){var ye="";(et===void 0||typeof et=="object"&&et!==null&&Object.keys(et).length===0)&&(ye+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var Me=tc(X);Me?ye+=Me:ye+=no();var Ve;et===null?Ve="null":Ra(et)?Ve="array":et!==void 0&&et.$$typeof===s?(Ve="<"+(Dt(et.type)||"Unknown")+" />",ye=" Did you accidentally export a JSX literal instead of a component?"):Ve=typeof et,Be("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",Ve,ye)}var Le=Vr(et,vi,ie,X,he);if(Le==null)return Le;if(we){var $e=vi.children;if($e!==void 0)if(W)if(Ra($e)){for(var gt=0;gt<$e.length;gt++)vt($e[gt],et);Object.freeze&&Object.freeze($e)}else Be("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else vt($e,et)}if(Zr.call(vi,"key")){var ut=Dt(et),Kt=Object.keys(vi).filter(function(Yt){return Yt!=="key"}),Ci=Kt.length>0?"{key: someKey, "+Kt.join(": ..., ")+": ...}":"{key: someKey}";if(!Mo[ut+Ci]){var _i=Kt.length>0?"{"+Kt.join(": ..., ")+": ...}":"{}";Be(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Ci,ut,_i,ut),Mo[ut+Ci]=!0}}return et===_?Go(Le):To(Le),Le}}var Za=cn;oI.Fragment=_,oI.jsxDEV=Za})();bO.exports=oI;var Ut=bO.exports,sI={},TO={exports:{}},sh={},SO={exports:{}},EO={};(function(d){/**
 * @license React
 * scheduler.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var s=!1,h=5;function _(Pi,rn){var Qn=Pi.length;Pi.push(rn),C(Pi,rn,Qn)}function v(Pi){return Pi.length===0?null:Pi[0]}function E(Pi){if(Pi.length===0)return null;var rn=Pi[0],Qn=Pi.pop();return Qn!==rn&&(Pi[0]=Qn,r(Pi,Qn,0)),rn}function C(Pi,rn,Qn){for(var Fr=Qn;Fr>0;){var Un=Fr-1>>>1,da=Pi[Un];if(z(da,rn)>0)Pi[Un]=rn,Pi[Fr]=da,Fr=Un;else return}}function r(Pi,rn,Qn){for(var Fr=Qn,Un=Pi.length,da=Un>>>1;Fr<da;){var _a=(Fr+1)*2-1,Ga=Pi[_a],Vr=_a+1,xr=Pi[Vr];if(z(Ga,rn)<0)Vr<Un&&z(xr,Ga)<0?(Pi[Fr]=xr,Pi[Vr]=rn,Fr=Vr):(Pi[Fr]=Ga,Pi[_a]=rn,Fr=_a);else if(Vr<Un&&z(xr,rn)<0)Pi[Fr]=xr,Pi[Vr]=rn,Fr=Vr;else return}}function z(Pi,rn){var Qn=Pi.sortIndex-rn.sortIndex;return Qn!==0?Qn:Pi.id-rn.id}var N=1,H=2,K=3,ne=4,ue=5;function pe(Pi,rn){}var xe=typeof performance=="object"&&typeof performance.now=="function";if(xe){var be=performance;d.unstable_now=function(){return be.now()}}else{var je=Date,Be=je.now();d.unstable_now=function(){return je.now()-Be}}var He=1073741823,Xe=-1,it=250,kt=5e3,Nt=1e4,oi=He,yi=[],Ui=[],hi=1,Ti=null,Dt=K,Di=!1,Qt=!1,ui=!1,ri=typeof setTimeout=="function"?setTimeout:null,zi=typeof clearTimeout=="function"?clearTimeout:null,En=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function hr(Pi){for(var rn=v(Ui);rn!==null;){if(rn.callback===null)E(Ui);else if(rn.startTime<=Pi)E(Ui),rn.sortIndex=rn.expirationTime,_(yi,rn);else return;rn=v(Ui)}}function wr(Pi){if(ui=!1,hr(Pi),!Qt)if(v(yi)!==null)Qt=!0,wa(Jn);else{var rn=v(Ui);rn!==null&&Na(wr,rn.startTime-Pi)}}function Jn(Pi,rn){Qt=!1,ui&&(ui=!1,qa()),Di=!0;var Qn=Dt;try{var Fr;if(!s)return xn(Pi,rn)}finally{Ti=null,Dt=Qn,Di=!1}}function xn(Pi,rn){var Qn=rn;for(hr(Qn),Ti=v(yi);Ti!==null&&!(Ti.expirationTime>Qn&&(!Pi||Pr()));){var Fr=Ti.callback;if(typeof Fr=="function"){Ti.callback=null,Dt=Ti.priorityLevel;var Un=Ti.expirationTime<=Qn,da=Fr(Un);Qn=d.unstable_now(),typeof da=="function"?Ti.callback=da:Ti===v(yi)&&E(yi),hr(Qn)}else E(yi);Ti=v(yi)}if(Ti!==null)return!0;var _a=v(Ui);return _a!==null&&Na(wr,_a.startTime-Qn),!1}function mr(Pi,rn){switch(Pi){case N:case H:case K:case ne:case ue:break;default:Pi=K}var Qn=Dt;Dt=Pi;try{return rn()}finally{Dt=Qn}}function Va(Pi){var rn;switch(Dt){case N:case H:case K:rn=K;break;default:rn=Dt;break}var Qn=Dt;Dt=rn;try{return Pi()}finally{Dt=Qn}}function Aa(Pi){var rn=Dt;return function(){var Qn=Dt;Dt=rn;try{return Pi.apply(this,arguments)}finally{Dt=Qn}}}function Gi(Pi,rn,Qn){var Fr=d.unstable_now(),Un;if(typeof Qn=="object"&&Qn!==null){var da=Qn.delay;typeof da=="number"&&da>0?Un=Fr+da:Un=Fr}else Un=Fr;var _a;switch(Pi){case N:_a=Xe;break;case H:_a=it;break;case ue:_a=oi;break;case ne:_a=Nt;break;case K:default:_a=kt;break}var Ga=Un+_a,Vr={id:hi++,callback:rn,priorityLevel:Pi,startTime:Un,expirationTime:Ga,sortIndex:-1};return Un>Fr?(Vr.sortIndex=Un,_(Ui,Vr),v(yi)===null&&Vr===v(Ui)&&(ui?qa():ui=!0,Na(wr,Un-Fr))):(Vr.sortIndex=Ga,_(yi,Vr),!Qt&&!Di&&(Qt=!0,wa(Jn))),Vr}function Cn(){}function Vi(){!Qt&&!Di&&(Qt=!0,wa(Jn))}function Rn(){return v(yi)}function gr(Pi){Pi.callback=null}function za(){return Dt}var Bn=!1,eo=null,jr=-1,Zr=h,to=-1;function Pr(){var Pi=d.unstable_now()-to;return!(Pi<Zr)}function Do(){}function mo(Pi){if(Pi<0||Pi>125){console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported");return}Pi>0?Zr=Math.floor(1e3/Pi):Zr=h}var ha=function(){if(eo!==null){var Pi=d.unstable_now();to=Pi;var rn=!0,Qn=!0;try{Qn=eo(rn,Pi)}finally{Qn?Ra():(Bn=!1,eo=null)}}else Bn=!1},Ra;if(typeof En=="function")Ra=function(){En(ha)};else if(typeof MessageChannel<"u"){var bo=new MessageChannel,Fa=bo.port2;bo.port1.onmessage=ha,Ra=function(){Fa.postMessage(null)}}else Ra=function(){ri(ha,0)};function wa(Pi){eo=Pi,Bn||(Bn=!0,Ra())}function Na(Pi,rn){jr=ri(function(){Pi(d.unstable_now())},rn)}function qa(){zi(jr),jr=-1}var xs=Do,ja=null;d.unstable_IdlePriority=ue,d.unstable_ImmediatePriority=N,d.unstable_LowPriority=ne,d.unstable_NormalPriority=K,d.unstable_Profiling=ja,d.unstable_UserBlockingPriority=H,d.unstable_cancelCallback=gr,d.unstable_continueExecution=Vi,d.unstable_forceFrameRate=mo,d.unstable_getCurrentPriorityLevel=za,d.unstable_getFirstCallbackNode=Rn,d.unstable_next=Va,d.unstable_pauseExecution=Cn,d.unstable_requestPaint=xs,d.unstable_runWithPriority=mr,d.unstable_scheduleCallback=Gi,d.unstable_shouldYield=Pr,d.unstable_wrapCallback=Aa,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)})()})(EO);SO.exports=EO;var tz=SO.exports;/**
 * @license React
 * react-dom.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStart(new Error);var d=Ct,s=tz,h=d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_=!1;function v(l){_=l}function E(l){if(!_){for(var u=arguments.length,w=new Array(u>1?u-1:0),I=1;I<u;I++)w[I-1]=arguments[I];r("warn",l,w)}}function C(l){if(!_){for(var u=arguments.length,w=new Array(u>1?u-1:0),I=1;I<u;I++)w[I-1]=arguments[I];r("error",l,w)}}function r(l,u,w){{var I=h.ReactDebugCurrentFrame,O=I.getStackAddendum();O!==""&&(u+="%s",w=w.concat([O]));var G=w.map(function(Y){return String(Y)});G.unshift("Warning: "+u),Function.prototype.apply.call(console[l],console,G)}}var z=0,N=1,H=2,K=3,ne=4,ue=5,pe=6,xe=7,be=8,je=9,Be=10,He=11,Xe=12,it=13,kt=14,Nt=15,oi=16,yi=17,Ui=18,hi=19,Ti=21,Dt=22,Di=23,Qt=24,ui=25,ri=!0,zi=!1,En=!1,hr=!1,wr=!1,Jn=!0,xn=!0,mr=!0,Va=!0,Aa=new Set,Gi={},Cn={};function Vi(l,u){Rn(l,u),Rn(l+"Capture",u)}function Rn(l,u){Gi[l]&&C("EventRegistry: More than one plugin attempted to publish the same registration name, `%s`.",l),Gi[l]=u;{var w=l.toLowerCase();Cn[w]=l,l==="onDoubleClick"&&(Cn.ondblclick=l)}for(var I=0;I<u.length;I++)Aa.add(u[I])}var gr=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",za=Object.prototype.hasOwnProperty;function Bn(l){{var u=typeof Symbol=="function"&&Symbol.toStringTag,w=u&&l[Symbol.toStringTag]||l.constructor.name||"Object";return w}}function eo(l){try{return jr(l),!1}catch{return!0}}function jr(l){return""+l}function Zr(l,u){if(eo(l))return C("The provided `%s` attribute is an unsupported type %s. This value must be coerced to a string before before using it here.",u,Bn(l)),jr(l)}function to(l){if(eo(l))return C("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",Bn(l)),jr(l)}function Pr(l,u){if(eo(l))return C("The provided `%s` prop is an unsupported type %s. This value must be coerced to a string before before using it here.",u,Bn(l)),jr(l)}function Do(l,u){if(eo(l))return C("The provided `%s` CSS property is an unsupported type %s. This value must be coerced to a string before before using it here.",u,Bn(l)),jr(l)}function mo(l){if(eo(l))return C("The provided HTML markup uses a value of unsupported type %s. This value must be coerced to a string before before using it here.",Bn(l)),jr(l)}function ha(l){if(eo(l))return C("Form field values (value, checked, defaultValue, or defaultChecked props) must be strings, not %s. This value must be coerced to a string before before using it here.",Bn(l)),jr(l)}var Ra=0,bo=1,Fa=2,wa=3,Na=4,qa=5,xs=6,ja=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",Pi=ja+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",rn=new RegExp("^["+ja+"]["+Pi+"]*$"),Qn={},Fr={};function Un(l){return za.call(Fr,l)?!0:za.call(Qn,l)?!1:rn.test(l)?(Fr[l]=!0,!0):(Qn[l]=!0,C("Invalid attribute name: `%s`",l),!1)}function da(l,u,w){return u!==null?u.type===Ra:w?!1:l.length>2&&(l[0]==="o"||l[0]==="O")&&(l[1]==="n"||l[1]==="N")}function _a(l,u,w,I){if(w!==null&&w.type===Ra)return!1;switch(typeof u){case"function":case"symbol":return!0;case"boolean":{if(I)return!1;if(w!==null)return!w.acceptsBooleans;var O=l.toLowerCase().slice(0,5);return O!=="data-"&&O!=="aria-"}default:return!1}}function Ga(l,u,w,I){if(u===null||typeof u>"u"||_a(l,u,w,I))return!0;if(I)return!1;if(w!==null)switch(w.type){case wa:return!u;case Na:return u===!1;case qa:return isNaN(u);case xs:return isNaN(u)||u<1}return!1}function Vr(l){return _n.hasOwnProperty(l)?_n[l]:null}function xr(l,u,w,I,O,G,Y){this.acceptsBooleans=u===Fa||u===wa||u===Na,this.attributeName=I,this.attributeNamespace=O,this.mustUseProperty=w,this.propertyName=l,this.type=u,this.sanitizeURL=G,this.removeEmptyString=Y}var _n={},aa=["children","dangerouslySetInnerHTML","defaultValue","defaultChecked","innerHTML","suppressContentEditableWarning","suppressHydrationWarning","style"];aa.forEach(function(l){_n[l]=new xr(l,Ra,!1,l,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(l){var u=l[0],w=l[1];_n[u]=new xr(u,bo,!1,w,null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(l){_n[l]=new xr(l,Fa,!1,l.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(l){_n[l]=new xr(l,Fa,!1,l,null,!1,!1)}),["allowFullScreen","async","autoFocus","autoPlay","controls","default","defer","disabled","disablePictureInPicture","disableRemotePlayback","formNoValidate","hidden","loop","noModule","noValidate","open","playsInline","readOnly","required","reversed","scoped","seamless","itemScope"].forEach(function(l){_n[l]=new xr(l,wa,!1,l.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(l){_n[l]=new xr(l,wa,!0,l,null,!1,!1)}),["capture","download"].forEach(function(l){_n[l]=new xr(l,Na,!1,l,null,!1,!1)}),["cols","rows","size","span"].forEach(function(l){_n[l]=new xr(l,xs,!1,l,null,!1,!1)}),["rowSpan","start"].forEach(function(l){_n[l]=new xr(l,qa,!1,l.toLowerCase(),null,!1,!1)});var wo=/[\-\:]([a-z])/g,go=function(l){return l[1].toUpperCase()};["accent-height","alignment-baseline","arabic-form","baseline-shift","cap-height","clip-path","clip-rule","color-interpolation","color-interpolation-filters","color-profile","color-rendering","dominant-baseline","enable-background","fill-opacity","fill-rule","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","glyph-name","glyph-orientation-horizontal","glyph-orientation-vertical","horiz-adv-x","horiz-origin-x","image-rendering","letter-spacing","lighting-color","marker-end","marker-mid","marker-start","overline-position","overline-thickness","paint-order","panose-1","pointer-events","rendering-intent","shape-rendering","stop-color","stop-opacity","strikethrough-position","strikethrough-thickness","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-anchor","text-decoration","text-rendering","underline-position","underline-thickness","unicode-bidi","unicode-range","units-per-em","v-alphabetic","v-hanging","v-ideographic","v-mathematical","vector-effect","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","writing-mode","xmlns:xlink","x-height"].forEach(function(l){var u=l.replace(wo,go);_n[u]=new xr(u,bo,!1,l,null,!1,!1)}),["xlink:actuate","xlink:arcrole","xlink:role","xlink:show","xlink:title","xlink:type"].forEach(function(l){var u=l.replace(wo,go);_n[u]=new xr(u,bo,!1,l,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(l){var u=l.replace(wo,go);_n[u]=new xr(u,bo,!1,l,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(l){_n[l]=new xr(l,bo,!1,l.toLowerCase(),null,!1,!1)});var no="xlinkHref";_n[no]=new xr("xlinkHref",bo,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(l){_n[l]=new xr(l,bo,!1,l.toLowerCase(),null,!0,!0)});var tc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*\:/i,ml=!1;function ic(l){!ml&&tc.test(l)&&(ml=!0,C("A future version of React will block javascript: URLs as a security precaution. Use event handlers instead if you can. If you need to generate unsafe HTML try using dangerouslySetInnerHTML instead. React was passed %s.",JSON.stringify(l)))}function Ks(l,u,w,I){if(I.mustUseProperty){var O=I.propertyName;return l[O]}else{Zr(w,u),I.sanitizeURL&&ic(""+w);var G=I.attributeName,Y=null;if(I.type===Na){if(l.hasAttribute(G)){var oe=l.getAttribute(G);return oe===""?!0:Ga(u,w,I,!1)?oe:oe===""+w?w:oe}}else if(l.hasAttribute(G)){if(Ga(u,w,I,!1))return l.getAttribute(G);if(I.type===wa)return w;Y=l.getAttribute(G)}return Ga(u,w,I,!1)?Y===null?w:Y:Y===""+w?w:Y}}function vt(l,u,w,I){{if(!Un(u))return;if(!l.hasAttribute(u))return w===void 0?void 0:null;var O=l.getAttribute(u);return Zr(w,u),O===""+w?w:O}}function To(l,u,w,I){var O=Vr(u);if(!da(u,O,I)){if(Ga(u,w,O,I)&&(w=null),I||O===null){if(Un(u)){var G=u;w===null?l.removeAttribute(G):(Zr(w,u),l.setAttribute(G,""+w))}return}var Y=O.mustUseProperty;if(Y){var oe=O.propertyName;if(w===null){var fe=O.type;l[oe]=fe===wa?!1:""}else l[oe]=w;return}var Oe=O.attributeName,Ne=O.attributeNamespace;if(w===null)l.removeAttribute(Oe);else{var ft=O.type,dt;ft===wa||ft===Na&&w===!0?dt="":(Zr(w,Oe),dt=""+w,O.sanitizeURL&&ic(dt.toString())),Ne?l.setAttributeNS(Ne,Oe,dt):l.setAttribute(Oe,dt)}}}var Go=Symbol.for("react.element"),Mo=Symbol.for("react.portal"),cn=Symbol.for("react.fragment"),Za=Symbol.for("react.strict_mode"),et=Symbol.for("react.profiler"),vi=Symbol.for("react.provider"),ie=Symbol.for("react.context"),W=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),he=Symbol.for("react.suspense_list"),we=Symbol.for("react.memo"),ye=Symbol.for("react.lazy"),Me=Symbol.for("react.scope"),Ve=Symbol.for("react.debug_trace_mode"),Le=Symbol.for("react.offscreen"),$e=Symbol.for("react.legacy_hidden"),gt=Symbol.for("react.cache"),ut=Symbol.for("react.tracing_marker"),Kt=Symbol.iterator,Ci="@@iterator";function _i(l){if(l===null||typeof l!="object")return null;var u=Kt&&l[Kt]||l[Ci];return typeof u=="function"?u:null}var Yt=Object.assign,Yi=0,ln,lr,Or,Ta,oa,Kr,er;function bn(){}bn.__reactDisabledLog=!0;function Rr(){{if(Yi===0){ln=console.log,lr=console.info,Or=console.warn,Ta=console.error,oa=console.group,Kr=console.groupCollapsed,er=console.groupEnd;var l={configurable:!0,enumerable:!0,value:bn,writable:!0};Object.defineProperties(console,{info:l,log:l,warn:l,error:l,group:l,groupCollapsed:l,groupEnd:l})}Yi++}}function Gr(){{if(Yi--,Yi===0){var l={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Yt({},l,{value:ln}),info:Yt({},l,{value:lr}),warn:Yt({},l,{value:Or}),error:Yt({},l,{value:Ta}),group:Yt({},l,{value:oa}),groupCollapsed:Yt({},l,{value:Kr}),groupEnd:Yt({},l,{value:er})})}Yi<0&&C("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var rr=h.ReactCurrentDispatcher,Tr;function sa(l,u,w){{if(Tr===void 0)try{throw Error()}catch(O){var I=O.stack.trim().match(/\n( *(at )?)/);Tr=I&&I[1]||""}return`
`+Tr+l}}var ro=!1,Ho;{var Ll=typeof WeakMap=="function"?WeakMap:Map;Ho=new Ll}function Ia(l,u){if(!l||ro)return"";{var w=Ho.get(l);if(w!==void 0)return w}var I;ro=!0;var O=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var G;G=rr.current,rr.current=null,Rr();try{if(u){var Y=function(){throw Error()};if(Object.defineProperty(Y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Y,[])}catch(jt){I=jt}Reflect.construct(l,[],Y)}else{try{Y.call()}catch(jt){I=jt}l.call(Y.prototype)}}else{try{throw Error()}catch(jt){I=jt}l()}}catch(jt){if(jt&&I&&typeof jt.stack=="string"){for(var oe=jt.stack.split(`
`),fe=I.stack.split(`
`),Oe=oe.length-1,Ne=fe.length-1;Oe>=1&&Ne>=0&&oe[Oe]!==fe[Ne];)Ne--;for(;Oe>=1&&Ne>=0;Oe--,Ne--)if(oe[Oe]!==fe[Ne]){if(Oe!==1||Ne!==1)do if(Oe--,Ne--,Ne<0||oe[Oe]!==fe[Ne]){var ft=`
`+oe[Oe].replace(" at new "," at ");return l.displayName&&ft.includes("<anonymous>")&&(ft=ft.replace("<anonymous>",l.displayName)),typeof l=="function"&&Ho.set(l,ft),ft}while(Oe>=1&&Ne>=0);break}}}finally{ro=!1,rr.current=G,Gr(),Error.prepareStackTrace=O}var dt=l?l.displayName||l.name:"",Vt=dt?sa(dt):"";return typeof l=="function"&&Ho.set(l,Vt),Vt}function as(l,u,w){return Ia(l,!0)}function Po(l,u,w){return Ia(l,!1)}function Js(l){var u=l.prototype;return!!(u&&u.isReactComponent)}function Ko(l,u,w){if(l==null)return"";if(typeof l=="function")return Ia(l,Js(l));if(typeof l=="string")return sa(l);switch(l){case X:return sa("Suspense");case he:return sa("SuspenseList")}if(typeof l=="object")switch(l.$$typeof){case W:return Po(l.render);case we:return Ko(l.type,u,w);case ye:{var I=l,O=I._payload,G=I._init;try{return Ko(G(O),u,w)}catch{}}}return""}function bs(l){switch(l._debugOwner&&l._debugOwner.type,l._debugSource,l.tag){case ue:return sa(l.type);case oi:return sa("Lazy");case it:return sa("Suspense");case hi:return sa("SuspenseList");case z:case H:case Nt:return Po(l.type);case He:return Po(l.type.render);case N:return as(l.type);default:return""}}function Rc(l){try{var u="",w=l;do u+=bs(w),w=w.return;while(w);return u}catch(I){return`
Error generating stack: `+I.message+`
`+I.stack}}function ch(l,u,w){var I=l.displayName;if(I)return I;var O=u.displayName||u.name||"";return O!==""?w+"("+O+")":w}function xu(l){return l.displayName||"Context"}function Nr(l){if(l==null)return null;if(typeof l.tag=="number"&&C("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case cn:return"Fragment";case Mo:return"Portal";case et:return"Profiler";case Za:return"StrictMode";case X:return"Suspense";case he:return"SuspenseList"}if(typeof l=="object")switch(l.$$typeof){case ie:var u=l;return xu(u)+".Consumer";case vi:var w=l;return xu(w._context)+".Provider";case W:return ch(l,l.render,"ForwardRef");case we:var I=l.displayName||null;return I!==null?I:Nr(l.type)||"Memo";case ye:{var O=l,G=O._payload,Y=O._init;try{return Nr(Y(G))}catch{return null}}}return null}function os(l,u,w){var I=u.displayName||u.name||"";return l.displayName||(I!==""?w+"("+I+")":w)}function $o(l){return l.displayName||"Context"}function pn(l){var u=l.tag,w=l.type;switch(u){case Qt:return"Cache";case je:var I=w;return $o(I)+".Consumer";case Be:var O=w;return $o(O._context)+".Provider";case Ui:return"DehydratedFragment";case He:return os(w,w.render,"ForwardRef");case xe:return"Fragment";case ue:return w;case ne:return"Portal";case K:return"Root";case pe:return"Text";case oi:return Nr(w);case be:return w===Za?"StrictMode":"Mode";case Dt:return"Offscreen";case Xe:return"Profiler";case Ti:return"Scope";case it:return"Suspense";case hi:return"SuspenseList";case ui:return"TracingMarker";case N:case z:case yi:case H:case kt:case Nt:if(typeof w=="function")return w.displayName||w.name||null;if(typeof w=="string")return w;break}return null}var ss=h.ReactDebugCurrentFrame,ao=null,gl=!1;function nc(){{if(ao===null)return null;var l=ao._debugOwner;if(l!==null&&typeof l<"u")return pn(l)}return null}function $d(){return ao===null?"":Rc(ao)}function Ba(){ss.getCurrentStack=null,ao=null,gl=!1}function fa(l){ss.getCurrentStack=l===null?null:$d,ao=l,gl=!1}function Wd(){return ao}function _l(l){gl=l}function Ha(l){return""+l}function yl(l){switch(typeof l){case"boolean":case"number":case"string":case"undefined":return l;case"object":return ha(l),l;default:return""}}var bu={button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0};function rc(l,u){bu[u.type]||u.onChange||u.onInput||u.readOnly||u.disabled||u.value==null||C("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`."),u.onChange||u.readOnly||u.disabled||u.checked==null||C("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")}function qd(l){var u=l.type,w=l.nodeName;return w&&w.toLowerCase()==="input"&&(u==="checkbox"||u==="radio")}function wu(l){return l._valueTracker}function ac(l){l._valueTracker=null}function Vn(l){var u="";return l&&(qd(l)?u=l.checked?"true":"false":u=l.value),u}function Ic(l){var u=qd(l)?"checked":"value",w=Object.getOwnPropertyDescriptor(l.constructor.prototype,u);ha(l[u]);var I=""+l[u];if(!(l.hasOwnProperty(u)||typeof w>"u"||typeof w.get!="function"||typeof w.set!="function")){var O=w.get,G=w.set;Object.defineProperty(l,u,{configurable:!0,get:function(){return O.call(this)},set:function(oe){ha(oe),I=""+oe,G.call(this,oe)}}),Object.defineProperty(l,u,{enumerable:w.enumerable});var Y={getValue:function(){return I},setValue:function(oe){ha(oe),I=""+oe},stopTracking:function(){ac(l),delete l[u]}};return Y}}function oc(l){wu(l)||(l._valueTracker=Ic(l))}function Tu(l){if(!l)return!1;var u=wu(l);if(!u)return!0;var w=u.getValue(),I=Vn(l);return I!==w?(u.setValue(I),!0):!1}function sc(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var Dc=!1,Mc=!1,Pc=!1,Oc=!1;function dp(l){var u=l.type==="checkbox"||l.type==="radio";return u?l.checked!=null:l.value!=null}function uh(l,u){var w=l,I=u.checked,O=Yt({},u,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:I??w._wrapperState.initialChecked});return O}function zm(l,u){rc("input",u),u.checked!==void 0&&u.defaultChecked!==void 0&&!Mc&&(C("%s contains an input of type %s with both checked and defaultChecked props. Input elements must be either controlled or uncontrolled (specify either the checked prop, or the defaultChecked prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://reactjs.org/link/controlled-components",nc()||"A component",u.type),Mc=!0),u.value!==void 0&&u.defaultValue!==void 0&&!Dc&&(C("%s contains an input of type %s with both value and defaultValue props. Input elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled input element and remove one of these props. More info: https://reactjs.org/link/controlled-components",nc()||"A component",u.type),Dc=!0);var w=l,I=u.defaultValue==null?"":u.defaultValue;w._wrapperState={initialChecked:u.checked!=null?u.checked:u.defaultChecked,initialValue:yl(u.value!=null?u.value:I),controlled:dp(u)}}function ge(l,u){var w=l,I=u.checked;I!=null&&To(w,"checked",I,!1)}function Ye(l,u){var w=l;{var I=dp(u);!w._wrapperState.controlled&&I&&!Oc&&(C("A component is changing an uncontrolled input to be controlled. This is likely caused by the value changing from undefined to a defined value, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://reactjs.org/link/controlled-components"),Oc=!0),w._wrapperState.controlled&&!I&&!Pc&&(C("A component is changing a controlled input to be uncontrolled. This is likely caused by the value changing from a defined to undefined, which should not happen. Decide between using a controlled or uncontrolled input element for the lifetime of the component. More info: https://reactjs.org/link/controlled-components"),Pc=!0)}ge(l,u);var O=yl(u.value),G=u.type;if(O!=null)G==="number"?(O===0&&w.value===""||w.value!=O)&&(w.value=Ha(O)):w.value!==Ha(O)&&(w.value=Ha(O));else if(G==="submit"||G==="reset"){w.removeAttribute("value");return}u.hasOwnProperty("value")?mn(w,u.type,O):u.hasOwnProperty("defaultValue")&&mn(w,u.type,yl(u.defaultValue)),u.checked==null&&u.defaultChecked!=null&&(w.defaultChecked=!!u.defaultChecked)}function zt(l,u,w){var I=l;if(u.hasOwnProperty("value")||u.hasOwnProperty("defaultValue")){var O=u.type,G=O==="submit"||O==="reset";if(G&&(u.value===void 0||u.value===null))return;var Y=Ha(I._wrapperState.initialValue);w||Y!==I.value&&(I.value=Y),I.defaultValue=Y}var oe=I.name;oe!==""&&(I.name=""),I.defaultChecked=!I.defaultChecked,I.defaultChecked=!!I._wrapperState.initialChecked,oe!==""&&(I.name=oe)}function Xt(l,u){var w=l;Ye(w,u),Ai(w,u)}function Ai(l,u){var w=u.name;if(u.type==="radio"&&w!=null){for(var I=l;I.parentNode;)I=I.parentNode;Zr(w,"name");for(var O=I.querySelectorAll("input[name="+JSON.stringify(""+w)+'][type="radio"]'),G=0;G<O.length;G++){var Y=O[G];if(!(Y===l||Y.form!==l.form)){var oe=$x(Y);if(!oe)throw new Error("ReactDOMInput: Mixing React and non-React radio inputs with the same `name` is not supported.");Tu(Y),Ye(Y,oe)}}}}function mn(l,u,w){(u!=="number"||sc(l.ownerDocument)!==l)&&(w==null?l.defaultValue=Ha(l._wrapperState.initialValue):l.defaultValue!==Ha(w)&&(l.defaultValue=Ha(w)))}var Mi=!1,Wn=!1,Ir=!1;function la(l,u){u.value==null&&(typeof u.children=="object"&&u.children!==null?d.Children.forEach(u.children,function(w){w!=null&&(typeof w=="string"||typeof w=="number"||Wn||(Wn=!0,C("Cannot infer the option value of complex children. Pass a `value` prop or use a plain string as children to <option>.")))}):u.dangerouslySetInnerHTML!=null&&(Ir||(Ir=!0,C("Pass a `value` prop if you set dangerouslyInnerHTML so React knows which value should be selected.")))),u.selected!=null&&!Mi&&(C("Use the `defaultValue` or `value` props on <select> instead of setting `selected` on <option>."),Mi=!0)}function Qi(l,u){u.value!=null&&l.setAttribute("value",Ha(yl(u.value)))}var Da=Array.isArray;function Sr(l){return Da(l)}var Xa;Xa=!1;function wi(){var l=nc();return l?`

Check the render method of \``+l+"`.":""}var lc=["value","defaultValue"];function vl(l){{rc("select",l);for(var u=0;u<lc.length;u++){var w=lc[u];if(l[w]!=null){var I=Sr(l[w]);l.multiple&&!I?C("The `%s` prop supplied to <select> must be an array if `multiple` is true.%s",w,wi()):!l.multiple&&I&&C("The `%s` prop supplied to <select> must be a scalar value if `multiple` is false.%s",w,wi())}}}}function Oo(l,u,w,I){var O=l.options;if(u){for(var G=w,Y={},oe=0;oe<G.length;oe++)Y["$"+G[oe]]=!0;for(var fe=0;fe<O.length;fe++){var Oe=Y.hasOwnProperty("$"+O[fe].value);O[fe].selected!==Oe&&(O[fe].selected=Oe),Oe&&I&&(O[fe].defaultSelected=!0)}}else{for(var Ne=Ha(yl(w)),ft=null,dt=0;dt<O.length;dt++){if(O[dt].value===Ne){O[dt].selected=!0,I&&(O[dt].defaultSelected=!0);return}ft===null&&!O[dt].disabled&&(ft=O[dt])}ft!==null&&(ft.selected=!0)}}function ws(l,u){return Yt({},u,{value:void 0})}function kc(l,u){var w=l;vl(u),w._wrapperState={wasMultiple:!!u.multiple},u.value!==void 0&&u.defaultValue!==void 0&&!Xa&&(C("Select elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled select element and remove one of these props. More info: https://reactjs.org/link/controlled-components"),Xa=!0)}function bi(l,u){var w=l;w.multiple=!!u.multiple;var I=u.value;I!=null?Oo(w,!!u.multiple,I,!1):u.defaultValue!=null&&Oo(w,!!u.multiple,u.defaultValue,!0)}function Dn(l,u){var w=l,I=w._wrapperState.wasMultiple;w._wrapperState.wasMultiple=!!u.multiple;var O=u.value;O!=null?Oo(w,!!u.multiple,O,!1):I!==!!u.multiple&&(u.defaultValue!=null?Oo(w,!!u.multiple,u.defaultValue,!0):Oo(w,!!u.multiple,u.multiple?[]:"",!1))}function qn(l,u){var w=l,I=u.value;I!=null&&Oo(w,!!u.multiple,I,!1)}var ks=!1;function hh(l,u){var w=l;if(u.dangerouslySetInnerHTML!=null)throw new Error("`dangerouslySetInnerHTML` does not make sense on <textarea>.");var I=Yt({},u,{value:void 0,defaultValue:void 0,children:Ha(w._wrapperState.initialValue)});return I}function cr(l,u){var w=l;rc("textarea",u),u.value!==void 0&&u.defaultValue!==void 0&&!ks&&(C("%s contains a textarea with both value and defaultValue props. Textarea elements must be either controlled or uncontrolled (specify either the value prop, or the defaultValue prop, but not both). Decide between using a controlled or uncontrolled textarea and remove one of these props. More info: https://reactjs.org/link/controlled-components",nc()||"A component"),ks=!0);var I=u.value;if(I==null){var O=u.children,G=u.defaultValue;if(O!=null){C("Use the `defaultValue` or `value` props instead of setting children on <textarea>.");{if(G!=null)throw new Error("If you supply `defaultValue` on a <textarea>, do not pass children.");if(Sr(O)){if(O.length>1)throw new Error("<textarea> can only have at most one child.");O=O[0]}G=O}}G==null&&(G=""),I=G}w._wrapperState={initialValue:yl(I)}}function Zd(l,u){var w=l,I=yl(u.value),O=yl(u.defaultValue);if(I!=null){var G=Ha(I);G!==w.value&&(w.value=G),u.defaultValue==null&&w.defaultValue!==G&&(w.defaultValue=G)}O!=null&&(w.defaultValue=Ha(O))}function dh(l,u){var w=l,I=w.textContent;I===w._wrapperState.initialValue&&I!==""&&I!==null&&(w.value=I)}function fp(l,u){Zd(l,u)}var Ma="http://www.w3.org/1999/xhtml",io="http://www.w3.org/1998/Math/MathML",N_="http://www.w3.org/2000/svg";function ld(l){switch(l){case"svg":return N_;case"math":return io;default:return Ma}}function pp(l,u){return l==null||l===Ma?ld(u):l===N_&&u==="foreignObject"?Ma:l}var mp=function(l){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(u,w,I,O){MSApp.execUnsafeLocalFunction(function(){return l(u,w,I,O)})}:l},cd,Fm=mp(function(l,u){if(l.namespaceURI===N_&&!("innerHTML"in l)){cd=cd||document.createElement("div"),cd.innerHTML="<svg>"+u.valueOf().toString()+"</svg>";for(var w=cd.firstChild;l.firstChild;)l.removeChild(l.firstChild);for(;w.firstChild;)l.appendChild(w.firstChild);return}l.innerHTML=u}),Jo=1,Sa=3,Pa=8,oo=9,Xd=11,Su=function(l,u){if(u){var w=l.firstChild;if(w&&w===l.lastChild&&w.nodeType===Sa){w.nodeValue=u;return}}l.textContent=u},_o={animation:["animationDelay","animationDirection","animationDuration","animationFillMode","animationIterationCount","animationName","animationPlayState","animationTimingFunction"],background:["backgroundAttachment","backgroundClip","backgroundColor","backgroundImage","backgroundOrigin","backgroundPositionX","backgroundPositionY","backgroundRepeat","backgroundSize"],backgroundPosition:["backgroundPositionX","backgroundPositionY"],border:["borderBottomColor","borderBottomStyle","borderBottomWidth","borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth","borderLeftColor","borderLeftStyle","borderLeftWidth","borderRightColor","borderRightStyle","borderRightWidth","borderTopColor","borderTopStyle","borderTopWidth"],borderBlockEnd:["borderBlockEndColor","borderBlockEndStyle","borderBlockEndWidth"],borderBlockStart:["borderBlockStartColor","borderBlockStartStyle","borderBlockStartWidth"],borderBottom:["borderBottomColor","borderBottomStyle","borderBottomWidth"],borderColor:["borderBottomColor","borderLeftColor","borderRightColor","borderTopColor"],borderImage:["borderImageOutset","borderImageRepeat","borderImageSlice","borderImageSource","borderImageWidth"],borderInlineEnd:["borderInlineEndColor","borderInlineEndStyle","borderInlineEndWidth"],borderInlineStart:["borderInlineStartColor","borderInlineStartStyle","borderInlineStartWidth"],borderLeft:["borderLeftColor","borderLeftStyle","borderLeftWidth"],borderRadius:["borderBottomLeftRadius","borderBottomRightRadius","borderTopLeftRadius","borderTopRightRadius"],borderRight:["borderRightColor","borderRightStyle","borderRightWidth"],borderStyle:["borderBottomStyle","borderLeftStyle","borderRightStyle","borderTopStyle"],borderTop:["borderTopColor","borderTopStyle","borderTopWidth"],borderWidth:["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth"],columnRule:["columnRuleColor","columnRuleStyle","columnRuleWidth"],columns:["columnCount","columnWidth"],flex:["flexBasis","flexGrow","flexShrink"],flexFlow:["flexDirection","flexWrap"],font:["fontFamily","fontFeatureSettings","fontKerning","fontLanguageOverride","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition","fontWeight","lineHeight"],fontVariant:["fontVariantAlternates","fontVariantCaps","fontVariantEastAsian","fontVariantLigatures","fontVariantNumeric","fontVariantPosition"],gap:["columnGap","rowGap"],grid:["gridAutoColumns","gridAutoFlow","gridAutoRows","gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],gridArea:["gridColumnEnd","gridColumnStart","gridRowEnd","gridRowStart"],gridColumn:["gridColumnEnd","gridColumnStart"],gridColumnGap:["columnGap"],gridGap:["columnGap","rowGap"],gridRow:["gridRowEnd","gridRowStart"],gridRowGap:["rowGap"],gridTemplate:["gridTemplateAreas","gridTemplateColumns","gridTemplateRows"],listStyle:["listStyleImage","listStylePosition","listStyleType"],margin:["marginBottom","marginLeft","marginRight","marginTop"],marker:["markerEnd","markerMid","markerStart"],mask:["maskClip","maskComposite","maskImage","maskMode","maskOrigin","maskPositionX","maskPositionY","maskRepeat","maskSize"],maskPosition:["maskPositionX","maskPositionY"],outline:["outlineColor","outlineStyle","outlineWidth"],overflow:["overflowX","overflowY"],padding:["paddingBottom","paddingLeft","paddingRight","paddingTop"],placeContent:["alignContent","justifyContent"],placeItems:["alignItems","justifyItems"],placeSelf:["alignSelf","justifySelf"],textDecoration:["textDecorationColor","textDecorationLine","textDecorationStyle"],textEmphasis:["textEmphasisColor","textEmphasisStyle"],transition:["transitionDelay","transitionDuration","transitionProperty","transitionTimingFunction"],wordWrap:["overflowWrap"]},Qs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};function Eu(l,u){return l+u.charAt(0).toUpperCase()+u.substring(1)}var Oa=["Webkit","ms","Moz","O"];Object.keys(Qs).forEach(function(l){Oa.forEach(function(u){Qs[Eu(u,l)]=Qs[l]})});function an(l,u,w){var I=u==null||typeof u=="boolean"||u==="";return I?"":!w&&typeof u=="number"&&u!==0&&!(Qs.hasOwnProperty(l)&&Qs[l])?u+"px":(Do(u,l),(""+u).trim())}var pi=/([A-Z])/g,ud=/^ms-/;function Hi(l){return l.replace(pi,"-$1").toLowerCase().replace(ud,"-ms-")}var hd=function(){};{var Nm=/^(?:webkit|moz|o)[A-Z]/,Ni=/^-ms-/,gp=/-(.)/g,_p=/;\s*$/,dd={},zl={},yp=!1,So=!1,ls=function(l){return l.replace(gp,function(u,w){return w.toUpperCase()})},fd=function(l){dd.hasOwnProperty(l)&&dd[l]||(dd[l]=!0,C("Unsupported style property %s. Did you mean %s?",l,ls(l.replace(Ni,"ms-"))))},Yd=function(l){dd.hasOwnProperty(l)&&dd[l]||(dd[l]=!0,C("Unsupported vendor-prefixed style property %s. Did you mean %s?",l,l.charAt(0).toUpperCase()+l.slice(1)))},Cu=function(l,u){zl.hasOwnProperty(u)&&zl[u]||(zl[u]=!0,C(`Style property values shouldn't contain a semicolon. Try "%s: %s" instead.`,l,u.replace(_p,"")))},ko=function(l,u){yp||(yp=!0,C("`NaN` is an invalid value for the `%s` css style property.",l))},Ob=function(l,u){So||(So=!0,C("`Infinity` is an invalid value for the `%s` css style property.",l))};hd=function(l,u){l.indexOf("-")>-1?fd(l):Nm.test(l)?Yd(l):_p.test(u)&&Cu(l,u),typeof u=="number"&&(isNaN(u)?ko(l,u):isFinite(u)||Ob(l,u))}}var kb=hd;function vp(l){{var u="",w="";for(var I in l)if(l.hasOwnProperty(I)){var O=l[I];if(O!=null){var G=I.indexOf("--")===0;u+=w+(G?I:Hi(I))+":",u+=an(I,O,G),w=";"}}return u||null}}function Au(l,u){var w=l.style;for(var I in u)if(u.hasOwnProperty(I)){var O=I.indexOf("--")===0;O||kb(I,u[I]);var G=an(I,u[I],O);I==="float"&&(I="cssFloat"),O?w.setProperty(I,G):w[I]=G}}function Qv(l){return l==null||typeof l=="boolean"||l===""}function xl(l){var u={};for(var w in l)for(var I=_o[w]||[w],O=0;O<I.length;O++)u[I[O]]=w;return u}function ex(l,u){{if(!u)return;var w=xl(l),I=xl(u),O={};for(var G in w){var Y=w[G],oe=I[G];if(oe&&Y!==oe){var fe=Y+","+oe;if(O[fe])continue;O[fe]=!0,C("%s a style property during rerender (%s) when a conflicting property is set (%s) can lead to styling bugs. To avoid this, don't mix shorthand and non-shorthand properties for the same value; instead, replace the shorthand with separate values.",Qv(l[Y])?"Removing":"Updating",Y,oe)}}}}var Bm={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},xp=Yt({menuitem:!0},Bm),fh="__html";function B_(l,u){if(u){if(xp[l]&&(u.children!=null||u.dangerouslySetInnerHTML!=null))throw new Error(l+" is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.");if(u.dangerouslySetInnerHTML!=null){if(u.children!=null)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");if(typeof u.dangerouslySetInnerHTML!="object"||!(fh in u.dangerouslySetInnerHTML))throw new Error("`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://reactjs.org/link/dangerously-set-inner-html for more information.")}if(!u.suppressContentEditableWarning&&u.contentEditable&&u.children!=null&&C("A component is `contentEditable` and contains `children` managed by React. It is now your responsibility to guarantee that none of those nodes are unexpectedly modified or duplicated. This is probably not intentional."),u.style!=null&&typeof u.style!="object")throw new Error("The `style` prop expects a mapping from style properties to values, not a string. For example, style={{marginRight: spacing + 'em'}} when using JSX.")}}function ph(l,u){if(l.indexOf("-")===-1)return typeof u.is=="string";switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Um={accept:"accept",acceptcharset:"acceptCharset","accept-charset":"acceptCharset",accesskey:"accessKey",action:"action",allowfullscreen:"allowFullScreen",alt:"alt",as:"as",async:"async",autocapitalize:"autoCapitalize",autocomplete:"autoComplete",autocorrect:"autoCorrect",autofocus:"autoFocus",autoplay:"autoPlay",autosave:"autoSave",capture:"capture",cellpadding:"cellPadding",cellspacing:"cellSpacing",challenge:"challenge",charset:"charSet",checked:"checked",children:"children",cite:"cite",class:"className",classid:"classID",classname:"className",cols:"cols",colspan:"colSpan",content:"content",contenteditable:"contentEditable",contextmenu:"contextMenu",controls:"controls",controlslist:"controlsList",coords:"coords",crossorigin:"crossOrigin",dangerouslysetinnerhtml:"dangerouslySetInnerHTML",data:"data",datetime:"dateTime",default:"default",defaultchecked:"defaultChecked",defaultvalue:"defaultValue",defer:"defer",dir:"dir",disabled:"disabled",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback",download:"download",draggable:"draggable",enctype:"encType",enterkeyhint:"enterKeyHint",for:"htmlFor",form:"form",formmethod:"formMethod",formaction:"formAction",formenctype:"formEncType",formnovalidate:"formNoValidate",formtarget:"formTarget",frameborder:"frameBorder",headers:"headers",height:"height",hidden:"hidden",high:"high",href:"href",hreflang:"hrefLang",htmlfor:"htmlFor",httpequiv:"httpEquiv","http-equiv":"httpEquiv",icon:"icon",id:"id",imagesizes:"imageSizes",imagesrcset:"imageSrcSet",innerhtml:"innerHTML",inputmode:"inputMode",integrity:"integrity",is:"is",itemid:"itemID",itemprop:"itemProp",itemref:"itemRef",itemscope:"itemScope",itemtype:"itemType",keyparams:"keyParams",keytype:"keyType",kind:"kind",label:"label",lang:"lang",list:"list",loop:"loop",low:"low",manifest:"manifest",marginwidth:"marginWidth",marginheight:"marginHeight",max:"max",maxlength:"maxLength",media:"media",mediagroup:"mediaGroup",method:"method",min:"min",minlength:"minLength",multiple:"multiple",muted:"muted",name:"name",nomodule:"noModule",nonce:"nonce",novalidate:"noValidate",open:"open",optimum:"optimum",pattern:"pattern",placeholder:"placeholder",playsinline:"playsInline",poster:"poster",preload:"preload",profile:"profile",radiogroup:"radioGroup",readonly:"readOnly",referrerpolicy:"referrerPolicy",rel:"rel",required:"required",reversed:"reversed",role:"role",rows:"rows",rowspan:"rowSpan",sandbox:"sandbox",scope:"scope",scoped:"scoped",scrolling:"scrolling",seamless:"seamless",selected:"selected",shape:"shape",size:"size",sizes:"sizes",span:"span",spellcheck:"spellCheck",src:"src",srcdoc:"srcDoc",srclang:"srcLang",srcset:"srcSet",start:"start",step:"step",style:"style",summary:"summary",tabindex:"tabIndex",target:"target",title:"title",type:"type",usemap:"useMap",value:"value",width:"width",wmode:"wmode",wrap:"wrap",about:"about",accentheight:"accentHeight","accent-height":"accentHeight",accumulate:"accumulate",additive:"additive",alignmentbaseline:"alignmentBaseline","alignment-baseline":"alignmentBaseline",allowreorder:"allowReorder",alphabetic:"alphabetic",amplitude:"amplitude",arabicform:"arabicForm","arabic-form":"arabicForm",ascent:"ascent",attributename:"attributeName",attributetype:"attributeType",autoreverse:"autoReverse",azimuth:"azimuth",basefrequency:"baseFrequency",baselineshift:"baselineShift","baseline-shift":"baselineShift",baseprofile:"baseProfile",bbox:"bbox",begin:"begin",bias:"bias",by:"by",calcmode:"calcMode",capheight:"capHeight","cap-height":"capHeight",clip:"clip",clippath:"clipPath","clip-path":"clipPath",clippathunits:"clipPathUnits",cliprule:"clipRule","clip-rule":"clipRule",color:"color",colorinterpolation:"colorInterpolation","color-interpolation":"colorInterpolation",colorinterpolationfilters:"colorInterpolationFilters","color-interpolation-filters":"colorInterpolationFilters",colorprofile:"colorProfile","color-profile":"colorProfile",colorrendering:"colorRendering","color-rendering":"colorRendering",contentscripttype:"contentScriptType",contentstyletype:"contentStyleType",cursor:"cursor",cx:"cx",cy:"cy",d:"d",datatype:"datatype",decelerate:"decelerate",descent:"descent",diffuseconstant:"diffuseConstant",direction:"direction",display:"display",divisor:"divisor",dominantbaseline:"dominantBaseline","dominant-baseline":"dominantBaseline",dur:"dur",dx:"dx",dy:"dy",edgemode:"edgeMode",elevation:"elevation",enablebackground:"enableBackground","enable-background":"enableBackground",end:"end",exponent:"exponent",externalresourcesrequired:"externalResourcesRequired",fill:"fill",fillopacity:"fillOpacity","fill-opacity":"fillOpacity",fillrule:"fillRule","fill-rule":"fillRule",filter:"filter",filterres:"filterRes",filterunits:"filterUnits",floodopacity:"floodOpacity","flood-opacity":"floodOpacity",floodcolor:"floodColor","flood-color":"floodColor",focusable:"focusable",fontfamily:"fontFamily","font-family":"fontFamily",fontsize:"fontSize","font-size":"fontSize",fontsizeadjust:"fontSizeAdjust","font-size-adjust":"fontSizeAdjust",fontstretch:"fontStretch","font-stretch":"fontStretch",fontstyle:"fontStyle","font-style":"fontStyle",fontvariant:"fontVariant","font-variant":"fontVariant",fontweight:"fontWeight","font-weight":"fontWeight",format:"format",from:"from",fx:"fx",fy:"fy",g1:"g1",g2:"g2",glyphname:"glyphName","glyph-name":"glyphName",glyphorientationhorizontal:"glyphOrientationHorizontal","glyph-orientation-horizontal":"glyphOrientationHorizontal",glyphorientationvertical:"glyphOrientationVertical","glyph-orientation-vertical":"glyphOrientationVertical",glyphref:"glyphRef",gradienttransform:"gradientTransform",gradientunits:"gradientUnits",hanging:"hanging",horizadvx:"horizAdvX","horiz-adv-x":"horizAdvX",horizoriginx:"horizOriginX","horiz-origin-x":"horizOriginX",ideographic:"ideographic",imagerendering:"imageRendering","image-rendering":"imageRendering",in2:"in2",in:"in",inlist:"inlist",intercept:"intercept",k1:"k1",k2:"k2",k3:"k3",k4:"k4",k:"k",kernelmatrix:"kernelMatrix",kernelunitlength:"kernelUnitLength",kerning:"kerning",keypoints:"keyPoints",keysplines:"keySplines",keytimes:"keyTimes",lengthadjust:"lengthAdjust",letterspacing:"letterSpacing","letter-spacing":"letterSpacing",lightingcolor:"lightingColor","lighting-color":"lightingColor",limitingconeangle:"limitingConeAngle",local:"local",markerend:"markerEnd","marker-end":"markerEnd",markerheight:"markerHeight",markermid:"markerMid","marker-mid":"markerMid",markerstart:"markerStart","marker-start":"markerStart",markerunits:"markerUnits",markerwidth:"markerWidth",mask:"mask",maskcontentunits:"maskContentUnits",maskunits:"maskUnits",mathematical:"mathematical",mode:"mode",numoctaves:"numOctaves",offset:"offset",opacity:"opacity",operator:"operator",order:"order",orient:"orient",orientation:"orientation",origin:"origin",overflow:"overflow",overlineposition:"overlinePosition","overline-position":"overlinePosition",overlinethickness:"overlineThickness","overline-thickness":"overlineThickness",paintorder:"paintOrder","paint-order":"paintOrder",panose1:"panose1","panose-1":"panose1",pathlength:"pathLength",patterncontentunits:"patternContentUnits",patterntransform:"patternTransform",patternunits:"patternUnits",pointerevents:"pointerEvents","pointer-events":"pointerEvents",points:"points",pointsatx:"pointsAtX",pointsaty:"pointsAtY",pointsatz:"pointsAtZ",prefix:"prefix",preservealpha:"preserveAlpha",preserveaspectratio:"preserveAspectRatio",primitiveunits:"primitiveUnits",property:"property",r:"r",radius:"radius",refx:"refX",refy:"refY",renderingintent:"renderingIntent","rendering-intent":"renderingIntent",repeatcount:"repeatCount",repeatdur:"repeatDur",requiredextensions:"requiredExtensions",requiredfeatures:"requiredFeatures",resource:"resource",restart:"restart",result:"result",results:"results",rotate:"rotate",rx:"rx",ry:"ry",scale:"scale",security:"security",seed:"seed",shaperendering:"shapeRendering","shape-rendering":"shapeRendering",slope:"slope",spacing:"spacing",specularconstant:"specularConstant",specularexponent:"specularExponent",speed:"speed",spreadmethod:"spreadMethod",startoffset:"startOffset",stddeviation:"stdDeviation",stemh:"stemh",stemv:"stemv",stitchtiles:"stitchTiles",stopcolor:"stopColor","stop-color":"stopColor",stopopacity:"stopOpacity","stop-opacity":"stopOpacity",strikethroughposition:"strikethroughPosition","strikethrough-position":"strikethroughPosition",strikethroughthickness:"strikethroughThickness","strikethrough-thickness":"strikethroughThickness",string:"string",stroke:"stroke",strokedasharray:"strokeDasharray","stroke-dasharray":"strokeDasharray",strokedashoffset:"strokeDashoffset","stroke-dashoffset":"strokeDashoffset",strokelinecap:"strokeLinecap","stroke-linecap":"strokeLinecap",strokelinejoin:"strokeLinejoin","stroke-linejoin":"strokeLinejoin",strokemiterlimit:"strokeMiterlimit","stroke-miterlimit":"strokeMiterlimit",strokewidth:"strokeWidth","stroke-width":"strokeWidth",strokeopacity:"strokeOpacity","stroke-opacity":"strokeOpacity",suppresscontenteditablewarning:"suppressContentEditableWarning",suppresshydrationwarning:"suppressHydrationWarning",surfacescale:"surfaceScale",systemlanguage:"systemLanguage",tablevalues:"tableValues",targetx:"targetX",targety:"targetY",textanchor:"textAnchor","text-anchor":"textAnchor",textdecoration:"textDecoration","text-decoration":"textDecoration",textlength:"textLength",textrendering:"textRendering","text-rendering":"textRendering",to:"to",transform:"transform",typeof:"typeof",u1:"u1",u2:"u2",underlineposition:"underlinePosition","underline-position":"underlinePosition",underlinethickness:"underlineThickness","underline-thickness":"underlineThickness",unicode:"unicode",unicodebidi:"unicodeBidi","unicode-bidi":"unicodeBidi",unicoderange:"unicodeRange","unicode-range":"unicodeRange",unitsperem:"unitsPerEm","units-per-em":"unitsPerEm",unselectable:"unselectable",valphabetic:"vAlphabetic","v-alphabetic":"vAlphabetic",values:"values",vectoreffect:"vectorEffect","vector-effect":"vectorEffect",version:"version",vertadvy:"vertAdvY","vert-adv-y":"vertAdvY",vertoriginx:"vertOriginX","vert-origin-x":"vertOriginX",vertoriginy:"vertOriginY","vert-origin-y":"vertOriginY",vhanging:"vHanging","v-hanging":"vHanging",videographic:"vIdeographic","v-ideographic":"vIdeographic",viewbox:"viewBox",viewtarget:"viewTarget",visibility:"visibility",vmathematical:"vMathematical","v-mathematical":"vMathematical",vocab:"vocab",widths:"widths",wordspacing:"wordSpacing","word-spacing":"wordSpacing",writingmode:"writingMode","writing-mode":"writingMode",x1:"x1",x2:"x2",x:"x",xchannelselector:"xChannelSelector",xheight:"xHeight","x-height":"xHeight",xlinkactuate:"xlinkActuate","xlink:actuate":"xlinkActuate",xlinkarcrole:"xlinkArcrole","xlink:arcrole":"xlinkArcrole",xlinkhref:"xlinkHref","xlink:href":"xlinkHref",xlinkrole:"xlinkRole","xlink:role":"xlinkRole",xlinkshow:"xlinkShow","xlink:show":"xlinkShow",xlinktitle:"xlinkTitle","xlink:title":"xlinkTitle",xlinktype:"xlinkType","xlink:type":"xlinkType",xmlbase:"xmlBase","xml:base":"xmlBase",xmllang:"xmlLang","xml:lang":"xmlLang",xmlns:"xmlns","xml:space":"xmlSpace",xmlnsxlink:"xmlnsXlink","xmlns:xlink":"xmlnsXlink",xmlspace:"xmlSpace",y1:"y1",y2:"y2",y:"y",ychannelselector:"yChannelSelector",z:"z",zoomandpan:"zoomAndPan"},Ru={"aria-current":0,"aria-description":0,"aria-details":0,"aria-disabled":0,"aria-hidden":0,"aria-invalid":0,"aria-keyshortcuts":0,"aria-label":0,"aria-roledescription":0,"aria-autocomplete":0,"aria-checked":0,"aria-expanded":0,"aria-haspopup":0,"aria-level":0,"aria-modal":0,"aria-multiline":0,"aria-multiselectable":0,"aria-orientation":0,"aria-placeholder":0,"aria-pressed":0,"aria-readonly":0,"aria-required":0,"aria-selected":0,"aria-sort":0,"aria-valuemax":0,"aria-valuemin":0,"aria-valuenow":0,"aria-valuetext":0,"aria-atomic":0,"aria-busy":0,"aria-live":0,"aria-relevant":0,"aria-dropeffect":0,"aria-grabbed":0,"aria-activedescendant":0,"aria-colcount":0,"aria-colindex":0,"aria-colspan":0,"aria-controls":0,"aria-describedby":0,"aria-errormessage":0,"aria-flowto":0,"aria-labelledby":0,"aria-owns":0,"aria-posinset":0,"aria-rowcount":0,"aria-rowindex":0,"aria-rowspan":0,"aria-setsize":0},Kd={},U_=new RegExp("^(aria)-["+Pi+"]*$"),Vm=new RegExp("^(aria)[A-Z]["+Pi+"]*$");function V_(l,u){{if(za.call(Kd,u)&&Kd[u])return!0;if(Vm.test(u)){var w="aria-"+u.slice(4).toLowerCase(),I=Ru.hasOwnProperty(w)?w:null;if(I==null)return C("Invalid ARIA attribute `%s`. ARIA attributes follow the pattern aria-* and must be lowercase.",u),Kd[u]=!0,!0;if(u!==I)return C("Invalid ARIA attribute `%s`. Did you mean `%s`?",u,I),Kd[u]=!0,!0}if(U_.test(u)){var O=u.toLowerCase(),G=Ru.hasOwnProperty(O)?O:null;if(G==null)return Kd[u]=!0,!1;if(u!==G)return C("Unknown ARIA attribute `%s`. Did you mean `%s`?",u,G),Kd[u]=!0,!0}}return!0}function j_(l,u){{var w=[];for(var I in u){var O=V_(l,I);O||w.push(I)}var G=w.map(function(Y){return"`"+Y+"`"}).join(", ");w.length===1?C("Invalid aria prop %s on <%s> tag. For details, see https://reactjs.org/link/invalid-aria-props",G,l):w.length>1&&C("Invalid aria props %s on <%s> tag. For details, see https://reactjs.org/link/invalid-aria-props",G,l)}}function Fl(l,u){ph(l,u)||j_(l,u)}var mh=!1;function bp(l,u){{if(l!=="input"&&l!=="textarea"&&l!=="select")return;u!=null&&u.value===null&&!mh&&(mh=!0,l==="select"&&u.multiple?C("`value` prop on `%s` should not be null. Consider using an empty array when `multiple` is set to `true` to clear the component or `undefined` for uncontrolled components.",l):C("`value` prop on `%s` should not be null. Consider using an empty string to clear the component or `undefined` for uncontrolled components.",l))}}var jm=function(){};{var cs={},pd=/^on./,Jd=/^on[^A-Z]/,G_=new RegExp("^(aria)-["+Pi+"]*$"),Gm=new RegExp("^(aria)[A-Z]["+Pi+"]*$");jm=function(l,u,w,I){if(za.call(cs,u)&&cs[u])return!0;var O=u.toLowerCase();if(O==="onfocusin"||O==="onfocusout")return C("React uses onFocus and onBlur instead of onFocusIn and onFocusOut. All React events are normalized to bubble, so onFocusIn and onFocusOut are not needed/supported by React."),cs[u]=!0,!0;if(I!=null){var G=I.registrationNameDependencies,Y=I.possibleRegistrationNames;if(G.hasOwnProperty(u))return!0;var oe=Y.hasOwnProperty(O)?Y[O]:null;if(oe!=null)return C("Invalid event handler property `%s`. Did you mean `%s`?",u,oe),cs[u]=!0,!0;if(pd.test(u))return C("Unknown event handler property `%s`. It will be ignored.",u),cs[u]=!0,!0}else if(pd.test(u))return Jd.test(u)&&C("Invalid event handler property `%s`. React events use the camelCase naming convention, for example `onClick`.",u),cs[u]=!0,!0;if(G_.test(u)||Gm.test(u))return!0;if(O==="innerhtml")return C("Directly setting property `innerHTML` is not permitted. For more information, lookup documentation on `dangerouslySetInnerHTML`."),cs[u]=!0,!0;if(O==="aria")return C("The `aria` attribute is reserved for future use in React. Pass individual `aria-` attributes instead."),cs[u]=!0,!0;if(O==="is"&&w!==null&&w!==void 0&&typeof w!="string")return C("Received a `%s` for a string attribute `is`. If this is expected, cast the value to a string.",typeof w),cs[u]=!0,!0;if(typeof w=="number"&&isNaN(w))return C("Received NaN for the `%s` attribute. If this is expected, cast the value to a string.",u),cs[u]=!0,!0;var fe=Vr(u),Oe=fe!==null&&fe.type===Ra;if(Um.hasOwnProperty(O)){var Ne=Um[O];if(Ne!==u)return C("Invalid DOM property `%s`. Did you mean `%s`?",u,Ne),cs[u]=!0,!0}else if(!Oe&&u!==O)return C("React does not recognize the `%s` prop on a DOM element. If you intentionally want it to appear in the DOM as a custom attribute, spell it as lowercase `%s` instead. If you accidentally passed it from a parent component, remove it from the DOM element.",u,O),cs[u]=!0,!0;return typeof w=="boolean"&&_a(u,w,fe,!1)?(w?C('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.',w,u,u,w,u):C('Received `%s` for a non-boolean attribute `%s`.\n\nIf you want to write it to the DOM, pass a string instead: %s="%s" or %s={value.toString()}.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.',w,u,u,w,u,u,u),cs[u]=!0,!0):Oe?!0:_a(u,w,fe,!1)?(cs[u]=!0,!1):((w==="false"||w==="true")&&fe!==null&&fe.type===wa&&(C("Received the string `%s` for the boolean attribute `%s`. %s Did you mean %s={%s}?",w,u,w==="false"?"The browser will interpret it as a truthy value.":'Although this works, it will not work as expected if you pass the string "false".',u,w),cs[u]=!0),!0)}}var bl=function(l,u,w){{var I=[];for(var O in u){var G=jm(l,O,u[O],w);G||I.push(O)}var Y=I.map(function(oe){return"`"+oe+"`"}).join(", ");I.length===1?C("Invalid value for prop %s on <%s> tag. Either remove it from the element, or pass a string or number value to keep it in the DOM. For details, see https://reactjs.org/link/attribute-behavior ",Y,l):I.length>1&&C("Invalid values for props %s on <%s> tag. Either remove them from the element, or pass a string or number value to keep them in the DOM. For details, see https://reactjs.org/link/attribute-behavior ",Y,l)}};function Hm(l,u,w){ph(l,u)||bl(l,u,w)}var Lt=1,wp=2,Lc=4,Qd=Lt|wp|Lc,Iu=null;function Tp(l){Iu!==null&&C("Expected currently replaying event to be null. This error is likely caused by a bug in React. Please file an issue."),Iu=l}function zc(){Iu===null&&C("Expected currently replaying event to not be null. This error is likely caused by a bug in React. Please file an issue."),Iu=null}function $m(l){return l===Iu}function el(l){var u=l.target||l.srcElement||window;return u.correspondingUseElement&&(u=u.correspondingUseElement),u.nodeType===Sa?u.parentNode:u}var vn=null,cc=null,ef=null;function tx(l){var u=Jc(l);if(u){if(typeof vn!="function")throw new Error("setRestoreImplementation() needs to be called to handle a target for controlled events. This error is likely caused by a bug in React. Please file an issue.");var w=u.stateNode;if(w){var I=$x(w);vn(u.stateNode,u.type,I)}}}function Wm(l){vn=l}function ix(l){cc?ef?ef.push(l):ef=[l]:cc=l}function Jr(){return cc!==null||ef!==null}function H_(){if(cc){var l=cc,u=ef;if(cc=null,ef=null,tx(l),u)for(var w=0;w<u.length;w++)tx(u[w])}}var qm=function(l,u){return l(u)},nx=function(){},$_=!1;function Lb(){var l=Jr();l&&(nx(),H_())}function rx(l,u,w){if($_)return l(u,w);$_=!0;try{return qm(l,u,w)}finally{$_=!1,Lb()}}function ax(l,u,w){qm=l,nx=w}function zb(l){return l==="button"||l==="input"||l==="select"||l==="textarea"}function Zm(l,u,w){switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":return!!(w.disabled&&zb(u));default:return!1}}function Sp(l,u){var w=l.stateNode;if(w===null)return null;var I=$x(w);if(I===null)return null;var O=I[u];if(Zm(u,l.type,I))return null;if(O&&typeof O!="function")throw new Error("Expected `"+u+"` listener to be a function, instead got a value of `"+typeof O+"` type.");return O}var Xm=!1;if(gr)try{var md={};Object.defineProperty(md,"passive",{get:function(){Xm=!0}}),window.addEventListener("test",md,md),window.removeEventListener("test",md,md)}catch{Xm=!1}function Ep(l,u,w,I,O,G,Y,oe,fe){var Oe=Array.prototype.slice.call(arguments,3);try{u.apply(w,Oe)}catch(Ne){this.onError(Ne)}}var Ym=Ep;if(typeof window<"u"&&typeof window.dispatchEvent=="function"&&typeof document<"u"&&typeof document.createEvent=="function"){var Du=document.createElement("react");Ym=function(u,w,I,O,G,Y,oe,fe,Oe){if(typeof document>"u"||document===null)throw new Error("The `document` global was defined when React was initialized, but is not defined anymore. This can happen in a test environment if a component schedules an update from an asynchronous callback, but the test has already finished running. To solve this, you can either unmount the component at the end of your test (and ensure that any asynchronous operations get canceled in `componentWillUnmount`), or you can change the test itself to be asynchronous.");var Ne=document.createEvent("Event"),ft=!1,dt=!0,Vt=window.event,jt=Object.getOwnPropertyDescriptor(window,"event");function ii(){Du.removeEventListener(ni,Fn,!1),typeof window.event<"u"&&window.hasOwnProperty("event")&&(window.event=Vt)}var Ji=Array.prototype.slice.call(arguments,3);function Fn(){ft=!0,ii(),w.apply(I,Ji),dt=!1}var Tn,ra=!1,Wr=!1;function Rt(It){if(Tn=It.error,ra=!0,Tn===null&&It.colno===0&&It.lineno===0&&(Wr=!0),It.defaultPrevented&&Tn!=null&&typeof Tn=="object")try{Tn._suppressLogging=!0}catch{}}var ni="react-"+(u||"invokeguardedcallback");if(window.addEventListener("error",Rt),Du.addEventListener(ni,Fn,!1),Ne.initEvent(ni,!1,!1),Du.dispatchEvent(Ne),jt&&Object.defineProperty(window,"event",jt),ft&&dt&&(ra?Wr&&(Tn=new Error("A cross-origin error was thrown. React doesn't have access to the actual error object in development. See https://reactjs.org/link/crossorigin-error for more information.")):Tn=new Error(`An error was thrown inside one of your components, but React doesn't know what it was. This is likely due to browser flakiness. React does its best to preserve the "Pause on exceptions" behavior of the DevTools, which requires some DEV-mode only tricks. It's possible that these don't work in your browser. Try triggering the error in production mode, or switching to a modern browser. If you suspect that this is actually an issue with React, please file an issue.`),this.onError(Tn)),window.removeEventListener("error",Rt),!ft)return ii(),Ep.apply(this,arguments)}}var tf=Ym,Fc=!1,Mu=null,Cp=!1,Ap=null,ox={onError:function(l){Fc=!0,Mu=l}};function gh(l,u,w,I,O,G,Y,oe,fe){Fc=!1,Mu=null,tf.apply(ox,arguments)}function Km(l,u,w,I,O,G,Y,oe,fe){if(gh.apply(this,arguments),Fc){var Oe=nf();Cp||(Cp=!0,Ap=Oe)}}function Jm(){if(Cp){var l=Ap;throw Cp=!1,Ap=null,l}}function W_(){return Fc}function nf(){if(Fc){var l=Mu;return Fc=!1,Mu=null,l}else throw new Error("clearCaughtError was called but no error was captured. This error is likely caused by a bug in React. Please file an issue.")}function Nc(l){return l._reactInternals}function sx(l){return l._reactInternals!==void 0}function lx(l,u){l._reactInternals=u}var Mn=0,uc=1,so=2,Qr=4,_h=16,Rp=32,Qm=64,Hr=128,Nl=256,Bc=512,Bl=1024,Uc=2048,Vc=4096,hc=8192,Pu=16384,eg=32767,Ts=32768,us=65536,gd=131072,rf=1048576,Ip=2097152,Ou=4194304,Dp=8388608,Ul=16777216,af=33554432,yh=Qr|Bl|0,of=so|Qr|_h|Rp|Bc|Vc|hc,vh=Qr|Qm|Bc|hc,_d=Uc|_h,jc=Ou|Dp|Ip,sf=h.ReactCurrentOwner;function xh(l){var u=l,w=l;if(l.alternate)for(;u.return;)u=u.return;else{var I=u;do u=I,(u.flags&(so|Vc))!==Mn&&(w=u.return),I=u.return;while(I)}return u.tag===K?w:null}function q_(l){if(l.tag===it){var u=l.memoizedState;if(u===null){var w=l.alternate;w!==null&&(u=w.memoizedState)}if(u!==null)return u.dehydrated}return null}function cx(l){return l.tag===K?l.stateNode.containerInfo:null}function Fb(l){return xh(l)===l}function Nb(l){{var u=sf.current;if(u!==null&&u.tag===N){var w=u,I=w.stateNode;I._warnedAboutRefsInRender||C("%s is accessing isMounted inside its render() function. render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",pn(w)||"A component"),I._warnedAboutRefsInRender=!0}}var O=Nc(l);return O?xh(O)===O:!1}function Mp(l){if(xh(l)!==l)throw new Error("Unable to find node on an unmounted component.")}function tg(l){var u=l.alternate;if(!u){var w=xh(l);if(w===null)throw new Error("Unable to find node on an unmounted component.");return w!==l?null:l}for(var I=l,O=u;;){var G=I.return;if(G===null)break;var Y=G.alternate;if(Y===null){var oe=G.return;if(oe!==null){I=O=oe;continue}break}if(G.child===Y.child){for(var fe=G.child;fe;){if(fe===I)return Mp(G),l;if(fe===O)return Mp(G),u;fe=fe.sibling}throw new Error("Unable to find node on an unmounted component.")}if(I.return!==O.return)I=G,O=Y;else{for(var Oe=!1,Ne=G.child;Ne;){if(Ne===I){Oe=!0,I=G,O=Y;break}if(Ne===O){Oe=!0,O=G,I=Y;break}Ne=Ne.sibling}if(!Oe){for(Ne=Y.child;Ne;){if(Ne===I){Oe=!0,I=Y,O=G;break}if(Ne===O){Oe=!0,O=Y,I=G;break}Ne=Ne.sibling}if(!Oe)throw new Error("Child was not found in either parent set. This indicates a bug in React related to the return pointer. Please file an issue.")}}if(I.alternate!==O)throw new Error("Return fibers should always be each others' alternates. This error is likely caused by a bug in React. Please file an issue.")}if(I.tag!==K)throw new Error("Unable to find node on an unmounted component.");return I.stateNode.current===I?l:u}function ig(l){var u=tg(l);return u!==null?Z_(u):null}function Z_(l){if(l.tag===ue||l.tag===pe)return l;for(var u=l.child;u!==null;){var w=Z_(u);if(w!==null)return w;u=u.sibling}return null}function lf(l){var u=tg(l);return u!==null?ng(u):null}function ng(l){if(l.tag===ue||l.tag===pe)return l;for(var u=l.child;u!==null;){if(u.tag!==ne){var w=ng(u);if(w!==null)return w}u=u.sibling}return null}var X_=s.unstable_scheduleCallback,ux=s.unstable_cancelCallback,rg=s.unstable_shouldYield,ku=s.unstable_requestPaint,yo=s.unstable_now,ag=s.unstable_getCurrentPriorityLevel,Gc=s.unstable_ImmediatePriority,Hc=s.unstable_UserBlockingPriority,Lu=s.unstable_NormalPriority,og=s.unstable_LowPriority,Pp=s.unstable_IdlePriority,Y_=s.unstable_yieldValue,sg=s.unstable_setDisableYieldValue,zu=null,Qo=null,qi=null,Ls=!1,dc=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u";function bh(l){if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")return!1;var u=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(u.isDisabled)return!0;if(!u.supportsFiber)return C("The installed version of React DevTools is too old and will not work with the current version of React. Please update React DevTools. https://reactjs.org/link/react-devtools"),!0;try{xn&&(l=Yt({},l,{getLaneLabelMap:wh,injectProfilingHooks:Op})),zu=u.inject(l),Qo=u}catch(w){C("React instrumentation encountered an error: %s.",w)}return!!u.checkDCE}function hx(l,u){if(Qo&&typeof Qo.onScheduleFiberRoot=="function")try{Qo.onScheduleFiberRoot(zu,l,u)}catch(w){Ls||(Ls=!0,C("React instrumentation encountered an error: %s",w))}}function Bb(l,u){if(Qo&&typeof Qo.onCommitFiberRoot=="function")try{var w=(l.current.flags&Hr)===Hr;if(mr){var I;switch(u){case Es:I=Gc;break;case Tl:I=Hc;break;case mc:I=Lu;break;case Hp:I=Pp;break;default:I=Lu;break}Qo.onCommitFiberRoot(zu,l,I,w)}}catch(O){Ls||(Ls=!0,C("React instrumentation encountered an error: %s",O))}}function lg(l){if(Qo&&typeof Qo.onPostCommitFiberRoot=="function")try{Qo.onPostCommitFiberRoot(zu,l)}catch(u){Ls||(Ls=!0,C("React instrumentation encountered an error: %s",u))}}function cg(l){if(Qo&&typeof Qo.onCommitFiberUnmount=="function")try{Qo.onCommitFiberUnmount(zu,l)}catch(u){Ls||(Ls=!0,C("React instrumentation encountered an error: %s",u))}}function Ua(l){if(typeof Y_=="function"&&(sg(l),v(l)),Qo&&typeof Qo.setStrictMode=="function")try{Qo.setStrictMode(zu,l)}catch(u){Ls||(Ls=!0,C("React instrumentation encountered an error: %s",u))}}function Op(l){qi=l}function wh(){{for(var l=new Map,u=1,w=0;w<Er;w++){var I=Bp(u);l.set(u,I),u*=2}return l}}function K_(l){qi!==null&&typeof qi.markCommitStarted=="function"&&qi.markCommitStarted(l)}function kp(){qi!==null&&typeof qi.markCommitStopped=="function"&&qi.markCommitStopped()}function Th(l){qi!==null&&typeof qi.markComponentRenderStarted=="function"&&qi.markComponentRenderStarted(l)}function $c(){qi!==null&&typeof qi.markComponentRenderStopped=="function"&&qi.markComponentRenderStopped()}function ug(l){qi!==null&&typeof qi.markComponentPassiveEffectMountStarted=="function"&&qi.markComponentPassiveEffectMountStarted(l)}function dx(){qi!==null&&typeof qi.markComponentPassiveEffectMountStopped=="function"&&qi.markComponentPassiveEffectMountStopped()}function yd(l){qi!==null&&typeof qi.markComponentPassiveEffectUnmountStarted=="function"&&qi.markComponentPassiveEffectUnmountStarted(l)}function cf(){qi!==null&&typeof qi.markComponentPassiveEffectUnmountStopped=="function"&&qi.markComponentPassiveEffectUnmountStopped()}function ai(l){qi!==null&&typeof qi.markComponentLayoutEffectMountStarted=="function"&&qi.markComponentLayoutEffectMountStarted(l)}function J_(){qi!==null&&typeof qi.markComponentLayoutEffectMountStopped=="function"&&qi.markComponentLayoutEffectMountStopped()}function Wc(l){qi!==null&&typeof qi.markComponentLayoutEffectUnmountStarted=="function"&&qi.markComponentLayoutEffectUnmountStarted(l)}function Fu(){qi!==null&&typeof qi.markComponentLayoutEffectUnmountStopped=="function"&&qi.markComponentLayoutEffectUnmountStopped()}function Sh(l,u,w){qi!==null&&typeof qi.markComponentErrored=="function"&&qi.markComponentErrored(l,u,w)}function Ri(l,u,w){qi!==null&&typeof qi.markComponentSuspended=="function"&&qi.markComponentSuspended(l,u,w)}function Q_(l){qi!==null&&typeof qi.markLayoutEffectsStarted=="function"&&qi.markLayoutEffectsStarted(l)}function fx(){qi!==null&&typeof qi.markLayoutEffectsStopped=="function"&&qi.markLayoutEffectsStopped()}function hg(l){qi!==null&&typeof qi.markPassiveEffectsStarted=="function"&&qi.markPassiveEffectsStarted(l)}function dg(){qi!==null&&typeof qi.markPassiveEffectsStopped=="function"&&qi.markPassiveEffectsStopped()}function fg(l){qi!==null&&typeof qi.markRenderStarted=="function"&&qi.markRenderStarted(l)}function ey(){qi!==null&&typeof qi.markRenderYielded=="function"&&qi.markRenderYielded()}function ty(){qi!==null&&typeof qi.markRenderStopped=="function"&&qi.markRenderStopped()}function Ub(l){qi!==null&&typeof qi.markRenderScheduled=="function"&&qi.markRenderScheduled(l)}function Vb(l,u){qi!==null&&typeof qi.markForceUpdateScheduled=="function"&&qi.markForceUpdateScheduled(l,u)}function Ss(l,u){qi!==null&&typeof qi.markStateUpdateScheduled=="function"&&qi.markStateUpdateScheduled(l,u)}var Sn=0,Ln=1,Br=2,lo=8,Vl=16,pg=Math.clz32?Math.clz32:tl,iy=Math.log,ny=Math.LN2;function tl(l){var u=l>>>0;return u===0?32:31-(iy(u)/ny|0)|0}var Er=31,mi=0,co=0,Zn=1,vd=2,hs=4,Nu=8,Eo=16,fc=32,At=4194240,Wt=64,Eh=128,ea=256,We=512,Lp=1024,Ch=2048,Ah=4096,uf=8192,hf=16384,Rh=32768,Ih=65536,ry=131072,mg=262144,gg=524288,zs=1048576,zp=2097152,df=130023424,xd=4194304,ff=8388608,bd=16777216,Bu=33554432,_g=67108864,ay=xd,Fp=134217728,oy=268435455,Np=268435456,uo=536870912,wl=1073741824;function Bp(l){{if(l&Zn)return"Sync";if(l&vd)return"InputContinuousHydration";if(l&hs)return"InputContinuous";if(l&Nu)return"DefaultHydration";if(l&Eo)return"Default";if(l&fc)return"TransitionHydration";if(l&At)return"Transition";if(l&df)return"Retry";if(l&Fp)return"SelectiveHydration";if(l&Np)return"IdleHydration";if(l&uo)return"Idle";if(l&wl)return"Offscreen"}}var gn=-1,dn=Wt,pf=xd;function Wo(l){switch(Gu(l)){case Zn:return Zn;case vd:return vd;case hs:return hs;case Nu:return Nu;case Eo:return Eo;case fc:return fc;case Wt:case Eh:case ea:case We:case Lp:case Ch:case Ah:case uf:case hf:case Rh:case Ih:case ry:case mg:case gg:case zs:case zp:return l&At;case xd:case ff:case bd:case Bu:case _g:return l&df;case Fp:return Fp;case Np:return Np;case uo:return uo;case wl:return wl;default:return C("Should have found matching lanes. This is a bug in React."),l}}function qc(l,u){var w=l.pendingLanes;if(w===mi)return mi;var I=mi,O=l.suspendedLanes,G=l.pingedLanes,Y=w&oy;if(Y!==mi){var oe=Y&~O;if(oe!==mi)I=Wo(oe);else{var fe=Y&G;fe!==mi&&(I=Wo(fe))}}else{var Oe=w&~O;Oe!==mi?I=Wo(Oe):G!==mi&&(I=Wo(G))}if(I===mi)return mi;if(u!==mi&&u!==I&&(u&O)===mi){var Ne=Gu(I),ft=Gu(u);if(Ne>=ft||Ne===Eo&&(ft&At)!==mi)return u}(I&hs)!==mi&&(I|=w&Eo);var dt=l.entangledLanes;if(dt!==mi)for(var Vt=l.entanglements,jt=I&dt;jt>0;){var ii=Gl(jt),Ji=1<<ii;I|=Vt[ii],jt&=~Ji}return I}function mf(l,u){for(var w=l.eventTimes,I=gn;u>0;){var O=Gl(u),G=1<<O,Y=w[O];Y>I&&(I=Y),u&=~G}return I}function Uu(l,u){switch(l){case Zn:case vd:case hs:return u+250;case Nu:case Eo:case fc:case Wt:case Eh:case ea:case We:case Lp:case Ch:case Ah:case uf:case hf:case Rh:case Ih:case ry:case mg:case gg:case zs:case zp:return u+5e3;case xd:case ff:case bd:case Bu:case _g:return gn;case Fp:case Np:case uo:case wl:return gn;default:return C("Should have found matching lanes. This is a bug in React."),gn}}function sy(l,u){for(var w=l.pendingLanes,I=l.suspendedLanes,O=l.pingedLanes,G=l.expirationTimes,Y=w;Y>0;){var oe=Gl(Y),fe=1<<oe,Oe=G[oe];Oe===gn?((fe&I)===mi||(fe&O)!==mi)&&(G[oe]=Uu(fe,u)):Oe<=u&&(l.expiredLanes|=fe),Y&=~fe}}function ly(l){return Wo(l.pendingLanes)}function gf(l){var u=l.pendingLanes&~wl;return u!==mi?u:u&wl?wl:mi}function yg(l){return(l&Zn)!==mi}function Fs(l){return(l&oy)!==mi}function Vu(l){return(l&df)===l}function wd(l){var u=Zn|hs|Eo;return(l&u)===mi}function vg(l){return(l&At)===l}function Td(l,u){var w=vd|hs|Nu|Eo;return(u&w)!==mi}function _f(l,u){return(u&l.expiredLanes)!==mi}function ju(l){return(l&At)!==mi}function xg(){var l=dn;return dn<<=1,(dn&At)===mi&&(dn=Wt),l}function jl(){var l=pf;return pf<<=1,(pf&df)===mi&&(pf=xd),l}function Gu(l){return l&-l}function Dh(l){return Gu(l)}function Gl(l){return 31-pg(l)}function Mh(l){return Gl(l)}function ar(l,u){return(l&u)!==mi}function pc(l,u){return(l&u)===u}function fr(l,u){return l|u}function yf(l,u){return l&~u}function Ph(l,u){return l&u}function px(l){return l}function Up(l,u){return l!==co&&l<u?l:u}function Vp(l){for(var u=[],w=0;w<Er;w++)u.push(l);return u}function Hl(l,u,w){l.pendingLanes|=u,u!==uo&&(l.suspendedLanes=mi,l.pingedLanes=mi);var I=l.eventTimes,O=Mh(u);I[O]=w}function cy(l,u){l.suspendedLanes|=u,l.pingedLanes&=~u;for(var w=l.expirationTimes,I=u;I>0;){var O=Gl(I),G=1<<O;w[O]=gn,I&=~G}}function jp(l,u,w){l.pingedLanes|=l.suspendedLanes&u}function bg(l,u){var w=l.pendingLanes&~u;l.pendingLanes=u,l.suspendedLanes=mi,l.pingedLanes=mi,l.expiredLanes&=u,l.mutableReadLanes&=u,l.entangledLanes&=u;for(var I=l.entanglements,O=l.eventTimes,G=l.expirationTimes,Y=w;Y>0;){var oe=Gl(Y),fe=1<<oe;I[oe]=mi,O[oe]=gn,G[oe]=gn,Y&=~fe}}function Oh(l,u){for(var w=l.entangledLanes|=u,I=l.entanglements,O=w;O;){var G=Gl(O),Y=1<<G;Y&u|I[G]&u&&(I[G]|=u),O&=~Y}}function uy(l,u){var w=Gu(u),I;switch(w){case hs:I=vd;break;case Eo:I=Nu;break;case Wt:case Eh:case ea:case We:case Lp:case Ch:case Ah:case uf:case hf:case Rh:case Ih:case ry:case mg:case gg:case zs:case zp:case xd:case ff:case bd:case Bu:case _g:I=fc;break;case uo:I=Np;break;default:I=co;break}return(I&(l.suspendedLanes|u))!==co?co:I}function Gp(l,u,w){if(dc)for(var I=l.pendingUpdatersLaneMap;w>0;){var O=Mh(w),G=1<<O,Y=I[O];Y.add(u),w&=~G}}function wg(l,u){if(dc)for(var w=l.pendingUpdatersLaneMap,I=l.memoizedUpdaters;u>0;){var O=Mh(u),G=1<<O,Y=w[O];Y.size>0&&(Y.forEach(function(oe){var fe=oe.alternate;(fe===null||!I.has(fe))&&I.add(oe)}),Y.clear()),u&=~G}}function hy(l,u){return null}var Es=Zn,Tl=hs,mc=Eo,Hp=uo,Sd=co;function $l(){return Sd}function Co(l){Sd=l}function mx(l,u){var w=Sd;try{return Sd=l,u()}finally{Sd=w}}function gx(l,u){return l!==0&&l<u?l:u}function _x(l,u){return l>u?l:u}function Tg(l,u){return l!==0&&l<u}function dy(l){var u=Gu(l);return Tg(Es,u)?Tg(Tl,u)?Fs(u)?mc:Hp:Tl:Es}function Sg(l){var u=l.current.memoizedState;return u.isDehydrated}var yx;function ta(l){yx=l}function vx(l){yx(l)}var fy;function jb(l){fy=l}var xx;function $p(l){xx=l}var vf;function py(l){vf=l}var Wp;function Wl(l){Wp=l}var xf=!1,ya=[],ds=null,Sl=null,ql=null,Ed=new Map,bf=new Map,Zl=[],Gb=["mousedown","mouseup","touchcancel","touchend","touchstart","auxclick","dblclick","pointercancel","pointerdown","pointerup","dragend","dragstart","drop","compositionend","compositionstart","keydown","keypress","keyup","input","textInput","copy","cut","paste","click","change","contextmenu","reset","submit"];function bx(l){return Gb.indexOf(l)>-1}function my(l,u,w,I,O){return{blockedOn:l,domEventName:u,eventSystemFlags:w,nativeEvent:O,targetContainers:[I]}}function Eg(l,u){switch(l){case"focusin":case"focusout":ds=null;break;case"dragenter":case"dragleave":Sl=null;break;case"mouseover":case"mouseout":ql=null;break;case"pointerover":case"pointerout":{var w=u.pointerId;Ed.delete(w);break}case"gotpointercapture":case"lostpointercapture":{var I=u.pointerId;bf.delete(I);break}}}function kh(l,u,w,I,O,G){if(l===null||l.nativeEvent!==G){var Y=my(u,w,I,O,G);if(u!==null){var oe=Jc(u);oe!==null&&fy(oe)}return Y}l.eventSystemFlags|=I;var fe=l.targetContainers;return O!==null&&fe.indexOf(O)===-1&&fe.push(O),l}function Cg(l,u,w,I,O){switch(u){case"focusin":{var G=O;return ds=kh(ds,l,u,w,I,G),!0}case"dragenter":{var Y=O;return Sl=kh(Sl,l,u,w,I,Y),!0}case"mouseover":{var oe=O;return ql=kh(ql,l,u,w,I,oe),!0}case"pointerover":{var fe=O,Oe=fe.pointerId;return Ed.set(Oe,kh(Ed.get(Oe)||null,l,u,w,I,fe)),!0}case"gotpointercapture":{var Ne=O,ft=Ne.pointerId;return bf.set(ft,kh(bf.get(ft)||null,l,u,w,I,Ne)),!0}}return!1}function wf(l){var u=Od(l.target);if(u!==null){var w=xh(u);if(w!==null){var I=w.tag;if(I===it){var O=q_(w);if(O!==null){l.blockedOn=O,Wp(l.priority,function(){xx(w)});return}}else if(I===K){var G=w.stateNode;if(Sg(G)){l.blockedOn=cx(w);return}}}}l.blockedOn=null}function Hu(l){for(var u=vf(),w={blockedOn:null,target:l,priority:u},I=0;I<Zl.length&&Tg(u,Zl[I].priority);I++);Zl.splice(I,0,w),I===0&&wf(w)}function il(l){if(l.blockedOn!==null)return!1;for(var u=l.targetContainers;u.length>0;){var w=u[0],I=b(l.domEventName,l.eventSystemFlags,w,l.nativeEvent);if(I===null){var O=l.nativeEvent,G=new O.constructor(O.type,O);Tp(G),O.target.dispatchEvent(G),zc()}else{var Y=Jc(I);return Y!==null&&fy(Y),l.blockedOn=I,!1}u.shift()}return!0}function qo(l,u,w){il(l)&&w.delete(u)}function $u(){xf=!1,ds!==null&&il(ds)&&(ds=null),Sl!==null&&il(Sl)&&(Sl=null),ql!==null&&il(ql)&&(ql=null),Ed.forEach(qo),bf.forEach(qo)}function Ns(l,u){l.blockedOn===u&&(l.blockedOn=null,xf||(xf=!0,s.unstable_scheduleCallback(s.unstable_NormalPriority,$u)))}function qp(l){if(ya.length>0){Ns(ya[0],l);for(var u=1;u<ya.length;u++){var w=ya[u];w.blockedOn===l&&(w.blockedOn=null)}}ds!==null&&Ns(ds,l),Sl!==null&&Ns(Sl,l),ql!==null&&Ns(ql,l);var I=function(oe){return Ns(oe,l)};Ed.forEach(I),bf.forEach(I);for(var O=0;O<Zl.length;O++){var G=Zl[O];G.blockedOn===l&&(G.blockedOn=null)}for(;Zl.length>0;){var Y=Zl[0];if(Y.blockedOn!==null)break;wf(Y),Y.blockedOn===null&&Zl.shift()}}var Tf=h.ReactCurrentBatchConfig,gy=!0;function wx(l){gy=!!l}function _y(){return gy}function Bs(l,u,w){var I=T(u),O;switch(I){case Es:O=f;break;case Tl:O=t;break;case mc:default:O=a;break}return O.bind(null,u,w,l)}function f(l,u,w,I){var O=$l(),G=Tf.transition;Tf.transition=null;try{Co(Es),a(l,u,w,I)}finally{Co(O),Tf.transition=G}}function t(l,u,w,I){var O=$l(),G=Tf.transition;Tf.transition=null;try{Co(Tl),a(l,u,w,I)}finally{Co(O),Tf.transition=G}}function a(l,u,w,I){gy&&p(l,u,w,I)}function p(l,u,w,I){var O=b(l,u,w,I);if(O===null){Cf(l,u,I,y,w),Eg(l,I);return}if(Cg(O,l,u,w,I)){I.stopPropagation();return}if(Eg(l,I),u&Lc&&bx(l)){for(;O!==null;){var G=Jc(O);G!==null&&vx(G);var Y=b(l,u,w,I);if(Y===null&&Cf(l,u,I,y,w),Y===O)break;O=Y}O!==null&&I.stopPropagation();return}Cf(l,u,I,null,w)}var y=null;function b(l,u,w,I){y=null;var O=el(I),G=Od(O);if(G!==null){var Y=xh(G);if(Y===null)G=null;else{var oe=Y.tag;if(oe===it){var fe=q_(Y);if(fe!==null)return fe;G=null}else if(oe===K){var Oe=Y.stateNode;if(Sg(Oe))return cx(Y);G=null}else Y!==G&&(G=null)}}return y=G,null}function T(l){switch(l){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return Es;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return Tl;case"message":{var u=ag();switch(u){case Gc:return Es;case Hc:return Tl;case Lu:case og:return mc;case Pp:return Hp;default:return mc}}default:return mc}}function R(l,u,w){return l.addEventListener(u,w,!1),w}function D(l,u,w){return l.addEventListener(u,w,!0),w}function L(l,u,w,I){return l.addEventListener(u,w,{capture:!0,passive:I}),w}function F(l,u,w,I){return l.addEventListener(u,w,{passive:I}),w}var j=null,B=null,$=null;function Z(l){return j=l,B=te(),!0}function Q(){j=null,B=null,$=null}function re(){if($)return $;var l,u=B,w=u.length,I,O=te(),G=O.length;for(l=0;l<w&&u[l]===O[l];l++);var Y=w-l;for(I=1;I<=Y&&u[w-I]===O[G-I];I++);var oe=I>1?1-I:void 0;return $=O.slice(l,oe),$}function te(){return"value"in j?j.value:j.textContent}function se(l){var u,w=l.keyCode;return"charCode"in l?(u=l.charCode,u===0&&w===13&&(u=13)):u=w,u===10&&(u=13),u>=32||u===13?u:0}function me(){return!0}function ce(){return!1}function Ae(l){function u(w,I,O,G,Y){this._reactName=w,this._targetInst=O,this.type=I,this.nativeEvent=G,this.target=Y,this.currentTarget=null;for(var oe in l)if(l.hasOwnProperty(oe)){var fe=l[oe];fe?this[oe]=fe(G):this[oe]=G[oe]}var Oe=G.defaultPrevented!=null?G.defaultPrevented:G.returnValue===!1;return Oe?this.isDefaultPrevented=me:this.isDefaultPrevented=ce,this.isPropagationStopped=ce,this}return Yt(u.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=me)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=me)},persist:function(){},isPersistent:me}),u}var _e={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ie=Ae(_e),Ce=Yt({},_e,{view:0,detail:0}),Te=Ae(Ce),De,Ge,Ue;function nt(l){l!==Ue&&(Ue&&l.type==="mousemove"?(De=l.screenX-Ue.screenX,Ge=l.screenY-Ue.screenY):(De=0,Ge=0),Ue=l)}var Ke=Yt({},Ce,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:An,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(nt(l),De)},movementY:function(l){return"movementY"in l?l.movementY:Ge}}),st=Ae(Ke),Pt=Yt({},Ke,{dataTransfer:0}),Ze=Ae(Pt),ze=Yt({},Ce,{relatedTarget:0}),lt=Ae(ze),Je=Yt({},_e,{animationName:0,elapsedTime:0,pseudoElement:0}),bt=Ae(Je),Ft=Yt({},_e,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),ci=Ae(Ft),Mt=Yt({},_e,{data:0}),Ot=Ae(Mt),di=Ot,ei={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jt={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};function ti(l){if(l.key){var u=ei[l.key]||l.key;if(u!=="Unidentified")return u}if(l.type==="keypress"){var w=se(l);return w===13?"Enter":String.fromCharCode(w)}return l.type==="keydown"||l.type==="keyup"?Jt[l.keyCode]||"Unidentified":""}var Ii={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yn(l){var u=this,w=u.nativeEvent;if(w.getModifierState)return w.getModifierState(l);var I=Ii[l];return I?!!w[I]:!1}function An(l){return yn}var _r=Yt({},Ce,{key:ti,code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:An,charCode:function(l){return l.type==="keypress"?se(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?se(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),Bi=Ae(_r),In=Yt({},Ke,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),tn=Ae(In),dr=Yt({},Ce,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:An}),Pn=Ae(dr),Cr=Yt({},_e,{propertyName:0,elapsedTime:0,pseudoElement:0}),jn=Ae(Cr),on=Yt({},Ke,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),tr=Ae(on),un=[9,13,27,32],kr=229,Xn=gr&&"CompositionEvent"in window,Fi=null;gr&&"documentMode"in document&&(Fi=document.documentMode);var zn=gr&&"TextEvent"in window&&!Fi,$r=gr&&(!Xn||Fi&&Fi>8&&Fi<=11),va=32,Xr=String.fromCharCode(va);function pa(){Vi("onBeforeInput",["compositionend","keypress","textInput","paste"]),Vi("onCompositionEnd",["compositionend","focusout","keydown","keypress","keyup","mousedown"]),Vi("onCompositionStart",["compositionstart","focusout","keydown","keypress","keyup","mousedown"]),Vi("onCompositionUpdate",["compositionupdate","focusout","keydown","keypress","keyup","mousedown"])}var Cs=!1;function As(l){return(l.ctrlKey||l.altKey||l.metaKey)&&!(l.ctrlKey&&l.altKey)}function Zo(l){switch(l){case"compositionstart":return"onCompositionStart";case"compositionend":return"onCompositionEnd";case"compositionupdate":return"onCompositionUpdate"}}function es(l,u){return l==="keydown"&&u.keyCode===kr}function nl(l,u){switch(l){case"keyup":return un.indexOf(u.keyCode)!==-1;case"keydown":return u.keyCode!==kr;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Lo(l){var u=l.detail;return typeof u=="object"&&"data"in u?u.data:null}function rl(l){return l.locale==="ko"}var fs=!1;function Ao(l,u,w,I,O){var G,Y;if(Xn?G=Zo(u):fs?nl(u,I)&&(G="onCompositionEnd"):es(u,I)&&(G="onCompositionStart"),!G)return null;$r&&!rl(I)&&(!fs&&G==="onCompositionStart"?fs=Z(O):G==="onCompositionEnd"&&fs&&(Y=re()));var oe=Yp(w,G);if(oe.length>0){var fe=new Ot(G,u,null,I,O);if(l.push({event:fe,listeners:oe}),Y)fe.data=Y;else{var Oe=Lo(I);Oe!==null&&(fe.data=Oe)}}}function ca(l,u){switch(l){case"compositionend":return Lo(u);case"keypress":var w=u.which;return w!==va?null:(Cs=!0,Xr);case"textInput":var I=u.data;return I===Xr&&Cs?null:I;default:return null}}function Ea(l,u){if(fs){if(l==="compositionend"||!Xn&&nl(l,u)){var w=re();return Q(),fs=!1,w}return null}switch(l){case"paste":return null;case"keypress":if(!As(u)){if(u.char&&u.char.length>1)return u.char;if(u.which)return String.fromCharCode(u.which)}return null;case"compositionend":return $r&&!rl(u)?null:u.data;default:return null}}function br(l,u,w,I,O){var G;if(zn?G=ca(u,I):G=Ea(u,I),!G)return null;var Y=Yp(w,"onBeforeInput");if(Y.length>0){var oe=new di("onBeforeInput","beforeinput",null,I,O);l.push({event:oe,listeners:Y}),oe.data=G}}function ka(l,u,w,I,O,G,Y){Ao(l,u,w,I,O),br(l,u,w,I,O)}var Ro={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ia(l){var u=l&&l.nodeName&&l.nodeName.toLowerCase();return u==="input"?!!Ro[l.type]:u==="textarea"}/**
 * Checks if an event is supported in the current execution environment.
 *
 * NOTE: This will not work correctly for non-generic events such as `change`,
 * `reset`, `load`, `error`, and `select`.
 *
 * Borrows from Modernizr.
 *
 * @param {string} eventNameSuffix Event name, e.g. "click".
 * @return {boolean} True if the event is supported.
 * @internal
 * @license Modernizr 3.0.0pre (Custom Build) | MIT
 */function El(l){if(!gr)return!1;var u="on"+l,w=u in document;if(!w){var I=document.createElement("div");I.setAttribute(u,"return;"),w=typeof I[u]=="function"}return w}function Sf(){Vi("onChange",["change","click","focusin","focusout","input","keydown","keyup","selectionchange"])}function Zc(l,u,w,I){ix(I);var O=Yp(u,"onChange");if(O.length>0){var G=new Ie("onChange","change",null,w,I);l.push({event:G,listeners:O})}}var Xc=null,Yc=null;function Cl(l){var u=l.nodeName&&l.nodeName.toLowerCase();return u==="select"||u==="input"&&l.type==="file"}function Kc(l){var u=[];Zc(u,Yc,l,el(l)),rx(vo,u)}function vo(l){KT(l,0)}function Rs(l){var u=Wg(l);if(Tu(u))return l}function Cd(l,u){if(l==="change")return u}var yy=!1;gr&&(yy=El("input")&&(!document.documentMode||document.documentMode>9));function Ag(l,u){Xc=l,Yc=u,Xc.attachEvent("onpropertychange",Hb)}function OT(){Xc&&(Xc.detachEvent("onpropertychange",Hb),Xc=null,Yc=null)}function Hb(l){l.propertyName==="value"&&Rs(Yc)&&Kc(l)}function Tx(l,u,w){l==="focusin"?(OT(),Ag(u,w)):l==="focusout"&&OT()}function ZC(l,u){if(l==="selectionchange"||l==="keyup"||l==="keydown")return Rs(Yc)}function kT(l){var u=l.nodeName;return u&&u.toLowerCase()==="input"&&(l.type==="checkbox"||l.type==="radio")}function XC(l,u){if(l==="click")return Rs(u)}function $b(l,u){if(l==="input"||l==="change")return Rs(u)}function Lh(l){var u=l._wrapperState;!u||!u.controlled||l.type!=="number"||mn(l,"number",l.value)}function Ad(l,u,w,I,O,G,Y){var oe=w?Wg(w):window,fe,Oe;if(Cl(oe)?fe=Cd:ia(oe)?yy?fe=$b:(fe=ZC,Oe=Tx):kT(oe)&&(fe=XC),fe){var Ne=fe(u,w);if(Ne){Zc(l,Ne,I,O);return}}Oe&&Oe(u,oe,w),u==="focusout"&&Lh(oe)}function LT(){Rn("onMouseEnter",["mouseout","mouseover"]),Rn("onMouseLeave",["mouseout","mouseover"]),Rn("onPointerEnter",["pointerout","pointerover"]),Rn("onPointerLeave",["pointerout","pointerover"])}function zT(l,u,w,I,O,G,Y){var oe=u==="mouseover"||u==="pointerover",fe=u==="mouseout"||u==="pointerout";if(oe&&!$m(I)){var Oe=I.relatedTarget||I.fromElement;if(Oe&&(Od(Oe)||im(Oe)))return}if(!(!fe&&!oe)){var Ne;if(O.window===O)Ne=O;else{var ft=O.ownerDocument;ft?Ne=ft.defaultView||ft.parentWindow:Ne=window}var dt,Vt;if(fe){var jt=I.relatedTarget||I.toElement;if(dt=w,Vt=jt?Od(jt):null,Vt!==null){var ii=xh(Vt);(Vt!==ii||Vt.tag!==ue&&Vt.tag!==pe)&&(Vt=null)}}else dt=null,Vt=w;if(dt!==Vt){var Ji=st,Fn="onMouseLeave",Tn="onMouseEnter",ra="mouse";(u==="pointerout"||u==="pointerover")&&(Ji=tn,Fn="onPointerLeave",Tn="onPointerEnter",ra="pointer");var Wr=dt==null?Ne:Wg(dt),Rt=Vt==null?Ne:Wg(Vt),ni=new Ji(Fn,ra+"leave",dt,I,O);ni.target=Wr,ni.relatedTarget=Rt;var It=null,Ei=Od(O);if(Ei===w){var sn=new Ji(Tn,ra+"enter",Vt,I,O);sn.target=Rt,sn.relatedTarget=Wr,It=sn}Cy(l,ni,It,dt,Vt)}}}function Sx(l,u){return l===u&&(l!==0||1/l===1/u)||l!==l&&u!==u}var Al=typeof Object.is=="function"?Object.is:Sx;function Rd(l,u){if(Al(l,u))return!0;if(typeof l!="object"||l===null||typeof u!="object"||u===null)return!1;var w=Object.keys(l),I=Object.keys(u);if(w.length!==I.length)return!1;for(var O=0;O<w.length;O++){var G=w[O];if(!za.call(u,G)||!Al(l[G],u[G]))return!1}return!0}function vy(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function FT(l){for(;l;){if(l.nextSibling)return l.nextSibling;l=l.parentNode}}function xy(l,u){for(var w=vy(l),I=0,O=0;w;){if(w.nodeType===Sa){if(O=I+w.textContent.length,I<=u&&O>=u)return{node:w,offset:u-I};I=O}w=vy(FT(w))}}function Wb(l){var u=l.ownerDocument,w=u&&u.defaultView||window,I=w.getSelection&&w.getSelection();if(!I||I.rangeCount===0)return null;var O=I.anchorNode,G=I.anchorOffset,Y=I.focusNode,oe=I.focusOffset;try{O.nodeType,Y.nodeType}catch{return null}return qb(l,O,G,Y,oe)}function qb(l,u,w,I,O){var G=0,Y=-1,oe=-1,fe=0,Oe=0,Ne=l,ft=null;e:for(;;){for(var dt=null;Ne===u&&(w===0||Ne.nodeType===Sa)&&(Y=G+w),Ne===I&&(O===0||Ne.nodeType===Sa)&&(oe=G+O),Ne.nodeType===Sa&&(G+=Ne.nodeValue.length),(dt=Ne.firstChild)!==null;)ft=Ne,Ne=dt;for(;;){if(Ne===l)break e;if(ft===u&&++fe===w&&(Y=G),ft===I&&++Oe===O&&(oe=G),(dt=Ne.nextSibling)!==null)break;Ne=ft,ft=Ne.parentNode}Ne=dt}return Y===-1||oe===-1?null:{start:Y,end:oe}}function NT(l,u){var w=l.ownerDocument||document,I=w&&w.defaultView||window;if(I.getSelection){var O=I.getSelection(),G=l.textContent.length,Y=Math.min(u.start,G),oe=u.end===void 0?Y:Math.min(u.end,G);if(!O.extend&&Y>oe){var fe=oe;oe=Y,Y=fe}var Oe=xy(l,Y),Ne=xy(l,oe);if(Oe&&Ne){if(O.rangeCount===1&&O.anchorNode===Oe.node&&O.anchorOffset===Oe.offset&&O.focusNode===Ne.node&&O.focusOffset===Ne.offset)return;var ft=w.createRange();ft.setStart(Oe.node,Oe.offset),O.removeAllRanges(),Y>oe?(O.addRange(ft),O.extend(Ne.node,Ne.offset)):(ft.setEnd(Ne.node,Ne.offset),O.addRange(ft))}}}function Zb(l){return l&&l.nodeType===Sa}function Id(l,u){return!l||!u?!1:l===u?!0:Zb(l)?!1:Zb(u)?Id(l,u.parentNode):"contains"in l?l.contains(u):l.compareDocumentPosition?!!(l.compareDocumentPosition(u)&16):!1}function BT(l){return l&&l.ownerDocument&&Id(l.ownerDocument.documentElement,l)}function Xb(l){try{return typeof l.contentWindow.location.href=="string"}catch{return!1}}function Yb(){for(var l=window,u=sc();u instanceof l.HTMLIFrameElement;){if(Xb(u))l=u.contentWindow;else return u;u=sc(l.document)}return u}function Kb(l){var u=l&&l.nodeName&&l.nodeName.toLowerCase();return u&&(u==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||u==="textarea"||l.contentEditable==="true")}function YC(){var l=Yb();return{focusedElem:l,selectionRange:Kb(l)?UT(l):null}}function KC(l){var u=Yb(),w=l.focusedElem,I=l.selectionRange;if(u!==w&&BT(w)){I!==null&&Kb(w)&&VT(w,I);for(var O=[],G=w;G=G.parentNode;)G.nodeType===Jo&&O.push({element:G,left:G.scrollLeft,top:G.scrollTop});typeof w.focus=="function"&&w.focus();for(var Y=0;Y<O.length;Y++){var oe=O[Y];oe.element.scrollLeft=oe.left,oe.element.scrollTop=oe.top}}}function UT(l){var u;return"selectionStart"in l?u={start:l.selectionStart,end:l.selectionEnd}:u=Wb(l),u||{start:0,end:0}}function VT(l,u){var w=u.start,I=u.end;I===void 0&&(I=w),"selectionStart"in l?(l.selectionStart=w,l.selectionEnd=Math.min(I,l.value.length)):NT(l,u)}var JC=gr&&"documentMode"in document&&document.documentMode<=11;function jT(){Vi("onSelect",["focusout","contextmenu","dragend","focusin","keydown","keyup","mousedown","mouseup","selectionchange"])}var Rg=null,Jb=null,Ig=null,Ex=!1;function GT(l){if("selectionStart"in l&&Kb(l))return{start:l.selectionStart,end:l.selectionEnd};var u=l.ownerDocument&&l.ownerDocument.defaultView||window,w=u.getSelection();return{anchorNode:w.anchorNode,anchorOffset:w.anchorOffset,focusNode:w.focusNode,focusOffset:w.focusOffset}}function HT(l){return l.window===l?l.document:l.nodeType===oo?l:l.ownerDocument}function Qb(l,u,w){var I=HT(w);if(!(Ex||Rg==null||Rg!==sc(I))){var O=GT(Rg);if(!Ig||!Rd(Ig,O)){Ig=O;var G=Yp(Jb,"onSelect");if(G.length>0){var Y=new Ie("onSelect","select",null,u,w);l.push({event:Y,listeners:G}),Y.target=Rg}}}}function $T(l,u,w,I,O,G,Y){var oe=w?Wg(w):window;switch(u){case"focusin":(ia(oe)||oe.contentEditable==="true")&&(Rg=oe,Jb=w,Ig=null);break;case"focusout":Rg=null,Jb=null,Ig=null;break;case"mousedown":Ex=!0;break;case"contextmenu":case"mouseup":case"dragend":Ex=!1,Qb(l,I,O);break;case"selectionchange":if(JC)break;case"keydown":case"keyup":Qb(l,I,O)}}function by(l,u){var w={};return w[l.toLowerCase()]=u.toLowerCase(),w["Webkit"+l]="webkit"+u,w["Moz"+l]="moz"+u,w}var Ef={animationend:by("Animation","AnimationEnd"),animationiteration:by("Animation","AnimationIteration"),animationstart:by("Animation","AnimationStart"),transitionend:by("Transition","TransitionEnd")},zh={},Xo={};gr&&(Xo=document.createElement("div").style,"AnimationEvent"in window||(delete Ef.animationend.animation,delete Ef.animationiteration.animation,delete Ef.animationstart.animation),"TransitionEvent"in window||delete Ef.transitionend.transition);function wy(l){if(zh[l])return zh[l];if(!Ef[l])return l;var u=Ef[l];for(var w in u)if(u.hasOwnProperty(w)&&w in Xo)return zh[l]=u[w];return l}var Dg=wy("animationend"),WT=wy("animationiteration"),qT=wy("animationstart"),ZT=wy("transitionend"),XT=new Map,Zp=["abort","auxClick","cancel","canPlay","canPlayThrough","click","close","contextMenu","copy","cut","drag","dragEnd","dragEnter","dragExit","dragLeave","dragOver","dragStart","drop","durationChange","emptied","encrypted","ended","error","gotPointerCapture","input","invalid","keyDown","keyPress","keyUp","load","loadedData","loadedMetadata","loadStart","lostPointerCapture","mouseDown","mouseMove","mouseOut","mouseOver","mouseUp","paste","pause","play","playing","pointerCancel","pointerDown","pointerMove","pointerOut","pointerOver","pointerUp","progress","rateChange","reset","resize","seeked","seeking","stalled","submit","suspend","timeUpdate","touchCancel","touchEnd","touchStart","volumeChange","scroll","toggle","touchMove","waiting","wheel"];function Dd(l,u){XT.set(l,u),Vi(u,[l])}function Xp(){for(var l=0;l<Zp.length;l++){var u=Zp[l],w=u.toLowerCase(),I=u[0].toUpperCase()+u.slice(1);Dd(w,"on"+I)}Dd(Dg,"onAnimationEnd"),Dd(WT,"onAnimationIteration"),Dd(qT,"onAnimationStart"),Dd("dblclick","onDoubleClick"),Dd("focusin","onFocus"),Dd("focusout","onBlur"),Dd(ZT,"onTransitionEnd")}function Ty(l,u,w,I,O,G,Y){var oe=XT.get(u);if(oe!==void 0){var fe=Ie,Oe=u;switch(u){case"keypress":if(se(I)===0)return;case"keydown":case"keyup":fe=Bi;break;case"focusin":Oe="focus",fe=lt;break;case"focusout":Oe="blur",fe=lt;break;case"beforeblur":case"afterblur":fe=lt;break;case"click":if(I.button===2)return;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":fe=st;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":fe=Ze;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":fe=Pn;break;case Dg:case WT:case qT:fe=bt;break;case ZT:fe=jn;break;case"scroll":fe=Te;break;case"wheel":fe=tr;break;case"copy":case"cut":case"paste":fe=ci;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":fe=tn;break}var Ne=(G&Lc)!==0;{var ft=!Ne&&u==="scroll",dt=Cx(w,oe,I.type,Ne,ft);if(dt.length>0){var Vt=new fe(oe,Oe,null,I,O);l.push({event:Vt,listeners:dt})}}}}Xp(),LT(),Sf(),jT(),pa();function QC(l,u,w,I,O,G,Y){Ty(l,u,w,I,O,G);var oe=(G&Qd)===0;oe&&(zT(l,u,w,I,O),Ad(l,u,w,I,O),$T(l,u,w,I,O),ka(l,u,w,I,O))}var Sy=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","resize","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],ew=new Set(["cancel","close","invalid","load","scroll","toggle"].concat(Sy));function YT(l,u,w){var I=l.type||"unknown-event";l.currentTarget=w,Km(I,u,void 0,l),l.currentTarget=null}function eA(l,u,w){var I;if(w)for(var O=u.length-1;O>=0;O--){var G=u[O],Y=G.instance,oe=G.currentTarget,fe=G.listener;if(Y!==I&&l.isPropagationStopped())return;YT(l,fe,oe),I=Y}else for(var Oe=0;Oe<u.length;Oe++){var Ne=u[Oe],ft=Ne.instance,dt=Ne.currentTarget,Vt=Ne.listener;if(ft!==I&&l.isPropagationStopped())return;YT(l,Vt,dt),I=ft}}function KT(l,u){for(var w=(u&Lc)!==0,I=0;I<l.length;I++){var O=l[I],G=O.event,Y=O.listeners;eA(G,Y,w)}Jm()}function tA(l,u,w,I,O){var G=el(w),Y=[];QC(Y,l,I,w,G,u),KT(Y,u)}function Ya(l,u){ew.has(l)||C('Did not expect a listenToNonDelegatedEvent() call for "%s". This is a bug in React. Please file an issue.',l);var w=!1,I=wA(u),O=nw(l);I.has(O)||(JT(u,l,wp,w),I.add(O))}function tw(l,u,w){ew.has(l)&&!u&&C('Did not expect a listenToNativeEvent() call for "%s" in the bubble phase. This is a bug in React. Please file an issue.',l);var I=0;u&&(I|=Lc),JT(w,l,I,u)}var Ey="_reactListening"+Math.random().toString(36).slice(2);function Md(l){if(!l[Ey]){l[Ey]=!0,Aa.forEach(function(w){w!=="selectionchange"&&(ew.has(w)||tw(w,!1,l),tw(w,!0,l))});var u=l.nodeType===oo?l:l.ownerDocument;u!==null&&(u[Ey]||(u[Ey]=!0,tw("selectionchange",!1,u)))}}function JT(l,u,w,I,O){var G=Bs(l,u,w),Y=void 0;Xm&&(u==="touchstart"||u==="touchmove"||u==="wheel")&&(Y=!0),l=l,I?Y!==void 0?L(l,u,G,Y):D(l,u,G):Y!==void 0?F(l,u,G,Y):R(l,u,G)}function xo(l,u){return l===u||l.nodeType===Pa&&l.parentNode===u}function Cf(l,u,w,I,O){var G=I;if(!(u&Lt)&&!(u&wp)){var Y=O;if(I!==null){var oe=I;e:for(;;){if(oe===null)return;var fe=oe.tag;if(fe===K||fe===ne){var Oe=oe.stateNode.containerInfo;if(xo(Oe,Y))break;if(fe===ne)for(var Ne=oe.return;Ne!==null;){var ft=Ne.tag;if(ft===K||ft===ne){var dt=Ne.stateNode.containerInfo;if(xo(dt,Y))return}Ne=Ne.return}for(;Oe!==null;){var Vt=Od(Oe);if(Vt===null)return;var jt=Vt.tag;if(jt===ue||jt===pe){oe=G=Vt;continue e}Oe=Oe.parentNode}}oe=oe.return}}}rx(function(){return tA(l,u,w,G)})}function Mg(l,u,w){return{instance:l,listener:u,currentTarget:w}}function Cx(l,u,w,I,O,G){for(var Y=u!==null?u+"Capture":null,oe=I?Y:u,fe=[],Oe=l,Ne=null;Oe!==null;){var ft=Oe,dt=ft.stateNode,Vt=ft.tag;if(Vt===ue&&dt!==null&&(Ne=dt,oe!==null)){var jt=Sp(Oe,oe);jt!=null&&fe.push(Mg(Oe,jt,Ne))}if(O)break;Oe=Oe.return}return fe}function Yp(l,u){for(var w=u+"Capture",I=[],O=l;O!==null;){var G=O,Y=G.stateNode,oe=G.tag;if(oe===ue&&Y!==null){var fe=Y,Oe=Sp(O,w);Oe!=null&&I.unshift(Mg(O,Oe,fe));var Ne=Sp(O,u);Ne!=null&&I.push(Mg(O,Ne,fe))}O=O.return}return I}function Fh(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==ue);return l||null}function QT(l,u){for(var w=l,I=u,O=0,G=w;G;G=Fh(G))O++;for(var Y=0,oe=I;oe;oe=Fh(oe))Y++;for(;O-Y>0;)w=Fh(w),O--;for(;Y-O>0;)I=Fh(I),Y--;for(var fe=O;fe--;){if(w===I||I!==null&&w===I.alternate)return w;w=Fh(w),I=Fh(I)}return null}function iw(l,u,w,I,O){for(var G=u._reactName,Y=[],oe=w;oe!==null&&oe!==I;){var fe=oe,Oe=fe.alternate,Ne=fe.stateNode,ft=fe.tag;if(Oe!==null&&Oe===I)break;if(ft===ue&&Ne!==null){var dt=Ne;if(O){var Vt=Sp(oe,G);Vt!=null&&Y.unshift(Mg(oe,Vt,dt))}else if(!O){var jt=Sp(oe,G);jt!=null&&Y.push(Mg(oe,jt,dt))}}oe=oe.return}Y.length!==0&&l.push({event:u,listeners:Y})}function Cy(l,u,w,I,O){var G=I&&O?QT(I,O):null;I!==null&&iw(l,u,I,G,!1),O!==null&&w!==null&&iw(l,w,O,G,!0)}function nw(l,u){return l+"__bubble"}var Is=!1,Ay="dangerouslySetInnerHTML",Ry="suppressContentEditableWarning",Nh="suppressHydrationWarning",Ax="autoFocus",Af="children",Rl="style",Rx="__html",Us,Iy,Pg,rw,Kp,eS,tS;Us={dialog:!0,webview:!0},Iy=function(l,u){Fl(l,u),bp(l,u),Hm(l,u,{registrationNameDependencies:Gi,possibleRegistrationNames:Cn})},eS=gr&&!document.documentMode,Pg=function(l,u,w){if(!Is){var I=Og(w),O=Og(u);O!==I&&(Is=!0,C("Prop `%s` did not match. Server: %s Client: %s",l,JSON.stringify(O),JSON.stringify(I)))}},rw=function(l){if(!Is){Is=!0;var u=[];l.forEach(function(w){u.push(w)}),C("Extra attributes from the server: %s",u)}},Kp=function(l,u){u===!1?C("Expected `%s` listener to be a function, instead got `false`.\n\nIf you used to conditionally omit it with %s={condition && value}, pass %s={condition ? value : undefined} instead.",l,l,l):C("Expected `%s` listener to be a function, instead got a value of `%s` type.",l,typeof u)},tS=function(l,u){var w=l.namespaceURI===Ma?l.ownerDocument.createElement(l.tagName):l.ownerDocument.createElementNS(l.namespaceURI,l.tagName);return w.innerHTML=u,w.innerHTML};var aw=/\r\n?/g,iS=/\u0000|\uFFFD/g;function Og(l){mo(l);var u=typeof l=="string"?l:""+l;return u.replace(aw,`
`).replace(iS,"")}function kg(l,u,w,I){var O=Og(u),G=Og(l);if(G!==O&&(I&&(Is||(Is=!0,C('Text content did not match. Server: "%s" Client: "%s"',G,O))),w&&ri))throw new Error("Text content does not match server-rendered HTML.")}function ow(l){return l.nodeType===oo?l:l.ownerDocument}function nS(){}function Dy(l){l.onclick=nS}function rS(l,u,w,I,O){for(var G in I)if(I.hasOwnProperty(G)){var Y=I[G];if(G===Rl)Y&&Object.freeze(Y),Au(u,Y);else if(G===Ay){var oe=Y?Y[Rx]:void 0;oe!=null&&Fm(u,oe)}else if(G===Af)if(typeof Y=="string"){var fe=l!=="textarea"||Y!=="";fe&&Su(u,Y)}else typeof Y=="number"&&Su(u,""+Y);else G===Ry||G===Nh||G===Ax||(Gi.hasOwnProperty(G)?Y!=null&&(typeof Y!="function"&&Kp(G,Y),G==="onScroll"&&Ya("scroll",u)):Y!=null&&To(u,G,Y,O))}}function Ix(l,u,w,I){for(var O=0;O<u.length;O+=2){var G=u[O],Y=u[O+1];G===Rl?Au(l,Y):G===Ay?Fm(l,Y):G===Af?Su(l,Y):To(l,G,Y,I)}}function Bh(l,u,w,I){var O,G=ow(w),Y,oe=I;if(oe===Ma&&(oe=ld(l)),oe===Ma){if(O=ph(l,u),!O&&l!==l.toLowerCase()&&C("<%s /> is using incorrect casing. Use PascalCase for React components, or lowercase for HTML elements.",l),l==="script"){var fe=G.createElement("div");fe.innerHTML="<script><\/script>";var Oe=fe.firstChild;Y=fe.removeChild(Oe)}else if(typeof u.is=="string")Y=G.createElement(l,{is:u.is});else if(Y=G.createElement(l),l==="select"){var Ne=Y;u.multiple?Ne.multiple=!0:u.size&&(Ne.size=u.size)}}else Y=G.createElementNS(oe,l);return oe===Ma&&!O&&Object.prototype.toString.call(Y)==="[object HTMLUnknownElement]"&&!za.call(Us,l)&&(Us[l]=!0,C("The tag <%s> is unrecognized in this browser. If you meant to render a React component, start its name with an uppercase letter.",l)),Y}function aS(l,u){return ow(u).createTextNode(l)}function iA(l,u,w,I){var O=ph(u,w);Iy(u,w);var G;switch(u){case"dialog":Ya("cancel",l),Ya("close",l),G=w;break;case"iframe":case"object":case"embed":Ya("load",l),G=w;break;case"video":case"audio":for(var Y=0;Y<Sy.length;Y++)Ya(Sy[Y],l);G=w;break;case"source":Ya("error",l),G=w;break;case"img":case"image":case"link":Ya("error",l),Ya("load",l),G=w;break;case"details":Ya("toggle",l),G=w;break;case"input":zm(l,w),G=uh(l,w),Ya("invalid",l);break;case"option":la(l,w),G=w;break;case"select":kc(l,w),G=ws(l,w),Ya("invalid",l);break;case"textarea":cr(l,w),G=hh(l,w),Ya("invalid",l);break;default:G=w}switch(B_(u,G),rS(u,l,I,G,O),u){case"input":oc(l),zt(l,w,!1);break;case"textarea":oc(l),dh(l);break;case"option":Qi(l,w);break;case"select":bi(l,w);break;default:typeof G.onClick=="function"&&Dy(l);break}}function nA(l,u,w,I,O){Iy(u,I);var G=null,Y,oe;switch(u){case"input":Y=uh(l,w),oe=uh(l,I),G=[];break;case"select":Y=ws(l,w),oe=ws(l,I),G=[];break;case"textarea":Y=hh(l,w),oe=hh(l,I),G=[];break;default:Y=w,oe=I,typeof Y.onClick!="function"&&typeof oe.onClick=="function"&&Dy(l);break}B_(u,oe);var fe,Oe,Ne=null;for(fe in Y)if(!(oe.hasOwnProperty(fe)||!Y.hasOwnProperty(fe)||Y[fe]==null))if(fe===Rl){var ft=Y[fe];for(Oe in ft)ft.hasOwnProperty(Oe)&&(Ne||(Ne={}),Ne[Oe]="")}else fe===Ay||fe===Af||fe===Ry||fe===Nh||fe===Ax||(Gi.hasOwnProperty(fe)?G||(G=[]):(G=G||[]).push(fe,null));for(fe in oe){var dt=oe[fe],Vt=Y!=null?Y[fe]:void 0;if(!(!oe.hasOwnProperty(fe)||dt===Vt||dt==null&&Vt==null))if(fe===Rl)if(dt&&Object.freeze(dt),Vt){for(Oe in Vt)Vt.hasOwnProperty(Oe)&&(!dt||!dt.hasOwnProperty(Oe))&&(Ne||(Ne={}),Ne[Oe]="");for(Oe in dt)dt.hasOwnProperty(Oe)&&Vt[Oe]!==dt[Oe]&&(Ne||(Ne={}),Ne[Oe]=dt[Oe])}else Ne||(G||(G=[]),G.push(fe,Ne)),Ne=dt;else if(fe===Ay){var jt=dt?dt[Rx]:void 0,ii=Vt?Vt[Rx]:void 0;jt!=null&&ii!==jt&&(G=G||[]).push(fe,jt)}else fe===Af?(typeof dt=="string"||typeof dt=="number")&&(G=G||[]).push(fe,""+dt):fe===Ry||fe===Nh||(Gi.hasOwnProperty(fe)?(dt!=null&&(typeof dt!="function"&&Kp(fe,dt),fe==="onScroll"&&Ya("scroll",l)),!G&&Vt!==dt&&(G=[])):(G=G||[]).push(fe,dt))}return Ne&&(ex(Ne,oe[Rl]),(G=G||[]).push(Rl,Ne)),G}function rA(l,u,w,I,O){w==="input"&&O.type==="radio"&&O.name!=null&&ge(l,O);var G=ph(w,I),Y=ph(w,O);switch(Ix(l,u,G,Y),w){case"input":Ye(l,O);break;case"textarea":Zd(l,O);break;case"select":Dn(l,O);break}}function aA(l){{var u=l.toLowerCase();return Um.hasOwnProperty(u)&&Um[u]||null}}function oA(l,u,w,I,O,G,Y){var oe,fe;switch(oe=ph(u,w),Iy(u,w),u){case"dialog":Ya("cancel",l),Ya("close",l);break;case"iframe":case"object":case"embed":Ya("load",l);break;case"video":case"audio":for(var Oe=0;Oe<Sy.length;Oe++)Ya(Sy[Oe],l);break;case"source":Ya("error",l);break;case"img":case"image":case"link":Ya("error",l),Ya("load",l);break;case"details":Ya("toggle",l);break;case"input":zm(l,w),Ya("invalid",l);break;case"option":la(l,w);break;case"select":kc(l,w),Ya("invalid",l);break;case"textarea":cr(l,w),Ya("invalid",l);break}B_(u,w);{fe=new Set;for(var Ne=l.attributes,ft=0;ft<Ne.length;ft++){var dt=Ne[ft].name.toLowerCase();switch(dt){case"value":break;case"checked":break;case"selected":break;default:fe.add(Ne[ft].name)}}}var Vt=null;for(var jt in w)if(w.hasOwnProperty(jt)){var ii=w[jt];if(jt===Af)typeof ii=="string"?l.textContent!==ii&&(w[Nh]!==!0&&kg(l.textContent,ii,G,Y),Vt=[Af,ii]):typeof ii=="number"&&l.textContent!==""+ii&&(w[Nh]!==!0&&kg(l.textContent,ii,G,Y),Vt=[Af,""+ii]);else if(Gi.hasOwnProperty(jt))ii!=null&&(typeof ii!="function"&&Kp(jt,ii),jt==="onScroll"&&Ya("scroll",l));else if(Y&&typeof oe=="boolean"){var Ji=void 0,Fn=Vr(jt);if(w[Nh]!==!0){if(!(jt===Ry||jt===Nh||jt==="value"||jt==="checked"||jt==="selected")){if(jt===Ay){var Tn=l.innerHTML,ra=ii?ii[Rx]:void 0;if(ra!=null){var Wr=tS(l,ra);Wr!==Tn&&Pg(jt,Tn,Wr)}}else if(jt===Rl){if(fe.delete(jt),eS){var Rt=vp(ii);Ji=l.getAttribute("style"),Rt!==Ji&&Pg(jt,Ji,Rt)}}else if(oe&&!wr)fe.delete(jt.toLowerCase()),Ji=vt(l,jt,ii),ii!==Ji&&Pg(jt,Ji,ii);else if(!da(jt,Fn,oe)&&!Ga(jt,ii,Fn,oe)){var ni=!1;if(Fn!==null)fe.delete(Fn.attributeName),Ji=Ks(l,jt,ii,Fn);else{var It=I;if(It===Ma&&(It=ld(u)),It===Ma)fe.delete(jt.toLowerCase());else{var Ei=aA(jt);Ei!==null&&Ei!==jt&&(ni=!0,fe.delete(Ei)),fe.delete(jt)}Ji=vt(l,jt,ii)}var sn=wr;!sn&&ii!==Ji&&!ni&&Pg(jt,Ji,ii)}}}}}switch(Y&&fe.size>0&&w[Nh]!==!0&&rw(fe),u){case"input":oc(l),zt(l,w,!0);break;case"textarea":oc(l),dh(l);break;case"select":case"option":break;default:typeof w.onClick=="function"&&Dy(l);break}return Vt}function sA(l,u,w){var I=l.nodeValue!==u;return I}function sw(l,u){{if(Is)return;Is=!0,C("Did not expect server HTML to contain a <%s> in <%s>.",u.nodeName.toLowerCase(),l.nodeName.toLowerCase())}}function lw(l,u){{if(Is)return;Is=!0,C('Did not expect server HTML to contain the text node "%s" in <%s>.',u.nodeValue,l.nodeName.toLowerCase())}}function Jp(l,u,w){{if(Is)return;Is=!0,C("Expected server HTML to contain a matching <%s> in <%s>.",u,l.nodeName.toLowerCase())}}function Dx(l,u){{if(u===""||Is)return;Is=!0,C('Expected server HTML to contain a matching text node for "%s" in <%s>.',u,l.nodeName.toLowerCase())}}function oS(l,u,w){switch(u){case"input":Xt(l,w);return;case"textarea":fp(l,w);return;case"select":qn(l,w);return}}var Rf=function(){},Lg=function(){};{var cw=["address","applet","area","article","aside","base","basefont","bgsound","blockquote","body","br","button","caption","center","col","colgroup","dd","details","dir","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","img","input","isindex","li","link","listing","main","marquee","menu","menuitem","meta","nav","noembed","noframes","noscript","object","ol","p","param","plaintext","pre","script","section","select","source","style","summary","table","tbody","td","template","textarea","tfoot","th","thead","title","tr","track","ul","wbr","xmp"],My=["applet","caption","html","table","td","th","marquee","object","template","foreignObject","desc","title"],sS=My.concat(["button"]),lA=["dd","dt","li","option","optgroup","p","rp","rt"],Mx={current:null,formTag:null,aTagInScope:null,buttonTagInScope:null,nobrTagInScope:null,pTagInButtonScope:null,listItemTagAutoclosing:null,dlItemTagAutoclosing:null};Lg=function(l,u){var w=Yt({},l||Mx),I={tag:u};return My.indexOf(u)!==-1&&(w.aTagInScope=null,w.buttonTagInScope=null,w.nobrTagInScope=null),sS.indexOf(u)!==-1&&(w.pTagInButtonScope=null),cw.indexOf(u)!==-1&&u!=="address"&&u!=="div"&&u!=="p"&&(w.listItemTagAutoclosing=null,w.dlItemTagAutoclosing=null),w.current=I,u==="form"&&(w.formTag=I),u==="a"&&(w.aTagInScope=I),u==="button"&&(w.buttonTagInScope=I),u==="nobr"&&(w.nobrTagInScope=I),u==="p"&&(w.pTagInButtonScope=I),u==="li"&&(w.listItemTagAutoclosing=I),(u==="dd"||u==="dt")&&(w.dlItemTagAutoclosing=I),w};var lS=function(l,u){switch(u){case"select":return l==="option"||l==="optgroup"||l==="#text";case"optgroup":return l==="option"||l==="#text";case"option":return l==="#text";case"tr":return l==="th"||l==="td"||l==="style"||l==="script"||l==="template";case"tbody":case"thead":case"tfoot":return l==="tr"||l==="style"||l==="script"||l==="template";case"colgroup":return l==="col"||l==="template";case"table":return l==="caption"||l==="colgroup"||l==="tbody"||l==="tfoot"||l==="thead"||l==="style"||l==="script"||l==="template";case"head":return l==="base"||l==="basefont"||l==="bgsound"||l==="link"||l==="meta"||l==="title"||l==="noscript"||l==="noframes"||l==="style"||l==="script"||l==="template";case"html":return l==="head"||l==="body"||l==="frameset";case"frameset":return l==="frame";case"#document":return l==="html"}switch(l){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return u!=="h1"&&u!=="h2"&&u!=="h3"&&u!=="h4"&&u!=="h5"&&u!=="h6";case"rp":case"rt":return lA.indexOf(u)===-1;case"body":case"caption":case"col":case"colgroup":case"frameset":case"frame":case"head":case"html":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":return u==null}return!0},cS=function(l,u){switch(l){case"address":case"article":case"aside":case"blockquote":case"center":case"details":case"dialog":case"dir":case"div":case"dl":case"fieldset":case"figcaption":case"figure":case"footer":case"header":case"hgroup":case"main":case"menu":case"nav":case"ol":case"p":case"section":case"summary":case"ul":case"pre":case"listing":case"table":case"hr":case"xmp":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return u.pTagInButtonScope;case"form":return u.formTag||u.pTagInButtonScope;case"li":return u.listItemTagAutoclosing;case"dd":case"dt":return u.dlItemTagAutoclosing;case"button":return u.buttonTagInScope;case"a":return u.aTagInScope;case"nobr":return u.nobrTagInScope}return null},Px={};Rf=function(l,u,w){w=w||Mx;var I=w.current,O=I&&I.tag;u!=null&&(l!=null&&C("validateDOMNesting: when childText is passed, childTag should be null"),l="#text");var G=lS(l,O)?null:I,Y=G?null:cS(l,w),oe=G||Y;if(oe){var fe=oe.tag,Oe=!!G+"|"+l+"|"+fe;if(!Px[Oe]){Px[Oe]=!0;var Ne=l,ft="";if(l==="#text"?/\S/.test(u)?Ne="Text nodes":(Ne="Whitespace text nodes",ft=" Make sure you don't have any extra whitespace between tags on each line of your source code."):Ne="<"+l+">",G){var dt="";fe==="table"&&l==="tr"&&(dt+=" Add a <tbody>, <thead> or <tfoot> to your code to match the DOM tree generated by the browser."),C("validateDOMNesting(...): %s cannot appear as a child of <%s>.%s%s",Ne,fe,ft,dt)}else C("validateDOMNesting(...): %s cannot appear as a descendant of <%s>.",Ne,fe)}}}}var zg="suppressHydrationWarning",Py="$",Fg="/$",Oy="$?",ky="$!",cA="style",uw=null,Ox=null;function If(l){var u,w,I=l.nodeType;switch(I){case oo:case Xd:{u=I===oo?"#document":"#fragment";var O=l.documentElement;w=O?O.namespaceURI:pp(null,"");break}default:{var G=I===Pa?l.parentNode:l,Y=G.namespaceURI||null;u=G.tagName,w=pp(Y,u);break}}{var oe=u.toLowerCase(),fe=Lg(null,oe);return{namespace:w,ancestorInfo:fe}}}function uS(l,u,w){{var I=l,O=pp(I.namespace,u),G=Lg(I.ancestorInfo,u);return{namespace:O,ancestorInfo:G}}}function uA(l){return l}function Ly(l){uw=_y(),Ox=YC();var u=null;return wx(!1),u}function zy(l){KC(Ox),wx(uw),uw=null,Ox=null}function kx(l,u,w,I,O){var G;{var Y=I;if(Rf(l,null,Y.ancestorInfo),typeof u.children=="string"||typeof u.children=="number"){var oe=""+u.children,fe=Lg(Y.ancestorInfo,l);Rf(null,oe,fe)}G=Y.namespace}var Oe=Bh(l,u,w,G);return $g(O,Oe),bw(Oe,u),Oe}function Fy(l,u){l.appendChild(u)}function hS(l,u,w,I,O){switch(iA(l,u,w,I),u){case"button":case"input":case"select":case"textarea":return!!w.autoFocus;case"img":return!0;default:return!1}}function dS(l,u,w,I,O,G){{var Y=G;if(typeof I.children!=typeof w.children&&(typeof I.children=="string"||typeof I.children=="number")){var oe=""+I.children,fe=Lg(Y.ancestorInfo,u);Rf(null,oe,fe)}}return nA(l,u,w,I)}function Lx(l,u){return l==="textarea"||l==="noscript"||typeof u.children=="string"||typeof u.children=="number"||typeof u.dangerouslySetInnerHTML=="object"&&u.dangerouslySetInnerHTML!==null&&u.dangerouslySetInnerHTML.__html!=null}function fS(l,u,w,I){{var O=w;Rf(null,l,O.ancestorInfo)}var G=aS(l,u);return $g(I,G),G}function hA(){var l=window.event;return l===void 0?mc:T(l.type)}var hw=typeof setTimeout=="function"?setTimeout:void 0,dw=typeof clearTimeout=="function"?clearTimeout:void 0,Ng=-1,fw=typeof Promise=="function"?Promise:void 0,dA=typeof queueMicrotask=="function"?queueMicrotask:typeof fw<"u"?function(l){return fw.resolve(null).then(l).catch(pS)}:hw;function pS(l){setTimeout(function(){throw l})}function pw(l,u,w,I){switch(u){case"button":case"input":case"select":case"textarea":w.autoFocus&&l.focus();return;case"img":{w.src&&(l.src=w.src);return}}}function mS(l,u,w,I,O,G){rA(l,u,w,I,O),bw(l,O)}function mw(l){Su(l,"")}function gS(l,u,w){l.nodeValue=w}function _S(l,u){l.appendChild(u)}function yS(l,u){var w;l.nodeType===Pa?(w=l.parentNode,w.insertBefore(u,l)):(w=l,w.appendChild(u));var I=l._reactRootContainer;I==null&&w.onclick===null&&Dy(w)}function fA(l,u,w){l.insertBefore(u,w)}function vS(l,u,w){l.nodeType===Pa?l.parentNode.insertBefore(u,w):l.insertBefore(u,w)}function xS(l,u){l.removeChild(u)}function Qp(l,u){l.nodeType===Pa?l.parentNode.removeChild(u):l.removeChild(u)}function zx(l,u){var w=u,I=0;do{var O=w.nextSibling;if(l.removeChild(w),O&&O.nodeType===Pa){var G=O.data;if(G===Fg)if(I===0){l.removeChild(O),qp(u);return}else I--;else(G===Py||G===Oy||G===ky)&&I++}w=O}while(w);qp(u)}function bS(l,u){l.nodeType===Pa?zx(l.parentNode,u):l.nodeType===Jo&&zx(l,u),qp(l)}function wS(l){l=l;var u=l.style;typeof u.setProperty=="function"?u.setProperty("display","none","important"):u.display="none"}function Fx(l){l.nodeValue=""}function pA(l,u){l=l;var w=u[cA],I=w!=null&&w.hasOwnProperty("display")?w.display:null;l.style.display=an("display",I)}function TS(l,u){l.nodeValue=u}function Ny(l){l.nodeType===Jo?l.textContent="":l.nodeType===oo&&l.documentElement&&l.removeChild(l.documentElement)}function SS(l,u,w){return l.nodeType!==Jo||u.toLowerCase()!==l.nodeName.toLowerCase()?null:l}function ES(l,u){return u===""||l.nodeType!==Sa?null:l}function CS(l){return l.nodeType!==Pa?null:l}function gw(l){return l.data===Oy}function _w(l){return l.data===ky}function mA(l){var u=l.nextSibling&&l.nextSibling.dataset,w,I,O;return u&&(w=u.dgst,I=u.msg,O=u.stck),{message:I,digest:w,stack:O}}function AS(l,u){l._reactRetry=u}function Df(l){for(;l!=null;l=l.nextSibling){var u=l.nodeType;if(u===Jo||u===Sa)break;if(u===Pa){var w=l.data;if(w===Py||w===ky||w===Oy)break;if(w===Fg)return null}}return l}function em(l){return Df(l.nextSibling)}function tm(l){return Df(l.firstChild)}function Bg(l){return Df(l.firstChild)}function By(l){return Df(l.nextSibling)}function yw(l,u,w,I,O,G,Y){$g(G,l),bw(l,w);var oe;{var fe=O;oe=fe.namespace}var Oe=(G.mode&Ln)!==Sn;return oA(l,u,w,oe,I,Oe,Y)}function Nx(l,u,w,I){return $g(w,l),w.mode&Ln,sA(l,u)}function gA(l,u){$g(u,l)}function Uy(l){for(var u=l.nextSibling,w=0;u;){if(u.nodeType===Pa){var I=u.data;if(I===Fg){if(w===0)return em(u);w--}else(I===Py||I===ky||I===Oy)&&w++}u=u.nextSibling}return null}function Bx(l){for(var u=l.previousSibling,w=0;u;){if(u.nodeType===Pa){var I=u.data;if(I===Py||I===ky||I===Oy){if(w===0)return u;w--}else I===Fg&&w++}u=u.previousSibling}return null}function Wu(l){qp(l)}function Ug(l){qp(l)}function vw(l){return l!=="head"&&l!=="body"}function Vg(l,u,w,I){var O=!0;kg(u.nodeValue,w,I,O)}function jg(l,u,w,I,O,G){if(u[zg]!==!0){var Y=!0;kg(I.nodeValue,O,G,Y)}}function RS(l,u){u.nodeType===Jo?sw(l,u):u.nodeType===Pa||lw(l,u)}function Ux(l,u){{var w=l.parentNode;w!==null&&(u.nodeType===Jo?sw(w,u):u.nodeType===Pa||lw(w,u))}}function IS(l,u,w,I,O){(O||u[zg]!==!0)&&(I.nodeType===Jo?sw(w,I):I.nodeType===Pa||lw(w,I))}function DS(l,u,w){Jp(l,u)}function _A(l,u){Dx(l,u)}function Vx(l,u,w){{var I=l.parentNode;I!==null&&Jp(I,u)}}function yA(l,u){{var w=l.parentNode;w!==null&&Dx(w,u)}}function Vy(l,u,w,I,O,G){(G||u[zg]!==!0)&&Jp(w,I)}function MS(l,u,w,I,O){(O||u[zg]!==!0)&&Dx(w,I)}function xw(l){C("An error occurred during hydration. The server HTML was replaced with client content in <%s>.",l.nodeName.toLowerCase())}function vA(l){Md(l)}var Pd=Math.random().toString(36).slice(2),Gg="__reactFiber$"+Pd,jx="__reactProps$"+Pd,Hg="__reactContainer$"+Pd,Gx="__reactEvents$"+Pd,xA="__reactListeners$"+Pd,PS="__reactHandles$"+Pd;function bA(l){delete l[Gg],delete l[jx],delete l[Gx],delete l[xA],delete l[PS]}function $g(l,u){u[Gg]=l}function jy(l,u){u[Hg]=l}function Hx(l){l[Hg]=null}function im(l){return!!l[Hg]}function Od(l){var u=l[Gg];if(u)return u;for(var w=l.parentNode;w;){if(u=w[Hg]||w[Gg],u){var I=u.alternate;if(u.child!==null||I!==null&&I.child!==null)for(var O=Bx(l);O!==null;){var G=O[Gg];if(G)return G;O=Bx(O)}return u}l=w,w=l.parentNode}return null}function Jc(l){var u=l[Gg]||l[Hg];return u&&(u.tag===ue||u.tag===pe||u.tag===it||u.tag===K)?u:null}function Wg(l){if(l.tag===ue||l.tag===pe)return l.stateNode;throw new Error("getNodeFromInstance: Invalid argument.")}function $x(l){return l[jx]||null}function bw(l,u){l[jx]=u}function wA(l){var u=l[Gx];return u===void 0&&(u=l[Gx]=new Set),u}var OS={},kS=h.ReactDebugCurrentFrame;function Wx(l){if(l){var u=l._owner,w=Ko(l.type,l._source,u?u.type:null);kS.setExtraStackFrame(w)}else kS.setExtraStackFrame(null)}function Qc(l,u,w,I,O){{var G=Function.call.bind(za);for(var Y in l)if(G(l,Y)){var oe=void 0;try{if(typeof l[Y]!="function"){var fe=Error((I||"React class")+": "+w+" type `"+Y+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof l[Y]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw fe.name="Invariant Violation",fe}oe=l[Y](u,Y,I,w,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(Oe){oe=Oe}oe&&!(oe instanceof Error)&&(Wx(O),C("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",I||"React class",w,Y,typeof oe),Wx(null)),oe instanceof Error&&!(oe.message in OS)&&(OS[oe.message]=!0,Wx(O),C("Failed %s type: %s",w,oe.message),Wx(null))}}}var qx=[],nm;nm=[];var al=-1;function Uh(l){return{current:l}}function Vs(l,u){if(al<0){C("Unexpected pop.");return}u!==nm[al]&&C("Unexpected Fiber popped."),l.current=qx[al],qx[al]=null,nm[al]=null,al--}function js(l,u,w){al++,qx[al]=l.current,nm[al]=w,l.current=u}var qg;qg={};var ol={};Object.freeze(ol);var qu=Uh(ol),sl=Uh(!1),Mf=ol;function kd(l,u,w){return w&&eu(u)?Mf:qu.current}function ww(l,u,w){{var I=l.stateNode;I.__reactInternalMemoizedUnmaskedChildContext=u,I.__reactInternalMemoizedMaskedChildContext=w}}function Vh(l,u){{var w=l.type,I=w.contextTypes;if(!I)return ol;var O=l.stateNode;if(O&&O.__reactInternalMemoizedUnmaskedChildContext===u)return O.__reactInternalMemoizedMaskedChildContext;var G={};for(var Y in I)G[Y]=u[Y];{var oe=pn(l)||"Unknown";Qc(I,G,"context",oe)}return O&&ww(l,u,G),G}}function Zx(){return sl.current}function eu(l){{var u=l.childContextTypes;return u!=null}}function rm(l){Vs(sl,l),Vs(qu,l)}function Gy(l){Vs(sl,l),Vs(qu,l)}function Pf(l,u,w){{if(qu.current!==ol)throw new Error("Unexpected context found on stack. This error is likely caused by a bug in React. Please file an issue.");js(qu,u,l),js(sl,w,l)}}function Xx(l,u,w){{var I=l.stateNode,O=u.childContextTypes;if(typeof I.getChildContext!="function"){{var G=pn(l)||"Unknown";qg[G]||(qg[G]=!0,C("%s.childContextTypes is specified but there is no getChildContext() method on the instance. You can either define getChildContext() on %s or remove childContextTypes from it.",G,G))}return w}var Y=I.getChildContext();for(var oe in Y)if(!(oe in O))throw new Error((pn(l)||"Unknown")+'.getChildContext(): key "'+oe+'" is not defined in childContextTypes.');{var fe=pn(l)||"Unknown";Qc(O,Y,"child context",fe)}return Yt({},w,Y)}}function Yx(l){{var u=l.stateNode,w=u&&u.__reactInternalMemoizedMergedChildContext||ol;return Mf=qu.current,js(qu,w,l),js(sl,sl.current,l),!0}}function Tw(l,u,w){{var I=l.stateNode;if(!I)throw new Error("Expected to have an instance by this point. This error is likely caused by a bug in React. Please file an issue.");if(w){var O=Xx(l,u,Mf);I.__reactInternalMemoizedMergedChildContext=O,Vs(sl,l),Vs(qu,l),js(qu,O,l),js(sl,w,l)}else Vs(sl,l),js(sl,w,l)}}function TA(l){{if(!Fb(l)||l.tag!==N)throw new Error("Expected subtree parent to be a mounted class component. This error is likely caused by a bug in React. Please file an issue.");var u=l;do{switch(u.tag){case K:return u.stateNode.context;case N:{var w=u.type;if(eu(w))return u.stateNode.__reactInternalMemoizedMergedChildContext;break}}u=u.return}while(u!==null);throw new Error("Found unexpected detached subtree parent. This error is likely caused by a bug in React. Please file an issue.")}}var Of=0,Kx=1,Zu=null,Sw=!1,Jx=!1;function LS(l){Zu===null?Zu=[l]:Zu.push(l)}function zS(l){Sw=!0,LS(l)}function FS(){Sw&&kf()}function kf(){if(!Jx&&Zu!==null){Jx=!0;var l=0,u=$l();try{var w=!0,I=Zu;for(Co(Es);l<I.length;l++){var O=I[l];do O=O(w);while(O!==null)}Zu=null,Sw=!1}catch(G){throw Zu!==null&&(Zu=Zu.slice(l+1)),X_(Gc,kf),G}finally{Co(u),Jx=!1}}return null}var am=[],Zg=0,Qx=null,e0=0,tu=[],iu=0,Lf=null,nu=1,Ld="";function NS(l){return sm(),(l.flags&rf)!==Mn}function Ew(l){return sm(),e0}function BS(){var l=Ld,u=nu,w=u&~SA(u);return w.toString(32)+l}function om(l,u){sm(),am[Zg++]=e0,am[Zg++]=Qx,Qx=l,e0=u}function Cw(l,u,w){sm(),tu[iu++]=nu,tu[iu++]=Ld,tu[iu++]=Lf,Lf=l;var I=nu,O=Ld,G=i0(I)-1,Y=I&~(1<<G),oe=w+1,fe=i0(u)+G;if(fe>30){var Oe=G-G%5,Ne=(1<<Oe)-1,ft=(Y&Ne).toString(32),dt=Y>>Oe,Vt=G-Oe,jt=i0(u)+Vt,ii=oe<<Vt,Ji=ii|dt,Fn=ft+O;nu=1<<jt|Ji,Ld=Fn}else{var Tn=oe<<G,ra=Tn|Y,Wr=O;nu=1<<fe|ra,Ld=Wr}}function t0(l){sm();var u=l.return;if(u!==null){var w=1,I=0;om(l,w),Cw(l,w,I)}}function i0(l){return 32-pg(l)}function SA(l){return 1<<i0(l)-1}function Aw(l){for(;l===Qx;)Qx=am[--Zg],am[Zg]=null,e0=am[--Zg],am[Zg]=null;for(;l===Lf;)Lf=tu[--iu],tu[iu]=null,Ld=tu[--iu],tu[iu]=null,nu=tu[--iu],tu[iu]=null}function EA(){return sm(),Lf!==null?{id:nu,overflow:Ld}:null}function CA(l,u){sm(),tu[iu++]=nu,tu[iu++]=Ld,tu[iu++]=Lf,nu=u.id,Ld=u.overflow,Lf=l}function sm(){Ds()||C("Expected to be hydrating. This is a bug in React. Please file an issue.")}var Gs=null,gc=null,Xu=!1,lm=!1,zf=null;function Rw(){Xu&&C("We should not be hydrating here. This is a bug in React. Please file a bug.")}function n0(){lm=!0}function US(){return lm}function VS(l){var u=l.stateNode.containerInfo;return gc=Bg(u),Gs=l,Xu=!0,zf=null,lm=!1,!0}function jS(l,u,w){return gc=By(u),Gs=l,Xu=!0,zf=null,lm=!1,w!==null&&CA(l,w),!0}function Iw(l,u){switch(l.tag){case K:{RS(l.stateNode.containerInfo,u);break}case ue:{var w=(l.mode&Ln)!==Sn;IS(l.type,l.memoizedProps,l.stateNode,u,w);break}case it:{var I=l.memoizedState;I.dehydrated!==null&&Ux(I.dehydrated,u);break}}}function Dw(l,u){Iw(l,u);var w=gL();w.stateNode=u,w.return=l;var I=l.deletions;I===null?(l.deletions=[w],l.flags|=_h):I.push(w)}function r0(l,u){{if(lm)return;switch(l.tag){case K:{var w=l.stateNode.containerInfo;switch(u.tag){case ue:var I=u.type;u.pendingProps,DS(w,I);break;case pe:var O=u.pendingProps;_A(w,O);break}break}case ue:{var G=l.type,Y=l.memoizedProps,oe=l.stateNode;switch(u.tag){case ue:{var fe=u.type,Oe=u.pendingProps,Ne=(l.mode&Ln)!==Sn;Vy(G,Y,oe,fe,Oe,Ne);break}case pe:{var ft=u.pendingProps,dt=(l.mode&Ln)!==Sn;MS(G,Y,oe,ft,dt);break}}break}case it:{var Vt=l.memoizedState,jt=Vt.dehydrated;if(jt!==null)switch(u.tag){case ue:var ii=u.type;u.pendingProps,Vx(jt,ii);break;case pe:var Ji=u.pendingProps;yA(jt,Ji);break}break}default:return}}}function Mw(l,u){u.flags=u.flags&~Vc|so,r0(l,u)}function Pw(l,u){switch(l.tag){case ue:{var w=l.type;l.pendingProps;var I=SS(u,w);return I!==null?(l.stateNode=I,Gs=l,gc=tm(I),!0):!1}case pe:{var O=l.pendingProps,G=ES(u,O);return G!==null?(l.stateNode=G,Gs=l,gc=null,!0):!1}case it:{var Y=CS(u);if(Y!==null){var oe={dehydrated:Y,treeContext:EA(),retryLane:wl};l.memoizedState=oe;var fe=_L(Y);return fe.return=l,l.child=fe,Gs=l,gc=null,!0}return!1}default:return!1}}function Hy(l){return(l.mode&Ln)!==Sn&&(l.flags&Hr)===Mn}function a0(l){throw new Error("Hydration failed because the initial UI does not match what was rendered on the server.")}function Ow(l){if(Xu){var u=gc;if(!u){Hy(l)&&(r0(Gs,l),a0()),Mw(Gs,l),Xu=!1,Gs=l;return}var w=u;if(!Pw(l,u)){Hy(l)&&(r0(Gs,l),a0()),u=em(w);var I=Gs;if(!u||!Pw(l,u)){Mw(Gs,l),Xu=!1,Gs=l;return}Dw(I,w)}}}function $y(l,u,w){var I=l.stateNode,O=!lm,G=yw(I,l.type,l.memoizedProps,u,w,l,O);return l.updateQueue=G,G!==null}function GS(l){var u=l.stateNode,w=l.memoizedProps,I=Nx(u,w,l);if(I){var O=Gs;if(O!==null)switch(O.tag){case K:{var G=O.stateNode.containerInfo,Y=(O.mode&Ln)!==Sn;Vg(G,u,w,Y);break}case ue:{var oe=O.type,fe=O.memoizedProps,Oe=O.stateNode,Ne=(O.mode&Ln)!==Sn;jg(oe,fe,Oe,u,w,Ne);break}}}return I}function AA(l){var u=l.memoizedState,w=u!==null?u.dehydrated:null;if(!w)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");gA(w,l)}function RA(l){var u=l.memoizedState,w=u!==null?u.dehydrated:null;if(!w)throw new Error("Expected to have a hydrated suspense instance. This error is likely caused by a bug in React. Please file an issue.");return Uy(w)}function HS(l){for(var u=l.return;u!==null&&u.tag!==ue&&u.tag!==K&&u.tag!==it;)u=u.return;Gs=u}function o0(l){if(l!==Gs)return!1;if(!Xu)return HS(l),Xu=!0,!1;if(l.tag!==K&&(l.tag!==ue||vw(l.type)&&!Lx(l.type,l.memoizedProps))){var u=gc;if(u)if(Hy(l))$S(l),a0();else for(;u;)Dw(l,u),u=em(u)}return HS(l),l.tag===it?gc=RA(l):gc=Gs?em(l.stateNode):null,!0}function IA(){return Xu&&gc!==null}function $S(l){for(var u=gc;u;)Iw(l,u),u=em(u)}function Xg(){Gs=null,gc=null,Xu=!1,lm=!1}function WS(){zf!==null&&(yD(zf),zf=null)}function Ds(){return Xu}function kw(l){zf===null?zf=[l]:zf.push(l)}var zo=h.ReactCurrentBatchConfig,DA=null;function Wy(){return zo.transition}var Yu={recordUnsafeLifecycleWarnings:function(l,u){},flushPendingUnsafeLifecycleWarnings:function(){},recordLegacyContextWarning:function(l,u){},flushLegacyContextWarning:function(){},discardPendingWarnings:function(){}};{var MA=function(l){for(var u=null,w=l;w!==null;)w.mode&lo&&(u=w),w=w.return;return u},zd=function(l){var u=[];return l.forEach(function(w){u.push(w)}),u.sort().join(", ")},Yg=[],Kg=[],Ff=[],jh=[],Jg=[],qy=[],cm=new Set;Yu.recordUnsafeLifecycleWarnings=function(l,u){cm.has(l.type)||(typeof u.componentWillMount=="function"&&u.componentWillMount.__suppressDeprecationWarning!==!0&&Yg.push(l),l.mode&lo&&typeof u.UNSAFE_componentWillMount=="function"&&Kg.push(l),typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps.__suppressDeprecationWarning!==!0&&Ff.push(l),l.mode&lo&&typeof u.UNSAFE_componentWillReceiveProps=="function"&&jh.push(l),typeof u.componentWillUpdate=="function"&&u.componentWillUpdate.__suppressDeprecationWarning!==!0&&Jg.push(l),l.mode&lo&&typeof u.UNSAFE_componentWillUpdate=="function"&&qy.push(l))},Yu.flushPendingUnsafeLifecycleWarnings=function(){var l=new Set;Yg.length>0&&(Yg.forEach(function(dt){l.add(pn(dt)||"Component"),cm.add(dt.type)}),Yg=[]);var u=new Set;Kg.length>0&&(Kg.forEach(function(dt){u.add(pn(dt)||"Component"),cm.add(dt.type)}),Kg=[]);var w=new Set;Ff.length>0&&(Ff.forEach(function(dt){w.add(pn(dt)||"Component"),cm.add(dt.type)}),Ff=[]);var I=new Set;jh.length>0&&(jh.forEach(function(dt){I.add(pn(dt)||"Component"),cm.add(dt.type)}),jh=[]);var O=new Set;Jg.length>0&&(Jg.forEach(function(dt){O.add(pn(dt)||"Component"),cm.add(dt.type)}),Jg=[]);var G=new Set;if(qy.length>0&&(qy.forEach(function(dt){G.add(pn(dt)||"Component"),cm.add(dt.type)}),qy=[]),u.size>0){var Y=zd(u);C(`Using UNSAFE_componentWillMount in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move code with side effects to componentDidMount, and set initial state in the constructor.

Please update the following components: %s`,Y)}if(I.size>0){var oe=zd(I);C(`Using UNSAFE_componentWillReceiveProps in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state

Please update the following components: %s`,oe)}if(G.size>0){var fe=zd(G);C(`Using UNSAFE_componentWillUpdate in strict mode is not recommended and may indicate bugs in your code. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.

Please update the following components: %s`,fe)}if(l.size>0){var Oe=zd(l);E(`componentWillMount has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move code with side effects to componentDidMount, and set initial state in the constructor.
* Rename componentWillMount to UNSAFE_componentWillMount to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,Oe)}if(w.size>0){var Ne=zd(w);E(`componentWillReceiveProps has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* If you're updating state whenever props change, refactor your code to use memoization techniques or move it to static getDerivedStateFromProps. Learn more at: https://reactjs.org/link/derived-state
* Rename componentWillReceiveProps to UNSAFE_componentWillReceiveProps to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,Ne)}if(O.size>0){var ft=zd(O);E(`componentWillUpdate has been renamed, and is not recommended for use. See https://reactjs.org/link/unsafe-component-lifecycles for details.

* Move data fetching code or side effects to componentDidUpdate.
* Rename componentWillUpdate to UNSAFE_componentWillUpdate to suppress this warning in non-strict mode. In React 18.x, only the UNSAFE_ name will work. To rename all deprecated lifecycles to their new names, you can run \`npx react-codemod rename-unsafe-lifecycles\` in your project source folder.

Please update the following components: %s`,ft)}};var s0=new Map,qS=new Set;Yu.recordLegacyContextWarning=function(l,u){var w=MA(l);if(w===null){C("Expected to find a StrictMode component in a strict mode tree. This error is likely caused by a bug in React. Please file an issue.");return}if(!qS.has(l.type)){var I=s0.get(w);(l.type.contextTypes!=null||l.type.childContextTypes!=null||u!==null&&typeof u.getChildContext=="function")&&(I===void 0&&(I=[],s0.set(w,I)),I.push(l))}},Yu.flushLegacyContextWarning=function(){s0.forEach(function(l,u){if(l.length!==0){var w=l[0],I=new Set;l.forEach(function(G){I.add(pn(G)||"Component"),qS.add(G.type)});var O=zd(I);try{fa(w),C(`Legacy context API has been detected within a strict-mode tree.

The old API will be supported in all 16.x releases, but applications using it should migrate to the new version.

Please update the following components: %s

Learn more about this warning here: https://reactjs.org/link/legacy-context`,O)}finally{Ba()}}})},Yu.discardPendingWarnings=function(){Yg=[],Kg=[],Ff=[],jh=[],Jg=[],qy=[],s0=new Map}}var Lw,zw,Fw,Nw,Bw,l0=function(l,u){};Lw=!1,zw=!1,Fw={},Nw={},Bw={},l0=function(l,u){if(!(l===null||typeof l!="object")&&!(!l._store||l._store.validated||l.key!=null)){if(typeof l._store!="object")throw new Error("React Component in warnForMissingKey should have a _store. This error is likely caused by a bug in React. Please file an issue.");l._store.validated=!0;var w=pn(u)||"Component";Nw[w]||(Nw[w]=!0,C('Each child in a list should have a unique "key" prop. See https://reactjs.org/link/warning-keys for more information.'))}};function PA(l){return l.prototype&&l.prototype.isReactComponent}function Zy(l,u,w){var I=w.ref;if(I!==null&&typeof I!="function"&&typeof I!="object"){if((l.mode&lo||Jn)&&!(w._owner&&w._self&&w._owner.stateNode!==w._self)&&!(w._owner&&w._owner.tag!==N)&&!(typeof w.type=="function"&&!PA(w.type))&&w._owner){var O=pn(l)||"Component";Fw[O]||(C('Component "%s" contains the string ref "%s". Support for string refs will be removed in a future major release. We recommend using useRef() or createRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref',O,I),Fw[O]=!0)}if(w._owner){var G=w._owner,Y;if(G){var oe=G;if(oe.tag!==N)throw new Error("Function components cannot have string refs. We recommend using useRef() instead. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-string-ref");Y=oe.stateNode}if(!Y)throw new Error("Missing owner for string ref "+I+". This error is likely caused by a bug in React. Please file an issue.");var fe=Y;Pr(I,"ref");var Oe=""+I;if(u!==null&&u.ref!==null&&typeof u.ref=="function"&&u.ref._stringRef===Oe)return u.ref;var Ne=function(ft){var dt=fe.refs;ft===null?delete dt[Oe]:dt[Oe]=ft};return Ne._stringRef=Oe,Ne}else{if(typeof I!="string")throw new Error("Expected ref to be a function, a string, an object returned by React.createRef(), or null.");if(!w._owner)throw new Error("Element ref was specified as a string ("+I+`) but no owner was set. This could happen for one of the following reasons:
1. You may be adding a ref to a function component
2. You may be adding a ref to a component that was not created inside a component's render method
3. You have multiple copies of React loaded
See https://reactjs.org/link/refs-must-have-owner for more information.`)}}return I}function c0(l,u){var w=Object.prototype.toString.call(u);throw new Error("Objects are not valid as a React child (found: "+(w==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":w)+"). If you meant to render a collection of children, use an array instead.")}function Xy(l){{var u=pn(l)||"Component";if(Bw[u])return;Bw[u]=!0,C("Functions are not valid as a React child. This may happen if you return a Component instead of <Component /> from render. Or maybe you meant to call this function rather than return it.")}}function ll(l){var u=l._payload,w=l._init;return w(u)}function Qg(l){function u(Rt,ni){if(l){var It=Rt.deletions;It===null?(Rt.deletions=[ni],Rt.flags|=_h):It.push(ni)}}function w(Rt,ni){if(!l)return null;for(var It=ni;It!==null;)u(Rt,It),It=It.sibling;return null}function I(Rt,ni){for(var It=new Map,Ei=ni;Ei!==null;)Ei.key!==null?It.set(Ei.key,Ei):It.set(Ei.index,Ei),Ei=Ei.sibling;return It}function O(Rt,ni){var It=Ov(Rt,ni);return It.index=0,It.sibling=null,It}function G(Rt,ni,It){if(Rt.index=It,!l)return Rt.flags|=rf,ni;var Ei=Rt.alternate;if(Ei!==null){var sn=Ei.index;return sn<ni?(Rt.flags|=so,ni):sn}else return Rt.flags|=so,ni}function Y(Rt){return l&&Rt.alternate===null&&(Rt.flags|=so),Rt}function oe(Rt,ni,It,Ei){if(ni===null||ni.tag!==pe){var sn=CR(It,Rt.mode,Ei);return sn.return=Rt,sn}else{var nn=O(ni,It);return nn.return=Rt,nn}}function fe(Rt,ni,It,Ei){var sn=It.type;if(sn===cn)return Ne(Rt,ni,It.props.children,Ei,It.key);if(ni!==null&&(ni.elementType===sn||kD(ni,It)||typeof sn=="object"&&sn!==null&&sn.$$typeof===ye&&ll(sn)===ni.type)){var nn=O(ni,It.props);return nn.ref=Zy(Rt,ni,It),nn.return=Rt,nn._debugSource=It._source,nn._debugOwner=It._owner,nn}var sr=ER(It,Rt.mode,Ei);return sr.ref=Zy(Rt,ni,It),sr.return=Rt,sr}function Oe(Rt,ni,It,Ei){if(ni===null||ni.tag!==ne||ni.stateNode.containerInfo!==It.containerInfo||ni.stateNode.implementation!==It.implementation){var sn=AR(It,Rt.mode,Ei);return sn.return=Rt,sn}else{var nn=O(ni,It.children||[]);return nn.return=Rt,nn}}function Ne(Rt,ni,It,Ei,sn){if(ni===null||ni.tag!==xe){var nn=C_(It,Rt.mode,Ei,sn);return nn.return=Rt,nn}else{var sr=O(ni,It);return sr.return=Rt,sr}}function ft(Rt,ni,It){if(typeof ni=="string"&&ni!==""||typeof ni=="number"){var Ei=CR(""+ni,Rt.mode,It);return Ei.return=Rt,Ei}if(typeof ni=="object"&&ni!==null){switch(ni.$$typeof){case Go:{var sn=ER(ni,Rt.mode,It);return sn.ref=Zy(Rt,null,ni),sn.return=Rt,sn}case Mo:{var nn=AR(ni,Rt.mode,It);return nn.return=Rt,nn}case ye:{var sr=ni._payload,vr=ni._init;return ft(Rt,vr(sr),It)}}if(Sr(ni)||_i(ni)){var $a=C_(ni,Rt.mode,It,null);return $a.return=Rt,$a}c0(Rt,ni)}return typeof ni=="function"&&Xy(Rt),null}function dt(Rt,ni,It,Ei){var sn=ni!==null?ni.key:null;if(typeof It=="string"&&It!==""||typeof It=="number")return sn!==null?null:oe(Rt,ni,""+It,Ei);if(typeof It=="object"&&It!==null){switch(It.$$typeof){case Go:return It.key===sn?fe(Rt,ni,It,Ei):null;case Mo:return It.key===sn?Oe(Rt,ni,It,Ei):null;case ye:{var nn=It._payload,sr=It._init;return dt(Rt,ni,sr(nn),Ei)}}if(Sr(It)||_i(It))return sn!==null?null:Ne(Rt,ni,It,Ei,null);c0(Rt,It)}return typeof It=="function"&&Xy(Rt),null}function Vt(Rt,ni,It,Ei,sn){if(typeof Ei=="string"&&Ei!==""||typeof Ei=="number"){var nn=Rt.get(It)||null;return oe(ni,nn,""+Ei,sn)}if(typeof Ei=="object"&&Ei!==null){switch(Ei.$$typeof){case Go:{var sr=Rt.get(Ei.key===null?It:Ei.key)||null;return fe(ni,sr,Ei,sn)}case Mo:{var vr=Rt.get(Ei.key===null?It:Ei.key)||null;return Oe(ni,vr,Ei,sn)}case ye:var $a=Ei._payload,xa=Ei._init;return Vt(Rt,ni,It,xa($a),sn)}if(Sr(Ei)||_i(Ei)){var _s=Rt.get(It)||null;return Ne(ni,_s,Ei,sn,null)}c0(ni,Ei)}return typeof Ei=="function"&&Xy(ni),null}function jt(Rt,ni,It){{if(typeof Rt!="object"||Rt===null)return ni;switch(Rt.$$typeof){case Go:case Mo:l0(Rt,It);var Ei=Rt.key;if(typeof Ei!="string")break;if(ni===null){ni=new Set,ni.add(Ei);break}if(!ni.has(Ei)){ni.add(Ei);break}C("Encountered two children with the same key, `%s`. Keys should be unique so that components maintain their identity across updates. Non-unique keys may cause children to be duplicated and/or omitted  the behavior is unsupported and could change in a future version.",Ei);break;case ye:var sn=Rt._payload,nn=Rt._init;jt(nn(sn),ni,It);break}}return ni}function ii(Rt,ni,It,Ei){for(var sn=null,nn=0;nn<It.length;nn++){var sr=It[nn];sn=jt(sr,sn,Rt)}for(var vr=null,$a=null,xa=ni,_s=0,ba=0,ns=null;xa!==null&&ba<It.length;ba++){xa.index>ba?(ns=xa,xa=null):ns=xa.sibling;var Kl=dt(Rt,xa,It[ba],Ei);if(Kl===null){xa===null&&(xa=ns);break}l&&xa&&Kl.alternate===null&&u(Rt,xa),_s=G(Kl,_s,ba),$a===null?vr=Kl:$a.sibling=Kl,$a=Kl,xa=ns}if(ba===It.length){if(w(Rt,xa),Ds()){var Pl=ba;om(Rt,Pl)}return vr}if(xa===null){for(;ba<It.length;ba++){var oh=ft(Rt,It[ba],Ei);oh!==null&&(_s=G(oh,_s,ba),$a===null?vr=oh:$a.sibling=oh,$a=oh)}if(Ds()){var Ec=ba;om(Rt,Ec)}return vr}for(var Cc=I(Rt,xa);ba<It.length;ba++){var Jl=Vt(Cc,Rt,ba,It[ba],Ei);Jl!==null&&(l&&Jl.alternate!==null&&Cc.delete(Jl.key===null?ba:Jl.key),_s=G(Jl,_s,ba),$a===null?vr=Jl:$a.sibling=Jl,$a=Jl)}if(l&&Cc.forEach(function(fb){return u(Rt,fb)}),Ds()){var Im=ba;om(Rt,Im)}return vr}function Ji(Rt,ni,It,Ei){var sn=_i(It);if(typeof sn!="function")throw new Error("An object is not an iterable. This error is likely caused by a bug in React. Please file an issue.");{typeof Symbol=="function"&&It[Symbol.toStringTag]==="Generator"&&(zw||C("Using Generators as children is unsupported and will likely yield unexpected results because enumerating a generator mutates it. You may convert it to an array with `Array.from()` or the `[...spread]` operator before rendering. Keep in mind you might need to polyfill these features for older browsers."),zw=!0),It.entries===sn&&(Lw||C("Using Maps as children is not supported. Use an array of keyed ReactElements instead."),Lw=!0);var nn=sn.call(It);if(nn)for(var sr=null,vr=nn.next();!vr.done;vr=nn.next()){var $a=vr.value;sr=jt($a,sr,Rt)}}var xa=sn.call(It);if(xa==null)throw new Error("An iterable object provided no iterator.");for(var _s=null,ba=null,ns=ni,Kl=0,Pl=0,oh=null,Ec=xa.next();ns!==null&&!Ec.done;Pl++,Ec=xa.next()){ns.index>Pl?(oh=ns,ns=null):oh=ns.sibling;var Cc=dt(Rt,ns,Ec.value,Ei);if(Cc===null){ns===null&&(ns=oh);break}l&&ns&&Cc.alternate===null&&u(Rt,ns),Kl=G(Cc,Kl,Pl),ba===null?_s=Cc:ba.sibling=Cc,ba=Cc,ns=oh}if(Ec.done){if(w(Rt,ns),Ds()){var Jl=Pl;om(Rt,Jl)}return _s}if(ns===null){for(;!Ec.done;Pl++,Ec=xa.next()){var Im=ft(Rt,Ec.value,Ei);Im!==null&&(Kl=G(Im,Kl,Pl),ba===null?_s=Im:ba.sibling=Im,ba=Im)}if(Ds()){var fb=Pl;om(Rt,fb)}return _s}for(var j1=I(Rt,ns);!Ec.done;Pl++,Ec=xa.next()){var tp=Vt(j1,Rt,Pl,Ec.value,Ei);tp!==null&&(l&&tp.alternate!==null&&j1.delete(tp.key===null?Pl:tp.key),Kl=G(tp,Kl,Pl),ba===null?_s=tp:ba.sibling=tp,ba=tp)}if(l&&j1.forEach(function(ZL){return u(Rt,ZL)}),Ds()){var qL=Pl;om(Rt,qL)}return _s}function Fn(Rt,ni,It,Ei){if(ni!==null&&ni.tag===pe){w(Rt,ni.sibling);var sn=O(ni,It);return sn.return=Rt,sn}w(Rt,ni);var nn=CR(It,Rt.mode,Ei);return nn.return=Rt,nn}function Tn(Rt,ni,It,Ei){for(var sn=It.key,nn=ni;nn!==null;){if(nn.key===sn){var sr=It.type;if(sr===cn){if(nn.tag===xe){w(Rt,nn.sibling);var vr=O(nn,It.props.children);return vr.return=Rt,vr._debugSource=It._source,vr._debugOwner=It._owner,vr}}else if(nn.elementType===sr||kD(nn,It)||typeof sr=="object"&&sr!==null&&sr.$$typeof===ye&&ll(sr)===nn.type){w(Rt,nn.sibling);var $a=O(nn,It.props);return $a.ref=Zy(Rt,nn,It),$a.return=Rt,$a._debugSource=It._source,$a._debugOwner=It._owner,$a}w(Rt,nn);break}else u(Rt,nn);nn=nn.sibling}if(It.type===cn){var xa=C_(It.props.children,Rt.mode,Ei,It.key);return xa.return=Rt,xa}else{var _s=ER(It,Rt.mode,Ei);return _s.ref=Zy(Rt,ni,It),_s.return=Rt,_s}}function ra(Rt,ni,It,Ei){for(var sn=It.key,nn=ni;nn!==null;){if(nn.key===sn)if(nn.tag===ne&&nn.stateNode.containerInfo===It.containerInfo&&nn.stateNode.implementation===It.implementation){w(Rt,nn.sibling);var sr=O(nn,It.children||[]);return sr.return=Rt,sr}else{w(Rt,nn);break}else u(Rt,nn);nn=nn.sibling}var vr=AR(It,Rt.mode,Ei);return vr.return=Rt,vr}function Wr(Rt,ni,It,Ei){var sn=typeof It=="object"&&It!==null&&It.type===cn&&It.key===null;if(sn&&(It=It.props.children),typeof It=="object"&&It!==null){switch(It.$$typeof){case Go:return Y(Tn(Rt,ni,It,Ei));case Mo:return Y(ra(Rt,ni,It,Ei));case ye:var nn=It._payload,sr=It._init;return Wr(Rt,ni,sr(nn),Ei)}if(Sr(It))return ii(Rt,ni,It,Ei);if(_i(It))return Ji(Rt,ni,It,Ei);c0(Rt,It)}return typeof It=="string"&&It!==""||typeof It=="number"?Y(Fn(Rt,ni,""+It,Ei)):(typeof It=="function"&&Xy(Rt),w(Rt,ni))}return Wr}var Ku=Qg(!0),u0=Qg(!1);function h0(l,u){if(l!==null&&u.child!==l.child)throw new Error("Resuming work not yet implemented.");if(u.child!==null){var w=u.child,I=Ov(w,w.pendingProps);for(u.child=I,I.return=u;w.sibling!==null;)w=w.sibling,I=I.sibling=Ov(w,w.pendingProps),I.return=u;I.sibling=null}}function OA(l,u){for(var w=l.child;w!==null;)hL(w,u),w=w.sibling}var d0=Uh(null),f0;f0={};var p0=null,um=null,m0=null,e_=!1;function Yy(){p0=null,um=null,m0=null,e_=!1}function Uw(){e_=!0}function Ky(){e_=!1}function g0(l,u,w){js(d0,u._currentValue,l),u._currentValue=w,u._currentRenderer!==void 0&&u._currentRenderer!==null&&u._currentRenderer!==f0&&C("Detected multiple renderers concurrently rendering the same context provider. This is currently unsupported."),u._currentRenderer=f0}function _0(l,u){var w=d0.current;Vs(d0,u),l._currentValue=w}function y0(l,u,w){for(var I=l;I!==null;){var O=I.alternate;if(pc(I.childLanes,u)?O!==null&&!pc(O.childLanes,u)&&(O.childLanes=fr(O.childLanes,u)):(I.childLanes=fr(I.childLanes,u),O!==null&&(O.childLanes=fr(O.childLanes,u))),I===w)break;I=I.return}I!==w&&C("Expected to find the propagation root when scheduling context work. This error is likely caused by a bug in React. Please file an issue.")}function ZS(l,u,w){Ju(l,u,w)}function Ju(l,u,w){var I=l.child;for(I!==null&&(I.return=l);I!==null;){var O=void 0,G=I.dependencies;if(G!==null){O=I.child;for(var Y=G.firstContext;Y!==null;){if(Y.context===u){if(I.tag===N){var oe=Dh(w),fe=th(gn,oe);fe.tag=Bf;var Oe=I.updateQueue;if(Oe!==null){var Ne=Oe.shared,ft=Ne.pending;ft===null?fe.next=fe:(fe.next=ft.next,ft.next=fe),Ne.pending=fe}}I.lanes=fr(I.lanes,w);var dt=I.alternate;dt!==null&&(dt.lanes=fr(dt.lanes,w)),y0(I.return,w,l),G.lanes=fr(G.lanes,w);break}Y=Y.next}}else if(I.tag===Be)O=I.type===l.type?null:I.child;else if(I.tag===Ui){var Vt=I.return;if(Vt===null)throw new Error("We just came from a parent so we must have had a parent. This is a bug in React.");Vt.lanes=fr(Vt.lanes,w);var jt=Vt.alternate;jt!==null&&(jt.lanes=fr(jt.lanes,w)),y0(Vt,w,l),O=I.sibling}else O=I.child;if(O!==null)O.return=I;else for(O=I;O!==null;){if(O===l){O=null;break}var ii=O.sibling;if(ii!==null){ii.return=O.return,O=ii;break}O=O.return}I=O}}function Qu(l,u){p0=l,um=null,m0=null;var w=l.dependencies;if(w!==null){var I=w.firstContext;I!==null&&(ar(w.lanes,u)&&ee(),w.firstContext=null)}}function Fo(l){e_&&C("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");var u=l._currentValue;if(m0!==l){var w={context:l,memoizedValue:u,next:null};if(um===null){if(p0===null)throw new Error("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().");um=w,p0.dependencies={lanes:mi,firstContext:w}}else um=um.next=w}return u}var ru=null;function eh(l){ru===null?ru=[l]:ru.push(l)}function XS(){if(ru!==null){for(var l=0;l<ru.length;l++){var u=ru[l],w=u.interleaved;if(w!==null){u.interleaved=null;var I=w.next,O=u.pending;if(O!==null){var G=O.next;O.next=I,w.next=G}u.pending=w}}ru=null}}function Vw(l,u,w,I){var O=u.interleaved;return O===null?(w.next=w,eh(u)):(w.next=O.next,O.next=w),u.interleaved=w,Jy(l,I)}function YS(l,u,w,I){var O=u.interleaved;O===null?(w.next=w,eh(u)):(w.next=O.next,O.next=w),u.interleaved=w}function KS(l,u,w,I){var O=u.interleaved;return O===null?(w.next=w,eh(u)):(w.next=O.next,O.next=w),u.interleaved=w,Jy(l,I)}function Xl(l,u){return Jy(l,u)}var kA=Jy;function Jy(l,u){l.lanes=fr(l.lanes,u);var w=l.alternate;w!==null&&(w.lanes=fr(w.lanes,u)),w===null&&(l.flags&(so|Vc))!==Mn&&DD(l);for(var I=l,O=l.return;O!==null;)O.childLanes=fr(O.childLanes,u),w=O.alternate,w!==null?w.childLanes=fr(w.childLanes,u):(O.flags&(so|Vc))!==Mn&&DD(l),I=O,O=O.return;if(I.tag===K){var G=I.stateNode;return G}else return null}var jw=0,Nf=1,Bf=2,Qy=3,ev=!1,hm,tv;hm=!1,tv=null;function v0(l){var u={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:mi},effects:null};l.updateQueue=u}function au(l,u){var w=u.updateQueue,I=l.updateQueue;if(w===I){var O={baseState:I.baseState,firstBaseUpdate:I.firstBaseUpdate,lastBaseUpdate:I.lastBaseUpdate,shared:I.shared,effects:I.effects};u.updateQueue=O}}function th(l,u){var w={eventTime:l,lane:u,tag:jw,payload:null,callback:null,next:null};return w}function _c(l,u,w){var I=l.updateQueue;if(I===null)return null;var O=I.shared;if(tv===O&&!hm&&(C("An update (setState, replaceState, or forceUpdate) was scheduled from inside an update function. Update functions should be pure, with zero side-effects. Consider using componentDidUpdate or a callback."),hm=!0),R2()){var G=O.pending;return G===null?u.next=u:(u.next=G.next,G.next=u),O.pending=u,kA(l,w)}else return KS(l,O,u,w)}function yc(l,u,w){var I=u.updateQueue;if(I!==null){var O=I.shared;if(ju(w)){var G=O.lanes;G=Ph(G,l.pendingLanes);var Y=fr(G,w);O.lanes=Y,Oh(l,Y)}}}function x0(l,u){var w=l.updateQueue,I=l.alternate;if(I!==null){var O=I.updateQueue;if(w===O){var G=null,Y=null,oe=w.firstBaseUpdate;if(oe!==null){var fe=oe;do{var Oe={eventTime:fe.eventTime,lane:fe.lane,tag:fe.tag,payload:fe.payload,callback:fe.callback,next:null};Y===null?G=Y=Oe:(Y.next=Oe,Y=Oe),fe=fe.next}while(fe!==null);Y===null?G=Y=u:(Y.next=u,Y=u)}else G=Y=u;w={baseState:O.baseState,firstBaseUpdate:G,lastBaseUpdate:Y,shared:O.shared,effects:O.effects},l.updateQueue=w;return}}var Ne=w.lastBaseUpdate;Ne===null?w.firstBaseUpdate=u:Ne.next=u,w.lastBaseUpdate=u}function Gw(l,u,w,I,O,G){switch(w.tag){case Nf:{var Y=w.payload;if(typeof Y=="function"){Uw();var oe=Y.call(G,I,O);{if(l.mode&lo){Ua(!0);try{Y.call(G,I,O)}finally{Ua(!1)}}Ky()}return oe}return Y}case Qy:l.flags=l.flags&~us|Hr;case jw:{var fe=w.payload,Oe;if(typeof fe=="function"){Uw(),Oe=fe.call(G,I,O);{if(l.mode&lo){Ua(!0);try{fe.call(G,I,O)}finally{Ua(!1)}}Ky()}}else Oe=fe;return Oe==null?I:Yt({},I,Oe)}case Bf:return ev=!0,I}return I}function b0(l,u,w,I){var O=l.updateQueue;ev=!1,tv=O.shared;var G=O.firstBaseUpdate,Y=O.lastBaseUpdate,oe=O.shared.pending;if(oe!==null){O.shared.pending=null;var fe=oe,Oe=fe.next;fe.next=null,Y===null?G=Oe:Y.next=Oe,Y=fe;var Ne=l.alternate;if(Ne!==null){var ft=Ne.updateQueue,dt=ft.lastBaseUpdate;dt!==Y&&(dt===null?ft.firstBaseUpdate=Oe:dt.next=Oe,ft.lastBaseUpdate=fe)}}if(G!==null){var Vt=O.baseState,jt=mi,ii=null,Ji=null,Fn=null,Tn=G;do{var ra=Tn.lane,Wr=Tn.eventTime;if(pc(I,ra)){if(Fn!==null){var ni={eventTime:Wr,lane:co,tag:Tn.tag,payload:Tn.payload,callback:Tn.callback,next:null};Fn=Fn.next=ni}Vt=Gw(l,O,Tn,Vt,u,w);var It=Tn.callback;if(It!==null&&Tn.lane!==co){l.flags|=Qm;var Ei=O.effects;Ei===null?O.effects=[Tn]:Ei.push(Tn)}}else{var Rt={eventTime:Wr,lane:ra,tag:Tn.tag,payload:Tn.payload,callback:Tn.callback,next:null};Fn===null?(Ji=Fn=Rt,ii=Vt):Fn=Fn.next=Rt,jt=fr(jt,ra)}if(Tn=Tn.next,Tn===null){if(oe=O.shared.pending,oe===null)break;var sn=oe,nn=sn.next;sn.next=null,Tn=nn,O.lastBaseUpdate=sn,O.shared.pending=null}}while(!0);Fn===null&&(ii=Vt),O.baseState=ii,O.firstBaseUpdate=Ji,O.lastBaseUpdate=Fn;var sr=O.shared.interleaved;if(sr!==null){var vr=sr;do jt=fr(jt,vr.lane),vr=vr.next;while(vr!==sr)}else G===null&&(O.shared.lanes=mi);F1(jt),l.lanes=jt,l.memoizedState=Vt}tv=null}function w0(l,u){if(typeof l!="function")throw new Error("Invalid argument passed as callback. Expected a function. Instead "+("received: "+l));l.call(u)}function Hw(){ev=!1}function iv(){return ev}function nv(l,u,w){var I=u.effects;if(u.effects=null,I!==null)for(var O=0;O<I.length;O++){var G=I[O],Y=G.callback;Y!==null&&(G.callback=null,w0(Y,w))}}var Uf={},Vf=Uh(Uf),rv=Uh(Uf),T0=Uh(Uf);function Fd(l){if(l===Uf)throw new Error("Expected host context to exist. This error is likely caused by a bug in React. Please file an issue.");return l}function JS(){var l=Fd(T0.current);return l}function av(l,u){js(T0,u,l),js(rv,l,l),js(Vf,Uf,l);var w=If(u);Vs(Vf,l),js(Vf,w,l)}function t_(l){Vs(Vf,l),Vs(rv,l),Vs(T0,l)}function i_(){var l=Fd(Vf.current);return l}function $w(l){Fd(T0.current);var u=Fd(Vf.current),w=uS(u,l.type);u!==w&&(js(rv,l,l),js(Vf,w,l))}function Ww(l){rv.current===l&&(Vs(Vf,l),Vs(rv,l))}var S0=0,qw=1,n_=1,ov=2,ou=Uh(S0);function Zw(l,u){return(l&u)!==0}function dm(l){return l&qw}function sv(l,u){return l&qw|u}function LA(l,u){return l|u}function jf(l,u){js(ou,u,l)}function Gh(l){Vs(ou,l)}function Nd(l,u){var w=l.memoizedState;return w!==null?w.dehydrated!==null:(l.memoizedProps,!0)}function lv(l){for(var u=l;u!==null;){if(u.tag===it){var w=u.memoizedState;if(w!==null){var I=w.dehydrated;if(I===null||gw(I)||_w(I))return u}}else if(u.tag===hi&&u.memoizedProps.revealOrder!==void 0){var O=(u.flags&Hr)!==Mn;if(O)return u}else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===l)return null;for(;u.sibling===null;){if(u.return===null||u.return===l)return null;u=u.return}u.sibling.return=u.return,u=u.sibling}return null}var cl=0,No=1,su=2,ps=4,Ms=8,fm=[];function E0(){for(var l=0;l<fm.length;l++){var u=fm[l];u._workInProgressVersionPrimary=null}fm.length=0}function zA(l,u){var w=u._getVersion,I=w(u._source);l.mutableSourceEagerHydrationData==null?l.mutableSourceEagerHydrationData=[u,I]:l.mutableSourceEagerHydrationData.push(u,I)}var Wi=h.ReactCurrentDispatcher,cv=h.ReactCurrentBatchConfig,pm,Hh;pm=new Set;var ih=mi,ua=null,Bo=null,ms=null,C0=!1,$h=!1,Gf=0,FA=0,QS=25,li=null,lu=null,Bd=-1,Xw=!1;function ma(){{var l=li;lu===null?lu=[l]:lu.push(l)}}function $i(){{var l=li;lu!==null&&(Bd++,lu[Bd]!==l&&NA(l))}}function mm(l){l!=null&&!Sr(l)&&C("%s received a final argument that is not an array (instead, received `%s`). When specified, the final argument must be an array.",li,typeof l)}function NA(l){{var u=pn(ua);if(!pm.has(u)&&(pm.add(u),lu!==null)){for(var w="",I=30,O=0;O<=Bd;O++){for(var G=lu[O],Y=O===Bd?l:G,oe=O+1+". "+G;oe.length<I;)oe+=" ";oe+=Y+`
`,w+=oe}C(`React has detected a change in the order of Hooks called by %s. This will lead to bugs and errors if not fixed. For more information, read the Rules of Hooks: https://reactjs.org/link/rules-of-hooks

   Previous render            Next render
   ------------------------------------------------------
%s   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
`,u,w)}}}function ul(){throw new Error(`Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:
1. You might have mismatching versions of React and the renderer (such as React DOM)
2. You might be breaking the Rules of Hooks
3. You might have more than one copy of React in the same app
See https://reactjs.org/link/invalid-hook-call for tips about how to debug and fix this problem.`)}function gm(l,u){if(Xw)return!1;if(u===null)return C("%s received a final argument during this render, but not during the previous render. Even though the final argument is optional, its type cannot change between renders.",li),!1;l.length!==u.length&&C(`The final argument passed to %s changed size between renders. The order and size of this array must remain constant.

Previous: %s
Incoming: %s`,li,"["+u.join(", ")+"]","["+l.join(", ")+"]");for(var w=0;w<u.length&&w<l.length;w++)if(!Al(l[w],u[w]))return!1;return!0}function Wh(l,u,w,I,O,G){ih=G,ua=u,lu=l!==null?l._debugHookTypes:null,Bd=-1,Xw=l!==null&&l.type!==u.type,u.memoizedState=null,u.updateQueue=null,u.lanes=mi,l!==null&&l.memoizedState!==null?Wi.current=p_:lu!==null?Wi.current=oE:Wi.current=bv;var Y=w(I,O);if($h){var oe=0;do{if($h=!1,Gf=0,oe>=QS)throw new Error("Too many re-renders. React limits the number of renders to prevent an infinite loop.");oe+=1,Xw=!1,Bo=null,ms=null,u.updateQueue=null,Bd=-1,Wi.current=s1,Y=w(I,O)}while($h)}Wi.current=f_,u._debugHookTypes=lu;var fe=Bo!==null&&Bo.next!==null;if(ih=mi,ua=null,Bo=null,ms=null,li=null,lu=null,Bd=-1,l!==null&&(l.flags&jc)!==(u.flags&jc)&&(l.mode&Ln)!==Sn&&C("Internal React error: Expected static flag was missing. Please notify the React team."),C0=!1,fe)throw new Error("Rendered fewer hooks than expected. This may be caused by an accidental early return statement.");return Y}function qh(){var l=Gf!==0;return Gf=0,l}function uv(l,u,w){u.updateQueue=l.updateQueue,(u.mode&Vl)!==Sn?u.flags&=-50333701:u.flags&=-2053,l.lanes=yf(l.lanes,w)}function _m(){if(Wi.current=f_,C0){for(var l=ua.memoizedState;l!==null;){var u=l.queue;u!==null&&(u.pending=null),l=l.next}C0=!1}ih=mi,ua=null,Bo=null,ms=null,lu=null,Bd=-1,li=null,nE=!1,$h=!1,Gf=0}function Zh(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ms===null?ua.memoizedState=ms=l:ms=ms.next=l,ms}function Yl(){var l;if(Bo===null){var u=ua.alternate;u!==null?l=u.memoizedState:l=null}else l=Bo.next;var w;if(ms===null?w=ua.memoizedState:w=ms.next,w!==null)ms=w,w=ms.next,Bo=l;else{if(l===null)throw new Error("Rendered more hooks than during the previous render.");Bo=l;var I={memoizedState:Bo.memoizedState,baseState:Bo.baseState,baseQueue:Bo.baseQueue,queue:Bo.queue,next:null};ms===null?ua.memoizedState=ms=I:ms=ms.next=I}return ms}function A0(){return{lastEffect:null,stores:null}}function r_(l,u){return typeof u=="function"?u(l):u}function R0(l,u,w){var I=Zh(),O;w!==void 0?O=w(u):O=u,I.memoizedState=I.baseState=O;var G={pending:null,interleaved:null,lanes:mi,dispatch:null,lastRenderedReducer:l,lastRenderedState:O};I.queue=G;var Y=G.dispatch=xm.bind(null,ua,G);return[I.memoizedState,Y]}function I0(l,u,w){var I=Yl(),O=I.queue;if(O===null)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");O.lastRenderedReducer=l;var G=Bo,Y=G.baseQueue,oe=O.pending;if(oe!==null){if(Y!==null){var fe=Y.next,Oe=oe.next;Y.next=Oe,oe.next=fe}G.baseQueue!==Y&&C("Internal error: Expected work-in-progress queue to be a clone. This is a bug in React."),G.baseQueue=Y=oe,O.pending=null}if(Y!==null){var Ne=Y.next,ft=G.baseState,dt=null,Vt=null,jt=null,ii=Ne;do{var Ji=ii.lane;if(pc(ih,Ji)){if(jt!==null){var Tn={lane:co,action:ii.action,hasEagerState:ii.hasEagerState,eagerState:ii.eagerState,next:null};jt=jt.next=Tn}if(ii.hasEagerState)ft=ii.eagerState;else{var ra=ii.action;ft=l(ft,ra)}}else{var Fn={lane:Ji,action:ii.action,hasEagerState:ii.hasEagerState,eagerState:ii.eagerState,next:null};jt===null?(Vt=jt=Fn,dt=ft):jt=jt.next=Fn,ua.lanes=fr(ua.lanes,Ji),F1(Ji)}ii=ii.next}while(ii!==null&&ii!==Ne);jt===null?dt=ft:jt.next=Vt,Al(ft,I.memoizedState)||ee(),I.memoizedState=ft,I.baseState=dt,I.baseQueue=jt,O.lastRenderedState=ft}var Wr=O.interleaved;if(Wr!==null){var Rt=Wr;do{var ni=Rt.lane;ua.lanes=fr(ua.lanes,ni),F1(ni),Rt=Rt.next}while(Rt!==Wr)}else Y===null&&(O.lanes=mi);var It=O.dispatch;return[I.memoizedState,It]}function D0(l,u,w){var I=Yl(),O=I.queue;if(O===null)throw new Error("Should have a queue. This is likely a bug in React. Please file an issue.");O.lastRenderedReducer=l;var G=O.dispatch,Y=O.pending,oe=I.memoizedState;if(Y!==null){O.pending=null;var fe=Y.next,Oe=fe;do{var Ne=Oe.action;oe=l(oe,Ne),Oe=Oe.next}while(Oe!==fe);Al(oe,I.memoizedState)||ee(),I.memoizedState=oe,I.baseQueue===null&&(I.baseState=oe),O.lastRenderedState=oe}return[oe,G]}function eE(l,u,w){}function BA(l,u,w){}function hv(l,u,w){var I=ua,O=Zh(),G,Y=Ds();if(Y){if(w===void 0)throw new Error("Missing getServerSnapshot, which is required for server-rendered content. Will revert to client rendering.");G=w(),Hh||G!==w()&&(C("The result of getServerSnapshot should be cached to avoid an infinite loop"),Hh=!0)}else{if(G=u(),!Hh){var oe=u();Al(G,oe)||(C("The result of getSnapshot should be cached to avoid an infinite loop"),Hh=!0)}var fe=zE();if(fe===null)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");Td(fe,ih)||Yw(I,u,G)}O.memoizedState=G;var Oe={value:G,getSnapshot:u};return O.queue=Oe,pv(Jw.bind(null,I,Oe,l),[l]),I.flags|=Uc,o_(No|Ms,Kw.bind(null,I,Oe,G,u),void 0,null),G}function ym(l,u,w){var I=ua,O=Yl(),G=u();if(!Hh){var Y=u();Al(G,Y)||(C("The result of getSnapshot should be cached to avoid an infinite loop"),Hh=!0)}var oe=O.memoizedState,fe=!Al(oe,G);fe&&(O.memoizedState=G,ee());var Oe=O.queue;if(l_(Jw.bind(null,I,Oe,l),[l]),Oe.getSnapshot!==u||fe||ms!==null&&ms.memoizedState.tag&No){I.flags|=Uc,o_(No|Ms,Kw.bind(null,I,Oe,G,u),void 0,null);var Ne=zE();if(Ne===null)throw new Error("Expected a work-in-progress root. This is a bug in React. Please file an issue.");Td(Ne,ih)||Yw(I,u,G)}return G}function Yw(l,u,w){l.flags|=Pu;var I={getSnapshot:u,value:w},O=ua.updateQueue;if(O===null)O=A0(),ua.updateQueue=O,O.stores=[I];else{var G=O.stores;G===null?O.stores=[I]:G.push(I)}}function Kw(l,u,w,I){u.value=w,u.getSnapshot=I,Qw(u)&&M0(l)}function Jw(l,u,w){var I=function(){Qw(u)&&M0(l)};return w(I)}function Qw(l){var u=l.getSnapshot,w=l.value;try{var I=u();return!Al(w,I)}catch{return!0}}function M0(l){var u=Xl(l,Zn);u!==null&&Xs(u,l,Zn,gn)}function vm(l){var u=Zh();typeof l=="function"&&(l=l()),u.memoizedState=u.baseState=l;var w={pending:null,interleaved:null,lanes:mi,dispatch:null,lastRenderedReducer:r_,lastRenderedState:l};u.queue=w;var I=w.dispatch=o1.bind(null,ua,w);return[u.memoizedState,I]}function P0(l){return I0(r_)}function a_(l){return D0(r_)}function o_(l,u,w,I){var O={tag:l,create:u,destroy:w,deps:I,next:null},G=ua.updateQueue;if(G===null)G=A0(),ua.updateQueue=G,G.lastEffect=O.next=O;else{var Y=G.lastEffect;if(Y===null)G.lastEffect=O.next=O;else{var oe=Y.next;Y.next=O,O.next=oe,G.lastEffect=O}}return O}function e1(l){var u=Zh();{var w={current:l};return u.memoizedState=w,w}}function dv(l){var u=Yl();return u.memoizedState}function s_(l,u,w,I){var O=Zh(),G=I===void 0?null:I;ua.flags|=l,O.memoizedState=o_(No|u,w,void 0,G)}function fv(l,u,w,I){var O=Yl(),G=I===void 0?null:I,Y=void 0;if(Bo!==null){var oe=Bo.memoizedState;if(Y=oe.destroy,G!==null){var fe=oe.deps;if(gm(G,fe)){O.memoizedState=o_(u,w,Y,G);return}}}ua.flags|=l,O.memoizedState=o_(No|u,w,Y,G)}function pv(l,u){return(ua.mode&Vl)!==Sn?s_(af|Uc|Dp,Ms,l,u):s_(Uc|Dp,Ms,l,u)}function l_(l,u){return fv(Uc,Ms,l,u)}function O0(l,u){return s_(Qr,su,l,u)}function mv(l,u){return fv(Qr,su,l,u)}function t1(l,u){var w=Qr;return w|=Ou,(ua.mode&Vl)!==Sn&&(w|=Ul),s_(w,ps,l,u)}function c_(l,u){return fv(Qr,ps,l,u)}function i1(l,u){if(typeof u=="function"){var w=u,I=l();return w(I),function(){w(null)}}else if(u!=null){var O=u;O.hasOwnProperty("current")||C("Expected useImperativeHandle() first argument to either be a ref callback or React.createRef() object. Instead received: %s.","an object with keys {"+Object.keys(O).join(", ")+"}");var G=l();return O.current=G,function(){O.current=null}}}function u_(l,u,w){typeof u!="function"&&C("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",u!==null?typeof u:"null");var I=w!=null?w.concat([l]):null,O=Qr;return O|=Ou,(ua.mode&Vl)!==Sn&&(O|=Ul),s_(O,ps,i1.bind(null,u,l),I)}function h_(l,u,w){typeof u!="function"&&C("Expected useImperativeHandle() second argument to be a function that creates a handle. Instead received: %s.",u!==null?typeof u:"null");var I=w!=null?w.concat([l]):null;return fv(Qr,ps,i1.bind(null,u,l),I)}function tE(l,u){}var gv=tE;function _v(l,u){var w=Zh(),I=u===void 0?null:u;return w.memoizedState=[l,I],l}function yv(l,u){var w=Yl(),I=u===void 0?null:u,O=w.memoizedState;if(O!==null&&I!==null){var G=O[1];if(gm(I,G))return O[0]}return w.memoizedState=[l,I],l}function k0(l,u){var w=Zh(),I=u===void 0?null:u,O=l();return w.memoizedState=[O,I],O}function Ud(l,u){var w=Yl(),I=u===void 0?null:u,O=w.memoizedState;if(O!==null&&I!==null){var G=O[1];if(gm(I,G))return O[0]}var Y=l();return w.memoizedState=[Y,I],Y}function vv(l){var u=Zh();return u.memoizedState=l,l}function Hf(l){var u=Yl(),w=Bo,I=w.memoizedState;return r1(u,I,l)}function n1(l){var u=Yl();if(Bo===null)return u.memoizedState=l,l;var w=Bo.memoizedState;return r1(u,w,l)}function r1(l,u,w){var I=!wd(ih);if(I){if(!Al(w,u)){var O=xg();ua.lanes=fr(ua.lanes,O),F1(O),l.baseState=!0}return u}else return l.baseState&&(l.baseState=!1,ee()),l.memoizedState=w,w}function iE(l,u,w){var I=$l();Co(gx(I,Tl)),l(!0);var O=cv.transition;cv.transition={};var G=cv.transition;cv.transition._updatedFibers=new Set;try{l(!1),u()}finally{if(Co(I),cv.transition=O,O===null&&G._updatedFibers){var Y=G._updatedFibers.size;Y>10&&E("Detected a large number of updates inside startTransition. If this is due to a subscription please re-write it to use React provided hooks. Otherwise concurrent mode guarantees are off the table."),G._updatedFibers.clear()}}}function L0(){var l=vm(!1),u=l[0],w=l[1],I=iE.bind(null,w),O=Zh();return O.memoizedState=I,[u,I]}function xv(){var l=P0(),u=l[0],w=Yl(),I=w.memoizedState;return[u,I]}function d_(){var l=a_(),u=l[0],w=Yl(),I=w.memoizedState;return[u,I]}var nE=!1;function UA(){return nE}function a1(){var l=Zh(),u=zE(),w=u.identifierPrefix,I;if(Ds()){var O=BS();I=":"+w+"R"+O;var G=Gf++;G>0&&(I+="H"+G.toString(32)),I+=":"}else{var Y=FA++;I=":"+w+"r"+Y.toString(32)+":"}return l.memoizedState=I,I}function Xh(){var l=Yl(),u=l.memoizedState;return u}function xm(l,u,w){typeof arguments[3]=="function"&&C("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var I=S_(l),O={lane:I,action:w,hasEagerState:!1,eagerState:null,next:null};if(rE(l))aE(u,O);else{var G=Vw(l,u,O,I);if(G!==null){var Y=Sc();Xs(G,l,I,Y),z0(G,u,I)}}F0(l,I)}function o1(l,u,w){typeof arguments[3]=="function"&&C("State updates from the useState() and useReducer() Hooks don't support the second callback argument. To execute a side effect after rendering, declare it in the component body with useEffect().");var I=S_(l),O={lane:I,action:w,hasEagerState:!1,eagerState:null,next:null};if(rE(l))aE(u,O);else{var G=l.alternate;if(l.lanes===mi&&(G===null||G.lanes===mi)){var Y=u.lastRenderedReducer;if(Y!==null){var oe;oe=Wi.current,Wi.current=cu;try{var fe=u.lastRenderedState,Oe=Y(fe,w);if(O.hasEagerState=!0,O.eagerState=Oe,Al(Oe,fe)){YS(l,u,O,I);return}}catch{}finally{Wi.current=oe}}}var Ne=Vw(l,u,O,I);if(Ne!==null){var ft=Sc();Xs(Ne,l,I,ft),z0(Ne,u,I)}}F0(l,I)}function rE(l){var u=l.alternate;return l===ua||u!==null&&u===ua}function aE(l,u){$h=C0=!0;var w=l.pending;w===null?u.next=u:(u.next=w.next,w.next=u),l.pending=u}function z0(l,u,w){if(ju(w)){var I=u.lanes;I=Ph(I,l.pendingLanes);var O=fr(I,w);u.lanes=O,Oh(l,O)}}function F0(l,u,w){Ss(l,u)}var f_={readContext:Fo,useCallback:ul,useContext:ul,useEffect:ul,useImperativeHandle:ul,useInsertionEffect:ul,useLayoutEffect:ul,useMemo:ul,useReducer:ul,useRef:ul,useState:ul,useDebugValue:ul,useDeferredValue:ul,useTransition:ul,useMutableSource:ul,useSyncExternalStore:ul,useId:ul,unstable_isNewReconciler:zi},bv=null,oE=null,p_=null,s1=null,Yh=null,cu=null,N0=null;{var l1=function(){C("Context can only be read while React is rendering. In classes, you can read it in the render method or getDerivedStateFromProps. In function components, you can read it directly in the function body, but not inside Hooks like useReducer() or useMemo().")},or=function(){C("Do not call Hooks inside useEffect(...), useMemo(...), or other built-in Hooks. You can only call Hooks at the top level of your React function. For more information, see https://reactjs.org/link/rules-of-hooks")};bv={readContext:function(l){return Fo(l)},useCallback:function(l,u){return li="useCallback",ma(),mm(u),_v(l,u)},useContext:function(l){return li="useContext",ma(),Fo(l)},useEffect:function(l,u){return li="useEffect",ma(),mm(u),pv(l,u)},useImperativeHandle:function(l,u,w){return li="useImperativeHandle",ma(),mm(w),u_(l,u,w)},useInsertionEffect:function(l,u){return li="useInsertionEffect",ma(),mm(u),O0(l,u)},useLayoutEffect:function(l,u){return li="useLayoutEffect",ma(),mm(u),t1(l,u)},useMemo:function(l,u){li="useMemo",ma(),mm(u);var w=Wi.current;Wi.current=Yh;try{return k0(l,u)}finally{Wi.current=w}},useReducer:function(l,u,w){li="useReducer",ma();var I=Wi.current;Wi.current=Yh;try{return R0(l,u,w)}finally{Wi.current=I}},useRef:function(l){return li="useRef",ma(),e1(l)},useState:function(l){li="useState",ma();var u=Wi.current;Wi.current=Yh;try{return vm(l)}finally{Wi.current=u}},useDebugValue:function(l,u){return li="useDebugValue",ma(),void 0},useDeferredValue:function(l){return li="useDeferredValue",ma(),vv(l)},useTransition:function(){return li="useTransition",ma(),L0()},useMutableSource:function(l,u,w){return li="useMutableSource",ma(),void 0},useSyncExternalStore:function(l,u,w){return li="useSyncExternalStore",ma(),hv(l,u,w)},useId:function(){return li="useId",ma(),a1()},unstable_isNewReconciler:zi},oE={readContext:function(l){return Fo(l)},useCallback:function(l,u){return li="useCallback",$i(),_v(l,u)},useContext:function(l){return li="useContext",$i(),Fo(l)},useEffect:function(l,u){return li="useEffect",$i(),pv(l,u)},useImperativeHandle:function(l,u,w){return li="useImperativeHandle",$i(),u_(l,u,w)},useInsertionEffect:function(l,u){return li="useInsertionEffect",$i(),O0(l,u)},useLayoutEffect:function(l,u){return li="useLayoutEffect",$i(),t1(l,u)},useMemo:function(l,u){li="useMemo",$i();var w=Wi.current;Wi.current=Yh;try{return k0(l,u)}finally{Wi.current=w}},useReducer:function(l,u,w){li="useReducer",$i();var I=Wi.current;Wi.current=Yh;try{return R0(l,u,w)}finally{Wi.current=I}},useRef:function(l){return li="useRef",$i(),e1(l)},useState:function(l){li="useState",$i();var u=Wi.current;Wi.current=Yh;try{return vm(l)}finally{Wi.current=u}},useDebugValue:function(l,u){return li="useDebugValue",$i(),void 0},useDeferredValue:function(l){return li="useDeferredValue",$i(),vv(l)},useTransition:function(){return li="useTransition",$i(),L0()},useMutableSource:function(l,u,w){return li="useMutableSource",$i(),void 0},useSyncExternalStore:function(l,u,w){return li="useSyncExternalStore",$i(),hv(l,u,w)},useId:function(){return li="useId",$i(),a1()},unstable_isNewReconciler:zi},p_={readContext:function(l){return Fo(l)},useCallback:function(l,u){return li="useCallback",$i(),yv(l,u)},useContext:function(l){return li="useContext",$i(),Fo(l)},useEffect:function(l,u){return li="useEffect",$i(),l_(l,u)},useImperativeHandle:function(l,u,w){return li="useImperativeHandle",$i(),h_(l,u,w)},useInsertionEffect:function(l,u){return li="useInsertionEffect",$i(),mv(l,u)},useLayoutEffect:function(l,u){return li="useLayoutEffect",$i(),c_(l,u)},useMemo:function(l,u){li="useMemo",$i();var w=Wi.current;Wi.current=cu;try{return Ud(l,u)}finally{Wi.current=w}},useReducer:function(l,u,w){li="useReducer",$i();var I=Wi.current;Wi.current=cu;try{return I0(l,u,w)}finally{Wi.current=I}},useRef:function(l){return li="useRef",$i(),dv()},useState:function(l){li="useState",$i();var u=Wi.current;Wi.current=cu;try{return P0(l)}finally{Wi.current=u}},useDebugValue:function(l,u){return li="useDebugValue",$i(),gv()},useDeferredValue:function(l){return li="useDeferredValue",$i(),Hf(l)},useTransition:function(){return li="useTransition",$i(),xv()},useMutableSource:function(l,u,w){return li="useMutableSource",$i(),void 0},useSyncExternalStore:function(l,u,w){return li="useSyncExternalStore",$i(),ym(l,u)},useId:function(){return li="useId",$i(),Xh()},unstable_isNewReconciler:zi},s1={readContext:function(l){return Fo(l)},useCallback:function(l,u){return li="useCallback",$i(),yv(l,u)},useContext:function(l){return li="useContext",$i(),Fo(l)},useEffect:function(l,u){return li="useEffect",$i(),l_(l,u)},useImperativeHandle:function(l,u,w){return li="useImperativeHandle",$i(),h_(l,u,w)},useInsertionEffect:function(l,u){return li="useInsertionEffect",$i(),mv(l,u)},useLayoutEffect:function(l,u){return li="useLayoutEffect",$i(),c_(l,u)},useMemo:function(l,u){li="useMemo",$i();var w=Wi.current;Wi.current=N0;try{return Ud(l,u)}finally{Wi.current=w}},useReducer:function(l,u,w){li="useReducer",$i();var I=Wi.current;Wi.current=N0;try{return D0(l,u,w)}finally{Wi.current=I}},useRef:function(l){return li="useRef",$i(),dv()},useState:function(l){li="useState",$i();var u=Wi.current;Wi.current=N0;try{return a_(l)}finally{Wi.current=u}},useDebugValue:function(l,u){return li="useDebugValue",$i(),gv()},useDeferredValue:function(l){return li="useDeferredValue",$i(),n1(l)},useTransition:function(){return li="useTransition",$i(),d_()},useMutableSource:function(l,u,w){return li="useMutableSource",$i(),void 0},useSyncExternalStore:function(l,u,w){return li="useSyncExternalStore",$i(),ym(l,u)},useId:function(){return li="useId",$i(),Xh()},unstable_isNewReconciler:zi},Yh={readContext:function(l){return l1(),Fo(l)},useCallback:function(l,u){return li="useCallback",or(),ma(),_v(l,u)},useContext:function(l){return li="useContext",or(),ma(),Fo(l)},useEffect:function(l,u){return li="useEffect",or(),ma(),pv(l,u)},useImperativeHandle:function(l,u,w){return li="useImperativeHandle",or(),ma(),u_(l,u,w)},useInsertionEffect:function(l,u){return li="useInsertionEffect",or(),ma(),O0(l,u)},useLayoutEffect:function(l,u){return li="useLayoutEffect",or(),ma(),t1(l,u)},useMemo:function(l,u){li="useMemo",or(),ma();var w=Wi.current;Wi.current=Yh;try{return k0(l,u)}finally{Wi.current=w}},useReducer:function(l,u,w){li="useReducer",or(),ma();var I=Wi.current;Wi.current=Yh;try{return R0(l,u,w)}finally{Wi.current=I}},useRef:function(l){return li="useRef",or(),ma(),e1(l)},useState:function(l){li="useState",or(),ma();var u=Wi.current;Wi.current=Yh;try{return vm(l)}finally{Wi.current=u}},useDebugValue:function(l,u){return li="useDebugValue",or(),ma(),void 0},useDeferredValue:function(l){return li="useDeferredValue",or(),ma(),vv(l)},useTransition:function(){return li="useTransition",or(),ma(),L0()},useMutableSource:function(l,u,w){return li="useMutableSource",or(),ma(),void 0},useSyncExternalStore:function(l,u,w){return li="useSyncExternalStore",or(),ma(),hv(l,u,w)},useId:function(){return li="useId",or(),ma(),a1()},unstable_isNewReconciler:zi},cu={readContext:function(l){return l1(),Fo(l)},useCallback:function(l,u){return li="useCallback",or(),$i(),yv(l,u)},useContext:function(l){return li="useContext",or(),$i(),Fo(l)},useEffect:function(l,u){return li="useEffect",or(),$i(),l_(l,u)},useImperativeHandle:function(l,u,w){return li="useImperativeHandle",or(),$i(),h_(l,u,w)},useInsertionEffect:function(l,u){return li="useInsertionEffect",or(),$i(),mv(l,u)},useLayoutEffect:function(l,u){return li="useLayoutEffect",or(),$i(),c_(l,u)},useMemo:function(l,u){li="useMemo",or(),$i();var w=Wi.current;Wi.current=cu;try{return Ud(l,u)}finally{Wi.current=w}},useReducer:function(l,u,w){li="useReducer",or(),$i();var I=Wi.current;Wi.current=cu;try{return I0(l,u,w)}finally{Wi.current=I}},useRef:function(l){return li="useRef",or(),$i(),dv()},useState:function(l){li="useState",or(),$i();var u=Wi.current;Wi.current=cu;try{return P0(l)}finally{Wi.current=u}},useDebugValue:function(l,u){return li="useDebugValue",or(),$i(),gv()},useDeferredValue:function(l){return li="useDeferredValue",or(),$i(),Hf(l)},useTransition:function(){return li="useTransition",or(),$i(),xv()},useMutableSource:function(l,u,w){return li="useMutableSource",or(),$i(),void 0},useSyncExternalStore:function(l,u,w){return li="useSyncExternalStore",or(),$i(),ym(l,u)},useId:function(){return li="useId",or(),$i(),Xh()},unstable_isNewReconciler:zi},N0={readContext:function(l){return l1(),Fo(l)},useCallback:function(l,u){return li="useCallback",or(),$i(),yv(l,u)},useContext:function(l){return li="useContext",or(),$i(),Fo(l)},useEffect:function(l,u){return li="useEffect",or(),$i(),l_(l,u)},useImperativeHandle:function(l,u,w){return li="useImperativeHandle",or(),$i(),h_(l,u,w)},useInsertionEffect:function(l,u){return li="useInsertionEffect",or(),$i(),mv(l,u)},useLayoutEffect:function(l,u){return li="useLayoutEffect",or(),$i(),c_(l,u)},useMemo:function(l,u){li="useMemo",or(),$i();var w=Wi.current;Wi.current=cu;try{return Ud(l,u)}finally{Wi.current=w}},useReducer:function(l,u,w){li="useReducer",or(),$i();var I=Wi.current;Wi.current=cu;try{return D0(l,u,w)}finally{Wi.current=I}},useRef:function(l){return li="useRef",or(),$i(),dv()},useState:function(l){li="useState",or(),$i();var u=Wi.current;Wi.current=cu;try{return a_(l)}finally{Wi.current=u}},useDebugValue:function(l,u){return li="useDebugValue",or(),$i(),gv()},useDeferredValue:function(l){return li="useDeferredValue",or(),$i(),n1(l)},useTransition:function(){return li="useTransition",or(),$i(),d_()},useMutableSource:function(l,u,w){return li="useMutableSource",or(),$i(),void 0},useSyncExternalStore:function(l,u,w){return li="useSyncExternalStore",or(),$i(),ym(l,u)},useId:function(){return li="useId",or(),$i(),Xh()},unstable_isNewReconciler:zi}}var $f=s.unstable_now,sE=0,B0=-1,Wf=-1,U0=-1,c1=!1,bm=!1;function lE(){return c1}function VA(){bm=!0}function jA(){c1=!1,bm=!1}function V0(){c1=bm,bm=!1}function cE(){return sE}function uE(){sE=$f()}function j0(l){Wf=$f(),l.actualStartTime<0&&(l.actualStartTime=$f())}function hE(l){Wf=-1}function G0(l,u){if(Wf>=0){var w=$f()-Wf;l.actualDuration+=w,u&&(l.selfBaseDuration=w),Wf=-1}}function Kh(l){if(B0>=0){var u=$f()-B0;B0=-1;for(var w=l.return;w!==null;){switch(w.tag){case K:var I=w.stateNode;I.effectDuration+=u;return;case Xe:var O=w.stateNode;O.effectDuration+=u;return}w=w.return}}}function u1(l){if(U0>=0){var u=$f()-U0;U0=-1;for(var w=l.return;w!==null;){switch(w.tag){case K:var I=w.stateNode;I!==null&&(I.passiveEffectDuration+=u);return;case Xe:var O=w.stateNode;O!==null&&(O.passiveEffectDuration+=u);return}w=w.return}}}function Jh(){B0=$f()}function qf(){U0=$f()}function wm(l){for(var u=l.child;u;)l.actualDuration+=u.actualDuration,u=u.sibling}function nh(l,u){if(l&&l.defaultProps){var w=Yt({},u),I=l.defaultProps;for(var O in I)w[O]===void 0&&(w[O]=I[O]);return w}return u}var wv={},H0,$0,W0,q0,Z0,h1,Tv,X0,Y0,Zf,m_;{H0=new Set,$0=new Set,W0=new Set,q0=new Set,X0=new Set,Z0=new Set,Y0=new Set,Zf=new Set,m_=new Set;var d1=new Set;Tv=function(l,u){if(!(l===null||typeof l=="function")){var w=u+"_"+l;d1.has(w)||(d1.add(w),C("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",u,l))}},h1=function(l,u){if(u===void 0){var w=Nr(l)||"Component";Z0.has(w)||(Z0.add(w),C("%s.getDerivedStateFromProps(): A valid state object (or null) must be returned. You have returned undefined.",w))}},Object.defineProperty(wv,"_processChildContext",{enumerable:!1,value:function(){throw new Error("_processChildContext is not available in React 16+. This likely means you have multiple copies of React and are attempting to nest a React 15 tree inside a React 16 tree using unstable_renderSubtreeIntoContainer, which isn't supported. Try to make sure you have only one copy of React (and ideally, switch to ReactDOM.createPortal).")}}),Object.freeze(wv)}function g_(l,u,w,I){var O=l.memoizedState,G=w(I,O);{if(l.mode&lo){Ua(!0);try{G=w(I,O)}finally{Ua(!1)}}h1(u,G)}var Y=G==null?O:Yt({},O,G);if(l.memoizedState=Y,l.lanes===mi){var oe=l.updateQueue;oe.baseState=Y}}var Sv={isMounted:Nb,enqueueSetState:function(l,u,w){var I=Nc(l),O=Sc(),G=S_(I),Y=th(O,G);Y.payload=u,w!=null&&(Tv(w,"setState"),Y.callback=w);var oe=_c(I,Y,G);oe!==null&&(Xs(oe,I,G,O),yc(oe,I,G)),Ss(I,G)},enqueueReplaceState:function(l,u,w){var I=Nc(l),O=Sc(),G=S_(I),Y=th(O,G);Y.tag=Nf,Y.payload=u,w!=null&&(Tv(w,"replaceState"),Y.callback=w);var oe=_c(I,Y,G);oe!==null&&(Xs(oe,I,G,O),yc(oe,I,G)),Ss(I,G)},enqueueForceUpdate:function(l,u){var w=Nc(l),I=Sc(),O=S_(w),G=th(I,O);G.tag=Bf,u!=null&&(Tv(u,"forceUpdate"),G.callback=u);var Y=_c(w,G,O);Y!==null&&(Xs(Y,w,O,I),yc(Y,w,O)),Vb(w,O)}};function f1(l,u,w,I,O,G,Y){var oe=l.stateNode;if(typeof oe.shouldComponentUpdate=="function"){var fe=oe.shouldComponentUpdate(I,G,Y);{if(l.mode&lo){Ua(!0);try{fe=oe.shouldComponentUpdate(I,G,Y)}finally{Ua(!1)}}fe===void 0&&C("%s.shouldComponentUpdate(): Returned undefined instead of a boolean value. Make sure to return true or false.",Nr(u)||"Component")}return fe}return u.prototype&&u.prototype.isPureReactComponent?!Rd(w,I)||!Rd(O,G):!0}function dE(l,u,w){var I=l.stateNode;{var O=Nr(u)||"Component",G=I.render;G||(u.prototype&&typeof u.prototype.render=="function"?C("%s(...): No `render` method found on the returned component instance: did you accidentally return an object from the constructor?",O):C("%s(...): No `render` method found on the returned component instance: you may have forgotten to define `render`.",O)),I.getInitialState&&!I.getInitialState.isReactClassApproved&&!I.state&&C("getInitialState was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Did you mean to define a state property instead?",O),I.getDefaultProps&&!I.getDefaultProps.isReactClassApproved&&C("getDefaultProps was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Use a static property to define defaultProps instead.",O),I.propTypes&&C("propTypes was defined as an instance property on %s. Use a static property to define propTypes instead.",O),I.contextType&&C("contextType was defined as an instance property on %s. Use a static property to define contextType instead.",O),u.childContextTypes&&!m_.has(u)&&(l.mode&lo)===Sn&&(m_.add(u),C(`%s uses the legacy childContextTypes API which is no longer supported and will be removed in the next major release. Use React.createContext() instead

.Learn more about this warning here: https://reactjs.org/link/legacy-context`,O)),u.contextTypes&&!m_.has(u)&&(l.mode&lo)===Sn&&(m_.add(u),C(`%s uses the legacy contextTypes API which is no longer supported and will be removed in the next major release. Use React.createContext() with static contextType instead.

Learn more about this warning here: https://reactjs.org/link/legacy-context`,O)),I.contextTypes&&C("contextTypes was defined as an instance property on %s. Use a static property to define contextTypes instead.",O),u.contextType&&u.contextTypes&&!Y0.has(u)&&(Y0.add(u),C("%s declares both contextTypes and contextType static properties. The legacy contextTypes property will be ignored.",O)),typeof I.componentShouldUpdate=="function"&&C("%s has a method called componentShouldUpdate(). Did you mean shouldComponentUpdate()? The name is phrased as a question because the function is expected to return a value.",O),u.prototype&&u.prototype.isPureReactComponent&&typeof I.shouldComponentUpdate<"u"&&C("%s has a method called shouldComponentUpdate(). shouldComponentUpdate should not be used when extending React.PureComponent. Please extend React.Component if shouldComponentUpdate is used.",Nr(u)||"A pure component"),typeof I.componentDidUnmount=="function"&&C("%s has a method called componentDidUnmount(). But there is no such lifecycle method. Did you mean componentWillUnmount()?",O),typeof I.componentDidReceiveProps=="function"&&C("%s has a method called componentDidReceiveProps(). But there is no such lifecycle method. If you meant to update the state in response to changing props, use componentWillReceiveProps(). If you meant to fetch data or run side-effects or mutations after React has updated the UI, use componentDidUpdate().",O),typeof I.componentWillRecieveProps=="function"&&C("%s has a method called componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",O),typeof I.UNSAFE_componentWillRecieveProps=="function"&&C("%s has a method called UNSAFE_componentWillRecieveProps(). Did you mean UNSAFE_componentWillReceiveProps()?",O);var Y=I.props!==w;I.props!==void 0&&Y&&C("%s(...): When calling super() in `%s`, make sure to pass up the same props that your component's constructor was passed.",O,O),I.defaultProps&&C("Setting defaultProps as an instance property on %s is not supported and will be ignored. Instead, define defaultProps as a static property on %s.",O,O),typeof I.getSnapshotBeforeUpdate=="function"&&typeof I.componentDidUpdate!="function"&&!W0.has(u)&&(W0.add(u),C("%s: getSnapshotBeforeUpdate() should be used with componentDidUpdate(). This component defines getSnapshotBeforeUpdate() only.",Nr(u))),typeof I.getDerivedStateFromProps=="function"&&C("%s: getDerivedStateFromProps() is defined as an instance method and will be ignored. Instead, declare it as a static method.",O),typeof I.getDerivedStateFromError=="function"&&C("%s: getDerivedStateFromError() is defined as an instance method and will be ignored. Instead, declare it as a static method.",O),typeof u.getSnapshotBeforeUpdate=="function"&&C("%s: getSnapshotBeforeUpdate() is defined as a static method and will be ignored. Instead, declare it as an instance method.",O);var oe=I.state;oe&&(typeof oe!="object"||Sr(oe))&&C("%s.state: must be set to an object or null",O),typeof I.getChildContext=="function"&&typeof u.childContextTypes!="object"&&C("%s.getChildContext(): childContextTypes must be defined in order to use getChildContext().",O)}}function p1(l,u){u.updater=Sv,l.stateNode=u,lx(u,l),u._reactInternalInstance=wv}function m1(l,u,w){var I=!1,O=ol,G=ol,Y=u.contextType;if("contextType"in u){var oe=Y===null||Y!==void 0&&Y.$$typeof===ie&&Y._context===void 0;if(!oe&&!Zf.has(u)){Zf.add(u);var fe="";Y===void 0?fe=" However, it is set to undefined. This can be caused by a typo or by mixing up named and default imports. This can also happen due to a circular dependency, so try moving the createContext() call to a separate file.":typeof Y!="object"?fe=" However, it is set to a "+typeof Y+".":Y.$$typeof===vi?fe=" Did you accidentally pass the Context.Provider instead?":Y._context!==void 0?fe=" Did you accidentally pass the Context.Consumer instead?":fe=" However, it is set to an object with keys {"+Object.keys(Y).join(", ")+"}.",C("%s defines an invalid contextType. contextType should point to the Context object returned by React.createContext().%s",Nr(u)||"Component",fe)}}if(typeof Y=="object"&&Y!==null)G=Fo(Y);else{O=kd(l,u,!0);var Oe=u.contextTypes;I=Oe!=null,G=I?Vh(l,O):ol}var Ne=new u(w,G);if(l.mode&lo){Ua(!0);try{Ne=new u(w,G)}finally{Ua(!1)}}var ft=l.memoizedState=Ne.state!==null&&Ne.state!==void 0?Ne.state:null;p1(l,Ne);{if(typeof u.getDerivedStateFromProps=="function"&&ft===null){var dt=Nr(u)||"Component";$0.has(dt)||($0.add(dt),C("`%s` uses `getDerivedStateFromProps` but its initial state is %s. This is not recommended. Instead, define the initial state by assigning an object to `this.state` in the constructor of `%s`. This ensures that `getDerivedStateFromProps` arguments have a consistent shape.",dt,Ne.state===null?"null":"undefined",dt))}if(typeof u.getDerivedStateFromProps=="function"||typeof Ne.getSnapshotBeforeUpdate=="function"){var Vt=null,jt=null,ii=null;if(typeof Ne.componentWillMount=="function"&&Ne.componentWillMount.__suppressDeprecationWarning!==!0?Vt="componentWillMount":typeof Ne.UNSAFE_componentWillMount=="function"&&(Vt="UNSAFE_componentWillMount"),typeof Ne.componentWillReceiveProps=="function"&&Ne.componentWillReceiveProps.__suppressDeprecationWarning!==!0?jt="componentWillReceiveProps":typeof Ne.UNSAFE_componentWillReceiveProps=="function"&&(jt="UNSAFE_componentWillReceiveProps"),typeof Ne.componentWillUpdate=="function"&&Ne.componentWillUpdate.__suppressDeprecationWarning!==!0?ii="componentWillUpdate":typeof Ne.UNSAFE_componentWillUpdate=="function"&&(ii="UNSAFE_componentWillUpdate"),Vt!==null||jt!==null||ii!==null){var Ji=Nr(u)||"Component",Fn=typeof u.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";q0.has(Ji)||(q0.add(Ji),C(`Unsafe legacy lifecycles will not be called for components using new component APIs.

%s uses %s but also contains the following legacy lifecycles:%s%s%s

The above lifecycles should be removed. Learn more about this warning here:
https://reactjs.org/link/unsafe-component-lifecycles`,Ji,Fn,Vt!==null?`
  `+Vt:"",jt!==null?`
  `+jt:"",ii!==null?`
  `+ii:""))}}}return I&&ww(l,O,G),Ne}function fE(l,u){var w=u.state;typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount(),w!==u.state&&(C("%s.componentWillMount(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",pn(l)||"Component"),Sv.enqueueReplaceState(u,u.state,null))}function g1(l,u,w,I){var O=u.state;if(typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps(w,I),typeof u.UNSAFE_componentWillReceiveProps=="function"&&u.UNSAFE_componentWillReceiveProps(w,I),u.state!==O){{var G=pn(l)||"Component";H0.has(G)||(H0.add(G),C("%s.componentWillReceiveProps(): Assigning directly to this.state is deprecated (except inside a component's constructor). Use setState instead.",G))}Sv.enqueueReplaceState(u,u.state,null)}}function K0(l,u,w,I){dE(l,u,w);var O=l.stateNode;O.props=w,O.state=l.memoizedState,O.refs={},v0(l);var G=u.contextType;if(typeof G=="object"&&G!==null)O.context=Fo(G);else{var Y=kd(l,u,!0);O.context=Vh(l,Y)}{if(O.state===w){var oe=Nr(u)||"Component";X0.has(oe)||(X0.add(oe),C("%s: It is not recommended to assign props directly to state because updates to props won't be reflected in state. In most cases, it is better to use props directly.",oe))}l.mode&lo&&Yu.recordLegacyContextWarning(l,O),Yu.recordUnsafeLifecycleWarnings(l,O)}O.state=l.memoizedState;var fe=u.getDerivedStateFromProps;if(typeof fe=="function"&&(g_(l,u,fe,w),O.state=l.memoizedState),typeof u.getDerivedStateFromProps!="function"&&typeof O.getSnapshotBeforeUpdate!="function"&&(typeof O.UNSAFE_componentWillMount=="function"||typeof O.componentWillMount=="function")&&(fE(l,O),b0(l,w,O,I),O.state=l.memoizedState),typeof O.componentDidMount=="function"){var Oe=Qr;Oe|=Ou,(l.mode&Vl)!==Sn&&(Oe|=Ul),l.flags|=Oe}}function Xf(l,u,w,I){var O=l.stateNode,G=l.memoizedProps;O.props=G;var Y=O.context,oe=u.contextType,fe=ol;if(typeof oe=="object"&&oe!==null)fe=Fo(oe);else{var Oe=kd(l,u,!0);fe=Vh(l,Oe)}var Ne=u.getDerivedStateFromProps,ft=typeof Ne=="function"||typeof O.getSnapshotBeforeUpdate=="function";!ft&&(typeof O.UNSAFE_componentWillReceiveProps=="function"||typeof O.componentWillReceiveProps=="function")&&(G!==w||Y!==fe)&&g1(l,O,w,fe),Hw();var dt=l.memoizedState,Vt=O.state=dt;if(b0(l,w,O,I),Vt=l.memoizedState,G===w&&dt===Vt&&!Zx()&&!iv()){if(typeof O.componentDidMount=="function"){var jt=Qr;jt|=Ou,(l.mode&Vl)!==Sn&&(jt|=Ul),l.flags|=jt}return!1}typeof Ne=="function"&&(g_(l,u,Ne,w),Vt=l.memoizedState);var ii=iv()||f1(l,u,G,w,dt,Vt,fe);if(ii){if(!ft&&(typeof O.UNSAFE_componentWillMount=="function"||typeof O.componentWillMount=="function")&&(typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount()),typeof O.componentDidMount=="function"){var Ji=Qr;Ji|=Ou,(l.mode&Vl)!==Sn&&(Ji|=Ul),l.flags|=Ji}}else{if(typeof O.componentDidMount=="function"){var Fn=Qr;Fn|=Ou,(l.mode&Vl)!==Sn&&(Fn|=Ul),l.flags|=Fn}l.memoizedProps=w,l.memoizedState=Vt}return O.props=w,O.state=Vt,O.context=fe,ii}function GA(l,u,w,I,O){var G=u.stateNode;au(l,u);var Y=u.memoizedProps,oe=u.type===u.elementType?Y:nh(u.type,Y);G.props=oe;var fe=u.pendingProps,Oe=G.context,Ne=w.contextType,ft=ol;if(typeof Ne=="object"&&Ne!==null)ft=Fo(Ne);else{var dt=kd(u,w,!0);ft=Vh(u,dt)}var Vt=w.getDerivedStateFromProps,jt=typeof Vt=="function"||typeof G.getSnapshotBeforeUpdate=="function";!jt&&(typeof G.UNSAFE_componentWillReceiveProps=="function"||typeof G.componentWillReceiveProps=="function")&&(Y!==fe||Oe!==ft)&&g1(u,G,I,ft),Hw();var ii=u.memoizedState,Ji=G.state=ii;if(b0(u,I,G,O),Ji=u.memoizedState,Y===fe&&ii===Ji&&!Zx()&&!iv()&&!En)return typeof G.componentDidUpdate=="function"&&(Y!==l.memoizedProps||ii!==l.memoizedState)&&(u.flags|=Qr),typeof G.getSnapshotBeforeUpdate=="function"&&(Y!==l.memoizedProps||ii!==l.memoizedState)&&(u.flags|=Bl),!1;typeof Vt=="function"&&(g_(u,w,Vt,I),Ji=u.memoizedState);var Fn=iv()||f1(u,w,oe,I,ii,Ji,ft)||En;return Fn?(!jt&&(typeof G.UNSAFE_componentWillUpdate=="function"||typeof G.componentWillUpdate=="function")&&(typeof G.componentWillUpdate=="function"&&G.componentWillUpdate(I,Ji,ft),typeof G.UNSAFE_componentWillUpdate=="function"&&G.UNSAFE_componentWillUpdate(I,Ji,ft)),typeof G.componentDidUpdate=="function"&&(u.flags|=Qr),typeof G.getSnapshotBeforeUpdate=="function"&&(u.flags|=Bl)):(typeof G.componentDidUpdate=="function"&&(Y!==l.memoizedProps||ii!==l.memoizedState)&&(u.flags|=Qr),typeof G.getSnapshotBeforeUpdate=="function"&&(Y!==l.memoizedProps||ii!==l.memoizedState)&&(u.flags|=Bl),u.memoizedProps=I,u.memoizedState=Ji),G.props=I,G.state=Ji,G.context=ft,Fn}function Tm(l,u){return{value:l,source:u,stack:Rc(u),digest:null}}function _1(l,u,w){return{value:l,source:null,stack:w??null,digest:u??null}}function J0(l,u){return!0}function y1(l,u){try{var w=J0(l,u);if(w===!1)return;var I=u.value,O=u.source,G=u.stack,Y=G!==null?G:"";if(I!=null&&I._suppressLogging){if(l.tag===N)return;console.error(I)}var oe=O?pn(O):null,fe=oe?"The above error occurred in the <"+oe+"> component:":"The above error occurred in one of your React components:",Oe;if(l.tag===K)Oe=`Consider adding an error boundary to your tree to customize error handling behavior.
Visit https://reactjs.org/link/error-boundaries to learn more about error boundaries.`;else{var Ne=pn(l)||"Anonymous";Oe="React will try to recreate this component tree from scratch "+("using the error boundary you provided, "+Ne+".")}var ft=fe+`
`+Y+`

`+(""+Oe);console.error(ft)}catch(dt){setTimeout(function(){throw dt})}}var HA=typeof WeakMap=="function"?WeakMap:Map;function pE(l,u,w){var I=th(gn,w);I.tag=Qy,I.payload={element:null};var O=u.value;return I.callback=function(){$2(O),y1(l,u)},I}function v1(l,u,w){var I=th(gn,w);I.tag=Qy;var O=l.type.getDerivedStateFromError;if(typeof O=="function"){var G=u.value;I.payload=function(){return O(G)},I.callback=function(){LD(l),y1(l,u)}}var Y=l.stateNode;return Y!==null&&typeof Y.componentDidCatch=="function"&&(I.callback=function(){LD(l),y1(l,u),typeof O!="function"&&G2(this);var fe=u.value,Oe=u.stack;this.componentDidCatch(fe,{componentStack:Oe!==null?Oe:""}),typeof O!="function"&&(ar(l.lanes,Zn)||C("%s: Error boundaries should implement getDerivedStateFromError(). In that method, return a state update to display an error message or fallback UI.",pn(l)||"Unknown"))}),I}function mE(l,u,w){var I=l.pingCache,O;if(I===null?(I=l.pingCache=new HA,O=new Set,I.set(u,O)):(O=I.get(u),O===void 0&&(O=new Set,I.set(u,O))),!O.has(w)){O.add(w);var G=W2.bind(null,l,u,w);dc&&N1(l,w),u.then(G,G)}}function $A(l,u,w,I){var O=l.updateQueue;if(O===null){var G=new Set;G.add(w),l.updateQueue=G}else O.add(w)}function WA(l,u){var w=l.tag;if((l.mode&Ln)===Sn&&(w===z||w===He||w===Nt)){var I=l.alternate;I?(l.updateQueue=I.updateQueue,l.memoizedState=I.memoizedState,l.lanes=I.lanes):(l.updateQueue=null,l.memoizedState=null)}}function gE(l){var u=l;do{if(u.tag===it&&Nd(u))return u;u=u.return}while(u!==null);return null}function _E(l,u,w,I,O){if((l.mode&Ln)===Sn){if(l===u)l.flags|=us;else{if(l.flags|=Hr,w.flags|=gd,w.flags&=-52805,w.tag===N){var G=w.alternate;if(G===null)w.tag=yi;else{var Y=th(gn,Zn);Y.tag=Bf,_c(w,Y,Zn)}}w.lanes=fr(w.lanes,Zn)}return l}return l.flags|=us,l.lanes=O,l}function qA(l,u,w,I,O){if(w.flags|=Ts,dc&&N1(l,O),I!==null&&typeof I=="object"&&typeof I.then=="function"){var G=I;WA(w),Ds()&&w.mode&Ln&&n0();var Y=gE(u);if(Y!==null){Y.flags&=~Nl,_E(Y,u,w,l,O),Y.mode&Ln&&mE(l,G,O),$A(Y,l,G);return}else{if(!yg(O)){mE(l,G,O),fR();return}var oe=new Error("A component suspended while responding to synchronous input. This will cause the UI to be replaced with a loading indicator. To fix, updates that suspend should be wrapped with startTransition.");I=oe}}else if(Ds()&&w.mode&Ln){n0();var fe=gE(u);if(fe!==null){(fe.flags&us)===Mn&&(fe.flags|=Nl),_E(fe,u,w,l,O),kw(Tm(I,w));return}}I=Tm(I,w),L2(I);var Oe=u;do{switch(Oe.tag){case K:{var Ne=I;Oe.flags|=us;var ft=Dh(O);Oe.lanes=fr(Oe.lanes,ft);var dt=pE(Oe,Ne,ft);x0(Oe,dt);return}case N:var Vt=I,jt=Oe.type,ii=Oe.stateNode;if((Oe.flags&Hr)===Mn&&(typeof jt.getDerivedStateFromError=="function"||ii!==null&&typeof ii.componentDidCatch=="function"&&!CD(ii))){Oe.flags|=us;var Ji=Dh(O);Oe.lanes=fr(Oe.lanes,Ji);var Fn=v1(Oe,Vt,Ji);x0(Oe,Fn);return}break}Oe=Oe.return}while(Oe!==null)}function ZA(){return null}var Hs=h.ReactCurrentOwner,Il=!1,x1,__,Q0,b1,eb,Yf,tb,ib,Ev;x1={},__={},Q0={},b1={},eb={},Yf=!1,tb={},ib={},Ev={};function hl(l,u,w,I){l===null?u.child=u0(u,null,w,I):u.child=Ku(u,l.child,w,I)}function ho(l,u,w,I){u.child=Ku(u,l.child,null,I),u.child=Ku(u,null,w,I)}function Sm(l,u,w,I,O){if(u.type!==u.elementType){var G=w.propTypes;G&&Qc(G,I,"prop",Nr(w))}var Y=w.render,oe=u.ref,fe,Oe;Qu(u,O),Th(u);{if(Hs.current=u,_l(!0),fe=Wh(l,u,Y,I,oe,O),Oe=qh(),u.mode&lo){Ua(!0);try{fe=Wh(l,u,Y,I,oe,O),Oe=qh()}finally{Ua(!1)}}_l(!1)}return $c(),l!==null&&!Il?(uv(l,u,O),le(l,u,O)):(Ds()&&Oe&&t0(u),u.flags|=uc,hl(l,u,fe,O),u.child)}function y_(l,u,w,I,O){if(l===null){var G=w.type;if(cL(G)&&w.compare===null&&w.defaultProps===void 0){var Y=G;return Y=db(G),u.tag=Nt,u.type=Y,x_(u,G),v_(l,u,Y,I,O)}{var oe=G.propTypes;if(oe&&Qc(oe,I,"prop",Nr(G)),w.defaultProps!==void 0){var fe=Nr(G)||"Unknown";Ev[fe]||(C("%s: Support for defaultProps will be removed from memo components in a future major release. Use JavaScript default parameters instead.",fe),Ev[fe]=!0)}}var Oe=SR(w.type,null,I,u,u.mode,O);return Oe.ref=u.ref,Oe.return=u,u.child=Oe,Oe}{var Ne=w.type,ft=Ne.propTypes;ft&&Qc(ft,I,"prop",Nr(Ne))}var dt=l.child,Vt=Re(l,O);if(!Vt){var jt=dt.memoizedProps,ii=w.compare;if(ii=ii!==null?ii:Rd,ii(jt,I)&&l.ref===u.ref)return le(l,u,O)}u.flags|=uc;var Ji=Ov(dt,I);return Ji.ref=u.ref,Ji.return=u,u.child=Ji,Ji}function v_(l,u,w,I,O){if(u.type!==u.elementType){var G=u.elementType;if(G.$$typeof===ye){var Y=G,oe=Y._payload,fe=Y._init;try{G=fe(oe)}catch{G=null}var Oe=G&&G.propTypes;Oe&&Qc(Oe,I,"prop",Nr(G))}}if(l!==null){var Ne=l.memoizedProps;if(Rd(Ne,I)&&l.ref===u.ref&&u.type===l.type)if(Il=!1,u.pendingProps=I=Ne,Re(l,O))(l.flags&gd)!==Mn&&(Il=!0);else return u.lanes=l.lanes,le(l,u,O)}return Cv(l,u,w,I,O)}function w1(l,u,w){var I=u.pendingProps,O=I.children,G=l!==null?l.memoizedState:null;if(I.mode==="hidden"||hr)if((u.mode&Ln)===Sn){var Y={baseLanes:mi,cachePool:null,transitions:null};u.memoizedState=Y,FE(u,w)}else if(ar(w,wl)){var ft={baseLanes:mi,cachePool:null,transitions:null};u.memoizedState=ft;var dt=G!==null?G.baseLanes:w;FE(u,dt)}else{var oe=null,fe;if(G!==null){var Oe=G.baseLanes;fe=fr(Oe,w)}else fe=w;u.lanes=u.childLanes=wl;var Ne={baseLanes:fe,cachePool:oe,transitions:null};return u.memoizedState=Ne,u.updateQueue=null,FE(u,fe),null}else{var Vt;G!==null?(Vt=fr(G.baseLanes,w),u.memoizedState=null):Vt=w,FE(u,Vt)}return hl(l,u,O,w),u.child}function XA(l,u,w){var I=u.pendingProps;return hl(l,u,I,w),u.child}function YA(l,u,w){var I=u.pendingProps.children;return hl(l,u,I,w),u.child}function T1(l,u,w){{u.flags|=Qr;{var I=u.stateNode;I.effectDuration=0,I.passiveEffectDuration=0}}var O=u.pendingProps,G=O.children;return hl(l,u,G,w),u.child}function uu(l,u){var w=u.ref;(l===null&&w!==null||l!==null&&l.ref!==w)&&(u.flags|=Bc,u.flags|=Ip)}function Cv(l,u,w,I,O){if(u.type!==u.elementType){var G=w.propTypes;G&&Qc(G,I,"prop",Nr(w))}var Y;{var oe=kd(u,w,!0);Y=Vh(u,oe)}var fe,Oe;Qu(u,O),Th(u);{if(Hs.current=u,_l(!0),fe=Wh(l,u,w,I,Y,O),Oe=qh(),u.mode&lo){Ua(!0);try{fe=Wh(l,u,w,I,Y,O),Oe=qh()}finally{Ua(!1)}}_l(!1)}return $c(),l!==null&&!Il?(uv(l,u,O),le(l,u,O)):(Ds()&&Oe&&t0(u),u.flags|=uc,hl(l,u,fe,O),u.child)}function yE(l,u,w,I,O){{switch(SL(u)){case!1:{var G=u.stateNode,Y=u.type,oe=new Y(u.memoizedProps,G.context),fe=oe.state;G.updater.enqueueSetState(G,fe,null);break}case!0:{u.flags|=Hr,u.flags|=us;var Oe=new Error("Simulated error coming from DevTools"),Ne=Dh(O);u.lanes=fr(u.lanes,Ne);var ft=v1(u,Tm(Oe,u),Ne);x0(u,ft);break}}if(u.type!==u.elementType){var dt=w.propTypes;dt&&Qc(dt,I,"prop",Nr(w))}}var Vt;eu(w)?(Vt=!0,Yx(u)):Vt=!1,Qu(u,O);var jt=u.stateNode,ii;jt===null?(ae(l,u),m1(u,w,I),K0(u,w,I,O),ii=!0):l===null?ii=Xf(u,w,I,O):ii=GA(l,u,w,I,O);var Ji=vc(l,u,w,ii,Vt,O);{var Fn=u.stateNode;ii&&Fn.props!==I&&(Yf||C("It looks like %s is reassigning its own `this.props` while rendering. This is not supported and can lead to confusing bugs.",pn(u)||"a component"),Yf=!0)}return Ji}function vc(l,u,w,I,O,G){uu(l,u);var Y=(u.flags&Hr)!==Mn;if(!I&&!Y)return O&&Tw(u,w,!1),le(l,u,G);var oe=u.stateNode;Hs.current=u;var fe;if(Y&&typeof w.getDerivedStateFromError!="function")fe=null,hE();else{Th(u);{if(_l(!0),fe=oe.render(),u.mode&lo){Ua(!0);try{oe.render()}finally{Ua(!1)}}_l(!1)}$c()}return u.flags|=uc,l!==null&&Y?ho(l,u,fe,G):hl(l,u,fe,G),u.memoizedState=oe.state,O&&Tw(u,w,!0),u.child}function vE(l){var u=l.stateNode;u.pendingContext?Pf(l,u.pendingContext,u.pendingContext!==u.context):u.context&&Pf(l,u.context,!1),av(l,u.containerInfo)}function KA(l,u,w){if(vE(u),l===null)throw new Error("Should have a current fiber. This is a bug in React.");var I=u.pendingProps,O=u.memoizedState,G=O.element;au(l,u),b0(u,I,null,w);var Y=u.memoizedState;u.stateNode;var oe=Y.element;if(O.isDehydrated){var fe={element:oe,isDehydrated:!1,cache:Y.cache,pendingSuspenseBoundaries:Y.pendingSuspenseBoundaries,transitions:Y.transitions},Oe=u.updateQueue;if(Oe.baseState=fe,u.memoizedState=fe,u.flags&Nl){var Ne=Tm(new Error("There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering."),u);return xE(l,u,oe,w,Ne)}else if(oe!==G){var ft=Tm(new Error("This root received an early update, before anything was able hydrate. Switched the entire root to client rendering."),u);return xE(l,u,oe,w,ft)}else{VS(u);var dt=u0(u,null,oe,w);u.child=dt;for(var Vt=dt;Vt;)Vt.flags=Vt.flags&~so|Vc,Vt=Vt.sibling}}else{if(Xg(),oe===G)return le(l,u,w);hl(l,u,oe,w)}return u.child}function xE(l,u,w,I,O){return Xg(),kw(O),u.flags|=Nl,hl(l,u,w,I),u.child}function hu(l,u,w){$w(u),l===null&&Ow(u);var I=u.type,O=u.pendingProps,G=l!==null?l.memoizedProps:null,Y=O.children,oe=Lx(I,O);return oe?Y=null:G!==null&&Lx(I,G)&&(u.flags|=Rp),uu(l,u),hl(l,u,Y,w),u.child}function JA(l,u){return l===null&&Ow(u),null}function bE(l,u,w,I){ae(l,u);var O=u.pendingProps,G=w,Y=G._payload,oe=G._init,fe=oe(Y);u.type=fe;var Oe=u.tag=uL(fe),Ne=nh(fe,O),ft;switch(Oe){case z:return x_(u,fe),u.type=fe=db(fe),ft=Cv(null,u,fe,Ne,I),ft;case N:return u.type=fe=yR(fe),ft=yE(null,u,fe,Ne,I),ft;case He:return u.type=fe=vR(fe),ft=Sm(null,u,fe,Ne,I),ft;case kt:{if(u.type!==u.elementType){var dt=fe.propTypes;dt&&Qc(dt,Ne,"prop",Nr(fe))}return ft=y_(null,u,fe,nh(fe.type,Ne),I),ft}}var Vt="";throw fe!==null&&typeof fe=="object"&&fe.$$typeof===ye&&(Vt=" Did you wrap a component in React.lazy() more than once?"),new Error("Element type is invalid. Received a promise that resolves to: "+fe+". "+("Lazy element type must resolve to a class or function."+Vt))}function QA(l,u,w,I,O){ae(l,u),u.tag=N;var G;return eu(w)?(G=!0,Yx(u)):G=!1,Qu(u,O),m1(u,w,I),K0(u,w,I,O),vc(null,u,w,!0,G,O)}function S1(l,u,w,I){ae(l,u);var O=u.pendingProps,G;{var Y=kd(u,w,!1);G=Vh(u,Y)}Qu(u,I);var oe,fe;Th(u);{if(w.prototype&&typeof w.prototype.render=="function"){var Oe=Nr(w)||"Unknown";x1[Oe]||(C("The <%s /> component appears to have a render method, but doesn't extend React.Component. This is likely to cause errors. Change %s to extend React.Component instead.",Oe,Oe),x1[Oe]=!0)}u.mode&lo&&Yu.recordLegacyContextWarning(u,null),_l(!0),Hs.current=u,oe=Wh(null,u,w,O,G,I),fe=qh(),_l(!1)}if($c(),u.flags|=uc,typeof oe=="object"&&oe!==null&&typeof oe.render=="function"&&oe.$$typeof===void 0){var Ne=Nr(w)||"Unknown";__[Ne]||(C("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",Ne,Ne,Ne),__[Ne]=!0)}if(typeof oe=="object"&&oe!==null&&typeof oe.render=="function"&&oe.$$typeof===void 0){{var ft=Nr(w)||"Unknown";__[ft]||(C("The <%s /> component appears to be a function component that returns a class instance. Change %s to a class that extends React.Component instead. If you can't use a class try assigning the prototype on the function as a workaround. `%s.prototype = React.Component.prototype`. Don't use an arrow function since it cannot be called with `new` by React.",ft,ft,ft),__[ft]=!0)}u.tag=N,u.memoizedState=null,u.updateQueue=null;var dt=!1;return eu(w)?(dt=!0,Yx(u)):dt=!1,u.memoizedState=oe.state!==null&&oe.state!==void 0?oe.state:null,v0(u),p1(u,oe),K0(u,w,O,I),vc(null,u,w,!0,dt,I)}else{if(u.tag=z,u.mode&lo){Ua(!0);try{oe=Wh(null,u,w,O,G,I),fe=qh()}finally{Ua(!1)}}return Ds()&&fe&&t0(u),hl(null,u,oe,I),x_(u,w),u.child}}function x_(l,u){{if(u&&u.childContextTypes&&C("%s(...): childContextTypes cannot be defined on a function component.",u.displayName||u.name||"Component"),l.ref!==null){var w="",I=nc();I&&(w+=`

Check the render method of \``+I+"`.");var O=I||"",G=l._debugSource;G&&(O=G.fileName+":"+G.lineNumber),eb[O]||(eb[O]=!0,C("Function components cannot be given refs. Attempts to access this ref will fail. Did you mean to use React.forwardRef()?%s",w))}if(u.defaultProps!==void 0){var Y=Nr(u)||"Unknown";Ev[Y]||(C("%s: Support for defaultProps will be removed from function components in a future major release. Use JavaScript default parameters instead.",Y),Ev[Y]=!0)}if(typeof u.getDerivedStateFromProps=="function"){var oe=Nr(u)||"Unknown";b1[oe]||(C("%s: Function components do not support getDerivedStateFromProps.",oe),b1[oe]=!0)}if(typeof u.contextType=="object"&&u.contextType!==null){var fe=Nr(u)||"Unknown";Q0[fe]||(C("%s: Function components do not support contextType.",fe),Q0[fe]=!0)}}}var nb={dehydrated:null,treeContext:null,retryLane:co};function rb(l){return{baseLanes:l,cachePool:ZA(),transitions:null}}function wE(l,u){var w=null;return{baseLanes:fr(l.baseLanes,u),cachePool:w,transitions:l.transitions}}function TE(l,u,w,I){if(u!==null){var O=u.memoizedState;if(O===null)return!1}return Zw(l,ov)}function SE(l,u){return yf(l.childLanes,u)}function EE(l,u,w){var I=u.pendingProps;EL(u)&&(u.flags|=Hr);var O=ou.current,G=!1,Y=(u.flags&Hr)!==Mn;if(Y||TE(O,l)?(G=!0,u.flags&=~Hr):(l===null||l.memoizedState!==null)&&(O=LA(O,n_)),O=dm(O),jf(u,O),l===null){Ow(u);var oe=u.memoizedState;if(oe!==null){var fe=oe.dehydrated;if(fe!==null)return e(u,fe)}var Oe=I.children,Ne=I.fallback;if(G){var ft=E1(u,Oe,Ne,w),dt=u.child;return dt.memoizedState=rb(w),u.memoizedState=nb,ft}else return ab(u,Oe)}else{var Vt=l.memoizedState;if(Vt!==null){var jt=Vt.dehydrated;if(jt!==null)return i(l,u,Y,I,jt,Vt,w)}if(G){var ii=I.fallback,Ji=I.children,Fn=A1(l,u,Ji,ii,w),Tn=u.child,ra=l.child.memoizedState;return Tn.memoizedState=ra===null?rb(w):wE(ra,w),Tn.childLanes=SE(l,w),u.memoizedState=nb,Fn}else{var Wr=I.children,Rt=Rv(l,u,Wr,w);return u.memoizedState=null,Rt}}}function ab(l,u,w){var I=l.mode,O={mode:"visible",children:u},G=Av(O,I);return G.return=l,l.child=G,G}function E1(l,u,w,I){var O=l.mode,G=l.child,Y={mode:"hidden",children:u},oe,fe;return(O&Ln)===Sn&&G!==null?(oe=G,oe.childLanes=mi,oe.pendingProps=Y,l.mode&Br&&(oe.actualDuration=0,oe.actualStartTime=-1,oe.selfBaseDuration=0,oe.treeBaseDuration=0),fe=C_(w,O,I,null)):(oe=Av(Y,O),fe=C_(w,O,I,null)),oe.return=l,fe.return=l,oe.sibling=fe,l.child=oe,fe}function Av(l,u,w){return FD(l,u,mi,null)}function C1(l,u){return Ov(l,u)}function Rv(l,u,w,I){var O=l.child,G=O.sibling,Y=C1(O,{mode:"visible",children:w});if((u.mode&Ln)===Sn&&(Y.lanes=I),Y.return=u,Y.sibling=null,G!==null){var oe=u.deletions;oe===null?(u.deletions=[G],u.flags|=_h):oe.push(G)}return u.child=Y,Y}function A1(l,u,w,I,O){var G=u.mode,Y=l.child,oe=Y.sibling,fe={mode:"hidden",children:w},Oe;if((G&Ln)===Sn&&u.child!==Y){var Ne=u.child;Oe=Ne,Oe.childLanes=mi,Oe.pendingProps=fe,u.mode&Br&&(Oe.actualDuration=0,Oe.actualStartTime=-1,Oe.selfBaseDuration=Y.selfBaseDuration,Oe.treeBaseDuration=Y.treeBaseDuration),u.deletions=null}else Oe=C1(Y,fe),Oe.subtreeFlags=Y.subtreeFlags&jc;var ft;return oe!==null?ft=Ov(oe,I):(ft=C_(I,G,O,null),ft.flags|=so),ft.return=u,Oe.return=u,Oe.sibling=ft,u.child=Oe,ft}function Iv(l,u,w,I){I!==null&&kw(I),Ku(u,l.child,null,w);var O=u.pendingProps,G=O.children,Y=ab(u,G);return Y.flags|=so,u.memoizedState=null,Y}function n(l,u,w,I,O){var G=u.mode,Y={mode:"visible",children:w},oe=Av(Y,G),fe=C_(I,G,O,null);return fe.flags|=so,oe.return=u,fe.return=u,oe.sibling=fe,u.child=oe,(u.mode&Ln)!==Sn&&Ku(u,l.child,null,O),fe}function e(l,u,w){return(l.mode&Ln)===Sn?(C("Cannot hydrate Suspense in legacy mode. Switch from ReactDOM.hydrate(element, container) to ReactDOMClient.hydrateRoot(container, <App />).render(element) or remove the Suspense components from the server rendered components."),l.lanes=Zn):_w(u)?l.lanes=Nu:l.lanes=wl,null}function i(l,u,w,I,O,G,Y){if(w)if(u.flags&Nl){u.flags&=~Nl;var Rt=_1(new Error("There was an error while hydrating this Suspense boundary. Switched to client rendering."));return Iv(l,u,Y,Rt)}else{if(u.memoizedState!==null)return u.child=l.child,u.flags|=Hr,null;var ni=I.children,It=I.fallback,Ei=n(l,u,ni,It,Y),sn=u.child;return sn.memoizedState=rb(Y),u.memoizedState=nb,Ei}else{if(Rw(),(u.mode&Ln)===Sn)return Iv(l,u,Y,null);if(_w(O)){var oe,fe,Oe;{var Ne=mA(O);oe=Ne.digest,fe=Ne.message,Oe=Ne.stack}var ft;fe?ft=new Error(fe):ft=new Error("The server could not finish this Suspense boundary, likely due to an error during server rendering. Switched to client rendering.");var dt=_1(ft,oe,Oe);return Iv(l,u,Y,dt)}var Vt=ar(Y,l.childLanes);if(Il||Vt){var jt=zE();if(jt!==null){var ii=uy(jt,Y);if(ii!==co&&ii!==G.retryLane){G.retryLane=ii;var Ji=gn;Xl(l,ii),Xs(jt,l,ii,Ji)}}fR();var Fn=_1(new Error("This Suspense boundary received an update before it finished hydrating. This caused the boundary to switch to client rendering. The usual way to fix this is to wrap the original update in startTransition."));return Iv(l,u,Y,Fn)}else if(gw(O)){u.flags|=Hr,u.child=l.child;var Tn=q2.bind(null,l);return AS(O,Tn),null}else{jS(u,O,G.treeContext);var ra=I.children,Wr=ab(u,ra);return Wr.flags|=Vc,Wr}}}function o(l,u,w){l.lanes=fr(l.lanes,u);var I=l.alternate;I!==null&&(I.lanes=fr(I.lanes,u)),y0(l.return,u,w)}function c(l,u,w){for(var I=u;I!==null;){if(I.tag===it){var O=I.memoizedState;O!==null&&o(I,w,l)}else if(I.tag===hi)o(I,w,l);else if(I.child!==null){I.child.return=I,I=I.child;continue}if(I===l)return;for(;I.sibling===null;){if(I.return===null||I.return===l)return;I=I.return}I.sibling.return=I.return,I=I.sibling}}function m(l){for(var u=l,w=null;u!==null;){var I=u.alternate;I!==null&&lv(I)===null&&(w=u),u=u.sibling}return w}function g(l){if(l!==void 0&&l!=="forwards"&&l!=="backwards"&&l!=="together"&&!tb[l])if(tb[l]=!0,typeof l=="string")switch(l.toLowerCase()){case"together":case"forwards":case"backwards":{C('"%s" is not a valid value for revealOrder on <SuspenseList />. Use lowercase "%s" instead.',l,l.toLowerCase());break}case"forward":case"backward":{C('"%s" is not a valid value for revealOrder on <SuspenseList />. React uses the -s suffix in the spelling. Use "%ss" instead.',l,l.toLowerCase());break}default:C('"%s" is not a supported revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',l);break}else C('%s is not a supported value for revealOrder on <SuspenseList />. Did you mean "together", "forwards" or "backwards"?',l)}function x(l,u){l!==void 0&&!ib[l]&&(l!=="collapsed"&&l!=="hidden"?(ib[l]=!0,C('"%s" is not a supported value for tail on <SuspenseList />. Did you mean "collapsed" or "hidden"?',l)):u!=="forwards"&&u!=="backwards"&&(ib[l]=!0,C('<SuspenseList tail="%s" /> is only valid if revealOrder is "forwards" or "backwards". Did you mean to specify revealOrder="forwards"?',l)))}function S(l,u){{var w=Sr(l),I=!w&&typeof _i(l)=="function";if(w||I){var O=w?"array":"iterable";return C("A nested %s was passed to row #%s in <SuspenseList />. Wrap it in an additional SuspenseList to configure its revealOrder: <SuspenseList revealOrder=...> ... <SuspenseList revealOrder=...>{%s}</SuspenseList> ... </SuspenseList>",O,u,O),!1}}return!0}function A(l,u){if((u==="forwards"||u==="backwards")&&l!==void 0&&l!==null&&l!==!1)if(Sr(l)){for(var w=0;w<l.length;w++)if(!S(l[w],w))return}else{var I=_i(l);if(typeof I=="function"){var O=I.call(l);if(O)for(var G=O.next(),Y=0;!G.done;G=O.next()){if(!S(G.value,Y))return;Y++}}else C('A single row was passed to a <SuspenseList revealOrder="%s" />. This is not useful since it needs multiple rows. Did you mean to pass multiple children or an array?',u)}}function M(l,u,w,I,O){var G=l.memoizedState;G===null?l.memoizedState={isBackwards:u,rendering:null,renderingStartTime:0,last:I,tail:w,tailMode:O}:(G.isBackwards=u,G.rendering=null,G.renderingStartTime=0,G.last=I,G.tail=w,G.tailMode=O)}function P(l,u,w){var I=u.pendingProps,O=I.revealOrder,G=I.tail,Y=I.children;g(O),x(G,O),A(Y,O),hl(l,u,Y,w);var oe=ou.current,fe=Zw(oe,ov);if(fe)oe=sv(oe,ov),u.flags|=Hr;else{var Oe=l!==null&&(l.flags&Hr)!==Mn;Oe&&c(u,u.child,w),oe=dm(oe)}if(jf(u,oe),(u.mode&Ln)===Sn)u.memoizedState=null;else switch(O){case"forwards":{var Ne=m(u.child),ft;Ne===null?(ft=u.child,u.child=null):(ft=Ne.sibling,Ne.sibling=null),M(u,!1,ft,Ne,G);break}case"backwards":{var dt=null,Vt=u.child;for(u.child=null;Vt!==null;){var jt=Vt.alternate;if(jt!==null&&lv(jt)===null){u.child=Vt;break}var ii=Vt.sibling;Vt.sibling=dt,dt=Vt,Vt=ii}M(u,!0,dt,null,G);break}case"together":{M(u,!1,null,null,void 0);break}default:u.memoizedState=null}return u.child}function k(l,u,w){av(u,u.stateNode.containerInfo);var I=u.pendingProps;return l===null?u.child=Ku(u,null,I,w):hl(l,u,I,w),u.child}var U=!1;function V(l,u,w){var I=u.type,O=I._context,G=u.pendingProps,Y=u.memoizedProps,oe=G.value;{"value"in G||U||(U=!0,C("The `value` prop is required for the `<Context.Provider>`. Did you misspell it or forget to pass it?"));var fe=u.type.propTypes;fe&&Qc(fe,G,"prop","Context.Provider")}if(g0(u,O,oe),Y!==null){var Oe=Y.value;if(Al(Oe,oe)){if(Y.children===G.children&&!Zx())return le(l,u,w)}else ZS(u,O,w)}var Ne=G.children;return hl(l,u,Ne,w),u.child}var q=!1;function J(l,u,w){var I=u.type;I._context===void 0?I!==I.Consumer&&(q||(q=!0,C("Rendering <Context> directly is not supported and will be removed in a future major release. Did you mean to render <Context.Consumer> instead?"))):I=I._context;var O=u.pendingProps,G=O.children;typeof G!="function"&&C("A context consumer was rendered with multiple children, or a child that isn't a function. A context consumer expects a single child that is a function. If you did pass a function, make sure there is no trailing or leading whitespace around it."),Qu(u,w);var Y=Fo(I);Th(u);var oe;return Hs.current=u,_l(!0),oe=G(Y),_l(!1),$c(),u.flags|=uc,hl(l,u,oe,w),u.child}function ee(){Il=!0}function ae(l,u){(u.mode&Ln)===Sn&&l!==null&&(l.alternate=null,u.alternate=null,u.flags|=so)}function le(l,u,w){return l!==null&&(u.dependencies=l.dependencies),hE(),F1(u.lanes),ar(w,u.childLanes)?(h0(l,u),u.child):null}function de(l,u,w){{var I=u.return;if(I===null)throw new Error("Cannot swap the root fiber.");if(l.alternate=null,u.alternate=null,w.index=u.index,w.sibling=u.sibling,w.return=u.return,w.ref=u.ref,u===I.child)I.child=w;else{var O=I.child;if(O===null)throw new Error("Expected parent to have a child.");for(;O.sibling!==u;)if(O=O.sibling,O===null)throw new Error("Expected to find the previous sibling.");O.sibling=w}var G=I.deletions;return G===null?(I.deletions=[l],I.flags|=_h):G.push(l),w.flags|=so,w}}function Re(l,u){var w=l.lanes;return!!ar(w,u)}function Se(l,u,w){switch(u.tag){case K:vE(u),u.stateNode,Xg();break;case ue:$w(u);break;case N:{var I=u.type;eu(I)&&Yx(u);break}case ne:av(u,u.stateNode.containerInfo);break;case Be:{var O=u.memoizedProps.value,G=u.type._context;g0(u,G,O);break}case Xe:{var Y=ar(w,u.childLanes);Y&&(u.flags|=Qr);{var oe=u.stateNode;oe.effectDuration=0,oe.passiveEffectDuration=0}}break;case it:{var fe=u.memoizedState;if(fe!==null){if(fe.dehydrated!==null)return jf(u,dm(ou.current)),u.flags|=Hr,null;var Oe=u.child,Ne=Oe.childLanes;if(ar(w,Ne))return EE(l,u,w);jf(u,dm(ou.current));var ft=le(l,u,w);return ft!==null?ft.sibling:null}else jf(u,dm(ou.current));break}case hi:{var dt=(l.flags&Hr)!==Mn,Vt=ar(w,u.childLanes);if(dt){if(Vt)return P(l,u,w);u.flags|=Hr}var jt=u.memoizedState;if(jt!==null&&(jt.rendering=null,jt.tail=null,jt.lastEffect=null),jf(u,ou.current),Vt)break;return null}case Dt:case Di:return u.lanes=mi,w1(l,u,w)}return le(l,u,w)}function Pe(l,u,w){if(u._debugNeedsRemount&&l!==null)return de(l,u,SR(u.type,u.key,u.pendingProps,u._debugOwner||null,u.mode,u.lanes));if(l!==null){var I=l.memoizedProps,O=u.pendingProps;if(I!==O||Zx()||u.type!==l.type)Il=!0;else{var G=Re(l,w);if(!G&&(u.flags&Hr)===Mn)return Il=!1,Se(l,u,w);(l.flags&gd)!==Mn?Il=!0:Il=!1}}else if(Il=!1,Ds()&&NS(u)){var Y=u.index,oe=Ew();Cw(u,oe,Y)}switch(u.lanes=mi,u.tag){case H:return S1(l,u,u.type,w);case oi:{var fe=u.elementType;return bE(l,u,fe,w)}case z:{var Oe=u.type,Ne=u.pendingProps,ft=u.elementType===Oe?Ne:nh(Oe,Ne);return Cv(l,u,Oe,ft,w)}case N:{var dt=u.type,Vt=u.pendingProps,jt=u.elementType===dt?Vt:nh(dt,Vt);return yE(l,u,dt,jt,w)}case K:return KA(l,u,w);case ue:return hu(l,u,w);case pe:return JA(l,u);case it:return EE(l,u,w);case ne:return k(l,u,w);case He:{var ii=u.type,Ji=u.pendingProps,Fn=u.elementType===ii?Ji:nh(ii,Ji);return Sm(l,u,ii,Fn,w)}case xe:return XA(l,u,w);case be:return YA(l,u,w);case Xe:return T1(l,u,w);case Be:return V(l,u,w);case je:return J(l,u,w);case kt:{var Tn=u.type,ra=u.pendingProps,Wr=nh(Tn,ra);if(u.type!==u.elementType){var Rt=Tn.propTypes;Rt&&Qc(Rt,Wr,"prop",Nr(Tn))}return Wr=nh(Tn.type,Wr),y_(l,u,Tn,Wr,w)}case Nt:return v_(l,u,u.type,u.pendingProps,w);case yi:{var ni=u.type,It=u.pendingProps,Ei=u.elementType===ni?It:nh(ni,It);return QA(l,u,ni,Ei,w)}case hi:return P(l,u,w);case Ti:break;case Dt:return w1(l,u,w)}throw new Error("Unknown unit of work tag ("+u.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function ke(l){l.flags|=Qr}function Fe(l){l.flags|=Bc,l.flags|=Ip}var rt,qe,ot,ht;rt=function(l,u,w,I){for(var O=u.child;O!==null;){if(O.tag===ue||O.tag===pe)Fy(l,O.stateNode);else if(O.tag!==ne){if(O.child!==null){O.child.return=O,O=O.child;continue}}if(O===u)return;for(;O.sibling===null;){if(O.return===null||O.return===u)return;O=O.return}O.sibling.return=O.return,O=O.sibling}},qe=function(l,u){},ot=function(l,u,w,I,O){var G=l.memoizedProps;if(G!==I){var Y=u.stateNode,oe=i_(),fe=dS(Y,w,G,I,O,oe);u.updateQueue=fe,fe&&ke(u)}},ht=function(l,u,w,I){w!==I&&ke(u)};function yt(l,u){if(!Ds())switch(l.tailMode){case"hidden":{for(var w=l.tail,I=null;w!==null;)w.alternate!==null&&(I=w),w=w.sibling;I===null?l.tail=null:I.sibling=null;break}case"collapsed":{for(var O=l.tail,G=null;O!==null;)O.alternate!==null&&(G=O),O=O.sibling;G===null?!u&&l.tail!==null?l.tail.sibling=null:l.tail=null:G.sibling=null;break}}}function Tt(l){var u=l.alternate!==null&&l.alternate.child===l.child,w=mi,I=Mn;if(u){if((l.mode&Br)!==Sn){for(var fe=l.selfBaseDuration,Oe=l.child;Oe!==null;)w=fr(w,fr(Oe.lanes,Oe.childLanes)),I|=Oe.subtreeFlags&jc,I|=Oe.flags&jc,fe+=Oe.treeBaseDuration,Oe=Oe.sibling;l.treeBaseDuration=fe}else for(var Ne=l.child;Ne!==null;)w=fr(w,fr(Ne.lanes,Ne.childLanes)),I|=Ne.subtreeFlags&jc,I|=Ne.flags&jc,Ne.return=l,Ne=Ne.sibling;l.subtreeFlags|=I}else{if((l.mode&Br)!==Sn){for(var O=l.actualDuration,G=l.selfBaseDuration,Y=l.child;Y!==null;)w=fr(w,fr(Y.lanes,Y.childLanes)),I|=Y.subtreeFlags,I|=Y.flags,O+=Y.actualDuration,G+=Y.treeBaseDuration,Y=Y.sibling;l.actualDuration=O,l.treeBaseDuration=G}else for(var oe=l.child;oe!==null;)w=fr(w,fr(oe.lanes,oe.childLanes)),I|=oe.subtreeFlags,I|=oe.flags,oe.return=l,oe=oe.sibling;l.subtreeFlags|=I}return l.childLanes=w,u}function Et(l,u,w){if(IA()&&(u.mode&Ln)!==Sn&&(u.flags&Hr)===Mn)return $S(u),Xg(),u.flags|=Nl|Ts|us,!1;var I=o0(u);if(w!==null&&w.dehydrated!==null)if(l===null){if(!I)throw new Error("A dehydrated suspense component was completed without a hydrated node. This is probably a bug in React.");if(AA(u),Tt(u),(u.mode&Br)!==Sn){var O=w!==null;if(O){var G=u.child;G!==null&&(u.treeBaseDuration-=G.treeBaseDuration)}}return!1}else{if(Xg(),(u.flags&Hr)===Mn&&(u.memoizedState=null),u.flags|=Qr,Tt(u),(u.mode&Br)!==Sn){var Y=w!==null;if(Y){var oe=u.child;oe!==null&&(u.treeBaseDuration-=oe.treeBaseDuration)}}return!1}else return WS(),!0}function pt(l,u,w){var I=u.pendingProps;switch(Aw(u),u.tag){case H:case oi:case Nt:case z:case He:case xe:case be:case Xe:case je:case kt:return Tt(u),null;case N:{var O=u.type;return eu(O)&&rm(u),Tt(u),null}case K:{var G=u.stateNode;if(t_(u),Gy(u),E0(),G.pendingContext&&(G.context=G.pendingContext,G.pendingContext=null),l===null||l.child===null){var Y=o0(u);if(Y)ke(u);else if(l!==null){var oe=l.memoizedState;(!oe.isDehydrated||(u.flags&Nl)!==Mn)&&(u.flags|=Bl,WS())}}return qe(l,u),Tt(u),null}case ue:{Ww(u);var fe=JS(),Oe=u.type;if(l!==null&&u.stateNode!=null)ot(l,u,Oe,I,fe),l.ref!==u.ref&&Fe(u);else{if(!I){if(u.stateNode===null)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");return Tt(u),null}var Ne=i_(),ft=o0(u);if(ft)$y(u,fe,Ne)&&ke(u);else{var dt=kx(Oe,I,fe,Ne,u);rt(dt,u,!1,!1),u.stateNode=dt,hS(dt,Oe,I,fe)&&ke(u)}u.ref!==null&&Fe(u)}return Tt(u),null}case pe:{var Vt=I;if(l&&u.stateNode!=null){var jt=l.memoizedProps;ht(l,u,jt,Vt)}else{if(typeof Vt!="string"&&u.stateNode===null)throw new Error("We must have new props for new mounts. This error is likely caused by a bug in React. Please file an issue.");var ii=JS(),Ji=i_(),Fn=o0(u);Fn?GS(u)&&ke(u):u.stateNode=fS(Vt,ii,Ji,u)}return Tt(u),null}case it:{Gh(u);var Tn=u.memoizedState;if(l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){var ra=Et(l,u,Tn);if(!ra)return u.flags&us?u:null}if((u.flags&Hr)!==Mn)return u.lanes=w,(u.mode&Br)!==Sn&&wm(u),u;var Wr=Tn!==null,Rt=l!==null&&l.memoizedState!==null;if(Wr!==Rt&&Wr){var ni=u.child;if(ni.flags|=hc,(u.mode&Ln)!==Sn){var It=l===null&&(u.memoizedProps.unstable_avoidThisFallback!==!0||!0);It||Zw(ou.current,n_)?k2():fR()}}var Ei=u.updateQueue;if(Ei!==null&&(u.flags|=Qr),Tt(u),(u.mode&Br)!==Sn&&Wr){var sn=u.child;sn!==null&&(u.treeBaseDuration-=sn.treeBaseDuration)}return null}case ne:return t_(u),qe(l,u),l===null&&vA(u.stateNode.containerInfo),Tt(u),null;case Be:var nn=u.type._context;return _0(nn,u),Tt(u),null;case yi:{var sr=u.type;return eu(sr)&&rm(u),Tt(u),null}case hi:{Gh(u);var vr=u.memoizedState;if(vr===null)return Tt(u),null;var $a=(u.flags&Hr)!==Mn,xa=vr.rendering;if(xa===null)if($a)yt(vr,!1);else{var _s=z2()&&(l===null||(l.flags&Hr)===Mn);if(!_s)for(var ba=u.child;ba!==null;){var ns=lv(ba);if(ns!==null){$a=!0,u.flags|=Hr,yt(vr,!1);var Kl=ns.updateQueue;return Kl!==null&&(u.updateQueue=Kl,u.flags|=Qr),u.subtreeFlags=Mn,OA(u,w),jf(u,sv(ou.current,ov)),u.child}ba=ba.sibling}vr.tail!==null&&yo()>mD()&&(u.flags|=Hr,$a=!0,yt(vr,!1),u.lanes=ay)}else{if(!$a){var Pl=lv(xa);if(Pl!==null){u.flags|=Hr,$a=!0;var oh=Pl.updateQueue;if(oh!==null&&(u.updateQueue=oh,u.flags|=Qr),yt(vr,!0),vr.tail===null&&vr.tailMode==="hidden"&&!xa.alternate&&!Ds())return Tt(u),null}else yo()*2-vr.renderingStartTime>mD()&&w!==wl&&(u.flags|=Hr,$a=!0,yt(vr,!1),u.lanes=ay)}if(vr.isBackwards)xa.sibling=u.child,u.child=xa;else{var Ec=vr.last;Ec!==null?Ec.sibling=xa:u.child=xa,vr.last=xa}}if(vr.tail!==null){var Cc=vr.tail;vr.rendering=Cc,vr.tail=Cc.sibling,vr.renderingStartTime=yo(),Cc.sibling=null;var Jl=ou.current;return $a?Jl=sv(Jl,ov):Jl=dm(Jl),jf(u,Jl),Cc}return Tt(u),null}case Ti:break;case Dt:case Di:{dR(u);var Im=u.memoizedState,fb=Im!==null;if(l!==null){var j1=l.memoizedState,tp=j1!==null;tp!==fb&&!hr&&(u.flags|=hc)}return!fb||(u.mode&Ln)===Sn?Tt(u):ar(ep,wl)&&(Tt(u),u.subtreeFlags&(so|Qr)&&(u.flags|=hc)),null}case Qt:return null;case ui:return null}throw new Error("Unknown unit of work tag ("+u.tag+"). This error is likely caused by a bug in React. Please file an issue.")}function St(l,u,w){switch(Aw(u),u.tag){case N:{var I=u.type;eu(I)&&rm(u);var O=u.flags;return O&us?(u.flags=O&~us|Hr,(u.mode&Br)!==Sn&&wm(u),u):null}case K:{u.stateNode,t_(u),Gy(u),E0();var G=u.flags;return(G&us)!==Mn&&(G&Hr)===Mn?(u.flags=G&~us|Hr,u):null}case ue:return Ww(u),null;case it:{Gh(u);var Y=u.memoizedState;if(Y!==null&&Y.dehydrated!==null){if(u.alternate===null)throw new Error("Threw in newly mounted dehydrated component. This is likely a bug in React. Please file an issue.");Xg()}var oe=u.flags;return oe&us?(u.flags=oe&~us|Hr,(u.mode&Br)!==Sn&&wm(u),u):null}case hi:return Gh(u),null;case ne:return t_(u),null;case Be:var fe=u.type._context;return _0(fe,u),null;case Dt:case Di:return dR(u),null;case Qt:return null;default:return null}}function tt(l,u,w){switch(Aw(u),u.tag){case N:{var I=u.type.childContextTypes;I!=null&&rm(u);break}case K:{u.stateNode,t_(u),Gy(u),E0();break}case ue:{Ww(u);break}case ne:t_(u);break;case it:Gh(u);break;case hi:Gh(u);break;case Be:var O=u.type._context;_0(O,u);break;case Dt:case Di:dR(u);break}}var Qe=null;Qe=new Set;var xt=!1,wt=!1,_t=typeof WeakSet=="function"?WeakSet:Set,mt=null,si=null,qt=null;function Gt(l){gh(null,function(){throw l}),nf()}var ji=function(l,u){if(u.props=l.memoizedProps,u.state=l.memoizedState,l.mode&Br)try{Jh(),u.componentWillUnmount()}finally{Kh(l)}else u.componentWillUnmount()};function Zt(l,u){try{Bt(ps,l)}catch(w){fo(l,u,w)}}function Si(l,u,w){try{ji(l,w)}catch(I){fo(l,u,I)}}function Zi(l,u,w){try{w.componentDidMount()}catch(I){fo(l,u,I)}}function hn(l,u){try{Ki(l)}catch(w){fo(l,u,w)}}function wn(l,u){var w=l.ref;if(w!==null)if(typeof w=="function"){var I;try{if(mr&&Va&&l.mode&Br)try{Jh(),I=w(null)}finally{Kh(l)}else I=w(null)}catch(O){fo(l,u,O)}typeof I=="function"&&C("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",pn(l))}else w.current=null}function Xi(l,u,w){try{w()}catch(I){fo(l,u,I)}}var Gn=!1;function Yn(l,u){Ly(l.containerInfo),mt=u,Yr();var w=Gn;return Gn=!1,w}function Yr(){for(;mt!==null;){var l=mt,u=l.child;(l.subtreeFlags&yh)!==Mn&&u!==null?(u.return=l,mt=u):Ee()}}function Ee(){for(;mt!==null;){var l=mt;fa(l);try{ve(l)}catch(w){fo(l,l.return,w)}Ba();var u=l.sibling;if(u!==null){u.return=l.return,mt=u;return}mt=l.return}}function ve(l){var u=l.alternate,w=l.flags;if((w&Bl)!==Mn){switch(fa(l),l.tag){case z:case He:case Nt:break;case N:{if(u!==null){var I=u.memoizedProps,O=u.memoizedState,G=l.stateNode;l.type===l.elementType&&!Yf&&(G.props!==l.memoizedProps&&C("Expected %s props to match memoized props before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",pn(l)||"instance"),G.state!==l.memoizedState&&C("Expected %s state to match memoized state before getSnapshotBeforeUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",pn(l)||"instance"));var Y=G.getSnapshotBeforeUpdate(l.elementType===l.type?I:nh(l.type,I),O);{var oe=Qe;Y===void 0&&!oe.has(l.type)&&(oe.add(l.type),C("%s.getSnapshotBeforeUpdate(): A snapshot value (or null) must be returned. You have returned undefined.",pn(l)))}G.__reactInternalSnapshotBeforeUpdate=Y}break}case K:{{var fe=l.stateNode;Ny(fe.containerInfo)}break}case ue:case pe:case ne:case yi:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}Ba()}}function at(l,u,w){var I=u.updateQueue,O=I!==null?I.lastEffect:null;if(O!==null){var G=O.next,Y=G;do{if((Y.tag&l)===l){var oe=Y.destroy;Y.destroy=void 0,oe!==void 0&&((l&Ms)!==cl?yd(u):(l&ps)!==cl&&Wc(u),(l&su)!==cl&&B1(!0),Xi(u,w,oe),(l&su)!==cl&&B1(!1),(l&Ms)!==cl?cf():(l&ps)!==cl&&Fu())}Y=Y.next}while(Y!==G)}}function Bt(l,u){var w=u.updateQueue,I=w!==null?w.lastEffect:null;if(I!==null){var O=I.next,G=O;do{if((G.tag&l)===l){(l&Ms)!==cl?ug(u):(l&ps)!==cl&&ai(u);var Y=G.create;(l&su)!==cl&&B1(!0),G.destroy=Y(),(l&su)!==cl&&B1(!1),(l&Ms)!==cl?dx():(l&ps)!==cl&&J_();{var oe=G.destroy;if(oe!==void 0&&typeof oe!="function"){var fe=void 0;(G.tag&ps)!==Mn?fe="useLayoutEffect":(G.tag&su)!==Mn?fe="useInsertionEffect":fe="useEffect";var Oe=void 0;oe===null?Oe=" You returned null. If your effect does not require clean up, return undefined (or nothing).":typeof oe.then=="function"?Oe=`

It looks like you wrote `+fe+`(async () => ...) or returned a Promise. Instead, write the async function inside your effect and call it immediately:

`+fe+`(() => {
  async function fetchData() {
    // You can await here
    const response = await MyAPI.getData(someId);
    // ...
  }
  fetchData();
}, [someId]); // Or [] if effect doesn't need props or state

Learn more about data fetching with Hooks: https://reactjs.org/link/hooks-data-fetching`:Oe=" You returned: "+oe,C("%s must not return anything besides a function, which is used for clean-up.%s",fe,Oe)}}}G=G.next}while(G!==O)}}function ct(l,u){if((u.flags&Qr)!==Mn)switch(u.tag){case Xe:{var w=u.stateNode.passiveEffectDuration,I=u.memoizedProps,O=I.id,G=I.onPostCommit,Y=cE(),oe=u.alternate===null?"mount":"update";lE()&&(oe="nested-update"),typeof G=="function"&&G(O,oe,w,Y);var fe=u.return;e:for(;fe!==null;){switch(fe.tag){case K:var Oe=fe.stateNode;Oe.passiveEffectDuration+=w;break e;case Xe:var Ne=fe.stateNode;Ne.passiveEffectDuration+=w;break e}fe=fe.return}break}}}function Ht(l,u,w,I){if((w.flags&vh)!==Mn)switch(w.tag){case z:case He:case Nt:{if(!wt)if(w.mode&Br)try{Jh(),Bt(ps|No,w)}finally{Kh(w)}else Bt(ps|No,w);break}case N:{var O=w.stateNode;if(w.flags&Qr&&!wt)if(u===null)if(w.type===w.elementType&&!Yf&&(O.props!==w.memoizedProps&&C("Expected %s props to match memoized props before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",pn(w)||"instance"),O.state!==w.memoizedState&&C("Expected %s state to match memoized state before componentDidMount. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",pn(w)||"instance")),w.mode&Br)try{Jh(),O.componentDidMount()}finally{Kh(w)}else O.componentDidMount();else{var G=w.elementType===w.type?u.memoizedProps:nh(w.type,u.memoizedProps),Y=u.memoizedState;if(w.type===w.elementType&&!Yf&&(O.props!==w.memoizedProps&&C("Expected %s props to match memoized props before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",pn(w)||"instance"),O.state!==w.memoizedState&&C("Expected %s state to match memoized state before componentDidUpdate. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",pn(w)||"instance")),w.mode&Br)try{Jh(),O.componentDidUpdate(G,Y,O.__reactInternalSnapshotBeforeUpdate)}finally{Kh(w)}else O.componentDidUpdate(G,Y,O.__reactInternalSnapshotBeforeUpdate)}var oe=w.updateQueue;oe!==null&&(w.type===w.elementType&&!Yf&&(O.props!==w.memoizedProps&&C("Expected %s props to match memoized props before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.props`. Please file an issue.",pn(w)||"instance"),O.state!==w.memoizedState&&C("Expected %s state to match memoized state before processing the update queue. This might either be because of a bug in React, or because a component reassigns its own `this.state`. Please file an issue.",pn(w)||"instance")),nv(w,oe,O));break}case K:{var fe=w.updateQueue;if(fe!==null){var Oe=null;if(w.child!==null)switch(w.child.tag){case ue:Oe=w.child.stateNode;break;case N:Oe=w.child.stateNode;break}nv(w,fe,Oe)}break}case ue:{var Ne=w.stateNode;if(u===null&&w.flags&Qr){var ft=w.type,dt=w.memoizedProps;pw(Ne,ft,dt)}break}case pe:break;case ne:break;case Xe:{{var Vt=w.memoizedProps,jt=Vt.onCommit,ii=Vt.onRender,Ji=w.stateNode.effectDuration,Fn=cE(),Tn=u===null?"mount":"update";lE()&&(Tn="nested-update"),typeof ii=="function"&&ii(w.memoizedProps.id,Tn,w.actualDuration,w.treeBaseDuration,w.actualStartTime,Fn);{typeof jt=="function"&&jt(w.memoizedProps.id,Tn,Ji,Fn),V2(w);var ra=w.return;e:for(;ra!==null;){switch(ra.tag){case K:var Wr=ra.stateNode;Wr.effectDuration+=Ji;break e;case Xe:var Rt=ra.stateNode;Rt.effectDuration+=Ji;break e}ra=ra.return}}}break}case it:{Kn(l,w);break}case hi:case yi:case Ti:case Dt:case Di:case ui:break;default:throw new Error("This unit of work tag should not have side-effects. This error is likely caused by a bug in React. Please file an issue.")}wt||w.flags&Bc&&Ki(w)}function xi(l){switch(l.tag){case z:case He:case Nt:{if(l.mode&Br)try{Jh(),Zt(l,l.return)}finally{Kh(l)}else Zt(l,l.return);break}case N:{var u=l.stateNode;typeof u.componentDidMount=="function"&&Zi(l,l.return,u),hn(l,l.return);break}case ue:{hn(l,l.return);break}}}function gi(l,u){for(var w=null,I=l;;){if(I.tag===ue){if(w===null){w=I;try{var O=I.stateNode;u?wS(O):pA(I.stateNode,I.memoizedProps)}catch(Y){fo(l,l.return,Y)}}}else if(I.tag===pe){if(w===null)try{var G=I.stateNode;u?Fx(G):TS(G,I.memoizedProps)}catch(Y){fo(l,l.return,Y)}}else if(!((I.tag===Dt||I.tag===Di)&&I.memoizedState!==null&&I!==l)){if(I.child!==null){I.child.return=I,I=I.child;continue}}if(I===l)return;for(;I.sibling===null;){if(I.return===null||I.return===l)return;w===I&&(w=null),I=I.return}w===I&&(w=null),I.sibling.return=I.return,I=I.sibling}}function Ki(l){var u=l.ref;if(u!==null){var w=l.stateNode,I;switch(l.tag){case ue:I=w;break;default:I=w}if(typeof u=="function"){var O;if(l.mode&Br)try{Jh(),O=u(I)}finally{Kh(l)}else O=u(I);typeof O=="function"&&C("Unexpected return value from a callback ref in %s. A callback ref should not return a function.",pn(l))}else u.hasOwnProperty("current")||C("Unexpected ref object provided for %s. Use either a ref-setter function or React.createRef().",pn(l)),u.current=I}}function Oi(l){var u=l.alternate;u!==null&&(u.return=null),l.return=null}function fi(l){var u=l.alternate;u!==null&&(l.alternate=null,fi(u));{if(l.child=null,l.deletions=null,l.sibling=null,l.tag===ue){var w=l.stateNode;w!==null&&bA(w)}l.stateNode=null,l._debugOwner=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}}function Hn(l){for(var u=l.return;u!==null;){if(yr(u))return u;u=u.return}throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.")}function yr(l){return l.tag===ue||l.tag===K||l.tag===ne}function ki(l){var u=l;e:for(;;){for(;u.sibling===null;){if(u.return===null||yr(u.return))return null;u=u.return}for(u.sibling.return=u.return,u=u.sibling;u.tag!==ue&&u.tag!==pe&&u.tag!==Ui;){if(u.flags&so||u.child===null||u.tag===ne)continue e;u.child.return=u,u=u.child}if(!(u.flags&so))return u.stateNode}}function On(l){var u=Hn(l);switch(u.tag){case ue:{var w=u.stateNode;u.flags&Rp&&(mw(w),u.flags&=~Rp);var I=ki(l);ir(l,I,w);break}case K:case ne:{var O=u.stateNode.containerInfo,G=ki(l);pr(l,G,O);break}default:throw new Error("Invalid host parent fiber. This error is likely caused by a bug in React. Please file an issue.")}}function pr(l,u,w){var I=l.tag,O=I===ue||I===pe;if(O){var G=l.stateNode;u?vS(w,G,u):yS(w,G)}else if(I!==ne){var Y=l.child;if(Y!==null){pr(Y,u,w);for(var oe=Y.sibling;oe!==null;)pr(oe,u,w),oe=oe.sibling}}}function ir(l,u,w){var I=l.tag,O=I===ue||I===pe;if(O){var G=l.stateNode;u?fA(w,G,u):_S(w,G)}else if(I!==ne){var Y=l.child;if(Y!==null){ir(Y,u,w);for(var oe=Y.sibling;oe!==null;)ir(oe,u,w),oe=oe.sibling}}}var nr=null,ur=!1;function Dr(l,u,w){{var I=u;e:for(;I!==null;){switch(I.tag){case ue:{nr=I.stateNode,ur=!1;break e}case K:{nr=I.stateNode.containerInfo,ur=!0;break e}case ne:{nr=I.stateNode.containerInfo,ur=!0;break e}}I=I.return}if(nr===null)throw new Error("Expected to find a host parent. This error is likely caused by a bug in React. Please file an issue.");$n(l,u,w),nr=null,ur=!1}Oi(w)}function Nn(l,u,w){for(var I=w.child;I!==null;)$n(l,u,I),I=I.sibling}function $n(l,u,w){switch(cg(w),w.tag){case ue:wt||wn(w,u);case pe:{{var I=nr,O=ur;nr=null,Nn(l,u,w),nr=I,ur=O,nr!==null&&(ur?Qp(nr,w.stateNode):xS(nr,w.stateNode))}return}case Ui:{nr!==null&&(ur?bS(nr,w.stateNode):zx(nr,w.stateNode));return}case ne:{{var G=nr,Y=ur;nr=w.stateNode.containerInfo,ur=!0,Nn(l,u,w),nr=G,ur=Y}return}case z:case He:case kt:case Nt:{if(!wt){var oe=w.updateQueue;if(oe!==null){var fe=oe.lastEffect;if(fe!==null){var Oe=fe.next,Ne=Oe;do{var ft=Ne,dt=ft.destroy,Vt=ft.tag;dt!==void 0&&((Vt&su)!==cl?Xi(w,u,dt):(Vt&ps)!==cl&&(Wc(w),w.mode&Br?(Jh(),Xi(w,u,dt),Kh(w)):Xi(w,u,dt),Fu())),Ne=Ne.next}while(Ne!==Oe)}}}Nn(l,u,w);return}case N:{if(!wt){wn(w,u);var jt=w.stateNode;typeof jt.componentWillUnmount=="function"&&Si(w,u,jt)}Nn(l,u,w);return}case Ti:{Nn(l,u,w);return}case Dt:{if(w.mode&Ln){var ii=wt;wt=ii||w.memoizedState!==null,Nn(l,u,w),wt=ii}else Nn(l,u,w);break}default:{Nn(l,u,w);return}}}function en(l){l.memoizedState}function Kn(l,u){var w=u.memoizedState;if(w===null){var I=u.alternate;if(I!==null){var O=I.memoizedState;if(O!==null){var G=O.dehydrated;G!==null&&Ug(G)}}}}function Ar(l){var u=l.updateQueue;if(u!==null){l.updateQueue=null;var w=l.stateNode;w===null&&(w=l.stateNode=new _t),u.forEach(function(I){var O=Z2.bind(null,l,I);if(!w.has(I)){if(w.add(I),dc)if(si!==null&&qt!==null)N1(qt,si);else throw Error("Expected finished root and lanes to be set. This is a bug in React.");I.then(O,O)}})}}function Li(l,u,w){si=w,qt=l,fa(u),Ur(u,l),fa(u),si=null,qt=null}function fn(l,u,w){var I=u.deletions;if(I!==null)for(var O=0;O<I.length;O++){var G=I[O];try{Dr(l,u,G)}catch(fe){fo(G,u,fe)}}var Y=Wd();if(u.subtreeFlags&of)for(var oe=u.child;oe!==null;)fa(oe),Ur(oe,l),oe=oe.sibling;fa(Y)}function Ur(l,u,w){var I=l.alternate,O=l.flags;switch(l.tag){case z:case He:case kt:case Nt:{if(fn(u,l),Mr(l),O&Qr){try{at(su|No,l,l.return),Bt(su|No,l)}catch(sr){fo(l,l.return,sr)}if(l.mode&Br){try{Jh(),at(ps|No,l,l.return)}catch(sr){fo(l,l.return,sr)}Kh(l)}else try{at(ps|No,l,l.return)}catch(sr){fo(l,l.return,sr)}}return}case N:{fn(u,l),Mr(l),O&Bc&&I!==null&&wn(I,I.return);return}case ue:{fn(u,l),Mr(l),O&Bc&&I!==null&&wn(I,I.return);{if(l.flags&Rp){var G=l.stateNode;try{mw(G)}catch(sr){fo(l,l.return,sr)}}if(O&Qr){var Y=l.stateNode;if(Y!=null){var oe=l.memoizedProps,fe=I!==null?I.memoizedProps:oe,Oe=l.type,Ne=l.updateQueue;if(l.updateQueue=null,Ne!==null)try{mS(Y,Ne,Oe,fe,oe,l)}catch(sr){fo(l,l.return,sr)}}}}return}case pe:{if(fn(u,l),Mr(l),O&Qr){if(l.stateNode===null)throw new Error("This should have a text node initialized. This error is likely caused by a bug in React. Please file an issue.");var ft=l.stateNode,dt=l.memoizedProps,Vt=I!==null?I.memoizedProps:dt;try{gS(ft,Vt,dt)}catch(sr){fo(l,l.return,sr)}}return}case K:{if(fn(u,l),Mr(l),O&Qr&&I!==null){var jt=I.memoizedState;if(jt.isDehydrated)try{Wu(u.containerInfo)}catch(sr){fo(l,l.return,sr)}}return}case ne:{fn(u,l),Mr(l);return}case it:{fn(u,l),Mr(l);var ii=l.child;if(ii.flags&hc){var Ji=ii.stateNode,Fn=ii.memoizedState,Tn=Fn!==null;if(Ji.isHidden=Tn,Tn){var ra=ii.alternate!==null&&ii.alternate.memoizedState!==null;ra||O2()}}if(O&Qr){try{en(l)}catch(sr){fo(l,l.return,sr)}Ar(l)}return}case Dt:{var Wr=I!==null&&I.memoizedState!==null;if(l.mode&Ln){var Rt=wt;wt=Rt||Wr,fn(u,l),wt=Rt}else fn(u,l);if(Mr(l),O&hc){var ni=l.stateNode,It=l.memoizedState,Ei=It!==null,sn=l;if(ni.isHidden=Ei,Ei&&!Wr&&(sn.mode&Ln)!==Sn){mt=sn;for(var nn=sn.child;nn!==null;)mt=nn,Ja(nn),nn=nn.sibling}gi(sn,Ei)}return}case hi:{fn(u,l),Mr(l),O&Qr&&Ar(l);return}case Ti:return;default:{fn(u,l),Mr(l);return}}}function Mr(l){var u=l.flags;if(u&so){try{On(l)}catch(w){fo(l,l.return,w)}l.flags&=~so}u&Vc&&(l.flags&=~Vc)}function La(l,u,w){si=w,qt=u,mt=l,Ka(l,u,w),si=null,qt=null}function Ka(l,u,w){for(var I=(l.mode&Ln)!==Sn;mt!==null;){var O=mt,G=O.child;if(O.tag===Dt&&I){var Y=O.memoizedState!==null,oe=Y||xt;if(oe){Lr(l,u,w);continue}else{var fe=O.alternate,Oe=fe!==null&&fe.memoizedState!==null,Ne=Oe||wt,ft=xt,dt=wt;xt=oe,wt=Ne,wt&&!dt&&(mt=O,Qa(O));for(var Vt=G;Vt!==null;)mt=Vt,Ka(Vt,u,w),Vt=Vt.sibling;mt=O,xt=ft,wt=dt,Lr(l,u,w);continue}}(O.subtreeFlags&vh)!==Mn&&G!==null?(G.return=O,mt=G):Lr(l,u,w)}}function Lr(l,u,w){for(;mt!==null;){var I=mt;if((I.flags&vh)!==Mn){var O=I.alternate;fa(I);try{Ht(u,O,I,w)}catch(Y){fo(I,I.return,Y)}Ba()}if(I===l){mt=null;return}var G=I.sibling;if(G!==null){G.return=I.return,mt=G;return}mt=I.return}}function Ja(l){for(;mt!==null;){var u=mt,w=u.child;switch(u.tag){case z:case He:case kt:case Nt:{if(u.mode&Br)try{Jh(),at(ps,u,u.return)}finally{Kh(u)}else at(ps,u,u.return);break}case N:{wn(u,u.return);var I=u.stateNode;typeof I.componentWillUnmount=="function"&&Si(u,u.return,I);break}case ue:{wn(u,u.return);break}case Dt:{var O=u.memoizedState!==null;if(O){$s(l);continue}break}}w!==null?(w.return=u,mt=w):$s(l)}}function $s(l){for(;mt!==null;){var u=mt;if(u===l){mt=null;return}var w=u.sibling;if(w!==null){w.return=u.return,mt=w;return}mt=u.return}}function Qa(l){for(;mt!==null;){var u=mt,w=u.child;if(u.tag===Dt){var I=u.memoizedState!==null;if(I){dl(l);continue}}w!==null?(w.return=u,mt=w):dl(l)}}function dl(l){for(;mt!==null;){var u=mt;fa(u);try{xi(u)}catch(I){fo(u,u.return,I)}if(Ba(),u===l){mt=null;return}var w=u.sibling;if(w!==null){w.return=u.return,mt=w;return}mt=u.return}}function ts(l,u,w,I){mt=u,xc(u,l,w,I)}function xc(l,u,w,I){for(;mt!==null;){var O=mt,G=O.child;(O.subtreeFlags&_d)!==Mn&&G!==null?(G.return=O,mt=G):fl(l,u,w,I)}}function fl(l,u,w,I){for(;mt!==null;){var O=mt;if((O.flags&Uc)!==Mn){fa(O);try{Dl(u,O,w,I)}catch(Y){fo(O,O.return,Y)}Ba()}if(O===l){mt=null;return}var G=O.sibling;if(G!==null){G.return=O.return,mt=G;return}mt=O.return}}function Dl(l,u,w,I){switch(u.tag){case z:case He:case Nt:{if(u.mode&Br){qf();try{Bt(Ms|No,u)}finally{u1(u)}}else Bt(Ms|No,u);break}}}function is(l){mt=l,Ml()}function Ml(){for(;mt!==null;){var l=mt,u=l.child;if((mt.flags&_h)!==Mn){var w=l.deletions;if(w!==null){for(var I=0;I<w.length;I++){var O=w[I];mt=O,Ps(O,l)}{var G=l.alternate;if(G!==null){var Y=G.child;if(Y!==null){G.child=null;do{var oe=Y.sibling;Y.sibling=null,Y=oe}while(Y!==null)}}}mt=l}}(l.subtreeFlags&_d)!==Mn&&u!==null?(u.return=l,mt=u):bc()}}function bc(){for(;mt!==null;){var l=mt;(l.flags&Uc)!==Mn&&(fa(l),Uo(l),Ba());var u=l.sibling;if(u!==null){u.return=l.return,mt=u;return}mt=l.return}}function Uo(l){switch(l.tag){case z:case He:case Nt:{l.mode&Br?(qf(),at(Ms|No,l,l.return),u1(l)):at(Ms|No,l,l.return);break}}}function Ps(l,u){for(;mt!==null;){var w=mt;fa(w),Kf(w,u),Ba();var I=w.child;I!==null?(I.return=w,mt=I):Qh(l)}}function Qh(l){for(;mt!==null;){var u=mt,w=u.sibling,I=u.return;if(fi(u),u===l){mt=null;return}if(w!==null){w.return=I,mt=w;return}mt=I}}function Kf(l,u){switch(l.tag){case z:case He:case Nt:{l.mode&Br?(qf(),at(Ms,l,u),u1(l)):at(Ms,l,u);break}}}function b_(l){switch(l.tag){case z:case He:case Nt:{try{Bt(ps|No,l)}catch(w){fo(l,l.return,w)}break}case N:{var u=l.stateNode;try{u.componentDidMount()}catch(w){fo(l,l.return,w)}break}}}function Jf(l){switch(l.tag){case z:case He:case Nt:{try{Bt(Ms|No,l)}catch(u){fo(l,l.return,u)}break}}}function ed(l){switch(l.tag){case z:case He:case Nt:{try{at(ps|No,l,l.return)}catch(w){fo(l,l.return,w)}break}case N:{var u=l.stateNode;typeof u.componentWillUnmount=="function"&&Si(l,l.return,u);break}}}function ob(l){switch(l.tag){case z:case He:case Nt:try{at(Ms|No,l,l.return)}catch(u){fo(l,l.return,u)}}}if(typeof Symbol=="function"&&Symbol.for){var td=Symbol.for;td("selector.component"),td("selector.has_pseudo_class"),td("selector.role"),td("selector.test_id"),td("selector.text")}var eR=[];function CE(){eR.forEach(function(l){return l()})}var AE=h.ReactCurrentActQueue;function tR(l){{var u=typeof IS_REACT_ACT_ENVIRONMENT<"u"?IS_REACT_ACT_ENVIRONMENT:void 0,w=typeof jest<"u";return w&&u!==!1}}function RE(){{var l=typeof IS_REACT_ACT_ENVIRONMENT<"u"?IS_REACT_ACT_ENVIRONMENT:void 0;return!l&&AE.current!==null&&C("The current testing environment is not configured to support act(...)"),l}}var IE=Math.ceil,sb=h.ReactCurrentDispatcher,Qf=h.ReactCurrentOwner,Ws=h.ReactCurrentBatchConfig,rh=h.ReactCurrentActQueue,gs=0,R1=1,Os=2,wc=4,id=0,w_=1,Em=2,lb=3,I1=4,dD=5,iR=6,na=gs,Tc=null,Yo=null,qs=mi,ep=mi,nR=Uh(mi),Zs=id,D1=null,DE=mi,M1=mi,ME=mi,P1=null,du=null,rR=0,fD=500,pD=1/0,T2=500,Cm=null;function O1(){pD=yo()+T2}function mD(){return pD}var PE=!1,aR=null,cb=null,Dv=!1,T_=null,k1=mi,oR=[],sR=null,S2=50,L1=0,lR=null,cR=!1,OE=!1,E2=50,ub=0,kE=null,z1=gn,LE=mi,gD=!1;function zE(){return Tc}function Sc(){return(na&(Os|wc))!==gs?yo():(z1!==gn||(z1=yo()),z1)}function S_(l){var u=l.mode;if((u&Ln)===Sn)return Zn;if((na&Os)!==gs&&qs!==mi)return Dh(qs);var w=Wy()!==DA;if(w){if(Ws.transition!==null){var I=Ws.transition;I._updatedFibers||(I._updatedFibers=new Set),I._updatedFibers.add(l)}return LE===co&&(LE=xg()),LE}var O=$l();if(O!==co)return O;var G=hA();return G}function C2(l){var u=l.mode;return(u&Ln)===Sn?Zn:jl()}function Xs(l,u,w,I){Y2(),gD&&C("useInsertionEffect must not schedule updates."),cR&&(OE=!0),Hl(l,w,I),(na&Os)!==mi&&l===Tc?Q2(u):(dc&&Gp(l,u,w),eL(u),l===Tc&&((na&Os)===gs&&(M1=fr(M1,w)),Zs===I1&&E_(l,qs)),fu(l,I),w===Zn&&na===gs&&(u.mode&Ln)===Sn&&!rh.isBatchingLegacy&&(O1(),FS()))}function A2(l,u,w){var I=l.current;I.lanes=u,Hl(l,u,w),fu(l,w)}function R2(l){return(na&Os)!==gs}function fu(l,u){var w=l.callbackNode;sy(l,u);var I=qc(l,l===Tc?qs:mi);if(I===mi){w!==null&&PD(w),l.callbackNode=null,l.callbackPriority=co;return}var O=Gu(I),G=l.callbackPriority;if(G===O&&!(rh.current!==null&&w!==gR)){w==null&&G!==Zn&&C("Expected scheduled callback to exist. This error is likely caused by a bug in React. Please file an issue.");return}w!=null&&PD(w);var Y;if(O===Zn)l.tag===Of?(rh.isBatchingLegacy!==null&&(rh.didScheduleLegacyUpdate=!0),zS(vD.bind(null,l))):LS(vD.bind(null,l)),rh.current!==null?rh.current.push(kf):dA(function(){(na&(Os|wc))===gs&&kf()}),Y=null;else{var oe;switch(dy(I)){case Es:oe=Gc;break;case Tl:oe=Hc;break;case mc:oe=Lu;break;case Hp:oe=Pp;break;default:oe=Lu;break}Y=_R(oe,_D.bind(null,l))}l.callbackPriority=O,l.callbackNode=Y}function _D(l,u){if(jA(),z1=gn,LE=mi,(na&(Os|wc))!==gs)throw new Error("Should not already be working.");var w=l.callbackNode,I=Rm();if(I&&l.callbackNode!==w)return null;var O=qc(l,l===Tc?qs:mi);if(O===mi)return null;var G=!Td(l,O)&&!_f(l,O)&&!u,Y=G?N2(l,O):NE(l,O);if(Y!==id){if(Y===Em){var oe=gf(l);oe!==mi&&(O=oe,Y=uR(l,oe))}if(Y===w_){var fe=D1;throw Mv(l,mi),E_(l,O),fu(l,yo()),fe}if(Y===iR)E_(l,O);else{var Oe=!Td(l,O),Ne=l.current.alternate;if(Oe&&!D2(Ne)){if(Y=NE(l,O),Y===Em){var ft=gf(l);ft!==mi&&(O=ft,Y=uR(l,ft))}if(Y===w_){var dt=D1;throw Mv(l,mi),E_(l,O),fu(l,yo()),dt}}l.finishedWork=Ne,l.finishedLanes=O,I2(l,Y,O)}}return fu(l,yo()),l.callbackNode===w?_D.bind(null,l):null}function uR(l,u){var w=P1;if(Sg(l)){var I=Mv(l,u);I.flags|=Nl,xw(l.containerInfo)}var O=NE(l,u);if(O!==Em){var G=du;du=w,G!==null&&yD(G)}return O}function yD(l){du===null?du=l:du.push.apply(du,l)}function I2(l,u,w){switch(u){case id:case w_:throw new Error("Root did not complete. This is a bug in React.");case Em:{Pv(l,du,Cm);break}case lb:{if(E_(l,w),Vu(w)&&!OD()){var I=rR+fD-yo();if(I>10){var O=qc(l,mi);if(O!==mi)break;var G=l.suspendedLanes;if(!pc(G,w)){Sc(),jp(l,G);break}l.timeoutHandle=hw(Pv.bind(null,l,du,Cm),I);break}}Pv(l,du,Cm);break}case I1:{if(E_(l,w),vg(w))break;if(!OD()){var Y=mf(l,w),oe=Y,fe=yo()-oe,Oe=X2(fe)-fe;if(Oe>10){l.timeoutHandle=hw(Pv.bind(null,l,du,Cm),Oe);break}}Pv(l,du,Cm);break}case dD:{Pv(l,du,Cm);break}default:throw new Error("Unknown root exit status.")}}function D2(l){for(var u=l;;){if(u.flags&Pu){var w=u.updateQueue;if(w!==null){var I=w.stores;if(I!==null)for(var O=0;O<I.length;O++){var G=I[O],Y=G.getSnapshot,oe=G.value;try{if(!Al(Y(),oe))return!1}catch{return!1}}}}var fe=u.child;if(u.subtreeFlags&Pu&&fe!==null){fe.return=u,u=fe;continue}if(u===l)return!0;for(;u.sibling===null;){if(u.return===null||u.return===l)return!0;u=u.return}u.sibling.return=u.return,u=u.sibling}return!0}function E_(l,u){u=yf(u,ME),u=yf(u,M1),cy(l,u)}function vD(l){if(V0(),(na&(Os|wc))!==gs)throw new Error("Should not already be working.");Rm();var u=qc(l,mi);if(!ar(u,Zn))return fu(l,yo()),null;var w=NE(l,u);if(l.tag!==Of&&w===Em){var I=gf(l);I!==mi&&(u=I,w=uR(l,I))}if(w===w_){var O=D1;throw Mv(l,mi),E_(l,u),fu(l,yo()),O}if(w===iR)throw new Error("Root did not complete. This is a bug in React.");var G=l.current.alternate;return l.finishedWork=G,l.finishedLanes=u,Pv(l,du,Cm),fu(l,yo()),null}function M2(l,u){u!==mi&&(Oh(l,fr(u,Zn)),fu(l,yo()),(na&(Os|wc))===gs&&(O1(),kf()))}function hR(l,u){var w=na;na|=R1;try{return l(u)}finally{na=w,na===gs&&!rh.isBatchingLegacy&&(O1(),FS())}}function P2(l,u,w,I,O){var G=$l(),Y=Ws.transition;try{return Ws.transition=null,Co(Es),l(u,w,I,O)}finally{Co(G),Ws.transition=Y,na===gs&&O1()}}function Am(l){T_!==null&&T_.tag===Of&&(na&(Os|wc))===gs&&Rm();var u=na;na|=R1;var w=Ws.transition,I=$l();try{return Ws.transition=null,Co(Es),l?l():void 0}finally{Co(I),Ws.transition=w,na=u,(na&(Os|wc))===gs&&kf()}}function xD(){return(na&(Os|wc))!==gs}function FE(l,u){js(nR,ep,l),ep=fr(ep,u)}function dR(l){ep=nR.current,Vs(nR,l)}function Mv(l,u){l.finishedWork=null,l.finishedLanes=mi;var w=l.timeoutHandle;if(w!==Ng&&(l.timeoutHandle=Ng,dw(w)),Yo!==null)for(var I=Yo.return;I!==null;){var O=I.alternate;tt(O,I),I=I.return}Tc=l;var G=Ov(l.current,null);return Yo=G,qs=ep=u,Zs=id,D1=null,DE=mi,M1=mi,ME=mi,P1=null,du=null,XS(),Yu.discardPendingWarnings(),G}function bD(l,u){do{var w=Yo;try{if(Yy(),_m(),Ba(),Qf.current=null,w===null||w.return===null){Zs=w_,D1=u,Yo=null;return}if(mr&&w.mode&Br&&G0(w,!0),xn)if($c(),u!==null&&typeof u=="object"&&typeof u.then=="function"){var I=u;Ri(w,I,qs)}else Sh(w,u,qs);qA(l,w.return,w,u,qs),ED(w)}catch(O){u=O,Yo===w&&w!==null?(w=w.return,Yo=w):w=Yo;continue}return}while(!0)}function wD(){var l=sb.current;return sb.current=f_,l===null?f_:l}function TD(l){sb.current=l}function O2(){rR=yo()}function F1(l){DE=fr(l,DE)}function k2(){Zs===id&&(Zs=lb)}function fR(){(Zs===id||Zs===lb||Zs===Em)&&(Zs=I1),Tc!==null&&(Fs(DE)||Fs(M1))&&E_(Tc,qs)}function L2(l){Zs!==I1&&(Zs=Em),P1===null?P1=[l]:P1.push(l)}function z2(){return Zs===id}function NE(l,u){var w=na;na|=Os;var I=wD();if(Tc!==l||qs!==u){if(dc){var O=l.memoizedUpdaters;O.size>0&&(N1(l,qs),O.clear()),wg(l,u)}Cm=hy(),Mv(l,u)}fg(u);do try{F2();break}catch(G){bD(l,G)}while(!0);if(Yy(),na=w,TD(I),Yo!==null)throw new Error("Cannot commit an incomplete root. This error is likely caused by a bug in React. Please file an issue.");return ty(),Tc=null,qs=mi,Zs}function F2(){for(;Yo!==null;)SD(Yo)}function N2(l,u){var w=na;na|=Os;var I=wD();if(Tc!==l||qs!==u){if(dc){var O=l.memoizedUpdaters;O.size>0&&(N1(l,qs),O.clear()),wg(l,u)}Cm=hy(),O1(),Mv(l,u)}fg(u);do try{B2();break}catch(G){bD(l,G)}while(!0);return Yy(),TD(I),na=w,Yo!==null?(ey(),id):(ty(),Tc=null,qs=mi,Zs)}function B2(){for(;Yo!==null&&!rg();)SD(Yo)}function SD(l){var u=l.alternate;fa(l);var w;(l.mode&Br)!==Sn?(j0(l),w=pR(u,l,ep),G0(l,!0)):w=pR(u,l,ep),Ba(),l.memoizedProps=l.pendingProps,w===null?ED(l):Yo=w,Qf.current=null}function ED(l){var u=l;do{var w=u.alternate,I=u.return;if((u.flags&Ts)===Mn){fa(u);var O=void 0;if((u.mode&Br)===Sn?O=pt(w,u,ep):(j0(u),O=pt(w,u,ep),G0(u,!1)),Ba(),O!==null){Yo=O;return}}else{var G=St(w,u);if(G!==null){G.flags&=eg,Yo=G;return}if((u.mode&Br)!==Sn){G0(u,!1);for(var Y=u.actualDuration,oe=u.child;oe!==null;)Y+=oe.actualDuration,oe=oe.sibling;u.actualDuration=Y}if(I!==null)I.flags|=Ts,I.subtreeFlags=Mn,I.deletions=null;else{Zs=iR,Yo=null;return}}var fe=u.sibling;if(fe!==null){Yo=fe;return}u=I,Yo=u}while(u!==null);Zs===id&&(Zs=dD)}function Pv(l,u,w){var I=$l(),O=Ws.transition;try{Ws.transition=null,Co(Es),U2(l,u,w,I)}finally{Ws.transition=O,Co(I)}return null}function U2(l,u,w,I){do Rm();while(T_!==null);if(K2(),(na&(Os|wc))!==gs)throw new Error("Should not already be working.");var O=l.finishedWork,G=l.finishedLanes;if(K_(G),O===null)return kp(),null;if(G===mi&&C("root.finishedLanes should not be empty during a commit. This is a bug in React."),l.finishedWork=null,l.finishedLanes=mi,O===l.current)throw new Error("Cannot commit the same tree as before. This error is likely caused by a bug in React. Please file an issue.");l.callbackNode=null,l.callbackPriority=co;var Y=fr(O.lanes,O.childLanes);bg(l,Y),l===Tc&&(Tc=null,Yo=null,qs=mi),((O.subtreeFlags&_d)!==Mn||(O.flags&_d)!==Mn)&&(Dv||(Dv=!0,sR=w,_R(Lu,function(){return Rm(),null})));var oe=(O.subtreeFlags&(yh|of|vh|_d))!==Mn,fe=(O.flags&(yh|of|vh|_d))!==Mn;if(oe||fe){var Oe=Ws.transition;Ws.transition=null;var Ne=$l();Co(Es);var ft=na;na|=wc,Qf.current=null,Yn(l,O),uE(),Li(l,O,G),zy(l.containerInfo),l.current=O,Q_(G),La(O,l,G),fx(),ku(),na=ft,Co(Ne),Ws.transition=Oe}else l.current=O,uE();var dt=Dv;if(Dv?(Dv=!1,T_=l,k1=G):(ub=0,kE=null),Y=l.pendingLanes,Y===mi&&(cb=null),dt||ID(l.current,!1),Bb(O.stateNode,I),dc&&l.memoizedUpdaters.clear(),CE(),fu(l,yo()),u!==null)for(var Vt=l.onRecoverableError,jt=0;jt<u.length;jt++){var ii=u[jt],Ji=ii.stack,Fn=ii.digest;Vt(ii.value,{componentStack:Ji,digest:Fn})}if(PE){PE=!1;var Tn=aR;throw aR=null,Tn}return ar(k1,Zn)&&l.tag!==Of&&Rm(),Y=l.pendingLanes,ar(Y,Zn)?(VA(),l===lR?L1++:(L1=0,lR=l)):L1=0,kf(),kp(),null}function Rm(){if(T_!==null){var l=dy(k1),u=_x(mc,l),w=Ws.transition,I=$l();try{return Ws.transition=null,Co(u),j2()}finally{Co(I),Ws.transition=w}}return!1}function V2(l){oR.push(l),Dv||(Dv=!0,_R(Lu,function(){return Rm(),null}))}function j2(){if(T_===null)return!1;var l=sR;sR=null;var u=T_,w=k1;if(T_=null,k1=mi,(na&(Os|wc))!==gs)throw new Error("Cannot flush passive effects while already rendering.");cR=!0,OE=!1,hg(w);var I=na;na|=wc,is(u.current),ts(u,u.current,w,l);{var O=oR;oR=[];for(var G=0;G<O.length;G++){var Y=O[G];ct(u,Y)}}dg(),ID(u.current,!0),na=I,kf(),OE?u===kE?ub++:(ub=0,kE=u):ub=0,cR=!1,OE=!1,lg(u);{var oe=u.current.stateNode;oe.effectDuration=0,oe.passiveEffectDuration=0}return!0}function CD(l){return cb!==null&&cb.has(l)}function G2(l){cb===null?cb=new Set([l]):cb.add(l)}function H2(l){PE||(PE=!0,aR=l)}var $2=H2;function AD(l,u,w){var I=Tm(w,u),O=pE(l,I,Zn),G=_c(l,O,Zn),Y=Sc();G!==null&&(Hl(G,Zn,Y),fu(G,Y))}function fo(l,u,w){if(Gt(w),B1(!1),l.tag===K){AD(l,l,w);return}var I=null;for(I=u;I!==null;){if(I.tag===K){AD(I,l,w);return}else if(I.tag===N){var O=I.type,G=I.stateNode;if(typeof O.getDerivedStateFromError=="function"||typeof G.componentDidCatch=="function"&&!CD(G)){var Y=Tm(w,l),oe=v1(I,Y,Zn),fe=_c(I,oe,Zn),Oe=Sc();fe!==null&&(Hl(fe,Zn,Oe),fu(fe,Oe));return}}I=I.return}C(`Internal React error: Attempted to capture a commit phase error inside a detached tree. This indicates a bug in React. Likely causes include deleting the same fiber more than once, committing an already-finished tree, or an inconsistent return pointer.

Error message:

%s`,w)}function W2(l,u,w){var I=l.pingCache;I!==null&&I.delete(u);var O=Sc();jp(l,w),tL(l),Tc===l&&pc(qs,w)&&(Zs===I1||Zs===lb&&Vu(qs)&&yo()-rR<fD?Mv(l,mi):ME=fr(ME,w)),fu(l,O)}function RD(l,u){u===co&&(u=C2(l));var w=Sc(),I=Xl(l,u);I!==null&&(Hl(I,u,w),fu(I,w))}function q2(l){var u=l.memoizedState,w=co;u!==null&&(w=u.retryLane),RD(l,w)}function Z2(l,u){var w=co,I;switch(l.tag){case it:I=l.stateNode;var O=l.memoizedState;O!==null&&(w=O.retryLane);break;case hi:I=l.stateNode;break;default:throw new Error("Pinged unknown suspense boundary type. This is probably a bug in React.")}I!==null&&I.delete(u),RD(l,w)}function X2(l){return l<120?120:l<480?480:l<1080?1080:l<1920?1920:l<3e3?3e3:l<4320?4320:IE(l/1960)*1960}function Y2(){if(L1>S2)throw L1=0,lR=null,new Error("Maximum update depth exceeded. This can happen when a component repeatedly calls setState inside componentWillUpdate or componentDidUpdate. React limits the number of nested updates to prevent infinite loops.");ub>E2&&(ub=0,kE=null,C("Maximum update depth exceeded. This can happen when a component calls setState inside useEffect, but useEffect either doesn't have a dependency array, or one of the dependencies changes on every render."))}function K2(){Yu.flushLegacyContextWarning(),Yu.flushPendingUnsafeLifecycleWarnings()}function ID(l,u){fa(l),BE(l,Ul,ed),u&&BE(l,af,ob),BE(l,Ul,b_),u&&BE(l,af,Jf),Ba()}function BE(l,u,w){for(var I=l,O=null;I!==null;){var G=I.subtreeFlags&u;I!==O&&I.child!==null&&G!==Mn?I=I.child:((I.flags&u)!==Mn&&w(I),I.sibling!==null?I=I.sibling:I=O=I.return)}}var UE=null;function DD(l){{if((na&Os)!==gs||!(l.mode&Ln))return;var u=l.tag;if(u!==H&&u!==K&&u!==N&&u!==z&&u!==He&&u!==kt&&u!==Nt)return;var w=pn(l)||"ReactComponent";if(UE!==null){if(UE.has(w))return;UE.add(w)}else UE=new Set([w]);var I=ao;try{fa(l),C("Can't perform a React state update on a component that hasn't mounted yet. This indicates that you have a side-effect in your render function that asynchronously later calls tries to update the component. Move this work to useEffect instead.")}finally{I?fa(l):Ba()}}}var pR;{var J2=null;pR=function(l,u,w){var I=ND(J2,u);try{return Pe(l,u,w)}catch(G){if(US()||G!==null&&typeof G=="object"&&typeof G.then=="function")throw G;if(Yy(),_m(),tt(l,u),ND(u,I),u.mode&Br&&j0(u),gh(null,Pe,null,l,u,w),W_()){var O=nf();typeof O=="object"&&O!==null&&O._suppressLogging&&typeof G=="object"&&G!==null&&!G._suppressLogging&&(G._suppressLogging=!0)}throw G}}}var MD=!1,mR;mR=new Set;function Q2(l){if(gl&&!UA())switch(l.tag){case z:case He:case Nt:{var u=Yo&&pn(Yo)||"Unknown",w=u;if(!mR.has(w)){mR.add(w);var I=pn(l)||"Unknown";C("Cannot update a component (`%s`) while rendering a different component (`%s`). To locate the bad setState() call inside `%s`, follow the stack trace as described in https://reactjs.org/link/setstate-in-render",I,u,u)}break}case N:{MD||(C("Cannot update during an existing state transition (such as within `render`). Render methods should be a pure function of props and state."),MD=!0);break}}}function N1(l,u){if(dc){var w=l.memoizedUpdaters;w.forEach(function(I){Gp(l,I,u)})}}var gR={};function _R(l,u){{var w=rh.current;return w!==null?(w.push(u),gR):X_(l,u)}}function PD(l){if(l!==gR)return ux(l)}function OD(){return rh.current!==null}function eL(l){{if(l.mode&Ln){if(!RE())return}else if(!tR()||na!==gs||l.tag!==z&&l.tag!==He&&l.tag!==Nt)return;if(rh.current===null){var u=ao;try{fa(l),C(`An update to %s inside a test was not wrapped in act(...).

When testing, code that causes React state updates should be wrapped into act(...):

act(() => {
  /* fire events that update state */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act`,pn(l))}finally{u?fa(l):Ba()}}}}function tL(l){l.tag!==Of&&RE()&&rh.current===null&&C(`A suspended resource finished loading inside a test, but the event was not wrapped in act(...).

When testing, code that resolves suspended data should be wrapped into act(...):

act(() => {
  /* finish loading suspended data */
});
/* assert on the output */

This ensures that you're testing the behavior the user would see in the browser. Learn more at https://reactjs.org/link/wrap-tests-with-act`)}function B1(l){gD=l}var nd=null,hb=null,iL=function(l){nd=l};function db(l){{if(nd===null)return l;var u=nd(l);return u===void 0?l:u.current}}function yR(l){return db(l)}function vR(l){{if(nd===null)return l;var u=nd(l);if(u===void 0){if(l!=null&&typeof l.render=="function"){var w=db(l.render);if(l.render!==w){var I={$$typeof:W,render:w};return l.displayName!==void 0&&(I.displayName=l.displayName),I}}return l}return u.current}}function kD(l,u){{if(nd===null)return!1;var w=l.elementType,I=u.type,O=!1,G=typeof I=="object"&&I!==null?I.$$typeof:null;switch(l.tag){case N:{typeof I=="function"&&(O=!0);break}case z:{(typeof I=="function"||G===ye)&&(O=!0);break}case He:{(G===W||G===ye)&&(O=!0);break}case kt:case Nt:{(G===we||G===ye)&&(O=!0);break}default:return!1}if(O){var Y=nd(w);if(Y!==void 0&&Y===nd(I))return!0}return!1}}function LD(l){{if(nd===null||typeof WeakSet!="function")return;hb===null&&(hb=new WeakSet),hb.add(l)}}var nL=function(l,u){{if(nd===null)return;var w=u.staleFamilies,I=u.updatedFamilies;Rm(),Am(function(){xR(l.current,I,w)})}},rL=function(l,u){{if(l.context!==ol)return;Rm(),Am(function(){U1(u,l,null,null)})}};function xR(l,u,w){{var I=l.alternate,O=l.child,G=l.sibling,Y=l.tag,oe=l.type,fe=null;switch(Y){case z:case Nt:case N:fe=oe;break;case He:fe=oe.render;break}if(nd===null)throw new Error("Expected resolveFamily to be set during hot reload.");var Oe=!1,Ne=!1;if(fe!==null){var ft=nd(fe);ft!==void 0&&(w.has(ft)?Ne=!0:u.has(ft)&&(Y===N?Ne=!0:Oe=!0))}if(hb!==null&&(hb.has(l)||I!==null&&hb.has(I))&&(Ne=!0),Ne&&(l._debugNeedsRemount=!0),Ne||Oe){var dt=Xl(l,Zn);dt!==null&&Xs(dt,l,Zn,gn)}O!==null&&!Ne&&xR(O,u,w),G!==null&&xR(G,u,w)}}var aL=function(l,u){{var w=new Set,I=new Set(u.map(function(O){return O.current}));return bR(l.current,I,w),w}};function bR(l,u,w){{var I=l.child,O=l.sibling,G=l.tag,Y=l.type,oe=null;switch(G){case z:case Nt:case N:oe=Y;break;case He:oe=Y.render;break}var fe=!1;oe!==null&&u.has(oe)&&(fe=!0),fe?oL(l,w):I!==null&&bR(I,u,w),O!==null&&bR(O,u,w)}}function oL(l,u){{var w=sL(l,u);if(w)return;for(var I=l;;){switch(I.tag){case ue:u.add(I.stateNode);return;case ne:u.add(I.stateNode.containerInfo);return;case K:u.add(I.stateNode.containerInfo);return}if(I.return===null)throw new Error("Expected to reach root first.");I=I.return}}}function sL(l,u){for(var w=l,I=!1;;){if(w.tag===ue)I=!0,u.add(w.stateNode);else if(w.child!==null){w.child.return=w,w=w.child;continue}if(w===l)return I;for(;w.sibling===null;){if(w.return===null||w.return===l)return I;w=w.return}w.sibling.return=w.return,w=w.sibling}return!1}var wR;{wR=!1;try{var zD=Object.preventExtensions({})}catch{wR=!0}}function lL(l,u,w,I){this.tag=l,this.key=w,this.elementType=null,this.type=null,this.stateNode=null,this.return=null,this.child=null,this.sibling=null,this.index=0,this.ref=null,this.pendingProps=u,this.memoizedProps=null,this.updateQueue=null,this.memoizedState=null,this.dependencies=null,this.mode=I,this.flags=Mn,this.subtreeFlags=Mn,this.deletions=null,this.lanes=mi,this.childLanes=mi,this.alternate=null,this.actualDuration=Number.NaN,this.actualStartTime=Number.NaN,this.selfBaseDuration=Number.NaN,this.treeBaseDuration=Number.NaN,this.actualDuration=0,this.actualStartTime=-1,this.selfBaseDuration=0,this.treeBaseDuration=0,this._debugSource=null,this._debugOwner=null,this._debugNeedsRemount=!1,this._debugHookTypes=null,!wR&&typeof Object.preventExtensions=="function"&&Object.preventExtensions(this)}var ah=function(l,u,w,I){return new lL(l,u,w,I)};function TR(l){var u=l.prototype;return!!(u&&u.isReactComponent)}function cL(l){return typeof l=="function"&&!TR(l)&&l.defaultProps===void 0}function uL(l){if(typeof l=="function")return TR(l)?N:z;if(l!=null){var u=l.$$typeof;if(u===W)return He;if(u===we)return kt}return H}function Ov(l,u){var w=l.alternate;w===null?(w=ah(l.tag,u,l.key,l.mode),w.elementType=l.elementType,w.type=l.type,w.stateNode=l.stateNode,w._debugSource=l._debugSource,w._debugOwner=l._debugOwner,w._debugHookTypes=l._debugHookTypes,w.alternate=l,l.alternate=w):(w.pendingProps=u,w.type=l.type,w.flags=Mn,w.subtreeFlags=Mn,w.deletions=null,w.actualDuration=0,w.actualStartTime=-1),w.flags=l.flags&jc,w.childLanes=l.childLanes,w.lanes=l.lanes,w.child=l.child,w.memoizedProps=l.memoizedProps,w.memoizedState=l.memoizedState,w.updateQueue=l.updateQueue;var I=l.dependencies;switch(w.dependencies=I===null?null:{lanes:I.lanes,firstContext:I.firstContext},w.sibling=l.sibling,w.index=l.index,w.ref=l.ref,w.selfBaseDuration=l.selfBaseDuration,w.treeBaseDuration=l.treeBaseDuration,w._debugNeedsRemount=l._debugNeedsRemount,w.tag){case H:case z:case Nt:w.type=db(l.type);break;case N:w.type=yR(l.type);break;case He:w.type=vR(l.type);break}return w}function hL(l,u){l.flags&=jc|so;var w=l.alternate;if(w===null)l.childLanes=mi,l.lanes=u,l.child=null,l.subtreeFlags=Mn,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null,l.selfBaseDuration=0,l.treeBaseDuration=0;else{l.childLanes=w.childLanes,l.lanes=w.lanes,l.child=w.child,l.subtreeFlags=Mn,l.deletions=null,l.memoizedProps=w.memoizedProps,l.memoizedState=w.memoizedState,l.updateQueue=w.updateQueue,l.type=w.type;var I=w.dependencies;l.dependencies=I===null?null:{lanes:I.lanes,firstContext:I.firstContext},l.selfBaseDuration=w.selfBaseDuration,l.treeBaseDuration=w.treeBaseDuration}return l}function dL(l,u,w){var I;return l===Kx?(I=Ln,u===!0&&(I|=lo,I|=Vl)):I=Sn,dc&&(I|=Br),ah(K,null,null,I)}function SR(l,u,w,I,O,G){var Y=H,oe=l;if(typeof l=="function")TR(l)?(Y=N,oe=yR(oe)):oe=db(oe);else if(typeof l=="string")Y=ue;else e:switch(l){case cn:return C_(w.children,O,G,u);case Za:Y=be,O|=lo,(O&Ln)!==Sn&&(O|=Vl);break;case et:return fL(w,O,G,u);case X:return pL(w,O,G,u);case he:return mL(w,O,G,u);case Le:return FD(w,O,G,u);case $e:case Me:case gt:case ut:case Ve:default:{if(typeof l=="object"&&l!==null)switch(l.$$typeof){case vi:Y=Be;break e;case ie:Y=je;break e;case W:Y=He,oe=vR(oe);break e;case we:Y=kt;break e;case ye:Y=oi,oe=null;break e}var fe="";{(l===void 0||typeof l=="object"&&l!==null&&Object.keys(l).length===0)&&(fe+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var Oe=I?pn(I):null;Oe&&(fe+=`

Check the render method of \``+Oe+"`.")}throw new Error("Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) "+("but got: "+(l==null?l:typeof l)+"."+fe))}}var Ne=ah(Y,w,u,O);return Ne.elementType=l,Ne.type=oe,Ne.lanes=G,Ne._debugOwner=I,Ne}function ER(l,u,w){var I=null;I=l._owner;var O=l.type,G=l.key,Y=l.props,oe=SR(O,G,Y,I,u,w);return oe._debugSource=l._source,oe._debugOwner=l._owner,oe}function C_(l,u,w,I){var O=ah(xe,l,I,u);return O.lanes=w,O}function fL(l,u,w,I){typeof l.id!="string"&&C('Profiler must specify an "id" of type `string` as a prop. Received the type `%s` instead.',typeof l.id);var O=ah(Xe,l,I,u|Br);return O.elementType=et,O.lanes=w,O.stateNode={effectDuration:0,passiveEffectDuration:0},O}function pL(l,u,w,I){var O=ah(it,l,I,u);return O.elementType=X,O.lanes=w,O}function mL(l,u,w,I){var O=ah(hi,l,I,u);return O.elementType=he,O.lanes=w,O}function FD(l,u,w,I){var O=ah(Dt,l,I,u);O.elementType=Le,O.lanes=w;var G={isHidden:!1};return O.stateNode=G,O}function CR(l,u,w){var I=ah(pe,l,null,u);return I.lanes=w,I}function gL(){var l=ah(ue,null,null,Sn);return l.elementType="DELETED",l}function _L(l){var u=ah(Ui,null,null,Sn);return u.stateNode=l,u}function AR(l,u,w){var I=l.children!==null?l.children:[],O=ah(ne,I,l.key,u);return O.lanes=w,O.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},O}function ND(l,u){return l===null&&(l=ah(H,null,null,Sn)),l.tag=u.tag,l.key=u.key,l.elementType=u.elementType,l.type=u.type,l.stateNode=u.stateNode,l.return=u.return,l.child=u.child,l.sibling=u.sibling,l.index=u.index,l.ref=u.ref,l.pendingProps=u.pendingProps,l.memoizedProps=u.memoizedProps,l.updateQueue=u.updateQueue,l.memoizedState=u.memoizedState,l.dependencies=u.dependencies,l.mode=u.mode,l.flags=u.flags,l.subtreeFlags=u.subtreeFlags,l.deletions=u.deletions,l.lanes=u.lanes,l.childLanes=u.childLanes,l.alternate=u.alternate,l.actualDuration=u.actualDuration,l.actualStartTime=u.actualStartTime,l.selfBaseDuration=u.selfBaseDuration,l.treeBaseDuration=u.treeBaseDuration,l._debugSource=u._debugSource,l._debugOwner=u._debugOwner,l._debugNeedsRemount=u._debugNeedsRemount,l._debugHookTypes=u._debugHookTypes,l}function yL(l,u,w,I,O){this.tag=u,this.containerInfo=l,this.pendingChildren=null,this.current=null,this.pingCache=null,this.finishedWork=null,this.timeoutHandle=Ng,this.context=null,this.pendingContext=null,this.callbackNode=null,this.callbackPriority=co,this.eventTimes=Vp(mi),this.expirationTimes=Vp(gn),this.pendingLanes=mi,this.suspendedLanes=mi,this.pingedLanes=mi,this.expiredLanes=mi,this.mutableReadLanes=mi,this.finishedLanes=mi,this.entangledLanes=mi,this.entanglements=Vp(mi),this.identifierPrefix=I,this.onRecoverableError=O,this.mutableSourceEagerHydrationData=null,this.effectDuration=0,this.passiveEffectDuration=0;{this.memoizedUpdaters=new Set;for(var G=this.pendingUpdatersLaneMap=[],Y=0;Y<Er;Y++)G.push(new Set)}switch(u){case Kx:this._debugRootType=w?"hydrateRoot()":"createRoot()";break;case Of:this._debugRootType=w?"hydrate()":"render()";break}}function BD(l,u,w,I,O,G,Y,oe,fe,Oe){var Ne=new yL(l,u,w,oe,fe),ft=dL(u,G);Ne.current=ft,ft.stateNode=Ne;{var dt={element:I,isDehydrated:w,cache:null,transitions:null,pendingSuspenseBoundaries:null};ft.memoizedState=dt}return v0(ft),Ne}var RR="18.3.1";function vL(l,u,w){var I=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return to(I),{$$typeof:Mo,key:I==null?null:""+I,children:l,containerInfo:u,implementation:w}}var IR,DR;IR=!1,DR={};function UD(l){if(!l)return ol;var u=Nc(l),w=TA(u);if(u.tag===N){var I=u.type;if(eu(I))return Xx(u,I,w)}return w}function xL(l,u){{var w=Nc(l);if(w===void 0){if(typeof l.render=="function")throw new Error("Unable to find node on an unmounted component.");var I=Object.keys(l).join(",");throw new Error("Argument appears to not be a ReactComponent. Keys: "+I)}var O=ig(w);if(O===null)return null;if(O.mode&lo){var G=pn(w)||"Component";if(!DR[G]){DR[G]=!0;var Y=ao;try{fa(O),w.mode&lo?C("%s is deprecated in StrictMode. %s was passed an instance of %s which is inside StrictMode. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",u,u,G):C("%s is deprecated in StrictMode. %s was passed an instance of %s which renders StrictMode children. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node",u,u,G)}finally{Y?fa(Y):Ba()}}}return O.stateNode}}function VD(l,u,w,I,O,G,Y,oe){var fe=!1,Oe=null;return BD(l,u,fe,Oe,w,I,O,G,Y)}function jD(l,u,w,I,O,G,Y,oe,fe,Oe){var Ne=!0,ft=BD(w,I,Ne,l,O,G,Y,oe,fe);ft.context=UD(null);var dt=ft.current,Vt=Sc(),jt=S_(dt),ii=th(Vt,jt);return ii.callback=u??null,_c(dt,ii,jt),A2(ft,jt,Vt),ft}function U1(l,u,w,I){hx(u,l);var O=u.current,G=Sc(),Y=S_(O);Ub(Y);var oe=UD(w);u.context===null?u.context=oe:u.pendingContext=oe,gl&&ao!==null&&!IR&&(IR=!0,C(`Render methods should be a pure function of props and state; triggering nested component updates from render is not allowed. If necessary, trigger nested updates in componentDidUpdate.

Check the render method of %s.`,pn(ao)||"Unknown"));var fe=th(G,Y);fe.payload={element:l},I=I===void 0?null:I,I!==null&&(typeof I!="function"&&C("render(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",I),fe.callback=I);var Oe=_c(O,fe,Y);return Oe!==null&&(Xs(Oe,O,Y,G),yc(Oe,O,Y)),Y}function VE(l){var u=l.current;if(!u.child)return null;switch(u.child.tag){case ue:return u.child.stateNode;default:return u.child.stateNode}}function bL(l){switch(l.tag){case K:{var u=l.stateNode;if(Sg(u)){var w=ly(u);M2(u,w)}break}case it:{Am(function(){var O=Xl(l,Zn);if(O!==null){var G=Sc();Xs(O,l,Zn,G)}});var I=Zn;MR(l,I);break}}}function GD(l,u){var w=l.memoizedState;w!==null&&w.dehydrated!==null&&(w.retryLane=Up(w.retryLane,u))}function MR(l,u){GD(l,u);var w=l.alternate;w&&GD(w,u)}function wL(l){if(l.tag===it){var u=Fp,w=Xl(l,u);if(w!==null){var I=Sc();Xs(w,l,u,I)}MR(l,u)}}function TL(l){if(l.tag===it){var u=S_(l),w=Xl(l,u);if(w!==null){var I=Sc();Xs(w,l,u,I)}MR(l,u)}}function HD(l){var u=lf(l);return u===null?null:u.stateNode}var $D=function(l){return null};function SL(l){return $D(l)}var WD=function(l){return!1};function EL(l){return WD(l)}var qD=null,ZD=null,XD=null,YD=null,KD=null,JD=null,QD=null,eM=null,tM=null;{var iM=function(l,u,w){var I=u[w],O=Sr(l)?l.slice():Yt({},l);return w+1===u.length?(Sr(O)?O.splice(I,1):delete O[I],O):(O[I]=iM(l[I],u,w+1),O)},nM=function(l,u){return iM(l,u,0)},rM=function(l,u,w,I){var O=u[I],G=Sr(l)?l.slice():Yt({},l);if(I+1===u.length){var Y=w[I];G[Y]=G[O],Sr(G)?G.splice(O,1):delete G[O]}else G[O]=rM(l[O],u,w,I+1);return G},aM=function(l,u,w){if(u.length!==w.length){E("copyWithRename() expects paths of the same length");return}else for(var I=0;I<w.length-1;I++)if(u[I]!==w[I]){E("copyWithRename() expects paths to be the same except for the deepest key");return}return rM(l,u,w,0)},oM=function(l,u,w,I){if(w>=u.length)return I;var O=u[w],G=Sr(l)?l.slice():Yt({},l);return G[O]=oM(l[O],u,w+1,I),G},sM=function(l,u,w){return oM(l,u,0,w)},PR=function(l,u){for(var w=l.memoizedState;w!==null&&u>0;)w=w.next,u--;return w};qD=function(l,u,w,I){var O=PR(l,u);if(O!==null){var G=sM(O.memoizedState,w,I);O.memoizedState=G,O.baseState=G,l.memoizedProps=Yt({},l.memoizedProps);var Y=Xl(l,Zn);Y!==null&&Xs(Y,l,Zn,gn)}},ZD=function(l,u,w){var I=PR(l,u);if(I!==null){var O=nM(I.memoizedState,w);I.memoizedState=O,I.baseState=O,l.memoizedProps=Yt({},l.memoizedProps);var G=Xl(l,Zn);G!==null&&Xs(G,l,Zn,gn)}},XD=function(l,u,w,I){var O=PR(l,u);if(O!==null){var G=aM(O.memoizedState,w,I);O.memoizedState=G,O.baseState=G,l.memoizedProps=Yt({},l.memoizedProps);var Y=Xl(l,Zn);Y!==null&&Xs(Y,l,Zn,gn)}},YD=function(l,u,w){l.pendingProps=sM(l.memoizedProps,u,w),l.alternate&&(l.alternate.pendingProps=l.pendingProps);var I=Xl(l,Zn);I!==null&&Xs(I,l,Zn,gn)},KD=function(l,u){l.pendingProps=nM(l.memoizedProps,u),l.alternate&&(l.alternate.pendingProps=l.pendingProps);var w=Xl(l,Zn);w!==null&&Xs(w,l,Zn,gn)},JD=function(l,u,w){l.pendingProps=aM(l.memoizedProps,u,w),l.alternate&&(l.alternate.pendingProps=l.pendingProps);var I=Xl(l,Zn);I!==null&&Xs(I,l,Zn,gn)},QD=function(l){var u=Xl(l,Zn);u!==null&&Xs(u,l,Zn,gn)},eM=function(l){$D=l},tM=function(l){WD=l}}function CL(l){var u=ig(l);return u===null?null:u.stateNode}function AL(l){return null}function RL(){return ao}function IL(l){var u=l.findFiberByHostInstance,w=h.ReactCurrentDispatcher;return bh({bundleType:l.bundleType,version:l.version,rendererPackageName:l.rendererPackageName,rendererConfig:l.rendererConfig,overrideHookState:qD,overrideHookStateDeletePath:ZD,overrideHookStateRenamePath:XD,overrideProps:YD,overridePropsDeletePath:KD,overridePropsRenamePath:JD,setErrorHandler:eM,setSuspenseHandler:tM,scheduleUpdate:QD,currentDispatcherRef:w,findHostInstanceByFiber:CL,findFiberByHostInstance:u||AL,findHostInstancesForRefresh:aL,scheduleRefresh:nL,scheduleRoot:rL,setRefreshHandler:iL,getCurrentFiber:RL,reconcilerVersion:RR})}var lM=typeof reportError=="function"?reportError:function(l){console.error(l)};function OR(l){this._internalRoot=l}jE.prototype.render=OR.prototype.render=function(l){var u=this._internalRoot;if(u===null)throw new Error("Cannot update an unmounted root.");{typeof arguments[1]=="function"?C("render(...): does not support the second callback argument. To execute a side effect after rendering, declare it in a component body with useEffect()."):GE(arguments[1])?C("You passed a container to the second argument of root.render(...). You don't need to pass it again since you already passed it to create the root."):typeof arguments[1]<"u"&&C("You passed a second argument to root.render(...) but it only accepts one argument.");var w=u.containerInfo;if(w.nodeType!==Pa){var I=HD(u.current);I&&I.parentNode!==w&&C("render(...): It looks like the React-rendered content of the root container was removed without using React. This is not supported and will cause errors. Instead, call root.unmount() to empty a root's container.")}}U1(l,u,null,null)},jE.prototype.unmount=OR.prototype.unmount=function(){typeof arguments[0]=="function"&&C("unmount(...): does not support a callback argument. To execute a side effect after rendering, declare it in a component body with useEffect().");var l=this._internalRoot;if(l!==null){this._internalRoot=null;var u=l.containerInfo;xD()&&C("Attempted to synchronously unmount a root while React was already rendering. React cannot finish unmounting the root until the current render has completed, which may lead to a race condition."),Am(function(){U1(null,l,null,null)}),Hx(u)}};function DL(l,u){if(!GE(l))throw new Error("createRoot(...): Target container is not a DOM element.");cM(l);var w=!1,I=!1,O="",G=lM;u!=null&&(u.hydrate?E("hydrate through createRoot is deprecated. Use ReactDOMClient.hydrateRoot(container, <App />) instead."):typeof u=="object"&&u!==null&&u.$$typeof===Go&&C(`You passed a JSX element to createRoot. You probably meant to call root.render instead. Example usage:

  let root = createRoot(domContainer);
  root.render(<App />);`),u.unstable_strictMode===!0&&(w=!0),u.identifierPrefix!==void 0&&(O=u.identifierPrefix),u.onRecoverableError!==void 0&&(G=u.onRecoverableError),u.transitionCallbacks!==void 0&&u.transitionCallbacks);var Y=VD(l,Kx,null,w,I,O,G);jy(Y.current,l);var oe=l.nodeType===Pa?l.parentNode:l;return Md(oe),new OR(Y)}function jE(l){this._internalRoot=l}function ML(l){l&&Hu(l)}jE.prototype.unstable_scheduleHydration=ML;function PL(l,u,w){if(!GE(l))throw new Error("hydrateRoot(...): Target container is not a DOM element.");cM(l),u===void 0&&C("Must provide initial children as second argument to hydrateRoot. Example usage: hydrateRoot(domContainer, <App />)");var I=w??null,O=w!=null&&w.hydratedSources||null,G=!1,Y=!1,oe="",fe=lM;w!=null&&(w.unstable_strictMode===!0&&(G=!0),w.identifierPrefix!==void 0&&(oe=w.identifierPrefix),w.onRecoverableError!==void 0&&(fe=w.onRecoverableError));var Oe=jD(u,null,l,Kx,I,G,Y,oe,fe);if(jy(Oe.current,l),Md(l),O)for(var Ne=0;Ne<O.length;Ne++){var ft=O[Ne];zA(Oe,ft)}return new jE(Oe)}function GE(l){return!!(l&&(l.nodeType===Jo||l.nodeType===oo||l.nodeType===Xd))}function V1(l){return!!(l&&(l.nodeType===Jo||l.nodeType===oo||l.nodeType===Xd||l.nodeType===Pa&&l.nodeValue===" react-mount-point-unstable "))}function cM(l){l.nodeType===Jo&&l.tagName&&l.tagName.toUpperCase()==="BODY"&&C("createRoot(): Creating roots directly with document.body is discouraged, since its children are often manipulated by third-party scripts and browser extensions. This may lead to subtle reconciliation issues. Try using a container element created for your app."),im(l)&&(l._reactRootContainer?C("You are calling ReactDOMClient.createRoot() on a container that was previously passed to ReactDOM.render(). This is not supported."):C("You are calling ReactDOMClient.createRoot() on a container that has already been passed to createRoot() before. Instead, call root.render() on the existing root instead if you want to update it."))}var OL=h.ReactCurrentOwner,uM;uM=function(l){if(l._reactRootContainer&&l.nodeType!==Pa){var u=HD(l._reactRootContainer.current);u&&u.parentNode!==l&&C("render(...): It looks like the React-rendered content of this container was removed without using React. This is not supported and will cause errors. Instead, call ReactDOM.unmountComponentAtNode to empty a container.")}var w=!!l._reactRootContainer,I=kR(l),O=!!(I&&Jc(I));O&&!w&&C("render(...): Replacing React-rendered children with a new root component. If you intended to update the children of this node, you should instead have the existing children update their state and render the new components instead of calling ReactDOM.render."),l.nodeType===Jo&&l.tagName&&l.tagName.toUpperCase()==="BODY"&&C("render(): Rendering components directly into document.body is discouraged, since its children are often manipulated by third-party scripts and browser extensions. This may lead to subtle reconciliation issues. Try rendering into a container element created for your app.")};function kR(l){return l?l.nodeType===oo?l.documentElement:l.firstChild:null}function hM(){}function kL(l,u,w,I,O){if(O){if(typeof I=="function"){var G=I;I=function(){var dt=VE(Y);G.call(dt)}}var Y=jD(u,I,l,Of,null,!1,!1,"",hM);l._reactRootContainer=Y,jy(Y.current,l);var oe=l.nodeType===Pa?l.parentNode:l;return Md(oe),Am(),Y}else{for(var fe;fe=l.lastChild;)l.removeChild(fe);if(typeof I=="function"){var Oe=I;I=function(){var dt=VE(Ne);Oe.call(dt)}}var Ne=VD(l,Of,null,!1,!1,"",hM);l._reactRootContainer=Ne,jy(Ne.current,l);var ft=l.nodeType===Pa?l.parentNode:l;return Md(ft),Am(function(){U1(u,Ne,w,I)}),Ne}}function LL(l,u){l!==null&&typeof l!="function"&&C("%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",u,l)}function HE(l,u,w,I,O){uM(w),LL(O===void 0?null:O,"render");var G=w._reactRootContainer,Y;if(!G)Y=kL(w,u,l,O,I);else{if(Y=G,typeof O=="function"){var oe=O;O=function(){var fe=VE(Y);oe.call(fe)}}U1(u,Y,l,O)}return VE(Y)}var dM=!1;function zL(l){{dM||(dM=!0,C("findDOMNode is deprecated and will be removed in the next major release. Instead, add a ref directly to the element you want to reference. Learn more about using refs safely here: https://reactjs.org/link/strict-mode-find-node"));var u=OL.current;if(u!==null&&u.stateNode!==null){var w=u.stateNode._warnedAboutRefsInRender;w||C("%s is accessing findDOMNode inside its render(). render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",Nr(u.type)||"A component"),u.stateNode._warnedAboutRefsInRender=!0}}return l==null?null:l.nodeType===Jo?l:xL(l,"findDOMNode")}function FL(l,u,w){if(C("ReactDOM.hydrate is no longer supported in React 18. Use hydrateRoot instead. Until you switch to the new API, your app will behave as if it's running React 17. Learn more: https://reactjs.org/link/switch-to-createroot"),!V1(u))throw new Error("Target container is not a DOM element.");{var I=im(u)&&u._reactRootContainer===void 0;I&&C("You are calling ReactDOM.hydrate() on a container that was previously passed to ReactDOMClient.createRoot(). This is not supported. Did you mean to call hydrateRoot(container, element)?")}return HE(null,l,u,!0,w)}function NL(l,u,w){if(C("ReactDOM.render is no longer supported in React 18. Use createRoot instead. Until you switch to the new API, your app will behave as if it's running React 17. Learn more: https://reactjs.org/link/switch-to-createroot"),!V1(u))throw new Error("Target container is not a DOM element.");{var I=im(u)&&u._reactRootContainer===void 0;I&&C("You are calling ReactDOM.render() on a container that was previously passed to ReactDOMClient.createRoot(). This is not supported. Did you mean to call root.render(element)?")}return HE(null,l,u,!1,w)}function BL(l,u,w,I){if(C("ReactDOM.unstable_renderSubtreeIntoContainer() is no longer supported in React 18. Consider using a portal instead. Until you switch to the createRoot API, your app will behave as if it's running React 17. Learn more: https://reactjs.org/link/switch-to-createroot"),!V1(w))throw new Error("Target container is not a DOM element.");if(l==null||!sx(l))throw new Error("parentComponent must be a valid React Component");return HE(l,u,w,!1,I)}var fM=!1;function UL(l){if(fM||(fM=!0,C("unmountComponentAtNode is deprecated and will be removed in the next major release. Switch to the createRoot API. Learn more: https://reactjs.org/link/switch-to-createroot")),!V1(l))throw new Error("unmountComponentAtNode(...): Target container is not a DOM element.");{var u=im(l)&&l._reactRootContainer===void 0;u&&C("You are calling ReactDOM.unmountComponentAtNode() on a container that was previously passed to ReactDOMClient.createRoot(). This is not supported. Did you mean to call root.unmount()?")}if(l._reactRootContainer){{var w=kR(l),I=w&&!Jc(w);I&&C("unmountComponentAtNode(): The node you're attempting to unmount was rendered by another copy of React.")}return Am(function(){HE(null,null,l,!1,function(){l._reactRootContainer=null,Hx(l)})}),!0}else{{var O=kR(l),G=!!(O&&Jc(O)),Y=l.nodeType===Jo&&V1(l.parentNode)&&!!l.parentNode._reactRootContainer;G&&C("unmountComponentAtNode(): The node you're attempting to unmount was rendered by React and is not a top-level container. %s",Y?"You may have accidentally passed in a React root node instead of its container.":"Instead, have the parent component update its state and rerender in order to remove this component.")}return!1}}ta(bL),jb(wL),$p(TL),py($l),Wl(mx),(typeof Map!="function"||Map.prototype==null||typeof Map.prototype.forEach!="function"||typeof Set!="function"||Set.prototype==null||typeof Set.prototype.clear!="function"||typeof Set.prototype.forEach!="function")&&C("React depends on Map and Set built-in types. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),Wm(oS),ax(hR,P2,Am);function VL(l,u){var w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(!GE(u))throw new Error("Target container is not a DOM element.");return vL(l,u,null,w)}function jL(l,u,w,I){return BL(l,u,w,I)}var LR={usingClientEntryPoint:!1,Events:[Jc,Wg,$x,ix,H_,hR]};function GL(l,u){return LR.usingClientEntryPoint||C('You are importing createRoot from "react-dom" which is not supported. You should instead import it from "react-dom/client".'),DL(l,u)}function HL(l,u,w){return LR.usingClientEntryPoint||C('You are importing hydrateRoot from "react-dom" which is not supported. You should instead import it from "react-dom/client".'),PL(l,u,w)}function $L(l){return xD()&&C("flushSync was called from inside a lifecycle method. React cannot flush when React is already rendering. Consider moving this call to a scheduler task or micro task."),Am(l)}var WL=IL({findFiberByHostInstance:Od,bundleType:1,version:RR,rendererPackageName:"react-dom"});if(!WL&&gr&&window.top===window.self&&(navigator.userAgent.indexOf("Chrome")>-1&&navigator.userAgent.indexOf("Edge")===-1||navigator.userAgent.indexOf("Firefox")>-1)){var pM=window.location.protocol;/^(https?|file):$/.test(pM)&&console.info("%cDownload the React DevTools for a better development experience: https://reactjs.org/link/react-devtools"+(pM==="file:"?`
You might need to use a local HTTP server (instead of file://): https://reactjs.org/link/react-devtools-faq`:""),"font-weight:bold")}sh.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=LR,sh.createPortal=VL,sh.createRoot=GL,sh.findDOMNode=zL,sh.flushSync=$L,sh.hydrate=FL,sh.hydrateRoot=HL,sh.render=NL,sh.unmountComponentAtNode=UL,sh.unstable_batchedUpdates=hR,sh.unstable_renderSubtreeIntoContainer=jL,sh.version=RR,typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop=="function"&&__REACT_DEVTOOLS_GLOBAL_HOOK__.registerInternalModuleStop(new Error)})();TO.exports=sh;var iz=TO.exports,zR=iz;{var $E=zR.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;sI.createRoot=function(d,s){$E.usingClientEntryPoint=!0;try{return zR.createRoot(d,s)}finally{$E.usingClientEntryPoint=!1}},sI.hydrateRoot=function(d,s,h){$E.usingClientEntryPoint=!0;try{return zR.hydrateRoot(d,s,h)}finally{$E.usingClientEntryPoint=!1}}}/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function mT(){return mT=Object.assign?Object.assign.bind():function(d){for(var s=1;s<arguments.length;s++){var h=arguments[s];for(var _ in h)Object.prototype.hasOwnProperty.call(h,_)&&(d[_]=h[_])}return d},mT.apply(this,arguments)}var I_;(function(d){d.Pop="POP",d.Push="PUSH",d.Replace="REPLACE"})(I_||(I_={}));const mM="popstate";function nz(d){d===void 0&&(d={});function s(_,v){let{pathname:E,search:C,hash:r}=_.location;return lI("",{pathname:E,search:C,hash:r},v.state&&v.state.usr||null,v.state&&v.state.key||"default")}function h(_,v){return typeof v=="string"?v:gT(v)}return az(s,h,null,d)}function jo(d,s){if(d===!1||d===null||typeof d>"u")throw new Error(s)}function Gd(d,s){if(!d){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function rz(){return Math.random().toString(36).substr(2,8)}function gM(d,s){return{usr:d.state,key:d.key,idx:s}}function lI(d,s,h,_){return h===void 0&&(h=null),mT({pathname:typeof d=="string"?d:d.pathname,search:"",hash:""},typeof s=="string"?Rb(s):s,{state:h,key:s&&s.key||_||rz()})}function gT(d){let{pathname:s="/",search:h="",hash:_=""}=d;return h&&h!=="?"&&(s+=h.charAt(0)==="?"?h:"?"+h),_&&_!=="#"&&(s+=_.charAt(0)==="#"?_:"#"+_),s}function Rb(d){let s={};if(d){let h=d.indexOf("#");h>=0&&(s.hash=d.substr(h),d=d.substr(0,h));let _=d.indexOf("?");_>=0&&(s.search=d.substr(_),d=d.substr(0,_)),d&&(s.pathname=d)}return s}function az(d,s,h,_){_===void 0&&(_={});let{window:v=document.defaultView,v5Compat:E=!1}=_,C=v.history,r=I_.Pop,z=null,N=H();N==null&&(N=0,C.replaceState(mT({},C.state,{idx:N}),""));function H(){return(C.state||{idx:null}).idx}function K(){r=I_.Pop;let be=H(),je=be==null?null:be-N;N=be,z&&z({action:r,location:xe.location,delta:je})}function ne(be,je){r=I_.Push;let Be=lI(xe.location,be,je);N=H()+1;let He=gM(Be,N),Xe=xe.createHref(Be);try{C.pushState(He,"",Xe)}catch(it){if(it instanceof DOMException&&it.name==="DataCloneError")throw it;v.location.assign(Xe)}E&&z&&z({action:r,location:xe.location,delta:1})}function ue(be,je){r=I_.Replace;let Be=lI(xe.location,be,je);N=H();let He=gM(Be,N),Xe=xe.createHref(Be);C.replaceState(He,"",Xe),E&&z&&z({action:r,location:xe.location,delta:0})}function pe(be){let je=v.location.origin!=="null"?v.location.origin:v.location.href,Be=typeof be=="string"?be:gT(be);return Be=Be.replace(/ $/,"%20"),jo(je,"No window.location.(origin|href) available to create URL for href: "+Be),new URL(Be,je)}let xe={get action(){return r},get location(){return d(v,C)},listen(be){if(z)throw new Error("A history only accepts one active listener");return v.addEventListener(mM,K),z=be,()=>{v.removeEventListener(mM,K),z=null}},createHref(be){return s(v,be)},createURL:pe,encodeLocation(be){let je=pe(be);return{pathname:je.pathname,search:je.search,hash:je.hash}},push:ne,replace:ue,go(be){return C.go(be)}};return xe}var _M;(function(d){d.data="data",d.deferred="deferred",d.redirect="redirect",d.error="error"})(_M||(_M={}));function oz(d,s,h){return h===void 0&&(h="/"),sz(d,s,h)}function sz(d,s,h,_){let v=typeof s=="string"?Rb(s):s,E=z_(v.pathname||"/",h);if(E==null)return null;let C=CO(d);lz(C);let r=null;for(let z=0;r==null&&z<C.length;++z){let N=vz(E);r=_z(C[z],N)}return r}function CO(d,s,h,_){s===void 0&&(s=[]),h===void 0&&(h=[]),_===void 0&&(_="");let v=(E,C,r)=>{let z={relativePath:r===void 0?E.path||"":r,caseSensitive:E.caseSensitive===!0,childrenIndex:C,route:E};z.relativePath.startsWith("/")&&(jo(z.relativePath.startsWith(_),'Absolute route path "'+z.relativePath+'" nested under path '+('"'+_+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),z.relativePath=z.relativePath.slice(_.length));let N=Lm([_,z.relativePath]),H=h.concat(z);E.children&&E.children.length>0&&(jo(E.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+N+'".')),CO(E.children,s,H,N)),!(E.path==null&&!E.index)&&s.push({path:N,score:mz(N,E.index),routesMeta:H})};return d.forEach((E,C)=>{var r;if(E.path===""||!((r=E.path)!=null&&r.includes("?")))v(E,C);else for(let z of AO(E.path))v(E,C,z)}),s}function AO(d){let s=d.split("/");if(s.length===0)return[];let[h,..._]=s,v=h.endsWith("?"),E=h.replace(/\?$/,"");if(_.length===0)return v?[E,""]:[E];let C=AO(_.join("/")),r=[];return r.push(...C.map(z=>z===""?E:[E,z].join("/"))),v&&r.push(...C),r.map(z=>d.startsWith("/")&&z===""?"/":z)}function lz(d){d.sort((s,h)=>s.score!==h.score?h.score-s.score:gz(s.routesMeta.map(_=>_.childrenIndex),h.routesMeta.map(_=>_.childrenIndex)))}const cz=/^:[\w-]+$/,uz=3,hz=2,dz=1,fz=10,pz=-2,yM=d=>d==="*";function mz(d,s){let h=d.split("/"),_=h.length;return h.some(yM)&&(_+=pz),s&&(_+=hz),h.filter(v=>!yM(v)).reduce((v,E)=>v+(cz.test(E)?uz:E===""?dz:fz),_)}function gz(d,s){return d.length===s.length&&d.slice(0,-1).every((_,v)=>_===s[v])?d[d.length-1]-s[s.length-1]:0}function _z(d,s,h){let{routesMeta:_}=d,v={},E="/",C=[];for(let r=0;r<_.length;++r){let z=_[r],N=r===_.length-1,H=E==="/"?s:s.slice(E.length)||"/",K=cI({path:z.relativePath,caseSensitive:z.caseSensitive,end:N},H),ne=z.route;if(!K)return null;Object.assign(v,K.params),C.push({params:v,pathname:Lm([E,K.pathname]),pathnameBase:Tz(Lm([E,K.pathnameBase])),route:ne}),K.pathnameBase!=="/"&&(E=Lm([E,K.pathnameBase]))}return C}function cI(d,s){typeof d=="string"&&(d={path:d,caseSensitive:!1,end:!0});let[h,_]=yz(d.path,d.caseSensitive,d.end),v=s.match(h);if(!v)return null;let E=v[0],C=E.replace(/(.)\/+$/,"$1"),r=v.slice(1);return{params:_.reduce((N,H,K)=>{let{paramName:ne,isOptional:ue}=H;if(ne==="*"){let xe=r[K]||"";C=E.slice(0,E.length-xe.length).replace(/(.)\/+$/,"$1")}const pe=r[K];return ue&&!pe?N[ne]=void 0:N[ne]=(pe||"").replace(/%2F/g,"/"),N},{}),pathname:E,pathnameBase:C,pattern:d}}function yz(d,s,h){s===void 0&&(s=!1),h===void 0&&(h=!0),Gd(d==="*"||!d.endsWith("*")||d.endsWith("/*"),'Route path "'+d+'" will be treated as if it were '+('"'+d.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+d.replace(/\*$/,"/*")+'".'));let _=[],v="^"+d.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(C,r,z)=>(_.push({paramName:r,isOptional:z!=null}),z?"/?([^\\/]+)?":"/([^\\/]+)"));return d.endsWith("*")?(_.push({paramName:"*"}),v+=d==="*"||d==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):h?v+="\\/*$":d!==""&&d!=="/"&&(v+="(?:(?=\\/|$))"),[new RegExp(v,s?void 0:"i"),_]}function vz(d){try{return d.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return Gd(!1,'The URL path "'+d+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),d}}function z_(d,s){if(s==="/")return d;if(!d.toLowerCase().startsWith(s.toLowerCase()))return null;let h=s.endsWith("/")?s.length-1:s.length,_=d.charAt(h);return _&&_!=="/"?null:d.slice(h)||"/"}function xz(d,s){s===void 0&&(s="/");let{pathname:h,search:_="",hash:v=""}=typeof d=="string"?Rb(d):d;return{pathname:h?h.startsWith("/")?h:bz(h,s):s,search:Sz(_),hash:Ez(v)}}function bz(d,s){let h=s.replace(/\/+$/,"").split("/");return d.split("/").forEach(v=>{v===".."?h.length>1&&h.pop():v!=="."&&h.push(v)}),h.length>1?h.join("/"):"/"}function FR(d,s,h,_){return"Cannot include a '"+d+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(_)+"].  Please separate it out to the ")+("`to."+h+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function wz(d){return d.filter((s,h)=>h===0||s.route.path&&s.route.path.length>0)}function DI(d,s){let h=wz(d);return s?h.map((_,v)=>v===h.length-1?_.pathname:_.pathnameBase):h.map(_=>_.pathnameBase)}function MI(d,s,h,_){_===void 0&&(_=!1);let v;typeof d=="string"?v=Rb(d):(v=mT({},d),jo(!v.pathname||!v.pathname.includes("?"),FR("?","pathname","search",v)),jo(!v.pathname||!v.pathname.includes("#"),FR("#","pathname","hash",v)),jo(!v.search||!v.search.includes("#"),FR("#","search","hash",v)));let E=d===""||v.pathname==="",C=E?"/":v.pathname,r;if(C==null)r=h;else{let K=s.length-1;if(!_&&C.startsWith("..")){let ne=C.split("/");for(;ne[0]==="..";)ne.shift(),K-=1;v.pathname=ne.join("/")}r=K>=0?s[K]:"/"}let z=xz(v,r),N=C&&C!=="/"&&C.endsWith("/"),H=(E||C===".")&&h.endsWith("/");return!z.pathname.endsWith("/")&&(N||H)&&(z.pathname+="/"),z}const Lm=d=>d.join("/").replace(/\/\/+/g,"/"),Tz=d=>d.replace(/\/+$/,"").replace(/^\/*/,"/"),Sz=d=>!d||d==="?"?"":d.startsWith("?")?d:"?"+d,Ez=d=>!d||d==="#"?"":d.startsWith("#")?d:"#"+d;function Cz(d){return d!=null&&typeof d.status=="number"&&typeof d.statusText=="string"&&typeof d.internal=="boolean"&&"data"in d}const RO=["post","put","patch","delete"];new Set(RO);const Az=["get",...RO];new Set(Az);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _T(){return _T=Object.assign?Object.assign.bind():function(d){for(var s=1;s<arguments.length;s++){var h=arguments[s];for(var _ in h)Object.prototype.hasOwnProperty.call(h,_)&&(d[_]=h[_])}return d},_T.apply(this,arguments)}const ET=Ct.createContext(null);ET.displayName="DataRouter";const PI=Ct.createContext(null);PI.displayName="DataRouterState";const Rz=Ct.createContext(null);Rz.displayName="Await";const sd=Ct.createContext(null);sd.displayName="Navigation";const CT=Ct.createContext(null);CT.displayName="Location";const hp=Ct.createContext({outlet:null,matches:[],isDataRoute:!1});hp.displayName="Route";const OI=Ct.createContext(null);OI.displayName="RouteError";function Iz(d,s){let{relative:h}=s===void 0?{}:s;Ib()||jo(!1,"useHref() may be used only in the context of a <Router> component.");let{basename:_,navigator:v}=Ct.useContext(sd),{hash:E,pathname:C,search:r}=AT(d,{relative:h}),z=C;return _!=="/"&&(z=C==="/"?_:Lm([_,C])),v.createHref({pathname:z,search:r,hash:E})}function Ib(){return Ct.useContext(CT)!=null}function Kv(){return Ib()||jo(!1,"useLocation() may be used only in the context of a <Router> component."),Ct.useContext(CT).location}const IO="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function DO(d){Ct.useContext(sd).static||Ct.useLayoutEffect(d)}function MO(){let{isDataRoute:d}=Ct.useContext(hp);return d?Gz():Dz()}function Dz(){Ib()||jo(!1,"useNavigate() may be used only in the context of a <Router> component.");let d=Ct.useContext(ET),{basename:s,future:h,navigator:_}=Ct.useContext(sd),{matches:v}=Ct.useContext(hp),{pathname:E}=Kv(),C=JSON.stringify(DI(v,h.v7_relativeSplatPath)),r=Ct.useRef(!1);return DO(()=>{r.current=!0}),Ct.useCallback(function(N,H){if(H===void 0&&(H={}),Gd(r.current,IO),!r.current)return;if(typeof N=="number"){_.go(N);return}let K=MI(N,JSON.parse(C),E,H.relative==="path");d==null&&s!=="/"&&(K.pathname=K.pathname==="/"?s:Lm([s,K.pathname])),(H.replace?_.replace:_.push)(K,H.state,H)},[s,_,C,E,d])}function AT(d,s){let{relative:h}=s===void 0?{}:s,{future:_}=Ct.useContext(sd),{matches:v}=Ct.useContext(hp),{pathname:E}=Kv(),C=JSON.stringify(DI(v,_.v7_relativeSplatPath));return Ct.useMemo(()=>MI(d,JSON.parse(C),E,h==="path"),[d,C,E,h])}function Mz(d,s){return Pz(d,s)}function Pz(d,s,h,_){Ib()||jo(!1,"useRoutes() may be used only in the context of a <Router> component.");let{navigator:v}=Ct.useContext(sd),{matches:E}=Ct.useContext(hp),C=E[E.length-1],r=C?C.params:{},z=C?C.pathname:"/",N=C?C.pathnameBase:"/",H=C&&C.route;{let Be=H&&H.path||"";OO(z,!H||Be.endsWith("*"),"You rendered descendant <Routes> (or called `useRoutes()`) at "+('"'+z+'" (under <Route path="'+Be+'">) but the ')+`parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

`+('Please change the parent <Route path="'+Be+'"> to <Route ')+('path="'+(Be==="/"?"*":Be+"/*")+'">.'))}let K=Kv(),ne;if(s){var ue;let Be=typeof s=="string"?Rb(s):s;N==="/"||(ue=Be.pathname)!=null&&ue.startsWith(N)||jo(!1,"When overriding the location using `<Routes location>` or `useRoutes(routes, location)`, the location pathname must begin with the portion of the URL pathname that was "+('matched by all parent routes. The current pathname base is "'+N+'" ')+('but pathname "'+Be.pathname+'" was given in the `location` prop.')),ne=Be}else ne=K;let pe=ne.pathname||"/",xe=pe;if(N!=="/"){let Be=N.replace(/^\//,"").split("/");xe="/"+pe.replace(/^\//,"").split("/").slice(Be.length).join("/")}let be=oz(d,{pathname:xe});Gd(H||be!=null,'No routes matched location "'+ne.pathname+ne.search+ne.hash+'" '),Gd(be==null||be[be.length-1].route.element!==void 0||be[be.length-1].route.Component!==void 0||be[be.length-1].route.lazy!==void 0,'Matched leaf route at location "'+ne.pathname+ne.search+ne.hash+'" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.');let je=Fz(be&&be.map(Be=>Object.assign({},Be,{params:Object.assign({},r,Be.params),pathname:Lm([N,v.encodeLocation?v.encodeLocation(Be.pathname).pathname:Be.pathname]),pathnameBase:Be.pathnameBase==="/"?N:Lm([N,v.encodeLocation?v.encodeLocation(Be.pathnameBase).pathname:Be.pathnameBase])})),E,h,_);return s&&je?Ct.createElement(CT.Provider,{value:{location:_T({pathname:"/",search:"",hash:"",state:null,key:"default"},ne),navigationType:I_.Pop}},je):je}function Oz(){let d=jz(),s=Cz(d)?d.status+" "+d.statusText:d instanceof Error?d.message:JSON.stringify(d),h=d instanceof Error?d.stack:null,_="rgba(200,200,200, 0.5)",v={padding:"0.5rem",backgroundColor:_},E={padding:"2px 4px",backgroundColor:_},C=null;return console.error("Error handled by React Router default ErrorBoundary:",d),C=Ct.createElement(Ct.Fragment,null,Ct.createElement("p",null," Hey developer "),Ct.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Ct.createElement("code",{style:E},"ErrorBoundary")," or"," ",Ct.createElement("code",{style:E},"errorElement")," prop on your route.")),Ct.createElement(Ct.Fragment,null,Ct.createElement("h2",null,"Unexpected Application Error!"),Ct.createElement("h3",{style:{fontStyle:"italic"}},s),h?Ct.createElement("pre",{style:v},h):null,C)}const kz=Ct.createElement(Oz,null);class Lz extends Ct.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,h){return h.location!==s.location||h.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:h.error,location:h.location,revalidation:s.revalidation||h.revalidation}}componentDidCatch(s,h){console.error("React Router caught the following error during render",s,h)}render(){return this.state.error!==void 0?Ct.createElement(hp.Provider,{value:this.props.routeContext},Ct.createElement(OI.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function zz(d){let{routeContext:s,match:h,children:_}=d,v=Ct.useContext(ET);return v&&v.static&&v.staticContext&&(h.route.errorElement||h.route.ErrorBoundary)&&(v.staticContext._deepestRenderedBoundaryId=h.route.id),Ct.createElement(hp.Provider,{value:s},_)}function Fz(d,s,h,_){var v;if(s===void 0&&(s=[]),h===void 0&&(h=null),_===void 0&&(_=null),d==null){var E;if(!h)return null;if(h.errors)d=h.matches;else if((E=_)!=null&&E.v7_partialHydration&&s.length===0&&!h.initialized&&h.matches.length>0)d=h.matches;else return null}let C=d,r=(v=h)==null?void 0:v.errors;if(r!=null){let H=C.findIndex(K=>K.route.id&&(r==null?void 0:r[K.route.id])!==void 0);H>=0||jo(!1,"Could not find a matching route for errors on route IDs: "+Object.keys(r).join(",")),C=C.slice(0,Math.min(C.length,H+1))}let z=!1,N=-1;if(h&&_&&_.v7_partialHydration)for(let H=0;H<C.length;H++){let K=C[H];if((K.route.HydrateFallback||K.route.hydrateFallbackElement)&&(N=H),K.route.id){let{loaderData:ne,errors:ue}=h,pe=K.route.loader&&ne[K.route.id]===void 0&&(!ue||ue[K.route.id]===void 0);if(K.route.lazy||pe){z=!0,N>=0?C=C.slice(0,N+1):C=[C[0]];break}}}return C.reduceRight((H,K,ne)=>{let ue,pe=!1,xe=null,be=null;h&&(ue=r&&K.route.id?r[K.route.id]:void 0,xe=K.route.errorElement||kz,z&&(N<0&&ne===0?(OO("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),pe=!0,be=null):N===ne&&(pe=!0,be=K.route.hydrateFallbackElement||null)));let je=s.concat(C.slice(0,ne+1)),Be=()=>{let He;return ue?He=xe:pe?He=be:K.route.Component?He=Ct.createElement(K.route.Component,null):K.route.element?He=K.route.element:He=H,Ct.createElement(zz,{match:K,routeContext:{outlet:H,matches:je,isDataRoute:h!=null},children:He})};return h&&(K.route.ErrorBoundary||K.route.errorElement||ne===0)?Ct.createElement(Lz,{location:h.location,revalidation:h.revalidation,component:xe,error:ue,children:Be(),routeContext:{outlet:null,matches:je,isDataRoute:!0}}):Be()},null)}var PO=function(d){return d.UseBlocker="useBlocker",d.UseRevalidator="useRevalidator",d.UseNavigateStable="useNavigate",d}(PO||{}),yT=function(d){return d.UseBlocker="useBlocker",d.UseLoaderData="useLoaderData",d.UseActionData="useActionData",d.UseRouteError="useRouteError",d.UseNavigation="useNavigation",d.UseRouteLoaderData="useRouteLoaderData",d.UseMatches="useMatches",d.UseRevalidator="useRevalidator",d.UseNavigateStable="useNavigate",d.UseRouteId="useRouteId",d}(yT||{});function kI(d){return d+" must be used within a data router.  See https://reactrouter.com/v6/routers/picking-a-router."}function Nz(d){let s=Ct.useContext(ET);return s||jo(!1,kI(d)),s}function Bz(d){let s=Ct.useContext(PI);return s||jo(!1,kI(d)),s}function Uz(d){let s=Ct.useContext(hp);return s||jo(!1,kI(d)),s}function LI(d){let s=Uz(d),h=s.matches[s.matches.length-1];return h.route.id||jo(!1,d+' can only be used on routes that contain a unique "id"'),h.route.id}function Vz(){return LI(yT.UseRouteId)}function jz(){var d;let s=Ct.useContext(OI),h=Bz(yT.UseRouteError),_=LI(yT.UseRouteError);return s!==void 0?s:(d=h.errors)==null?void 0:d[_]}function Gz(){let{router:d}=Nz(PO.UseNavigateStable),s=LI(yT.UseNavigateStable),h=Ct.useRef(!1);return DO(()=>{h.current=!0}),Ct.useCallback(function(v,E){E===void 0&&(E={}),Gd(h.current,IO),h.current&&(typeof v=="number"?d.navigate(v):d.navigate(v,_T({fromRouteId:s},E)))},[d,s])}const vM={};function OO(d,s,h){!s&&!vM[d]&&(vM[d]=!0,Gd(!1,h))}const xM={};function Hz(d,s){xM[s]||(xM[s]=!0,console.warn(s))}const bM=(d,s,h)=>Hz(d," React Router Future Flag Warning: "+s+". "+("You can use the `"+d+"` future flag to opt-in early. ")+("For more information, see "+h+"."));function $z(d,s){(d==null?void 0:d.v7_startTransition)===void 0&&bM("v7_startTransition","React Router will begin wrapping state updates in `React.startTransition` in v7","https://reactrouter.com/v6/upgrading/future#v7_starttransition"),(d==null?void 0:d.v7_relativeSplatPath)===void 0&&bM("v7_relativeSplatPath","Relative route resolution within Splat routes is changing in v7","https://reactrouter.com/v6/upgrading/future#v7_relativesplatpath")}function kO(d){let{to:s,replace:h,state:_,relative:v}=d;Ib()||jo(!1,"<Navigate> may be used only in the context of a <Router> component.");let{future:E,static:C}=Ct.useContext(sd);Gd(!C,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:r}=Ct.useContext(hp),{pathname:z}=Kv(),N=MO(),H=MI(s,DI(r,E.v7_relativeSplatPath),z,v==="path"),K=JSON.stringify(H);return Ct.useEffect(()=>N(JSON.parse(K),{replace:h,state:_,relative:v}),[N,K,v,h,_]),null}function Q1(d){jo(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Wz(d){let{basename:s="/",children:h=null,location:_,navigationType:v=I_.Pop,navigator:E,static:C=!1,future:r}=d;Ib()&&jo(!1,"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let z=s.replace(/^\/*/,"/"),N=Ct.useMemo(()=>({basename:z,navigator:E,static:C,future:_T({v7_relativeSplatPath:!1},r)}),[z,r,E,C]);typeof _=="string"&&(_=Rb(_));let{pathname:H="/",search:K="",hash:ne="",state:ue=null,key:pe="default"}=_,xe=Ct.useMemo(()=>{let be=z_(H,z);return be==null?null:{location:{pathname:be,search:K,hash:ne,state:ue,key:pe},navigationType:v}},[z,H,K,ne,ue,pe,v]);return Gd(xe!=null,'<Router basename="'+z+'"> is not able to match the URL '+('"'+H+K+ne+'" because it does not start with the ')+"basename, so the <Router> won't render anything."),xe==null?null:Ct.createElement(sd.Provider,{value:N},Ct.createElement(CT.Provider,{children:h,value:xe}))}function qz(d){let{children:s,location:h}=d;return Mz(uI(s),h)}new Promise(()=>{});function uI(d,s){s===void 0&&(s=[]);let h=[];return Ct.Children.forEach(d,(_,v)=>{if(!Ct.isValidElement(_))return;let E=[...s,v];if(_.type===Ct.Fragment){h.push.apply(h,uI(_.props.children,E));return}_.type!==Q1&&jo(!1,"["+(typeof _.type=="string"?_.type:_.type.name)+"] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>"),!_.props.index||!_.props.children||jo(!1,"An index route cannot have child routes.");let C={id:_.props.id||E.join("-"),caseSensitive:_.props.caseSensitive,element:_.props.element,Component:_.props.Component,index:_.props.index,path:_.props.path,loader:_.props.loader,action:_.props.action,errorElement:_.props.errorElement,ErrorBoundary:_.props.ErrorBoundary,hasErrorBoundary:_.props.ErrorBoundary!=null||_.props.errorElement!=null,shouldRevalidate:_.props.shouldRevalidate,handle:_.props.handle,lazy:_.props.lazy};_.props.children&&(C.children=uI(_.props.children,E)),h.push(C)}),h}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Tb(){return Tb=Object.assign?Object.assign.bind():function(d){for(var s=1;s<arguments.length;s++){var h=arguments[s];for(var _ in h)Object.prototype.hasOwnProperty.call(h,_)&&(d[_]=h[_])}return d},Tb.apply(this,arguments)}function zI(d,s){if(d==null)return{};var h={},_=Object.keys(d),v,E;for(E=0;E<_.length;E++)v=_[E],!(s.indexOf(v)>=0)&&(h[v]=d[v]);return h}const uC="get",hC="application/x-www-form-urlencoded";function zC(d){return d!=null&&typeof d.tagName=="string"}function Zz(d){return zC(d)&&d.tagName.toLowerCase()==="button"}function Xz(d){return zC(d)&&d.tagName.toLowerCase()==="form"}function Yz(d){return zC(d)&&d.tagName.toLowerCase()==="input"}function Kz(d){return!!(d.metaKey||d.altKey||d.ctrlKey||d.shiftKey)}function Jz(d,s){return d.button===0&&(!s||s==="_self")&&!Kz(d)}let WE=null;function Qz(){if(WE===null)try{new FormData(document.createElement("form"),0),WE=!1}catch{WE=!0}return WE}const eF=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function NR(d){return d!=null&&!eF.has(d)?(Gd(!1,'"'+d+'" is not a valid `encType` for `<Form>`/`<fetcher.Form>` '+('and will default to "'+hC+'"')),null):d}function tF(d,s){let h,_,v,E,C;if(Xz(d)){let r=d.getAttribute("action");_=r?z_(r,s):null,h=d.getAttribute("method")||uC,v=NR(d.getAttribute("enctype"))||hC,E=new FormData(d)}else if(Zz(d)||Yz(d)&&(d.type==="submit"||d.type==="image")){let r=d.form;if(r==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let z=d.getAttribute("formaction")||r.getAttribute("action");if(_=z?z_(z,s):null,h=d.getAttribute("formmethod")||r.getAttribute("method")||uC,v=NR(d.getAttribute("formenctype"))||NR(r.getAttribute("enctype"))||hC,E=new FormData(r,d),!Qz()){let{name:N,type:H,value:K}=d;if(H==="image"){let ne=N?N+".":"";E.append(ne+"x","0"),E.append(ne+"y","0")}else N&&E.append(N,K)}}else{if(zC(d))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');h=uC,_=null,v=hC,C=d}return E&&v==="text/plain"&&(C=E,E=void 0),{action:_,method:h.toLowerCase(),encType:v,formData:E,body:C}}const iF=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],nF=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],rF=["fetcherKey","navigate","reloadDocument","replace","state","method","action","onSubmit","relative","preventScrollReset","viewTransition"],aF="6";try{window.__reactRouterVersion=aF}catch{}const LO=Ct.createContext({isTransitioning:!1});LO.displayName="ViewTransition";const oF=Ct.createContext(new Map);oF.displayName="Fetchers";const sF="startTransition",wM=ez[sF];function lF(d){let{basename:s,children:h,future:_,window:v}=d,E=Ct.useRef();E.current==null&&(E.current=nz({window:v,v5Compat:!0}));let C=E.current,[r,z]=Ct.useState({action:C.action,location:C.location}),{v7_startTransition:N}=_||{},H=Ct.useCallback(K=>{N&&wM?wM(()=>z(K)):z(K)},[z,N]);return Ct.useLayoutEffect(()=>C.listen(H),[C,H]),Ct.useEffect(()=>$z(_),[_]),Ct.createElement(Wz,{basename:s,children:h,location:r.location,navigationType:r.action,navigator:C,future:_})}const cF=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",uF=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,zO=Ct.forwardRef(function(s,h){let{onClick:_,relative:v,reloadDocument:E,replace:C,state:r,target:z,to:N,preventScrollReset:H,viewTransition:K}=s,ne=zI(s,iF),{basename:ue}=Ct.useContext(sd),pe,xe=!1;if(typeof N=="string"&&uF.test(N)&&(pe=N,cF))try{let He=new URL(window.location.href),Xe=N.startsWith("//")?new URL(He.protocol+N):new URL(N),it=z_(Xe.pathname,ue);Xe.origin===He.origin&&it!=null?N=it+Xe.search+Xe.hash:xe=!0}catch{Gd(!1,'<Link to="'+N+'"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.')}let be=Iz(N,{relative:v}),je=pF(N,{replace:C,state:r,target:z,preventScrollReset:H,relative:v,viewTransition:K});function Be(He){_&&_(He),He.defaultPrevented||je(He)}return Ct.createElement("a",Tb({},ne,{href:pe||be,onClick:xe||E?_:Be,ref:h,target:z}))});zO.displayName="Link";const hF=Ct.forwardRef(function(s,h){let{"aria-current":_="page",caseSensitive:v=!1,className:E="",end:C=!1,style:r,to:z,viewTransition:N,children:H}=s,K=zI(s,nF),ne=AT(z,{relative:K.relative}),ue=Kv(),pe=Ct.useContext(PI),{navigator:xe,basename:be}=Ct.useContext(sd),je=pe!=null&&xF(ne)&&N===!0,Be=xe.encodeLocation?xe.encodeLocation(ne).pathname:ne.pathname,He=ue.pathname,Xe=pe&&pe.navigation&&pe.navigation.location?pe.navigation.location.pathname:null;v||(He=He.toLowerCase(),Xe=Xe?Xe.toLowerCase():null,Be=Be.toLowerCase()),Xe&&be&&(Xe=z_(Xe,be)||Xe);const it=Be!=="/"&&Be.endsWith("/")?Be.length-1:Be.length;let kt=He===Be||!C&&He.startsWith(Be)&&He.charAt(it)==="/",Nt=Xe!=null&&(Xe===Be||!C&&Xe.startsWith(Be)&&Xe.charAt(Be.length)==="/"),oi={isActive:kt,isPending:Nt,isTransitioning:je},yi=kt?_:void 0,Ui;typeof E=="function"?Ui=E(oi):Ui=[E,kt?"active":null,Nt?"pending":null,je?"transitioning":null].filter(Boolean).join(" ");let hi=typeof r=="function"?r(oi):r;return Ct.createElement(zO,Tb({},K,{"aria-current":yi,className:Ui,ref:h,style:hi,to:z,viewTransition:N}),typeof H=="function"?H(oi):H)});hF.displayName="NavLink";const dF=Ct.forwardRef((d,s)=>{let{fetcherKey:h,navigate:_,reloadDocument:v,replace:E,state:C,method:r=uC,action:z,onSubmit:N,relative:H,preventScrollReset:K,viewTransition:ne}=d,ue=zI(d,rF),pe=yF(),xe=vF(z,{relative:H}),be=r.toLowerCase()==="get"?"get":"post",je=Be=>{if(N&&N(Be),Be.defaultPrevented)return;Be.preventDefault();let He=Be.nativeEvent.submitter,Xe=(He==null?void 0:He.getAttribute("formmethod"))||r;pe(He||Be.currentTarget,{fetcherKey:h,method:Xe,navigate:_,replace:E,state:C,relative:H,preventScrollReset:K,viewTransition:ne})};return Ct.createElement("form",Tb({ref:s,method:be,action:xe,onSubmit:v?N:je},ue))});dF.displayName="Form";var wC;(function(d){d.UseScrollRestoration="useScrollRestoration",d.UseSubmit="useSubmit",d.UseSubmitFetcher="useSubmitFetcher",d.UseFetcher="useFetcher",d.useViewTransitionState="useViewTransitionState"})(wC||(wC={}));var TM;(function(d){d.UseFetcher="useFetcher",d.UseFetchers="useFetchers",d.UseScrollRestoration="useScrollRestoration"})(TM||(TM={}));function fF(d){return d+" must be used within a data router.  See https://reactrouter.com/v6/routers/picking-a-router."}function FO(d){let s=Ct.useContext(ET);return s||jo(!1,fF(d)),s}function pF(d,s){let{target:h,replace:_,state:v,preventScrollReset:E,relative:C,viewTransition:r}=s===void 0?{}:s,z=MO(),N=Kv(),H=AT(d,{relative:C});return Ct.useCallback(K=>{if(Jz(K,h)){K.preventDefault();let ne=_!==void 0?_:gT(N)===gT(H);z(d,{replace:ne,state:v,preventScrollReset:E,relative:C,viewTransition:r})}},[N,z,H,_,v,h,d,E,C,r])}function mF(){if(typeof document>"u")throw new Error("You are calling submit during the server render. Try calling submit within a `useEffect` or callback instead.")}let gF=0,_F=()=>"__"+String(++gF)+"__";function yF(){let{router:d}=FO(wC.UseSubmit),{basename:s}=Ct.useContext(sd),h=Vz();return Ct.useCallback(function(_,v){v===void 0&&(v={}),mF();let{action:E,method:C,encType:r,formData:z,body:N}=tF(_,s);if(v.navigate===!1){let H=v.fetcherKey||_F();d.fetch(H,h,v.action||E,{preventScrollReset:v.preventScrollReset,formData:z,body:N,formMethod:v.method||C,formEncType:v.encType||r,flushSync:v.flushSync})}else d.navigate(v.action||E,{preventScrollReset:v.preventScrollReset,formData:z,body:N,formMethod:v.method||C,formEncType:v.encType||r,replace:v.replace,state:v.state,fromRouteId:h,flushSync:v.flushSync,viewTransition:v.viewTransition})},[d,s,h])}function vF(d,s){let{relative:h}=s===void 0?{}:s,{basename:_}=Ct.useContext(sd),v=Ct.useContext(hp);v||jo(!1,"useFormAction must be used inside a RouteContext");let[E]=v.matches.slice(-1),C=Tb({},AT(d||".",{relative:h})),r=Kv();if(d==null){C.search=r.search;let z=new URLSearchParams(C.search),N=z.getAll("index");if(N.some(K=>K==="")){z.delete("index"),N.filter(ne=>ne).forEach(ne=>z.append("index",ne));let K=z.toString();C.search=K?"?"+K:""}}return(!d||d===".")&&E.route.index&&(C.search=C.search?C.search.replace(/^\?/,"?index&"):"?index"),_!=="/"&&(C.pathname=C.pathname==="/"?_:Lm([_,C.pathname])),gT(C)}function xF(d,s){s===void 0&&(s={});let h=Ct.useContext(LO);h==null&&jo(!1,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:_}=FO(wC.useViewTransitionState),v=AT(d,{relative:s.relative});if(!h.isTransitioning)return!1;let E=z_(h.currentLocation.pathname,_)||h.currentLocation.pathname,C=z_(h.nextLocation.pathname,_)||h.nextLocation.pathname;return cI(v.pathname,C)!=null||cI(v.pathname,E)!=null}var hI=function(d,s){return hI=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,_){h.__proto__=_}||function(h,_){for(var v in _)Object.prototype.hasOwnProperty.call(_,v)&&(h[v]=_[v])},hI(d,s)};function bF(d,s){if(typeof s!="function"&&s!==null)throw new TypeError("Class extends value "+String(s)+" is not a constructor or null");hI(d,s);function h(){this.constructor=d}d.prototype=s===null?Object.create(s):(h.prototype=s.prototype,new h)}var pl=function(){return pl=Object.assign||function(s){for(var h,_=1,v=arguments.length;_<v;_++){h=arguments[_];for(var E in h)Object.prototype.hasOwnProperty.call(h,E)&&(s[E]=h[E])}return s},pl.apply(this,arguments)};function SM(d,s){var h={};for(var _ in d)Object.prototype.hasOwnProperty.call(d,_)&&s.indexOf(_)<0&&(h[_]=d[_]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function")for(var v=0,_=Object.getOwnPropertySymbols(d);v<_.length;v++)s.indexOf(_[v])<0&&Object.prototype.propertyIsEnumerable.call(d,_[v])&&(h[_[v]]=d[_[v]]);return h}function pb(d,s,h,_){function v(E){return E instanceof h?E:new h(function(C){C(E)})}return new(h||(h=Promise))(function(E,C){function r(H){try{N(_.next(H))}catch(K){C(K)}}function z(H){try{N(_.throw(H))}catch(K){C(K)}}function N(H){H.done?E(H.value):v(H.value).then(r,z)}N((_=_.apply(d,s||[])).next())})}function mb(d,s){var h={label:0,sent:function(){if(E[0]&1)throw E[1];return E[1]},trys:[],ops:[]},_,v,E,C=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return C.next=r(0),C.throw=r(1),C.return=r(2),typeof Symbol=="function"&&(C[Symbol.iterator]=function(){return this}),C;function r(N){return function(H){return z([N,H])}}function z(N){if(_)throw new TypeError("Generator is already executing.");for(;C&&(C=0,N[0]&&(h=0)),h;)try{if(_=1,v&&(E=N[0]&2?v.return:N[0]?v.throw||((E=v.return)&&E.call(v),0):v.next)&&!(E=E.call(v,N[1])).done)return E;switch(v=0,E&&(N=[N[0]&2,E.value]),N[0]){case 0:case 1:E=N;break;case 4:return h.label++,{value:N[1],done:!1};case 5:h.label++,v=N[1],N=[0];continue;case 7:N=h.ops.pop(),h.trys.pop();continue;default:if(E=h.trys,!(E=E.length>0&&E[E.length-1])&&(N[0]===6||N[0]===2)){h=0;continue}if(N[0]===3&&(!E||N[1]>E[0]&&N[1]<E[3])){h.label=N[1];break}if(N[0]===6&&h.label<E[1]){h.label=E[1],E=N;break}if(E&&h.label<E[2]){h.label=E[2],h.ops.push(N);break}E[2]&&h.ops.pop(),h.trys.pop();continue}N=s.call(d,h)}catch(H){N=[6,H],v=0}finally{_=E=0}if(N[0]&5)throw N[1];return{value:N[0]?N[1]:void 0,done:!0}}}function wF(d,s,h){for(var _=0,v=s.length,E;_<v;_++)(E||!(_ in s))&&(E||(E=Array.prototype.slice.call(s,0,_)),E[_]=s[_]);return d.concat(E||Array.prototype.slice.call(s))}function op(d,s){var h={};for(var _ in d)Object.prototype.hasOwnProperty.call(d,_)&&s.indexOf(_)<0&&(h[_]=d[_]);if(d!=null&&typeof Object.getOwnPropertySymbols=="function"){var v=0;for(_=Object.getOwnPropertySymbols(d);v<_.length;v++)s.indexOf(_[v])<0&&Object.prototype.propertyIsEnumerable.call(d,_[v])&&(h[_[v]]=d[_[v]])}return h}var Vv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function FI(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}function NI(d,s){return d(s={exports:{}},s.exports),s.exports}var Nv=NI(function(d,s){Object.defineProperty(s,"__esModule",{value:!0});var h=function(){function _(){var v=this;this.locked=new Map,this.addToLocked=function(E,C){var r=v.locked.get(E);r===void 0?C===void 0?v.locked.set(E,[]):v.locked.set(E,[C]):C!==void 0&&(r.unshift(C),v.locked.set(E,r))},this.isLocked=function(E){return v.locked.has(E)},this.lock=function(E){return new Promise(function(C,r){v.isLocked(E)?v.addToLocked(E,C):(v.addToLocked(E),C())})},this.unlock=function(E){var C=v.locked.get(E);if(C!==void 0&&C.length!==0){var r=C.pop();v.locked.set(E,C),r!==void 0&&setTimeout(r,0)}else v.locked.delete(E)}}return _.getInstance=function(){return _.instance===void 0&&(_.instance=new _),_.instance},_}();s.default=function(){return h.getInstance()}});FI(Nv);var TF=FI(NI(function(d,s){var h=Vv&&Vv.__awaiter||function(H,K,ne,ue){return new(ne||(ne=Promise))(function(pe,xe){function be(He){try{Be(ue.next(He))}catch(Xe){xe(Xe)}}function je(He){try{Be(ue.throw(He))}catch(Xe){xe(Xe)}}function Be(He){He.done?pe(He.value):new ne(function(Xe){Xe(He.value)}).then(be,je)}Be((ue=ue.apply(H,K||[])).next())})},_=Vv&&Vv.__generator||function(H,K){var ne,ue,pe,xe,be={label:0,sent:function(){if(1&pe[0])throw pe[1];return pe[1]},trys:[],ops:[]};return xe={next:je(0),throw:je(1),return:je(2)},typeof Symbol=="function"&&(xe[Symbol.iterator]=function(){return this}),xe;function je(Be){return function(He){return function(Xe){if(ne)throw new TypeError("Generator is already executing.");for(;be;)try{if(ne=1,ue&&(pe=2&Xe[0]?ue.return:Xe[0]?ue.throw||((pe=ue.return)&&pe.call(ue),0):ue.next)&&!(pe=pe.call(ue,Xe[1])).done)return pe;switch(ue=0,pe&&(Xe=[2&Xe[0],pe.value]),Xe[0]){case 0:case 1:pe=Xe;break;case 4:return be.label++,{value:Xe[1],done:!1};case 5:be.label++,ue=Xe[1],Xe=[0];continue;case 7:Xe=be.ops.pop(),be.trys.pop();continue;default:if(pe=be.trys,!((pe=pe.length>0&&pe[pe.length-1])||Xe[0]!==6&&Xe[0]!==2)){be=0;continue}if(Xe[0]===3&&(!pe||Xe[1]>pe[0]&&Xe[1]<pe[3])){be.label=Xe[1];break}if(Xe[0]===6&&be.label<pe[1]){be.label=pe[1],pe=Xe;break}if(pe&&be.label<pe[2]){be.label=pe[2],be.ops.push(Xe);break}pe[2]&&be.ops.pop(),be.trys.pop();continue}Xe=K.call(H,be)}catch(it){Xe=[6,it],ue=0}finally{ne=pe=0}if(5&Xe[0])throw Xe[1];return{value:Xe[0]?Xe[1]:void 0,done:!0}}([Be,He])}}},v=Vv;Object.defineProperty(s,"__esModule",{value:!0});var E="browser-tabs-lock-key",C={key:function(H){return h(v,void 0,void 0,function(){return _(this,function(K){throw new Error("Unsupported")})})},getItem:function(H){return h(v,void 0,void 0,function(){return _(this,function(K){throw new Error("Unsupported")})})},clear:function(){return h(v,void 0,void 0,function(){return _(this,function(H){return[2,window.localStorage.clear()]})})},removeItem:function(H){return h(v,void 0,void 0,function(){return _(this,function(K){throw new Error("Unsupported")})})},setItem:function(H,K){return h(v,void 0,void 0,function(){return _(this,function(ne){throw new Error("Unsupported")})})},keySync:function(H){return window.localStorage.key(H)},getItemSync:function(H){return window.localStorage.getItem(H)},clearSync:function(){return window.localStorage.clear()},removeItemSync:function(H){return window.localStorage.removeItem(H)},setItemSync:function(H,K){return window.localStorage.setItem(H,K)}};function r(H){return new Promise(function(K){return setTimeout(K,H)})}function z(H){for(var K="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",ne="",ue=0;ue<H;ue++)ne+=K[Math.floor(Math.random()*K.length)];return ne}var N=function(){function H(K){this.acquiredIatSet=new Set,this.storageHandler=void 0,this.id=Date.now().toString()+z(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),this.storageHandler=K,H.waiters===void 0&&(H.waiters=[])}return H.prototype.acquireLock=function(K,ne){return ne===void 0&&(ne=5e3),h(this,void 0,void 0,function(){var ue,pe,xe,be,je,Be,He;return _(this,function(Xe){switch(Xe.label){case 0:ue=Date.now()+z(4),pe=Date.now()+ne,xe=E+"-"+K,be=this.storageHandler===void 0?C:this.storageHandler,Xe.label=1;case 1:return Date.now()<pe?[4,r(30)]:[3,8];case 2:return Xe.sent(),be.getItemSync(xe)!==null?[3,5]:(je=this.id+"-"+K+"-"+ue,[4,r(Math.floor(25*Math.random()))]);case 3:return Xe.sent(),be.setItemSync(xe,JSON.stringify({id:this.id,iat:ue,timeoutKey:je,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,r(30)];case 4:return Xe.sent(),(Be=be.getItemSync(xe))!==null&&(He=JSON.parse(Be)).id===this.id&&He.iat===ue?(this.acquiredIatSet.add(ue),this.refreshLockWhileAcquired(xe,ue),[2,!0]):[3,7];case 5:return H.lockCorrector(this.storageHandler===void 0?C:this.storageHandler),[4,this.waitForSomethingToChange(pe)];case 6:Xe.sent(),Xe.label=7;case 7:return ue=Date.now()+z(4),[3,1];case 8:return[2,!1]}})})},H.prototype.refreshLockWhileAcquired=function(K,ne){return h(this,void 0,void 0,function(){var ue=this;return _(this,function(pe){return setTimeout(function(){return h(ue,void 0,void 0,function(){var xe,be,je;return _(this,function(Be){switch(Be.label){case 0:return[4,Nv.default().lock(ne)];case 1:return Be.sent(),this.acquiredIatSet.has(ne)?(xe=this.storageHandler===void 0?C:this.storageHandler,(be=xe.getItemSync(K))===null?(Nv.default().unlock(ne),[2]):((je=JSON.parse(be)).timeRefreshed=Date.now(),xe.setItemSync(K,JSON.stringify(je)),Nv.default().unlock(ne),this.refreshLockWhileAcquired(K,ne),[2])):(Nv.default().unlock(ne),[2])}})})},1e3),[2]})})},H.prototype.waitForSomethingToChange=function(K){return h(this,void 0,void 0,function(){return _(this,function(ne){switch(ne.label){case 0:return[4,new Promise(function(ue){var pe=!1,xe=Date.now(),be=!1;function je(){if(be||(window.removeEventListener("storage",je),H.removeFromWaiting(je),clearTimeout(Be),be=!0),!pe){pe=!0;var He=50-(Date.now()-xe);He>0?setTimeout(ue,He):ue(null)}}window.addEventListener("storage",je),H.addToWaiting(je);var Be=setTimeout(je,Math.max(0,K-Date.now()))})];case 1:return ne.sent(),[2]}})})},H.addToWaiting=function(K){this.removeFromWaiting(K),H.waiters!==void 0&&H.waiters.push(K)},H.removeFromWaiting=function(K){H.waiters!==void 0&&(H.waiters=H.waiters.filter(function(ne){return ne!==K}))},H.notifyWaiters=function(){H.waiters!==void 0&&H.waiters.slice().forEach(function(K){return K()})},H.prototype.releaseLock=function(K){return h(this,void 0,void 0,function(){return _(this,function(ne){switch(ne.label){case 0:return[4,this.releaseLock__private__(K)];case 1:return[2,ne.sent()]}})})},H.prototype.releaseLock__private__=function(K){return h(this,void 0,void 0,function(){var ne,ue,pe,xe;return _(this,function(be){switch(be.label){case 0:return ne=this.storageHandler===void 0?C:this.storageHandler,ue=E+"-"+K,(pe=ne.getItemSync(ue))===null?[2]:(xe=JSON.parse(pe)).id!==this.id?[3,2]:[4,Nv.default().lock(xe.iat)];case 1:be.sent(),this.acquiredIatSet.delete(xe.iat),ne.removeItemSync(ue),Nv.default().unlock(xe.iat),H.notifyWaiters(),be.label=2;case 2:return[2]}})})},H.lockCorrector=function(K){for(var ne=Date.now()-5e3,ue=K,pe=[],xe=0;;){var be=ue.keySync(xe);if(be===null)break;pe.push(be),xe++}for(var je=!1,Be=0;Be<pe.length;Be++){var He=pe[Be];if(He.includes(E)){var Xe=ue.getItemSync(He);if(Xe!==null){var it=JSON.parse(Xe);(it.timeRefreshed===void 0&&it.timeAcquired<ne||it.timeRefreshed!==void 0&&it.timeRefreshed<ne)&&(ue.removeItemSync(He),je=!0)}}}je&&H.notifyWaiters()},H.waiters=void 0,H}();s.default=N}));const SF={timeoutInSeconds:60},NO={name:"auth0-spa-js",version:"2.7.0"},BO=()=>Date.now();class ys extends Error{constructor(s,h){super(h),this.error=s,this.error_description=h,Object.setPrototypeOf(this,ys.prototype)}static fromPayload({error:s,error_description:h}){return new ys(s,h)}}class BI extends ys{constructor(s,h,_,v=null){super(s,h),this.state=_,this.appState=v,Object.setPrototypeOf(this,BI.prototype)}}class UI extends ys{constructor(s,h,_,v,E=null){super(s,h),this.connection=_,this.state=v,this.appState=E,Object.setPrototypeOf(this,UI.prototype)}}class vT extends ys{constructor(){super("timeout","Timeout"),Object.setPrototypeOf(this,vT.prototype)}}class VI extends vT{constructor(s){super(),this.popup=s,Object.setPrototypeOf(this,VI.prototype)}}class jI extends ys{constructor(s){super("cancelled","Popup closed"),this.popup=s,Object.setPrototypeOf(this,jI.prototype)}}class GI extends ys{constructor(s,h,_){super(s,h),this.mfa_token=_,Object.setPrototypeOf(this,GI.prototype)}}class FC extends ys{constructor(s,h){super("missing_refresh_token",`Missing Refresh Token (audience: '${TC(s,["default"])}', scope: '${TC(h)}')`),this.audience=s,this.scope=h,Object.setPrototypeOf(this,FC.prototype)}}class HI extends ys{constructor(s,h){super("missing_scopes",`Missing requested scopes after refresh (audience: '${TC(s,["default"])}', missing scope: '${TC(h)}')`),this.audience=s,this.scope=h,Object.setPrototypeOf(this,HI.prototype)}}class NC extends ys{constructor(s){super("use_dpop_nonce","Server rejected DPoP proof: wrong nonce"),this.newDpopNonce=s,Object.setPrototypeOf(this,NC.prototype)}}function TC(d,s=[]){return d&&!s.includes(d)?d:""}const SC=()=>window.crypto,G1=()=>{const d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.";let s="";return Array.from(SC().getRandomValues(new Uint8Array(43))).forEach(h=>s+=d[h%d.length]),s},BR=d=>btoa(d),dI=d=>{var{clientId:s}=d,h=op(d,["clientId"]);return new URLSearchParams((_=>Object.keys(_).filter(v=>_[v]!==void 0).reduce((v,E)=>Object.assign(Object.assign({},v),{[E]:_[E]}),{}))(Object.assign({client_id:s},h))).toString()},EM=async d=>await SC().subtle.digest({name:"SHA-256"},new TextEncoder().encode(d)),CM=d=>(s=>decodeURIComponent(atob(s).split("").map(h=>"%"+("00"+h.charCodeAt(0).toString(16)).slice(-2)).join("")))(d.replace(/_/g,"/").replace(/-/g,"+")),AM=d=>{const s=new Uint8Array(d);return(h=>{const _={"+":"-","/":"_","=":""};return h.replace(/[+/=]/g,v=>_[v])})(window.btoa(String.fromCharCode(...Array.from(s))))},EF=new TextEncoder,CF=new TextDecoder;function aT(d){return typeof d=="string"?EF.encode(d):CF.decode(d)}function RM(d){if(typeof d.modulusLength!="number"||d.modulusLength<2048)throw new RF(`${d.name} modulusLength must be at least 2048 bits`)}async function AF(d,s,h){if(h.usages.includes("sign")===!1)throw new TypeError('private CryptoKey instances used for signing assertions must include "sign" in their "usages"');const _=`${oT(aT(JSON.stringify(d)))}.${oT(aT(JSON.stringify(s)))}`;return`${_}.${oT(await crypto.subtle.sign(function(v){switch(v.algorithm.name){case"ECDSA":return{name:v.algorithm.name,hash:"SHA-256"};case"RSA-PSS":return RM(v.algorithm),{name:v.algorithm.name,saltLength:32};case"RSASSA-PKCS1-v1_5":return RM(v.algorithm),{name:v.algorithm.name};case"Ed25519":return{name:v.algorithm.name}}throw new jv}(h),h,aT(_)))}`}let fI;Uint8Array.prototype.toBase64?fI=d=>(d instanceof ArrayBuffer&&(d=new Uint8Array(d)),d.toBase64({alphabet:"base64url",omitPadding:!0})):fI=s=>{s instanceof ArrayBuffer&&(s=new Uint8Array(s));const h=[];for(let _=0;_<s.byteLength;_+=32768)h.push(String.fromCharCode.apply(null,s.subarray(_,_+32768)));return btoa(h.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")};function oT(d){return fI(d)}class jv extends Error{constructor(s){var h;super(s??"operation not supported"),this.name=this.constructor.name,(h=Error.captureStackTrace)===null||h===void 0||h.call(Error,this,this.constructor)}}class RF extends Error{constructor(s){var h;super(s),this.name=this.constructor.name,(h=Error.captureStackTrace)===null||h===void 0||h.call(Error,this,this.constructor)}}function IF(d){switch(d.algorithm.name){case"RSA-PSS":return function(s){if(s.algorithm.hash.name==="SHA-256")return"PS256";throw new jv("unsupported RsaHashedKeyAlgorithm hash name")}(d);case"RSASSA-PKCS1-v1_5":return function(s){if(s.algorithm.hash.name==="SHA-256")return"RS256";throw new jv("unsupported RsaHashedKeyAlgorithm hash name")}(d);case"ECDSA":return function(s){if(s.algorithm.namedCurve==="P-256")return"ES256";throw new jv("unsupported EcKeyAlgorithm namedCurve")}(d);case"Ed25519":return"Ed25519";default:throw new jv("unsupported CryptoKey algorithm name")}}function UO(d){return d instanceof CryptoKey}function VO(d){return UO(d)&&d.type==="public"}async function DF(d,s,h,_,v,E){const C=d==null?void 0:d.privateKey,r=d==null?void 0:d.publicKey;if(!UO(z=C)||z.type!=="private")throw new TypeError('"keypair.privateKey" must be a private CryptoKey');var z;if(!VO(r))throw new TypeError('"keypair.publicKey" must be a public CryptoKey');if(r.extractable!==!0)throw new TypeError('"keypair.publicKey.extractable" must be true');if(typeof s!="string")throw new TypeError('"htu" must be a string');if(typeof h!="string")throw new TypeError('"htm" must be a string');if(_!==void 0&&typeof _!="string")throw new TypeError('"nonce" must be a string or undefined');if(v!==void 0&&typeof v!="string")throw new TypeError('"accessToken" must be a string or undefined');return AF({alg:IF(C),typ:"dpop+jwt",jwk:await jO(r)},Object.assign(Object.assign({},E),{iat:Math.floor(Date.now()/1e3),jti:crypto.randomUUID(),htm:h,nonce:_,htu:s,ath:v?oT(await crypto.subtle.digest("SHA-256",aT(v))):void 0}),C)}async function jO(d){const{kty:s,e:h,n:_,x:v,y:E,crv:C}=await crypto.subtle.exportKey("jwk",d);return{kty:s,crv:C,e:h,n:_,x:v,y:E}}const MF=["authorization_code","refresh_token","urn:ietf:params:oauth:grant-type:token-exchange"];function PF(){return async function(d,s){var h;let _;if(d.length===0)throw new TypeError('"alg" must be a non-empty string');switch(d){case"PS256":_={name:"RSA-PSS",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"RS256":_={name:"RSASSA-PKCS1-v1_5",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"ES256":_={name:"ECDSA",namedCurve:"P-256"};break;case"Ed25519":_={name:"Ed25519"};break;default:throw new jv}return crypto.subtle.generateKey(_,(h=s==null?void 0:s.extractable)!==null&&h!==void 0&&h,["sign","verify"])}("ES256",{extractable:!1})}function OF(d){return async function(s){if(!VO(s))throw new TypeError('"publicKey" must be a public CryptoKey');if(s.extractable!==!0)throw new TypeError('"publicKey.extractable" must be true');const h=await jO(s);let _;switch(h.kty){case"EC":_={crv:h.crv,kty:h.kty,x:h.x,y:h.y};break;case"OKP":_={crv:h.crv,kty:h.kty,x:h.x};break;case"RSA":_={e:h.e,kty:h.kty,n:h.n};break;default:throw new jv("unsupported JWK kty")}return oT(await crypto.subtle.digest({name:"SHA-256"},aT(JSON.stringify(_))))}(d.publicKey)}function kF({keyPair:d,url:s,method:h,nonce:_,accessToken:v}){const E=function(C){const r=new URL(C);return r.search="",r.hash="",r.href}(s);return DF(d,E,h,_,v)}const LF=async(d,s)=>{const h=await fetch(d,s);return{ok:h.ok,json:await h.json(),headers:(_=h.headers,[..._].reduce((v,[E,C])=>(v[E]=C,v),{}))};var _},zF=async(d,s,h)=>{const _=new AbortController;let v;return s.signal=_.signal,Promise.race([LF(d,s),new Promise((E,C)=>{v=setTimeout(()=>{_.abort(),C(new Error("Timeout when executing 'fetch'"))},h)})]).finally(()=>{clearTimeout(v)})},FF=async(d,s,h,_,v,E,C,r)=>{return z={auth:{audience:s,scope:h},timeout:v,fetchUrl:d,fetchOptions:_,useFormData:C,useMrrt:r},N=E,new Promise(function(H,K){const ne=new MessageChannel;ne.port1.onmessage=function(ue){ue.data.error?K(new Error(ue.data.error)):H(ue.data),ne.port1.close()},N.postMessage(z,[ne.port2])});var z,N},NF=async(d,s,h,_,v,E,C=1e4,r)=>v?FF(d,s,h,_,C,v,E,r):zF(d,_,C);async function GO(d,s,h,_,v,E,C,r,z,N){if(z){const He=await z.generateProof({url:d,method:v.method||"GET",nonce:await z.getNonce()});v.headers=Object.assign(Object.assign({},v.headers),{dpop:He})}let H,K=null;for(let He=0;He<3;He++)try{H=await NF(d,h,_,v,E,C,s,r),K=null;break}catch(Xe){K=Xe}if(K)throw K;const ne=H.json,{error:ue,error_description:pe}=ne,xe=op(ne,["error","error_description"]),{headers:be,ok:je}=H;let Be;if(z&&(Be=be["dpop-nonce"],Be&&await z.setNonce(Be)),!je){const He=pe||`HTTP error. Unable to fetch ${d}`;if(ue==="mfa_required")throw new GI(ue,He,xe.mfa_token);if(ue==="missing_refresh_token")throw new FC(h,_);if(ue==="use_dpop_nonce"){if(!z||!Be||N)throw new NC(Be);return GO(d,s,h,_,v,E,C,r,z,!0)}throw new ys(ue||"request_error",He)}return xe}async function BF(d,s){var{baseUrl:h,timeout:_,audience:v,scope:E,auth0Client:C,useFormData:r,useMrrt:z,dpop:N}=d,H=op(d,["baseUrl","timeout","audience","scope","auth0Client","useFormData","useMrrt","dpop"]);const K=H.grant_type==="urn:ietf:params:oauth:grant-type:token-exchange",ne=H.grant_type==="refresh_token"&&z,ue=Object.assign(Object.assign(Object.assign(Object.assign({},H),K&&v&&{audience:v}),K&&E&&{scope:E}),ne&&{audience:v,scope:E}),pe=r?dI(ue):JSON.stringify(ue),xe=(be=H.grant_type,MF.includes(be));var be;return await GO(`${h}/oauth/token`,_,v||"default",E,{method:"POST",body:pe,headers:{"Content-Type":r?"application/x-www-form-urlencoded":"application/json","Auth0-Client":btoa(JSON.stringify(C||NO))}},s,r,z,xe?N:void 0)}const H1=(...d)=>{return(s=d.filter(Boolean).join(" ").trim().split(/\s+/),Array.from(new Set(s))).join(" ");var s};class jd{constructor(s,h="@@auth0spajs@@",_){this.prefix=h,this.suffix=_,this.clientId=s.clientId,this.scope=s.scope,this.audience=s.audience}toKey(){return[this.prefix,this.clientId,this.audience,this.scope,this.suffix].filter(Boolean).join("::")}static fromKey(s){const[h,_,v,E]=s.split("::");return new jd({clientId:_,scope:E,audience:v},h)}static fromCacheEntry(s){const{scope:h,audience:_,client_id:v}=s;return new jd({scope:h,audience:_,clientId:v})}}class UF{set(s,h){localStorage.setItem(s,JSON.stringify(h))}get(s){const h=window.localStorage.getItem(s);if(h)try{return JSON.parse(h)}catch{return}}remove(s){localStorage.removeItem(s)}allKeys(){return Object.keys(window.localStorage).filter(s=>s.startsWith("@@auth0spajs@@"))}}class HO{constructor(){this.enclosedCache=function(){let s={};return{set(h,_){s[h]=_},get(h){const _=s[h];if(_)return _},remove(h){delete s[h]},allKeys:()=>Object.keys(s)}}()}}class VF{constructor(s,h,_){this.cache=s,this.keyManifest=h,this.nowProvider=_||BO}async setIdToken(s,h,_){var v;const E=this.getIdTokenCacheKey(s);await this.cache.set(E,{id_token:h,decodedToken:_}),await((v=this.keyManifest)===null||v===void 0?void 0:v.add(E))}async getIdToken(s){const h=await this.cache.get(this.getIdTokenCacheKey(s.clientId));if(!h&&s.scope&&s.audience){const _=await this.get(s);return!_||!_.id_token||!_.decodedToken?void 0:{id_token:_.id_token,decodedToken:_.decodedToken}}if(h)return{id_token:h.id_token,decodedToken:h.decodedToken}}async get(s,h=0,_=!1,v){var E;let C=await this.cache.get(s.toKey());if(!C){const N=await this.getCacheKeys();if(!N)return;const H=this.matchExistingCacheKey(s,N);if(H&&(C=await this.cache.get(H)),!H&&_&&v!=="cache-only")return this.getEntryWithRefreshToken(s,N)}if(!C)return;const r=await this.nowProvider(),z=Math.floor(r/1e3);return C.expiresAt-h<z?C.body.refresh_token?this.modifiedCachedEntry(C,s):(await this.cache.remove(s.toKey()),void await((E=this.keyManifest)===null||E===void 0?void 0:E.remove(s.toKey()))):C.body}async modifiedCachedEntry(s,h){return s.body={refresh_token:s.body.refresh_token,audience:s.body.audience,scope:s.body.scope},await this.cache.set(h.toKey(),s),{refresh_token:s.body.refresh_token,audience:s.body.audience,scope:s.body.scope}}async set(s){var h;const _=new jd({clientId:s.client_id,scope:s.scope,audience:s.audience}),v=await this.wrapCacheEntry(s);await this.cache.set(_.toKey(),v),await((h=this.keyManifest)===null||h===void 0?void 0:h.add(_.toKey()))}async clear(s){var h;const _=await this.getCacheKeys();_&&(await _.filter(v=>!s||v.includes(s)).reduce(async(v,E)=>{await v,await this.cache.remove(E)},Promise.resolve()),await((h=this.keyManifest)===null||h===void 0?void 0:h.clear()))}async wrapCacheEntry(s){const h=await this.nowProvider();return{body:s,expiresAt:Math.floor(h/1e3)+s.expires_in}}async getCacheKeys(){var s;return this.keyManifest?(s=await this.keyManifest.get())===null||s===void 0?void 0:s.keys:this.cache.allKeys?this.cache.allKeys():void 0}getIdTokenCacheKey(s){return new jd({clientId:s},"@@auth0spajs@@","@@user@@").toKey()}matchExistingCacheKey(s,h){return h.filter(_=>{var v;const E=jd.fromKey(_),C=new Set(E.scope&&E.scope.split(" ")),r=((v=s.scope)===null||v===void 0?void 0:v.split(" "))||[],z=E.scope&&r.reduce((N,H)=>N&&C.has(H),!0);return E.prefix==="@@auth0spajs@@"&&E.clientId===s.clientId&&E.audience===s.audience&&z})[0]}async getEntryWithRefreshToken(s,h){var _;for(const v of h){const E=jd.fromKey(v);if(E.prefix==="@@auth0spajs@@"&&E.clientId===s.clientId){const C=await this.cache.get(v);if(!((_=C==null?void 0:C.body)===null||_===void 0)&&_.refresh_token)return this.modifiedCachedEntry(C,s)}}}async updateEntry(s,h){var _;const v=await this.getCacheKeys();if(v)for(const E of v){const C=await this.cache.get(E);if(((_=C==null?void 0:C.body)===null||_===void 0?void 0:_.refresh_token)===s){const r=Object.assign(Object.assign({},C.body),{refresh_token:h});await this.set(r)}}}}class jF{constructor(s,h,_){this.storage=s,this.clientId=h,this.cookieDomain=_,this.storageKey=`a0.spajs.txs.${this.clientId}`}create(s){this.storage.save(this.storageKey,s,{daysUntilExpire:1,cookieDomain:this.cookieDomain})}get(){return this.storage.get(this.storageKey)}remove(){this.storage.remove(this.storageKey,{cookieDomain:this.cookieDomain})}}const $1=d=>typeof d=="number",GF=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"],HF=d=>{if(!d.id_token)throw new Error("ID token is required but missing");const s=(E=>{const C=E.split("."),[r,z,N]=C;if(C.length!==3||!r||!z||!N)throw new Error("ID token could not be decoded");const H=JSON.parse(CM(z)),K={__raw:E},ne={};return Object.keys(H).forEach(ue=>{K[ue]=H[ue],GF.includes(ue)||(ne[ue]=H[ue])}),{encoded:{header:r,payload:z,signature:N},header:JSON.parse(CM(r)),claims:K,user:ne}})(d.id_token);if(!s.claims.iss)throw new Error("Issuer (iss) claim must be a string present in the ID token");if(s.claims.iss!==d.iss)throw new Error(`Issuer (iss) claim mismatch in the ID token; expected "${d.iss}", found "${s.claims.iss}"`);if(!s.user.sub)throw new Error("Subject (sub) claim must be a string present in the ID token");if(s.header.alg!=="RS256")throw new Error(`Signature algorithm of "${s.header.alg}" is not supported. Expected the ID token to be signed with "RS256".`);if(!s.claims.aud||typeof s.claims.aud!="string"&&!Array.isArray(s.claims.aud))throw new Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(s.claims.aud)){if(!s.claims.aud.includes(d.aud))throw new Error(`Audience (aud) claim mismatch in the ID token; expected "${d.aud}" but was not one of "${s.claims.aud.join(", ")}"`);if(s.claims.aud.length>1){if(!s.claims.azp)throw new Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(s.claims.azp!==d.aud)throw new Error(`Authorized Party (azp) claim mismatch in the ID token; expected "${d.aud}", found "${s.claims.azp}"`)}}else if(s.claims.aud!==d.aud)throw new Error(`Audience (aud) claim mismatch in the ID token; expected "${d.aud}" but found "${s.claims.aud}"`);if(d.nonce){if(!s.claims.nonce)throw new Error("Nonce (nonce) claim must be a string present in the ID token");if(s.claims.nonce!==d.nonce)throw new Error(`Nonce (nonce) claim mismatch in the ID token; expected "${d.nonce}", found "${s.claims.nonce}"`)}if(d.max_age&&!$1(s.claims.auth_time))throw new Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(s.claims.exp==null||!$1(s.claims.exp))throw new Error("Expiration Time (exp) claim must be a number present in the ID token");if(!$1(s.claims.iat))throw new Error("Issued At (iat) claim must be a number present in the ID token");const h=d.leeway||60,_=new Date(d.now||Date.now()),v=new Date(0);if(v.setUTCSeconds(s.claims.exp+h),_>v)throw new Error(`Expiration Time (exp) claim error in the ID token; current time (${_}) is after expiration time (${v})`);if(s.claims.nbf!=null&&$1(s.claims.nbf)){const E=new Date(0);if(E.setUTCSeconds(s.claims.nbf-h),_<E)throw new Error(`Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Current time (${_}) is before ${E}`)}if(s.claims.auth_time!=null&&$1(s.claims.auth_time)){const E=new Date(0);if(E.setUTCSeconds(parseInt(s.claims.auth_time)+d.max_age+h),_>E)throw new Error(`Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Current time (${_}) is after last auth at ${E}`)}if(d.organization){const E=d.organization.trim();if(E.startsWith("org_")){const C=E;if(!s.claims.org_id)throw new Error("Organization ID (org_id) claim must be a string present in the ID token");if(C!==s.claims.org_id)throw new Error(`Organization ID (org_id) claim mismatch in the ID token; expected "${C}", found "${s.claims.org_id}"`)}else{const C=E.toLowerCase();if(!s.claims.org_name)throw new Error("Organization Name (org_name) claim must be a string present in the ID token");if(C!==s.claims.org_name)throw new Error(`Organization Name (org_name) claim mismatch in the ID token; expected "${C}", found "${s.claims.org_name}"`)}}return s};var Gv=NI(function(d,s){var h=Vv&&Vv.__assign||function(){return h=Object.assign||function(z){for(var N,H=1,K=arguments.length;H<K;H++)for(var ne in N=arguments[H])Object.prototype.hasOwnProperty.call(N,ne)&&(z[ne]=N[ne]);return z},h.apply(this,arguments)};function _(z,N){if(!N)return"";var H="; "+z;return N===!0?H:H+"="+N}function v(z,N,H){return encodeURIComponent(z).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(N).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(K){if(typeof K.expires=="number"){var ne=new Date;ne.setMilliseconds(ne.getMilliseconds()+864e5*K.expires),K.expires=ne}return _("Expires",K.expires?K.expires.toUTCString():"")+_("Domain",K.domain)+_("Path",K.path)+_("Secure",K.secure)+_("SameSite",K.sameSite)}(H)}function E(z){for(var N={},H=z?z.split("; "):[],K=/(%[\dA-F]{2})+/gi,ne=0;ne<H.length;ne++){var ue=H[ne].split("="),pe=ue.slice(1).join("=");pe.charAt(0)==='"'&&(pe=pe.slice(1,-1));try{N[ue[0].replace(K,decodeURIComponent)]=pe.replace(K,decodeURIComponent)}catch{}}return N}function C(){return E(document.cookie)}function r(z,N,H){document.cookie=v(z,N,h({path:"/"},H))}s.__esModule=!0,s.encode=v,s.parse=E,s.getAll=C,s.get=function(z){return C()[z]},s.set=r,s.remove=function(z,N){r(z,"",h(h({},N),{expires:-1}))}});FI(Gv),Gv.encode,Gv.parse,Gv.getAll;var $F=Gv.get,$O=Gv.set,WO=Gv.remove;const yb={get(d){const s=$F(d);if(s!==void 0)return JSON.parse(s)},save(d,s,h){let _={};window.location.protocol==="https:"&&(_={secure:!0,sameSite:"none"}),h!=null&&h.daysUntilExpire&&(_.expires=h.daysUntilExpire),h!=null&&h.cookieDomain&&(_.domain=h.cookieDomain),$O(d,JSON.stringify(s),_)},remove(d,s){let h={};s!=null&&s.cookieDomain&&(h.domain=s.cookieDomain),WO(d,h)}},WF={get(d){return yb.get(d)||yb.get(`_legacy_${d}`)},save(d,s,h){let _={};window.location.protocol==="https:"&&(_={secure:!0}),h!=null&&h.daysUntilExpire&&(_.expires=h.daysUntilExpire),h!=null&&h.cookieDomain&&(_.domain=h.cookieDomain),$O(`_legacy_${d}`,JSON.stringify(s),_),yb.save(d,s,h)},remove(d,s){let h={};s!=null&&s.cookieDomain&&(h.domain=s.cookieDomain),WO(d,h),yb.remove(d,s),yb.remove(`_legacy_${d}`,s)}},qF={get(d){if(typeof sessionStorage>"u")return;const s=sessionStorage.getItem(d);return s!=null?JSON.parse(s):void 0},save(d,s){sessionStorage.setItem(d,JSON.stringify(s))},remove(d){sessionStorage.removeItem(d)}};var R_;(function(d){d.Code="code",d.ConnectCode="connect_code"})(R_||(R_={}));function ZF(d,s,h){var _=s===void 0?null:s,v=function(z,N){var H=atob(z);if(N){for(var K=new Uint8Array(H.length),ne=0,ue=H.length;ne<ue;++ne)K[ne]=H.charCodeAt(ne);return String.fromCharCode.apply(null,new Uint16Array(K.buffer))}return H}(d,h!==void 0&&h),E=v.indexOf(`
`,10)+1,C=v.substring(E)+(_?"//# sourceMappingURL="+_:""),r=new Blob([C],{type:"application/javascript"});return URL.createObjectURL(r)}var IM,DM,MM,UR,XF=(IM="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7Y2xhc3MgZSBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKHQscil7c3VwZXIociksdGhpcy5lcnJvcj10LHRoaXMuZXJyb3JfZGVzY3JpcHRpb249cixPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcyxlLnByb3RvdHlwZSl9c3RhdGljIGZyb21QYXlsb2FkKHtlcnJvcjp0LGVycm9yX2Rlc2NyaXB0aW9uOnJ9KXtyZXR1cm4gbmV3IGUodCxyKX19Y2xhc3MgdCBleHRlbmRzIGV7Y29uc3RydWN0b3IoZSxzKXtzdXBlcigibWlzc2luZ19yZWZyZXNoX3Rva2VuIixgTWlzc2luZyBSZWZyZXNoIFRva2VuIChhdWRpZW5jZTogJyR7cihlLFsiZGVmYXVsdCJdKX0nLCBzY29wZTogJyR7cihzKX0nKWApLHRoaXMuYXVkaWVuY2U9ZSx0aGlzLnNjb3BlPXMsT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsdC5wcm90b3R5cGUpfX1mdW5jdGlvbiByKGUsdD1bXSl7cmV0dXJuIGUmJiF0LmluY2x1ZGVzKGUpP2U6IiJ9ImZ1bmN0aW9uIj09dHlwZW9mIFN1cHByZXNzZWRFcnJvciYmU3VwcHJlc3NlZEVycm9yO2NvbnN0IHM9ZT0+e3ZhcntjbGllbnRJZDp0fT1lLHI9ZnVuY3Rpb24oZSx0KXt2YXIgcj17fTtmb3IodmFyIHMgaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxzKSYmdC5pbmRleE9mKHMpPDAmJihyW3NdPWVbc10pO2lmKG51bGwhPWUmJiJmdW5jdGlvbiI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgbz0wO2ZvcihzPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7bzxzLmxlbmd0aDtvKyspdC5pbmRleE9mKHNbb10pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLHNbb10pJiYocltzW29dXT1lW3Nbb11dKX1yZXR1cm4gcn0oZSxbImNsaWVudElkIl0pO3JldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKChlPT5PYmplY3Qua2V5cyhlKS5maWx0ZXIoKHQ9PnZvaWQgMCE9PWVbdF0pKS5yZWR1Y2UoKCh0LHIpPT5PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sdCkse1tyXTplW3JdfSkpLHt9KSkoT2JqZWN0LmFzc2lnbih7Y2xpZW50X2lkOnR9LHIpKSkudG9TdHJpbmcoKX07bGV0IG89e307Y29uc3Qgbj0oZSx0KT0+YCR7ZX18JHt0fWA7YWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsKGFzeW5jKHtkYXRhOnt0aW1lb3V0OmUsYXV0aDpyLGZldGNoVXJsOmksZmV0Y2hPcHRpb25zOmMsdXNlRm9ybURhdGE6YSx1c2VNcnJ0OmZ9LHBvcnRzOltwXX0pPT57bGV0IGgsdSxsPXt9O2NvbnN0e2F1ZGllbmNlOmQsc2NvcGU6eX09cnx8e307dHJ5e2NvbnN0IHI9YT8oZT0+e2NvbnN0IHQ9bmV3IFVSTFNlYXJjaFBhcmFtcyhlKSxyPXt9O3JldHVybiB0LmZvckVhY2goKChlLHQpPT57clt0XT1lfSkpLHJ9KShjLmJvZHkpOkpTT04ucGFyc2UoYy5ib2R5KTtpZighci5yZWZyZXNoX3Rva2VuJiYicmVmcmVzaF90b2tlbiI9PT1yLmdyYW50X3R5cGUpe2lmKHU9KChlLHQpPT5vW24oZSx0KV0pKGQseSksIXUmJmYpe2NvbnN0IGU9by5sYXRlc3RfcmVmcmVzaF90b2tlbix0PSgoZSx0KT0+e2NvbnN0IHI9T2JqZWN0LmtleXMobykuZmluZCgocj0+e2lmKCJsYXRlc3RfcmVmcmVzaF90b2tlbiIhPT1yKXtjb25zdCBzPSgoZSx0KT0+dC5zdGFydHNXaXRoKGAke2V9fGApKSh0LHIpLG89ci5zcGxpdCgifCIpWzFdLnNwbGl0KCIgIiksbj1lLnNwbGl0KCIgIikuZXZlcnkoKGU9Pm8uaW5jbHVkZXMoZSkpKTtyZXR1cm4gcyYmbn19KSk7cmV0dXJuISFyfSkoeSxkKTtlJiYhdCYmKHU9ZSl9aWYoIXUpdGhyb3cgbmV3IHQoZCx5KTtjLmJvZHk9YT9zKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxyKSx7cmVmcmVzaF90b2tlbjp1fSkpOkpTT04uc3RyaW5naWZ5KE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxyKSx7cmVmcmVzaF90b2tlbjp1fSkpfWxldCBqLGs7ImZ1bmN0aW9uIj09dHlwZW9mIEFib3J0Q29udHJvbGxlciYmKGo9bmV3IEFib3J0Q29udHJvbGxlcixjLnNpZ25hbD1qLnNpZ25hbCk7dHJ5e2s9YXdhaXQgUHJvbWlzZS5yYWNlKFsoXz1lLG5ldyBQcm9taXNlKChlPT5zZXRUaW1lb3V0KGUsXykpKSksZmV0Y2goaSxPYmplY3QuYXNzaWduKHt9LGMpKV0pfWNhdGNoKGUpe3JldHVybiB2b2lkIHAucG9zdE1lc3NhZ2Uoe2Vycm9yOmUubWVzc2FnZX0pfWlmKCFrKXJldHVybiBqJiZqLmFib3J0KCksdm9pZCBwLnBvc3RNZXNzYWdlKHtlcnJvcjoiVGltZW91dCB3aGVuIGV4ZWN1dGluZyAnZmV0Y2gnIn0pO2c9ay5oZWFkZXJzLGw9Wy4uLmddLnJlZHVjZSgoKGUsW3Qscl0pPT4oZVt0XT1yLGUpKSx7fSksaD1hd2FpdCBrLmpzb24oKSxoLnJlZnJlc2hfdG9rZW4/KGYmJihvLmxhdGVzdF9yZWZyZXNoX3Rva2VuPWgucmVmcmVzaF90b2tlbixPPXUsYj1oLnJlZnJlc2hfdG9rZW4sT2JqZWN0LmVudHJpZXMobykuZm9yRWFjaCgoKFtlLHRdKT0+e3Q9PT1PJiYob1tlXT1iKX0pKSksKChlLHQscik9PntvW24odCxyKV09ZX0pKGgucmVmcmVzaF90b2tlbixkLHkpLGRlbGV0ZSBoLnJlZnJlc2hfdG9rZW4pOigoZSx0KT0+e2RlbGV0ZSBvW24oZSx0KV19KShkLHkpLHAucG9zdE1lc3NhZ2Uoe29rOmsub2ssanNvbjpoLGhlYWRlcnM6bH0pfWNhdGNoKGUpe3AucG9zdE1lc3NhZ2Uoe29rOiExLGpzb246e2Vycm9yOmUuZXJyb3IsZXJyb3JfZGVzY3JpcHRpb246ZS5tZXNzYWdlfSxoZWFkZXJzOmx9KX12YXIgTyxiLGcsX30pKX0oKTsKCg==",DM=null,MM=!1,function(d){return UR=UR||ZF(IM,DM,MM),new Worker(UR,d)});const VR={};class YF{constructor(s,h){this.cache=s,this.clientId=h,this.manifestKey=this.createManifestKeyFrom(this.clientId)}async add(s){var h;const _=new Set(((h=await this.cache.get(this.manifestKey))===null||h===void 0?void 0:h.keys)||[]);_.add(s),await this.cache.set(this.manifestKey,{keys:[..._]})}async remove(s){const h=await this.cache.get(this.manifestKey);if(h){const _=new Set(h.keys);return _.delete(s),_.size>0?await this.cache.set(this.manifestKey,{keys:[..._]}):await this.cache.remove(this.manifestKey)}}get(){return this.cache.get(this.manifestKey)}clear(){return this.cache.remove(this.manifestKey)}createManifestKeyFrom(s){return`@@auth0spajs@@::${s}`}}const KF={memory:()=>new HO().enclosedCache,localstorage:()=>new UF},PM=d=>KF[d],OM=d=>{const{openUrl:s,onRedirect:h}=d,_=op(d,["openUrl","onRedirect"]);return Object.assign(Object.assign({},_),{openUrl:s===!1||s?s:h})},kM=(d,s)=>{const h=(s==null?void 0:s.split(" "))||[];return((d==null?void 0:d.split(" "))||[]).every(_=>h.includes(_))},kv={NONCE:"nonce",KEYPAIR:"keypair"};class JF{constructor(s){this.clientId=s}getVersion(){return 1}createDbHandle(){const s=window.indexedDB.open("auth0-spa-js",this.getVersion());return new Promise((h,_)=>{s.onupgradeneeded=()=>Object.values(kv).forEach(v=>s.result.createObjectStore(v)),s.onerror=()=>_(s.error),s.onsuccess=()=>h(s.result)})}async getDbHandle(){return this.dbHandle||(this.dbHandle=await this.createDbHandle()),this.dbHandle}async executeDbRequest(s,h,_){const v=_((await this.getDbHandle()).transaction(s,h).objectStore(s));return new Promise((E,C)=>{v.onsuccess=()=>E(v.result),v.onerror=()=>C(v.error)})}buildKey(s){const h=s?`_${s}`:"auth0";return`${this.clientId}::${h}`}setNonce(s,h){return this.save(kv.NONCE,this.buildKey(h),s)}setKeyPair(s){return this.save(kv.KEYPAIR,this.buildKey(),s)}async save(s,h,_){await this.executeDbRequest(s,"readwrite",v=>v.put(_,h))}findNonce(s){return this.find(kv.NONCE,this.buildKey(s))}findKeyPair(){return this.find(kv.KEYPAIR,this.buildKey())}find(s,h){return this.executeDbRequest(s,"readonly",_=>_.get(h))}async deleteBy(s,h){const _=await this.executeDbRequest(s,"readonly",v=>v.getAllKeys());_==null||_.filter(h).map(v=>this.executeDbRequest(s,"readwrite",E=>E.delete(v)))}deleteByClientId(s,h){return this.deleteBy(s,_=>typeof _=="string"&&_.startsWith(`${h}::`))}clearNonces(){return this.deleteByClientId(kv.NONCE,this.clientId)}clearKeyPairs(){return this.deleteByClientId(kv.KEYPAIR,this.clientId)}}class QF{constructor(s){this.storage=new JF(s)}getNonce(s){return this.storage.findNonce(s)}setNonce(s,h){return this.storage.setNonce(s,h)}async getOrGenerateKeyPair(){let s=await this.storage.findKeyPair();return s||(s=await PF(),await this.storage.setKeyPair(s)),s}async generateProof(s){const h=await this.getOrGenerateKeyPair();return kF(Object.assign({keyPair:h},s))}async calculateThumbprint(){return OF(await this.getOrGenerateKeyPair())}async clear(){await Promise.all([this.storage.clearNonces(),this.storage.clearKeyPairs()])}}var vb;(function(d){d.Bearer="Bearer",d.DPoP="DPoP"})(vb||(vb={}));class eN{constructor(s,h){this.hooks=h,this.config=Object.assign(Object.assign({},s),{fetch:s.fetch||(typeof window>"u"?fetch:window.fetch.bind(window))})}isAbsoluteUrl(s){return/^(https?:)?\/\//i.test(s)}buildUrl(s,h){if(h){if(this.isAbsoluteUrl(h))return h;if(s)return`${s.replace(/\/?\/$/,"")}/${h.replace(/^\/+/,"")}`}throw new TypeError("`url` must be absolute or `baseUrl` non-empty.")}getAccessToken(s){return this.config.getAccessToken?this.config.getAccessToken(s):this.hooks.getAccessToken(s)}extractUrl(s){return typeof s=="string"?s:s instanceof URL?s.href:s.url}buildBaseRequest(s,h){if(!this.config.baseUrl)return new Request(s,h);const _=this.buildUrl(this.config.baseUrl,this.extractUrl(s)),v=s instanceof Request?new Request(_,s):_;return new Request(v,h)}setAuthorizationHeader(s,h,_=vb.Bearer){s.headers.set("authorization",`${_} ${h}`)}async setDpopProofHeader(s,h){if(!this.config.dpopNonceId)return;const _=await this.hooks.getDpopNonce(),v=await this.hooks.generateDpopProof({accessToken:h,method:s.method,nonce:_,url:s.url});s.headers.set("dpop",v)}async prepareRequest(s,h){const _=await this.getAccessToken(h);let v,E;typeof _=="string"?(v=this.config.dpopNonceId?vb.DPoP:vb.Bearer,E=_):(v=_.token_type,E=_.access_token),this.setAuthorizationHeader(s,E,v),v===vb.DPoP&&await this.setDpopProofHeader(s,E)}getHeader(s,h){return Array.isArray(s)?new Headers(s).get(h)||"":typeof s.get=="function"?s.get(h)||"":s[h]||""}hasUseDpopNonceError(s){if(s.status!==401)return!1;const h=this.getHeader(s.headers,"www-authenticate");return h.includes("invalid_dpop_nonce")||h.includes("use_dpop_nonce")}async handleResponse(s,h){const _=this.getHeader(s.headers,"dpop-nonce");if(_&&await this.hooks.setDpopNonce(_),!this.hasUseDpopNonceError(s))return s;if(!_||!h.onUseDpopNonceError)throw new NC(_);return h.onUseDpopNonceError()}async internalFetchWithAuth(s,h,_,v){const E=this.buildBaseRequest(s,h);await this.prepareRequest(E,v);const C=await this.config.fetch(E);return this.handleResponse(C,_)}fetchWithAuth(s,h,_){const v={onUseDpopNonceError:()=>this.internalFetchWithAuth(s,h,Object.assign(Object.assign({},v),{onUseDpopNonceError:void 0}),_)};return this.internalFetchWithAuth(s,h,v,_)}}class tN{constructor(s,h){this.myAccountFetcher=s,this.apiBase=h}async connectAccount(s){const h=await this.myAccountFetcher.fetchWithAuth(`${this.apiBase}v1/connected-accounts/connect`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return this._handleResponse(h)}async completeAccount(s){const h=await this.myAccountFetcher.fetchWithAuth(`${this.apiBase}v1/connected-accounts/complete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});return this._handleResponse(h)}async _handleResponse(s){let h;try{h=await s.text(),h=JSON.parse(h)}catch(_){throw new EC({type:"invalid_json",status:s.status,title:"Invalid JSON response",detail:h||String(_)})}if(s.ok)return h;throw new EC(h)}}class EC extends Error{constructor({type:s,status:h,title:_,detail:v,validation_errors:E}){super(v),this.name="MyAccountApiError",this.type=s,this.status=h,this.title=_,this.detail=v,this.validation_errors=E,Object.setPrototypeOf(this,EC.prototype)}}const jR=new TF;class iN{constructor(s){let h,_;if(this.userCache=new HO().enclosedCache,this.defaultOptions={authorizationParams:{scope:"openid profile email"},useRefreshTokensFallback:!1,useFormData:!0},this._releaseLockOnPageHide=async()=>{await jR.releaseLock("auth0.lock.getTokenSilently"),window.removeEventListener("pagehide",this._releaseLockOnPageHide)},this.options=Object.assign(Object.assign(Object.assign({},this.defaultOptions),s),{authorizationParams:Object.assign(Object.assign({},this.defaultOptions.authorizationParams),s.authorizationParams)}),typeof window<"u"&&(()=>{if(!SC())throw new Error("For security reasons, `window.crypto` is required to run `auth0-spa-js`.");if(SC().subtle===void 0)throw new Error(`
      auth0-spa-js must run on a secure origin. See https://github.com/auth0/auth0-spa-js/blob/main/FAQ.md#why-do-i-get-auth0-spa-js-must-run-on-a-secure-origin for more information.
    `)})(),s.cache&&s.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),s.cache)_=s.cache;else{if(h=s.cacheLocation||"memory",!PM(h))throw new Error(`Invalid cache location "${h}"`);_=PM(h)()}this.httpTimeoutMs=s.httpTimeoutInSeconds?1e3*s.httpTimeoutInSeconds:1e4,this.cookieStorage=s.legacySameSiteCookie===!1?yb:WF,this.orgHintCookieName=`auth0.${this.options.clientId}.organization_hint`,this.isAuthenticatedCookieName=(z=>`auth0.${z}.is.authenticated`)(this.options.clientId),this.sessionCheckExpiryDays=s.sessionCheckExpiryDays||1;const v=s.useCookiesForTransactions?this.cookieStorage:qF;var E;this.scope=H1("openid",this.options.authorizationParams.scope,this.options.useRefreshTokens?"offline_access":""),this.transactionManager=new jF(v,this.options.clientId,this.options.cookieDomain),this.nowProvider=this.options.nowProvider||BO,this.cacheManager=new VF(_,_.allKeys?void 0:new YF(_,this.options.clientId),this.nowProvider),this.dpop=this.options.useDpop?new QF(this.options.clientId):void 0,this.domainUrl=(E=this.options.domain,/^https?:\/\//.test(E)?E:`https://${E}`),this.tokenIssuer=((z,N)=>z?z.startsWith("https://")?z:`https://${z}/`:`${N}/`)(this.options.issuer,this.domainUrl);const C=`${this.domainUrl}/me/`,r=this.createFetcher(Object.assign(Object.assign({},this.options.useDpop&&{dpopNonceId:"__auth0_my_account_api__"}),{getAccessToken:()=>this.getTokenSilently({authorizationParams:{scope:"create:me:connected_accounts",audience:C},detailedResponse:!0})}));this.myAccountApi=new tN(r,C),typeof window<"u"&&window.Worker&&this.options.useRefreshTokens&&h==="memory"&&(this.options.workerUrl?this.worker=new Worker(this.options.workerUrl):this.worker=new XF)}_url(s){const h=encodeURIComponent(btoa(JSON.stringify(this.options.auth0Client||NO)));return`${this.domainUrl}${s}&auth0Client=${h}`}_authorizeUrl(s){return this._url(`/authorize?${dI(s)}`)}async _verifyIdToken(s,h,_){const v=await this.nowProvider();return HF({iss:this.tokenIssuer,aud:this.options.clientId,id_token:s,nonce:h,organization:_,leeway:this.options.leeway,max_age:(E=this.options.authorizationParams.max_age,typeof E!="string"?E:parseInt(E,10)||void 0),now:v});var E}_processOrgHint(s){s?this.cookieStorage.save(this.orgHintCookieName,s,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}):this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain})}async _prepareAuthorizeUrl(s,h,_){var v;const E=BR(G1()),C=BR(G1()),r=G1(),z=await EM(r),N=AM(z),H=await((v=this.dpop)===null||v===void 0?void 0:v.calculateThumbprint()),K=((ue,pe,xe,be,je,Be,He,Xe,it)=>Object.assign(Object.assign(Object.assign({client_id:ue.clientId},ue.authorizationParams),xe),{scope:H1(pe,xe.scope),response_type:"code",response_mode:Xe||"query",state:be,nonce:je,redirect_uri:He||ue.authorizationParams.redirect_uri,code_challenge:Be,code_challenge_method:"S256",dpop_jkt:it}))(this.options,this.scope,s,E,C,N,s.redirect_uri||this.options.authorizationParams.redirect_uri||_,h==null?void 0:h.response_mode,H),ne=this._authorizeUrl(K);return{nonce:C,code_verifier:r,scope:K.scope,audience:K.audience||"default",redirect_uri:K.redirect_uri,state:E,url:ne}}async loginWithPopup(s,h){var _;if(s=s||{},!(h=h||{}).popup&&(h.popup=(r=>{const z=window.screenX+(window.innerWidth-400)/2,N=window.screenY+(window.innerHeight-600)/2;return window.open(r,"auth0:authorize:popup",`left=${z},top=${N},width=400,height=600,resizable,scrollbars=yes,status=1`)})(""),!h.popup))throw new Error("Unable to open a popup for loginWithPopup - window.open returned `null`");const v=await this._prepareAuthorizeUrl(s.authorizationParams||{},{response_mode:"web_message"},window.location.origin);h.popup.location.href=v.url;const E=await(r=>new Promise((z,N)=>{let H;const K=setInterval(()=>{r.popup&&r.popup.closed&&(clearInterval(K),clearTimeout(ne),window.removeEventListener("message",H,!1),N(new jI(r.popup)))},1e3),ne=setTimeout(()=>{clearInterval(K),N(new VI(r.popup)),window.removeEventListener("message",H,!1)},1e3*(r.timeoutInSeconds||60));H=function(ue){if(ue.data&&ue.data.type==="authorization_response"){if(clearTimeout(ne),clearInterval(K),window.removeEventListener("message",H,!1),r.popup.close(),ue.data.response.error)return N(ys.fromPayload(ue.data.response));z(ue.data.response)}},window.addEventListener("message",H)}))(Object.assign(Object.assign({},h),{timeoutInSeconds:h.timeoutInSeconds||this.options.authorizeTimeoutInSeconds||60}));if(v.state!==E.state)throw new ys("state_mismatch","Invalid state");const C=((_=s.authorizationParams)===null||_===void 0?void 0:_.organization)||this.options.authorizationParams.organization;await this._requestToken({audience:v.audience,scope:v.scope,code_verifier:v.code_verifier,grant_type:"authorization_code",code:E.code,redirect_uri:v.redirect_uri},{nonceIn:v.nonce,organization:C})}async getUser(){var s;const h=await this._getIdTokenFromCache();return(s=h==null?void 0:h.decodedToken)===null||s===void 0?void 0:s.user}async getIdTokenClaims(){var s;const h=await this._getIdTokenFromCache();return(s=h==null?void 0:h.decodedToken)===null||s===void 0?void 0:s.claims}async loginWithRedirect(s={}){var h;const _=OM(s),{openUrl:v,fragment:E,appState:C}=_,r=op(_,["openUrl","fragment","appState"]),z=((h=r.authorizationParams)===null||h===void 0?void 0:h.organization)||this.options.authorizationParams.organization,N=await this._prepareAuthorizeUrl(r.authorizationParams||{}),{url:H}=N,K=op(N,["url"]);this.transactionManager.create(Object.assign(Object.assign(Object.assign({},K),{appState:C,response_type:R_.Code}),z&&{organization:z}));const ne=E?`${H}#${E}`:H;v?await v(ne):window.location.assign(ne)}async handleRedirectCallback(s=window.location.href){const h=s.split("?").slice(1);if(h.length===0)throw new Error("There are no query params available for parsing.");const _=this.transactionManager.get();if(!_)throw new ys("missing_transaction","Invalid state");this.transactionManager.remove();const v=(E=>{E.indexOf("#")>-1&&(E=E.substring(0,E.indexOf("#")));const C=new URLSearchParams(E);return{state:C.get("state"),code:C.get("code")||void 0,connect_code:C.get("connect_code")||void 0,error:C.get("error")||void 0,error_description:C.get("error_description")||void 0}})(h.join(""));return _.response_type===R_.ConnectCode?this._handleConnectAccountRedirectCallback(v,_):this._handleLoginRedirectCallback(v,_)}async _handleLoginRedirectCallback(s,h){const{code:_,state:v,error:E,error_description:C}=s;if(E)throw new BI(E,C||E,v,h.appState);if(!h.code_verifier||h.state&&h.state!==v)throw new ys("state_mismatch","Invalid state");const r=h.organization,z=h.nonce,N=h.redirect_uri;return await this._requestToken(Object.assign({audience:h.audience,scope:h.scope,code_verifier:h.code_verifier,grant_type:"authorization_code",code:_},N?{redirect_uri:N}:{}),{nonceIn:z,organization:r}),{appState:h.appState,response_type:R_.Code}}async _handleConnectAccountRedirectCallback(s,h){const{connect_code:_,state:v,error:E,error_description:C}=s;if(E)throw new UI(E,C||E,h.connection,v,h.appState);if(!_)throw new ys("missing_connect_code","Missing connect code");if(!(h.code_verifier&&h.state&&h.auth_session&&h.redirect_uri&&h.state===v))throw new ys("state_mismatch","Invalid state");const r=await this.myAccountApi.completeAccount({auth_session:h.auth_session,connect_code:_,redirect_uri:h.redirect_uri,code_verifier:h.code_verifier});return Object.assign(Object.assign({},r),{appState:h.appState,response_type:R_.ConnectCode})}async checkSession(s){if(!this.cookieStorage.get(this.isAuthenticatedCookieName)){if(!this.cookieStorage.get("auth0.is.authenticated"))return;this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove("auth0.is.authenticated")}try{await this.getTokenSilently(s)}catch{}}async getTokenSilently(s={}){var h;const _=Object.assign(Object.assign({cacheMode:"on"},s),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),s.authorizationParams),{scope:H1(this.scope,(h=s.authorizationParams)===null||h===void 0?void 0:h.scope)})}),v=await((E,C)=>{let r=VR[C];return r||(r=E().finally(()=>{delete VR[C],r=null}),VR[C]=r),r})(()=>this._getTokenSilently(_),`${this.options.clientId}::${_.authorizationParams.audience}::${_.authorizationParams.scope}`);return s.detailedResponse?v:v==null?void 0:v.access_token}async _getTokenSilently(s){const{cacheMode:h}=s,_=op(s,["cacheMode"]);if(h!=="off"){const v=await this._getEntryFromCache({scope:_.authorizationParams.scope,audience:_.authorizationParams.audience||"default",clientId:this.options.clientId,cacheMode:h});if(v)return v}if(h!=="cache-only"){if(!await(async(v,E=3)=>{for(let C=0;C<E;C++)if(await v())return!0;return!1})(()=>jR.acquireLock("auth0.lock.getTokenSilently",5e3),10))throw new vT;try{if(window.addEventListener("pagehide",this._releaseLockOnPageHide),h!=="off"){const H=await this._getEntryFromCache({scope:_.authorizationParams.scope,audience:_.authorizationParams.audience||"default",clientId:this.options.clientId});if(H)return H}const v=this.options.useRefreshTokens?await this._getTokenUsingRefreshToken(_):await this._getTokenFromIFrame(_),{id_token:E,token_type:C,access_token:r,oauthTokenScope:z,expires_in:N}=v;return Object.assign(Object.assign({id_token:E,token_type:C,access_token:r},z?{scope:z}:null),{expires_in:N})}finally{await jR.releaseLock("auth0.lock.getTokenSilently"),window.removeEventListener("pagehide",this._releaseLockOnPageHide)}}}async getTokenWithPopup(s={},h={}){var _;const v=Object.assign(Object.assign({},s),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),s.authorizationParams),{scope:H1(this.scope,(_=s.authorizationParams)===null||_===void 0?void 0:_.scope)})});return h=Object.assign(Object.assign({},SF),h),await this.loginWithPopup(v,h),(await this.cacheManager.get(new jd({scope:v.authorizationParams.scope,audience:v.authorizationParams.audience||"default",clientId:this.options.clientId}),void 0,this.options.useMrrt)).access_token}async isAuthenticated(){return!!await this.getUser()}_buildLogoutUrl(s){s.clientId!==null?s.clientId=s.clientId||this.options.clientId:delete s.clientId;const h=s.logoutParams||{},{federated:_}=h,v=op(h,["federated"]),E=_?"&federated":"";return this._url(`/v2/logout?${dI(Object.assign({clientId:s.clientId},v))}`)+E}async logout(s={}){var h;const _=OM(s),{openUrl:v}=_,E=op(_,["openUrl"]);s.clientId===null?await this.cacheManager.clear():await this.cacheManager.clear(s.clientId||this.options.clientId),this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove(this.isAuthenticatedCookieName,{cookieDomain:this.options.cookieDomain}),this.userCache.remove("@@user@@"),await((h=this.dpop)===null||h===void 0?void 0:h.clear());const C=this._buildLogoutUrl(E);v?await v(C):v!==!1&&window.location.assign(C)}async _getTokenFromIFrame(s){const h=Object.assign(Object.assign({},s.authorizationParams),{prompt:"none"}),_=this.cookieStorage.get(this.orgHintCookieName);_&&!h.organization&&(h.organization=_);const{url:v,state:E,nonce:C,code_verifier:r,redirect_uri:z,scope:N,audience:H}=await this._prepareAuthorizeUrl(h,{response_mode:"web_message"},window.location.origin);try{if(window.crossOriginIsolated)throw new ys("login_required","The application is running in a Cross-Origin Isolated context, silently retrieving a token without refresh token is not possible.");const K=s.timeoutInSeconds||this.options.authorizeTimeoutInSeconds;let ne;try{ne=new URL(this.domainUrl).origin}catch{ne=this.domainUrl}const ue=await((xe,be,je=60)=>new Promise((Be,He)=>{const Xe=window.document.createElement("iframe");Xe.setAttribute("width","0"),Xe.setAttribute("height","0"),Xe.style.display="none";const it=()=>{window.document.body.contains(Xe)&&(window.document.body.removeChild(Xe),window.removeEventListener("message",kt,!1))};let kt;const Nt=setTimeout(()=>{He(new vT),it()},1e3*je);kt=function(oi){if(oi.origin!=be||!oi.data||oi.data.type!=="authorization_response")return;const yi=oi.source;yi&&yi.close(),oi.data.response.error?He(ys.fromPayload(oi.data.response)):Be(oi.data.response),clearTimeout(Nt),window.removeEventListener("message",kt,!1),setTimeout(it,2e3)},window.addEventListener("message",kt,!1),window.document.body.appendChild(Xe),Xe.setAttribute("src",xe)}))(v,ne,K);if(E!==ue.state)throw new ys("state_mismatch","Invalid state");const pe=await this._requestToken(Object.assign(Object.assign({},s.authorizationParams),{code_verifier:r,code:ue.code,grant_type:"authorization_code",redirect_uri:z,timeout:s.authorizationParams.timeout||this.httpTimeoutMs}),{nonceIn:C,organization:h.organization});return Object.assign(Object.assign({},pe),{scope:N,oauthTokenScope:pe.scope,audience:H})}catch(K){throw K.error==="login_required"&&this.logout({openUrl:!1}),K}}async _getTokenUsingRefreshToken(s){const h=await this.cacheManager.get(new jd({scope:s.authorizationParams.scope,audience:s.authorizationParams.audience||"default",clientId:this.options.clientId}),void 0,this.options.useMrrt);if(!(h&&h.refresh_token||this.worker)){if(this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(s);throw new FC(s.authorizationParams.audience||"default",s.authorizationParams.scope)}const _=s.authorizationParams.redirect_uri||this.options.authorizationParams.redirect_uri||window.location.origin,v=typeof s.timeoutInSeconds=="number"?1e3*s.timeoutInSeconds:null,E=((H,K,ne,ue)=>{var pe;if(H&&ne&&ue){if(K.audience!==ne)return K.scope;const xe=ue.split(" "),be=((pe=K.scope)===null||pe===void 0?void 0:pe.split(" "))||[],je=be.every(Be=>xe.includes(Be));return xe.length>=be.length&&je?ue:K.scope}return K.scope})(this.options.useMrrt,s.authorizationParams,h==null?void 0:h.audience,h==null?void 0:h.scope);try{const H=await this._requestToken(Object.assign(Object.assign(Object.assign({},s.authorizationParams),{grant_type:"refresh_token",refresh_token:h&&h.refresh_token,redirect_uri:_}),v&&{timeout:v}),{scopesToRequest:E});if(H.refresh_token&&this.options.useMrrt&&(h!=null&&h.refresh_token)&&await this.cacheManager.updateEntry(h.refresh_token,H.refresh_token),this.options.useMrrt&&(C=h==null?void 0:h.audience,r=h==null?void 0:h.scope,z=s.authorizationParams.audience,N=s.authorizationParams.scope,(C!==z||!kM(N,r))&&!kM(E,H.scope))){if(this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(s);const K=((ne,ue)=>{const pe=(ne==null?void 0:ne.split(" "))||[],xe=(ue==null?void 0:ue.split(" "))||[];return pe.filter(be=>xe.indexOf(be)==-1).join(",")})(E,H.scope);throw new HI(s.authorizationParams.audience||"default",K)}return Object.assign(Object.assign({},H),{scope:s.authorizationParams.scope,oauthTokenScope:H.scope,audience:s.authorizationParams.audience||"default"})}catch(H){if((H.message.indexOf("Missing Refresh Token")>-1||H.message&&H.message.indexOf("invalid refresh token")>-1)&&this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(s);throw H}var C,r,z,N}async _saveEntryInCache(s){const{id_token:h,decodedToken:_}=s,v=op(s,["id_token","decodedToken"]);this.userCache.set("@@user@@",{id_token:h,decodedToken:_}),await this.cacheManager.setIdToken(this.options.clientId,s.id_token,s.decodedToken),await this.cacheManager.set(v)}async _getIdTokenFromCache(){const s=this.options.authorizationParams.audience||"default",h=await this.cacheManager.getIdToken(new jd({clientId:this.options.clientId,audience:s,scope:this.scope})),_=this.userCache.get("@@user@@");return h&&h.id_token===(_==null?void 0:_.id_token)?_:(this.userCache.set("@@user@@",h),h)}async _getEntryFromCache({scope:s,audience:h,clientId:_,cacheMode:v}){const E=await this.cacheManager.get(new jd({scope:s,audience:h,clientId:_}),60,this.options.useMrrt,v);if(E&&E.access_token){const{token_type:C,access_token:r,oauthTokenScope:z,expires_in:N}=E,H=await this._getIdTokenFromCache();return H&&Object.assign(Object.assign({id_token:H.id_token,token_type:C||"Bearer",access_token:r},z?{scope:z}:null),{expires_in:N})}}async _requestToken(s,h){const{nonceIn:_,organization:v,scopesToRequest:E}=h||{},C=await BF(Object.assign(Object.assign({baseUrl:this.domainUrl,client_id:this.options.clientId,auth0Client:this.options.auth0Client,useFormData:this.options.useFormData,timeout:this.httpTimeoutMs,useMrrt:this.options.useMrrt,dpop:this.dpop},s),{scope:E||s.scope}),this.worker),r=await this._verifyIdToken(C.id_token,_,v);return await this._saveEntryInCache(Object.assign(Object.assign(Object.assign(Object.assign({},C),{decodedToken:r,scope:s.scope,audience:s.audience||"default"}),C.scope?{oauthTokenScope:C.scope}:null),{client_id:this.options.clientId})),this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this._processOrgHint(v||r.claims.org_id),Object.assign(Object.assign({},C),{decodedToken:r})}async exchangeToken(s){return this._requestToken({grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:s.subject_token,subject_token_type:s.subject_token_type,scope:H1(s.scope,this.scope),audience:s.audience||this.options.authorizationParams.audience})}_assertDpop(s){if(!s)throw new Error("`useDpop` option must be enabled before using DPoP.")}getDpopNonce(s){return this._assertDpop(this.dpop),this.dpop.getNonce(s)}setDpopNonce(s,h){return this._assertDpop(this.dpop),this.dpop.setNonce(s,h)}generateDpopProof(s){return this._assertDpop(this.dpop),this.dpop.generateProof(s)}createFetcher(s={}){return new eN(s,{isDpopEnabled:()=>!!this.options.useDpop,getAccessToken:h=>{var _;return this.getTokenSilently({authorizationParams:{scope:(_=h==null?void 0:h.scope)===null||_===void 0?void 0:_.join(" "),audience:h==null?void 0:h.audience},detailedResponse:!0})},getDpopNonce:()=>this.getDpopNonce(s.dpopNonceId),setDpopNonce:h=>this.setDpopNonce(h,s.dpopNonceId),generateDpopProof:h=>this.generateDpopProof(h)})}async connectAccountWithRedirect(s){const{openUrl:h,appState:_,connection:v,authorization_params:E,redirectUri:C=this.options.authorizationParams.redirect_uri||window.location.origin}=s;if(!v)throw new Error("connection is required");const r=BR(G1()),z=G1(),N=await EM(z),H=AM(N),{connect_uri:K,connect_params:ne,auth_session:ue}=await this.myAccountApi.connectAccount({connection:v,redirect_uri:C,state:r,code_challenge:H,code_challenge_method:"S256",authorization_params:E});this.transactionManager.create({state:r,code_verifier:z,auth_session:ue,redirect_uri:C,appState:_,connection:v,response_type:R_.ConnectCode});const pe=new URL(K);pe.searchParams.set("ticket",ne.ticket),h?await h(pe.toString()):window.location.assign(pe)}}var qO={isAuthenticated:!1,isLoading:!0,error:void 0,user:void 0},pu=function(){throw new Error("You forgot to wrap your component in <Auth0Provider>.")},nN=pl(pl({},qO),{buildAuthorizeUrl:pu,buildLogoutUrl:pu,getAccessTokenSilently:pu,getAccessTokenWithPopup:pu,getIdTokenClaims:pu,loginWithRedirect:pu,loginWithPopup:pu,connectAccountWithRedirect:pu,logout:pu,handleRedirectCallback:pu,getDpopNonce:pu,setDpopNonce:pu,generateDpopProof:pu,createFetcher:pu}),ZO=Ct.createContext(nN),LM=function(d){bF(s,d);function s(h,_){var v=d.call(this,_??h)||this;return v.error=h,v.error_description=_,Object.setPrototypeOf(v,s.prototype),v}return s}(Error),rN=/[?&](?:connect_)?code=[^&]+/,aN=/[?&]state=[^&]+/,oN=/[?&]error=[^&]+/,sN=function(d){return d===void 0&&(d=window.location.search),(rN.test(d)||oN.test(d))&&aN.test(d)},XO=function(d){return function(s){if(s instanceof Error)return s;if(s!==null&&typeof s=="object"&&"error"in s&&typeof s.error=="string"){if("error_description"in s&&typeof s.error_description=="string"){var h=s;return new LM(h.error,h.error_description)}var _=s;return new LM(_.error)}return new Error(d)}},zM=XO("Login failed"),GR=XO("Get access token failed"),YO=function(d){var s,h;d!=null&&d.redirectUri&&(console.warn("Using `redirectUri` has been deprecated, please use `authorizationParams.redirect_uri` instead as `redirectUri` will be no longer supported in a future version"),d.authorizationParams=(s=d.authorizationParams)!==null&&s!==void 0?s:{},d.authorizationParams.redirect_uri=d.redirectUri,delete d.redirectUri),!((h=d==null?void 0:d.authorizationParams)===null||h===void 0)&&h.redirectUri&&(console.warn("Using `authorizationParams.redirectUri` has been deprecated, please use `authorizationParams.redirect_uri` instead as `authorizationParams.redirectUri` will be removed in a future version"),d.authorizationParams.redirect_uri=d.authorizationParams.redirectUri,delete d.authorizationParams.redirectUri)},lN=function(d,s){switch(s.type){case"LOGIN_POPUP_STARTED":return pl(pl({},d),{isLoading:!0});case"LOGIN_POPUP_COMPLETE":case"INITIALISED":return pl(pl({},d),{isAuthenticated:!!s.user,user:s.user,isLoading:!1,error:void 0});case"HANDLE_REDIRECT_COMPLETE":case"GET_ACCESS_TOKEN_COMPLETE":return d.user===s.user?d:pl(pl({},d),{isAuthenticated:!!s.user,user:s.user});case"LOGOUT":return pl(pl({},d),{isAuthenticated:!1,user:void 0});case"ERROR":return pl(pl({},d),{isLoading:!1,error:s.error})}},cN=function(d){return YO(d),pl(pl({},d),{auth0Client:{name:"auth0-react",version:"2.8.0"}})},uN=function(d){var s;window.history.replaceState({},document.title,(s=d.returnTo)!==null&&s!==void 0?s:window.location.pathname)},hN=function(d){var s=d.children,h=d.skipRedirectCallback,_=d.onRedirectCallback,v=_===void 0?uN:_,E=d.context,C=E===void 0?ZO:E,r=SM(d,["children","skipRedirectCallback","onRedirectCallback","context"]),z=Ct.useState(function(){return new iN(cN(r))})[0],N=Ct.useReducer(lN,qO),H=N[0],K=N[1],ne=Ct.useRef(!1),ue=Ct.useCallback(function(hi){return K({type:"ERROR",error:hi}),hi},[]);Ct.useEffect(function(){ne.current||(ne.current=!0,function(){return pb(void 0,void 0,void 0,function(){var hi,Ti,Dt,Di,Qt,ui,ri;return mb(this,function(zi){switch(zi.label){case 0:return zi.trys.push([0,7,,8]),hi=void 0,sN()&&!h?[4,z.handleRedirectCallback()]:[3,3];case 1:return Ti=zi.sent(),Dt=Ti.appState,Di=Dt===void 0?{}:Dt,Qt=Ti.response_type,ui=SM(Ti,["appState","response_type"]),[4,z.getUser()];case 2:return hi=zi.sent(),Di.response_type=Qt,Qt===R_.ConnectCode&&(Di.connectedAccount=ui),v(Di,hi),[3,6];case 3:return[4,z.checkSession()];case 4:return zi.sent(),[4,z.getUser()];case 5:hi=zi.sent(),zi.label=6;case 6:return K({type:"INITIALISED",user:hi}),[3,8];case 7:return ri=zi.sent(),ue(zM(ri)),[3,8];case 8:return[2]}})})}())},[z,v,h,ue]);var pe=Ct.useCallback(function(hi){return YO(hi),z.loginWithRedirect(hi)},[z]),xe=Ct.useCallback(function(hi,Ti){return pb(void 0,void 0,void 0,function(){var Dt,Di;return mb(this,function(Qt){switch(Qt.label){case 0:K({type:"LOGIN_POPUP_STARTED"}),Qt.label=1;case 1:return Qt.trys.push([1,3,,4]),[4,z.loginWithPopup(hi,Ti)];case 2:return Qt.sent(),[3,4];case 3:return Dt=Qt.sent(),ue(zM(Dt)),[2];case 4:return[4,z.getUser()];case 5:return Di=Qt.sent(),K({type:"LOGIN_POPUP_COMPLETE",user:Di}),[2]}})})},[z,ue]),be=Ct.useCallback(function(){for(var hi=[],Ti=0;Ti<arguments.length;Ti++)hi[Ti]=arguments[Ti];return pb(void 0,wF([],hi),void 0,function(Dt){return Dt===void 0&&(Dt={}),mb(this,function(Di){switch(Di.label){case 0:return[4,z.logout(Dt)];case 1:return Di.sent(),(Dt.openUrl||Dt.openUrl===!1)&&K({type:"LOGOUT"}),[2]}})})},[z]),je=Ct.useCallback(function(hi){return pb(void 0,void 0,void 0,function(){var Ti,Dt,Di,Qt;return mb(this,function(ui){switch(ui.label){case 0:return ui.trys.push([0,2,3,5]),[4,z.getTokenSilently(hi)];case 1:return Ti=ui.sent(),[3,5];case 2:throw Dt=ui.sent(),GR(Dt);case 3:return Di=K,Qt={type:"GET_ACCESS_TOKEN_COMPLETE"},[4,z.getUser()];case 4:return Di.apply(void 0,[(Qt.user=ui.sent(),Qt)]),[7];case 5:return[2,Ti]}})})},[z]),Be=Ct.useCallback(function(hi,Ti){return pb(void 0,void 0,void 0,function(){var Dt,Di,Qt,ui;return mb(this,function(ri){switch(ri.label){case 0:return ri.trys.push([0,2,3,5]),[4,z.getTokenWithPopup(hi,Ti)];case 1:return Dt=ri.sent(),[3,5];case 2:throw Di=ri.sent(),GR(Di);case 3:return Qt=K,ui={type:"GET_ACCESS_TOKEN_COMPLETE"},[4,z.getUser()];case 4:return Qt.apply(void 0,[(ui.user=ri.sent(),ui)]),[7];case 5:return[2,Dt]}})})},[z]),He=Ct.useCallback(function(hi){return z.connectAccountWithRedirect(hi)},[z]),Xe=Ct.useCallback(function(){return z.getIdTokenClaims()},[z]),it=Ct.useCallback(function(hi){return pb(void 0,void 0,void 0,function(){var Ti,Dt,Di;return mb(this,function(Qt){switch(Qt.label){case 0:return Qt.trys.push([0,2,3,5]),[4,z.handleRedirectCallback(hi)];case 1:return[2,Qt.sent()];case 2:throw Ti=Qt.sent(),GR(Ti);case 3:return Dt=K,Di={type:"HANDLE_REDIRECT_COMPLETE"},[4,z.getUser()];case 4:return Dt.apply(void 0,[(Di.user=Qt.sent(),Di)]),[7];case 5:return[2]}})})},[z]),kt=Ct.useCallback(function(hi){return z.getDpopNonce(hi)},[z]),Nt=Ct.useCallback(function(hi,Ti){return z.setDpopNonce(hi,Ti)},[z]),oi=Ct.useCallback(function(hi){return z.generateDpopProof(hi)},[z]),yi=Ct.useCallback(function(hi){return z.createFetcher(hi)},[z]),Ui=Ct.useMemo(function(){return pl(pl({},H),{getAccessTokenSilently:je,getAccessTokenWithPopup:Be,getIdTokenClaims:Xe,loginWithRedirect:pe,loginWithPopup:xe,connectAccountWithRedirect:He,logout:be,handleRedirectCallback:it,getDpopNonce:kt,setDpopNonce:Nt,generateDpopProof:oi,createFetcher:yi})},[H,je,Be,Xe,pe,xe,He,be,it,kt,Nt,oi,yi]);return II.createElement(C.Provider,{value:Ui},s)},BC=function(d){return d===void 0&&(d=ZO),Ct.useContext(d)};function dN(){const{loginWithRedirect:d}=BC();return Ut.jsxDEV("button",{onClick:()=>d({authorizationParams:{redirect_uri:window.location.origin+"/dashboard"}}),children:"Login"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Home.tsx",lineNumber:6,columnNumber:5},this)}function KO(d,s){return function(){return d.apply(s,arguments)}}const{toString:fN}=Object.prototype,{getPrototypeOf:$I}=Object,{iterator:UC,toStringTag:JO}=Symbol,VC=(d=>s=>{const h=fN.call(s);return d[h]||(d[h]=h.slice(8,-1).toLowerCase())})(Object.create(null)),Hd=d=>(d=d.toLowerCase(),s=>VC(s)===d),jC=d=>s=>typeof s===d,{isArray:Db}=Array,Sb=jC("undefined");function RT(d){return d!==null&&!Sb(d)&&d.constructor!==null&&!Sb(d.constructor)&&yu(d.constructor.isBuffer)&&d.constructor.isBuffer(d)}const QO=Hd("ArrayBuffer");function pN(d){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(d):s=d&&d.buffer&&QO(d.buffer),s}const mN=jC("string"),yu=jC("function"),ek=jC("number"),IT=d=>d!==null&&typeof d=="object",gN=d=>d===!0||d===!1,dC=d=>{if(VC(d)!=="object")return!1;const s=$I(d);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(JO in d)&&!(UC in d)},_N=d=>{if(!IT(d)||RT(d))return!1;try{return Object.keys(d).length===0&&Object.getPrototypeOf(d)===Object.prototype}catch{return!1}},yN=Hd("Date"),vN=Hd("File"),xN=Hd("Blob"),bN=Hd("FileList"),wN=d=>IT(d)&&yu(d.pipe),TN=d=>{let s;return d&&(typeof FormData=="function"&&d instanceof FormData||yu(d.append)&&((s=VC(d))==="formdata"||s==="object"&&yu(d.toString)&&d.toString()==="[object FormData]"))},SN=Hd("URLSearchParams"),[EN,CN,AN,RN]=["ReadableStream","Request","Response","Headers"].map(Hd),IN=d=>d.trim?d.trim():d.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function DT(d,s,{allOwnKeys:h=!1}={}){if(d===null||typeof d>"u")return;let _,v;if(typeof d!="object"&&(d=[d]),Db(d))for(_=0,v=d.length;_<v;_++)s.call(null,d[_],_,d);else{if(RT(d))return;const E=h?Object.getOwnPropertyNames(d):Object.keys(d),C=E.length;let r;for(_=0;_<C;_++)r=E[_],s.call(null,d[r],r,d)}}function tk(d,s){if(RT(d))return null;s=s.toLowerCase();const h=Object.keys(d);let _=h.length,v;for(;_-- >0;)if(v=h[_],s===v.toLowerCase())return v;return null}const Hv=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ik=d=>!Sb(d)&&d!==Hv;function pI(){const{caseless:d,skipUndefined:s}=ik(this)&&this||{},h={},_=(v,E)=>{const C=d&&tk(h,E)||E;dC(h[C])&&dC(v)?h[C]=pI(h[C],v):dC(v)?h[C]=pI({},v):Db(v)?h[C]=v.slice():(!s||!Sb(v))&&(h[C]=v)};for(let v=0,E=arguments.length;v<E;v++)arguments[v]&&DT(arguments[v],_);return h}const DN=(d,s,h,{allOwnKeys:_}={})=>(DT(s,(v,E)=>{h&&yu(v)?d[E]=KO(v,h):d[E]=v},{allOwnKeys:_}),d),MN=d=>(d.charCodeAt(0)===65279&&(d=d.slice(1)),d),PN=(d,s,h,_)=>{d.prototype=Object.create(s.prototype,_),d.prototype.constructor=d,Object.defineProperty(d,"super",{value:s.prototype}),h&&Object.assign(d.prototype,h)},ON=(d,s,h,_)=>{let v,E,C;const r={};if(s=s||{},d==null)return s;do{for(v=Object.getOwnPropertyNames(d),E=v.length;E-- >0;)C=v[E],(!_||_(C,d,s))&&!r[C]&&(s[C]=d[C],r[C]=!0);d=h!==!1&&$I(d)}while(d&&(!h||h(d,s))&&d!==Object.prototype);return s},kN=(d,s,h)=>{d=String(d),(h===void 0||h>d.length)&&(h=d.length),h-=s.length;const _=d.indexOf(s,h);return _!==-1&&_===h},LN=d=>{if(!d)return null;if(Db(d))return d;let s=d.length;if(!ek(s))return null;const h=new Array(s);for(;s-- >0;)h[s]=d[s];return h},zN=(d=>s=>d&&s instanceof d)(typeof Uint8Array<"u"&&$I(Uint8Array)),FN=(d,s)=>{const _=(d&&d[UC]).call(d);let v;for(;(v=_.next())&&!v.done;){const E=v.value;s.call(d,E[0],E[1])}},NN=(d,s)=>{let h;const _=[];for(;(h=d.exec(s))!==null;)_.push(h);return _},BN=Hd("HTMLFormElement"),UN=d=>d.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(h,_,v){return _.toUpperCase()+v}),FM=(({hasOwnProperty:d})=>(s,h)=>d.call(s,h))(Object.prototype),VN=Hd("RegExp"),nk=(d,s)=>{const h=Object.getOwnPropertyDescriptors(d),_={};DT(h,(v,E)=>{let C;(C=s(v,E,d))!==!1&&(_[E]=C||v)}),Object.defineProperties(d,_)},jN=d=>{nk(d,(s,h)=>{if(yu(d)&&["arguments","caller","callee"].indexOf(h)!==-1)return!1;const _=d[h];if(yu(_)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+h+"'")})}})},GN=(d,s)=>{const h={},_=v=>{v.forEach(E=>{h[E]=!0})};return Db(d)?_(d):_(String(d).split(s)),h},HN=()=>{},$N=(d,s)=>d!=null&&Number.isFinite(d=+d)?d:s;function WN(d){return!!(d&&yu(d.append)&&d[JO]==="FormData"&&d[UC])}const qN=d=>{const s=new Array(10),h=(_,v)=>{if(IT(_)){if(s.indexOf(_)>=0)return;if(RT(_))return _;if(!("toJSON"in _)){s[v]=_;const E=Db(_)?[]:{};return DT(_,(C,r)=>{const z=h(C,v+1);!Sb(z)&&(E[r]=z)}),s[v]=void 0,E}}return _};return h(d,0)},ZN=Hd("AsyncFunction"),XN=d=>d&&(IT(d)||yu(d))&&yu(d.then)&&yu(d.catch),rk=((d,s)=>d?setImmediate:s?((h,_)=>(Hv.addEventListener("message",({source:v,data:E})=>{v===Hv&&E===h&&_.length&&_.shift()()},!1),v=>{_.push(v),Hv.postMessage(h,"*")}))(`axios@${Math.random()}`,[]):h=>setTimeout(h))(typeof setImmediate=="function",yu(Hv.postMessage)),YN=typeof queueMicrotask<"u"?queueMicrotask.bind(Hv):typeof process<"u"&&process.nextTick||rk,KN=d=>d!=null&&yu(d[UC]),$t={isArray:Db,isArrayBuffer:QO,isBuffer:RT,isFormData:TN,isArrayBufferView:pN,isString:mN,isNumber:ek,isBoolean:gN,isObject:IT,isPlainObject:dC,isEmptyObject:_N,isReadableStream:EN,isRequest:CN,isResponse:AN,isHeaders:RN,isUndefined:Sb,isDate:yN,isFile:vN,isBlob:xN,isRegExp:VN,isFunction:yu,isStream:wN,isURLSearchParams:SN,isTypedArray:zN,isFileList:bN,forEach:DT,merge:pI,extend:DN,trim:IN,stripBOM:MN,inherits:PN,toFlatObject:ON,kindOf:VC,kindOfTest:Hd,endsWith:kN,toArray:LN,forEachEntry:FN,matchAll:NN,isHTMLForm:BN,hasOwnProperty:FM,hasOwnProp:FM,reduceDescriptors:nk,freezeMethods:jN,toObjectSet:GN,toCamelCase:UN,noop:HN,toFiniteNumber:$N,findKey:tk,global:Hv,isContextDefined:ik,isSpecCompliantForm:WN,toJSONObject:qN,isAsyncFn:ZN,isThenable:XN,setImmediate:rk,asap:YN,isIterable:KN};function zr(d,s,h,_,v){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=d,this.name="AxiosError",s&&(this.code=s),h&&(this.config=h),_&&(this.request=_),v&&(this.response=v,this.status=v.status?v.status:null)}$t.inherits(zr,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:$t.toJSONObject(this.config),code:this.code,status:this.status}}});const ak=zr.prototype,ok={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(d=>{ok[d]={value:d}});Object.defineProperties(zr,ok);Object.defineProperty(ak,"isAxiosError",{value:!0});zr.from=(d,s,h,_,v,E)=>{const C=Object.create(ak);$t.toFlatObject(d,C,function(H){return H!==Error.prototype},N=>N!=="isAxiosError");const r=d&&d.message?d.message:"Error",z=s==null&&d?d.code:s;return zr.call(C,r,z,h,_,v),d&&C.cause==null&&Object.defineProperty(C,"cause",{value:d,configurable:!0}),C.name=d&&d.name||"Error",E&&Object.assign(C,E),C};const JN=null;function mI(d){return $t.isPlainObject(d)||$t.isArray(d)}function sk(d){return $t.endsWith(d,"[]")?d.slice(0,-2):d}function NM(d,s,h){return d?d.concat(s).map(function(v,E){return v=sk(v),!h&&E?"["+v+"]":v}).join(h?".":""):s}function QN(d){return $t.isArray(d)&&!d.some(mI)}const eB=$t.toFlatObject($t,{},null,function(s){return/^is[A-Z]/.test(s)});function GC(d,s,h){if(!$t.isObject(d))throw new TypeError("target must be an object");s=s||new FormData,h=$t.toFlatObject(h,{metaTokens:!0,dots:!1,indexes:!1},!1,function(xe,be){return!$t.isUndefined(be[xe])});const _=h.metaTokens,v=h.visitor||H,E=h.dots,C=h.indexes,z=(h.Blob||typeof Blob<"u"&&Blob)&&$t.isSpecCompliantForm(s);if(!$t.isFunction(v))throw new TypeError("visitor must be a function");function N(pe){if(pe===null)return"";if($t.isDate(pe))return pe.toISOString();if($t.isBoolean(pe))return pe.toString();if(!z&&$t.isBlob(pe))throw new zr("Blob is not supported. Use a Buffer instead.");return $t.isArrayBuffer(pe)||$t.isTypedArray(pe)?z&&typeof Blob=="function"?new Blob([pe]):Buffer.from(pe):pe}function H(pe,xe,be){let je=pe;if(pe&&!be&&typeof pe=="object"){if($t.endsWith(xe,"{}"))xe=_?xe:xe.slice(0,-2),pe=JSON.stringify(pe);else if($t.isArray(pe)&&QN(pe)||($t.isFileList(pe)||$t.endsWith(xe,"[]"))&&(je=$t.toArray(pe)))return xe=sk(xe),je.forEach(function(He,Xe){!($t.isUndefined(He)||He===null)&&s.append(C===!0?NM([xe],Xe,E):C===null?xe:xe+"[]",N(He))}),!1}return mI(pe)?!0:(s.append(NM(be,xe,E),N(pe)),!1)}const K=[],ne=Object.assign(eB,{defaultVisitor:H,convertValue:N,isVisitable:mI});function ue(pe,xe){if(!$t.isUndefined(pe)){if(K.indexOf(pe)!==-1)throw Error("Circular reference detected in "+xe.join("."));K.push(pe),$t.forEach(pe,function(je,Be){(!($t.isUndefined(je)||je===null)&&v.call(s,je,$t.isString(Be)?Be.trim():Be,xe,ne))===!0&&ue(je,xe?xe.concat(Be):[Be])}),K.pop()}}if(!$t.isObject(d))throw new TypeError("data must be an object");return ue(d),s}function BM(d){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(d).replace(/[!'()~]|%20|%00/g,function(_){return s[_]})}function WI(d,s){this._pairs=[],d&&GC(d,this,s)}const lk=WI.prototype;lk.append=function(s,h){this._pairs.push([s,h])};lk.toString=function(s){const h=s?function(_){return s.call(this,_,BM)}:BM;return this._pairs.map(function(v){return h(v[0])+"="+h(v[1])},"").join("&")};function tB(d){return encodeURIComponent(d).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function ck(d,s,h){if(!s)return d;const _=h&&h.encode||tB;$t.isFunction(h)&&(h={serialize:h});const v=h&&h.serialize;let E;if(v?E=v(s,h):E=$t.isURLSearchParams(s)?s.toString():new WI(s,h).toString(_),E){const C=d.indexOf("#");C!==-1&&(d=d.slice(0,C)),d+=(d.indexOf("?")===-1?"?":"&")+E}return d}class UM{constructor(){this.handlers=[]}use(s,h,_){return this.handlers.push({fulfilled:s,rejected:h,synchronous:_?_.synchronous:!1,runWhen:_?_.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){$t.forEach(this.handlers,function(_){_!==null&&s(_)})}}const uk={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},iB=typeof URLSearchParams<"u"?URLSearchParams:WI,nB=typeof FormData<"u"?FormData:null,rB=typeof Blob<"u"?Blob:null,aB={isBrowser:!0,classes:{URLSearchParams:iB,FormData:nB,Blob:rB},protocols:["http","https","file","blob","url","data"]},qI=typeof window<"u"&&typeof document<"u",gI=typeof navigator=="object"&&navigator||void 0,oB=qI&&(!gI||["ReactNative","NativeScript","NS"].indexOf(gI.product)<0),sB=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",lB=qI&&window.location.href||"http://localhost",cB=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:qI,hasStandardBrowserEnv:oB,hasStandardBrowserWebWorkerEnv:sB,navigator:gI,origin:lB},Symbol.toStringTag,{value:"Module"})),Ql={...cB,...aB};function uB(d,s){return GC(d,new Ql.classes.URLSearchParams,{visitor:function(h,_,v,E){return Ql.isNode&&$t.isBuffer(h)?(this.append(_,h.toString("base64")),!1):E.defaultVisitor.apply(this,arguments)},...s})}function hB(d){return $t.matchAll(/\w+|\[(\w*)]/g,d).map(s=>s[0]==="[]"?"":s[1]||s[0])}function dB(d){const s={},h=Object.keys(d);let _;const v=h.length;let E;for(_=0;_<v;_++)E=h[_],s[E]=d[E];return s}function hk(d){function s(h,_,v,E){let C=h[E++];if(C==="__proto__")return!0;const r=Number.isFinite(+C),z=E>=h.length;return C=!C&&$t.isArray(v)?v.length:C,z?($t.hasOwnProp(v,C)?v[C]=[v[C],_]:v[C]=_,!r):((!v[C]||!$t.isObject(v[C]))&&(v[C]=[]),s(h,_,v[C],E)&&$t.isArray(v[C])&&(v[C]=dB(v[C])),!r)}if($t.isFormData(d)&&$t.isFunction(d.entries)){const h={};return $t.forEachEntry(d,(_,v)=>{s(hB(_),v,h,0)}),h}return null}function fB(d,s,h){if($t.isString(d))try{return(s||JSON.parse)(d),$t.trim(d)}catch(_){if(_.name!=="SyntaxError")throw _}return(h||JSON.stringify)(d)}const MT={transitional:uk,adapter:["xhr","http","fetch"],transformRequest:[function(s,h){const _=h.getContentType()||"",v=_.indexOf("application/json")>-1,E=$t.isObject(s);if(E&&$t.isHTMLForm(s)&&(s=new FormData(s)),$t.isFormData(s))return v?JSON.stringify(hk(s)):s;if($t.isArrayBuffer(s)||$t.isBuffer(s)||$t.isStream(s)||$t.isFile(s)||$t.isBlob(s)||$t.isReadableStream(s))return s;if($t.isArrayBufferView(s))return s.buffer;if($t.isURLSearchParams(s))return h.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let r;if(E){if(_.indexOf("application/x-www-form-urlencoded")>-1)return uB(s,this.formSerializer).toString();if((r=$t.isFileList(s))||_.indexOf("multipart/form-data")>-1){const z=this.env&&this.env.FormData;return GC(r?{"files[]":s}:s,z&&new z,this.formSerializer)}}return E||v?(h.setContentType("application/json",!1),fB(s)):s}],transformResponse:[function(s){const h=this.transitional||MT.transitional,_=h&&h.forcedJSONParsing,v=this.responseType==="json";if($t.isResponse(s)||$t.isReadableStream(s))return s;if(s&&$t.isString(s)&&(_&&!this.responseType||v)){const C=!(h&&h.silentJSONParsing)&&v;try{return JSON.parse(s,this.parseReviver)}catch(r){if(C)throw r.name==="SyntaxError"?zr.from(r,zr.ERR_BAD_RESPONSE,this,null,this.response):r}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ql.classes.FormData,Blob:Ql.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};$t.forEach(["delete","get","head","post","put","patch"],d=>{MT.headers[d]={}});const pB=$t.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),mB=d=>{const s={};let h,_,v;return d&&d.split(`
`).forEach(function(C){v=C.indexOf(":"),h=C.substring(0,v).trim().toLowerCase(),_=C.substring(v+1).trim(),!(!h||s[h]&&pB[h])&&(h==="set-cookie"?s[h]?s[h].push(_):s[h]=[_]:s[h]=s[h]?s[h]+", "+_:_)}),s},VM=Symbol("internals");function W1(d){return d&&String(d).trim().toLowerCase()}function fC(d){return d===!1||d==null?d:$t.isArray(d)?d.map(fC):String(d)}function gB(d){const s=Object.create(null),h=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let _;for(;_=h.exec(d);)s[_[1]]=_[2];return s}const _B=d=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(d.trim());function HR(d,s,h,_,v){if($t.isFunction(_))return _.call(this,s,h);if(v&&(s=h),!!$t.isString(s)){if($t.isString(_))return s.indexOf(_)!==-1;if($t.isRegExp(_))return _.test(s)}}function yB(d){return d.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,h,_)=>h.toUpperCase()+_)}function vB(d,s){const h=$t.toCamelCase(" "+s);["get","set","has"].forEach(_=>{Object.defineProperty(d,_+h,{value:function(v,E,C){return this[_].call(this,s,v,E,C)},configurable:!0})})}let vu=class{constructor(s){s&&this.set(s)}set(s,h,_){const v=this;function E(r,z,N){const H=W1(z);if(!H)throw new Error("header name must be a non-empty string");const K=$t.findKey(v,H);(!K||v[K]===void 0||N===!0||N===void 0&&v[K]!==!1)&&(v[K||z]=fC(r))}const C=(r,z)=>$t.forEach(r,(N,H)=>E(N,H,z));if($t.isPlainObject(s)||s instanceof this.constructor)C(s,h);else if($t.isString(s)&&(s=s.trim())&&!_B(s))C(mB(s),h);else if($t.isObject(s)&&$t.isIterable(s)){let r={},z,N;for(const H of s){if(!$t.isArray(H))throw TypeError("Object iterator must return a key-value pair");r[N=H[0]]=(z=r[N])?$t.isArray(z)?[...z,H[1]]:[z,H[1]]:H[1]}C(r,h)}else s!=null&&E(h,s,_);return this}get(s,h){if(s=W1(s),s){const _=$t.findKey(this,s);if(_){const v=this[_];if(!h)return v;if(h===!0)return gB(v);if($t.isFunction(h))return h.call(this,v,_);if($t.isRegExp(h))return h.exec(v);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,h){if(s=W1(s),s){const _=$t.findKey(this,s);return!!(_&&this[_]!==void 0&&(!h||HR(this,this[_],_,h)))}return!1}delete(s,h){const _=this;let v=!1;function E(C){if(C=W1(C),C){const r=$t.findKey(_,C);r&&(!h||HR(_,_[r],r,h))&&(delete _[r],v=!0)}}return $t.isArray(s)?s.forEach(E):E(s),v}clear(s){const h=Object.keys(this);let _=h.length,v=!1;for(;_--;){const E=h[_];(!s||HR(this,this[E],E,s,!0))&&(delete this[E],v=!0)}return v}normalize(s){const h=this,_={};return $t.forEach(this,(v,E)=>{const C=$t.findKey(_,E);if(C){h[C]=fC(v),delete h[E];return}const r=s?yB(E):String(E).trim();r!==E&&delete h[E],h[r]=fC(v),_[r]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const h=Object.create(null);return $t.forEach(this,(_,v)=>{_!=null&&_!==!1&&(h[v]=s&&$t.isArray(_)?_.join(", "):_)}),h}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,h])=>s+": "+h).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...h){const _=new this(s);return h.forEach(v=>_.set(v)),_}static accessor(s){const _=(this[VM]=this[VM]={accessors:{}}).accessors,v=this.prototype;function E(C){const r=W1(C);_[r]||(vB(v,C),_[r]=!0)}return $t.isArray(s)?s.forEach(E):E(s),this}};vu.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);$t.reduceDescriptors(vu.prototype,({value:d},s)=>{let h=s[0].toUpperCase()+s.slice(1);return{get:()=>d,set(_){this[h]=_}}});$t.freezeMethods(vu);function $R(d,s){const h=this||MT,_=s||h,v=vu.from(_.headers);let E=_.data;return $t.forEach(d,function(r){E=r.call(h,E,v.normalize(),s?s.status:void 0)}),v.normalize(),E}function dk(d){return!!(d&&d.__CANCEL__)}function Mb(d,s,h){zr.call(this,d??"canceled",zr.ERR_CANCELED,s,h),this.name="CanceledError"}$t.inherits(Mb,zr,{__CANCEL__:!0});function fk(d,s,h){const _=h.config.validateStatus;!h.status||!_||_(h.status)?d(h):s(new zr("Request failed with status code "+h.status,[zr.ERR_BAD_REQUEST,zr.ERR_BAD_RESPONSE][Math.floor(h.status/100)-4],h.config,h.request,h))}function xB(d){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(d);return s&&s[1]||""}function bB(d,s){d=d||10;const h=new Array(d),_=new Array(d);let v=0,E=0,C;return s=s!==void 0?s:1e3,function(z){const N=Date.now(),H=_[E];C||(C=N),h[v]=z,_[v]=N;let K=E,ne=0;for(;K!==v;)ne+=h[K++],K=K%d;if(v=(v+1)%d,v===E&&(E=(E+1)%d),N-C<s)return;const ue=H&&N-H;return ue?Math.round(ne*1e3/ue):void 0}}function wB(d,s){let h=0,_=1e3/s,v,E;const C=(N,H=Date.now())=>{h=H,v=null,E&&(clearTimeout(E),E=null),d(...N)};return[(...N)=>{const H=Date.now(),K=H-h;K>=_?C(N,H):(v=N,E||(E=setTimeout(()=>{E=null,C(v)},_-K)))},()=>v&&C(v)]}const CC=(d,s,h=3)=>{let _=0;const v=bB(50,250);return wB(E=>{const C=E.loaded,r=E.lengthComputable?E.total:void 0,z=C-_,N=v(z),H=C<=r;_=C;const K={loaded:C,total:r,progress:r?C/r:void 0,bytes:z,rate:N||void 0,estimated:N&&r&&H?(r-C)/N:void 0,event:E,lengthComputable:r!=null,[s?"download":"upload"]:!0};d(K)},h)},jM=(d,s)=>{const h=d!=null;return[_=>s[0]({lengthComputable:h,total:d,loaded:_}),s[1]]},GM=d=>(...s)=>$t.asap(()=>d(...s)),TB=Ql.hasStandardBrowserEnv?((d,s)=>h=>(h=new URL(h,Ql.origin),d.protocol===h.protocol&&d.host===h.host&&(s||d.port===h.port)))(new URL(Ql.origin),Ql.navigator&&/(msie|trident)/i.test(Ql.navigator.userAgent)):()=>!0,SB=Ql.hasStandardBrowserEnv?{write(d,s,h,_,v,E,C){if(typeof document>"u")return;const r=[`${d}=${encodeURIComponent(s)}`];$t.isNumber(h)&&r.push(`expires=${new Date(h).toUTCString()}`),$t.isString(_)&&r.push(`path=${_}`),$t.isString(v)&&r.push(`domain=${v}`),E===!0&&r.push("secure"),$t.isString(C)&&r.push(`SameSite=${C}`),document.cookie=r.join("; ")},read(d){if(typeof document>"u")return null;const s=document.cookie.match(new RegExp("(?:^|; )"+d+"=([^;]*)"));return s?decodeURIComponent(s[1]):null},remove(d){this.write(d,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function EB(d){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(d)}function CB(d,s){return s?d.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):d}function pk(d,s,h){let _=!EB(s);return d&&(_||h==!1)?CB(d,s):s}const HM=d=>d instanceof vu?{...d}:d;function Xv(d,s){s=s||{};const h={};function _(N,H,K,ne){return $t.isPlainObject(N)&&$t.isPlainObject(H)?$t.merge.call({caseless:ne},N,H):$t.isPlainObject(H)?$t.merge({},H):$t.isArray(H)?H.slice():H}function v(N,H,K,ne){if($t.isUndefined(H)){if(!$t.isUndefined(N))return _(void 0,N,K,ne)}else return _(N,H,K,ne)}function E(N,H){if(!$t.isUndefined(H))return _(void 0,H)}function C(N,H){if($t.isUndefined(H)){if(!$t.isUndefined(N))return _(void 0,N)}else return _(void 0,H)}function r(N,H,K){if(K in s)return _(N,H);if(K in d)return _(void 0,N)}const z={url:E,method:E,data:E,baseURL:C,transformRequest:C,transformResponse:C,paramsSerializer:C,timeout:C,timeoutMessage:C,withCredentials:C,withXSRFToken:C,adapter:C,responseType:C,xsrfCookieName:C,xsrfHeaderName:C,onUploadProgress:C,onDownloadProgress:C,decompress:C,maxContentLength:C,maxBodyLength:C,beforeRedirect:C,transport:C,httpAgent:C,httpsAgent:C,cancelToken:C,socketPath:C,responseEncoding:C,validateStatus:r,headers:(N,H,K)=>v(HM(N),HM(H),K,!0)};return $t.forEach(Object.keys({...d,...s}),function(H){const K=z[H]||v,ne=K(d[H],s[H],H);$t.isUndefined(ne)&&K!==r||(h[H]=ne)}),h}const mk=d=>{const s=Xv({},d);let{data:h,withXSRFToken:_,xsrfHeaderName:v,xsrfCookieName:E,headers:C,auth:r}=s;if(s.headers=C=vu.from(C),s.url=ck(pk(s.baseURL,s.url,s.allowAbsoluteUrls),d.params,d.paramsSerializer),r&&C.set("Authorization","Basic "+btoa((r.username||"")+":"+(r.password?unescape(encodeURIComponent(r.password)):""))),$t.isFormData(h)){if(Ql.hasStandardBrowserEnv||Ql.hasStandardBrowserWebWorkerEnv)C.setContentType(void 0);else if($t.isFunction(h.getHeaders)){const z=h.getHeaders(),N=["content-type","content-length"];Object.entries(z).forEach(([H,K])=>{N.includes(H.toLowerCase())&&C.set(H,K)})}}if(Ql.hasStandardBrowserEnv&&(_&&$t.isFunction(_)&&(_=_(s)),_||_!==!1&&TB(s.url))){const z=v&&E&&SB.read(E);z&&C.set(v,z)}return s},AB=typeof XMLHttpRequest<"u",RB=AB&&function(d){return new Promise(function(h,_){const v=mk(d);let E=v.data;const C=vu.from(v.headers).normalize();let{responseType:r,onUploadProgress:z,onDownloadProgress:N}=v,H,K,ne,ue,pe;function xe(){ue&&ue(),pe&&pe(),v.cancelToken&&v.cancelToken.unsubscribe(H),v.signal&&v.signal.removeEventListener("abort",H)}let be=new XMLHttpRequest;be.open(v.method.toUpperCase(),v.url,!0),be.timeout=v.timeout;function je(){if(!be)return;const He=vu.from("getAllResponseHeaders"in be&&be.getAllResponseHeaders()),it={data:!r||r==="text"||r==="json"?be.responseText:be.response,status:be.status,statusText:be.statusText,headers:He,config:d,request:be};fk(function(Nt){h(Nt),xe()},function(Nt){_(Nt),xe()},it),be=null}"onloadend"in be?be.onloadend=je:be.onreadystatechange=function(){!be||be.readyState!==4||be.status===0&&!(be.responseURL&&be.responseURL.indexOf("file:")===0)||setTimeout(je)},be.onabort=function(){be&&(_(new zr("Request aborted",zr.ECONNABORTED,d,be)),be=null)},be.onerror=function(Xe){const it=Xe&&Xe.message?Xe.message:"Network Error",kt=new zr(it,zr.ERR_NETWORK,d,be);kt.event=Xe||null,_(kt),be=null},be.ontimeout=function(){let Xe=v.timeout?"timeout of "+v.timeout+"ms exceeded":"timeout exceeded";const it=v.transitional||uk;v.timeoutErrorMessage&&(Xe=v.timeoutErrorMessage),_(new zr(Xe,it.clarifyTimeoutError?zr.ETIMEDOUT:zr.ECONNABORTED,d,be)),be=null},E===void 0&&C.setContentType(null),"setRequestHeader"in be&&$t.forEach(C.toJSON(),function(Xe,it){be.setRequestHeader(it,Xe)}),$t.isUndefined(v.withCredentials)||(be.withCredentials=!!v.withCredentials),r&&r!=="json"&&(be.responseType=v.responseType),N&&([ne,pe]=CC(N,!0),be.addEventListener("progress",ne)),z&&be.upload&&([K,ue]=CC(z),be.upload.addEventListener("progress",K),be.upload.addEventListener("loadend",ue)),(v.cancelToken||v.signal)&&(H=He=>{be&&(_(!He||He.type?new Mb(null,d,be):He),be.abort(),be=null)},v.cancelToken&&v.cancelToken.subscribe(H),v.signal&&(v.signal.aborted?H():v.signal.addEventListener("abort",H)));const Be=xB(v.url);if(Be&&Ql.protocols.indexOf(Be)===-1){_(new zr("Unsupported protocol "+Be+":",zr.ERR_BAD_REQUEST,d));return}be.send(E||null)})},IB=(d,s)=>{const{length:h}=d=d?d.filter(Boolean):[];if(s||h){let _=new AbortController,v;const E=function(N){if(!v){v=!0,r();const H=N instanceof Error?N:this.reason;_.abort(H instanceof zr?H:new Mb(H instanceof Error?H.message:H))}};let C=s&&setTimeout(()=>{C=null,E(new zr(`timeout ${s} of ms exceeded`,zr.ETIMEDOUT))},s);const r=()=>{d&&(C&&clearTimeout(C),C=null,d.forEach(N=>{N.unsubscribe?N.unsubscribe(E):N.removeEventListener("abort",E)}),d=null)};d.forEach(N=>N.addEventListener("abort",E));const{signal:z}=_;return z.unsubscribe=()=>$t.asap(r),z}},DB=function*(d,s){let h=d.byteLength;if(h<s){yield d;return}let _=0,v;for(;_<h;)v=_+s,yield d.slice(_,v),_=v},MB=async function*(d,s){for await(const h of PB(d))yield*DB(h,s)},PB=async function*(d){if(d[Symbol.asyncIterator]){yield*d;return}const s=d.getReader();try{for(;;){const{done:h,value:_}=await s.read();if(h)break;yield _}}finally{await s.cancel()}},$M=(d,s,h,_)=>{const v=MB(d,s);let E=0,C,r=z=>{C||(C=!0,_&&_(z))};return new ReadableStream({async pull(z){try{const{done:N,value:H}=await v.next();if(N){r(),z.close();return}let K=H.byteLength;if(h){let ne=E+=K;h(ne)}z.enqueue(new Uint8Array(H))}catch(N){throw r(N),N}},cancel(z){return r(z),v.return()}},{highWaterMark:2})},WM=64*1024,{isFunction:qE}=$t,OB=(({Request:d,Response:s})=>({Request:d,Response:s}))($t.global),{ReadableStream:qM,TextEncoder:ZM}=$t.global,XM=(d,...s)=>{try{return!!d(...s)}catch{return!1}},kB=d=>{d=$t.merge.call({skipUndefined:!0},OB,d);const{fetch:s,Request:h,Response:_}=d,v=s?qE(s):typeof fetch=="function",E=qE(h),C=qE(_);if(!v)return!1;const r=v&&qE(qM),z=v&&(typeof ZM=="function"?(pe=>xe=>pe.encode(xe))(new ZM):async pe=>new Uint8Array(await new h(pe).arrayBuffer())),N=E&&r&&XM(()=>{let pe=!1;const xe=new h(Ql.origin,{body:new qM,method:"POST",get duplex(){return pe=!0,"half"}}).headers.has("Content-Type");return pe&&!xe}),H=C&&r&&XM(()=>$t.isReadableStream(new _("").body)),K={stream:H&&(pe=>pe.body)};v&&["text","arrayBuffer","blob","formData","stream"].forEach(pe=>{!K[pe]&&(K[pe]=(xe,be)=>{let je=xe&&xe[pe];if(je)return je.call(xe);throw new zr(`Response type '${pe}' is not supported`,zr.ERR_NOT_SUPPORT,be)})});const ne=async pe=>{if(pe==null)return 0;if($t.isBlob(pe))return pe.size;if($t.isSpecCompliantForm(pe))return(await new h(Ql.origin,{method:"POST",body:pe}).arrayBuffer()).byteLength;if($t.isArrayBufferView(pe)||$t.isArrayBuffer(pe))return pe.byteLength;if($t.isURLSearchParams(pe)&&(pe=pe+""),$t.isString(pe))return(await z(pe)).byteLength},ue=async(pe,xe)=>{const be=$t.toFiniteNumber(pe.getContentLength());return be??ne(xe)};return async pe=>{let{url:xe,method:be,data:je,signal:Be,cancelToken:He,timeout:Xe,onDownloadProgress:it,onUploadProgress:kt,responseType:Nt,headers:oi,withCredentials:yi="same-origin",fetchOptions:Ui}=mk(pe),hi=s||fetch;Nt=Nt?(Nt+"").toLowerCase():"text";let Ti=IB([Be,He&&He.toAbortSignal()],Xe),Dt=null;const Di=Ti&&Ti.unsubscribe&&(()=>{Ti.unsubscribe()});let Qt;try{if(kt&&N&&be!=="get"&&be!=="head"&&(Qt=await ue(oi,je))!==0){let wr=new h(xe,{method:"POST",body:je,duplex:"half"}),Jn;if($t.isFormData(je)&&(Jn=wr.headers.get("content-type"))&&oi.setContentType(Jn),wr.body){const[xn,mr]=jM(Qt,CC(GM(kt)));je=$M(wr.body,WM,xn,mr)}}$t.isString(yi)||(yi=yi?"include":"omit");const ui=E&&"credentials"in h.prototype,ri={...Ui,signal:Ti,method:be.toUpperCase(),headers:oi.normalize().toJSON(),body:je,duplex:"half",credentials:ui?yi:void 0};Dt=E&&new h(xe,ri);let zi=await(E?hi(Dt,Ui):hi(xe,ri));const En=H&&(Nt==="stream"||Nt==="response");if(H&&(it||En&&Di)){const wr={};["status","statusText","headers"].forEach(Va=>{wr[Va]=zi[Va]});const Jn=$t.toFiniteNumber(zi.headers.get("content-length")),[xn,mr]=it&&jM(Jn,CC(GM(it),!0))||[];zi=new _($M(zi.body,WM,xn,()=>{mr&&mr(),Di&&Di()}),wr)}Nt=Nt||"text";let hr=await K[$t.findKey(K,Nt)||"text"](zi,pe);return!En&&Di&&Di(),await new Promise((wr,Jn)=>{fk(wr,Jn,{data:hr,headers:vu.from(zi.headers),status:zi.status,statusText:zi.statusText,config:pe,request:Dt})})}catch(ui){throw Di&&Di(),ui&&ui.name==="TypeError"&&/Load failed|fetch/i.test(ui.message)?Object.assign(new zr("Network Error",zr.ERR_NETWORK,pe,Dt),{cause:ui.cause||ui}):zr.from(ui,ui&&ui.code,pe,Dt)}}},LB=new Map,gk=d=>{let s=d&&d.env||{};const{fetch:h,Request:_,Response:v}=s,E=[_,v,h];let C=E.length,r=C,z,N,H=LB;for(;r--;)z=E[r],N=H.get(z),N===void 0&&H.set(z,N=r?new Map:kB(s)),H=N;return N};gk();const ZI={http:JN,xhr:RB,fetch:{get:gk}};$t.forEach(ZI,(d,s)=>{if(d){try{Object.defineProperty(d,"name",{value:s})}catch{}Object.defineProperty(d,"adapterName",{value:s})}});const YM=d=>`- ${d}`,zB=d=>$t.isFunction(d)||d===null||d===!1;function FB(d,s){d=$t.isArray(d)?d:[d];const{length:h}=d;let _,v;const E={};for(let C=0;C<h;C++){_=d[C];let r;if(v=_,!zB(_)&&(v=ZI[(r=String(_)).toLowerCase()],v===void 0))throw new zr(`Unknown adapter '${r}'`);if(v&&($t.isFunction(v)||(v=v.get(s))))break;E[r||"#"+C]=v}if(!v){const C=Object.entries(E).map(([z,N])=>`adapter ${z} `+(N===!1?"is not supported by the environment":"is not available in the build"));let r=h?C.length>1?`since :
`+C.map(YM).join(`
`):" "+YM(C[0]):"as no adapter specified";throw new zr("There is no suitable adapter to dispatch the request "+r,"ERR_NOT_SUPPORT")}return v}const _k={getAdapter:FB,adapters:ZI};function WR(d){if(d.cancelToken&&d.cancelToken.throwIfRequested(),d.signal&&d.signal.aborted)throw new Mb(null,d)}function KM(d){return WR(d),d.headers=vu.from(d.headers),d.data=$R.call(d,d.transformRequest),["post","put","patch"].indexOf(d.method)!==-1&&d.headers.setContentType("application/x-www-form-urlencoded",!1),_k.getAdapter(d.adapter||MT.adapter,d)(d).then(function(_){return WR(d),_.data=$R.call(d,d.transformResponse,_),_.headers=vu.from(_.headers),_},function(_){return dk(_)||(WR(d),_&&_.response&&(_.response.data=$R.call(d,d.transformResponse,_.response),_.response.headers=vu.from(_.response.headers))),Promise.reject(_)})}const yk="1.13.1",HC={};["object","boolean","number","function","string","symbol"].forEach((d,s)=>{HC[d]=function(_){return typeof _===d||"a"+(s<1?"n ":" ")+d}});const JM={};HC.transitional=function(s,h,_){function v(E,C){return"[Axios v"+yk+"] Transitional option '"+E+"'"+C+(_?". "+_:"")}return(E,C,r)=>{if(s===!1)throw new zr(v(C," has been removed"+(h?" in "+h:"")),zr.ERR_DEPRECATED);return h&&!JM[C]&&(JM[C]=!0,console.warn(v(C," has been deprecated since v"+h+" and will be removed in the near future"))),s?s(E,C,r):!0}};HC.spelling=function(s){return(h,_)=>(console.warn(`${_} is likely a misspelling of ${s}`),!0)};function NB(d,s,h){if(typeof d!="object")throw new zr("options must be an object",zr.ERR_BAD_OPTION_VALUE);const _=Object.keys(d);let v=_.length;for(;v-- >0;){const E=_[v],C=s[E];if(C){const r=d[E],z=r===void 0||C(r,E,d);if(z!==!0)throw new zr("option "+E+" must be "+z,zr.ERR_BAD_OPTION_VALUE);continue}if(h!==!0)throw new zr("Unknown option "+E,zr.ERR_BAD_OPTION)}}const pC={assertOptions:NB,validators:HC},ip=pC.validators;let qv=class{constructor(s){this.defaults=s||{},this.interceptors={request:new UM,response:new UM}}async request(s,h){try{return await this._request(s,h)}catch(_){if(_ instanceof Error){let v={};Error.captureStackTrace?Error.captureStackTrace(v):v=new Error;const E=v.stack?v.stack.replace(/^.+\n/,""):"";try{_.stack?E&&!String(_.stack).endsWith(E.replace(/^.+\n.+\n/,""))&&(_.stack+=`
`+E):_.stack=E}catch{}}throw _}}_request(s,h){typeof s=="string"?(h=h||{},h.url=s):h=s||{},h=Xv(this.defaults,h);const{transitional:_,paramsSerializer:v,headers:E}=h;_!==void 0&&pC.assertOptions(_,{silentJSONParsing:ip.transitional(ip.boolean),forcedJSONParsing:ip.transitional(ip.boolean),clarifyTimeoutError:ip.transitional(ip.boolean)},!1),v!=null&&($t.isFunction(v)?h.paramsSerializer={serialize:v}:pC.assertOptions(v,{encode:ip.function,serialize:ip.function},!0)),h.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?h.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:h.allowAbsoluteUrls=!0),pC.assertOptions(h,{baseUrl:ip.spelling("baseURL"),withXsrfToken:ip.spelling("withXSRFToken")},!0),h.method=(h.method||this.defaults.method||"get").toLowerCase();let C=E&&$t.merge(E.common,E[h.method]);E&&$t.forEach(["delete","get","head","post","put","patch","common"],pe=>{delete E[pe]}),h.headers=vu.concat(C,E);const r=[];let z=!0;this.interceptors.request.forEach(function(xe){typeof xe.runWhen=="function"&&xe.runWhen(h)===!1||(z=z&&xe.synchronous,r.unshift(xe.fulfilled,xe.rejected))});const N=[];this.interceptors.response.forEach(function(xe){N.push(xe.fulfilled,xe.rejected)});let H,K=0,ne;if(!z){const pe=[KM.bind(this),void 0];for(pe.unshift(...r),pe.push(...N),ne=pe.length,H=Promise.resolve(h);K<ne;)H=H.then(pe[K++],pe[K++]);return H}ne=r.length;let ue=h;for(;K<ne;){const pe=r[K++],xe=r[K++];try{ue=pe(ue)}catch(be){xe.call(this,be);break}}try{H=KM.call(this,ue)}catch(pe){return Promise.reject(pe)}for(K=0,ne=N.length;K<ne;)H=H.then(N[K++],N[K++]);return H}getUri(s){s=Xv(this.defaults,s);const h=pk(s.baseURL,s.url,s.allowAbsoluteUrls);return ck(h,s.params,s.paramsSerializer)}};$t.forEach(["delete","get","head","options"],function(s){qv.prototype[s]=function(h,_){return this.request(Xv(_||{},{method:s,url:h,data:(_||{}).data}))}});$t.forEach(["post","put","patch"],function(s){function h(_){return function(E,C,r){return this.request(Xv(r||{},{method:s,headers:_?{"Content-Type":"multipart/form-data"}:{},url:E,data:C}))}}qv.prototype[s]=h(),qv.prototype[s+"Form"]=h(!0)});let BB=class vk{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let h;this.promise=new Promise(function(E){h=E});const _=this;this.promise.then(v=>{if(!_._listeners)return;let E=_._listeners.length;for(;E-- >0;)_._listeners[E](v);_._listeners=null}),this.promise.then=v=>{let E;const C=new Promise(r=>{_.subscribe(r),E=r}).then(v);return C.cancel=function(){_.unsubscribe(E)},C},s(function(E,C,r){_.reason||(_.reason=new Mb(E,C,r),h(_.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const h=this._listeners.indexOf(s);h!==-1&&this._listeners.splice(h,1)}toAbortSignal(){const s=new AbortController,h=_=>{s.abort(_)};return this.subscribe(h),s.signal.unsubscribe=()=>this.unsubscribe(h),s.signal}static source(){let s;return{token:new vk(function(v){s=v}),cancel:s}}};function UB(d){return function(h){return d.apply(null,h)}}function VB(d){return $t.isObject(d)&&d.isAxiosError===!0}const _I={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(_I).forEach(([d,s])=>{_I[s]=d});function xk(d){const s=new qv(d),h=KO(qv.prototype.request,s);return $t.extend(h,qv.prototype,s,{allOwnKeys:!0}),$t.extend(h,s,null,{allOwnKeys:!0}),h.create=function(v){return xk(Xv(d,v))},h}const vs=xk(MT);vs.Axios=qv;vs.CanceledError=Mb;vs.CancelToken=BB;vs.isCancel=dk;vs.VERSION=yk;vs.toFormData=GC;vs.AxiosError=zr;vs.Cancel=vs.CanceledError;vs.all=function(s){return Promise.all(s)};vs.spread=UB;vs.isAxiosError=VB;vs.mergeConfig=Xv;vs.AxiosHeaders=vu;vs.formToJSON=d=>hk($t.isHTMLForm(d)?new FormData(d):d);vs.getAdapter=_k.getAdapter;vs.HttpStatusCode=_I;vs.default=vs;const{Axios:K4,AxiosError:J4,CanceledError:Q4,isCancel:ej,CancelToken:tj,VERSION:ij,all:nj,Cancel:rj,isAxiosError:aj,spread:oj,toFormData:sj,AxiosHeaders:lj,HttpStatusCode:cj,formToJSON:uj,getAdapter:hj,mergeConfig:dj}=vs,sp=vs.create({baseURL:"http://localhost:3000/api",withCredentials:!0});sp.interceptors.request.use(d=>{const s=localStorage.getItem("access_token");return s&&(d.headers=d.headers??{},d.headers.Authorization=`Bearer ${s}`),d});var bk={exports:{}};(function(d,s){(function(h,_){d.exports=_()})(JL,function(){var h,_,v;function E(r,z){if(!h)h=z;else if(!_)_=z;else{var N="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+h+")(sharedChunk); ("+_+")(sharedChunk); self.onerror = null;",H={};h(H),v=z(H),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(v.workerUrl=window.URL.createObjectURL(new Blob([N],{type:"text/javascript"})))}}E(["exports"],function(r){var z=1e-6,N=typeof Float32Array<"u"?Float32Array:Array;function H(n,e){var i=e[0],o=e[1],c=e[2],m=e[3],g=i*m-c*o;return g?(n[0]=m*(g=1/g),n[1]=-o*g,n[2]=-c*g,n[3]=i*g,n):null}function K(){var n=new N(9);return N!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function ne(n,e){var i=e[0],o=e[1],c=e[2],m=e[3],g=e[4],x=e[5],S=e[6],A=e[7],M=e[8];return n[0]=g*M-x*A,n[1]=c*A-o*M,n[2]=o*x-c*g,n[3]=x*S-m*M,n[4]=i*M-c*S,n[5]=c*m-i*x,n[6]=m*A-g*S,n[7]=o*S-i*A,n[8]=i*g-o*m,n}function ue(n,e,i){var o=e[0],c=e[1],m=e[2],g=e[3],x=e[4],S=e[5],A=e[6],M=e[7],P=e[8],k=i[0],U=i[1],V=i[2],q=i[3],J=i[4],ee=i[5],ae=i[6],le=i[7],de=i[8];return n[0]=k*o+U*g+V*A,n[1]=k*c+U*x+V*M,n[2]=k*m+U*S+V*P,n[3]=q*o+J*g+ee*A,n[4]=q*c+J*x+ee*M,n[5]=q*m+J*S+ee*P,n[6]=ae*o+le*g+de*A,n[7]=ae*c+le*x+de*M,n[8]=ae*m+le*S+de*P,n}function pe(){var n=new N(16);return N!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function xe(n){var e=new N(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function be(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function je(n,e){var i=e[0],o=e[1],c=e[2],m=e[3],g=e[4],x=e[5],S=e[6],A=e[7],M=e[8],P=e[9],k=e[10],U=e[11],V=e[12],q=e[13],J=e[14],ee=e[15],ae=i*x-o*g,le=i*S-c*g,de=i*A-m*g,Re=o*S-c*x,Se=o*A-m*x,Pe=c*A-m*S,ke=M*q-P*V,Fe=M*J-k*V,rt=M*ee-U*V,qe=P*J-k*q,ot=P*ee-U*q,ht=k*ee-U*J,yt=ae*ht-le*ot+de*qe+Re*rt-Se*Fe+Pe*ke;return yt?(n[0]=(x*ht-S*ot+A*qe)*(yt=1/yt),n[1]=(c*ot-o*ht-m*qe)*yt,n[2]=(q*Pe-J*Se+ee*Re)*yt,n[3]=(k*Se-P*Pe-U*Re)*yt,n[4]=(S*rt-g*ht-A*Fe)*yt,n[5]=(i*ht-c*rt+m*Fe)*yt,n[6]=(J*de-V*Pe-ee*le)*yt,n[7]=(M*Pe-k*de+U*le)*yt,n[8]=(g*ot-x*rt+A*ke)*yt,n[9]=(o*rt-i*ot-m*ke)*yt,n[10]=(V*Se-q*de+ee*ae)*yt,n[11]=(P*de-M*Se-U*ae)*yt,n[12]=(x*Fe-g*qe-S*ke)*yt,n[13]=(i*qe-o*Fe+c*ke)*yt,n[14]=(q*le-V*Re-J*ae)*yt,n[15]=(M*Re-P*le+k*ae)*yt,n):null}function Be(n,e,i){var o=e[0],c=e[1],m=e[2],g=e[3],x=e[4],S=e[5],A=e[6],M=e[7],P=e[8],k=e[9],U=e[10],V=e[11],q=e[12],J=e[13],ee=e[14],ae=e[15],le=i[0],de=i[1],Re=i[2],Se=i[3];return n[0]=le*o+de*x+Re*P+Se*q,n[1]=le*c+de*S+Re*k+Se*J,n[2]=le*m+de*A+Re*U+Se*ee,n[3]=le*g+de*M+Re*V+Se*ae,n[4]=(le=i[4])*o+(de=i[5])*x+(Re=i[6])*P+(Se=i[7])*q,n[5]=le*c+de*S+Re*k+Se*J,n[6]=le*m+de*A+Re*U+Se*ee,n[7]=le*g+de*M+Re*V+Se*ae,n[8]=(le=i[8])*o+(de=i[9])*x+(Re=i[10])*P+(Se=i[11])*q,n[9]=le*c+de*S+Re*k+Se*J,n[10]=le*m+de*A+Re*U+Se*ee,n[11]=le*g+de*M+Re*V+Se*ae,n[12]=(le=i[12])*o+(de=i[13])*x+(Re=i[14])*P+(Se=i[15])*q,n[13]=le*c+de*S+Re*k+Se*J,n[14]=le*m+de*A+Re*U+Se*ee,n[15]=le*g+de*M+Re*V+Se*ae,n}function He(n,e,i){var o,c,m,g,x,S,A,M,P,k,U,V,q=i[0],J=i[1],ee=i[2];return e===n?(n[12]=e[0]*q+e[4]*J+e[8]*ee+e[12],n[13]=e[1]*q+e[5]*J+e[9]*ee+e[13],n[14]=e[2]*q+e[6]*J+e[10]*ee+e[14],n[15]=e[3]*q+e[7]*J+e[11]*ee+e[15]):(c=e[1],m=e[2],g=e[3],x=e[4],S=e[5],A=e[6],M=e[7],P=e[8],k=e[9],U=e[10],V=e[11],n[0]=o=e[0],n[1]=c,n[2]=m,n[3]=g,n[4]=x,n[5]=S,n[6]=A,n[7]=M,n[8]=P,n[9]=k,n[10]=U,n[11]=V,n[12]=o*q+x*J+P*ee+e[12],n[13]=c*q+S*J+k*ee+e[13],n[14]=m*q+A*J+U*ee+e[14],n[15]=g*q+M*J+V*ee+e[15]),n}function Xe(n,e,i){var o=i[0],c=i[1],m=i[2];return n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o,n[3]=e[3]*o,n[4]=e[4]*c,n[5]=e[5]*c,n[6]=e[6]*c,n[7]=e[7]*c,n[8]=e[8]*m,n[9]=e[9]*m,n[10]=e[10]*m,n[11]=e[11]*m,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function it(n,e,i){var o=Math.sin(i),c=Math.cos(i),m=e[4],g=e[5],x=e[6],S=e[7],A=e[8],M=e[9],P=e[10],k=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=m*c+A*o,n[5]=g*c+M*o,n[6]=x*c+P*o,n[7]=S*c+k*o,n[8]=A*c-m*o,n[9]=M*c-g*o,n[10]=P*c-x*o,n[11]=k*c-S*o,n}function kt(n,e,i){var o=Math.sin(i),c=Math.cos(i),m=e[0],g=e[1],x=e[2],S=e[3],A=e[8],M=e[9],P=e[10],k=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=m*c-A*o,n[1]=g*c-M*o,n[2]=x*c-P*o,n[3]=S*c-k*o,n[8]=m*o+A*c,n[9]=g*o+M*c,n[10]=x*o+P*c,n[11]=S*o+k*c,n}function Nt(n,e,i){var o=Math.sin(i),c=Math.cos(i),m=e[0],g=e[1],x=e[2],S=e[3],A=e[4],M=e[5],P=e[6],k=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=m*c+A*o,n[1]=g*c+M*o,n[2]=x*c+P*o,n[3]=S*c+k*o,n[4]=A*c-m*o,n[5]=M*c-g*o,n[6]=P*c-x*o,n[7]=k*c-S*o,n}function oi(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function yi(n,e,i){var o,c,m,g=i[0],x=i[1],S=i[2],A=Math.sqrt(g*g+x*x+S*S);return A<z?null:(g*=A=1/A,x*=A,S*=A,o=Math.sin(e),c=Math.cos(e),n[0]=g*g*(m=1-c)+c,n[1]=x*g*m+S*o,n[2]=S*g*m-x*o,n[3]=0,n[4]=g*x*m-S*o,n[5]=x*x*m+c,n[6]=S*x*m+g*o,n[7]=0,n[8]=g*S*m+x*o,n[9]=x*S*m-g*o,n[10]=S*S*m+c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function Ui(n,e){var i=e[0],o=e[1],c=e[2],m=e[4],g=e[5],x=e[6],S=e[8],A=e[9],M=e[10];return n[0]=Math.sqrt(i*i+o*o+c*c),n[1]=Math.sqrt(m*m+g*g+x*x),n[2]=Math.sqrt(S*S+A*A+M*M),n}function hi(n,e){var i=e[0],o=e[1],c=e[2],m=e[3],g=i+i,x=o+o,S=c+c,A=i*g,M=o*g,P=o*x,k=c*g,U=c*x,V=c*S,q=m*g,J=m*x,ee=m*S;return n[0]=1-P-V,n[1]=M+ee,n[2]=k-J,n[3]=0,n[4]=M-ee,n[5]=1-A-V,n[6]=U+q,n[7]=0,n[8]=k+J,n[9]=U-q,n[10]=1-A-P,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}var Ti=Be;function Dt(){var n=new N(3);return N!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Di(n){var e=new N(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Qt(n){var e=n[0],i=n[1],o=n[2];return Math.sqrt(e*e+i*i+o*o)}function ui(n,e,i){var o=new N(3);return o[0]=n,o[1]=e,o[2]=i,o}function ri(n,e,i,o){return n[0]=e,n[1]=i,n[2]=o,n}function zi(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function En(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function hr(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function wr(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function Jn(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function xn(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function mr(n,e,i,o){return n[0]=e[0]+i[0]*o,n[1]=e[1]+i[1]*o,n[2]=e[2]+i[2]*o,n}function Va(n,e){var i=e[0]-n[0],o=e[1]-n[1],c=e[2]-n[2];return Math.sqrt(i*i+o*o+c*c)}function Aa(n,e){var i=e[0]-n[0],o=e[1]-n[1],c=e[2]-n[2];return i*i+o*o+c*c}function Gi(n){var e=n[0],i=n[1],o=n[2];return e*e+i*i+o*o}function Cn(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function Vi(n,e){var i=e[0],o=e[1],c=e[2],m=i*i+o*o+c*c;return m>0&&(m=1/Math.sqrt(m)),n[0]=e[0]*m,n[1]=e[1]*m,n[2]=e[2]*m,n}function Rn(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function gr(n,e,i){var o=e[0],c=e[1],m=e[2],g=i[0],x=i[1],S=i[2];return n[0]=c*S-m*x,n[1]=m*g-o*S,n[2]=o*x-c*g,n}function za(n,e,i,o){var c=e[0],m=e[1],g=e[2];return n[0]=c+o*(i[0]-c),n[1]=m+o*(i[1]-m),n[2]=g+o*(i[2]-g),n}function Bn(n,e,i){var o=e[0],c=e[1],m=e[2],g=i[3]*o+i[7]*c+i[11]*m+i[15];return n[0]=(i[0]*o+i[4]*c+i[8]*m+i[12])/(g=g||1),n[1]=(i[1]*o+i[5]*c+i[9]*m+i[13])/g,n[2]=(i[2]*o+i[6]*c+i[10]*m+i[14])/g,n}function eo(n,e,i){var o=e[0],c=e[1],m=e[2];return n[0]=o*i[0]+c*i[3]+m*i[6],n[1]=o*i[1]+c*i[4]+m*i[7],n[2]=o*i[2]+c*i[5]+m*i[8],n}function jr(n,e,i){var o=i[0],c=i[1],m=i[2],g=i[3],x=e[0],S=e[1],A=e[2],M=c*A-m*S,P=m*x-o*A,k=o*S-c*x;return n[0]=x+g*(M+=M)+c*(k+=k)-m*(P+=P),n[1]=S+g*P+m*M-o*k,n[2]=A+g*k+o*P-c*M,n}function Zr(n){return n[0]=0,n[1]=0,n[2]=0,n}function to(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var Pr=En,Do=hr,mo=Qt;function ha(){var n=new N(4);return N!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Ra(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function bo(n,e){var i=e[0],o=e[1],c=e[2],m=e[3],g=i*i+o*o+c*c+m*m;return g>0&&(g=1/Math.sqrt(g)),n[0]=i*g,n[1]=o*g,n[2]=c*g,n[3]=m*g,n}function Fa(n,e,i){var o=e[0],c=e[1],m=e[2],g=e[3];return n[0]=i[0]*o+i[4]*c+i[8]*m+i[12]*g,n[1]=i[1]*o+i[5]*c+i[9]*m+i[13]*g,n[2]=i[2]*o+i[6]*c+i[10]*m+i[14]*g,n[3]=i[3]*o+i[7]*c+i[11]*m+i[15]*g,n}function wa(){var n=new N(4);return N!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Na(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function qa(n,e,i){i*=.5;var o=e[0],c=e[1],m=e[2],g=e[3],x=Math.sin(i),S=Math.cos(i);return n[0]=o*S+g*x,n[1]=c*S+m*x,n[2]=m*S-c*x,n[3]=g*S-o*x,n}function xs(n,e,i){i*=.5;var o=e[0],c=e[1],m=e[2],g=e[3],x=Math.sin(i),S=Math.cos(i);return n[0]=o*S-m*x,n[1]=c*S+g*x,n[2]=m*S+o*x,n[3]=g*S-c*x,n}Dt(),ha();var ja,Pi,rn,Qn=bo,Fr=(ja=Dt(),Pi=ui(1,0,0),rn=ui(0,1,0),function(n,e,i){var o=Rn(e,i);return o<-.999999?(gr(ja,Pi,e),mo(ja)<1e-6&&gr(ja,rn,e),Vi(ja,ja),function(c,m,g){g*=.5;var x=Math.sin(g);c[0]=x*m[0],c[1]=x*m[1],c[2]=x*m[2],c[3]=Math.cos(g)}(n,ja,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(gr(ja,e,i),n[0]=ja[0],n[1]=ja[1],n[2]=ja[2],n[3]=1+o,Qn(n,n))});function Un(){var n=new N(2);return N!=Float32Array&&(n[0]=0,n[1]=0),n}function da(n,e){var i=new N(2);return i[0]=n,i[1]=e,i}function _a(n,e,i){return n[0]=e,n[1]=i,n}function Ga(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n}function Vr(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n}function xr(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n}function _n(n){var e=n[0],i=n[1];return Math.sqrt(e*e+i*i)}function aa(n,e){var i=e[0],o=e[1],c=i*i+o*o;return c>0&&(c=1/Math.sqrt(c)),n[0]=e[0]*c,n[1]=e[1]*c,n}function wo(n,e){return n[0]*e[0]+n[1]*e[1]}wa(),wa(),K();var go,no,tc=Vr;function ml(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}Un();var ic=function(){if(no)return go;function n(e,i,o,c){this.cx=3*e,this.bx=3*(o-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=o,this.p2y=c}return no=1,go=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var o=e,c=0;c<8;c++){var m=this.sampleCurveX(o)-e;if(Math.abs(m)<i)return o;var g=this.sampleCurveDerivativeX(o);if(Math.abs(g)<1e-6)break;o-=m/g}var x=0,S=1;for(o=e,c=0;c<20&&(m=this.sampleCurveX(o),!(Math.abs(m-e)<i));c++)e>m?x=o:S=o,o=.5*(S-x)+x;return o},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},go}(),Ks=ml(ic);function vt(n,e){this.x=n,this.y=e}function To(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!To(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!To(n[i],e[i]))return!1;return!0}return n===e}vt.prototype={clone(){return new vt(this.x,this.y)},add(n){return this.clone()._add(n)},sub(n){return this.clone()._sub(n)},multByPoint(n){return this.clone()._multByPoint(n)},divByPoint(n){return this.clone()._divByPoint(n)},mult(n){return this.clone()._mult(n)},div(n){return this.clone()._div(n)},rotate(n){return this.clone()._rotate(n)},rotateAround(n,e){return this.clone()._rotateAround(n,e)},matMult(n){return this.clone()._matMult(n)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(n){return this.x===n.x&&this.y===n.y},dist(n){return Math.sqrt(this.distSqr(n))},distSqr(n){const e=n.x-this.x,i=n.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith(n){return this.angleWithSep(n.x,n.y)},angleWithSep(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult(n){const e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add(n){return this.x+=n.x,this.y+=n.y,this},_sub(n){return this.x-=n.x,this.y-=n.y,this},_mult(n){return this.x*=n,this.y*=n,this},_div(n){return this.x/=n,this.y/=n,this},_multByPoint(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint(n){return this.x/=n.x,this.y/=n.y,this},_unit(){return this._div(this.mag()),this},_perp(){const n=this.y;return this.y=this.x,this.x=-n,this},_rotate(n){const e=Math.cos(n),i=Math.sin(n),o=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=o,this},_rotateAround(n,e){const i=Math.cos(n),o=Math.sin(n),c=e.y+o*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:vt},vt.convert=function(n){if(n instanceof vt)return n;if(Array.isArray(n))return new vt(+n[0],+n[1]);if(n.x!==void 0&&n.y!==void 0)return new vt(+n.x,+n.y);throw new Error("Expected [x, y] or {x, y} point format")};const Go=Math.PI/180,Mo=180/Math.PI;function cn(n){return n*Go}function Za(n){return n*Mo}const et=[[0,0],[1,0],[1,1],[0,1]];function vi(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function ie(n,e,i,o){const c=new Ks(n,e,i,o);return function(m){return c.solve(m)}}const W=ie(.25,.1,.25,1);function X(n,e,i){return Math.min(i,Math.max(e,n))}function he(n,e,i){return(i=X((i-n)/(e-n),0,1))*i*(3-2*i)}function we(n,e,i){const o=i-e,c=((n-e)%o+o)%o+e;return c===e?i:c}function ye(n,e,i){if(!n.length)return i(null,[]);let o=n.length;const c=new Array(n.length);let m=null;n.forEach((g,x)=>{e(g,(S,A)=>{S&&(m=S),c[x]=A,--o==0&&i(m,c)})})}let Me=1;function Ve(){return Me++}function Le(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log2(n)))}function $e(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function gt(n,e,i){const o={};for(const c in n)o[c]=e.call(this,n[c],c,n);return o}function ut(n,e,i){const o={};for(const c in n)e.call(this,n[c],c,n)&&(o[c]=n[c]);return o}function Kt(n){return Array.isArray(n)?n.map(Kt):typeof n=="object"&&n?gt(n,Kt):n}function Ci(n,e){for(let i=0;i<n.length;i++)if(e.indexOf(n[i])>=0)return!0;return!1}const _i={};function Yt(n){_i[n]||(typeof console<"u"&&console.warn(n),_i[n]=!0)}function Yi(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function ln(n){let e=0;for(let i,o,c=0,m=n.length,g=m-1;c<m;g=c++)i=n[c],o=n[g],e+=(o.x-i.x)*(i.y+o.y);return e}function lr([n,e,i]){const o=cn(e+90),c=cn(i);return{x:n*Math.cos(o)*Math.sin(c),y:n*Math.sin(o)*Math.sin(c),z:n*Math.cos(c),azimuthal:e,polar:i}}function Or(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function Ta(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,o,c,m)=>{const g=c||m;return e[o]=!g||g.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let oa=null;function Kr(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function er(n,e,i,o){for(;e<i;){const c=e+i>>1;n[c]<o?e=c+1:i=c}return e}function bn(n,e,i,o){for(;e<i;){const c=e+i>>1;n[c]<=o?e=c+1:i=c}return e}function Rr(n){return n>0?1/(1.001-n):1+n}function Gr(n){return n>0?1-1/(1.001-n):-n}function rr(n,e,i){return(n-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Tr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Tr.API_URL)return null;try{const n=new URL(Tr.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function sa(n){return Tr.API_URL_REGEX.test(n)}function ro(n){return Tr.API_SPRITE_REGEX.test(n)}let Ho,Ll,Ia,as,Po,Js;function Ko(){return Ho==null&&(Ho=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ho}const bs={now:()=>as!==void 0?as:performance.now(),setNow(n){as=n},restoreNow(){as=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:o}=n;Po||(Po=document.createElement("canvas"));const c=Po.getContext("2d",{willReadFrequently:!0});if(!c)throw new Error("failed to create canvas 2d context");return(i>Po.width||o>Po.height)&&(Po.width=i,Po.height=o),c.clearRect(-e,-e,i+2*e,o+2*e),c.drawImage(n,0,0,i,o),c.getImageData(-e,-e,i+2*e,o+2*e)},resolveURL:n=>(Ll||(Ll=document.createElement("a")),Ll.href=n,Ll.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ia==null&&(Ia=window.matchMedia("(prefers-reduced-motion: reduce)")),Ia.matches)},hasCanvasFingerprintNoise(){if(Js!==void 0)return Js;if(!Ko())return Js=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let i=0;for(let c=0;c<n.width;++c)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(c,0,1,1);const o=e.getImageData(0,0,n.width,n.height);i=0;for(let c=0;c<o.data.length;++c)if(c%4!=3&&i++!==o.data[c])return Js=!0,!0;return Js=!1,!1}};function Rc(n,e){const i=n.indexOf("?");if(i<0)return`${n}?${new URLSearchParams(e).toString()}`;const o=new URLSearchParams(n.slice(i));for(const c in e)o.set(c,e[c]);return`${n.slice(0,i)}?${o.toString()}`}function ch(n,e={persistentParams:[]}){const i=n.indexOf("?");if(i<0)return n;const o=new URLSearchParams,c=new URLSearchParams(n.slice(i));for(const g of e.persistentParams){const x=c.get(g);x&&o.set(g,x)}const m=o.toString();return`${n.slice(0,i)}${m.length>0?`?${m}`:""}`}const xu="mapbox-tiles";let Nr=500,os=50;const $o=["language","worldview","jobid"];let pn,ss;function ao(){try{return caches}catch{}}function gl(){const n=ao();n&&pn==null&&(pn=n.open(xu))}let nc=1/0;const $d={supported:!1,testSupport:function(n){!Wd&&fa&&(_l?yl(n):Ba=n)}};let Ba,fa,Wd=!1,_l=!1;const Ha=typeof self<"u"?self:{};function yl(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,fa),n.isContextLost())return;$d.supported=!0}catch{}n.deleteTexture(e),Wd=!0}Ha.document&&(fa=Ha.document.createElement("img"),fa.onload=function(){Ba&&yl(Ba),Ba=null,_l=!0},fa.onerror=function(){Wd=!0,Ba=null},fa.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const bu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(bu);class rc extends Error{constructor(e,i,o){i===401&&sa(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const qd=Or()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,wu=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(qd())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(o,c){const m=new AbortController,g=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:qd(),referrerPolicy:o.referrerPolicy,signal:m.signal});let x=!1,S=!1;const A=(M=g.url).indexOf("sku=")>0&&sa(M);var M;o.type==="json"&&g.headers.set("Accept","application/json");const P=(U,V,q)=>{if(S)return;if(U&&U.message!=="SecurityError"&&Yt(U.toString()),V&&q)return k(V);const J=Date.now();fetch(g).then(ee=>{if(ee.ok){const ae=A?ee.clone():null;return k(ee,ae,J)}return c(new rc(ee.statusText,ee.status,o.url))}).catch(ee=>{ee.name!=="AbortError"&&c(new Error(`${ee.message} ${o.url}`))})},k=(U,V,q)=>{(o.type==="arrayBuffer"?U.arrayBuffer():o.type==="json"?U.json():U.text()).then(J=>{S||(V&&q&&function(ee,ae,le){if(gl(),pn==null)return;const de=Ta(ae.headers.get("Cache-Control")||"");if(de["no-store"])return;const Re={status:ae.status,statusText:ae.statusText,headers:new Headers};ae.headers.forEach((ke,Fe)=>Re.headers.set(Fe,ke)),de["max-age"]&&Re.headers.set("Expires",new Date(le+1e3*de["max-age"]).toUTCString());const Se=Re.headers.get("Expires");if(!Se||new Date(Se).getTime()-le<42e4)return;let Pe=ch(ee.url,{persistentParams:$o});if(ae.status===206){const ke=ee.headers.get("Range");if(!ke)return;Re.status=200,Pe=Rc(Pe,{range:ke})}(function(ke,Fe){if(ss===void 0)try{new Response(new ReadableStream),ss=!0}catch{ss=!1}ss?Fe(ke.body):ke.blob().then(Fe).catch(rt=>Yt(rt.message))})(ae,ke=>{const Fe=new Response((rt=ae.status)!==200&&rt!==404&&[101,103,204,205,304].includes(rt)?null:ke,Re);var rt;gl(),pn!=null&&pn.then(qe=>qe.put(Pe,Fe)).catch(qe=>Yt(qe.message))})}(g,V,q),x=!0,c(null,J,U.headers))}).catch(J=>{S||c(new Error(J.message))})};return A?function(U,V){if(gl(),pn==null)return V(null);pn.then(q=>{let J=ch(U.url,{persistentParams:$o});const ee=U.headers.get("Range");ee&&(J=Rc(J,{range:ee})),q.match(J).then(ae=>{const le=function(de){if(!de)return!1;const Re=new Date(de.headers.get("Expires")||0),Se=Ta(de.headers.get("Cache-Control")||"");return Number(Re)>Date.now()&&!Se["no-cache"]}(ae);q.delete(J).catch(V),le&&q.put(J,ae.clone()).catch(V),V(null,ae,le)}).catch(V)}).catch(V)}(g,P):P(null,null),{cancel:()=>{S=!0,x||m.abort()}}}(n,e);if(Or(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(o,c){const m=new XMLHttpRequest;m.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const g in o.headers)m.setRequestHeader(g,o.headers[g]);return o.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=o.credentials==="include",m.onerror=()=>{c(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let g=m.response;if(o.type==="json")try{g=JSON.parse(m.response)}catch(S){return c(S)}const x=new Headers;m.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(S=>{const A=S.split(": "),M=A.shift(),P=A.join(": ");x.append(M,P)}),c(null,g,x)}else c(new rc(m.statusText,m.status,o.url))},m.send(o.body),{cancel:()=>m.abort()}}(n,e)},ac=function(n,e){return wu(Object.assign(n,{type:"arrayBuffer"}),e)};function Vn(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const Ic="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let oc,Tu;oc=[],Tu=0;const sc=function(n,e){if($d.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),Tu>=Tr.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return oc.push(m),m}Tu++;let i=!1;const o=()=>{if(!i)for(i=!0,Tu--;oc.length&&Tu<Tr.MAX_PARALLEL_IMAGE_REQUESTS;){const m=oc.shift(),{requestParameters:g,callback:x,cancelled:S}=m;S||(m.cancel=sc(g,x).cancel)}},c=ac(n,(m,g,x)=>{o(),m?e(m):g&&(self.createImageBitmap?function(S,A){const M=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(M).then(P=>{A(null,P)}).catch(P=>{A(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(S,A)=>e(S,A,x)):function(S,A){const M=new Image;M.onload=()=>{A(null,M),URL.revokeObjectURL(M.src),M.onload=null,requestAnimationFrame(()=>{M.src=Ic})},M.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(S)],{type:"image/png"});M.src=S.byteLength?URL.createObjectURL(P):Ic}(g,(S,A)=>e(S,A,x)))});return{cancel:()=>{c.cancel(),o()}}};var Dc,Mc,Pc,Oc={exports:{}},dp={exports:{}},uh={exports:{}},zm=function(){if(Pc)return Oc.exports;Pc=1;var n=(Dc||(Dc=1,dp.exports=function(i,o){var c,m,g,x,S,A,M,P;for(m=i.length-(c=3&i.length),g=o,S=3432918353,A=461845907,P=0;P<m;)M=255&i.charCodeAt(P)|(255&i.charCodeAt(++P))<<8|(255&i.charCodeAt(++P))<<16|(255&i.charCodeAt(++P))<<24,++P,g=27492+(65535&(x=5*(65535&(g=(g^=M=(65535&(M=(M=(65535&M)*S+(((M>>>16)*S&65535)<<16)&4294967295)<<15|M>>>17))*A+(((M>>>16)*A&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(M=0,c){case 3:M^=(255&i.charCodeAt(P+2))<<16;case 2:M^=(255&i.charCodeAt(P+1))<<8;case 1:g^=M=(65535&(M=(M=(65535&(M^=255&i.charCodeAt(P)))*S+(((M>>>16)*S&65535)<<16)&4294967295)<<15|M>>>17))*A+(((M>>>16)*A&65535)<<16)&4294967295}return g^=i.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}),dp.exports),e=(Mc||(Mc=1,uh.exports=function(i,o){for(var c,m=i.length,g=o^m,x=0;m>=4;)c=1540483477*(65535&(c=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),m-=4,++x;switch(m){case 3:g^=(255&i.charCodeAt(x+2))<<16;case 2:g^=(255&i.charCodeAt(x+1))<<8;case 1:g=1540483477*(65535&(g^=255&i.charCodeAt(x)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}),uh.exports);return Oc.exports=n,Oc.exports.murmur3=n,Oc.exports.murmur2=e,Oc.exports}(),ge=ml(zm);class Ye{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class zt extends Ye{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function Xt(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function Ai(n,e,i){if(i&&i[n]){const o=i[n].indexOf(e);o!==-1&&i[n].splice(o,1)}}class mn{on(e,i){return this._listeners=this._listeners||{},Xt(e,i,this._listeners),this}off(e,i){return Ai(e,i,this._listeners),Ai(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Xt(e,i,this._oneTimeListeners),this):new Promise(o=>{this.once(e,o)})}fire(e,i){const o=typeof e=="string"?new Ye(e,i):e,c=o.type;if(this.listens(c)){o.target=this;const m=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const S of m)S.call(this,o);const g=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const S of g)Ai(c,S,this._oneTimeListeners),S.call(this,o);const x=this._eventedParent;if(x){const S=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(o,S),x.fire(o)}}else o instanceof zt&&console.error(o.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Mi{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Mi(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,o]=e.split("");return new Mi({name:i,iconsetId:o})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Mi.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Wn,Ir={},la=function(){if(Wn)return Ir;Wn=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(m){return(m=Math.round(m))<0?0:m>255?255:m}function i(m){return e(m[m.length-1]==="%"?parseFloat(m)/100*255:parseInt(m))}function o(m){return(g=m[m.length-1]==="%"?parseFloat(m)/100:parseFloat(m))<0?0:g>1?1:g;var g}function c(m,g,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?m+(g-m)*x*6:2*x<1?g:3*x<2?m+(g-m)*(2/3-x)*6:m}try{Ir.parseCSSColor=function(m){var g,x=m.replace(/ /g,"").toLowerCase();if(x in n)return n[x].slice();if(x[0]==="#")return x.length===4?(g=parseInt(x.substr(1),16))>=0&&g<=4095?[(3840&g)>>4|(3840&g)>>8,240&g|(240&g)>>4,15&g|(15&g)<<4,1]:null:x.length===7&&(g=parseInt(x.substr(1),16))>=0&&g<=16777215?[(16711680&g)>>16,(65280&g)>>8,255&g,1]:null;var S=x.indexOf("("),A=x.indexOf(")");if(S!==-1&&A+1===x.length){var M=x.substr(0,S),P=x.substr(S+1,A-(S+1)).split(","),k=1;switch(M){case"rgba":if(P.length!==4)return null;k=o(P.pop());case"rgb":return P.length!==3?null:[i(P[0]),i(P[1]),i(P[2]),k];case"hsla":if(P.length!==4)return null;k=o(P.pop());case"hsl":if(P.length!==3)return null;var U=(parseFloat(P[0])%360+360)%360/360,V=o(P[1]),q=o(P[2]),J=q<=.5?q*(V+1):q+V-q*V,ee=2*q-J;return[e(255*c(ee,J,U+1/3)),e(255*c(ee,J,U)),e(255*c(ee,J,U-1/3)),k];default:return null}}return null}}catch{}return Ir}();class Qi{constructor(e,i,o,c=1){this.r=e,this.g=i,this.b=o,this.a=c}static parse(e){if(!e)return;if(e instanceof Qi)return e;if(typeof e!="string")return;const i=la.parseCSSColor(e);return i?new Qi(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,o,c]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*o)},${c})`}toNonPremultipliedRenderColor(e){const{r:i,g:o,b:c,a:m}=this;return new Sr(e,i,o,c,m)}toPremultipliedRenderColor(e){const{r:i,g:o,b:c,a:m}=this;return new Xa(e,i*m,o*m,c*m,m)}clone(){return new Qi(this.r,this.g,this.b,this.a)}}class Da{constructor(e,i,o,c,m,g=!1){if(this.premultiplied=!1,this.premultiplied=g,e){const x=e.image.height,S=x*x;this.premultiplied?(i=m===0?0:i/m*(x-1),o=m===0?0:o/m*(x-1),c=m===0?0:c/m*(x-1)):(i*=x-1,o*=x-1,c*=x-1);const A=Math.floor(i),M=Math.floor(o),P=Math.floor(c),k=Math.ceil(i),U=Math.ceil(o),V=Math.ceil(c),q=i-A,J=o-M,ee=c-P,ae=e.image.data,le=4*(A+M*S+P*x),de=4*(A+M*S+V*x),Re=4*(A+U*S+P*x),Se=4*(A+U*S+V*x),Pe=4*(k+M*S+P*x),ke=4*(k+M*S+V*x),Fe=4*(k+U*S+P*x),rt=4*(k+U*S+V*x);if(le<0||rt>=ae.length)throw new Error("out of range");this.r=wi(wi(wi(ae[le],ae[de],ee),wi(ae[Re],ae[Se],ee),J),wi(wi(ae[Pe],ae[ke],ee),wi(ae[Fe],ae[rt],ee),J),q)/255*(this.premultiplied?m:1),this.g=wi(wi(wi(ae[le+1],ae[de+1],ee),wi(ae[Re+1],ae[Se+1],ee),J),wi(wi(ae[Pe+1],ae[ke+1],ee),wi(ae[Fe+1],ae[rt+1],ee),J),q)/255*(this.premultiplied?m:1),this.b=wi(wi(wi(ae[le+2],ae[de+2],ee),wi(ae[Re+2],ae[Se+2],ee),J),wi(wi(ae[Pe+2],ae[ke+2],ee),wi(ae[Fe+2],ae[rt+2],ee),J),q)/255*(this.premultiplied?m:1),this.a=m}else this.r=i,this.g=o,this.b=c,this.a=m}toArray(){const{r:e,g:i,b:o,a:c}=this;return[255*e,255*i,255*o,c]}toHslaArray(){let{r:e,g:i,b:o,a:c}=this;if(this.premultiplied){if(c===0)return[0,0,0,0];const V=1/c;e*=V,i*=V,o*=V}const m=Math.min(Math.max(e,0),1),g=Math.min(Math.max(i,0),1),x=Math.min(Math.max(o,0),1),S=Math.min(m,g,x),A=Math.max(m,g,x),M=A-S,P=.5*(S+A);if(M===0)return[0,0,100*P,c];const k=P>.5?M/(2-A-S):M/(A+S);let U;switch(A){case m:U=60*((g-x)/M+(g<x?6:0));break;case g:U=60*((x-m)/M+2);break;default:U=60*((m-g)/M+4)}return[U,100*k,100*P,c]}toArray01(){const{r:e,g:i,b:o,a:c}=this;return[e,i,o,c]}toArray01Scaled(e){const{r:i,g:o,b:c}=this;return[i*e,o*e,c*e]}toArray01Linear(){const{r:e,g:i,b:o,a:c}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(o,2.2),c]}}class Sr extends Da{constructor(e,i,o,c,m){super(e,i,o,c,m,!1)}}class Xa extends Da{constructor(e,i,o,c,m){super(e,i,o,c,m,!0)}}function wi(n,e,i){return n*(1-i)+e*i}function lc(n,e,i){return n.map((o,c)=>wi(o,e[c],i))}Qi.black=new Qi(0,0,0,1),Qi.white=new Qi(1,1,1,1),Qi.transparent=new Qi(0,0,0,0),Qi.red=new Qi(1,0,0,1),Qi.blue=new Qi(0,0,1,1);var vl=Object.freeze({__proto__:null,array:lc,color:function(n,e,i){return new Qi(wi(n.r,e.r,i),wi(n.g,e.g,i),wi(n.b,e.b,i),wi(n.a,e.a,i))},number:wi});class Oo extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class ws{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[o,c]of i)this.bindings[o]=c}concat(e){return new ws(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const kc={kind:"null"},bi={kind:"number"},Dn={kind:"string"},qn={kind:"boolean"},ks={kind:"color"},hh={kind:"object"},cr={kind:"value"},Zd={kind:"collator"},dh={kind:"formatted"},fp={kind:"resolvedImage"};function Ma(n,e){return{kind:"array",itemType:n,N:e}}function io(n){if(n.kind==="array"){const e=io(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const N_=[kc,bi,Dn,qn,ks,dh,hh,Ma(cr),fp];function ld(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!ld(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of N_)if(!ld(i,e))return null}}return`Expected ${io(n)} but found ${io(e)} instead.`}function pp(n,e){return e.some(i=>i.kind===n.kind)}function mp(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}function cd(n,e){return n.kind==="array"&&e.kind==="array"?n.N===e.N&&cd(n.itemType,e.itemType):n.kind===e.kind}class Fm{constructor(e,i,o){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Jo{constructor(e,i,o,c,m){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=o,this.fontStack=c,this.textColor=m}}class Sa{constructor(e){this.sections=e}static fromString(e){return new Sa([new Jo(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Sa?e:Sa.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const c=i.image.getPrimary().id.toString();e.push(["image",c]);continue}e.push(i.text);const o={};i.fontStack&&(o["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(o["font-scale"]=i.scale),i.textColor&&(o["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(o)}return e}}class Pa{constructor(e,i={}){if(this.id=Mi.from(e),this.options=Object.assign({},i),i.transform){const{a:o,b:c,c:m,d:g,e:x,f:S}=i.transform;this.options.transform=new DOMMatrix([o,c,m,g,x,S])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:o,d:c,e:m,f:g}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:o,d:c,e:m,f:g}})}static parse(e){let i,o,c,m;try{({name:i,iconsetId:o,params:c,transform:m}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:g,b:x,c:S,d:A,e:M,f:P}=m||{};return new Pa({name:i,iconsetId:o},{params:c,transform:new DOMMatrix([g,x,S,A,M,P])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class oo{constructor(e,i,o,c,m=!1){this.primaryId=Mi.from(e),this.primaryOptions=i,o&&(this.secondaryId=Mi.from(o)),this.secondaryOptions=c,this.available=m}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Pa(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Pa(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?oo.build({name:e}):e}static build(e,i,o,c){return!e||typeof e=="object"&&!("name"in e)?null:new oo(e,o,i,c)}}function Xd(n,e,i,o){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[n,e,i,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[n,e,i,o]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Su(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof Qi||n instanceof Fm||n instanceof Sa||n instanceof oo)return!0;if(Array.isArray(n)){for(const e of n)if(!Su(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Su(n[e]))return!1;return!0}return!1}function _o(n){if(n===null)return kc;if(typeof n=="string")return Dn;if(typeof n=="boolean")return qn;if(typeof n=="number")return bi;if(n instanceof Qi)return ks;if(n instanceof Fm)return Zd;if(n instanceof Sa)return dh;if(n instanceof oo)return fp;if(Array.isArray(n)){const e=n.length;let i;for(const o of n){const c=_o(o);if(i){if(i===c)continue;i=cr;break}i=c}return Ma(i||cr,e)}return hh}function Qs(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Sa||n instanceof oo||n instanceof Qi?n.toString():JSON.stringify(n)}class Eu{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Su(e[1]))return i.error("invalid value");const o=e[1];let c=_o(o);const m=i.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new Eu(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Qi?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Sa?this.value.serialize():this.value}}class Oa{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const an={string:Dn,number:bi,boolean:qn,object:hh};class pi{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let o,c=1;const m=e[0];if(m==="array"){let x,S;if(e.length>2){const A=e[1];if(typeof A!="string"||!(A in an)||A==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=an[A],c++}else x=cr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);S=e[2],c++}o=Ma(x,S)}else o=an[m];const g=[];for(;c<e.length;c++){const x=i.parse(e[c],c,cr);if(!x)return null;g.push(x)}return new pi(o,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const o=this.args[i].evaluate(e);if(!ld(this.type,_o(o)))return o;if(i===this.args.length-1)throw new Oa(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${io(_o(o))} but was expected to be of type ${io(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){i.push(o.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&i.push(c)}}return i.concat(this.args.map(o=>o.serialize()))}}class ud{constructor(e){this.type=dh,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return i.error("First argument must be an image or text section.");const c=[];let m=!1;for(let g=1;g<=e.length-1;++g){const x=e[g];if(m&&typeof x=="object"&&!Array.isArray(x)){m=!1;let S=null;if(x["font-scale"]&&(S=i.parseObjectValue(x["font-scale"],g,"font-scale",bi),!S))return null;let A=null;if(x["text-font"]&&(A=i.parseObjectValue(x["text-font"],g,"text-font",Ma(Dn)),!A))return null;let M=null;if(x["text-color"]&&(M=i.parseObjectValue(x["text-color"],g,"text-color",ks),!M))return null;const P=c[c.length-1];P.scale=S,P.font=A,P.textColor=M}else{const S=i.parse(e[g],g,cr);if(!S)return null;const A=S.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:S,scale:null,font:null,textColor:null})}}return new ud(c)}evaluate(e){return new Sa(this.sections.map(i=>{const o=i.content.evaluate(e);return cd(_o(o),fp)?new Jo("",o,null,null,null):new Jo(Qs(o),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const o={};i.scale&&(o["font-scale"]=i.scale.serialize()),i.font&&(o["text-font"]=i.font.serialize()),i.textColor&&(o["text-color"]=i.textColor.serialize()),e.push(o)}return e}}class Hi{constructor(e,i,o,c){this._imageWarnHistory={},this.type=fp,this.namePrimary=e,this.nameSecondary=i,o&&(this.paramsPrimary=o.params,this.iconsetIdPrimary=o.iconset?o.iconset.id:void 0),c&&(this.paramsSecondary=c.params,this.iconsetIdSecondary=c.iconset?c.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let o=1;const c=[];function m(){if(o<e.length){const x=i.parse(e[o],o++,Dn);return x?(c.push({image:x,options:{}}),!0):(i.error(c.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function g(){if(o<e.length){const S=e[o];if((x=S)===null||typeof x!="object"||Array.isArray(x))return!0;const A=S.params,M=S.iconset,P=i.concat(o);if(!A&&!M)return o++,!0;if(A){if(typeof A!="object"||A.constructor!==Object)return P.error('Image options "params" should be an object'),!1;const k={},U=P.concat(void 0,"params");for(const V in A){if(!V)return U.error("Image parameter name should be non-empty"),!1;const q=U.concat(void 0,V).parse(A[V],void 0,ks,void 0,{typeAnnotation:"coerce"});if(!q)return!1;k[V]=q}c[c.length-1].options.params=k}if(M){if(typeof M!="object"||M.constructor!==Object)return P.error('Image options "iconset" should be an object'),!1;if(!M.id)return P.error('Image options "iconset" should have an "id" property'),!1;c[c.length-1].options.iconset=M}return o++,!0}var x;return!0}for(let x=0;x<2;x++)if(!m()||!g())return;return new Hi(c[0].image,c[1]?c[1].image:void 0,c[0].options,c[1]?c[1].options:void 0)}evaluateParams(e,i){const o={};if(i){for(const c in i)if(i[c])try{o[c]=i[c].evaluate(e)}catch{continue}if(Object.keys(o).length!==0)return{params:o}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},o=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,c=oo.build(i,o,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(c&&e.availableImages){const m=c.getPrimary().id;if(c.available=e.availableImages.some(g=>Mi.isEqual(g,m)),c.available){const g=c.getSecondary()?c.getSecondary().id:null;g&&(c.available=e.availableImages.some(x=>Mi.isEqual(x,g)))}}return c}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const o={};if(i&&(o.iconset={id:i}),e){o.params={};for(const c in e)e[c]&&(o.params[c]=e[c].serialize())}return Object.keys(o).length>0?o:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function hd(n){return Ni(n)?"string":gp(n)?"number":_p(n)?"boolean":Array.isArray(n)?"array":n===null?"null":Nm(n)?"object":typeof n}function Nm(n){return n!=null&&!Array.isArray(n)&&typeof n!="function"&&!(n instanceof String||n instanceof Number||n instanceof Boolean)&&typeof n=="object"}function Ni(n){return typeof n=="string"||n instanceof String}function gp(n){return typeof n=="number"||n instanceof Number}function _p(n){return typeof n=="boolean"||n instanceof Boolean}const dd={"to-boolean":qn,"to-color":ks,"to-number":bi,"to-string":Dn};class zl{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const o=e[0],c=[];let m=kc;if(o==="to-array"){if(!Array.isArray(e[1]))return null;const g=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);m=Ma(i.expectedType.itemType,g)}else{if(!(g>0&&Su(e[1][0])))return null;m=Ma(_o(e[1][0]),g)}for(let x=0;x<g;x++){const S=e[1][x];let A;if(Array.isArray(S))A=i.parse(S,void 0,m.itemType);else{const M=hd(S);if(M!==m.itemType.kind)return i.error(`Expected ${m.itemType.kind} but found ${M}.`);A=i.registry.literal.parse(["literal",S===void 0?null:S],i)}if(!A)return null;c.push(A)}}else{if((o==="to-boolean"||o==="to-string")&&e.length!==2)return i.error("Expected one argument.");m=dd[o];for(let g=1;g<e.length;g++){const x=i.parse(e[g],g,cr);if(!x)return null;c.push(x)}}return new zl(m,c)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,o;for(const c of this.args){if(i=c.evaluate(e),o=null,i instanceof Qi)return i;if(typeof i=="string"){const m=e.parseColor(i);if(m)return m}else if(Array.isArray(i)&&(o=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Xd(i[0],i[1],i[2],i[3]),!o))return new Qi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Oa(o||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const o of this.args){if(i=o.evaluate(e),i===null)return 0;const c=Number(i);if(!isNaN(c))return c}throw new Oa(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Sa.fromString(Qs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?oo.build(Qs(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):Qs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ud([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Hi(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const yp=["Unknown","Point","LineString","Polygon"];class So{constructor(e,i,o){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=o}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?yp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:o,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*i-e[0])+this.featureDistanceData.bearing[1]*(c*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Qi.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class ls{constructor(e,i,o,c,m){this.name=e,this.type=i,this._evaluate=o,this.args=c,this._overloadIndex=m}evaluate(e){if(!this._evaluate){const i=ls.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const o=e[0],c=ls.definitions[o];if(!c)return i.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,x=[];let S=null,A=-1;for(const[M,P]of g){if(Array.isArray(M)&&M.length!==e.length-1)continue;x.push(M),A++,S=new Jm(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const k=[];let U=!1;for(let V=1;V<e.length;V++){const q=e[V],J=Array.isArray(M)?M[V-1]:M.type,ee=S.parse(q,1+k.length,J);if(!ee){U=!0;break}k.push(ee)}if(!U)if(Array.isArray(M)&&M.length!==k.length)S.error(`Expected ${M.length} arguments, but found ${k.length} instead.`);else{for(let V=0;V<k.length;V++){const q=Array.isArray(M)?M[V]:M.type,J=k[V];S.concat(V+1).checkSubtype(q,J.type)}if(S.errors.length===0)return new ls(o,m,P,k,A)}}if(x.length===1)i.errors.push(...S.errors);else{const M=(x.length?x:g.map(([k])=>k)).map(fd).join(" | "),P=[];for(let k=1;k<e.length;k++){const U=i.parse(e[k],1+P.length);if(!U)return null;P.push(io(U.type))}i.error(`Expected arguments of type ${M}, but found (${P.join(", ")}) instead.`)}return null}static register(e,i){ls.definitions=i;for(const o in i)e[o]=ls}}function fd(n){return Array.isArray(n)?`(${n.map(io).join(", ")})`:`(${io(n.type)}...)`}class Yd{constructor(e,i,o){this.type=Zd,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return i.error("Collator options argument must be an object.");const c=o["case-sensitive"]===void 0?i.parse(!1,1,qn):i.parseObjectValue(o["case-sensitive"],1,"case-sensitive",qn);if(!c)return null;const m=o["diacritic-sensitive"]===void 0?i.parse(!1,1,qn):i.parseObjectValue(o["diacritic-sensitive"],1,"diacritic-sensitive",qn);if(!m)return null;let g=null;return o.locale&&(g=i.parseObjectValue(o.locale,1,"locale",Dn),!g)?null:new Yd(c,m,g)}evaluate(e){return new Fm(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Cu(n,e,i=0,o=n.length-1,c=Ob){for(;o>i;){if(o-i>600){const S=o-i+1,A=e-i+1,M=Math.log(S),P=.5*Math.exp(2*M/3),k=.5*Math.sqrt(M*P*(S-P)/S)*(A-S/2<0?-1:1);Cu(n,e,Math.max(i,Math.floor(e-A*P/S+k)),Math.min(o,Math.floor(e+(S-A)*P/S+k)),c)}const m=n[e];let g=i,x=o;for(ko(n,i,e),c(n[o],m)>0&&ko(n,i,o);g<x;){for(ko(n,g,x),g++,x--;c(n[g],m)<0;)g++;for(;c(n[x],m)>0;)x--}c(n[i],m)===0?ko(n,i,x):(x++,ko(n,x,o)),x<=e&&(i=x+1),e<=x&&(o=x-1)}}function ko(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function Ob(n,e){return n<e?-1:n>e?1:0}function kb(n){let e=0;for(let i,o,c=0,m=n.length,g=m-1;c<m;g=c++)i=n[c],o=n[g],e+=(o.x-i.x)*(i.y+o.y);return e}function vp(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Au(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Qv(n,e,i){const o=n[0]-e[0],c=n[1]-e[1],m=n[0]-i[0],g=n[1]-i[1];return o*g-m*c==0&&o*m<=0&&c*g<=0}function xl(n,e,i=!1){let o=!1;for(let x=0,S=e.length;x<S;x++){const A=e[x];for(let M=0,P=A.length,k=P-1;M<P;k=M++){const U=A[k],V=A[M];if(Qv(n,U,V))return i;(m=U)[1]>(c=n)[1]!=(g=V)[1]>c[1]&&c[0]<(g[0]-m[0])*(c[1]-m[1])/(g[1]-m[1])+m[0]&&(o=!o)}}var c,m,g;return o}function ex(n,e,i,o){const c=o[0]-i[0],m=o[1]-i[1],g=(n[0]-i[0])*m-c*(n[1]-i[1]),x=(e[0]-i[0])*m-c*(e[1]-i[1]);return g>0&&x<0||g<0&&x>0}function Bm(n,e,i,o){return(c=[o[0]-i[0],o[1]-i[1]])[0]*(m=[e[0]-n[0],e[1]-n[1]])[1]-c[1]*m[0]!=0&&!(!ex(n,e,i,o)||!ex(i,o,n,e));var c,m}function xp(n){const e=new vt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new vt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const o of n[0])e.x>o.x&&(e.x=o.x),e.y>o.y&&(e.y=o.y),i.x<o.x&&(i.x=o.x),i.y<o.y&&(i.y=o.y);return{min:e,max:i}}const fh=8192;function B_(n,e){const i=(180+n[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(i*c*fh),Math.round(o*c*fh)]}function ph(n,e){for(let i=0;i<e.length;i++)if(xl(n,e[i]))return!0;return!1}function Um(n,e,i){for(const o of i)for(let c=0,m=o.length,g=m-1;c<m;g=c++)if(Bm(n,e,o[g],o[c]))return!0;return!1}function Ru(n,e){for(let i=0;i<n.length;++i)if(!xl(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(Um(n[i],n[i+1],e))return!1;return!0}function Kd(n,e){for(let i=0;i<e.length;i++)if(Ru(n,e[i]))return!0;return!1}function U_(n,e,i){const o=[];for(let c=0;c<n.length;c++){const m=[];for(let g=0;g<n[c].length;g++){const x=B_(n[c][g],i);vp(e,x),m.push(x)}o.push(m)}return o}function Vm(n,e,i){const o=[];for(let c=0;c<n.length;c++){const m=U_(n[c],e,i);o.push(m)}return o}function V_(n,e,i,o){if(n[0]<i[0]||n[0]>i[2]){const c=.5*o;let m=n[0]-i[0]>c?-o:i[0]-n[0]>c?o:0;m===0&&(m=n[0]-i[2]>c?-o:i[2]-n[0]>c?o:0),n[0]+=m}vp(e,n)}function j_(n,e,i,o){const c=Math.pow(2,o.z)*fh,m=[o.x*fh,o.y*fh],g=[];if(!n)return g;for(const x of n)for(const S of x){const A=[S.x+m[0],S.y+m[1]];V_(A,e,i,c),g.push(A)}return g}function Fl(n,e,i,o){const c=Math.pow(2,o.z)*fh,m=[o.x*fh,o.y*fh],g=[];if(!n)return g;for(const S of n){const A=[];for(const M of S){const P=[M.x+m[0],M.y+m[1]];vp(e,P),A.push(P)}g.push(A)}if(e[2]-e[0]<=c/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const S of g)for(const A of S)V_(A,e,i,c)}var x;return g}class mh{constructor(e,i){this.type=qn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Su(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let c=0;c<o.features.length;++c){const m=o.features[c].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new mh(o,o.features[c].geometry)}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new mh(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new mh(o,o)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(o.type==="Polygon"){const x=U_(o.coordinates,m,g),S=j_(i.geometry(),c,m,g);if(!Au(c,m))return!1;for(const A of S)if(!xl(A,x))return!1}if(o.type==="MultiPolygon"){const x=Vm(o.coordinates,m,g),S=j_(i.geometry(),c,m,g);if(!Au(c,m))return!1;for(const A of S)if(!ph(A,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(o.type==="Polygon"){const x=U_(o.coordinates,m,g),S=Fl(i.geometry(),c,m,g);if(!Au(c,m))return!1;for(const A of S)if(!Ru(A,x))return!1}if(o.type==="MultiPolygon"){const x=Vm(o.coordinates,m,g),S=Fl(i.geometry(),c,m,g);if(!Au(c,m))return!1;for(const A of S)if(!Kd(A,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const bp={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},jm=1/298.257223563,cs=jm*(2-jm),pd=Math.PI/180;class Jd{static fromTile(e,i,o){const c=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),m=Math.atan(.5*(Math.exp(c)-Math.exp(-c)))/pd;return new Jd(m,o)}static get units(){return bp}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!bp[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(bp).join(", ")}`);const o=6378.137*pd*(i?bp[i]:1),c=Math.cos(e*pd),m=1/(1-cs*(1-c*c)),g=Math.sqrt(m);this.kx=o*g*c,this.ky=o*g*m*(1-cs)}distance(e,i){const o=bl(e[0]-i[0])*this.kx,c=(e[1]-i[1])*this.ky;return Math.sqrt(o*o+c*c)}bearing(e,i){const o=bl(i[0]-e[0])*this.kx;return Math.atan2(o,(i[1]-e[1])*this.ky)/pd}destination(e,i,o){const c=o*pd;return this.offset(e,Math.sin(c)*i,Math.cos(c)*i)}offset(e,i,o){return[e[0]+i/this.kx,e[1]+o/this.ky]}lineDistance(e){let i=0;for(let o=0;o<e.length-1;o++)i+=this.distance(e[o],e[o+1]);return i}area(e){let i=0;for(let o=0;o<e.length;o++){const c=e[o];for(let m=0,g=c.length,x=g-1;m<g;x=m++)i+=bl(c[m][0]-c[x][0])*(c[m][1]+c[x][1])*(o?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let o=0;if(i<=0)return e[0];for(let c=0;c<e.length-1;c++){const m=e[c],g=e[c+1],x=this.distance(m,g);if(o+=x,o>i)return Gm(m,g,(i-(o-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,i,o){let[c,m]=i,g=bl(o[0]-c)*this.kx,x=(o[1]-m)*this.ky;if(g!==0||x!==0){const S=(bl(e[0]-c)*this.kx*g+(e[1]-m)*this.ky*x)/(g*g+x*x);S>1?(c=o[0],m=o[1]):S>0&&(c+=g/this.kx*S,m+=x/this.ky*S)}return g=bl(e[0]-c)*this.kx,x=(e[1]-m)*this.ky,Math.sqrt(g*g+x*x)}pointOnLine(e,i){let o=1/0,c=e[0][0],m=e[0][1],g=0,x=0;for(let S=0;S<e.length-1;S++){let A=e[S][0],M=e[S][1],P=bl(e[S+1][0]-A)*this.kx,k=(e[S+1][1]-M)*this.ky,U=0;P===0&&k===0||(U=(bl(i[0]-A)*this.kx*P+(i[1]-M)*this.ky*k)/(P*P+k*k),U>1?(A=e[S+1][0],M=e[S+1][1]):U>0&&(A+=P/this.kx*U,M+=k/this.ky*U)),P=bl(i[0]-A)*this.kx,k=(i[1]-M)*this.ky;const V=P*P+k*k;V<o&&(o=V,c=A,m=M,g=S,x=U)}return{point:[c,m],index:g,t:Math.max(0,Math.min(1,x))}}lineSlice(e,i,o){let c=this.pointOnLine(o,e),m=this.pointOnLine(o,i);if(c.index>m.index||c.index===m.index&&c.t>m.t){const A=c;c=m,m=A}const g=[c.point],x=c.index+1,S=m.index;!G_(o[x],g[0])&&x<=S&&g.push(o[x]);for(let A=x+1;A<=S;A++)g.push(o[A]);return G_(o[S],m.point)||g.push(m.point),g}lineSliceAlong(e,i,o){let c=0;const m=[];for(let g=0;g<o.length-1;g++){const x=o[g],S=o[g+1],A=this.distance(x,S);if(c+=A,c>e&&m.length===0&&m.push(Gm(x,S,(e-(c-A))/A)),c>=i)return m.push(Gm(x,S,(i-(c-A))/A)),m;c>e&&m.push(S)}return m}bufferPoint(e,i){const o=i/this.ky,c=i/this.kx;return[e[0]-c,e[1]-o,e[0]+c,e[1]+o]}bufferBBox(e,i){const o=i/this.ky,c=i/this.kx;return[e[0]-c,e[1]-o,e[2]+c,e[3]+o]}insideBBox(e,i){return bl(e[0]-i[0])>=0&&bl(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function G_(n,e){return n[0]===e[0]&&n[1]===e[1]}function Gm(n,e,i){const o=bl(e[0]-n[0]);return[n[0]+o*i,n[1]+(e[1]-n[1])*i]}function bl(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class Hm{constructor(e=[],i=(o,c)=>o<c?-1:o>c?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:o}=this,c=i[e];for(;e>0;){const m=e-1>>1,g=i[m];if(o(c,g)>=0)break;i[e]=g,e=m}i[e]=c}_down(e){const{data:i,compare:o}=this,c=this.length>>1,m=i[e];for(;e<c;){let g=1+(e<<1);const x=g+1;if(x<this.length&&o(i[x],i[g])<0&&(g=x),o(i[g],m)>=0)break;i[e]=i[g],e=g}i[e]=m}}var Lt=8192;function wp(n,e){return e.dist-n.dist}const Lc=100,Qd=50;function Iu(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}function Tp(n){return n[1]-n[0]+1}function zc(n,e){const i=n[1]>=n[0]&&n[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function $m(n,e){if(n[0]>n[1])return[null,null];const i=Tp(n);if(e){if(i===2)return[n,null];const o=Math.floor(i/2);return[[n[0],n[0]+o],[n[0]+o,n[1]]]}{if(i===1)return[n,null];const o=Math.floor(i/2)-1;return[[n[0],n[0]+o],[n[0]+o+1,n[1]]]}}function el(n,e){const i=[1/0,1/0,-1/0,-1/0];if(!zc(e,n.length))return i;for(let o=e[0];o<=e[1];++o)vp(i,n[o]);return i}function vn(n){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;++i)for(let o=0;o<n[i].length;++o)vp(e,n[i][o]);return e}function cc(n,e,i){if(Iu(n)||Iu(e))return NaN;let o=0,c=0;return n[2]<e[0]&&(o=e[0]-n[2]),n[0]>e[2]&&(o=n[0]-e[2]),n[1]>e[3]&&(c=n[1]-e[3]),n[3]<e[1]&&(c=e[1]-n[3]),i.distance([0,0],[o,c])}function ef(n){return 360*n-180}function tx(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Wm(n,e){const i=Math.pow(2,e.z),o=(n.y/Lt+e.y)/i;return[ef((n.x/Lt+e.x)/i),tx(o)]}function ix(n,e){const i=[];for(let o=0;o<n.length;++o)i.push(Wm(n[o],e));return i}function Jr(n,e,i){const o=i.pointOnLine(e,n).point;return i.distance(n,o)}function H_(n,e,i,o,c){const m=i.slice(o[0],o[1]+1);let g=1/0;for(let x=e[0];x<=e[1];++x)if((g=Math.min(g,Jr(n[x],m,c)))===0)return 0;return g}function qm(n,e,i,o,c){const m=Math.min(c.pointToSegmentDistance(n,i,o),c.pointToSegmentDistance(e,i,o)),g=Math.min(c.pointToSegmentDistance(i,n,e),c.pointToSegmentDistance(o,n,e));return Math.min(m,g)}function nx(n,e,i,o,c){if(!zc(e,n.length)||!zc(o,i.length))return NaN;let m=1/0;for(let g=e[0];g<e[1];++g)for(let x=o[0];x<o[1];++x){if(Bm(n[g],n[g+1],i[x],i[x+1]))return 0;m=Math.min(m,qm(n[g],n[g+1],i[x],i[x+1],c))}return m}function $_(n,e,i,o,c){if(!zc(e,n.length)||!zc(o,i.length))return NaN;let m=1/0;for(let g=e[0];g<=e[1];++g)for(let x=o[0];x<=o[1];++x)if((m=Math.min(m,c.distance(n[g],i[x])))===0)return m;return m}function Lb(n,e,i){if(xl(n,e,!0))return 0;let o=1/0;for(const c of e){const m=c.length;if(m<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(c[0]!==c[m-1]&&(o=Math.min(o,i.pointToSegmentDistance(n,c[m-1],c[0])))===0||(o=Math.min(o,Jr(n,c,i)))===0)return o}return o}function rx(n,e,i,o){if(!zc(e,n.length))return NaN;for(let m=e[0];m<=e[1];++m)if(xl(n[m],i,!0))return 0;let c=1/0;for(let m=e[0];m<e[1];++m)for(const g of i)for(let x=0,S=g.length,A=S-1;x<S;A=x++){if(Bm(n[m],n[m+1],g[A],g[x]))return 0;c=Math.min(c,qm(n[m],n[m+1],g[A],g[x],o))}return c}function ax(n,e){for(const i of n)for(let o=0;o<=i.length-1;++o)if(xl(i[o],e,!0))return!0;return!1}function zb(n,e,i,o=1/0){const c=vn(n),m=vn(e);if(o!==1/0&&cc(c,m,i)>=o)return o;if(Au(c,m)){if(ax(n,e))return 0}else if(ax(e,n))return 0;let g=o;for(const x of n)for(let S=0,A=x.length,M=A-1;S<A;M=S++)for(const P of e)for(let k=0,U=P.length,V=U-1;k<U;V=k++){if(Bm(x[M],x[S],P[V],P[k]))return 0;g=Math.min(g,qm(x[M],x[S],P[V],P[k],i))}return g}function Zm(n,e,i,o,c,m,g){if(m===null||g===null)return;const x=cc(el(o,m),el(c,g),i);x<e&&n.push({dist:x,range1:m,range2:g})}function Sp(n,e,i,o,c=1/0){let m=Math.min(o.distance(n[0],i[0][0]),c);if(m===0)return m;const g=new Hm([{dist:0,range1:[0,n.length-1],range2:[0,0]}],wp),x=e?Qd:Lc,S=vn(i);for(;g.length;){const A=g.pop();if(A.dist>=m)continue;const M=A.range1;if(Tp(M)<=x){if(!zc(M,n.length))return NaN;if(e){const P=rx(n,M,i,o);if((m=Math.min(m,P))===0)return m}else for(let P=M[0];P<=M[1];++P){const k=Lb(n[P],i,o);if((m=Math.min(m,k))===0)return m}}else{const P=$m(M,e);if(P[0]!==null){const k=cc(el(n,P[0]),S,o);k<m&&g.push({dist:k,range1:P[0],range2:[0,0]})}if(P[1]!==null){const k=cc(el(n,P[1]),S,o);k<m&&g.push({dist:k,range1:P[1],range2:[0,0]})}}}return m}function Xm(n,e,i,o,c,m=1/0){let g=Math.min(m,c.distance(n[0],i[0]));if(g===0)return g;const x=new Hm([{dist:0,range1:[0,n.length-1],range2:[0,i.length-1]}],wp),S=e?Qd:Lc,A=o?Qd:Lc;for(;x.length;){const M=x.pop();if(M.dist>=g)continue;const P=M.range1,k=M.range2;if(Tp(P)<=S&&Tp(k)<=A){if(!zc(P,n.length)||!zc(k,i.length))return NaN;if(e&&o?g=Math.min(g,nx(n,P,i,k,c)):e||o?e&&!o?g=Math.min(g,H_(i,k,n,P,c)):!e&&o&&(g=Math.min(g,H_(n,P,i,k,c))):g=Math.min(g,$_(n,P,i,k,c)),g===0)return g}else{const U=$m(P,e),V=$m(k,o);Zm(x,g,c,n,i,U[0],V[0]),Zm(x,g,c,n,i,U[0],V[1]),Zm(x,g,c,n,i,U[1],V[0]),Zm(x,g,c,n,i,U[1],V[1])}}return g}function md(n,e,i,o,c=1/0){let m=c;const g=el(n,[0,n.length-1]);for(const x of i)if(!(m!==1/0&&cc(g,el(x,[0,x.length-1]),o)>=m)&&(m=Math.min(m,Xm(n,e,x,!0,o,m)),m===0))return m;return m}function Ep(n,e,i,o,c=1/0){let m=c;const g=el(n,[0,n.length-1]);for(const x of i){if(m!==1/0&&cc(g,vn(x),o)>=m)continue;const S=Sp(n,e,x,o,m);if(isNaN(S))return S;if((m=Math.min(m,S))===0)return m}return m}function Ym(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class Du{constructor(e,i){this.type=bi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Su(e[1])){const o=e[1];if(o.type==="FeatureCollection"){for(let c=0;c<o.features.length;++c)if(Ym(o.features[c].geometry.type))return new Du(o,o.features[c].geometry)}else if(o.type==="Feature"){if(Ym(o.geometry.type))return new Du(o,o.geometry)}else if(Ym(o.type))return new Du(o,o)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),o=e.canonicalID();if(i!=null&&o!=null){if(e.geometryType()==="Point")return function(c,m,g){const x=[];for(const A of c)for(const M of A)x.push(Wm(M,m));const S=new Jd(x[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?Xm(x,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",S):g.type==="MultiLineString"?md(x,!1,g.coordinates,S):g.type==="Polygon"||g.type==="MultiPolygon"?Ep(x,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,S):null}(i,o,this.geometries);if(e.geometryType()==="LineString")return function(c,m,g){const x=[];for(const A of c){const M=[];for(const P of A)M.push(Wm(P,m));x.push(M)}const S=new Jd(x[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return md(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",x,S);if(g.type==="MultiLineString"){let A=1/0;for(let M=0;M<g.coordinates.length;M++){const P=md(g.coordinates[M],!0,x,S,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}if(g.type==="Polygon"||g.type==="MultiPolygon"){let A=1/0;for(let M=0;M<x.length;M++){const P=Ep(x[M],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,S,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}return null}(i,o,this.geometries);if(e.geometryType()==="Polygon")return function(c,m,g){const x=[];for(const A of function(M,P){const k=M.length;if(k<=1)return[M];const U=[];let V,q;for(let J=0;J<k;J++){const ee=kb(M[J]);ee!==0&&(M[J].area=Math.abs(ee),q===void 0&&(q=ee<0),q===ee<0?(V&&U.push(V),V=[M[J]]):V.push(M[J]))}return V&&U.push(V),U}(c)){const M=[];for(let P=0;P<A.length;++P)M.push(ix(A[P],m));x.push(M)}const S=new Jd(x[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Ep(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",x,S);if(g.type==="MultiLineString"){let A=1/0;for(let M=0;M<g.coordinates.length;M++){const P=Ep(g.coordinates[M],!0,x,S,A);if(isNaN(P))return P;if((A=Math.min(A,P))===0)return A}return A}return g.type==="Polygon"||g.type==="MultiPolygon"?function(A,M,P){let k=1/0;for(const U of A)for(const V of M){const q=zb(U,V,P,k);if(isNaN(q))return q;if((k=Math.min(k,q))===0)return k}return k}(g.type==="Polygon"?[g.coordinates]:g.coordinates,x,S):null}(i,o,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function tf(n){if(n instanceof ls&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof mh||n instanceof Du)return!1;if(n instanceof gh)return n.featureConstant;let e=!0;return n.eachChild(i=>{e&&!tf(i)&&(e=!1)}),e}function Fc(n){if(n instanceof ls&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!Fc(i)&&(e=!1)}),e}function Mu(n,e){if(n instanceof ls&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(o=>{i&&!Mu(o,e)&&(i=!1)}),i}function Cp(n,e,i){return[n,e,i].filter(Boolean).join("")}function Ap(n,e){switch(n){case"string":return Qs(e);case"number":return+e;case"boolean":return!!e;case"color":return Qi.parse(e);case"formatted":return Sa.fromString(Qs(e));case"resolvedImage":return oo.build(Qs(e))}return e}function ox(n,e,i,o){return o!==void 0&&(n=o*Math.round(n/o)),e!==void 0&&n<e&&(n=e),i!==void 0&&n>i&&(n=i),n}class gh{constructor(e,i,o,c=!1){this.type=e,this.key=i,this.scope=o,this.featureConstant=c}static parse(e,i){let o=i.expectedType;if(o==null&&(o=cr),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const c=i.parse(e[1],1);if(!(c instanceof Eu))return i.error("Key name of 'config' expression must be a string literal.");let m,g=!0;const x=Qs(c.value);if(e.length>=3){const S=i.parse(e[2],2);if(!(S instanceof Eu))return i.error("Scope of 'config' expression must be a string literal.");m=Qs(S.value)}if(i.options){const S=Cp(x,m,i._scope),A=i.options.get(S);A&&(g=tf(A.value||A.default))}return new gh(o,x,m,g)}evaluate(e){const i=Cp(this.key,this.scope,e.scope),o=e.getConfig(i);if(!o)return null;const{type:c,value:m,values:g,minValue:x,maxValue:S,stepValue:A}=o,M=o.default.evaluate(e);let P=M;if(m){const k=e.scope;e.scope=(k||"").split("").slice(1).join(""),P=m.evaluate(e),e.scope=k}return c&&(P=Ap(c,P)),P===void 0||x===void 0&&S===void 0&&A===void 0||(typeof P=="number"?P=ox(P,x,S,A):Array.isArray(P)&&(P=P.map(k=>typeof k=="number"?ox(k,x,S,A):k))),m!==void 0&&P!==void 0&&g&&!g.includes(P)&&(P=M,c&&(P=Ap(c,P))),(c&&c!==this.type||P!==void 0&&!cd(_o(P),this.type))&&(P=Ap(this.type.kind,P)),P}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Km{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const o=e[1];return i.scope.has(o)?new Km(o,i.scope.get(o)):i.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Jm{constructor(e,i=[],o,c=new ws,m=[],g,x,S){this.registry=e,this.path=i,this.key=i.map(A=>typeof A=="string"?`['${A}']`:`[${A}]`).join(""),this.scope=c,this.errors=m,this.expectedType=o,this._scope=g,this.options=x,this.iconImageUseTheme=S}parse(e,i,o,c,m={}){return i||o?this.concat(i,null,o,c)._parse(e,m):this._parse(e,m)}parseObjectValue(e,i,o,c,m,g={}){return this.concat(i,o,c,m)._parse(e,g)}_parse(e,i){function o(c,m,g){return g==="assert"?new pi(m,[c]):g==="coerce"?new zl(m,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(c){let m=c.parse(e,this);if(!m)return null;if(this.expectedType){const g=this.expectedType,x=m.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||x.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(g,x))return null}else m=o(m,g,i.typeAnnotation||"coerce");else m=o(m,g,i.typeAnnotation||"assert")}if(!(m instanceof Eu)&&m.type.kind!=="resolvedImage"&&W_(m)){const g=new So(this._scope,this.options,this.iconImageUseTheme);try{m=new Eu(m.type,m.evaluate(g))}catch(x){return this.error(x.message),null}}return m}return zl.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,o,c){let m=typeof e=="number"?this.path.concat(e):this.path;m=typeof i=="string"?m.concat(i):m;const g=c?this.scope.concat(c):this.scope;return new Jm(this.registry,m,o||null,g,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const o=`${this.key}${i.map(c=>`[${c}]`).join("")}`;this.errors.push(new Oo(o,e))}checkSubtype(e,i){const o=ld(e,i);return o&&this.error(o),o}}function W_(n){if(n instanceof Km)return W_(n.boundExpression);if(n instanceof ls&&n.name==="error"||n instanceof Yd||n instanceof mh||n instanceof Du||n instanceof gh)return!1;const e=n instanceof zl||n instanceof pi;let i=!0;return n.eachChild(o=>{i=e?i&&W_(o):i&&o instanceof Eu}),!!i&&tf(n)&&Mu(n,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function nf(n,e){const i=n.length-1;let o,c,m=0,g=i,x=0;for(;m<=g;)if(x=Math.floor((m+g)/2),o=n[x],c=n[x+1],o<=e){if(x===i||e<c)return x;m=x+1}else{if(!(o>e))throw new Oa("Input is not a number.");g=x-1}return 0}class Nc{constructor(e,i,o){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[c,m]of o)this.labels.push(c),this.outputs.push(m)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const o=i.parse(e[1],1,bi);if(!o)return null;const c=[];let m=null;i.expectedType&&i.expectedType.kind!=="value"&&(m=i.expectedType);for(let g=1;g<e.length;g+=2){const x=g===1?-1/0:e[g],S=e[g+1],A=g,M=g+1;if(typeof x!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(c.length&&c[c.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const P=i.parse(S,M,m);if(!P)return null;m=m||P.type,c.push([x,P])}return new Nc(m,o,c)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return o[0].evaluate(e);const m=i.length;return c>=i[m-1]?o[m-1].evaluate(e):o[nf(i,c)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const sx=.95047,lx=1.08883,Mn=4/29,uc=6/29,so=3*uc*uc,Qr=uc*uc*uc,_h=Math.PI/180,Rp=180/Math.PI;function Qm(n){return n>Qr?Math.pow(n,1/3):n/so+Mn}function Hr(n){return n>uc?n*n*n:so*(n-Mn)}function Nl(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Bc(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function Bl(n){const e=Bc(n.r),i=Bc(n.g),o=Bc(n.b),c=Qm((.4124564*e+.3575761*i+.1804375*o)/sx),m=Qm((.2126729*e+.7151522*i+.072175*o)/1);return{l:116*m-16,a:500*(c-m),b:200*(m-Qm((.0193339*e+.119192*i+.9503041*o)/lx)),alpha:n.a}}function Uc(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,o=isNaN(n.b)?e:e-n.b/200;return e=1*Hr(e),i=sx*Hr(i),o=lx*Hr(o),new Qi(Nl(3.2404542*i-1.5371385*e-.4985314*o),Nl(-.969266*i+1.8760108*e+.041556*o),Nl(.0556434*i-.2040259*e+1.0572252*o),n.alpha)}function Vc(n,e,i){const o=e-n;return n+i*(o>180||o<-180?o-360*Math.round(o/360):o)}const hc={forward:Bl,reverse:Uc,interpolate:function(n,e,i){return{l:wi(n.l,e.l,i),a:wi(n.a,e.a,i),b:wi(n.b,e.b,i),alpha:wi(n.alpha,e.alpha,i)}}},Pu={forward:function(n){const{l:e,a:i,b:o}=Bl(n),c=Math.atan2(o,i)*Rp;return{h:c<0?c+360:c,c:Math.sqrt(i*i+o*o),l:e,alpha:n.a}},reverse:function(n){const e=n.h*_h,i=n.c;return Uc({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:Vc(n.h,e.h,i),c:wi(n.c,e.c,i),l:wi(n.l,e.l,i),alpha:wi(n.alpha,e.alpha,i)}}};var eg=Object.freeze({__proto__:null,hcl:Pu,lab:hc});class Ts{constructor(e,i,o,c,m){this.type=e,this.operator=i,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[g,x]of m)this.labels.push(g),this.outputs.push(x)}static interpolationFactor(e,i,o,c){let m=0;if(e.name==="exponential")m=us(i,e.base,o,c);else if(e.name==="linear")m=us(i,1,o,c);else if(e.name==="cubic-bezier"){const g=e.controlPoints;m=new Ks(g[0],g[1],g[2],g[3]).solve(us(i,1,o,c))}return m}static parse(e,i){let[o,c,m,...g]=e;if(!Array.isArray(c)||c.length===0)return i.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const A=c[1];if(typeof A!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:A}}else{if(c[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const A=c.slice(1);if(A.length!==4||A.some(M=>typeof M!="number"||M<0||M>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(m=i.parse(m,2,bi),!m)return null;const x=[];let S=null;o==="interpolate-hcl"||o==="interpolate-lab"?S=ks:i.expectedType&&i.expectedType.kind!=="value"&&(S=i.expectedType);for(let A=0;A<g.length;A+=2){const M=g[A],P=g[A+1],k=A+3,U=A+4;if(typeof M!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(x.length&&x[x.length-1][0]>=M)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const V=i.parse(P,U,S);if(!V)return null;S=S||V.type,x.push([M,V])}return S.kind==="number"||S.kind==="color"||S.kind==="array"&&S.itemType.kind==="number"&&typeof S.N=="number"?new Ts(S,o,c,m,x):i.error(`Type ${io(S)} is not interpolatable.`)}evaluate(e){const i=this.labels,o=this.outputs;if(i.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=i[0])return o[0].evaluate(e);const m=i.length;if(c>=i[m-1])return o[m-1].evaluate(e);const g=nf(i,c),x=Ts.interpolationFactor(this.interpolation,c,i[g],i[g+1]),S=o[g].evaluate(e),A=o[g+1].evaluate(e);return this.operator==="interpolate"?vl[this.type.kind.toLowerCase()](S,A,x):this.operator==="interpolate-hcl"?Pu.reverse(Pu.interpolate(Pu.forward(S),Pu.forward(A),x)):hc.reverse(hc.interpolate(hc.forward(S),hc.forward(A),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)i.push(this.labels[o],this.outputs[o].serialize());return i}}function us(n,e,i,o){const c=o-i,m=n-i;return c===0?0:e===1?m/c:(Math.pow(e,m)-1)/(Math.pow(e,c)-1)}class gd{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let o=null;const c=i.expectedType;c&&c.kind!=="value"&&(o=c);const m=[];for(const x of e.slice(1)){const S=i.parse(x,1+m.length,o,void 0,{typeAnnotation:"omit"});if(!S)return null;o=o||S.type,m.push(S)}const g=c&&m.some(x=>ld(c,x.type));return new gd(g?cr:o,m)}evaluate(e){let i,o=null,c=0;for(const m of this.args){if(c++,o=m.evaluate(e),o&&o instanceof oo&&!o.available&&(i||(i=o),o=null,c===this.args.length))return i;if(o!==null)break}return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class rf{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let m=1;m<e.length-1;m+=2){const g=e[m];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=i.parse(e[m+1],m+1);if(!x)return null;o.push([g,x])}const c=i.parse(e[e.length-1],e.length-1,i.expectedType,o);return c?new rf(o,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,o]of this.bindings)e.push(i,o.serialize());return e.push(this.result.serialize()),e}}class Ip{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,bi),c=i.parse(e[2],2,Ma(i.expectedType||cr));return o&&c?new Ip(c.type.itemType,o,c):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Oa("Array index out of bounds: negative index");if(i>=o.length)throw new Oa("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new Oa("Array index must be an integer. Use at-interpolated for fractional indices");return o[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ou{constructor(e,i,o){this.type=e,this.index=i,this.input=o}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,bi),c=i.parse(e[2],2,Ma(i.expectedType||cr));return o&&c?new Ou(c.type.itemType,o,c):null}evaluate(e){const i=this.index.evaluate(e),o=this.input.evaluate(e);if(i<0)throw new Oa(`Array index out of bounds: ${i} < 0.`);if(i>o.length-1)throw new Oa(`Array index out of bounds: ${i} > ${o.length-1}.`);if(i===Math.floor(i))return o[i];const c=Math.floor(i),m=Math.ceil(i),g=o[c],x=o[m];if(typeof g!="number"||typeof x!="number")throw new Oa(`Cannot interpolate between non-number values at index ${i}.`);const S=i-c;return g*(1-S)+x*S}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Dp{constructor(e,i){this.type=qn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,cr),c=i.parse(e[2],2,cr);return o&&c?pp(o.type,[qn,Dn,bi,kc,cr])?new Dp(o,c):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${io(o.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(o==null)return!1;if(!mp(i,["boolean","string","number","null"]))throw new Oa(`Expected first argument to be of type boolean, string, number or null, but found ${io(_o(i))} instead.`);if(!mp(o,["string","array"]))throw new Oa(`Expected second argument to be of type array or string, but found ${io(_o(o))} instead.`);return o.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Ul{constructor(e,i,o){this.type=bi,this.needle=e,this.haystack=i,this.fromIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,cr),c=i.parse(e[2],2,cr);if(!o||!c)return null;if(!pp(o.type,[qn,Dn,bi,kc,cr]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${io(o.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,bi);return m?new Ul(o,c,m):null}return new Ul(o,c)}evaluate(e){const i=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!mp(i,["boolean","string","number","null"]))throw new Oa(`Expected first argument to be of type boolean, string, number or null, but found ${io(_o(i))} instead.`);if(!mp(o,["string","array"]))throw new Oa(`Expected second argument to be of type array or string, but found ${io(_o(o))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return o.indexOf(i,c)}return o.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class af{constructor(e,i,o,c,m,g){this.inputType=e,this.type=i,this.input=o,this.cases=c,this.outputs=m,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let o,c;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);const m={},g=[];for(let A=2;A<e.length-1;A+=2){let M=e[A];const P=e[A+1];Array.isArray(M)||(M=[M]);const k=i.concat(A);if(M.length===0)return k.error("Expected at least one branch label.");for(const V of M){if(typeof V!="number"&&typeof V!="string")return k.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return k.error("Numeric branch labels must be integer values.");if(o){if(k.checkSubtype(o,_o(V)))return null}else o=_o(V);if(m[String(V)]!==void 0)return k.error("Branch labels must be unique.");m[String(V)]=g.length}const U=i.parse(P,A,c);if(!U)return null;c=c||U.type,g.push(U)}const x=i.parse(e[1],1,cr);if(!x)return null;const S=i.parse(e[e.length-1],e.length-1,c);return S?x.type.kind!=="value"&&i.concat(1).checkSubtype(o,x.type)?null:new af(o,c,x,m,g,S):null}evaluate(e){const i=this.input.evaluate(e);return(cd(_o(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),o=[],c={};for(const g of i){const x=c[this.cases[g]];x===void 0?(c[this.cases[g]]=o.length,o.push([this.cases[g],[g]])):o[x][1].push(g)}const m=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,x]of o)e.push(x.length===1?m(x[0]):x.map(m)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}class yh{constructor(e,i,o){this.type=e,this.branches=i,this.otherwise=o}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let o;i.expectedType&&i.expectedType.kind!=="value"&&(o=i.expectedType);const c=[];for(let g=1;g<e.length-1;g+=2){const x=i.parse(e[g],g,qn);if(!x)return null;const S=i.parse(e[g+1],g+1,o);if(!S)return null;c.push([x,S]),o=o||S.type}const m=i.parse(e[e.length-1],e.length-1,o);return m?new yh(o,c,m):null}evaluate(e){for(const[i,o]of this.branches)if(i.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,o]of this.branches)e(i),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class of{constructor(e,i,o,c){this.type=e,this.input=i,this.beginIndex=o,this.endIndex=c}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,cr),c=i.parse(e[2],2,bi);if(!o||!c)return null;if(!pp(o.type,[Ma(cr),Dn,cr]))return i.error(`Expected first argument to be of type array or string, but found ${io(o.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,bi);return m?new of(o.type,o,c,m):null}return new of(o.type,o,c)}evaluate(e){const i=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!mp(i,["string","array"]))throw new Oa(`Expected first argument to be of type array or string, but found ${io(_o(i))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return i.slice(o,c)}return i.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class vh{constructor(e,i){this.type=Ma(Dn),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=i.parse(e[1],1,Dn),c=i.parse(e[2],2,Dn);return o&&c?new vh(o,c):void 0}evaluate(e){const i=this.str.evaluate(e),o=this.delimiter.evaluate(e);return i.split(o)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function _d(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function jc(n,e,i,o){return o.compare(e,i)===0}function sf(n,e,i){const o=n!=="=="&&n!=="!=";return class wk{constructor(m,g,x){this.type=qn,this.lhs=m,this.rhs=g,this.collator=x,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const x=m[0];let S=g.parse(m[1],1,cr);if(!S)return null;if(!_d(x,S.type))return g.concat(1).error(`"${x}" comparisons are not supported for type '${io(S.type)}'.`);let A=g.parse(m[2],2,cr);if(!A)return null;if(!_d(x,A.type))return g.concat(2).error(`"${x}" comparisons are not supported for type '${io(A.type)}'.`);if(S.type.kind!==A.type.kind&&S.type.kind!=="value"&&A.type.kind!=="value")return g.error(`Cannot compare types '${io(S.type)}' and '${io(A.type)}'.`);o&&(S.type.kind==="value"&&A.type.kind!=="value"?S=new pi(A.type,[S]):S.type.kind!=="value"&&A.type.kind==="value"&&(A=new pi(S.type,[A])));let M=null;if(m.length===4){if(S.type.kind!=="string"&&A.type.kind!=="string"&&S.type.kind!=="value"&&A.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(M=g.parse(m[3],3,Zd),!M)return null}return new wk(S,A,M)}evaluate(m){const g=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(o&&this.hasUntypedArgument){const S=_o(g),A=_o(x);if(S.kind!==A.kind||S.kind!=="string"&&S.kind!=="number")throw new Oa(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${S.kind}, ${A.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const S=_o(g),A=_o(x);if(S.kind!=="string"||A.kind!=="string")return e(m,g,x)}return this.collator?i(m,g,x,this.collator.evaluate(m)):e(m,g,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[n];return this.eachChild(g=>{m.push(g.serialize())}),m}}}const xh=sf("==",function(n,e,i){return e===i},jc),q_=sf("!=",function(n,e,i){return e!==i},function(n,e,i,o){return!jc(0,e,i,o)}),cx=sf("<",function(n,e,i){return e<i},function(n,e,i,o){return o.compare(e,i)<0}),Fb=sf(">",function(n,e,i){return e>i},function(n,e,i,o){return o.compare(e,i)>0}),Nb=sf("<=",function(n,e,i){return e<=i},function(n,e,i,o){return o.compare(e,i)<=0}),Mp=sf(">=",function(n,e,i){return e>=i},function(n,e,i,o){return o.compare(e,i)>=0});class tg{constructor(e,i,o,c,m,g){this.type=Dn,this.number=e,this.locale=i,this.currency=o,this.unit=c,this.minFractionDigits=m,this.maxFractionDigits=g}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const o=i.parse(e[1],1,bi);if(!o)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return i.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=i.parseObjectValue(c.locale,2,"locale",Dn),!m))return null;let g=null;if(c.currency&&(g=i.parseObjectValue(c.currency,2,"currency",Dn),!g))return null;let x=null;if(c.unit&&(x=i.parseObjectValue(c.unit,2,"unit",Dn),!x))return null;let S=null;if(c["min-fraction-digits"]&&(S=i.parseObjectValue(c["min-fraction-digits"],2,"min-fraction-digits",bi),!S))return null;let A=null;return c["max-fraction-digits"]&&(A=i.parseObjectValue(c["max-fraction-digits"],2,"max-fraction-digits",bi),!A)?null:new tg(o,m,g,x,S,A)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ig{constructor(e){this.type=bi,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=i.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${io(o.type)} instead.`):new ig(o):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Oa(`Expected value to be of type string or array, but found ${io(_o(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function Z_(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const lf={"==":xh,"!=":q_,">":Fb,"<":cx,">=":Mp,"<=":Nb,array:pi,at:Ip,"at-interpolated":Ou,boolean:pi,case:yh,coalesce:gd,collator:Yd,format:ud,image:Hi,in:Dp,"index-of":Ul,interpolate:Ts,"interpolate-hcl":Ts,"interpolate-lab":Ts,length:ig,let:rf,literal:Eu,match:af,number:pi,"number-format":tg,object:pi,slice:of,step:Nc,string:pi,"to-boolean":zl,"to-color":zl,"to-number":zl,"to-string":zl,var:Km,within:mh,distance:Du,config:gh,split:vh};function ng(n,[e,i,o,c]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const m=c?c.evaluate(n):1,g=Xd(e,i,o,m);if(g)throw new Oa(g);return new Qi(e/255,i/255,o/255,m)}function X_(n,[e,i,o,c]){e=e.evaluate(n),i=i.evaluate(n),o=o.evaluate(n);const m=c?c.evaluate(n):1,g=function(A,M,P,k){return typeof A=="number"&&A>=0&&A<=360?typeof M=="number"&&M>=0&&M<=100&&typeof P=="number"&&P>=0&&P<=100?k===void 0||typeof k=="number"&&k>=0&&k<=1?null:`Invalid hsla value [${[A,M,P,k].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof k=="number"?[A,M,P,k]:[A,M,P]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof k=="number"?[A,M,P,k]:[A,M,P]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,o,m);if(g)throw new Oa(g);const x=`hsla(${e}, ${i}%, ${o}%, ${m})`,S=Qi.parse(x);if(!S)throw new Oa(`Failed to parse HSLA color: ${x}`);return S}function ux(n,e){return n in e}function rg(n,e){const i=e[n];return i===void 0?null:i}function ku(n){return{type:n}}function yo(n){if(n instanceof gh)return new Set([n.key]);let e=new Set;return n.eachChild(i=>{e=new Set([...e,...yo(i)])}),e}function ag(n){if(n instanceof ls&&n.name==="is-active-floor")return!0;let e=!1;return n.eachChild(i=>{!e&&ag(i)&&(e=!0)}),e}function Gc(n){return{result:"success",value:n}}function Hc(n){return{result:"error",value:n}}function Lu(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function og(n){return n["property-type"]==="data-driven"}function Pp(n){return Lu(n.expression,"measure-light")}function Y_(n){return Lu(n.expression,"zoom")}function sg(n){return!!n.expression&&n.expression.interpolated}function zu(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Qo(n){return n}function qi(n,e){const i=e.type==="color",o=n.stops&&typeof n.stops[0][0]=="object",c=o||!(o||n.property!==void 0),m=n.type||(sg(e)?"exponential":"interval");if(i&&((n=Object.assign({},n)).stops&&(n.stops=n.stops.map(A=>[A[0],Qi.parse(A[1])])),n.default=Qi.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!eg[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let g,x,S;if(m==="exponential")g=hx;else if(m==="interval")g=bh;else if(m==="categorical"){g=dc,x=Object.create(null);for(const A of n.stops)x[A[0]]=A[1];S=typeof n.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);g=Bb}if(o){const A={},M=[];for(let U=0;U<n.stops.length;U++){const V=n.stops[U],q=V[0].zoom;A[q]===void 0&&(A[q]={zoom:q,type:n.type,property:n.property,default:n.default,stops:[]},M.push(q)),A[q].stops.push([V[0].value,V[1]])}const P=[];for(const U of M)P.push([A[U].zoom,qi(A[U],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:Ts.interpolationFactor.bind(void 0,k),zoomStops:P.map(U=>U[0]),evaluate:({zoom:U},V)=>hx({stops:P,base:n.base},e,U).evaluate(U,V)}}if(c){const A=m==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Ts.interpolationFactor.bind(void 0,A),zoomStops:n.stops.map(M=>M[0]),evaluate:({zoom:M})=>g(n,e,M,x,S)}}return{kind:"source",evaluate(A,M){const P=M&&M.properties?M.properties[n.property]:void 0;return P===void 0?Ls(n.default,e.default):g(n,e,P,x,S)}}}function Ls(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function dc(n,e,i,o,c){return Ls(typeof i===c?o[i]:void 0,n.default,e.default)}function bh(n,e,i){if(!gp(i))return Ls(n.default,e.default);const o=n.stops.length;if(o===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[o-1][0])return n.stops[o-1][1];const c=nf(n.stops.map(m=>m[0]),i);return n.stops[c][1]}function hx(n,e,i){const o=n.base!==void 0?n.base:1;if(!gp(i))return Ls(n.default,e.default);const c=n.stops.length;if(c===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[c-1][0])return n.stops[c-1][1];const m=nf(n.stops.map(M=>M[0]),i),g=function(M,P,k,U){const V=U-k,q=M-k;return V===0?0:P===1?q/V:(Math.pow(P,q)-1)/(Math.pow(P,V)-1)}(i,o,n.stops[m][0],n.stops[m+1][0]),x=n.stops[m][1],S=n.stops[m+1][1];let A=vl[e.type]||Qo;if(n.colorSpace&&n.colorSpace!=="rgb"){const M=eg[n.colorSpace];A=(P,k)=>M.reverse(M.interpolate(M.forward(P),M.forward(k),g))}return typeof x.evaluate=="function"?{evaluate(...M){const P=x.evaluate.apply(void 0,M),k=S.evaluate.apply(void 0,M);if(P!==void 0&&k!==void 0)return A(P,k,g)}}:A(x,S,g)}function Bb(n,e,i){return e.type==="color"?i=Qi.parse(i):e.type==="formatted"?i=Sa.fromString(i.toString()):e.type==="resolvedImage"?i=oo.build(i.toString()):hd(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Ls(i,n.default,e.default)}ls.register(lf,{error:[{kind:"error"},[Dn],(n,[e])=>{throw new Oa(e.evaluate(n))}],typeof:[Dn,[cr],(n,[e])=>io(_o(e.evaluate(n)))],"to-rgba":[Ma(bi,4),[ks],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ma(bi,4),[ks],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[ks,[bi,bi,bi],ng],rgba:[ks,[bi,bi,bi,bi],ng],hsl:[ks,[bi,bi,bi],X_],hsla:[ks,[bi,bi,bi,bi],X_],has:{type:qn,overloads:[[[Dn],(n,[e])=>ux(e.evaluate(n),n.properties())],[[Dn,hh],(n,[e,i])=>ux(e.evaluate(n),i.evaluate(n))]]},get:{type:cr,overloads:[[[Dn],(n,[e])=>rg(e.evaluate(n),n.properties())],[[Dn,hh],(n,[e,i])=>rg(e.evaluate(n),i.evaluate(n))]]},"feature-state":[cr,[Dn],(n,[e])=>rg(e.evaluate(n),n.featureState||{})],properties:[hh,[],n=>n.properties()],"geometry-type":[Dn,[],n=>n.geometryType()],worldview:[Dn,[],n=>n.globals.worldview||""],"is-active-floor":[qn,ku(Dn),(n,e)=>{if(!(n.globals.activeFloors&&n.globals.activeFloors.size>0))return!1;const i=n.globals.activeFloors;return e.some(o=>{const c=o.evaluate(n);return i.has(c)})}],id:[cr,[],n=>n.id()],zoom:[bi,[],n=>n.globals.zoom],pitch:[bi,[],n=>n.globals.pitch||0],"distance-from-center":[bi,[],n=>n.distanceFromCenter()],"measure-light":[bi,[Dn],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[bi,[],n=>n.globals.heatmapDensity||0],"line-progress":[bi,[],n=>n.globals.lineProgress||0],"raster-value":[bi,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[bi,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[bi,[],n=>n.globals.skyRadialProgress||0],accumulated:[cr,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[bi,ku(bi),(n,e)=>{let i=0;for(const o of e)i+=o.evaluate(n);return i}],"*":[bi,ku(bi),(n,e)=>{let i=1;for(const o of e)i*=o.evaluate(n);return i}],"-":{type:bi,overloads:[[[bi,bi],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[bi],(n,[e])=>-e.evaluate(n)]]},"/":[bi,[bi,bi],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[bi,[bi,bi],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[bi,[],()=>Math.LN2],pi:[bi,[],()=>Math.PI],e:[bi,[],()=>Math.E],"^":[bi,[bi,bi],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[bi,[bi],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[bi,[bi],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[bi,[bi],(n,[e])=>Math.log(e.evaluate(n))],log2:[bi,[bi],(n,[e])=>Math.log2(e.evaluate(n))],sin:[bi,[bi],(n,[e])=>Math.sin(e.evaluate(n))],cos:[bi,[bi],(n,[e])=>Math.cos(e.evaluate(n))],tan:[bi,[bi],(n,[e])=>Math.tan(e.evaluate(n))],asin:[bi,[bi],(n,[e])=>Math.asin(e.evaluate(n))],acos:[bi,[bi],(n,[e])=>Math.acos(e.evaluate(n))],atan:[bi,[bi],(n,[e])=>Math.atan(e.evaluate(n))],min:[bi,ku(bi),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[bi,ku(bi),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[bi,[bi],(n,[e])=>Math.abs(e.evaluate(n))],round:[bi,[bi],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[bi,[bi],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[bi,[bi],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[qn,[Dn,cr],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[qn,[cr],(n,[e])=>n.id()===e.value],"filter-type-==":[qn,[Dn],(n,[e])=>n.geometryType()===e.value],"filter-<":[qn,[Dn,cr],(n,[e,i])=>{const o=n.properties()[e.value],c=i.value;return typeof o==typeof c&&o<c}],"filter-id-<":[qn,[cr],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<o}],"filter->":[qn,[Dn,cr],(n,[e,i])=>{const o=n.properties()[e.value],c=i.value;return typeof o==typeof c&&o>c}],"filter-id->":[qn,[cr],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>o}],"filter-<=":[qn,[Dn,cr],(n,[e,i])=>{const o=n.properties()[e.value],c=i.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[qn,[cr],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i<=o}],"filter->=":[qn,[Dn,cr],(n,[e,i])=>{const o=n.properties()[e.value],c=i.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[qn,[cr],(n,[e])=>{const i=n.id(),o=e.value;return typeof i==typeof o&&i>=o}],"filter-has":[qn,[cr],(n,[e])=>e.value in n.properties()],"filter-has-id":[qn,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[qn,[Ma(Dn)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[qn,[Ma(cr)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[qn,[Dn,Ma(cr)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[qn,[Dn,Ma(cr)],(n,[e,i])=>function(o,c,m,g){for(;m<=g;){const x=m+g>>1;if(c[x]===o)return!0;c[x]>o?g=x-1:m=x+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:qn,overloads:[[[qn,qn],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[ku(qn),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:qn,overloads:[[[qn,qn],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[ku(qn),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[qn,[qn],(n,[e])=>!e.evaluate(n)],"is-supported-script":[qn,[Dn],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[Dn,[Dn],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[Dn,[Dn],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[Dn,ku(cr),(n,e)=>e.map(i=>Qs(i.evaluate(n))).join("")],"resolved-locale":[Dn,[Zd],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[bi,[bi,bi,cr],(n,e)=>{const[i,o,c]=e.map(g=>g.evaluate(n));if(i>o||i===o)return i;let m;if(typeof c=="string")m=function(g){let x=0;if(g.length===0)return x;for(let S=0;S<g.length;S++)x=(x<<5)-x+g.charCodeAt(S),x|=0;return x}(c);else{if(typeof c!="number")throw new Oa(`Invalid seed input: ${c}`);m=c}return i+Z_(m)()*(o-i)}]});class lg{constructor(e,i,o,c,m){this.expression=e,this._warningHistory={},this._scope=o,this._options=c,this._iconImageUseTheme=m,this._evaluator=new So(o,c,m),this._defaultValue=i?function(g){return g.type==="color"&&(zu(g.default)||Array.isArray(g.default))?new Qi(0,0,0,0):g.type==="color"?Qi.parse(g.default)||null:g.default===void 0?null:g.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=yo(e),this.isIndoorDependent=ag(e)}evaluateWithoutErrorHandling(e,i,o,c,m,g,x,S){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=o,this._evaluator.canonical=c||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,o,c,m,g,x,S,A){this._evaluator||(this._evaluator=new So(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=S||null,this._evaluator.iconImageUseTheme=A||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Oa(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${M.message}`)),this._defaultValue}}}function cg(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in lf}function Ua(n,e,i,o,c){const m=new Jm(lf,[],e?function(x){const S={color:ks,string:Dn,number:bi,enum:Dn,boolean:qn,formatted:dh,resolvedImage:fp};return x.type==="array"?Ma(S[x.value]||cr,x.length):S[x.type]}(e):void 0,void 0,void 0,i,o,c),g=m.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?Gc(new lg(g,e,i,o,c)):Hc(m.errors)}class Op{constructor(e,i,o,c){this.kind=e,this._styleExpression=i,this.isLightConstant=o,this.isLineProgressConstant=c,this.isStateDependent=e!=="constant"&&!Fc(i.expression),this.configDependencies=yo(i.expression),this.isIndoorDependent=ag(i.expression)}evaluateWithoutErrorHandling(e,i,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,c,m,g)}evaluate(e,i,o,c,m,g,x){return this._styleExpression.evaluate(e,i,o,c,m,g,void 0,void 0,x)}}class wh{constructor(e,i,o,c,m,g){this.kind=e,this.zoomStops=o,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Fc(i.expression),this.isIndoorDependent=ag(i.expression),this.isLightConstant=m,this.isLineProgressConstant=g,this.configDependencies=yo(i.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,i,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,o,c,m,g)}evaluate(e,i,o,c,m,g){return this._styleExpression.evaluate(e,i,o,c,m,g)}interpolationFactor(e,i,o){return this.interpolationType?Ts.interpolationFactor(this.interpolationType,e,i,o):0}}function K_(n,e,i,o,c){if((n=Ua(n,e,i,o,c)).result==="error")return n;const m=n.value.expression,g=tf(m);if(!g&&!og(e))return Hc([new Oo("","data expressions not supported")]);const x=Mu(m,["zoom","pitch","distance-from-center"]);if(!x&&!Y_(e))return Hc([new Oo("","zoom expressions not supported")]);const S=Mu(m,["measure-light"]);if(!S&&!Pp(e))return Hc([new Oo("","measure-light expression not supported")]);const A=Mu(m,["line-progress"]);if(!A&&!function(k){return Lu(k.expression,"line-progress")}(e))return Hc([new Oo("","line-progress expression not supported")]);const M=e.expression&&e.expression.relaxZoomRestriction,P=Th(m);return P||x||M?P instanceof Oo?Hc([P]):P instanceof Ts&&!sg(e)?Hc([new Oo("",'"interpolate" expressions cannot be used with this property')]):Gc(P?new wh(g&&A?"camera":"composite",n.value,P.labels,P instanceof Ts?P.interpolation:void 0,S,A):new Op(g&&A?"constant":"source",n.value,S,A)):Hc([new Oo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class kp{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,qi(this._parameters,this._specification))}static deserialize(e){return new kp(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Th(n){let e=null;if(n instanceof rf)e=Th(n.result);else if(n instanceof gd){for(const i of n.args)if(e=Th(i),e)break}else(n instanceof Nc||n instanceof Ts)&&n.input instanceof ls&&n.input.name==="zoom"&&(e=n);return e instanceof Oo||n.eachChild(i=>{const o=Th(i);o instanceof Oo?e=o:e&&o&&e!==o&&(e=new Oo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var $c,ug,dx=function(){if(ug)return $c;ug=1,$c=e;var n=3;function e(i,o,c){var m=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var g=new Int32Array(this.arrayBuffer);i=g[0],this.d=(o=g[1])+2*(c=g[2]);for(var x=0;x<this.d*this.d;x++){var S=g[n+x],A=g[n+x+1];m.push(S===A?null:g.subarray(S,A))}var M=g[n+m.length+1];this.keys=g.subarray(g[n+m.length],M),this.bboxes=g.subarray(M),this.insert=this._insertReadonly}else{this.d=o+2*c;for(var P=0;P<this.d*this.d;P++)m.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=i,this.padding=c,this.scale=o/i,this.uid=0;var k=c/o*i;this.min=-k,this.max=i+k}return e.prototype.insert=function(i,o,c,m,g){this._forEachCell(o,c,m,g,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(g)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,o,c,m,g,x){this.cells[g].push(x)},e.prototype.query=function(i,o,c,m,g){var x=this.min,S=this.max;if(i<=x&&o<=x&&S<=c&&S<=m&&!g)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(i,o,c,m,this._queryCell,A,{},g),A},e.prototype._queryCell=function(i,o,c,m,g,x,S,A){var M=this.cells[g];if(M!==null)for(var P=this.keys,k=this.bboxes,U=0;U<M.length;U++){var V=M[U];if(S[V]===void 0){var q=4*V;(A?A(k[q+0],k[q+1],k[q+2],k[q+3]):i<=k[q+2]&&o<=k[q+3]&&c>=k[q+0]&&m>=k[q+1])?(S[V]=!0,x.push(P[V])):S[V]=!1}}},e.prototype._forEachCell=function(i,o,c,m,g,x,S,A){for(var M=this._convertToCellCoord(i),P=this._convertToCellCoord(o),k=this._convertToCellCoord(c),U=this._convertToCellCoord(m),V=M;V<=k;V++)for(var q=P;q<=U;q++){var J=this.d*q+V;if((!A||A(this._convertFromCellCoord(V),this._convertFromCellCoord(q),this._convertFromCellCoord(V+1),this._convertFromCellCoord(q+1)))&&g.call(this,i,o,c,m,J,x,S,A))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,o=n+this.cells.length+1+1,c=0,m=0;m<this.cells.length;m++)c+=this.cells[m].length;var g=new Int32Array(o+c+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;for(var x=o,S=0;S<i.length;S++){var A=i[S];g[n+S]=x,g.set(A,x),x+=A.length}return g[n+i.length]=x,g.set(this.keys,x),g[n+i.length+1]=x+=this.keys.length,g.set(this.bboxes,x),x+=this.bboxes.length,g.buffer},$c}(),yd=ml(dx);const cf={};function ai(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),cf[e]={klass:n,omit:i.omit||[]}}ai(Object,"Object"),yd.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.add(i),{buffer:i}},yd.deserialize=function(n){return new yd(n.buffer)},Object.defineProperty(yd,"name",{value:"Grid"}),ai(yd,"Grid"),delete vt.prototype.constructor,typeof DOMMatrix<"u"&&ai(DOMMatrix,"DOMMatrix"),ai(Qi,"Color"),ai(Error,"Error"),ai(Sa,"Formatted"),ai(Jo,"FormattedSection"),ai(rc,"AJAXError"),ai(oo,"ResolvedImage"),ai(kp,"StylePropertyFunction"),ai(lg,"StyleExpression",{omit:["_evaluator"]}),ai(Mi,"ImageId"),ai(Pa,"ImageVariant"),ai(wh,"ZoomDependentExpression"),ai(Op,"ZoomConstantExpression"),ai(ls,"CompoundExpression",{omit:["_evaluate"]});for(const n in lf)cf[lf[n]._classRegistryKey]||ai(lf[n],`Expression${n}`);function J_(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Wc(n){return self.ImageBitmap&&n instanceof ImageBitmap}function Fu(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(J_(n)||Wc(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const o of n)i.push(Fu(o,e));return i}if(n instanceof Map){const i={$name:"Map",entries:[]};for(const[o,c]of n.entries())i.entries.push(Fu(o),Fu(c,e));return i}if(n instanceof Set){const i={$name:"Set"};let o=0;for(const c of n.values())i[++o]=Fu(c);return i}if(n instanceof DOMMatrix){const i={$name:"DOMMatrix"},o=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const c of o)i[c]=n[c];return i}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const i=n.constructor,o=i._classRegistryKey;if(!o)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const c=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const m in n)n.hasOwnProperty(m)&&(cf[o].omit.indexOf(m)>=0||(c[m]=Fu(n[m],e)));n instanceof Error&&(c.message=n.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof n)}function Sh(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||J_(n)||Wc(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(Sh);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const c=n.entries||[],m=new Map;for(let g=0;g<c.length;g+=2)m.set(Sh(c[g]),Sh(c[g+1]));return m}if(e==="Set"){const c=new Set;for(const m of Object.keys(n))m!=="$name"&&c.add(Sh(n[m]));return c}if(e==="DOMMatrix"){let c;return c=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(c)}if(e==="BigInt")return BigInt(n.value);const{klass:i}=cf[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(n);const o=Object.create(i.prototype);for(const c of Object.keys(n))c!=="$name"&&(o[c]=Sh(n[c]));return o}throw new Error("can't deserialize object of type "+typeof n)}const Ri={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function Q_(n){for(const e of n)if(dg(e.charCodeAt(0)))return!0;return!1}function fx(n){for(const e of n)if(!hg(e.charCodeAt(0)))return!1;return!0}function hg(n){return!(Ri.Arabic(n)||Ri["Arabic Supplement"](n)||Ri["Arabic Extended-A"](n)||Ri["Arabic Presentation Forms-A"](n)||Ri["Arabic Presentation Forms-B"](n))}function dg(n){return!(n!==746&&n!==747&&(n<4352||!(Ri["Bopomofo Extended"](n)||Ri.Bopomofo(n)||Ri["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Ri["CJK Compatibility Ideographs"](n)||Ri["CJK Compatibility"](n)||Ri["CJK Radicals Supplement"](n)||Ri["CJK Strokes"](n)||!(!Ri["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Ri["CJK Unified Ideographs Extension A"](n)||Ri["CJK Unified Ideographs"](n)||Ri["Enclosed CJK Letters and Months"](n)||Ri["Hangul Compatibility Jamo"](n)||Ri["Hangul Jamo Extended-A"](n)||Ri["Hangul Jamo Extended-B"](n)||Ri["Hangul Jamo"](n)||Ri["Hangul Syllables"](n)||Ri.Hiragana(n)||Ri["Ideographic Description Characters"](n)||Ri.Kanbun(n)||Ri["Kangxi Radicals"](n)||Ri["Katakana Phonetic Extensions"](n)||Ri.Katakana(n)&&n!==12540||!(!Ri["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Ri["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Ri["Unified Canadian Aboriginal Syllabics"](n)||Ri["Unified Canadian Aboriginal Syllabics Extended"](n)||Ri["Vertical Forms"](n)||Ri["Yijing Hexagram Symbols"](n)||Ri["Yi Syllables"](n)||Ri["Yi Radicals"](n))))}function fg(n){return!(dg(n)||function(e){return!!(Ri["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ri["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ri["Letterlike Symbols"](e)||Ri["Number Forms"](e)||Ri["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ri["Control Pictures"](e)&&e!==9251||Ri["Optical Character Recognition"](e)||Ri["Enclosed Alphanumerics"](e)||Ri["Geometric Shapes"](e)||Ri["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ri["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ri["CJK Symbols and Punctuation"](e)||Ri.Katakana(e)||Ri["Private Use Area"](e)||Ri["CJK Compatibility Forms"](e)||Ri["Small Form Variants"](e)||Ri["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function ey(n){return Ri.Arabic(n)||Ri["Arabic Supplement"](n)||Ri["Arabic Extended-A"](n)||Ri["Arabic Presentation Forms-A"](n)||Ri["Arabic Presentation Forms-B"](n)}function ty(n){return n>=1424&&n<=2303||Ri["Arabic Presentation Forms-A"](n)||Ri["Arabic Presentation Forms-B"](n)}function Ub(n,e){return!(!e&&ty(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Ri.Khmer(n))}function Vb(n){for(const e of n)if(ty(e.charCodeAt(0)))return!0;return!1}const Ss={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Sn=null,Ln=Ss.unavailable,Br=null;const lo=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(Ln=Ss.error),Sn&&Sn(n)};function Vl(){pg.fire(new Ye("pluginStateChange",{pluginStatus:Ln,pluginURL:Br}))}const pg=new mn,iy=function(){return Ln},ny=function(){if(Ln!==Ss.deferred||!Br)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ln=Ss.loading,Vl(),Br&&ac({url:Br},n=>{n?lo(n):(Ln=Ss.loaded,Vl())})},tl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ln===Ss.loaded||tl.applyArabicShaping!=null,isLoading:()=>Ln===Ss.loading,setState(n){Ln=n.pluginStatus,Br=n.pluginURL},isParsing:()=>Ln===Ss.parsing,isParsed:()=>Ln===Ss.parsed,getPluginURL:()=>Br};class Er{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview,this.activeFloors=i.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,o){for(const c of i)if(!Ub(c.charCodeAt(0),o))return!1;return!0}(e,tl.isLoaded())}}class mi{constructor(e,i,o,c,m){this.property=e,this.value=i,this.expression=function(g,x,S,A,M){if(zu(g))return new kp(g,x);if(cg(g)||Array.isArray(g)&&g.length>0){const P=K_(g,x,S,A,M);if(P.result==="error")throw new Error(P.value.map(k=>`${k.key}: ${k.message}`).join(", "));return P.value}{let P=g;return typeof g=="string"&&x.type==="color"&&(P=Qi.parse(g)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>P}}}(i===void 0?e.specification.default:i,e.specification,o,c,m)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,o,c){return this.property.possiblyEvaluate(this,e,i,o,c)}}class co{constructor(e,i,o,c){this.property=e,this.value=new mi(e,void 0,i,o,c)}transitioned(e,i){return new vd(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new vd(this.property,this.value,null,{},0)}}class Zn{constructor(e,i,o,c){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=o,this._iconImageUseTheme=c,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Kt(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new co(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new mi(this._values[e].property,i===null?void 0:Kt(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,i){i&&(this._options=i);const o=this._properties.properties;if(e)for(const c in e){const m=e[c];if(c.endsWith("-transition")){const g=c.slice(0,-11);o[g]&&this.setTransition(g,m)}else o.hasOwnProperty(c)&&this.setValue(c,m)}}getTransition(e){return Kt(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new co(this._values[e].property)),this._values[e].transition=Kt(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o);const c=this.getTransition(i);c!==void 0&&(e[`${i}-transition`]=c)}return e}transitioned(e,i){const o=new hs(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,i._values[c]);return o}untransitioned(){const e=new hs(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class vd{constructor(e,i,o,c,m){const g=c.delay||0,x=c.duration||0;m=m||0,this.property=e,this.value=i,this.begin=m+g,this.end=this.begin+x,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,i,o){const c=e.now||0,m=this.value.possiblyEvaluate(e,i,o),g=this.prior;if(g){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return g.possiblyEvaluate(e,i,o);{const x=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,o),m,vi(x))}}return m}}class hs{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,o){const c=new fc(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(e,i,o);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Nu{constructor(e,i,o,c){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=o,this._iconImageUseTheme=c,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Kt(this._values[e].value)}setValue(e,i){this._values[e]=new mi(this._values[e].property,i===null?void 0:Kt(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const i of Object.keys(this._values)){const o=this.getValue(i);o!==void 0&&(e[i]=o)}return e}possiblyEvaluate(e,i,o,c){const m=new fc(this._properties);for(const g of Object.keys(this._values))m._values[g]=this._values[g].possiblyEvaluate(e,i,o,c);return m}isIndoorDependent(){return this._isIndoorDependent}}class Eo{constructor(e,i,o,c){this.property=e,this.value=i,this.parameters=o,this.iconImageUseTheme=c}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,o,c){return this.property.evaluate(this.value,this.parameters,e,i,o,c,this.iconImageUseTheme)}}class fc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class At{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,o){const c=vl[this.specification.type];return c?c(e,i,o):e}}class Wt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,o,c,m){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Eo(this,{kind:"constant",value:e.expression.evaluate(i,null,{},o,c,void 0,m)},i):new Eo(this,e.expression,i,m)}interpolate(e,i,o){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Eo(this,{kind:"constant",value:void 0},e.parameters);const c=vl[this.specification.type];return c?new Eo(this,{kind:"constant",value:c(e.value.value,i.value.value,o)},e.parameters):e}evaluate(e,i,o,c,m,g,x){return e.kind==="constant"?e.value:e.evaluate(i,o,c,m,g,void 0,x)}}class Eh{constructor(e){this.specification=e}possiblyEvaluate(e,i,o,c){return!!e.expression.evaluate(i,null,{},o,c)}interpolate(){return!1}}class ea{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Er(0,{});for(const o in e){const c=e[o];c.specification.overridable&&this.overridableProperties.push(o);const m=this.defaultPropertyValues[o]=new mi(c,void 0),g=this.defaultTransitionablePropertyValues[o]=new co(c);this.defaultTransitioningPropertyValues[o]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=m.possiblyEvaluate(i)}}}ai(Wt,"DataDrivenProperty"),ai(At,"DataConstantProperty"),ai(Eh,"ColorRampProperty");var We=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Lp(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Ch(n){if(Array.isArray(n))return n.map(Ch);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Ch(n[i]);return e}return Lp(n)}function Ah(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Ah(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function uf(n,e="",i=null,o="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ah(n)||(n=zs(n));const c=n;let m=!0;try{m=function(M){if(!Ih(M))return M;let P=Ch(M);return Rh(P),P=hf(P),P}(c)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(c,null,2)}
        `)}let g=null,x=null;if(o!=="background"&&o!=="sky"&&o!=="slot"){x=We[`filter_${o}`];const M=Ua(m,x,e,i);if(M.result==="error")throw new Error(M.value.map(P=>`${P.key}: ${P.message}`).join(", "));g=(P,k,U)=>M.value.evaluate(P,k,{},U)}let S=null,A=null;if(m!==c){const M=Ua(c,x,e,i);if(M.result==="error")throw new Error(M.value.map(P=>`${P.key}: ${P.message}`).join(", "));S=(P,k,U,V,q)=>M.value.evaluate(P,k,{},U,void 0,void 0,V,q),A=!tf(M.value.expression)}return{filter:g,dynamicFilter:S||void 0,needGeometry:gg(m),needFeature:!!A}}function hf(n){if(!Array.isArray(n))return n;const e=function(i){if(ry.has(i[0])){for(let o=1;o<i.length;o++)if(Ih(i[o]))return!0}return i}(n);return e===!0?e:e.map(i=>hf(i))}function Rh(n){let e=!1;const i=[];if(n[0]==="case"){for(let o=1;o<n.length-1;o+=2)e=e||Ih(n[o]),i.push(n[o+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||Ih(n[1]);for(let o=2;o<n.length-1;o+=2)i.push(n[o+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||Ih(n[1]);for(let o=1;o<n.length-1;o+=2)i.push(n[o+1])}e&&(n.length=0,n.push("any",...i));for(let o=1;o<n.length;o++)Rh(n[o])}function Ih(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(Ih(n[i]))return!0;return!1}const ry=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function mg(n,e){return n<e?-1:n>e?1:0}function gg(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(gg(n[e]))return!0;return!1}function zs(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?zp(n[1],n[2],"=="):e==="!="?ff(zp(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?zp(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(zs))):e==="all"?["all"].concat(n.slice(1).map(zs)):e==="none"?["all"].concat(n.slice(1).map(zs).map(ff)):e==="in"?df(n[1],n.slice(2)):e==="!in"?ff(df(n[1],n.slice(2))):e==="has"?xd(n[1]):e!=="!has"||ff(xd(n[1]));var i}function zp(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function df(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(mg)]]:["filter-in-small",n,["literal",e]]}}function xd(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function ff(n){return["!",n]}const bd="";function Bu(n,e){return e?`${n}${bd}${e}`:n}let _g;const ay=()=>_g||(_g=new ea({"icon-size":new Wt(We.layout_symbol["icon-size"]),"icon-image":new Wt(We.layout_symbol["icon-image"]),"icon-rotate":new Wt(We.layout_symbol["icon-rotate"]),"icon-offset":new Wt(We.layout_symbol["icon-offset"])}));class Fp{constructor(e,i,o,c,m,g){this.cachedIconPrimary=null;const x=Ua(e,We.appearance.condition);if(x.result==="success"&&(this.condition=x.value),this.name=i,o){this.properties=new fc(ay()),this.unevaluatedLayout=new Nu(ay(),c,m,g);for(const S in o)this.unevaluatedLayout.setValue(S,o[S])}}hasCachedIconPrimary(){return this.cachedIconPrimary!==null}setCachedIconPrimary(e){this.cachedIconPrimary=e}getCachedIconPrimary(){return this.cachedIconPrimary}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}recalculate(e,i,o){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,i,o))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}}const oy="-transition",Np=new Set(["fill","line","background","hillshade","raster"]);class uo extends mn{constructor(e,i,o,c,m,g){if(super(),this.id=e.id,this.fqid=Bu(this.id,o),this.type=e.type,this.scope=o,this.lut=c,this.options=m,this.iconImageUseTheme=g,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const x=Ua(this.filter,We[`filter_${e.type}`]);x.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...x.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||x.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),i.layout&&(this._unevaluatedLayout=new Nu(i.layout,this.scope,m,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),i.paint){this._transitionablePaint=new Zn(i.paint,this.scope,m);for(const x in e.paint)this.setPaintProperty(x,e.paint[x]);for(const x in e.layout)this.setLayoutProperty(x,e.layout[x]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fc(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Np.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const o=this._unevaluatedLayout;o._properties.properties[e]&&(o.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...o.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||o.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(i=>{this.appearances.push(new Fp(i.condition,i.name,i.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(oy)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,i){const o=this._transitionablePaint,c=o._properties.properties;if(e.endsWith(oy)){const P=e.slice(0,-11);return c[P]&&o.setTransition(P,i||void 0),!1}if(!c[e])return!1;const m=o._values[e],g=m.value.isDataDriven(),x=m.value;o.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...o.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||o.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const S=o._values[e].value,A=S.isDataDriven(),M=e.endsWith("pattern")||e==="line-dasharray";return A||g||M||this._handleOverridablePaintPropertyUpdate(e,x,S)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,o){return null}_handleOverridablePaintPropertyUpdate(e,i,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(i=>i.serialize())),ut(e,(i,o)=>!(i===void 0||o==="layout"&&!Object.keys(i).length||o==="paint"&&!Object.keys(i).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Eo&&og(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}for(const e of this.appearances)if(!Fc(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=uf(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,i,o){return{}}queryRadius(e){}queryIntersectsFeature(e,i,o,c,m,g,x,S,A){}}const wl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Bp{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class gn{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function dn(n,e=1){let i=0,o=0;return{members:n.map(c=>{const m=wl[c.type].BYTES_PER_ELEMENT,g=i=pf(i,Math.max(e,m)),x=c.components||1;return o=Math.max(o,m),i+=m*x,{name:c.name,type:c.type,components:x,offset:g}}),size:pf(i,Math.max(o,e)),alignment:e}}function pf(n,e){return Math.ceil(n/e)*e}class Wo extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.int16[c+0]=i,this.int16[c+1]=o,e}}Wo.prototype.bytesPerElement=4,ai(Wo,"StructArrayLayout2i4");class qc extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const m=3*e;return this.int16[m+0]=i,this.int16[m+1]=o,this.int16[m+2]=c,e}}qc.prototype.bytesPerElement=6,ai(qc,"StructArrayLayout3i6");class mf extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,c)}emplace(e,i,o,c,m){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=o,this.int16[g+2]=c,this.int16[g+3]=m,e}}mf.prototype.bytesPerElement=8,ai(mf,"StructArrayLayout4i8");class Uu extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Uu.prototype.bytesPerElement=4,ai(Uu,"StructArrayLayout1f4");class sy extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const m=4*e,g=2*e;return this.int16[m+0]=i,this.int16[m+1]=o,this.float32[g+1]=c,e}}sy.prototype.bytesPerElement=8,ai(sy,"StructArrayLayout2i1f8");class ly extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=o,this.int16[m+2]=c,e}}ly.prototype.bytesPerElement=8,ai(ly,"StructArrayLayout3i8");class gf extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,c,m)}emplace(e,i,o,c,m,g){const x=5*e;return this.int16[x+0]=i,this.int16[x+1]=o,this.int16[x+2]=c,this.int16[x+3]=m,this.int16[x+4]=g,e}}gf.prototype.bytesPerElement=10,ai(gf,"StructArrayLayout5i10");class yg extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,g,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,o,c,m,g,x)}emplace(e,i,o,c,m,g,x,S){const A=6*e,M=12*e,P=3*e;return this.int16[A+0]=i,this.int16[A+1]=o,this.uint8[M+4]=c,this.uint8[M+5]=m,this.uint8[M+6]=g,this.uint8[M+7]=x,this.float32[P+2]=S,e}}yg.prototype.bytesPerElement=12,ai(yg,"StructArrayLayout2i4ub1f12");class Fs extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const m=3*e;return this.float32[m+0]=i,this.float32[m+1]=o,this.float32[m+2]=c,e}}Fs.prototype.bytesPerElement=12,ai(Fs,"StructArrayLayout3f12");class Vu extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,c,m)}emplace(e,i,o,c,m,g){const x=6*e,S=3*e;return this.uint16[x+0]=i,this.uint16[x+1]=o,this.uint16[x+2]=c,this.uint16[x+3]=m,this.float32[S+2]=g,e}}Vu.prototype.bytesPerElement=12,ai(Vu,"StructArrayLayout4ui1f12");class wd extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,c)}emplace(e,i,o,c,m){const g=4*e;return this.uint16[g+0]=i,this.uint16[g+1]=o,this.uint16[g+2]=c,this.uint16[g+3]=m,e}}wd.prototype.bytesPerElement=8,ai(wd,"StructArrayLayout4ui8");class vg extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,c,m,g)}emplace(e,i,o,c,m,g,x){const S=6*e;return this.int16[S+0]=i,this.int16[S+1]=o,this.int16[S+2]=c,this.int16[S+3]=m,this.int16[S+4]=g,this.int16[S+5]=x,e}}vg.prototype.bytesPerElement=12,ai(vg,"StructArrayLayout6i12");class Td extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,g,x,S,A,M,P,k){const U=this.length;return this.resize(U+1),this.emplace(U,e,i,o,c,m,g,x,S,A,M,P,k)}emplace(e,i,o,c,m,g,x,S,A,M,P,k,U){const V=12*e;return this.int16[V+0]=i,this.int16[V+1]=o,this.int16[V+2]=c,this.int16[V+3]=m,this.uint16[V+4]=g,this.uint16[V+5]=x,this.uint16[V+6]=S,this.uint16[V+7]=A,this.int16[V+8]=M,this.int16[V+9]=P,this.int16[V+10]=k,this.int16[V+11]=U,e}}Td.prototype.bytesPerElement=24,ai(Td,"StructArrayLayout4i4ui4i24");class _f extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,c,m,g)}emplace(e,i,o,c,m,g,x){const S=10*e,A=5*e;return this.int16[S+0]=i,this.int16[S+1]=o,this.int16[S+2]=c,this.float32[A+2]=m,this.float32[A+3]=g,this.float32[A+4]=x,e}}_f.prototype.bytesPerElement=20,ai(_f,"StructArrayLayout3i3f20");class ju extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,c)}emplace(e,i,o,c,m){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=m,e}}ju.prototype.bytesPerElement=16,ai(ju,"StructArrayLayout4f16");class xg extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}xg.prototype.bytesPerElement=4,ai(xg,"StructArrayLayout1ul4");class jl extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.uint16[c+0]=i,this.uint16[c+1]=o,e}}jl.prototype.bytesPerElement=4,ai(jl,"StructArrayLayout2ui4");class Gu extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,g,x,S,A,M,P,k,U){const V=this.length;return this.resize(V+1),this.emplace(V,e,i,o,c,m,g,x,S,A,M,P,k,U)}emplace(e,i,o,c,m,g,x,S,A,M,P,k,U,V){const q=20*e,J=10*e;return this.int16[q+0]=i,this.int16[q+1]=o,this.int16[q+2]=c,this.int16[q+3]=m,this.int16[q+4]=g,this.float32[J+3]=x,this.float32[J+4]=S,this.float32[J+5]=A,this.float32[J+6]=M,this.int16[q+14]=P,this.uint32[J+8]=k,this.uint16[q+18]=U,this.uint16[q+19]=V,e}}Gu.prototype.bytesPerElement=40,ai(Gu,"StructArrayLayout5i4f1i1ul2ui40");class Dh extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,g,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,o,c,m,g,x)}emplace(e,i,o,c,m,g,x,S){const A=8*e;return this.int16[A+0]=i,this.int16[A+1]=o,this.int16[A+2]=c,this.int16[A+4]=m,this.int16[A+5]=g,this.int16[A+6]=x,this.int16[A+7]=S,e}}Dh.prototype.bytesPerElement=16,ai(Dh,"StructArrayLayout3i2i2i16");class Gl extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,c,m)}emplace(e,i,o,c,m,g){const x=4*e,S=8*e;return this.float32[x+0]=i,this.float32[x+1]=o,this.float32[x+2]=c,this.int16[S+6]=m,this.int16[S+7]=g,e}}Gl.prototype.bytesPerElement=16,ai(Gl,"StructArrayLayout2f1f2i16");class Mh extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,c,m,g)}emplace(e,i,o,c,m,g,x){const S=20*e,A=5*e;return this.uint8[S+0]=i,this.uint8[S+1]=o,this.float32[A+1]=c,this.float32[A+2]=m,this.float32[A+3]=g,this.float32[A+4]=x,e}}Mh.prototype.bytesPerElement=20,ai(Mh,"StructArrayLayout2ub4f20");class ar extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,o)}emplace(e,i,o,c){const m=3*e;return this.uint16[m+0]=i,this.uint16[m+1]=o,this.uint16[m+2]=c,e}}ar.prototype.bytesPerElement=6,ai(ar,"StructArrayLayout3ui6");class pc extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,g,x,S,A,M,P,k,U,V,q,J,ee,ae,le,de,Re){const Se=this.length;return this.resize(Se+1),this.emplace(Se,e,i,o,c,m,g,x,S,A,M,P,k,U,V,q,J,ee,ae,le,de,Re)}emplace(e,i,o,c,m,g,x,S,A,M,P,k,U,V,q,J,ee,ae,le,de,Re,Se){const Pe=30*e,ke=15*e,Fe=60*e;return this.int16[Pe+0]=i,this.int16[Pe+1]=o,this.int16[Pe+2]=c,this.float32[ke+2]=m,this.float32[ke+3]=g,this.uint16[Pe+8]=x,this.uint16[Pe+9]=S,this.uint32[ke+5]=A,this.uint32[ke+6]=M,this.uint32[ke+7]=P,this.uint16[Pe+16]=k,this.uint16[Pe+17]=U,this.uint16[Pe+18]=V,this.float32[ke+10]=q,this.float32[ke+11]=J,this.uint8[Fe+48]=ee,this.uint8[Fe+49]=ae,this.uint8[Fe+50]=le,this.uint32[ke+13]=de,this.int16[Pe+28]=Re,this.uint8[Fe+58]=Se,e}}pc.prototype.bytesPerElement=60,ai(pc,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class fr extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,g,x,S,A,M,P,k,U,V,q,J,ee,ae,le,de,Re,Se,Pe,ke,Fe,rt,qe,ot,ht,yt,Tt,Et,pt){const St=this.length;return this.resize(St+1),this.emplace(St,e,i,o,c,m,g,x,S,A,M,P,k,U,V,q,J,ee,ae,le,de,Re,Se,Pe,ke,Fe,rt,qe,ot,ht,yt,Tt,Et,pt)}emplace(e,i,o,c,m,g,x,S,A,M,P,k,U,V,q,J,ee,ae,le,de,Re,Se,Pe,ke,Fe,rt,qe,ot,ht,yt,Tt,Et,pt,St){const tt=20*e,Qe=40*e,xt=80*e;return this.float32[tt+0]=i,this.float32[tt+1]=o,this.int16[Qe+4]=c,this.int16[Qe+5]=m,this.int16[Qe+6]=g,this.int16[Qe+7]=x,this.int16[Qe+8]=S,this.int16[Qe+9]=A,this.int16[Qe+10]=M,this.int16[Qe+11]=P,this.int16[Qe+12]=k,this.uint16[Qe+13]=U,this.uint16[Qe+14]=V,this.uint16[Qe+15]=q,this.uint16[Qe+16]=J,this.uint16[Qe+17]=ee,this.uint16[Qe+18]=ae,this.uint16[Qe+19]=le,this.uint16[Qe+20]=de,this.uint16[Qe+21]=Re,this.uint16[Qe+22]=Se,this.uint16[Qe+23]=Pe,this.uint16[Qe+24]=ke,this.uint16[Qe+25]=Fe,this.uint16[Qe+26]=rt,this.uint16[Qe+27]=qe,this.uint32[tt+14]=ot,this.float32[tt+15]=ht,this.float32[tt+16]=yt,this.float32[tt+17]=Tt,this.float32[tt+18]=Et,this.uint8[xt+76]=pt,this.uint16[Qe+39]=St,e}}fr.prototype.bytesPerElement=80,ai(fr,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class yf extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,o,c,m,g)}emplace(e,i,o,c,m,g,x){const S=6*e;return this.float32[S+0]=i,this.float32[S+1]=o,this.float32[S+2]=c,this.float32[S+3]=m,this.float32[S+4]=g,this.float32[S+5]=x,e}}yf.prototype.bytesPerElement=24,ai(yf,"StructArrayLayout6f24");class Ph extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,o,c,m)}emplace(e,i,o,c,m,g){const x=5*e;return this.float32[x+0]=i,this.float32[x+1]=o,this.float32[x+2]=c,this.float32[x+3]=m,this.float32[x+4]=g,e}}Ph.prototype.bytesPerElement=20,ai(Ph,"StructArrayLayout5f20");class px extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,g,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,o,c,m,g,x)}emplace(e,i,o,c,m,g,x,S){const A=7*e;return this.float32[A+0]=i,this.float32[A+1]=o,this.float32[A+2]=c,this.float32[A+3]=m,this.float32[A+4]=g,this.float32[A+5]=x,this.float32[A+6]=S,e}}px.prototype.bytesPerElement=28,ai(px,"StructArrayLayout7f28");class Up extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,g,x,S,A,M,P){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,o,c,m,g,x,S,A,M,P)}emplace(e,i,o,c,m,g,x,S,A,M,P,k){const U=11*e;return this.float32[U+0]=i,this.float32[U+1]=o,this.float32[U+2]=c,this.float32[U+3]=m,this.float32[U+4]=g,this.float32[U+5]=x,this.float32[U+6]=S,this.float32[U+7]=A,this.float32[U+8]=M,this.float32[U+9]=P,this.float32[U+10]=k,e}}Up.prototype.bytesPerElement=44,ai(Up,"StructArrayLayout11f44");class Vp extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,g,x,S,A){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,o,c,m,g,x,S,A)}emplace(e,i,o,c,m,g,x,S,A,M){const P=9*e;return this.float32[P+0]=i,this.float32[P+1]=o,this.float32[P+2]=c,this.float32[P+3]=m,this.float32[P+4]=g,this.float32[P+5]=x,this.float32[P+6]=S,this.float32[P+7]=A,this.float32[P+8]=M,e}}Vp.prototype.bytesPerElement=36,ai(Vp,"StructArrayLayout9f36");class Hl extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,i)}emplace(e,i,o){const c=2*e;return this.float32[c+0]=i,this.float32[c+1]=o,e}}Hl.prototype.bytesPerElement=8,ai(Hl,"StructArrayLayout2f8");class cy extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,o,c)}emplace(e,i,o,c,m){const g=6*e;return this.uint32[3*e+0]=i,this.uint16[g+2]=o,this.uint16[g+3]=c,this.uint16[g+4]=m,e}}cy.prototype.bytesPerElement=12,ai(cy,"StructArrayLayout1ul3ui12");class jp extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}jp.prototype.bytesPerElement=2,ai(jp,"StructArrayLayout1ui2");class bg extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,g,x,S,A,M,P,k,U,V,q,J){const ee=this.length;return this.resize(ee+1),this.emplace(ee,e,i,o,c,m,g,x,S,A,M,P,k,U,V,q,J)}emplace(e,i,o,c,m,g,x,S,A,M,P,k,U,V,q,J,ee){const ae=16*e;return this.float32[ae+0]=i,this.float32[ae+1]=o,this.float32[ae+2]=c,this.float32[ae+3]=m,this.float32[ae+4]=g,this.float32[ae+5]=x,this.float32[ae+6]=S,this.float32[ae+7]=A,this.float32[ae+8]=M,this.float32[ae+9]=P,this.float32[ae+10]=k,this.float32[ae+11]=U,this.float32[ae+12]=V,this.float32[ae+13]=q,this.float32[ae+14]=J,this.float32[ae+15]=ee,e}}bg.prototype.bytesPerElement=64,ai(bg,"StructArrayLayout16f64");class Oh extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,o,c,m,g,x){const S=this.length;return this.resize(S+1),this.emplace(S,e,i,o,c,m,g,x)}emplace(e,i,o,c,m,g,x,S){const A=10*e,M=5*e;return this.uint16[A+0]=i,this.uint16[A+1]=o,this.uint16[A+2]=c,this.uint16[A+3]=m,this.float32[M+2]=g,this.float32[M+3]=x,this.float32[M+4]=S,e}}Oh.prototype.bytesPerElement=20,ai(Oh,"StructArrayLayout4ui3f20");class uy extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}uy.prototype.bytesPerElement=2,ai(uy,"StructArrayLayout1i2");class Gp extends gn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Gp.prototype.bytesPerElement=1,ai(Gp,"StructArrayLayout1ub1");class wg extends Bp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}wg.prototype.size=40;class hy extends Gu{get(e){return new wg(this,e)}}ai(hy,"CollisionBoxArray");class Es extends Bp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Es.prototype.size=60;class Tl extends pc{get(e){return new Es(this,e)}}ai(Tl,"PlacedSymbolArray");class mc extends Bp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}mc.prototype.size=80;class Hp extends fr{get(e){return new mc(this,e)}}ai(Hp,"SymbolInstanceArray");class Sd extends Uu{getoffsetX(e){return this.float32[1*e+0]}}ai(Sd,"GlyphOffsetArray");class $l extends Wo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ai($l,"SymbolLineVertexArray");class Co extends Bp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Co.prototype.size=12;class mx extends cy{get(e){return new Co(this,e)}}ai(mx,"FeatureIndexArray");class gx extends jl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ai(gx,"FillExtrusionCentroidArray");class _x extends Bp{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}_x.prototype.size=6;class Tg extends qc{get(e){return new _x(this,e)}}ai(Tg,"FillExtrusionWallArray");const dy=dn([{name:"a_pos",components:2,type:"Int16"}],4),Sg=dn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),yx=dn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ta{constructor(e=[]){this.segments=e}_prepareSegment(e,i,o,c){let m=this.segments[this.segments.length-1];return e>ta.MAX_VERTEX_ARRAY_LENGTH&&Yt(`Max vertices per segment is ${ta.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>ta.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:i,primitiveOffset:o,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}prepareSegment(e,i,o,c){return this._prepareSegment(e,i.length,o.length,c)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,o,c){return new ta([{vertexOffset:e,primitiveOffset:i,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function vx(n,e){return 256*(n=X(Math.floor(n),0,255))+X(Math.floor(e),0,255)}ta.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ai(ta,"SegmentVector");const fy=dn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),jb=dn([{name:"a_pattern_b",components:4,type:"Uint16"}]),xx=dn([{name:"a_dash",components:4,type:"Uint16"}]);class $p{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,o,c){this.ids.push(vf(e)),this.positions.push(i,o,c)}eachPosition(e,i){const o=vf(e);let c=0,m=this.ids.length-1;for(;c<m;){const g=c+m>>1;this.ids[g]>=o?m=g:c=g+1}for(;this.ids[c]===o;)i(this.positions[3*c],this.positions[3*c+1],this.positions[3*c+2]),c++}static serialize(e,i){const o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return py(o,c,0,o.length-1),i&&(i.add(o.buffer),i.add(c.buffer)),{ids:o,positions:c}}static deserialize(e){const i=new $p;let o;i.ids=e.ids,i.positions=e.positions;for(const c of i.ids)c!==o&&i.uniqueIds.push(c),o=c;return i.indexed=!0,i}}function vf(n){const e=+n;return Number.isSafeInteger(e)?e:ge(String(n))}function py(n,e,i,o){for(;i<o;){const c=n[i+o>>1];let m=i-1,g=o+1;for(;;){do m++;while(n[m]<c);do g--;while(n[g]>c);if(m>=g)break;Wp(n,m,g),Wp(e,3*m,3*g),Wp(e,3*m+1,3*g+1),Wp(e,3*m+2,3*g+2)}g-i<o-g?(py(n,e,i,g),i=g+1):(py(n,e,g+1,o),o=g)}}function Wp(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}ai($p,"FeaturePositionMap");class Wl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,o){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class xf extends Wl{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}}class ya extends Wl{constructor(e){super(e),this.current=0}set(e,i,o){this.fetchUniformLocation(e,i)&&this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class ds extends Wl{constructor(e){super(e),this.current=[0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}}class Sl extends Wl{constructor(e){super(e),this.current=[0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}}class ql extends Wl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,o){this.fetchUniformLocation(e,i)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3])))}}class Ed extends Wl{constructor(e){super(e),this.current=Qi.transparent.toPremultipliedRenderColor(null)}set(e,i,o){this.fetchUniformLocation(e,i)&&(o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a)))}}const bf=new Float32Array(16);class Zl extends Wl{constructor(e){super(e),this.current=bf}set(e,i,o){if(this.fetchUniformLocation(e,i)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let c=1;c<16;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}}const Gb=new Float32Array(9),bx=new Float32Array(4);class my extends Wl{constructor(e){super(e),this.current=bx}set(e,i,o){if(this.fetchUniformLocation(e,i)){for(let c=0;c<4;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}}function Eg(n){return[vx(255*n.r,255*n.g),vx(255*n.b,255*n.a)]}function kh(n,e,i,o,c,m,g,x){return!!n&&(n.kind==="composite"||n.kind==="source"?n.evaluate(new Er(0,{brightness:m,worldview:x}),e,i,c,o,g)==="none":n.value==="none")}class Cg{constructor(e,i,o,c){this.value=e,this.uniformNames=i.map(m=>`u_${m}`),this.type=o,this.context=c}setUniform(e,i,o,c,m){const g=c.constantOr(this.value);i.set(e,m,g instanceof Qi?g.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):g)}getBinding(e,i){return this.type==="color"?new Ed(e):new ya(e)}}class wf{constructor(e,i){this.uniformNames=i.map(o=>`u_${o}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,o,c,m){let g=null;m!=="u_pattern"&&m!=="u_dash"||(g=this.pattern),m==="u_pattern_b"&&(g=this.patternTransition),m==="u_pixel_ratio"&&(g=this.pixelRatio),g&&i.set(e,m,g)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new ql(e):new ya(e)}}class Hu{constructor(e,i,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=i.map(m=>({name:`a_${m}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,i,o,c,m,g,x,S){const A=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Er(0,{brightness:g,worldview:S}),i,{},m,c,x):this.expression.kind==="constant"&&this.expression.value,P=kh(this.lutExpression,i,{},c,m,g,x,S);this.paintVertexArray.resize(e),this._setPaintValue(A,e,M,P?null:this.context.lut)}updatePaintArray(e,i,o,c,m,g,x,S){const A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x,worldview:S},o,c,void 0,m):this.expression.kind==="constant"&&this.expression.value,M=kh(this.lutExpression,o,c,m,void 0,x,void 0,S);this._setPaintValue(e,i,A,M?null:this.context.lut)}_setPaintValue(e,i,o,c){if(this.type==="color"){const m=Eg(o.toPremultipliedRenderColor(c));for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,m[0],m[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class il{constructor(e,i,o,c,m,g){this.expression=e,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=o,this.useIntegerZoom=c,this.context=m,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,i,o,c,m,g,x,S){const A=this.expression.evaluate(new Er(this.context.zoom,{brightness:g,worldview:S}),i,{},m,c,x),M=this.expression.evaluate(new Er(this.context.zoom+1,{brightness:g,worldview:S}),i,{},m,c,x),P=kh(this.lutExpression,i,{},c,m,g,x,S),k=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(k,e,A,M,P?null:this.context.lut)}updatePaintArray(e,i,o,c,m,g,x,S){const A=this.expression.evaluate({zoom:this.context.zoom,brightness:x,worldview:S},o,c,void 0,m),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x,worldview:S},o,c,void 0,m),P=kh(this.lutExpression,o,c,m,void 0,x,void 0,S);this._setPaintValue(e,i,A,M,P?null:this.context.lut)}_setPaintValue(e,i,o,c,m){if(this.type==="color"){const g=Eg(o.toPremultipliedRenderColor(m)),x=Eg(o.toPremultipliedRenderColor(m));for(let S=e;S<i;S++)this.paintVertexArray.emplace(S,g[0],g[1],x[0],x[1])}else{for(let g=e;g<i;g++)this.paintVertexArray.emplace(g,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,o,c,m){const g=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,x=X(this.expression.interpolationFactor(g,this.context.zoom,this.context.zoom+1),0,1);i.set(e,m,x)}getBinding(e,i){return new ya(e)}}class qo{constructor(e,i,o,c,m){this.expression=e,this.layerId=m,this.paintVertexAttributes=(o==="array"?xx:fy).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new c,this.paintTransitionVertexArray=new wd}populatePaintArray(e,i,o,c){const m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(m,e,i.patterns&&i.patterns[this.layerId],o)}updatePaintArray(e,i,o,c,m,g,x){this._setPaintValues(e,i,o.patterns&&o.patterns[this.layerId],g)}_setPaintValues(e,i,o,c){if(!c||!o)return;const m=c[o[0]],g=c[o[1]];if(m){if(m){const{tl:x,br:S,pixelRatio:A}=m;for(let M=e;M<i;M++)this.paintVertexArray.emplace(M,x[0],x[1],S[0],S[1],A)}if(g){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:x,br:S}=g;for(let A=e;A<i;A++)this.paintTransitionVertexArray.emplace(A,x[0],x[1],S[0],S[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,jb.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class $u{constructor(e,i,o=()=>!0){this.binders={},this._buffers=[],this.context=i;const c=[];for(const m in e.paint._values){const g=e.paint.get(m);if(m.endsWith("-use-theme")||!o(m)||!(g instanceof Eo&&og(g.property.specification)))continue;const x=Tf(m,e.type),S=g.value,A=g.property.specification.type,M=!!g.property.useIntegerZoom,P=m==="line-dasharray"||m.endsWith("pattern"),k=e.paint.get(`${m}-use-theme`),U=m==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||k&&k.value.kind!=="constant";if(S.kind!=="constant"||U)if(S.kind==="source"||U||P){const V=_y(m,A,"source");this.binders[m]=P?new qo(S,x,A,V,e.id):new Hu(S,x,A,V),c.push(`/a_${m}`)}else{const V=_y(m,A,"composite");this.binders[m]=new il(S,x,A,M,i,V),c.push(`/z_${m}`)}else this.binders[m]=P?new wf(S.value,x):new Cg(S.value,x,A,i),c.push(`/u_${m}`);k&&(this.binders[m].lutExpression=k.value)}this.cacheKey=c.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Hu||i instanceof il?i.maxValue:0}populatePaintArrays(e,i,o,c,m,g,x,S){for(const A in this.binders){const M=this.binders[A];M.context=this.context,(M instanceof Hu||M instanceof il||M instanceof qo)&&M.populatePaintArray(e,i,o,c,m,g,x,S)}}setConstantPatternPositions(e,i){for(const o in this.binders){const c=this.binders[o];c instanceof wf&&c.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof qo?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,o,c,m,g,x,S,A,M){let P=!1;const k=Object.keys(e),U=k.length!==0&&!S,V=U?k:i.uniqueIds;this.context.lut=m.lut;for(const q in this.binders){const J=this.binders[q];if(J.context=this.context,(J instanceof Hu||J instanceof il||J instanceof qo)&&J.expression&&J.expression.kind&&J.expression.kind!=="constant"&&(J.expression.isStateDependent===!0||J.expression.isLightConstant===!1)){const ee=m.paint.get(q);J.expression=ee.value;for(const ae of V){const le=e[ae.toString()];i.eachPosition(ae,(de,Re,Se)=>{const Pe=c.feature(de);J.updatePaintArray(Re,Se,Pe,le,g,x,A,M)})}if(!U)for(const ae of o.uniqueIds){const le=e[ae.toString()];o.eachPosition(ae,(de,Re,Se)=>{const Pe=c.feature(de);J.updatePaintArray(Re,Se,Pe,le,g,x,A,M)})}P=!0}}return P}defines(){const e=[];for(const i in this.binders){const o=this.binders[i];(o instanceof Cg||o instanceof wf)&&e.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof Cg||c instanceof wf||c instanceof il)for(const m of c.uniformNames)i.push({name:m,property:o,binding:c.getBinding(e,m)})}return i}setUniforms(e,i,o,c,m){for(const{name:g,property:x,binding:S}of o)this.binders[x].setUniform(e,S,m,c.get(x),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Hu||i instanceof il||i instanceof qo)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof qo&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const o=this.binders[i];(o instanceof Hu||o instanceof il||o instanceof qo)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Hu||i instanceof il||i instanceof qo)&&i.destroy()}}}class Ns{constructor(e,i,o=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new $u(c,i,o);this.needsUpload=!1,this._featureMap=new $p,this._featureMapWithoutIds=new $p,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,o,c,m,g,x,S,A){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(e,i,c,m,g,x,S,A);i.id!==void 0?this._featureMap.add(i.id,o,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,o,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,o,c,m,g,x,S){for(const A of o)this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,A,c,m,g,x||0,S)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const qp={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Tf(n,e){return qp[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const gy={"line-pattern":{source:Vu,composite:Vu},"fill-pattern":{source:Vu,composite:Vu},"fill-extrusion-pattern":{source:Vu,composite:Vu},"line-dasharray":{source:wd,composite:wd}},wx={color:{source:Hl,composite:ju},number:{source:Uu,composite:Hl}};function _y(n,e,i){const o=gy[n];return o&&o[i]||wx[e][i]}ai(Cg,"ConstantBinder"),ai(wf,"PatternConstantBinder"),ai(Hu,"SourceExpressionBinder"),ai(qo,"PatternCompositeBinder"),ai(il,"CompositeExpressionBinder"),ai($u,"ProgramConfiguration",{omit:["_buffers"]}),ai(Ns,"ProgramConfigurationSet");const Bs=Lt/Math.PI/2,f=5,t=6,a=16383,p=64,y=[p,32,16],b=-Bs,T=Bs;function R(n,e,i,o=Bs){return i=cn(i),[n*Math.sin(i)*o,-e*o,n*Math.cos(i)*o]}function D(n,e,i){return R(Math.cos(cn(n)),Math.sin(cn(n)),e,i)}const L=63710088e-1,F=2*Math.PI*L;class j{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new j(we(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,o=this.lat*i,c=e.lat*i,m=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*i);return L*Math.acos(Math.min(m,1))}toBounds(e=0){const i=360*e/40075017,o=i/Math.cos(Math.PI/180*this.lat);return new B({lng:this.lng-o,lat:this.lat-i},{lng:this.lng+o,lat:this.lat+i})}toEcef(e){return D(this.lat,this.lng,Bs+e*Bs/L)}static convert(e){if(e instanceof j)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new j(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new j(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class B{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof j?new j(e.lng,e.lat):j.convert(e),this}setSouthWest(e){return this._sw=e instanceof j?new j(e.lng,e.lat):j.convert(e),this}extend(e){const i=this._sw,o=this._ne;let c,m;if(e instanceof j)c=e,m=e;else{if(!(e instanceof B))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(B.convert(e)):this.extend(j.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(j.convert(e)):this;if(c=e._sw,m=e._ne,!c||!m)return this}return i||o?(i.lng=Math.min(c.lng,i.lng),i.lat=Math.min(c.lat,i.lat),o.lng=Math.max(m.lng,o.lng),o.lat=Math.max(m.lat,o.lat)):(this._sw=new j(c.lng,c.lat),this._ne=new j(m.lng,m.lat)),this}getCenter(){return new j((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new j(this.getWest(),this.getNorth())}getSouthEast(){return new j(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:o}=j.convert(e);let c=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&c}static convert(e){if(e)return e instanceof B?e:new B(e)}}const $=0,Z=25.5;function Q(n){return F*Math.cos(n*Math.PI/180)}function re(n){return(180+n)/360}function te(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function se(n,e){return n/Q(e)}function me(n){return 360*n-180}function ce(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function Ae(n,e){return n*Q(ce(e))}const _e=85.051129;function Ie(n){return Math.cos(cn(X(n,-_e,_e)))}function Ce(n,e){const i=X(e,$,Z),o=Math.pow(2,i);return Ie(n)*F/(512*o)}function Te(n){return 1/Math.cos(n*Math.PI/180)}function De(n,e=0){const i=Math.exp(Math.PI*(1-(n.y+e/Lt)/(1<<n.z)*2));return 80150034*i/(i*i+1)/Lt/(1<<n.z)}class Ge{constructor(e,i,o=0){this.x=+e,this.y=+i,this.z=+o}static fromLngLat(e,i=0){const o=j.convert(e);return new Ge(re(o.lng),te(o.lat),se(i,o.lat))}toLngLat(){return new j(me(this.x),ce(this.y))}toAltitude(){return Ae(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/F*Te(ce(this.y))}}function Ue(n,e,i,o,c,m,g,x,S){const A=(e+o)/2,M=(i+c)/2,P=new vt(A,M);x(P),function(k,U,V,q,J,ee){const ae=V-J,le=q-ee;return Math.abs((q-U)*ae-(V-k)*le)/Math.hypot(ae,le)}(P.x,P.y,m.x,m.y,g.x,g.y)>=S?(Ue(n,e,i,A,M,m,P,x,S),Ue(n,A,M,o,c,P,g,x,S)):n.push(g)}function nt(n,e,i){let o=n[0],c=o.x,m=o.y;e(o);const g=[o];for(let x=1;x<n.length;x++){const S=n[x],{x:A,y:M}=S;e(S),Ue(g,c,m,A,M,o,S,e,i),c=A,m=M,o=S}return g}function Ke(n,e,i,o){if(o(e,i)){const c=e.add(i)._mult(.5);Ke(n,e,c,o),Ke(n,c,i,o)}else n.push(i)}function st(n,e){let i=n[0];const o=[i];for(let c=1;c<n.length;c++){const m=n[c];Ke(o,i,m,e),i=m}return o}const Pt=Math.pow(2,14)-1,Ze=-Pt-1;function ze(n,e){const i=Math.round(n.x*e),o=Math.round(n.y*e);return n.x=X(i,Ze,Pt),n.y=X(o,Ze,Pt),(i<n.x||i>n.x+1||o<n.y||o>n.y+1)&&Yt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function lt(n,e,i){const o=n.loadGeometry(),c=n.extent,m=Lt/c;if(e&&i&&i.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:x,x:S,y:A,projection:M}=i,P=k=>{const U=me((e.x+k.x/c)/g),V=ce((e.y+k.y/c)/g),q=M.project(U,V);k.x=(q.x*x-S)*c,k.y=(q.y*x-A)*c};for(let k=0;k<o.length;k++)if(n.type!==1)o[k]=nt(o[k],P,1);else{const U=[];for(const V of o[k])V.x<0||V.x>=c||V.y<0||V.y>=c||(P(V),U.push(V));o[k]=U}}for(const g of o)for(const x of g)ze(x,m);return o}function Je(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?lt(n):[]}}class bt{constructor(e,i,o,c,m){this.properties={},this.extent=o,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=c,this._values=m,e.readFields(Ft,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,o=[];let c,m=1,g=0,x=0,S=0;for(;e.pos<i;){if(g<=0){const A=e.readVarint();m=7&A,g=A>>3}if(g--,m===1||m===2)x+=e.readSVarint(),S+=e.readSVarint(),m===1&&(c&&o.push(c),c=[]),c&&c.push(new vt(x,S));else{if(m!==7)throw new Error(`unknown command ${m}`);c&&c.push(c[0].clone())}}return c&&o.push(c),o}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let o=1,c=0,m=0,g=0,x=1/0,S=-1/0,A=1/0,M=-1/0;for(;e.pos<i;){if(c<=0){const P=e.readVarint();o=7&P,c=P>>3}if(c--,o===1||o===2)m+=e.readSVarint(),g+=e.readSVarint(),m<x&&(x=m),m>S&&(S=m),g<A&&(A=g),g>M&&(M=g);else if(o!==7)throw new Error(`unknown command ${o}`)}return[x,A,S,M]}toGeoJSON(e,i,o){const c=this.extent*Math.pow(2,o),m=this.extent*e,g=this.extent*i,x=this.loadGeometry();function S(k){return[360*(k.x+m)/c-180,360/Math.PI*Math.atan(Math.exp((1-2*(k.y+g)/c)*Math.PI))-90]}function A(k){return k.map(S)}let M;if(this.type===1){const k=[];for(const V of x)k.push(V[0]);const U=A(k);M=k.length===1?{type:"Point",coordinates:U[0]}:{type:"MultiPoint",coordinates:U}}else if(this.type===2){const k=x.map(A);M=k.length===1?{type:"LineString",coordinates:k[0]}:{type:"MultiLineString",coordinates:k}}else{if(this.type!==3)throw new Error("unknown feature type");{const k=function(V){const q=V.length;if(q<=1)return[V];const J=[];let ee,ae;for(let le=0;le<q;le++){const de=ci(V[le]);de!==0&&(ae===void 0&&(ae=de<0),ae===de<0?(ee&&J.push(ee),ee=[V[le]]):ee&&ee.push(V[le]))}return ee&&J.push(ee),J}(x),U=[];for(const V of k)U.push(V.map(A));M=U.length===1?{type:"Polygon",coordinates:U[0]}:{type:"MultiPolygon",coordinates:U}}}const P={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(P.id=this.id),P}}function Ft(n,e,i){n===1?e.id=i.readVarint():n===2?function(o,c){const m=o.readVarint()+o.pos;for(;o.pos<m;){const g=c._keys[o.readVarint()],x=c._values[o.readVarint()];c.properties[g]=x}}(i,e):n===3?e.type=i.readVarint():n===4&&(e._geometry=i.pos)}function ci(n){let e=0;for(let i,o,c=0,m=n.length,g=m-1;c<m;g=c++)i=n[c],o=n[g],e+=(o.x-i.x)*(i.y+o.y);return e}bt.types=["Unknown","Point","LineString","Polygon"];class Mt{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Ot,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new bt(this._pbf,i,this.extent,this._keys,this._values)}}function Ot(n,e,i){n===15?e.version=i.readVarint():n===1?e.name=i.readString():n===5?e.extent=i.readVarint():n===2?e._features.push(i.pos):n===3?e._keys.push(i.readString()):n===4&&e._values.push(function(o){let c=null;const m=o.readVarint()+o.pos;for(;o.pos<m;){const g=o.readVarint()>>3;c=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}if(c==null)throw new Error("unknown feature value");return c}(i))}class di{constructor(e,i){this.layers=e.readFields(ei,{},i)}}function ei(n,e,i){if(n===3){const o=new Mt(i,i.readVarint()+i.pos);o.length&&(e[o.name]=o)}}const Jt="3d_elevation_id",ti="level";class Ii{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,o){return this.get(e,!0,i,o)}optional(e,i,o){return this.get(e,!1,i,o)}success(){return this._valid}get(e,i,o,c){const m=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&m!==void 0&&!Number.isNaN(m)?o(c?c(m):m):i&&(this._valid=!1),this}}class yn{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,o){return this.featureFunc(e,i,o)}parseVertex(e,i,o){return this.vertexFunc(e,i,o)}}const An=new yn((n,e,i)=>n.reset(e).require(Jt,o=>{i.id=o}).optional("fixed_height_relative",o=>{i.constantHeight=o},Bi.decodeRelativeHeight).geometry(o=>{i.bounds=o},xp).success(),(n,e,i)=>n.reset(e).require(Jt,o=>{i.id=o}).require("elevation_idx",o=>{i.idx=o}).require("extent",o=>{i.extent=o}).require("height_relative",o=>{i.height=o},Bi.decodeRelativeHeight).geometry(o=>{i.position=o},Bi.getPoint).success()),_r=new yn((n,e,i)=>n.reset(e).require(Jt,o=>{i.id=o}).optional("fixed_height",o=>{i.constantHeight=o},Bi.decodeMetricHeight).geometry(o=>{i.bounds=o},xp).success(),(n,e,i)=>n.reset(e).require(Jt,o=>{i.id=o}).require("elevation_idx",o=>{i.idx=o}).require("extent",o=>{i.extent=o}).require("height",o=>{i.height=o},Bi.decodeMetricHeight).geometry(o=>{i.position=o},Bi.getPoint).success());class Bi{static getPoint(e){return da(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?_r:void 0:An}static parse(e){const i=[],o=[],c=e.length,m=new Ii;for(let g=0;g<c;g++){const x=e.feature(g),S=x.properties.version,A=Bi.getVersionSchema(S);if(A===void 0){Yt(`Unknown elevation feature version number ${S||"(unknown)"}`);continue}const M=x.properties.type;if(!M)continue;const P=bt.types[x.type];if(P==="Point"&&M==="curve_point"){const k={};A.parseVertex(m,x,k)&&i.push(k)}else if(P==="Polygon"&&M==="curve_meta"){const k={};A.parseFeature(m,x,k)&&o.push(k)}}return{vertices:i,features:o}}}class In{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const c=wo(i,this.dir);if(Math.abs(c)<1e-6)return!1;const m=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/c;return o[0]=this.pos[0]+this.dir[0]*m,o[1]=this.pos[1]+this.dir[1]*m,!0}}class tn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,o){const c=Rn(i,this.dir);if(Math.abs(c)<1e-6)return!1;const m=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/c;return o[0]=this.pos[0]+this.dir[0]*m,o[1]=this.pos[1]+this.dir[1]*m,o[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(e,i,o){if(function(U,V){var q=U[0],J=U[1],ee=U[2],ae=V[0],le=V[1],de=V[2];return Math.abs(q-ae)<=z*Math.max(1,Math.abs(q),Math.abs(ae))&&Math.abs(J-le)<=z*Math.max(1,Math.abs(J),Math.abs(le))&&Math.abs(ee-de)<=z*Math.max(1,Math.abs(ee),Math.abs(de))}(this.pos,e)||i===0)return o[0]=o[1]=o[2]=0,!1;const[c,m,g]=this.dir,x=this.pos[0]-e[0],S=this.pos[1]-e[1],A=this.pos[2]-e[2],M=c*c+m*m+g*g,P=2*(x*c+S*m+A*g),k=P*P-4*M*(x*x+S*S+A*A-i*i);if(k<0){const U=Math.max(-P/2,0),V=x+c*U,q=S+m*U,J=A+g*U,ee=Math.hypot(V,q,J);return o[0]=V*i/ee,o[1]=q*i/ee,o[2]=J*i/ee,!1}{const U=(-P-Math.sqrt(k))/(2*M);if(U<0){const V=Math.hypot(x,S,A);return o[0]=x*i/V,o[1]=S*i/V,o[2]=A*i/V,!1}return o[0]=x+c*U,o[1]=S+m*U,o[2]=A+g*U,!0}}}class dr{constructor(e,i,o,c,m){this.TL=e,this.TR=i,this.BR=o,this.BL=c,this.horizon=m}static fromInvProjectionMatrix(e,i,o){const c=[-1,1,1],m=[1,1,1],g=[1,-1,1],x=[-1,-1,1],S=Bn(c,c,e),A=Bn(m,m,e),M=Bn(g,g,e),P=Bn(x,x,e);return new dr(S,A,M,P,i/o)}}function Pn(n,e,i){let o=1/0,c=-1/0;const m=[];for(const g of n){Pr(m,g,e);const x=Rn(m,i);o=Math.min(o,x),c=Math.max(c,x)}return[o,c]}function Cr(n,e){let i=!0;for(let o=0;o<n.planes.length;o++){const c=n.planes[o];let m=0;for(let g=0;g<e.length;g++)m+=+(Rn(c,e[g])+c[3]>=0);if(m===0)return 0;m!==e.length&&(i=!1)}return i?2:1}function jn(n,e){for(const i of n.projections){const o=Pn(e,n.points[0],i.axis);if(i.projection[1]<o[0]||i.projection[0]>o[1])return 0}return 1}function on(n,e){let i=0;const o=[0,0,0,0];for(let g=0;g<n.length;g++)o[0]=n[g][0],o[1]=n[g][1],o[2]=n[g][2],o[3]=1,(c=o)[0]*(m=e)[0]+c[1]*m[1]+c[2]*m[2]+c[3]*m[3]>=0&&i++;var c,m;return i}class tr{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=un.fromPoints(this.points),this.projections=[],this.frustumEdges=[Pr([],this.points[2],this.points[3]),Pr([],this.points[0],this.points[3]),Pr([],this.points[4],this.points[0]),Pr([],this.points[5],this.points[1]),Pr([],this.points[6],this.points[2]),Pr([],this.points[7],this.points[3])];for(const o of this.frustumEdges){const c=[0,-o[2],o[1]],m=[o[2],0,-o[0]];this.projections.push({axis:c,projection:Pn(this.points,this.points[0],c)}),this.projections.push({axis:m,projection:Pn(this.points,this.points[0],m)})}}static fromInvProjectionMatrix(e,i,o,c){const m=Math.pow(2,o),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const M=Fa([],A,e),P=1/M[3]/i*m;return(k=M)[0]=(U=M)[0]*(V=[P,P,c?1/M[3]:P,P])[0],k[1]=U[1]*V[1],k[2]=U[2]*V[2],k[3]=U[3]*V[3],k;var k,U,V}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const M=Vi([],gr([],Pr([],g[A[0]],g[A[1]]),Pr([],g[A[2]],g[A[1]]))),P=-Rn(M,g[A[1]]);return M.concat(P)}),S=[];for(let A=0;A<g.length;A++)S.push([g[A][0],g[A][1],g[A][2]]);return new tr(S,x)}intersectsPrecise(e,i,o){for(let c=0;c<i.length;c++)if(!on(e,i[c]))return 0;for(let c=0;c<this.planes.length;c++)if(!on(e,this.planes[c]))return 0;for(const c of o)for(const m of this.frustumEdges){const g=gr([],c,m),x=Qt(g);if(x===0)continue;xn(g,g,1/x);const S=Pn(this.points,this.points[0],g),A=Pn(e,this.points[0],g);if(S[0]>A[1]||A[0]>S[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const o=i[3];if(Rn([i[0],i[1],i[2]],e)+o<0)return!1}return!0}}class un{static fromPoints(e){const i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];for(const c of e)wr(i,i,c),Jn(o,o,c);return new un(i,o)}static fromTileIdAndHeight(e,i,o){const c=1<<e.canonical.z,m=e.canonical.x,g=e.canonical.y;return new un([m/c,g/c,i],[(m+1)/c,(g+1)/c,o])}static applyTransform(e,i){const o=e.getCorners();for(let c=0;c<o.length;++c)Bn(o[c],o[c],i);return un.fromPoints(o)}static applyTransformFast(e,i){const o=[i[12],i[13],i[14]],c=[...o];for(let m=0;m<3;m++)for(let g=0;g<3;g++){const x=i[4*g+m],S=x*e.min[g],A=x*e.max[g];o[m]+=Math.min(S,A),c[m]+=Math.max(S,A)}return new un(o,c)}static projectAabbCorners(e,i){const o=e.getCorners();for(let c=0;c<o.length;++c)Bn(o[c],o[c],i);return o}constructor(e,i){this.min=e,this.max=i,this.center=xn([],zi([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],o=Di(this.min),c=Di(this.max);for(let m=0;m<i.length;m++)o[m]=i[m]?this.min[m]:this.center[m],c[m]=i[m]?this.center[m]:this.max[m];return c[2]=this.max[2],new un(o,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Cr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Cr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?jn(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?jn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ai(un,"Aabb");class kr{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,o=i[1],c=-i[0],m=(e.extent+1)*this.metersToTile;return[new vt(Math.trunc(e.position[0]+o*m),Math.trunc(e.position[1]+c*m)),new vt(Math.trunc(e.position[0]-o*m),Math.trunc(e.position[1]-c*m))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Xn{constructor(e,i,o,c,m,g){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Un(),Un(),Un(),Un(),Un(),Un(),Un()],this.id=e,this.heightRange={min:o,max:o},this.safeArea=i,this.constantHeight=o,this.constantHeight==null&&(this.constantHeight!=null||c.length!==0)){this.vertices=c,this.edges=m,this.edges=this.edges.filter(x=>{return x.a<this.vertices.length&&x.b<this.vertices.length&&!((S=this.vertices[x.a].position)[0]===(A=this.vertices[x.b].position)[0]&&S[1]===A[1]);var S,A}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:da(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const S=this.vertices[x.a].position,A=this.vertices[x.b].position,M=Vr(Un(),A,S),P=_n(M),k=xr(Un(),M,1/P);this.edgeProps.push({vec:M,dir:k,len:P});const U=this.vertexProps[x.a].dir,V=this.vertexProps[x.b].dir;Ga(U,U,k),Ga(V,V,k)}for(const x of this.vertexProps)x.dir[0]===0&&x.dir[1]===0||aa(x.dir,x.dir);this.tessellate(g)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[o,c]=i;return wi(this.vertices[this.edges[o].a].height,this.vertices[this.edges[o].b].height,c)}computeSlopeNormal(e,i){const o=this.getClosestEdge(e);if(!o)return ui(0,0,1);const c=o[0],m=this.edges[c],g=this.edgeProps[c].vec,x=ui(g[0],g[1],(this.vertices[m.b].height-this.vertices[m.a].height)*i),S=ui(x[1],-x[0],0);gr(S,S,x);const A=Qt(S);return A>0?xn(S,S,1/A):ri(S,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,o=Number.POSITIVE_INFINITY,c=0;const[m,g,x,S,A,M,P]=this._tmpVec2;_a(P,e.x,e.y);const k=new In(P,null);for(let U=0;U<this.edges.length;U++){const V=this.edges[U],q=this.edgeProps[U].dir;k.dir=q;const J=this.vertices[V.a].position,ee=this.vertices[V.b].position,ae=k.intersectsPlane(J,this.vertexProps[V.a].dir,m),le=k.intersectsPlane(ee,this.vertexProps[V.b].dir,g);if(!ae||!le)continue;Vr(x,g,m),Vr(S,P,m);const de=wo(x,x),Re=de>0?wo(S,x)/de:0,Se=X(Re,0,1),Pe=Math.abs((Re-Se)*this.edgeProps[U].len);Vr(A,P,J),_a(M,q[1],-q[0]);const ke=Pe+Math.abs(wo(A,M));ke<o&&(i=U,o=ke,c=Se)}return[i,c]}tessellate(e){const i=Dt(),o=Dt(),c=Dt(),m=Dt();for(let g=this.edges.length-1;g>=0;--g){const x=this.edges[g].a,S=this.edges[g].b,{position:A,height:M,extent:P}=this.vertices[x],{position:k,height:U,extent:V}=this.vertices[S],q=this.vertexProps[x].dir,J=this.vertexProps[S].dir;if(ri(i,A[0]/e,A[1]/e,M),ri(o,k[0]/e,k[1]/e,U),ri(c,q[1],-q[0],0),xn(c,c,P),ri(m,J[1],-J[0],0),xn(m,m,V),this.distSqLines(ui(i[0]+.5*c[0],i[1]+.5*c[1],i[2]+.5*c[2]),ui(o[0]-.5*m[0],o[1]-.5*m[1],o[2]-.5*m[2]),ui(i[0]-.5*c[0],i[1]-.5*c[1],i[2]-.5*c[2]),ui(o[0]+.5*m[0],o[1]+.5*m[1],o[2]+.5*m[2]))<=.0025000000000000005)continue;const ee=this.vertices.length,ae=Ga(Un(),A,k);this.vertices.push({position:xr(ae,ae,.5),height:.5*(M+U),extent:.5*(P+V)});const le=Ga(Un(),q,J);this.vertexProps.push({dir:aa(le,le)}),this.edges.splice(g,1),this.edgeProps.splice(g,1),this.edges.push({a:x,b:ee}),this.edges.push({a:ee,b:S});const de=Vr(Un(),this.vertices[ee].position,A),Re=_n(de),Se={vec:de,dir:xr(Un(),de,1/Re),len:Re};this.edgeProps.push(Se),this.edgeProps.push(Se)}}distSqLines(e,i,o,c){const m=En(Dt(),i,e),g=En(Dt(),c,o),x=En(Dt(),e,o),S=Rn(m,m),A=Rn(m,g),M=Rn(m,x),P=Rn(g,g),k=Rn(g,x),U=S*P-A*A;if(U===0)return Aa(za(m,o,c,Rn(x,g)/Rn(g,g)),e);const V=(S*k-A*M)/U;return Aa(za(m,e,i,(A*k-M*P)/U),za(g,o,c,V))}}class Fi{static parseFrom(e,i){const o=Bi.parse(e);if(!o)return[];let{vertices:c,features:m}=o;const g=1/De(i);m.sort((M,P)=>M.id-P.id),c.sort((M,P)=>M.id-P.id||M.idx-P.idx),c=c.filter((M,P,k)=>P===k.findIndex(U=>U.id===M.id&&U.idx===M.idx));const x=new Array;let S=0;const A=c.length;for(const M of m){if(M.constantHeight){x.push(new Xn(M.id,M.bounds,M.constantHeight));continue}for(;S!==A&&c[S].id<M.id;)S++;if(S===A||c[S].id!==M.id)continue;const P=new Array,k=new Array,U=S;for(;S!==A&&c[S].id===M.id;){const V=c[S];if(P.push({position:V.position,height:V.height,extent:V.extent}),S!==U&&c[S-1].idx===V.idx-1){const q=S-U;k.push({a:q-1,b:q})}S++}x.push(new Xn(M.id,M.bounds,void 0,P,k,g))}return x}static getElevationFeature(e,i){if(!i)return;const o=+e.properties[Jt];return Number.isNaN(o)?void 0:i.find(c=>c.id===o)}}class zn{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*Lt,this.yOffset=(e.y*this.zScale-i.y)*Lt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,o){const c=this.constantElevation(i,o);return c??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),o))}computeBiasedHeight(e,i){return i<=0?e:e+i*he(0,i,e>=0?e:Math.abs(.5*e))}}ai(Xn,"ElevationFeature");class $r{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Wo,this.indexArray=new ar,this.segments=new ta,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Uu),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,o,c){}populate(e,i,o,c){const m=this.layers[0],g=[];let x=null;m.type==="circle"&&(x=m.layout.get("circle-sort-key"));for(const{feature:A,id:M,index:P,sourceLayerIndex:k}of e){const U=this.layers[0]._featureFilter.needGeometry,V=Je(A,U);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),V,o))continue;const q=x?x.evaluate(V,{},o):void 0,J={id:M,properties:A.properties,type:A.type,sourceLayerIndex:k,index:P,geometry:U?V.geometry:lt(A,o,c),patterns:{},sortKey:q};g.push(J)}x&&g.sort((A,M)=>A.sortKey-M.sortKey);let S=null;c.projection.name==="globe"&&(this.globeExtVertexArray=new vg,S=c.projection);for(const A of g){const{geometry:M,index:P,sourceLayerIndex:k}=A,U=e[P].feature;this.addFeature(A,M,P,i.availableImages,o,S,i.brightness,i.elevationFeatures),i.featureIndex.insert(U,M,P,k,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,o,c,m,g,x){this.programConfigurations.updatePaintArrays(e,i,m,o,c,g,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,yx.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Sg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,o,c,m,g,x,S){let A;this.elevationMode!=="none"&&(A=Fi.getElevationFeature(e,S));for(const M of i)for(const P of M){const k=P.x,U=P.y;if(k<0||k>=Lt||U<0||U>=Lt)continue;if(g){const J=g.projectTilePoint(k,U,m),ee=g.upVector(m,k,U);this.addGlobeExtVertex(J,ee),this.addGlobeExtVertex(J,ee),this.addGlobeExtVertex(J,ee),this.addGlobeExtVertex(J,ee)}const V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),q=V.vertexLength;if(this.addCircleVertex(k,U,-1,-1),this.addCircleVertex(k,U,1,-1),this.addCircleVertex(k,U,1,1),this.addCircleVertex(k,U,-1,1),this.elevationMode!=="none"){const J=A?A.pointElevation(new vt(k,U)):0;this.hasElevation=this.hasElevation||J!==0;for(let ee=0;ee<4;ee++)this.elevatedLayoutVertexArray.emplaceBack(J)}this.indexArray.emplaceBack(q,q+1,q+2),this.indexArray.emplaceBack(q,q+2,q+3),V.vertexLength+=4,V.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c,m,x,void 0,this.worldview)}addCircleVertex(e,i,o,c){this.layoutVertexArray.emplaceBack(2*e+(o+1)/2,2*i+(c+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function va(n,e){for(let i=0;i<n.length;i++)if(Ao(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(Ao(n,e[i]))return!0;return!!As(n,e)}function Xr(n,e,i){return!!Ao(n,e)||!!Lo(e,n,i)}function pa(n,e){if(n.length===1)return fs(e,n[0]);for(let i=0;i<e.length;i++){const o=e[i];for(let c=0;c<o.length;c++)if(Ao(n,o[c]))return!0}for(let i=0;i<n.length;i++)if(fs(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(As(n,e[i]))return!0;return!1}function Cs(n,e,i){if(n.length>1){if(As(n,e))return!0;for(let o=0;o<e.length;o++)if(Lo(e[o],n,i))return!0}for(let o=0;o<n.length;o++)if(Lo(n[o],e,i))return!0;return!1}function As(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const o=n[i],c=n[i+1];for(let m=0;m<e.length-1;m++)if(Zo(o,c,e[m],e[m+1]))return!0}return!1}function Zo(n,e,i,o){return Yi(n,i,o)!==Yi(e,i,o)&&Yi(n,e,i)!==Yi(n,e,o)}function es(n,e,i){return(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x)}function nl(n,e,i,o){const c=es(n,e,o),m=es(n,e,i);if(Math.sign(c)===Math.sign(m))return;const g=es(i,o,n),x=g+m-c;return Math.sign(g)!==Math.sign(x)?[g/(g-x),m/(m-c)]:void 0}function Lo(n,e,i){const o=i*i;if(e.length===1)return n.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(rl(n,e[c-1],e[c])<o)return!0;return!1}function rl(n,e,i){const o=e.distSqr(i);if(o===0)return n.distSqr(e);const c=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/o;return n.distSqr(c<0?e:c>1?i:i.sub(e)._mult(c)._add(e))}function fs(n,e){let i,o,c,m=!1;for(let g=0;g<n.length;g++){i=n[g];for(let x=0,S=i.length-1;x<i.length;S=x++)o=i[x],c=i[S],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(m=!m)}return m}function Ao(n,e){let i=!1;for(let o=0,c=n.length-1;o<n.length;c=o++){const m=n[o],g=n[c];m.y>e.y!=g.y>e.y&&e.x<(g.x-m.x)*(e.y-m.y)/(g.y-m.y)+m.x&&(i=!i)}return i}function ca(n,e,i,o,c){for(const g of n)if(e<=g.x&&i<=g.y&&o>=g.x&&c>=g.y)return!0;const m=[new vt(e,i),new vt(e,c),new vt(o,c),new vt(o,i)];if(n.length>2){for(const g of m)if(Ao(n,g))return!0}for(let g=0;g<n.length-1;g++)if(Ea(n[g],n[g+1],m))return!0;return!1}function Ea(n,e,i){const o=i[0],c=i[2];if(n.x<o.x&&e.x<o.x||n.x>c.x&&e.x>c.x||n.y<o.y&&e.y<o.y||n.y>c.y&&e.y>c.y)return!1;const m=Yi(n,e,i[0]);return m!==Yi(n,e,i[1])||m!==Yi(n,e,i[2])||m!==Yi(n,e,i[3])}function br(n,e,i,o,c,m){let g=e.y-n.y,x=n.x-e.x;if(m=m||0){const S=g*g+x*x;if(S===0)return!0;const A=Math.sqrt(S);g/=A,x/=A}return!((i.x-n.x)*g+(i.y-n.y)*x-m<0||(o.x-n.x)*g+(o.y-n.y)*x-m<0||(c.x-n.x)*g+(c.y-n.y)*x-m<0)}function ka(n,e,i,o,c,m,g){return!(br(n,e,o,c,m,g)||br(e,i,o,c,m,g)||br(i,n,o,c,m,g)||br(o,c,n,e,i,g)||br(c,m,n,e,i,g)||br(m,o,n,e,i,g))}function Ro(n,e,i){const o=e.paint.get(n).value;return o.kind==="constant"?o.value:i.programConfigurations.get(e.id).getMaxValue(n)}function ia(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function El(n,e,i,o,c){if(!e[0]&&!e[1])return n;const m=vt.convert(e)._mult(c);i==="viewport"&&m._rotate(-o);const g=[];for(let x=0;x<n.length;x++)g.push(n[x].sub(m));return g}function Sf(n,e,i,o){const c=vt.convert(n)._mult(o);return e==="viewport"&&c._rotate(-i),c}let Zc,Xc;function Yc(n,e,i){var o=2*Math.PI*6378137/256/Math.pow(2,i);return[n*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}ai($r,"CircleBucket",{omit:["layers"]});class Cl{constructor(e,i,o){this.z=e,this.x=i,this.y=o,this.key=Rs(0,e,e,i,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const o=function(m,g,x){var S=Yc(256*m,256*(g=Math.pow(2,x)-g-1),x),A=Yc(256*(m+1),256*(g+1),x);return S[0]+","+S[1]+","+A[0]+","+A[1]}(this.x,this.y,this.z),c=function(m,g,x){let S,A="";for(let M=m;M>0;M--)S=1<<M-1,A+=(g&S?1:0)+(x&S?2:0);return A}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",o)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Kc{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Rs(e,i.z,i.z,i.x,i.y)}}class vo{constructor(e,i,o,c,m){this.overscaledZ=e,this.wrap=i,this.canonical=new Cl(o,+c,+m),this.key=i===0&&e===o?this.canonical.key:Rs(i,e,o,c,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new vo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vo(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Rs(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return Rs(this.wrap*+i,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new vo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new vo(i,this.wrap,i,o,c),new vo(i,this.wrap,i,o+1,c),new vo(i,this.wrap,i,o,c+1),new vo(i,this.wrap,i,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new vo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new vo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Kc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Rs(n,e,i,o,c){const m=1<<Math.min(i,22);let g=m*(c%m)+o%m;return n&&i<22&&(g+=m*m*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*g+i)+(e-i)}const Cd=[n=>{let e=n.canonical.x-1,i=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,i--),new vo(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,i=n.wrap;return e===1<<n.canonical.z&&(e=0,i++),new vo(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>new vo(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new vo(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];ai(Cl,"CanonicalTileID"),ai(vo,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const yy=dn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ag}=yy,OT=dn([{name:"a_pos_3",components:3,type:"Int16"}]);var Hb=dn([{name:"a_pos",type:"Int16",components:2}]);function Tx(n){return n*Bs/L}const ZC=[new un([b,b,b],[T,T,T]),new un([b,b,b],[0,0,T]),new un([0,b,b],[T,0,T]),new un([b,0,b],[0,T,T]),new un([0,0,b],[T,T,T])];function kT(n,e,i,o=!0){const c=xn([],n._camera.position,n.worldSize),m=[e,i,1,1];Fa(m,m,n.pixelMatrixInverse),Ra(m,m,1/m[3]);const g=Vi([],Pr([],m,c)),x=n.globeMatrix,S=[x[12],x[13],x[14]],A=Pr([],S,c),M=Qt(A),P=Vi([],A),k=n.worldSize/(2*Math.PI),U=Rn(P,g),V=Math.asin(k/M);if(V<Math.acos(U)){if(!o)return null;const rt=[],qe=[];xn(rt,g,M/U),Vi(qe,Pr(qe,rt,A)),Vi(g,zi(g,A,xn(g,qe,Math.tan(V)*M)))}const q=[];new tn(c,g).closestPointOnSphere(S,k,q);const J=Vi([],Kr(x,0)),ee=Vi([],Kr(x,1)),ae=Vi([],Kr(x,2)),le=Rn(J,q),de=Rn(ee,q),Re=Rn(ae,q),Se=Za(Math.asin(-de/k));let Pe=Za(Math.atan2(le,Re));Pe=n.center.lng+function(rt,qe){const ot=(qe-rt+180)%360-180;return ot<-180?ot+360:ot}(n.center.lng,Pe);const ke=re(Pe),Fe=X(te(Se),0,1);return new Ge(ke,Fe)}class XC{constructor(e,i,o){this.a=Pr([],e,o),this.b=Pr([],i,o),this.center=o;const c=Vi([],this.a),m=Vi([],this.b);this.angle=Math.acos(Rn(c,m))}}function $b(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(o,c,m,g){const x=Math.sin(m);return o*(Math.sin((1-g)*m)/x)+c*(Math.sin(g*m)/x)}(n.a[e],n.b[e],n.angle,X(i,0,1))+n.center[e]}function Lh(n){if(n.z<=1)return ZC[n.z+2*n.y+n.x];const e=Al(Sx(n));return un.fromPoints(e)}function Ad(n,e,i){return xn(n,n,1-i),mr(n,n,e,i)}function LT(n,e,i){for(const o of n)Bn(o,o,e),xn(o,o,i)}function zT(n,e,i,o){const c=e/n.worldSize,m=n.globeMatrix;if(i.z<=1){const Fe=Lh(i).getCorners();return LT(Fe,m,c),un.fromPoints(Fe)}const g=Sx(i,o),x=Al(g,Bs+Tx(n._tileCoverLift));LT(x,m,c);const S=Number.MAX_VALUE,A=[-S,-S,-S],M=[S,S,S];if(g.contains(n.center)){for(const qe of x)wr(M,M,qe),Jn(A,A,qe);A[2]=0;const Fe=n.point,rt=[Fe.x*c,Fe.y*c,0];return wr(M,M,rt),Jn(A,A,rt),new un(M,A)}if(n._tileCoverLift>0){for(const Fe of x)wr(M,M,Fe),Jn(A,A,Fe);return new un(M,A)}const P=[m[12]*c,m[13]*c,m[14]*c],k=g.getCenter(),U=X(n.center.lat,-_e,_e),V=X(k.lat,-_e,_e),q=re(n.center.lng),J=te(U);let ee=q-re(k.lng);const ae=J-te(V);ee>.5?ee-=1:ee<-.5&&(ee+=1);let le=0;Math.abs(ee)>Math.abs(ae)?le=ee>=0?1:3:(le=ae>=0?0:2,mr(P,P,[m[4]*c,m[5]*c,m[6]*c],-Math.sin(cn(ae>=0?g.getSouth():g.getNorth()))*Bs));const de=x[le],Re=x[(le+1)%4],Se=new XC(de,Re,P),Pe=[$b(Se,0)||de[0],$b(Se,1)||de[1],$b(Se,2)||de[2]],ke=Id(n.zoom);if(ke>0){const Fe=function({x:qe,y:ot,z:ht},yt,Tt,Et,pt){const St=1/(1<<ht);let tt=qe*St,Qe=tt+St,xt=ot*St,wt=xt+St,_t=0;const mt=(tt+Qe)/2-Et;return mt>.5?_t=-1:mt<-.5&&(_t=1),tt=((tt+_t)*yt-(Et*=yt))*Tt+Et,Qe=((Qe+_t)*yt-Et)*Tt+Et,xt=(xt*yt-(pt*=yt))*Tt+pt,wt=(wt*yt-pt)*Tt+pt,[[tt,wt,0],[Qe,wt,0],[Qe,xt,0],[tt,xt,0]]}(i,e,n._pixelsPerMercatorPixel,q,J);for(let qe=0;qe<x.length;qe++)Ad(x[qe],Fe[qe],ke);const rt=zi([],Fe[le],Fe[(le+1)%4]);xn(rt,rt,.5),Ad(Pe,rt,ke)}for(const Fe of x)wr(M,M,Fe),Jn(A,A,Fe);return M[2]=Math.min(de[2],Re[2]),wr(M,M,Pe),Jn(A,A,Pe),new un(M,A)}function Sx({x:n,y:e,z:i},o=!1){const c=1/(1<<i),m=new j(me(n*c),e===(1<<i)-1&&o?-90:ce((e+1)*c)),g=new j(me((n+1)*c),e===0&&o?90:ce(e*c));return new B(m,g)}function Al(n,e=Bs){const i=cn(n.getNorth()),o=cn(n.getSouth()),c=Math.cos(i),m=Math.cos(o),g=Math.sin(i),x=Math.sin(o),S=n.getWest(),A=n.getEast();return[R(m,x,S,e),R(m,x,A,e),R(c,g,A,e),R(c,g,S,e)]}function Rd(n,e,i,o){const c=1<<i.z,m=(n/Lt+i.x)/c;return D(ce((e/Lt+i.y)/c),me(m),o)}function vy({min:n,max:e}){return a/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const FT=new Float64Array(16);function xy(n){const e=vy(n),i=oi(FT,[e,e,e]);return He(i,i,Cn([],n.min))}function Wb(n){const e=(o=n.min,(i=FT)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=o[0],i[13]=o[1],i[14]=o[2],i[15]=1,i);var i,o;const c=1/vy(n);return Xe(e,e,[c,c,c])}function qb(n){const e=Lt/(2*Math.PI);return n/(2*Math.PI)/e}function NT(n,e){return Lt/(512*Math.pow(2,n))*vy(Lh(e))}function Zb(n,e,i,o,c){const m=qb(i),g=[n,e,-i/(2*Math.PI)],x=be(new Float64Array(16));return He(x,x,g),Xe(x,x,[m,m,m]),it(x,x,cn(-c)),kt(x,x,cn(-o)),x}function Id(n){return he(f,t,n)}function BT(n,e){const i=D(e.lat,e.lng),o=function(V){const q=D(V._center.lat,V._center.lng);let J=gr([],ui(0,1,0),q);const ee=yi([],-V.angle,q);J=Bn(J,J,ee),yi(ee,-V._pitch,J);const ae=Vi([],q);return xn(ae,ae,Tx(V.cameraToCenterDistance/V.pixelsPerMeter)),Bn(ae,ae,ee),zi([],q,ae)}(n);return g=(c=En([],o,i))[0],x=c[1],S=c[2],A=(m=i)[0],M=m[1],P=m[2],U=(k=Math.sqrt((g*g+x*x+S*S)*(A*A+M*M+P*P)))&&Rn(c,m)/k,Math.acos(Math.min(Math.max(U,-1),1));var c,m,g,x,S,A,M,P,k,U}function Xb(n,e){return BT(n,e)>Math.PI/2*1.01}const Yb=cn(85),Kb=Math.cos(Yb),YC=Math.sin(Yb),KC=pe(),UT=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function VT(n,e,i,o,c,m,g,x,S){if(m&&n.queryGeometry.isAboveHorizon)return!1;m&&(S*=n.pixelToTileUnitsFactor);const A=n.tileID.canonical,M=i.projection.upVectorScale(A,i.center.lat,i.worldSize).metersToTile;for(const P of e)for(const k of P){const U=k.add(x),V=c&&i.elevation?i.elevation.exaggeration()*c.getElevationAt(U.x,U.y,!0):0,q=i.projection.projectTilePoint(U.x,U.y,A);if(V>0){const le=i.projection.upVector(A,U.x,U.y);q.x+=le[0]*M*V,q.y+=le[1]*M*V,q.z+=le[2]*M*V}const J=m?U:JC(q.x,q.y,q.z,o),ee=m?n.tilespaceRays.map(le=>Jb(le,V)):n.queryGeometry.screenGeometry,ae=Fa([],[q.x,q.y,q.z,1],o);if(!g&&m?S*=ae[3]/i.cameraToCenterDistance:g&&!m&&(S*=i.cameraToCenterDistance/ae[3]),m){const le=ce((k.y/Lt+A.y)/(1<<A.z));S/=i.projection.pixelsPerMeter(le,1)/se(1,le)}if(Xr(ee,J,S))return!0}return!1}function JC(n,e,i,o){const c=Fa([],[n,e,i,1],o);return new vt(c[0]/c[3],c[1]/c[3])}const jT=ui(0,0,0),Rg=ui(0,0,1);function Jb(n,e){const i=Dt();return jT[2]=e,n.intersectsPlane(jT,Rg,i),new vt(i[0],i[1])}class Ig extends $r{}let Ex,GT,HT,Qb;function $T(n,{width:e,height:i},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*i*o)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*i*o);return n.width=e,n.height=i,n.data=c,n}function by(n,e,i){const{width:o,height:c}=e;o===n.width&&c===n.height||(Ef(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,o),height:Math.min(n.height,c)},i,null),n.width=o,n.height=c,n.data=e.data)}function Ef(n,e,i,o,c,m,g,x){if(c.width===0||c.height===0)return e;if(c.width>n.width||c.height>n.height||i.x>n.width-c.width||i.y>n.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const S=n.data,A=e.data,M=m===4&&x;for(let P=0;P<c.height;P++){const k=((i.y+P)*n.width+i.x)*m,U=((o.y+P)*e.width+o.x)*m;if(M)for(let V=0;V<c.width;V++){const q=k+V*m+3,J=U+V*m;A[J+0]=255,A[J+1]=255,A[J+2]=255,A[J+3]=S[q]}else if(g)for(let V=0;V<c.width;V++){const q=k+V*m,J=U+V*m,ee=new Qi(S[q+0]/255,S[q+1]/255,S[q+2]/255,S[q+3]).toNonPremultipliedRenderColor(g).toArray();A[J+0]=ee[0],A[J+1]=ee[1],A[J+2]=ee[2],A[J+3]=ee[3]}else for(let V=0;V<c.width*m;V++)A[U+V]=S[k+V]}return e}ai(Ig,"HeatmapBucket",{omit:["layers"]});class zh{constructor(e,i){$T(this,e,1,i)}resize(e){by(this,new zh(e),1)}clone(){return new zh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,c,m){Ef(e,i,o,c,m,1,null)}}class Xo{constructor(e,i){$T(this,e,4,i)}resize(e){by(this,new Xo(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Xo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,o,c,m,g,x){Ef(e,i,o,c,m,4,g,x)}}class wy{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Dg(n){const e={},i=n.resolution||256,o=n.clips?n.clips.length:1,c=n.image||new Xo({width:i,height:o}),m=(g,x,S)=>{e[n.evaluationKey]=S;const A=n.expression.evaluate(e),M=A?A.toNonPremultipliedRenderColor(null):null;M&&(c.data[g+x+0]=Math.floor(255*M.r),c.data[g+x+1]=Math.floor(255*M.g),c.data[g+x+2]=Math.floor(255*M.b),c.data[g+x+3]=Math.floor(255*M.a))};if(n.clips)for(let g=0,x=0;g<o;++g,x+=4*i)for(let S=0,A=0;S<i;S++,A+=4){const M=S/(i-1),{start:P,end:k}=n.clips[g];m(x,A,P*(1-M)+k*M)}else for(let g=0,x=0;g<i;g++,x+=4)m(0,x,g/(i-1));return c}ai(zh,"AlphaImage"),ai(Xo,"RGBAImage");const WT=dn([{name:"a_pos",components:2,type:"Int16"}],4),qT=dn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),ZT=dn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),XT=dn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Zp(n,e,i=2){const o=e&&e.length,c=o?e[0]*i:n.length;let m=Dd(n,0,c,i,!0);const g=[];if(!m||m.next===m.prev)return g;let x,S,A;if(o&&(m=function(M,P,k,U){const V=[];for(let q=0,J=P.length;q<J;q++){const ee=Dd(M,P[q]*U,q<J-1?P[q+1]*U:M.length,U,!1);ee===ee.next&&(ee.steiner=!0),V.push(tw(ee))}V.sort(eA);for(let q=0;q<V.length;q++)k=KT(V[q],k);return k}(n,e,m,i)),n.length>80*i){x=n[0],S=n[1];let M=x,P=S;for(let k=i;k<c;k+=i){const U=n[k],V=n[k+1];U<x&&(x=U),V<S&&(S=V),U>M&&(M=U),V>P&&(P=V)}A=Math.max(M-x,P-S),A=A!==0?32767/A:0}return Ty(m,g,i,x,S,A,0),g}function Dd(n,e,i,o,c){let m;if(c===function(g,x,S,A){let M=0;for(let P=x,k=S-A;P<S;P+=A)M+=(g[k]-g[P])*(g[P+1]+g[k+1]),k=P;return M}(n,e,i,o)>0)for(let g=e;g<i;g+=o)m=iw(g/o|0,n[g],n[g+1],m);else for(let g=i-o;g>=e;g-=o)m=iw(g/o|0,n[g],n[g+1],m);return m&&Cf(m,m.next)&&(Cy(m),m=m.next),m}function Xp(n,e){if(!n)return n;e||(e=n);let i,o=n;do if(i=!1,o.steiner||!Cf(o,o.next)&&xo(o.prev,o,o.next)!==0)o=o.next;else{if(Cy(o),o=e=o.prev,o===o.next)break;i=!0}while(i||o!==e);return e}function Ty(n,e,i,o,c,m,g){if(!n)return;!g&&m&&function(S,A,M,P){let k=S;do k.z===0&&(k.z=Ya(k.x,k.y,A,M,P)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==S);k.prevZ.nextZ=null,k.prevZ=null,function(U){let V,q=1;do{let J,ee=U;U=null;let ae=null;for(V=0;ee;){V++;let le=ee,de=0;for(let Se=0;Se<q&&(de++,le=le.nextZ,le);Se++);let Re=q;for(;de>0||Re>0&&le;)de!==0&&(Re===0||!le||ee.z<=le.z)?(J=ee,ee=ee.nextZ,de--):(J=le,le=le.nextZ,Re--),ae?ae.nextZ=J:U=J,J.prevZ=ae,ae=J;ee=le}ae.nextZ=null,q*=2}while(V>1)}(k)}(n,o,c,m);let x=n;for(;n.prev!==n.next;){const S=n.prev,A=n.next;if(m?Sy(n,o,c,m):QC(n))e.push(S.i,n.i,A.i),Cy(n),n=A.next,x=A.next;else if((n=A)===x){g?g===1?Ty(n=ew(Xp(n),e),e,i,o,c,m,2):g===2&&YT(n,e,i,o,c,m):Ty(Xp(n),e,i,o,c,m,1);break}}}function QC(n){const e=n.prev,i=n,o=n.next;if(xo(e,i,o)>=0)return!1;const c=e.x,m=i.x,g=o.x,x=e.y,S=i.y,A=o.y,M=Math.min(c,m,g),P=Math.min(x,S,A),k=Math.max(c,m,g),U=Math.max(x,S,A);let V=o.next;for(;V!==e;){if(V.x>=M&&V.x<=k&&V.y>=P&&V.y<=U&&Md(c,x,m,S,g,A,V.x,V.y)&&xo(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function Sy(n,e,i,o){const c=n.prev,m=n,g=n.next;if(xo(c,m,g)>=0)return!1;const x=c.x,S=m.x,A=g.x,M=c.y,P=m.y,k=g.y,U=Math.min(x,S,A),V=Math.min(M,P,k),q=Math.max(x,S,A),J=Math.max(M,P,k),ee=Ya(U,V,e,i,o),ae=Ya(q,J,e,i,o);let le=n.prevZ,de=n.nextZ;for(;le&&le.z>=ee&&de&&de.z<=ae;){if(le.x>=U&&le.x<=q&&le.y>=V&&le.y<=J&&le!==c&&le!==g&&Md(x,M,S,P,A,k,le.x,le.y)&&xo(le.prev,le,le.next)>=0||(le=le.prevZ,de.x>=U&&de.x<=q&&de.y>=V&&de.y<=J&&de!==c&&de!==g&&Md(x,M,S,P,A,k,de.x,de.y)&&xo(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;le&&le.z>=ee;){if(le.x>=U&&le.x<=q&&le.y>=V&&le.y<=J&&le!==c&&le!==g&&Md(x,M,S,P,A,k,le.x,le.y)&&xo(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;de&&de.z<=ae;){if(de.x>=U&&de.x<=q&&de.y>=V&&de.y<=J&&de!==c&&de!==g&&Md(x,M,S,P,A,k,de.x,de.y)&&xo(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function ew(n,e){let i=n;do{const o=i.prev,c=i.next.next;!Cf(o,c)&&Mg(o,i,i.next,c)&&Fh(o,c)&&Fh(c,o)&&(e.push(o.i,i.i,c.i),Cy(i),Cy(i.next),i=n=c),i=i.next}while(i!==n);return Xp(i)}function YT(n,e,i,o,c,m){let g=n;do{let x=g.next.next;for(;x!==g.prev;){if(g.i!==x.i&&JT(g,x)){let S=QT(g,x);return g=Xp(g,g.next),S=Xp(S,S.next),Ty(g,e,i,o,c,m,0),void Ty(S,e,i,o,c,m,0)}x=x.next}g=g.next}while(g!==n)}function eA(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function KT(n,e){const i=function(c,m){let g=m;const x=c.x,S=c.y;let A,M=-1/0;if(Cf(c,g))return g;do{if(Cf(c,g.next))return g.next;if(S<=g.y&&S>=g.next.y&&g.next.y!==g.y){const q=g.x+(S-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(q<=x&&q>M&&(M=q,A=g.x<g.next.x?g:g.next,q===x))return A}g=g.next}while(g!==m);if(!A)return null;const P=A,k=A.x,U=A.y;let V=1/0;g=A;do{if(x>=g.x&&g.x>=k&&x!==g.x&&Ey(S<U?x:M,S,k,U,S<U?M:x,S,g.x,g.y)){const q=Math.abs(S-g.y)/(x-g.x);Fh(g,c)&&(q<V||q===V&&(g.x>A.x||g.x===A.x&&tA(A,g)))&&(A=g,V=q)}g=g.next}while(g!==P);return A}(n,e);if(!i)return e;const o=QT(i,n);return Xp(o,o.next),Xp(i,i.next)}function tA(n,e){return xo(n.prev,n,e.prev)<0&&xo(e.next,n,n.next)<0}function Ya(n,e,i,o,c){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*c|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*c|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function tw(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function Ey(n,e,i,o,c,m,g,x){return(c-g)*(e-x)>=(n-g)*(m-x)&&(n-g)*(o-x)>=(i-g)*(e-x)&&(i-g)*(m-x)>=(c-g)*(o-x)}function Md(n,e,i,o,c,m,g,x){return!(n===g&&e===x)&&Ey(n,e,i,o,c,m,g,x)}function JT(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,o){let c=i;do{if(c.i!==i.i&&c.next.i!==i.i&&c.i!==o.i&&c.next.i!==o.i&&Mg(c,c.next,i,o))return!0;c=c.next}while(c!==i);return!1}(n,e)&&(Fh(n,e)&&Fh(e,n)&&function(i,o){let c=i,m=!1;const g=(i.x+o.x)/2,x=(i.y+o.y)/2;do c.y>x!=c.next.y>x&&c.next.y!==c.y&&g<(c.next.x-c.x)*(x-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==i);return m}(n,e)&&(xo(n.prev,n,e.prev)||xo(n,e.prev,e))||Cf(n,e)&&xo(n.prev,n,n.next)>0&&xo(e.prev,e,e.next)>0)}function xo(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function Cf(n,e){return n.x===e.x&&n.y===e.y}function Mg(n,e,i,o){const c=Yp(xo(n,e,i)),m=Yp(xo(n,e,o)),g=Yp(xo(i,o,n)),x=Yp(xo(i,o,e));return c!==m&&g!==x||!(c!==0||!Cx(n,i,e))||!(m!==0||!Cx(n,o,e))||!(g!==0||!Cx(i,n,o))||!(x!==0||!Cx(i,e,o))}function Cx(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Yp(n){return n>0?1:n<0?-1:0}function Fh(n,e){return xo(n.prev,n,n.next)<0?xo(n,e,n.next)>=0&&xo(n,n.prev,e)>=0:xo(n,e,n.prev)<0||xo(n,n.next,e)<0}function QT(n,e){const i=nw(n.i,n.x,n.y),o=nw(e.i,e.x,e.y),c=n.next,m=e.prev;return n.next=e,e.prev=n,i.next=c,c.prev=i,o.next=i,i.prev=o,m.next=o,o.prev=m,o}function iw(n,e,i,o){const c=nw(n,e,i);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function Cy(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function nw(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Is(n,e){const i=n.length;if(i<=1)return[n];const o=[];let c,m;for(let g=0;g<i;g++){const x=ln(n[g]);x!==0&&(n[g].area=Math.abs(x),m===void 0&&(m=x<0),m===x<0?(c&&o.push(c),c=[n[g]]):c.push(n[g]))}if(c&&o.push(c),e>1)for(let g=0;g<o.length;g++)o[g].length<=e||(Cu(o[g],e,1,o[g].length-1,Ay),o[g]=o[g].slice(0,e));return o}function Ay(n,e){return e.area-n.area}function Ry(n,e,i=1){if(!n)return null;const o=typeof n=="string"?oo.from(n).getPrimary():n.getPrimary(),c=typeof n=="string"?null:n.getSecondary();for(const m of[o,c]){if(!m)continue;const g=m.id.toString();e.has(g)||e.set(g,[]),m.scaleSelf(i),e.get(g).push(m)}return{primary:o.toString(),secondary:c?c.toString():null}}function Nh(n,e,i,o){const c=o.patternDependencies;let m=!1;for(const g of e){const x=g.paint.get(`${n}-pattern`);x.isConstant()||(m=!0),Ry(x.constantOr(null),c,i)&&(m=!0)}return m}function Ax(n,e,i,o,c,m){const g=m.patternDependencies;for(const x of e){const S=x.paint.get(`${n}-pattern`).value;if(S.kind!=="constant"){let A=S.evaluate({zoom:o},i,{},m.availableImages);A=A&&A.name?A.name:A;const M=Ry(A,g,c);if(!M)continue;const{primary:P,secondary:k}=M;P&&(i.patterns[x.id]=[P,k].filter(Boolean))}}return i}class Af{constructor(){this.polygons=new Map}add(e,...i){const o=this.polygons.get(e);o?o.push(...i):this.polygons.set(e,i)}merge(e){for(const[i,o]of e.polygons)this.add(i,...o)}}class Rl{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=Lt&&i>=Lt}static evaluate(e){if(e.length===0)return new Rl;let i=[];for(const S of e)i.push(...S.portals);if(i.length===0)return new Rl;for(const S of i){const A=S.va,M=S.vb;(Rl.isOnBorder(A.x,M.x)||Rl.isOnBorder(A.y,M.y))&&(S.type="border")}const o=i.filter(S=>S.type!=="unevaluated"),c=i.filter(S=>S.type==="unevaluated");if(c.length===0)return new Rl;c.sort((S,A)=>S.hash===A.hash?S.isTunnel===A.isTunnel?0:S.isTunnel?-1:1:S.hash<A.hash?1:-1),i=o.concat(c);let m=o.length,g=m,x=m;do if(g++,g===i.length||i[m].hash!==i[g].hash){if(g-m==2){x<m&&(i[x]=i[m],i[m]=null);const S=i[x],A=i[g-1];S.type=S.isTunnel!==A.isTunnel?"tunnel":"polygon",S.connection={a:S.connection.a,b:A.connection.a},x++}m=g}while(m!==i.length);return i.splice(x),i.sort((S,A)=>S.hash<A.hash?1:-1),{portals:i}}}ai(Rl,"ElevationPortalGraph"),ai(Af,"ElevationPolygons");class Rx{constructor(e,i,o){this.outPositions=e,this.outNormals=i,this.outIndices=o,this.vertexLookup=new Map}addVertex(e,i,o){let c=e[2];o!=null&&(c*=o);const m=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,g=this.vertexLookup.get(m);if(g!=null)return g;const x=this.outPositions.length;this.vertexLookup.set(m,x);const S=Math.trunc(16384*i[0]),A=Math.trunc(16384*i[1]),M=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],c),this.outNormals.emplaceBack(S,A,M),x}addTriangle(e,i,o){this.outIndices.emplaceBack(e,i,o)}addTriangles(e,i,o){if(e.length===0)return;const c=o.length===1,m=Dt(),g=Dt();for(let x=0;x<e.length;x+=3){const S=i[e[x+0]],A=i[e[x+1]],M=i[e[x+2]],P=c?o[0]:o[e[x+1]],k=c?o[0]:o[e[x+2]];ri(m,S.x,S.y,c?o[0]:o[e[x+0]]);const U=this.addVertex(m,g);ri(m,A.x,A.y,P);const V=this.addVertex(m,g);ri(m,M.x,M.y,k);const q=this.addVertex(m,g);this.outIndices.emplaceBack(U,V,q)}}addQuad(e,i,o,c,m,g){const x=this.addVertex(e,m,g),S=this.addVertex(i,m,g),A=this.addVertex(o,m,g),M=this.addVertex(c,m,g);this.addTriangle(x,S,A),this.addTriangle(A,M,x)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Us{constructor(e,i,o,c){this.unevaluatedPortals=new Rl,this.portalPolygons=new Af,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new sy,this.vertexNormals=new ly,this.indexArray=new ar,this.tileToMeters=De(e),this.bridgeProgramConfigurations=new Ns(i,{zoom:o,lut:c},m=>m!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Ns(i,{zoom:o,lut:c},m=>m!=="fill-bridge-guard-rail-color")}addVertices(e,i){const o=this.unevalVertices.length;for(let c=0;c<e.length;c++)this.unevalVertices.push(e[c]),this.unevalHeights.push(i[c]);return o}addTriangles(e,i,o){const c=o?this.unevalTunnelTriangles:this.unevalTriangles;for(const m of e)c.push(m+i)}addRenderableRing(e,i,o,c,m,g){const x=[new vt(m.min.x,m.min.y),new vt(m.max.x,m.min.y),new vt(m.max.x,m.max.y),new vt(m.min.x,m.max.y)];for(let S=0;S<o-1;S++){const A=i+S,M=A+1,P=this.unevalVertices[A],k=this.unevalVertices[M];if(!(P.x>=m.min.x&&P.x<=m.max.x&&P.y>=m.min.y&&P.y<=m.max.y||k.x>=m.min.x&&k.x<=m.max.x&&k.y>=m.min.y&&k.y<=m.max.y||Ea(P,k,x))||this.isOnBorder(P.x,k.x)||this.isOnBorder(P.y,k.y))continue;const U=Us.computeEdgeHash(this.unevalVertices[A],this.unevalVertices[M]);let V,q=this.vertexHashLookup.get(Us.computePosHash(P));q!=null?V=q.next:(q=this.vertexHashLookup.get(Us.computePosHash(k)),V=q!=null?q.prev:U),this.unevalEdges.push({polygonIdx:e,a:A,b:M,hash:U,portalHash:V,isTunnel:c,type:"unevaluated",featureInfo:g})}}addPortalCandidates(e,i,o,c,m){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:m});const g=i[0];this.vertexHashLookup.clear();let x=Us.computeEdgeHash(g[g.length-2],g[g.length-1]);for(let S=0;S<g.length-1;S++){const A=g[S+0],M=g[S+1],P=da(M.x-A.x,M.y-A.y),k=_n(P);if(k===0)continue;let U="unevaluated";const V=c.pointElevation(A),q=c.pointElevation(M);Math.abs(V)<.01&&Math.abs(q)<.01?U="entrance":(this.isOnBorder(A.x,M.x)||this.isOnBorder(A.y,M.y))&&(U="border");const J=Us.computeEdgeHash(A,M);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:A,vb:M,vab:P,length:k,hash:J,isTunnel:o,type:U});const ee=Us.computePosHash(A);this.vertexHashLookup.set(ee,{prev:x,next:J}),x=J}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),o=k=>{k.primitiveLength=this.indexArray.length-k.primitiveOffset},c=new Rx(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const m=i(),g=i(),x=i(),S=(k,U)=>{k.sort((q,J)=>q.type===U&&J.type!==U?-1:q.type!==U&&J.type===U?1:0);const V=k.findIndex(q=>q.type!==U);return V>=0?V:k.length};let A=0;this.unevalEdges.length>0&&(A=S(this.unevalEdges,"none"),this.constructBridgeStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},this.tileToMeters)),o(x);const M=i(),P=i();if(this.unevalEdges.length>0){const k=this.unevalEdges.splice(A),U=S(k,"tunnel")+A;this.unevalEdges.push(...k),this.constructTunnelStructures(c,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},{min:A,max:U})}o(M),c.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),o(P),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),o(g),c.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),o(m),this.maskSegments=ta.simpleSegment(0,P.primitiveOffset,0,P.primitiveLength),this.depthSegments=ta.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableBridgeSegments=ta.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableTunnelSegments=ta.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.shadowCasterSegments=ta.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength)}update(e,i,o,c,m,g,x,S){this.bridgeProgramConfigurations.updatePaintArrays(e,i,m,o,c,g,x,S),this.tunnelProgramConfigurations.updatePaintArrays(e,i,m,o,c,g,x,S)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,ZT.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,XT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,o,c,m){const g=(x,S)=>{for(let A=0;A<S.length-1;A++){const M=S[A].featureIndex,P=S[A+1].vertexStart,k=e.feature(M);x.populatePaintArrays(P,k,M,{},o,i,c,void 0,m)}};g(this.bridgeProgramConfigurations,this.bridgeFeatureSections),g(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,o,c,m){const g=new Map;for(let x=c;x<m;x++){const S=o[x],A=S.a,M=S.b,P=Us.computePosHash(e[A]),k=Us.computePosHash(e[M]);let U=g.get(P);U||(U={},g.set(P,U));let V=g.get(k);V||(V={},g.set(k,V)),i[A]<=0&&i[M]<=0||(U.to=M,V.from=A)}return g}isTerminalVertex(e,i){const o=Us.computePosHash(this.unevalVertices[e]),c=i.get(o);return!c||!c.from||!c.to}constructBridgeStructures(e,i,o,c,m,g){e.clearVertexLookup();const x=this.computeVertexConnections(i,o,c,m.min,m.max),S=1/g,A=.5*S,M=(Tt,Et)=>ri(Tt,i[Et].x,i[Et].y,o[Et]*S),P=Dt(),k=Dt(),U=Dt(),V=Dt(),q=Dt(),J=(Tt,Et)=>{const pt=x.get(Us.computePosHash(i[Et])),St=pt.from,tt=pt.to;if(!St||!tt)return;M(P,St),M(k,Et),M(U,tt),Zr(V),to(P,k)||(Pr(q,k,P),Vi(V,q)),to(U,k)||(Pr(q,U,k),zi(V,V,Vi(q,q)));const Qe=mo(V);return Qe>0?xn(Tt,V,1/Qe):void 0};let ee=Number.POSITIVE_INFINITY;this.sortSubarray(c,m.min,m.max,(Tt,Et)=>Tt.featureInfo.featureIndex-Et.featureInfo.featureIndex);const ae=Dt(),le=Dt(),de=Dt(),Re=Dt(),Se=Dt(),Pe=Dt(),ke=Dt(),Fe=Dt(),rt=Dt(),qe=[Dt(),Dt(),Dt(),Dt()],ot=[Dt(),Dt(),Dt(),Dt()],ht=[{coord:new vt(0,0),height:0},{coord:new vt(0,0),height:0}],yt=(Tt,Et)=>Tt>Et;for(let Tt=m.min;Tt<m.max;Tt++){const Et=c[Tt];if(!Et.featureInfo.guardRailEnabled||!this.prepareEdgePoints(ht,i,o,Et,yt))continue;const[pt,St]=ht;if(ri(ae,pt.coord.x,pt.coord.y,S*pt.height),ri(le,St.coord.x,St.coord.y,S*St.height),to(ae,le))continue;Pr(de,le,ae),Vi(de,de);const tt=J(Fe,Et.a)||de,Qe=J(rt,Et.b)||de;ri(Re,tt[1],-tt[0],0),Vi(Re,Re),ri(Se,Qe[1],-Qe[0],0),Vi(Se,Se),gr(Fe,Re,tt),Vi(Pe,Fe),gr(Fe,Se,Qe),Vi(ke,Fe),zi(qe[0],ae,xn(Fe,Pr(Fe,Re,Pe),A)),zi(qe[1],ae,xn(Fe,zi(Fe,Re,Pe),A)),zi(qe[2],ae,xn(Fe,Pe,A)),qe[3]=ae,zi(ot[0],le,xn(Fe,Pr(Fe,Se,ke),A)),zi(ot[1],le,xn(Fe,zi(Fe,Se,ke),A)),zi(ot[2],le,xn(Fe,ke,A)),ot[3]=le,ee=this.addFeatureSection(Et.featureInfo.featureIndex,ee,this.bridgeFeatureSections,e);const xt=e.addVertex(qe[0],Re,g),wt=e.addVertex(qe[1],Re,g),_t=e.addVertex(ot[0],Se,g),mt=e.addVertex(ot[1],Se,g);e.addTriangle(xt,wt,_t),e.addTriangle(wt,mt,_t);const si=e.addVertex(qe[1],Pe,g),qt=e.addVertex(qe[2],Pe,g),Gt=e.addVertex(ot[1],ke,g),ji=e.addVertex(ot[2],ke,g);e.addTriangle(si,qt,Gt),e.addTriangle(qt,ji,Gt),Cn(Re,Re),Cn(Se,Se);const Zt=e.addVertex(qe[2],Re,g),Si=e.addVertex(qe[3],Re,g),Zi=e.addVertex(ot[2],Se,g),hn=e.addVertex(ot[3],Se,g);e.addTriangle(Zt,Si,Zi),e.addTriangle(Si,hn,Zi);const wn=this.isTerminalVertex(Et.a,x),Xi=this.isTerminalVertex(Et.b,x);pt.height<.01&&wn&&e.addQuad(qe[3],qe[2],qe[1],qe[0],Cn(tt,tt),g),St.height<.01&&Xi&&e.addQuad(ot[0],ot[1],ot[2],ot[3],Qe,g)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,o,c,m,g){e.clearVertexLookup();let x=Number.POSITIVE_INFINITY;const S=(ee,ae)=>ee.featureInfo.featureIndex-ae.featureInfo.featureIndex;this.sortSubarray(c,m.min,m.max,S),this.sortSubarray(c,g.min,g.max,S);const A=ee=>Vi(ee,ee),M=[{coord:new vt(0,0),height:0},{coord:new vt(0,0),height:0}],P=(ee,ae)=>ee<ae,k=Dt(),U=Dt(),V=Dt(),q=Dt(),J=Dt();for(let ee=m.min;ee<m.max;ee++){if(!this.prepareEdgePoints(M,i,o,c[ee],P))continue;const[ae,le]=M,de=A(ri(J,-(le.coord.y-ae.coord.y),le.coord.x-ae.coord.x,0));x=this.addFeatureSection(c[ee].featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(ri(k,ae.coord.x,ae.coord.y,ae.height),ri(U,le.coord.x,le.coord.y,le.height),ri(V,le.coord.x,le.coord.y,c[ee].isTunnel?-.1:0),ri(q,ae.coord.x,ae.coord.y,c[ee].isTunnel?-.1:0),de)}for(let ee=g.min;ee<g.max;ee++){const ae=c[ee];ae.isTunnel&&([ae.a,ae.b]=[ae.b,ae.a]);const le=i[ae.a],de=i[ae.b],Re=A(ri(J,-(de.y-le.y),de.x-le.x,0));x=this.addFeatureSection(ae.featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(ri(k,de.x,de.y,0),ri(U,le.x,le.y,0),ri(V,le.x,le.y,o[ae.a]+4),ri(q,de.x,de.y,o[ae.b]+4),Re),e.addQuad(ri(k,le.x,le.y,0),ri(U,de.x,de.y,0),ri(V,de.x,de.y,o[ae.b]+4),ri(q,le.x,le.y,o[ae.a]+4),Re)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,o,c){e.coord.x=i,e.coord.y=o,e.height=c}prepareEdgePoints(e,i,o,c,m){let g=i[c.a].x,x=i[c.a].y,S=i[c.b].x,A=i[c.b].y,M=o[c.a],P=o[c.b];const k=m(M,0),U=m(P,0);if(k&&U)return this.setElevatedPoint(e[0],g,x,M),this.setElevatedPoint(e[1],S,A,P),!0;if(!k&&!U)return!1;if(k){if(!U){const V=P/(P-M);S=wi(S,g,V),A=wi(A,x,V),P=wi(P,M,V)}}else{const V=M/(M-P);g=wi(g,S,V),x=wi(x,A,V),M=wi(M,P,V)}return this.setElevatedPoint(e[0],g,x,M),this.setElevatedPoint(e[1],S,A,P),!0}prepareEdges(e,i){if(i.length===0)return;i.sort((x,S)=>x.hash===S.hash?S.polygonIdx-x.polygonIdx:S.hash>x.hash?1:-1);let o=0,c=0,m=0,g=i[o].polygonIdx;do c++,(c===i.length||i[o].hash!==i[c].hash)&&((c-o==1||i[c-1].polygonIdx!==g)&&(m<o&&(i[m]=i[o],i[o]=null),i[m].type="none",m++),o=c,o!==i.length&&(g=i[o].polygonIdx));while(o!==i.length);if(i.splice(m),i.length!==0&&e.length!==0){i.sort((A,M)=>A.portalHash<M.portalHash?1:-1);let x=0,S=0;for(;x!==i.length&&S!==e.length;){const A=i[x],M=e[S];A.portalHash>M.hash?x++:M.hash>A.portalHash?S++:(A.type=M.type,x++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=Lt&&i>=Lt}addFeatureSection(e,i,o,c){return e!==i&&(i=e,o.push({featureIndex:e,vertexStart:c.getVertexCount()}),c.clearVertexLookup()),i}sortSubarray(e,i,o,c){const m=e.slice(i,o);m.sort(c),e.splice(i,m.length,...m)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Us.computePosHash(e))<<32n|BigInt(Us.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var Iy,Pg={exports:{}},rw=(Iy||(Iy=1,function(n,e){(function(i){function o(Ee,ve){return Ee>ve?1:Ee<ve?-1:0}var c=function(Ee,ve){Ee===void 0&&(Ee=o),ve===void 0&&(ve=!1),this._compare=Ee,this._root=null,this._size=0,this._noDuplicates=!!ve},m={size:{configurable:!0}};function g(Ee,ve,at,Bt,ct){var Ht=ct-Bt;if(Ht>0){var xi=Bt+Math.floor(Ht/2),gi={key:ve[xi],data:at[xi],parent:Ee};return gi.left=g(gi,ve,at,Bt,xi),gi.right=g(gi,ve,at,xi+1,ct),gi}return null}function x(Ee,ve,at,Bt,ct){if(!(at>=Bt)){for(var Ht=Ee[at+Bt>>1],xi=at-1,gi=Bt+1;;){do xi++;while(ct(Ee[xi],Ht)<0);do gi--;while(ct(Ee[gi],Ht)>0);if(xi>=gi)break;var Ki=Ee[xi];Ee[xi]=Ee[gi],Ee[gi]=Ki,Ki=ve[xi],ve[xi]=ve[gi],ve[gi]=Ki}x(Ee,ve,at,gi,ct),x(Ee,ve,gi+1,Bt,ct)}}c.prototype.rotateLeft=function(Ee){var ve=Ee.right;ve&&(Ee.right=ve.left,ve.left&&(ve.left.parent=Ee),ve.parent=Ee.parent),Ee.parent?Ee===Ee.parent.left?Ee.parent.left=ve:Ee.parent.right=ve:this._root=ve,ve&&(ve.left=Ee),Ee.parent=ve},c.prototype.rotateRight=function(Ee){var ve=Ee.left;ve&&(Ee.left=ve.right,ve.right&&(ve.right.parent=Ee),ve.parent=Ee.parent),Ee.parent?Ee===Ee.parent.left?Ee.parent.left=ve:Ee.parent.right=ve:this._root=ve,ve&&(ve.right=Ee),Ee.parent=ve},c.prototype._splay=function(Ee){for(;Ee.parent;){var ve=Ee.parent;ve.parent?ve.left===Ee&&ve.parent.left===ve?(this.rotateRight(ve.parent),this.rotateRight(ve)):ve.right===Ee&&ve.parent.right===ve?(this.rotateLeft(ve.parent),this.rotateLeft(ve)):ve.left===Ee&&ve.parent.right===ve?(this.rotateRight(ve),this.rotateLeft(ve)):(this.rotateLeft(ve),this.rotateRight(ve)):ve.left===Ee?this.rotateRight(ve):this.rotateLeft(ve)}},c.prototype.splay=function(Ee){for(var ve,at,Bt,ct,Ht;Ee.parent;)(at=(ve=Ee.parent).parent)&&at.parent?((Bt=at.parent).left===at?Bt.left=Ee:Bt.right=Ee,Ee.parent=Bt):(Ee.parent=null,this._root=Ee),ct=Ee.left,Ht=Ee.right,Ee===ve.left?(at&&(at.left===ve?(ve.right?(at.left=ve.right,at.left.parent=at):at.left=null,ve.right=at,at.parent=ve):(ct?(at.right=ct,ct.parent=at):at.right=null,Ee.left=at,at.parent=Ee)),Ht?(ve.left=Ht,Ht.parent=ve):ve.left=null,Ee.right=ve,ve.parent=Ee):(at&&(at.right===ve?(ve.left?(at.right=ve.left,at.right.parent=at):at.right=null,ve.left=at,at.parent=ve):(Ht?(at.left=Ht,Ht.parent=at):at.left=null,Ee.right=at,at.parent=Ee)),ct?(ve.right=ct,ct.parent=ve):ve.right=null,Ee.left=ve,ve.parent=Ee)},c.prototype.replace=function(Ee,ve){Ee.parent?Ee===Ee.parent.left?Ee.parent.left=ve:Ee.parent.right=ve:this._root=ve,ve&&(ve.parent=Ee.parent)},c.prototype.minNode=function(Ee){if(Ee===void 0&&(Ee=this._root),Ee)for(;Ee.left;)Ee=Ee.left;return Ee},c.prototype.maxNode=function(Ee){if(Ee===void 0&&(Ee=this._root),Ee)for(;Ee.right;)Ee=Ee.right;return Ee},c.prototype.insert=function(Ee,ve){var at=this._root,Bt=null,ct=this._compare;if(this._noDuplicates)for(;at;){if(Bt=at,ct(at.key,Ee)===0)return;at=ct(at.key,Ee)<0?at.right:at.left}else for(;at;)Bt=at,at=ct(at.key,Ee)<0?at.right:at.left;return at={key:Ee,data:ve,left:null,right:null,parent:Bt},Bt?ct(Bt.key,at.key)<0?Bt.right=at:Bt.left=at:this._root=at,this.splay(at),this._size++,at},c.prototype.find=function(Ee){for(var ve=this._root,at=this._compare;ve;){var Bt=at(ve.key,Ee);if(Bt<0)ve=ve.right;else{if(!(Bt>0))return ve;ve=ve.left}}return null},c.prototype.contains=function(Ee){for(var ve=this._root,at=this._compare;ve;){var Bt=at(Ee,ve.key);if(Bt===0)return!0;ve=Bt<0?ve.left:ve.right}return!1},c.prototype.remove=function(Ee){var ve=this.find(Ee);if(!ve)return!1;if(this.splay(ve),ve.left)if(ve.right){var at=this.minNode(ve.right);at.parent!==ve&&(this.replace(at,at.right),at.right=ve.right,at.right.parent=at),this.replace(ve,at),at.left=ve.left,at.left.parent=at}else this.replace(ve,ve.left);else this.replace(ve,ve.right);return this._size--,!0},c.prototype.removeNode=function(Ee){if(!Ee)return!1;if(this.splay(Ee),Ee.left)if(Ee.right){var ve=this.minNode(Ee.right);ve.parent!==Ee&&(this.replace(ve,ve.right),ve.right=Ee.right,ve.right.parent=ve),this.replace(Ee,ve),ve.left=Ee.left,ve.left.parent=ve}else this.replace(Ee,Ee.left);else this.replace(Ee,Ee.right);return this._size--,!0},c.prototype.erase=function(Ee){var ve=this.find(Ee);if(ve){this.splay(ve);var at=ve.left,Bt=ve.right,ct=null;at&&(at.parent=null,ct=this.maxNode(at),this.splay(ct),this._root=ct),Bt&&(at?ct.right=Bt:this._root=Bt,Bt.parent=ct),this._size--}},c.prototype.pop=function(){var Ee=this._root,ve=null;if(Ee){for(;Ee.left;)Ee=Ee.left;ve={key:Ee.key,data:Ee.data},this.remove(Ee.key)}return ve},c.prototype.next=function(Ee){var ve=Ee;if(ve)if(ve.right)for(ve=ve.right;ve&&ve.left;)ve=ve.left;else for(ve=Ee.parent;ve&&ve.right===Ee;)Ee=ve,ve=ve.parent;return ve},c.prototype.prev=function(Ee){var ve=Ee;if(ve)if(ve.left)for(ve=ve.left;ve&&ve.right;)ve=ve.right;else for(ve=Ee.parent;ve&&ve.left===Ee;)Ee=ve,ve=ve.parent;return ve},c.prototype.forEach=function(Ee){for(var ve=this._root,at=[],Bt=!1,ct=0;!Bt;)ve?(at.push(ve),ve=ve.left):at.length>0?(Ee(ve=at.pop(),ct++),ve=ve.right):Bt=!0;return this},c.prototype.range=function(Ee,ve,at,Bt){for(var ct=[],Ht=this._compare,xi=this._root;ct.length!==0||xi;)if(xi)ct.push(xi),xi=xi.left;else{if(Ht((xi=ct.pop()).key,ve)>0)break;if(Ht(xi.key,Ee)>=0&&at.call(Bt,xi))return this;xi=xi.right}return this},c.prototype.keys=function(){for(var Ee=this._root,ve=[],at=[],Bt=!1;!Bt;)Ee?(ve.push(Ee),Ee=Ee.left):ve.length>0?(Ee=ve.pop(),at.push(Ee.key),Ee=Ee.right):Bt=!0;return at},c.prototype.values=function(){for(var Ee=this._root,ve=[],at=[],Bt=!1;!Bt;)Ee?(ve.push(Ee),Ee=Ee.left):ve.length>0?(Ee=ve.pop(),at.push(Ee.data),Ee=Ee.right):Bt=!0;return at},c.prototype.at=function(Ee){for(var ve=this._root,at=[],Bt=!1,ct=0;!Bt;)if(ve)at.push(ve),ve=ve.left;else if(at.length>0){if(ve=at.pop(),ct===Ee)return ve;ct++,ve=ve.right}else Bt=!0;return null},c.prototype.load=function(Ee,ve,at){if(Ee===void 0&&(Ee=[]),ve===void 0&&(ve=[]),at===void 0&&(at=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Bt=Ee.length;return at&&x(Ee,ve,0,Bt-1,this._compare),this._root=g(null,Ee,ve,0,Bt),this._size=Bt,this},c.prototype.min=function(){var Ee=this.minNode(this._root);return Ee?Ee.key:null},c.prototype.max=function(){var Ee=this.maxNode(this._root);return Ee?Ee.key:null},c.prototype.isEmpty=function(){return this._root===null},m.size.get=function(){return this._size},c.createTree=function(Ee,ve,at,Bt,ct){return new c(at,ct).load(Ee,ve,Bt)},Object.defineProperties(c.prototype,m);var S=0,A=1,M=2,P=3,k=0,U=1,V=2,q=3;function J(Ee,ve,at){ve===null?(Ee.inOut=!1,Ee.otherInOut=!0):(Ee.isSubject===ve.isSubject?(Ee.inOut=!ve.inOut,Ee.otherInOut=ve.otherInOut):(Ee.inOut=!ve.otherInOut,Ee.otherInOut=ve.isVertical()?!ve.inOut:ve.inOut),ve&&(Ee.prevInResult=!ee(ve,at)||ve.isVertical()?ve.prevInResult:ve));var Bt=ee(Ee,at);Ee.resultTransition=Bt?function(ct,Ht){var xi,gi=!ct.inOut,Ki=!ct.otherInOut;switch(Ht){case k:xi=gi&&Ki;break;case U:xi=gi||Ki;break;case q:xi=gi^Ki;break;case V:xi=ct.isSubject?gi&&!Ki:Ki&&!gi}return xi?1:-1}(Ee,at):0}function ee(Ee,ve){switch(Ee.type){case S:switch(ve){case k:return!Ee.otherInOut;case U:return Ee.otherInOut;case V:return Ee.isSubject&&Ee.otherInOut||!Ee.isSubject&&!Ee.otherInOut;case q:return!0}break;case M:return ve===k||ve===U;case P:return ve===V;case A:return!1}return!1}var ae=function(Ee,ve,at,Bt,ct){this.left=ve,this.point=Ee,this.otherEvent=at,this.isSubject=Bt,this.type=ct||S,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},le={inResult:{configurable:!0}};function de(Ee,ve){return Ee[0]===ve[0]&&Ee[1]===ve[1]}ae.prototype.isBelow=function(Ee){var ve=this.point,at=this.otherEvent.point;return this.left?(ve[0]-Ee[0])*(at[1]-Ee[1])-(at[0]-Ee[0])*(ve[1]-Ee[1])>0:(at[0]-Ee[0])*(ve[1]-Ee[1])-(ve[0]-Ee[0])*(at[1]-Ee[1])>0},ae.prototype.isAbove=function(Ee){return!this.isBelow(Ee)},ae.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},le.inResult.get=function(){return this.resultTransition!==0},ae.prototype.clone=function(){var Ee=new ae(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Ee.contourId=this.contourId,Ee.resultTransition=this.resultTransition,Ee.prevInResult=this.prevInResult,Ee.isExteriorRing=this.isExteriorRing,Ee.inOut=this.inOut,Ee.otherInOut=this.otherInOut,Ee},Object.defineProperties(ae.prototype,le);var Re=11102230246251565e-32,Se=134217729,Pe=(3+8*Re)*Re;function ke(Ee,ve,at,Bt,ct){var Ht,xi,gi,Ki,Oi=ve[0],fi=Bt[0],Hn=0,yr=0;fi>Oi==fi>-Oi?(Ht=Oi,Oi=ve[++Hn]):(Ht=fi,fi=Bt[++yr]);var ki=0;if(Hn<Ee&&yr<at)for(fi>Oi==fi>-Oi?(gi=Ht-((xi=Oi+Ht)-Oi),Oi=ve[++Hn]):(gi=Ht-((xi=fi+Ht)-fi),fi=Bt[++yr]),Ht=xi,gi!==0&&(ct[ki++]=gi);Hn<Ee&&yr<at;)fi>Oi==fi>-Oi?(gi=Ht-((xi=Ht+Oi)-(Ki=xi-Ht))+(Oi-Ki),Oi=ve[++Hn]):(gi=Ht-((xi=Ht+fi)-(Ki=xi-Ht))+(fi-Ki),fi=Bt[++yr]),Ht=xi,gi!==0&&(ct[ki++]=gi);for(;Hn<Ee;)gi=Ht-((xi=Ht+Oi)-(Ki=xi-Ht))+(Oi-Ki),Oi=ve[++Hn],Ht=xi,gi!==0&&(ct[ki++]=gi);for(;yr<at;)gi=Ht-((xi=Ht+fi)-(Ki=xi-Ht))+(fi-Ki),fi=Bt[++yr],Ht=xi,gi!==0&&(ct[ki++]=gi);return Ht===0&&ki!==0||(ct[ki++]=Ht),ki}function Fe(Ee){return new Float64Array(Ee)}var rt=33306690738754716e-32,qe=22204460492503146e-32,ot=11093356479670487e-47,ht=Fe(4),yt=Fe(8),Tt=Fe(12),Et=Fe(16),pt=Fe(4);function St(Ee,ve,at){var Bt=function(ct,Ht,xi,gi,Ki,Oi){var fi=(Ht-Oi)*(xi-Ki),Hn=(ct-Ki)*(gi-Oi),yr=fi-Hn;if(fi===0||Hn===0||fi>0!=Hn>0)return yr;var ki=Math.abs(fi+Hn);return Math.abs(yr)>=rt*ki?yr:-function(On,pr,ir,nr,ur,Dr,Nn){var $n,en,Kn,Ar,Li,fn,Ur,Mr,La,Ka,Lr,Ja,$s,Qa,dl,ts,xc,fl,Dl=On-ur,is=ir-ur,Ml=pr-Dr,bc=nr-Dr;ht[0]=(dl=(Mr=Dl-(Ur=(fn=Se*Dl)-(fn-Dl)))*(Ka=bc-(La=(fn=Se*bc)-(fn-bc)))-((Qa=Dl*bc)-Ur*La-Mr*La-Ur*Ka))-((Lr=dl-(xc=(Mr=Ml-(Ur=(fn=Se*Ml)-(fn-Ml)))*(Ka=is-(La=(fn=Se*is)-(fn-is)))-((ts=Ml*is)-Ur*La-Mr*La-Ur*Ka)))+(Li=dl-Lr))+(Li-xc),ht[1]=($s=Qa-((Ja=Qa+Lr)-(Li=Ja-Qa))+(Lr-Li))-((Lr=$s-ts)+(Li=$s-Lr))+(Li-ts),ht[2]=Ja-((fl=Ja+Lr)-(Li=fl-Ja))+(Lr-Li),ht[3]=fl;var Uo=function(Jf,ed){for(var ob=ed[0],td=1;td<4;td++)ob+=ed[td];return ob}(0,ht),Ps=qe*Nn;if(Uo>=Ps||-Uo>=Ps||($n=On-(Dl+(Li=On-Dl))+(Li-ur),Kn=ir-(is+(Li=ir-is))+(Li-ur),en=pr-(Ml+(Li=pr-Ml))+(Li-Dr),Ar=nr-(bc+(Li=nr-bc))+(Li-Dr),$n===0&&en===0&&Kn===0&&Ar===0)||(Ps=ot*Nn+Pe*Math.abs(Uo),(Uo+=Dl*Ar+bc*$n-(Ml*Kn+is*en))>=Ps||-Uo>=Ps))return Uo;pt[0]=(dl=(Mr=$n-(Ur=(fn=Se*$n)-(fn-$n)))*(Ka=bc-(La=(fn=Se*bc)-(fn-bc)))-((Qa=$n*bc)-Ur*La-Mr*La-Ur*Ka))-((Lr=dl-(xc=(Mr=en-(Ur=(fn=Se*en)-(fn-en)))*(Ka=is-(La=(fn=Se*is)-(fn-is)))-((ts=en*is)-Ur*La-Mr*La-Ur*Ka)))+(Li=dl-Lr))+(Li-xc),pt[1]=($s=Qa-((Ja=Qa+Lr)-(Li=Ja-Qa))+(Lr-Li))-((Lr=$s-ts)+(Li=$s-Lr))+(Li-ts),pt[2]=Ja-((fl=Ja+Lr)-(Li=fl-Ja))+(Lr-Li),pt[3]=fl;var Qh=ke(4,ht,4,pt,yt);pt[0]=(dl=(Mr=Dl-(Ur=(fn=Se*Dl)-(fn-Dl)))*(Ka=Ar-(La=(fn=Se*Ar)-(fn-Ar)))-((Qa=Dl*Ar)-Ur*La-Mr*La-Ur*Ka))-((Lr=dl-(xc=(Mr=Ml-(Ur=(fn=Se*Ml)-(fn-Ml)))*(Ka=Kn-(La=(fn=Se*Kn)-(fn-Kn)))-((ts=Ml*Kn)-Ur*La-Mr*La-Ur*Ka)))+(Li=dl-Lr))+(Li-xc),pt[1]=($s=Qa-((Ja=Qa+Lr)-(Li=Ja-Qa))+(Lr-Li))-((Lr=$s-ts)+(Li=$s-Lr))+(Li-ts),pt[2]=Ja-((fl=Ja+Lr)-(Li=fl-Ja))+(Lr-Li),pt[3]=fl;var Kf=ke(Qh,yt,4,pt,Tt);pt[0]=(dl=(Mr=$n-(Ur=(fn=Se*$n)-(fn-$n)))*(Ka=Ar-(La=(fn=Se*Ar)-(fn-Ar)))-((Qa=$n*Ar)-Ur*La-Mr*La-Ur*Ka))-((Lr=dl-(xc=(Mr=en-(Ur=(fn=Se*en)-(fn-en)))*(Ka=Kn-(La=(fn=Se*Kn)-(fn-Kn)))-((ts=en*Kn)-Ur*La-Mr*La-Ur*Ka)))+(Li=dl-Lr))+(Li-xc),pt[1]=($s=Qa-((Ja=Qa+Lr)-(Li=Ja-Qa))+(Lr-Li))-((Lr=$s-ts)+(Li=$s-Lr))+(Li-ts),pt[2]=Ja-((fl=Ja+Lr)-(Li=fl-Ja))+(Lr-Li),pt[3]=fl;var b_=ke(Kf,Tt,4,pt,Et);return Et[b_-1]}(ct,Ht,xi,gi,Ki,Oi,ki)}(Ee[0],Ee[1],ve[0],ve[1],at[0],at[1]);return Bt>0?-1:Bt<0?1:0}function tt(Ee,ve){var at=Ee.point,Bt=ve.point;return at[0]>Bt[0]?1:at[0]<Bt[0]?-1:at[1]!==Bt[1]?at[1]>Bt[1]?1:-1:function(ct,Ht,xi,gi){return ct.left!==Ht.left?ct.left?1:-1:St(xi,ct.otherEvent.point,Ht.otherEvent.point)!==0?ct.isBelow(Ht.otherEvent.point)?-1:1:!ct.isSubject&&Ht.isSubject?1:-1}(Ee,ve,at)}function Qe(Ee,ve,at){var Bt=new ae(ve,!1,Ee,Ee.isSubject),ct=new ae(ve,!0,Ee.otherEvent,Ee.isSubject);return de(Ee.point,Ee.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Ee),Bt.contourId=ct.contourId=Ee.contourId,tt(ct,Ee.otherEvent)>0&&(Ee.otherEvent.left=!0,ct.left=!1),Ee.otherEvent.otherEvent=ct,Ee.otherEvent=Bt,at.push(ct),at.push(Bt),at}function xt(Ee,ve){return Ee[0]*ve[1]-Ee[1]*ve[0]}function wt(Ee,ve){return Ee[0]*ve[0]+Ee[1]*ve[1]}function _t(Ee,ve,at){var Bt=function(Ki,Oi,fi,Hn,yr){var ki=[Oi[0]-Ki[0],Oi[1]-Ki[1]],On=[Hn[0]-fi[0],Hn[1]-fi[1]];function pr(fn,Ur,Mr){return[fn[0]+Ur*Mr[0],fn[1]+Ur*Mr[1]]}var ir=[fi[0]-Ki[0],fi[1]-Ki[1]],nr=xt(ki,On),ur=nr*nr,Dr=wt(ki,ki);if(ur>0){var Nn=xt(ir,On)/nr;if(Nn<0||Nn>1)return null;var $n=xt(ir,ki)/nr;return $n<0||$n>1?null:Nn===0||Nn===1?[pr(Ki,Nn,ki)]:$n===0||$n===1?[pr(fi,$n,On)]:[pr(Ki,Nn,ki)]}if((ur=(nr=xt(ir,ki))*nr)>0)return null;var en=wt(ki,ir)/Dr,Kn=en+wt(ki,On)/Dr,Ar=Math.min(en,Kn),Li=Math.max(en,Kn);return Ar<=1&&Li>=0?Ar===1?[pr(Ki,Ar>0?Ar:0,ki)]:Li===0?[pr(Ki,Li<1?Li:1,ki)]:[pr(Ki,Ar>0?Ar:0,ki),pr(Ki,Li<1?Li:1,ki)]:null}(Ee.point,Ee.otherEvent.point,ve.point,ve.otherEvent.point),ct=Bt?Bt.length:0;if(ct===0||ct===1&&(de(Ee.point,ve.point)||de(Ee.otherEvent.point,ve.otherEvent.point))||ct===2&&Ee.isSubject===ve.isSubject)return 0;if(ct===1)return de(Ee.point,Bt[0])||de(Ee.otherEvent.point,Bt[0])||Qe(Ee,Bt[0],at),de(ve.point,Bt[0])||de(ve.otherEvent.point,Bt[0])||Qe(ve,Bt[0],at),1;var Ht=[],xi=!1,gi=!1;return de(Ee.point,ve.point)?xi=!0:tt(Ee,ve)===1?Ht.push(ve,Ee):Ht.push(Ee,ve),de(Ee.otherEvent.point,ve.otherEvent.point)?gi=!0:tt(Ee.otherEvent,ve.otherEvent)===1?Ht.push(ve.otherEvent,Ee.otherEvent):Ht.push(Ee.otherEvent,ve.otherEvent),xi&&gi||xi?(ve.type=A,Ee.type=ve.inOut===Ee.inOut?M:P,xi&&!gi&&Qe(Ht[1].otherEvent,Ht[0].point,at),2):gi?(Qe(Ht[0],Ht[1].point,at),3):Ht[0]!==Ht[3].otherEvent?(Qe(Ht[0],Ht[1].point,at),Qe(Ht[1],Ht[2].point,at),3):(Qe(Ht[0],Ht[1].point,at),Qe(Ht[3].otherEvent,Ht[2].point,at),3)}function mt(Ee,ve){if(Ee===ve)return 0;if(St(Ee.point,Ee.otherEvent.point,ve.point)!==0||St(Ee.point,Ee.otherEvent.point,ve.otherEvent.point)!==0)return de(Ee.point,ve.point)?Ee.isBelow(ve.otherEvent.point)?-1:1:Ee.point[0]===ve.point[0]?Ee.point[1]<ve.point[1]?-1:1:tt(Ee,ve)===1?ve.isAbove(Ee.point)?-1:1:Ee.isBelow(ve.point)?-1:1;if(Ee.isSubject!==ve.isSubject)return Ee.isSubject?-1:1;var at=Ee.point,Bt=ve.point;return at[0]===Bt[0]&&at[1]===Bt[1]?(at=Ee.otherEvent.point)[0]===(Bt=ve.otherEvent.point)[0]&&at[1]===Bt[1]?0:Ee.contourId>ve.contourId?1:-1:tt(Ee,ve)===1?1:-1}var si=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function qt(Ee,ve,at,Bt){var ct,Ht=Ee+1,xi=ve[Ee].point,gi=ve.length;for(Ht<gi&&(ct=ve[Ht].point);Ht<gi&&ct[0]===xi[0]&&ct[1]===xi[1];){if(!at[Ht])return Ht;++Ht<gi&&(ct=ve[Ht].point)}for(Ht=Ee-1;at[Ht]&&Ht>Bt;)Ht--;return Ht}si.prototype.isExterior=function(){return this.holeOf==null};var Gt=Zt,ji=Zt;function Zt(Ee,ve){if(!(this instanceof Zt))return new Zt(Ee,ve);if(this.data=Ee||[],this.length=this.data.length,this.compare=ve||Si,this.length>0)for(var at=(this.length>>1)-1;at>=0;at--)this._down(at)}function Si(Ee,ve){return Ee<ve?-1:Ee>ve?1:0}Zt.prototype={push:function(Ee){this.data.push(Ee),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Ee=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Ee}},peek:function(){return this.data[0]},_up:function(Ee){for(var ve=this.data,at=this.compare,Bt=ve[Ee];Ee>0;){var ct=Ee-1>>1,Ht=ve[ct];if(at(Bt,Ht)>=0)break;ve[Ee]=Ht,Ee=ct}ve[Ee]=Bt},_down:function(Ee){for(var ve=this.data,at=this.compare,Bt=this.length>>1,ct=ve[Ee];Ee<Bt;){var Ht=1+(Ee<<1),xi=Ht+1,gi=ve[Ht];if(xi<this.length&&at(ve[xi],gi)<0&&(Ht=xi,gi=ve[xi]),at(gi,ct)>=0)break;ve[Ee]=gi,Ee=Ht}ve[Ee]=ct}},Gt.default=ji;var Zi=Math.max,hn=Math.min,wn=0;function Xi(Ee,ve,at,Bt,ct,Ht){var xi,gi,Ki,Oi,fi,Hn;for(xi=0,gi=Ee.length-1;xi<gi;xi++)if(Oi=Ee[xi+1],fi=new ae(Ki=Ee[xi],!1,void 0,ve),Hn=new ae(Oi,!1,fi,ve),fi.otherEvent=Hn,Ki[0]!==Oi[0]||Ki[1]!==Oi[1]){fi.contourId=Hn.contourId=at,Ht||(fi.isExteriorRing=!1,Hn.isExteriorRing=!1),tt(fi,Hn)>0?Hn.left=!0:fi.left=!0;var yr=Ki[0],ki=Ki[1];ct[0]=hn(ct[0],yr),ct[1]=hn(ct[1],ki),ct[2]=Zi(ct[2],yr),ct[3]=Zi(ct[3],ki),Bt.push(fi),Bt.push(Hn)}}var Gn=[];function Yn(Ee,ve,at){typeof Ee[0][0][0]=="number"&&(Ee=[Ee]),typeof ve[0][0][0]=="number"&&(ve=[ve]);var Bt=function(ki,On,pr){var ir=null;return ki.length*On.length==0&&(pr===k?ir=Gn:pr===V?ir=ki:pr!==U&&pr!==q||(ir=ki.length===0?On:ki)),ir}(Ee,ve,at);if(Bt)return Bt===Gn?null:Bt;var ct=[1/0,1/0,-1/0,-1/0],Ht=[1/0,1/0,-1/0,-1/0],xi=function(ki,On,pr,ir,nr){var ur,Dr,Nn,$n,en,Kn,Ar=new Gt(null,tt);for(Nn=0,$n=ki.length;Nn<$n;Nn++)for(en=0,Kn=(ur=ki[Nn]).length;en<Kn;en++)(Dr=en===0)&&wn++,Xi(ur[en],!0,wn,Ar,pr,Dr);for(Nn=0,$n=On.length;Nn<$n;Nn++)for(en=0,Kn=(ur=On[Nn]).length;en<Kn;en++)Dr=en===0,nr===V&&(Dr=!1),Dr&&wn++,Xi(ur[en],!1,wn,Ar,ir,Dr);return Ar}(Ee,ve,ct,Ht,at);if(Bt=function(ki,On,pr,ir,nr){var ur=null;return(pr[0]>ir[2]||ir[0]>pr[2]||pr[1]>ir[3]||ir[1]>pr[3])&&(nr===k?ur=Gn:nr===V?ur=ki:nr!==U&&nr!==q||(ur=ki.concat(On))),ur}(Ee,ve,ct,Ht,at))return Bt===Gn?null:Bt;for(var gi=function(ki){var On,pr,ir=function(Nn){var $n,en,Kn,Ar,Li=[];for(en=0,Kn=Nn.length;en<Kn;en++)(($n=Nn[en]).left&&$n.inResult||!$n.left&&$n.otherEvent.inResult)&&Li.push($n);for(var fn=!1;!fn;)for(fn=!0,en=0,Kn=Li.length;en<Kn;en++)en+1<Kn&&tt(Li[en],Li[en+1])===1&&(Ar=Li[en],Li[en]=Li[en+1],Li[en+1]=Ar,fn=!1);for(en=0,Kn=Li.length;en<Kn;en++)($n=Li[en]).otherPos=en;for(en=0,Kn=Li.length;en<Kn;en++)($n=Li[en]).left||(Ar=$n.otherPos,$n.otherPos=$n.otherEvent.otherPos,$n.otherEvent.otherPos=Ar);return Li}(ki),nr={},ur=[],Dr=function(){if(!nr[On]){var Nn=ur.length,$n=function(Li,fn,Ur){var Mr=new si;if(Li.prevInResult!=null){var La=Li.prevInResult,Ka=La.outputContourId;if(La.resultTransition>0){var Lr=fn[Ka];if(Lr.holeOf!=null){var Ja=Lr.holeOf;fn[Ja].holeIds.push(Ur),Mr.holeOf=Ja,Mr.depth=fn[Ka].depth}else fn[Ka].holeIds.push(Ur),Mr.holeOf=Ka,Mr.depth=fn[Ka].depth+1}else Mr.holeOf=null,Mr.depth=fn[Ka].depth}else Mr.holeOf=null,Mr.depth=0;return Mr}(ir[On],ur,Nn),en=function(Li){nr[Li]=!0,Li<ir.length&&ir[Li]&&(ir[Li].outputContourId=Nn)},Kn=On,Ar=On;for($n.points.push(ir[On].point);en(Kn),en(Kn=ir[Kn].otherPos),$n.points.push(ir[Kn].point),!((Kn=qt(Kn,ir,nr,Ar))==Ar||Kn>=ir.length)&&ir[Kn];);ur.push($n)}};for(On=0,pr=ir.length;On<pr;On++)Dr();return ur}(function(ki,On,pr,ir,nr,ur){for(var Dr,Nn,$n,en=new c(mt),Kn=[],Ar=Math.min(ir[2],nr[2]);ki.length!==0;){var Li=ki.pop();if(Kn.push(Li),ur===k&&Li.point[0]>Ar||ur===V&&Li.point[0]>ir[2])break;if(Li.left){Nn=Dr=en.insert(Li),Dr=Dr!==($n=en.minNode())?en.prev(Dr):null,Nn=en.next(Nn);var fn=Dr?Dr.key:null;if(J(Li,fn,ur),Nn&&_t(Li,Nn.key,ki)===2&&(J(Li,fn,ur),J(Nn.key,Li,ur)),Dr&&_t(Dr.key,Li,ki)===2){var Ur=Dr;J(fn,(Ur=Ur!==$n?en.prev(Ur):null)?Ur.key:null,ur),J(Li,fn,ur)}}else Nn=Dr=en.find(Li=Li.otherEvent),Dr&&Nn&&(Dr=Dr!==$n?en.prev(Dr):null,Nn=en.next(Nn),en.remove(Li),Nn&&Dr&&_t(Dr.key,Nn.key,ki))}return Kn}(xi,0,0,ct,Ht,at)),Ki=[],Oi=0;Oi<gi.length;Oi++){var fi=gi[Oi];if(fi.isExterior()){for(var Hn=[fi.points],yr=0;yr<fi.holeIds.length;yr++)Hn.push(gi[fi.holeIds[yr]].points);Ki.push(Hn)}}return Ki}var Yr={UNION:U,DIFFERENCE:V,INTERSECTION:k,XOR:q};i.diff=function(Ee,ve){return Yn(Ee,ve,V)},i.intersection=function(Ee,ve){return Yn(Ee,ve,k)},i.operations=Yr,i.union=function(Ee,ve){return Yn(Ee,ve,U)},i.xor=function(Ee,ve){return Yn(Ee,ve,q)},Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,Pg.exports)),Pg.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Kp(n,e,i,o){const c=[],m=o===0?(g,x,S,A,M,P)=>{g.push(new vt(P,S+(P-x)/(A-x)*(M-S)))}:(g,x,S,A,M,P)=>{g.push(new vt(x+(P-S)/(M-S)*(A-x),P))};for(const g of n){const x=[];for(const S of g){if(S.length<=2)continue;const A=[];for(let k=0;k<S.length-1;k++){const U=S[k].x,V=S[k].y,q=S[k+1].x,J=S[k+1].y,ee=o===0?U:V,ae=o===0?q:J;ee<e?ae>e&&m(A,U,V,q,J,e):ee>i?ae<i&&m(A,U,V,q,J,i):A.push(S[k]),ae<e&&ee>=e&&m(A,U,V,q,J,e),ae>i&&ee<=i&&m(A,U,V,q,J,i)}let M=S[S.length-1];const P=o===0?M.x:M.y;P>=e&&P<=i&&A.push(M),A.length&&(M=A[A.length-1],A[0].x===M.x&&A[0].y===M.y||A.push(A[0]),x.push(A))}x.length&&c.push(x)}return c}function eS(n,e){const i=aw(n),o=aw([e]),c=rw.intersection(i,o);return c==null?[]:iS(c)}function tS(n,e){let o=aw(n,65536);const c=[];for(;e.valid();e.next()){const[m,g]=e.get(),x=m.x*65536,S=m.y*65536,A=g.x*65536,M=g.y*65536,P=A-x,k=M-S,U=Math.hypot(P,k);if(U===0)continue;const V=Math.trunc(k/U*3),q=-Math.trunc(P/U*3);c.push([[[x,S],[A,M],[A+V,M+q],[x+V,S+q],[x,S]]])}return c.length>0&&(o=rw.diff(o,c)),iS(o,1/65536)}function aw(n,e=1){return[n.map(i=>i.map(o=>[o.x*e,o.y*e]))]}function iS(n,e=1){return n.map(i=>i.map((o,c)=>{const m=o.map(g=>new vt(g[0]*e,g[1]*e).round());return c>0&&m.reverse(),m}))}class Og{constructor(e,i){this.layoutVertexArray=new Wo,this.indexArray=new ar,this.lineIndexArray=new jl,this.triangleSegments=new ta,this.lineSegments=new ta,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Uu)}update(e,i,o,c,m,g,x,S){this.programConfigurations.updatePaintArrays(e,i,m,o,c,g,x,S)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,WT.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,qT.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,o,c,m,g,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,o,c,m,g,void 0,x)}}class kg{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new Og(e,!1),this.elevationBufferData=new Og(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,o,c){}populate(e,i,o,c){this.hasPattern=Nh("fill",this.layers,this.pixelRatio,i);const m=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:x,id:S,index:A,sourceLayerIndex:M}of e){const P=this.layers[0]._featureFilter.needGeometry,k=Je(x,P);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),k,o))continue;const U=m?m.evaluate(k,{},o,i.availableImages):void 0,V={id:S,properties:x.properties,type:x.type,sourceLayerIndex:M,index:A,geometry:P?k.geometry:lt(x,o,c),patterns:{},sortKey:U};g.push(V)}m&&g.sort((x,S)=>x.sortKey-S.sortKey);for(const x of g){const{geometry:S,index:A,sourceLayerIndex:M}=x;if(this.hasPattern){const P=Ax("fill",this.layers,x,this.zoom,this.pixelRatio,i);this.patternFeatures.push(P)}else this.addFeature(x,S,A,o,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[A].feature,S,A,M,this.index)}}update(e,i,o,c,m,g,x){this.bufferData.update(e,i,o,c,m,g,x,this.worldview),this.elevationBufferData.update(e,i,o,c,m,g,x,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,o,c,m,g,x,this.worldview)}addFeatures(e,i,o,c,m,g){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,o,c,g,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,o,c,m,g=[],x,S){const A=Is(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,A,c,o,S):this.addGeometry(A,this.bufferData),this.bufferData.populatePaintArrays(e,o,m,g,c,x,this.worldview),this.elevationBufferData.populatePaintArrays(e,o,m,g,c,x,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,o,c,m){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,o,c,m,this.worldview))}addElevatedRoadFeature(e,i,o,c,m){const g=new Array,x=Fi.getElevationFeature(e,m);if(!x)return void this.addGeometry(i,this.bufferData);{const A=this.clipPolygonsToTile(i,1);A.length>0&&g.push({polygons:A,elevationFeature:x,elevationTileID:o})}const S={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},o),featureIndex:c};for(const A of g)if(A.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Us(A.elevationTileID,this.layers,this.zoom,this.lut));const P=A.elevationFeature.isTunnel();let k=0;e.properties.hasOwnProperty(ti)&&(k=+e.properties[ti]);for(const U of A.polygons)this.elevatedStructures.addPortalCandidates(A.elevationFeature.id,U,P,A.elevationFeature,k)}A.elevationFeature.constantHeight==null&&(A.polygons=this.prepareElevatedPolygons(A.polygons,A.elevationFeature,A.elevationTileID));const M=new zn(o,A.elevationTileID);this.addElevatedGeometry(A.polygons,M,A.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,c,S)}}addElevatedGeometry(e,i,o,c,m,g){const x={elevation:o,elevationSampler:i,bias:c,index:m,featureInfo:g},[S,A]=this.addGeometry(e,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:S,max:A}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,S),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,A))}addGeometry(e,i,o){let c=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY,g=null;o&&(g=o.elevationSampler.constantElevation(o.elevation,o.bias),g!=null&&(c=g,m=g));const x=(S,A,M)=>{if(o!=null)if(A.push(S),g!=null)i.elevatedLayoutVertexArray.emplaceBack(g),M.push(g);else{const P=o.elevationSampler.pointElevation(S,o.elevation,o.bias);i.elevatedLayoutVertexArray.emplaceBack(P),M.push(P),c=Math.min(c,P),m=Math.max(m,P)}};for(const S of e){let A=0;for(const le of S)A+=le.length;const M=i.triangleSegments.prepareSegment(A,i.layoutVertexArray,i.indexArray),P=M.vertexLength,k=[],U=[],V=[],q=[],J=[],ee=i.layoutVertexArray.length;for(const le of S){if(le.length===0)continue;le!==S[0]&&U.push(k.length/2);const de=i.lineSegments.prepareSegment(le.length,i.layoutVertexArray,i.lineIndexArray),Re=de.vertexLength;o&&J.push(i.layoutVertexArray.length-ee),x(le[0],V,q),i.layoutVertexArray.emplaceBack(le[0].x,le[0].y),i.lineIndexArray.emplaceBack(Re+le.length-1,Re),k.push(le[0].x),k.push(le[0].y);for(let Se=1;Se<le.length;Se++)x(le[Se],V,q),i.layoutVertexArray.emplaceBack(le[Se].x,le[Se].y),i.lineIndexArray.emplaceBack(Re+Se-1,Re+Se),k.push(le[Se].x),k.push(le[Se].y);de.vertexLength+=le.length,de.primitiveLength+=le.length}const ae=Zp(k,U);for(let le=0;le<ae.length;le+=3)i.indexArray.emplaceBack(P+ae[le],P+ae[le+1],P+ae[le+2]);if(ae.length>0&&o&&this.elevationMode==="hd-road-base"){const le=o.elevation.isTunnel(),de=o.elevation.safeArea,Re=this.elevatedStructures.addVertices(V,q);this.elevatedStructures.addTriangles(ae,Re,le);const Se=J.length;if(Se>0){for(let Pe=0;Pe<Se-1;Pe++)this.elevatedStructures.addRenderableRing(o.index,J[Pe]+Re,J[Pe+1]-J[Pe],le,de,o.featureInfo);this.elevatedStructures.addRenderableRing(o.index,J[Se-1]+Re,V.length-J[Se-1],le,de,o.featureInfo)}}M.vertexLength+=A,M.primitiveLength+=ae.length/3}return[c,m]}prepareElevatedPolygons(e,i,o){const c=1/De(o),m=[];for(const g of e){const x=tS(g,new kr(i,c));m.push(...x)}return m}clipPolygonsToTile(e,i){const o=-i,c=-i,m=Lt+i,g=Lt+i;let x=0;const S=[],A=[];for(;x<e.length;x++){const k=e[x],U=xp(k);(U.min.x>=o&&U.max.x<=m&&U.min.y>=c&&U.max.y<=g?S:A).push(k)}if(S.length===e.length)return e;const M=[new vt(o,c),new vt(m,c),new vt(m,g),new vt(o,g),new vt(o,c)],P=S;for(const k of A)P.push(...eS(k,M));return P}}let ow,nS,Dy,rS;ai(kg,"FillBucket",{omit:["layers","patternFeatures"]}),ai(Og,"FillBufferData"),ai(Us,"ElevatedStructures");class Ix{constructor(e,i,o,c){if(this.triangleCount=i.length/3,this.min=new vt(0,0),this.max=new vt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[m,g]=[e[0].clone(),e[0].clone()];for(let P=1;P<e.length;++P){const k=e[P];m.x=Math.min(m.x,k.x),m.y=Math.min(m.y,k.y),g.x=Math.max(g.x,k.x),g.y=Math.max(g.y,k.y)}if(c){const P=Math.ceil(Math.max(g.x-m.x,g.y-m.y)/c);o=Math.max(o,P)}if(o===0)return;this.min=m,this.max=g;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const S=Math.max(x.x,x.y)/o;this.cellsX=Math.max(1,Math.ceil(x.x/S)),this.cellsY=Math.max(1,Math.ceil(x.y/S)),this.xScale=1/S,this.yScale=1/S;const A=[];for(let P=0;P<this.triangleCount;P++){const k=e[i[3*P+0]].sub(this.min),U=e[i[3*P+1]].sub(this.min),V=e[i[3*P+2]].sub(this.min),q=Bh(Math.floor(Math.min(k.x,U.x,V.x)),this.xScale,this.cellsX),J=Bh(Math.floor(Math.max(k.x,U.x,V.x)),this.xScale,this.cellsX),ee=Bh(Math.floor(Math.min(k.y,U.y,V.y)),this.yScale,this.cellsY),ae=Bh(Math.floor(Math.max(k.y,U.y,V.y)),this.yScale,this.cellsY),le=new vt(0,0),de=new vt(0,0),Re=new vt(0,0),Se=new vt(0,0);for(let Pe=ee;Pe<=ae;++Pe){le.y=de.y=Pe*S,Re.y=Se.y=(Pe+1)*S;for(let ke=q;ke<=J;++ke)le.x=Re.x=ke*S,de.x=Se.x=(ke+1)*S,(ka(k,U,V,le,de,Se)||ka(k,U,V,le,Se,Re))&&A.push({cellIdx:Pe*this.cellsX+ke,triIdx:P})}}if(A.length===0)return;A.sort((P,k)=>P.cellIdx-k.cellIdx||P.triIdx-k.triIdx);let M=0;for(;M<A.length;){const P=A[M].cellIdx,k={start:this.payload.length,len:0};for(;M<A.length&&A[M].cellIdx===P;)++k.len,this.payload.push(A[M++].triIdx);this.cells[P]=k}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const o=Bh(e.x-this.min.x,this.xScale,this.cellsX),c=Bh(e.y-this.min.y,this.yScale,this.cellsY),m=this.cells[c*this.cellsX+o];if(m){this._lazyInitLookup();for(let g=0;g<m.len;g++){const x=this.payload[m.start+g],S=Math.floor(x/8),A=1<<x%8;if(!(this.lookup[S]&A)&&(this.lookup[S]|=A,i.push(x),i.length===this.triangleCount))return}}}query(e,i,o){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const c=Bh(e.x-this.min.x,this.xScale,this.cellsX),m=Bh(i.x-this.min.x,this.xScale,this.cellsX),g=Bh(e.y-this.min.y,this.yScale,this.cellsY),x=Bh(i.y-this.min.y,this.yScale,this.cellsY);for(let S=g;S<=x;S++)for(let A=c;A<=m;A++){const M=this.cells[S*this.cellsX+A];if(M)for(let P=0;P<M.len;P++){const k=this.payload[M.start+P],U=Math.floor(k/8),V=1<<k%8;if(!(this.lookup[U]&V)&&(this.lookup[U]|=V,o.push(k),o.length===this.triangleCount))return}}}}function Bh(n,e,i){return Math.max(0,Math.min(i-1,Math.floor(n*e)))}ai(Ix,"TriangleGridIndex");class aS{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}updateAppearances(e,i,o,c){}populate(e,i,o,c){const m=[];for(const{feature:g,id:x,index:S,sourceLayerIndex:A}of e){const M=this.layers[0]._featureFilter.needGeometry,P=Je(g,M);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),P,o))continue;const k={id:x,properties:g.properties,type:g.type,sourceLayerIndex:A,index:S,geometry:M?P.geometry:lt(g,o,c),patterns:{}};m.push(k)}for(const g of m){const{geometry:x,index:S,sourceLayerIndex:A}=g;this.addFeature(g,x,S,o,{},i.availableImages,i.brightness),i.featureIndex.insert(e[S].feature,x,S,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,o,c,m,g,x){}destroy(){}addFeature(e,i,o,c,m,g=[],x){for(const S of Is(i,2)){const A=[],M=[],P=[],k=new vt(1/0,1/0),U=new vt(-1/0,-1/0);for(const J of S)if(J.length!==0){J!==S[0]&&P.push(M.length/2);for(let ee=0;ee<J.length;ee++)M.push(J[ee].x),M.push(J[ee].y),A.push(J[ee]),k.x=Math.min(k.x,J[ee].x),k.y=Math.min(k.y,J[ee].y),U.x=Math.max(U.x,J[ee].x),U.y=Math.max(U.y,J[ee].y)}const V=Zp(M,P),q=new Ix(A,V,8,256);this.footprints.push({vertices:A,indices:V,grid:q,min:k,max:U})}}}ai(aS,"ClipBucket",{omit:["layers"]});const iA=dn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),nA=dn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),rA=dn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),aA=dn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),oA=dn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),sA=dn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),sw=dn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:lw}=iA,Jp=Number.MAX_SAFE_INTEGER,Dx=Jp-1;function oS(n,e,i,o){return n.order<e||n.order===Jp||!(n.clipMask&i)||function(c,m){return m.length!==0&&m.find(g=>g===c)===void 0}(o,n.clipScope)}function Rf(n,e){return n.x-e.x||n.y-e.y}function Lg(n,e){return Rf(n.min,e.min)===0&&Rf(n.max,e.max)===0}function cw(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function My(n,e){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(n[i].sourceId!==e[i].sourceId||!Lg(n[i],e[i])||n[i].order!==e[i].order||n[i].clipMask!==e[i].clipMask||!To(n[i].clipScope,e[i].clipScope))return!1;return!0}function sS(n,e,i){const o=1/Lt,c=1/(1<<i.canonical.z),m=(e.x*o+i.canonical.x)*c+i.wrap,g=(e.y*o+i.canonical.y)*c;return{min:new vt((n.x*o+i.canonical.x)*c+i.wrap,(n.y*o+i.canonical.y)*c),max:new vt(m,g)}}function lA(n,e,i){const o=1<<i.canonical.z,c=((e.x-i.wrap)*o-i.canonical.x)*Lt,m=(e.y*o-i.canonical.y)*Lt;return{min:new vt(((n.x-i.wrap)*o-i.canonical.x)*Lt,(n.y*o-i.canonical.y)*Lt),max:new vt(c,m)}}function Mx(n,e,i,o,c,m,g){const x=n.indices,S=n.vertices,A=[];for(let M=o;M<o+c;M+=3){const P=e[i[M+0]+m],k=e[i[M+1]+m],U=e[i[M+2]+m],V=Math.min(P.x,k.x,U.x),q=Math.max(P.x,k.x,U.x),J=Math.min(P.y,k.y,U.y),ee=Math.max(P.y,k.y,U.y);A.length=0,n.grid.query(new vt(V,J),new vt(q,ee),A);for(let ae=0;ae<A.length;ae++){const le=A[ae];if(ka(S[x[3*le+0]],S[x[3*le+1]],S[x[3*le+2]],P,k,U,g))return!0}}return!1}function lS(n,e,i,o){if(!n||!i)return!1;let c=n.vertices;if(!e.canonical.equals(o.canonical)||e.wrap!==o.wrap){if(i.vertices.length<n.vertices.length)return lS(i,o,n,e);const m=e.canonical,g=o.canonical,x=Math.pow(2,g.z-m.z);c=n.vertices.map(S=>new vt((S.x+m.x*Lt)*x-g.x*Lt,(S.y+m.y*Lt)*x-g.y*Lt))}return Mx(i,c,n.indices,0,n.indices.length,0,0)}function cS(n,e,i,o){const c=Math.pow(2,o.z-i.z);return new vt((n+i.x*Lt)*c-o.x*Lt,(e+i.y*Lt)*c-o.y*Lt)}function Px(n,e){const i=[];e.grid.queryPoint(n,i);const o=e.indices,c=e.vertices;for(let m=0;m<i.length;m++){const g=i[m];if(Ao([c[o[3*g+0]],c[o[3*g+1]],c[o[3*g+2]]],n))return!0}return!1}const zg=[new vt(0,0),new vt(Lt,0),new vt(Lt,Lt),new vt(0,Lt)];function Py(n,e){const i=[];let o=[];if(!e||n.length<2)return[n];if(n.length===2)return Ea(n[0],n[1],zg)?[n]:[];for(let c=0;c<n.length+2;c++){const m=n[c%n.length],g=n[(c+1)%n.length],x=Ea(c===0?n[n.length-1]:n[(c-1)%n.length],m,zg),S=Ea(m,g,zg),A=x||S;A&&o.push(m),A&&S||o.length>0&&(o.length>1&&i.push(o),o=[])}return o.length>1&&i.push(o),i}const Fg=bt.types,Oy=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],ky=["fill-extrusion-flood-light-ground-radius"],cA=Math.pow(2,13),uw=Math.pow(2,15)-1,Ox=new vt(0,1),If=2147483648,uS=7,uA=450;function Ly(n,e,i,o,c,m,g,x){n.emplaceBack((e<<1)+g,(i<<1)+m,(Math.floor(o*cA)<<1)+c,Math.round(x))}function zy(n,e,i){n.emplaceBack(e.x*Lt,e.y*Lt,i?1:0)}function kx(n,e,i,o,c,m){n.emplaceBack(e.x,e.y,(i.x<<1)+o,(i.y<<1)+c,m)}function Fy(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class hS{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class dS{constructor(){this.centroidXY=new vt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new vt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new vt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new vt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Lx{constructor(){this.acc=new vt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,o){this.accCount++,this.acc._add(i);let c=!!this.borders;i.x<e.min.x?(e.min.x=i.x,c=!0):i.x>e.max.x&&(e.max.x=i.x,c=!0),i.y<e.min.y?(e.min.y=i.y,c=!0):i.y>e.max.y&&(e.max.y=i.y,c=!0),((i.x===0||i.x===Lt)&&i.x===o.x)!=((i.y===0||i.y===Lt)&&i.y===o.y)&&this.processBorderOverlap(i,o),c&&this.checkBorderIntersection(i,o)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,wi(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Lt!=e.x>Lt&&this.addBorderIntersection(1,wi(i.y,e.y,(Lt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,wi(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Lt!=e.y>Lt&&this.addBorderIntersection(3,wi(i.x,e.x,(Lt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];i<o[0]&&(o[0]=i),i>o[1]&&(o[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,i.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,i.x),this.addBorderIntersection(o,e.x)}}centroid(){return this.accCount===0?new vt(0,0):new vt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function fS(n,e){const i=n.add(e)._unit(),o=X(n.x*i.x+n.y*i.y,-1,1);var c,m,g;return c=Math.acos(o),Math.min(4,Math.max(-4,Math.tan(c)))/4*uw*((m=n).x*(g=e).y-m.y*g.x<0?-1:1)}const hA=[n=>n.x<0,n=>n.x>Lt,n=>n.y<0,n=>n.y>Lt];function hw(n,e,i,o){const c=[4];if(o===0)return c;i._mult(o);const m=n.sub(i),g=e.sub(i),x=[n,e,m,g];for(let S=0;S<4;S++)for(const A of x)if(hA[S](A)){c.push(S);break}return c}class dw{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new gf,this.indexArray=new ar,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut},i=>ky.includes(i)),this._segments=new ta,this.hiddenByLandmarkVertexArray=new Gp,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ta}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,o,c=!1){const m=e.length;if(m>2){let g=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*m,this.vertexArray.length,2*this._segmentToGroundQuads[g].length);let S;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{const A=e[0],M=e[1];S=fS(A.sub(e[m-1])._perp()._unit(),M.sub(A)._perp()._unit())}for(let A=0;A<m;A++){const M=A===m-1?0:A+1,P=e[A],k=e[M],U=e[M===m-1?0:M+1],V=k.sub(P)._perp()._unit(),q=fS(V,U.sub(k)._perp()._unit()),J=S,ee=q;if(pw(P,k,i)||c&&mS(P,i)&&mS(k,i)){S=q;continue}const ae=x.vertexLength;kx(this.vertexArray,P,k,1,1,J),kx(this.vertexArray,P,k,1,0,J),kx(this.vertexArray,P,k,0,1,ee),kx(this.vertexArray,P,k,0,0,ee),x.vertexLength+=4;const le=hw(P,k,V,o);for(const de of le)this._segmentToGroundQuads[g].push({id:ae,region:de}),this._segmentToRegionTriCounts[g][de]+=2,x.primitiveLength+=2;S=q}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let o=0;o<i;o++)this._segmentToGroundQuads[o].sort((c,m)=>c.region-m.region);for(let o=0;o<i;o++){const c=this._segmentToGroundQuads[o],m=e[o],g=this._segmentToRegionTriCounts[o];g.reduce((S,A)=>S+A,0);let x=0;for(let S=0;S<=4;S++){const A=g[S];if(A!==0){let M=this.regionSegments[S];M||(M=this.regionSegments[S]=new ta);const P={vertexOffset:m.vertexOffset,primitiveOffset:m.primitiveOffset+x,vertexLength:m.vertexLength,primitiveLength:A};M.get().push(P)}x+=A}for(let S=0;S<c.length;S++){const A=c[S].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,o,c,m,g,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,o,c,m,g,void 0,x)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,nA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,rA.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,o,c,m,g,x,S){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,o,c,m,g,x,S)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&If))}updateHiddenByLandmarkRange(e,i,o){if(!this.hasData())return;const c=i+e;if(i!==0){for(let m=e;m<c;++m)this.hiddenByLandmarkVertexArray.emplace(m,o?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,sA.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Ng{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ar,this.footprintVertices=new Wo,this.footprintSegments=[],this.layoutVertexArray=new mf,this.centroidVertexArray=new gx,this.wallVertexArray=new Tg,this.indexArray=new ar,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut},i=>Oy.includes(i)),this.segments=new ta,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new dw(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,o,c){}populate(e,i,o,c){this.features=[],this.hasPattern=Nh("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=De(o),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:m,id:g,index:x,sourceLayerIndex:S}of e){const A=this.layers[0]._featureFilter.needGeometry,M=Je(m,A);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),M,o))continue;const P={id:g,sourceLayerIndex:S,index:x,geometry:A?M.geometry:lt(m,o,c),properties:m.properties,type:m.type,patterns:{}},k=this.layoutVertexArray.length,U=Fg[P.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:m.id,feature:Ax("fill-extrusion",this.layers,P,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const V of P.geometry)for(const q of Py(V,U))this.addFeature(m.id,P,[q],x,o,{},i.availableImages,c,i.brightness);else this.addFeature(m.id,P,P.geometry,x,o,{},i.availableImages,c,i.brightness);i.featureIndex.insert(m,P.geometry,x,S,this.index,k)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,o,c,m,g){for(const{featureId:x,feature:S}of this.features){const A=Fg[S.type]==="Polygon",{geometry:M}=S;if(this.wallMode)for(const P of M)for(const k of Py(P,A))this.addFeature(x,S,[k],S.index,i,o,c,m,g);else this.addFeature(x,S,M,S.index,i,o,c,m,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,o,c,m,g,x){this.programConfigurations.updatePaintArrays(e,i,m,o,c,g,x,this.worldview),this.groundEffect.update(e,i,m,o,c,g,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lw),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,oA.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,sw.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,aA.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,o,c,m,g,x,S,A){const M=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,P=[new vt(0,0),new vt(Lt,Lt)],k=S.projection,U=k.name==="globe",V=this.wallMode||Fg[i.type]==="Polygon",q=new Lx;q.centroidDataIndex=this.centroidData.length;const J=new dS;J.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(J.buildingId=i.properties.building_id);const ee=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},m)<=0,ae=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},m);let le;if(J.height=ae,J.vertexArrayOffset=this.layoutVertexArray.length,J.groundVertexArrayOffset=this.groundEffect.vertexArray.length,U&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new vg),this.wallMode){if(U)return void Yt("Non zero fill-extrusion-line-width is not yet supported on globe.");if(o.length!==1)return;le=function(qe){const ot=qe[0].x===qe[qe.length-1].x&&qe[0].y===qe[qe.length-1].y;(function(qt){let Gt=0;const ji=qt.length;for(let Zt=0;Zt<ji;Zt++)Gt+=(qt[(Zt+1)%ji].x-qt[Zt].x)*(qt[(Zt+1)%ji].y+qt[Zt].y);return Gt>=0})(qe)||(qe=qe.reverse());const yt={geometry:[],joinNormals:[],indices:[]},Tt=[],Et=[],pt=[];let St=qe.length;for(;St>=2&&qe[St-1].equals(qe[St-2]);)St--;if(St<(ot?3:2))return yt;let tt,Qe,xt,wt,_t,mt=0;for(;mt<St-1&&qe[mt].equals(qe[mt+1]);)mt++;ot&&(tt=qe[St-2],_t=qe[mt].sub(tt)._unit()._perp());for(let qt=mt;qt<St;qt++){if(xt=qt===St-1?ot?qe[mt+1]:void 0:qe[qt+1],xt&&qe[qt].equals(xt))continue;_t&&(wt=_t),tt&&(Qe=tt),tt=qe[qt],_t=xt?xt.sub(tt)._unit()._perp():wt,wt=wt||_t;let Gt=wt.add(_t);Gt.x===0&&Gt.y===0||Gt._unit();const ji=Gt.x*_t.x+Gt.y*_t.y,Zt=ji!==0?1/ji:1/0,Si=wt.x*_t.y-wt.y*_t.x>0;let Zi="miter";const hn=2;Zi==="miter"&&Zt>hn&&(Zi="bevel"),Zi==="bevel"&&(Zt>100&&(Zi="flipbevel"),Zt<hn&&(Zi="miter"));const wn=(Xi,Gn,Yn,Yr)=>{const Ee=new vt(Xi.x,Xi.y),ve=new vt(Xi.x,Xi.y);Ee.x+=Gn.x*Yr,Ee.y+=Gn.y*Yr,ve.x-=Gn.x*Math.max(Yn,1),ve.y-=Gn.y*Math.max(Yn,1),pt.push(Gn),Tt.push(Ee),Et.push(ve)};if(Zi==="miter")Gt._mult(Zt),wn(tt,Gt,0,0);else if(Zi==="flipbevel")Gt=_t.mult(-1),wn(tt,Gt,0,0),wn(tt,Gt.mult(-1),0,0);else{const Xi=-Math.sqrt(Zt*Zt-1),Gn=Si?Xi:0,Yn=Si?0:Xi;Qe&&wn(tt,wt,Gn,Yn),xt&&wn(tt,_t,Gn,Yn)}}yt.geometry=[...Tt,...Et.reverse(),Tt[0]],yt.joinNormals=[...pt,...pt.reverse(),pt[pt.length-1]];const si=yt.geometry.length-1;for(let qt=0;qt<si/2;qt++)if(qt+1<si/2){let Gt=qt,ji=qt+1,Zt=si-1-qt,Si=si-2-qt;Gt=Gt===0?si-1:Gt-1,ji=ji===0?si-1:ji-1,Zt=Zt===0?si-1:Zt-1,Si=Si===0?si-1:Si-1,yt.indices.push(Zt),yt.indices.push(ji),yt.indices.push(Gt),yt.indices.push(Zt),yt.indices.push(Si),yt.indices.push(ji)}return yt}(o[0]),o=[le.geometry]}const de=(qe,ot)=>qe<(ot.length-1)/2||qe===ot.length-1,Re=this.wallMode?[o]:Is(o,500);for(let qe=Re.length-1;qe>=0;qe--){const ot=Re[qe];(ot.length===0||(Se=ot[0]).every(ht=>ht.x<=0)||Se.every(ht=>ht.x>=Lt)||Se.every(ht=>ht.y<=0)||Se.every(ht=>ht.y>=Lt))&&Re.splice(qe,1)}var Se;let Pe;if(U)Pe=yS(Re,P,m);else{Pe=[];for(const qe of Re)Pe.push({polygon:qe,bounds:P})}const ke=V?this.edgeRadius:0,Fe=ke>0&&this.zoom<17,rt=(qe,ot)=>{if(qe.length===0)return!1;const ht=qe[qe.length-1];return ot.x===ht.x&&ot.y===ht.y};for(const{polygon:qe,bounds:ot}of Pe){let ht=0,yt=0;for(const St of qe)V&&!St[0].equals(St[St.length-1])&&St.push(St[0]),yt+=V?St.length-1:St.length;const Tt=this.segments.prepareSegment((V?5:4)*yt,this.layoutVertexArray,this.indexArray);J.footprintSegIdx<0&&(J.footprintSegIdx=this.footprintSegments.length),J.polygonSegIdx<0&&(J.polygonSegIdx=this.polygonSegments.length);const Et={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},pt=new hS;if(pt.vertexOffset=this.footprintVertices.length,pt.indexOffset=3*this.footprintIndices.length,pt.ringIndices=[],V){const St=[],tt=[];ht=Tt.vertexLength;for(let xt=0;xt<qe.length;xt++){const wt=qe[xt];wt.length&&xt!==0&&tt.push(St.length/2);const _t=[];let mt,si;mt=wt[1].sub(wt[0])._perp()._unit(),pt.ringIndices.push(wt.length-1);for(let qt=1;qt<wt.length;qt++){const Gt=wt[qt],ji=wt[qt===wt.length-1?1:qt+1],Zt=Gt.clone();if(ke){si=ji.sub(Gt)._perp()._unit();const Si=mt.add(si)._unit(),Zi=ke*Math.min(4,1/(mt.x*Si.x+mt.y*Si.y));Zt.x+=Zi*Si.x,Zt.y+=Zi*Si.y,Zt.x=Math.round(Zt.x),Zt.y=Math.round(Zt.y),mt=si}if(!ee||ke!==0&&!Fe||rt(_t,Zt)||_t.push(Zt),Ly(this.layoutVertexArray,Zt.x,Zt.y,0,0,1,1,0),this.wallMode){const Si=de(qt,wt);zy(this.wallVertexArray,le.joinNormals[qt],!Si)}Tt.vertexLength++,this.footprintVertices.emplaceBack(Gt.x,Gt.y),St.push(Gt.x,Gt.y),U&&Fy(this.layoutVertexExtArray,k.projectTilePoint(Zt.x,Zt.y,m),k.upVector(m,Zt.x,Zt.y))}ee&&(ke===0||Fe)&&(_t.length!==0&&rt(_t,_t[0])&&_t.pop(),this.groundEffect.addData(_t,ot,M))}const Qe=this.wallMode?le.indices:Zp(St,tt);for(let xt=0;xt<Qe.length;xt+=3)this.footprintIndices.emplaceBack(pt.vertexOffset+Qe[xt+0],pt.vertexOffset+Qe[xt+1],pt.vertexOffset+Qe[xt+2]),this.indexArray.emplaceBack(ht+Qe[xt],ht+Qe[xt+2],ht+Qe[xt+1]),Tt.primitiveLength++;pt.indexCount+=Qe.length,pt.vertexCount+=this.footprintVertices.length-pt.vertexOffset}for(let St=0;St<qe.length;St++){const tt=qe[St];q.startRing(J,tt[0]);let Qe=tt.length>4&&mw(tt[tt.length-2],tt[0],tt[1]),xt=ke?dA(tt[tt.length-2],tt[0],tt[1],ke):0;const wt=[];let _t,mt,si;mt=tt[1].sub(tt[0])._perp()._unit();let qt=!0;for(let Gt=1,ji=0;Gt<tt.length;Gt++){let Zt=tt[Gt-1],Si=tt[Gt];const Zi=tt[Gt===tt.length-1?1:Gt+1];if(q.appendEdge(J,Si,Zt),pw(Si,Zt,ot)){ke&&(mt=Zi.sub(Si)._perp()._unit(),qt=!qt);continue}const hn=Si.sub(Zt)._perp(),wn=hn.x/(Math.abs(hn.x)+Math.abs(hn.y)),Xi=hn.y>0?1:0,Gn=Zt.dist(Si);if(ji+Gn>32768&&(ji=0),ke){si=Zi.sub(Si)._perp()._unit();let ve=pS(Zt,Si,Zi,fw(mt,si),ke);isNaN(ve)&&(ve=0);const at=Si.sub(Zt)._unit();Zt=Zt.add(at.mult(xt))._round(),Si=Si.add(at.mult(-ve))._round(),xt=ve,mt=si,ee&&this.zoom>=17&&(rt(wt,Zt)||wt.push(Zt),rt(wt,Si)||wt.push(Si))}const Yn=Tt.vertexLength,Yr=tt.length>4&&mw(Zt,Si,Zi);let Ee=gS(ji,Qe,qt);if(Ly(this.layoutVertexArray,Zt.x,Zt.y,wn,Xi,0,0,Ee),Ly(this.layoutVertexArray,Zt.x,Zt.y,wn,Xi,0,1,Ee),this.wallMode){const ve=de(Gt-1,tt),at=le.joinNormals[Gt-1];zy(this.wallVertexArray,at,ve),zy(this.wallVertexArray,at,ve)}if(ji+=Gn,Ee=gS(ji,Yr,!qt),Qe=Yr,Ly(this.layoutVertexArray,Si.x,Si.y,wn,Xi,0,0,Ee),Ly(this.layoutVertexArray,Si.x,Si.y,wn,Xi,0,1,Ee),this.wallMode){const ve=de(Gt,tt),at=le.joinNormals[Gt];zy(this.wallVertexArray,at,ve),zy(this.wallVertexArray,at,ve)}if(Tt.vertexLength+=4,this.indexArray.emplaceBack(Yn+0,Yn+1,Yn+2),this.indexArray.emplaceBack(Yn+1,Yn+3,Yn+2),Tt.primitiveLength+=2,ke){const ve=ht+(Gt===1?tt.length-2:Gt-2),at=Gt===1?ht:ve+1;if(this.indexArray.emplaceBack(Yn+1,ve,Yn+3),this.indexArray.emplaceBack(ve,at,Yn+3),Tt.primitiveLength+=2,_t===void 0&&(_t=Yn),!pw(Zi,tt[Gt],ot)){const Bt=Gt===tt.length-1?_t:Tt.vertexLength;this.indexArray.emplaceBack(Yn+2,Yn+3,Bt),this.indexArray.emplaceBack(Yn+3,Bt+1,Bt),this.indexArray.emplaceBack(Yn+3,at,Bt+1),Tt.primitiveLength+=3}qt=!qt}if(U){const ve=this.layoutVertexExtArray,at=k.projectTilePoint(Zt.x,Zt.y,m),Bt=k.projectTilePoint(Si.x,Si.y,m),ct=k.upVector(m,Zt.x,Zt.y),Ht=k.upVector(m,Si.x,Si.y);Fy(ve,at,ct),Fy(ve,at,ct),Fy(ve,Bt,Ht),Fy(ve,Bt,Ht)}}V&&(ht+=tt.length-1),ee&&ke&&this.zoom>=17&&(wt.length!==0&&rt(wt,wt[0])&&wt.pop(),this.groundEffect.addData(wt,ot,M,ke>0))}this.footprintSegments.push(pt),Et.triangleCount=this.indexArray.length-Et.triangleArrayOffset,this.polygonSegments.push(Et),++J.footprintSegLen,++J.polygonSegLen}if(J.vertexCount=this.layoutVertexArray.length-J.vertexArrayOffset,J.groundVertexCount=this.groundEffect.vertexArray.length-J.groundVertexArrayOffset,J.vertexCount!==0){if(J.centroidXY=q.borders?Ox:this.encodeCentroid(q,J),this.centroidData.push(J),q.borders){this.featuresOnBorder.push(q);const qe=this.featuresOnBorder.length-1;for(let ot=0;ot<q.borders.length;ot++)q.borders[ot][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ot].push(qe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,g,x,m,A,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,c,g,x,m,A,this.worldview),this.maxHeight=Math.max(this.maxHeight,ae)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,o)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}splitToSubtiles(){const e=[];for(let x=0;x<this.centroidData.length;x++){const S=this.centroidData[x],A=+(S.min.y+S.max.y>Lt),M=2*A+(+(S.min.x+S.max.x>Lt)^A);for(let P=0;P<S.polygonSegLen;P++){const k=S.polygonSegIdx+P;e.push({centroidIdx:x,subtile:M,polygonSegmentIdx:k,triangleSegmentIdx:this.polygonSegments[k].triangleSegIdx})}}const i=new ar;e.sort((x,S)=>x.triangleSegmentIdx===S.triangleSegmentIdx?x.subtile-S.subtile:x.triangleSegmentIdx-S.triangleSegmentIdx);let o=0,c=0,m=0;for(const x of e){if(x.triangleSegmentIdx!==o)break;m++}const g=e.length;for(;c!==e.length;){o=e[c].triangleSegmentIdx;let x=0,S=c,A=c;for(let M=S;M<m&&e[M].subtile===x;M++)A++;for(;S!==m;){const M=e[S];x=M.subtile;const P=this.centroidData[M.centroidIdx].min.clone(),k=this.centroidData[M.centroidIdx].max.clone(),U={vertexOffset:this.segments.segments[o].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[o].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let V=S;V<A;V++){const q=e[V],J=this.polygonSegments[q.polygonSegmentIdx],ee=this.centroidData[q.centroidIdx].min,ae=this.centroidData[q.centroidIdx].max,le=this.indexArray.uint16;for(let de=J.triangleArrayOffset;de<J.triangleArrayOffset+J.triangleCount;de++)i.emplaceBack(le[3*de],le[3*de+1],le[3*de+2]);U.primitiveLength+=J.triangleCount,P.x=Math.min(P.x,ee.x),P.y=Math.min(P.y,ee.y),k.x=Math.max(k.x,ae.x),k.y=Math.max(k.y,ae.y)}U.primitiveLength>0&&this.triangleSubSegments.push({segment:U,min:P,max:k}),S=A;for(let V=S;V<m&&e[V].subtile===e[S].subtile;V++)A++}c=m;for(let M=c;M<g&&e[M].triangleSegmentIdx===e[c].triangleSegmentIdx;M++)m++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,o){const c=new ta;if(this.wallMode){for(const q of this.triangleSubSegments)c.segments.push(q.segment);return c}let m=0,g=0;const x=1<<e.canonical.z;if(i){const q=i.getMinMaxForTile(e);q&&(m=q.min,g=q.max)}g+=this.maxHeight;const S=e.toUnwrapped();let A;const M=[S.canonical.x/x+S.wrap,S.canonical.y/x],P=[(S.canonical.x+1)/x+S.wrap,(S.canonical.y+1)/x],k=(q,J,ee)=>[q[0]*(1-ee[0])+J[0]*ee[0],q[1]*(1-ee[1])+J[1]*ee[1]],U=[],V=[];for(const q of this.triangleSubSegments){U[0]=q.min.x/Lt,U[1]=q.min.y/Lt,V[0]=q.max.x/Lt,V[1]=q.max.y/Lt;const J=k(M,P,U),ee=k(M,P,V);if(new un([J[0],J[1],m],[ee[0],ee[1],g]).intersectsPrecise(o)===0){A&&(c.segments.push(A),A=void 0);continue}const ae=q.segment;A&&A.vertexOffset!==ae.vertexOffset&&(c.segments.push(A),A=void 0),A?(A.vertexLength+=ae.vertexLength,A.primitiveLength+=ae.primitiveLength):A={vertexOffset:ae.vertexOffset,primitiveLength:ae.primitiveLength,vertexLength:ae.vertexLength,primitiveOffset:ae.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&c.segments.push(A),c}encodeCentroid(e,i){const o=e.centroid(),c=i.span(),m=Math.min(7,Math.round(c.x*this.tileToMeter/10)),g=Math.min(7,Math.round(c.y*this.tileToMeter/10));return new vt(X(o.x,1,Lt-1)<<3|m,X(o.y,1,Lt-1)<<3|g)}encodeBorderCentroid(e){if(!e.borders)return new vt(0,0);const i=e.borders,o=Number.MAX_VALUE;if(i[0][0]!==o||i[1][0]!==o){const c=i[0][0]!==o?0:1;return new vt(6|(i[0][0]!==o?0:65528),(i[c][0]+i[c][1])/2<<3|6)}{const c=i[2][0]!==o?2:3;return new vt((i[c][0]+i[c][1])/2<<3|6,6|(i[2][0]!==o?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,o=e.vertexCount+e.vertexArrayOffset,c=e.flags&If?Ox:e.centroidXY,m=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==c.y||m!==c.x){for(let g=i;g<o;++g)this.centroidVertexArray.emplace(g,c.x,c.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const c=i.getReplacementRegionsForTile(e.toUnwrapped());if(My(this.activeReplacements,c))return;if(this.activeReplacements=c,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const g of this.centroidData)g.flags&=2147483647;const m=[];for(const g of this.activeReplacements){if(g.order<o)continue;const x=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));if(g.footprint.buildingId){const S=g.footprint.buildingId;for(const A of this.centroidData)A.buildingId===S&&(A.flags|=If)}else for(const S of this.centroidData)if(!(S.flags&If||g.min.x>S.max.x||S.min.x>g.max.x||g.min.y>S.max.y||S.min.y>g.max.y))for(let A=0;A<S.footprintSegLen;A++){const M=this.footprintSegments[S.footprintSegIdx+A];if(m.length=0,fA(this.footprintVertices,M.vertexOffset,M.vertexCount,g.footprintTileId.canonical,e.canonical,m),Mx(g.footprint,m,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-x)){S.flags|=If;break}}}for(const g of this.centroidData)this.writeCentroidToBuffer(g);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,o){let c=!1;for(let m=0;m<o.footprintSegLen;m++){const g=this.footprintSegments[o.footprintSegIdx+m];let x=0;for(const S of g.ringIndices){for(let A=x,M=S+x-1;A<S+x;M=A++){const P=this.footprintVertices.int16[2*(A+g.vertexOffset)+0],k=this.footprintVertices.int16[2*(A+g.vertexOffset)+1],U=this.footprintVertices.int16[2*(M+g.vertexOffset)+1];k>i!=U>i&&e<(this.footprintVertices.int16[2*(M+g.vertexOffset)+0]-P)*(i-k)/(U-k)+P&&(c=!c)}x=S}}return c}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,c=!0;const m=4*(e+Lt)*Lt+(i+Lt);if(this.partLookup.hasOwnProperty(m)){const g=this.partLookup[m];return g?{height:g.height,hidden:!!(g.flags&If)}:void 0}for(const g of this.centroidData)e>g.max.x||g.min.x>e||i>g.max.y||g.min.y>i||g.height<=o||this.footprintContainsPoint(e,i,g)&&(o=g.height,this.partLookup[m]=g,c=!!(g.flags&If));if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:c};this.partLookup[m]=void 0}}function fw(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function dA(n,e,i,o){const c=e.sub(n)._perp()._unit(),m=i.sub(e)._perp()._unit();return pS(n,e,i,fw(c,m),o)}function pS(n,e,i,o,c){const m=Math.sqrt(1-o*o);return Math.min(n.dist(e)/3,e.dist(i)/3,c*m/o)}function pw(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function mS(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function mw(n,e,i){if(n.x<0||n.x>=Lt||e.x<0||e.x>=Lt||i.x<0||i.x>=Lt)return!1;const o=i.sub(e),c=o.perp(),m=n.sub(e);return(o.x*m.x+o.y*m.y)/Math.sqrt((o.x*o.x+o.y*o.y)*(m.x*m.x+m.y*m.y))>-.866&&c.x*m.x+c.y*m.y<0}function gS(n,e,i){const o=e?2|n:-3&n;return i?1|o:-2&o}function _S(){const n=Math.PI/32,e=Math.tan(n),i=L;return i*Math.sqrt(1+2*e*e)-i}function yS(n,e,i){const o=1<<i.z,c=me(i.x/o),m=me((i.x+1)/o),g=ce(i.y/o),x=ce((i.y+1)/o);return function(S,A,M,P,k=0,U){const V=[];if(!S.length||!M||!P)return V;const q=(Se,Pe)=>{for(const ke of Se)V.push({polygon:ke,bounds:Pe})},J=Math.ceil(Math.log2(M)),ee=Math.ceil(Math.log2(P)),ae=J-ee,le=[];for(let Se=0;Se<Math.abs(ae);Se++)le.push(ae>0?0:1);for(let Se=0;Se<Math.min(J,ee);Se++)le.push(0),le.push(1);let de=S;if(de=Kp(de,A[0].y-k,A[1].y+k,1),de=Kp(de,A[0].x-k,A[1].x+k,0),!de.length)return V;const Re=[];for(le.length?Re.push({polygons:de,bounds:A,depth:0}):q(de,A);Re.length;){const Se=Re.pop(),Pe=Se.depth,ke=le[Pe],Fe=Se.bounds[0],rt=Se.bounds[1],qe=ke===0?Fe.x:Fe.y,ot=ke===0?rt.x:rt.y,ht=U?U(ke,qe,ot):.5*(qe+ot),yt=Kp(Se.polygons,qe-k,ht+k,ke),Tt=Kp(Se.polygons,ht-k,ot+k,ke);if(yt.length){const Et=[Fe,new vt(ke===0?ht:rt.x,ke===1?ht:rt.y)];le.length>Pe+1?Re.push({polygons:yt,bounds:Et,depth:Pe+1}):q(yt,Et)}if(Tt.length){const Et=[new vt(ke===0?ht:Fe.x,ke===1?ht:Fe.y),rt];le.length>Pe+1?Re.push({polygons:Tt,bounds:Et,depth:Pe+1}):q(Tt,Et)}}return V}(n,e,Math.ceil((m-c)/11.25),Math.ceil((g-x)/11.25),1,(S,A,M)=>{if(S===0)return .5*(A+M);{const P=ce((i.y+A/Lt)/o);return(te(.5*(ce((i.y+M/Lt)/o)+P))*o-i.y)*Lt}})}function fA(n,e,i,o,c,m){const g=Math.pow(2,o.z-c.z);for(let x=0;x<i;x++){let S=n.int16[2*(x+e)+0],A=n.int16[2*(x+e)+1];S=(S+c.x*Lt)*g-o.x*Lt,A=(A+c.y*Lt)*g-o.y*Lt,m.push(new vt(S,A))}}let vS,xS;ai(Ng,"FillExtrusionBucket",{omit:["layers","features"]}),ai(dS,"PartData"),ai(hS,"FootprintSegment"),ai(Lx,"BorderCentroidData"),ai(dw,"GroundEffect");class Qp extends vt{constructor(e,i,o){super(e,i),this.z=o}}class zx extends Qp{constructor(e,i,o,c){super(e,i,o),this.w=c}}function bS(n,e,i,o){const c=i==="x"?"y":"x",m=(o-n[i])/(e[i]-n[i]);n[c]=Math.round(n[c]+(e[c]-n[c])*m),n[i]=o,n.hasOwnProperty("z")&&(n.z=wi(n.z,e.z,m)),n.hasOwnProperty("w")&&(n.w=wi(n.w,e.w,m))}function wS(n,e,i,o){const c=i,m=o;for(const g of["x","y"]){let x=n,S=e;x[g]>=S[g]&&(x=e,S=n),x[g]<c&&S[g]>c&&bS(x,S,g,c),x[g]<m&&S[g]>m&&bS(S,x,g,m)}}function Fx(n,e,i,o,c,m){const g=[];for(let x=0;x<n.length;x++){const S=n[x];let A;const M=g.length;let P=0;for(let k=0;k<S.length-1;k++){let U=S[k],V=S[k+1],q=0;const J=P;let ee,ae;m&&(q=Math.hypot(V.x-U.x,V.y-U.y),P+=q,ee=U,ae=V),U.x<e&&V.x<e||(U.x<e?U=new vt(e,U.y+(e-U.x)/(V.x-U.x)*(V.y-U.y))._round():V.x<e&&(V=new vt(e,U.y+(e-U.x)/(V.x-U.x)*(V.y-U.y))._round()),U.y<i&&V.y<i||(U.y<i?U=new vt(U.x+(i-U.y)/(V.y-U.y)*(V.x-U.x),i)._round():V.y<i&&(V=new vt(U.x+(i-U.y)/(V.y-U.y)*(V.x-U.x),i)._round()),U.x>=o&&V.x>=o||(U.x>=o?U=new vt(o,U.y+(o-U.x)/(V.x-U.x)*(V.y-U.y))._round():V.x>=o&&(V=new vt(o,U.y+(o-U.x)/(V.x-U.x)*(V.y-U.y))._round()),U.y>=c&&V.y>=c||(U.y>=c?U=new vt(U.x+(c-U.y)/(V.y-U.y)*(V.x-U.x),c)._round():V.y>=c&&(V=new vt(U.x+(c-U.y)/(V.y-U.y)*(V.x-U.x),c)._round()),A&&U.equals(A[A.length-1])||(A=[U],g.push(A),m&&m.push({progress:{min:J+TS(ee,ae,U)*q,max:1},parentIndex:x,prevPoint:ee,nextPoint:ae})),A.push(V),m&&(m[m.length-1].progress.max=J+TS(ee,ae,V)*q,m[m.length-1].nextPoint=ae)))))}if(m&&P>0)for(let k=M;k<g.length;k++)m[k].progress.min/=P,m[k].progress.max/=P}return g}function pA(n,e,i,o,c){if(n.length<2)return void o.push(n);const m=[];for(;e.valid();){const[A,M]=e.get();for(let P=0;P<n.length-1;P++){const k=n[P],U=n[P+1],V=nl(k,U,A,M);if(V){const[q]=V,J=new vt(wi(k.x,U.x,q),wi(k.y,U.y,q));m.push({t:P+q,distance:0,point:J})}}e.next()}if(m.length===0)return void o.push(n);m.sort((A,M)=>A.t-M.t);let g=0,x=0,S=[];for(o.push(S);g!==n.length;){if(x===m.length){for(;g!==n.length;)S.length!==0&&S[S.length-1].equals(n[g])||S.push(n[g]),g++;break}m[x].t<=g?(S.length!==0&&S[S.length-1].equals(m[x].point)||S.push(m[x].point),Math.trunc(m[x].t),x++):(S.length!==0&&S[S.length-1].equals(n[g])||S.push(n[g]),g++)}}function TS(n,e,i){return n.x!==e.x?(i.x-n.x)/(e.x-n.x):n.y!==e.y?(i.y-n.y)/(e.y-n.y):0}function Ny(n,e){return n.x*e.x+n.y*e.y}function SS(n,e){if(n.length===1){let i=0;const o=e[i++];let c;for(;!c||o.equals(c);)if(c=e[i++],!c)return 1/0;for(;i<e.length;i++){const m=e[i],g=n[0],x=c.sub(o),S=m.sub(o),A=g.sub(o),M=Ny(x,x),P=Ny(x,S),k=Ny(S,S),U=Ny(A,x),V=Ny(A,S),q=M*k-P*P,J=(k*U-P*V)/q,ee=(M*V-P*U)/q,ae=o.z*(1-J-ee)+c.z*J+m.z*ee;if(isFinite(ae))return ae}return 1/0}{let i=1/0;for(const o of e)i=Math.min(i,o.z);return i}}function ES(n,e,i){let o=1/0;pa(i,e)&&(o=SS(i,e[0]));for(let c=0;c<e.length;c++){const m=e[c],g=n[c];for(let x=0;x<m.length-1;x++){const S=m[x],A=[S,m[x+1],g[x+1],g[x],S];va(i,A)&&(o=Math.min(o,SS(i,A)))}}return o!==1/0&&o}function CS(n,e,i,o,c,m,g,x,S,A,M){return n.projection.name==="globe"?function(P,k,U,V,q,J,ee,ae,le,de,Re){const Se=[],Pe=[],ke=P.projection.upVectorScale(Re,P.center.lat,P.worldSize).metersToTile,Fe=[0,0,0,1],rt=[0,0,0,1],qe=(ht,yt,Tt,Et)=>{ht[0]=yt,ht[1]=Tt,ht[2]=Et,ht[3]=1},ot=_S();U>0&&(U+=ot),V+=ot;for(const ht of k){const yt=[],Tt=[];for(const Et of ht){const pt=Et.x+q.x,St=Et.y+q.y,tt=P.projection.projectTilePoint(pt,St,Re),Qe=P.projection.upVector(Re,Et.x,Et.y);let xt=U,wt=V;if(ee){const _t=gw(pt,St,U,V,ee,ae,le,de);xt+=_t.base,wt+=_t.top}U!==0?qe(Fe,tt.x+Qe[0]*ke*xt,tt.y+Qe[1]*ke*xt,tt.z+Qe[2]*ke*xt):qe(Fe,tt.x,tt.y,tt.z),qe(rt,tt.x+Qe[0]*ke*wt,tt.y+Qe[1]*ke*wt,tt.z+Qe[2]*ke*wt),Bn(Fe,Fe,J),Bn(rt,rt,J),yt.push(new Qp(Fe[0],Fe[1],Fe[2])),Tt.push(new Qp(rt[0],rt[1],rt[2]))}Se.push(yt),Pe.push(Tt)}return[Se,Pe]}(n,e,i,o,c,m,g,x,S,A,M):g?function(P,k,U,V,q,J,ee,ae,le){const de=[],Re=[],Se=[0,0,0,1];for(const Pe of P){const ke=[],Fe=[];for(const rt of Pe){const qe=rt.x+V.x,ot=rt.y+V.y,ht=gw(qe,ot,k,U,J,ee,ae,le);Se[0]=qe,Se[1]=ot,Se[2]=ht.base,Se[3]=1,Fa(Se,Se,q),Se[3]=Math.max(Se[3],1e-5);const yt=new Qp(Se[0]/Se[3],Se[1]/Se[3],Se[2]/Se[3]);Se[0]=qe,Se[1]=ot,Se[2]=ht.top,Se[3]=1,Fa(Se,Se,q),Se[3]=Math.max(Se[3],1e-5);const Tt=new Qp(Se[0]/Se[3],Se[1]/Se[3],Se[2]/Se[3]);ke.push(yt),Fe.push(Tt)}de.push(ke),Re.push(Fe)}return[de,Re]}(e,i,o,c,m,g,x,S,A):function(P,k,U,V,q){const J=[],ee=[],ae=q[8]*k,le=q[9]*k,de=q[10]*k,Re=q[11]*k,Se=q[8]*U,Pe=q[9]*U,ke=q[10]*U,Fe=q[11]*U;for(const rt of P){const qe=[],ot=[];for(const ht of rt){const yt=ht.x+V.x,Tt=ht.y+V.y,Et=q[0]*yt+q[4]*Tt+q[12],pt=q[1]*yt+q[5]*Tt+q[13],St=q[2]*yt+q[6]*Tt+q[14],tt=q[3]*yt+q[7]*Tt+q[15],Qe=Et+ae,xt=pt+le,wt=St+de,_t=Math.max(tt+Re,1e-5),mt=Et+Se,si=pt+Pe,qt=St+ke,Gt=Math.max(tt+Fe,1e-5);qe.push(new Qp(Qe/_t,xt/_t,wt/_t)),ot.push(new Qp(mt/Gt,si/Gt,qt/Gt))}J.push(qe),ee.push(ot)}return[J,ee]}(e,i,o,c,m)}function gw(n,e,i,o,c,m,g,x){const S=g*c.getElevationAt(n,e,!0,!0),A=m[0]!==0,M=A?m[1]===0?g*(m[0]/uS-uA):g*function(P,k,U){const V=Math.floor(k[0]/8),q=Math.floor(k[1]/8),J=10*(k[0]-8*V),ee=10*(k[1]-8*q),ae=P.getElevationAt(V,q,!0,!0),le=P.getMeterToDEM(U),de=Math.floor(.5*(J*le-1)),Re=Math.floor(.5*(ee*le-1)),Se=P.tileCoordToPixel(V,q),Pe=2*de+1,ke=2*Re+1,Fe=function(Tt,Et,pt,St,tt){return[Tt.getElevationAtPixel(Et,pt,!0),Tt.getElevationAtPixel(Et+tt,pt,!0),Tt.getElevationAtPixel(Et,pt+tt,!0),Tt.getElevationAtPixel(Et+St,pt+tt,!0)]}(P,Se.x-de,Se.y-Re,Pe,ke),rt=Math.abs(Fe[0]-Fe[1]),qe=Math.abs(Fe[2]-Fe[3]),ot=Math.abs(Fe[0]-Fe[2])+Math.abs(Fe[1]-Fe[3]),ht=Math.min(.25,.5*le*(rt+qe)/Pe),yt=Math.min(.25,.5*le*ot/ke);return ae+Math.max(ht*J,yt*ee)}(c,m,x):S;return{base:S+(i===0?-1:i),top:A?Math.max(M+o,S+i+2):S+o}}class _w{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class mA{constructor(){this.tasks={},this.taskQueue=[],$e(["process"],this),this.invoker=new _w(this.process),this.nextId=0}add(e,i){const o=this.nextId++,c=function({type:m,isSymbolTile:g,zoom:x}){return x=x||0,m==="message"?0:m!=="maybePrepare"||g?m!=="parseTile"||g?m==="parseTile"&&g?300-x:m==="maybePrepare"&&g?400-x:500:200-x:100-x}(i);if(c===0){try{e()}finally{}return null}return this.tasks[o]={fn:e,metadata:i,priority:c,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let c=0;c<this.taskQueue.length;c++){const m=this.tasks[this.taskQueue[c]];m.priority<i&&(i=m.priority,e=c)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}class AS{constructor(e,i,o){this.target=e,this.parent=i,this.mapId=o,this.callbacks={},this.cancelCallbacks={},$e(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new mA}send(e,i,o,c,m=!1,g){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=g,this.callbacks[x]=o);const S=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!o,targetMapId:c,mustQueue:m,sourceMapId:this.mapId,data:Fu(i,S)},S),{cancel:()=>{o&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const o=i.id;if(o&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const c=this.cancelCallbacks[o];delete this.cancelCallbacks[o],c&&c.cancel()}else if(i.mustQueue||Or(self)){const c=this.callbacks[o],m=this.scheduler.add(()=>this.processTask(o,i),c&&c.metadata||{type:"message"});m&&(this.cancelCallbacks[o]=m)}else this.processTask(o,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const o=this.callbacks[e];delete this.callbacks[e],o&&(i.error?o(Sh(i.error)):o(null,Sh(i.data)))}else{const o=new Set,c=i.hasCallback?(g,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:g?Fu(g):null,data:Fu(x,o)},o)}:()=>{},m=Sh(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,m,c);else if(this.parent.getWorkerSource){const g=i.type.split("."),{source:x,scope:S}=m;this.parent.getWorkerSource(i.sourceMapId,g[0],x,S)[g[1]](m,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Df={workerUrl:"",workerClass:null,workerParams:void 0};const em="mapboxgl_preloaded_worker_pool";class tm{constructor(){this.active={}}acquire(e,i=tm.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(Df.workerClass!=null?new Df.workerClass:new self.Worker(Df.workerUrl,Df.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[em]}numActive(){return Object.keys(this.active).length}}tm.workerCount=2;class Bg{constructor(e,i,o="Worker",c=tm.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ve();const m=this.workerPool.acquire(this.id,c);for(let g=0;g<m.length;g++){const x=new Bg.Actor(m[g],i,this.id);x.name=`${o} ${g}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,o){ye(this.actors,(c,m)=>{c.send(e,i,m)},o=o||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let By,yw;function Nx(){return By||(By=new tm),By}Bg.Actor=AS;class gA{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),o=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,o/i.BYTES_PER_ELEMENT),o}createFloatArray(e){const i=new Float32Array(e),o=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,o/i.BYTES_PER_ELEMENT),o}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let o=0;o<e.length;++o)this.module.heapU8[i+o]=e.charCodeAt(o);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,o=e.facadeGlazingColorRgb,c=e.roofColorRgb,m=e.wallColorRgb,g=e.normalScale;this.module.setStyle(i[0],i[1],i[2],o[0],o[1],o[2],c[0],c[1],c[2],m[0],m[1],m[2],g[0],g[1],g[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,o){this.module.setFauxFacadeOptions(e?1:0,i?1:0,o)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){for(const x of e){const S=this.createStringBuffer(x.roofType),A=[0],M=[];for(const U of x.coordinates)if(Array.isArray(U)){for(const V of U)M.push(V.x),M.push(V.y);A.push(M.length)}const P=this.createIntArray(A),k=this.createFloatArray(M);this.module.addFeature(x.id,x.sourceId,x.minHeight,x.height,S,x.roofType.length,k,P,A.length-1),this.module.free(S),this.module.free(P),this.module.free(k)}for(const x of i){let S;S=x.entrances?JSON.parse(x.entrances):[];const A=this.createFloatArray(S),M=[];for(const k of x.coordinates)M.push(k.x),M.push(k.y);const P=this.createFloatArray(M);this.module.addFacade(x.sourceId,x.crossPerc,x.distanceToRoad,A,S.length,P,M.length),this.module.free(A),this.module.free(P)}if(!this.module.generateMesh()){const x=this.module.getLastError();return this.readStringBuffer(x)}const o=this.module.getMeshCount(),c=new Array(o);for(let x=0;x<o;x++){const S=this.module.getPositionsPtr(x),A=this.module.getPositionsLength(x),M=new Float32Array(this.module.heapF32.buffer,S,A),P=this.module.getNormalsPtr(x),k=this.module.getNormalsLength(x),U=new Float32Array(this.module.heapF32.buffer,P,k),V=this.module.getColorsPtr(x),q=this.module.getColorsLength(x),J=new Uint8Array(this.module.heapU8.buffer,V,q),ee=this.module.getAOPtr(x),ae=this.module.getAOLength(x),le=new Float32Array(this.module.heapF32.buffer,ee,ae),de=this.module.getUVPtr(x),Re=this.module.getUVLength(x),Se=new Float32Array(this.module.heapF32.buffer,de,Re),Pe=this.module.getFauxFacadePtr(x),ke=this.module.getFauxFacadeLength(x),Fe=new Uint8Array(this.module.heapU8.buffer,Pe,ke),rt=this.module.getIndicesPtr(x),qe=this.module.getIndicesLength(x),ot=new Int32Array(this.module.heap32.buffer,rt,qe),ht=this.module.getBuildingPart(x),yt=this.readStringBuffer(ht);c[x]={positions:M,normals:U,colors:J,ao:le,uv:Se,isFauxFacade:Fe,indices:ot,buildingPart:yt}}const m=this.module.getRingCount(),g=[];for(let x=0;x<m;x++){const S=this.module.getRingPtr(x),A=this.module.getRingLength(x),M=new Float32Array(this.module.heapF32.buffer,S,A);g.push(M)}return{meshes:c,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:g}}}let Uy,Bx,Wu,Ug,vw,Vg=null,jg=null,RS=null,Ux=null;function IS(){return Or(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Bx||Tr.DRACO_URL}function DS(){if(Or(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Ug)return Ug;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Ug=WebAssembly.validate(n)?Tr.MESHOPT_SIMD_URL:Tr.MESHOPT_URL,Ug}function _A(){return Ux}const Vx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},yA={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Vy={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function MS(n,e,i){const o=i.json.bufferViews.length,c=i.buffers.length;e.bufferView=o,i.json.bufferViews[o]={buffer:c,byteLength:n.byteLength},i.buffers[c]=n}const xw="KHR_draco_mesh_compression";function vA(n,e){const i=n.extensions&&n.extensions[xw];if(!i)return;const o=new Wu.Decoder,c=PS(e,i.bufferView),m=new Wu.Mesh;if(!o.DecodeArrayToMesh(c,c.byteLength,m))throw new Error("Failed to decode Draco mesh");const g=e.json.accessors[n.indices],x=Vx[g.componentType],S=g.count*x.BYTES_PER_ELEMENT,A=Wu._malloc(S);x===Uint16Array?o.GetTrianglesUInt16Array(m,S,A):o.GetTrianglesUInt32Array(m,S,A),MS(Wu.memory.buffer.slice(A,A+S),g,e),Wu._free(A);for(const M of Object.keys(i.attributes)){const P=o.GetAttributeByUniqueId(m,i.attributes[M]),k=e.json.accessors[n.attributes[M]],U=yA[k.componentType],V=k.count*Vy[k.type]*Vx[k.componentType].BYTES_PER_ELEMENT,q=Wu._malloc(V);o.GetAttributeDataArrayForAllPoints(m,P,Wu[U],V,q),MS(Wu.memory.buffer.slice(q,q+V),k,e),Wu._free(q)}o.destroy(),m.destroy(),delete n.extensions[xw]}const Pd="EXT_meshopt_compression";function Gg(n,e){if(!n.extensions||!n.extensions[Pd])return;const i=n.extensions[Pd],o=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),c=new Uint8Array(i.count*i.byteStride);vw.decodeGltfBuffer(c,i.count,i.byteStride,o,i.mode,i.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=c.buffer,delete n.extensions[Pd]}const jx=1179937895,Hg=new TextDecoder("utf8");function Gx(n,e){return new URL(n,e).href}function xA(n,e,i,o){return fetch(Gx(n.uri,o)).then(c=>c.arrayBuffer()).then(c=>{e.buffers[i]=c})}function PS(n,e){const i=n.json.bufferViews[e];return new Uint8Array(n.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function bA(n,e,i,o){if(n.uri){const c=Gx(n.uri,o);return fetch(c).then(m=>m.blob()).then(m=>createImageBitmap(m)).then(m=>{e.images[i]=m})}if(n.bufferView!==void 0){const c=PS(e,n.bufferView),m=new Blob([c],{type:n.mimeType});return createImageBitmap(m).then(g=>{e.images[i]=g})}}function $g(n,e=0,i){const o={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===jx){const M=new Uint32Array(n,e);let P=2;const k=(M[P++]>>2)-3,U=M[P++]>>2;if(P++,o.json=JSON.parse(Hg.decode(M.subarray(P,P+U))),P+=U,P<k){const V=M[P++];P++;const q=e+(P<<2);o.buffers[0]=n.slice(q,q+V)}}else o.json=JSON.parse(Hg.decode(new Uint8Array(n,e)));const{buffers:c,images:m,meshes:g,extensionsUsed:x,bufferViews:S}=o.json;let A=Promise.resolve();if(c){const M=[];for(let P=0;P<c.length;P++){const k=c[P];k.uri?M.push(xA(k,o,P,i)):o.buffers[P]||(o.buffers[P]=null)}A=Promise.all(M)}return A.then(()=>{const M=[],P=x&&x.includes(xw),k=x&&x.includes(Pd);if(P&&M.push(function(){if(!Wu)return Uy??(Uy=function(U){let V,q=null;function J(){V=new Uint8Array(q.buffer)}function ee(){throw new Error("Unexpected Draco error.")}const ae={a:{a:ee,d:function(le,de,Re){return V.copyWithin(le,de,de+Re)},c:function(le){const de=V.length,Re=Math.max(le>>>0,Math.ceil(1.2*de)),Se=Math.ceil((Re-de)/65536);try{return q.grow(Se),J(),!0}catch{return!1}},b:ee}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(U,ae):U.then(le=>le.arrayBuffer()).then(le=>WebAssembly.instantiate(le,ae))).then(le=>{const{Rb:de,Qb:Re,P:Se,T:Pe,X:ke,Ja:Fe,La:rt,Qa:qe,Va:ot,Wa:ht,eb:yt,jb:Tt,f:Et,e:pt,yb:St,zb:tt,Ab:Qe,Bb:xt,Db:wt,Gb:_t}=le.instance.exports;q=pt;const mt=(()=>{let si=0,qt=0,Gt=0,ji=0;return Zt=>{Gt&&(de(ji),de(si),qt+=Gt,Gt=si=0),si||(qt+=128,si=Re(qt));const Si=Zt.length+7&-8;let Zi=si;Si>=qt&&(Gt=Si,Zi=ji=Re(Si));for(let hn=0;hn<Zt.length;hn++)V[Zi+hn]=Zt[hn];return Zi}})();return J(),Et(),{memory:pt,_free:de,_malloc:Re,Mesh:class{constructor(){this.ptr=Se()}destroy(){Pe(this.ptr)}},Decoder:class{constructor(){this.ptr=Fe()}destroy(){Tt(this.ptr)}DecodeArrayToMesh(si,qt,Gt){const ji=mt(si),Zt=rt(this.ptr,ji,qt,Gt.ptr);return!!ke(Zt)}GetAttributeByUniqueId(si,qt){return{ptr:qe(this.ptr,si.ptr,qt)}}GetTrianglesUInt16Array(si,qt,Gt){ot(this.ptr,si.ptr,qt,Gt)}GetTrianglesUInt32Array(si,qt,Gt){ht(this.ptr,si.ptr,qt,Gt)}GetAttributeDataArrayForAllPoints(si,qt,Gt,ji,Zt){yt(this.ptr,si.ptr,qt.ptr,Gt,ji,Zt)}},DT_INT8:St(),DT_UINT8:tt(),DT_INT16:Qe(),DT_UINT16:xt(),DT_UINT32:wt(),DT_FLOAT32:_t()}})}(fetch(IS())),Uy.then(U=>{Wu=U,Uy=void 0}))}()),k&&M.push(function(){if(vw)return;const U=function(V){let q;const J=WebAssembly.instantiateStreaming(V,{}).then(le=>{q=le.instance,q.exports.__wasm_call_ctors()}),ee={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ae={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:J,supported:!0,decodeGltfBuffer(le,de,Re,Se,Pe,ke){(function(Fe,rt,qe,ot,ht,yt,Tt){const Et=Fe.exports.sbrk,pt=ot+3&-4,St=Et(pt*ht),tt=Et(yt.length),Qe=new Uint8Array(Fe.exports.memory.buffer);Qe.set(yt,tt);const xt=rt(St,ot,ht,tt,yt.length);if(xt===0&&Tt&&Tt(St,pt,ht),qe.set(Qe.subarray(St,St+ot*ht)),Et(St-Et(0)),xt!==0)throw new Error(`Malformed buffer data: ${xt}`)})(q,q.exports[ae[Pe]],le,de,Re,Se,q.exports[ee[ke]])}}}(fetch(DS()));return U.ready.then(()=>{vw=U})}()),m)for(let U=0;U<m.length;U++)M.push(bA(m[U],o,U,i));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(P&&g)for(const{primitives:U}of g)for(const V of U)vA(V,o);if(k&&g&&S)for(const U of S)Gg(U,o);return o})})}function jy(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>$g(e,0,n))}function Hx(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function im(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Od{constructor(e,i,o,c){this.context=e,this.format=o,this.useMipmap=c&&c.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:c&&c.premultiply})}update(e,i){const o=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,c=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:m}=this,{gl:g}=m,{x,y:S}=i&&i.position?i.position:{x:0,y:0},A=x+o,M=S+c;!this.size||this.size[0]===A&&this.size[1]===M||(g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(this.texture),this.texture=g.createTexture(),this.size=null),g.bindTexture(g.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA8&&(!i||i.premultiply!==!1));const P=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&A>0&&M>0){const k=this.useMipmap?Math.floor(Math.log2(Math.max(A,M)))+1:1;g.texStorage2D(g.TEXTURE_2D,k,this.format,A,M),this.size=[A,M]}this.size&&(P?g.texSubImage2D(g.TEXTURE_2D,0,x,S,Hx(this.format),im(this.format),e):"data"in e&&e.data&&g.texSubImage2D(g.TEXTURE_2D,0,x,S,o,c,Hx(this.format),im(this.format),e.data)),this.useMipmap&&g.generateMipmap(g.TEXTURE_2D)}bind(e,i,o=!1){const{context:c}=this,{gl:m}=c;m.bindTexture(m.TEXTURE_2D,this.texture),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap&&!o?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,o,c,m){const{context:g}=this,{gl:x}=g;x.bindTexture(x.TEXTURE_2D,this.texture),i!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?e===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),o!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,o),this.wrapS=o),c!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,c),this.wrapT=c),m!==this.compareMode&&(m?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.COMPARE_REF_TO_TEXTURE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_FUNC,m)):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.NONE),this.compareMode=m)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Jc{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:o}=this,{gl:c}=o;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrapS=i)}}const Wg=dn([{name:"a_pos_3f",components:3,type:"Float32"}]),$x=dn([{name:"a_color_3f",components:3,type:"Float32"}]),bw=dn([{name:"a_color_4f",components:4,type:"Float32"}]),wA=dn([{name:"a_uv_2f",components:2,type:"Float32"}]),OS=dn([{name:"a_normal_3f",components:3,type:"Float32"}]),kS=dn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Wx=dn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function Qc(n,e){const i=nm(n.projection,n.zoom,n.width,n.height),o=function(m,g,x,S,A){const M=new j(x.lng-180*al,x.lat),P=new j(x.lng+180*al,x.lat),k=m.project(M.lng,M.lat),U=m.project(P.lng,P.lat),V=-Math.atan2(U.y-k.y,U.x-k.x),q=Ge.fromLngLat(x);q.y=X(q.y,-1+al,1-al);const J=q.toLngLat(),ee=m.project(J.lng,J.lat),ae=Ge.fromLngLat(J);ae.x+=al;const le=ae.toLngLat(),de=m.project(le.lng,le.lat),Re=Vs(de.x-ee.x,de.y-ee.y,V),Se=Ge.fromLngLat(J);Se.y+=al;const Pe=Se.toLngLat(),ke=m.project(Pe.lng,Pe.lat),Fe=Vs(ke.x-ee.x,ke.y-ee.y,V),rt=Math.abs(Re.x)/Math.abs(Fe.y),qe=be([]);Nt(qe,qe,-V*(1-(A?0:S)));const ot=be([]);return Xe(ot,ot,[1,1-(1-rt)*S,1]),ot[4]=-Fe.x/Fe.y*S,Nt(ot,ot,V),Be(ot,qe,ot),ot}(n.projection,0,n.center,i,e),c=qx(n);return Xe(o,o,[c,c,1]),o}function qx(n){const e=n.projection,i=nm(n.projection,n.zoom,n.width,n.height),o=Uh(e,n.center),c=Uh(e,j.convert(e.center));return Math.pow(2,o*i+(1-i)*c)}function nm(n,e,i,o,c=1/0){const m=n.range;if(!m)return 0;const g=Math.min(c,Math.max(i,o)),x=Math.log2(g/1024);return he(m[0]+x,m[1]+x,e)}const al=1/4e4;function Uh(n,e){const i=X(e.lat,-_e,_e),o=new j(e.lng-180*al,i),c=new j(e.lng+180*al,i),m=n.project(o.lng,i),g=n.project(c.lng,i),x=Ge.fromLngLat(o),S=Ge.fromLngLat(c),A=g.x-m.x,M=g.y-m.y,P=S.x-x.x,k=S.y-x.y,U=Math.sqrt((P*P+k*k)/(A*A+M*M));return Math.log2(U)}function Vs(n,e,i){const o=Math.cos(i),c=Math.sin(i);return{x:n*o-e*c,y:n*c+e*o}}function js(n,e,i){be(n),Nt(n,n,cn(e[2])),it(n,n,cn(e[0])),kt(n,n,cn(e[1])),Xe(n,n,i),Be(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function qg(n,e,i,o,c,m,g,x){const S=[i[0]-e[0],i[1]-e[1],0],A=[o[0]-e[0],o[1]-e[1],0];if(Qt(S)<1e-12||Qt(A)<1e-12)return Na(n);const M=gr([],S,A);Vi(M,M),En(A,o,e),S[2]=(m-c)*x,A[2]=(g-c)*x;const P=S;return gr(P,S,A),Vi(P,P),Fr(n,M,P)}function ol(n,e,i=!1){const o=Id(e.zoom),c=function(m,g,x){const S=g.worldSize,A=[m[12],m[13],m[14]],M=ce(A[1]/S),P=me(A[0]/S),k=be([]),U=se(1,M)*S,V=se(1,0)*S*Ce(M,g.zoom),q=1/qb(S);let J=V*q;if(x){const de=nm(g.projection,g.zoom,g.width,g.height,1024);J=q*g.projection.pixelSpaceConversion(g.center.lat,S,de)}const ee=D(M,P);zi(ee,ee,xn([],Vi([],ee),U*J*A[2]));const ae=function(de){const Re=[de[0],de[1],de[2]];let Se=[0,1,0];const Pe=gr([],Se,Re);return gr(Se,Re,Pe),Gi(Se)===0&&(Se=[0,1,0],gr(Pe,Re,Se)),Vi(Pe,Pe),Vi(Se,Se),Vi(Re,Re),[Pe[0],Pe[1],Pe[2],0,Se[0],Se[1],Se[2],0,Re[0],Re[1],Re[2],0,de[0],de[1],de[2],1]}(ee);Xe(k,k,[J,J,J*U]),He(k,k,[-A[0],-A[1],-A[2]]);const le=Be([],g.globeMatrix,ae);return Be(le,le,k),Be(le,le,m),le}(n,e,i);if(o>0){const m=function(g,x){const S=x.worldSize,A=se(1,0)*S*Ce(x.center.lat,x.zoom)/qb(S),M=se(1,x.center.lat)*S,P=be([]);kt(P,P,cn(x.center.lng)),it(P,P,cn(x.center.lat)),He(P,P,[0,0,Bs]),Xe(P,P,[A,A,A*M]);const k=x.point;return He(P,P,[-k.x,-k.y,0]),Be(P,P,g),Be(P,x.globeMatrix,P)}(n,e);return function(g,x,S){const A=(V,q,J)=>{const ee=Qt(V),ae=Qt(q),le=Ad(V,q,J);return xn(le,le,1/Qt(le)*wi(ee,ae,J))},M=A([g[0],g[1],g[2]],[x[0],x[1],x[2]],S),P=A([g[4],g[5],g[6]],[x[4],x[5],x[6]],S),k=A([g[8],g[9],g[10]],[x[8],x[9],x[10]],S),U=Ad([g[12],g[13],g[14]],[x[12],x[13],x[14]],S);return[M[0],M[1],M[2],0,P[0],P[1],P[2],0,k[0],k[1],k[2],0,U[0],U[1],U[2],1]}(c,m,o)}return c}function qu(n,e,i,o){const c=un.projectAabbCorners(o,i);let m=Number.MAX_VALUE;for(let x=0;x<c.length;++x){const S=c[x];S[0]=(.5*S[0]+.5)*e.width,S[1]=(.5-.5*S[1])*e.height,S[2]<m&&(m=S[2])}const g=function(x){const S=[];let A=0;for(let U=1;U<x.length;U++)(x[U][0]<x[A][0]||x[U][0]===x[A][0]&&x[U][1]<x[A][1])&&(A=U);let M,P=A;const k=new Uint8Array(x.length);do{if(k[P])break;S.push(new vt(x[P][0],x[P][1])),k[P]=1,M=(P+1)%x.length;for(let U=0;U<x.length;U++){if(x[U][0]===x[M][0]&&x[U][1]===x[M][1]||x[U][0]===x[P][0]&&x[U][1]===x[P][1])continue;const V=[x[U][0]-x[P][0],x[U][1]-x[P][1]],q=[x[M][0]-x[P][0],x[M][1]-x[P][1]],J=V[0]*q[1]-V[1]*q[0];(J>0||J===0&&V[0]*q[0]+V[1]*q[1]>=0&&V[0]*V[0]+V[1]*V[1]>q[0]*q[0]+q[1]*q[1])&&(M=U)}P=M}while(P!==A);return S.length>0&&S.push(S[0]),S}(c);if(va(n,g))return m}const sl=64,Mf={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function kd(n,e,i,o,c,m,g,x,S,A=!1){const M=i.zoom,P=i.project(o),k=Ce(o.lat,M),U=1/k;be(n),He(n,n,[P.x+g[0]*U,P.y+g[1]*U,g[2]]);let V=1,q=1;const J=i.worldSize;if(A){if(i.projection.name==="mercator"){let de=0;i.elevation&&(de=i.elevation.getAtPointOrZero(new Ge(P.x/J,P.y/J),0));const Re=Fa([],[P.x,P.y,de,1],i.projMatrix)[3]/i.cameraToCenterDistance;V=Re,q=Re*Ce(i.center.lat,M)}else if(i.projection.name==="globe"){const de=ol(n,i),Re=[0,0,0,1];Fa(Re,Re,Be([],i.projMatrix,de));const Se=Re[3]/i.cameraToCenterDistance,Pe=Id(M),ke=i.projection.pixelsPerMeter(o.lat,J)*Ce(o.lat,M),Fe=i.projection.pixelsPerMeter(i.center.lat,J)*Ce(i.center.lat,M);V=Se/wi(ke,Ie(i.center.lat),Pe),q=Se*k/ke,V*=Fe,q*=Fe}}else V=U;Xe(n,n,[V,V,q]);const ee=[...n],ae=e.orientation,le=[];if(js(le,[ae[0]+(c?c[0]:0),ae[1]+(c?c[1]:0),ae[2]+(c?c[2]:0)],m),Be(n,ee,le),x&&i.elevation){let de=0;const Re=[];if(S&&i.elevation){de=function(Pe,ke,Fe,rt,qe){const ot=ke.elevation;if(!ot)return 0;const ht=un.projectAabbCorners(Fe,rt),yt=se(1,qe.lat)*ke.worldSize,Tt=function(qt,Gt){const ji=[0,0,1],Zt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Si of Zt){const Zi=qt[Si.corners[0]],hn=qt[Si.corners[1]],wn=qt[Si.corners[2]],Xi=[hn[0]-Zi[0],hn[1]-Zi[1],Gt*(hn[2]-Zi[2])],Gn=gr(Xi,Xi,[wn[0]-Zi[0],wn[1]-Zi[1],Gt*(wn[2]-Zi[2])]);Vi(Gn,Gn),Si.dotProductWithUp=Rn(Gn,ji)}return Zt.sort((Si,Zi)=>Si.dotProductWithUp-Zi.dotProductWithUp),Zt[0].corners}(ht,yt),Et=ht[Tt[0]],pt=ht[Tt[1]],St=ht[Tt[2]],tt=ht[Tt[3]],Qe=ot.getAtPointOrZero(new Ge(Et[0]/ke.worldSize,Et[1]/ke.worldSize),0),xt=ot.getAtPointOrZero(new Ge(pt[0]/ke.worldSize,pt[1]/ke.worldSize),0),wt=ot.getAtPointOrZero(new Ge(St[0]/ke.worldSize,St[1]/ke.worldSize),0),_t=ot.getAtPointOrZero(new Ge(tt[0]/ke.worldSize,tt[1]/ke.worldSize),0),mt=(Qe+_t)/2,si=(xt+wt)/2;return mt>si?xt<wt?qg(Pe,pt,tt,Et,xt,_t,Qe,yt):qg(Pe,St,Et,tt,wt,Qe,_t,yt):Qe<_t?qg(Pe,Et,pt,St,Qe,xt,wt,yt):qg(Pe,tt,St,pt,_t,wt,xt,yt),Math.max(mt,si)}(Re,i,e.aabb,n,o);const Se=Be([],hi([],Re),le);Be(n,ee,Se)}else de=i.elevation.getAtPointOrZero(new Ge(P.x/J,P.y/J),0);de!==0&&(n[14]+=de)}}class ww{constructor(e,i,o,c,m){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=i,this.position=o!=null?new j(o[0],o[1]):new j(0,0),this.orientation=c??[0,0,0],this.nodes=m,this.uploaded=!1,this.aabb=new un([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){Be(e.globalMatrix,i,e.localMatrix);const o=this.nodeOverrides.get(e.name);if(o!==void 0){const g=[];m=o.orientation,be(c=g),kt(c,c,cn(m[1])),Nt(c,c,cn(m[2])),it(c,c,cn(m[0])),Be(e.globalMatrix,e.globalMatrix,g)}var c,m;if(e.meshes)for(const g of e.meshes){const x=un.applyTransformFast(g.aabb,e.globalMatrix);this.aabb.encapsulate(x)}if(e.children)for(const g of e.children)this._applyTransformations(g,e.globalMatrix)}computeBoundsAndApplyParent(){const e=be([]);this.aabb=new un([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.nodes)this._applyTransformations(i,e)}computeModelMatrix(e,i,o,c,m,g,x=!1){kd(this.matrix,this,e.transform,this.position,i,o,c,m,g,x)}upload(e){if(!this.uploaded){for(const i of this.nodes)eu(i,e);for(const i of this.nodes)rm(i);this.uploaded=!0}}destroy(){for(const e of this.nodes)Gy(e)}}function Vh(n,e,i=!1){n.uploaded||(n.gfxTexture=new Od(e,n.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function Zx(n,e,i){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,Wg.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,OS.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,wA.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?$x:bw).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,Wx.members,!0)),n.segments=ta.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const o=n.material;o.pbrMetallicRoughness.baseColorTexture&&Vh(o.pbrMetallicRoughness.baseColorTexture,e),o.pbrMetallicRoughness.metallicRoughnessTexture&&Vh(o.pbrMetallicRoughness.metallicRoughnessTexture,e),o.normalTexture&&Vh(o.normalTexture,e),o.occlusionTexture&&Vh(o.occlusionTexture,e,i),o.emissionTexture&&Vh(o.emissionTexture,e)}function eu(n,e,i){if(n.meshes)for(const o of n.meshes)Zx(o,e,i);if(n.children)for(const o of n.children)eu(o,e,i)}function rm(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)rm(e)}function Gy(n){if(n.meshes)for(const i of n.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const i of n.children)Gy(i)}function Pf(n,e){const i=n.json.bufferViews[e.bufferView],o=Vx[e.componentType];return new o(n.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Vy[e.type]*o.BYTES_PER_ELEMENT?i.byteStride/o.BYTES_PER_ELEMENT:Vy[e.type]))}function Xx(n,e,i,o){const c=Vx[e.componentType],m=function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(c),g=n.json.bufferViews[e.bufferView],x=g.byteStride?g.byteStride/c.BYTES_PER_ELEMENT:Vy[e.type],S=i.float32,A=S.length/i.capacity;for(let M=0,P=0;M<e.count*x;M+=x,P+=A)for(let k=0;k<A;k++)S[P+k]=o[M+k]*m;i._trim()}function Yx(n,e,i){const o=n.indices,c=n.attributes,m={};m.indexArray=new ar;const g=e.json.accessors[o],x=g.count/3;m.indexArray.reserve(x);const S=Pf(e,g);for(let k=0;k<x;k++)m.indexArray.emplaceBack(S[3*k],S[3*k+1],S[3*k+2]);m.indexArray._trim(),m.vertexArray=new Fs;const A=e.json.accessors[c.POSITION];m.vertexArray.reserve(A.count);const M=Pf(e,A);for(let k=0;k<A.count;k++)m.vertexArray.emplaceBack(M[3*k],M[3*k+1],M[3*k+2]);if(m.vertexArray._trim(),m.aabb=new un(A.min,A.max),m.centroid=function(k,U){const V=[0,0,0],q=k.length;if(q>0){for(let J=0;J<q;J++){const ee=3*k[J];V[0]+=U[ee],V[1]+=U[ee+1],V[2]+=U[ee+2]}V[0]/=q,V[1]/=q,V[2]/=q}return V}(S,M),c.COLOR_0!==void 0){const k=e.json.accessors[c.COLOR_0],U=Vy[k.type],V=Pf(e,k);m.colorArray=U===3?new Fs:new ju,m.colorArray.resize(k.count),Xx(e,k,m.colorArray,V)}if(c.NORMAL!==void 0){m.normalArray=new Fs;const k=e.json.accessors[c.NORMAL];m.normalArray.resize(k.count);const U=Pf(e,k);Xx(e,k,m.normalArray,U)}if(c.TEXCOORD_0!==void 0&&i.length>0){m.texcoordArray=new Hl;const k=e.json.accessors[c.TEXCOORD_0];m.texcoordArray.resize(k.count);const U=Pf(e,k);Xx(e,k,m.texcoordArray,U)}if(c._FEATURE_ID_RGBA4444!==void 0){const k=e.json.accessors[c._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(m.featureData=Pf(e,k))}c._FEATURE_RGBA4444!==void 0&&(m.featureData=new Uint32Array(Pf(e,e.json.accessors[c._FEATURE_RGBA4444]).buffer));const P=n.material;return m.material=function(k,U){const{emissiveFactor:V=[0,0,0],alphaMode:q="OPAQUE",alphaCutoff:J=.5,normalTexture:ee,occlusionTexture:ae,emissiveTexture:le,doubleSided:de,name:Re}=k,{baseColorFactor:Se=[1,1,1,1],metallicFactor:Pe=1,roughnessFactor:ke=1,baseColorTexture:Fe,metallicRoughnessTexture:rt}=k.pbrMetallicRoughness||{},qe=ae?U[ae.index]:void 0;if(ae&&ae.extensions&&ae.extensions.KHR_texture_transform&&qe){const ot=ae.extensions.KHR_texture_transform;qe.offsetScale=[ot.offset[0],ot.offset[1],ot.scale[0],ot.scale[1]]}return{name:Re,pbrMetallicRoughness:{baseColorFactor:new Qi(...Se),metallicFactor:Pe,roughnessFactor:ke,baseColorTexture:Fe?U[Fe.index]:void 0,metallicRoughnessTexture:rt?U[rt.index]:void 0},doubleSided:de,emissiveFactor:new Qi(...V),alphaMode:q,alphaCutoff:J,normalTexture:ee?U[ee.index]:void 0,occlusionTexture:qe,emissionTexture:le?U[le.index]:void 0,defined:k.defined===void 0}}(P!==void 0?e.json.materials[P]:{defined:!1},i),m}function Tw(n,e,i){const{matrix:o,rotation:c,translation:m,scale:g,mesh:x,extras:S,children:A,name:M}=n,P={};if(P.name=M,P.localMatrix=o||function(k,U,V,q){var J=U[0],ee=U[1],ae=U[2],le=U[3],de=J+J,Re=ee+ee,Se=ae+ae,Pe=J*de,ke=J*Re,Fe=J*Se,rt=ee*Re,qe=ee*Se,ot=ae*Se,ht=le*de,yt=le*Re,Tt=le*Se,Et=q[0],pt=q[1],St=q[2];return k[0]=(1-(rt+ot))*Et,k[1]=(ke+Tt)*Et,k[2]=(Fe-yt)*Et,k[3]=0,k[4]=(ke-Tt)*pt,k[5]=(1-(Pe+ot))*pt,k[6]=(qe+ht)*pt,k[7]=0,k[8]=(Fe+yt)*St,k[9]=(qe-ht)*St,k[10]=(1-(Pe+rt))*St,k[11]=0,k[12]=V[0],k[13]=V[1],k[14]=V[2],k[15]=1,k}([],c||[0,0,0,1],m||[0,0,0],g||[1,1,1]),P.globalMatrix=xe(P.localMatrix),x!==void 0){P.meshes=i[x];const k=P.anchor=[0,0];for(const U of P.meshes){const{min:V,max:q}=U.aabb;k[0]+=V[0]+q[0],k[1]+=V[1]+q[1]}k[0]=Math.floor(k[0]/P.meshes.length/2),k[1]=Math.floor(k[1]/P.meshes.length/2)}if(S&&(S.id&&(P.id=S.id),S.lights&&(P.lights=function(k){if(!k.length)return[];const U=function(ae){const le=atob(ae),de=new Uint8Array(le.length);for(let Re=0;Re<le.length;Re++)de[Re]=le.codePointAt(Re);return de}(k),V=[],q=U.length/24,J=new Uint16Array(U.buffer),ee=new Float32Array(U.buffer);for(let ae=0;ae<q;ae++){const le=J[2*ae*6]/30,de=J[2*ae*6+1]/30,Re=J[2*ae*6+10]/100,Se=ee[6*ae+1],Pe=ee[6*ae+2],ke=ee[6*ae+3],Fe=ee[6*ae+4],rt=ke-Se,qe=Fe-Pe,ot=Math.hypot(rt,qe);V.push({pos:[Se+.5*rt,Pe+.5*qe,de],normal:[qe/ot,-rt/ot,0],width:ot,height:le,depth:Re,points:[Se,Pe,ke,Fe]})}return V}(S.lights)),S.MAPBOX_geometry_bloom&&(P.isGeometryBloom=S.MAPBOX_geometry_bloom)),A){const k=[];for(const U of A)k.push(Tw(e.json.nodes[U],e,i));P.children=k}return P}function TA(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new Ix(n.vertices,n.indices,8,256),[i,o]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:i,max:o}}function Of(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const o=[];for(const g of i){if(!Array.isArray(g)||g.length!==2)continue;const x=g[0],S=g[1];typeof x=="number"&&typeof S=="number"&&o.push(new vt(x,S))}if(o.length<3)return null;o.length>1&&o[o.length-1].equals(o[0])&&o.pop();let c=0;for(let g=0;g<o.length;g++){const x=o[g],S=o[(g+1)%o.length],A=o[(g+2)%o.length];c+=(x.x-S.x)*(A.y-S.y)-(A.x-S.x)*(x.y-S.y)}c>0&&o.reverse();const m=Zp(o.flatMap(g=>[g.x,g.y]),[]);return m.length===0?null:{vertices:o,indices:m}}function Kx(n,e){const i=[],o=[];let c=0;const m=[];for(const g of n){c=i.length;const x=g.vertexArray.float32,S=g.indexArray.uint16;for(let A=0;A<g.vertexArray.length;A++)m[0]=x[3*A+0],m[1]=x[3*A+1],m[2]=x[3*A+2],Bn(m,m,e),i.push(new vt(m[0],m[1]));for(let A=0;A<3*g.indexArray.length;A++)o.push(S[A]+c)}if(o.length%3!=0)return null;for(let g=0;g<o.length;g+=3){const x=i[o[g+0]],S=i[o[g+1]],A=i[o[g+2]];(x.x-S.x)*(A.y-S.y)-(A.x-S.x)*(x.y-S.y)>0&&([o[g+1],o[g+2]]=[o[g+2],o[g+1]])}return{vertices:i,indices:o}}function Zu(n){const e=function(S,A){const M=[],P=WebGL2RenderingContext;if(S.json.textures)for(const k of S.json.textures){const U={magFilter:P.LINEAR,minFilter:P.NEAREST,wrapS:P.REPEAT,wrapT:P.REPEAT};k.sampler!==void 0&&Object.assign(U,S.json.samplers[k.sampler]),M.push({image:A[k.source],sampler:U,uploaded:!1})}return M}(n,n.images),i=function(S,A){const M=[];for(const P of S.json.meshes){const k=[];for(const U of P.primitives)k.push(Yx(U,S,A));M.push(k)}return M}(n,e),{scenes:o,scene:c,nodes:m}=n.json,g=o?o[c||0].nodes:[...m.keys()],x=[];for(const S of g)x.push(Tw(m[S],n,i));return function(S,A,M){const P={},k=new Set;for(let U=0;U<S.length;U++){const V=M[A[U]];if(!V.extras)continue;const q=V.extras["mapbox:footprint:version"],J=V.extras["mapbox:footprint:id"];(q||J)&&k.add(U),q==="1.0.0"&&J&&(P[J]=U)}for(let U=0;U<S.length;U++){if(k.has(U))continue;const V=S[U],q=M[A[U]];if(!q.extras)continue;let J=null;V.id in P&&(J=Kx(S[P[V.id]].meshes,V.localMatrix)),J||(J=Of(q)),J&&(V.footprint=TA(J))}if(k.size>0){const U=Array.from(k.values()).sort((V,q)=>V-q);for(let V=U.length-1;V>=0;V--)S.splice(U[V],1)}}(x,g,n.json.nodes),x}function Sw(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,i=n.aabb.min[0]-1,o=n.aabb.min[1]-1,c=sl/(n.aabb.max[0]-i+2),m=sl/(n.aabb.max[1]-o+2);for(let g=0;g<e.length;g+=3){const x=e[g+2],S=(e[g+0]-i)*c|0,A=(e[g+1]-o)*m|0;x>n.heightmap[A*sl+S]&&(n.heightmap[A*sl+S]=x)}}function Jx(n,e,i,o,c){i.reserve(i.length+4*n.length),o.reserve(o.length+10*n.length),c.reserve(c.length+10*n.length);let m=o.length;for(const g of n){const x=Math.min(10,Math.max(4,1.3*g.height))*e,S=[-g.normal[1],g.normal[0],0],A=Math.min(.29,.1*g.width/g.depth),M=g.width-2*g.depth*e*(A+.01),P=mr([],g.pos,S,M/2),k=mr([],g.pos,S,-M/2),U=[P[0],P[1],P[2]+g.height],V=[k[0],k[1],k[2]+g.height],q=mr([],g.normal,S,A);xn(q,q,x);const J=mr([],g.normal,S,-A);xn(J,J,x),zi(q,P,q),zi(J,k,J),P[2]+=.1,k[2]+=.1,o.emplaceBack(q[0],q[1],q[2]),o.emplaceBack(J[0],J[1],J[2]),o.emplaceBack(P[0],P[1],P[2]),o.emplaceBack(k[0],k[1],k[2]),o.emplaceBack(U[0],U[1],U[2]),o.emplaceBack(V[0],V[1],V[2]),o.emplaceBack(P[0],P[1],P[2]),o.emplaceBack(k[0],k[1],k[2]),o.emplaceBack(q[0],q[1],q[2]),o.emplaceBack(J[0],J[1],J[2]);const ee=M/x/2;c.emplaceBack(-ee-A,-1,ee,.8),c.emplaceBack(ee+A,-1,ee,.8),c.emplaceBack(-ee,0,ee,1.3),c.emplaceBack(ee,0,ee,1.3),c.emplaceBack(ee+A,-.8,ee,.7),c.emplaceBack(ee+A,-.8,ee,.7),c.emplaceBack(0,0,ee,1.3),c.emplaceBack(0,0,ee,1.3),c.emplaceBack(ee+A,-1.2,ee,.8),c.emplaceBack(ee+A,-1.2,ee,.8),i.emplaceBack(6+m,4+m,8+m),i.emplaceBack(7+m,9+m,5+m),i.emplaceBack(0+m,1+m,2+m),i.emplaceBack(1+m,3+m,2+m),m+=10}}function LS(n,e){const i={};i.indexArray=new ar,i.vertexArray=new Fs,i.colorArray=new ju,Jx(n,e,i.indexArray,i.vertexArray,i.colorArray);const o={defined:!0};o.emissiveFactor=Qi.black;const c={};return c.baseColorFactor=Qi.white,o.pbrMetallicRoughness=c,i.material=o,i.aabb=new un([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const zS=dn([{name:"a_pos_3f",components:3,type:"Float32"}]),FS=dn([{name:"a_normal_3",components:3,type:"Int16"}]),kf=dn([{name:"a_centroid_3",components:3,type:"Int16"}]),am=dn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Zg=dn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),Qx=dn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),e0=dn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),tu=dn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),iu=dn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),Lf=bt.types,nu=32767;function Ld(n,e){const i=Lt+e;for(const o of n)for(const c of o)if(c.x<-e||c.x>i||c.y<-e||c.y>i)return!1;return!0}class NS{constructor(){this.layoutVertexArray=new Fs,this.layoutAttenuationArray=new ju,this.layoutColorArray=new jl,this.indexArray=new ar,this.indexArrayForConflation=new ar,this.segmentsBucket=new ta}}class Ew{constructor(){this.layoutVertexArray=new Fs,this.layoutNormalArray=new qc,this.layoutCentroidArray=new qc,this.layoutColorArray=new jl,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutFloodLightDataArray=new jp,this.layoutAOArray=new Uu,this.indexArray=new ar,this.indexArrayForConflation=new ar,this.segmentsBucket=new ta,this.entranceBloom=new NS}}class BS{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new Ew,this.buildingWithFacade=new Ew,this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.buildingWithFacade.layoutFacadePaintArray=new jl,this.buildingWithFacade.layoutFacadeDataArray=new wd,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new jl,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.groundEffect=new dw(e),this.groundEffect.groundRadiusArray=new Uu,this.hasAppearances=null}updateFootprints(e,i){for(const o of this.footprints)i.push({footprint:o,id:e})}updateAppearances(e,i,o,c){}prepare(){return function(){if(Ux!=null||RS!=null)return null;if(jg!=null)return jg;const e=fetch(Tr.BUILDING_GEN_URL);return jg=function(i){let o,c,m,g;function x(){o=new Uint8Array(g.buffer),c=new Int32Array(g.buffer),m=new Float32Array(g.buffer)}function S(){throw new Error("Unexpected BuildingGen error.")}const A=()=>{},M={a:{a:S,f:function(P){const k=o.length,U=Math.max(P>>>0,Math.ceil(1.2*k)),V=Math.ceil((U-k)/65536);try{return g.grow(V),x(),!0}catch{return!1}},g:S,b:A,c:A,d:A,e:A}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,M):i.then(P=>P.arrayBuffer()).then(P=>WebAssembly.instantiate(P,M))).then(P=>{const k=P.instance.exports;return(0,k.g)(),g=k.f,x(),new gA({setStyle:k.h,setAOOptions:k.i,setMetricOptions:k.j,setStructuralOptions:k.k,setFacadeOptions:k.l,setFauxFacadeOptions:k.m,setFacadeClassifierOptions:k.n,addFeature:k.o,addFacade:k.p,generateMesh:k.q,getLastError:k.r,getOuterRingLength:k.s,getMeshCount:k.t,getPositionsPtr:k.u,getPositionsLength:k.v,getNormalsPtr:k.w,getNormalsLength:k.x,getColorsPtr:k.y,getColorsLength:k.z,getAOPtr:k.A,getAOLength:k.B,getUVPtr:k.C,getUVLength:k.D,getFauxFacadePtr:k.E,getFauxFacadeLength:k.F,getIndicesPtr:k.G,getIndicesLength:k.H,getBuildingPart:k.I,getRingCount:k.J,getRingPtr:k.K,getRingLength:k.L,free:k.M,malloc:k.N,heapU8:o,heap32:c,heapF32:m})})}(e).then(i=>(jg=null,Ux=i,Ux)).catch(i=>{Yt("Could not load building-gen"),jg=null,RS=i}),jg}()}populate(e,i,o,c){const m=_A();if(!m)return;const g=De(o);this.tileToMeter=g,this.brightness=i.brightness,m.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,g],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:g,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),m.setAOOptions(!1,.3),m.setMetricOptions(!1,16),m.setStructuralOptions(!0),m.setFacadeClassifierOptions(3);const x=new Map,S=new Map;for(const{feature:A}of e){if(Lf[A.type]!=="LineString"){x.set(A.id,A.properties.source_id);continue}const M=this.layers[0]._featureFilter.needGeometry,P=Je(A,M);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),P,o))continue;const k=M?P.geometry:lt(A,o,c),U=[];for(const ee of k)for(const ae of ee)U.push({x:ae.x,y:ae.y});const V={coordinates:U,crossPerc:A.properties.cross_perc,distanceToRoad:A.properties.distance_to_road,entrances:A.properties.entrances,sourceId:0},q=A.properties.source_id;let J=S.get(q);J||(J=[],S.set(q,J)),J.push(V)}this.maxHeight=0;for(const{feature:A,id:M,index:P,sourceLayerIndex:k}of e){if(Lf[A.type]==="LineString")continue;const U=this.layers[0]._featureFilter.needGeometry,V=Je(A,U);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),V,o))continue;const q=U?V.geometry:lt(A,o,c),J=Is(q,500);if(!Ld(q,163))continue;const ee=this.layers[0],ae=ee.layout.get("building-roof-shape").evaluate(A,{},o);if(ae==="flat")continue;const le=ee.layout.get("building-base").evaluate(A,{},o),de=ee.layout.get("building-height").evaluate(A,{},o),Re=ee.layout.get("building-flood-light-ground-radius").evaluate(A,{},o),Se=ee.paint.get("building-ambient-occlusion-intensity"),Pe=Re/this.tileToMeter;let ke=ee.layout.get("building-flood-light-wall-radius").evaluate(A,{},o);ke=X(ke,0,2048);const Fe=ke/2048*nu,rt=x.get(M);let qe;qe=S.has(rt)?S.get(rt):[];const ot=qe.length!==0&&ee.layout.get("building-facade").evaluate(A,{},o);m.setFacadeOptions(4,!0),m.setFauxFacadeOptions(ot,!1,1);let ht=0,yt=0,Tt=0,Et=0,pt=0,St=0;if(ot){let ct=Math.round(ee.layout.get("building-facade-floors").evaluate(A,{},o));if(le===0){ct=Math.max(1,ct-(qe.length>0?1:0));let xi=4;if(de>100){const gi=[10,13,15];xi=gi[A.id?A.id%gi.length:0],m.setFacadeOptions(xi,!0)}pt=1.6803*xi/g}else pt=le/g;St=de/g,pt=Math.min(pt,St),Tt=ee.layout.get("building-facade-unit-width").evaluate(A,{},o)/g,Et=(St-pt)/ct,m.setFauxFacadeOptions(!0,!0,Tt);const Ht=ee.layout.get("building-facade-window").evaluate(A,{},o);ht=Ht[0],yt=Ht[1]}const tt=[],Qe=new vt(1/0,1/0),xt=new vt(-1/0,-1/0),wt=new vt(0,0);let _t=0;for(const ct of J)if(ct.length>0){const Ht=[];for(const xi of ct){const gi=[];for(let Ki=xi.length-1;Ki>=0;Ki--){const Oi=xi[Ki];gi.push({x:Oi.x,y:Oi.y}),Qe.x=Math.min(Qe.x,Oi.x),Qe.y=Math.min(Qe.y,Oi.y),xt.x=Math.max(xt.x,Oi.x),xt.y=Math.max(xt.y,Oi.y),wt.x+=Oi.x,wt.y+=Oi.y,_t++}Ht.push(gi)}tt.push({id:A.id?A.id:0,height:de,minHeight:le,sourceId:0,roofType:ae,coordinates:Ht})}wt.x/=_t||1,wt.y/=_t||1;const mt=m.generateMesh(tt,qe);if(typeof mt=="string"){Yt(`Unable to generate building ${A.id}: ${mt}`);continue}if(mt.meshes.length===0||mt.modifiedPolygonRings.length===0)continue;let si=0;for(const ct of mt.meshes)si+=ct.positions.length/3;const qt=ot?this.buildingWithFacade:this.buildingWithoutFacade,Gt=qt.segmentsBucket.prepareSegment(si,qt.layoutVertexArray,qt.indexArray),ji=[];let Zt=null,Si=0,Zi=-1;const hn=qt.layoutVertexArray.length,wn=qt.indexArray.length;let Xi=0;for(const ct of mt.meshes){const Ht=qt.layoutVertexArray.length;if(ct.buildingPart==="entrance"){const fi=new Array;for(let On=0;On<ct.positions.length;On+=12){const pr=ct.positions[On+0],ir=ct.positions[On+1],nr=ct.positions[On+3],ur=ct.positions[On+4],Dr=ct.positions[On+2],Nn=ct.positions[On+8]-Dr,$n=1,en=nr-pr,Kn=ur-ir,Ar=Math.hypot(en,Kn);fi.push({pos:[pr+.5*en,ir+.5*Kn,Dr],normal:[Kn/Ar,-en/Ar,0],width:Ar,height:Nn,depth:$n,points:[pr,ir,nr,ur]})}const Hn=qt.entranceBloom.segmentsBucket.prepareSegment(10*fi.length,qt.entranceBloom.layoutVertexArray,qt.entranceBloom.indexArray),yr=qt.entranceBloom.layoutVertexArray.length;Si=qt.entranceBloom.indexArray.length,Jx(fi,.5/this.tileToMeter,qt.entranceBloom.indexArray,qt.entranceBloom.layoutVertexArray,qt.entranceBloom.layoutAttenuationArray);const ki=qt.entranceBloom.layoutVertexArray.length-yr;Zi=qt.entranceBloom.indexArray.length-Si;for(let On=0;On<ki;On++)qt.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Hn.vertexLength+=ki,Hn.primitiveLength+=Zi,Zt={part:ct.buildingPart,vertexOffset:yr,vertexLength:ki}}for(let fi=0;fi<ct.positions.length;fi+=3)Xi=Math.max(Xi,ct.positions[fi+2]),qt.layoutVertexArray.emplaceBack(ct.positions[fi],ct.positions[fi+1],ct.positions[fi+2]);const xi=Math.floor(wt.x),gi=Math.floor(wt.y),Ki=Math.floor(Xi);for(let fi=0;fi<ct.positions.length;fi+=3)qt.layoutCentroidArray.emplaceBack(xi,gi,Ki),qt.layoutFloodLightDataArray.emplaceBack(ct.buildingPart==="wall"?Fe:0);for(let fi=0;fi<ct.normals.length;fi+=3)qt.layoutNormalArray.emplaceBack(ct.normals[fi+0]*nu,ct.normals[fi+1]*nu,ct.normals[fi+2]*nu);for(let fi=0;fi<ct.ao.length;fi++)qt.layoutAOArray.emplaceBack(ct.ao[fi]);for(let fi=0;fi<ct.colors.length;fi+=3){const Hn=1+(ct.ao[fi/3]-1)*Se;qt.layoutColorArray.emplaceBack(ct.colors[fi]*Hn<<8|ct.colors[fi+1]*Hn,ct.colors[fi+2]*Hn<<8)}if(ot){for(let fi=0;fi<ct.positions.length;fi+=3)qt.layoutFacadePaintArray.emplaceBack(65535,255);for(let fi=0;fi<ct.isFauxFacade.length;fi++)if(ct.isFauxFacade[fi]){const Hn=1|Math.min(65535,Math.floor(ct.uv[2*fi]*mt.outerRingLength)),yr=Math.floor(255*ht)<<8|Math.floor(255*yt),ki=Math.floor(65535*Math.min(1,Tt/Lt)),On=Math.floor(65535*Math.min(1,Et/Lt));qt.layoutFacadeDataArray.emplaceBack(Hn,yr,ki,On);const pr=Math.floor(65535*Math.min(1,pt/Lt)),ir=Math.floor(65535*Math.min(1,St/Lt));qt.layoutFacadeVerticalRangeArray.emplaceBack(pr,ir)}else qt.layoutFacadeDataArray.emplaceBack(0,0,0,0),qt.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Oi=Gt.vertexLength;for(let fi=0;fi<ct.indices.length;fi+=3)qt.indexArray.emplaceBack(Oi+ct.indices[fi],Oi+ct.indices[fi+1],Oi+ct.indices[fi+2]);Gt.vertexLength+=ct.positions.length/3,Gt.primitiveLength+=ct.indices.length/3,(ct.buildingPart==="roof"||ct.buildingPart==="wall"||ct.buildingPart==="facade_glazing"||ct.buildingPart==="entrance")&&ji.push({part:ct.buildingPart,vertexOffset:Ht,vertexLength:ct.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Xi),this.buildingFeatures.push({promoteId:M,feature:V,hasFauxFacade:ot,segment:Gt,parts:ji,buildingBloom:Zt});const Gn=qt.indexArray.length-wn,Yn=[],Yr=[],Ee=new vt(1/0,1/0),ve=new vt(-1/0,-1/0),at=this.groundEffect.vertexArray.length;for(const ct of mt.modifiedPolygonRings){const Ht=[],xi=new vt(1/0,1/0),gi=new vt(-1/0,-1/0);for(let Ki=0;Ki<ct.length;Ki+=2){const Oi=ct.length-Ki-2;xi.x=Math.min(xi.x,ct[Oi]),xi.y=Math.min(xi.y,ct[Oi+1]),gi.x=Math.max(gi.x,ct[Oi]),gi.y=Math.max(gi.y,ct[Oi+1]);const fi=new vt(ct[Oi],ct[Oi+1]);Ht.push(fi),Yn.push(fi.x,fi.y),Yr.push(fi.clone())}Ee.x=Math.min(Ee.x,xi.x),Ee.y=Math.min(Ee.y,xi.y),ve.x=Math.max(ve.x,gi.x),ve.y=Math.max(ve.y,gi.y),this.groundEffect.addData(Ht,[xi,gi],Pe)}const Bt=this.groundEffect.vertexArray.length-at;for(let ct=0;ct<Bt;ct++)this.groundEffect.groundRadiusArray.emplaceBack(Re);(Qe.x<0||xt.x>Lt||Qe.y<0||xt.y>Lt)&&this.featuresOnBorder.push({featureId:A.id,footprintIndex:this.footprints.length});{const ct=Zp(Yn,null,2),Ht=new Ix(Yr,ct,8,256);let xi=A.id;A.properties&&A.properties.hasOwnProperty("building_id")&&(xi=A.properties.building_id);const gi={vertices:Yr,indices:ct,grid:Ht,min:Ee,max:ve,buildingId:xi,hiddenFlags:0,indicesOffset:wn,indicesLength:Gn,bloomIndicesOffset:Si,bloomIndicesLength:Zi,groundEffectVertexOffset:at,groundEffectVertexLength:Bt,hasFauxFacade:ot,segment:Gt,height:Xi};A.id!==void 0&&this.featureFootprintLookup.set(A.id,this.footprints.length),this.footprints.push(gi)}this.programConfigurations.populatePaintArrays(qt.layoutVertexArray.length,A,P,{},i.availableImages,o,i.brightness),this.groundEffect.addPaintPropertiesData(A,P,{},i.availableImages,o,i.brightness),i.featureIndex.insert(A,q,P,k,this.index,hn)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(e,i,o,c,m,g,x){this.programConfigurations.updatePaintArrays(e,i,m,o,c,g,x),this.groundEffect.update(e,i,m,o,c,g,x),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=o=>{o.layoutVertexBuffer=e.createVertexBuffer(o.layoutVertexArray,zS.members),o.layoutNormalBuffer=e.createVertexBuffer(o.layoutNormalArray,FS.members),o.layoutCentroidBuffer=e.createVertexBuffer(o.layoutCentroidArray,kf.members),o.layoutFloodLightDataBuffer=e.createVertexBuffer(o.layoutFloodLightDataArray,iu.members),o.layoutFacadeDataArray&&o.layoutFacadeDataArray.length&&(o.layoutFacadeDataBuffer=e.createVertexBuffer(o.layoutFacadeDataArray,Qx.members)),o.layoutFacadeVerticalRangeArray&&o.layoutFacadeVerticalRangeArray.length&&(o.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(o.layoutFacadeVerticalRangeArray,e0.members)),o.entranceBloom.layoutVertexArray.length&&(o.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(o.entranceBloom.layoutVertexArray,zS.members),o.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(o.entranceBloom.layoutAttenuationArray,tu.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,o=!0){let c=!1;const m=o?i:0,g=0|(o?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const x of e){const S=this.footprints[x],A=S.hiddenFlags&g|m;S.hiddenFlags!==A&&(S.hiddenFlags=A,c=!0,this.groundEffect.updateHiddenByLandmarkRange(S.groundEffectVertexOffset,S.groundEffectVertexLength,S.hiddenFlags!==0))}return c&&(this.indexArrayForConflationUploaded=!1),c}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=c=>{c.indexArray.length!==0&&(c.indexArrayForConflation.resize(c.indexArray.length),c.indexArrayForConflation.uint16.set(c.indexArray.uint16),c.entranceBloom.indexArrayForConflation.resize(c.entranceBloom.indexArray.length),c.entranceBloom.indexArrayForConflation.uint16.set(c.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const c of this.footprints){const m=c.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,g=c.indicesOffset+c.indicesLength;if(c.hiddenFlags!==0){for(let S=c.indicesOffset;S<g;S++)m.indexArrayForConflation.uint16[3*S+0]=0,m.indexArrayForConflation.uint16[3*S+1]=0,m.indexArrayForConflation.uint16[3*S+2]=0;const x=c.bloomIndicesOffset+c.bloomIndicesLength;for(let S=c.bloomIndicesOffset;S<x;S++)m.entranceBloom.indexArrayForConflation.uint16[3*S+0]=0,m.entranceBloom.indexArrayForConflation.uint16[3*S+1]=0,m.entranceBloom.indexArrayForConflation.uint16[3*S+2]=0}}const o=c=>{c.indexArray.length!==0&&(c.indexBuffer?c.indexBuffer.updateData(c.indexArrayForConflation):c.indexBuffer=e.createIndexBuffer(c.indexArrayForConflation,!0),c.entranceBloom.indexBuffer?c.entranceBloom.indexBuffer.updateData(c.entranceBloom.indexArrayForConflation):c.entranceBloom.indexBuffer=e.createIndexBuffer(c.entranceBloom.indexArrayForConflation,!0))};o(this.buildingWithoutFacade),o(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=o=>{o.layoutColorBuffer?o.layoutColorBuffer.updateData(o.layoutColorArray):o.layoutColorBuffer=e.createVertexBuffer(o.layoutColorArray,am.members,!0),o.layoutFacadePaintArray&&(o.layoutFacadePaintBuffer?o.layoutFacadePaintBuffer.updateData(o.layoutFacadePaintArray):o.layoutFacadePaintBuffer=e.createVertexBuffer(o.layoutFacadePaintArray,Zg.members,!0)),o.entranceBloom.layoutColorBuffer?o.entranceBloom.layoutColorBuffer.updateData(o.entranceBloom.layoutColorArray):o.entranceBloom.layoutColorBuffer=e.createVertexBuffer(o.entranceBloom.layoutColorArray,am.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const o=e.paint.get("building-ambient-occlusion-intensity");for(const c of this.buildingFeatures){const m=i[c.promoteId],g=c.feature;g.properties["building-part"]="roof";const x=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),S=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="wall";const A=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),M=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="window";const P=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),k=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical);g.properties["building-part"]="door";const U=e.paint.get("building-color").evaluate(g,m,this.canonical).toPremultipliedRenderColor(this.lut),V=e.paint.get("building-emissive-strength").evaluate(g,m,this.canonical),q=c.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const ee of c.parts){let ae,le=x;ee.part==="roof"?(le=x,ae=S):ee.part==="wall"?(le=A,ae=M):ee.part==="facade_glazing"?(le=P,ae=k):ee.part==="entrance"&&(le=U,ae=V),ae=X(ae,0,1);for(let de=0;de<ee.vertexLength;de++){const Re=ee.vertexOffset+de,Se=1+(q.layoutAOArray.float32[Re]-1)*o;q.layoutColorArray.emplace(Re,le.r*Se*255<<8|le.g*Se*255,le.b*Se*255<<8|255*ae),c.hasFauxFacade&&q.layoutFacadePaintArray.emplace(Re,255*P.r<<8|255*P.g,255*P.b<<8|255*k)}}const J=c.buildingBloom;if(J)for(let ee=0;ee<J.vertexLength;ee++)q.entranceBloom.layoutColorArray.emplace(J.vertexOffset+ee,255*U.r<<8|255*U.g,255*U.b<<8|51*V)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,o){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const c=i.getReplacementRegionsForTile(e.toUnwrapped());if(My(this.activeReplacements,c))return;this.activeReplacements=c;for(const g of this.footprints)g.hiddenFlags&=-2;const m=[];for(const g of this.activeReplacements){if(g.order<=Dx)continue;const x=Math.max(1,Math.pow(2,g.footprintTileId.canonical.z-e.canonical.z));for(const S of this.footprints)S.min.x>g.max.x||S.max.x<g.min.x||S.min.y>g.max.y||S.max.y<g.min.y||(m.length=0,om(S.vertices,0,S.vertices.length,g.footprintTileId.canonical,e.canonical,m),Mx(g.footprint,m,S.indices,0,S.indices.length,0,-x)&&(S.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const g of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(g.groundEffectVertexOffset,g.groundEffectVertexLength,g.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const i=this.featureFootprintLookup.get(e.id);return this.footprints[i]}return null}getHeightAtTileCoord(e,i){let o=Number.NEGATIVE_INFINITY,c=!0;const m=4*(e+Lt)*Lt+(i+Lt);if(this.footprintLookup.hasOwnProperty(m)){const x=this.footprintLookup[m];return x?{height:x.height,hidden:x.hiddenFlags!==0}:void 0}const g=new vt(e,i);for(const x of this.footprints)e>x.max.x||x.min.x>e||i>x.max.y||x.min.y>i||x.height<=o||Px(g,x)&&(o=x.height,this.footprintLookup[m]=x,c=x.hiddenFlags!==0);if(o!==Number.NEGATIVE_INFINITY)return{height:o,hidden:c};this.footprintLookup[m]=void 0}}function om(n,e,i,o,c,m){const g=Math.pow(2,o.z-c.z);for(let x=0;x<i;x++){let S=n[x+e].x,A=n[x+e].y;S=(S+c.x*Lt)*g-o.x*Lt,A=(A+c.y*Lt)*g-o.y*Lt,m.push(new vt(S,A))}}let Cw,t0;ai(BS,"BuildingBucket",{omit:["layers"]}),ai(Ew,"BuildingGeometry"),ai(NS,"BuildingBloomGeometry");const i0=dn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),SA=dn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Aw}=i0,EA=dn([{name:"a_packed",components:3,type:"Float32"}]),{members:CA}=EA,sm=dn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Gs}=sm;class gc{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new zh({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const o=this.getKey(e,i);return this.positions[o]}trim(){const e=this.width,i=this.height=Le(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,o){const c=[];let m=e.length%2==1?-e[e.length-1]*o:0,g=e[0]*o,x=!0;c.push({left:m,right:g,isDash:x,zeroLength:e[0]===0});let S=e[0];for(let A=1;A<e.length;A++){x=!x;const M=e[A];m=S*o,S+=M,g=S*o,c.push({left:m,right:g,isDash:x,zeroLength:M===0})}return c}addRoundDash(e,i,o){const c=i/2;for(let m=-o;m<=o;m++){const g=this.width*(this.nextRow+o+m);let x=0,S=e[x];for(let A=0;A<this.width;A++){A/S.right>1&&(S=e[++x]);const M=Math.abs(A-S.left),P=Math.abs(A-S.right),k=Math.min(M,P);let U;const V=m/o*(c+1);if(S.isDash){const q=c-Math.abs(V);U=Math.sqrt(k*k+q*q)}else U=c-Math.sqrt(k*k+V*V);this.image.data[g+A]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(e,i){for(let S=e.length-1;S>=0;--S){const A=e[S],M=e[S+1];A.zeroLength?e.splice(S,1):M&&M.isDash===A.isDash&&(M.left=A.left,e.splice(S,1))}const o=e[0],c=e[e.length-1];o.isDash===c.isDash&&(o.left=c.left-this.width,c.right=o.right+this.width);const m=this.width*this.nextRow;let g=0,x=e[g];for(let S=0;S<this.width;S++){S/x.right>1&&(x=e[++g]);const A=Math.abs(S-x.left),M=Math.abs(S-x.right),P=Math.min(A,M);this.image.data[m+S]=Math.max(0,Math.min(255,(x.isDash?P:-P)+i+128))}}addDash(e,i){const o=this.getKey(e,i);if(this.positions[o])return this.positions[o];const c=i==="round",m=c?7:0,g=2*m+1;if(this.nextRow+g>this.height)return Yt("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let M=0;M<e.length;M++)e[M]<0&&(Yt("Negative value is found in line dasharray, replacing values with 0"),e[M]=0),x+=e[M];if(x!==0){const M=this.width/x,P=this.getDashRanges(e,this.width,M);c?this.addRoundDash(P,M,m):this.addRegularDash(P,i==="square"?.5*M:0)}const S=this.nextRow+m;this.nextRow+=g;const A={tl:[S,m],br:[x,0]};return this.positions[o]=A,A}}ai(gc,"LineAtlas");const Xu=bt.types,lm=Math.cos(Math.PI/180*37.5),zf=Math.cos(Math.PI/180*5);class Rw{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new yg,this.layoutVertexArray2=new Fs,this.patternVertexArray=new Fs,this.indexArray=new ar,this.programConfigurations=new Ns(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new ta,this.maxLineLength=0,this.zOffsetVertexArray=new Fs,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Lt/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,o,c){}populate(e,i,o,c){this.hasPattern=Nh("line",this.layers,this.pixelRatio,i);const m=this.layers[0].layout.get("line-sort-key");this.tileToMeter=De(o);const g=this.layers[0].layout.get("line-elevation-reference");if(g==="hd-road-markup")this.elevationType="road";else{const k=this.layers[0].layout.get("line-z-offset"),U=k.isConstant()&&!k.constantOr(0);this.elevationType=g!=="sea"&&g!=="ground"&&U?"none":"offset",this.elevationType==="offset"&&g==="none"&&Yt(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&x!==void 0;const S=[];for(const{feature:k,id:U,index:V,sourceLayerIndex:q}of e){const J=this.layers[0]._featureFilter.needGeometry,ee=Je(k,J);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),ee,o))continue;const ae=m?m.evaluate(ee,{},o):void 0,le={id:U,properties:k.properties,type:k.type,sourceLayerIndex:q,index:V,geometry:J?ee.geometry:lt(k,o,c),patterns:{},sortKey:ae};S.push(le)}m&&S.sort((k,U)=>k.sortKey-U.sortKey);const{lineAtlas:A,featureIndex:M}=i,P=this.addConstantDashes(A);for(const k of S){const{geometry:U,index:V,sourceLayerIndex:q}=k;if(P&&this.addFeatureDashes(k,A),this.hasPattern){const J=Ax("line",this.layers,k,this.zoom,this.pixelRatio,i);this.patternFeatures.push(J)}else this.addFeature(k,U,V,o,A.positions,i.availableImages,i.brightness,i.elevationFeatures);M.insert(e[V].feature,U,V,q,this.index)}}addConstantDashes(e){let i=!1;for(const o of this.layers){const c=o.paint.get("line-dasharray").value,m=o.layout.get("line-cap").value;if(c.kind!=="constant"||m.kind!=="constant")i=!0;else{const g=m.value,x=c.value;if(!x)continue;e.addDash(x,g)}}return i}addFeatureDashes(e,i){const o=this.zoom;for(const c of this.layers){const m=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if(m.kind==="constant"&&g.kind==="constant")continue;let x,S;if(m.kind==="constant"){if(x=m.value,!x)continue}else x=m.evaluate({zoom:o},e);S=g.kind==="constant"?g.value:g.evaluate({zoom:o},e),i.addDash(x,S),e.patterns[c.id]=[i.getKey(x,S)]}}update(e,i,o,c,m,g,x,S){this.programConfigurations.updatePaintArrays(e,i,m,o,c,g,x,S)}addFeatures(e,i,o,c,m,g){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,o,c,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,CA)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Gs)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,SA.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Aw),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let o,c;if(i&&i>0?(o=`mapbox_clip_start_${i}`,c=`mapbox_clip_end_${i}`):(o="mapbox_clip_start",c="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(o)&&e.properties.hasOwnProperty(c))return{start:+e.properties[o],end:+e.properties[c]}}addFeature(e,i,o,c,m,g,x,S){const A=this.layers[0].layout,M=A.get("line-join").evaluate(e,{}),P=A.get("line-cap").evaluate(e,{}),k=A.get("line-miter-limit"),U=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const V=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=A.get("line-z-offset").value;const q=this.layers[0].paint.get("line-width").value;if(q.kind!=="constant"&&q.isLineProgressConstant===!1&&(this.variableWidthValue=q),this.elevationType==="road"){const J=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,c,S,M,P,k,U)){const[ee,ae]=this.clipRuntimeLinesToTile(i,1);for(let le=0;le<ee.length;le++){const de=ee[le],Re=ae[le],Se={progress:{min:Re.progress.min,max:Re.progress.max},nextDir:this.computeSegNextDir(Re,de),prevDir:this.computeSegPrevDir(Re,de)};this.addLine(de,e,c,M,P,k,U,Se,V&&Re.parentIndex>0?Re.parentIndex:null)}this.fillNonElevatedRoadSegment(J)}}else for(let J=0;J<i.length;J++)this.addLine(i[J],e,c,M,P,k,U,void 0,V&&J>0?J:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,m,g,c,x,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return Fx(e,-i,-i,Lt+i,Lt+i)}clipRuntimeLinesToTile(e,i){const o=[];return[Fx(e,-i,-i,Lt+i,Lt+i,o),o]}addElevatedRoadFeature(e,i,o,c,m,g,x,S){const A=[],M=Fi.getElevationFeature(e,c);if(M){const P=this.clipLinesToTile(i,1),k=this.prepareElevatedLines(P,M,o);for(const U of k)A.push({geometry:U,elevation:M,elevationTileID:o,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(A.length===0)return!1;for(const P of A){const k=this.layoutVertexArray.length;this.addLine(P.geometry,e,o,m,g,x,S);const U=new zn(o,P.elevationTileID);if(P.elevation)for(let V=k;V<this.layoutVertexArray.length;V++){const q=new vt(this.layoutVertexArray.int16[6*V]>>1,this.layoutVertexArray.int16[6*V+1]>>1),J=U.pointElevation(q,P.elevation,.05);this.updateHeightRange(J),this.zOffsetVertexArray.emplaceBack(J,0,0)}else this.fillNonElevatedRoadSegment(k)}return!0}prepareElevatedLines(e,i,o){if(i.constantHeight!=null)return e;const c=[],m=1/De(o);for(const g of e)pA(g,new kr(i,m),0,c);return c}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,o,c,m,g,x,S,A){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=A?this.lineFeatureClips(i,A):this.lineClips;const M=c==="none";this.patternJoinNone=this.hasPattern&&M,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const P=S&&S.progress.min>0,k=S&&S.progress.max<1;if(this.lineClips){let Fe={min:this.lineClips.start,max:this.lineClips.end},rt=1;if(S){const ht=this.lineClips.end-this.lineClips.start;Fe=function(yt,Tt,Et){return{min:rr(yt.min,Tt,Et),max:rr(yt.max,Tt,Et)}}(S.progress,{min:0,max:1},Fe),ht>0&&(rt=(Fe.max-Fe.min)/ht)}const qe=+i.properties.mapbox_clip_feature_len,ot=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(qe)||Number.isNaN(ot)){for(let yt=0;yt<e.length-1;yt++)this.totalDistance+=e[yt].dist(e[yt+1]);const ht=this.totalDistance/(Fe.max-Fe.min);this.totalFeatureLength=Number.isFinite(ht)?ht:0,this.lineClips.start=Fe.min,this.lineClips.end=Fe.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=qe,this.distance=ot*rt,this.lineClips.start=Fe.min,this.lineClips.end=Fe.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const U=Xu[i.type]==="Polygon";let V=e.length;for(;V>=2&&e[V-1].equals(e[V-2]);)V--;let q=0;for(;q<V-1&&e[q].equals(e[q+1]);)q++;if(V<(U?3:2))return;c==="bevel"&&(g=1.05);const J=this.segments.prepareSegment(10*V,this.layoutVertexArray,this.indexArray);let ee,ae,le,de,Re,Se,Pe,ke;S&&S.prevDir&&(Se=S.prevDir.perp()),S&&S.nextDir&&(Pe=S.nextDir.perp()),this.e1=this.e2=-1,U&&(ee=e[V-2],Re=e[q].sub(ee)._unit()._perp());for(let Fe=q;Fe<V;Fe++){if(le=Fe===V-1?U?e[q+1]:void 0:e[Fe+1],le&&e[Fe].equals(le))continue;Re&&(de=Re),ee&&(ae=ee),ee=e[Fe],ke=this.evaluateLineProgressFeatures(ae?ae.dist(ee):0),Re=le?le.sub(ee)._unit()._perp():de,de=de||Re;const rt=ae&&le;let qe=rt?c:U||M?"butt":m;const ot=de.x*Re.x+de.y*Re.y;if(M){const Qe=function(xt){if(xt.patternJoinNone){const wt=xt.segmentPoints.length/2,_t=xt.lineSoFar-xt.segmentStart;for(let mt=0;mt<wt;++mt){const si=xt.segmentPoints[2*mt+1],qt=Math.round(xt.segmentPoints[2*mt])+.5+.25*si;xt.patternVertexArray.emplaceBack(qt,_t,xt.segmentStart),xt.patternVertexArray.emplaceBack(qt,_t,xt.segmentStart)}xt.segmentPoints.length=0}xt.e1=xt.e2=-1};if(rt&&ot<zf){this.updateDistance(ae,ee),this.addCurrentVertex(ee,de,1,1,J,ke),Qe(this),this.addCurrentVertex(ee,Re,-1,-1,J,ke);continue}if(ae){if(!le){this.updateDistance(ae,ee),this.addCurrentVertex(ee,de,1,1,J,ke),Qe(this);continue}qe="miter"}}let ht=de.add(Re);ht.x===0&&ht.y===0||ht._unit();const yt=ht.x*Re.x+ht.y*Re.y,Tt=yt!==0?1/yt:1/0,Et=2*Math.sqrt(2-2*yt),pt=yt<lm&&ae&&le,St=de.x*Re.y-de.y*Re.x>0,tt=this.overscaling<=16?15*Lt/(512*this.overscaling):0;if(rt&&qe==="round"){if(Tt<x)qe="miter";else if(Tt<=2){const Qe=n0(ee,-10,Lt+10);qe=this.elevationType==="offset"&&(Qe||this.hasCrossSlope)?"miter":"fakeround"}}if(qe==="miter"&&Tt>g&&(qe="bevel"),qe==="bevel"&&(Tt>2&&(qe="flipbevel"),Tt<g&&(qe="miter")),ae&&!(qe==="miter"&&pt)&&this.updateDistance(ae,ee),qe==="miter")if(pt){const Qe=ee.dist(ae);if(Qe>2*tt){const wt=ee.sub(ee.sub(ae)._mult(tt/Qe)._round());this.updateDistance(ae,wt),this.addCurrentVertex(wt,de,0,0,J,ke),ae=wt}this.updateDistance(ae,ee),ht._mult(Tt),this.addCurrentVertex(ee,ht,0,0,J,ke);const xt=ee.dist(le);if(xt>2*tt){const wt=ee.add(le.sub(ee)._mult(tt/xt)._round());this.updateDistance(ee,wt),this.addCurrentVertex(wt,Re,0,0,J,ke),ee=wt}}else ht._mult(Tt),this.addCurrentVertex(ee,ht,0,0,J,ke);else if(qe==="flipbevel"){if(Tt>100)ht=Re.mult(-1);else{const Qe=Tt*de.add(Re).mag()/de.sub(Re).mag();ht._perp()._mult(Qe*(St?-1:1))}this.addCurrentVertex(ee,ht,0,0,J,ke),this.addCurrentVertex(ee,ht.mult(-1),0,0,J,ke)}else if(qe==="bevel"||qe==="fakeround"){ke!=null&&ae&&this.addCurrentVertex(ee,Pe||de,-1,-1,J,ke);const Qe=ee.dist(ae)<=2*tt&&qe!=="bevel",xt=ht.mult(St?1:-1);xt._mult(Tt);const wt=Re.mult(St?-1:1),_t=de.mult(St?-1:1),mt=this.evaluateLineProgressFeatures(this.distance);if(ke==null&&(this.addHalfVertex(ee,xt.x,xt.y,!1,!St,0,J,mt),Qe||this.addHalfVertex(ee,xt.x+2*_t.x,xt.y+2*_t.y,!1,St,0,J,mt)),qe==="fakeround"){const si=Math.round(180*Et/Math.PI/20);this.addHalfVertex(ee,_t.x,_t.y,!1,St,0,J,mt);for(let qt=0;qt<si;qt++){let Gt=qt/si;if(Gt!==.5){const Zt=Gt-.5;Gt+=Gt*Zt*(Gt-1)*((1.0904+ot*(ot*(3.55645-1.43519*ot)-3.2452))*Zt*Zt+(.848013+ot*(.215638*ot-1.06021)))}const ji=wt.sub(_t)._mult(Gt)._add(_t)._unit();this.addHalfVertex(ee,ji.x,ji.y,!1,St,0,J,mt)}this.addHalfVertex(ee,wt.x,wt.y,!1,St,0,J,mt)}Qe||ke!=null||this.addHalfVertex(ee,xt.x+2*wt.x,xt.y+2*wt.y,!1,St,0,J,mt),ke!=null&&le&&this.addCurrentVertex(ee,Se||Re,1,1,J,ke)}else if(qe==="butt")this.addCurrentVertex(ee,ht,0,0,J,ke);else if(qe==="square"){if(!ae){const Qe=P?0:-1;this.addCurrentVertex(ee,ht,Qe,Qe,J,ke)}if(this.addCurrentVertex(ee,ht,0,0,J,ke),ae){const Qe=k?0:1;this.addCurrentVertex(ee,ht,Qe,Qe,J,ke)}}else if(qe==="round"){if(ae){const Qe=!rt&&Pe?Pe:de;this.addCurrentVertex(ee,Qe,0,0,J,ke),!rt&&k||this.addCurrentVertex(ee,Qe,1,1,J,ke,!0)}if(le){const Qe=!rt&&Se?Se:Re;!rt&&P||this.addCurrentVertex(ee,Qe,-1,-1,J,ke,!0),this.addCurrentVertex(ee,Qe,0,0,J,ke)}}}}addVerticesTo(e,i,o,c,m,g,x,S,A,M){const P=(i.w-e.w)/this.tessellationStep|0;let k=0;const U=this.scaledDistance;if(P>1){this.lineSoFar=e.w;const q=(i.x-e.x)/P,J=(i.y-e.y)/P,ee=(i.z-e.z)/P,ae=(i.w-e.w)/P;for(let le=1;le<P;++le){e.x+=q,e.y+=J,e.z+=ee,this.lineSoFar+=ae,k+=ae;const de=this.evaluateLineProgressFeatures(this.prevDistance+k);this.scaledDistance=(this.prevDistance+k)/this.totalDistance,this.addHalfVertex(e,o,c,M,!1,x,A,de),this.addHalfVertex(e,m,g,M,!0,-S,A,de)}}this.lineSoFar=i.w,this.scaledDistance=U;const V=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,o,c,M,!1,x,A,V),this.addHalfVertex(i,m,g,M,!0,-S,A,V)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Yt(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,o,c,m,g,x=!1){const S=i.x+i.y*o,A=i.y-i.x*o,M=i.y*c-i.x,P=-i.y-i.x*c;if(g!=null){const k=this.elevationType==="offset",U=-10,V=Lt+10,q=g.zOffset,J=new zx(e.x,e.y,q,this.lineSoFar),ee=!!k&&n0(e,U,V),ae=this.lineSoFar,le=this.distance;if(this.currentVertex)if(ee){const de=this.currentVertexIsOutside,Re=this.currentVertex,Se=new zx(e.x,e.y,q,this.lineSoFar);if(wS(Re,Se,U,V),!n0(Se,U,V)){if(de){this.e1=this.e2=-1,this.distance-=Re.dist(J),this.lineSoFar=Re.w;const Pe=this.evaluateLineProgressFeatures(Re.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Re,S,A,x,!1,o,m,Pe),this.addHalfVertex(Re,M,P,x,!0,-c,m,Pe),this.prevDistance=this.distance}this.distance=this.prevDistance+Re.dist(Se),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Re,Se,S,A,M,P,o,c,m,x),this.distance=le,this.scaledDistance=this.distance/this.totalDistance}}else{const de=this.currentVertex;if(this.currentVertexIsOutside){wS(de,J,U,V),this.e1=this.e2=-1,this.distance-=de.dist(J),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=de.w;const Re=this.evaluateLineProgressFeatures(de.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(de,S,A,x,!1,o,m,Re),this.addHalfVertex(de,M,P,x,!0,-c,m,Re),this.prevDistance=this.distance,this.distance=le,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(de,J,S,A,M,P,o,c,m,x)}else ee||(this.addHalfVertex(e,S,A,x,!1,o,m,g),this.addHalfVertex(e,M,P,x,!0,-c,m,g));this.currentVertex=J,this.currentVertexIsOutside=ee,this.lineSoFar=ae}else this.addHalfVertex(e,S,A,x,!1,o,m,g),this.addHalfVertex(e,M,P,x,!0,-c,m,g)}addHalfVertex({x:e,y:i},o,c,m,g,x,S,A){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),g||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(i<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const P=wi(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,P)}const M=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),S.primitiveLength++),g?this.e2=M:this.e1=M,A!=null&&this.zOffsetVertexArray.emplaceBack(A.zOffset,A.variableWidth,A.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function n0(n,e,i){return n.x<e||n.x>i||n.y<e||n.y>i}let US,VS;function jS(n,e,i){return e*(Lt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}ai(Rw,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Iw=(n,e,i)=>(1-i)*n+i*e;function Dw(n,e){return 1/jS(n,1,e.tileZoom)}function r0(n,e,i,o){return n.translatePosMatrix(o||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Mw=n=>{const e=[];Pw(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=n.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const o=n.layout.get("line-join").constantOr("miter")==="none",c=!!n.paint.get("line-pattern").constantOr(1);return o&&c&&e.push("LINE_JOIN_NONE"),e};function Pw(n){const e=n.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let Hy;const a0=()=>Hy||(Hy={layout:US||(US=new ea({"line-cap":new Wt(We.layout_line["line-cap"]),"line-join":new Wt(We.layout_line["line-join"]),"line-miter-limit":new At(We.layout_line["line-miter-limit"]),"line-round-limit":new At(We.layout_line["line-round-limit"]),"line-sort-key":new Wt(We.layout_line["line-sort-key"]),"line-z-offset":new Wt(We.layout_line["line-z-offset"]),"line-elevation-reference":new At(We.layout_line["line-elevation-reference"]),"line-cross-slope":new At(We.layout_line["line-cross-slope"]),visibility:new At(We.layout_line.visibility),"line-width-unit":new At(We.layout_line["line-width-unit"])})),paint:VS||(VS=new ea({"line-opacity":new Wt(We.paint_line["line-opacity"]),"line-color":new Wt(We.paint_line["line-color"]),"line-translate":new At(We.paint_line["line-translate"]),"line-translate-anchor":new At(We.paint_line["line-translate-anchor"]),"line-width":new Wt(We.paint_line["line-width"]),"line-gap-width":new Wt(We.paint_line["line-gap-width"]),"line-offset":new Wt(We.paint_line["line-offset"]),"line-blur":new Wt(We.paint_line["line-blur"]),"line-dasharray":new Wt(We.paint_line["line-dasharray"]),"line-pattern":new Wt(We.paint_line["line-pattern"]),"line-pattern-cross-fade":new At(We.paint_line["line-pattern-cross-fade"]),"line-gradient":new Eh(We.paint_line["line-gradient"]),"line-trim-offset":new At(We.paint_line["line-trim-offset"]),"line-trim-fade-range":new At(We.paint_line["line-trim-fade-range"]),"line-trim-color":new At(We.paint_line["line-trim-color"]),"line-emissive-strength":new At(We.paint_line["line-emissive-strength"]),"line-border-width":new Wt(We.paint_line["line-border-width"]),"line-border-color":new Wt(We.paint_line["line-border-color"]),"line-occlusion-opacity":new At(We.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"})}))},Hy);class Ow extends Wt{possiblyEvaluate(e,i){return i=new Er(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,o,c){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,o,c)}}let $y;function GS(n,e){return e>0?e+2*n:n}const AA=dn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),RA=dn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),HS=dn([{name:"a_projected_pos",components:4,type:"Float32"}],4);dn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const o0=dn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),IA=dn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),$S=dn([{name:"a_texb",components:2,type:"Uint16"}]),Xg=dn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),WS=dn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ds=dn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),kw=dn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);dn([{name:"triangle",components:3,type:"Uint16"}]),dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),dn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),dn([{type:"Float32",name:"offsetX"}]),dn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var zo=24;function DA(n,e,i){return n.sections.forEach(o=>{o.text=function(c,m,g){const x=m.layout.get("text-transform").evaluate(g,{});return x==="uppercase"?c=c.toLocaleUpperCase():x==="lowercase"&&(c=c.toLocaleLowerCase()),tl.applyArabicShaping&&(c=tl.applyArabicShaping(c)),c}(o.text,e,i)}),n}const Wy={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Yu(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}function MA(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}const zd=4294967296,Yg=1/zd,Kg=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Ff=class{constructor(n=new Uint8Array(16)){this.buf=ArrayBuffer.isView(n)?n:new Uint8Array(n),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(n,e,i=this.length){for(;this.pos<i;){const o=this.readVarint(),c=o>>3,m=this.pos;this.type=7&o,n(c,e,this),this.pos===m&&this.skip(o)}return e}readMessage(n,e){return this.readFields(n,e,this.readVarint()+this.pos)}readFixed32(){const n=this.dataView.getUint32(this.pos,!0);return this.pos+=4,n}readSFixed32(){const n=this.dataView.getInt32(this.pos,!0);return this.pos+=4,n}readFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*zd;return this.pos+=8,n}readSFixed64(){const n=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*zd;return this.pos+=8,n}readFloat(){const n=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,n}readDouble(){const n=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,n}readVarint(n){const e=this.buf;let i,o;return o=e[this.pos++],i=127&o,o<128?i:(o=e[this.pos++],i|=(127&o)<<7,o<128?i:(o=e[this.pos++],i|=(127&o)<<14,o<128?i:(o=e[this.pos++],i|=(127&o)<<21,o<128?i:(o=e[this.pos],i|=(15&o)<<28,function(c,m,g){const x=g.buf;let S,A;if(A=x[g.pos++],S=(112&A)>>4,A<128||(A=x[g.pos++],S|=(127&A)<<3,A<128)||(A=x[g.pos++],S|=(127&A)<<10,A<128)||(A=x[g.pos++],S|=(127&A)<<17,A<128)||(A=x[g.pos++],S|=(127&A)<<24,A<128)||(A=x[g.pos++],S|=(1&A)<<31,A<128))return jh(c,S,m);throw new Error("Expected varint not more than 10 bytes")}(i,n,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const n=this.readVarint();return n%2==1?(n+1)/-2:n/2}readBoolean(){return!!this.readVarint()}readString(){const n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&Kg?Kg.decode(this.buf.subarray(e,n)):function(i,o,c){let m="",g=o;for(;g<c;){const x=i[g];let S,A,M,P=null,k=x>239?4:x>223?3:x>191?2:1;if(g+k>c)break;k===1?x<128&&(P=x):k===2?(S=i[g+1],(192&S)==128&&(P=(31&x)<<6|63&S,P<=127&&(P=null))):k===3?(S=i[g+1],A=i[g+2],(192&S)==128&&(192&A)==128&&(P=(15&x)<<12|(63&S)<<6|63&A,(P<=2047||P>=55296&&P<=57343)&&(P=null))):k===4&&(S=i[g+1],A=i[g+2],M=i[g+3],(192&S)==128&&(192&A)==128&&(192&M)==128&&(P=(15&x)<<18|(63&S)<<12|(63&A)<<6|63&M,(P<=65535||P>=1114112)&&(P=null))),P===null?(P=65533,k=1):P>65535&&(P-=65536,m+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),m+=String.fromCharCode(P),g+=k}return m}(this.buf,e,n)}readBytes(){const n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e}readPackedVarint(n=[],e){const i=this.readPackedEnd();for(;this.pos<i;)n.push(this.readVarint(e));return n}readPackedSVarint(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSVarint());return n}readPackedBoolean(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readBoolean());return n}readPackedFloat(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFloat());return n}readPackedDouble(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readDouble());return n}readPackedFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed32());return n}readPackedSFixed32(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed32());return n}readPackedFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readFixed64());return n}readPackedSFixed64(n=[]){const e=this.readPackedEnd();for(;this.pos<e;)n.push(this.readSFixed64());return n}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(n){const e=7&n;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(n,e){this.writeVarint(n<<3|e)}realloc(n){let e=this.length||16;for(;e<this.pos+n;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeSFixed32(n){this.realloc(4),this.dataView.setInt32(this.pos,n,!0),this.pos+=4}writeFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*Yg),!0),this.pos+=8}writeSFixed64(n){this.realloc(8),this.dataView.setInt32(this.pos,-1&n,!0),this.dataView.setInt32(this.pos+4,Math.floor(n*Yg),!0),this.pos+=8}writeVarint(n){(n=+n||0)>268435455||n<0?function(e,i){let o,c;if(e>=0?(o=e%4294967296|0,c=e/4294967296|0):(o=~(-e%4294967296),c=~(-e/4294967296),4294967295^o?o=o+1|0:(o=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(m,g,x){x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7)}(o,0,i),function(m,g){const x=(7&m)<<4;g.buf[g.pos++]|=x|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(c,i)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))}writeSVarint(n){this.writeVarint(n<0?2*-n-1:2*n)}writeBoolean(n){this.writeVarint(+n)}writeString(n){n=String(n),this.realloc(4*n.length),this.pos++;const e=this.pos;this.pos=function(o,c,m){for(let g,x,S=0;S<c.length;S++){if(g=c.charCodeAt(S),g>55295&&g<57344){if(!x){g>56319||S+1===c.length?(o[m++]=239,o[m++]=191,o[m++]=189):x=g;continue}if(g<56320){o[m++]=239,o[m++]=191,o[m++]=189,x=g;continue}g=x-55296<<10|g-56320|65536,x=null}else x&&(o[m++]=239,o[m++]=191,o[m++]=189,x=null);g<128?o[m++]=g:(g<2048?o[m++]=g>>6|192:(g<65536?o[m++]=g>>12|224:(o[m++]=g>>18|240,o[m++]=g>>12&63|128),o[m++]=g>>6&63|128),o[m++]=63&g|128)}return m}(this.buf,n,this.pos);const i=this.pos-e;i>=128&&Jg(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(n){this.realloc(4),this.dataView.setFloat32(this.pos,n,!0),this.pos+=4}writeDouble(n){this.realloc(8),this.dataView.setFloat64(this.pos,n,!0),this.pos+=8}writeBytes(n){const e=n.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=n[i]}writeRawMessage(n,e){this.pos++;const i=this.pos;n(e,this);const o=this.pos-i;o>=128&&Jg(i,o,this),this.pos=i-1,this.writeVarint(o),this.pos+=o}writeMessage(n,e,i){this.writeTag(n,2),this.writeRawMessage(e,i)}writePackedVarint(n,e){e.length&&this.writeMessage(n,qy,e)}writePackedSVarint(n,e){e.length&&this.writeMessage(n,cm,e)}writePackedBoolean(n,e){e.length&&this.writeMessage(n,Lw,e)}writePackedFloat(n,e){e.length&&this.writeMessage(n,s0,e)}writePackedDouble(n,e){e.length&&this.writeMessage(n,qS,e)}writePackedFixed32(n,e){e.length&&this.writeMessage(n,zw,e)}writePackedSFixed32(n,e){e.length&&this.writeMessage(n,Fw,e)}writePackedFixed64(n,e){e.length&&this.writeMessage(n,Nw,e)}writePackedSFixed64(n,e){e.length&&this.writeMessage(n,Bw,e)}writeBytesField(n,e){this.writeTag(n,2),this.writeBytes(e)}writeFixed32Field(n,e){this.writeTag(n,5),this.writeFixed32(e)}writeSFixed32Field(n,e){this.writeTag(n,5),this.writeSFixed32(e)}writeFixed64Field(n,e){this.writeTag(n,1),this.writeFixed64(e)}writeSFixed64Field(n,e){this.writeTag(n,1),this.writeSFixed64(e)}writeVarintField(n,e){this.writeTag(n,0),this.writeVarint(e)}writeSVarintField(n,e){this.writeTag(n,0),this.writeSVarint(e)}writeStringField(n,e){this.writeTag(n,2),this.writeString(e)}writeFloatField(n,e){this.writeTag(n,5),this.writeFloat(e)}writeDoubleField(n,e){this.writeTag(n,1),this.writeDouble(e)}writeBooleanField(n,e){this.writeVarintField(n,+e)}};function jh(n,e,i){return i?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function Jg(n,e,i){const o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(o);for(let c=i.pos-1;c>=n;c--)i.buf[c+o]=i.buf[c]}function qy(n,e){for(let i=0;i<n.length;i++)e.writeVarint(n[i])}function cm(n,e){for(let i=0;i<n.length;i++)e.writeSVarint(n[i])}function s0(n,e){for(let i=0;i<n.length;i++)e.writeFloat(n[i])}function qS(n,e){for(let i=0;i<n.length;i++)e.writeDouble(n[i])}function Lw(n,e){for(let i=0;i<n.length;i++)e.writeBoolean(n[i])}function zw(n,e){for(let i=0;i<n.length;i++)e.writeFixed32(n[i])}function Fw(n,e){for(let i=0;i<n.length;i++)e.writeSFixed32(n[i])}function Nw(n,e){for(let i=0;i<n.length;i++)e.writeFixed64(n[i])}function Bw(n,e){for(let i=0;i<n.length;i++)e.writeSFixed64(n[i])}const l0=3;function PA(n,e,i){e.glyphs=[],n===1&&i.readMessage(Zy,e)}function Zy(n,e,i){if(n===3){const{id:o,bitmap:c,width:m,height:g,left:x,top:S,advance:A}=i.readMessage(c0,{});e.glyphs.push({id:o,bitmap:new zh({width:m+2*l0,height:g+2*l0},c),metrics:{width:m,height:g,left:x,top:S,advance:A}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function c0(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const Xy=l0,ll={horizontal:1,vertical:2,horizontalOnly:3};class Qg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const o=new Qg;return o.scale=e||1,o.fontStack=i,o}static forImage(e){const i=new Qg;return i.image=e,i}}class Ku{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,o){const c=new Ku;for(let m=0;m<e.sections.length;m++){const g=e.sections[m];g.image?c.addImageSection(g,o):c.addTextSection(g,i)}return c}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,o){let c="";for(let m=0;m<i.length;m++){const g=i.charCodeAt(m+1)||null,x=i.charCodeAt(m-1)||null;c+=!o&&(g&&fg(g)&&!Wy[i[m+1]]||x&&fg(x)&&!Wy[i[m-1]])||!Wy[i[m]]?i[m]:Wy[i[m]]}return c}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&h0[this.text.charCodeAt(o)];o++)e++;let i=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&h0[this.text.charCodeAt(o)];o--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const o=new Ku;return o.text=this.text.substring(e,i),o.sectionIndex=this.sectionIndex.slice(e,i),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Qg.forText(e.scale,e.fontStack||i));const o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e,i){const o=e.image?e.image.getPrimary():null;if(!o)return void Yt("Can't add FormattedSection with an empty image.");o.scaleSelf(i);const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCodePoint(c),this.sections.push(Qg.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Yt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function u0(n,e,i,o,c,m,g,x,S,A,M,P,k,U,V,q=1){const J=Ku.fromFeature(n,c,q);P===ll.vertical&&J.verticalizePunctuation(k);let ee=[];const ae=function(Pe,ke,Fe,rt,qe,ot){if(!Pe)return[];const ht=[],yt=function(St,tt,Qe,xt,wt,_t){let mt=0;for(let si=0;si<St.length();si++){const qt=St.getSection(si);mt+=d0(St.getCodePoint(si),qt,xt,wt,tt,_t)}return mt/Math.max(1,Math.ceil(mt/Qe))}(Pe,ke,Fe,rt,qe,ot),Tt=Pe.text.indexOf("")>=0;let Et=0;for(let St=0;St<Pe.length();St++){const tt=Pe.getSection(St),Qe=Pe.getCodePoint(St);if(h0[Qe]||(Et+=d0(Qe,tt,rt,qe,ke,ot)),St<Pe.length()-1){const xt=!((pt=Qe)<11904||!(Ri["Bopomofo Extended"](pt)||Ri.Bopomofo(pt)||Ri["CJK Compatibility Forms"](pt)||Ri["CJK Compatibility Ideographs"](pt)||Ri["CJK Compatibility"](pt)||Ri["CJK Radicals Supplement"](pt)||Ri["CJK Strokes"](pt)||Ri["CJK Symbols and Punctuation"](pt)||Ri["CJK Unified Ideographs Extension A"](pt)||Ri["CJK Unified Ideographs"](pt)||Ri["Enclosed CJK Letters and Months"](pt)||Ri["Halfwidth and Fullwidth Forms"](pt)||Ri.Hiragana(pt)||Ri["Ideographic Description Characters"](pt)||Ri["Kangxi Radicals"](pt)||Ri["Katakana Phonetic Extensions"](pt)||Ri.Katakana(pt)||Ri["Vertical Forms"](pt)||Ri["Yi Radicals"](pt)||Ri["Yi Syllables"](pt)));(OA[Qe]||xt||tt.image)&&ht.push(um(St+1,Et,yt,ht,p0(Qe,Pe.getCodePoint(St+1),xt&&Tt),!1))}}var pt;return m0(um(Pe.length(),Et,yt,ht,0,!0))}(J,A,m,e,o,U),{processBidirectionalText:le,processStyledBidirectionalText:de}=tl;if(le&&J.sections.length===1){const Pe=le(J.toString(),ae);for(const ke of Pe){const Fe=new Ku;Fe.text=ke,Fe.sections=J.sections;for(let rt=0;rt<ke.length;rt++)Fe.sectionIndex.push(0);ee.push(Fe)}}else if(de){const Pe=de(J.text,J.sectionIndex,ae);for(const ke of Pe){const Fe=new Ku;Fe.text=ke[0],Fe.sectionIndex=ke[1],Fe.sections=J.sections,ee.push(Fe)}}else ee=function(Pe,ke){const Fe=[],rt=Pe.text;let qe=0;for(const ot of ke)Fe.push(Pe.substring(qe,ot)),qe=ot;return qe<rt.length&&Fe.push(Pe.substring(qe,rt.length)),Fe}(J,ae);const Re=[],Se={positionedLines:Re,text:J.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Pe,ke,Fe,rt,qe,ot,ht,yt,Tt,Et,pt,St){let tt=0,Qe=0,xt=0;const wt=yt==="right"?1:yt==="left"?0:.5;let _t=!1;for(const Zt of qe){const Si=Zt.getSections();for(const Zi of Si){if(Zi.image)continue;const hn=ke[Zi.fontStack];if(hn&&(_t=hn.ascender!==void 0&&hn.descender!==void 0,!_t))break}if(!_t)break}let mt=0;for(const Zt of qe){Zt.trim();const Si=Zt.getMaxScale(),Zi=(Si-1)*zo,hn={positionedGlyphs:[],lineOffset:0};Pe.positionedLines[mt]=hn;const wn=hn.positionedGlyphs;let Xi=0;if(!Zt.length()){Qe+=ot,++mt;continue}let Gn=0,Yn=0;for(let Ee=0;Ee<Zt.length();Ee++){const ve=Zt.getSection(Ee),at=Zt.getSectionIndex(Ee),Bt=Zt.getCodePoint(Ee);let ct=ve.scale,Ht=null,xi=null,gi=null,Ki=zo,Oi=0,fi=Tt;fi===ll.vertical&&((si=Bt)===12312||si===12313||si===12316||si===12540||si===12448)&&(fi=ll.horizontal);const Hn=!(fi===ll.horizontal||!pt&&!dg(Bt)||pt&&(h0[Bt]||ey(Bt)));if(ve.image){const yr=rt.get(ve.image.toString());if(!yr)continue;gi=ve.image,Pe.iconsInText=Pe.iconsInText||!0,xi=yr.paddedRect;const ki=yr.displaySize;ct=ct*zo/St,Ht={width:ki[0],height:ki[1],left:0,top:-Xy,advance:Hn?ki[1]:ki[0],localGlyph:!1},Oi=_t?-Ht.height*ct:Si*zo-17-ki[1]*ct,Ki=Ht.advance;const On=(Hn?ki[0]:ki[1])*ct-zo*Si;On>0&&On>Xi&&(Xi=On)}else{const yr=Fe[ve.fontStack];if(!yr)continue;yr[Bt]&&(xi=yr[Bt]);const ki=ke[ve.fontStack];if(!ki)continue;const On=ki.glyphs[Bt];if(!On)continue;if(Ht=On.metrics,Ki=Bt!==8203?zo:0,_t){const pr=ki.ascender!==void 0?Math.abs(ki.ascender):0,ir=ki.descender!==void 0?Math.abs(ki.descender):0,nr=(pr+ir)*ct;Gn<nr&&(Gn=nr,Yn=(pr-ir)/2*ct),Oi=-pr*ct}else Oi=(Si-ct)*zo-17}Hn?(Pe.verticalizable=!0,wn.push({glyph:Bt,image:gi,x:tt,y:Qe+Oi,vertical:Hn,scale:ct,localGlyph:Ht.localGlyph,fontStack:ve.fontStack,sectionIndex:at,metrics:Ht,rect:xi}),tt+=Ki*ct+Et):(wn.push({glyph:Bt,image:gi,x:tt,y:Qe+Oi,vertical:Hn,scale:ct,localGlyph:Ht.localGlyph,fontStack:ve.fontStack,sectionIndex:at,metrics:Ht,rect:xi}),tt+=Ht.advance*ct+Et)}wn.length!==0&&(xt=Math.max(tt-Et,xt),_t?Yy(wn,wt,Xi,Yn,ot*Si/2):Yy(wn,wt,Xi,0,ot/2)),tt=0;const Yr=ot*Si+Xi;hn.lineOffset=Math.max(Xi,Zi),Qe+=Yr,++mt}var si;const qt=Qe,{horizontalAlign:Gt,verticalAlign:ji}=e_(ht);(function(Zt,Si,Zi,hn,wn,Xi){const Gn=(Si-Zi)*wn,Yn=-Xi*hn;for(const Yr of Zt)for(const Ee of Yr.positionedGlyphs)Ee.x+=Gn,Ee.y+=Yn})(Pe.positionedLines,wt,Gt,ji,xt,qt),Pe.top+=-ji*qt,Pe.bottom=Pe.top+qt,Pe.left+=-Gt*xt,Pe.right=Pe.left+xt,Pe.hasBaseline=_t}(Se,e,i,o,ee,g,x,S,P,A,k,V),!function(Pe){for(const ke of Pe)if(ke.positionedGlyphs.length!==0)return!1;return!0}(Re))return Se}const h0={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},OA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function d0(n,e,i,o,c,m){if(e.image){const g=o.get(e.image.toString());return g?g.displaySize[0]*e.scale*zo/m+c:0}{const g=i[e.fontStack],x=g&&g.glyphs[n];return x?x.metrics.advance*e.scale+c:0}}function f0(n,e,i,o){const c=Math.pow(n-e,2);return o?n<e?c/2:2*c:c+Math.abs(i)*i}function p0(n,e,i){let o=0;return n===10&&(o-=1e4),i&&(o+=150),n!==40&&n!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function um(n,e,i,o,c,m){let g=null,x=f0(e,i,c,m);for(const S of o){const A=f0(e-S.x,i,c,m)+S.badness;A<=x&&(g=S,x=A)}return{index:n,x:e,priorBreak:g,badness:x}}function m0(n){return n?m0(n.priorBreak).concat(n.index):[]}function e_(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Yy(n,e,i,o,c){if(!(e||i||o||c))return;const m=n.length-1,g=n[m],x=(g.x+g.metrics.advance*g.scale)*e;for(let S=0;S<=m;S++)n[S].x-=x,n[S].y+=i+o+c}function Uw(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function Ky(n,e,i,o){const{horizontalAlign:c,verticalAlign:m}=e_(o),g=i[0]-n.displaySize[0]*c,x=i[1]-n.displaySize[1]*m;return{imagePrimary:n,imageSecondary:e,top:x,bottom:x+n.displaySize[1],left:g,right:g+n.displaySize[0]}}function g0(n,e,i,o,c,m){const g=n.imagePrimary;let x;if(g.content){const J=g.content,ee=g.pixelRatio||1;x=[J[0]/ee,J[1]/ee,g.displaySize[0]-J[2]/ee,g.displaySize[1]-J[3]/ee]}const S=e.left*m,A=e.right*m;let M,P,k,U;i==="width"||i==="both"?(U=c[0]+S-o[3],P=c[0]+A+o[1]):(U=c[0]+(S+A-g.displaySize[0])/2,P=U+g.displaySize[0]);const V=e.top*m,q=e.bottom*m;return i==="height"||i==="both"?(M=c[1]+V-o[0],k=c[1]+q+o[2]):(M=c[1]+(V+q-g.displaySize[1])/2,k=M+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:M,right:P,bottom:k,left:U,collisionPadding:x}}function _0(n){return!n.imagePrimary.stretchX}function y0(n){return!n.imagePrimary.stretchY}function ZS(n){return{width:n.right-n.left,height:n.bottom-n.top}}const Ju=128;function Qu(n,e,i){const{expression:o}=e;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new Er(n+1,{worldview:i}))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:m}=o;let g=0;for(;g<c.length&&c[g]<=n;)g++;g=Math.max(0,g-1);let x=g;for(;x<c.length&&c[x]<n+1;)x++;x=Math.min(c.length-1,x);const S=c[g],A=c[x];return o.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:A,interpolationType:m}:{kind:"camera",minZoom:S,maxZoom:A,minSize:o.evaluate(new Er(S,{worldview:i})),maxSize:o.evaluate(new Er(A,{worldview:i})),interpolationType:m}}}function Fo(n,{uSize:e,uSizeT:i},{lowerSize:o,upperSize:c}){return n.kind==="source"?o/Ju:n.kind==="composite"?wi(o/Ju,c/Ju,i):e}function ru(n,e,i=1){let o=0,c=0;if(n.kind==="constant")c=n.layoutSize*i;else if(n.kind!=="source"){const{interpolationType:m,minZoom:g,maxZoom:x}=n,S=m?X(Ts.interpolationFactor(m,e,g,x),0,1):0;n.kind==="camera"?c=wi(n.minSize,n.maxSize,S)*i:o=S*i}return{uSizeT:o,uSize:c}}class eh extends vt{constructor(e,i,o,c,m){super(e,i),this.angle=c,this.z=o,m!==void 0&&(this.segment=m)}clone(){return new eh(this.x,this.y,this.z,this.angle,this.segment)}}function XS(n,e,i,o,c){if(e.segment===void 0)return!0;let m=e,g=e.segment+1,x=0;for(;x>-i/2;){if(g--,g<0)return!1;x-=n[g].dist(m),m=n[g]}x+=n[g].dist(n[g+1]),g++;const S=[];let A=0;for(;x<i/2;){const M=n[g],P=n[g+1];if(!P)return!1;let k=n[g-1].angleTo(M)-M.angleTo(P);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:x,angleDelta:k}),A+=k;x-S[0].distance>o;)A-=S.shift().angleDelta;if(A>c)return!1;g++,x+=M.dist(P)}return!0}function Vw(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function YS(n,e,i){return n?.6*e*i:0}function KS(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function Xl(n,e,i,o,c,m){const g=YS(i,c,m),x=KS(i,o)*m;let S=0;const A=Vw(n)/2;for(let M=0;M<n.length-1;M++){const P=n[M],k=n[M+1],U=P.dist(k);if(S+U>A){const V=(A-S)/U,q=wi(P.x,k.x,V),J=wi(P.y,k.y,V),ee=new eh(q,J,0,k.angleTo(P),M);return!g||XS(n,ee,x,g,e)?ee:void 0}S+=U}}function kA(n,e,i,o,c,m,g,x,S){const A=YS(o,m,g),M=KS(o,c),P=M*g,k=n[0].x===0||n[0].x===S||n[0].y===0||n[0].y===S;return e-P<e/4&&(e=P+e/4),Jy(n,k?e/2*x%e:(M/2+2*m)*g*x%e,e,A,i,P,k,!1,S)}function Jy(n,e,i,o,c,m,g,x,S){const A=m/2,M=Vw(n);let P=0,k=e-i,U=[];for(let V=0;V<n.length-1;V++){const q=n[V],J=n[V+1],ee=q.dist(J),ae=J.angleTo(q);for(;k+i<P+ee;){k+=i;const le=(k-P)/ee,de=wi(q.x,J.x,le),Re=wi(q.y,J.y,le);if(de>=0&&de<S&&Re>=0&&Re<S&&k-A>=0&&k+A<=M){const Se=new eh(de,Re,0,ae,V);o&&!XS(n,Se,m,o,c)||U.push(Se)}}P+=ee}return x||U.length||g||(U=Jy(n,P/2,i,o,c,m,g,!0,S)),U}function jw(n){let e=0,i=0;for(const g of n)e+=g.w*g.h,i=Math.max(i,g.w);n.sort((g,x)=>x.h-g.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let c=0,m=0;for(const g of n)for(let x=o.length-1;x>=0;x--){const S=o[x];if(!(g.w>S.w||g.h>S.h)){if(g.x=S.x,g.y=S.y,m=Math.max(m,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===S.w&&g.h===S.h){const A=o.pop();A&&x<o.length&&(o[x]=A)}else g.h===S.h?(S.x+=g.w,S.w-=g.w):g.w===S.w?(S.y+=g.h,S.h-=g.h):(o.push({x:S.x+g.w,y:S.y,w:S.w-g.w,h:g.h}),S.y+=g.h,S.h-=g.h);break}}return{w:c,h:m,fill:e/(c*m)||0}}ai(eh,"Anchor");const Nf=1;class Bf{static getImagePositionScale(e,i,o){if(i&&e&&e.options&&e.options.transform){const c=e.options.transform;return{x:c.a,y:c.d}}return{x:o,y:o}}constructor(e,i,o,c){this.paddedRect=e;const{pixelRatio:m,version:g,stretchX:x,stretchY:S,content:A,sdf:M,usvg:P}=i;this.pixelRatio=m,this.stretchX=x,this.stretchY=S,this.content=A,this.version=g,this.padding=o,this.sdf=M,this.usvg=P,this.scale=Bf.getImagePositionScale(c,P,m)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Qy(n,e,i){const o=Pa.parse(n),c=function(m,g,x=[1,1]){return{x:0,y:0,w:(m.data?m.data.width:m.width*x[0])+2*g,h:(m.data?m.data.height:m.height*x[1])+2*g}}(e,i,[o.options.transform.a,o.options.transform.d]);return{bin:c,imagePosition:new Bf(c,e,i,o),imageVariant:o}}class ev{constructor(e,i,o){const c=new Map,m=new Map;this.haveRenderCallbacks=[];const g=[];this.addImages(e,c,Nf,g),this.addImages(i,m,2,g);const{w:x,h:S}=jw(g),A=new Xo({width:x||1,height:S||1});for(const[M,P]of e.entries()){const k=c.get(M).paddedRect;Xo.copy(P.data,A,{x:0,y:0},{x:k.x+Nf,y:k.y+Nf},P.data,null,P.sdf)}for(const[M,P]of i.entries()){const k=m.get(M),U=k.paddedRect;let V=k.padding;const q=U.x+V,J=U.y+V,ee=P.data.width,ae=P.data.height;V=V>1?V-1:V,Xo.copy(P.data,A,{x:0,y:0},{x:q,y:J},P.data,o),Xo.copy(P.data,A,{x:0,y:ae-V},{x:q,y:J-V},{width:ee,height:V},o),Xo.copy(P.data,A,{x:0,y:0},{x:q,y:J+ae},{width:ee,height:V},o),Xo.copy(P.data,A,{x:ee-V,y:0},{x:q-V,y:J},{width:V,height:ae},o),Xo.copy(P.data,A,{x:0,y:0},{x:q+ee,y:J},{width:V,height:ae},o),Xo.copy(P.data,A,{x:ee-V,y:ae-V},{x:q-V,y:J-V},{width:V,height:V},o),Xo.copy(P.data,A,{x:0,y:ae-V},{x:q+ee,y:J-V},{width:V,height:V},o),Xo.copy(P.data,A,{x:0,y:0},{x:q+ee,y:J+ae},{width:V,height:V},o),Xo.copy(P.data,A,{x:ee-V,y:0},{x:q-V,y:J+ae},{width:V,height:V},o)}this.lut=o,this.image=A,this.iconPositions=c,this.patternPositions=m}addImages(e,i,o,c){for(const[m,g]of e.entries()){const{bin:x,imagePosition:S,imageVariant:A}=Qy(m,g,o);i.set(m,S),c.push(x),g.hasRenderCallback&&this.haveRenderCallbacks.push(A.id)}}patchUpdatedImages(e,i,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>e.hasImage(c,o)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,o);for(const c of e.getUpdatedImages(o)){for(const m of this.iconPositions.keys()){const g=Pa.parse(m);if(Mi.isEqual(g.id,c)){const x=e.getImage(c,o);this.patchUpdatedImage(this.iconPositions.get(m),x,i,null)}}for(const m of this.patternPositions.keys()){const g=Pa.parse(m);if(Mi.isEqual(g.id,c)){const x=e.getImage(c,o);this.patchUpdatedImage(this.patternPositions.get(m),x,i,this.lut)}}}}patchUpdatedImage(e,i,o,c=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[m,g]=e.tl,x=e.sdf;if(this.lut||x){const S={width:i.data.width,height:i.data.height},A=new Xo(S);Xo.copy(i.data,A,{x:0,y:0},{x:0,y:0},S,c,x),o.update(A,{position:{x:m,y:g}})}else o.update(i.data,{position:{x:m,y:g}})}}ai(Bf,"ImagePosition"),ai(ev,"ImageAtlas");const hm=1e20;function tv(n,e,i,o,c,m,g,x,S){for(let A=e;A<e+o;A++)v0(n,i*m+A,m,c,g,x,S);for(let A=i;A<i+c;A++)v0(n,A*m+e,1,o,g,x,S)}function v0(n,e,i,o,c,m,g){m[0]=0,g[0]=-hm,g[1]=hm,c[0]=n[e];for(let x=1,S=0,A=0;x<o;x++){c[x]=n[e+x*i];const M=x*x;do{const P=m[S];A=(c[x]-c[P]+M-P*P)/(x-P)/2}while(A<=g[S]&&--S>-1);S++,m[S]=x,g[S]=A,g[S+1]=hm}for(let x=0,S=0;x<o;x++){for(;g[S+1]<x;)S++;const A=m[S],M=x-A;n[e+x*i]=c[A]+M*M}}const au=2,th={none:0,ideographs:1,all:2};class _c{constructor(e,i,o){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=o,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const o=[],c=this.url||Tr.GLYPHS_URL;for(const m in e)for(const g of e[m])o.push({stack:m,id:g});ye(o,({stack:m,id:g},x)=>{let S=this.entries[m];S||(S=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let A=S.glyphs[g];if(A!==void 0)return void x(null,{stack:m,id:g,glyph:A});if(A=this._tinySDF(S,m,g),A)return S.glyphs[g]=A,void x(null,{stack:m,id:g,glyph:A});const M=Math.floor(g/256);if(256*M>65535)return Yt("glyphs > 65535 not supported"),void x(null,{stack:m,id:g,glyph:A});if(S.ranges[M])return void x(null,{stack:m,id:g,glyph:A});let P=S.requests[M];P||(P=S.requests[M]=[],_c.loadGlyphRange(m,M,c,this.requestManager,(k,U)=>{if(U){S.ascender=U.ascender,S.descender=U.descender;for(const V in U.glyphs)this._doesCharSupportLocalGlyph(+V)||(S.glyphs[+V]=U.glyphs[+V]);S.ranges[M]=!0}for(const V of P)V(k,U);delete S.requests[M]})),P.push((k,U)=>{k?x(k):U&&x(null,{stack:m,id:g,glyph:U.glyphs[g]||null})})},(m,g)=>{if(m)i(m);else if(g){const x={};for(const{stack:S,id:A,glyph:M}of g)x[S]===void 0&&(x[S]={}),x[S].glyphs===void 0&&(x[S].glyphs={}),x[S].glyphs[A]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},x[S].ascender=this.entries[S].ascender,x[S].descender=this.entries[S].descender;i(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==th.none&&(this.localGlyphMode===th.all?!!this.localFontFamily:!!this.localFontFamily&&(Ri["CJK Unified Ideographs"](e)||Ri["Hangul Syllables"](e)||Ri.Hiragana(e)||Ri.Katakana(e)||Ri["CJK Symbols and Punctuation"](e)||Ri["CJK Unified Ideographs Extension A"](e)||Ri["CJK Unified Ideographs Extension B"](e)||Ri.Osage(e)))}_tinySDF(e,i,o){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let m=e.tinySDF;if(!m){let q="400";/bold/i.test(i)?q="900":/medium/i.test(i)?q="500":/light/i.test(i)&&(q="200"),m=e.tinySDF=new _c.TinySDF({fontFamily:c,fontWeight:q,fontSize:24*au,buffer:3*au,radius:8*au}),m.fontWeight=q}if(this.localGlyphs[m.fontWeight][o])return this.localGlyphs[m.fontWeight][o];const g=String.fromCodePoint(o),{data:x,width:S,height:A,glyphWidth:M,glyphHeight:P,glyphLeft:k,glyphTop:U,glyphAdvance:V}=m.draw(g);return this.localGlyphs[m.fontWeight][o]={id:o,bitmap:new zh({width:S,height:A},x),metrics:{width:M/au,height:P/au,left:k/au,top:U/au-27,advance:V/au,localGlyph:!0}}}}_c.loadGlyphRange=function(n,e,i,o,c){const m=256*e,g=m+255,x=o.transformRequest(o.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${m}-${g}`),bu.Glyphs);ac(x,(S,A)=>{if(S)c(S);else if(A){const M={},P=function(k){return new Ff(k).readFields(PA,{})}(A);for(const k of P.glyphs)M[k.id]=k;c(null,{glyphs:M,ascender:P.ascender,descender:P.descender})}})},_c.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:m="normal",fontStyle:g="normal",lang:x=null}={}){this.buffer=e,this.cutoff=o,this.radius=i,this.lang=x;const S=this.size=n+4*e,A=this._createCanvas(S),M=this.ctx=A.getContext("2d",{willReadFrequently:!0});M.font=`${g} ${m} ${n}px ${c}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:m}=this.ctx.measureText(n),g=Math.ceil(i),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-c))),S=Math.min(this.size-this.buffer,g+Math.ceil(o)),A=x+2*this.buffer,M=S+2*this.buffer,P=Math.max(A*M,0),k=new Uint8ClampedArray(P),U={data:k,width:A,height:M,glyphWidth:x,glyphHeight:S,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(x===0||S===0)return U;const{ctx:V,buffer:q,gridInner:J,gridOuter:ee}=this;this.lang&&(V.lang=this.lang),V.clearRect(q,q,x,S),V.fillText(n,q,q+g);const ae=V.getImageData(q,q,x,S);ee.fill(hm,0,P),J.fill(0,0,P);for(let le=0;le<S;le++)for(let de=0;de<x;de++){const Re=ae.data[4*(le*x+de)+3]/255;if(Re===0)continue;const Se=(le+q)*A+de+q;if(Re===1)ee[Se]=0,J[Se]=hm;else{const Pe=.5-Re;ee[Se]=Pe>0?Pe*Pe:0,J[Se]=Pe<0?Pe*Pe:0}}tv(ee,0,0,A,M,A,this.f,this.v,this.z),tv(J,q,q,x,S,A,this.f,this.v,this.z);for(let le=0;le<P;le++){const de=Math.sqrt(ee[le])-Math.sqrt(J[le]);k[le]=Math.round(255-255*(de/this.radius+this.cutoff))}return U}};const yc=Nf;function x0(n,e){return n+e[1]-e[0]}function Gw(n,e,i,o,c=1){const m=[],g=n.imagePrimary,x=g.pixelRatio,S=g.paddedRect.w-2*yc,A=g.paddedRect.h-2*yc,M=(n.right-n.left)*c,P=(n.bottom-n.top)*c,k=g.stretchX||[[0,S]],U=g.stretchY||[[0,A]],V=k.reduce(x0,0),q=U.reduce(x0,0),J=S-V,ee=A-q;let ae=0,le=V,de=0,Re=q,Se=0,Pe=J,ke=0,Fe=ee;if(g.content&&o){const qe=g.content;ae=w0(k,0,qe[0]),de=w0(U,0,qe[1]),le=w0(k,qe[0],qe[2]),Re=w0(U,qe[1],qe[3]),Se=qe[0]-ae,ke=qe[1]-de,Pe=qe[2]-qe[0]-le,Fe=qe[3]-qe[1]-Re}const rt=(qe,ot,ht,yt)=>{const Tt=nv(qe.stretch-ae,le,M,n.left*c),Et=Uf(qe.fixed-Se,Pe,qe.stretch,V),pt=nv(ot.stretch-de,Re,P,n.top*c),St=Uf(ot.fixed-ke,Fe,ot.stretch,q),tt=nv(ht.stretch-ae,le,M,n.left*c),Qe=Uf(ht.fixed-Se,Pe,ht.stretch,V),xt=nv(yt.stretch-de,Re,P,n.top*c),wt=Uf(yt.fixed-ke,Fe,yt.stretch,q),_t=new vt(Tt,pt),mt=new vt(tt,pt),si=new vt(tt,xt),qt=new vt(Tt,xt),Gt=new vt(Et/x,St/x),ji=new vt(Qe/x,wt/x),Zt=e*Math.PI/180;if(Zt){const Gn=Math.sin(Zt),Yn=Math.cos(Zt),Yr=[Yn,-Gn,Gn,Yn];_t._matMult(Yr),mt._matMult(Yr),qt._matMult(Yr),si._matMult(Yr)}const Si=qe.stretch+qe.fixed,Zi=ht.stretch+ht.fixed,hn=ot.stretch+ot.fixed,wn=yt.stretch+yt.fixed,Xi=n.imageSecondary;return{tl:_t,tr:mt,bl:qt,br:si,texPrimary:{x:g.paddedRect.x+yc+Si,y:g.paddedRect.y+yc+hn,w:Zi-Si,h:wn-hn},texSecondary:Xi?{x:Xi.paddedRect.x+yc+Si,y:Xi.paddedRect.y+yc+hn,w:Zi-Si,h:wn-hn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gt,pixelOffsetBR:ji,minFontScaleX:Pe/x/M,minFontScaleY:Fe/x/P,isSDF:i}};if(o&&(g.stretchX||g.stretchY)){const qe=Hw(k,J,V),ot=Hw(U,ee,q);for(let ht=0;ht<qe.length-1;ht++){const yt=qe[ht],Tt=qe[ht+1];for(let Et=0;Et<ot.length-1;Et++)m.push(rt(yt,ot[Et],Tt,ot[Et+1]))}}else m.push(rt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:A+1}));return m}function b0(n,e){const i=n.stretchY||[[0,n.paddedRect.h-2*yc]];return e&&(n.stretchX||n.stretchY)?iv(n.stretchX||[[0,n.paddedRect.w-2*yc]])*iv(i):1}function w0(n,e,i){let o=0;for(const c of n)o+=Math.max(e,Math.min(i,c[1]))-Math.max(e,Math.min(i,c[0]));return o}function Hw(n,e,i){const o=[{fixed:-yc,stretch:0}];for(const[c,m]of n){const g=o[o.length-1];o.push({fixed:c-g.stretch,stretch:g.stretch}),o.push({fixed:c-g.stretch,stretch:g.stretch+(m-c)})}return o.push({fixed:e+yc,stretch:i}),o}function iv(n){return 2*n.length+1}function nv(n,e,i,o){return n/e*i+o}function Uf(n,e,i,o){return n-e*i/o}function Vf(n,e,i,o){const c=e+n.positionedLines[o].lineOffset;return o===0?i+c/2:i+(c+(e+n.positionedLines[o-1].lineOffset))/2}function rv(n,e=1,i=!1){let o=1/0,c=1/0,m=-1/0,g=-1/0;const x=n[0];for(let U=0;U<x.length;U++){const V=x[U];(!U||V.x<o)&&(o=V.x),(!U||V.y<c)&&(c=V.y),(!U||V.x>m)&&(m=V.x),(!U||V.y>g)&&(g=V.y)}const S=Math.min(m-o,g-c);let A=S/2;const M=new Hm([],T0);if(S===0)return new vt(o,c);for(let U=o;U<m;U+=S)for(let V=c;V<g;V+=S)M.push(new Fd(U+A,V+A,A,n));let P=function(U){let V=0,q=0,J=0;const ee=U[0];for(let ae=0,le=ee.length,de=le-1;ae<le;de=ae++){const Re=ee[ae],Se=ee[de],Pe=Re.x*Se.y-Se.x*Re.y;q+=(Re.x+Se.x)*Pe,J+=(Re.y+Se.y)*Pe,V+=3*Pe}return new Fd(q/V,J/V,0,U)}(n),k=M.length;for(;M.length;){const U=M.pop();(U.d>P.d||!P.d)&&(P=U,i&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,k)),U.max-P.d<=e||(A=U.h/2,M.push(new Fd(U.p.x-A,U.p.y-A,A,n)),M.push(new Fd(U.p.x+A,U.p.y-A,A,n)),M.push(new Fd(U.p.x-A,U.p.y+A,A,n)),M.push(new Fd(U.p.x+A,U.p.y+A,A,n)),k+=4)}return i&&(console.log(`num probes: ${k}`),console.log(`best distance: ${P.d}`)),P.p}function T0(n,e){return e.max-n.max}class Fd{constructor(e,i,o,c){this.p=new vt(e,i),this.h=o,this.d=function(m,g){let x=!1,S=1/0;for(let A=0;A<g.length;A++){const M=g[A];for(let P=0,k=M.length,U=k-1;P<k;U=P++){const V=M[P],q=M[U];V.y>m.y!=q.y>m.y&&m.x<(q.x-V.x)*(m.y-V.y)/(q.y-V.y)+V.x&&(x=!x),S=Math.min(S,rl(m,V,q))}}return(x?1:-1)*Math.sqrt(S)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}}const JS=Object.keys,av=Number.POSITIVE_INFINITY,t_=Math.sqrt(2);function i_(n,e,i,o){const c=n.collisionPadding||[0,0,0,0],m={top:n.top-c[1],bottom:n.bottom+c[3],left:n.left-c[0],right:n.right+c[2],scaled:!1};return o!==void 0&&function(g,x){g.top*=x,g.bottom*=x,g.left*=x,g.right*=x,g.scaled=!0}(m,o),i&&function(g,x){if(!x)return;const S=cn(x),A=new vt(g.left,g.top),M=new vt(g.right,g.top),P=new vt(g.left,g.bottom),k=new vt(g.right,g.bottom);A._rotateAround(S,new vt(0,0)),M._rotateAround(S,new vt(0,0)),P._rotateAround(S,new vt(0,0)),k._rotateAround(S,new vt(0,0)),g.left=Math.min(A.x,M.x,P.x,k.x),g.right=Math.max(A.x,M.x,P.x,k.x),g.top=Math.min(A.y,M.y,P.y,k.y),g.bottom=Math.max(A.y,M.y,P.y,k.y)}(m,i),e?{top:Math.min(e.top,m.top),bottom:Math.max(e.bottom,m.bottom),left:Math.min(e.left,m.left),right:Math.max(e.right,m.right),scaled:e.scaled||m.scaled}:m}function $w(n,[e,i]){let o=0,c=0;if(i===av){e<0&&(e=0);const m=e/t_;switch(n){case"top-right":case"top-left":c=m-7;break;case"bottom-right":case"bottom-left":c=7-m;break;case"bottom":c=7-e;break;case"top":c=e-7}switch(n){case"top-right":case"bottom-right":o=-m;break;case"top-left":case"bottom-left":o=m;break;case"left":o=e;break;case"right":o=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":c=i-7;break;case"bottom-right":case"bottom-left":case"bottom":c=7-i}switch(n){case"top-right":case"bottom-right":case"right":o=-e;break;case"top-left":case"bottom-left":case"left":o=e}}return[o,c]}function Ww(n,e,i,o,c,m,g,x,S,A,M){const P=n.layers[0],k=P.appearances;if(k.length===0)return{iconBBox:null,iconVerticalBBox:null};let U=null,V=null;const q=o.get("icon-rotate").evaluate(c,{},m);e&&(U=i_(e,U,q,g),i)&&(V=i_(i,V,q+90,g));const[J,ee]=o.get("icon-size-scale-range"),ae=X(1,J,ee);for(const le of k){const de=le.getUnevaluatedProperties(),Re=de._values["icon-image"].value!==void 0,Se=de._values["icon-size"].value!==void 0,Pe=de._values["icon-offset"].value!==void 0,ke=de._values["icon-rotate"].value!==void 0;if(Re||Se||Pe||ke){const Fe=Pe?P.getAppearanceValueAndResolveTokens(le,"icon-offset",c,m,[]):null,rt=Fe&&Array.isArray(Fe)?Fe:x,qe=ke?P.getAppearanceValueAndResolveTokens(le,"icon-rotate",c,m,[]):null,ot=typeof qe=="number"?qe:q,ht=Se?P.getAppearanceValueAndResolveTokens(le,"icon-size",c,m,[]):null,yt=typeof ht=="number"?ht*S.iconScaleFactor:g;let Tt=null,Et=null,pt=null;if(Re){const St=P.getAppearanceValueAndResolveTokens(le,"icon-image",c,m,[]);if(St){const tt=n.getResolvedImageFromTokens(St),Qe=de._values["icon-size"],xt=n_(tt,Qu(n.zoom,Qe,n.worldview),Qe,m,n.zoom,c,n.pixelRatio,ae,n.worldview);pt=A.get(xt.iconPrimary.toString())}}else e&&(pt=e.imagePrimary);pt&&(Tt=Ky(pt,null,rt,M),n.allowVerticalPlacement&&(Et=Ky(pt,null,rt,M))),Tt&&(U=i_(Tt,U,ot,yt)),Et&&(V=i_(Et,V,ot+90,yt))}}return{iconBBox:U,iconVerticalBBox:V}}function S0(n,e,i,o,c,m,g,x,S){if(!e||!e.usvg)return;const A=ZS(o),M=ZS(c),P=m!=="both"&&m!=="width"||!_0(o)?1:M.width/A.width,k=m!=="both"&&m!=="height"||!y0(o)?1:M.height/A.height;i.scaleSelf(P,k);const U=i.toString();g.set(U,i),x.set(U,e);const{imagePosition:V}=Qy(U,e,Nf);S.set(U,V)}function qw(n,e,i,o,c,m,g,x,S){if(!n)return;const A=function(M,P,k,U,V,q){if(M.kind==="camera")return M.maxSize;if(M.kind==="composite"){const J=P.possiblyEvaluate(new Er(M.maxZoom,{worldview:q}),k).evaluate(V,{},k),ee=P.possiblyEvaluate(new Er(M.minZoom,{worldview:q}),k).evaluate(V,{},k);return Math.max(J,ee)}return P.possiblyEvaluate(new Er(U,{worldview:q})).evaluate(V,{},k)}(e,i,o,c,m,S);return n.scaleSelf(A*x*g)}function n_(n,e,i,o,c,m,g,x,S){return{iconPrimary:qw(n.getPrimary(),e,i,o,c,m,g,x,S),iconSecondary:qw(n.getSecondary(),e,i,o,c,m,g,x,S)}}function ov(n,e,i){if(!e)return;const o=i.get(n.toString()),c=i.get(e.toString());o&&c&&(o.paddedRect.w===c.paddedRect.w&&o.paddedRect.h===c.paddedRect.h||Yt(`Mismatch in icon variant sizes: ${n.toString()} and ${e.toString()}`),o.usvg!==c.usvg&&Yt(`Mismatch in icon variant image types: ${n.id} and ${e.id}`))}function ou(n,e,i,o){if(!n)return;const c=e.get(i.toString());if(n.imagePrimary=c,o){const m=e.get(o.toString());n.imageSecondary=m}}function Zw(n,e){for(const i in n.horizontal)dm(n.horizontal[i],e);dm(n.vertical,e)}function dm(n,e){if(n){for(const i of n.positionedLines)for(const o of i.positionedGlyphs)if(o.image!==null){const c=o.image.toString();o.rect=e.get(c).paddedRect}}}function sv(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function LA(n,e,i,o,c,m,g,x,S){const A=cl(m.horizontal)||m.vertical,M=i.get("icon-text-fit-padding").evaluate(o,{},c);let P,k=e;return e&&S!=="none"&&(n.allowVerticalPlacement&&m.vertical&&(P=g0(e,m.vertical,S,M,x,g)),A&&(k=g0(e,A,S,M,x,g))),{defaultShapedIcon:k,verticallyShapedIcon:P}}function jf(n,e,i,o,c,m,g,x,S,A,M,P,k,U,V,q,J,ee,ae,le,de,Re){let Se=g.textMaxSize.evaluate(e,{},k);Se===void 0?Se=x*g.textScaleFactor:Se*=g.textScaleFactor;const Pe=n.layers[0].layout,ke=zo,Fe=x*g.textScaleFactor/ke,rt=cl(i.horizontal)||i.vertical;if(J!=="none"&&n.appearanceFeatureData&&e.index<n.appearanceFeatureData.length){const _t=n.appearanceFeatureData[e.index];_t&&(_t.textShaping=rt,_t.iconTextFitPadding=Pe.get("icon-text-fit-padding").evaluate(e,{},k),_t.fontScale=Fe)}const qe=U.name==="globe",ot=n.tilePixelRatio*Se/ke,ht=(tt=n.overscaling,n.zoom>18&&tt>2&&(tt>>=1),Math.max(Lt/(512*tt),1)*Pe.get("symbol-spacing")),yt=Pe.get("text-padding")*n.tilePixelRatio,Tt=Pe.get("icon-padding")*n.tilePixelRatio,Et=cn(Pe.get("text-max-angle")),pt=Pe.get("icon-rotation-alignment")==="map"&&le!=="point",St=ht/2;var tt;n.hasAnyIconTextFit===!1&&J!=="none"&&(n.hasAnyIconTextFit=!0);const Qe=e.properties?+e.properties[Jt]:null,xt=Qe&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(Qe):65535,wt=(_t,mt,si)=>{if(mt.x<0||mt.x>=Lt||mt.y<0||mt.y>=Lt)return;let qt=null;if(qe){const{x:Gt,y:ji,z:Zt}=U.projectTilePoint(mt.x,mt.y,si);qt={anchor:new eh(Gt,ji,Zt,0,void 0),up:U.upVector(si,mt.x,mt.y)}}(function(Gt,ji,Zt,Si,Zi,hn,wn,Xi,Gn,Yn,Yr,Ee,ve,at,Bt,ct,Ht,xi,gi,Ki,Oi,fi,Hn,yr,ki,On,pr,ir,nr,ur,Dr){const Nn=Gt.addToLineVertexArray(ji,Si);let $n,en,Kn,Ar,Li,fn,Ur,Mr=0,La=0,Ka=0,Lr=0,Ja=-1,$s=-1;const Qa={};let dl=ge("");const ts=Zt?Zt.anchor:ji,xc=ir!=="none";let fl=0,Dl=0;if(Gn._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Uo=Gn.layout.get("text-offset").evaluate(Oi,{},ki);fl=Uo[0]*zo,Dl=Uo[1]*zo}else fl=Gn.layout.get("text-radial-offset").evaluate(Oi,{},ki)*zo,Dl=av;if(Gt.allowVerticalPlacement&&Zi.vertical){const Uo=Zi.vertical;if(Bt)fn=su(Uo),Xi&&(Ur=su(Xi));else{const Ps=Gn.layout.get("text-rotate").evaluate(Oi,{},ki)+90;Kn=No(Yn,ts,ji,Yr,Ee,ve,Uo,at,Ps,ct),Xi&&(Ar=No(Yn,ts,ji,Yr,Ee,ve,Xi,xi,Ps,null,Dr))}}if(hn){const Uo=Gt.iconSizeData,Ps=Gn.layout.get("icon-rotate").evaluate(Oi,{},ki),Qh=Gw(hn,Ps,Hn,xc,fi.iconScaleFactor),Kf=Xi?Gw(Xi,Ps,Hn,xc,fi.iconScaleFactor):void 0;en=No(Yn,ts,ji,Yr,Ee,ve,hn,xi,Ps,null,ur);const b_=function(ed,ob,td,eR,CE,AE,tR,RE){const IE=ed.layers[0],sb=IE.appearances;let Qf=ob.length;if(td&&(Qf=Math.max(Qf,td.length)),sb.length===0)return Qf;const[Ws,rh]=eR.get("icon-size-scale-range"),gs=X(1,Ws,rh);for(const R1 of sb){const Os=R1.getUnevaluatedProperties();if(Os._values["icon-image"].value!==void 0){const wc=IE.getAppearanceValueAndResolveTokens(R1,"icon-image",CE,AE,[]);if(wc){const id=ed.getResolvedImageFromTokens(wc);if(id){const w_=Os._values["icon-size"],Em=n_(id,Qu(ed.zoom,w_,ed.worldview),w_,AE,ed.zoom,CE,ed.pixelRatio,gs,ed.worldview),lb=tR.get(Em.iconPrimary.toString());Qf=Math.max(Qf,b0(lb,RE))}}}}return Qf}(Gt,Qh,Kf,Gn.layout,Oi,ki,Gt.iconAtlasPositions,xc);Mr=4*b_;let Jf=null;Uo.kind==="source"?(Jf=[Ju*Gn.layout.get("icon-size").evaluate(Oi,{},ki)*fi.iconScaleFactor],Jf[0]>Nd&&Yt(`${Gt.layerIds[0]}: Value for "icon-size" is >= ${Gh}. Reduce your "icon-size".`)):Uo.kind==="composite"&&(Jf=[Ju*fi.compositeIconSizes[0].evaluate(Oi,{},ki)*fi.iconScaleFactor,Ju*fi.compositeIconSizes[1].evaluate(Oi,{},ki)*fi.iconScaleFactor],(Jf[0]>Nd||Jf[1]>Nd)&&Yt(`${Gt.layerIds[0]}: Value for "icon-size" is >= ${Gh}. Reduce your "icon-size".`)),Gt.addSymbols(Gt.icon,Qh,Jf,Ki,gi,Oi,void 0,Zt,ji,Nn.lineStartIndex,Nn.lineLength,-1,yr,ki,On,pr,Gt.symbolInstances.length,b_),Ja=Gt.icon.placedSymbolArray.length-1,Kf&&(La=4*b_,Gt.addSymbols(Gt.icon,Kf,Jf,Ki,gi,Oi,ll.vertical,Zt,ji,Nn.lineStartIndex,Nn.lineLength,-1,yr,ki,On,pr,Gt.symbolInstances.length,b_),$s=Gt.icon.placedSymbolArray.length-1)}for(const Uo in Zi.horizontal){const Ps=Uo,Qh=Zi.horizontal[Ps];$n||(dl=ge(Qh.text),Bt?Li=su(Qh):$n=No(Yn,ts,ji,Yr,Ee,ve,Qh,at,Gn.layout.get("text-rotate").evaluate(Oi,{},ki),ct));const Kf=Qh.positionedLines.length===1;if(Ka+=lv(Gt,Zt,ji,Qh,wn,Gn,Bt,Oi,ct,Nn,Zi.vertical?ll.horizontal:ll.horizontalOnly,Kf?JS(Zi.horizontal):[Ps],Qa,Ja,fi,yr,ki,Gt.symbolInstances.length,On),Kf)break}Zi.vertical&&(Lr+=lv(Gt,Zt,ji,Zi.vertical,wn,Gn,Bt,Oi,ct,Nn,ll.vertical,["vertical"],Qa,$s,fi,yr,ki,Gt.symbolInstances.length,On));let is=-1;const Ml=(Uo,Ps)=>Uo?Math.max(Uo,Ps):Ps;is=Ml(Li,is),is=Ml(fn,is),is=Ml(Ur,is);const bc=is>-1?1:0;Gt.glyphOffsetArray.length>=65535&&Yt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Oi.sortKey!==void 0&&Gt.addToSortKeyRanges(Gt.symbolInstances.length,Oi.sortKey),Gt.symbolInstances.emplaceBack(ji.x,ji.y,ts.x,ts.y,ts.z,Qa.right>=0?Qa.right:-1,Qa.center>=0?Qa.center:-1,Qa.left>=0?Qa.left:-1,Qa.vertical>=0?Qa.vertical:-1,Ja,$s,dl,$n!==void 0?$n:Gt.collisionBoxArray.length,$n!==void 0?$n+1:Gt.collisionBoxArray.length,Kn!==void 0?Kn:Gt.collisionBoxArray.length,Kn!==void 0?Kn+1:Gt.collisionBoxArray.length,en!==void 0?en:Gt.collisionBoxArray.length,en!==void 0?en+1:Gt.collisionBoxArray.length,Ar||Gt.collisionBoxArray.length,Ar?Ar+1:Gt.collisionBoxArray.length,Yr,Ka,Lr,Mr,La,bc,0,fl,Dl,is,0,xc?1:0,nr)})(n,mt,qt,_t,i,o,m,c,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,yt,ae,A,0,Tt,pt,ee,e,g,M,P,k,V,q,J,xt,de,Re)};if(le==="line")for(const _t of Fx(e.geometry,0,0,Lt,Lt)){const mt=kA(_t,ht,Et,i.vertical||rt,o,ke,ot,n.overscaling,Lt);for(const si of mt)rt&&ps(n,rt.text,St,si)||wt(_t,si,k)}else if(le==="line-center"){for(const _t of e.geometry)if(_t.length>1){const mt=Xl(_t,Et,i.vertical||rt,o,ke,ot);mt&&wt(_t,mt,k)}}else if(e.type==="Polygon")for(const _t of Is(e.geometry,0)){const mt=rv(_t,16);wt(_t[0],new eh(mt.x,mt.y,0,0,void 0),k)}else if(e.type==="LineString")for(const _t of e.geometry)wt(_t,new eh(_t[0].x,_t[0].y,0,0,void 0),k);else if(e.type==="Point")for(const _t of e.geometry)for(const mt of _t)wt([mt],new eh(mt.x,mt.y,0,0,void 0),k)}const Gh=255,Nd=Gh*Ju;function lv(n,e,i,o,c,m,g,x,S,A,M,P,k,U,V,q,J,ee,ae){const le=function(Se,Pe,ke,Fe,rt,qe,ot,ht){const yt=[];if(Pe.positionedLines.length===0)return yt;const Tt=Fe.layout.get("text-rotate").evaluate(qe,{})*Math.PI/180,Et=function(xt){const wt=xt[0],_t=xt[1],mt=wt*_t;return mt>0?[wt,-_t]:mt<0?[-wt,_t]:wt===0?[_t,wt]:[_t,-wt]}(ke);let pt=Math.abs(Pe.top-Pe.bottom);for(const xt of Pe.positionedLines)pt-=xt.lineOffset;const St=Pe.positionedLines.length,tt=pt/St;let Qe=Pe.top-ke[1];for(let xt=0;xt<St;++xt){const wt=Pe.positionedLines[xt];Qe=Vf(Pe,tt,Qe,xt);for(const _t of wt.positionedGlyphs){if(!_t.rect)continue;const mt=_t.rect||{};let si=Xy+1,qt=!0,Gt=1,ji=0;if(_t.image){const gi=ot.get(_t.image.toString());if(!gi)continue;if(gi.sdf){Yt("SDF images are not supported in formatted text and will be ignored.");continue}qt=!1,Gt=gi.pixelRatio,si=Nf/Gt}const Zt=(rt||ht)&&_t.vertical,Si=_t.metrics.advance*_t.scale/2,Zi=_t.metrics,hn=_t.rect;if(hn===null)continue;ht&&Pe.verticalizable&&(ji=_t.image?Si-_t.metrics.width*_t.scale/2:0);const wn=rt?[_t.x+Si,_t.y]:[0,0];let Xi=[0,0],Gn=[0,0],Yn=!1;rt||(Zt?(Gn=[_t.x+Si+Et[0],_t.y+Et[1]-ji],Yn=!0):Xi=[_t.x+Si+ke[0],_t.y+ke[1]-ji]);const Yr=hn.w*_t.scale/(Gt*(_t.localGlyph?au:1)),Ee=hn.h*_t.scale/(Gt*(_t.localGlyph?au:1));let ve,at,Bt,ct;if(Zt){const gi=_t.y-Qe,Ki=new vt(-Si,Si-gi),Oi=-Math.PI/2,fi=new vt(...Gn);ve=new vt(-Si+Xi[0],Xi[1]),ve._rotateAround(Oi,Ki)._add(fi),ve.x+=-gi+Si,ve.y-=(Zi.left-si)*_t.scale;const Hn=_t.image?Zi.advance*_t.scale:zo*_t.scale,yr=String.fromCodePoint(_t.glyph);Yu(yr)?ve.x+=(1-si)*_t.scale:MA(yr)?ve.x+=Hn-Zi.height*_t.scale+(-si-1)*_t.scale:ve.x+=_t.image||Zi.width+2*si===hn.w&&Zi.height+2*si===hn.h?(Hn-Ee)/2:(Hn-(Zi.height+2*si)*_t.scale)/2,at=new vt(ve.x,ve.y-Yr),Bt=new vt(ve.x+Ee,ve.y),ct=new vt(ve.x+Ee,ve.y-Yr)}else{const gi=(Zi.left-si)*_t.scale-Si+Xi[0],Ki=(-Zi.top-si)*_t.scale+Xi[1],Oi=gi+Yr,fi=Ki+Ee;ve=new vt(gi,Ki),at=new vt(Oi,Ki),Bt=new vt(gi,fi),ct=new vt(Oi,fi)}if(Tt){let gi;gi=rt?new vt(0,0):Yn?new vt(Et[0],Et[1]):new vt(ke[0],ke[1]),ve._rotateAround(Tt,gi),at._rotateAround(Tt,gi),Bt._rotateAround(Tt,gi),ct._rotateAround(Tt,gi)}const Ht=new vt(0,0),xi=new vt(0,0);yt.push({tl:ve,tr:at,bl:Bt,br:ct,texPrimary:mt,texSecondary:void 0,writingMode:Pe.writingMode,glyphOffset:wn,sectionIndex:_t.sectionIndex,isSDF:qt,pixelOffsetTL:Ht,pixelOffsetBR:xi,minFontScaleX:0,minFontScaleY:0})}}return yt}(0,o,S,m,g,x,c,n.allowVerticalPlacement),de=n.textSizeData;let Re=null;de.kind==="source"?(Re=[Ju*m.layout.get("text-size").evaluate(x,{},J)*V.textScaleFactor],Re[0]>Nd&&Yt(`${n.layerIds[0]}: Value for "text-size" is >= ${Gh}. Reduce your "text-size".`)):de.kind==="composite"&&(Re=[Ju*V.compositeTextSizes[0].evaluate(x,{},J)*V.textScaleFactor,Ju*V.compositeTextSizes[1].evaluate(x,{},J)*V.textScaleFactor],(Re[0]>Nd||Re[1]>Nd)&&Yt(`${n.layerIds[0]}: Value for "text-size" is >= ${Gh}. Reduce your "text-size".`)),n.addSymbols(n.text,le,Re,S,g,x,M,e,i,A.lineStartIndex,A.lineLength,U,q,J,ae,!1,ee,le.length);for(const Se of P)k[Se]=n.text.placedSymbolArray.length-1;return 4*le.length}function cl(n){for(const e in n)return n[e];return null}function No(n,e,i,o,c,m,g,x,S,A,M){let P,k,U,V;if(P=M?M.top:g.top,k=M?M.bottom:g.bottom,U=M?M.left:g.left,V=M?M.right:g.right,Uw(g)&&g.collisionPadding){const q=g.collisionPadding;U-=q[0],P-=q[1],V+=q[2],k+=q[3]}if(S){const q=new vt(U,P),J=new vt(V,P),ee=new vt(U,k),ae=new vt(V,k),le=cn(S);let de=new vt(0,0);A&&(de=new vt(A[0],A[1])),q._rotateAround(le,de),J._rotateAround(le,de),ee._rotateAround(le,de),ae._rotateAround(le,de),U=Math.min(q.x,J.x,ee.x,ae.x),V=Math.max(q.x,J.x,ee.x,ae.x),P=Math.min(q.y,J.y,ee.y,ae.y),k=Math.max(q.y,J.y,ee.y,ae.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,U,P,V,k,x,o,c,m),n.length-1}function su(n){Uw(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function ps(n,e,i,o){const c=n.compareText;if(e in c){const m=c[e];for(let g=m.length-1;g>=0;g--)if(o.dist(m[g])<i)return!0}else c[e]=[];return c[e].push(o),!1}function Ms(n,e){const i=n.fovAboveCenter,o=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,c=(n._camera.position[2]*n.worldSize-o)/Math.cos(n._pitch),m=Math.sin(i)*c/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01));let g=Math.sin(n._pitch)*m+c;const x=c*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let S=Math.max(n.zoom-17,0);n.isOrthographic&&(S/=10),g*=1+S}return Math.min(1.01*g,x)}function fm(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),o=n.x*i,c=(n.x+1)*i,m=n.y*i,g=(n.y+1)*i,x=me(o),S=me(c),A=ce(m),M=ce(g),P=e.project(x,A),k=e.project(S,A),U=e.project(S,M),V=e.project(x,M);let q=Math.min(P.x,k.x,U.x,V.x),J=Math.min(P.y,k.y,U.y,V.y),ee=Math.max(P.x,k.x,U.x,V.x),ae=Math.max(P.y,k.y,U.y,V.y);const le=i/16;function de(Se,Pe,ke,Fe,rt,qe){const ot=(ke+rt)/2,ht=(Fe+qe)/2,yt=e.project(me(ot),ce(ht)),Tt=Math.max(0,q-yt.x,J-yt.y,yt.x-ee,yt.y-ae);q=Math.min(q,yt.x),ee=Math.max(ee,yt.x),J=Math.min(J,yt.y),ae=Math.max(ae,yt.y),Tt>le&&(de(Se,yt,ke,Fe,ot,ht),de(yt,Pe,ot,ht,rt,qe))}de(P,k,o,m,c,m),de(k,U,c,m,c,g),de(U,V,c,g,o,g),de(V,P,o,g,o,m),q-=le,J-=le,ee+=le,ae+=le;const Re=1/Math.max(ee-q,ae-J);return{scale:Re,x:q*Re,y:J*Re,x2:ee*Re,y2:ae*Re,projection:e}}function E0(n,{x:e,y:i},o=0){return new vt(((e-o)*n.scale-n.x)*Lt,(i*n.scale-n.y)*Lt)}const zA=be(new Float32Array(16));class Wi{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new j(0,0)}projectTilePoint(e,i,o){return{x:e,y:i,z:0}}locationPoint(e,i,o,c=!0){return e._coordinatePoint(e.locationCoordinate(i,o),c)}pixelsPerMeter(e,i){return se(1,e)*i}pixelSpaceConversion(e,i,o){return 1}farthestPixelDistance(e){return Ms(e,e.pixelsPerMeter)}pointCoordinate(e,i,o,c){const m=e.horizonLineFromTop(!1),g=new vt(i,Math.max(m,o));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,c))}pointCoordinate3D(e,i,o){const c=new vt(i,o);if(e.elevation)return e.elevation.pointCoordinate(c);{const m=this.pointCoordinate(e,c.x,c.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const o=e.horizonLineFromTop();return i.y<o}createInversionMatrix(e,i){return zA}createTileMatrix(e,i,o){let c,m,g;const x=o.canonical,S=be(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=fm(x,this);c=1,m=A.x+o.wrap*A.scale,g=A.y,Xe(S,S,[c/A.scale,c/A.scale,e.pixelsPerMeter/i])}else c=i/e.zoomScale(x.z),m=(x.x+Math.pow(2,x.z)*o.wrap)*c,g=x.y*c;return He(S,S,[m,g,0]),Xe(S,S,[c/Lt,c/Lt,1]),S}upVector(e,i,o){return[0,0,1]}upVectorScale(e,i,o){return{metersToTile:1}}}class cv extends Wi{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,o]=this.parallels=e.parallels||[29.5,45.5],c=Math.sin(cn(i));this.n=(c+Math.sin(cn(o)))/2,this.c=1+c*(2*this.n-c),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:o,c,r0:m}=this,g=cn(e-this.center[0]),x=cn(i),S=Math.sqrt(c-2*o*Math.sin(x))/o;return{x:S*Math.sin(g*o),y:S*Math.cos(g*o)-m,z:0}}unproject(e,i){const{n:o,c,r0:m}=this,g=m+i;let x=Math.atan2(e,Math.abs(g))*Math.sign(g);g*o<0&&(x-=Math.PI*Math.sign(e)*Math.sign(g));const S=cn(this.center[0])*o;x=we(x,-Math.PI-S,Math.PI-S);const A=X(Za(x/o)+this.center[0],-180,180),M=Math.asin(X((c-(e*e+g*g)*o*o)/(2*o),-1,1)),P=X(Za(M),-_e,_e);return new j(A,P)}}const pm=1.340264,Hh=-.081106,ih=893e-6,ua=.003796,Bo=Math.sqrt(3)/2;class ms extends Wi{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const o=Math.asin(Bo*Math.sin(i)),c=o*o,m=c*c*c;return{x:.5*(e*Math.cos(o)/(Bo*(pm+3*Hh*c+m*(7*ih+9*ua*c)))/Math.PI+.5),y:1-.5*(o*(pm+Hh*c+m*(ih+ua*c))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,c=o*o,m=c*c*c;for(let M,P,k,U=0;U<12&&(P=o*(pm+Hh*c+m*(ih+ua*c))-i,k=pm+3*Hh*c+m*(7*ih+9*ua*c),M=P/k,o=X(o-M,-Math.PI/3,Math.PI/3),c=o*o,m=c*c*c,!(Math.abs(M)<1e-12));++U);const g=Bo*e*(pm+3*Hh*c+m*(7*ih+9*ua*c))/Math.cos(o),x=Math.asin(Math.sin(o)/Bo),S=X(180*g/Math.PI,-180,180),A=X(180*x/Math.PI,-_e,_e);return new j(S,A)}}class C0 extends Wi{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const o=360*(e-.5),c=X(360*(.5-i),-_e,_e);return new j(o,c)}}const $h=Math.PI/2;function Gf(n){return Math.tan(($h+n)/2)}class FA extends Wi{constructor(e){super(e),this.center=e.center||[0,30];const[i,o]=this.parallels=e.parallels||[30,30];let c=cn(i),m=cn(o);this.southernCenter=c+m<0,this.southernCenter&&(c=-c,m=-m);const g=Math.cos(c),x=Gf(c);this.n=c===m?Math.sin(c):Math.log(g/Math.cos(m))/Math.log(Gf(m)/x),this.f=g*Math.pow(Gf(c),this.n)/this.n}project(e,i){i=cn(i),this.southernCenter&&(i=-i),e=cn(e-this.center[0]);const o=1e-6,{n:c,f:m}=this;m>0?i<-$h+o&&(i=-$h+o):i>$h-o&&(i=$h-o);const g=m/Math.pow(Gf(i),c);let x=g*Math.sin(c*e),S=m-g*Math.cos(c*e);return x=.5*(x/Math.PI+.5),S=.5*(S/Math.PI+.5),{x,y:this.southernCenter?S:1-S,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:o,f:c}=this,m=c-i,g=Math.sign(m),x=Math.sign(o)*Math.sqrt(e*e+m*m);let S=Math.atan2(e,Math.abs(m))*g;m*o<0&&(S-=Math.PI*Math.sign(e)*g);const A=X(Za(S/o)+this.center[0],-180,180),M=X(Za(2*Math.atan(Math.pow(c/x,1/o))-$h),-_e,_e);return new j(A,this.southernCenter?-M:M)}}class QS extends Wi{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:re(e),y:te(i),z:0}}unproject(e,i){const o=me(e),c=ce(i);return new j(o,c)}}const li=cn(_e);class lu extends Wi{project(e,i){const o=(i=cn(i))*i,c=o*o;return{x:.5*((e=cn(e))*(.8707-.131979*o+c*(c*(.003971*o-.001529*c)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+o*(.015085+c*(.028874*o-.044475-.005916*c)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let o=i=(2*(1-i)-1)*Math.PI,c=25,m=0,g=o*o;do{g=o*o;const A=g*g;m=(o*(1.007226+g*(.015085+A*(.028874*g-.044475-.005916*A)))-i)/(1.007226+g*(.045255+A*(.259866*g-.311325-.005916*11*A))),o=X(o-m,-li,li)}while(Math.abs(m)>1e-6&&--c>0);g=o*o;const x=X(Za(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),S=Za(o);return new j(x,S)}}const Bd=cn(_e);class Xw extends Wi{project(e,i){i=cn(i),e=cn(e);const o=Math.cos(i),c=2/Math.PI,m=Math.acos(o*Math.cos(e/2)),g=Math.sin(m)/m,x=.5*(e*c+2*o*Math.sin(e/2)/g)||0,S=.5*(i+Math.sin(i)/g)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(e,i){let o=e=(2*e-.5)*Math.PI,c=i=(2*(1-i)-1)*Math.PI,m=25;const g=1e-6;let x=0,S=0;do{const A=Math.cos(c),M=Math.sin(c),P=2*M*A,k=M*M,U=A*A,V=Math.cos(o/2),q=Math.sin(o/2),J=2*V*q,ee=q*q,ae=1-U*V*V,le=ae?1/ae:0,de=ae?Math.acos(A*V)*Math.sqrt(1/ae):0,Re=.5*(2*de*A*q+2*o/Math.PI)-e,Se=.5*(de*M+c)-i,Pe=.5*le*(U*ee+de*A*V*k)+1/Math.PI,ke=le*(J*P/4-de*M*q),Fe=.125*le*(P*q-de*M*U*J),rt=.5*le*(k*V+de*ee*A)+.5,qe=ke*Fe-rt*Pe;x=(Se*ke-Re*rt)/qe,S=(Re*Fe-Se*Pe)/qe,o=X(o-x,-Math.PI,Math.PI),c=X(c-S,-Bd,Bd)}while((Math.abs(x)>g||Math.abs(S)>g)&&--m>0);return new j(Za(o),Za(c))}}class ma extends Wi{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(cn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:o,cosPhi:c}=this;return{x:cn(e)*c*o+.5,y:-Math.sin(cn(i))/c*o+.5,z:0}}unproject(e,i){const{scale:o,cosPhi:c}=this,m=-(i-.5)/o,g=X(Za((e-.5)/o)/c,-180,180),x=Math.asin(X(m*c,-1,1)),S=X(Za(x),-_e,_e);return new j(g,S)}}class $i extends QS{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,o){const c=Rd(e,i,o);return Bn(c,c,xy(Lh(o))),{x:c[0],y:c[1],z:c[2]}}locationPoint(e,i,o){const c=D(i.lat,i.lng),m=Vi([],c),g=o?e._centerAltitude+o:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;mr(c,c,m,se(1,0)*Lt*g);const x=be(new Float64Array(16));return Be(x,e.pixelMatrix,e.globeMatrix),Bn(c,c,x),new vt(c[0],c[1])}pixelsPerMeter(e,i){return se(1,0)*i}pixelSpaceConversion(e,i,o){const c=se(1,e)*i,m=wi(se(1,45)*i,c,o);return this.pixelsPerMeter(e,i)/m}createTileMatrix(e,i,o){const c=Wb(Lh(o.canonical));return Be(new Float64Array(16),e.globeMatrix,c)}createInversionMatrix(e,i){const{center:o}=e,c=xy(Lh(i));return kt(c,c,cn(o.lng)),it(c,c,cn(o.lat)),Xe(c,c,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(c)}pointCoordinate(e,i,o,c){return kT(e,i,o,!0)||new Ge(0,0)}pointCoordinate3D(e,i,o){const c=this.pointCoordinate(e,i,o,0);return[c.x,c.y,c.z]}isPointAboveHorizon(e,i){return!kT(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(c,m){const g=c.cameraToCenterDistance,x=c._centerAltitude*m,S=c._camera,A=c._camera.forward(),M=zi([],xn([],A,-g),[0,0,x]),P=c.worldSize/(2*Math.PI),k=[0,0,-P],U=c.width/c.height,V=Math.tan(c.fovAboveCenter),q=xn([],S.up(),V),J=xn([],S.right(),V*U),ee=Vi([],zi([],zi([],A,q),J)),ae=[];let le;if(new tn(M,ee).closestPointOnSphere(k,P,ae)){const de=zi([],ae,k),Re=Pr([],de,M);le=Math.cos(c.fovAboveCenter)*Qt(Re)}else{const de=Pr([],M,k),Re=Pr([],k,M);Vi(Re,Re);const Se=Qt(de)-P;le=Math.sqrt(Se*(Se+2*P));const Pe=Math.acos(le/(P+Se))-Math.acos(Rn(A,Re));le*=Math.cos(Pe)}return 1.01*le}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),o=Id(e.zoom);if(o>0){const c=Ms(e,se(1,e.center.lat)*e.worldSize),m=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return wi(i,c+m*(1-Math.cos(g)),Math.pow(o,10))}return i}upVector(e,i,o){return Rd(i,o,e,1)}upVectorScale(e){return{metersToTile:Tx(vy(Lh(e)))}}}function mm(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new QS(n);case"equirectangular":return new C0(n);case"naturalEarth":return new lu(n);case"equalEarth":return new ms(n);case"winkelTripel":return new Xw(n);case"albers":return i?new ma(n):new cv(n);case"lambertConformalConic":return i?new ma(n):new FA(n);case"globe":return new $i(n)}throw new Error(`Invalid projection name: ${n.name}`)}const NA=bt.types,ul=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function gm(n,e,i,o,c,m,g,x,S,A,M,P,k){const U=x?Math.min(Nd,Math.round(x[0])):0,V=x?Math.min(Nd,Math.round(x[1])):0;n.emplaceBack(e,i,Math.round(32*o),Math.round(32*c),m,g,(U<<1)+(S?1:0),0+(V<<1),16*A,16*M,256*P,256*k)}function Wh(n,e,i){n.emplaceBack(e,i)}function qh(n,e,i,o,c,m,g){n.emplaceBack(e,i,o,c,m,g)}const uv=(n,e,i,o)=>{for(let c=0;c<e;c++)n.emplaceBack(i[0],i[1],i[2],o[0],o[1],o[2])};function _m(n,e,i,o,c){n.emplaceBack(e,i,o,c),n.emplaceBack(e,i,o,c),n.emplaceBack(e,i,o,c),n.emplaceBack(e,i,o,c)}function Zh(n){for(const e of n.sections)if(Vb(e.text))return!0;return!1}class Yl{constructor(e){this.layoutVertexArray=new Td,this.indexArray=new ar,this.programConfigurations=e,this.segments=new ta,this.dynamicLayoutVertexArray=new ju,this.opacityVertexArray=new xg,this.placedSymbolArray=new Tl,this.iconTransitioningVertexArray=new jl,this.globeExtVertexArray=new _f,this.zOffsetVertexArray=new Uu,this.orientationVertexArray=new yf,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,i){const o=[],c=this.layoutVertexArray.uint16;for(let m=0;m<i;++m){const g=12*(e+m);o.push(...c.slice(g,g+12))}return o}updateIconVertexData(e,i,o,c,m,g,x,S,A,M,P,k,U){const V=this.layoutVertexArray.uint16,q=12*e;V[q]=i,V[q+1]=o,V[q+2]=c,V[q+3]=m,V[q+4]=g,V[q+5]=x,V[q+6]=S,V[q+7]=A,V[q+8]=M,V[q+9]=P,V[q+10]=k,V[q+11]=U}upload(e,i,o,c,m,g){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,AA.members,!!g),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,HS.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ul,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,$S.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,RA.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||m)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,o0.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,IA.members,!0)),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}ai(Yl,"SymbolBuffers");class A0{constructor(e,i,o){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new o,this.segments=new ta,this.collisionVertexArray=new Mh,this.collisionVertexArrayExt=new ju}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Xg.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,WS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ai(A0,"CollisionBuffers");class r_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=be([]),this.placementViewportMatrix=be([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=Qu(this.zoom,i["text-size"],this.worldview),this.iconSizeData=Qu(this.zoom,i["icon-size"],this.worldview);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),m=o.get("symbol-z-order");this.lut=e.lut,this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(g=>ll[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null}hasAnyAppearanceProperty(e){const i=this.layers[0].getAppearances();return!(!i||i.length===0)&&i.some(o=>o.getProperty(e)!=null)}createArrays(){this.text=new Yl(new Ns(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Yl(new Ns(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Sd,this.lineVertexArray=new $l,this.symbolInstances=new Hp}calculateGlyphDependencies(e,i,o,c,m){for(const g of e){const x=g.codePointAt(0);if(x===void 0)break;if(i[x]=!0,c&&m&&x<=65535){const S=Wy[g];S&&(i[S.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,i,o,c,m,g){let x=1;const S=e.getUnevaluatedProperties()._values["icon-size"],A=Qu(this.zoom,S,this.worldview),M=ru(A,i);if(A.kind!=="constant"&&A.kind!=="camera"||(x=M.uSize),A.kind==="composite"){const{minZoom:P,maxZoom:k}=A,U=S.possiblyEvaluate(new Er(P,{worldview:this.worldview}),c),V=S.possiblyEvaluate(new Er(k,{worldview:this.worldview}),c),q=U.evaluate(o,{},c,m);x=q+(V.evaluate(o,{},c,m)-q)*M.uSizeT}return A.kind==="source"&&(x=S.possiblyEvaluate(new Er(this.zoom,{worldview:this.worldview}),c).evaluate(o,{},c,m)),x*g}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!My(this.activeReplacements,o)&&(this.activeReplacements=o,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?oo.build(e):e}populate(e,i,o,c){const m=this.layers[0],g=m.layout,x=this.projection.name==="globe",S=g.get("text-font"),A=g.get("text-field"),M=g.get("icon-image"),[P,k]=g.get("icon-size-scale-range"),U=X(i.scaleFactor||1,P,k),V=(A.value.kind!=="constant"||A.value.value instanceof Sa&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),q=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,J=this.hasAnyAppearanceProperty("icon-image"),ee=g.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!V&&!q&&!J)return;const ae=i.iconDependencies,le=i.glyphDependencies,de=i.availableImages,Re=new Er(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),Se=Pe=>{const ke=Pe.id.toString();ae.has(ke)?ae.get(ke).push(Pe):ae.set(ke,[Pe])};for(const Pe of e){const{feature:ke,id:Fe,index:rt,sourceLayerIndex:qe}=Pe,ot=m._featureFilter.needGeometry,ht=Je(ke,ot);if(!m._featureFilter.filter(Re,ht,o))continue;if(ot||(ht.geometry=lt(ke,o,c)),x&&ke.type!==1&&o.z<=5){const xt=ht.geometry,wt=.98078528056,_t=(mt,si)=>Rn(Rd(mt.x,mt.y,o,1),Rd(si.x,si.y,o,1))<wt;for(let mt=0;mt<xt.length;mt++)xt[mt]=st(xt[mt],_t)}let yt,Tt;if(V){const xt=m.getValueAndResolveTokens("text-field",ht,o,de),wt=Sa.factory(xt);Zh(wt)&&(this.hasRTLText=!0),(!this.hasRTLText||iy()==="unavailable"||this.hasRTLText&&tl.isParsed())&&(yt=DA(wt,m,ht))}if(q){const xt=m.getValueAndResolveTokens("icon-image",ht,o,de);Tt=this.getResolvedImageFromTokens(xt)}const Et=this.layers[0];let pt=!1;if(!Tt&&J){const xt=Et.getAppearances();for(const wt of xt)if(wt.getProperty("icon-image")){const _t=Et.getAppearanceValueAndResolveTokens(wt,"icon-image",ht,o,de);if(_t){Tt=this.getResolvedImageFromTokens(_t),pt=!0;break}}}if(!yt&&!Tt)continue;const St=this.sortFeaturesByKey?ee.evaluate(ht,{},o):void 0,tt={id:Fe,text:yt,icon:Tt,index:rt,sourceLayerIndex:qe,geometry:ht.geometry,properties:ke.properties,type:NA[ke.type],sortKey:St};if(this.features.push(tt),this.appearanceFeatureData.push({id:Fe,properties:ke.properties,usesAppearanceIconAsPlaceholder:pt,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Tt){const xt=Et._unevaluatedLayout._values,{iconPrimary:wt,iconSecondary:_t}=n_(Tt,this.iconSizeData,xt["icon-size"],o,this.zoom,tt,this.pixelRatio,U,this.worldview);Se(wt),_t&&(this.hasAnySecondaryIcon=!0,Se(_t))}const Qe=Et.getAppearances();if(Qe.length!==0&&Qe.forEach(xt=>{if(!xt.getProperty("icon-image"))return;const wt=this.getCombinedIconPrimary(xt,Et,ht,o,de,tt,U);wt&&Se(wt)}),yt){const xt=S.evaluate(ht,{},o).join(","),wt=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ll.vertical)>=0;for(const _t of yt.sections)if(_t.image){const mt=_t.image.getPrimary().scaleSelf(this.pixelRatio),si=mt.id.toString(),qt=ae.get(si)||[];qt.push(mt),ae.set(si,qt)}else{const mt=Q_(yt.toString()),si=_t.fontStack||xt,qt=le[si]=le[si]||{};this.calculateGlyphDependencies(_t.text,qt,wt,this.allowVerticalPlacement,mt)}}}if(g.get("symbol-placement")==="line"&&(this.features=function(Pe){const ke={},Fe={},rt=[];let qe=0;function ot(Et){rt.push(Pe[Et]),qe++}function ht(Et,pt,St){const tt=Fe[Et];return delete Fe[Et],Fe[pt]=tt,rt[tt].geometry[0].pop(),rt[tt].geometry[0]=rt[tt].geometry[0].concat(St[0]),tt}function yt(Et,pt,St){const tt=ke[pt];return delete ke[pt],ke[Et]=tt,rt[tt].geometry[0].shift(),rt[tt].geometry[0]=St[0].concat(rt[tt].geometry[0]),tt}function Tt(Et,pt,St){const tt=St?pt[0][pt[0].length-1]:pt[0][0];return`${Et}:${tt.x}:${tt.y}`}for(let Et=0;Et<Pe.length;Et++){const pt=Pe[Et],St=pt.geometry,tt=pt.text?pt.text.toString():null;if(!tt){ot(Et);continue}const Qe=Tt(tt,St),xt=Tt(tt,St,!0);if(Qe in Fe&&xt in ke&&Fe[Qe]!==ke[xt]){const wt=yt(Qe,xt,St),_t=ht(Qe,xt,rt[wt].geometry);delete ke[Qe],delete Fe[xt],Fe[Tt(tt,rt[_t].geometry,!0)]=_t,rt[wt].geometry=null}else Qe in Fe?ht(Qe,xt,St):xt in ke?yt(Qe,xt,St):(ot(Et),ke[Qe]=qe-1,Fe[xt]=qe-1)}return rt.filter(Et=>Et.geometry)}(this.features)),g.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Pe of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Pe.id,this.elevationFeatures.length),this.elevationFeatures.push(Pe)}}else g.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Pe,ke)=>Pe.sortKey-ke.sortKey)}getCombinedIconPrimary(e,i,o,c,m,g,x){let S,A;const M=e.getUnevaluatedProperties();if(M._values["icon-image"].value!==void 0){const P=i.getAppearanceValueAndResolveTokens(e,"icon-image",o,c,m);S=this.getResolvedImageFromTokens(P)}else{const P=i.getValueAndResolveTokens("icon-image",o,c,m);S=this.getResolvedImageFromTokens(P)}if(S){const P=M._values["icon-size"]||i._unevaluatedLayout._values["icon-size"];A=n_(S,Qu(this.zoom,P,this.worldview),P,c,this.zoom,g,this.pixelRatio,x,this.worldview).iconPrimary}return A}updateAppearanceBasedIconTextures(e,i,o,c){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const m=this.layers[0];let g=!1,x=0;const S=m.layout,[A,M]=S.get("icon-size-scale-range"),P=X(1,A,M);for(let k=0;k<this.symbolInstances.length;k++){const U=this.symbolInstances.get(k),V=this.appearanceFeatureData[U.featureIndex];if(V&&U.placedIconSymbolIndex>=0){const q=V.id,J=i&&q!==void 0?i[String(q)]:void 0,ee={type:"Point",id:V.id,properties:V.properties,geometry:[]},ae=this.layers[0].appearances&&this.layers[0].appearances.find(le=>le.isActive({globals:c,feature:ee,canonical:e,featureState:J}));if(V.activeAppearance===ae)continue;if(ae){V.activeAppearance=ae;const le={sortKey:void 0,text:void 0,icon:null,index:U.featureIndex,sourceLayerIndex:U.featureIndex,geometry:[],properties:V.properties,type:"Point",id:V.id};if(!ae.hasCachedIconPrimary()){const Pe=this.getCombinedIconPrimary(ae,m,ee,e,o,le,P);ae.setCachedIconPrimary(Pe)}const de=ae.getCachedIconPrimary();if(!de)continue;const Re=de.toString(),Se=this.iconAtlasPositions&&this.iconAtlasPositions.get(Re);if(Se){const Pe=m.getAppearanceValueAndResolveTokens(ae,"icon-offset",ee,e,o),ke=Pe&&Array.isArray(Pe)?Pe:[0,0];let Fe=Ky(Se,void 0,ke,m.layout.get("icon-anchor").evaluate(ee,{},e));const rt=m.getAppearanceValueAndResolveTokens(ae,"icon-rotate",ee,e,o),qe=typeof rt=="number"?rt:0,ot=Se.sdf,ht=m.layout.get("icon-text-fit").constantOr("none");ht!=="none"&&V.textShaping&&V.iconTextFitPadding&&V.fontScale&&(Fe=g0(Fe,V.textShaping,ht,V.iconTextFitPadding,ke,V.fontScale));const yt=this.calculateEffectiveAppearanceIconSize(ae,c.zoom,ee,e,o,P),Tt=0,Et=1+(Math.min(Nd,Math.round(yt*Ju))<<1),pt=Gw(Fe,qe,ot,ht!=="none",P);V.isUsingAppearanceVertexData||(V.isUsingAppearanceVertexData=!0,V.layoutBasedVertexData=this.icon.getIconVertexData(x,U.numIconVertices));for(let tt=0;tt<pt.length;++tt){const Qe=pt[tt],xt=V.layoutBasedVertexData[0]||U.tileAnchorX,wt=V.layoutBasedVertexData[1]||U.tileAnchorY,_t=16*Qe.pixelOffsetTL.x,mt=16*Qe.pixelOffsetTL.y,si=16*Qe.pixelOffsetBR.x,qt=16*Qe.pixelOffsetBR.y,Gt=16*Qe.minFontScaleX,ji=16*Qe.minFontScaleY;this.icon.updateIconVertexData(x,xt,wt,Math.round(32*Qe.tl.x),Math.round(32*Qe.tl.y),Qe.texPrimary.x,Qe.texPrimary.y,Tt,Et,_t,mt,Gt,ji),this.icon.updateIconVertexData(x+1,xt,wt,Math.round(32*Qe.tr.x),Math.round(32*Qe.tr.y),Qe.texPrimary.x+Qe.texPrimary.w,Qe.texPrimary.y,Tt,Et,si,mt,Gt,ji),this.icon.updateIconVertexData(x+2,xt,wt,Math.round(32*Qe.bl.x),Math.round(32*Qe.bl.y),Qe.texPrimary.x,Qe.texPrimary.y+Qe.texPrimary.h,Tt,Et,_t,qt,Gt,ji),this.icon.updateIconVertexData(x+3,xt,wt,Math.round(32*Qe.br.x),Math.round(32*Qe.br.y),Qe.texPrimary.x+Qe.texPrimary.w,Qe.texPrimary.y+Qe.texPrimary.h,Tt,Et,si,qt,Gt,ji),x+=4}const St=U.numIconVertices-4*pt.length;for(let tt=0;tt<St;++tt)this.icon.updateIconVertexData(x+tt,0,0,0,0,0,0,0,0,0,0,0,0);g=!0}else x+=U.numIconVertices}else if(V.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(x,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+3,0,0,0,0,0,0,0,0,0,0,0,0),g=!0),x+=U.numIconVertices,V.activeAppearance=null;else if(V.isUsingAppearanceVertexData){const de=V.layoutBasedVertexData.length/12;for(let Re=0;Re<de;++Re){const Se=Re*12;this.icon.updateIconVertexData(x+Re,V.layoutBasedVertexData[Se+0],V.layoutBasedVertexData[Se+1],V.layoutBasedVertexData[Se+2],V.layoutBasedVertexData[Se+3],V.layoutBasedVertexData[Se+4],V.layoutBasedVertexData[Se+5],V.layoutBasedVertexData[Se+6],V.layoutBasedVertexData[Se+7],V.layoutBasedVertexData[Se+8],V.layoutBasedVertexData[Se+9],V.layoutBasedVertexData[Se+10],V.layoutBasedVertexData[Se+11])}x+=de,V.isUsingAppearanceVertexData=!1,V.activeAppearance=null,g=!0}else x+=U.numIconVertices,V.activeAppearance=null}}return g}update(e,i,o,c,m,g,x){this.text.programConfigurations.updatePaintArrays(e,i,m,o,c,g,x,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,m,o,c,g,x,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const o=De(e),c=1/o;let m=!1,g=!1;for(let x=0;x<this.symbolInstances.length;x++){const S=this.symbolInstances.get(x),A=ui(1,0,0),M=ui(0,1,0),{numHorizontalGlyphVertices:P,numVerticalGlyphVertices:k,numIconVertices:U,numVerticalIconVertices:V}=S,q=P>0||k>0,J=U>0,ee=this.elevationFeatures[S.elevationFeatureIndex];if(ee){const ae=new vt(S.tileAnchorX,S.tileAnchorY),le=.075+ee.pointElevation(ae);S.zOffset!==le&&(i=!0,S.zOffset=le),le!==0&&(this.hasAnyZOffset=!0);const de=ee.computeSlopeNormal(ae,c),Re=Fr(wa(),ui(0,0,1),de);jr(A,A,Re),jr(M,M,Re),A[2]*=o,M[2]*=o,A[0]===1&&A[1]===0&&A[2]===0&&M[0]===0&&M[1]===1&&M[2]===0||(m=m||q,g=g||J)}if(q&&(uv(this.text.orientationVertexArray,P,A,M),uv(this.text.orientationVertexArray,k,A,M)),J){const{placedIconSymbolIndex:ae,verticalPlacedIconSymbolIndex:le}=S;ae>=0&&uv(this.icon.orientationVertexArray,U,A,M),le>=0&&uv(this.icon.orientationVertexArray,V,A,M)}}m||(this.text.orientationVertexArray=void 0),g||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(m,g,x)=>{o+=g,o>m.length&&m.resize(o);for(let S=-g;S<0;S++)m.emplace(S+o,x)},i=(m,g,x)=>{c+=g,c>m.length&&m.resize(c);for(let S=-g;S<0;S++)m.emplace(S+c,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let o=0,c=0;for(let m=0;m<this.symbolInstances.length;m++){const g=this.symbolInstances.get(m),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:S,numIconVertices:A}=g,M=g.zOffset,P=A>0;if((x>0||S>0)&&(e(this.text.zOffsetVertexArray,x,M),e(this.text.zOffsetVertexArray,S,M)),P){const{placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:U}=g;k>=0&&i(this.icon.zOffsetVertexArray,A,M),U>=0&&i(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,i,o,c,m){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(g=>g.appearances&&g.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,i,o,c){return!!(e&&i&&o)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,i,o,c)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=mm(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const o=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:c,y:m}of i)this.lineVertexArray.emplaceBack(c,m);return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,i,o,c,m,g,x,S,A,M,P,k,U,V,q,J,ee,ae){const le=e.indexArray,de=e.layoutVertexArray,Re=e.globeExtVertexArray,Se=e.segments.prepareSegment(4*ae,de,le,this.canOverlap?g.sortKey:void 0),Pe=this.glyphOffsetArray.length,ke=Se.vertexLength,Fe=this.allowVerticalPlacement&&x===ll.vertical?Math.PI/2:0,rt=g.text&&g.text.sections;for(let ht=0;ht<i.length;ht++){const{tl:yt,tr:Tt,bl:Et,br:pt,texPrimary:St,texSecondary:tt,pixelOffsetTL:Qe,pixelOffsetBR:xt,minFontScaleX:wt,minFontScaleY:_t,glyphOffset:mt,isSDF:si,sectionIndex:qt}=i[ht],Gt=Se.vertexLength,ji=mt[1];if(gm(de,A.x,A.y,yt.x,ji+yt.y,St.x,St.y,o,si,Qe.x,Qe.y,wt,_t),gm(de,A.x,A.y,Tt.x,ji+Tt.y,St.x+St.w,St.y,o,si,xt.x,Qe.y,wt,_t),gm(de,A.x,A.y,Et.x,ji+Et.y,St.x,St.y+St.h,o,si,Qe.x,xt.y,wt,_t),gm(de,A.x,A.y,pt.x,ji+pt.y,St.x+St.w,St.y+St.h,o,si,xt.x,xt.y,wt,_t),S){const{x:Zt,y:Si,z:Zi}=S.anchor,[hn,wn,Xi]=S.up;qh(Re,Zt,Si,Zi,hn,wn,Xi),qh(Re,Zt,Si,Zi,hn,wn,Xi),qh(Re,Zt,Si,Zi,hn,wn,Xi),qh(Re,Zt,Si,Zi,hn,wn,Xi),_m(e.dynamicLayoutVertexArray,Zt,Si,Zi,Fe)}else _m(e.dynamicLayoutVertexArray,A.x,A.y,A.z,Fe);if(J){const Zt=tt||St;Wh(e.iconTransitioningVertexArray,Zt.x,Zt.y),Wh(e.iconTransitioningVertexArray,Zt.x+Zt.w,Zt.y),Wh(e.iconTransitioningVertexArray,Zt.x,Zt.y+Zt.h),Wh(e.iconTransitioningVertexArray,Zt.x+Zt.w,Zt.y+Zt.h)}le.emplaceBack(Gt,Gt+1,Gt+2),le.emplaceBack(Gt+1,Gt+2,Gt+3),Se.vertexLength+=4,Se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(mt[0]),ht!==i.length-1&&qt===i[ht+1].sectionIndex||e.programConfigurations.populatePaintArrays(de.length,g,g.index,{},U,V,q,rt&&rt[qt],this.worldview)}const qe=ae-i.length;qe!==0&&this._addNullVertices(qe,de,o,S,Re,e,J,Se,le);const ot=S?S.anchor:A;e.placedSymbolArray.emplaceBack(ot.x,ot.y,ot.z,A.x,A.y,Pe,this.glyphOffsetArray.length-Pe,ke,M,P,A.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],x,0,0,0,k,0),e.symbolInstanceIndices.push(ee)}_addNullVertices(e,i,o,c,m,g,x,S,A){for(let M=0;M<e;M++){for(let k=0;k<4;k++)gm(i,0,0,0,0,0,0,o,!1,0,0,0,0),c&&qh(m,0,0,0,0,0,0),_m(g.dynamicLayoutVertexArray,0,0,0,0),x&&Wh(g.iconTransitioningVertexArray,0,0);const P=S.vertexLength;A.emplaceBack(P,P+1,P+2),A.emplaceBack(P+1,P+2,P+3),S.vertexLength+=4,S.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,i,o,c,m,g,x){e.emplaceBack(i,o,c,m,g,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,o,c,m,g,x){const S=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),A=S.vertexLength,M=x.tileAnchorX,P=x.tileAnchorY;for(let U=0;U<4;U++)o.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(o.collisionVertexArrayExt,i,e.padding,x.zOffset),this._commitLayoutVertex(o.layoutVertexArray,c,m,g,M,P,new vt(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,m,g,M,P,new vt(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,m,g,M,P,new vt(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,c,m,g,M,P,new vt(e.x1,e.y2)),S.vertexLength+=4;const k=o.indexArray;k.emplaceBack(A,A+1),k.emplaceBack(A+1,A+2),k.emplaceBack(A+2,A+3),k.emplaceBack(A+3,A),S.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,o,c,m,g){for(let x=c;x<m;x++){const S=o.get(x),A=this.getSymbolInstanceTextSize(e,g,i,x);this._addCollisionDebugVertices(S,A,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,i,o,c,m,g){for(let x=c;x<m;x++){const S=o.get(x),A=this.getSymbolInstanceIconSize(e,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(S,A,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,i,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new A0(Dh,Ds.members,jl),this.iconCollisionBox=new A0(Dh,Ds.members,jl);const c=ru(this.iconSizeData,e),m=ru(this.textSizeData,e,o);for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(m,e,i,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(m,e,i,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(c,e,i,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(c,e,i,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,i,o,c){const m=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:c),g=Fo(this.textSizeData,e,m)/zo;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,i,o){const c=this.icon.placedSymbolArray.get(o),m=Fo(this.iconSizeData,e,c);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,i,o,c){e.emplaceBack(i,-o,-o,c),e.emplaceBack(i,o,-o,c),e.emplaceBack(i,o,o,c),e.emplaceBack(i,-o,o,c)}_updateTextDebugCollisionBoxes(e,i,o,c,m,g,x){for(let S=c;S<m;S++){const A=o.get(S),M=this.getSymbolInstanceTextSize(e,g,i,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,A.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(e,i,o,c,m,g,x){for(let S=c;S<m;S++){const A=o.get(S),M=this.getSymbolInstanceIconSize(e,i,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,A.padding,g.zOffset)}}updateCollisionDebugBuffers(e,i,o,c){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const m=ru(this.iconSizeData,e,c),g=ru(this.textSizeData,e,o);for(let x=0;x<this.symbolInstances.length;x++){const S=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(g,e,i,S.textBoxStartIndex,S.textBoxEndIndex,S,o),this._updateTextDebugCollisionBoxes(g,e,i,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S,o),this._updateIconDebugCollisionBoxes(m,e,i,S.iconBoxStartIndex,S.iconBoxEndIndex,S,c),this._updateIconDebugCollisionBoxes(m,e,i,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S,c)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,o,c,m,g,x,S,A){const M={};if(i<o){const{x1:P,y1:k,x2:U,y2:V,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:de,featureIndex:Re}=e.get(i);M.textBox={x1:P,y1:k,x2:U,y2:V,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:de},M.textFeatureIndex=Re}if(c<m){const{x1:P,y1:k,x2:U,y2:V,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:de,featureIndex:Re}=e.get(c);M.verticalTextBox={x1:P,y1:k,x2:U,y2:V,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:de},M.verticalTextFeatureIndex=Re}if(g<x){const{x1:P,y1:k,x2:U,y2:V,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:de,featureIndex:Re}=e.get(g);M.iconBox={x1:P,y1:k,x2:U,y2:V,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:de},M.iconFeatureIndex=Re}if(S<A){const{x1:P,y1:k,x2:U,y2:V,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:de,featureIndex:Re}=e.get(S);M.verticalIconBox={x1:P,y1:k,x2:U,y2:V,padding:q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:de},M.verticalIconFeatureIndex=Re}return M}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const o=e.placedSymbolArray.get(i),c=o.vertexStartIndex+4*o.numGlyphs;for(let m=o.vertexStartIndex;m<c;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),o=Math.cos(e),c=[],m=[],g=[];for(let x=0;x<this.symbolInstances.length;++x){g.push(x);const S=this.symbolInstances.get(x);c.push(0|Math.round(i*S.tileAnchorX+o*S.tileAnchorY)),m.push(S.featureIndex)}return g.sort((x,S)=>c[x]-c[S]||m[S]-m[x]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===i?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex);const{rightJustifiedTextSymbolIndex:c,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:A}=o;c>=0&&this.addIndicesForPlacedSymbol(this.text,c),m>=0&&m!==c&&this.addIndicesForPlacedSymbol(this.text,m),g>=0&&g!==m&&g!==c&&this.addIndicesForPlacedSymbol(this.text,g),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const i=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let o;return this.elevationFeatures&&i<this.elevationFeatures.length&&(o=this.elevationFeatures[i]),o}}function R0(n,e){return e.replace(/{([^{}]+)}/g,(i,o)=>o in n?String(n[o]):"")}let I0,D0,eE;ai(r_,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),r_.addDynamicAttributes=_m;class BA{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:kc,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ai(BA,"FormatSectionOverride",{omit:["defaultValue"]});const hv=()=>eE||(eE={layout:I0||(I0=new ea({"symbol-placement":new At(We.layout_symbol["symbol-placement"]),"symbol-spacing":new At(We.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new At(We.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wt(We.layout_symbol["symbol-sort-key"]),"symbol-z-order":new At(We.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new At(We.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new At(We.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new At(We.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new At(We.layout_symbol["icon-ignore-placement"]),"icon-optional":new At(We.layout_symbol["icon-optional"]),"icon-rotation-alignment":new At(We.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wt(We.layout_symbol["icon-size"]),"icon-size-scale-range":new At(We.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Wt(We.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Wt(We.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wt(We.layout_symbol["icon-image"]),"icon-image-use-theme":new At({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Wt(We.layout_symbol["icon-rotate"]),"icon-padding":new At(We.layout_symbol["icon-padding"]),"icon-keep-upright":new At(We.layout_symbol["icon-keep-upright"]),"icon-offset":new Wt(We.layout_symbol["icon-offset"]),"icon-anchor":new Wt(We.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new At(We.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new At(We.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new At(We.layout_symbol["text-rotation-alignment"]),"text-field":new Wt(We.layout_symbol["text-field"]),"text-font":new Wt(We.layout_symbol["text-font"]),"text-size":new Wt(We.layout_symbol["text-size"]),"text-size-scale-range":new At(We.layout_symbol["text-size-scale-range"]),"text-max-width":new Wt(We.layout_symbol["text-max-width"]),"text-line-height":new Wt(We.layout_symbol["text-line-height"]),"text-letter-spacing":new Wt(We.layout_symbol["text-letter-spacing"]),"text-justify":new Wt(We.layout_symbol["text-justify"]),"text-radial-offset":new Wt(We.layout_symbol["text-radial-offset"]),"text-variable-anchor":new At(We.layout_symbol["text-variable-anchor"]),"text-anchor":new Wt(We.layout_symbol["text-anchor"]),"text-max-angle":new At(We.layout_symbol["text-max-angle"]),"text-writing-mode":new At(We.layout_symbol["text-writing-mode"]),"text-rotate":new Wt(We.layout_symbol["text-rotate"]),"text-padding":new At(We.layout_symbol["text-padding"]),"text-keep-upright":new At(We.layout_symbol["text-keep-upright"]),"text-transform":new Wt(We.layout_symbol["text-transform"]),"text-offset":new Wt(We.layout_symbol["text-offset"]),"text-allow-overlap":new At(We.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new At(We.layout_symbol["text-ignore-placement"]),"text-optional":new At(We.layout_symbol["text-optional"]),visibility:new At(We.layout_symbol.visibility)})),paint:D0||(D0=new ea({"icon-opacity":new Wt(We.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Wt(We.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Wt(We.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Wt(We.paint_symbol["text-emissive-strength"]),"icon-color":new Wt(We.paint_symbol["icon-color"]),"icon-halo-color":new Wt(We.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wt(We.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wt(We.paint_symbol["icon-halo-blur"]),"icon-translate":new At(We.paint_symbol["icon-translate"]),"icon-translate-anchor":new At(We.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new At(We.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Wt(We.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Wt(We.paint_symbol["text-occlusion-opacity"]),"text-color":new Wt(We.paint_symbol["text-color"],{runtimeType:ks,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new Wt(We.paint_symbol["text-halo-color"]),"text-halo-width":new Wt(We.paint_symbol["text-halo-width"]),"text-halo-blur":new Wt(We.paint_symbol["text-halo-blur"]),"text-translate":new At(We.paint_symbol["text-translate"]),"text-translate-anchor":new At(We.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new At(We.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new At(We.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new At(We.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new At(We.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Wt(We.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"})}))},eE);class ym extends uo{constructor(e,i,o,c){super(e,hv(),i,o,c,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=be([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.appearances&&this.appearances.forEach(c=>{c.recalculate(e,i,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const m of o)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,o,c){return this._saturation===e&&this._contrast===i&&this._brightnessMin===o&&this._brightnessMax===c||(this._colorAdjustmentMatrix=function(m,g,x,S){m=Gr(m),g=Rr(g);const A=pe(),M=m/3,P=1-2*M,k=[P,M,M,0,M,P,M,0,M,M,P,0,0,0,0,1],U=.5-.5*g,V=S-x;return Be(A,[V,0,0,0,0,V,0,0,0,0,V,0,x,x,x,1],[g,0,0,0,0,g,0,0,0,0,g,0,U,U,U,1]),Be(A,A,k),A}(e,i,o,c),this._saturation=e,this._contrast=i,this._brightnessMin=o,this._brightnessMax=c),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,o,c){const m=this.layout.get(e).evaluate(i,{},o,c),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||cg(g.value)||!m?m:R0(i.properties,m)}getAppearanceValueAndResolveTokens(e,i,o,c,m){const g=e.getProperty(i);if(!g)return;const x=g.evaluate(o,{},c,m),S=e.getUnevaluatedProperties()._values[i];return S.isDataDriven()||cg(S.value)||!x||typeof x!="string"?x:R0(o.properties,x)}createBucket(e){return new r_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of hv().paint.overridableProperties){if(!ym.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),o=new BA(i),c=new lg(o,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let m=null;m=i.value.kind==="constant"||i.value.kind==="source"?new Op("source",c):new wh("composite",c,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Eo(i.property,m,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,o){return!(!this.layout||i.isDataDriven()||o.isDataDriven())&&ym.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const o=e.get("text-field"),c=hv().paint.properties[i];let m=!1;const g=x=>{for(const S of x)if(c.overrides&&c.overrides.hasOverride(S))return void(m=!0)};if(o.value.kind==="constant"&&o.value.value instanceof Sa)g(o.value.value.sections);else if(o.value.kind==="source"){const x=A=>{m||(A instanceof Eu&&_o(A.value)===dh?g(A.value.sections):A instanceof ud?g(A.sections):A.eachChild(x))},S=o.value;S._styleExpression&&x(S._styleExpression.expression)}return m}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,o){return{config:new $u(this,{zoom:i,lut:o}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Yw,Kw,Jw,Qw;var M0=dn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function vm(n,e,i,o,c,m,g,x){const S=[n,e,1,i,o,1,c,m,1],A=[g,x,1],M=ne([],S),[P,k,U]=eo(A,A,M);return ue(S,S,[P,0,0,0,k,0,0,0,U])}function P0(n,e,i,o,c,m,g,x){const S=function(A,M,P,k,U,V,q,J){const ee=vm(0,0,1,0,1,1,0,1),ae=vm(A,M,P,k,U,V,q,J);return ue(ae,ae,ne([],ee))}(n,e,i,o,c,m,g,x);return[S[2]/S[8]/Lt,S[5]/S[8]/Lt]}function a_(n){return[n[0],Math.min(Math.max(n[1],-_e),_e)]}class o_ extends mn{constructor(e,i,o,c){super(),this.id=e,this.dispatcher=o,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(c),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Ye("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=sc(this.map._requestManager.transformRequest(this.url,bu.Image),(o,c)=>{this._imageRequest=null,this._loaded=!0,o?this.fire(new zt(o)):c&&(this.image=c instanceof HTMLImageElement?bs.getImageData(c):c,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Jc(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ye("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Jc||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],o=e[0][1];for(const m of e)m[1]>o&&(o=m[1]),m[1]<i&&(i=m[1]);const c=(o+i)/2;if(c>_e?this.onNorthPole=!0:c<-_e&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const m=e.map(Ge.fromLngLat);this.tileID=function(g){let x=1/0,S=1/0,A=-1/0,M=-1/0;for(const q of g)x=Math.min(x,q.x),S=Math.min(S,q.y),A=Math.max(A,q.x),M=Math.max(M,q.y);const P=Math.max(A-x,M-S),k=Math.max(0,Math.floor(-Math.log2(P))),U=Math.pow(2,k);let V=Math.floor((x+A)/2*U);return V>1&&(V-=1),new Cl(k,V,Math.floor((S+M)/2*U))}(m),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ye("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Jc||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const ee in this.tiles){const ae=this.tiles[ee];ae.state!=="loaded"&&(ae.state="loaded",ae.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=fm(new Cl(0,0,0),this.map.transform.projection),o=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ee){const ae=ee[1].x-ee[0].x,le=ee[1].y-ee[0].y,de=ee[2].x-ee[1].x,Re=ee[2].y-ee[1].y,Se=ee[3].x-ee[2].x,Pe=ee[3].y-ee[2].y,ke=ee[0].x-ee[3].x,Fe=ee[0].y-ee[3].y,rt=ae*Re-de*le,qe=de*Pe-Se*Re,ot=Se*Fe-ke*Pe,ht=ke*le-ae*Fe;return rt>0&&qe>0&&ot>0&&ht>0||rt<0&&qe<0&&ot<0&&ht<0}(o))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const c=fm(this.tileID,this.map.transform.projection),[m,g,x,S]=this.coordinates.map(ee=>{const ae=c.projection.project(ee[0],ee[1]);return E0(c,ae)._round()});this.perspectiveTransform=P0(m.x,m.y,g.x,g.y,x.x,x.y,S.x,S.y);const A=this._boundsArray=new mf;A.emplaceBack(m.x,m.y,0,0),A.emplaceBack(g.x,g.y,Lt,0),A.emplaceBack(S.x,S.y,0,Lt),A.emplaceBack(x.x,x.y,Lt,Lt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(A,M0.members),this.boundsSegments=ta.simpleSegment(0,0,4,2);const M=[],P=[a_((k=this.coordinates)[0]),a_(k[1]),a_(k[2]),a_(k[3])];var k;const[U,V,q,J]=function(ee){let ae=ee[0][0],le=ae,de=ee[0][1],Re=de;for(let Se=1;Se<ee.length;Se++)ee[Se][0]<ae?ae=ee[Se][0]:ee[Se][0]>le&&(le=ee[Se][0]),ee[Se][1]<de?de=ee[Se][1]:ee[Se][1]>Re&&(Re=ee[Se][1]);return[ae,de,le-ae,Re-de]}(P);{const ee=new mf,[ae,le,de,Re]=function(pt){let St=pt[0].x,tt=St,Qe=pt[0].y,xt=Qe;for(let wt=1;wt<pt.length;wt++)pt[wt].x<St?St=pt[wt].x:pt[wt].x>tt&&(tt=pt[wt].x),pt[wt].y<Qe?Qe=pt[wt].y:pt[wt].y>xt&&(xt=pt[wt].y);return[St,Qe,tt-St,xt-Qe]}(o),Se=pt=>[(pt.x-ae)/de,(pt.y-le)/Re],[Pe,ke,Fe,rt]=o.map(Se),qe=function(pt,St,tt,Qe,xt,wt,_t,mt){const si=vm(0,0,1,0,1,1,0,1);return ue(si,si,ne([],vm(pt,St,tt,Qe,xt,wt,_t,mt)))}(Pe[0],Pe[1],ke[0],ke[1],Fe[0],Fe[1],rt[0],rt[1]);this.elevatedGlobePerspectiveTransform=P0(Pe[0],Pe[1],ke[0],ke[1],Fe[0],Fe[1],rt[0],rt[1]);const ot=(pt,St)=>{M.push(pt.lng);const tt=Math.round((pt.lng-U)/q*Lt),Qe=Math.round((pt.lat-V)/J*Lt),xt=Se(St),wt=eo([],[xt[0],xt[1],1],qe),_t=Math.round(wt[0]/wt[2]*Lt),mt=Math.round(wt[1]/wt[2]*Lt);ee.emplaceBack(tt,Qe,_t,mt)},ht=o[3].x-o[0].x,yt=o[3].y-o[0].y,Tt=o[2].x-o[1].x,Et=o[2].y-o[1].y;for(let pt=0;pt<65;pt++){const St=pt/64,tt=[o[0].x+St*ht,o[0].y+St*yt],Qe=[o[1].x+St*Tt,o[1].y+St*Et],xt=Qe[0]-tt[0],wt=Qe[1]-tt[1];for(let _t=0;_t<65;_t++){const mt=_t/64,si={x:tt[0]+xt*mt,y:tt[1]+wt*mt};ot(i.projection.unproject(si.x,si.y),si)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(ee,M0.members)}{this.maxLongitudeTriangleSize=0;let ee=[],ae=new ar;const le=(de,Re,Se)=>{ae.emplaceBack(de,Re,Se);const Pe=M[de],ke=M[Re],Fe=M[Se],rt=Math.min(Math.min(Pe,ke),Fe),qe=Math.max(Math.max(Pe,ke),Fe)-rt;qe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=qe),ee.push(rt+qe/2)};for(let de=0;de<64;de++)for(let Re=0;Re<64;Re++){const Se=65*de+Re,Pe=Se+1,ke=Se+65,Fe=ke+1;le(Se,ke,Pe),le(Pe,ke,Fe)}[ee,ae]=function(de,Re){const Se=Array.from({length:de.length},(Fe,rt)=>rt);Se.sort((Fe,rt)=>de[Fe]-de[rt]);const Pe=[],ke=new ar;for(let Fe=0;Fe<Se.length;Fe++){const rt=Se[Fe];Pe.push(de[rt]);const qe=3*rt,ot=qe+1;ke.emplaceBack(Re.uint16[qe],Re.uint16[ot],Re.uint16[ot+1])}return[Pe,ke]}(ee,ae),this.elevatedGlobeTrianglesCenterLongitudes=ee,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ae)}this.elevatedGlobeSegments=ta.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,q/Lt,0,J/Lt,0,0,V,U,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,o=i.gl;!this._dirty||this.texture instanceof Jc||(this.texture?this.texture.update(this.image):(this.texture=new Od(i,this.image,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const o=this.elevatedGlobeTrianglesCenterLongitudes;let c=(m=e+180)+360*Math.round((o[0]-m)/360);var m;const g=new ta,x=(P,k)=>{g.segments.push({vertexOffset:0,primitiveOffset:P,vertexLength:i.segments[0].vertexLength,primitiveLength:k,sortKey:void 0,vaos:{}})},S=.51*this.maxLongitudeTriangleSize;if(Math.abs(o[0]-c)<=S){const P=bn(o,0,o.length,c+S);return P===o.length||x(P,er(o,P+1,o.length,c+360-S)-P),g}c<o[0]&&(c+=360);const A=er(o,0,o.length,c-S);if(A===o.length)return x(0,o.length),g;x(0,A-0);const M=bn(o,A+1,o.length,c+S);return M!==o.length&&x(M,o.length-M),g}}const e1=(Math.pow(256,2)-1)/16907520;class dv extends uo{constructor(e,i,o,c){super(e,{layout:Jw||(Jw=new ea({visibility:new At(We.layout_raster.visibility)})),paint:Qw||(Qw=new ea({"raster-opacity":new At(We.paint_raster["raster-opacity"]),"raster-color":new Eh(We.paint_raster["raster-color"]),"raster-color-mix":new At(We.paint_raster["raster-color-mix"]),"raster-color-range":new At(We.paint_raster["raster-color-range"]),"raster-hue-rotate":new At(We.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new At(We.paint_raster["raster-brightness-min"]),"raster-brightness-max":new At(We.paint_raster["raster-brightness-max"]),"raster-saturation":new At(We.paint_raster["raster-saturation"]),"raster-contrast":new At(We.paint_raster["raster-contrast"]),"raster-resampling":new At(We.paint_raster["raster-resampling"]),"raster-fade-duration":new At(We.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new At(We.paint_raster["raster-emissive-strength"]),"raster-array-band":new At(We.paint_raster["raster-array-band"]),"raster-elevation":new At(We.paint_raster["raster-elevation"]),"raster-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,c),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof o_&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[o,c]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(o)&&isNaN(c)||o===this._curRampRange[0]&&c===this._curRampRange[1]||(this.colorRamp=Dg({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:o,end:c}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[o,c])}}let s_,fv,pv,l_,O0;class mv extends uo{constructor(e,i,o,c){super(e,{layout:s_||(s_=new ea({visibility:new At(We["layout_raster-particle"].visibility)})),paint:fv||(fv=new ea({"raster-particle-array-band":new At(We["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new At(We["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Eh(We["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new At(We["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new At(We["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new At(We["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new At(We["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new At(We["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"})}))},i,o,c),this._updateColorRamp(),this.lastInvalidatedAt=bs.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Dg({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=bs.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class t1 extends uo{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function c_(n,e,i){const o=[0,0,1],c=Na([]);return xs(c,c,i?-cn(n)+Math.PI:cn(n)),qa(c,c,-cn(e)),jr(o,o,c),Vi(o,o)}const i1={None:0,Model:1,Symbol:2,FillExtrusion:4};class u_{constructor(e,i,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),i!=null&&i.__line__&&(this.line=i.__line__)}}function h_(n,e){const i=n.indexOf("://")===-1;try{return new URL(n,i&&e?"http://example.com":void 0),!0}catch{return!1}}class tE{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class gv{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new bg,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const i=16*e,o=this.instancedDataArray.float32;let c=Math.floor(o[i+2]);const m=1.05*(o[i+2]-c);return c/=100,[o[i]%1*1.05,o[i+1]%1*1.05,m,c]}tileCoordinatesForInstance(e){const i=16*e,o=this.instancedDataArray.float32;let c=o[i+0];return c=c>Lt?c-Lt:c,new vt(Math.trunc(c),Math.trunc(o[i+1]))}translationForInstance(e){const i=16*e,o=this.instancedDataArray.float32;return[o[i+4],o[i+5],o[i+6]]}rotationScaleForInstance(e){const i=16*e,o=this.instancedDataArray.float32;return[o[i+7],o[i+8],o[i+9],o[i+10],o[i+11],o[i+12],o[i+13],o[i+14],o[i+15]]}transformForInstance(e){const i=16*e,o=this.instancedDataArray.float32;return[o[i+7],o[i+8],o[i+9],o[i+4],o[i+10],o[i+11],o[i+12],o[i+5],o[i+13],o[i+14],o[i+15],o[i+6],0,0,0,1]}}class _v{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,o,c){}populate(e,i,o,c){this.tileToMeter=De(o);const m=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:g,id:x,index:S,sourceLayerIndex:A}of e){const M=x??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),P=Je(g,m);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),P,o))continue;const k={id:M,sourceLayerIndex:A,index:S,geometry:m?P.geometry:lt(g,o,c),properties:g.properties,type:g.type,patterns:{}},U=this.addFeature(k,k.geometry,P);U&&i.featureIndex.insert(g,k.geometry,S,A,this.index,this.instancesPerModel[U].instancedDataArray.length,Lt/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,i=this.layers[0].scope;let o=0;for(const c of this.modelUris){const m=e.getModel(c,i);if(!m)continue;const g=this.instancesPerModel[c];if(g){const x=.5*Va(m.aabb.max,m.aabb.min)*g.maxScale+g.maxXYTranslationDistance,S=Math.min(Lt,Math.max(x/this.tileToMeter,Lt/32));o=Math.max(S,o)}}return o}update(e,i,o,c){for(const m in this.instancesPerModel){const g=this.instancesPerModel[m];for(const x in e)g.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(g.features[g.idToFeaturesIndex[x]],e[x],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];for(const c of o.features){const m=this.layers[0],g=c.feature,x=this.canonical,S=m.paint.get("model-rotation").evaluate(g,{},x),A=m.paint.get("model-scale").evaluate(g,{},x),M=m.paint.get("model-translation").evaluate(g,{},x);to(c.rotation,S)&&to(c.scale,A)&&to(c.translation,M)||(this.evaluate(c,c.featureStates,o,!0),e=!0)}}return e}updateReplacement(e,i,o,c){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const m=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(My(this.activeReplacements,m))return!1;this.activeReplacements=m;let g=!1;for(const x in this.instancesPerModel){const S=this.instancesPerModel[x],A=S.instancedDataArray;for(const M of S.features){const P=M.instancedDataOffset,k=M.instancedDataCount;for(let U=0;U<k;U++){const V=16*(U+P);let q=A.float32[V+0];const J=q>Lt;q=J?q-Lt:q;const ee=Math.floor(q),ae=Math.floor(A.float32[V+1]);let le=!1;for(const de of this.activeReplacements)if(!oS(de,o,i1.Model,c)&&!(de.min.x>ee||ee>de.max.x||de.min.y>ae||ae>de.max.y)&&(le=Px(cS(ee,ae,e.canonical,de.footprintTileId.canonical),de.footprint),le))break;A.float32[V]=le?q+Lt:q,g=g||le!==J}}}return g}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length<0||o.instancedDataArray.length===0||(o.instancedDataBuffer?o.instancedDataBuffer.updateData(o.instancedDataArray):o.instancedDataBuffer=e.createVertexBuffer(o.instancedDataArray,kS.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const o=this.instancesPerModel[i];o.instancedDataArray.length!==0&&o.instancedDataBuffer&&o.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,o){const c=this.layers[0],m=c.layout.get("model-id").evaluate(o,{},this.canonical);if(!m)return Yt(`modelId is not evaluated for layer ${c.id} and it is not going to get rendered.`),m;(h_(m,!1)||this.styleDefinedModelURLs[m]!==void 0)&&(this.modelUris.includes(m)||this.modelUris.push(m)),this.instancesPerModel[m]||(this.instancesPerModel[m]=new gv);const g=this.instancesPerModel[m],x=g.instancedDataArray,S=new tE(o,x.length);for(const A of i)for(const M of A){if(M.x<0||M.x>=Lt||M.y<0||M.y>=Lt)continue;if(this.lookupDim!==0){const k=(this.lookupDim-1)/Lt,U=this.lookupDim*(M.y*k|0)+M.x*k|0;if(this.lookup){if(this.lookup[U]!==0)continue;this.lookup[U]=1}}this.instanceCount++;const P=x.length;x.resize(P+1),g.instancesEvaluatedElevation.push(0),x.float32[16*P]=M.x,x.float32[16*P+1]=M.y}return S.instancedDataCount=g.instancedDataArray.length-S.instancedDataOffset,S.instancedDataCount>0&&(e.id&&(g.idToFeaturesIndex[e.id]=g.features.length),g.features.push(S),this.evaluate(S,{},g,!1)),m}getModelUris(){return this.modelUris}evaluate(e,i,o,c){const m=this.layers[0],g=e.feature,x=this.canonical,S=e.rotation=m.paint.get("model-rotation").evaluate(g,i,x),A=e.scale=m.paint.get("model-scale").evaluate(g,i,x),M=e.translation=m.paint.get("model-translation").evaluate(g,i,x),P=Object.assign({},m.paint.get("model-color").evaluate(g,i,x));P.a=m.paint.get("model-color-mix-intensity").evaluate(g,i,x);const k=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]);const U=M[0]*M[0]+M[1]*M[1],V=U>0?Math.sqrt(U):0;o.maxScale=Math.max(Math.max(o.maxScale,A[0]),Math.max(A[1],A[2])),o.maxXYTranslationDistance=Math.max(o.maxXYTranslationDistance,V),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),js(k,S,A);const q=Math.round(100*P.a)+P.b/1.05;for(let J=0;J<e.instancedDataCount;++J){const ee=e.instancedDataOffset+J,ae=16*ee,le=o.instancedDataArray.float32;let de=0;c&&(de=le[ae+6]-o.instancesEvaluatedElevation[ee]);const Re=0|le[ae+1];le[ae]=(0|le[ae])+P.r/1.05,le[ae+1]=Re+P.g/1.05,le[ae+2]=q,le[ae+3]=1/(x.z>10?this.tileToMeter:De(x,Re)),le[ae+4]=M[0],le[ae+5]=M[1],le[ae+6]=M[2]+de,le[ae+7]=k[0],le[ae+8]=k[1],le[ae+9]=k[2],le[ae+10]=k[4],le[ae+11]=k[5],le[ae+12]=k[6],le[ae+13]=k[8],le[ae+14]=k[9],le[ae+15]=k[10],o.instancesEvaluatedElevation[ee]=M[2]}}}let yv,k0;ai(_v,"ModelBucket",{omit:["layers"]}),ai(gv,"PerModelAttributes"),ai(tE,"ModelFeature");class Ud{constructor(e,i,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=o}static create(e,i,o){const c=o||e.findDEMTileFor(i);if(!c||!c.dem)return;const m=c.dem,g=c.tileID,x=1<<i.canonical.z-g.canonical.z;return new Ud(c,m.dim/Lt/x,[(i.canonical.x/x-g.canonical.x)*m.dim,(i.canonical.y/x-g.canonical.y)*m.dim])}tileCoordToPixel(e,i){const o=i*this._scale+this._offset[1];return new vt(Math.floor(e*this._scale+this._offset[0]),Math.floor(o))}getElevationAt(e,i,o,c){const m=e*this._scale+this._offset[0],g=i*this._scale+this._offset[1],x=Math.floor(m),S=Math.floor(g),A=this._dem;return c=!!c,o?wi(wi(A.get(x,S,c),A.get(x,S+1,c),g-S),wi(A.get(x+1,S,c),A.get(x+1,S+1,c),g-S),m-x):A.get(x,S,c)}getElevationAtPixel(e,i,o){return this._dem.get(e,i,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*se(1,e)*this._dem.stride}}const vv=new Float32Array(262144),Hf=new Uint8Array(262144);function n1(n){let e=0;if(n.meshes)for(const i of n.meshes)e=Math.max(e,i.aabb.max[2]);if(n.children)for(const i of n.children)e=Math.max(e,n1(i));return e}function r1(n,e,i){if(n.meshes)for(const o of n.meshes){if(o.aabb.min[0]===1/0)continue;const c=un.applyTransform(o.aabb,n.globalMatrix);i.insert(e,c.min[0],c.min[1],c.max[0],c.max[1])}if(n.children)for(const o of n.children)r1(o,e,i)}const iE=["","wall","door","roof","window","lamp","logo"];class L0{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:n1(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new un([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new un([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const o of this.node.meshes)this.node.lightMeshIndex!==e&&(o.transformedAabb=un.applyTransformFast(o.aabb,this.node.globalMatrix),i.encapsulate(o.transformedAabb)),e++;this.aabb=i}return this.aabb}}class xv{constructor(e,i,o,c,m,g,x,S){this.id=o,this.layers=e,this.layerIds=this.layers.map(A=>A.fqid),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id),this.modelTraits|=Mf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,c&&(this.modelTraits|=Mf.HasMapboxMeshFeatures),m&&(this.modelTraits|=Mf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=g,this.worldview=S,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const A of i)this.nodesInfo.push(new L0(A)),r1(A,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,i){for(const o of this.getNodesInfo()){const c=o.node;c.footprint&&i.push({footprint:c.footprint,id:e})}}updateAppearances(e,i,o,c){}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const o=i?this.stateDependentLayers:this.layers;if(!To(e,this.states))for(const c of o)this.evaluate(c,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const o of i){const c=o.node;this.uploaded?this.updatePbrBuffer(c):eu(c,e,!0)}for(const o of i)rm(o.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const o of e.meshes)o.pbrBuffer&&(o.pbrBuffer.updateData(o.featureArray),i=!0);return i}needsReEvaluation(e,i,o){const c=e.transform.projectionOptions,m=e.style.getBrightness(),g=this.brightness!==m;if(!this.uploaded||this.dirty||c.name!==this.projection.name||d_(o.paint.get("model-color").value,g)||d_(o.paint.get("model-color-mix-intensity").value,g)||d_(o.paint.get("model-roughness").value,g)||d_(o.paint.get("model-emissive-strength").value,g)||d_(o.paint.get("model-height-based-emissive-strength-multiplier").value,g)){this.projection=c,this.brightness=m;const x=this.getNodesInfo();for(const S of x)S.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const o=this.getNodesInfo(),c=this.id.canonical;for(const m of o){const g=m.feature;m.evaluatedTranslation=i.paint.get("model-translation").evaluate(g,{},c),m.evaluatedScale=i.paint.get("model-scale").evaluate(g,{},c)}}evaluate(e,i){const o=this.getNodesInfo();for(const c of o){if(!c.node.meshes)continue;const m=c.feature,g=i&&i[m.id];if(To(g,c.state))continue;c.state=structuredClone(g);const x=c.node.meshes&&c.node.meshes[0].featureData,S=c.evaluatedColor[2],A=c.evaluatedRMEA[2],M=this.id.canonical;if(c.hasTranslucentParts=!1,x){for(let P=0;P<iE.length;P++){const k=iE[P];k.length&&(m.properties.part=k);const U=e.paint.get("model-color").evaluate(m,g,M).toPremultipliedRenderColor(null),V=e.paint.get("model-color-mix-intensity").evaluate(m,g,M);c.evaluatedColor[P]=[U.r,U.g,U.b,V],c.evaluatedRMEA[P][0]=e.paint.get("model-roughness").evaluate(m,g,M),c.evaluatedRMEA[P][2]=e.paint.get("model-emissive-strength").evaluate(m,g,M),c.evaluatedRMEA[P][3]=U.a,c.emissionHeightBasedParams[P]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(m,g,M),!c.hasTranslucentParts&&U.a<1&&(c.hasTranslucentParts=!0)}delete m.properties.part,UA(c,S!==c.evaluatedColor[2]||A!==c.evaluatedRMEA[2],this.modelTraits)}else c.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(m,g,M);c.evaluatedTranslation=e.paint.get("model-translation").evaluate(m,g,M),c.evaluatedScale=e.paint.get("model-scale").evaluate(m,g,M),this.updatePbrBuffer(c.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,o,c){const m=e.findDEMTileFor(o);if(m&&(m.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(m.dem&&m.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=m.tileID.overscaledZ;const g=Ud.create(e,o,m);if(!g)return;this.modelTraits&Mf.HasMapboxMeshFeatures&&this.updateDEM(e,g,o,c);for(const x of this.getNodesInfo()){const S=x.node;if(!S.footprint||!S.footprint.vertices||!S.footprint.vertices.length)continue;const A=S.footprint.vertices;let M=g.getElevationAt(A[0].x,A[0].y,!0,!0);for(let P=1;P<A.length;P++)M=Math.min(M,g.getElevationAt(A[P].x,A[P].y,!0,!0));S.elevation=M}}this.terrainTile=m.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,o,c){let m=i._dem._modifiedForSources[c];if(m===void 0&&(i._dem._modifiedForSources[c]=[],m=i._dem._modifiedForSources[c]),m.includes(o.canonical))return;const g=i._dem.dim;m.push(o.canonical);let x=!1;for(const S of this.getNodesInfo()){const A=S.node;if(!A.footprint||!A.footprint.grid)continue;const M=A.footprint.grid,P=i.tileCoordToPixel(M.min.x,M.min.y),k=i.tileCoordToPixel(M.max.x,M.max.y),U=Math.min(Math.min(g-k.y,P.x),Math.min(P.y,g-k.x));if(U<0)continue;const V=X(U,2,5);let q=Math.max(0,P.x-V),J=Math.max(0,P.y-V),ee=Math.min(k.x+V,g-1),ae=Math.min(k.y+V,g-1);for(let Se=J;Se<=ae;++Se)for(let Pe=q;Pe<=ee;++Pe)Hf[Se*g+Pe]=255;let le=0,de=0;for(let Se=0;Se<M.cellsY;++Se)for(let Pe=0;Pe<M.cellsX;++Pe){if(!M.cells[Se*M.cellsX+Pe])continue;const ke=i.tileCoordToPixel(M.min.x+Pe/M.xScale,M.min.y+Se/M.yScale),Fe=i.tileCoordToPixel(M.min.x+(Pe+1)/M.xScale,M.min.y+(Se+1)/M.yScale);for(let rt=ke.y;rt<=Math.min(Fe.y+1,g-1);++rt)for(let qe=ke.x;qe<=Math.min(Fe.x+1,g-1);++qe)Hf[rt*g+qe]===255&&(Hf[rt*g+qe]=0,le+=i.getElevationAtPixel(qe,rt),de++)}const Re=le/de;q=Math.max(1,P.x-V),J=Math.max(1,P.y-V),ee=Math.min(k.x+V,g-2),ae=Math.min(k.y+V,g-2),x=!0;for(let Se=J;Se<=ae;++Se)for(let Pe=q;Pe<=ee;++Pe)Hf[Se*g+Pe]===0&&(vv[Se*g+Pe]=i._dem.set(Pe,Se,Re));for(let Se=1;Se<V;++Se){q=Math.max(1,P.x-Se),J=Math.max(1,P.y-Se),ee=Math.min(k.x+Se,g-2),ae=Math.min(k.y+Se,g-2);for(let Pe=J;Pe<=ae;++Pe)for(let ke=q;ke<=ee;++ke){const Fe=Pe*g+ke;if(Hf[Fe]===255){let rt=0,qe=0,ot=-1,ht=-1;for(let yt=-1;yt<=1;++yt)for(let Tt=-1;Tt<=1;++Tt){const Et=(Pe+yt)*g+ke+Tt;if(Hf[Et]>=Se)continue;const pt=vv[Et],St=Math.abs(pt);St>qe&&(rt=pt,qe=St,ot=Tt,ht=yt)}if(qe>.1){const yt=1-(Se+.5*Math.abs(ot*ht))/V;let Tt=i._dem.get(ke,Pe)+rt*yt;const Et=i._dem.get(ke+ot,Pe+ht),pt=i._dem.get(ke-ot,Pe-ht,!0);(Tt-Et)*(Tt-pt)>0&&(Tt=(Et+pt)/2),vv[Fe]=i._dem.set(ke,Pe,Tt),Hf[Fe]=Se}}}}}x&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=bs.now())}setFilter(e){this.filter=e?uf(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Er(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)rm(i.node),Gy(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const o=i.getReplacementRegionsForTile(e.toUnwrapped());for(const c of this.getNodesInfo()){const m=c.node.footprint;c.hiddenByReplacement=!!m&&!o.find(g=>g.footprint===m)}}getHeightAtTileCoord(e,i){const o=[],c=[0,0,0],m=be([]);for(const g of this.getNodesInfo()){const x=g.node.meshes[0],S=x.transformedAabb;if(e<S.min[0]||i<S.min[1]||e>S.max[0]||i>S.max[1])continue;if(g.node.hidden===!0)return{height:1/0,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};je(m,g.node.globalMatrix),c[0]=e,c[1]=i,Bn(c,c,m);const A=(c[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*sl|0,M=Math.min(63,(c[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*sl|0)*sl+Math.min(63,A),P=x.heightmap[M];if(!(P<0&&g.node.footprint))return g.hiddenByReplacement?void 0:{height:P,maxHeight:g.feature.properties.height,hidden:!1,verticalScale:g.evaluatedScale[2]};if(g.node.footprint.grid.query(new vt(e,i),new vt(e,i),o),o.length>0)return{height:void 0,maxHeight:g.feature.properties.height,hidden:g.hiddenByReplacement,verticalScale:g.evaluatedScale[2]}}}}function d_(n,e){return n instanceof Op&&!n.isLightConstant&&e}function nE(n,e,i,o,c,m,g,x){let S=(61440&e|(61440&e)>>4)>>8,A=(3840&e|(3840&e)>>4)>>4,M=240&e|(240&e)>>4;i[3]>0&&(S=wi(S,255*i[0],i[3]),A=wi(A,255*i[1],i[3]),M=wi(M,255*i[2],i[3]));const P=S<<8|A,k=M<<8|Math.floor(255*o[3]),U=function(Se){const Pe=X(Se,0,2);return Math.min(Math.round(.5*Pe*255),255)}(o[2])<<8|15*o[0]<<4|15*o[1],V=X(c[0],0,1),q=X(c[1],0,1),J=X(c[2],0,1),ee=X(c[3],0,1);let ae,le,de,Re;if(V!==q&&g!==m&&q!==V){const Se=g-m;le=1/(Se*(q-V)),de=-(m+Se*V)/(Se*(q-V));const Pe=X(c[4],-1,1);Re=Math.pow(10,Pe),ae=255*J<<8|255*ee}else ae=65535,le=0,de=1,Re=1;if(n.emplaceBack(P,k,U,ae,le,de,Re),x){const Se=x.length;x.clear();for(let Pe=0;Pe<Se;Pe++)x.emplaceBack(P,k,U,ae,le,de,Re)}}function UA(n,e,i){const o=n.node;let c=0;const m=i&Mf.HasMeshoptCompression;for(const g of o.meshes){if(o.lights&&o.lightMeshIndex===c||!g.featureData)continue;g.featureArray=new Oh,g.featureArray.reserve(g.featureData.length);let x=e;for(const S of g.featureData){const A=m?65535&S:S>>16&65535,M=m?S>>16&65535:65535&S,P=(15&M)<8?15&M:0,k=n.evaluatedRMEA[P],U=n.evaluatedColor[P],V=n.emissionHeightBasedParams[P];let q;if(x&&P===2&&o.lights&&(q=new Oh,q.resize(10*o.lights.length)),nE(g.featureArray,A,U,k,V,g.aabb.min[2],g.aabb.max[2],q),q&&x){x=!1;const J=o.meshes[o.lightMeshIndex];J.featureArray=q,J.featureArray._trim()}}g.featureArray._trim(),c++}}ai(xv,"Tiled3dModelBucket",{omit:["layers"]}),ai(L0,"Tiled3dModelFeature");const a1=["id","tile","layer","source","sourceLayer","state"];class Xh{constructor(e,i,o,c,m){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=o,this._y=c,this.properties=e?e.properties:{},this.id=m}clone(){const e=new Xh(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of a1)this[i]!==void 0&&(e[i]=this[i]);return e}}class xm extends mn{constructor(e,i,o,c){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=i,this._modelsInfo=new Map}load(){const e=[];for(const i in this._options.models){const o=this._options.models[i],c=this._modelsInfo.get(i);if(c){const m=c.model;m.position=o.position!=null?new j(o.position[0],o.position[1]):new j(0,0),m.orientation=o.orientation!=null?o.orientation:[0,0,0],c.modelSpec=o,xm.applyModelSpecification(m,o),m.computeBoundsAndApplyParent(),this.models.push(m)}else{const m=jy(this.map._requestManager.transformRequest(o.uri,bu.Model).url).then(g=>{if(!g)return;const x=Zu(g),S=new ww(i,o.uri,o.position,o.orientation,x);xm.applyModelSpecification(S,o),S.computeBoundsAndApplyParent(),this.models.push(S),this._modelsInfo.set(i,{modelSpec:o,model:S})}).catch(g=>{this.fire(new zt(new Error(`Could not load model ${i} from ${o.uri}: ${g.message}`)))});e.push(m)}}Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new Ye("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this._loaded=!0,this.fire(new zt(new Error(`Could not load models: ${i.message}`)))})}static applyModelSpecification(e,i){i.nodeOverrides&&xm.convertNodeOverrides(e,i.nodeOverrides),i.materialOverrides&&xm.convertMaterialOverrides(e,i.materialOverrides),i.nodeOverrideNames&&(e.nodeOverrideNames=[...i.nodeOverrideNames]),i.materialOverrideNames&&(e.materialOverrideNames=[...i.materialOverrideNames]),i.featureProperties&&(e.featureProperties=i.featureProperties)}static convertNodeOverrides(e,i){if(Array.isArray(i)&&i.every(o=>typeof o=="string")){e.nodeOverrideNames=[];for(const o of i)e.nodeOverrideNames.push(o)}else Object.entries(i).forEach(([o,c])=>{const m={orientation:[0,0,0]};if(c.hasOwnProperty("orientation")){const g=c.orientation;g&&(m.orientation=g)}e.nodeOverrides.set(o,m)})}static convertMaterialOverrides(e,i){if(Array.isArray(i)&&i.every(o=>typeof o=="string")){e.materialOverrideNames=[];for(const o of i)e.materialOverrideNames.push(o)}else Object.entries(i).forEach(([o,c])=>{const m={color:new Qi(1,1,1),colorMix:0,emissionStrength:0,opacity:1},g=c["model-color"];g!==void 0&&(m.color.r=g[0],m.color.g=g[1],m.color.b=g[2]);const x=c["model-color-mix-intensity"];x!==void 0&&(m.colorMix=x);const S=c["model-emissive-strength"];S!==void 0&&(m.emissionStrength=S);const A=c["model-opacity"];A!==void 0&&(m.opacity=A),e.materialOverrides.set(o,m)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,i){}serialize(){return this._options}setProperty(e,i){return!1}reload(){const e=Bu(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const i=new Map;for(const o in e){const c=e[o];if(this._modelsInfo.has(o)){const m=this._modelsInfo.get(o);m&&m.modelSpec.uri===c.uri&&i.set(o,m)}}this._modelsInfo=i,this._options.models=e,this._loaded=!1,this.load()}}function o1(n,e,i,o){const c=1<<n.z;e.lat=ce((o/Lt+n.y)/c),e.lng=me((i/Lt+n.x)/c)}function rE(n,e,i,o){const c=n.getNodesInfo()[e];if(!c||c.hiddenByReplacement||!c.node.meshes)return;let m=Number.MAX_VALUE;const g=c.node,x=i.tile,S=o.calculatePosMatrix(x.tileID.toUnwrapped(),o.worldSize),A=c.evaluatedScale;let M=0;o.elevation&&g.elevation&&(M=g.elevation*o.elevation.exaggeration()),He(S,S,[(g.anchor?g.anchor[0]:0)*(A[0]-1),(g.anchor?g.anchor[1]:0)*(A[1]-1),M]),Xe(S,S,A);const P=i.queryGeometry,k=P.isPointQuery()?P.screenBounds:P.screenGeometry,U=function(q){const J=Be([],S,q.globalMatrix);Be(J,o.expandedFarZProjMatrix,J);for(let ee=0;ee<q.meshes.length;++ee){const ae=q.meshes[ee];if(ee===q.lightMeshIndex)continue;const le=qu(k,o,J,ae.aabb);le!=null&&(m=Math.min(le,m))}if(q.children)for(const ee of q.children)U(ee)};if(U(g),m===Number.MAX_VALUE)return;const V=new j(0,0);return o1(x.tileID.canonical,V,c.node.anchor[0],c.node.anchor[1]),{intersectionZ:m,position:V,feature:c.feature}}const aE={circle:class extends uo{constructor(n,e,i,o){super(n,{layout:Zc||(Zc=new ea({"circle-sort-key":new Wt(We.layout_circle["circle-sort-key"]),"circle-elevation-reference":new At(We.layout_circle["circle-elevation-reference"]),visibility:new At(We.layout_circle.visibility)})),paint:Xc||(Xc=new ea({"circle-radius":new Wt(We.paint_circle["circle-radius"]),"circle-color":new Wt(We.paint_circle["circle-color"]),"circle-blur":new Wt(We.paint_circle["circle-blur"]),"circle-opacity":new Wt(We.paint_circle["circle-opacity"]),"circle-translate":new At(We.paint_circle["circle-translate"]),"circle-translate-anchor":new At(We.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new At(We.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new At(We.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wt(We.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wt(We.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wt(We.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new At(We.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}createBucket(n){return new $r(n)}queryRadius(n){const e=n;return Ro("circle-radius",this,e)+Ro("circle-stroke-width",this,e)+ia(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,o,c,m,g,x){const S=Sf(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,n.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return VT(n,o,m,g,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",S,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,i){const o=UT(this);return{config:new $u(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}is3D(n){return!n&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends uo{createBucket(n){return new Ig(n)}constructor(n,e,i,o){super(n,{layout:Ex||(Ex=new ea({visibility:new At(We.layout_heatmap.visibility)})),paint:GT||(GT=new ea({"heatmap-radius":new Wt(We.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wt(We.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new At(We.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Eh(We.paint_heatmap["heatmap-color"]),"heatmap-opacity":new At(We.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Dg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(n){return Ro("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,o,c,m,g,x){const S=this.paint.get("heatmap-radius").evaluate(e,i);return VT(n,o,m,g,x,!0,!0,new vt(0,0),S)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,i){return n==="heatmap"?{config:new $u(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends uo{constructor(n,e,i,o){super(n,{layout:HT||(HT=new ea({visibility:new At(We.layout_hillshade.visibility)})),paint:Qb||(Qb=new ea({"hillshade-illumination-direction":new At(We.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new At(We.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new At(We.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new At(We.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new At(We.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new At(We.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new At(We.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}},fill:class extends uo{constructor(n,e,i,o){super(n,{layout:ow||(ow=new ea({"fill-sort-key":new Wt(We.layout_fill["fill-sort-key"]),visibility:new At(We.layout_fill.visibility),"fill-elevation-reference":new At(We.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Wt(We.layout_fill["fill-construct-bridge-guard-rail"])})),paint:nS||(nS=new ea({"fill-antialias":new At(We.paint_fill["fill-antialias"]),"fill-opacity":new Wt(We.paint_fill["fill-opacity"]),"fill-color":new Wt(We.paint_fill["fill-color"]),"fill-outline-color":new Wt(We.paint_fill["fill-outline-color"]),"fill-translate":new At(We.paint_fill["fill-translate"]),"fill-translate-anchor":new At(We.paint_fill["fill-translate-anchor"]),"fill-pattern":new Wt(We.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new At(We.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new At(We.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Wt(We.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Wt(We.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Wt(We.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(n,e,i){return{config:new $u(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new kg(n)}queryRadius(){return ia(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,o,c,m){return!n.queryGeometry.isAboveHorizon&&pa(El(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,n.pixelToTileUnitsFactor),o)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends uo{constructor(n,e,i,o){super(n,{layout:vS||(vS=new ea({visibility:new At(We["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new At(We["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:xS||(xS=new ea({"fill-extrusion-opacity":new At(We["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wt(We["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new At(We["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new At(We["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Wt(We["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new At(We["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Wt(We["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wt(We["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new At(We["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new At(We["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new At(We["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new At(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new At(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new At(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new At(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new At(We["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new At(We["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new At(We["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Wt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Wt(We["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new At(We["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new At(We["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new At(We["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new At(We["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Wt(We["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Wt(We["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new At(We["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new Ng(n)}queryRadius(){return ia(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,i,o,c,m,g,x,S){const A=Sf(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,n.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(e,i),P=this.paint.get("fill-extrusion-base").evaluate(e,i),k=[0,0],U=x&&m.elevation,V=m.elevation?m.elevation.exaggeration():1,q=n.tile.getBucket(this);if(U&&q instanceof Ng){const de=q.centroidVertexArray,Re=S+1;Re<de.length&&(k[0]=de.geta_centroid_pos0(Re),k[1]=de.geta_centroid_pos1(Re))}if(k[0]===0&&k[1]===1)return!1;m.projection.name==="globe"&&(o=yS([o],[new vt(0,0),new vt(Lt,Lt)],n.tileID.canonical).map(de=>de.polygon).flat());const J=U?x:null,[ee,ae]=CS(m,o,P,M,A,g,J,k,V,m.center.lat,n.tileID.canonical),le=n.queryGeometry;return ES(ee,ae,le.isPointQuery()?le.screenBounds:le.screenGeometry)}},building:class extends uo{constructor(n,e,i,o){super(n,{layout:Cw||(Cw=new ea({visibility:new At(We.layout_building.visibility),"building-facade":new Wt(We.layout_building["building-facade"]),"building-facade-floors":new Wt(We.layout_building["building-facade-floors"]),"building-facade-unit-width":new Wt(We.layout_building["building-facade-unit-width"]),"building-facade-window":new Wt(We.layout_building["building-facade-window"]),"building-roof-shape":new Wt(We.layout_building["building-roof-shape"]),"building-height":new Wt(We.layout_building["building-height"]),"building-base":new Wt(We.layout_building["building-base"]),"building-flood-light-wall-radius":new Wt(We.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Wt(We.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Wt(We.layout_building["building-flip-roof-orientation"])})),paint:t0||(t0=new ea({"building-opacity":new At(We.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new At(We.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new At(We.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new At(We.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new At(We.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new At(We.paint_building["building-vertical-scale"]),"building-cast-shadows":new At(We.paint_building["building-cast-shadows"]),"building-color":new Wt(We.paint_building["building-color"]),"building-emissive-strength":new Wt(We.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new At(We.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new At(We.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new At(We.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new At(We.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new At(We.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new BS(n)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(n){return!0}queryRadius(n){return 0}queryIntersectsFeature(n,e,i,o,c,m,g,x,S){let A=this.layout.get("building-height").evaluate(e,i);const M=this.layout.get("building-base").evaluate(e,i),P=n.tile.getBucket(this).getFootprint(e);if(P){if(P.hiddenFlags!==0)return!1;A=P.height}const[k,U]=CS(m,o,M,A,new vt(0,0),g,null,[0,0],1,m.center.lat,n.tileID.canonical),V=n.queryGeometry;return ES(k,U,V.isPointQuery()?V.screenBounds:V.screenGeometry)}},line:class extends uo{constructor(n,e,i,o){const c=a0();super(n,c,e,i,o),c.layout&&(this.layout=new fc(c.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Nc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if($y)return $y;const i=a0();return $y=new Ow(i.paint.properties["line-width"].specification),$y.useIntegerZoom=!0,$y})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Rw(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,i){const o=Mw(this);return{config:new $u(this,{zoom:e,lut:i}),defines:o,overrideFog:!1}}queryRadius(n){const e=n,i=GS(Ro("line-width",this,e),Ro("line-gap-width",this,e)),o=Ro("line-offset",this,e);return i/2+Math.abs(o)+ia(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,o,c,m){if(n.queryGeometry.isAboveHorizon)return!1;const g=El(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,n.pixelToTileUnitsFactor),x=n.pixelToTileUnitsFactor/2*GS(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),S=this.paint.get("line-offset").evaluate(e,i);return S&&(o=function(A,M){const P=[],k=new vt(0,0);for(let U=0;U<A.length;U++){const V=A[U],q=[];for(let J=0;J<V.length;J++){const ee=V[J],ae=V[J+1],le=J===0?k:ee.sub(V[J-1])._unit()._perp(),de=J===V.length-1?k:ae.sub(ee)._unit()._perp(),Re=le._add(de)._unit();Re._mult(1/(Re.x*de.x+Re.y*de.y)),q.push(Re._mult(M)._add(ee))}P.push(q)}return P}(o,S*n.pixelToTileUnitsFactor)),function(A,M,P){for(let k=0;k<M.length;k++){const U=M[k];if(A.length>=3){for(let V=0;V<U.length;V++)if(Ao(A,U[V]))return!0}if(Cs(A,U,P))return!0}return!1}(g,o,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:ym,background:class extends uo{constructor(n,e,i,o){super(n,{layout:Yw||(Yw=new ea({visibility:new At(We.layout_background.visibility)})),paint:Kw||(Kw=new ea({"background-pitch-alignment":new At(We.paint_background["background-pitch-alignment"]),"background-color":new At(We.paint_background["background-color"]),"background-pattern":new At(We.paint_background["background-pattern"]),"background-opacity":new At(We.paint_background["background-opacity"]),"background-emissive-strength":new At(We.paint_background["background-emissive-strength"]),"background-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:dv,"raster-particle":mv,sky:class extends uo{constructor(n,e,i,o){super(n,{layout:pv||(pv=new ea({visibility:new At(We.layout_sky.visibility)})),paint:l_||(l_=new ea({"sky-type":new At(We.paint_sky["sky-type"]),"sky-atmosphere-sun":new At(We.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new At(We.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new At(We.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new At(We.paint_sky["sky-gradient-radius"]),"sky-gradient":new Eh(We.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new At(We.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new At(We.paint_sky["sky-atmosphere-color"]),"sky-opacity":new At(We.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Dg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),c=!o,m=n.style.light,g=m.properties.get("position");return c&&m.properties.get("anchor")==="viewport"&&Yt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?c_(g.azimuthal,90-g.polar,e):c_(o[0],90-o[1],e)}const i=this.paint.get("sky-gradient-center");return c_(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends uo{constructor(n,e,i,o){super(n,{paint:O0||(O0=new ea({}))},e,null)}},model:class extends uo{constructor(n,e,i,o){super(n,{layout:yv||(yv=new ea({visibility:new At(We.layout_model.visibility),"model-id":new Wt(We.layout_model["model-id"])})),paint:k0||(k0=new ea({"model-opacity":new Wt(We.paint_model["model-opacity"]),"model-rotation":new Wt(We.paint_model["model-rotation"]),"model-scale":new Wt(We.paint_model["model-scale"]),"model-translation":new Wt(We.paint_model["model-translation"]),"model-color":new Wt(We.paint_model["model-color"]),"model-color-mix-intensity":new Wt(We.paint_model["model-color-mix-intensity"]),"model-type":new At(We.paint_model["model-type"]),"model-cast-shadows":new At(We.paint_model["model-cast-shadows"]),"model-receive-shadows":new At(We.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new At(We.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Wt(We.paint_model["model-emissive-strength"]),"model-roughness":new Wt(We.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Wt(We.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new At(We.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new At(We.paint_model["model-front-cutoff"]),"model-elevation-reference":new At(We.paint_model["model-elevation-reference"]),"model-color-use-theme":new Wt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,o),this.layer=n,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new _v(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof xv?Lt-1:0}queryRenderedFeatures(n,e,i){const o=e.getSource();if(!(o&&o instanceof xm))return{};const c=o,m={};m[this.id]=[];const g=m[this.id];let x=0;for(const S of c.models){const A=e.getFeatureState(this.sourceLayer,S.id),M={type:"Unknown",id:S.id,properties:S.featureProperties},P=this.paint.get("model-rotation").evaluate(M,A),k=this.paint.get("model-scale").evaluate(M,A),U=this.paint.get("model-translation").evaluate(M,A),V=this.paint.get("model-elevation-reference");let q=[];kd(q,S,i,S.position,P,k,U,V==="ground",V==="ground",!1),i.projection.name==="globe"&&(q=ol(q,i));const J=Be([],i.projMatrix,q),ee=qu(n.isPointQuery()?n.screenBounds:n.screenGeometry,i,J,S.aabb);if(ee!=null){const ae=new Xh(void 0,0,0,0,S.id);ae.layer=this.layer,ae.properties=structuredClone(S.featureProperties),ae.properties.layer=this.id,ae.properties.uri=S.uri,ae.properties.orientation=S.orientation,ae.sourceLayer=this.sourceLayer,ae.geometry={type:"Point",coordinates:[S.position.lng,S.position.lat]},ae.state=A,ae.source=this.source,g.push({featureIndex:x,feature:ae,intersectionZ:ee})}++x}return m}queryIntersectsFeature(n,e,i,o,c,m){if(!this.modelManager)return!1;const g=this.modelManager,x=n.tile.getBucket(this);if(!(x&&x instanceof _v))return!1;for(const S in x.instancesPerModel){const A=x.instancesPerModel[S],M=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(A.idToFeaturesIndex.hasOwnProperty(M)){const P=A.features[A.idToFeaturesIndex[M]],k=g.getModel(S,this.scope);if(!k)return!1;let U=[];const V=new j(0,0),q=x.canonical;let J=Number.MAX_VALUE;for(let ee=0;ee<P.instancedDataCount;++ee){const ae=16*(P.instancedDataOffset+ee),le=A.instancedDataArray.float32,de=[le[ae+4],le[ae+5],le[ae+6]];o1(q,V,Math.floor(le[ae]),Math.floor(le[ae+1])),kd(U,k,m,V,P.rotation,P.scale,de,!1,!1,!1),m.projection.name==="globe"&&(U=ol(U,m));const Re=Be([],m.projMatrix,U),Se=n.queryGeometry,Pe=qu(Se.isPointQuery()?Se.screenBounds:Se.screenGeometry,m,Re,k.aabb);Pe!=null&&(J=Math.min(Pe,J))}return J!==Number.MAX_VALUE&&J}}return!1}_handleOverridablePaintPropertyUpdate(n,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof wh}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends uo{constructor(n,e,i,o){super(n,{layout:Dy||(Dy=new ea({"clip-layer-types":new At(We.layout_clip["clip-layer-types"]),"clip-layer-scope":new At(We.layout_clip["clip-layer-scope"])})),paint:rS||(rS=new ea({}))},e,i,o)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new aS(n)}is3D(n){return!0}}},z0=new Qi(0,0,0),F0={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},f_={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},bv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},oE={PAINT_ORDER_FILL_AND_STROKE:1},p_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},s1={MASK_TYPE_LUMINANCE:1};function Yh(n,e,i){n===1&&e.icons.push(function(o,c){return function(m){if(m.usvg_tree.height||(m.usvg_tree.height=m.usvg_tree.width),!m.metadata)return m;const{metadata:g}=m;if(g.content_area){const{content_area:x}=g;x.left==null&&(x.left=0),x.top==null&&(x.top=x.left),x.width==null&&(x.width=m.usvg_tree.width),x.height==null&&(x.height=x.width)}if(g.text_placeholder){const{text_placeholder:x}=g;x.top==null&&(x.top=x.left),x.height==null&&(x.height=x.width)}return g.stretch_x&&g.stretch_x.length&&cu(g,"x"),g.stretch_y&&g.stretch_y.length&&cu(g,"y"),m}(o.readFields(N0,{name:void 0},c))}(i,i.readVarint()+i.pos))}function cu(n,e){const i=[],o=n[`stretch_${e}`];let c=null;for(let m=0;m<o.length;m++)c===null?c=i.length===0?o[0]:i[i.length-1][1]+o[m]:(i.push([c,c+o[m]]),c=null);n[`stretch_${e}_areas`]=i}function N0(n,e,i){n===1?e.name=i.readString():n===2?e.metadata=function(o,c){return o.readFields(l1,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},c)}(i,i.readVarint()+i.pos):n===3&&(e.usvg_tree=function(o,c){return o.readFields(B0,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},c)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function l1(n,e,i){n===1?e.stretch_x=i.readPackedVarint():n===2?e.stretch_y=i.readPackedVarint():n===3?e.content_area=or(i,i.readVarint()+i.pos):n===4?e.variables.push(function(o,c){return o.readFields(sE,{name:void 0},c)}(i,i.readVarint()+i.pos)):n===5&&(e.text_placeholder=or(i,i.readVarint()+i.pos))}function or(n,e){return n.readFields($f,{},e)}function $f(n,e,i){n===1?e.left=i.readVarint():n===2?e.width=i.readVarint():n===3?e.top=i.readVarint():n===4&&(e.height=i.readVarint())}function sE(n,e,i){n===1?e.name=i.readString():n===2&&(e.rgb_color=V0(i.readVarint()),e.value="rgb_color")}function B0(n,e,i){n===1?e.width=e.height=i.readVarint():n===2?e.height=i.readVarint():n===3?e.children.push(Wf(i,i.readVarint()+i.pos)):n===4?e.linear_gradients.push(function(o,c){return o.readFields(uE,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},c)}(i,i.readVarint()+i.pos)):n===5?e.radial_gradients.push(function(o,c){return o.readFields(G0,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},c)}(i,i.readVarint()+i.pos)):n===7?e.clip_paths.push(function(o,c){return o.readFields(Kh,{children:[]},c)}(i,i.readVarint()+i.pos)):n===8&&e.masks.push(function(o,c){const m=o.readFields(u1,{left:0,width:20,mask_type:s1.MASK_TYPE_LUMINANCE,children:[]},c);return m.height==null&&(m.height=m.width),m.top==null&&(m.top=m.left),m}(i,i.readVarint()+i.pos))}function Wf(n,e){return n.readFields(U0,{},e)}function U0(n,e,i){n===1?(e.group=function(o,c){return o.readFields(c1,{opacity:255,children:[]},c)}(i,i.readVarint()+i.pos),e.node="group"):n===2&&(e.path=function(o,c){return o.readFields(VA,{paint_order:1,commands:[],step:1,diffs:[],rule:F0.PATH_RULE_NON_ZERO},c)}(i,i.readVarint()+i.pos),e.node="path")}function c1(n,e,i){n===1?e.transform=bm(i,i.readVarint()+i.pos):n===2?e.opacity=i.readVarint():n===5?e.clip_path_idx=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(Wf(i,i.readVarint()+i.pos))}function bm(n,e){return n.readFields(lE,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function lE(n,e,i){n===1?e.sx=i.readFloat():n===2?e.ky=i.readFloat():n===3?e.kx=i.readFloat():n===4?e.sy=i.readFloat():n===5?e.tx=i.readFloat():n===6&&(e.ty=i.readFloat())}function VA(n,e,i){n===1?e.fill=function(o,c){return o.readFields(jA,{rgb_color:z0,paint:"rgb_color",opacity:255},c)}(i,i.readVarint()+i.pos):n===2?e.stroke=function(o,c){return o.readFields(cE,{rgb_color:z0,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},c)}(i,i.readVarint()+i.pos):n===3?e.paint_order=i.readVarint():n===5?i.readPackedVarint(e.commands):n===6?e.step=i.readFloat():n===7?i.readPackedSVarint(e.diffs):n===8&&(e.rule=i.readVarint())}function jA(n,e,i){n===1?(e.rgb_color=V0(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=i.readVarint())}function V0(n){return new Qi((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function cE(n,e,i){n===1?(e.rgb_color=V0(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5?i.readPackedFloat(e.dasharray):n===6?e.dashoffset=i.readFloat():n===7?e.miterlimit=i.readFloat():n===8?e.opacity=i.readVarint():n===9?e.width=i.readFloat():n===10?e.linecap=i.readVarint():n===11&&(e.linejoin=i.readVarint())}function uE(n,e,i){n===1?e.transform=bm(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(j0(i,i.readVarint()+i.pos)):n===4?e.x1=i.readFloat():n===5?e.y1=i.readFloat():n===6?e.x2=i.readFloat():n===7&&(e.y2=i.readFloat())}function j0(n,e){return n.readFields(hE,{offset:0,opacity:255,rgb_color:z0},e)}function hE(n,e,i){n===1?e.offset=i.readFloat():n===2?e.opacity=i.readVarint():n===3&&(e.rgb_color=V0(i.readVarint()))}function G0(n,e,i){n===1?e.transform=bm(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(j0(i,i.readVarint()+i.pos)):n===4?e.cx=i.readFloat():n===5?e.cy=i.readFloat():n===6?e.r=i.readFloat():n===7?e.fx=i.readFloat():n===8?e.fy=i.readFloat():n===9&&(e.fr=i.readFloat())}function Kh(n,e,i){n===1?e.transform=bm(i,i.readVarint()+i.pos):n===2?e.clip_path_idx=i.readVarint():n===3&&e.children.push(Wf(i,i.readVarint()+i.pos))}function u1(n,e,i){n===1?e.left=e.top=i.readFloat():n===2?e.width=e.height=i.readFloat():n===3?e.top=i.readFloat():n===4?e.height=i.readFloat():n===5?e.mask_type=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(Wf(i,i.readVarint()+i.pos))}class Jh{static calculate(e={},i=[]){const o=new Map,c=new Map;if(Object.keys(e).length===0)return o;i.forEach(m=>{c.set(m.name,m.rgb_color||new Qi(0,0,0))});for(const[m,g]of Object.entries(e))c.has(m)?o.set(c.get(m).toString(),g):console.warn(`Ignoring unknown image variable "${m}"`);return o}}function qf(n,e=255,i){const o=e/255,c=n.toString(),m=i.has(c)?i.get(c).clone():n.clone();return m.a*=o,m.toString()}function wm(n,e){if(!Ko()){const i=document.createElement("canvas");return i.width=n,i.height=e,i}return new OffscreenCanvas(n,e)}function nh(n,e){const i=Jh.calculate(e.params,n.metadata?n.metadata.variables:[]),o=n.usvg_tree,c=o.width,m=o.height,g=e.transform?e.transform:new DOMMatrix,x=Math.max(1,Math.round(c*g.a)),S=Math.max(1,Math.round(m*g.d)),A=new DOMMatrix([x/c,0,0,S/m,0,0]),M=wm(x,S).getContext("2d");return wv(M,A,o,o,i),M.getImageData(0,0,x,S)}function wv(n,e,i,o,c){for(const m of o.children)H0(n,e,i,m,c)}function H0(n,e,i,o,c){o.group?(n.save(),function(m,g,x,S,A){const M=S.mask_idx!=null?x.masks[S.mask_idx]:null,P=S.clip_path_idx!=null?x.clip_paths[S.clip_path_idx]:null;if(S.transform&&(g=Zf(S.transform).preMultiplySelf(g)),!function(V,q,J){return V.opacity!==255||q||J}(S,P!=null,M!=null))return void wv(m,g,x,S,A);const k=wm(m.canvas.width,m.canvas.height),U=k.getContext("2d");wv(U,g,x,S,A),P&&X0(U,g,x,P),M&&Y0(U,g,x,M,A),m.globalAlpha=S.opacity/255,m.drawImage(k,0,0)}(n,e,i,o.group,c),n.restore()):o.path&&(n.save(),function(m,g,x,S,A){m.setTransform(g),S.paint_order===oE.PAINT_ORDER_FILL_AND_STROKE?($0(m,x,S,A),q0(m,x,S,A)):(q0(m,x,S,A),$0(m,x,S,A))}(n,e,i,o.path,c),n.restore())}function $0(n,e,i,o){const c=i.fill;if(!c)return;const m=c.opacity/255;switch(n.save(),n.beginPath(),m_(i,n),c.paint){case"rgb_color":n.fillStyle=qf(c.rgb_color,c.opacity,o);break;case"linear_gradient_idx":{const g=e.linear_gradients[c.linear_gradient_idx];g.transform&&n.setTransform(Zf(g.transform).preMultiplySelf(n.getTransform())),n.fillStyle=Z0(n,g,m,o);break}case"radial_gradient_idx":{const g=e.radial_gradients[c.radial_gradient_idx];g.transform&&n.setTransform(Zf(g.transform).preMultiplySelf(n.getTransform())),n.fillStyle=h1(n,g,m,o)}}n.fill(W0(i)),n.restore()}function W0(n){return n.rule===F0.PATH_RULE_NON_ZERO?"nonzero":n.rule===F0.PATH_RULE_EVEN_ODD?"evenodd":void 0}function q0(n,e,i,o){const c=i.stroke;if(!c)return;const m=d1(i);n.lineWidth=c.width,n.miterLimit=c.miterlimit,n.setLineDash(c.dasharray),n.lineDashOffset=c.dashoffset;const g=c.opacity/255;switch(c.paint){case"rgb_color":n.strokeStyle=qf(c.rgb_color,c.opacity,o);break;case"linear_gradient_idx":n.strokeStyle=Z0(n,e.linear_gradients[c.linear_gradient_idx],g,o,!0);break;case"radial_gradient_idx":n.strokeStyle=h1(n,e.radial_gradients[c.radial_gradient_idx],g,o,!0)}switch(c.linejoin){case bv.LINE_JOIN_MITER_CLIP:case bv.LINE_JOIN_MITER:n.lineJoin="miter";break;case bv.LINE_JOIN_ROUND:n.lineJoin="round";break;case bv.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(c.linecap){case f_.LINE_CAP_BUTT:n.lineCap="butt";break;case f_.LINE_CAP_ROUND:n.lineCap="round";break;case f_.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(m)}function Z0(n,e,i,o,c=!1){if(e.stops.length===1){const k=e.stops[0];return qf(k.rgb_color,k.opacity*i,o)}const{x1:m,y1:g,x2:x,y2:S}=e;let A=new DOMPoint(m,g),M=new DOMPoint(x,S);if(c){const k=Zf(e.transform);A=k.transformPoint(A),M=k.transformPoint(M)}const P=n.createLinearGradient(A.x,A.y,M.x,M.y);for(const k of e.stops)P.addColorStop(k.offset,qf(k.rgb_color,k.opacity*i,o));return P}function h1(n,e,i,o,c=!1){if(e.stops.length===1){const ee=e.stops[0];return qf(ee.rgb_color,ee.opacity*i,o)}const m=Zf(e.transform),{fx:g,fy:x,fr:S,cx:A,cy:M,r:P}=e;let k=new DOMPoint(g,x),U=new DOMPoint(A,M),V=S,q=P;if(c){k=m.transformPoint(k),U=m.transformPoint(U);const ee=(m.a+m.d)/2;V=S*ee,q=e.r*ee}const J=n.createRadialGradient(k.x,k.y,V,U.x,U.y,q);for(const ee of e.stops)J.addColorStop(ee.offset,qf(ee.rgb_color,ee.opacity*i,o));return J}function Tv(n,e,i,o){const c=o.transform?Zf(o.transform).preMultiplySelf(e):e,m=wm(n.canvas.width,n.canvas.height),g=m.getContext("2d");for(const S of o.children)if(S.group)Tv(g,c,i,S.group);else if(S.path){const A=S.path,M=new Path2D;M.addPath(d1(A),c),g.fill(M,W0(A))}const x=o.clip_path_idx!=null?i.clip_paths[o.clip_path_idx]:null;x&&X0(g,c,i,x),n.globalCompositeOperation="source-over",n.drawImage(m,0,0)}function X0(n,e,i,o){const c=wm(n.canvas.width,n.canvas.height);Tv(c.getContext("2d"),e,i,o),n.globalCompositeOperation="destination-in",n.drawImage(c,0,0)}function Y0(n,e,i,o,c){if(o.children.length===0)return;const m=o.mask_idx!=null?i.masks[o.mask_idx]:null;m&&Y0(n,e,i,m,c);const g=n.canvas.width,x=n.canvas.height,S=wm(g,x),A=S.getContext("2d"),M=o.width,P=o.height,k=o.left,U=o.top,V=new Path2D,q=new Path2D;q.rect(k,U,M,P),V.addPath(q,e),A.clip(V);for(const ae of o.children)H0(A,e,i,ae,c);const J=A.getImageData(0,0,g,x),ee=J.data;if(o.mask_type===s1.MASK_TYPE_LUMINANCE)for(let ae=0;ae<ee.length;ae+=4)ee[ae+3]=ee[ae+3]/255*(.2126*ee[ae]+.7152*ee[ae+1]+.0722*ee[ae+2]);A.putImageData(J,0,0),n.globalCompositeOperation="destination-in",n.drawImage(S,0,0)}function Zf(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function m_(n,e){const i=n.step;let o=n.diffs[0]*i,c=n.diffs[1]*i;e.moveTo(o,c);for(let m=0,g=2;m<n.commands.length;m++)switch(n.commands[m]){case p_.PATH_COMMAND_MOVE:o+=n.diffs[g++]*i,c+=n.diffs[g++]*i,e.moveTo(o,c);break;case p_.PATH_COMMAND_LINE:o+=n.diffs[g++]*i,c+=n.diffs[g++]*i,e.lineTo(o,c);break;case p_.PATH_COMMAND_QUAD:{const x=o+n.diffs[g++]*i,S=c+n.diffs[g++]*i;o=x+n.diffs[g++]*i,c=S+n.diffs[g++]*i,e.quadraticCurveTo(x,S,o,c);break}case p_.PATH_COMMAND_CUBIC:{const x=o+n.diffs[g++]*i,S=c+n.diffs[g++]*i,A=x+n.diffs[g++]*i,M=S+n.diffs[g++]*i;o=A+n.diffs[g++]*i,c=M+n.diffs[g++]*i,e.bezierCurveTo(x,S,A,M,o,c);break}case p_.PATH_COMMAND_CLOSE:e.closePath()}return e}function d1(n){return m_(n,new Path2D)}class g_{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}ai(g_,"LRUCache");class Sv{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Xo(e,e.data)}getFromCache(e,i,o){return this.cacheMap.has(o)||this.cacheMap.set(o,new g_(150)),this.cacheMap.get(o).get(Bu(e.toString(),i))}setInCache(e,i,o,c){this.cacheDependenciesMap.has(c)||this.cacheDependenciesMap.set(c,new Map),this.cacheMap.has(c)||this.cacheMap.set(c,new g_(150));const m=this.cacheDependenciesMap.get(c),g=Bu(e.id.toString(),o);m.get(g)||m.set(g,new Set);const x=this.cacheMap.get(c),S=e.toString();m.get(g).add(S),x.put(Bu(e.toString(),o),i)}removeImagesFromCacheByIds(e,i,o=0){if(!this.cacheMap.has(o)||!this.cacheDependenciesMap.has(o))return;const c=this.cacheMap.get(o),m=this.cacheDependenciesMap.get(o);for(const g of e){const x=Bu(g.toString(),i);if(m.has(x)){for(const S of m.get(x))c.delete(S);m.delete(x)}}}rasterize(e,i,o,c,m=nh){const g=this.getFromCache(e,o,c);if(g)return g.clone();const x=m(i.icon,e.options),S=Sv._getImage(x);return this.setInCache(e,S,o,c),S.clone()}}class f1{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const o=this.toIdx(e,i);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function dE(n,e,i,o){let c=0,m=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(o[g])<1e-15){if(i[g]<n[g]||i[g]>e[g])return null}else{const x=1/o[g];let S=(n[g]-i[g])*x,A=(e[g]-i[g])*x;if(S>A){const M=S;S=A,A=M}if(S>c&&(c=S),A<m&&(m=A),c>m)return null}return c}function p1(n,e,i,o,c,m,g,x,S,A,M){const P=o-n,k=c-e,U=m-i,V=g-n,q=x-e,J=S-i,ee=M[1]*J-M[2]*q,ae=M[2]*V-M[0]*J,le=M[0]*q-M[1]*V,de=P*ee+k*ae+U*le;if(Math.abs(de)<1e-15)return null;const Re=1/de,Se=A[0]-n,Pe=A[1]-e,ke=A[2]-i,Fe=(Se*ee+Pe*ae+ke*le)*Re;if(Fe<0||Fe>1)return null;const rt=Pe*U-ke*k,qe=ke*P-Se*U,ot=Se*k-Pe*P,ht=(M[0]*rt+M[1]*qe+M[2]*ot)*Re;return ht<0||Fe+ht>1?null:(V*rt+q*qe+J*ot)*Re}function m1(n,e,i){return(n-e)/(i-e)}function fE(n,e,i,o,c,m,g,x,S){const A=1<<i,M=m-o,P=g-c,k=(n+1)/A*M+o,U=(e+0)/A*P+c,V=(e+1)/A*P+c;x[0]=(n+0)/A*M+o,x[1]=U,S[0]=k,S[1]=V}class g1{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(m){const g=Math.ceil(Math.log2(m.dim/8)),x=[];let S=Math.ceil(Math.pow(2,g));const A=1/S,M=(U,V,q,J,ee)=>{const ae=J?1:0,le=(U+1)*q-ae,de=V*q,Re=(V+1)*q-ae;ee[0]=U*q,ee[1]=de,ee[2]=le,ee[3]=Re};let P=new f1(S);const k=[];for(let U=0;U<S*S;U++){M(U%S,Math.floor(U/S),A,!1,k);const V=Xf(k[0],k[1],m),q=Xf(k[2],k[1],m),J=Xf(k[2],k[3],m),ee=Xf(k[0],k[3],m);P.minimums.push(Math.min(V,q,J,ee)),P.maximums.push(Math.max(V,q,J,ee)),P.leaves.push(1)}for(x.push(P),S/=2;S>=1;S/=2){const U=x[x.length-1];P=new f1(S);for(let V=0;V<S*S;V++){M(V%S,Math.floor(V/S),2,!0,k);const q=U.getElevation(k[0],k[1]),J=U.getElevation(k[2],k[1]),ee=U.getElevation(k[2],k[3]),ae=U.getElevation(k[0],k[3]),le=U.isLeaf(k[0],k[1]),de=U.isLeaf(k[2],k[1]),Re=U.isLeaf(k[2],k[3]),Se=U.isLeaf(k[0],k[3]),Pe=Math.min(q.min,J.min,ee.min,ae.min),ke=Math.max(q.max,J.max,ee.max,ae.max),Fe=le&&de&&Re&&Se;P.maximums.push(ke),P.minimums.push(Pe),P.leaves.push(ke-Pe<=5&&Fe?1:0)}x.push(P)}return x}(this.dem),o=i.length-1,c=i[o];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(i,0,0,o,0)}raycastRoot(e,i,o,c,m,g,x=1){return dE([e,i,-100],[o,c,this.maximums[0]*x],m,g)}raycast(e,i,o,c,m,g,x=1){if(!this.nodeCount)return null;const S=this.raycastRoot(e,i,o,c,m,g,x);if(S==null)return null;const A=[],M=[],P=[],k=[],U=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;U.length>0;){const{idx:V,t:q,nodex:J,nodey:ee,depth:ae}=U.pop();if(this.leaves[V]){fE(J,ee,ae,e,i,o,c,P,k);const de=1<<ae,Re=(J+0)/de,Se=(J+1)/de,Pe=(ee+0)/de,ke=(ee+1)/de,Fe=Xf(Re,Pe,this.dem)*x,rt=Xf(Se,Pe,this.dem)*x,qe=Xf(Se,ke,this.dem)*x,ot=Xf(Re,ke,this.dem)*x,ht=p1(P[0],P[1],Fe,k[0],P[1],rt,k[0],k[1],qe,m,g),yt=p1(k[0],k[1],qe,P[0],k[1],ot,P[0],P[1],Fe,m,g),Tt=Math.min(ht!==null?ht:Number.MAX_VALUE,yt!==null?yt:Number.MAX_VALUE);if(Tt!==Number.MAX_VALUE)return Tt;{const Et=mr([],m,g,q);if(K0(Fe,rt,ot,qe,m1(Et[0],P[0],k[0]),m1(Et[1],P[1],k[1]))>=Et[2])return q}continue}let le=0;for(let de=0;de<this._siblingOffset.length;de++){fE((J<<1)+this._siblingOffset[de][0],(ee<<1)+this._siblingOffset[de][1],ae+1,e,i,o,c,P,k),P[2]=-100,k[2]=this.maximums[this.childOffsets[V]+de]*x;const Re=dE(P,k,m,g);if(Re!=null){const Se=Re;A[de]=Se;let Pe=!1;for(let ke=0;ke<le&&!Pe;ke++)Se>=A[M[ke]]&&(M.splice(ke,0,de),Pe=!0);Pe||(M[le]=de),le++}}for(let de=0;de<le;de++){const Re=M[de];U.push({idx:this.childOffsets[V]+Re,t:A[Re],nodex:(J<<1)+this._siblingOffset[Re][0],nodey:(ee<<1)+this._siblingOffset[Re][1],depth:ae+1})}}return null}_addNode(e,i,o){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,o,c,m){if(e[c].isLeaf(i,o)===1)return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const g=c-1,x=e[g];let S=0,A=0;for(let M=0;M<this._siblingOffset.length;M++){const P=2*i+this._siblingOffset[M][0],k=2*o+this._siblingOffset[M][1],U=x.getElevation(P,k),V=x.isLeaf(P,k),q=this._addNode(U.min,U.max,V);V&&(S|=1<<M),A||(A=q)}for(let M=0;M<this._siblingOffset.length;M++)S&1<<M||this._construct(e,2*i+this._siblingOffset[M][0],2*o+this._siblingOffset[M][1],g,A+M)}}function K0(n,e,i,o,c,m){return wi(wi(n,i,m),wi(e,o,m),c)}function Xf(n,e,i){const o=i.dim,c=X(n*o-.5,0,o-1),m=X(e*o-.5,0,o-1),g=Math.floor(c),x=Math.floor(m),S=Math.min(g+1,o-1),A=Math.min(x+1,o-1);return K0(i.get(g,x),i.get(S,x),i.get(g,A),i.get(S,A),c-g,m-x)}const GA={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Tm(n,e,i){return(256*n*256+256*e+i)/10-1e4}function _1(n,e,i){return 256*n+e+i/256-32768}class J0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,o,c=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return void Yt(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const m=this.dim=i.height-2,g=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=c,this._modifiedForSources={},!c){for(let S=0;S<m;S++)g[this._idx(-1,S)]=g[this._idx(0,S)],g[this._idx(m,S)]=g[this._idx(m-1,S)],g[this._idx(S,-1)]=g[this._idx(S,0)],g[this._idx(S,m)]=g[this._idx(S,m-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(m,-1)]=g[this._idx(m-1,0)],g[this._idx(-1,m)]=g[this._idx(0,m-1)],g[this._idx(m,m)]=g[this._idx(m-1,m-1)]}const x=o==="terrarium"?_1:Tm;for(let S=0;S<g.length;++S){const A=4*S;this.floatView[S]=x(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=bs.now()}_buildQuadTree(){this._tree=new g1(this)}get(e,i,o=!1){o&&(e=X(e,-1,this.dim),i=X(i,-1,this.dim));const c=this._idx(e,i);return this.floatView[c]}set(e,i,o){const c=this._idx(e,i),m=this.floatView[c];return this.floatView[c]=o,o-m}static getUnpackVector(e){return GA[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const o=[0,0,0,0],c=J0.getUnpackVector(i);let m=Math.floor((e+c[3])/c[2]);return o[2]=m%256,m=Math.floor(m/256),o[1]=m%256,m=Math.floor(m/256),o[0]=m,o}getPixels(){return new wy({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=i*this.dim,m=i*this.dim+this.dim,g=o*this.dim,x=o*this.dim+this.dim;switch(i){case-1:c=m-1;break;case 1:m=c+1}switch(o){case-1:g=x-1;break;case 1:x=g+1}const S=-i*this.dim,A=-o*this.dim;for(let M=g;M<x;M++)for(let P=c;P<m;P++){const k=4*this._idx(P,M),U=4*this._idx(P+S,M+A);this.pixels[k+0]=e.pixels[U+0],this.pixels[k+1]=e.pixels[U+1],this.pixels[k+2]=e.pixels[U+2],this.pixels[k+3]=e.pixels[U+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function y1(n,e,i){n===1?e.headerLength=i.readFixed32():n===2?e.x=i.readVarint():n===3?e.y=i.readVarint():n===4?e.z=i.readVarint():n===5&&e.layers.push(function(o,c){return o.readFields($A,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},c)}(i,i.readVarint()+i.pos))}function HA(n,e,i){n===1?(e.delta_filter=function(o,c){return o.readFields(pE,{blockSize:0},c)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):n===2?(i.readVarint(),e.filter="zigzag_filter"):n===3?(i.readVarint(),e.filter="bitshuffle_filter"):n===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function pE(n,e,i){n===1&&(e.blockSize=i.readVarint())}function v1(n,e,i){n===1?(i.readVarint(),e.codec="gzip_data"):n===2?(i.readVarint(),e.codec="jpeg_image"):n===3?(i.readVarint(),e.codec="webp_image"):n===4&&(i.readVarint(),e.codec="png_image")}function mE(n,e,i){let o=0,c=0;n===1?e.firstByte=i.readFixed64():n===2?e.lastByte=i.readFixed64():n===3?e.filters.push(function(m,g){return m.readFields(HA,{},g)}(i,i.readVarint()+i.pos)):n===4?e.codec=function(m,g){return m.readFields(v1,{},g)}(i,i.readVarint()+i.pos):n===5?c=i.readFloat():n===6?o=i.readFloat():n===7?e.bands.push(i.readString()):n===8?e.offset=i.readDouble():n===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=c),e.scale===0&&(e.scale=o)}function $A(n,e,i){n===1?e.version=i.readVarint():n===2?e.name=i.readString():n===3?e.units=i.readString():n===4?e.tileSize=i.readVarint():n===5?e.buffer=i.readVarint():n===6?e.pixelFormat=i.readVarint():n===7&&e.dataIndex.push(function(o,c){return o.readFields(mE,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},c)}(i,i.readVarint()+i.pos))}function WA(n,e,i){if(n===2)(function(o,c,m){o.readFields(gE,m,c)})(i,i.readVarint()+i.pos,e);else if(n===3)throw new Error("Not implemented")}function gE(n,e,i){if(n===1){let o=0;const c=i.readVarint()+i.pos;for(;i.pos<c;)e[o++]=i.readVarint()}}function _E(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let o=2;o>=1;o--){const c=o===1?1:0,m=o===2?1:0;for(let g=0;g<e[0];g++){const x=e[1]*g;for(let S=c;S<e[1];S++){const A=e[2]*(S+x);for(let M=m;M<e[2];M++){const P=e[3]*(M+A);for(let k=0;k<e[3];k++){const U=P+k;n[U]+=n[U-i]}}}}i*=e[o]}return n}function qA(n){for(let e=0,i=n.length;e<i;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function ZA(n,e){switch(e){case"uint32":return n;case"uint16":for(let i=0;i<n.length;i+=2){const o=n[i],c=n[i+1];n[i]=(240&o)>>4|(61440&o)>>8|(240&c)<<4|61440&c,n[i+1]=15&o|(3840&o)>>4|(15&c)<<8|(3840&c)<<4}return n;case"uint8":for(let i=0;i<n.length;i+=4){const o=n[i],c=n[i+1],m=n[i+2],g=n[i+3];n[i+0]=(192&o)>>6|(192&c)>>4|(192&m)>>2|192&g,n[i+1]=(48&o)>>4|(48&c)>>2|48&m|(48&g)<<2,n[i+2]=(12&o)>>2|12&c|(12&m)<<2|(12&g)<<4,n[i+3]=3&o|(3&c)<<2|(3&m)<<4|(3&g)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}ai(J0,"DEMData"),ai(g1,"DemMinMaxQuadTree",{omit:["dem"]});var Hs=Uint8Array,Il=Uint16Array,x1=Int32Array,__=new Hs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Q0=new Hs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),b1=new Hs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),eb=function(n,e){for(var i=new Il(31),o=0;o<31;++o)i[o]=e+=1<<n[o-1];var c=new x1(i[30]);for(o=1;o<30;++o)for(var m=i[o];m<i[o+1];++m)c[m]=m-i[o]<<5|o;return{b:i,r:c}},Yf=eb(__,2),tb=Yf.b,ib=Yf.r;tb[28]=258,ib[258]=28;for(var Ev=eb(Q0,0).b,hl=new Il(32768),ho=0;ho<32768;++ho){var Sm=(43690&ho)>>1|(21845&ho)<<1;hl[ho]=((65280&(Sm=(61680&(Sm=(52428&Sm)>>2|(13107&Sm)<<2))>>4|(3855&Sm)<<4))>>8|(255&Sm)<<8)>>1}var y_=function(n,e,i){for(var o=n.length,c=0,m=new Il(e);c<o;++c)n[c]&&++m[n[c]-1];var g,x=new Il(e);for(c=1;c<e;++c)x[c]=x[c-1]+m[c-1]<<1;g=new Il(1<<e);var S=15-e;for(c=0;c<o;++c)if(n[c])for(var A=c<<4|n[c],M=e-n[c],P=x[n[c]-1]++<<M,k=P|(1<<M)-1;P<=k;++P)g[hl[P]>>S]=A;return g},v_=new Hs(288);for(ho=0;ho<144;++ho)v_[ho]=8;for(ho=144;ho<256;++ho)v_[ho]=9;for(ho=256;ho<280;++ho)v_[ho]=7;for(ho=280;ho<288;++ho)v_[ho]=8;var w1=new Hs(32);for(ho=0;ho<32;++ho)w1[ho]=5;var XA=y_(v_,9),YA=y_(w1,5),T1=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},uu=function(n,e,i){var o=e/8|0;return(n[o]|n[o+1]<<8)>>(7&e)&i},Cv=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(7&e)},yE=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],vc=function(n,e,i){var o=new Error(e||yE[n]);if(o.code=n,Error.captureStackTrace&&Error.captureStackTrace(o,vc),!i)throw o;return o},vE=new Hs(0),KA=typeof TextDecoder<"u"&&new TextDecoder;try{KA.decode(vE,{stream:!0})}catch{}const xE={gzip_data:"gzip"};class hu extends Error{constructor(e){super(e),this.name="MRTError"}}const JA={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},bE={uint32:1,uint16:2,uint8:4},QA={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let S1;class x_{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new hu(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),o=new DataView(e);if(i[0]!==13)throw new hu("File is not a valid MRT.");return o.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),o=this.getHeaderLength(e);if(i.length<o)throw new hu(`Expected header with length >= ${o} but got buffer of length ${i.length}`);const c=new S1(i.subarray(0,o)).readFields(y1,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==c.x||this.y!==c.y||this.z!==c.z))throw new hu(`Invalid attempt to parse header ${c.z}/${c.x}/${c.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=c.x,this.y=c.y,this.z=c.z;for(const m of c.layers)this.layers[m.name]=new nb(m,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],o=this.getLayer(e.layerName);for(let c of e.blockIndices){const m=o.dataIndex[c],g=m.firstByte-e.firstByte,x=m.lastByte-e.firstByte;if(o._blocksInProgress.has(c))continue;const S={layerName:o.name,firstByte:g,lastByte:x,pixelFormat:o.pixelFormat,blockIndex:c,blockShape:[m.bands.length].concat(o.bandShape),buffer:o.buffer,codec:m.codec.codec,filters:m.filters.map(A=>A.filter)};o._blocksInProgress.add(c),i.push(S)}return new rb(i,()=>{i.forEach(c=>o._blocksInProgress.delete(c.blockIndex))},(c,m)=>{if(i.forEach(g=>o._blocksInProgress.delete(g.blockIndex)),c)throw c;m.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class nb{constructor({version:e,name:i,units:o,tileSize:c,pixelFormat:m,buffer:g,dataIndex:x},S){if(this.version=e,this.version!==1)throw new hu(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=o,this.tileSize=c,this.buffer=g,this.pixelFormat=JA[m],this.dataIndex=x,this.bandShape=[c+2*g,c+2*g,bE[this.pixelFormat]],this._decodedBlocks=new g_(S?S.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return bE[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[o,c]of this.dataIndex.entries()){for(const[m,g]of c.bands.entries())if(g===e)return{bandIndex:i+m,blockIndex:o,blockBandIndex:m};i+=c.bands.length}break;case"number":for(const[o,c]of this.dataIndex.entries()){if(e>=i&&e<i+c.bands.length)return{bandIndex:e,blockIndex:o,blockBandIndex:e-i};i+=c.bands.length}break;default:throw new hu(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,o=-1/0;const c=[],m=new Set;for(const g of e){const{blockIndex:x}=this.getBlockForBand(g);if(x<0)throw new hu(`Invalid band: ${JSON.stringify(g)}`);const S=this.dataIndex[x];c.includes(x)||c.push(x),m.add(x),i=Math.min(i,S.firstByte),o=Math.max(o,S.lastByte)}if(m.size>this.cacheSize)throw new hu(`Number of blocks to decode (${m.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:o,blockIndices:c}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:o}=this.getBlockForBand(e);if(i<0)throw new hu(`Band not found: ${JSON.stringify(e)}`);const c=this._decodedBlocks.get(i.toString());if(!c)throw new hu(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const m=this.dataIndex[i],g=this.bandShape.reduce((A,M)=>A*M,1),x=o*g,S=c.subarray(x,x+g);return{data:S,bytes:new Uint8Array(S.buffer).subarray(S.byteOffset,S.byteOffset+S.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:m.offset,scale:m.scale}}}x_.setPbf=function(n){S1=n};class rb{constructor(e,i,o){this.tasks=e,this._onCancel=i,this._onComplete=o,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}x_.performDecoding=function(n,e){const i=new Uint8Array(n);return Promise.all(e.tasks.map(o=>{const{layerName:c,firstByte:m,lastByte:g,pixelFormat:x,blockShape:S,blockIndex:A,filters:M,codec:P}=o,k=i.subarray(m,g+1),U=new Uint32Array(S[0]*S[1]*S[2]);let V;if(P!=="gzip_data")throw new hu(`Unhandled codec: ${P}`);return V=function(q,J){if(!globalThis.DecompressionStream&&J==="gzip_data")return Promise.resolve(((de=function(Pe){Pe[0]==31&&Pe[1]==139&&Pe[2]==8||vc(6,"invalid gzip data");var ke=Pe[3],Fe=10;4&ke&&(Fe+=2+(Pe[10]|Pe[11]<<8));for(var rt=(ke>>3&1)+(ke>>4&1);rt>0;rt-=!Pe[Fe++]);return Fe+(2&ke)}(le=q))+8>le.length&&vc(6,"invalid gzip data"),function(Pe,ke,Fe,rt){var qe=Pe.length;if(!qe||ke.f&&!ke.l)return Fe||new Hs(0);var ot=!Fe,ht=ot||ke.i!=2,yt=ke.i;ot&&(Fe=new Hs(3*qe));var Tt,Et,pt=function(nr){var ur=Fe.length;if(nr>ur){var Dr=new Hs(Math.max(2*ur,nr));Dr.set(Fe),Fe=Dr}},St=ke.f||0,tt=ke.p||0,Qe=ke.b||0,xt=ke.l,wt=ke.d,_t=ke.m,mt=ke.n,si=8*qe;do{if(!xt){St=uu(Pe,tt,1);var qt=uu(Pe,tt+1,3);if(tt+=3,!qt){var Gt=Pe[(Ee=4+((tt+7)/8|0))-4]|Pe[Ee-3]<<8,ji=Ee+Gt;if(ji>qe){yt&&vc(0);break}ht&&pt(Qe+Gt),Fe.set(Pe.subarray(Ee,ji),Qe),ke.b=Qe+=Gt,ke.p=tt=8*ji,ke.f=St;continue}if(qt==1)xt=XA,wt=YA,_t=9,mt=5;else if(qt==2){var Zt=uu(Pe,tt,31)+257,Si=uu(Pe,tt+10,15)+4,Zi=Zt+uu(Pe,tt+5,31)+1;tt+=14;for(var hn=new Hs(Zi),wn=new Hs(19),Xi=0;Xi<Si;++Xi)wn[b1[Xi]]=uu(Pe,tt+3*Xi,7);tt+=3*Si;var Gn=T1(wn),Yn=(1<<Gn)-1,Yr=y_(wn,Gn);for(Xi=0;Xi<Zi;){var Ee,ve=Yr[uu(Pe,tt,Yn)];if(tt+=15&ve,(Ee=ve>>4)<16)hn[Xi++]=Ee;else{var at=0,Bt=0;for(Ee==16?(Bt=3+uu(Pe,tt,3),tt+=2,at=hn[Xi-1]):Ee==17?(Bt=3+uu(Pe,tt,7),tt+=3):Ee==18&&(Bt=11+uu(Pe,tt,127),tt+=7);Bt--;)hn[Xi++]=at}}var ct=hn.subarray(0,Zt),Ht=hn.subarray(Zt);_t=T1(ct),mt=T1(Ht),xt=y_(ct,_t),wt=y_(Ht,mt)}else vc(1);if(tt>si){yt&&vc(0);break}}ht&&pt(Qe+131072);for(var xi=(1<<_t)-1,gi=(1<<mt)-1,Ki=tt;;Ki=tt){var Oi=(at=xt[Cv(Pe,tt)&xi])>>4;if((tt+=15&at)>si){yt&&vc(0);break}if(at||vc(2),Oi<256)Fe[Qe++]=Oi;else{if(Oi==256){Ki=tt,xt=null;break}var fi=Oi-254;Oi>264&&(fi=uu(Pe,tt,(1<<(ki=__[Xi=Oi-257]))-1)+tb[Xi],tt+=ki);var Hn=wt[Cv(Pe,tt)&gi],yr=Hn>>4;if(Hn||vc(3),tt+=15&Hn,Ht=Ev[yr],yr>3){var ki=Q0[yr];Ht+=Cv(Pe,tt)&(1<<ki)-1,tt+=ki}if(tt>si){yt&&vc(0);break}ht&&pt(Qe+131072);var On=Qe+fi;if(Qe<Ht){var pr=0-Ht,ir=Math.min(Ht,On);for(pr+Qe<0&&vc(3);Qe<ir;++Qe)Fe[Qe]=(void 0)[pr+Qe]}for(;Qe<On;++Qe)Fe[Qe]=Fe[Qe-Ht]}}ke.l=xt,ke.p=Ki,ke.b=Qe,ke.f=St,xt&&(St=1,ke.m=_t,ke.d=wt,ke.n=mt)}while(!St);return Qe!=Fe.length&&ot?(Tt=Fe,((Et=Qe)==null||Et>Tt.length)&&(Et=Tt.length),new Hs(Tt.subarray(0,Et))):Fe.subarray(0,Qe)}(le.subarray(de,-8),{i:2},new Hs(((ee=le)[(ae=ee.length)-4]|ee[ae-3]<<8|ee[ae-2]<<16|ee[ae-1]<<24)>>>0))));var ee,ae,le,de;const Re=xE[J];if(!Re)throw new Error(`Unhandled codec: ${J}`);const Se=new globalThis.DecompressionStream(Re);return new Response(new Blob([q]).stream().pipeThrough(Se)).arrayBuffer().then(Pe=>new Uint8Array(Pe))}(k,P).then(q=>(function(J,ee){J.readFields(WA,ee)}(new S1(q),U),new QA[x](U.buffer))),V.then(q=>{for(let J=M.length-1;J>=0;J--)switch(M[J]){case"delta_filter":_E(q,S);break;case"zigzag_filter":qA(q);break;case"bitshuffle_filter":ZA(q,x);break;default:throw new hu(`Unhandled filter "${M[J]}"`)}return{layerName:c,blockIndex:A,data:q}}).catch(q=>{throw q})}))},ai(rb,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),ai(x_,"MapboxRasterTile"),ai(nb,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class wE{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const o=e[i];this._stringToNumber[o]=i,this._numberToString[i]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class TE{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new yd(Lt,16,0),this.featureIndexArray=new mx,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,o,c,m,g=0,x=0){const S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,m,g);const A=this.grid;for(let M=0;M<i.length;M++){const P=i[M],k=[1/0,1/0,-1/0,-1/0];for(let U=0;U<P.length;U++){const V=P[U];k[0]=Math.min(k[0],V.x),k[1]=Math.min(k[1],V.y),k[2]=Math.max(k[2],V.x),k[3]=Math.max(k[3],V.y)}x!==0&&(k[0]-=x,k[1]-=x,k[2]+=x,k[3]+=x),k[0]<Lt&&k[1]<Lt&&k[2]>=0&&k[3]>=0&&A.insert(S,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new di(new Ff(this.rawTileData)).layers,this.sourceLayerCoder=new wE(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:o,transform:c,tileTransform:m,pixelPosMatrix:g,availableImages:x,worldview:S}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const A=i.queryRadius?i.queryRadius:0,M=o.bufferedTilespaceBounds,P=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(q,J,ee,ae)=>ca(o.bufferedTilespaceGeometry,q-A,J-A,ee+A,ae+A));P.sort(EE);let k=null;c.elevation&&P.length>0&&(k=Ud.create(c.elevation,this.tileID));const U={};let V;for(let q=0;q<P.length;q++){const J=P[q];if(J===V)continue;V=J;const ee=this.featureIndexArray.get(J);let ae=null;this.is3DTile?this.loadMatchingModelFeature(U,ee,e,o,c,S):this.loadMatchingFeature(U,ee,e,x,S,(le,de,Re,Se=0)=>(ae||(ae=lt(le,this.tileID.canonical,m)),de.queryIntersectsFeature(o,le,Re,ae,this.z,c,g,k,Se)))}return U}loadMatchingFeature(e,i,o,c,m,g){const{featureIndex:x,bucketIndex:S,sourceLayerIndex:A,layoutVertexArrayOffset:M}=i,P=this.bucketLayerIDs[S],k=o.layers,U=Object.keys(k);if(U.length&&!Ci(U,P))return;const V=o.sourceCache,q=this.sourceLayerCoder.decode(A),J=this.vtLayers[q].feature(x),ee=this.getId(J,q);for(let ae=0;ae<P.length;ae++){const le=P[ae];if(!k[le])continue;const{styleLayer:de,targets:Re}=k[le];let Se={};ee!==void 0&&(Se=V.getFeatureState(de.sourceLayer,ee));const Pe=!g||g(J,de,Se,M);if(!Pe)continue;const ke=new Xh(J,this.z,this.x,this.y,ee);ke.tile=this.tileID.canonical,ke.state=Se;let Fe=this.serializedLayersCache.get(le);Fe||(Fe=de.serialize(),Fe.id=le,this.serializedLayersCache.set(le,Fe)),ke.source=Fe.source,ke.sourceLayer=Fe["source-layer"],ke.layer=Object.assign({},Fe),ke.layer.paint=SE(Fe.paint,de.paint,J,Se,c),ke.layer.layout=SE(Fe.layout,de.layout,J,Se,c);let rt=!1;for(const qe of Re){this.updateFeatureProperties(ke,qe);const{filter:ot}=qe;if(ot){if(J.properties=ke.properties,ot.needGeometry){const ht=Je(J,!0);if(!ot.filter(new Er(this.tileID.overscaledZ,{worldview:m}),ht,this.tileID.canonical))continue}else if(!ot.filter(new Er(this.tileID.overscaledZ,{worldview:m}),J))continue}rt=!0,qe.targetId&&this.addFeatureVariant(ke,qe)}rt&&this.appendToResult(e,le,x,ke,Pe)}}loadMatchingModelFeature(e,i,o,c,m,g){const{featureIndex:x,bucketIndex:S}=i,A=this.bucketLayerIDs[S],M=o.layers,P=Object.keys(M);if(!P.length||Ci(P,A))for(let k=0;k<A.length;k++){const U=A[k],{styleLayer:V,targets:q}=M[U];if(V.type!=="model")continue;const J=c.tile,ee=J.getBucket(V);if(!(ee&&ee instanceof xv))continue;const ae=rE(ee,x,c,m);if(!ae)continue;const{z:le,x:de,y:Re}=J.tileID.canonical,{feature:Se,intersectionZ:Pe,position:ke}=ae;let Fe={};Se.id!==void 0&&(Fe=o.sourceCache.getFeatureState(V.sourceLayer,Se.id));const rt=new Xh({},le,de,Re,Se.id);rt.tile=this.tileID.canonical,rt.state=Fe,rt.properties=Se.properties,rt.geometry={type:"Point",coordinates:[ke.lng,ke.lat]};let qe=this.serializedLayersCache.get(U);qe||(qe=V.serialize(),qe.id=U,this.serializedLayersCache.set(U,qe)),rt.source=qe.source,rt.sourceLayer=qe["source-layer"],rt.layer=Object.assign({},qe);let ot=!1;for(const ht of q){this.updateFeatureProperties(rt,ht);const{filter:yt}=ht;if(yt){if(Se.properties=rt.properties,yt.needGeometry){if(!yt.filter(new Er(this.tileID.overscaledZ,{worldview:g}),Se,this.tileID.canonical))continue}else if(!yt.filter(new Er(this.tileID.overscaledZ,{worldview:g}),Se))continue}ot=!0,ht.targetId&&this.addFeatureVariant(rt,ht)}ot&&this.appendToResult(e,U,x,rt,Pe)}}updateFeatureProperties(e,i,o){if(i.properties){const c={};for(const m in i.properties){const g=i.properties[m].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,o);g!=null&&(c[m]=g)}e.properties=c}}addFeatureVariant(e,i,o){const c={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(c.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(c)}appendToResult(e,i,o,c,m){let g=e[i];g===void 0&&(g=e[i]=[]),g.push({featureIndex:o,feature:c,intersectionZ:m})}lookupSymbolFeatures(e,i,o,c,m,g){const x={};this.loadVTLayers();for(const S of e)this.loadMatchingFeature(x,{bucketIndex:i,sourceLayerIndex:o,featureIndex:S,layoutVertexArrayOffset:0},c,m,g);return x}loadFeature(e){const{featureIndex:i,sourceLayerIndex:o}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(o),m=this.vtFeatures[c];if(m[i])return m[i];const g=this.vtLayers[c].feature(i);return m[i]=g,g}hasLayer(e){for(const i of this.bucketLayerIDs)for(const o of i)if(e===o)return!0;return!1}getId(e,i){let o=e.id;if(this.promoteId){const c=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(c!=null)if(Array.isArray(c)){if(!this.promoteIdExpression){const m=Ua(c);if(m.result!=="success"){const g=m.value.map(x=>`${x.key}: ${x.message}`).join(", ");return void Yt(`Failed to create expression for promoteId: ${g}`)}this.promoteIdExpression=m.value}o=this.promoteIdExpression.evaluate({zoom:0},e)}else o=e.properties[c];typeof o=="boolean"&&(o=Number(o))}return o}}function SE(n,e,i,o,c){return gt(n,(m,g)=>{const x=e instanceof fc?e.get(g):null;return x&&x.evaluate?x.evaluate(i,o,void 0,c):x})}function EE(n,e){return e-n}ai(TE,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const ab=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class E1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,o]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const m=ab[15&o];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new E1(x,g,m,e)}constructor(e,i=64,o=Float64Array,c){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=o,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=ab.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-x%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+x+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=e,this.coords[this._pos++]=i,o}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Av(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:x}=this,S=[0,m.length-1,0],A=[];for(;S.length;){const M=S.pop()||0,P=S.pop()||0,k=S.pop()||0;if(P-k<=x){for(let J=k;J<=P;J++){const ee=g[2*J],ae=g[2*J+1];ee>=e&&ee<=o&&ae>=i&&ae<=c&&A.push(m[J])}continue}const U=k+P>>1,V=g[2*U],q=g[2*U+1];V>=e&&V<=o&&q>=i&&q<=c&&A.push(m[U]),(M===0?e<=V:i<=q)&&(S.push(k),S.push(U-1),S.push(1-M)),(M===0?o>=V:c>=q)&&(S.push(U+1),S.push(P),S.push(1-M))}return A}within(e,i,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:m,nodeSize:g}=this,x=[0,c.length-1,0],S=[],A=o*o;for(;x.length;){const M=x.pop()||0,P=x.pop()||0,k=x.pop()||0;if(P-k<=g){for(let J=k;J<=P;J++)Iv(m[2*J],m[2*J+1],e,i)<=A&&S.push(c[J]);continue}const U=k+P>>1,V=m[2*U],q=m[2*U+1];Iv(V,q,e,i)<=A&&S.push(c[U]),(M===0?e-o<=V:i-o<=q)&&(x.push(k),x.push(U-1),x.push(1-M)),(M===0?e+o>=V:i+o>=q)&&(x.push(U+1),x.push(P),x.push(1-M))}return S}}function Av(n,e,i,o,c,m){if(c-o<=i)return;const g=o+c>>1;C1(n,e,g,o,c,m),Av(n,e,i,o,g-1,1-m),Av(n,e,i,g+1,c,1-m)}function C1(n,e,i,o,c,m){for(;c>o;){if(c-o>600){const A=c-o+1,M=i-o+1,P=Math.log(A),k=.5*Math.exp(2*P/3),U=.5*Math.sqrt(P*k*(A-k)/A)*(M-A/2<0?-1:1);C1(n,e,i,Math.max(o,Math.floor(i-M*k/A+U)),Math.min(c,Math.floor(i+(A-M)*k/A+U)),m)}const g=e[2*i+m];let x=o,S=c;for(Rv(n,e,o,i),e[2*c+m]>g&&Rv(n,e,o,c);x<S;){for(Rv(n,e,x,S),x++,S--;e[2*x+m]<g;)x++;for(;e[2*S+m]>g;)S--}e[2*o+m]===g?Rv(n,e,o,S):(S++,Rv(n,e,S,c)),S<=i&&(o=S+1),i<=S&&(c=S-1)}}function Rv(n,e,i,o){A1(n,i,o),A1(e,2*i,2*o),A1(e,2*i+1,2*o+1)}function A1(n,e,i){const o=n[e];n[e]=n[i],n[i]=o}function Iv(n,e,i,o){const c=n-i,m=e-o;return c*c+m*m}r.$=_p,r.A=Pa,r.B=Bu,r.C=2,r.D=Bg,r.E=mn,r.F=Bf,r.G=jw,r.H=Nm,r.I=Mi,r.J=Lp,r.K=hd,r.L=gp,r.M=sg,r.N=og,r.O=Y_,r.P=vt,r.Q=cg,r.R=bu,r.S=Ch,r.T=Od,r.U=Ua,r.V=u_,r.W=K_,r.X=Mu,r.Y=tf,r.Z=Fc,r._=ls,r.a=function(n){return Tr.API_CDN_URL_REGEX.test(n)},r.a$=mf,r.a0=Ni,r.a1=la,r.a2=Ah,r.a3=class extends u_{},r.a4=zu,r.a5=Pp,r.a6=We,r.a7=function(n){const e=n.value;return e?Ni(e)?h_(e,!0)?[]:[new u_(n.key,e,`invalid url "${e}"`)]:[new u_(n.key,e,`string expected, "${hd(e)}" found`)]:[]},r.a8=Zn,r.a9=ea,r.aA=X,r.aB=Be,r.aC=Fa,r.aD=Bs,r.aE=Ao,r.aF=re,r.aG=nt,r.aH=function(n,e){const i={};for(let o=0;o<e.length;o++){const c=e[o];c in n&&(i[c]=n[c])}return i},r.aI=B,r.aJ=te,r.aK=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,i,o){const c=this.entries[n]=this.entries[n]||{callbacks:[]};if(c.result){const[m,g]=c.result;return this.scheduler?this.scheduler.add(()=>{o(m,g)},e):o(m,g),()=>{}}return c.callbacks.push(o),c.cancel||(c.cancel=i((m,g)=>{c.result=[m,g];for(const x of c.callbacks)this.scheduler?this.scheduler.add(()=>{x(m,g)},e):x(m,g);setTimeout(()=>delete this.entries[n],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(m=>m!==o),c.callbacks.length||(c.cancel(),delete this.entries[n]))}}},r.aL=function(n,e,i){const o=JSON.stringify(n.request);return n.data&&(this.deduped.entries[o]={result:[null,n.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},c=>{const m=ac(n.request,(g,x,S)=>{g?c(g):x&&c(null,{vectorTile:i?void 0:new di(new Ff(x)),rawData:x,responseHeaders:new Map(S.entries())})});return()=>{m.cancel(),c()}},e)},r.aM=function(n){return n?{cacheControl:n.get("Cache-Control"),expires:n.get("Expires")}:{cacheControl:void 0,expires:void 0}},r.aN=function(n){nc++,nc>os&&(n.getActor().send("enforceCacheSizeLimit",Nr),nc=0)},r.aO=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log2(n)))},r.aP=vo,r.aQ=dv,r.aR=mv,r.aS=j,r.aT=o_,r.aU=function(n,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let o=0;o<n.length;o++){const c=document.createElement("source");Vn(n[o])||(i.crossOrigin="Anonymous"),c.src=n[o],i.appendChild(c)}return{cancel:()=>{}}},r.aV=Jc,r.aW=xm,r.aX=$e,r.aY=fm,r.aZ=me,r.a_=ce,r.aa=At,r.ab=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return lr(n.expression.evaluate(e))}interpolate(n,e,i){return{x:wi(n.x,e.x,i),y:wi(n.y,e.y,i),z:wi(n.z,e.z,i),azimuthal:wi(n.azimuthal,e.azimuthal,i),polar:wi(n.polar,e.polar,i)}}},r.ac=Er,r.ad=wh,r.ae=Ge,r.af=Bn,r.ag=Qt,r.ah=he,r.ai=fc,r.aj=Id,r.ak=wi,r.al=Lt,r.am=lc,r.an=cn,r.ao=Qi,r.ap=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return function([i,o]){const c=lr([1,i,o]);return{x:c.x,y:c.y,z:c.z}}(n.expression.evaluate(e))}interpolate(n,e,i){return{x:wi(n.x,e.x,i),y:wi(n.y,e.y,i),z:wi(n.z,e.z,i)}}},r.aq=function(n,e,i=0,o=!0){const c=new vt(i,i),m=n.sub(c),g=e.add(c),x=[m,new vt(g.x,m.y),g,new vt(m.x,g.y)];return o&&x.push(m.clone()),x},r.ar=function(n,e){const i=[];for(let o=0;o<n.length;o++){const c=we(o-1,-1,n.length-1),m=we(o+1,-1,n.length-1),g=n[o],x=n[m],S=n[c].sub(g).unit(),A=x.sub(g).unit(),M=A.angleWithSep(S.x,S.y),P=S.add(A).unit().mult(-1*e/Math.sin(M/2));i.push(g.add(P))}return i},r.as=E0,r.at=ca,r.au=function(n,e,i=0){return ui(((e.x-i)*n.scale-n.x)*Lt,(e.y*n.scale-n.y)*Lt,Ae(e.z,e.y))},r.av=Pr,r.aw=Vi,r.ax=tn,r.ay=jS,r.az=function(n){let e=1/0,i=1/0,o=-1/0,c=-1/0;for(const m of n)e=Math.min(e,m.x),i=Math.min(i,m.y),o=Math.max(o,m.x),c=Math.max(c,m.y);return{min:new vt(e,i),max:new vt(o,c)}},r.b=function(n){return Tr.API_FONTS_REGEX.test(n)},r.b$=Px,r.b0=ar,r.b1=Ve,r.b2=hy,r.b3=r_,r.b4=function(){tl.isLoading()||tl.isLoaded()||iy()!=="deferred"||ny()},r.b5=uf,r.b6=Je,r.b7=Xh,r.b8=Ta,r.b9=Rw,r.bA=Nt,r.bB=pe,r.bC=function(n,e){const{x:i,y:o}=n.point,c=Zb(i,o,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Be(c,c,Wb(Lh(e)))},r.bD=H,r.bE=Zr,r.bF=Va,r.bG=mr,r.bH=gr,r.bI=Rn,r.bJ=ru,r.bK=ll,r.bL=Fo,r.bM=function(n,e,i,o,c){const m=5*e+2;n.float32[m+0]=i,n.float32[m+1]=o,n.float32[m+2]=c},r.bN=_m,r.bO=da,r.bP=xr,r.bQ=Ga,r.bR=tc,r.bS=we,r.bT=function(n,e,i,o){var c=new N(4);return c[0]=n,c[1]=e,c[2]=i,c[3]=o,c},r.bU=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,o=1<<i,c=Math.floor(n.x),m=Math.floor((n.x-c)*o),g=Math.floor(n.y*o),x=this.findDEMTileFor(new vo(i,c,i,m,g));return!(!x||!x.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const o=this._source();if(!o||n.y<0||n.y>1)return e;const c=o.getSource().maxzoom,m=1<<c,g=Math.floor(n.x),x=n.x-g,S=new vo(c,g,c,Math.floor(x*m),Math.floor(n.y*m)),A=this.findDEMTileFor(S);if(!A||!A.dem)return e;const M=A.dem,P=1<<A.tileID.canonical.z,k=(x*P-A.tileID.canonical.x)*M.dim,U=(n.y*P-A.tileID.canonical.y)*M.dim,V=Math.floor(k),q=Math.floor(U);return(i?this.exaggeration():1)*wi(wi(M.get(V,q),M.get(V,q+1),U-q),wi(M.get(V+1,q),M.get(V+1,q+1),U-q),k-V)}static getAtTileOffset(n,e,i,o){const c=1<<n.canonical.z;return o?o.pointElevation(e):i?i.getAtPointOrZero(new Ge(n.wrap+(n.canonical.x+e.x/Lt)/c,(n.canonical.y+e.y/Lt)/c)):0}static getAtTileOffsetFunc(n,e,i,o){return(c,m,g)=>{const x=this.getAtTileOffset(n,c,m,g),S=o.upVector(n.canonical,c.x,c.y);return xn(S,S,x*o.upVectorScale(n.canonical,e,i).metersToTile),S}}getForTilePoints(n,e,i,o){if(this.isUsingMockSource())return!1;const c=Ud.create(this,n,o);return!!c&&(e.forEach(m=>{m[2]=this.exaggeration()*c.getElevationAt(m[0],m[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,o=e.tileID,c=1<<n.canonical.z-o.canonical.z;let m=n.canonical.x/c-o.canonical.x,g=n.canonical.y/c-o.canonical.y,x=0;for(let S=0;S<n.canonical.z-o.canonical.z&&!i.leaves[x];S++){m*=2,g*=2;const A=2*Math.floor(g)+Math.floor(m);x=i.childOffsets[x]+A,m%=1,g%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,i=Number.MAX_VALUE,o=Number.MIN_VALUE;for(const c of n){const m=this.getMinMaxForTile(c.tileID);m&&(i=Math.min(i,m.min),o=Math.max(o,m.max),e=!0)}return e?{min:i,max:o}:null}},r.bV=Fx,r.bW=va,r.bX=zo,r.bY=oS,r.bZ=i1,r.b_=cS,r.ba=kg,r.bb=lt,r.bc=Wo,r.bd=jp,r.be=Hb,r.bf=ta,r.bg=Zp,r.bh=M0,r.bi=function(n,e){const i=Id(e.zoom);if(i===0)return Lh(n);const o=Sx(n),c=Al(o),m=re(o.getWest())*e.worldSize,g=re(o.getEast())*e.worldSize,x=te(o.getNorth())*e.worldSize,S=te(o.getSouth())*e.worldSize,A=[m,x,0],M=[g,x,0],P=[m,S,0],k=[g,S,0],U=je([],e.globeMatrix);return Bn(A,A,U),Bn(M,M,U),Bn(P,P,U),Bn(k,k,U),c[0]=Ad(c[0],P,i),c[1]=Ad(c[1],k,i),c[2]=Ad(c[2],M,i),c[3]=Ad(c[3],A,i),un.fromPoints(c)},r.bj=xy,r.bk=je,r.bl=Rd,r.bm=Ad,r.bn=qc,r.bo=OT,r.bp=oi,r.bq=He,r.br=x_,r.bs=Ff,r.bt=ac,r.bu=function(n,e){const i=[];for(const o in n)o in e||i.push(o);return i},r.bv=ye,r.bw=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bx=To,r.by=xe,r.bz=be,r.c=ro,r.c$=function(n){return n*n*n*n*n},r.c0=e_,r.c1=$w,r.c2=sv,r.c3=E1,r.c4=xn,r.c5=mo,r.c6=Na,r.c7=function(n,e,i){i*=.5;var o=e[0],c=e[1],m=e[2],g=e[3],x=Math.sin(i),S=Math.cos(i);return n[0]=o*S+c*x,n[1]=c*S-o*x,n[2]=m*S+g*x,n[3]=g*S-m*x,n},r.c8=qa,r.c9=Kr,r.cA=tr,r.cB=qx,r.cC=Cl,r.cD=zT,r.cE=function(n,e,i,o,c,m,g,x,S){if(S.name==="globe")return zT(n,e,new Cl(i,o,c),!1);const A=fm({z:i,x:o,y:c},S);return new un([(m+A.x/A.scale)*e,e*(A.y/A.scale),g],[(m+A.x2/A.scale)*e,e*(A.y2/A.scale),x])},r.cF=function(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n[3]=Math.min(e[3],i[3]),n},r.cG=function(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n[3]=Math.max(e[3],i[3]),n},r.cH=function(n){const e=Math.round((n+45+360)%360/90)%4;return et[e]},r.cI=_e,r.cJ=Ra,r.cK=t,r.cL=function(n){const e=be(new Float64Array(16));Be(e,n.pixelMatrix,n.globeMatrix);const i=[0,b,0],o=[0,T,0];return Bn(i,i,e),Bn(o,o,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!Xb(n,new j(n.center.lat,90)),o[0]>0&&o[0]<=n.width&&o[1]>0&&o[1]<=n.height&&!Xb(n,new j(n.center.lat,-90))]},r.cM=function(n,e){const{scale:i}=n.tileTransform,o=i*Lt/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return function(c,m,g){var x=m[1],S=m[2],A=m[3],M=g[0],P=g[1];return c[0]=m[0]*M,c[1]=x*M,c[2]=S*P,c[3]=A*P,c}(new Float32Array(4),e.inverseAdjustmentMatrix,[o,o])},r.cN=nm,r.cO=Ti,r.cP=Qc,r.cQ=function(n){const e=Qc(n,!0);return H([],[e[0],e[1],e[4],e[5]])},r.cR=Xe,r.cS=dr,r.cT=it,r.cU=function(n){const{x:e,y:i}=n.point,{lng:o,lat:c}=n._center;return Zb(e,i,n.worldSize,o,c)},r.cV=hr,r.cW=Za,r.cX=Rs,r.cY=Ea,r.cZ=f,r.c_=function(n,e,i){let o=0;for(let c=0;c<2;++c)n[c]>0&&(o+=(n[c]-0)*(n[c]-0)),e[c]<0&&(o+=(0-e[c])*(0-e[c]));return o},r.ca=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},r.cb=hi,r.cc=function(n,e,i,o,c){var m=1/Math.tan(e/2);if(n[0]=m/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=m,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,c!=null&&c!==1/0){var g=1/(o-c);n[10]=(c+o)*g,n[14]=2*c*o*g}else n[10]=-1,n[14]=-2*o;return n},r.cd=function(n,e,i,o,c,m,g){var x=1/(e-i),S=1/(o-c),A=1/(m-g);return n[0]=-2*x,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*S,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*A,n[11]=0,n[12]=(e+i)*x,n[13]=(c+o)*S,n[14]=(g+m)*A,n[15]=1,n},r.ce=se,r.cf=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},r.cg=xf,r.ch=Sl,r.ci=ya,r.cj=ds,r.ck=Zl,r.cl=mm,r.cm=function(){var n=new N(4);return N!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},r.cn=function(n,e,i){var o=e[0],c=e[1],m=e[2],g=e[3],x=Math.sin(i),S=Math.cos(i);return n[0]=o*S+m*x,n[1]=c*S+g*x,n[2]=o*-x+m*S,n[3]=c*-x+g*S,n},r.co=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},r.cp=to,r.cq=function(n){var e=n[0],i=n[1],o=n[2],c=n[3];return Math.sqrt(e*e+i*i+o*o+c*c)},r.cr=Qn,r.cs=jr,r.ct=Kc,r.cu=3,r.cv=2,r.cw=7,r.cx=6,r.cy=za,r.cz=Dt,r.d=function(n){return Tr.API_TILEJSON_REGEX.test(n)},r.d$=UT,r.d0=Q,r.d1=45,r.d2=ql,r.d3=function(n,e,i){const o=Math.sqrt(n*n+e*e+i*i),c=o>0?Math.acos(i/o)*Mo:0;let m=n!==0||e!==0?Math.atan2(-e,-n)*Mo+90:0;return m<0&&(m+=360),[o,m,c]},r.d4=ui,r.d5=lr,r.d6=De,r.d7=zi,r.d8=un,r.d9=En,r.dA=Ed,r.dB=class extends Wl{constructor(n){super(n),this.current=Gb}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let o=0;o<9;o++)if(i[o]!==this.current[o]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.dC=vi,r.dD=function(n,e,i){const o=Id(i.zoom),c=n.style.map._antialias,m=n.terrain&&n.terrain.exaggeration()>0;return o===0&&!c&&!m},r.dE=function(n){const e=n.pixelsPerMeter,i=e/se(1,n.center.lat),o=be(new Float64Array(16));return He(o,o,[n.point.x,n.point.y,0]),Xe(o,o,[i,i,e]),Float32Array.from(o)},r.dF=Sx,r.dG=function(n){const e=_e-5;n=X(n,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(cn(n))),3);return Math.round(i*(y.length-1))},r.dH=function(n,e,i,o){const c=e.getNorth(),m=e.getSouth(),g=e.getWest(),x=e.getEast(),S=1<<n.z,A=x-g,M=c-m,P=A/p,k=-M/y[i],U=[0,P,0,k,0,0,c,g,0];if(n.z>0){const V=180/o;ue(U,U,[V/A+1,0,0,0,V/M+1,0,-.5*V/P,.5*V/k,1])}return U[2]=S,U[5]=n.x,U[8]=n.y,U},r.dI=Lh,r.dJ=function(n,e,i){const o=be(new Float64Array(16)),c=(e/(1<<n)-.5)*Math.PI*2;return kt(o,i.globeMatrix,c),Float32Array.from(o)},r.dK=wy,r.dL=Tx,r.dM=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},r.dN=K,r.dO=function(n,e){var i=Math.sin(e),o=Math.cos(e);return n[0]=o,n[1]=i,n[2]=0,n[3]=-i,n[4]=o,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},r.dP=eo,r.dQ=NT,r.dR=Rr,r.dS=Gr,r.dT=256,r.dU=function(n,e){const i=[0,0,0];return Bn(i,i,xy(Lh(e.canonical))),Bn(i,i,n),i},r.dV=n=>({u_matrix:new Zl(n),u_texsize:new ds(n),u_pixels_to_tile_units:new my(n),u_device_pixel_ratio:new ya(n),u_width_scale:new ya(n),u_floor_width_scale:new ya(n),u_image:new xf(n),u_units_to_pixels:new ds(n),u_tile_units_to_pixels:new ya(n),u_alpha_discard_threshold:new ya(n),u_trim_offset:new ds(n),u_trim_fade_range:new ds(n),u_trim_color:new ql(n),u_emissive_strength:new ya(n),u_zbias_factor:new ya(n),u_tile_to_meter:new ya(n),u_ground_shadow_factor:new Sl(n),u_pattern_transition:new ya(n)}),r.dW=n=>({u_matrix:new Zl(n),u_pixels_to_tile_units:new my(n),u_device_pixel_ratio:new ya(n),u_width_scale:new ya(n),u_floor_width_scale:new ya(n),u_units_to_pixels:new ds(n),u_dash_image:new xf(n),u_gradient_image:new xf(n),u_image_height:new ya(n),u_texsize:new ds(n),u_tile_units_to_pixels:new ya(n),u_alpha_discard_threshold:new ya(n),u_trim_offset:new ds(n),u_trim_fade_range:new ds(n),u_trim_color:new ql(n),u_emissive_strength:new ya(n),u_zbias_factor:new ya(n),u_tile_to_meter:new ya(n),u_ground_shadow_factor:new Sl(n)}),r.dX=n=>({u_camera_to_center_distance:new ya(n),u_extrude_scale:new my(n),u_device_pixel_ratio:new ya(n),u_matrix:new Zl(n),u_inv_rot_matrix:new Zl(n),u_merc_center:new ds(n),u_tile_id:new Sl(n),u_zoom_transition:new ya(n),u_up_dir:new Sl(n),u_emissive_strength:new ya(n)}),r.dY=Gl,r.dZ=kw,r.d_=class{constructor(n,e,i,o){this.context=n,this.format=o,this.size=i,this.texture=n.gl.createTexture();const[c,m,g]=this.size,{gl:x}=n;x.bindTexture(x.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&x.texImage3D(x.TEXTURE_3D,0,this.format,c,m,g,0,Hx(this.format),im(this.format),e.data)}bind(n,e){const{context:i}=this,{gl:o}=i;o.bindTexture(o.TEXTURE_3D,this.texture),n!==this.minFilter&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MAG_FILTER,n),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_S,e),o.texParameteri(o.TEXTURE_3D,o.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},r.da=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},r.db=jy,r.dc=Zu,r.dd=ww,r.de=h_,r.df=function(n,e){return n.readFields(Yh,{icons:[]},e)},r.dg=Nx,r.dh=_c,r.di=th,r.dj=qd,r.dk=lo,r.dl=ch,r.dm=ge,r.dn=Kt,r.dp=function(n){const e=n.indexOf(bd);return e>=0?n.slice(0,e):n},r.dq=function(n){return n.indexOf(bd)>=0},r.dr=function(n){const e=n.lastIndexOf(bd);return e>=0?n.slice(e+1):""},r.ds=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.dt=function(n,e,i,o){return n.type==="custom"?new t1(n,e):new aE[n.type](n,e,i,o)},r.du=ut,r.dv=function(n){const e=n.indexOf(bd);return e>=0?n.slice(e+1):""},r.dw=class extends Xh{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},r.dx=pg,r.dy=wu,r.dz=function(n){return n({pluginStatus:Ln,pluginURL:Br}),pg.on("pluginStateChange",n),n},r.e=Tr,r.e$=function([n,e,i]){const o=Math.hypot(n,e,i),c=Math.atan2(n,i),m=.5*Math.PI-Math.acos(-e/o);return new j(Za(c),Za(m))},r.e0=(n,e,i,o,c,m)=>{const g=n.transform,x=g.projection.name==="globe";let S;if(m.paint.get("circle-pitch-alignment")==="map")if(x){const M=NT(g.zoom,e.canonical)*g._pixelsPerMercatorPixel;S=Float32Array.from([M,0,0,M])}else S=g.calculatePixelsToTileUnitsMatrix(i);else S=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(g.projection),u_matrix:n.translatePosMatrix(e.projMatrix,i,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:bs.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:KC,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:m.paint.get("circle-emissive-strength")};if(x){A.u_inv_rot_matrix=o,A.u_merc_center=c,A.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],A.u_zoom_transition=Id(g.zoom);const M=c[0]*Lt,P=c[1]*Lt;A.u_up_dir=g.projection.upVector(new Cl(0,0,0),M,P)}return A},r.e1=Mw,r.e2=oo,r.e3=(n,e,i,o,c,m,g,x,S,A)=>{const M=n.transform,P=M.pitch<15?Iw(.07,.7,X((14-M.zoom)/5,0,1)):.07,k=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:r0(n,e,i,o),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:c,u_width_scale:m,u_floor_width_scale:g,u_image:0,u_tile_units_to_pixels:Dw(e,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(k?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:De(e.tileID.canonical,0),u_ground_shadow_factor:S,u_pattern_transition:A}},r.e4=(n,e,i,o,c,m,g,x,S,A)=>{const M=n.transform,P=M.calculatePixelsToTileUnitsMatrix(e),k=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",U=M.pitch<15?Iw(.07,.7,X((14-M.zoom)/5,0,1)):.07;return{u_matrix:r0(n,e,i,o),u_pixels_to_tile_units:P,u_device_pixel_ratio:m,u_width_scale:g,u_floor_width_scale:x,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:c,u_texsize:Pw(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Dw(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(k?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:U,u_tile_to_meter:De(e.tileID.canonical,0),u_ground_shadow_factor:A}},r.e5=Le,r.e6=Dg,r.e7=Ae,r.e8=Cd,r.e9=Ng,r.eA=o1,r.eB=kd,r.eC=ol,r.eD=[1,1,1],r.eE=Ud,r.eF=ha,r.eG=function(n,e,i,o){var c=e[0],m=e[1],g=e[2],x=e[3];return n[0]=c+o*(i[0]-c),n[1]=m+o*(i[1]-m),n[2]=g+o*(i[2]-g),n[3]=x+o*(i[3]-x),n},r.eH=Mf,r.eI=jl,r.eJ=Hl,r.eK=function(n,e,i,o,c,m,g,x,S,A,M,P,k,U,V,q){var J=new N(16);return J[0]=n,J[1]=e,J[2]=i,J[3]=o,J[4]=c,J[5]=m,J[6]=g,J[7]=x,J[8]=S,J[9]=A,J[10]=M,J[11]=P,J[12]=k,J[13]=U,J[14]=V,J[15]=q,J},r.eL=L,r.eM=Vp,r.eN=Up,r.eO=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new vt(1/0,1/0),max:new vt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const i=sS(new vt(0,0),new vt(Lt,Lt),n),o=[];if(e&&!cw(i,this._globalClipBounds))return o;for(const c of this._activeRegions){if(c.hiddenByOverlap||!cw(i,c))continue;const m=lA(c.min,c.max,n);o.push({min:m.min,max:m.max,sourceId:this._sourceIds[c.priority],footprint:c.footprint,footprintTileId:c.tileId,order:c.order,clipMask:c.clipMask,clipScope:c.clipScope})}return o}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const o of e.cache.getVisibleCoordinates()){const c=e.cache.getTile(o).buckets[e.layer];c&&c.updateFootprints(o.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const i=n.getOrder(),o=n.getClipMask(),c=n.getClipScope();for(const m of e){if(!m.footprint)continue;const g=sS(m.footprint.min,m.footprint.max,m.id);this._activeRegions.push({min:g.min,max:g.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:m.id,footprint:m.footprint,order:i,clipMask:o,clipScope:c})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Rf(e.min,i.min)||Rf(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(o,c){const m=(g,x)=>g+x;return o.length-c.length||o.reduce(m,"").localeCompare(c.reduce(m,""))}(e.clipScope,i.clipScope));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const i=this._activeRegions[e],o=this._prevRegions[e];n=i.priority!==o.priority||!Lg(i,o)||i.order!==o.order||i.clipMask!==o.clipMask||!To(i.clipScope,o.clipScope),this._activeRegions[e].hiddenByOverlap=o.hiddenByOverlap,++e}}if(n){++this._updateTime;for(const i of this._activeRegions)i.order!==Jp&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const o=this._activeRegions;if(i>=o.length)return i;const c=o[i].priority;for(;i<o.length&&o[i].priority===c;)++i;return i};if(this._sourceIds.length>1){let i=0,o=e(i);for(;i!==o;){let c=i;const m=i;for(;c!==o;){const g=this._activeRegions[c];g.hiddenByOverlap=!1;for(let x=0;x<m;x++){const S=this._activeRegions[x];if(!S.hiddenByOverlap&&g.order===Jp&&cw(g,S)&&(g.hiddenByOverlap=lS(g.footprint,g.tileId,S.footprint,S.tileId),g.hiddenByOverlap))break}++c}i=o,o=e(i)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},r.eP=Jp,r.eQ=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const i=new Wo,o=new ar,c=[],m=n+1+2,g=e[0]+1,x=e[0]+1+(1+e.length),S=(A,M,P)=>{let k=A===m-1?A-2:A===0?A:A-1;return k+=P?24575:0,[k,M]};for(let A=0;A<m;++A)i.emplaceBack(...S(A,0,!0));for(let A=0;A<g;++A)for(let M=0;M<m;++M)i.emplaceBack(...S(M,A,(M===0||M===m-1)&&!0));for(let A=0;A<e.length;++A){const M=e[A];for(let P=0;P<m;++P)i.emplaceBack(...S(P,M,!0))}for(let A=0;A<e.length;++A){const M=o.length,P=e[A]+1+2,k=new ar;for(let q=0;q<P-1;q++){const J=q===P-2,ee=J?m*(x-e.length+A-q):m;for(let ae=0;ae<m-1;ae++){const le=q*m+ae;q===0||J||ae===0||ae===m-2?(k.emplaceBack(le+1,le,le+ee),k.emplaceBack(le+ee,le+ee+1,le+1)):(o.emplaceBack(le+1,le,le+ee),o.emplaceBack(le+ee,le+ee+1,le+1))}}const U=ta.simpleSegment(0,M,i.length,o.length-M);for(let q=0;q<k.uint16.length;q+=3)o.emplaceBack(k.uint16[q],k.uint16[q+1],k.uint16[q+2]);const V=ta.simpleSegment(0,M,i.length,o.length-M);c.push({withoutSkirts:U,withSkirts:V})}return{vertices:i,indices:o,segments:c}}_createGrid(n){const e=this._fillGridMeshWithLods(p,y);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,Hb.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new ar;for(let g=0;g<=p;g++)e.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new Ph,o=new Ph,c=new Ph,m=new Ph;this._poleSegments=[];for(let g=0,x=0;g<f;g++){const S=360/(1<<g);i.emplaceBack(0,-Bs,0,.5,0),o.emplaceBack(0,-Bs,0,.5,1),c.emplaceBack(0,-Bs,0,.5,.5),m.emplaceBack(0,-Bs,0,.5,.5);for(let A=0;A<=p;A++){let M=A/p,P=0;const k=wi(0,S,M),[U,V,q]=R(Kb,YC,k,Bs);i.emplaceBack(U,V,q,M,P),o.emplaceBack(U,V,q,M,1-P);const J=cn(k);M=.5+.5*Math.sin(J),P=.5+.5*Math.cos(J),c.emplaceBack(U,V,q,M,P),m.emplaceBack(U,V,q,M,1-P)}this._poleSegments.push(ta.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,Ag,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(o,Ag,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(c,Ag,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(m,Ag,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},r.eR=Dx,r.eS=ie,r.eT=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.eU=W,r.eV=Te,r.eW=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},r.eX=Do,r.eY=D,r.eZ=Gi,r.e_=ri,r.ea=_S,r.eb=If,r.ec=uA,r.ed=uS,r.ee=Ce,r.ef=function(n,e){if(n===e){var i=e[1],o=e[2],c=e[3],m=e[6],g=e[7],x=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=i,n[6]=e[9],n[7]=e[13],n[8]=o,n[9]=m,n[11]=e[14],n[12]=c,n[13]=g,n[14]=x}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},r.eg=e1,r.eh=dn,r.ei=uy,r.ej=256,r.ek=Wb,r.el=Fs,r.em=kt,r.en=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},r.eo=Ph,r.ep=px,r.eq=Z_,r.er=function(n,e,i,o,c){return X((n-e)/(i-e)*(c-o)+o,o,c)},r.es=xs,r.et=function(n,e){var i=e[0],o=e[1],c=e[2],m=e[3],g=e[4],x=e[5],S=e[6],A=e[7],M=e[8],P=M*g-x*A,k=-M*m+x*S,U=A*m-g*S,V=i*P+o*k+c*U;return V?(n[0]=P*(V=1/V),n[1]=(-M*o+c*A)*V,n[2]=(x*o-c*g)*V,n[3]=k*V,n[4]=(M*i-c*S)*V,n[5]=(-x*i+c*m)*V,n[6]=U*V,n[7]=(-A*i+o*S)*V,n[8]=(g*i-o*m)*V,n):null},r.eu=2,r.ev=Cn,r.ew=wa,r.ex=Ui,r.ey=function(n,e){var i=new N(3);Ui(i,e);var o=1/i[0],c=1/i[1],m=1/i[2],g=e[0]*o,x=e[1]*c,S=e[2]*m,A=e[4]*o,M=e[5]*c,P=e[6]*m,k=e[8]*o,U=e[9]*c,V=e[10]*m,q=g+M+V,J=0;return q>0?(J=2*Math.sqrt(q+1),n[3]=.25*J,n[0]=(P-U)/J,n[1]=(k-S)/J,n[2]=(x-A)/J):g>M&&g>V?(J=2*Math.sqrt(1+g-M-V),n[3]=(P-U)/J,n[0]=.25*J,n[1]=(x+A)/J,n[2]=(k+S)/J):M>V?(J=2*Math.sqrt(1+M-g-V),n[3]=(k-S)/J,n[0]=(x+A)/J,n[1]=.25*J,n[2]=(P+U)/J):(J=2*Math.sqrt(1+V-g-M),n[3]=(x-A)/J,n[0]=(k+S)/J,n[1]=(P+U)/J,n[2]=.25*J),n},r.ez=function(n,e){var i=2*Math.acos(e[3]),o=Math.sin(i/2);return o>z?(n[0]=e[0]/o,n[1]=e[1]/o,n[2]=e[2]/o):(n[0]=1,n[1]=0,n[2]=0),i},r.f=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},r.f0=bo,r.f1=Uh,r.f2=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!function(i){if(oa==null){const o=i.navigator?i.navigator.userAgent:null;oa=!!i.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return oa}(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},r.f3=function(n,e){Nr=n,os=e},r.f4=Xb,r.f5=BT,r.f6=function(n){const e=[0,0,0],i=be(new Float64Array(16));return Be(i,n.pixelMatrix,n.globeMatrix),Bn(e,e,i),new vt(e[0],e[1])},r.f7=function(){const n=By;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(em),By=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.f8=function(){Nx().acquire(em)},r.f9=iy,r.fA=bt,r.fB=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==jx){const i=new Uint32Array(n,0,7),[,,o,c,m,g]=i;e=i.byteLength+c+m+g+m,(o!==n.byteLength||e>=n.byteLength)&&Yt("Invalid b3dm header information.")}return $g(n,e)},r.fC=function(n,e){const i=Zu(n);for(const o of i){for(const c of o.meshes)Sw(c);o.lights&&(o.lightMeshIndex=o.meshes.length,o.meshes.push(LS(o.lights,e)))}return i},r.fD=xv,r.fE=Or,r.fF=AS,r.fG=tl,r.fH=Ss,r.fI=function(n){gl(),pn!=null&&pn.then(e=>{e.keys().then(i=>{for(let o=0;o<i.length-n;o++)e.delete(i[o]).catch(c=>Yt(c.message))}).catch(i=>Yt(i.message))}).catch(e=>Yt(e.message))},r.fa=function(n,e,i=!1){if(Ln===Ss.deferred||Ln===Ss.loading||Ln===Ss.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Br=bs.resolveURL(n),Ln=Ss.deferred,Sn=e,Vl(),i||ny()},r.fb=function(n){Ug=bs.resolveURL(n),Vg||(Vg=new Bg(Nx(),new mn)),Vg.broadcast("setMeshoptUrl",Ug)},r.fc=DS,r.fd=function(n){Bx=bs.resolveURL(n),Vg||(Vg=new Bg(Nx(),new mn)),Vg.broadcast("setDracoUrl",Bx)},r.fe=IS,r.ff=Df,r.fg=function(n){const e=ao();if(!e)return;const i=e.delete(xu);n&&i.then(()=>n()).catch(n)},r.fh=tm,r.fi=ai,r.fj=zh,r.fk=au,r.fl=wE,r.fm=TE,r.fn=gc,r.fo=Jt,r.fp="hd_road_elevation",r.fq=Fi,r.fr=gt,r.fs=Rl,r.ft=Qy,r.fu=Nf,r.fv=function(n,e,i,o,c,m,g,x=1,S,A,M){n.createArrays(),n.tilePixelRatio=Lt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const P=n.layers[0].layout,k=n.layers[0]._unevaluatedLayout._values,U={};U.scaleFactor=x,U.textSizeScaleRange=P.get("text-size-scale-range"),U.iconSizeScaleRange=P.get("icon-size-scale-range");const[V,q]=U.textSizeScaleRange,[J,ee]=U.iconSizeScaleRange;U.textScaleFactor=X(U.scaleFactor,V,q),U.iconScaleFactor=X(U.scaleFactor,J,ee);const ae=k["text-size"],le=k["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:Fe,maxZoom:rt}=n.textSizeData;U.compositeTextSizes=[ae.possiblyEvaluate(new Er(Fe,{worldview:M}),m),ae.possiblyEvaluate(new Er(rt,{worldview:M}),m)]}if(n.iconSizeData.kind==="composite"){const{minZoom:Fe,maxZoom:rt}=n.iconSizeData;U.compositeIconSizes=[le.possiblyEvaluate(new Er(Fe,{worldview:M}),m),le.possiblyEvaluate(new Er(rt,{worldview:M}),m)]}U.layoutTextSize=ae.possiblyEvaluate(new Er(g+1,{worldview:M}),m),U.layoutIconSize=le.possiblyEvaluate(new Er(g+1,{worldview:M}),m),U.textMaxSize=ae.possiblyEvaluate(new Er(18,{worldview:M}),m);const de=P.get("symbol-placement"),Re=P.get("text-rotation-alignment")==="map"&&de!=="point",Se=P.get("text-size");let Pe=!1;const ke=[];for(const Fe of n.features){const rt=P.get("text-font").evaluate(Fe,{},m).join(","),qe=Se.evaluate(Fe,{},m)*U.textScaleFactor,ot=U.layoutTextSize.evaluate(Fe,{},m)*U.textScaleFactor,ht=U.layoutIconSize.evaluate(Fe,{},m)*U.iconScaleFactor,yt={horizontal:{},vertical:void 0},Tt=Fe.text;let Et,pt=[0,0];if(Tt){const hn=Tt.toString(),wn=P.get("text-letter-spacing").evaluate(Fe,{},m)*zo,Xi=P.get("text-line-height").evaluate(Fe,{},m)*zo,Gn=fx(hn)?wn:0,Yn=P.get("text-anchor").evaluate(Fe,{},m),Yr=P.get("text-variable-anchor");if(!Yr){const ct=P.get("text-radial-offset").evaluate(Fe,{},m);if(ct)pt=$w(Yn,[ct*zo,av]);else{const Ht=P.get("text-offset").evaluate(Fe,{},m);pt=[Ht[0]*zo,Ht[1]*zo]}}let Ee=Re?"center":P.get("text-justify").evaluate(Fe,{},m);const ve=de==="point",at=ve?P.get("text-max-width").evaluate(Fe,{},m)*zo:1/0,Bt=ct=>{n.allowVerticalPlacement&&Q_(hn)&&(yt.vertical=u0(Tt,e,i,c,rt,at,Xi,Yn,ct,Gn,pt,ll.vertical,!0,ot,qe,S))};if(!Re&&Yr){const ct=Ee==="auto"?Yr.map(xi=>sv(xi)):[Ee];let Ht=!1;for(let xi=0;xi<ct.length;xi++){const gi=ct[xi];if(!yt.horizontal[gi])if(Ht)yt.horizontal[gi]=yt.horizontal[0];else{const Ki=u0(Tt,e,i,c,rt,at,Xi,"center",gi,Gn,pt,ll.horizontal,!1,ot,qe,S);Ki&&(yt.horizontal[gi]=Ki,Ht=Ki.positionedLines.length===1)}}Bt("left")}else{if(Ee==="auto"&&(Ee=sv(Yn)),ve||P.get("text-writing-mode").indexOf("horizontal")>=0||!Q_(hn)){const ct=u0(Tt,e,i,c,rt,at,Xi,Yn,Ee,Gn,pt,ll.horizontal,!1,ot,qe,S);ct&&(yt.horizontal[Ee]=ct)}Bt(ve?"left":Ee)}}let St,tt,Qe,xt,wt,_t,mt=!1;const si=P.get("icon-text-fit").evaluate(Fe,{},m);if(Fe.icon&&Fe.icon.hasPrimary()){const hn=n_(Fe.icon,n.iconSizeData,k["icon-size"],m,n.zoom,Fe,S,U.iconScaleFactor,M);St=hn.iconPrimary,Qe=hn.iconSecondary;const wn=St.toString();if(tt=o.get(wn),tt&&(wt=P.get("icon-offset").evaluate(Fe,{},m),_t=P.get("icon-anchor").evaluate(Fe,{},m),Et=Ky(c.get(wn),Qe?c.get(Qe.toString()):void 0,wt,_t),mt=tt.sdf,n.sdfIcons===void 0?n.sdfIcons=tt.sdf:n.sdfIcons!==tt.sdf&&Yt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(tt.pixelRatio!==n.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),Qe){const Xi=Qe.toString();xt=o.get(Xi)}}Pe=Pe||!(!Fe.icon||!Fe.icon.hasSecondary());const qt=cl(yt.horizontal)||yt.vertical;n.iconsInText||(n.iconsInText=!!qt&&qt.iconsInText);const Gt=ot*U.textScaleFactor/zo,{defaultShapedIcon:ji,verticallyShapedIcon:Zt}=LA(n,Et,P,Fe,m,yt,Gt,wt,si);si!=="none"&&Et&&(_0(Et)||y0(Et))&&(S0(0,tt,St,Et,ji,si,A,o,c),S0(0,xt,Qe,Et,ji,si,A,o,c),Zt&&(S0(0,tt,St,Et,Zt,si,A,o,c),S0(0,xt,Qe,Et,Zt,si,A,o,c))),Et=ji;const{iconBBox:Si,iconVerticalBBox:Zi}=Ww(n,Et,Zt,P,Fe,m,ht,wt,U,c,_t);ke.push({feature:Fe,shapedTextOrientations:yt,shapedText:qt,shapedIcon:Et,iconPrimary:St,iconSecondary:Qe,iconOffset:wt,iconAnchor:_t,verticallyShapedIcon:Zt,layoutTextSize:ot,layoutIconSize:ht,textOffset:pt,isSDFIcon:mt,iconTextFit:si,iconCollisionBounds:Si,iconVerticalCollisionBounds:Zi})}return{featureData:ke,sizes:U,hasAnySecondaryIcon:Pe,textAlongLine:Re,symbolPlacement:de}},r.fw=ev,r.fx=function(n,e,i,o,c,m,g,x,S,A){n.iconAtlasPositions=A.iconPositions;const{featureData:M,hasAnySecondaryIcon:P,sizes:k,textAlongLine:U,symbolPlacement:V}=e;for(const q of M){const{shapedIcon:J,verticallyShapedIcon:ee,feature:ae,shapedTextOrientations:le,shapedText:de,layoutTextSize:Re,textOffset:Se,isSDFIcon:Pe,iconPrimary:ke,iconSecondary:Fe,iconTextFit:rt,iconOffset:qe,iconCollisionBounds:ot,iconVerticalCollisionBounds:ht}=q;ou(J,A.iconPositions,ke,Fe),ou(ee,A.iconPositions,ke,Fe),Zw(le,A.iconPositions),ov(ke,Fe,A.iconPositions),(de||J)&&jf(n,ae,le,J,ee,S,k,Re,0,Se,Pe,o,c,g,x,P,rt,qe,U,V,ot,ht)}i&&n.generateCollisionDebugBuffers(m,n.collisionBoxArray,k.textScaleFactor)},r.fy=di,r.fz=J0,r.g=function(n,e){return wu(Object.assign(n,{method:"GET"}),e)},r.h=function(n){return n.indexOf("mapbox:")===0},r.i=function(n){return Tr.API_STYLE_REGEX.test(n)&&!ro(n)},r.j=sa,r.k=$d,r.l=function(n){return decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.m=function(n,e){return wu(Object.assign(n,{type:"json"}),e)},r.n=sc,r.o=bs,r.p=function(n,e){return wu(Object.assign(n,{method:"POST"}),e)},r.q=Xo,r.r=Ko,r.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=function(){return yw||(yw=new tm),yw},r.u=function(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()},r.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},r.w=Yt,r.x=Sv,r.y=zt,r.z=Ye}),E(["./shared"],function(r){function z(ie){const W=ie?ie.url.toString():void 0;return W?performance.getEntriesByName(W):[]}function N(ie){if(typeof ie=="number"||typeof ie=="boolean"||typeof ie=="string"||ie==null)return JSON.stringify(ie);if(Array.isArray(ie)){let X="[";for(const he of ie)X+=`${N(he)},`;return`${X}]`}let W="{";for(const X of Object.keys(ie).sort())W+=`${X}:${N(ie[X])},`;return`${W}}`}function H(ie){let W="";for(const X of r.bw)W+=`/${N(ie[X])}`;return W}class K{constructor(W){this.keyCache={},this._layers={},this._layerConfigs={},W&&this.replace(W)}replace(W,X){this._layerConfigs={},this._layers={},this.update(W,[],X)}update(W,X,he){this._options=he;for(const ye of W)this._layerConfigs[ye.id]=ye,(this._layers[ye.id]=r.dt(ye,this.scope,null,this._options)).compileFilter(he),this.keyCache[ye.id]&&delete this.keyCache[ye.id];for(const ye of X)delete this.keyCache[ye],delete this._layerConfigs[ye],delete this._layers[ye];this.familiesBySource={};const we=function(ye,Me){const Ve={};for(let $e=0;$e<ye.length;$e++){const gt=ye[$e];let ut=Me&&Me[gt.id];ut||(gt.type==="symbol"?ut=gt.id:(ut=H(gt),gt.type==="line"&&gt.paint&&function Ci(_i){return typeof _i=="string"&&_i==="line-progress"||(Array.isArray(_i)?_i.some(Ci):!(!_i||typeof _i!="object")&&Object.values(_i).some(Ci))}(gt.paint["line-width"])&&(ut+=`/${N(gt.paint["line-width"])}`))),Me&&(Me[gt.id]=ut);let Kt=Ve[ut];Kt||(Kt=Ve[ut]=[]),Kt.push(gt)}const Le=[];for(const $e in Ve)Le.push(Ve[$e]);return Le}(Object.values(this._layerConfigs),this.keyCache);for(const ye of we){const Me=ye.map(Kt=>this._layers[Kt.id]),Ve=Me[0];if(Ve.visibility==="none")continue;const Le=Ve.source||"";let $e=this.familiesBySource[Le];$e||($e=this.familiesBySource[Le]={});const gt=Ve.sourceLayer||"_geojsonTileLayer";let ut=$e[gt];ut||(ut=$e[gt]=[]),ut.push(Me)}}}const ne=1*r.fk;class ue{constructor(W){const X={},he=[];for(const Ve in W){const Le=W[Ve],$e=X[Ve]={};for(const gt in Le.glyphs){const ut=Le.glyphs[+gt];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;const Kt=ut.metrics.localGlyph?ne:1,Ci={x:0,y:0,w:ut.bitmap.width+2*Kt,h:ut.bitmap.height+2*Kt};he.push(Ci),$e[gt]=Ci}}const{w:we,h:ye}=r.G(he),Me=new r.fj({width:we||1,height:ye||1});for(const Ve in W){const Le=W[Ve];for(const $e in Le.glyphs){const gt=Le.glyphs[+$e];if(!gt||gt.bitmap.width===0||gt.bitmap.height===0)continue;const ut=X[Ve][$e],Kt=gt.metrics.localGlyph?ne:1;r.fj.copy(gt.bitmap,Me,{x:0,y:0},{x:ut.x+Kt,y:ut.y+Kt},gt.bitmap)}}this.image=Me,this.positions=X}}function pe(ie,W,X){ie[W]?X&&(ie[W].center=X):ie[W]={floorIds:new Set,center:X||[0,0],floors:{}}}function xe(ie,W,X,he){for(const we of W)pe(ie,we),ie[we].floors[X]=he,ie[we].floorIds.add(X)}function be(ie){return{id:ie.properties.id.toString(),center:ie.properties.center.toString().split(";").map(Number)}}function je(ie){return{id:ie.properties.id.toString(),isDefault:!!ie.properties.is_default&&ie.properties.is_default,connections:ie.properties.connected_floor_ids?new Set(ie.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:ie.properties.conflicted_floor_ids?new Set(ie.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:ie.properties.building_ids?new Set(ie.properties.building_ids.toString().split(";")):new Set,name:ie.properties.name.toString(),zIndex:ie.properties.z_index}}function Be(ie,W){return W.every(X=>ie.properties&&ie.properties[X]!=null)}function He(ie){return Be(ie,["type","id","name"])&&ie.properties.type==="building"}function Xe(ie){return Be(ie,["type","id","name","z_index"])&&ie.properties.type==="floor"}r.fi(ue,"GlyphAtlas");class it{constructor(W){this.tileID=new r.aP(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.tileZoom=W.tileZoom,this.uid=W.uid,this.zoom=W.zoom,this.lut=W.lut,this.canonical=W.tileID.canonical,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.scope=W.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.request&&W.request.collectResourceTiming,this.promoteId=W.promoteId,this.isSymbolTile=W.isSymbolTile,this.tileTransform=r.aY(W.tileID.canonical,W.projection),this.projection=W.projection,this.worldview=W.worldview,this.localizableLayerIds=W.localizableLayerIds,this.brightness=W.brightness,this.extraShadowCaster=!!W.extraShadowCaster,this.tessellationStep=W.tessellationStep,this.scaleFactor=W.scaleFactor,this.worldview=W.worldview,this.indoor=W.indoor}parse(W,X,he,we,ye,Me){this.status="parsing",this.data=W,this.collisionBoxArray=new r.b2;const Ve=new r.fl(Object.keys(W.layers).sort()),Le=new r.fm(this.tileID,this.promoteId);Le.bucketLayerIDs=[];const $e={},gt=new r.fn(256,256),ut={featureIndex:Le,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:gt,availableImages:he,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const Yt=this.indoor.indoorState.activeFloorsVisible,Yi=function(ln,lr,Or){const Ta=function(er,bn){if(!er)return r.w("No source layers defined in indoor specification"),bn;if(er.size===0)return bn;const Rr=er.difference(bn);for(const Gr of Rr)r.w(`Missing source layer required in indoor specification: ${Gr}`);return bn.intersection(bn)}(lr.sourceLayers,new Set(Object.keys(ln.layers))),oa=lr.indoorState,Kr=function(er,bn,Rr,Gr){const rr=new Set,Tr=new Set,sa=new Set,ro=new Map,Ho={},Ll=Ia=>{const as=ro.get(Ia)||new Set;for(const Po of rr)if((ro.get(Po)||new Set).has(Ia)||as.has(Po))return!0;return!1};for(const Ia of bn){const as=er.layers[Ia];if(as)for(let Po=0;Po<as.length;Po++){const Js=as.feature(Po);if(He(Js)){const{id:Ko,center:bs}=be(Js);pe(Ho,Ko,bs),rr.add(Ko)}else if(Xe(Js)){const{id:Ko,isDefault:bs,connections:Rc,conflicts:ch,buildings:xu,name:Nr,zIndex:os}=je(Js);xe(Ho,xu,Ko,{name:Nr,zIndex:os}),ro.set(Ko,ch),(Ko===Gr||Rc.has(Gr))&&rr.add(Ko),Tr.add(Ko),bs&&sa.add(Ko)}}else r.w(`indoor source layer not found: ${Ia}`)}if(Rr)for(const Ia of Rr)Tr.has(Ia)&&(Ll(Ia)||rr.add(Ia));for(const Ia of sa)rr.has(Ia)||Ll(Ia)||rr.add(Ia);return{buildings:Ho,activeFloors:rr}}(ln,Ta,oa.lastActiveFloors,oa.selectedFloorId);return Or.send("setIndoorData",Kr),Kr}(W,this.indoor,ye);ut.activeFloors=Yt?Yi.activeFloors:void 0}const Kt=[],Ci=X.familiesBySource[this.source];for(const Yt in Ci){const Yi=W.layers[Yt];if(!Yi)continue;let ln=!1,lr=!1,Or=!1;for(const er of Ci[Yt])er[0].type==="symbol"?ln=!0:lr=!0,er[0].is3D()&&er[0].type!=="model"&&(Or=!0);if(this.extraShadowCaster&&!Or||this.isSymbolTile===!0&&!ln||this.isSymbolTile===!1&&!lr)continue;Yi.version===1&&r.w(`Vector tile source "${this.source}" layer "${Yt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ta=Ve.encode(Yt),oa=[];let Kr=!1;for(let er=0,bn=0;er<Yi.length;er++){const Rr=Yi.feature(er),Gr=Le.getId(Rr,Yt);if(this.localizableLayerIds&&this.localizableLayerIds.has(Yt)){const rr=Rr.properties?Rr.properties.worldview:null;if(this.worldview&&typeof rr=="string")if(rr==="all")Rr.properties.$localized=!0;else{if(!rr.split(",").includes(this.worldview))continue;Rr.properties.$localized=!0,Rr.properties.worldview=this.worldview}}!Kr&&Rr.properties&&Rr.properties.hasOwnProperty(r.fo)&&(Kr=!0),oa.push({feature:Rr,id:Gr,index:bn,sourceLayerIndex:Ta}),bn++}Kr&&!ut.elevationFeatures&&W.layers.hasOwnProperty(r.fp)&&(ut.elevationFeatures=r.fq.parseFrom(W.layers[r.fp],this.canonical));for(const er of Ci[Yt]){const bn=er[0];if(this.extraShadowCaster&&(!bn.is3D()||bn.type==="model")||this.isSymbolTile!==void 0&&bn.type==="symbol"!==this.isSymbolTile||bn.minzoom&&this.zoom<Math.floor(bn.minzoom)||bn.maxzoom&&this.zoom>=bn.maxzoom||bn.visibility==="none")continue;kt(er,this.zoom,ut.brightness,he,this.worldview);const Rr=$e[bn.id]=bn.createBucket({index:Le.bucketLayerIDs.length,layers:er,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ta,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:we,worldview:this.worldview});Le.bucketLayerIDs.push(er.map(rr=>r.B(rr.id,rr.scope)));let Gr=Rr.prepare?Rr.prepare():null;Gr!=null?(Gr=Gr.then(()=>Rr.populate(oa,ut,this.tileID.canonical,this.tileTransform)),Kt.push(Gr)):Rr.populate(oa,ut,this.tileID.canonical,this.tileTransform)}}const _i=()=>{let Yt,Yi,ln,lr,Or,Ta;gt.trim();const oa={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Kr=()=>{if(Yt)return this.status="done",Me(Yt);if(this.extraShadowCaster)this.status="done",Me(null,{buckets:Object.values($e).filter(bn=>!bn.isEmpty()),featureIndex:Le,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ut.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Yi&&ln&&lr){const bn=new ue(Yi),Rr=new Map;for(const[Tr,sa]of ln.entries()){const{imagePosition:ro}=r.ft(Tr,sa,r.fu);Rr.set(Tr,ro)}const Gr={};for(const Tr in $e){const sa=$e[Tr];sa instanceof r.b3&&(kt(sa.layers,this.zoom,ut.brightness,he,this.worldview),Gr[Tr]=r.fv(sa,Yi,bn.positions,ln,Rr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Or,this.worldview))}const rr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(ye,ln,Or,()=>{rr.iconsPending=!1,er(Gr,bn,rr)}),this.rasterizeIfNeeded(ye,lr,Ta,()=>{rr.patternsPending=!1,er(Gr,bn,rr)})}},er=(bn,Rr,Gr,rr)=>{if(Gr.iconsPending||Gr.patternsPending)return;const Tr=new r.fw(ln,lr,this.lut);for(const sa in $e){const ro=$e[sa];if(sa in bn)r.fx(ro,bn[sa],this.showCollisionBoxes,he,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,ln,Tr);else if(ro.hasPattern&&(ro instanceof r.b9||ro instanceof r.ba||ro instanceof r.e9)){kt(ro.layers,this.zoom,ut.brightness,he,this.worldview);const Ho=Object.fromEntries(Tr.patternPositions);ro.addFeatures(ut,this.tileID.canonical,Ho,he,this.tileTransform,this.brightness)}}this.status="done",Me(null,{buckets:Object.values($e).filter(sa=>!sa.isEmpty()),featureIndex:Le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Rr.image,lineAtlas:gt,imageAtlas:Tr,brightness:ut.brightness})};if(!this.extraShadowCaster){const bn=r.fr(ut.glyphDependencies,rr=>Object.keys(rr).map(Number));Object.keys(bn).length?ye.send("getGlyphs",{uid:this.uid,stacks:bn},(rr,Tr)=>{Yt||(Yt=rr,Yi=Tr,Kr())},void 0,!1,oa):Yi={};const Rr=Array.from(ut.iconDependencies.keys()).map(rr=>r.I.parse(rr));Rr.length?ye.send("getImages",{images:Rr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(rr,Tr)=>{Yt||(Yt=rr,ln=new Map,Or=this.updateImageMapAndGetImageTaskQueue(ln,Tr,ut.iconDependencies),Kr())},void 0,!1,oa):(ln=new Map,Or=new Map);const Gr=Array.from(ut.patternDependencies.keys()).map(rr=>r.I.parse(rr));Gr.length?ye.send("getImages",{images:Gr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(rr,Tr)=>{Yt||(Yt=rr,lr=new Map,Ta=this.updateImageMapAndGetImageTaskQueue(lr,Tr,ut.patternDependencies),Kr())},void 0,!1,oa):(lr=new Map,Ta=new Map)}if(ut.elevationFeatures&&ut.elevationFeatures.length>0){const bn=[];for(const Gr of Object.values($e))if(Gr instanceof r.ba){const rr=Gr.getUnevaluatedPortalGraph();rr&&bn.push(rr)}const Rr=r.fs.evaluate(bn);for(const Gr of Object.values($e))if(Gr instanceof r.ba){const rr=W.layers[Ve.decode(Gr.sourceLayerIndex)];Gr.setEvaluatedPortalGraph(Rr,rr,this.tileID.canonical,ut.availableImages,ut.brightness)}}Kr()};Kt.length>0?Promise.allSettled(Kt).then(_i).catch(Me):_i()}updateParameters(W){this.scaleFactor=W.scaleFactor,this.showCollisionBoxes=W.showCollisionBoxes,this.projection=W.projection,this.brightness=W.brightness,this.tileTransform=r.aY(W.tileID.canonical,W.projection),this.extraShadowCaster=W.extraShadowCaster,this.lut=W.lut,this.worldview=W.worldview,this.indoor=W.indoor}rasterizeIfNeeded(W,X,he,we){Array.from(X.values()).some(ye=>ye.usvg)?this.rasterize(W,X,he,we):we()}updateImageMapAndGetImageTaskQueue(W,X,he){const we=new Map;for(const ye of X.keys()){const Me=he.get(ye)||[];for(const Ve of Me){const Le=Ve.toString(),$e=X.get(Ve.id.toString());$e.usvg?we.has(Le)||(we.set(Le,Ve),W.set(Le,Object.assign({},$e))):W.set(Le,$e)}}return we}rasterize(W,X,he,we){this.rasterizeTask=W.send("rasterizeImages",{scope:this.scope,tasks:he},(ye,Me)=>{if(!ye)for(const[Ve,Le]of Me.entries()){const $e=Object.assign(X.get(Ve),{data:Le});X.set(Ve,$e)}we()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function kt(ie,W,X,he,we){const ye=new r.ac(W,{brightness:X,worldview:we});for(const Me of ie)Me.recalculate(ye,he)}class Nt extends r.E{constructor(W,X,he,we,ye,Me,Ve){super(),this.actor=W,this.layerIndex=X,this.availableImages=he,this.availableModels=we,this.loadVectorData=Me||r.aL,this.loading={},this.loaded={},this.deduped=new r.aK(W.scheduler),this.isSpriteLoaded=ye,this.scheduler=W.scheduler,this.brightness=Ve}loadTile(W,X){const he=W.uid,we=W&&W.request,ye=we&&we.collectResourceTiming,Me=this.loading[he]=new it(W);Me.abort=this.loadVectorData(W,(Ve,Le)=>{const $e=!this.loading[he];if(delete this.loading[he],Me.cancelRasterize(),$e||Ve||!Le)return Me.status="done",$e||(this.loaded[he]=Me),X(Ve);const gt=Le.rawData,ut={},Kt=r.aM(Le.responseHeaders);Kt&&Kt.expires&&(ut.expires=Kt.expires),Kt&&Kt.cacheControl&&(ut.cacheControl=Kt.cacheControl),Me.vectorTile=Le.vectorTile||new r.fy(new r.bs(gt));const Ci=()=>{Me.parse(Me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(_i,Yt)=>{if(_i||!Yt)return X(_i);const Yi={};if(ye){const ln=z(we);ln.length>0&&(Yi.resourceTiming=JSON.parse(JSON.stringify(ln)))}X(null,Object.assign({rawTileData:gt.slice(0),responseHeaders:Le.responseHeaders},Yt,ut,Yi))})};this.isSpriteLoaded?Ci():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Ci,{type:"parseTile",isSymbolTile:W.isSymbolTile,zoom:W.tileZoom}):Ci()}),this.loaded=this.loaded||{},this.loaded[he]=Me})}reloadTile(W,X){const he=this.loaded,we=W.uid;if(he&&he[we]){const ye=he[we];ye.updateParameters(W);const Me=(Ve,Le)=>{const $e=ye.reloadCallback;$e&&(delete ye.reloadCallback,ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,$e)),X(Ve,Le)};ye.status==="parsing"?ye.reloadCallback=Me:ye.status==="done"&&(ye.vectorTile?ye.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Me):Me())}else X(null,void 0)}abortTile(W,X){const he=W.uid,we=this.loading[he];we&&(we.abort&&we.abort(),delete this.loading[he]),X()}removeTile(W,X){const he=this.loaded,we=W.uid;he&&he[we]&&delete he[we],X()}}class oi{loadTile(W,X){const{uid:he,encoding:we,rawImageData:ye,padding:Me}=W,Ve=ImageBitmap&&ye instanceof ImageBitmap?this.getImageData(ye,Me):ye;X(null,new r.fz(he,Ve,we,Me<1))}reloadTile(W,X){X(null,null)}abortTile(W,X){X()}removeTile(W,X){X()}getImageData(W,X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);const he=this.offscreenCanvasContext.getImageData(-X,-X,W.width+2*X,W.height+2*X);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),he}}r.br.setPbf(r.bs);class yi{constructor(W){this._mrt=new r.br(W.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=W.uid,this.tileID=W.tileID,this.source=W.source}parse(W,X){const he=this._mrt;this.status="parsing",this._entireBuffer=W;try{he.parseHeader(W),this._isHeaderLoaded=!0;const we=[];for(const ye in he.layers){const Me=he.getLayer(ye),Ve=Me.getDataRange(Me.getBandList()),Le=he.createDecodingTask(Ve),$e=W.slice(Ve.firstByte,Ve.lastByte+1),gt=r.br.performDecoding($e,Le).then(ut=>Le.complete(null,ut)).catch(ut=>Le.complete(ut,null));we.push(gt)}Promise.allSettled(we).then(()=>X(null,he)).catch(ye=>X(ye))}catch(we){X(we)}}}class Ui{constructor(W){this.actor=W,this.loading={},this.loaded={}}loadTile(W,X){const he=W.uid,we=W.request,ye=this.loading[he]=new yi(W),{cancel:Me}=r.bt(we,(Ve,Le,$e)=>{const gt=!this.loading[he];if(delete this.loading[he],gt||Ve||!Le)return ye.status="done",gt||(this.loaded[he]=ye),X(Ve);ye.parse(Le,(ut,Kt)=>{if(ut||!Kt)return X(ut);X(null,Kt,$e)}),this.loaded[he]=ye});ye.abort=Me}reloadTile(W,X){X(null,void 0)}abortTile(W,X){const he=W.uid,we=this.loading[he];we&&(we.abort&&we.abort(),delete this.loading[he]),X()}removeTile(W,X){const he=W.uid;this.loaded[he]&&delete this.loaded[he],X()}decodeRasterArray(W,X){r.br.performDecoding(W.buffer,W.task).then(he=>X(null,he)).catch(he=>X(he))}}const hi=r.fA.prototype.toGeoJSON;class Ti{constructor(W){this._feature=W,this.extent=r.al,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))}loadGeometry(){if(this._feature.type===1){const W=[];for(const X of this._feature.geometry)W.push([new r.P(X[0],X[1])]);return W}{const W=[];for(const X of this._feature.geometry){const he=[];for(const we of X)he.push(new r.P(we[0],we[1]));W.push(he)}return W}}toGeoJSON(W,X,he){return hi.call(this,W,X,he)}}class Dt{constructor(W,X){this.name=W,this.extent=r.al,this.length=X.length,this._jsonFeatures=X}feature(W){return new Ti(this._jsonFeatures[W])}}class Di{constructor(W){this.layers={},this.extent=r.al;for(const X of Object.keys(W))this.layers[X]=new Dt(X,W[X])}}const Qt=64/4096,ui=128;class ri{constructor(){this.features=new Map}clear(){this.features.clear()}load(W=[],X){for(const he of W){const we=he.id;if(we==null)continue;let ye=this.features.get(we);ye&&this.updateCache(ye,X),he.geometry?(ye=En(he),this.updateCache(ye,X),this.features.set(we,ye)):this.features.delete(we),this.updateCache(ye,X)}}updateCache(W,X){for(const{canonical:he,uid:we}of Object.values(X)){const{z:ye,x:Me,y:Ve}=he;zi(W,Math.pow(2,ye),Me,Ve)&&delete X[we]}}getTile(W,X,he){const we=Math.pow(2,W),ye=[];for(const Me of this.features.values())zi(Me,we,X,he)&&ye.push(xn(Me,we,X,he));return{features:ye}}getFeatures(){return[...this.features.values()]}}function zi({minX:ie,minY:W,maxX:X,maxY:he},we,ye,Me){return ie<(ye+1+Qt)/we&&W<(Me+1+Qt)/we&&X>(ye-Qt)/we&&he>(Me-Qt)/we}function En(ie){const{id:W,geometry:X,properties:he}=ie;if(!X)return;if(X.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:we,coordinates:ye}=X,Me={id:W,type:1,geometry:[],tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ve=Me.geometry;if(we==="Point")hr(ye,Ve,Me);else if(we==="MultiPoint")for(const Le of ye)hr(Le,Ve,Me);else if(we==="LineString")Me.type=2,wr(ye,Ve,Me);else if(we==="MultiLineString")Me.type=2,Jn(ye,Ve,Me);else if(we==="Polygon")Me.type=3,Jn(ye,Ve,Me,!0);else{if(we!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Me.type=3;for(const Le of ye)Jn(Le,Ve,Me,!0)}return Me}function hr([ie,W],X,he){const we=r.aF(ie);let ye=r.aJ(W);ye=ye<0?0:ye>1?1:ye,X.push(we,ye),he.minX=Math.min(he.minX,we),he.minY=Math.min(he.minY,ye),he.maxX=Math.max(he.maxX,we),he.maxY=Math.max(he.maxY,ye)}function wr(ie,W,X,he=!1,we=!1){const ye=[];for(const Me of ie)hr(Me,ye,X);W.push(ye),he&&function(Me,Ve){let Le=0;for(let $e=0,gt=Me.length,ut=gt-2;$e<gt;ut=$e,$e+=2)Le+=(Me[$e]-Me[ut])*(Me[$e+1]+Me[ut+1]);if(Le>0===Ve)for(let $e=0,gt=Me.length;$e<gt/2;$e+=2){const ut=Me[$e],Kt=Me[$e+1];Me[$e]=Me[gt-2-$e],Me[$e+1]=Me[gt-1-$e],Me[gt-2-$e]=ut,Me[gt-1-$e]=Kt}}(ye,we)}function Jn(ie,W,X,he=!1){for(let we=0;we<ie.length;we++)wr(ie[we],W,X,he,we===0)}function xn(ie,W,X,he){const{id:we,type:ye,geometry:Me,tags:Ve}=ie,Le=[];if(ye===1)(function($e,gt,ut,Kt,Ci){for(let _i=0;_i<$e.length;_i+=2){const Yt=Math.round(r.al*($e[_i+0]*gt-ut)),Yi=Math.round(r.al*($e[_i+1]*gt-Kt));Ci.push([Yt,Yi])}})(Me,W,X,he,Le);else for(const $e of Me)mr($e,W,X,he,Le);return{id:we,type:ye,geometry:Le,tags:Ve}}function mr(ie,W,X,he,we){const ye=-ui,Me=r.al+ui;let Ve;for(let Le=0;Le<ie.length-2;Le+=2){let $e=Math.round(r.al*(ie[Le+0]*W-X)),gt=Math.round(r.al*(ie[Le+1]*W-he)),ut=Math.round(r.al*(ie[Le+2]*W-X)),Kt=Math.round(r.al*(ie[Le+3]*W-he));const Ci=ut-$e,_i=Kt-gt;$e<ye&&ut<ye||($e<ye?(gt+=Math.round(_i*((ye-$e)/Ci)),$e=ye):ut<ye&&(Kt=gt+Math.round(_i*((ye-$e)/Ci)),ut=ye),gt<ye&&Kt<ye||(gt<ye?($e+=Math.round(Ci*((ye-gt)/_i)),gt=ye):Kt<ye&&(ut=$e+Math.round(Ci*((ye-gt)/_i)),Kt=ye),$e>=Me&&ut>=Me||($e>=Me?(gt+=Math.round(_i*((Me-$e)/Ci)),$e=Me):ut>=Me&&(Kt=gt+Math.round(_i*((Me-$e)/Ci)),ut=Me),gt>=Me&&Kt>=Me||(gt>=Me?($e+=Math.round(Ci*((Me-gt)/_i)),gt=Me):Kt>=Me&&(ut=$e+Math.round(Ci*((Me-gt)/_i)),Kt=Me),Ve&&$e===Ve[Ve.length-1][0]&&gt===Ve[Ve.length-1][1]||(Ve=[[$e,gt]],we.push(Ve)),Ve.push([ut,Kt])))))}}function Va({name:ie,features:W},X){X.writeStringField(1,ie),X.writeVarintField(5,r.al);const he=new Map,we=new Map,ye={keys:he,values:we,feature:null};for(const Me of W)ye.feature=Me,X.writeMessage(2,Aa,ye);for(const Me of he.keys())X.writeStringField(3,Me);for(const Me of we.keys())X.writeMessage(4,gr,Me)}function Aa(ie,W){const X=ie.feature;X.id!==void 0&&Number.isSafeInteger(+X.id)&&W.writeVarintField(1,+X.id),X.tags&&W.writeMessage(2,Gi,ie),W.writeVarintField(3,X.type),W.writeMessage(4,Rn,X)}function Gi({keys:ie,values:W,feature:X},he){for(const we of Object.keys(X.tags)){let ye=X.tags[we];if(ye===null)continue;let Me=ie.get(we);Me===void 0&&(Me=ie.size,ie.set(we,Me)),he.writeVarint(Me);const Ve=typeof ye;Ve!=="string"&&Ve!=="boolean"&&Ve!=="number"&&(ye=JSON.stringify(ye));let Le=W.get(ye);Le===void 0&&(Le=W.size,W.set(ye,Le)),he.writeVarint(Le)}}function Cn(ie,W){return(W<<3)+(7&ie)}function Vi(ie){return ie<<1^ie>>31}function Rn(ie,W){const{geometry:X,type:he}=ie;let we=0,ye=0;if(he===1){W.writeVarint(Cn(1,X.length));for(const Me of X){const Ve=Me[0]-we,Le=Me[1]-ye;W.writeVarint(Vi(Ve)),W.writeVarint(Vi(Le)),we+=Ve,ye+=Le}}else for(const Me of X){W.writeVarint(Cn(1,1));const Ve=Me.length-(he===3?1:0);for(let Le=0;Le<Ve;Le++){Le===1&&W.writeVarint(Cn(2,Ve-1));const $e=Me[Le][0]-we,gt=Me[Le][1]-ye;W.writeVarint(Vi($e)),W.writeVarint(Vi(gt)),we+=$e,ye+=gt}he===3&&W.writeVarint(Cn(7,1))}}function gr(ie,W){const X=typeof ie;X==="string"?W.writeStringField(1,ie):X==="boolean"?W.writeBooleanField(7,ie):X==="number"&&(ie%1!=0?W.writeDoubleField(3,ie):ie<0?W.writeSVarintField(6,ie):W.writeVarintField(5,ie))}const za={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ie=>ie},Bn=Math.fround||(eo=new Float32Array(1),ie=>(eo[0]=+ie,eo[0]));var eo;const jr=3,Zr=5,to=6;class Pr{constructor(W){this.options=Object.assign(Object.create(za),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:X,minZoom:he,maxZoom:we}=this.options;X&&console.time("total time");const ye=`prepare ${W.length} points`;X&&console.time(ye),this.points=W;const Me=[];for(let Le=0;Le<W.length;Le++){const $e=W[Le];if(!$e.geometry)continue;const[gt,ut]=$e.geometry.coordinates,Kt=Bn(ha(gt)),Ci=Bn(Ra(ut));Me.push(Kt,Ci,1/0,Le,-1,1),this.options.reduce&&Me.push(0)}let Ve=this.trees[we+1]=this._createTree(Me);X&&console.timeEnd(ye);for(let Le=we;Le>=he;Le--){const $e=+Date.now();Ve=this.trees[Le]=this._createTree(this._cluster(Ve,Le)),X&&console.log("z%d: %d clusters in %dms",Le,Ve.numItems,+Date.now()-$e)}return X&&console.timeEnd("total time"),this}getClusters(W,X){let he=((W[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,W[1]));let ye=W[2]===180?180:((W[2]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)he=-180,ye=180;else if(he>ye){const ut=this.getClusters([he,we,180,Me],X),Kt=this.getClusters([-180,we,ye,Me],X);return ut.concat(Kt)}const Ve=this.trees[this._limitZoom(X)],Le=Ve.range(ha(he),Ra(Me),ha(ye),Ra(we)),$e=Ve.data,gt=[];for(const ut of Le){const Kt=this.stride*ut;gt.push($e[Kt+Zr]>1?Do($e,Kt,this.clusterProps):this.points[$e[Kt+jr]])}return gt}getChildren(W){const X=this._getOriginId(W),he=this._getOriginZoom(W),we="No cluster with the specified id.",ye=this.trees[he];if(!ye)throw new Error(we);const Me=ye.data;if(X*this.stride>=Me.length)throw new Error(we);const Ve=this.options.radius/(this.options.extent*Math.pow(2,he-1)),Le=ye.within(Me[X*this.stride],Me[X*this.stride+1],Ve),$e=[];for(const gt of Le){const ut=gt*this.stride;Me[ut+4]===W&&$e.push(Me[ut+Zr]>1?Do(Me,ut,this.clusterProps):this.points[Me[ut+jr]])}if($e.length===0)throw new Error(we);return $e}getLeaves(W,X,he){const we=[];return this._appendLeaves(we,W,X=X||10,he=he||0,0),we}getTile(W,X,he){const we=this.trees[this._limitZoom(W)],ye=Math.pow(2,W),{extent:Me,radius:Ve}=this.options,Le=Ve/Me,$e=(he-Le)/ye,gt=(he+1+Le)/ye,ut={features:[]};return this._addTileFeatures(we.range((X-Le)/ye,$e,(X+1+Le)/ye,gt),we.data,X,he,ye,ut),X===0&&this._addTileFeatures(we.range(1-Le/ye,$e,1,gt),we.data,ye,he,ye,ut),X===ye-1&&this._addTileFeatures(we.range(0,$e,Le/ye,gt),we.data,-1,he,ye,ut),ut.features.length?ut:null}getClusterExpansionZoom(W){let X=this._getOriginZoom(W)-1;for(;X<=this.options.maxZoom;){const he=this.getChildren(W);if(X++,he.length!==1)break;W=he[0].properties.cluster_id}return X}_appendLeaves(W,X,he,we,ye){const Me=this.getChildren(X);for(const Ve of Me){const Le=Ve.properties;if(Le&&Le.cluster?ye+Le.point_count<=we?ye+=Le.point_count:ye=this._appendLeaves(W,Le.cluster_id,he,we,ye):ye<we?ye++:W.push(Ve),W.length===he)break}return ye}_createTree(W){const X=new r.c3(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let he=0;he<W.length;he+=this.stride)X.add(W[he],W[he+1]);return X.finish(),X.data=W,X}_addTileFeatures(W,X,he,we,ye,Me){for(const Ve of W){const Le=Ve*this.stride,$e=X[Le+Zr]>1;let gt,ut,Kt;if($e)gt=mo(X,Le,this.clusterProps),ut=X[Le],Kt=X[Le+1];else{const Yt=this.points[X[Le+jr]];gt=Yt.properties;const[Yi,ln]=Yt.geometry.coordinates;ut=ha(Yi),Kt=Ra(ln)}const Ci={type:1,geometry:[[Math.round(this.options.extent*(ut*ye-he)),Math.round(this.options.extent*(Kt*ye-we))]],tags:gt};let _i;_i=$e||this.options.generateId?X[Le+jr]:this.points[X[Le+jr]].id,_i!==void 0&&(Ci.id=_i),Me.features.push(Ci)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,X){const{radius:he,extent:we,reduce:ye,minPoints:Me}=this.options,Ve=he/(we*Math.pow(2,X)),Le=W.data,$e=[],gt=this.stride;for(let ut=0;ut<Le.length;ut+=gt){if(Le[ut+2]<=X)continue;Le[ut+2]=X;const Kt=Le[ut],Ci=Le[ut+1],_i=W.within(Le[ut],Le[ut+1],Ve),Yt=Le[ut+Zr];let Yi=Yt;for(const ln of _i){const lr=ln*gt;Le[lr+2]>X&&(Yi+=Le[lr+Zr])}if(Yi>Yt&&Yi>=Me){let ln,lr=Kt*Yt,Or=Ci*Yt,Ta=-1;const oa=(ut/gt<<5)+(X+1)+this.points.length;for(const Kr of _i){const er=Kr*gt;if(Le[er+2]<=X)continue;Le[er+2]=X;const bn=Le[er+Zr];lr+=Le[er]*bn,Or+=Le[er+1]*bn,Le[er+4]=oa,ye&&(ln||(ln=this._map(Le,ut,!0),Ta=this.clusterProps.length,this.clusterProps.push(ln)),ye(ln,this._map(Le,er)))}Le[ut+4]=oa,$e.push(lr/Yi,Or/Yi,1/0,oa,-1,Yi),ye&&$e.push(Ta)}else{for(let ln=0;ln<gt;ln++)$e.push(Le[ut+ln]);if(Yi>1)for(const ln of _i){const lr=ln*gt;if(!(Le[lr+2]<=X)){Le[lr+2]=X;for(let Or=0;Or<gt;Or++)$e.push(Le[lr+Or])}}}}return $e}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,X,he){if(W[X+Zr]>1){const Me=this.clusterProps[W[X+to]];return he?Object.assign({},Me):Me}const we=this.points[W[X+jr]].properties,ye=this.options.map(we);return he&&ye===we?Object.assign({},ye):ye}}function Do(ie,W,X){return{type:"Feature",id:ie[W+jr],properties:mo(ie,W,X),geometry:{type:"Point",coordinates:[(he=ie[W],360*(he-.5)),bo(ie[W+1])]}};var he}function mo(ie,W,X){const he=ie[W+Zr],we=he>=1e4?`${Math.round(he/1e3)}k`:he>=1e3?Math.round(he/100)/10+"k":he,ye=ie[W+to],Me=ye===-1?{}:Object.assign({},X[ye]);return Object.assign(Me,{cluster:!0,cluster_id:ie[W+jr],point_count:he,point_count_abbreviated:we})}function ha(ie){return ie/360+.5}function Ra(ie){const W=Math.sin(ie*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function bo(ie){const W=(180-360*ie)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Fa(ie,W,X,he){let we=he;const ye=W+(X-W>>1);let Me,Ve=X-W;const Le=ie[W],$e=ie[W+1],gt=ie[X],ut=ie[X+1];for(let Kt=W+3;Kt<X;Kt+=3){const Ci=wa(ie[Kt],ie[Kt+1],Le,$e,gt,ut);if(Ci>we)Me=Kt,we=Ci;else if(Ci===we){const _i=Math.abs(Kt-ye);_i<Ve&&(Me=Kt,Ve=_i)}}we>he&&(Me-W>3&&Fa(ie,W,Me,he),ie[Me+2]=we,X-Me>3&&Fa(ie,Me,X,he))}function wa(ie,W,X,he,we,ye){let Me=we-X,Ve=ye-he;if(Me!==0||Ve!==0){const Le=((ie-X)*Me+(W-he)*Ve)/(Me*Me+Ve*Ve);Le>1?(X=we,he=ye):Le>0&&(X+=Me*Le,he+=Ve*Le)}return Me=ie-X,Ve=W-he,Me*Me+Ve*Ve}function Na(ie,W,X,he){const we={id:ie??null,type:W,geometry:X,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(W==="Point"||W==="MultiPoint"||W==="LineString")qa(we,X);else if(W==="Polygon")qa(we,X[0]);else if(W==="MultiLineString")for(const ye of X)qa(we,ye);else if(W==="MultiPolygon")for(const ye of X)qa(we,ye[0]);return we}function qa(ie,W){for(let X=0;X<W.length;X+=3)ie.minX=Math.min(ie.minX,W[X]),ie.minY=Math.min(ie.minY,W[X+1]),ie.maxX=Math.max(ie.maxX,W[X]),ie.maxY=Math.max(ie.maxY,W[X+1])}function xs(ie,W,X,he){if(!W.geometry)return;const we=W.geometry.coordinates;if(we&&we.length===0)return;const ye=W.geometry.type,Me=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2);let Ve=[],Le=W.id;if(X.promoteId?Le=W.properties[X.promoteId]:X.generateId&&(Le=he||0),ye==="Point")ja(we,Ve);else if(ye==="MultiPoint")for(const $e of we)ja($e,Ve);else if(ye==="LineString")Pi(we,Ve,Me,!1);else if(ye==="MultiLineString"){if(X.lineMetrics){for(const $e of we)Ve=[],Pi($e,Ve,Me,!1),ie.push(Na(Le,"LineString",Ve,W.properties));return}rn(we,Ve,Me,!1)}else if(ye==="Polygon")rn(we,Ve,Me,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(const $e of W.geometry.geometries)xs(ie,{id:Le,geometry:$e,properties:W.properties},X,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const $e of we){const gt=[];rn($e,gt,Me,!0),Ve.push(gt)}}ie.push(Na(Le,ye,Ve,W.properties))}function ja(ie,W){W.push(Qn(ie[0]),Fr(ie[1]),0)}function Pi(ie,W,X,he){let we,ye,Me=0;for(let Le=0;Le<ie.length;Le++){const $e=Qn(ie[Le][0]),gt=Fr(ie[Le][1]);W.push($e,gt,0),Le>0&&(Me+=he?(we*gt-$e*ye)/2:Math.sqrt(Math.pow($e-we,2)+Math.pow(gt-ye,2))),we=$e,ye=gt}const Ve=W.length-3;W[2]=1,Fa(W,0,Ve,X),W[Ve+2]=1,W.size=Math.abs(Me),W.start=0,W.end=W.size}function rn(ie,W,X,he){for(let we=0;we<ie.length;we++){const ye=[];Pi(ie[we],ye,X,he),W.push(ye)}}function Qn(ie){return ie/360+.5}function Fr(ie){const W=Math.sin(ie*Math.PI/180),X=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return X<0?0:X>1?1:X}function Un(ie,W,X,he,we,ye,Me,Ve){if(he/=W,ye>=(X/=W)&&Me<he)return ie;if(Me<X||ye>=he)return null;const Le=[];for(const $e of ie){const gt=$e.geometry;let ut=$e.type;const Kt=we===0?$e.minX:$e.minY,Ci=we===0?$e.maxX:$e.maxY;if(Kt>=X&&Ci<he){Le.push($e);continue}if(Ci<X||Kt>=he)continue;let _i=[];if(ut==="Point"||ut==="MultiPoint")da(gt,_i,X,he,we);else if(ut==="LineString")_a(gt,_i,X,he,we,!1,Ve.lineMetrics);else if(ut==="MultiLineString")Vr(gt,_i,X,he,we,!1);else if(ut==="Polygon")Vr(gt,_i,X,he,we,!0);else if(ut==="MultiPolygon")for(const Yt of gt){const Yi=[];Vr(Yt,Yi,X,he,we,!0),Yi.length&&_i.push(Yi)}if(_i.length){if(Ve.lineMetrics&&ut==="LineString"){for(const Yt of _i)Le.push(Na($e.id,ut,Yt,$e.tags));continue}ut!=="LineString"&&ut!=="MultiLineString"||(_i.length===1?(ut="LineString",_i=_i[0]):ut="MultiLineString"),ut!=="Point"&&ut!=="MultiPoint"||(ut=_i.length===3?"Point":"MultiPoint"),Le.push(Na($e.id,ut,_i,$e.tags))}}return Le.length?Le:null}function da(ie,W,X,he,we){for(let ye=0;ye<ie.length;ye+=3){const Me=ie[ye+we];Me>=X&&Me<=he&&xr(W,ie[ye],ie[ye+1],ie[ye+2])}}function _a(ie,W,X,he,we,ye,Me){let Ve=Ga(ie);const Le=we===0?_n:aa;let $e,gt,ut=ie.start;for(let Yi=0;Yi<ie.length-3;Yi+=3){const ln=ie[Yi],lr=ie[Yi+1],Or=ie[Yi+2],Ta=ie[Yi+3],oa=ie[Yi+4],Kr=we===0?ln:lr,er=we===0?Ta:oa;let bn=!1;Me&&($e=Math.sqrt(Math.pow(ln-Ta,2)+Math.pow(lr-oa,2))),Kr<X?er>X&&(gt=Le(Ve,ln,lr,Ta,oa,X),Me&&(Ve.start=ut+$e*gt)):Kr>he?er<he&&(gt=Le(Ve,ln,lr,Ta,oa,he),Me&&(Ve.start=ut+$e*gt)):xr(Ve,ln,lr,Or),er<X&&Kr>=X&&(gt=Le(Ve,ln,lr,Ta,oa,X),bn=!0),er>he&&Kr<=he&&(gt=Le(Ve,ln,lr,Ta,oa,he),bn=!0),!ye&&bn&&(Me&&(Ve.end=ut+$e*gt),W.push(Ve),Ve=Ga(ie)),Me&&(ut+=$e)}let Kt=ie.length-3;const Ci=ie[Kt],_i=ie[Kt+1],Yt=we===0?Ci:_i;Yt>=X&&Yt<=he&&xr(Ve,Ci,_i,ie[Kt+2]),Kt=Ve.length-3,ye&&Kt>=3&&(Ve[Kt]!==Ve[0]||Ve[Kt+1]!==Ve[1])&&xr(Ve,Ve[0],Ve[1],Ve[2]),Ve.length&&W.push(Ve)}function Ga(ie){const W=[];return W.size=ie.size,W.start=ie.start,W.end=ie.end,W}function Vr(ie,W,X,he,we,ye){for(const Me of ie)_a(Me,W,X,he,we,ye,!1)}function xr(ie,W,X,he){ie.push(W,X,he)}function _n(ie,W,X,he,we,ye){const Me=(ye-W)/(he-W);return xr(ie,ye,X+(we-X)*Me,1),Me}function aa(ie,W,X,he,we,ye){const Me=(ye-X)/(we-X);return xr(ie,W+(he-W)*Me,ye,1),Me}function wo(ie,W){const X=[];for(let he=0;he<ie.length;he++){const we=ie[he],ye=we.type;let Me;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Me=go(we.geometry,W);else if(ye==="MultiLineString"||ye==="Polygon"){Me=[];for(const Ve of we.geometry)Me.push(go(Ve,W))}else if(ye==="MultiPolygon"){Me=[];for(const Ve of we.geometry){const Le=[];for(const $e of Ve)Le.push(go($e,W));Me.push(Le)}}X.push(Na(we.id,ye,Me,we.tags))}return X}function go(ie,W){const X=[];X.size=ie.size,ie.start!==void 0&&(X.start=ie.start,X.end=ie.end);for(let he=0;he<ie.length;he+=3)X.push(ie[he]+W,ie[he+1],ie[he+2]);return X}function no(ie,W){if(ie.transformed)return ie;const X=1<<ie.z,he=ie.x,we=ie.y;for(const ye of ie.features){const Me=ye.geometry,Ve=ye.type;if(ye.geometry=[],Ve===1)for(let Le=0;Le<Me.length;Le+=2)ye.geometry.push(tc(Me[Le],Me[Le+1],W,X,he,we));else for(let Le=0;Le<Me.length;Le++){const $e=[];for(let gt=0;gt<Me[Le].length;gt+=2)$e.push(tc(Me[Le][gt],Me[Le][gt+1],W,X,he,we));ye.geometry.push($e)}}return ie.transformed=!0,ie}function tc(ie,W,X,he,we,ye){return[Math.round(X*(ie*he-we)),Math.round(X*(W*he-ye))]}function ml(ie,W,X,he,we){const ye=W===we.maxZoom?0:we.tolerance/((1<<W)*we.extent),Me={features:[],numPoints:0,numSimplified:0,numFeatures:ie.length,source:null,x:X,y:he,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ve of ie)ic(Me,Ve,ye,we);return Me}function ic(ie,W,X,he){const we=W.geometry,ye=W.type,Me=[];if(ie.minX=Math.min(ie.minX,W.minX),ie.minY=Math.min(ie.minY,W.minY),ie.maxX=Math.max(ie.maxX,W.maxX),ie.maxY=Math.max(ie.maxY,W.maxY),ye==="Point"||ye==="MultiPoint")for(let Ve=0;Ve<we.length;Ve+=3)Me.push(we[Ve],we[Ve+1]),ie.numPoints++,ie.numSimplified++;else if(ye==="LineString")Ks(Me,we,ie,X,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(let Ve=0;Ve<we.length;Ve++)Ks(Me,we[Ve],ie,X,ye==="Polygon",Ve===0);else if(ye==="MultiPolygon")for(let Ve=0;Ve<we.length;Ve++){const Le=we[Ve];for(let $e=0;$e<Le.length;$e++)Ks(Me,Le[$e],ie,X,!0,$e===0)}if(Me.length){let Ve=W.tags||null;if(ye==="LineString"&&he.lineMetrics){Ve={};for(const $e in W.tags)Ve[$e]=W.tags[$e];Ve.mapbox_clip_start=we.start/we.size,Ve.mapbox_clip_end=we.end/we.size}const Le={geometry:Me,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:Ve};W.id!==null&&(Le.id=W.id),ie.features.push(Le)}}function Ks(ie,W,X,he,we,ye){const Me=he*he;if(he>0&&W.size<(we?Me:he))return void(X.numPoints+=W.length/3);const Ve=[];for(let Le=0;Le<W.length;Le+=3)(he===0||W[Le+2]>Me)&&(X.numSimplified++,Ve.push(W[Le],W[Le+1])),X.numPoints++;we&&function(Le,$e){let gt=0;for(let ut=0,Kt=Le.length,Ci=Kt-2;ut<Kt;Ci=ut,ut+=2)gt+=(Le[ut]-Le[Ci])*(Le[ut+1]+Le[Ci+1]);if(gt>0===$e)for(let ut=0,Kt=Le.length;ut<Kt/2;ut+=2){const Ci=Le[ut],_i=Le[ut+1];Le[ut]=Le[Kt-2-ut],Le[ut+1]=Le[Kt-1-ut],Le[Kt-2-ut]=Ci,Le[Kt-1-ut]=_i}}(Ve,ye),ie.push(Ve)}const vt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class To{constructor(W,X){const he=(X=this.options=function(ye,Me){for(const Ve in Me)ye[Ve]=Me[Ve];return ye}(Object.create(vt),X)).debug;if(he&&console.time("preprocess data"),X.maxZoom<0||X.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(X.promoteId&&X.generateId)throw new Error("promoteId and generateId cannot be used together.");let we=function(ye,Me){const Ve=[];if(ye.type==="FeatureCollection")for(let Le=0;Le<ye.features.length;Le++)xs(Ve,ye.features[Le],Me,Le);else xs(Ve,ye.type==="Feature"?ye:{geometry:ye},Me);return Ve}(W,X);this.tiles={},this.tileCoords=[],he&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",X.indexMaxZoom,X.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),we=function(ye,Me){const Ve=Me.buffer/Me.extent;let Le=ye;const $e=Un(ye,1,-1-Ve,Ve,0,-1,2,Me),gt=Un(ye,1,1-Ve,2+Ve,0,-1,2,Me);return($e||gt)&&(Le=Un(ye,1,-Ve,1+Ve,0,-1,2,Me)||[],$e&&(Le=wo($e,1).concat(Le)),gt&&(Le=Le.concat(wo(gt,-1)))),Le}(we,X),we.length&&this.splitTile(we,0,0,0),he&&(we.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,X,he,we,ye,Me,Ve){const Le=[W,X,he,we],$e=this.options,gt=$e.debug;for(;Le.length;){we=Le.pop(),he=Le.pop(),X=Le.pop(),W=Le.pop();const ut=1<<X,Kt=Go(X,he,we);let Ci=this.tiles[Kt];if(!Ci&&(gt>1&&console.time("creation"),Ci=this.tiles[Kt]=ml(W,X,he,we,$e),this.tileCoords.push({z:X,x:he,y:we}),gt)){gt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",X,he,we,Ci.numFeatures,Ci.numPoints,Ci.numSimplified),console.timeEnd("creation"));const bn=`z${X}`;this.stats[bn]=(this.stats[bn]||0)+1,this.total++}if(Ci.source=W,ye==null){if(X===$e.indexMaxZoom||Ci.numPoints<=$e.indexMaxPoints)continue}else{if(X===$e.maxZoom||X===ye)continue;if(ye!=null){const bn=ye-X;if(he!==Me>>bn||we!==Ve>>bn)continue}}if(Ci.source=null,W.length===0)continue;gt>1&&console.time("clipping");const _i=.5*$e.buffer/$e.extent,Yt=.5-_i,Yi=.5+_i,ln=1+_i;let lr=null,Or=null,Ta=null,oa=null,Kr=Un(W,ut,he-_i,he+Yi,0,Ci.minX,Ci.maxX,$e),er=Un(W,ut,he+Yt,he+ln,0,Ci.minX,Ci.maxX,$e);W=null,Kr&&(lr=Un(Kr,ut,we-_i,we+Yi,1,Ci.minY,Ci.maxY,$e),Or=Un(Kr,ut,we+Yt,we+ln,1,Ci.minY,Ci.maxY,$e),Kr=null),er&&(Ta=Un(er,ut,we-_i,we+Yi,1,Ci.minY,Ci.maxY,$e),oa=Un(er,ut,we+Yt,we+ln,1,Ci.minY,Ci.maxY,$e),er=null),gt>1&&console.timeEnd("clipping"),Le.push(lr||[],X+1,2*he,2*we),Le.push(Or||[],X+1,2*he,2*we+1),Le.push(Ta||[],X+1,2*he+1,2*we),Le.push(oa||[],X+1,2*he+1,2*we+1)}}getTile(W,X,he){W=+W,X=+X,he=+he;const we=this.options,{extent:ye,debug:Me}=we;if(W<0||W>24)return null;const Ve=1<<W,Le=Go(W,X=X+Ve&Ve-1,he);if(this.tiles[Le])return no(this.tiles[Le],ye);Me>1&&console.log("drilling down to z%d-%d-%d",W,X,he);let $e,gt=W,ut=X,Kt=he;for(;!$e&&gt>0;)gt--,ut>>=1,Kt>>=1,$e=this.tiles[Go(gt,ut,Kt)];return $e&&$e.source?(Me>1&&(console.log("found parent tile z%d-%d-%d",gt,ut,Kt),console.time("drilling down")),this.splitTile($e.source,gt,ut,Kt,W,X,he),Me>1&&console.timeEnd("drilling down"),this.tiles[Le]?no(this.tiles[Le],ye):null):null}}function Go(ie,W,X){return 32*((1<<ie)*X+W)+ie}function Mo(ie,W){const X=ie.tileID.canonical;if(!this._geoJSONIndex)return void W(null,null);const he=this._geoJSONIndex.getTile(X.z,X.x,X.y);if(!he)return void W(null,null);const we=$e=>$e.tags&&"3d_elevation_id"in $e.tags&&"source"in $e.tags&&$e.tags.source==="elevation",ye=he.features.filter($e=>we($e));let Me={_geojsonTileLayer:he.features};ye.length>0&&(Me={_geojsonTileLayer:he.features.filter($e=>!we($e)),hd_road_elevation:ye});const Ve=new Di(Me),Le=function($e){const gt=new r.bs;for(const ut of Object.keys($e))gt.writeMessage(3,Va,{name:ut,features:$e[ut]});return gt.finish()}(Me).buffer;W(null,{vectorTile:Ve,rawData:Le})}class cn extends Nt{constructor(W,X,he,we,ye,Me,Ve){super(W,X,he,we,ye,Mo,Ve),Me&&(this.loadGeoJSON=Me),this._dynamicIndex=new ri}loadData(W,X){const he=W&&W.request,we=he&&he.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(W,(ye,Me)=>{if(ye||!Me)return X(ye);if(typeof Me!="object")return X(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));{try{if(W.filter){const Le=r.U(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Le.result==="error")throw new Error(Le.value.map($e=>`${$e.key}: ${$e.message}`).join(", "));Me.features=Me.features.filter($e=>Le.value.evaluate({zoom:0},$e))}W.dynamic?(Me.type==="Feature"&&(Me={type:"FeatureCollection",features:[Me]}),W.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Me.features,this.loaded),W.cluster&&(Me.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=W.cluster?new Pr(function({superclusterOptions:Le,clusterProperties:$e}){if(!$e||!Le)return Le;const gt={},ut={},Kt={accumulated:null,zoom:0},Ci={properties:null},_i=Object.keys($e);for(const Yt of _i){const[Yi,ln]=$e[Yt],lr=r.U(ln),Or=r.U(typeof Yi=="string"?[Yi,["accumulated"],["get",Yt]]:Yi);gt[Yt]=lr.value,ut[Yt]=Or.value}return Le.map=Yt=>{Ci.properties=Yt;const Yi={};for(const ln of _i)Yi[ln]=gt[ln].evaluate(Kt,Ci);return Yi},Le.reduce=(Yt,Yi)=>{Ci.properties=Yi;for(const ln of _i)Kt.accumulated=Yt[ln],Yt[ln]=ut[ln].evaluate(Kt,Ci)},Le}(W)).load(Me.features):W.dynamic?this._dynamicIndex:function(Le,$e){return new To(Le,$e)}(Me,W.geojsonVtOptions)}catch(Le){return X(Le)}const Ve={};if(we){const Le=z(he);Le&&(Ve.resourceTiming={},Ve.resourceTiming[W.source]=JSON.parse(JSON.stringify(Le)))}X(null,Ve)}})}reloadTile(W,X){const he=this.loaded;return he&&he[W.uid]?W.partial?X(null,void 0):super.reloadTile(W,X):this.loadTile(W,X)}loadGeoJSON(W,X){if(W.request)r.m(W.request,X);else{if(typeof W.data!="string")return X(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return X(null,JSON.parse(W.data))}catch{return X(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(W,X){try{X(null,this._geoJSONIndex.getClusterExpansionZoom(W.clusterId))}catch(he){X(he)}}getClusterChildren(W,X){try{X(null,this._geoJSONIndex.getChildren(W.clusterId))}catch(he){X(he)}}getClusterLeaves(W,X){try{X(null,this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset))}catch(he){X(he)}}}class Za{constructor(W,X,he){this.tileID=new r.aP(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.tileZoom=W.tileZoom,this.uid=W.uid,this.zoom=W.zoom,this.canonical=W.tileID.canonical,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=W.projection,this.brightness=X,this.worldview=he}parse(W,X,he,we){this.status="parsing";const ye=new r.aP(he.tileID.overscaledZ,he.tileID.wrap,he.tileID.canonical.z,he.tileID.canonical.x,he.tileID.canonical.y),Me=[],Ve=X.familiesBySource[he.source],Le=new r.fm(ye,he.promoteId);Le.bucketLayerIDs=[],Le.is3DTile=!0,r.fB(W).then($e=>{if(!$e)return we(new Error("Could not parse tile"));const gt=$e.json.extensionsUsed&&$e.json.extensionsUsed.includes("MAPBOX_mesh_features")||$e.json.asset.extras&&$e.json.asset.extras.MAPBOX_mesh_features,ut=$e.json.extensionsUsed&&$e.json.extensionsUsed.includes("EXT_meshopt_compression"),Kt=new r.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Ci in Ve)for(const _i of Ve[Ci]){const Yt=_i[0];Le.bucketLayerIDs.push(_i.map(lr=>r.B(lr.id,lr.scope))),Yt.recalculate(Kt,[]);const Yi=r.fC($e,1/r.d6(he.tileID.canonical)),ln=new r.fD(_i,Yi,ye,gt,ut,this.brightness,Le,this.worldview);gt||(ln.needsUpload=!0),Me.push(ln),ln.evaluate(Yt)}this.status="done",we(null,{buckets:Me,featureIndex:Le,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch($e=>we(new Error($e.message)))}}class et{constructor(W,X,he,we,ye,Me,Ve,Le){this.actor=W,this.layerIndex=X,this.availableImages=he,this.availableModels=we,this.brightness=Ve,this.loading={},this.loaded={},this.worldview=Le}loadTile(W,X){const he=W.uid,we=this.loading[he]=new Za(W,this.brightness,this.worldview);r.bt(W.request,(ye,Me)=>{const Ve=!this.loading[he];return delete this.loading[he],Ve||ye?(we.status="done",Ve||(this.loaded[he]=we),X(ye)):Me&&Me.byteLength!==0?void we.parse(Me,this.layerIndex,W,(Le,$e)=>{we.status="done",this.loaded=this.loaded||{},this.loaded[he]=we,Le||!$e?X(Le):X(null,$e)}):(we.status="done",this.loaded[he]=we,X())})}reloadTile(W,X){const he=this.loaded,we=W.uid;if(he&&he[we]){const ye=he[we];ye.projection=W.projection,ye.brightness=W.brightness;const Me=(Ve,Le)=>{ye.reloadCallback&&(delete ye.reloadCallback,this.loadTile(W,X)),X(Ve,Le)};ye.status==="parsing"?ye.reloadCallback=Me:ye.status==="done"&&this.loadTile(W,X)}}abortTile(W,X){const he=W.uid;this.loading[he]&&delete this.loading[he],X()}removeTile(W,X){const he=this.loaded,we=W.uid;he&&he[we]&&delete he[we],X()}}class vi{constructor(W){this.self=W,this.actor=new r.fF(W,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new r.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=r.cl({name:"mercator"}),this.workerSourceTypes={vector:Nt,geojson:cn,"raster-dem":oi,"raster-array":Ui,"batched-model":et},this.workerSources={},this.self.registerWorkerSource=(X,he)=>{if(this.workerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.workerSourceTypes[X]=he},this.self.registerRTLTextPlugin=X=>{if(r.fG.isParsed())throw new Error("RTL text plugin already registered.");r.fG.setState({pluginStatus:r.fH.parsed,pluginURL:r.fG.getPluginURL()}),r.fG.applyArabicShaping=X.applyArabicShaping,r.fG.processBidirectionalText=X.processBidirectionalText,r.fG.processStyledBidirectionalText=X.processStyledBidirectionalText;for(const he of this.rtlPluginParsingListeners)he(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(W,X,he){delete this.layerIndexes[W],delete this.availableImages[W],delete this.availableModels[W],delete this.workerSources[W],he()}checkIfReady(W,X,he){he()}setReferrer(W,X){this.referrer=X}spriteLoaded(W,X){this.isSpriteLoaded[W]||(this.isSpriteLoaded[W]={});const{scope:he,isLoaded:we}=X;if(this.isSpriteLoaded[W][he]=we,this.workerSources[W]&&this.workerSources[W][he])for(const ye in this.workerSources[W][he]){const Me=this.workerSources[W][he][ye];for(const Ve in Me){const Le=Me[Ve];Le instanceof Nt&&(Le.isSpriteLoaded=we,Le.fire(new r.z("isSpriteLoaded")))}}}setImages(W,X,he){this.availableImages[W]||(this.availableImages[W]={});const{scope:we,images:ye}=X;if(this.availableImages[W][we]=ye,this.workerSources[W]&&this.workerSources[W][we]){for(const Me in this.workerSources[W][we]){const Ve=this.workerSources[W][we][Me];for(const Le in Ve)Ve[Le].availableImages=ye}he()}else he()}setModels(W,{scope:X,models:he},we){if(this.availableModels[W]||(this.availableModels[W]={}),this.availableModels[W][X]=he,this.workerSources[W]&&this.workerSources[W][X]){for(const ye in this.workerSources[W][X]){const Me=this.workerSources[W][X][ye];for(const Ve in Me)Me[Ve].availableModels=he}we()}else we()}setProjection(W,X){this.projections[W]=r.cl(X)}setBrightness(W,X,he){this.brightness=X,he()}setWorldview(W,X,he){this.worldview=X,he()}setLayers(W,X,he){this.getLayerIndex(W,X.scope).replace(X.layers,X.options),he()}updateLayers(W,X,he){this.getLayerIndex(W,X.scope).update(X.layers,X.removedIds,X.options),he()}loadTile(W,X,he){X.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,X.type,X.source,X.scope).loadTile(X,he)}decodeRasterArray(W,X,he){this.getWorkerSource(W,X.type,X.source,X.scope).decodeRasterArray(X,he)}reloadTile(W,X,he){X.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,X.type,X.source,X.scope).reloadTile(X,he)}abortTile(W,X,he){this.getWorkerSource(W,X.type,X.source,X.scope).abortTile(X,he)}removeTile(W,X,he){this.getWorkerSource(W,X.type,X.source,X.scope).removeTile(X,he)}removeSource(W,X,he){if(!(this.workerSources[W]&&this.workerSources[W][X.scope]&&this.workerSources[W][X.scope][X.type]&&this.workerSources[W][X.scope][X.type][X.source]))return;const we=this.workerSources[W][X.scope][X.type][X.source];delete this.workerSources[W][X.scope][X.type][X.source],we.removeSource!==void 0?we.removeSource(X,he):he()}loadWorkerSource(W,X,he){try{this.self.importScripts(X.url),he()}catch(we){he(we.toString())}}syncRTLPluginState(W,X,he){if(r.fG.isParsed())he(null,!0);else if(r.fG.isParsing())this.rtlPluginParsingListeners.push(he);else try{r.fG.setState(X);const we=r.fG.getPluginURL();!r.fG.isLoaded()||r.fG.isParsed()||r.fG.isParsing()||we==null||(r.fG.setState({pluginStatus:r.fH.parsing,pluginURL:r.fG.getPluginURL()}),this.self.importScripts(we),r.fG.isParsed()?he(null,!0):this.rtlPluginParsingListeners.push(he))}catch(we){he(we.toString())}}setDracoUrl(W,X){this.dracoUrl=X}getAvailableImages(W,X){this.availableImages[W]||(this.availableImages[W]={});let he=this.availableImages[W][X];return he||(he=[]),he}getAvailableModels(W,X){this.availableModels[W]||(this.availableModels[W]={});let he=this.availableModels[W][X];return he||(he={}),he}getLayerIndex(W,X){this.layerIndexes[W]||(this.layerIndexes[W]={});let he=this.layerIndexes[W][X];return he||(he=this.layerIndexes[W][X]=new K,he.scope=X),he}getWorkerSource(W,X,he,we){const ye=this.workerSources;return ye[W]||(ye[W]={}),ye[W][we]||(ye[W][we]={}),ye[W][we][X]||(ye[W][we][X]={}),this.isSpriteLoaded[W]||(this.isSpriteLoaded[W]={}),ye[W][we][X][he]||(ye[W][we][X][he]=new this.workerSourceTypes[X]({send:(Me,Ve,Le,$e,gt,ut)=>this.actor.send(Me,Ve,Le,W,gt,ut),scheduler:this.actor.scheduler},this.getLayerIndex(W,we),this.getAvailableImages(W,we),this.getAvailableModels(W,we),this.isSpriteLoaded[W][we],void 0,this.brightness,this.worldview)),ye[W][we][X][he]}rasterizeImagesWorker(W,X,he){const we=new Map;for(const[ye,{image:Me,imageVariant:Ve}]of X.tasks.entries()){const Le=this.imageRasterizer.rasterize(Ve,Me,X.scope,W);we.set(ye,Le)}he(void 0,we)}removeRasterizedImages(W,X,he){this.imageRasterizer.removeImagesFromCacheByIds(X.imageIds,X.scope,W),he()}enforceCacheSizeLimit(W,X){r.fI(X)}getWorkerPerformanceMetrics(W,X,he){he(void 0,void 0)}}return r.fE(self)&&(self.worker=new vi(self)),vi}),E(["./shared"],function(r){var z="3.16.0";const N={create:"create",load:"load",fullLoad:"fullLoad"},H={mark(f){performance.mark(f)},measure(f,t,a){performance.measure(f,t,a)}};function K(f){const t=f.name.split("?")[0];return r.a(t)&&t.includes("mapbox-gl.js")?"javascript":r.a(t)&&t.includes("mapbox-gl.css")?"css":r.b(t)?"fontRange":r.c(t)?"sprite":r.i(t)?"style":r.d(t)?"tilejson":"other"}var ne,ue={},pe=function(){if(ne)return ue;function f(p){return!t(p)}function t(p){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,T,R=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(R);try{T=new Worker(D),b=!0}catch{b=!1}return T&&T.terminate(),URL.revokeObjectURL(D),b}()?function(){var b=document.createElement("canvas");b.width=b.height=1;var T=b.getContext("2d");if(!T)return!1;var R=T.getImageData(0,0,1,1);return R&&R.width===b.width}()?(a[y=p&&p.failIfMajorPerformanceCaveat]===void 0&&(a[y]=function(b){var T,R=function(D){var L=document.createElement("canvas"),F=Object.create(f.webGLContextAttributes);return F.failIfMajorPerformanceCaveat=D,L.getContext("webgl2",F)}(b);if(!R)return!1;try{T=R.createShader(R.VERTEX_SHADER)}catch{return!1}return!(!T||R.isContextLost())&&(R.shaderSource(T,"void main() {}"),R.compileShader(T),R.getShaderParameter(T,R.COMPILE_STATUS)===!0)}(y)),a[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}ne=1,ue.supported=f,ue.notSupportedReason=t;var a={};return f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},ue}();function xe(f,t,a){const p=document.createElement(f);return t!=null&&(p.className=t),a&&a.appendChild(p),p}function be(f,t,a){const p=document.createElementNS("http://www.w3.org/2000/svg",f);for(const y of Object.keys(t))p.setAttributeNS(null,y,String(t[y]));return a&&a.appendChild(p),p}const je=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Be=je&&je.userSelect!==void 0?"userSelect":"WebkitUserSelect";let He;function Xe(){je&&Be&&(He=je[Be],je[Be]="none")}function it(){je&&Be&&(je[Be]=He)}function kt(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",kt,!0)}function Nt(){window.addEventListener("click",kt,!0),window.setTimeout(()=>{window.removeEventListener("click",kt,!0)},0)}function oi(f,t){const a=f.getBoundingClientRect();return hi(f,a,t)}function yi(f,t){const a=f.getBoundingClientRect(),p=[];for(let y=0;y<t.length;y++)p.push(hi(f,a,t[y]));return p}function Ui(f){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&f.button===2&&f.ctrlKey?0:f.button}function hi(f,t,a){const p=f.offsetWidth===t.width?1:f.offsetWidth/t.width;return new r.P((a.clientX-t.left)*p,(a.clientY-t.top)*p)}const Ti="01",Dt="NO_ACCESS_TOKEN";class Di{constructor(t,a,p){this._transformRequestFn=t,this._customAccessToken=a,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const t=function(){let a="";for(let p=0;p<10;p++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ti,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeStyleURL(t,a){if(!r.h(t))return t;const p=ui(t);return p.params.push(`sdk=js-${z}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||a)}normalizeGlyphsURL(t,a){if(!r.h(t))return t;const p=ui(t);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||a)}normalizeModelURL(t,a){if(!r.h(t))return t;const p=ui(t);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||a)}normalizeSourceURL(t,a,p,y){if(!r.h(t))return t;const b=ui(t);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),p&&b.params.push(`language=${p}`),y&&b.params.push(`worldview=${y}`),this._makeAPIURL(b,this._customAccessToken||a)}normalizeIconsetURL(t,a){const p=ui(t);return r.h(t)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||a)):ri(p)}normalizeSpriteURL(t,a,p,y){const b=ui(t);return r.h(t)?(b.path=`/styles/v1${b.path}/sprite${a}${p}`,this._makeAPIURL(b,this._customAccessToken||y)):(b.path+=`${a}${p}`,ri(b))}normalizeTileURL(t,a,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!r.h(t))return t;const y=ui(t);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||p&&y.authority!=="raster"&&p===512?"@2x":""}${r.k.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${r.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${r.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${r.e.TILE_URL_VERSION}${y.path}`);const b=this._customAccessToken||function(T){for(const R of T){const D=R.match(/^access_token=(.*)$/);if(D)return D[1]}return null}(y.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,b)}canonicalizeTileURL(t,a){const p=ui(t);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return t;let y="mapbox://";p.path.match(/^\/raster\/v1\//)?y+=`raster/${p.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${p.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${p.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let b=p.params;return a&&(b=b.filter(T=>!T.match(/^access_token=/))),b.length&&(y+=`?${b.join("&")}`),y}canonicalizeTileset(t,a){const p=!!a&&r.h(a),y=[];for(const b of t.tiles||[])r.j(b)?y.push(this.canonicalizeTileURL(b,p)):y.push(b);return y}_makeAPIURL(t,a){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=ui(r.e.API_URL);if(t.protocol=y.protocol,t.authority=y.authority,t.protocol==="http"){const b=t.params.indexOf("secure");b>=0&&t.params.splice(b,1)}if(y.path!=="/"&&(t.path=`${y.path}${t.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return ri(t);if(a=a||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return t.params=t.params.filter(b=>b.indexOf("access_token")===-1),t.params.push(`access_token=${a||""}`),ri(t)}}const Qt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ui(f){const t=f.match(Qt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function ri(f){const t=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${t}`}const zi="mapbox.eventData";function En(f){if(!f)return null;const t=f.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(r.l(t[1]))}catch{return null}}class hr{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const a=En(r.e.ACCESS_TOKEN);let p="";return p=a&&a.u?r.f(a.u):r.e.ACCESS_TOKEN||"",t?`${zi}.${t}:${p}`:`${zi}:${p}`}fetchEventData(){const t=r.s("localStorage"),a=this.getStorageKey(),p=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp");if(t)try{const b=localStorage.getItem(a);b&&(this.eventData=JSON.parse(b));const T=localStorage.getItem(p);T&&(this.anonId=T);const R=localStorage.getItem(y);R&&(this.anonIdTimestamp=Number(R));const D=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<D)&&this.refreshUUID()}catch{r.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=r.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=r.s("localStorage"),a=this.getStorageKey(),p=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp"),b=this.anonId,T=this.anonIdTimestamp;if(t&&b)try{localStorage.setItem(p,b),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData)),T&&localStorage.setItem(y,T.toString())}catch{r.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,a,p,y){if(!r.e.EVENTS_URL)return;const b=ui(r.e.EVENTS_URL);b.params.push(`access_token=${y||r.e.ACCESS_TOKEN||""}`);const T={event:this.type,created:new Date(t).toISOString()},R=a?Object.assign(T,a):T,D={url:ri(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([R])};this.pendingRequest=r.p(D,L=>{this.pendingRequest=null,p(L),this.saveEventData(),this.processRequests(y)})}queueRequest(t,a){this.queue.push(t),this.processRequests(a)}}const wr=new class extends hr{constructor(f){super("appUserTurnstile"),this._customAccessToken=f}postTurnstileEvent(f,t){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(f)&&f.some(a=>r.h(a)||r.j(a))&&this.queueRequest(Date.now(),t)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=En(r.e.ACCESS_TOKEN),a=t?t.u:r.e.ACCESS_TOKEN;let p=a!==this.eventData.tokenU;r.v(this.anonId)||(this.refreshUUID(),p=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),T=new Date(y),R=(y-this.eventData.lastSuccess)/864e5;p=p||R>=1||R<-1||b.getDate()!==T.getDate()}else p=!0;p?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:Ti,"enabled.telemetry":!1,userId:this.anonId},b=>{b||(this.eventData.lastSuccess=y,this.eventData.tokenU=a)},f):this.processRequests()}},Jn=wr.postTurnstileEvent.bind(wr),xn=new class extends hr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(f,t,a,p){this.skuToken=t,this.errorCb=p,r.e.EVENTS_URL&&(a||r.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},a):this.errorCb(new Error(Dt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),r.v(this.anonId)||this.refreshUUID(),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:z,skuId:Ti,skuToken:this.skuToken,userId:this.anonId},p=>{p?this.errorCb(p):t&&(this.success[t]=!0)},f))}remove(){this.errorCb=null}},mr=xn.postMapLoadEvent.bind(xn),Va=new class extends hr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(f){let t=this.mapInstanceIdMap.get(f);return t||(t=r.u(),this.mapInstanceIdMap.set(f,t)),t}getEventId(f){const t=this.eventIdPerMapInstanceMap.get(f)||0;return this.eventIdPerMapInstanceMap.set(f,t+1),t}postStyleLoadEvent(f,t){const{map:a,style:p,importedStyles:y}=t;if(!r.e.EVENTS_URL||!f&&!r.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(a),T={mapInstanceId:b,eventId:this.getEventId(b),style:p};y.length&&(T.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:T},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:a}=this.queue.shift();this.postEvent(t,a,()=>{},f)}},Aa=Va.postStyleLoadEvent.bind(Va),Gi=new class extends hr{constructor(f){super("metrics"),f&&(this.data=f)}postMetricsEvent(f){if(!r.e.EVENTS_URL||!f&&!r.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),r.v(this.anonId)||this.refreshUUID();const t=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:t},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:a}=this.queue.shift();this.postEvent(t,a,()=>{},f)}}({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Cn=Gi.postMetricsEvent.bind(Gi),Vi=new class extends hr{constructor(){super("gljs.performance")}postPerformanceEvent(f,t){r.e.EVENTS_URL&&(f||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},f)}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:a}=this.queue.shift(),p=function(y){const b=performance.getEntriesByType("resource"),T=performance.getEntriesByType("mark"),R=function($){const Z={};if($){for(const Q in $)if(Q!=="other")for(const re of $[Q]){const te=`${Q}ResolveRangeMin`,se=`${Q}ResolveRangeMax`,me=`${Q}RequestCount`,ce=`${Q}RequestCachedCount`;Z[te]=Math.min(Z[te]||1/0,re.startTime),Z[se]=Math.max(Z[se]||-1/0,re.responseEnd);const Ae=_e=>{Z[_e]===void 0&&(Z[_e]=0),++Z[_e]};re.transferSize!==void 0&&re.transferSize===0&&Ae(ce),Ae(me)}}return Z}(function($,Z){const Q={};if($)for(const re of $){const te=Z(re);Q[te]===void 0&&(Q[te]=[]),Q[te].push(re)}return Q}(b,K)),D=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,F=L?L.effectiveType:void 0,j={counters:[],metadata:[],attributes:[]},B=($,Z,Q)=>{Q!=null&&$.push({name:Z,value:Q.toString()})};for(const $ in R)B(j.counters,$,R[$]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(B(j.counters,"interactionRangeMin",y.interactionRange[0]),B(j.counters,"interactionRangeMax",y.interactionRange[1])),T)for(const $ of Object.values(N)){const Z=T.find(Q=>Q.name===$);Z&&B(j.counters,$,Z.startTime)}return B(j.counters,"visibilityHidden",y.visibilityHidden),B(j.attributes,"style",function($){if($)for(const Z of $){const Q=Z.name.split("?")[0];if(r.i(Q)){const re=Q.split("/").slice(-2);if(re.length===2)return`mapbox://styles/${re[0]}/${re[1]}`}}}(b)),B(j.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),B(j.attributes,"fogEnabled",y.fogEnabled?"true":"false"),B(j.attributes,"projection",y.projection),B(j.attributes,"zoom",y.zoom),B(j.metadata,"devicePixelRatio",D),B(j.metadata,"connectionEffectiveType",F),B(j.metadata,"navigatorUserAgent",navigator.userAgent),B(j.metadata,"screenWidth",window.screen.width),B(j.metadata,"screenHeight",window.screen.height),B(j.metadata,"windowWidth",window.innerWidth),B(j.metadata,"windowHeight",window.innerHeight),B(j.metadata,"mapWidth",y.width/D),B(j.metadata,"mapHeight",y.height/D),B(j.metadata,"webglRenderer",y.renderer),B(j.metadata,"webglVendor",y.vendor),B(j.metadata,"sdkVersion",z),B(j.metadata,"sdkIdentifier","mapbox-gl-js"),j}(a);for(const y of p.metadata);for(const y of p.counters);for(const y of p.attributes);this.postEvent(t,p,()=>{},f)}},Rn=Vi.postPerformanceEvent.bind(Vi),gr=new class extends hr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(f,t,a,p){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const y=ui(r.e.API_URL+r.e.SESSION_PATH);y.params.push(`sku=${t||""}`),y.params.push(`access_token=${p||r.e.ACCESS_TOKEN||""}`);const b={url:ri(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(b,T=>{this.pendingRequest=null,a(T),this.saveEventData(),this.processRequests(p)})}getSessionAPI(f,t,a,p){this.skuToken=t,this.errorCb=p,r.e.SESSION_PATH&&r.e.API_URL&&(a||r.e.ACCESS_TOKEN?this.queueRequest({id:f,timestamp:Date.now()},a):this.errorCb(new Error(Dt)))}processRequests(f){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||this.getSession(a,this.skuToken,p=>{p?this.errorCb(p):t&&(this.success[t]=!0)},f)}remove(){this.errorCb=null}},za=gr.getSessionAPI.bind(gr),Bn=new Set;function eo(f,t){t?Bn.add(f):Bn.delete(f)}class jr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,a){this._updatedSourceCaches[t]=a,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const a=t.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(t.id),this.setDirty()}removeLayer(t){const a=t.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][t.id]=t,this._updatedLayers[a].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const a in this._updatedLayers)t[a]=t[a]||{},t[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)t[a]=t[a]||{},t[a].removedIds=Object.keys(this._removedLayers[a]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,a){this._updatedImages[a]=this._updatedImages[a]||new Set,this._updatedImages[a].add(r.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Zr(f){const{userImage:t}=f;return!!(t&&t.render&&t.render())&&(f.data.replace(new Uint8Array(t.data.buffer)),!0)}class to extends r.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&r.r()&&(this.imageRasterizerDispatcher=new r.D(r.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new r.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const a=this.atlasTexture.get(t);a&&(a.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,a){this.imageProviders.has(a)||this.imageProviders.set(a,new Map),this.imageProviders.get(a).set(t.id,t)}removeImageProvider(t,a){this.imageProviders.has(a)&&this.imageProviders.get(a).delete(t)}getPendingImageProviders(){const t=[];for(const a of this.imageProviders.values())for(const p of a.values())p.hasPendingRequests()&&t.push(p);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new r.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,a){if(this.loaded.get(a)!==t&&(this.loaded.set(a,t),t)){for(const{ids:p,callback:y}of this.requestors)this._notify(p,a,y);this.requestors=[]}}hasImage(t,a){return!!this.getImage(t,a)}getImage(t,a){return this.images.get(a).get(t.toString())}addImage(t,a,p){this._validate(t,p)&&this.images.get(a).set(t.toString(),p)}_validate(t,a){let p=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new r.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new r.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(a.content,a)||(this.fire(new r.y(new Error(`Image "${t.name}" has invalid "content" value`))),p=!1),p}_validateStretch(t,a){if(!t)return!0;let p=0;for(const y of t){if(y[0]<p||y[1]<y[0]||a<y[1])return!1;p=y[1]}return!0}_validateContent(t,a){return t?t.length!==4||!a.usvg&&(t[0]<0||a.data.width<t[0]||t[1]<0||a.data.height<t[1]||t[2]<0||a.data.width<t[2]||t[3]<0||a.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,a,p){const y=this.images.get(a).get(t.toString());p.version=y.version+1,this.images.get(a).set(t.toString(),p),this.updatedImages.get(a).add(t),this.removeFromImageRasterizerCache(t,a)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,a){this.spriteFormat!=="raster"&&(r.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:a}):this.imageRasterizer.removeImagesFromCacheByIds([t],a))}removeImage(t,a){const p=this.images.get(a),y=p.get(t.toString());p.delete(t.toString()),this.patterns.get(a).delete(t.toString()),this.removeFromImageRasterizerCache(t,a),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(a=>r.I.from(a))}getImages(t,a,p){const y=[],b=[],T=this.imageProviders.get(a);for(const F of t){if(!F.iconsetId){y.push(F);continue}const j=T.get(F.iconsetId);j&&(this.getImage(F,a)?b.push(F):j.addPendingRequest(F))}if(y.length===0)return void this._notify(b,a,p);let R=!0;const D=!!this.loaded.get(a),L=this.images.get(a);if(!D)for(const F of y)L.has(F.toString())||(R=!1);D||R?this._notify(y,a,p):this.requestors.push({ids:y,scope:a,callback:p})}rasterizeImages(t,a){const p=new Map,{tasks:y,scope:b}=t;for(const[T,R]of y.entries()){const D=this.getImage(R.id,b);D&&p.set(T,{image:D,imageVariant:R})}this._rasterizeImages(b,p,a)}_rasterizeImages(t,a,p){if(r.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:a,scope:t},p);else{const y=new Map;for(const[b,{image:T,imageVariant:R}]of a.entries())y.set(b,this.imageRasterizer.rasterize(R,T,t,0));p(void 0,y)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,a,p){const y=this.images.get(a),b=new Map;for(const T of t){if(!y.get(T.toString())){if(T.iconsetId)continue;this.fire(new r.z("styleimagemissing",{id:T.name}))}const R=y.get(T.toString());if(!R){r.w(`Image "${T.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const D={data:R.usvg?null:R.data.clone(),pixelRatio:R.pixelRatio,sdf:R.sdf,usvg:R.usvg,version:R.version,stretchX:R.stretchX,stretchY:R.stretchY,content:R.content,hasRenderCallback:!!(R.userImage&&R.userImage.render)};R.usvg&&Object.assign(D,{width:R.icon.usvg_tree.width,height:R.icon.usvg_tree.height}),b.set(r.I.toString(T),D)}p(null,b)}getPixelSize(t){const{width:a,height:p}=this.atlasImage.get(t);return{width:a,height:p}}getPattern(t,a,p){const y=t.toString(),b=this.patterns.get(a),T=b.get(y),R=this.getImage(t,a);if(!R)return null;if(T){if(T.position.version===R.version)return T.position;T.position.version=R.version}else{if(R.usvg&&!R.data){const D=this.getPatternInFlightId(y,a);if(this.patternsInFlight.has(D))return null;this.patternsInFlight.add(D);const L=new r.A(t).scaleSelf(r.o.devicePixelRatio),F=new Map([[L.toString(),{image:R,imageVariant:L}]]);return this._rasterizeImages(a,F,(j,B)=>this.storePatternImage(L,a,R,p,B)),null}this.storePattern(t,a,R)}return this._updatePatternAtlas(a,p),b.get(y).position}getPatternInFlightId(t,a){return r.B(t,a)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,a,p,y,b){const T=t.toString(),R=b?b.get(T):void 0;R&&(p.data=R,this.storePattern(t.id,a,p),this._updatePatternAtlas(a,y),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),a)))}storePattern(t,a,p){const y={w:p.data.width+2*r.C,h:p.data.height+2*r.C,x:0,y:0},b=new r.F(y,p,r.C);this.patterns.get(a).set(t.toString(),{bin:y,position:b})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,a){const p=t.gl;let y=this.atlasTexture.get(a);y?this.dirty&&(y.update(this.atlasImage.get(a)),this.dirty=!1):(y=new r.T(t,this.atlasImage.get(a),p.RGBA8),this.atlasTexture.set(a,y)),y.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(t,a){const p=this.patterns.get(t),y=Array.from(p.values()).map(({bin:L})=>L),{w:b,h:T}=r.G(y),R=this.atlasImage.get(t);R.resize({width:b||1,height:T||1});const D=this.images.get(t);for(const[L,{bin:F,position:j}]of p.entries()){let B=j.padding;const $=F.x+B,Z=F.y+B,Q=D.get(L).data,re=Q.width,te=Q.height;B=B>1?B-1:B,r.q.copy(Q,R,{x:0,y:0},{x:$,y:Z},{width:re,height:te},a),r.q.copy(Q,R,{x:0,y:te-B},{x:$,y:Z-B},{width:re,height:B},a),r.q.copy(Q,R,{x:0,y:0},{x:$,y:Z+te},{width:re,height:B},a),r.q.copy(Q,R,{x:re-B,y:0},{x:$-B,y:Z},{width:B,height:te},a),r.q.copy(Q,R,{x:0,y:0},{x:$+re,y:Z},{width:B,height:te},a),r.q.copy(Q,R,{x:re-B,y:te-B},{x:$-B,y:Z-B},{width:B,height:B},a),r.q.copy(Q,R,{x:0,y:te-B},{x:$+re,y:Z-B},{width:B,height:B},a),r.q.copy(Q,R,{x:0,y:0},{x:$+re,y:Z+te},{width:B,height:B},a),r.q.copy(Q,R,{x:re-B,y:0},{x:$-B,y:Z+te},{width:B,height:B},a)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,a){const p=this.images.get(a);for(const y of t){if(this.callbackDispatchedThisFrame.get(a).has(y.toString()))continue;this.callbackDispatchedThisFrame.get(a).add(y.toString());const b=p.get(y.toString());Zr(b)&&this.updateImage(y,a,b)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Pr(f){const t=f.value,a=f.valueSpec,p=f.style,y=f.styleSpec,b=f.key,T=f.arrayElementValidator||_n;if(!Array.isArray(t))return[new r.V(b,t,`array expected, ${r.K(t)} found`)];if(a.length&&t.length!==a.length)return[new r.V(b,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new r.V(b,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let R={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};y.$version<7&&(R.function=a.function),r.H(a.value)&&(R=a.value);let D=[];for(let L=0;L<t.length;L++)D=D.concat(T({array:t,arrayIndex:L,value:t[L],valueSpec:R,style:p,styleSpec:y,key:`${b}[${L}]`},!0));return D}function Do(f){const t=f.key,a=f.value,p=f.valueSpec;if(!r.L(a))return[new r.V(t,a,`number expected, ${r.K(a)} found`)];if(a!=a)return[new r.V(t,a,"number expected, NaN found")];if("minimum"in p){let y=p.minimum;if(Array.isArray(p.minimum)&&(y=p.minimum[f.arrayIndex]),a<y)return[new r.V(t,a,`${a} is less than the minimum value ${y}`)]}if("maximum"in p){let y=p.maximum;if(Array.isArray(p.maximum)&&(y=p.maximum[f.arrayIndex]),a>y)return[new r.V(t,a,`${a} is greater than the maximum value ${y}`)]}return[]}function mo(f){const t=f.key,a=f.value;if(!r.H(a))return[new r.V(t,a,`object expected, ${r.K(a)} found`)];const p=f.valueSpec,y=r.J(a.type);let b,T,R,D={};const L=y!=="categorical"&&a.property===void 0,F=!L,j=function(Q){const re=Q.stops;return Array.isArray(re)&&Array.isArray(re[0])&&r.H(re[0][0])}(a),B=aa({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(Q){if(y==="identity")return[new r.V(Q.key,Q.value,'identity function may not have a "stops" property')];let re=[];const te=Q.value;return re=re.concat(Pr({key:Q.key,value:te,valueSpec:Q.valueSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:$})),Array.isArray(te)&&te.length===0&&re.push(new r.V(Q.key,te,"array must have at least one stop")),re},default:function(Q){return _n({key:Q.key,value:Q.value,valueSpec:p,style:Q.style,styleSpec:Q.styleSpec})}}});return y==="identity"&&L&&B.push(new r.V(f.key,f.value,'missing required property "property"')),y==="identity"||a.stops||B.push(new r.V(f.key,f.value,'missing required property "stops"')),y==="exponential"&&p.expression&&!r.M(p)&&B.push(new r.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(F&&!r.N(p)?B.push(new r.V(f.key,f.value,"property functions not supported")):L&&!r.O(p)&&B.push(new r.V(f.key,f.value,"zoom functions not supported"))),y!=="categorical"&&!j||a.property!==void 0||B.push(new r.V(f.key,f.value,'"property" property is required')),B;function $(Q){let re=[];const te=Q.value,se=Q.key;if(!Array.isArray(te))return[new r.V(se,te,`array expected, ${r.K(te)} found`)];if(te.length!==2)return[new r.V(se,te,`array length 2 expected, length ${te.length} found`)];if(j){if(!r.H(te[0]))return[new r.V(se,te,`object expected, ${r.K(te[0])} found`)];const me=te[0];if(me.zoom===void 0)return[new r.V(se,te,"object stop key must have zoom")];if(me.value===void 0)return[new r.V(se,te,"object stop key must have value")];const ce=r.J(me.zoom);if(typeof ce!="number")return[new r.V(se,me.zoom,"stop zoom values must be numbers")];if(R&&R>ce)return[new r.V(se,me.zoom,"stop zoom values must appear in ascending order")];ce!==R&&(R=ce,T=void 0,D={}),re=re.concat(aa({key:`${se}[0]`,value:te[0],valueSpec:{zoom:{}},style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:Do,value:Z}}))}else re=re.concat(Z({key:`${se}[0]`,value:te[0],style:Q.style,styleSpec:Q.styleSpec},te));return r.Q(r.S(te[1]))?re.concat([new r.V(`${se}[1]`,te[1],"expressions are not allowed in function stops.")]):re.concat(_n({key:`${se}[1]`,value:te[1],valueSpec:p,style:Q.style,styleSpec:Q.styleSpec}))}function Z(Q,re){const te=r.K(Q.value),se=r.J(Q.value),me=Q.value!==null?Q.value:re;if(b){if(te!==b)return[new r.V(Q.key,me,`${te} stop domain type must match previous stop domain type ${b}`)]}else b=te;if(te!=="number"&&te!=="string"&&te!=="boolean"&&typeof se!="number"&&typeof se!="string"&&typeof se!="boolean")return[new r.V(Q.key,me,"stop domain value must be a number, string, or boolean")];if(te!=="number"&&y!=="categorical"){let ce=`number expected, ${te} found`;return r.N(p)&&y===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(Q.key,me,ce)]}return y!=="categorical"||te!=="number"||typeof se=="number"&&isFinite(se)&&Math.floor(se)===se?y!=="categorical"&&te==="number"&&typeof se=="number"&&typeof T=="number"&&T!==void 0&&se<T?[new r.V(Q.key,me,"stop domain values must appear in ascending order")]:(T=se,y==="categorical"&&se in D?[new r.V(Q.key,me,"stop domain values must be unique")]:(D[se]=!0,[])):[new r.V(Q.key,me,`integer expected, found ${String(se)}`)]}}function ha(f){const t=(f.expressionContext==="property"?r.W:r.U)(r.S(f.value),f.valueSpec);if(t.result==="error")return t.value.map(p=>new r.V(`${f.key}${p.key}`,f.value,p.message));const a=t.value.expression||t.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!a.outputDefined())return[new r.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!r.Z(a))return[new r.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Ra(a,f);if(f.expressionContext==="appearance")return bo(a,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!r.X(a,["zoom","feature-state"]))return[new r.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!r.Y(a))return[new r.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ra(f,t){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const y of t.valueSpec.expression.parameters)a.delete(y);if(a.size===0)return[];const p=[];return f instanceof r._&&a.has(f.name)?[new r.V(t.key,t.value,`["${f.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(f.eachChild(y=>{p.push(...Ra(y,t))}),p)}function bo(f,t){const a=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const y of t.valueSpec.expression.parameters)a.add(y);if(a.size===0)return[];const p=[];return f instanceof r._&&!a.has(f.name)?[new r.V(t.key,t.value,`["${f.name}"] is not an allowed parameter`)]:(f.eachChild(y=>{p.push(...bo(y,t))}),p)}function Fa(f){const t=f.key,a=f.value,p=f.valueSpec,y=[];return Array.isArray(p.values)?p.values.indexOf(r.J(a))===-1&&y.push(new r.V(t,a,`expected one of [${p.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(p.values).indexOf(r.J(a))===-1&&y.push(new r.V(t,a,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(a)} found`)),y}function wa(f){return r.a2(r.S(f.value))?ha(Object.assign({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Na(f)}function Na(f){const t=f.value,a=f.key;if(!Array.isArray(t))return[new r.V(a,t,`array expected, ${r.K(t)} found`)];if(t.length<1)return[new r.V(a,t,"filter array must have at least 1 element")];const p=f.styleSpec;let y=Fa({key:`${a}[0]`,value:t[0],valueSpec:p.filter_operator});switch(r.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&r.J(t[1])==="$type"&&y.push(new r.V(a,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new r.V(a,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(r.a0(t[1])||y.push(new r.V(`${a}[1]`,t[1],`string expected, ${r.K(t[1])} found`)));for(let b=2;b<t.length;b++)r.J(t[1])==="$type"?y=y.concat(Fa({key:`${a}[${b}]`,value:t[b],valueSpec:p.geometry_type})):r.a0(t[b])||r.L(t[b])||r.$(t[b])||y.push(new r.V(`${a}[${b}]`,t[b],`string, number, or boolean expected, ${r.K(t[b])} found.`));break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)y=y.concat(Na({key:`${a}[${b}]`,value:t[b],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":t.length!==2?y.push(new r.V(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):r.a0(t[1])||y.push(new r.V(`${a}[1]`,t[1],`string expected, ${r.K(t[1])} found`))}return y}function qa(f,t){const a=f.key,p=f.style,y=f.layer,b=f.styleSpec,T=f.value,R=f.objectKey,D=b[`${t}_${f.layerType}`];if(!D)return[];const L=R.match(/^(.*)-use-theme$/);if(L&&D[L[1]])return r.Q(r.S(T))?[].concat(_n({key:a,value:T,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:R})):_n({key:a,value:T,valueSpec:{type:"string"},style:p,styleSpec:b});const F=R.match(/^(.*)-transition$/);if(t==="paint"&&F&&D[F[1]]&&D[F[1]].transition)return _n({key:a,value:T,valueSpec:b.transition,style:p,styleSpec:b});const j=f.valueSpec||D[R];if(!j)return[new r.a3(a,T,`unknown property "${R}"`)];let B;if(r.a0(T)&&r.N(j)&&!j.tokens&&(B=/^{([^}]+)}$/.exec(T))){const Z=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new r.V(a,T,`"${R}" does not support interpolation syntax
Use an identity property function instead: ${Z}.`)]}const $=[];if(f.layerType==="symbol")R!=="text-field"||!p||p.glyphs||p.imports||$.push(new r.V(a,T,'use of "text-field" requires a style "glyphs" property')),R==="text-font"&&r.a4(r.S(T))&&r.J(T.type)==="identity"&&$.push(new r.V(a,T,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&t==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&r.N(j)&&(r.a5(j)||r.O(j))){const Z=r.W(r.S(T),j).value,Q="expression"in Z&&Z.expression||"_styleExpression"in Z&&Z._styleExpression&&Z._styleExpression.expression;Q&&!r.X(Q,["measure-light"])&&(R==="model-emissive-strength"&&r.Y(Q)&&r.Z(Q)||$.push(new r.V(a,T,`${R} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return $.concat(_n({key:f.key,value:T,valueSpec:j,style:p,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:R}))}function xs(f){return qa(f,"paint")}function ja(f){return qa(f,"layout")}function Pi(f){let t=[];const a=f.value,p=f.key,y=f.style,b=f.styleSpec;if(!r.H(a))return[new r.V(p,a,"object expected")];a.type||a.ref||t.push(new r.V(p,a,'either "type" or "ref" is required'));let T=r.J(a.type);const R=r.J(a.ref);if(a.id){const D=r.J(a.id);for(let L=0;L<f.arrayIndex;L++){const F=y.layers[L];r.J(F.id)===D&&t.push(new r.V(p,a.id,`duplicate layer id "${D}", previously used at line ${F.id.__line__}`))}}if("ref"in a){let D;["type","source","source-layer","filter","layout"].forEach(L=>{L in a&&t.push(new r.V(p,a[L],`"${L}" is prohibited for ref layers`))}),y.layers.forEach(L=>{r.J(L.id)===R&&(D=L)}),D?D.ref?t.push(new r.V(p,a.ref,"ref cannot reference another ref layer")):T=r.J(D.type):typeof R=="string"&&t.push(new r.V(p,a.ref,`ref layer "${R}" not found`))}else if(T!=="background"&&T!=="sky"&&T!=="slot")if(a.source)if(r.a0(a.source)){const D=y.sources&&y.sources[a.source],L=D&&r.J(D.type);D?L==="vector"&&T==="raster"?t.push(new r.V(p,a.source,`layer "${a.id}" requires a raster source`)):L==="raster"&&T!=="raster"?t.push(new r.V(p,a.source,`layer "${a.id}" requires a vector source`)):L!=="vector"||a["source-layer"]?L==="raster-dem"&&T!=="hillshade"?t.push(new r.V(p,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(T)?T==="line"&&a.paint&&(a.paint["line-gradient"]||a.paint["line-trim-offset"])&&L==="geojson"&&!D.lineMetrics?t.push(new r.V(p,a,`layer "${a.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):T==="raster-particle"&&L!=="raster-array"&&t.push(new r.V(p,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):t.push(new r.V(p,a.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new r.V(p,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new r.V(p,a.source,`source "${a.source}" not found`))}else t.push(new r.V(`${p}.source`,a.source,'"source" must be a string'));else t.push(new r.V(p,a,'missing required property "source"'));return t=t.concat(aa({key:p,value:a,valueSpec:b.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>_n({key:`${p}.type`,value:a.type,valueSpec:b.layer.type,style:f.style,styleSpec:f.styleSpec,object:a,objectKey:"type"}),filter:D=>wa(Object.assign({layerType:T},D)),layout:D=>aa({layer:a,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":L=>ja(Object.assign({layerType:T},L))}}),paint:D=>aa({layer:a,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":L=>xs(Object.assign({layerType:T,layer:a},L))}}),appearances(D){const L=Pr({key:D.key,value:D.value,valueSpec:D.valueSpec,style:D.style,styleSpec:D.styleSpec,arrayElementValidator:B=>function($){const{key:Z,layer:Q,layerType:re}=$,te=r.J($.value),se=r.J(te.name),me=r.J(te.condition),ce=aa({key:Z,value:te,valueSpec:$.styleSpec.appearance,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{condition:Ae=>function(_e){const Ie=[];return Ie.push(...ha({key:_e.key,value:_e.object.condition,valueSpec:r.a6.appearance.condition,expressionContext:"appearance"})),Ie}(Object.assign({layer:Q,layerType:re},Ae)),properties:Ae=>function(_e){const Ie=[],{styleSpec:Ce,layer:Te,layerType:De}=_e,Ge=Ce[`paint_${De}`],Ue=Ce[`layout_${De}`],nt=_e.object[_e.objectKey];for(const Ke in nt){const st=Ke in Ge?"paint":Ke in Ue?"layout":void 0;if(!st){Ie.push(new r.V(_e.key,Ke,`unknown property "${Ke}" for layer type "${De}"`));continue}const Pt=Object.assign({},_e,{key:`${_e.key}.${Ke}`,object:nt,objectKey:Ke,layer:Te,layerType:De,value:nt[Ke],valueSpec:st==="paint"?Ge[Ke]:Ue[Ke]});Ie.push(...qa(Pt,st))}return Ie}(Object.assign({layer:Q,layerType:re},Ae))}});return se!=="hidden"&&me===void 0&&ce.push(new r.V($.key,"name",'Appearance with name different than "hidden" must have a condition')),ce}(Object.assign({layerType:T,layer:a},B))}),F=Array.isArray(D.value)?D.value:[],j=new Set;return F.forEach((B,$)=>{const Z=r.J(B.name);if(Z)if(j.has(Z)){const Q=r.J(a.id);L.push(new r.V(D.key,Z,`Duplicated appearance name "${Z}" for layer "${Q}"`))}else j.add(Z)}),L}}})),t}function rn({key:f,value:t}){return r.a0(t)?[]:[new r.V(f,t,`string expected, ${r.K(t)} found`)]}const Qn={promoteId:function f({key:t,value:a}){if(r.a0(a))return rn({key:t,value:a});if(Array.isArray(a)){const y=[],b=r.S(a),T=r.U(b);return T.result==="error"&&T.value.forEach(R=>{y.push(new r.V(`${t}${R.key}`,null,`${R.message}`))}),r.X(T.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||y.push(new r.V(`${t}`,null,"promoteId expression should be only feature dependent")),y}if(!r.H(a))return[new r.V(t,a,`string, expression or object expected, "${r.K(a)}" found`)];const p=[];for(const y in a)p.push(...f({key:`${t}.${y}`,value:a[y]}));return p}};function Fr(f){const t=f.value,a=f.key,p=f.styleSpec,y=f.style;if(!r.H(t))return[new r.V(a,t,`object expected, ${r.K(t)} found`)];if(!("type"in t))return[new r.V(a,t,'"type" is required')];const b=r.J(t.type);let T=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&("url"in t||"tiles"in t||T.push(new r.a3(a,t,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return T=T.concat(aa({key:a,value:t,valueSpec:p[`source_${b.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:Qn})),T;case"geojson":if(T=aa({key:a,value:t,valueSpec:p.source_geojson,style:y,styleSpec:p,objectElementValidators:Qn}),"cluster"in t&&"clusterProperties"in t){if(!r.H(t.clusterProperties))return[new r.V(`${a}.clusterProperties`,t,`object expected, ${r.K(t)} found`)];for(const R in t.clusterProperties){const D=t.clusterProperties[R];if(!Array.isArray(D))return[new r.V(`${a}.clusterProperties.${R}`,D,"array expected")];const[L,F]=D,j=typeof L=="string"?[L,["accumulated"],["get",R]]:L;T.push(...ha({key:`${a}.${R}.map`,value:F,expressionContext:"cluster-map"})),T.push(...ha({key:`${a}.${R}.reduce`,value:j,expressionContext:"cluster-reduce"}))}}return T;case"video":return aa({key:a,value:t,valueSpec:p.source_video,style:y,styleSpec:p});case"image":return aa({key:a,value:t,valueSpec:p.source_image,style:y,styleSpec:p});case"canvas":return[new r.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fa({key:`${a}.type`,value:t.type,valueSpec:{values:Un(p)}})}}function Un(f){return f.source.reduce((t,a)=>{const p=f[a];return p.type.type==="enum"&&(t=t.concat(Object.keys(p.type.values||{}))),t},[])}function da(f){const t=f.value,a=f.styleSpec,p=a.light,y=f.style;if(t===void 0)return[];if(!r.H(t))return[new r.V("light",t,`object expected, ${r.K(t)} found`)];let b=[];for(const T in t){const R=T.match(/^(.*)-transition$/),D=T.match(/^(.*)-use-theme$/);b=b.concat(D&&p[D[1]]?_n({key:T,value:t[T],valueSpec:{type:"string"},style:y,styleSpec:a}):R&&p[R[1]]&&p[R[1]].transition?_n({key:T,value:t[T],valueSpec:a.transition,style:y,styleSpec:a}):p[T]?_n({key:T,value:t[T],valueSpec:p[T],style:y,styleSpec:a}):[new r.V(T,t[T],`unknown property "${T}"`)])}return b}function _a(f){const t=f.value;if(!t)return[];const a=f.key;if(!r.H(t))return[new r.V(a,t,`object expected, ${r.K(t)} found`)];let p=[];const y=f.styleSpec,b=y["light-3d"],T=f.style,R=f.style.lights;for(const F of["type","id"])if(!(F in t))return p=p.concat([new r.V(a,t,`missing property "${F}"`)]),p;if(!r.a0(t.type))return p=p.concat([new r.V(`${a}.type`,t.type,"string expected")]),p;if(R)for(let F=0;F<f.arrayIndex;F++){const j=r.J(t.type),B=R[F];r.J(B.type)===j&&p.push(new r.V(a,t.id,`duplicate light type "${t.type}", previously defined at line ${B.id.__line__}`))}const D=`properties_light_${t.type}`;if(!(D in y))return p=p.concat([new r.V(`${a}.type`,t,`Invalid light type ${t.type}`)]),p;const L=y[D];for(const F in t)if(F==="properties"){const j=t[F];if(!r.H(j))return p=p.concat([new r.V("properties",j,`object expected, ${r.K(j)} found`)]),p;for(const B in j){const $=B.match(/^(.*)-transition$/),Z=B.match(/^(.*)-use-theme$/);p=p.concat(Z&&L[Z[1]]?_n({key:F,value:j[B],valueSpec:{type:"string"},style:T,styleSpec:y}):$&&L[$[1]]&&L[$[1]].transition?_n({key:F,value:t[F],valueSpec:y.transition,style:T,styleSpec:y}):L[B]?_n({key:B,value:j[B],valueSpec:L[B],style:T,styleSpec:y}):[new r.a3(f.key,j[B],`unknown property "${B}"`)])}}else p=p.concat(b[F]?_n({key:F,value:t[F],valueSpec:b[F],style:T,styleSpec:y}):[new r.a3(F,t[F],`unknown property "${F}"`)]);return p}function Ga(f){const t=f.value,a=f.key,p=f.style,y=f.styleSpec,b=y.terrain;if(t==null)return[];if(!r.H(t))return[new r.V("terrain",t,`object expected, ${r.K(t)} found`)];let T=[];for(const R in t){const D=R.match(/^(.*)-transition$/),L=R.match(/^(.*)-use-theme$/);T=T.concat(L&&b[L[1]]?_n({key:R,value:t[R],valueSpec:{type:"string"},style:p,styleSpec:y}):D&&b[D[1]]&&b[D[1]].transition?_n({key:R,value:t[R],valueSpec:y.transition,style:p,styleSpec:y}):b[R]?_n({key:R,value:t[R],valueSpec:b[R],style:p,styleSpec:y}):[new r.a3(R,t[R],`unknown property "${R}"`)])}if(t.source)if(r.a0(t.source)){const R=p.sources&&p.sources[t.source],D=R&&r.J(R.type);R?D!=="raster-dem"&&T.push(new r.V(`${a}.source`,t.source,`terrain cannot be used with a source of type ${D}, it only be used with a "raster-dem" source type`)):T.push(new r.V(`${a}.source`,t.source,`source "${t.source}" not found`))}else T.push(new r.V(`${a}.source`,t.source,"source must be a string"));else T.push(new r.V(a,t,'terrain is missing required property "source"'));return T}function Vr(f){const t=f.value,a=f.style,p=f.styleSpec,y=p.fog;if(t===void 0)return[];if(!r.H(t))return[new r.V("fog",t,`object expected, ${r.K(t)} found`)];let b=[];for(const T in t){const R=T.match(/^(.*)-transition$/),D=T.match(/^(.*)-use-theme$/);b=b.concat(D&&y[D[1]]?_n({key:T,value:t[T],valueSpec:{type:"string"},style:a,styleSpec:p}):R&&y[R[1]]&&y[R[1]].transition?_n({key:T,value:t[T],valueSpec:p.transition,style:a,styleSpec:p}):y[T]?_n({key:T,value:t[T],valueSpec:y[T],style:a,styleSpec:p}):[new r.a3(T,t[T],`unknown property "${T}"`)])}return b}const xr={"*":()=>[],array:Pr,boolean:function(f){const t=f.value,a=f.key;return r.$(t)?[]:[new r.V(a,t,`boolean expected, ${r.K(t)} found`)]},number:Do,color:function({key:f,value:t}){return r.a0(t)?r.a1.parseCSSColor(t)===null?[new r.V(f,t,`color expected, "${t}" found`)]:[]:[new r.V(f,t,`color expected, ${r.K(t)} found`)]},enum:Fa,filter:wa,function:mo,layer:Pi,object:aa,source:Fr,model:r.a7,light:da,"light-3d":_a,terrain:Ga,fog:Vr,string:rn,formatted:function(f){return rn(f).length===0?[]:ha(f)},resolvedImage:function(f){return rn(f).length===0?[]:ha(f)},projection:function(f){const t=f.value,a=f.styleSpec,p=a.projection,y=f.style;if(r.H(t)){let b=[];for(const T in t)b=b.concat(_n({key:T,value:t[T],valueSpec:p[T],style:y,styleSpec:a}));return b}return r.a0(t)?[]:[new r.V("projection",t,`object or string expected, ${r.K(t)} found`)]},import:function(f){const t=f.key,{value:a,styleSpec:p}=f;if(!r.H(a))return[new r.V(t,a,"import must be an object")];const{data:y,...b}=a;Object.defineProperty(b,"__line__",{value:a.__line__,enumerable:!1});let T=aa(Object.assign({},f,{value:b,valueSpec:p.import}));return r.J(b.id)===""&&T.push(new r.V(`${f.key}.id`,b,"import id can't be an empty string")),y&&(T=T.concat(go(y,p,{key:`${f.key}.data`}))),T},iconset:function(f){const t=f.value,a=f.key,p=f.styleSpec,y=f.style;if(!r.H(t))return[new r.V(a,t,"object expected")];if(!t.type)return[new r.V(a,t,'"type" is required')];const b=r.J(t.type);let T=[];if(T=T.concat(aa({key:a,value:t,valueSpec:p[`iconset_${b}`],style:y,styleSpec:p})),function(R,D){return!(R!=="source"||!D.source)}(b,t)){const R=y.sources&&y.sources[t.source],D=R&&r.J(R.type);R?D!=="raster-array"&&T.push(new r.V(a,t.source,`iconset cannot be used with a source of type ${String(D)}, it only be used with a "raster-array" source type`)):T.push(new r.V(a,t.source,`source "${t.source}" not found`))}return T}};function _n(f,t=!1){const a=f.value,p=f.valueSpec,y=f.styleSpec;if(p.expression){if(r.a4(r.J(a)))return mo(f);if(r.Q(r.S(a)))return ha(f)}if(p.type&&xr[p.type]){const b=xr[p.type](f);return t===!0&&b.length>0&&Array.isArray(f.value)?ha(f):b}return aa(Object.assign({},f,{valueSpec:p.type?y[p.type]:p}))}function aa(f){const t=f.key,a=f.value,p=f.valueSpec||{},y=f.objectElementValidators||{},b=f.style,T=f.styleSpec;if(!r.H(a))return[new r.V(t,a,`object expected, ${r.K(a)} found`)];let R=[];for(const D in a){const L=D.split(".")[0];let F;y[L]?F=y[L]:p[L]?F=_n:y["*"]?F=y["*"]:p["*"]&&(F=_n),F?R=R.concat(F({key:(t&&`${t}.`)+D,value:a[D],valueSpec:p[L]||p["*"],style:b,styleSpec:T,object:a,objectKey:D},a)):R.push(new r.a3(t,a[D],`unknown property "${D}"`))}for(const D in p){if(y[D])continue;const L=p[D];L.required&&L.default===void 0&&a[D]===void 0&&R.push(new r.V(t,a,`missing required property "${D}"`))}return R}function wo({key:f,value:t}){const a=rn({key:f,value:t});if(a.length)return a;const p=t;return p.indexOf("{fontstack}")===-1&&a.push(new r.V(f,t,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&a.push(new r.V(f,t,'"glyphs" url must include a "{range}" token')),a}function go(f,t=r.a6,a={}){return aa({key:a.key||"",value:f,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:f,objectElementValidators:{glyphs:wo}})}function no(f,t=r.a6){return ie(go(f,t))}const tc=f=>ie(Fr(f)),ml=f=>ie(da(f)),ic=f=>ie(_a(f)),Ks=f=>ie(Ga(f)),vt=f=>ie(Vr(f)),To=f=>ie(function(t){const a=t.value,p=t.style,y=t.styleSpec,b=y.snow;if(a===void 0)return[];if(!r.H(a))return[new r.V("snow",a,`object expected, ${r.K(a)} found`)];let T=[];for(const R in a){const D=R.match(/^(.*)-transition$/);T=T.concat(D&&b[D[1]]&&b[D[1]].transition?_n({key:R,value:a[R],valueSpec:y.transition,style:p,styleSpec:y}):b[R]?_n({key:R,value:a[R],valueSpec:b[R],style:p,styleSpec:y}):[new r.a3(R,a[R],`unknown property "${R}"`)])}return T}(f)),Go=f=>ie(function(t){const a=t.value,p=t.style,y=t.styleSpec,b=y.rain;if(a===void 0)return[];if(!r.H(a))return[new r.V("rain",a,`object expected, ${r.K(a)} found`)];let T=[];for(const R in a){const D=R.match(/^(.*)-transition$/);T=T.concat(D&&b[D[1]]&&b[D[1]].transition?_n({key:R,value:a[R],valueSpec:y.transition,style:p,styleSpec:y}):b[R]?_n({key:R,value:a[R],valueSpec:b[R],style:p,styleSpec:y}):[new r.a3(R,a[R],`unknown property "${R}"`)])}return T}(f)),Mo=f=>ie(Pi(f)),cn=f=>ie(wa(f)),Za=f=>ie(xs(f)),et=f=>ie(ja(f)),vi=f=>ie(r.a7(f));function ie(f){return f.slice().sort((t,a)=>t.line&&a.line?t.line-a.line:0)}function W(f,t){let a=!1;if(t&&t.length)for(const p of t)p instanceof r.a3?r.w(p.message):(f.fire(new r.y(new Error(p.message))),a=!0);return a}const X=r.a6.light;let he;class we extends r.E{constructor(t,a="flat"){super(),this._transitionable=new r.a8(he||(he=new r.a9({anchor:new r.aa(X.anchor),position:new r.ab(X.position),color:new r.aa(X.color),intensity:new r.aa(X.intensity)}))),this.setLight(t,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a,p={}){this._validate(ml,t,p)||(this._transitionable.setTransitionOrValue(t),this.id=a)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,p){return(!p||p.validate!==!1)&&W(this,t.call(no,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}const ye=r.a6.terrain;let Me=class extends r.E{constructor(f,t,a,p,y){super(),this.scope=a,this._transitionable=new r.a8(new r.a9({source:new r.aa(ye.source),exaggeration:new r.aa(ye.exaggeration)}),a,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=y}get(){return this._transitionable.serialize()}set(f,t){this._transitionable.setTransitionOrValue(f,t)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new r.ac(f,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const f=this._transitionable._values.exaggeration;if(!f)return null;const t=f.value.expression;if(!t)return null;let a=-1,p=-1,y=1;for(const b of t.zoomStops)y=t.evaluate(new r.ac(b,{worldview:this.worldview})),y>.01?(a=b,p=-1):p=b;return y<.01&&a>0&&p>a?[a,p]:null}isZoomDependent(){const f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof r.ad}};const Ve=45,Le=65,$e=.05;function gt(f,t,a,p){const y=r.ah(Ve,Le,a),[b,T]=ut(f,p);let R=1-Math.min(1,Math.exp((t-b)/(T-b)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*y*f.alpha}function ut(f,t){const a=.5/Math.tan(.5*t);return[f.range[0]+a,f.range[1]+a]}function Kt(f,t,a,p,y){const b=r.af([],[t,a,p],y.mercatorFogMatrix);return gt(f,r.ag(b),y.pitch,y._fov)}function Ci(f,t,a,p,y,b,T){const R=[[a,p,0],[y,p,0],[y,b,0],[a,b,0]];let D=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const F of R){const j=r.af([],F,t),B=r.ag(j);D=Math.min(D,B),L=Math.max(L,B)}return[gt(f,D,T.pitch,T._fov),gt(f,L,T.pitch,T._fov)]}const _i=r.a6.fog;class Yt extends r.E{constructor(t,a,p,y){super();const b=new r.a9({range:new r.aa(_i.range),color:new r.aa(_i.color),"color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new r.aa(_i["high-color"]),"high-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new r.aa(_i["space-color"]),"space-color-use-theme":new r.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new r.aa(_i["horizon-blend"]),"star-intensity":new r.aa(_i["star-intensity"]),"vertical-range":new r.aa(_i["vertical-range"])});this._transitionable=new r.a8(b,p,new Map(y)),this.set(t,y),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new r.ai(b),this.scope=p}get state(){const t=this._transform,a=t.projection.name==="globe",p=r.aj(t.zoom),y=this.properties.get("range"),b=[.5,3];return{range:a?[r.ak(b[0],y[0],p),r.ak(b[1],y[1],p)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,a,p={}){if(this._validate(vt,t,p))return;const y=Object.assign({},t);for(const b of Object.keys(_i))y[b]===void 0&&(y[b]=_i[b].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.ah(Ve,Le,t))*a.a}getOpacityAtLatLng(t,a){return this._transform.projection.supportsFog?function(p,y,b){const T=r.ae.fromLngLat(y),R=b.elevation?b.elevation.getAtPointOrZero(T):0;return Kt(p,T.x,T.y,R,b)}(this.state,t,a):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ci(this.state,a,0,0,r.al,r.al,this._transform)}getOpacityForBounds(t,a,p,y,b){return this._transform.projection.supportsFog?Ci(this.state,t,a,p,y,b,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?ut(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const p of a){const y=t.points[p];let b;if(y[2]>=0)b=y;else{const T=t.points[p-4];b=r.am(T,y,T[2]/(T[2]-y[2]))}if(Kt(this.state,b[0],b[1],0,this._transform)>=$e)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,p){return(!p||p.validate!==!1)&&W(this,t.call(no,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}}let Yi,ln,lr,Or,Ta=class extends r.E{constructor(f,t,a,p){super();const y=Yi||(Yi=new r.a9({density:new r.aa(r.a6.snow.density),intensity:new r.aa(r.a6.snow.intensity),color:new r.aa(r.a6.snow.color),opacity:new r.aa(r.a6.snow.opacity),vignette:new r.aa(r.a6.snow.vignette),"vignette-color":new r.aa(r.a6.snow["vignette-color"]),"center-thinning":new r.aa(r.a6.snow["center-thinning"]),direction:new r.aa(r.a6.snow.direction),"flake-size":new r.aa(r.a6.snow["flake-size"])}));this._transitionable=new r.a8(y,a,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(y),this.scope=a}get state(){const f=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),p=r.an(a[0]),y=-Math.max(r.an(a[1]),.01),b=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],T=this.properties.get("vignette"),R=this.properties.get("vignette-color");return R.a=T,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(t.r,t.g,t.b,t.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:R}}get(){return this._transitionable.serialize()}set(f,t,a={}){if(this._validate(To,f,a))return;const p=Object.assign({},f),y=r.a6.snow;for(const b of Object.keys(y))p[b]===void 0&&(p[b]=y[b].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,t,a){return(!a||a.validate!==!1)&&W(this,f.call(no,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}},oa=class extends r.E{constructor(f,t,a,p){super();const y=ln||(ln=new r.a9({density:new r.aa(r.a6.rain.density),intensity:new r.aa(r.a6.rain.intensity),color:new r.aa(r.a6.rain.color),opacity:new r.aa(r.a6.rain.opacity),vignette:new r.aa(r.a6.rain.vignette),"vignette-color":new r.aa(r.a6.rain["vignette-color"]),"center-thinning":new r.aa(r.a6.rain["center-thinning"]),direction:new r.aa(r.a6.rain.direction),"droplet-size":new r.aa(r.a6.rain["droplet-size"]),"distortion-strength":new r.aa(r.a6.rain["distortion-strength"])}));this._transitionable=new r.a8(y,a,new Map(p)),this.set(f,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new r.ai(y),this.scope=a}get state(){const f=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),p=r.an(a[0]),y=-Math.max(r.an(a[1]),.01),b=[Math.cos(p)*Math.cos(y),Math.sin(p)*Math.cos(y),Math.sin(y)],T=this.properties.get("vignette-color");return T.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new r.ao(t.r,t.g,t.b,t.a*f),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(f,t,a={}){if(this._validate(Go,f,a))return;const p=Object.assign({},f),y=r.a6.rain;for(const b of Object.keys(y))p[b]===void 0&&(p[b]=y[b].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(f){this._transitionable.setTransitionOrValue(this._options,new Map(f))}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}_validate(f,t,a){return(!a||a.validate!==!1)&&W(this,f.call(no,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:r.a6})))}};class Kr extends r.E{constructor(t,a,p,y){super(),this.scope=p,this._options=t,this.properties=new r.ai(a),this._transitionable=new r.a8(a,p,new Map(y)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,a){this._options=t,this._transitionable.setTransitionOrValue(t.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class er{constructor(t,a,p){this.screenBounds=t,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=a,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(t,a){let p,y;if(t instanceof r.P||typeof t[0]=="number"){const b=r.P.convert(t);p=[b],y=a.isPointAboveHorizon(b)}else{const b=r.P.convert(t[0]),T=r.P.convert(t[1]),R=b.add(T)._div(2);p=[b,T],y=r.aq(b,T).every(D=>a.isPointAboveHorizon(D))&&a.isPointAboveHorizon(R)}return new er(p,y,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return r.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const a=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],y=r.aq(a,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<p.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?y[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(y[3]=this.cameraPoint)),r.ar(y,t)}bufferedCameraGeometryGlobe(t){const a=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],y=r.aq(a,p,t),b=this.cameraPoint.clone();switch(3*((b.y>a.y)+(b.y>p.y))+((b.x>a.x)+(b.x>p.x))){case 0:y[0]=b,y[4]=b.clone();break;case 1:y.splice(1,0,b);break;case 2:y[1]=b;break;case 3:y.splice(4,0,b);break;case 5:y.splice(2,0,b);break;case 6:y[3]=b;break;case 7:y.splice(3,0,b);break;case 8:y[2]=b}return y}containsTile(t,a,p,y=0){const b=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/a._pixelsPerMercatorPixel+1,T=p?this._bufferedCameraMercator(b,a):this._bufferedScreenMercator(b,a);let R=t.tileID.wrap+(T.unwrapped?y:0);const D=T.polygon.map(re=>r.as(t.tileTransform,re,R));if(!r.at(D,0,0,r.al,r.al))return;R=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const L=this.screenGeometryMercator.polygon.map(re=>r.au(t.tileTransform,re,R)),F=L.map(re=>new r.P(re[0],re[1])),j=a.getFreeCameraOptions().position||new r.ae(0,0,0),B=r.au(t.tileTransform,j,R),$=L.map(re=>{const te=r.av(re,re,B);return r.aw(te,te),new r.ax(B,te)}),Z=r.ay(t,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:$,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(Q=r.az(D),Q.min.x=r.aA(Q.min.x,0,r.al),Q.min.y=r.aA(Q.min.y,0,r.al),Q.max.x=r.aA(Q.max.x,0,r.al),Q.max.y=r.aA(Q.max.y,0,r.al),Q),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Z};var Q}_bufferedScreenMercator(t,a){const p=Gr(t);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let y;return y=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),a):{polygon:this.bufferedScreenGeometry(t).map(b=>a.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[p]=y,y}}_bufferedCameraMercator(t,a){const p=Gr(t);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let y;return y=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),a):{polygon:this.bufferedCameraGeometry(t).map(b=>a.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[p]=y,y}}_projectAndResample(t,a){const p=function(b,T){const R=r.aB([],T.pixelMatrix,T.globeMatrix),D=[0,-r.aD,0,1],L=[0,r.aD,0,1],F=[0,0,0,1];r.aC(D,D,R),r.aC(L,L,R),r.aC(F,F,R);const j=new r.P(D[0]/D[3],D[1]/D[3]),B=new r.P(L[0]/L[3],L[1]/L[3]),$=r.aE(b,j)&&D[3]<F[3],Z=r.aE(b,B)&&L[3]<F[3];if(!$&&!Z)return null;const Q=function(Ie,Ce,Te){for(let De=1;De<Ie.length;De++){const Ge=Rr(Ce.pointCoordinate3D(Ie[De-1]).x),Ue=Rr(Ce.pointCoordinate3D(Ie[De]).x);if(Te<0){if(Ge<Ue)return{idx:De,t:-Ge/(Ue-1-Ge)}}else if(Ue<Ge)return{idx:De,t:(1-Ge)/(Ue+1-Ge)}}return null}(b,T,$?-1:1);if(!Q)return null;const{idx:re,t:te}=Q;let se=re>1?bn(b.slice(0,re),T):[],me=re<b.length?bn(b.slice(re),T):[];se=se.map(Ie=>new r.P(Rr(Ie.x),Ie.y)),me=me.map(Ie=>new r.P(Rr(Ie.x),Ie.y));const ce=[...se];ce.length===0&&ce.push(me[me.length-1]);const Ae=r.ak(ce[ce.length-1].y,(me.length===0?se[0]:me[0]).y,te);let _e;return _e=$?[new r.P(0,Ae),new r.P(0,0),new r.P(1,0),new r.P(1,Ae)]:[new r.P(1,Ae),new r.P(1,1),new r.P(0,1),new r.P(0,Ae)],ce.push(..._e),me.length===0?ce.push(se[0]):ce.push(...me),{polygon:ce.map(Ie=>new r.ae(Ie.x,Ie.y)),unwrapped:!1}}(t,a);if(p)return p;const y=function(b,T){let R=!1,D=-1/0,L=0;for(let j=0;j<b.length-1;j++)b[j].x>D&&(D=b[j].x,L=j);for(let j=0;j<b.length-1;j++){const B=(L+j)%(b.length-1),$=b[B],Z=b[B+1];Math.abs($.x-Z.x)>.5&&($.x<Z.x?($.x+=1,B===0&&(b[b.length-1].x+=1)):(Z.x+=1,B+1===b.length-1&&(b[0].x+=1)),R=!0)}const F=r.aF(T.center.lng);return R&&F<Math.abs(F-1)&&b.forEach(j=>{j.x-=1}),{polygon:b,unwrapped:R}}(bn(t,a).map(b=>new r.P(Rr(b.x),b.y)),a);return{polygon:y.polygon.map(b=>new r.ae(b.x,b.y)),unwrapped:y.unwrapped}}}function bn(f,t){return r.aG(f,a=>{const p=t.pointCoordinate3D(a);a.x=p.x,a.y=p.y},1/256)}function Rr(f){return f<0?1+f%1:f%1}function Gr(f){return 100*f|0}function rr(f,t,a,p,y){const b=function(R,D){if(R)return y(R);if(D){if(f.url&&D.tiles&&f.tiles&&delete f.tiles,D.variants){if(!Array.isArray(D.variants))return y(new Error("variants must be an array"));for(const F of D.variants){if(F==null||typeof F!="object"||F.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(F.capabilities))return y(new Error("capabilities must be an array"));if(F.capabilities.length===1&&F.capabilities[0]==="meshopt"){D=Object.assign(D,F);break}}}const L=r.aH(Object.assign({},D,f),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);L.tiles=t.canonicalizeTileset(L,f.url),y(null,L)}},T=function(R,D,L){if(!R)return null;if(!D&&!L)return R;L=L||R.worldview_default;const F=Object.values(R.language||{});if(F.length===0)return null;const j=Object.values(R.worldview||{});if(j.length===0)return null;const B=F.every(Z=>Z===D),$=j.every(Z=>Z===L);return B&&$?R:D in(R.language_options||{})||L in(R.worldview_options||{})?null:R.language_options&&R.worldview_options?R:null}(f.data,a,p);return T?r.o.frame(()=>b(null,T)):f.url?r.m(t.transformRequest(t.normalizeSourceURL(f.url,null,a,p),r.R.Source),b):r.o.frame(()=>{const{data:R,...D}=f;b(null,D)})}function Tr(f,t){const a=Math.pow(2,t.z),p=Math.floor(r.aF(f.getWest())*a),y=Math.floor(r.aJ(f.getNorth())*a),b=Math.ceil(r.aF(f.getEast())*a),T=Math.ceil(r.aJ(f.getSouth())*a);return t.x>=p&&t.x<b&&t.y>=y&&t.y<T}class sa{constructor(t,a,p){this.bounds=t?r.aI.convert(this.validateBounds(t)):null,this.minzoom=a||0,this.maxzoom=p||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const a of t)this.extraBounds.push(r.aI.convert(this.validateBounds(a)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Tr(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const a of this.extraBounds)if(Tr(a,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const a=new sa(t.bounds,t.minzoom,t.maxzoom);return a.addExtraBounds(t.extra_bounds),a}}class ro extends r.E{constructor(t,a,p,y){if(super(),this.id=t,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,r.aH(a,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new r.aK}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=rr(this._options,this.map._requestManager,a,p,(y,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new r.y(y));else if(b){if(Object.assign(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const T of b.vector_layers)this.vectorLayerIds.push(T.id),b.worldview&&b.worldview[T.source]&&this.localizableLayerIds.add(T.id)}this.tileBounds=sa.fromTileJSON(b),Jn(b.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(y)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,a){const p=t.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(p),b=this.map._requestManager.transformRequest(y,r.R.Tile),T=this.map.style?this.map.style.getLut(this.scope):null,R=T?{image:T.image.clone()}:null,D={request:b,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:R,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&r.h(p)&&(D.localizableLayerIds=this.localizableLayerIds),D.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=a:t.request=t.actor.send("reloadTile",D,L.bind(this));else if(t.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",D,L.bind(this),void 0,!0);else{const F=r.aL.call({deduped:this._deduped},D,(j,B)=>{if(j||!B)L.call(this,j);else{const $=r.aM(B.responseHeaders);D.data={cacheControl:$.cacheControl,expires:$.expires,rawData:B.rawData.slice(0)},t.actor&&t.actor.send("loadTile",D,L.bind(this),void 0,!0)}},!0);t.request={cancel:F}}function L(F,j){return delete t.request,t.aborted?a(null):F&&F.status!==404?a(F):(j&&j.resourceTiming&&(t.resourceTiming=j.resourceTiming),this.map._refreshExpiredTiles&&j&&t.setExpiryData(j),t.loadVectorData(j,this.map.painter),r.aN(this.dispatcher),a(null,j),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ho extends r.E{constructor(t,a,p,y){super(),this.id=t,this.dispatcher=p,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},a),Object.assign(this,r.aH(a,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const a=this.map.getWorldview();this._tileJSONRequest=rr(this._options,this.map._requestManager,null,a,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new r.y(p)):y&&(Object.assign(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map(b=>b.id)),this.tileBounds=sa.fromTileJSON(y),Jn(y.tiles),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(p)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const p=r.o.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);t.request=r.n(this.map._requestManager.transformRequest(y,r.R.Tile),(b,T,R)=>{if(delete t.request,t.aborted)return t.state="unloaded",a(null);if(b)return t.state="errored",a(b);if(!T)return a(null);const D=r.aM(R);this.map._refreshExpiredTiles&&t.setExpiryData(D),t.setTexture(T,this.map.painter),t.state="loaded",r.aN(this.dispatcher),a(null)})}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a&&a()}unloadTile(t,a){t.texture&&t.texture instanceof r.T?(t.destroy(!0),t.texture&&t.texture instanceof r.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Ll([f,t],a,p,{scaled:y=!0}={}){const{tileSize:b,buffer:T}=p,{x:R,y:D,z:L}=a;if(!isFinite(R)||!isFinite(D)||!isFinite(L))throw new Error("Invalid MRT header");const F=2**L,j=F*r.aF(f),B=F*r.aJ(t);return function([$,Z],Q,{scaled:re=!0}={}){if(!Q)throw new Error("bandView is undefined");const{data:te,tileSize:se,buffer:me,offset:ce,scale:Ae,dimension:_e}=Q;if($<-me||$>se+me||Z<-me||Z>se+me)throw new Error(`Point (${$}, ${Z}) out of bounds for tileSize=${se}, buffer=${me}`);const Ie=(Z+me)*(se+2*me)+($+me);if(new Uint32Array(te.buffer)[Ie]===4294967295)return null;let Ce=[];Ce=re?[]:new Q.data.constructor(_e);for(let Te=0;Te<_e;Te++)Ce[Te]=Math.round(1e12*(te[_e*Ie+Te]*Ae+ce))/1e12;return Ce}([Math.min(Math.max(-T,Math.floor((j-R)*b)),b-1+T),Math.min(Math.max(-T,Math.floor((B-D)*b)),b-1+T)],p,{scaled:y})}class Ia extends Ho{constructor(t,a,p,y){super(t,a,p,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},a)}triggerRepaint(t){const a=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);a&&a.enabled&&p&&a._clearRenderCacheForTile(p.id,t.tileID),this.map.triggerRepaint()}loadTile(t,a){const p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(p,r.R.Tile),b={request:y,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=y,t.actor||(t.actor=this.dispatcher.getActor());const T=(R,D,L)=>{if(delete t.request,t.aborted)return t.state="unloaded",a(null);if(R)return R.name==="AbortError"?void 0:(t.state="errored",a(R));if(this.map._refreshExpiredTiles&&D){const F=r.aM(L);t.setExpiryData(F)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!D)return a(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=D}a(null)};t.request=this.partial?t.fetchHeader(void 0,T.bind(this)):t.actor.send("loadTile",b,T.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){const p=t.texturePerLayer;if(t.flushAllQueues(),p.size){t.destroy(!0);for(const y of p.values())this.map.painter.saveTileTexture(y)}else t.destroy()}prepareTile(t,a,p,y){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(a,p,y,(b,T)=>{if(b)return t.state="errored",this.fire(new r.y(b)),void this.triggerRepaint(t);T&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(p,T,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find(({id:b})=>b===t),p=a&&a.fields,y=p&&p.bands&&p.bands;return y?y[0]:0}getTextureDescriptor(t,a,p){if(!t)return;const y=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let b=null;a instanceof r.aQ?b=a.paint.get("raster-array-band"):a instanceof r.aR&&(b=a.paint.get("raster-particle-array-band"));const T=b||this.getInitialBand(y);if(T==null)return;if(!t.textureDescriptorPerLayer.get(a.id))return void this.prepareTile(t,y,a.id,T);if(t.updateNeeded(a.id,T)&&!p)return;const R=t.textureDescriptorPerLayer.get(a.id);return Object.assign({},R,{texture:t.texturePerLayer.get(a.id)})}getImages(t,a){const p=new Map;for(const y of t)for(const b of a){const[T,R]=b.split("/"),D=y.getLayer(T);if(!D||!D.hasBand(R)||!D.hasDataForBand(R))continue;const{bytes:L,tileSize:F,buffer:j}=D.getBandView(R),B=F+2*j,$={data:new r.q({width:B,height:B},L),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(b,$)}return p}queryRasterArrayValueByBandId(t,a,p){const y=a._mrt;return new Promise(b=>{const T={},R=new Set;for(const[D,L]of Object.entries(y.layers)){if(p.layerName&&D!==p.layerName)continue;const F={};T[D]=F;for(const{bands:j}of L.dataIndex)for(const B of j)p.bands&&!p.bands.includes(B)||(R.add(r.B(D,B)),a.fetchBand(D,null,B,$=>{r.o.frame(()=>{F[B]=$?null:Ll([t.lng,t.lat],y,L.getBandView(B)),R.delete(r.B(D,B)),R.size===0&&b(T)})},!1))}R.size===0&&b(T)})}_loadTileForQuery(t,a){if(this._loadTileLoaded[t.uid])return void a(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(a);this._loadTilePending[t.uid]=[a];const p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(p,r.R.Tile);t.actor.send("loadTile",{request:y,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(b,T,R)=>{if(b)return this._loadTilePending[t.uid].forEach(D=>D(b,null)),void delete this._loadTilePending[t.uid];if(!T)return this._loadTilePending[t.uid].forEach(D=>D(null,null)),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&T){const D=r.aM(R);t.setExpiryData(D)}t._mrt=T,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach(D=>D(null,T)),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]},void 0,!0)}queryRasterArrayValueByAllBands(t,a,p){return new Promise((y,b)=>{this._loadTileForQuery(a,(T,R)=>{T?b(T):y(R?this.queryRasterArrayValueByBandId(t,a,p):null)})})}queryRasterArrayValue(t,a){const p=r.aS.convert(t),y=this.findLoadedParent(p);return y&&y._mrt?a.bands||!this.partial?this.queryRasterArrayValueByBandId(p,y,a):this.queryRasterArrayValueByAllBands(p,y,a):Promise.resolve(null)}findLoadedParent(t){const a=r.ae.fromLngLat(t,this.map.transform.tileSize),p=this.maxzoom+1,y=1<<p,b=Math.floor(a.x),T=Math.floor((a.x-b)*y),R=Math.floor(a.y*y),D=this.map.style.getSourceCache(this.id),L=new r.aP(p,b,p,T,R);return D.findLoadedParent(L,this.minzoom)}}const as={vector:ro,raster:Ho,"raster-dem":class extends Ho{constructor(f,t,a,p){super(f,t,a,p),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(f,t){const a=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(y,b){y&&(f.state="errored",t(y)),b&&(f.dem=b,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",t(null))}f.request=r.n(this.map._requestManager.transformRequest(a,r.R.Tile),(function(y,b,T){if(delete f.request,f.aborted)f.state="unloaded",t(null);else if(y)f.state="errored",t(y);else if(b){const R=r.aM(T);this.map._refreshExpiredTiles&&f.setExpiryData(R);const D=ImageBitmap&&b instanceof ImageBitmap&&r.r(),L=1-(b.width-r.aO(b.width))/2;L<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const F=D?b:r.o.getImageData(b,L),j={uid:f.uid,tileID:f.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:F,encoding:this.encoding,padding:L};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadTile",j,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const t=f.canonical,a=Math.pow(2,t.z),p=(t.x-1+a)%a,y=t.x===0?f.wrap-1:f.wrap,b=(t.x+1+a)%a,T=t.x+1===a?f.wrap+1:f.wrap,R={};return R[new r.aP(f.overscaledZ,y,t.z,p,t.y).key]={backfilled:!1},R[new r.aP(f.overscaledZ,T,t.z,b,t.y).key]={backfilled:!1},t.y>0&&(R[new r.aP(f.overscaledZ,y,t.z,p,t.y-1).key]={backfilled:!1},R[new r.aP(f.overscaledZ,f.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},R[new r.aP(f.overscaledZ,T,t.z,b,t.y-1).key]={backfilled:!1}),t.y+1<a&&(R[new r.aP(f.overscaledZ,y,t.z,p,t.y+1).key]={backfilled:!1},R[new r.aP(f.overscaledZ,f.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},R[new r.aP(f.overscaledZ,T,t.z,b,t.y+1).key]={backfilled:!1}),R}},"raster-array":Ia,geojson:class extends r.E{constructor(f,t,a,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(p),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const y=r.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*y,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*y,extent:r.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:r.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*y,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){if(!this._options.dynamic)return this.fire(new r.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof f!="string"&&(f.type==="Feature"&&(f={type:"FeatureCollection",features:[f]}),f.type!=="FeatureCollection"))return this.fire(new r.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof f!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const a of this._data.features)t.set(a.id,a);for(const a of f.features)t.set(a.id,a);this._data.features=[...t.values()]}else this._data=f;return this._updateWorkerData(!0),this}getClusterExpansionZoom(f,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},t),this}getClusterChildren(f,t){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},t),this}getClusterLeaves(f,t,a,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:t,offset:a},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:f},this.workerOptions);t.scope=this.scope;const a=this._data;typeof a=="string"?(t.request=this.map._requestManager.transformRequest(r.o.resolveURL(a),r.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(p,y)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new r.y(p));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(b.resourceTiming=y.resourceTiming[this.id]),f&&(this._partialReload=!0),this.fire(new r.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const f=r.B(this.id,this.scope);this.map.style.clearSource(f),this._updateWorkerData()}loadTile(f,t){const a=f.actor?"reloadTile":"loadTile";f.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,y=p?{image:p.image.clone()}:null,b=this._partialReload,T={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:r.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:f.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:b,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};f.request=this.actor.send(a,T,(R,D)=>b&&!D?(f.state="loaded",t(null)):(delete f.request,f.destroy(),f.aborted?t(null):R?t(R):(f.loadVectorData(D,this.map.painter,a==="reloadTile"),t(null))),void 0,a==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f,t){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(f){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aT{constructor(f,t,a,p){super(f,t,a,p),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const t of f.urls)this.urls.push(this.map._requestManager.transformRequest(t,r.R.Source).url);r.aU(this.urls,(t,a)=>{this._loaded=!0,t?this.fire(new r.y(t)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const t=this.video.seekable;f<t.start(0)||f>t.end(0)?this.fire(new r.y(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,t=f.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(f,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aT,model:r.aW,"batched-model":class extends r.E{constructor(f,t,a,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}reload(){this.cancelTileJSONRequest();const f=r.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(f))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(f){this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=rr(this._options,this.map._requestManager,t,a,(p,y)=>{this._tileJSONRequest=null,this._loaded=!0,p?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new r.y(p))):y&&(Object.assign(this,y),y.bounds&&(this.tileBounds=new sa(y.bounds,this.minzoom,this.maxzoom)),Jn(y.tiles,this.map._requestManager._customAccessToken),this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,t){const a=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(a,r.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:r.o.devicePixelRatio,promoteId:this.promoteId};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=t;else{if(f.buckets){const b=Object.values(f.buckets);for(const T of b)T.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,y.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,y.bind(this),void 0,!0);function y(b,T){return f.aborted?t(null):b&&b.status!==404?t(b):(this.map._refreshExpiredTiles&&T&&f.setExpiryData(T),f.loadModelData(T,this.map.painter),f.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends r.aT{constructor(f,t,a,p){super(f,t,a,p),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(b=>typeof b!="number"))||this.fire(new r.y(new r.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.y(new r.V(`sources.${f}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new r.y(new r.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new r.y(new r.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.y(new r.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(f){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof r.aV||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends r.E{constructor(f,t,a,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=t,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new sa(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,r.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this.map=f,this._loaded=!1,this.fire(new r.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:t,y:a,z:p}=f.canonical;return this._implementation.hasTile({x:t,y:a,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,t){const{x:a,y:p,z:y}=f.tileID.canonical,b=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:a,y:p,z:y},{signal:b.signal})).then((function(T){return delete f.request,f.aborted?(f.state="unloaded",t(null)):T===void 0?(f.state="errored",t(null)):T===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",t(null)):function(R){return R instanceof ImageData||R instanceof HTMLCanvasElement||R instanceof ImageBitmap||R instanceof HTMLImageElement}(T)?(this.loadTileData(f,T),f.state="loaded",void t(null)):(f.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.name!=="AbortError"&&(f.state="errored",t(T))}),f.request.cancel=()=>b.abort()}loadTileData(f,t){f.setTexture(t,this.map.painter)}unloadTile(f,t){if(f.texture&&f.texture instanceof r.T?(f.destroy(!0),f.texture&&f.texture instanceof r.T&&this.map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){const{x:a,y:p,z:y}=f.tileID.canonical;this._implementation.unloadTile({x:a,y:p,z:y})}t&&t()}abortTile(f,t){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){const f=r.B(this.id,this.scope);this.map.style.clearSource(f)}_update(){this.fire(new r.z("data",{dataType:"source",sourceDataType:"content"}))}}},Po=function(f,t,a,p){const y=new as[t.type](f,t,a,p);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return r.aX(["load","abort","unload","serialize","prepare"],y),y};function Js(f,t,a=""){return`${a}:${t.id||""}:${t.layer.id}:${function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:y,importId:b}=p;return`featureset:${y}${b?`:import:${b}`:""}`}}(f.target)}`}function Ko(f,t,a,p=""){if(f.uniqueFeatureID){const y=Js(f,t,p);if(a.has(y))return!0;a.add(y)}return!1}function bs(f,t,a,p,y=!1){const b=t.sourceCache.transform,T=t.sourceCache.tilesIn(f,t.has3DLayers,y);T.sort(xu);const R=[];for(const D of T){const L=D.tile.queryRenderedFeatures(t,D,a,p,b,y);Object.keys(L).length&&R.push({wrappedTileID:D.tile.tileID.wrapped().key,queryResults:L})}for(const D in t.layers){const L=t.layers[D];if(L.styleLayer){const F=L.styleLayer.queryRenderedFeatures(f,t.sourceCache,p);Object.keys(F).length&&R.push({wrappedTileID:0,queryResults:F})}}return R.length===0?{}:function(D){const L={},F={};for(const j of D){const B=j.queryResults,$=j.wrappedTileID,Z=F[$]=F[$]||{};for(const Q in B){const re=B[Q],te=Z[Q]=Z[Q]||{},se=L[Q]=L[Q]||[];for(const me of re)te[me.featureIndex]||(te[me.featureIndex]=!0,se.push(me))}}return L}(R)}function Rc(f,t,a,p,y,b){const T={},R=p.queryRenderedSymbols(f),D=[];for(const L of Object.keys(R).map(Number))D.push(y[L]);D.sort(xu);for(const L of D){const F=L.featureIndex.lookupSymbolFeatures(R[L.bucketInstanceId],L.bucketIndex,L.sourceLayerIndex,t,a,b);for(const j in F){const B=T[j]=T[j]||[],$=F[j];$.sort((Z,Q)=>{const re=L.featureSortOrder;if(re){const te=re.indexOf(Z.featureIndex);return re.indexOf(Q.featureIndex)-te}return Q.featureIndex-Z.featureIndex});for(const Z of $)B.push(Z)}}return T}function ch(f,t){const a=f.getRenderableIds().map(b=>f.getTileByID(b)),p=[],y={};for(let b=0;b<a.length;b++){const T=a[b],R=T.tileID.canonical.key;y[R]||(y[R]=!0,T.querySourceFeatures(p,t))}return p}function xu(f,t){const a=f.tileID,p=t.tileID;return a.overscaledZ-p.overscaledZ||a.canonical.y-p.canonical.y||a.wrap-p.wrap||a.canonical.x-p.canonical.x}function Nr(f,t){const a={};if(!t)return a;for(const p of f){const y=p.layerIds.map(b=>t.getLayer(b)).filter(Boolean);if(y.length!==0){p.layers=y,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(b=>y.filter(T=>T.id===b)[0]));for(const b of y)a[b.fqid]=p}}return a}const os=32,$o=33,pn=new Uint16Array(8184);for(let f=0;f<2046;f++){let t=f+2,a=0,p=0,y=0,b=0,T=0,R=0;for(1&t?y=b=T=os:a=p=R=os;(t>>=1)>1;){const L=a+y>>1,F=p+b>>1;1&t?(y=a,b=p,a=T,p=R):(a=y,p=b,y=T,b=R),T=L,R=F}const D=4*f;pn[D+0]=a,pn[D+1]=p,pn[D+2]=y,pn[D+3]=b}const ss=new Uint16Array(2178),ao=new Uint8Array(1089),gl=new Uint16Array(1089);function nc(f){return f===0?-.03125:f===32?.03125:0}const $d={type:2,extent:r.al,loadGeometry:()=>[[new r.P(0,0),new r.P(r.al+1,0),new r.P(r.al+1,r.al+1),new r.P(0,r.al+1),new r.P(0,0)]]};class Ba{constructor(t,a,p,y,b,T){this.tileID=t,this.uid=r.b1(),this.uses=0,this.tileSize=a,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection),this.worldview=T,this._hasAppearances=null}registerFadeDuration(t){const a=t+this.timeAdded;a<r.o.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aY(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,a,p){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Nr(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const b=this.buckets[y];if(b instanceof r.b3){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const b=this.buckets[y];if(b instanceof r.b3&&b.hasRTLText){this.hasRTLText=!0,r.b4();break}}this.queryPadding=0;for(const y in this.buckets){const b=this.buckets[y],T=a.style.getOwnLayer(y);if(!T)continue;const R=T.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,R)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new r.b2}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,a,p){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Nr(t.buckets,a.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,a){for(const b in this.buckets){const T=this.buckets[b];if(T.uploadPending()){let R={},D=[],L={zoom:0,pitch:0,brightness:0,worldview:""};if(a){if(a.style){D=a.style.listImages();const F=T.layers[0],j=F.sourceLayer||"_geojsonTileLayer",B=a.style.getLayerSourceCache(F);B&&(R=B._state.getState(j,void 0))}L={zoom:a.transform.zoom||0,pitch:a.transform.pitch||0,brightness:a.style.getBrightness()||0,worldview:a.worldview||""}}T.upload(t,this.tileID.canonical,R,D,L)}}const p=t.gl,y=this.imageAtlas;y&&!y.uploaded&&(this.imageAtlasTexture=new r.T(t,y.image,p.RGBA8,{useMipmap:!!y.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(t,this.glyphAtlasImage,p.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(t,this.lineAtlas.image,p.R8),this.lineAtlas.uploaded=!0)}prepare(t,a,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,p),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=a.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(a)),(this._lastUpdatedBrightness||y||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const a in this.buckets){const p=this.buckets[a];p.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,p.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,a,p,y,b,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const R=this.evaluateQueryRenderedFeaturePadding(),D=function(L,F){const j=r.bp([],[.5*L.width,.5*-L.height,1]);return r.bq(j,j,[1,-1,0]),r.aB(j,j,L.calculateProjMatrix(F.toUnwrapped())),Float32Array.from(j)}(b,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:a,pixelPosMatrix:D,transform:y,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:R})}querySourceFeatures(t,a){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const y=p.loadVTLayers(),b=a?a.sourceLayer:"",T=y._geojsonTileLayer||y[b];if(!T)return;const R=r.b5(a&&a.filter),{z:D,x:L,y:F}=this.tileID.canonical,j={z:D,x:L,y:F};for(let B=0;B<T.length;B++){const $=T.feature(B);if(R.needGeometry){const re=r.b6($,!0);if(!R.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),re,this.tileID.canonical))continue}else if(!R.filter(new r.ac(this.tileID.overscaledZ,{worldview:this.worldview}),$))continue;const Z=p.getId($,b),Q=new r.b7($,D,L,F,Z);Q.tile=j,t.push(Q)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const p=r.b8(t.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const p=Date.now();let y=!1;if(this.expirationTime>p)y=!1;else if(a)if(this.expirationTime<a)y=!0;else{const b=this.expirationTime-a;b?this.expirationTime=p+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const a in this.buckets)if(t.style.hasLayer(a)&&this.buckets[a].layers.some(p=>p.appearances&&p.appearances.length>0))return!0;return!1}updateBuckets(t,a){if(!this.latestFeatureIndex||!t.style)return;const p=this.latestFeatureIndex.loadVTLayers(),y=t.style.listImages(),b=t.style.getBrightness();for(const T in this.buckets){if(!t.style.hasLayer(T))continue;const R=this.buckets[T],D=R.layers[0],L=D.sourceLayer||"_geojsonTileLayer",F=p[L],j=t.style.getLayerSourceCache(D);let B={};j&&(B=j._state.getState(L,void 0));const $=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Z=Object.keys(B).length>0&&!a;if(R.hasAppearances=R.layers.some(re=>re.appearances&&re.appearances.length>0),(Z&&R.stateDependentLayers.length!==0||a)&&R.update(B,F,y,$,Z?R.stateDependentLayers:R.layers,a,b),Z&&R.stateDependentLayers.length!==0||a||R.hasAppearances){const re={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};R.updateAppearances(this.tileID.canonical,B,y,re)}(R instanceof r.b9||R instanceof r.ba)&&t._terrain&&t._terrain.enabled&&j&&R.uploadPending()&&t._terrain._clearRenderCacheForTile(j.id,this.tileID);const Q=t&&t.style&&t.style.getOwnLayer(T);Q&&(this.queryPadding=Math.max(this.queryPadding,Q.queryRadius(R)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=r.o.now()+t}setTexture(t,a){const p=a.context,y=p.gl;this.texture=this.texture||a.getTileTexture(t.width),this.texture&&this.texture instanceof r.T?this.texture.update(t):(this.texture=new r.T(p,t,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(t,a){const p={};for(const y of a)p[y]=!0;this.dependencies[t]=p}hasDependency(t,a){for(const p of t){const y=this.dependencies[p];if(y){for(const b of a)if(y[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const p=r.bb($d,this.tileID.canonical,this.tileTransform)[0],y=new r.bc,b=new r.bd;for(let T=0;T<p.length;T++){const{x:R,y:D}=p[T];y.emplaceBack(R,D),b.emplaceBack(T)}b.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(b),this._tileDebugBuffer=t.createVertexBuffer(y,r.be.members),this._tileDebugSegments=r.bf.simpleSegment(0,0,y.length,b.length)}_makeTileBoundsBuffers(t,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const p=r.bb($d,this.tileID.canonical,this.tileTransform)[0];let y,b;if(this.isRaster){const T=function(R,D){const L=r.aY(R,D),F=Math.pow(2,R.z);for(let re=0;re<$o;re++)for(let te=0;te<$o;te++){const se=r.aZ((R.x+(te+nc(te))/os)/F),me=r.a_((R.y+(re+nc(re))/os)/F),ce=D.project(se,me),Ae=re*$o+te;ss[2*Ae+0]=Math.round((ce.x*L.scale-L.x)*r.al),ss[2*Ae+1]=Math.round((ce.y*L.scale-L.y)*r.al)}ao.fill(0),gl.fill(0);for(let re=2045;re>=0;re--){const te=4*re,se=pn[te+0],me=pn[te+1],ce=pn[te+2],Ae=pn[te+3],_e=se+ce>>1,Ie=me+Ae>>1,Ce=_e+Ie-me,Te=Ie+se-_e,De=me*$o+se,Ge=Ae*$o+ce,Ue=Ie*$o+_e,nt=Math.hypot((ss[2*De+0]+ss[2*Ge+0])/2-ss[2*Ue+0],(ss[2*De+1]+ss[2*Ge+1])/2-ss[2*Ue+1])>=16;ao[Ue]=ao[Ue]||(nt?1:0),re<1022&&(ao[Ue]=ao[Ue]||ao[(me+Te>>1)*$o+(se+Ce>>1)]||ao[(Ae+Te>>1)*$o+(ce+Ce>>1)])}const j=new r.a$,B=new r.b0;let $=0;function Z(re,te){const se=te*$o+re;return gl[se]===0&&(j.emplaceBack(ss[2*se+0],ss[2*se+1],re*r.al/os,te*r.al/os),gl[se]=++$),gl[se]-1}function Q(re,te,se,me,ce,Ae){const _e=re+se>>1,Ie=te+me>>1;if(Math.abs(re-ce)+Math.abs(te-Ae)>1&&ao[Ie*$o+_e])Q(ce,Ae,re,te,_e,Ie),Q(se,me,ce,Ae,_e,Ie);else{const Ce=Z(re,te),Te=Z(se,me),De=Z(ce,Ae);B.emplaceBack(Ce,Te,De)}}return Q(0,0,os,os,os,0),Q(os,os,0,0,0,os),{vertices:j,indices:B}}(this.tileID.canonical,a);y=T.vertices,b=T.indices}else{y=new r.a$,b=new r.b0;for(const{x:R,y:D}of p)y.emplaceBack(R,D,0,0);const T=r.bg(y.int16.subarray(0,4*y.length),void 0,4);for(let R=0;R<T.length;R+=3)b.emplaceBack(T[R],T[R+1],T[R+2])}this._tileBoundsBuffer=t.createVertexBuffer(y,r.bh.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(b),this._tileBoundsSegments=r.bf.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugBuffers(t,a){const p=a.projection;if(!p||p.name!=="globe"||a.freezeTileCoverage)return;const y=this.tileID.canonical,b=r.bi(y,a),T=r.bj(b),R=r.aj(a.zoom);let D;R>0&&(D=r.bk(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,y,a,T,D,R),this._makeGlobeTileDebugTextBuffer(t,y,a,T,D,R)}_globePoint(t,a,p,y,b,T,R){let D=r.bl(t,a,p);if(T){const L=1<<p.z,F=r.aF(y.center.lng),j=r.aJ(y.center.lat),B=(p.x+.5)/L-F;let $=0;B>.5?$=-1:B<-.5&&($=1);let Z=(t/r.al+p.x)/L+$,Q=(a/r.al+p.y)/L;Z=(Z-F)*y._pixelsPerMercatorPixel+F,Q=(Q-j)*y._pixelsPerMercatorPixel+j;const re=[Z*y.worldSize,Q*y.worldSize,0];r.af(re,re,T),D=r.bm(D,re,R)}return r.af(D,D,b)}_makeGlobeTileDebugBorderBuffer(t,a,p,y,b,T){const R=new r.bc,D=new r.bd,L=new r.bn,F=(B,$,Z,Q,re)=>{const te=(Z-B)/(re-1),se=(Q-$)/(re-1),me=R.length;for(let ce=0;ce<re;ce++){const Ae=B+ce*te,_e=$+ce*se;R.emplaceBack(Ae,_e);const Ie=this._globePoint(Ae,_e,a,p,y,b,T);L.emplaceBack(Ie[0],Ie[1],Ie[2]),D.emplaceBack(me+ce)}},j=r.al;F(0,0,j,0,16),F(j,0,j,j,16),F(j,j,0,j,16),F(0,j,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(D),this._tileDebugBuffer=t.createVertexBuffer(R,r.be.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(L,r.bo.members),this._tileDebugSegments=r.bf.simpleSegment(0,0,R.length,D.length)}_makeGlobeTileDebugTextBuffer(t,a,p,y,b,T){const R=r.al/4,D=new r.bc,L=new r.b0,F=new r.bn,j=25;L.reserve(32),D.reserve(j),F.reserve(j);const B=($,Z)=>j*$+Z;for(let $=0;$<j;$++){const Z=$*R;for(let Q=0;Q<j;Q++){const re=Q*R;D.emplaceBack(re,Z);const te=this._globePoint(re,Z,a,p,y,b,T);F.emplaceBack(te[0],te[1],te[2])}}for(let $=0;$<4;$++)for(let Z=0;Z<4;Z++){const Q=B($,Z),re=B($,Z+1),te=B($+1,Z),se=B($+1,Z+1);L.emplaceBack(Q,re,te),L.emplaceBack(te,re,se)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(L),this._tileDebugTextBuffer=t.createVertexBuffer(D,r.be.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(F,r.bo.members),this._tileDebugTextSegments=r.bf.simpleSegment(0,0,j,32)}destroy(t=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.br.setPbf(r.bs);class fa extends Ba{constructor(t,a,p,y,b){super(t,a,p,y,b),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,a,p){const y=p.context,b=y.gl;let T=this.texturePerLayer.get(t)||p.getTileTexture(a.width);T&&T instanceof r.T?T.update(a,{premultiply:!1}):T=new r.T(y,a,b.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,T)}flushQueues(t){const a=this._workQueuePerLayer.get(t)||[],p=this._fetchQueuePerLayer.get(t)||[];for(;a.length;)a.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const a=this._workQueuePerLayer.get(t)||[];for(;a.length;)a.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const a=this._fetchQueuePerLayer.get(t)||[];for(;a.length;)a.pop()()}}fetchHeader(t=16384,a){const p=this._mrt=new r.br(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=r.bt(y,(b,T,R)=>{if(b)a(b);else try{const D=p.getHeaderLength(T);if(D>t)return void(this.request=this.fetchHeader(D,a));p.parseHeader(T),this._isHeaderLoaded=!0;let L=0;for(const F of Object.values(p.layers))L=Math.max(L,F.dataIndex[F.dataIndex.length-1].lastByte);T.byteLength>=L&&(this.entireBuffer=T),a(null,this.entireBuffer||T,R)}catch(D){a(D)}}),this.request}fetchBandForRender(t,a,p,y){this.fetchBand(t,a,p,b=>{if(b)return void y(b);this.updateTextureDescriptor(t,a,p);const T=this.textureDescriptorPerLayer.get(a);y(null,T?T.img:null)})}fetchBand(t,a,p,y,b=!0){const T=this._mrt;if(!this._isHeaderLoaded||!T)return void y(new Error("Tile header is not ready"));const R=this.actor;if(!R)return void y(new Error("Can't fetch tile band without an actor"));let D;const L=r.B(String(p),r.B(this.tileID.key,t));let F=this._taskQueue.get(L);F?F.add(y):(F=new Set,F.add(y),this._taskQueue.set(L,F));const j=(Q,re)=>{D.complete(Q,re),Q?y(Q):(F.values().forEach(te=>te(null,re)),this._taskQueue.delete(L))},B=(Q,re)=>{if(Q)return y(Q);const te=R.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:re,task:D},j,void 0,!0);if(a!==null){const se=this._workQueuePerLayer.get(a)||[];se.push(()=>{te&&te.cancel(),D.cancel()}),this._workQueuePerLayer.has(a)||this._workQueuePerLayer.set(a,se)}};let $;try{$=T.getLayer(t)}catch(Q){if(this.state==="reloading")return;throw Q}if(!$)return void y(new Error(`Unknown sourceLayer "${t}"`));if($.hasDataForBand(p))return F.values().forEach(Q=>Q(null,null)),void this._taskQueue.delete(L);const Z=$.getDataRange([p]);if(D=T.createDecodingTask(Z),!D||D.tasks.length)if(a!==null&&this.flushQueues(a),this.entireBuffer)B(null,this.entireBuffer.slice(Z.firstByte,Z.lastByte+1));else{const Q=Object.assign({},this.requestParams,{headers:{Range:`bytes=${Z.firstByte}-${Z.lastByte}`}}),re=r.bt(Q,B);if(a!==null){const te=this._fetchQueuePerLayer.get(a)||[];te.push(()=>{re.cancel(),D.cancel()}),this._fetchQueuePerLayer.has(a)||this._fetchQueuePerLayer.set(a,te)}}}updateNeeded(t,a){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==a||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,a,p){if(!this._mrt)return;const y=this._mrt.getLayer(t);if(!y||!y.hasBand(p)||!y.hasDataForBand(p))return;const{bytes:b,tileSize:T,buffer:R,offset:D,scale:L}=y.getBandView(p),F=T+2*R,j=new r.q({width:F,height:F},b),B=this.texturePerLayer.get(a);B&&B instanceof r.T&&B.update(j,{premultiply:!1}),this.textureDescriptorPerLayer.set(a,{layer:t,band:p,img:j,buffer:R,offset:D,tileSize:T,format:y.pixelFormat,mix:[L,256*L,65536*L,16777216*L]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const a of this.texturePerLayer.values())a&&a instanceof r.T&&a.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Wd{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,p){const y=t.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const b={value:a,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(t,b)},p)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){const T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const p=t.wrapped().key,y=a===void 0?0:this.data[p].indexOf(a),b=this.data[p][y];return this.data[p].splice(y,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const p in this.data)for(const y of this.data[p])t(y.value)||a.push(y);for(const p of a)this.remove(p.value.tileID,p)}}class _l{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,p){const y=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][y]=this.stateChanges[t][y]||{},Object.assign(this.stateChanges[t][y],p),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==y&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][y]===null){this.deletedStates[t][y]={};for(const b in this.state[t][y])p[b]||(this.deletedStates[t][y][b]=null)}else for(const b in p)this.deletedStates[t]&&this.deletedStates[t][y]&&this.deletedStates[t][y][b]===null&&delete this.deletedStates[t][y][b]}removeFeatureState(t,a,p){if(this.deletedStates[t]===null)return;const y=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},p&&a!==void 0)this.deletedStates[t][y]!==null&&(this.deletedStates[t][y]=this.deletedStates[t][y]||{},this.deletedStates[t][y][p]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][y])for(p in this.deletedStates[t][y]={},this.stateChanges[t][y])this.deletedStates[t][y][p]=null;else this.deletedStates[t][y]=null;else this.deletedStates[t]=null}getState(t,a){const p=this.state[t]||{},y=this.stateChanges[t]||{},b=this.deletedStates[t];if(b===null)return{};if(a!==void 0){const R=String(a),D=Object.assign({},p[R],y[R]);if(b){const L=b[a];if(L===null)return{};for(const F in L)delete D[F]}return D}const T=Object.assign({},p,y);if(b)for(const R in b)delete T[R];return T}initializeTileState(t,a){t.refreshFeatureState(a)}coalesceChanges(t,a){const p={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const b={};for(const T in this.stateChanges[y])this.state[y][T]||(this.state[y][T]={}),Object.assign(this.state[y][T],this.stateChanges[y][T]),b[T]=this.state[y][T];p[y]=b}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const b={};if(this.deletedStates[y]===null)for(const T in this.state[y])b[T]={},this.state[y][T]={};else for(const T in this.deletedStates[y]){if(this.deletedStates[y][T]===null)this.state[y][T]={};else if(this.state[y][T])for(const R of Object.keys(this.deletedStates[y][T]))delete this.state[y][T][R];b[T]=this.state[y][T]}p[y]=p[y]||{},Object.assign(p[y],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const y in t)t[y].refreshFeatureState(a)}}class Ha extends r.E{constructor(t,a,p){super(),this.id=t,this._onlySymbols=p,a.on("data",y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new Wd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new _l,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,a){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const p=this._tiles[a];p.upload(t,this.map?this.map.painter:void 0),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(yl).map(t=>t.key)}getRenderableIds(t,a){const p=[];for(const y in this._tiles)this._isIdRenderable(+y,t,a)&&p.push(this._tiles[y]);return t?p.sort((y,b)=>{const T=y.tileID,R=b.tileID,D=new r.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle),L=new r.P(R.canonical.x,R.canonical.y)._rotate(this.transform.angle);return T.overscaledZ-R.overscaledZ||L.y-D.y||L.x-D.x}).map(y=>y.tileID.key):p.map(y=>y.tileID).sort(yl).map(y=>y.key)}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a,p){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())&&(p||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,a){const p=this._tiles[t];p&&(p.state!=="loading"&&(p.state=a),this._loadTile(p,this._tileLoaded.bind(this,p,t,a)))}_tileLoaded(t,a,p,y,b){if(y){if(t.state="errored",y.status!==404)this._source.fire(new r.y(y,{tile:t}));else{if(this._source.fire(new r.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const R=this.map.painter.terrain;this.update(this.transform,R.getScaledDemTileSize(),!0),R.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=r.o.now(),p==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let T=new Map;b&&b.responseHeaders&&(T=b.responseHeaders),this._source.fire(new r.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:T}))}_backfillDEM(t){const a=this.getRenderableIds();for(let y=0;y<a.length;y++){const b=a[y];if(t.neighboringTiles&&t.neighboringTiles[b]){const T=this.getTileByID(b);p(t,T),p(T,t)}}function p(y,b){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let T=b.tileID.canonical.x-y.tileID.canonical.x;const R=b.tileID.canonical.y-y.tileID.canonical.y,D=Math.pow(2,y.tileID.canonical.z),L=b.tileID.key;T===0&&R===0||Math.abs(R)>1||(Math.abs(T)>1&&(Math.abs(T+D)===1?T+=D:Math.abs(T-D)===1&&(T-=D)),b.dem&&y.dem&&(y.dem.backfillBorder(b.dem,T,R),y.neighboringTiles&&y.neighboringTiles[L]&&(y.neighboringTiles[L].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,p,y){for(const b in this._tiles){let T=this._tiles[b];if(y[b]||!T.hasData()||T.tileID.overscaledZ<=a||T.tileID.overscaledZ>p)continue;let R=T.tileID;for(;T&&T.tileID.overscaledZ>a+1;){const L=T.tileID.scaledTo(T.tileID.overscaledZ-1);T=this._tiles[L.key],T&&T.hasData()&&(R=L)}let D=R;for(;D.overscaledZ>a;)if(D=D.scaledTo(D.overscaledZ-1),t[D.key]){y[R.key]=R;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const p=this._loadedParentTiles[t.key];return p&&p.tileID.overscaledZ>=a?p:null}for(let p=t.overscaledZ-1;p>=a;p--){const y=t.scaledTo(p),b=this._getLoadedTile(y);if(b)return b}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,a){a=a||this._source.tileSize;const p=Math.ceil(t.width/a)+1,y=Math.ceil(t.height/a)+1,b=Math.floor(p*y*5),T=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,T):T;this._cache.setMaxSize(R)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const p={};for(const y in this._tiles){const b=this._tiles[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+a),p[b.tileID.key]=b}this._tiles=p;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(t,a,p,y,b){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(t,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const T=this._source.type==="batched-model";let R,D=this._source.maxzoom;const L=this.map&&this.map.painter?this.map.painter._terrain:null;if(L&&L.sourceCache===this&&L.attenuationRange()){const B=L.attenuationRange()[0],$=Math.floor(B)-Math.log2(L.getDemUpscale());D>$&&(D=$)}if(this.used||this.usedForTerrain){if(this._source.tileID)R=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(B=>new r.aP(B.canonical.z,B.wrap,B.canonical.z,B.canonical.x,B.canonical.y));else if(this.tileCoverLift!==0){const B=t.clone();B.tileCoverLift=this.tileCoverLift,R=B.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.minzoom<=1&&t.projection.name==="globe"&&(R.push(new r.aP(1,0,1,0,0)),R.push(new r.aP(1,0,1,1,0)),R.push(new r.aP(1,0,1,0,1)),R.push(new r.aP(1,0,1,1,1)))}else if(R=t.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:T}),this._source.hasTile){const B=this._source.hasTile.bind(this._source);R=R.filter($=>B($))}}else R=[];if(R.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!bu(this._source.type)){const B=t.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),$=Math.min(B,this._source.maxzoom);if(T){const Z=t.extendTileCover(R,$);for(const Q of Z)R.push(Q)}else if(b){const Z=t.extendTileCoverToNearPlane(R,this.transform.getFrustum($),$);for(const Q of Z)R.push(Q)}else if(this.castsShadows&&y){const Z=t.extendTileCover(R,$,y);for(const Q of Z)this._shadowCasterTiles[Q.key]=!0,R.push(Q)}}const F=this._updateRetainedTiles(R);if(bu(this._source.type)&&R.length!==0){const B={},$={},Z=Object.keys(F);for(const re of Z){const te=F[re],se=this._tiles[re];if(!se||se.fadeEndTime&&se.fadeEndTime<=r.o.now())continue;const me=this.findLoadedParent(te,Math.max(te.overscaledZ-Ha.maxOverzooming,this._source.minzoom));me&&(this._addTile(me.tileID),B[me.tileID.key]=me.tileID),$[re]=te}const Q=R[R.length-1].overscaledZ;for(const re in this._tiles){const te=this._tiles[re];if(F[re]||!te.hasData())continue;let se=te.tileID;for(;se.overscaledZ>Q;){se=se.scaledTo(se.overscaledZ-1);const me=this._tiles[se.key];if(me&&me.hasData()&&$[se.key]){F[re]=te.tileID;break}}}for(const re in B)F[re]||(this._coveredTiles[re]=!0,F[re]=B[re])}for(const B in F)this._tiles[B].clearFadeHold();const j=r.bu(this._tiles,F);for(const B of j){const $=this._tiles[B];$.hasSymbolBuckets&&!$.holdingForFade()?$.setHoldDuration(this.map._fadeDuration):$.hasSymbolBuckets&&!$.symbolFadeFinished()||this._removeTile(+B)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const a={};if(t.length===0)return a;const p={},y=t.reduce((L,F)=>Math.min(L,F.overscaledZ),1/0),b=t[0].overscaledZ,T=Math.max(b-Ha.maxOverzooming,this._source.minzoom),R=Math.max(b+Ha.maxUnderzooming,this._source.minzoom),D={};for(const L of t){const F=this._addTile(L);a[L.key]=L,F.hasData()||y<this._source.maxzoom&&(D[L.key]=L)}this._retainLoadedChildren(D,y,R,a);for(const L of t){let F=this._tiles[L.key];if(F.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const B=L.children(this._source.maxzoom)[0],$=this.getTile(B);if($&&$.hasData()){a[B.key]=B;continue}}else{const B=L.children(this._source.maxzoom);if(a[B[0].key]&&a[B[1].key]&&a[B[2].key]&&a[B[3].key])continue}let j=F.wasRequested();for(let B=L.overscaledZ-1;B>=T;--B){const $=L.scaledTo(B);if(p[$.key]||(p[$.key]=!0,F=this.getTile($),!F&&j&&(F=this._addTile($)),F&&(a[$.key]=$,j=F.wasRequested(),F.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let p,y=this._tiles[t].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){p=this._loadedParentTiles[y.key];break}a.push(y.key);const b=y.scaledTo(y.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;y=b}for(const b of a)this._loadedParentTiles[b]=p}}_addTile(t){let a=this._tiles[t.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const p=!!a;if(!p){const y=this.map?this.map.painter:null,b=this._source.tileSize*t.overscaleFactor();a=this._source.type==="raster-array"?new fa(t,b,this.transform.tileZoom,y,this._isRaster):new Ba(t,b,this.transform.tileZoom,y,this._isRaster,this._source.worldview),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))}return a.uses++,this._tiles[t.key]=a,p||this._source.fire(new r.z("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const p=a.getExpiryTimeout();p&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},p))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,a,p){const y=[],b=this.transform;if(!b)return y;const T=b.projection.name==="globe",R=r.aF(b.center.lng);for(const D in this._tiles){const L=this._tiles[D];if(p&&L.clearQueryDebugViz(),L.holdingForFade())continue;let F;if(T){const j=L.tileID.canonical;if(j.z===0){const B=[Math.abs(r.aA(R,...rc(j,-1))-R),Math.abs(r.aA(R,...rc(j,1))-R)];F=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(r.aA(R,...rc(j,-1))-R),Math.abs(r.aA(R,...rc(j,0))-R),Math.abs(r.aA(R,...rc(j,1))-R)];F=[B.indexOf(Math.min(...B))-1]}}else F=[0];for(const j of F){const B=t.containsTile(L,b,a,j);B&&y.push(B)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,a){const p=this.getRenderableIds(t,a).map(b=>this._tiles[b].tileID),y=this.transform.projection.name==="globe";for(const b of p)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=y?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return p}sortCoordinatesByDistance(t){const a=t.slice(),p=this.transform._camera.position,y=this.transform._camera.forward(),b={};for(const T of a){const R=1/(1<<T.canonical.z);b[T.key]=((T.canonical.x+.5)*R+T.wrap-p[0])*y[0]+((T.canonical.y+.5)*R-p[1])*y[1]-p[2]*y[2]}return a.sort((T,R)=>b[T.key]-b[R.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(bu(this._source.type))for(const t in this._tiles){const a=this._tiles[t];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=r.o.now())return!0}return!1}setFeatureState(t,a,p){this._state.updateState(t=t||"_geojsonTileLayer",a,p)}removeFeatureState(t,a,p){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,p)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,p){const y=this._tiles[t];y&&y.setDependencies(a,p)}reloadTilesForDependencies(t,a){for(const p in this._tiles)this._tiles[p].hasDependency(t,a)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(t,a))}_preloadTiles(t,a){if(!this._sourceLoaded){const D=()=>{this._sourceLoaded&&(this._source.off("data",D),this._preloadTiles(t,a))};return void this._source.on("data",D)}const p=new Map,y=Array.isArray(t)?t:[t],b=this.map.painter.terrain,T=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const D of y){const L=D.coveringTiles({tileSize:T,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const F of L)p.set(F.key,F);this.usedForTerrain&&D.updateElevation(!1)}const R=Array.from(p.values());r.bv(R,(D,L)=>{const F=new Ba(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(F,j=>{this._source.type==="raster-dem"&&F.dem&&this._backfillDEM(F),L(j,F)})},a)}}function yl(f,t){const a=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*t.wrap)-+(t.wrap<0);return f.overscaledZ-t.overscaledZ||p-a||t.canonical.y-f.canonical.y||t.canonical.x-f.canonical.x}function bu(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function rc(f,t){const a=1<<f.z;return[f.x/a+t,(f.x+1)/a+t]}Ha.maxOverzooming=10,Ha.maxUnderzooming=3;class qd{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,a=!1;for(const p in this.style._mergedLayers){const y=this.style._mergedLayers[p];if(y.type==="fill-extrusion"||y.type==="building")this.layers.push({layer:y,visible:t,visibilityChanged:a});else if(y.type==="model"){const b=this.style.getLayerSource(y);b&&b.type==="batched-model"&&this.layers.push({layer:y,visible:t,visibilityChanged:a})}}}onNewFrame(t){this.layersGotHidden=!1;for(const a of this.layers){const p=a.layer;let y=!1;p.type==="fill-extrusion"?y=!p.isHidden(t)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?y=!p.isHidden(t)&&p.paint.get("building-opacity")>0:p.type==="model"&&(y=!p.isHidden(t)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&a.visible,a.visible=y}}updateZOffset(t,a){this.currentBuildingBuckets=[];for(const y of this.layers){const b=y.layer,T=this.style.getLayerSourceCache(b);let R=1;b.type==="fill-extrusion"?R=y.visible?b.paint.get("fill-extrusion-vertical-scale"):0:b.type==="building"&&(R=y.visible?b.paint.get("building-vertical-scale"):0);let D=T?T.getTile(a):null;if(!D&&T)for(const L in T._tiles){const F=T._tiles[L];if(a.canonical.isChildOf(F.tileID.canonical)){D=F;break}}this.currentBuildingBuckets.push({bucket:D?D.getBucket(b):null,tileID:D?D.tileID:a,verticalScale:R})}t.hasAnyZOffset=!1;let p=!1;for(let y=0;y<t.symbolInstances.length;y++){const b=t.symbolInstances.get(y),T=b.zOffset,R=this._getHeightAtTileOffset(a,b.tileAnchorX,b.tileAnchorY);b.zOffset=R!==Number.NEGATIVE_INFINITY?R:T,p||T===b.zOffset||(p=!0),t.hasAnyZOffset||b.zOffset===0||(t.hasAnyZOffset=!0)}p&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,a,p,y){let b=a,T=p;if(t.canonical.z!==y.canonical.z){const R=y.canonical,D=1/(1<<t.canonical.z-R.z);b=(a+t.canonical.x*r.al)*D-R.x*r.al|0,T=(p+t.canonical.y*r.al)*D-R.y*r.al|0}return{tileX:b,tileY:T}}_getHeightAtTileOffset(t,a,p){let y,b;for(let T=0;T<this.layers.length;++T){const R=this.layers[T].layer;if(R.type!=="fill-extrusion"&&R.type!=="building")continue;const{bucket:D,tileID:L,verticalScale:F}=this.currentBuildingBuckets[T];if(!D)continue;const{tileX:j,tileY:B}=this._mapCoordToOverlappingTile(t,a,p,L),$=D.getHeightAtTileCoord(j,B);$&&$.height!==void 0&&($.hidden?y=$.height:b=Math.max($.height*F,b||0))}if(b!==void 0)return b;for(let T=0;T<this.layers.length;++T){const R=this.layers[T];if(R.layer.type!=="model"||!R.visible)continue;const{bucket:D,tileID:L}=this.currentBuildingBuckets[T];if(!D)continue;const{tileX:F,tileY:j}=this._mapCoordToOverlappingTile(t,a,p,L),B=D.getHeightAtTileCoord(F,j);if(B&&!B.hidden)return B.height===void 0&&y!==void 0?Math.min(B.maxHeight,y)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function wu(f,t){const a={};for(const p in f)p!=="ref"&&(a[p]=f[p]);return r.bw.forEach(p=>{p in t&&(a[p]=t[p])}),a}function ac(f){f=f.slice();const t=Object.create(null);for(let a=0;a<f.length;a++)t[f[a].id]=f[a];for(let a=0;a<f.length;a++)"ref"in f[a]&&(f[a]=wu(f[a],t[f[a].ref]));return f}const Vn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Ic(f,t,a){a.push({command:Vn.addSource,args:[f,t[f]]})}function oc(f,t,a){t.push({command:Vn.removeSource,args:[f]}),a[f]=!0}function Tu(f,t,a,p){oc(f,a,p),Ic(f,t,a)}function sc(f,t,a){let p;for(p in f[a])if(f[a].hasOwnProperty(p)&&p!=="data"&&!r.bx(f[a][p],t[a][p]))return!1;for(p in t[a])if(t[a].hasOwnProperty(p)&&p!=="data"&&!r.bx(f[a][p],t[a][p]))return!1;return!0}function Dc(f,t,a,p,y,b){let T;for(T in t=t||{},f=f||{})f.hasOwnProperty(T)&&(r.bx(f[T],t[T])||a.push({command:b,args:[p,T,t[T],y]}));for(T in t)t.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(r.bx(f[T],t[T])||a.push({command:b,args:[p,T,t[T],y]}))}function Mc(f){return f.id}function Pc(f,t){return f[t.id]=t,f}function Oc(f,t,a){const p=t.createTileMatrix(f,f.worldSize,a.toUnwrapped());return r.aB(new Float32Array(16),f.projMatrix,p)}function dp(f,t,a){if(t.projection.name===a.projection.name)return f.projMatrix;const p=a.clone();return p.setProjection(t.projection),Oc(p,t.getProjection(),f)}function uh(f,t,a){return t.name===a.projection.name?f.projMatrix:Oc(a,t,f)}class zm{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=r.aA(t,0,1);let a=1,p=this._distances[a];const y=t*this.paddedLength+this.padding;for(;p<y&&a<this._distances.length;)p=this._distances[++a];const b=a-1,T=this._distances[b],R=p-T,D=R>0?(y-T)/R:0;return this.points[b].mult(1-D).add(this.points[a].mult(D))}}class ge{constructor(t,a,p){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/p),this.yCellCount=Math.ceil(a/p);for(let T=0;T<this.xCellCount*this.yCellCount;T++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,p,y,b){this._forEachCell(a,p,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(p),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(t,a,p,y){this._forEachCell(a-y,p-y,a+y,p+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(p),this.circles.push(y)}_insertBoxCell(t,a,p,y,b,T){this.boxCells[b].push(T)}_insertCircleCell(t,a,p,y,b,T){this.circleCells[b].push(T)}_query(t,a,p,y,b,T){if(p<0||t>this.width||y<0||a>this.height)return!b&&[];const R=[];if(t<=0&&a<=0&&this.width<=p&&this.height<=y){if(b)return!0;for(let D=0;D<this.boxKeys.length;D++)R.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const L=this.circles[3*D],F=this.circles[3*D+1],j=this.circles[3*D+2];R.push({key:this.circleKeys[D],x1:L-j,y1:F-j,x2:L+j,y2:F+j})}return T?R.filter(T):R}return this._forEachCell(t,a,p,y,this._queryCell,R,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?R.length>0:R}_queryCircle(t,a,p,y,b){const T=t-p,R=t+p,D=a-p,L=a+p;if(R<0||T>this.width||L<0||D>this.height)return!y&&[];const F=[];return this._forEachCell(T,D,R,L,this._queryCellCircle,F,{hitTest:y,circle:{x:t,y:a,radius:p},seenUids:{box:{},circle:{}}},b),y?F.length>0:F}query(t,a,p,y,b){return this._query(t,a,p,y,!1,b)}hitTest(t,a,p,y,b){return this._query(t,a,p,y,!0,b)}hitTestCircle(t,a,p,y){return this._queryCircle(t,a,p,!0,y)}_queryCell(t,a,p,y,b,T,R,D){const L=R.seenUids,F=this.boxCells[b];if(F!==null){const B=this.bboxes;for(const $ of F)if(!L.box[$]){L.box[$]=!0;const Z=4*$;if(t<=B[Z+2]&&a<=B[Z+3]&&p>=B[Z+0]&&y>=B[Z+1]&&(!D||D(this.boxKeys[$]))){if(R.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[$],x1:B[Z],y1:B[Z+1],x2:B[Z+2],y2:B[Z+3]})}}}const j=this.circleCells[b];if(j!==null){const B=this.circles;for(const $ of j)if(!L.circle[$]){L.circle[$]=!0;const Z=3*$;if(this._circleAndRectCollide(B[Z],B[Z+1],B[Z+2],t,a,p,y)&&(!D||D(this.circleKeys[$]))){if(R.hitTest)return T.push(!0),!0;{const Q=B[Z],re=B[Z+1],te=B[Z+2];T.push({key:this.circleKeys[$],x1:Q-te,y1:re-te,x2:Q+te,y2:re+te})}}}}}_queryCellCircle(t,a,p,y,b,T,R,D){const L=R.circle,F=R.seenUids,j=this.boxCells[b];if(j!==null){const $=this.bboxes;for(const Z of j)if(!F.box[Z]){F.box[Z]=!0;const Q=4*Z;if(this._circleAndRectCollide(L.x,L.y,L.radius,$[Q+0],$[Q+1],$[Q+2],$[Q+3])&&(!D||D(this.boxKeys[Z])))return T.push(!0),!0}}const B=this.circleCells[b];if(B!==null){const $=this.circles;for(const Z of B)if(!F.circle[Z]){F.circle[Z]=!0;const Q=3*Z;if(this._circlesCollide($[Q],$[Q+1],$[Q+2],L.x,L.y,L.radius)&&(!D||D(this.circleKeys[Z])))return T.push(!0),!0}}}_forEachCell(t,a,p,y,b,T,R,D){const L=this._convertToXCellCoord(t),F=this._convertToYCellCoord(a),j=this._convertToXCellCoord(p),B=this._convertToYCellCoord(y);for(let $=L;$<=j;$++)for(let Z=F;Z<=B;Z++)if(b.call(this,t,a,p,y,this.xCellCount*Z+$,T,R,D))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,p,y,b,T){const R=y-t,D=b-a,L=p+T;return L*L>R*R+D*D}_circleAndRectCollide(t,a,p,y,b,T,R){const D=(T-y)/2,L=Math.abs(t-(y+D));if(L>D+p)return!1;const F=(R-b)/2,j=Math.abs(a-(b+F));if(j>F+p)return!1;if(L<=D||j<=F)return!0;const B=L-D,$=j-F;return B*B+$*$<=p*p}}const Ye={unknown:0,flipRequired:1,flipNotRequired:2},zt=Math.tan(85*Math.PI/180);function Xt(f,t,a,p,y,b,T){const R=r.bB();if(a)if(b.name==="globe"){const D=r.bC(y,t);r.aB(R,R,D)}else{const D=r.bD([],T);R[0]=D[0],R[1]=D[1],R[4]=D[2],R[5]=D[3],p||r.bA(R,R,y.angle)}else r.aB(R,y.labelPlaneMatrix,f);return R}function Ai(f,t,a,p,y,b,T){const R=Xt(f,t,a,p,y,b,T);return b.name==="globe"&&a||(R[2]=R[6]=R[10]=R[14]=0),R}function mn(f,t,a,p,y,b,T){if(a){if(b.name==="globe"){const R=Xt(f,t,a,p,y,b,T);return r.bk(R,R),r.aB(R,f,R),R}{const R=r.by(f),D=r.bz([]);return D[0]=T[0],D[1]=T[1],D[4]=T[2],D[5]=T[3],r.aB(R,R,D),p||r.bA(R,R,-y.angle),R}}return y.glCoordMatrix}function Mi(f,t,a,p){const y=[f,t,a,1];a?r.aC(y,y,p):Oo(y,y,p);const b=y[3];return y[0]/=b,y[1]/=b,y[2]/=b,y}function Wn(f,t){return Math.min(.5+f/t*.5,1.5)}function Ir(f,t){const a=f[0]/f[3],p=f[1]/f[3];return a>=-t[0]&&a<=t[0]&&p>=-t[1]&&p<=t[1]}function la(f,t,a,p,y,b,T,R,D,L,F=1){const j=a.transform,B=p?f.textSizeData:f.iconSizeData,$=r.bJ(B,a.transform.zoom,F),Z=j.projection.name==="globe",Q=[256/a.width*2+1,256/a.height*2+1],re=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;re.clear();let te=null;Z&&(te=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const se=f.lineVertexArray,me=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ce=a.transform.width/a.transform.height;let Ae,_e=!1;for(let Ie=0;Ie<me.length;Ie++){const Ce=me.get(Ie),{numGlyphs:Te,writingMode:De}=Ce;if(De!==r.bK.vertical||_e||Ae===r.bK.horizontal||(_e=!0),Ae=De,(Ce.hidden||De===r.bK.vertical)&&!_e){vl(Te,re);continue}_e=!1;const Ge=new r.P(Ce.tileAnchorX,Ce.tileAnchorY),Ue=f.elevationType==="road",nt=!!j.elevation||Ue;let{x:Ke,y:st,z:Pt}=j.projection.projectTilePoint(Ge.x,Ge.y,L.canonical),Ze=null;if(nt){const ti=Ue?f.getElevationFeatureForText(Ie):null;Ze={getElevation:D,elevation:j.elevation,elevationFeature:ti};const[Ii,yn,An]=D(Ge,j.elevation,ti);Ke+=Ii,st+=yn,Pt+=An}const ze=[Ke,st,Pt,1];if(r.aC(ze,ze,t),!Ir(ze,Q)){vl(Te,re);continue}const lt=ze[3],Je=Wn(a.transform.getCameraToCenterDistance(j.projection),lt),bt=r.bL(B,$,Ce),Ft=T?bt/Je:bt*Je,ci=Mi(Ke,st,Pt,y);if(ci[3]<=0){vl(Te,re);continue}let Mt={};const Ot=r.an(f.layers[0].layout.get("text-max-angle")),di=Math.cos(Ot),ei=T?null:Ze,Jt=Sr(Ce,Ft,!1,R,t,y,b,f.glyphOffsetArray,se,re,te,ci,Ge,Mt,ce,ei,j.projection,L,T,di);_e=Jt.useVertical,ei&&Jt.needsFlipping&&(Mt={}),(Jt.notEnoughRoom||_e||Jt.needsFlipping&&Sr(Ce,Ft,!0,R,t,y,b,f.glyphOffsetArray,se,re,te,ci,Ge,Mt,ce,ei,j.projection,L,T,di).notEnoughRoom)&&vl(Te,re)}p?(f.text.dynamicLayoutVertexBuffer.updateData(re),te&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(te)):(f.icon.dynamicLayoutVertexBuffer.updateData(re),te&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(te))}function Qi(f,t,a,p,y,b,T,R,D,L,F,j,B,$,Z,Q,re){const{lineStartIndex:te,glyphStartIndex:se,segment:me}=R,ce=se+R.numGlyphs,Ae=te+R.lineLength,_e=t.getoffsetX(se),Ie=t.getoffsetX(ce-1),Ce=lc(f*_e,a,p,y,b,T,me,te,Ae,D,L,F,j,B,!0,$,Z,Q,re);if(!Ce)return null;const Te=lc(f*Ie,a,p,y,b,T,me,te,Ae,D,L,F,j,B,!0,$,Z,Q,re);return Te?{first:Ce,last:Te}:null}function Da(f,t,a,p){return f===r.bK.horizontal&&Math.abs(p)>Math.abs(a)?{useVertical:!0}:f===r.bK.vertical?p>0?{needsFlipping:!0}:null:t!==Ye.unknown&&function(y,b){return y===0||Math.abs(b/y)>zt}(a,p)?t===Ye.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Sr(f,t,a,p,y,b,T,R,D,L,F,j,B,$,Z,Q,re,te,se,me){const ce=t/24,Ae=f.lineOffsetX*ce,_e=f.lineOffsetY*ce,{lineStartIndex:Ie,glyphStartIndex:Ce,numGlyphs:Te,segment:De,writingMode:Ge,flipState:Ue}=f,nt=Ie+f.lineLength,Ke=st=>{if(F){const[lt,Je,bt]=st.up,Ft=L.length;r.bM(F,Ft+0,lt,Je,bt),r.bM(F,Ft+1,lt,Je,bt),r.bM(F,Ft+2,lt,Je,bt),r.bM(F,Ft+3,lt,Je,bt)}const[Pt,Ze,ze]=st.point;r.bN(L,Pt,Ze,ze,st.angle)};if(Te>1){const st=Qi(ce,R,Ae,_e,a,j,B,f,D,b,$,Q,!1,re,te,se,me);if(!st)return{notEnoughRoom:!0};if(p&&!a){let[Pt,Ze,ze]=st.first.point,[lt,Je,bt]=st.last.point;[Pt,Ze]=Mi(Pt,Ze,ze,T),[lt,Je]=Mi(lt,Je,bt,T);const Ft=Da(Ge,Ue,(lt-Pt)*Z,Je-Ze);if(f.flipState=Ft&&Ft.needsFlipping?Ye.flipRequired:Ye.flipNotRequired,Ft)return Ft}Ke(st.first);for(let Pt=Ce+1;Pt<Ce+Te-1;Pt++){const Ze=lc(ce*R.getoffsetX(Pt),Ae,_e,a,j,B,De,Ie,nt,D,b,$,Q,!1,!1,re,te,se,me);if(!Ze)return L.length-=4*(Pt-Ce),{notEnoughRoom:!0};Ke(Ze)}Ke(st.last)}else{if(p&&!a){const Pt=Mi(B.x,B.y,0,y),Ze=Ie+De+1,ze=new r.P(D.getx(Ze),D.gety(Ze)),lt=Mi(ze.x,ze.y,0,y),Je=lt[3]>0?lt:wi(B,ze,Pt,1,y,void 0,re,te.canonical),bt=Da(Ge,Ue,(Je[0]-Pt[0])*Z,Je[1]-Pt[1]);if(f.flipState=bt&&bt.needsFlipping?Ye.flipRequired:Ye.flipNotRequired,bt)return bt}const st=lc(ce*R.getoffsetX(Ce),Ae,_e,a,j,B,De,Ie,nt,D,b,$,Q,!1,!1,re,te,se,me);if(!st)return{notEnoughRoom:!0};Ke(st)}return{}}function Xa(f,t,a,p,y){const{x:b,y:T,z:R}=p.projectTilePoint(f.x,f.y,t);if(!y)return Mi(b,T,R,a);const[D,L,F]=y.getElevation(f,y.elevation,y.elevationFeature);return Mi(b+D,T+L,R+F,a)}function wi(f,t,a,p,y,b,T,R){const D=Xa(f.sub(t)._unit()._add(f),R,y,T,b);return r.av(D,a,D),r.aw(D,D),r.bG(D,a,D,p)}function lc(f,t,a,p,y,b,T,R,D,L,F,j,B,$,Z,Q,re,te,se){const me=p?f-t:f+t;let ce=me>0?1:-1,Ae=0;p&&(ce*=-1,Ae=Math.PI),ce<0&&(Ae+=Math.PI);let _e=R+T+(ce>0?0:1)|0,Ie=y,Ce=y,Te=0,De=0;const Ge=Math.abs(me),Ue=[],nt=[];let Ke=b,st=Ke,Pt=r.bE([]);const Ze=()=>wi(st,Ke,Ce,Ge-Te+1,F,B,Q,re.canonical);for(;Te+De<=Ge;){if(_e+=ce,_e<R||_e>=D)return null;if(Ce=Ie,st=Ke,Ue.push(Ce),$&&nt.push(st),Ke=new r.P(L.getx(_e),L.gety(_e)),Ie=j[_e],!Ie){const ei=Xa(Ke,re.canonical,F,Q,B);Ie=ei[3]>0?j[_e]=ei:Ze()}Te+=De;const Ot=r.av([],Ie,Ce),di=r.bF(Ce,Ie);if(a&&di>0&&De>0&&r.bI(Pt,Ot)/(De*di)<se)return null;De=di,Pt=Ot}Z&&B&&(j[_e]&&(Ie=Ze(),De=r.bF(Ce,Ie),Pt=r.av([],Ie,Ce)),j[_e]=Ie);const ze=(Ge-Te)/De,lt=Ke.sub(st)._mult(ze)._add(st),Je=r.bG([],Ce,Pt,ze);let bt=[0,0,1],Ft=Pt[0],ci=Pt[1];if(te&&(bt=Q.upVector(re.canonical,lt.x,lt.y),bt[0]!==0||bt[1]!==0||bt[2]!==1)){const Ot=[bt[2],0,-bt[0]],di=r.bH([],bt,Ot);r.aw(Ot,Ot),r.aw(di,di),Ft=r.bI(Pt,Ot),ci=r.bI(Pt,di)}if(a){const Ot=r.bH([],bt,Pt);r.aw(Ot,Ot),r.bG(Je,Je,Ot,a*ce)}const Mt=Ae+Math.atan2(ci,Ft);return Ue.push(Je),$&&nt.push(lt),{point:Je,angle:Mt,path:Ue,tilePath:nt,up:bt}}function vl(f,t){const a=t.length,p=a+4*f;t.resize(p),t.float32.fill(-1/0,4*a,4*p)}function Oo(f,t,a){const p=t[0],y=t[1];return f[0]=a[0]*p+a[4]*y+a[12],f[1]=a[1]*p+a[5]*y+a[13],f[3]=a[3]*p+a[7]*y+a[15],f}const ws=100;class kc{constructor(t,a,p=new ge(t.width+200,t.height+200,25),y=new ge(t.width+200,t.height+200,25)){this.transform=t,this.grid=p,this.ignoredGrid=y,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ws,this.screenBottomBoundary=t.height+ws,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=a}placeCollisionBox(t,a,p,y,b,T,R,D,L,F,j){let B=p.projectedAnchorX,$=p.projectedAnchorY,Z=p.projectedAnchorZ;const Q=p.tileAnchorX,re=p.tileAnchorY,te=p.elevation,se=p.tileID,me=t.getProjection();if(te&&se){const[nt,Ke,st]=me.upVector(se.canonical,p.tileAnchorX,p.tileAnchorY),Pt=me.upVectorScale(se.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=nt*te*Pt,$+=Ke*te*Pt,Z+=st*te*Pt}const ce=t.projection.name==="globe",Ae=t.projection.name==="globe"?r.aj(this.transform.zoom):0;if(se&&ce&&Ae<1&&!T){const nt=1<<se.canonical.z,Ke=r.bO(Q,re);r.bP(Ke,Ke,1/r.al),r.bQ(Ke,Ke,r.bO(se.canonical.x,se.canonical.y)),r.bP(Ke,Ke,1/nt),r.bR(Ke,Ke,r.bO(y[0],y[1])),Ke[0]=r.bS(Ke[0],-.5,.5),r.bP(Ke,Ke,r.al);const st=r.bT(Ke[0],Ke[1],r.al/(2*Math.PI),1);r.aC(st,st,b),B=r.ak(B,st[0],Ae),$=r.ak($,st[1],Ae),Z=r.ak(Z,st[2],Ae)}const _e=this.projectAndGetPerspectiveRatio(F,B,$,Z,p.tileID,me.name==="globe"||!!te||this.transform.pitch>0,me),Ie=L*_e.perspectiveRatio,Ce=(p.x1*a+R.x-p.padding)*Ie+_e.point.x,Te=(p.y1*a+R.y-p.padding)*Ie+_e.point.y,De=(p.x2*a+R.x+p.padding)*Ie+_e.point.x,Ge=(p.y2*a+R.y+p.padding)*Ie+_e.point.y,Ue=_e.perspectiveRatio<=.55||_e.occluded;return!this.isInsideGrid(Ce,Te,De,Ge)||!D&&this.grid.hitTest(Ce,Te,De,Ge,j)||Ue?{box:[],offscreen:!1,occluded:_e.occluded}:{box:[Ce,Te,De,Ge],offscreen:this.isOffscreen(Ce,Te,De,Ge),occluded:!1}}placeCollisionCircles(t,a,p,y,b,T,R,D,L,F,j,B,$,Z,Q,re){const te=[],se=this.transform.elevation,me=t.getProjection(),ce=t.elevationType==="road",Ae=!!se||ce,_e=r.bU.getAtTileOffsetFunc(re,this.transform.center.lat,this.transform.worldSize,me),Ie=new r.P(p.tileAnchorX,p.tileAnchorY),Ce=new r.P(p.tileAnchorX,p.tileAnchorY);let{x:Te,y:De,z:Ge}=me.projectTilePoint(Ce.x,Ce.y,re.canonical),Ue=null;if(Ae){const di=ce?t.getElevationFeatureForText(y):null;Ue={getElevation:_e,elevation:se,elevationFeature:di};const[ei,Jt,ti]=_e(Ie,se,di);Te+=ei,De+=Jt,Ge+=ti}const nt=me.name==="globe",Ke=this.projectAndGetPerspectiveRatio(D,Te,De,Ge,re,nt||!!se||this.transform.pitch>0,me),{perspectiveRatio:st}=Ke,Pt=(B?R/st:R*st)/r.bX,Ze=Mi(Te,De,Ge,L),ze=p.lineOffsetX*Pt,lt=p.lineOffsetY*Pt,Je=r.an(t.layers[0].layout.get("text-max-angle")),bt=Math.cos(Je),Ft=Ke.signedDistanceFromCamera>0?Qi(Pt,T,ze,lt,ce&&p.flipState===1,Ze,Ce,p,b,L,{},Ae&&!B?Ue:null,B&&Ae,me,re,B,bt):null;let ci=!1,Mt=!1,Ot=!0;if(Ft&&!Ke.occluded){const di=.5*Z*st+Q,ei=new r.P(-100,-100),Jt=new r.P(this.screenRightBoundary,this.screenBottomBoundary),ti=new zm,{first:Ii,last:yn}=Ft,An=Ii.path.length;let _r=[];for(let tn=An-1;tn>=1;tn--)_r.push(Ii.path[tn]);for(let tn=1;tn<yn.path.length;tn++)_r.push(yn.path[tn]);const Bi=2.5*di;F&&(_r=_r.map(([tn,dr,Pn],Cr)=>(Ae&&!nt&&(Pn=_e(Cr<An-1?Ii.tilePath[An-1-Cr]:yn.tilePath[Cr-An+2],se,Ue.elevationFeature)[2]),Mi(tn,dr,Pn,F))),_r.some(tn=>tn[3]<=0)&&(_r=[]));let In=[];if(_r.length>0){let tn=1/0,dr=-1/0,Pn=1/0,Cr=-1/0;for(const jn of _r)tn=Math.min(tn,jn[0]),Pn=Math.min(Pn,jn[1]),dr=Math.max(dr,jn[0]),Cr=Math.max(Cr,jn[1]);dr>=ei.x&&tn<=Jt.x&&Cr>=ei.y&&Pn<=Jt.y&&(In=[_r.map(jn=>new r.P(jn[0],jn[1]))],(tn<ei.x||dr>Jt.x||Pn<ei.y||Cr>Jt.y)&&(In=r.bV(In,ei.x,ei.y,Jt.x,Jt.y)))}for(const tn of In){ti.reset(tn,.25*di);let dr=0;dr=ti.length<=.5*di?1:Math.ceil(ti.paddedLength/Bi)+1;for(let Pn=0;Pn<dr;Pn++){const Cr=Pn/Math.max(dr-1,1),jn=ti.lerp(Cr),on=jn.x+ws,tr=jn.y+ws;te.push(on,tr,di,0);const un=on-di,kr=tr-di,Xn=on+di,Fi=tr+di;if(Ot=Ot&&this.isOffscreen(un,kr,Xn,Fi),Mt=Mt||this.isInsideGrid(un,kr,Xn,Fi),!a&&this.grid.hitTestCircle(on,tr,di,$)&&(ci=!0,!j))return{circles:[],offscreen:!1,collisionDetected:ci,occluded:!1}}}}return{circles:!j&&ci||!Mt?[]:te,offscreen:Ot,collisionDetected:ci,occluded:Ke.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let p=1/0,y=1/0,b=-1/0,T=-1/0;for(const F of t){const j=new r.P(F.x+ws,F.y+ws);p=Math.min(p,j.x),y=Math.min(y,j.y),b=Math.max(b,j.x),T=Math.max(T,j.y),a.push(j)}const R=this.grid.query(p,y,b,T).concat(this.ignoredGrid.query(p,y,b,T)),D={},L={};for(const F of R){const j=F.key;if(D[j.bucketInstanceId]===void 0&&(D[j.bucketInstanceId]={}),D[j.bucketInstanceId][j.featureIndex])continue;const B=[new r.P(F.x1,F.y1),new r.P(F.x2,F.y1),new r.P(F.x2,F.y2),new r.P(F.x1,F.y2)];r.bW(a,B)&&(D[j.bucketInstanceId][j.featureIndex]=!0,L[j.bucketInstanceId]===void 0&&(L[j.bucketInstanceId]=[]),L[j.bucketInstanceId].push(j.featureIndex))}return L}insertCollisionBox(t,a,p,y,b){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:y,collisionGroupID:b},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,p,y,b){const T=a?this.ignoredGrid:this.grid,R={bucketInstanceId:p,featureIndex:y,collisionGroupID:b};for(let D=0;D<t.length;D+=4)T.insertCircle(R,t[D],t[D+1],t[D+2])}projectAndGetPerspectiveRatio(t,a,p,y,b,T,R){const D=[a,p,y,1];let L=!1;y||this.transform.pitch>0?(r.aC(D,D,t),this.fogState&&b&&R.name!=="globe"&&(L=function(B,$,Z,Q,re,te){const se=te.calculateFogTileMatrix(re),me=[$,Z,Q];return r.af(me,me,se),gt(B,r.ag(me),te.pitch,te._fov)}(this.fogState,a,p,y,b.toUnwrapped(),this.transform)>.9)):Oo(D,D,t);const F=D[3];return{point:new r.P((D[0]/F+1)/2*this.transform.width+ws,(-D[1]/F+1)/2*this.transform.height+ws),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(R)/F*.5,1.5),signedDistanceFromCamera:F,occluded:T&&D[2]>F||L}}isOffscreen(t,a,p,y){return p<ws||t>=this.screenRightBoundary||y<ws||a>this.screenBottomBoundary}isInsideGrid(t,a,p,y){return p>=0&&t<this.gridRightBoundary&&y>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=r.bz([]);return r.bq(t,t,[-100,-100,0]),t}}class bi{constructor(t,a,p,y){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):y&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class Dn{constructor(t,a,p,y,b,T=!1){this.text=new bi(t?t.text:null,a,p,b),this.icon=new bi(t?t.icon:null,a,y,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class qn{constructor(t,a,p,y=!1){this.text=t,this.icon=a,this.skipFade=p,this.clipped=y}}class ks{constructor(){this.invProjMatrix=r.bB(),this.viewportMatrix=r.bB(),this.circles=[]}}class hh{constructor(t,a,p,y,b){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=p,this.bucketIndex=y,this.tileID=b}}class cr{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:p=>p.collisionGroupID===a}}return this.collisionGroups[t]}}function Zd(f,t,a,p,y){const{horizontalAlign:b,verticalAlign:T}=r.c0(f),R=-(b-.5)*t,D=-(T-.5)*a,L=r.c1(f,p);return new r.P(R+L[0]*y,D+L[1]*y)}function dh(f,t,a,p,y){const b=new r.P(f,t);return a&&b._rotate(p?y:-y),b}class fp{constructor(t,a,p,y,b,T){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new kc(this.transform,b),this.buildingIndex=T,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new cr(p),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,a,p,y,b=1){const T=p.getBucket(a),R=p.latestFeatureIndex;if(!T||!R||a.fqid!==T.layerIds[0])return;const D=T.layers[0].layout,L=T.layers[0].paint,F=p.collisionBoxArray,j=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),B=p.tileSize/r.al,$=p.tileID.toUnwrapped();this.transform.setProjection(T.projection);const Z=(Q=p.tileID,re=T.getProjection(),te=this.transform,re.name===this.projection?te.calculateProjMatrix(Q.toUnwrapped()):Oc(te,re,Q));var Q,re,te;const se=D.get("text-pitch-alignment")==="map",me=D.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const ce=a.dynamicFilter(),Ae=a.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(p),Ie=Ai(Z,p.tileID.canonical,se,me,this.transform,T.getProjection(),_e);let Ce=null;const Te=T.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(se){const ze=mn(Z,p.tileID.canonical,se,me,this.transform,T.getProjection(),_e);Ce=r.aB([],this.transform.labelPlaneMatrix,ze)}let De=null;ce&&p.latestFeatureIndex&&(De={unwrappedTileID:$,dynamicFilter:ce,dynamicFilterNeedsFeature:Ae}),this.retainedQueryData[T.bucketInstanceId]=new hh(T.bucketInstanceId,R,T.sourceLayerIndex,T.index,p.tileID);const[Ge,Ue]=T.layers[0].layout.get("text-size-scale-range"),nt=r.aA(b,Ge,Ue),[Ke,st]=D.get("icon-size-scale-range"),Pt=r.aA(b,Ke,st),Ze={bucket:T,layout:D,paint:L,posMatrix:Z,invMatrix:Te,mercatorCenter:[r.aF(this.transform.center.lng),r.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ie,labelToScreenMatrix:Ce,clippingData:De,scale:j,textPixelRatio:B,holdingForFade:p.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:r.bJ(T.textSizeData,this.transform.zoom,nt),partiallyEvaluatedIconSize:r.bJ(T.iconSizeData,this.transform.zoom,Pt),collisionGroup:this.collisionGroups.get(T.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(y)for(const ze of T.sortKeyRanges){const{sortKey:lt,symbolInstanceStart:Je,symbolInstanceEnd:bt}=ze;t.push({sortKey:lt,symbolInstanceStart:Je,symbolInstanceEnd:bt,parameters:Ze})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Ze})}attemptAnchorPlacement(t,a,p,y,b,T,R,D,L,F,j,B,$,Z,Q,re,te,se,me,ce,Ae){const{textOffset0:_e,textOffset1:Ie,crossTileID:Ce}=Q,Te=[_e,Ie],De=Zd(t,T,R,Te,D),Ge=this.collisionIndex.placeCollisionBox(te,D,a,p,y,b,dh(De.x,De.y,L,F,this.transform.angle),Z,j,B,$.predicate);if(me){const Ue=te.getSymbolInstanceIconSize(Ae,this.transform.zoom,Q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(te,Ue,me,p,y,b,dh(De.x,De.y,L,F,this.transform.angle),Z,j,B,$.predicate).box.length===0)return}if(Ge.box.length>0){let Ue;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ce]&&this.prevPlacement.placements[Ce]&&this.prevPlacement.placements[Ce].text&&(Ue=this.prevPlacement.variableOffsets[Ce].anchor),this.variableOffsets[Ce]={textOffset:Te,width:T,height:R,anchor:t,textScale:D,prevAnchor:Ue},this.markUsedJustification(te,t,Q,se),te.allowVerticalPlacement&&(this.markUsedOrientation(te,se,Q),this.placedOrientations[Ce]=se),{shift:De,placedGlyphBoxes:Ge}}}placeLayerBucketPart(t,a,p,y,b=1){const{bucket:T,layout:R,paint:D,posMatrix:L,textLabelPlaneMatrix:F,labelToScreenMatrix:j,clippingData:B,textPixelRatio:$,mercatorCenter:Z,invMatrix:Q,holdingForFade:re,collisionBoxArray:te,partiallyEvaluatedTextSize:se,partiallyEvaluatedIconSize:me,collisionGroup:ce,latestFeatureIndex:Ae}=t.parameters,_e=R.get("text-optional"),Ie=R.get("icon-optional"),Ce=R.get("text-allow-overlap"),Te=R.get("icon-allow-overlap"),De=R.get("text-rotation-alignment")==="map",Ge=R.get("icon-rotation-alignment")==="map",Ue=R.get("text-pitch-alignment")==="map",nt=D.get("symbol-z-offset"),Ke=R.get("symbol-elevation-reference")==="sea",st=R.get("symbol-placement"),[Pt,Ze]=R.get("text-size-scale-range"),[ze,lt]=R.get("icon-size-scale-range"),Je=r.aA(b,Pt,Ze),bt=r.aA(b,ze,lt),Ft=R.get("text-variable-anchor"),ci=De&&st!=="point",Mt=Ge&&st!=="point",Ot=Ft&&T.hasTextData(),di=T.hasIconTextFit()&&Ot&&T.hasIconData();this.transform.setProjection(T.projection);const ei=Ot||ci,Jt=Mt||di;let ti=Ce&&(Te||!T.hasIconData()||Ie),Ii=Te&&(Ce||!T.hasTextData()||_e);const yn=!nt.isConstant();!T.collisionArrays&&te&&T.deserializeCollisionBoxes(te),p&&y&&T.updateCollisionDebugBuffers(this.transform.zoom,te,Je,bt);const An=(Bi,In,tn)=>{const{crossTileID:dr,numVerticalGlyphVertices:Pn}=Bi;let Cr=null;if(B&&B.dynamicFilterNeedsFeature||yn){const ca=this.retainedQueryData[T.bucketInstanceId];Cr=Ae.loadFeature({featureIndex:Bi.featureIndex,bucketIndex:ca.bucketIndex,sourceLayerIndex:ca.sourceLayerIndex,layoutVertexArrayOffset:0})}if(B&&!(0,B.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:T.worldview},Cr,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new r.P(Bi.tileAnchorX,Bi.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[dr]=new qn(!1,!1,!1,!0),void a.add(dr);const jn=nt.evaluate(Cr,{});if(a.has(dr))return;if(re)return void(this.placements[dr]=new qn(!1,!1,!1));let on=!1,tr=!1,un=!0,kr=!1,Xn=!1,Fi=null,zn={box:null,offscreen:null,occluded:null},$r={box:null},va=null,Xr=null,pa=null,Cs=0,As=0,Zo=0;tn.textFeatureIndex?Cs=tn.textFeatureIndex:Bi.useRuntimeCollisionCircles&&(Cs=Bi.featureIndex),tn.verticalTextFeatureIndex&&(As=tn.verticalTextFeatureIndex);const es=T.elevationFeatures?T.elevationFeatures[Bi.elevationFeatureIndex]:void 0,nl=ca=>{ca.tileID=this.retainedQueryData[T.bucketInstanceId].tileID;const Ea=this.transform.elevation;ca.elevation=Ke?jn:jn+r.bU.getAtTileOffset(ca.tileID,new r.P(ca.tileAnchorX,ca.tileAnchorY),Ea,es),ca.elevation+=Bi.zOffset},Lo=tn.textBox;if(Lo){nl(Lo);const ca=br=>{let ka=r.bK.horizontal;if(T.allowVerticalPlacement&&!br&&this.prevPlacement){const Ro=this.prevPlacement.placedOrientations[dr];Ro&&(this.placedOrientations[dr]=Ro,ka=Ro,this.markUsedOrientation(T,ka,Bi))}return ka},Ea=(br,ka)=>{if(T.allowVerticalPlacement&&Pn>0&&tn.verticalTextBox){for(const Ro of T.writingModes)if(Ro===r.bK.vertical?(zn=ka(),$r=zn):zn=br(),zn&&zn.box&&zn.box.length)break}else zn=br()};if(Ft){let br=Ft;if(this.prevPlacement&&this.prevPlacement.variableOffsets[dr]){const ia=this.prevPlacement.variableOffsets[dr];br.indexOf(ia.anchor)>0&&(br=br.filter(El=>El!==ia.anchor),br.unshift(ia.anchor))}const ka=(ia,El,Sf)=>{const Zc=T.getSymbolInstanceTextSize(se,Bi,this.transform.zoom,In),Xc=(ia.x2-ia.x1)*Zc+2*ia.padding,Yc=(ia.y2-ia.y1)*Zc+2*ia.padding,Cl=Bi.hasIconTextFit&&!Te?El:null;Cl&&nl(Cl);let Kc={box:[],offscreen:!1,occluded:!1};const vo=Ce?2*br.length:br.length;for(let Rs=0;Rs<vo;++Rs){const Cd=this.attemptAnchorPlacement(br[Rs%br.length],ia,Z,Q,ei,Xc,Yc,Zc,De,Ue,$,L,ce,Rs>=br.length,Bi,In,T,Sf,Cl,se,me);if(Cd&&(Kc=Cd.placedGlyphBoxes,Kc&&Kc.box&&Kc.box.length)){on=!0,Fi=Cd.shift;break}}return Kc};Ea(()=>ka(Lo,tn.iconBox,r.bK.horizontal),()=>{const ia=tn.verticalTextBox;return ia&&nl(ia),T.allowVerticalPlacement&&!(zn&&zn.box&&zn.box.length)&&Pn>0&&ia?ka(ia,tn.verticalIconBox,r.bK.vertical):{box:null,offscreen:null,occluded:null}}),zn&&(on=zn.box,un=zn.offscreen,kr=zn.occluded);const Ro=ca(!(!zn||!zn.box));if(!on&&this.prevPlacement){const ia=this.prevPlacement.variableOffsets[dr];ia&&(this.variableOffsets[dr]=ia,this.markUsedJustification(T,ia.anchor,Bi,Ro))}}else{const br=(ka,Ro)=>{const ia=T.getSymbolInstanceTextSize(se,Bi,this.transform.zoom,In),El=this.collisionIndex.placeCollisionBox(T,ia,ka,Z,Q,ei,new r.P(0,0),Ce,$,L,ce.predicate);return El&&El.box&&El.box.length&&(this.markUsedOrientation(T,Ro,Bi),this.placedOrientations[dr]=Ro),El};Ea(()=>br(Lo,r.bK.horizontal),()=>{const ka=tn.verticalTextBox;return T.allowVerticalPlacement&&Pn>0&&ka?(nl(ka),br(ka,r.bK.vertical)):{box:null,offscreen:null,occluded:null}}),ca(!!(zn&&zn.box&&zn.box.length))}}if(va=zn,on=va&&va.box&&va.box.length>0,un=va&&va.offscreen,kr=va&&va.occluded,Bi.useRuntimeCollisionCircles){const ca=Bi.centerJustifiedTextSymbolIndex>=0?Bi.centerJustifiedTextSymbolIndex:Bi.verticalPlacedTextSymbolIndex,Ea=T.text.placedSymbolArray.get(ca),br=r.bL(T.textSizeData,se,Ea),ka=R.get("text-padding");Xr=this.collisionIndex.placeCollisionCircles(T,Ce,Ea,ca,T.lineVertexArray,T.glyphOffsetArray,br,L,F,j,p,Ue,ce.predicate,Bi.collisionCircleDiameter*br/r.bX,ka,this.retainedQueryData[T.bucketInstanceId].tileID),on=Ce||Xr.circles.length>0&&!Xr.collisionDetected,un=un&&Xr.offscreen,kr=Xr.occluded}if(tn.iconFeatureIndex&&(Zo=tn.iconFeatureIndex),tn.iconBox){const ca=Ea=>{nl(Ea);const br=Bi.hasIconTextFit&&Fi?dh(Fi.x,Fi.y,De,Ue,this.transform.angle):new r.P(0,0),ka=T.getSymbolInstanceIconSize(me,this.transform.zoom,Bi.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(T,ka,Ea,Z,Q,Jt,br,Te,$,L,ce.predicate)};$r&&$r.box&&$r.box.length&&tn.verticalIconBox?(pa=ca(tn.verticalIconBox),tr=pa.box.length>0):(pa=ca(tn.iconBox),tr=pa.box.length>0),un=un&&pa.offscreen,Xn=pa.occluded}const rl=_e||Bi.numHorizontalGlyphVertices===0&&Pn===0,fs=Ie||Bi.numIconVertices===0;if(rl||fs?fs?rl||(tr=tr&&on):on=tr&&on:tr=on=tr&&on,on&&va&&va.box&&this.collisionIndex.insertCollisionBox(va.box,R.get("text-ignore-placement"),T.bucketInstanceId,$r&&$r.box&&As?As:Cs,ce.ID),tr&&pa&&this.collisionIndex.insertCollisionBox(pa.box,R.get("icon-ignore-placement"),T.bucketInstanceId,Zo,ce.ID),Xr&&(on&&this.collisionIndex.insertCollisionCircles(Xr.circles,R.get("text-ignore-placement"),T.bucketInstanceId,Cs,ce.ID),p)){const ca=T.bucketInstanceId;let Ea=this.collisionCircleArrays[ca];Ea===void 0&&(Ea=this.collisionCircleArrays[ca]=new ks);for(let br=0;br<Xr.circles.length;br+=4)Ea.circles.push(Xr.circles[br+0]),Ea.circles.push(Xr.circles[br+1]),Ea.circles.push(Xr.circles[br+2]),Ea.circles.push(Xr.collisionDetected?1:0)}const Ao=T.projection.name!=="globe";ti=ti&&(Ao||!kr),Ii=Ii&&(Ao||!Xn),this.placements[dr]=new qn(on||ti,tr||Ii,un||T.justReloaded),a.add(dr)},_r=this.retainedQueryData[T.bucketInstanceId].tileID;if(T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,_r),T.elevationType==="road"&&T.updateRoadElevation(_r.canonical),T.updateZOffset(),T.sortFeaturesByY){const Bi=T.getSortedSymbolIndexes(this.transform.angle);for(let In=Bi.length-1;In>=0;--In){const tn=Bi[In];An(T.symbolInstances.get(tn),tn,T.collisionArrays[tn])}T.hasAnyZOffset&&r.w(`${T.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(T.hasAnyZOffset){const Bi=T.getSortedIndexesByZOffset();for(let In=0;In<Bi.length;++In){const tn=Bi[In];An(T.symbolInstances.get(tn),tn,T.collisionArrays[tn])}}else for(let Bi=t.symbolInstanceStart;Bi<t.symbolInstanceEnd;Bi++)An(T.symbolInstances.get(Bi),Bi,T.collisionArrays[Bi]);if(p&&T.bucketInstanceId in this.collisionCircleArrays){const Bi=this.collisionCircleArrays[T.bucketInstanceId];r.bk(Bi.invProjMatrix,L),Bi.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(t,a,p,y){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:D,crossTileID:L}=p,F=r.c2(a),j=y===r.bK.vertical?D:F==="left"?b:F==="center"?T:F==="right"?R:-1;b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=j>=0&&b!==j?0:L),T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=j>=0&&T!==j?0:L),R>=0&&(t.text.placedSymbolArray.get(R).crossTileID=j>=0&&R!==j?0:L),D>=0&&(t.text.placedSymbolArray.get(D).crossTileID=j>=0&&D!==j?0:L)}markUsedOrientation(t,a,p){const y=a===r.bK.horizontal||a===r.bK.horizontalOnly?a:0,b=a===r.bK.vertical?a:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:R,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:L}=p,F=t.text.placedSymbolArray;T>=0&&(F.get(T).placedOrientation=y),R>=0&&(F.get(R).placedOrientation=y),D>=0&&(F.get(D).placedOrientation=y),L>=0&&(F.get(L).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let p=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const y=a?a.symbolFadeChange(t):1,b=a?a.opacities:{},T=a?a.variableOffsets:{},R=a?a.placedOrientations:{};for(const D in this.placements){const L=this.placements[D],F=b[D];F?(this.opacities[D]=new Dn(F,y,L.text,L.icon,null,L.clipped),p=p||L.text!==F.text.placed||L.icon!==F.icon.placed):(this.opacities[D]=new Dn(null,y,L.text,L.icon,L.skipFade,L.clipped),p=p||L.text||L.icon)}for(const D in b){const L=b[D];if(!this.opacities[D]){const F=new Dn(L,y,!1,!1);F.isHidden()||(this.opacities[D]=F,p=p||L.text.placed||L.icon.placed)}}for(const D in T)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=T[D]);for(const D in R)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=R[D]);p?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a,p,y){const b=new Set;for(const T of a){const R=T.getBucket(t);R&&T.latestFeatureIndex&&t.fqid===R.layerIds[0]&&(this.updateBucketOpacities(R,b,T,T.collisionBoxArray,p,y,T.tileID,t.scope),R.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(R,T.tileID),R.elevationType==="road"&&R.updateRoadElevation(T.tileID.canonical),R.updateZOffset())}}updateBucketOpacities(t,a,p,y,b,T,R,D){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const L=t.layers[0].layout,F=t.layers[0].paint,j=!!t.layers[0].dynamicFilter(),B=new Dn(null,0,!1,!1,!0),$=L.get("text-allow-overlap"),Z=L.get("icon-allow-overlap"),Q=L.get("text-variable-anchor"),re=L.get("text-rotation-alignment")==="map",te=L.get("text-pitch-alignment")==="map",se=F.get("symbol-z-offset"),me=L.get("symbol-elevation-reference")==="sea",ce=!se.isConstant(),Ae=new Dn(null,0,$&&(Z||!t.hasIconData()||L.get("icon-optional")),Z&&($||!t.hasTextData()||L.get("text-optional")),!0);!t.collisionArrays&&y&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(y);const _e=(Ce,Te,De)=>{for(let Ge=0;Ge<Te/4;Ge++)Ce.opacityVertexArray.emplaceBack(De)};let Ie=0;T&&t.updateReplacement(R,T);for(let Ce=0;Ce<t.symbolInstances.length;Ce++){const Te=t.symbolInstances.get(Ce),{numHorizontalGlyphVertices:De,numVerticalGlyphVertices:Ge,crossTileID:Ue,numIconVertices:nt,tileAnchorX:Ke,tileAnchorY:st}=Te;let Pt=null;const Ze=this.retainedQueryData[t.bucketInstanceId];ce&&Te&&Ze&&(Pt=p.latestFeatureIndex.loadFeature({featureIndex:Te.featureIndex,bucketIndex:Ze.bucketIndex,sourceLayerIndex:Ze.sourceLayerIndex,layoutVertexArrayOffset:0}));const ze=se.evaluate(Pt,{}),lt=a.has(Ue);let Je=this.opacities[Ue];lt?Je=B:Je||(Je=Ae,this.opacities[Ue]=Je),a.add(Ue);const bt=De>0||Ge>0,Ft=nt>0,ci=this.placedOrientations[Ue],Mt=ci===r.bK.vertical,Ot=ci===r.bK.horizontal||ci===r.bK.horizontalOnly;!bt&&!Ft||Je.isHidden()||Ie++;let di=!1;if((bt||Ft)&&T)for(const ei of t.activeReplacements){if(r.bY(ei,b,r.bZ.Symbol,D)||ei.min.x>Ke||Ke>ei.max.x||ei.min.y>st||st>ei.max.y)continue;const Jt=r.b_(Ke,st,R.canonical,ei.footprintTileId.canonical);if(di=r.b$(Jt,ei.footprint),di)break}if(bt){const ei=di?Sa:Jo(Je.text);_e(t.text,De,Mt?Sa:ei),_e(t.text,Ge,Ot?Sa:ei);const Jt=Je.text.isHidden(),{leftJustifiedTextSymbolIndex:ti,centerJustifiedTextSymbolIndex:Ii,rightJustifiedTextSymbolIndex:yn,verticalPlacedTextSymbolIndex:An}=Te,_r=t.text.placedSymbolArray,Bi=Jt||Mt?1:0;ti>=0&&(_r.get(ti).hidden=Bi),Ii>=0&&(_r.get(Ii).hidden=Bi),yn>=0&&(_r.get(yn).hidden=Bi),An>=0&&(_r.get(An).hidden=Jt||Ot?1:0);const In=this.variableOffsets[Ue];In&&this.markUsedJustification(t,In.anchor,Te,ci);const tn=this.placedOrientations[Ue];tn&&(this.markUsedJustification(t,"left",Te,tn),this.markUsedOrientation(t,tn,Te))}if(Ft){const ei=di?Sa:Jo(Je.icon),{placedIconSymbolIndex:Jt,verticalPlacedIconSymbolIndex:ti}=Te,Ii=t.icon.placedSymbolArray,yn=Je.icon.isHidden()?1:0;Jt>=0&&(_e(t.icon,nt,Mt?Sa:ei),Ii.get(Jt).hidden=yn),ti>=0&&(_e(t.icon,Te.numVerticalIconVertices,Ot?Sa:ei),Ii.get(ti).hidden=yn)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const ei=t.collisionArrays[Ce];if(ei){let Jt=new r.P(0,0),ti=!0;if(ei.textBox||ei.verticalTextBox){if(Q){const yn=this.variableOffsets[Ue];yn?(Jt=Zd(yn.anchor,yn.width,yn.height,yn.textOffset,yn.textScale),re&&Jt._rotate(te?this.transform.angle:-this.transform.angle)):ti=!1}j&&(ti=!Je.clipped),ei.textBox&&Ma(t.textCollisionBox.collisionVertexArray,Je.text.placed,!ti||Mt,ze,me,Jt.x,Jt.y),ei.verticalTextBox&&Ma(t.textCollisionBox.collisionVertexArray,Je.text.placed,!ti||Ot,ze,me,Jt.x,Jt.y)}const Ii=ti&&!!(!Ot&&ei.verticalIconBox);ei.iconBox&&Ma(t.iconCollisionBox.collisionVertexArray,Je.icon.placed,Ii,ze,me,Te.hasIconTextFit?Jt.x:0,Te.hasIconTextFit?Jt.y:0),ei.verticalIconBox&&Ma(t.iconCollisionBox.collisionVertexArray,Je.icon.placed,!Ii,ze,me,Te.hasIconTextFit?Jt.x:0,Te.hasIconTextFit?Jt.y:0)}}}if(t.fullyClipped=Ie===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const Ce=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Ce.invProjMatrix,t.placementViewportMatrix=Ce.viewportMatrix,t.collisionCircleArray=Ce.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const p=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*p>t}setStale(){this.stale=!0}}function Ma(f,t,a,p,y,b,T){f.emplaceBack(t?1:0,a?1:0,b||0,T||0,p,y?1:0),f.emplaceBack(t?1:0,a?1:0,b||0,T||0,p,y?1:0),f.emplaceBack(t?1:0,a?1:0,b||0,T||0,p,y?1:0),f.emplaceBack(t?1:0,a?1:0,b||0,T||0,p,y?1:0)}const io=Math.pow(2,25),N_=Math.pow(2,24),ld=Math.pow(2,17),pp=Math.pow(2,16),mp=Math.pow(2,9),cd=Math.pow(2,8),Fm=Math.pow(2,1);function Jo(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const t=f.placed?1:0,a=Math.floor(127*f.opacity);return a*io+t*N_+a*ld+t*pp+a*mp+t*cd+a*Fm+t}const Sa=0;class Pa{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,a,p,y,b,T){const R=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(R,y,t[this._currentTileIndex],this._sortAcrossTiles,T),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,R.sort((D,L)=>D.sortKey-L.sortKey));this._currentPartIndex<R.length;){const D=R[this._currentPartIndex];if(a.placeLayerBucketPart(D,this._seenCrossTileIDs,p,D.symbolInstanceStart===0,T),this._currentPartIndex++,b())return!0}return!1}}class oo{constructor(t,a,p,y,b,T,R,D,L){this.placement=new fp(t,b,T,R,D,L),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(t,a,p,y,b){const T=r.o.now(),R=()=>{const D=r.o.now()-T;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=a[t[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&(!D.minzoom||D.minzoom<=L)&&(!D.maxzoom||D.maxzoom>L)){const F=D,j=F.layout.get("symbol-z-elevate"),B=F.layout.get("symbol-sort-key").constantOr(1)!==void 0,$=F.layout.get("symbol-z-order"),Z=$==="viewport-y"||$==="auto"&&!($!=="viewport-y"&&B),Q=F.layout.get("text-allow-overlap")||F.layout.get("icon-allow-overlap")||F.layout.get("text-ignore-placement")||F.layout.get("icon-ignore-placement"),re=Z&&Q,te=this._inProgressLayer=this._inProgressLayer||new Pa(F),se=r.B(D.source,D.scope);if(te.continuePlacement(j||re?y[se]:p[se],this.placement,this._showCollisionBoxes,D,R,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Xd=512/r.al/2;class Su{constructor(t,a,p){this.tileID=t,this.bucketInstanceId=p,this.index=new r.c3(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=t.canonical.x*r.al,b=t.canonical.y*r.al;for(let T=0;T<a.length;T++){const{key:R,crossTileID:D,tileAnchorX:L,tileAnchorY:F}=a.get(T),j=Math.floor((y+L)*Xd),B=Math.floor((b+F)*Xd);this.index.add(j,B),this.keys.push(R),this.crossTileIDs.push(D)}this.index.finish()}findMatches(t,a,p){const y=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),b=Xd/Math.pow(2,a.canonical.z-this.tileID.canonical.z),T=a.canonical.x*r.al,R=a.canonical.y*r.al;for(let D=0;D<t.length;D++){const L=t.get(D);if(L.crossTileID)continue;const{key:F,tileAnchorX:j,tileAnchorY:B}=L,$=Math.floor((T+j)*b),Z=Math.floor((R+B)*b),Q=this.index.range($-y,Z-y,$+y,Z+y).sort((re,te)=>re-te);for(const re of Q){const te=this.crossTileIDs[re];if(this.keys[re]===F&&!p.has(te)){p.add(te),L.crossTileID=te;break}}}}}class _o{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Qs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const p in this.indexes){const y=this.indexes[p],b={};for(const T in y){const R=y[T];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+a),b[R.tileID.key]=R}this.indexes[p]=b}this.lng=t}addBucket(t,a,p){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const y=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>t.overscaledZ)for(const R in T){const D=T[R];D.tileID.isChildOf(t)&&D.findMatches(a.symbolInstances,t,y)}else{const R=T[t.scaledTo(Number(b)).key];R&&R.findMatches(a.symbolInstances,t,y)}}for(let b=0;b<a.symbolInstances.length;b++){const T=a.symbolInstances.get(b);T.crossTileID||(T.crossTileID=p.generate(),y.add(T.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Su(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const p of a.crossTileIDs)this.usedCrossTileIDs[t].delete(p)}removeStaleBuckets(t){let a=!1;for(const p in this.indexes){const y=this.indexes[p];for(const b in y)t[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,y[b]),delete y[b],a=!0)}return a}}class Eu{constructor(){this.layerIndexes={},this.crossTileIDs=new _o,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,p,y){let b=this.layerIndexes[t.fqid];b===void 0&&(b=this.layerIndexes[t.fqid]=new Qs);let T=!1;const R={};y.name!=="globe"&&b.handleWrapJump(p);for(const D of a){const L=D.getBucket(t);L&&t.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(D.tileID,L,this.crossTileIDs)&&(T=!0),R[L.bucketInstanceId]=!0)}return b.removeStaleBuckets(R)&&(T=!0),T}pruneUnusedLayers(t){const a={};t.forEach(p=>{a[p]=!0});for(const p in this.layerIndexes)a[p]||delete this.layerIndexes[p]}}const Oa=771;class an{constructor(t,a,p,y){this.blendFunction=t,this.blendColor=a.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=y}}an.Replace=[1,0,1,0],an.disabled=new an(an.Replace,r.ao.transparent,[!1,!1,!1,!1]),an.unblended=new an(an.Replace,r.ao.transparent,[!0,!0,!0,!0]),an.alphaBlended=new an([1,Oa,1,Oa],r.ao.transparent,[!0,!0,!0,!0]),an.alphaBlendedNonPremultiplied=new an([770,Oa,770,Oa],r.ao.transparent,[!0,!0,!0,!0]),an.multiply=new an([774,0,774,0],r.ao.transparent,[!0,!0,!0,!0]),an.additive=new an([1,1,1,1],r.ao.transparent,[!0,!0,!0,!0]);class pi{constructor(t,a,p){this.func=t,this.mask=a,this.range=p}}pi.ReadOnly=!1,pi.ReadWrite=!0,pi.disabled=new pi(519,pi.ReadOnly,[0,1]);const ud=7680;class Hi{constructor(t,a,p,y,b,T){this.test=t,this.ref=a,this.mask=p,this.fail=y,this.depthFail=b,this.pass=T}}Hi.disabled=new Hi({func:519,mask:0},0,0,ud,ud,ud);const hd=1029,Nm=2305;class Ni{constructor(t,a,p){this.enable=t,this.mode=a,this.frontFace=p}}function gp(f,t){const a=r.c9(f,3);r.cb(f,t),r.cf(f,3,a)}function _p(f,t){const a=r.c6([]);return r.c7(a,a,-t),r.c8(a,a,-f),a}function dd(f,t){const a=[f[0],f[1],0],p=[t[0],t[1],0];if(r.ag(a)>=1e-15){const T=r.aw([],a);r.c4(p,T,r.bI(p,T)),t[0]=p[0],t[1]=p[1]}const y=r.bH([],t,f);if(r.c5(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return _p(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),b)}Ni.disabled=new Ni(!1,hd,Nm),Ni.backCCW=new Ni(!0,hd,Nm),Ni.backCW=new Ni(!0,hd,2304),Ni.frontCW=new Ni(!0,1028,2304),Ni.frontCCW=new Ni(!0,1028,Nm);class zl{constructor(t,a){this.position=t,this.orientation=a}get position(){return this._position}set position(t){if(t){const a=t instanceof r.ae?t:new r.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(a.x=r.bS(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(t,a,p){if(this.orientation=null,!this.position)return;const y=this.position,b=p||(this._elevation?this._elevation.getAtPointOrZero(r.ae.fromLngLat(t)):0),T=r.ae.fromLngLat(t,b),R=[T.x-y.x,T.y-y.y,T.z-y.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=dd(R,a)}setPitchBearing(t,a){this.orientation=_p(r.an(t),r.an(-a))}}class yp{constructor(t,a){this._transform=r.bz([]),this.orientation=a,this.position=t}get mercatorPosition(){const t=this.position;return new r.ae(t[0],t[1],t[2])}get position(){const t=r.c9(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var a;t&&r.cf(this._transform,3,[(a=t)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||r.c6([]),t&&gp(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,a){this._orientation=_p(t,a),gp(this._transform,this._orientation)}forward(){const t=r.c9(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=r.c9(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=r.c9(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,a){const p=new Float64Array(16);return r.bk(p,this.getWorldToCamera(t,a)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,a,p){const y=this.position;r.c4(y,y,-t);const b=new Float64Array(16);return r.bp(b,[p,p,p]),r.bq(b,b,y),b[10]*=a,b}getWorldToCamera(t,a){const p=new Float64Array(16),y=new Float64Array(4),b=this.position;return r.ca(y,this._orientation),r.c4(b,b,-t),r.cb(p,y),r.bq(p,p,b),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=a,p[9]*=a,p[10]*=a,p[11]*=a,p}getCameraToClipPerspective(t,a,p,y){const b=new Float64Array(16);return r.cc(b,t,a,p,y),b}getCameraToClipOrthographic(t,a,p,y,b,T){const R=new Float64Array(16);return r.cd(R,t,a,p,y,b,T),R}getDistanceToElevation(t,a=!1){const p=t===0?0:r.ce(t,a?r.a_(this.position[1]):this.position[1]),y=this.forward();return(p-this.position[2])/y[2]}clone(){return new yp([...this.position],[...this.orientation])}}const So={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ls{constructor(t=0,a=0,p=0,y=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(p)||p<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=p,this.right=y}interpolate(t,a,p){return a.top!=null&&t.top!=null&&(this.top=r.ak(t.top,a.top,p)),a.bottom!=null&&t.bottom!=null&&(this.bottom=r.ak(t.bottom,a.bottom,p)),a.left!=null&&t.left!=null&&(this.left=r.ak(t.left,a.left,p)),a.right!=null&&t.right!=null&&(this.right=r.ak(t.right,a.right,p)),this}getCenter(t,a){const p=r.aA((this.left+t-this.right)/2,0,t),y=r.aA((this.top+a-this.bottom)/2,0,a);return new r.P(p,y)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ls(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const fd=15;class Yd{constructor(t,a,p,y,b,T,R){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=p??0,this._maxPitch=y??60,this.setProjection(T),this.setMaxBounds(R),this.width=0,this.height=0,this._center=new r.aS(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ls,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new yp,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Yd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<fd}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,a=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(t||p)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return r.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=r.cl(this.projectionOptions);const p=this.getProjection(),y=!r.bx(a,p);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.cl({name:"mercator"});const a=t!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bS(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const a=-t*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=r.cm(),r.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=r.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=r.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let y=0,b=0;for(let T=0;T<a.length;T++){const R=new r.P(a[T][0]*this.width,p+a[T][1]*(this.height-p)),D=t.pointCoordinate(R);if(!D)continue;const L=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);y+=D[3]*L,b+=L}return b===0?NaN:y/b}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*a,y=this._mercatorZfromZoom(t),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(y-p,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let p;p=t.z<this._camera.position[2]?[a.x,a.y,a.z]:[t.x,t.y,t.z];const y=r.ag(r.av([],this._camera.position,p));return r.aA(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let a=!1;if(t.orientation&&!r.co(t.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(t.orientation)),t.position){const p=[t.position.x,t.position.y,t.position.z];r.cp(p,this._camera.position)||(this._setCameraPosition(p),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,a=new zl;return a.position=new r.ae(t[0],t[1],t[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(t){if(!r.cq(t))return!1;r.cr(t,t);const a=r.cs([],[0,0,-1],t),p=r.cs([],[0,-1,0],t);if(p[2]<0)return!1;const y=dd(a,p);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(t){const a=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;t[2]=r.aA(t[2],y/p,y/a),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,p){this._unmodified=!1,this._edgeInsets.interpolate(t,a,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new r.ct(0,t)];if(this.renderWorldCopies){const p=this.pointCoordinate(new r.P(0,0)),y=this.pointCoordinate(new r.P(this.width,0)),b=this.pointCoordinate(new r.P(this.width,this.height)),T=this.pointCoordinate(new r.P(0,this.height)),R=Math.floor(Math.min(p.x,y.x,b.x,T.x)),D=Math.floor(Math.max(p.x,y.x,b.x,T.x)),L=1;for(let F=R-L;F<=D+L;F++)F!==0&&a.push(new r.ct(F,t))}return a}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,a,p){let y=[];const b=p!=null,T=!b;if(T&&this.zoom<a||b&&p[0]===0&&p[1]===0)return y;const R=new Set,D=(F,j,B,$,Z)=>{const Q=r.cX(j,F,B,$,Z);R.has(Q)||(y.push(new r.aP(F,j,B,$,Z)),R.add(Q))};for(let F=0;F<t.length;F++){const j=t[F];if(T&&j.canonical.z!==a)continue;const B=j.canonical,$=j.overscaledZ,Z=j.wrap,Q=1<<B.z,re=B.x+1<Q,te=B.x>0,se=B.y+1<Q,me=B.y>0,ce=j.wrap-(te?0:1),Ae=j.wrap+(re?0:1),_e=te?B.x-1:Q-1,Ie=re?B.x+1:0;if(b)p[0]<0?(D($,Ae,B.z,Ie,B.y),p[1]<0&&se&&(D($,Z,B.z,B.x,B.y+1),D($,Ae,B.z,Ie,B.y+1)),p[1]>0&&me&&(D($,Z,B.z,B.x,B.y-1),D($,Ae,B.z,Ie,B.y-1))):p[0]>0?(D($,ce,B.z,_e,B.y),p[1]<0&&se&&(D($,Z,B.z,B.x,B.y+1),D($,ce,B.z,_e,B.y+1)),p[1]>0&&me&&(D($,Z,B.z,B.x,B.y-1),D($,ce,B.z,_e,B.y-1))):p[1]<0&&se?D($,Z,B.z,B.x,B.y+1):me&&D($,Z,B.z,B.x,B.y-1);else{const Ce=j.visibleQuadrants;1&Ce&&(D($,ce,B.z,_e,B.y),me&&(D($,Z,B.z,B.x,B.y-1),D($,ce,B.z,_e,B.y-1))),2&Ce&&(D($,Ae,B.z,Ie,B.y),me&&(D($,Z,B.z,B.x,B.y-1),D($,Ae,B.z,Ie,B.y-1))),4&Ce&&(D($,ce,B.z,_e,B.y),se&&(D($,Z,B.z,B.x,B.y+1),D($,ce,B.z,_e,B.y+1))),8&Ce&&(D($,Ae,B.z,Ie,B.y),se&&(D($,Z,B.z,B.x,B.y+1),D($,Ae,B.z,Ie,B.y+1)))}}const L=[];for(const F of y)y.some(j=>F.isChildOf(j))||L.push(F);if(y=L.filter(F=>!t.some(j=>!!(F.overscaledZ<a&&j.isChildOf(F))||F.equals(j)||F.isChildOf(j))),T){const F=1<<a,j=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),B=[F*j.x,F*j.y],$=4,Z=$*$;y=y.filter(Q=>{const re=Q.canonical.x+.5-B[0],te=Q.canonical.y+.5-B[1];return re*re+te*te<Z})}return y}extendTileCoverToNearPlane(t,a,p){const y=[],b=new Set;for(const se of t)b.add(se.key);const T=(se,me,ce,Ae,_e)=>{const Ie=r.cX(me,se,ce,Ae,_e);b.has(Ie)||(y.push(new r.aP(se,me,ce,Ae,_e)),b.add(Ie))},R=t.reduce((se,me)=>Math.max(se,me.overscaledZ),p),D=1<<p,L=[new r.P(0,0),new r.P(r.al,0),new r.P(r.al,r.al),new r.P(0,r.al)],F=new r.P(0,0),j=new r.P(0,0),B=(se,me)=>{const ce=Math.floor(se[0]),Ae=Math.floor(se[1]),_e=(se[0]-ce)*r.al,Ie=(se[1]-Ae)*r.al,Ce=Math.floor(me[0]),Te=Math.floor(me[1]),De=(me[0]-Ce)*r.al,Ge=(me[1]-Te)*r.al;for(let Ue=-1;Ue<=1;Ue++){const nt=ce+Ue;if(!(nt<0||nt>=D)){F.x=_e-Ue*r.al,j.x=De-(nt-Ce)*r.al;for(let Ke=-1;Ke<=1;Ke++){const st=Ae+Ke;F.y=Ie-Ke*r.al,j.y=Ge-(st-Te)*r.al,r.cY(F,j,L)&&T(R,0,p,nt,st)}}}},$=a.points,Z=$[r.cu],Q=$[r.cv],re=this._projectToGround(Z,$[r.cw]),te=this._projectToGround(Q,$[r.cx]);return B(Z,re),B(Q,te),y}_projectToGround(t,a){return r.cy(r.cz(),t,a,t[2]/(t[2]-a[2]))}coveringTiles(t){let a=this.coveringZoomLevel(t);const p=a,y=this.elevation&&this.elevation.exaggeration(),b=y&&!t.isTerrainDEM,T=this.projection.name==="mercator";if(t.minzoom!==void 0&&a<t.minzoom)return[];t.maxzoom!==void 0&&a>t.maxzoom&&(a=t.maxzoom);const R=this.locationCoordinate(this.center),D=this.center.lat,L=1<<a,F=[L*R.x,L*R.y,0],j=this.projection.name==="globe",B=!j,$=r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,B),Z=j?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=L*r.ce(1,this.center.lat),re=this._camera.position[2]/r.ce(1,this.center.lat),te=[L*Z.x,L*Z.y,re*(B?1:Q)],se=j||y,me=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ce=this.isLODDisabled(!0)?a:0;let Ae;if(this._elevation&&t.isTerrainDEM)Ae=1e4*this._elevation.exaggeration();else if(this._elevation){const ze=this._elevation.getMinMaxForVisibleTiles();Ae=ze?ze.max:this._centerAltitude}else Ae=this._centerAltitude;const _e=t.isTerrainDEM?-Ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ie=this.projection.isReprojectedInTileSpace?r.cB(this):1,Ce=ze=>{const Je=new r.ae(ze.x+25e-6,ze.y,ze.z),bt=new r.ae(ze.x,ze.y+25e-6,ze.z),Ft=ze.toLngLat(),ci=Je.toLngLat(),Mt=bt.toLngLat(),Ot=this.locationCoordinate(Ft),di=this.locationCoordinate(ci),ei=this.locationCoordinate(Mt),Jt=Math.hypot(di.x-Ot.x,di.y-Ot.y),ti=Math.hypot(ei.x-Ot.x,ei.y-Ot.y);return Math.sqrt(Jt*ti)*Ie/25e-6},Te=ze=>{const lt=Ae,Je=_e;return{aabb:r.cE(this,L,0,0,0,ze,Je,lt,this.projection),zoom:0,x:0,y:0,minZ:Je,maxZ:lt,wrap:ze,fullyVisible:!1}},De=[];let Ge=[];const Ue=a,nt=t.reparseOverscaled?p:a,Ke=(re-this._centerAltitude)*Q,st=ze=>{if(!this._elevation||!ze.tileID||!T)return;const lt=this._elevation.getMinMaxForTile(ze.tileID),Je=ze.aabb;lt?(Je.min[2]=lt.min,Je.max[2]=lt.max,Je.center[2]=(Je.min[2]+Je.max[2])/2):(ze.shouldSplit=Ze(ze),ze.shouldSplit||(Je.min[2]=Je.max[2]=Je.center[2]=this._centerAltitude))},Pt=(ze,lt)=>{if(.707*lt<ze)return 1;const Je=lt/ze;return Je/(1.4144271570014144+(Math.pow(1.1,Je-1.4144271570014144+1)-1)/(1.1-1)-1)},Ze=ze=>{if(ze.zoom<ce)return!0;if(ze.zoom===Ue)return!1;if(ze.shouldSplit!=null)return ze.shouldSplit;const lt=ze.aabb.distanceX(te),Je=ze.aabb.distanceY(te);let bt=Ke,Ft=1;if(j){bt=ze.aabb.distanceZ(te);const ti=Math.pow(2,ze.zoom),Ii=r.a_((ze.y+1)/ti),yn=r.a_(ze.y/ti),An=Math.min(Math.max(D,Ii),yn),_r=r.d0(An)/r.d0(D);if(Ft=An===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,_r/this._mercatorScaleRatio),this.zoom<=r.cZ&&ze.zoom===Ue-1&&_r>=.9)return!0}else if(b&&(bt=ze.aabb.distanceZ(te)*Q),this.projection.isReprojectedInTileSpace&&p<=5){const ti=Math.pow(2,ze.zoom),Ii=Ce(new r.ae((ze.x+.5)/ti,(ze.y+.5)/ti));Ft=Ii>.85?1:Ii}if(!T&&!j){const ti=Math.sqrt(lt*lt+Je*Je+bt*bt);let Ii=(1<<Ue-ze.zoom)*me*Ft;return Ii*=Pt(Math.max(bt,Ke),ti),ti<Ii}let ci=Number.MAX_VALUE,Mt=0;const Ot=ze.aabb.getCorners(),di=[];for(const ti of Ot){r.av(di,ti,te),j||(b?di[2]*=Q:di[2]=Ke);const Ii=r.bI(di,this._camera.forward());Ii<ci&&(ci=Ii,Mt=Math.abs(di[2]))}let ei=(1<<Ue-ze.zoom)*me*Ft;if(ei*=Pt(Math.max(Mt,Ke),ci),ci<ei)return!0;const Jt=ze.aabb.closestPoint(F);return Jt[0]===F[0]&&Jt[1]===F[1]};if(this.renderWorldCopies)for(let ze=1;ze<=3;ze++)De.push(Te(-ze)),De.push(Te(ze));for(De.push(Te(0));De.length>0;){const ze=De.pop(),lt=ze.x,Je=ze.y;let bt=ze.fullyVisible;const Ft=()=>this.projection.name==="globe"&&(ze.y===0||ze.y===(1<<ze.zoom)-1);if(!bt){let ci=se?ze.aabb.intersects($):ze.aabb.intersectsFlat($);if(ci===0&&Ft()){const Mt=new r.cC(ze.zoom,lt,Je);ci=r.cD(this,L,Mt,!0).intersects($)}if(ci===0)continue;bt=ci===2}if(ze.zoom!==Ue&&Ze(ze))for(let ci=0;ci<4;ci++){const Mt=(lt<<1)+ci%2,Ot=(Je<<1)+(ci>>1),di={aabb:T?ze.aabb.quadrant(ci):r.cE(this,L,ze.zoom+1,Mt,Ot,ze.wrap,ze.minZ,ze.maxZ,this.projection),zoom:ze.zoom+1,x:Mt,y:Ot,wrap:ze.wrap,fullyVisible:bt,tileID:void 0,shouldSplit:void 0,minZ:ze.minZ,maxZ:ze.maxZ};b&&!j&&(di.tileID=new r.aP(ze.zoom+1===Ue?nt:ze.zoom+1,ze.wrap,ze.zoom+1,Mt,Ot),st(di)),De.push(di)}else{const ci=ze.zoom===Ue?nt:ze.zoom;if(t.minzoom&&t.minzoom>ci)continue;let Mt=0;if(!bt){let Jt=se?ze.aabb.intersectsPrecise($):ze.aabb.intersectsPreciseFlat($);if(Jt===0&&Ft()){const ti=new r.cC(ze.zoom,lt,Je);Jt=r.cD(this,L,ti,!0).intersectsPrecise($)}if(Jt===0)continue;if(t.calculateQuadrantVisibility)if($.containsPoint(ze.aabb.center))Mt=15;else for(let ti=0;ti<4;ti++)ze.aabb.quadrant(ti).intersects($)!==0&&(Mt|=1<<ti)}const Ot=F[0]-(.5+lt+(ze.wrap<<ze.zoom))*(1<<a-ze.zoom),di=F[1]-.5-Je,ei=ze.tileID?ze.tileID:new r.aP(ci,ze.wrap,ze.zoom,lt,Je);t.calculateQuadrantVisibility&&(ei.visibleQuadrants=Mt),Ge.push({tileID:ei,distanceSq:Ot*Ot+di*di})}}if(this.fogCullDistSq){const ze=this.fogCullDistSq,lt=this.horizonLineFromTop();Ge=Ge.filter(Je=>{const bt=[0,0,0,1],Ft=[r.al,r.al,0,1],ci=this.calculateFogTileMatrix(Je.tileID.toUnwrapped());r.aC(bt,bt,ci),r.aC(Ft,Ft,ci);const Mt=r.cF([],bt,Ft),Ot=r.cG([],bt,Ft),di=r.c_(Mt,Ot);if(di===0)return!0;let ei=!1;const Jt=this._elevation;if(Jt&&di>ze&&lt!==0){const ti=this.calculateProjMatrix(Je.tileID.toUnwrapped());let Ii;t.isTerrainDEM||(Ii=Jt.getMinMaxForTile(Je.tileID)),Ii||(Ii={min:_e,max:Ae});const yn=r.cH(this.rotation),An=[yn[0]*r.al,yn[1]*r.al,Ii.max];r.af(An,An,ti),ei=(1-An[1])*this.height*.5<lt}return di<ze||ei})}return Ge.sort((ze,lt)=>ze.distanceSq-lt.distanceSq).map(ze=>ze.tileID)}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const a=r.aA(t.lat,-r.cI,r.cI),p=this.projection.project(t.lng,a);return new r.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,a){let p,y;const b=this.centerPoint;if(this.projection.name==="globe"){const R=this.worldSize;p=(a.x-b.x)/R,y=(a.y-b.y)/R}else{const R=this.pointCoordinate(a),D=this.pointCoordinate(b);p=R.x-D.x,y=R.y-D.y}const T=this.locationCoordinate(t);this.setLocation(new r.ae(T.x-p,T.y-y))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,a){return this.projection.locationPoint(this,t,a)}locationPoint3D(t,a){return this.projection.locationPoint(this,t,a,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,a){return this.coordinateLocation(this.pointCoordinate3D(t,a))}locationCoordinate(t,a){const p=a?r.ce(a,t.lat):void 0,y=this.projection.project(t.lng,t.lat);return new r.ae(y.x,y.y,p)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,a){const p=a??this._centerAltitude,y=[t.x,t.y,0,1],b=[t.x,t.y,1,1];r.aC(y,y,this.pixelMatrixInverse),r.aC(b,b,this.pixelMatrixInverse);const T=b[3];r.cJ(y,y,1/y[3]),r.cJ(b,b,1/T);const R=y[2],D=b[2];return{p0:y,p1:b,t:R===D?0:(p-R)/(D-R)}}screenPointToMercatorRay(t){const a=[t.x,t.y,0,1],p=[t.x,t.y,1,1];return r.aC(a,a,this.pixelMatrixInverse),r.aC(p,p,this.pixelMatrixInverse),r.cJ(a,a,1/a[3]),r.cJ(p,p,1/p[3]),a[2]=r.ce(a[2],this._center.lat)*this.worldSize,p[2]=r.ce(p[2],this._center.lat)*this.worldSize,r.cJ(a,a,1/this.worldSize),r.cJ(p,p,1/this.worldSize),new r.ax([a[0],a[1],a[2]],r.aw([],r.av([],p,a)))}rayIntersectionCoordinate(t){const{p0:a,p1:p,t:y}=t,b=r.ce(a[2],this._center.lat),T=r.ce(p[2],this._center.lat);return new r.ae(r.ak(a[0],p[0],y)/this.worldSize,r.ak(a[1],p[1],y)/this.worldSize,r.ak(b,T,y))}pointCoordinate(t,a=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,a)}pointCoordinate3D(t,a){if(!this.elevation)return this.pointCoordinate(t,a);let p=this.projection.pointCoordinate3D(this,t.x,t.y);if(p)return new r.ae(p[0],p[1],p[2]);let y=0,b=this.horizonLineFromTop();if(t.y>b)return this.pointCoordinate(t,a);const T=.02*b,R=t.clone();for(let D=0;D<10&&b-y>T;D++){R.y=r.ak(y,b,.66);const L=this.projection.pointCoordinate3D(this,R.x,R.y);L?(b=R.y,p=L):y=R.y}return p?new r.ae(p[0],p[1],p[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=r.cK)return!this.isPointAboveHorizon(t);const a=this.pointCoordinate(t);return a.y>=0&&a.y<=1}_coordinatePoint(t,a){const p=a&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,y=[t.x*this.worldSize,t.y*this.worldSize,p+t.toAltitude(),1];return r.aC(y,y,this.pixelMatrix),y[3]>0?new r.P(y[0]/y[3],y[1]/y[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:a}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=this.pointLocation3D(new r.P(a,t)),T=this.pointLocation3D(new r.P(y,t)),R=this.pointLocation3D(new r.P(y,p)),D=this.pointLocation3D(new r.P(a,p));let L=Math.min(b.lng,T.lng,R.lng,D.lng),F=Math.max(b.lng,T.lng,R.lng,D.lng),j=Math.min(b.lat,T.lat,R.lat,D.lat),B=Math.max(b.lat,T.lat,R.lat,D.lat);const $=Math.pow(2,-this.zoom)/16*270,Z=this.projection.name==="globe"?1:4,Q=(re,te,se,me,ce)=>{const Ae=(re+se)/2,_e=(te+me)/2,Ie=new r.P(Ae,_e),{lng:Ce,lat:Te}=this.pointLocation3D(Ie),De=Math.max(0,L-Ce,j-Te,Ce-F,Te-B);L=Math.min(L,Ce),F=Math.max(F,Ce),j=Math.min(j,Te),B=Math.max(B,Te),(ce<Z||De>$)&&(Q(re,te,Ae,_e,ce+1),Q(Ae,_e,se,me,ce+1))};if(Q(a,t,y,t,1),Q(y,t,y,p,1),Q(y,p,a,p,1),Q(a,p,a,t,1),this.projection.name==="globe"){const[re,te]=r.cL(this);re?(B=90,F=180,L=-180):te&&(j=-90,F=180,L=-180)}return new r.aI(new r.aS(L,j),new r.aS(F,B))}_getBoundsRectangular(t,a){const{top:p,left:y}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,R=new r.P(y,p),D=new r.P(T,p),L=new r.P(T,b),F=new r.P(y,b);let j=this.pointCoordinate(R,t),B=this.pointCoordinate(D,t);const $=this.pointCoordinate(L,a),Z=this.pointCoordinate(F,a),Q=(re,te)=>(te.y-re.y)/(te.x-re.x);return j.y>1&&B.y>=0?j=new r.ae((1-Z.y)/Q(Z,j)+Z.x,1):j.y<0&&B.y<=1&&(j=new r.ae(-Z.y/Q(Z,j)+Z.x,0)),B.y>1&&j.y>=0?B=new r.ae((1-$.y)/Q($,B)+$.x,1):B.y<0&&j.y<=1&&(B=new r.ae(-$.y/Q($,B)+$.x,0)),new r.aI().extend(this.coordinateLocation(j)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation($))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=t.visibleDemTiles.reduce((p,y)=>{if(y.dem){const b=y.dem.tree;p.min=Math.min(p.min,b.minimums[0]),p.max=Math.max(p.max,b.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*t.exaggeration(),a.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-a*(1-this._horizonShift);return t?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-r.cI,this.maxLat=r.cI,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.aF(this.minLng)*this.tileSize,this.worldMaxX=r.aF(this.maxLng)*this.tileSize,this.worldMinY=r.aJ(this.maxLat)*this.tileSize,this.worldMaxY=r.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,a){return this.projection.createTileMatrix(this,a,t)}calculateDistanceTileData(t){const a=t.key,p=this._distanceTileDataCache;if(p[a])return p[a];const y=t.canonical,b=1/this.height,T=this.cameraWorldSize,R=T/this.zoomScale(y.z),D=(y.x+Math.pow(2,y.z)*t.wrap)*R,L=y.y*R,F=this.point;F.x*=T/this.worldSize,F.y*=T/this.worldSize;const j=this.angle,B=Math.sin(-j),$=-Math.cos(-j);return p[a]={bearing:[B,$],center:[(F.x-D)*b,(F.y-L)*b],scale:R/r.al*b},p[a]}calculateFogTileMatrix(t){const a=t.key,p=this._fogTileMatrixCache;if(p[a])return p[a];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return r.aB(y,this.worldToFogMatrix,y),p[a]=new Float32Array(y),p[a]}calculateProjMatrix(t,a=!1,p=!1){const y=t.key;let b;if(b=p?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,b[y])return b[y];const T=this.calculatePosMatrix(t,this.worldSize);let R;return R=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,r.aB(T,R,T),b[y]=new Float32Array(T),b[y]}calculatePixelsToTileUnitsMatrix(t){const a=t.tileID.key,p=this._pixelsToTileUnitsCache;if(p[a])return p[a];const y=r.cM(t,this);return p[a]=y,p[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,a=r.bp([],[t,t,t]);return r.aB(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const a=r.ce(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(a),y=this._camera.forward(),b=r.ce(1,this._center.lat);p[2]/=b,y[2]/=b,r.aw(y,y);const T=t.raycast(p,y,t.exaggeration());if(T){const R=r.bG([],p,y,T),D=new r.ae(R[0],R[1],r.ce(R[2],r.a_(R[1]))),L=(D.z+r.ag([D.x-p[0],D.y-p[1],D.z-p[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const a=this._elevation,p=r.ce(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(p),b=a.getAtPointOrZero(new r.ae(...y)),T=this.pixelsPerMeter/this.worldSize*b,R=this._minimumHeightOverTerrain(),D=y[2]-T;if(D<=R)if(D<0||t){const L=this.locationCoordinate(this._center,this._centerAltitude),F=[y[0],y[1],L.z-y[2]],j=r.ag(F);F[2]-=(R-D)/this._pixelsPerMercatorPixel;const B=r.ag(F);if(B===0)return;r.c4(F,F,j/B*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],L.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const B=this.center;return B.lat=r.aA(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(B.lng=r.aA(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const a=this._unmodified,{x:p,y}=this.point;let b=0,T=p,R=y;const D=this.width/2,L=this.height/2,F=this.worldMinY*this.scale,j=this.worldMaxY*this.scale;if(y-L<F&&(R=F+L),y+L>j&&(R=j-L),j-F<this.height&&(b=Math.max(b,this.height/(j-F)),R=(j+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,$=this.worldMaxX*this.scale,Z=this.worldSize/2-(B+$)/2;T=(p+Z+this.worldSize)%this.worldSize-Z,T-D<B&&(T=B+D),T+D>$&&(T=$-D),$-B<this.width&&(b=Math.max(b,this.width/($-B)),T=($+B)/2)}T===p&&R===y||this._allowWorldUnderZoom||(this.center=this.unproject(new r.P(T,R))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.ce(1,this.center.lat)/r.ce(1,r.d1));const y=r.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?p:1,T=this._camera.getWorldToCamera(this.worldSize,b);let R;const D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-t.x/this.width,D[9]=2*t.y/this.height,this.isOrthographic){let Te=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),De=Te*this.aspect,Ge=-De,Ue=-Te;De-=t.x,Ge-=t.x,Te+=t.y,Ue+=t.y,R=this._camera.getCameraToClipOrthographic(Ge,De,Ue,Te,this._nearZ,this._farZ),((nt,Ke,st,Pt)=>{for(let Ze=0;Ze<16;Ze++)nt[Ze]=r.ak(Ke[Ze],st[Ze],Pt)})(R,R,D,r.c$(this.pitch>=fd?1:this.pitch/fd))}else R=D;const L=r.cO([],D,T);let F=r.cO([],R,T);if(this.projection.isReprojectedInTileSpace){const Te=this.locationCoordinate(this.center),De=r.bz([]);r.bq(De,De,[Te.x*this.worldSize,Te.y*this.worldSize,0]),r.aB(De,De,r.cP(this)),r.bq(De,De,[-Te.x*this.worldSize,-Te.y*this.worldSize,0]),r.aB(F,F,De),r.aB(L,L,De),this.inverseAdjustmentMatrix=r.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.cR([],F,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=F,this.invProjMatrix=r.bk(new Float64Array(16),this.projMatrix),a){const Te=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Te[8]=2*-t.x/this.width,Te[9]=2*t.y/this.height,this.expandedFarZProjMatrix=r.cO([],Te,T)}else this.expandedFarZProjMatrix=this.projMatrix;const j=r.bk([],R);this.frustumCorners=r.cS.fromInvProjectionMatrix(j,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const B=new Float32Array(16);r.bz(B),r.cR(B,B,[1,-1,1]),r.cT(B,B,this._pitch),r.bA(B,B,this.angle);const $=r.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.by($);const Z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$[8]=2*-t.x/this.width,$[9]=2*(t.y+Z)/this.height,this.skyboxMatrix=r.aB(B,$,B);const Q=this.point,re=Q.x,te=Q.y,se=this.width%2/2,me=this.height%2/2,ce=Math.cos(this.angle),Ae=Math.sin(this.angle),_e=re-Math.round(re)+ce*se+Ae*me,Ie=te-Math.round(te)+ce*me+Ae*se,Ce=new Float64Array(F);if(r.bq(Ce,Ce,[_e>.5?_e-1:_e,Ie>.5?Ie-1:Ie,0]),this.alignedProjMatrix=Ce,F=r.bB(),r.cR(F,F,[this.width/2,-this.height/2,1]),r.bq(F,F,[1,-1,0]),this.labelPlaneMatrix=F,F=r.bB(),r.cR(F,F,[1,-1,1]),r.bq(F,F,[-1,-1,0]),r.cR(F,F,[2/this.width,2/this.height,1]),this.glCoordMatrix=F,this.pixelMatrix=r.aB(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},F=r.bk(new Float64Array(16),this.pixelMatrix),!F)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=F,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.cU(this);const Te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.af(Te,Te,T),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=F;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,p=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,b=[t,t,a];r.c4(b,b,y),r.c4(p,p,-1),r.cV(p,p,b);const T=r.bB();r.bq(T,T,p),r.cR(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,a,y)}_computeCameraPosition(t){const a=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-t/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-p[0]*b,y.y/this.worldSize-p[1]*b,t/this.worldSize*this._centerAltitude-p[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],y=t[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(b=Math.min((a-p)/y,1)),this._camera.position=r.bG([],this._camera.position,t,b),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,a=this._camera.forward(),{pitch:p,bearing:y}=this._camera.getPitchBearing(),b=r.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.an(this._maxPitch)),R=Math.max((t[2]-b)/Math.cos(p),T),D=this._zoomFromMercatorZ(R);r.bG(t,t,a,R),this._pitch=r.aA(p,r.an(this.minPitch),r.an(this.maxPitch)),this.angle=r.bS(y,-Math.PI,Math.PI),this._setZoom(r.aA(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let a=0,p=r.cK,y=0,b=1/0;for(;p-a>1e-6&&p>a;){const T=a+.5*(p-a),R=this.tileSize*Math.pow(2,T),D=this.getCameraToCenterDistance(this.projection,T,R),L=this.scaleZoom(D/(Math.max(0,t)*this.tileSize)),F=Math.abs(T-L);F<b&&(b=F,y=T),T<L?a=T:p=T}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,a){const p=Math.min(t.x,a.x),y=Math.max(t.x,a.x),b=Math.min(t.y,a.y),T=Math.max(t.y,a.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const R=[new r.P(p,b),new r.P(y,T),new r.P(p,T),new r.P(y,b)],D=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const F of R){const j=this.pointRayIntersection(F);if(j.t<0)return!0;const B=this.rayIntersectionCoordinate(j);if(B.x<D||B.y<0||B.x>L||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(t,a){const p=r.ag(r.av([],this._camera.position,t)),y=this._zoomFromMercatorZ(p)+a;return p-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([a,p,y],b){const T=[a,p,y,1];r.aC(T,T,b);const R=T[3]=Math.max(T[3],1e-6);return T[0]/=R,T[1]/=R,T[2]/=R,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,t))}}getCameraToCenterDistance(t,a=this.zoom,p=this.worldSize){const y=r.cN(t,a,this.width,this.height,1024),b=t.pixelSpaceConversion(this.center.lat,p,y);let T=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(T=r.ak(1,T,r.c$(this.pitch>=fd?1:this.pitch/fd))),T}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.aB(t,t,this.globeMatrix),t}getFrustum(t){return r.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Cu=(f,t)=>{if(t>0&&f.terrain&&r.w("Cutoff is currently disabled on terrain"),t<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=f.transform,p=Math.max(Math.abs(a._zoom-(f.minCutoffZoom-1)),1),y=a.isLODDisabled(!1)?r.ah(60,45,a.pitch):r.ah(30,15,a.pitch),b=a._farZ-a._nearZ,T=t*a.height,R=((1-(D=y))*a.cameraToCenterDistance+D*(a._farZ+T))*p;var D;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(R-a._nearZ)/b,(R-T-a._nearZ)/b]}}},ko={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Ob{constructor(t,a){this.aabb=t,this.lastCascade=a}}class kb{add(t,a){const p=this.receivers[t.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],a.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],a.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],a.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],a.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],a.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],a.max[2])):this.receivers[t.key]=new Ob(a,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,a,p){const y=r.d8.fromPoints(t.points);let b=0;for(const T in this.receivers){const R=this.receivers[T];if(!R||!y.intersectsAabb(R.aabb))continue;R.aabb.min=y.closestPoint(R.aabb.min),R.aabb.max=y.closestPoint(R.aabb.max);const D=R.aabb.getCorners();for(let L=0;L<p.length;L++){let F=!0;for(const j of D){const B=[j[0]*a,j[1]*a,j[2]];if(r.af(B,B,p[L].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){F=!1;break}}if(R.lastCascade=L,b=Math.max(b,L),F)break}}return b+1}}class vp{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new kb,this._depthMode=new pi(t.context.gl.LEQUAL,pi.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(ko,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(ko,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(ko,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,a){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const y=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||y<=0||(this._shadowLayerCount=p.style.order.reduce((Z,Q)=>{const re=p.style._mergedLayers[Q];return Z+(re.hasShadowPass()&&!re.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=p.context,T=ko.shadowMapResolution,R=ko.shadowMapResolution;if(this._cascades.length===0||ko.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Z=0;Z<ko.cascadeCount;++Z){const Q=p._shadowMapDebug,re=b.gl,te=b.createFramebuffer(T,R,Q,"texture"),se=new r.T(b,{width:T,height:R,data:null},re.DEPTH_COMPONENT16);if(te.depthAttachment.set(se.texture),Q){const me=new r.T(b,{width:T,height:R,data:null},re.RGBA8);te.colorAttachment.set(me.texture)}this._cascades.push({framebuffer:te,texture:se,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.cA,scale:0})}}this.shadowDirection=Qv(a);let D=0;if(t.elevation){const Z=t.elevation,Q=[1e4,-1e4];Z.visibleDemTiles.filter(re=>re.dem).forEach(re=>{const te=re.dem.tree;Q[0]=Math.min(Q[0],te.minimums[0]),Q[1]=Math.max(Q[1],te.maximums[0])}),Q[0]!==1e4&&(D=(Q[1]-Q[0])*Z.exaggeration())}const L=1.5*t.cameraToCenterDistance,F=3*L,j=new Float64Array(16);for(let Z=0;Z<this._cascades.length;++Z){const Q=this._cascades[Z];let re=t.height/50,te=1;ko.cascadeCount===1?te=F:Z===0?te=L:(re=L,te=F);const[se,me]=ex(t,this.shadowDirection,re,te,ko.shadowMapResolution,D);Q.scale=t.scale,Q.matrix=se,Q.boundingSphereRadius=me,r.bk(j,Q.matrix),Q.frustum=r.cA.fromInvProjectionMatrix(j,1,0,!0),Q.far=te}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/ko.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=ko.shadowMapResolution,this._uniformValues.u_shadowmap_0=So.ShadowMap0,this._uniformValues.u_shadowmap_1=So.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const $=p.transform.elevation;for(const Z of this._groundShadowTiles){let Q={min:0,max:0};if($){const re=$.getMinMaxForTile(Z);re&&(Q=re)}this.addShadowReceiver(Z.toUnwrapped(),Q.min,Q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,a){if(!this.enabled)return;const p=this.painter,y=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),y.viewport.set([0,0,ko.shadowMapResolution,ko.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){p.currentShadowCascade=b,y.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),y.clear({color:r.ao.white,depth:1});for(const T of t.order){const R=t._mergedLayers[T];if(!R.hasShadowPass()||R.isHidden(p.transform.zoom))continue;const D=t.getLayerSourceCache(R),L=D?a[D.id]:void 0;(R.type==="model"||L&&L.length)&&p.renderLayer(p,D,R,L)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,a=t.style,p=t.context,y=p.gl,b=a.directionalLight,T=a.ambientLight;if(!b||!T)return;const R=[],D=Cu(t,t.longestCutoffRange);D.shouldRenderCutoff&&R.push("RENDER_CUTOFF"),R.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&R.push("NORMAL_OFFSET");const L=xl(a,b,T),F=new pi(y.LEQUAL,pi.ReadOnly,t.depthRangeFor3D),j=new Hi({func:y.EQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.KEEP);for(const B of this._groundShadowTiles){const $=B.toUnwrapped(),Z=t.isTileAffectedByFog(B),Q=t.getOrCreateProgram("groundShadow",{defines:R,overrideFog:Z});this.setupShadows($,Q),t.uploadCommonUniforms(p,Q,$,null,D);const re={u_matrix:t.transform.calculateProjMatrix($),u_ground_shadow_factor:L};Q.draw(t,y.TRIANGLES,F,j,an.multiply,Ni.disabled,re,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?an.unblended:an.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const a=this.painter.transform,p=a.calculatePosMatrix(t,a.worldSize);return r.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(t){const a=r.by(t);return r.aB(a,this._cascades[this.painter.currentShadowCascade].matrix,t),a}setupShadows(t,a,p){if(!this.enabled)return;const y=this.painter.transform,b=this.painter.context,T=b.gl,R=this._uniformValues,D=new Float64Array(16),L=y.calculatePosMatrix(t,y.worldSize);for(let F=0;F<this._cascades.length;F++)r.aB(D,this._cascades[F].matrix,L),R[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),b.activeTexture.set(T.TEXTURE0+So.ShadowMap0+F),this._cascades[F].texture.bindExtraParam(T.LINEAR,T.LINEAR,T.CLAMP_TO_EDGE,T.CLAMP_TO_EDGE,T.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const F=r.d6(t.canonical),j=2/y.tileSize*r.al/ko.shadowMapResolution,B=j*this._cascades[0].boundingSphereRadius,$=j*this._cascades[this._cascades.length-1].boundingSphereRadius,Z=(p==="vector-tile"?1:3)*function(Q,re,te,se,me){const ce=r.aA((Q-22)/-22,0,1);return .125*(1-ce)+4*ce}(y.zoom);R.u_shadow_normal_offset=[F,B*Z,$*Z],R.u_shadow_bias=[1e-4,.0012,.012]}else R.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(b,R)}setupShadowsFromMatrix(t,a,p=!1){if(!this.enabled)return;const y=this.painter.context,b=y.gl,T=this._uniformValues,R=new Float64Array(16);for(let D=0;D<ko.cascadeCount;D++)r.aB(R,this._cascades[D].matrix,t),T[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),y.activeTexture.set(b.TEXTURE0+So.ShadowMap0+D),this._cascades[D].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);if(this.useNormalOffset=p,p){const D=ko.normalOffset;T.u_shadow_normal_offset=[1,D,D],T.u_shadow_bias=[6e-5,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(y,T)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,a,p,y){if(y[2]>=0)return{};const b=function(D,L,F){const j=F/(1<<D.canonical.z);return new r.d8([D.canonical.x*j+D.wrap*F,D.canonical.y*j+D.wrap*F,0],[(D.canonical.x+1)*j+D.wrap*F,(D.canonical.y+1)*j+D.wrap*F,L])}(t,a,p).getCorners(),T=a/-y[2];y[0]<0?(r.d7(b[0],b[0],[y[0]*T,0,0]),r.d7(b[3],b[3],[y[0]*T,0,0])):y[0]>0&&(r.d7(b[1],b[1],[y[0]*T,0,0]),r.d7(b[2],b[2],[y[0]*T,0,0])),y[1]<0?(r.d7(b[0],b[0],[0,y[1]*T,0]),r.d7(b[1],b[1],[0,y[1]*T,0])):y[1]>0&&(r.d7(b[2],b[2],[0,y[1]*T,0]),r.d7(b[3],b[3],[0,y[1]*T,0]));const R={};return R.vertices=b,R.planes=[Au(b[1],b[0],b[4]),Au(b[2],b[1],b[5]),Au(b[3],b[2],b[6]),Au(b[0],b[3],b[7])],R}addShadowReceiver(t,a,p){this._receivers.add(t,r.d8.fromTileIdAndHeight(t,a,p))}getMaxCascadeForTile(t){const a=this._receivers.get(t);return a&&a.lastCascade?a.lastCascade:0}}function Au(f,t,a){const p=r.av([],a,t),y=r.av([],f,t),b=r.bH([],p,y),T=r.ag(b);return T===0?[0,0,1,0]:(r.c4(b,b,1/T),[b[0],b[1],b[2],-r.bI(b,t)])}function Qv(f){const t=f.properties.get("direction"),a=r.d3(t.x,t.y,t.z);a[2]=r.aA(a[2],0,75);const p=r.d5([a[0],a[1],a[2]]);return r.d4(p.x,p.y,p.z)}function xl(f,t,a){const p=t.properties.get("color-use-theme")==="none",y=t.properties.get("color"),b=t.properties.get("intensity"),T=t.properties.get("direction"),R=[T.x,T.y,T.z],D=a.properties.get("color-use-theme")==="none",L=a.properties.get("color"),F=a.properties.get("intensity"),j=Math.max(r.bI([0,0,1],R),0),B=[0,0,0];r.c4(B,L.toPremultipliedRenderColor(D?null:f.getLut(t.scope)).toArray01Linear().slice(0,3),F);const $=[0,0,0];return r.c4($,y.toPremultipliedRenderColor(p?null:f.getLut(a.scope)).toArray01Linear().slice(0,3),j*b),r.da([B[0]>0?B[0]/(B[0]+$[0]):0,B[1]>0?B[1]/(B[1]+$[1]):0,B[2]>0?B[2]/(B[2]+$[2]):0])}function ex(f,t,a,p,y,b){const T=f.zoom,R=f.scale,D=f.worldSize,L=1/D,F=f.aspect,j=Math.sqrt(1+F*F)*Math.tan(.5*f.fovX),B=j*j,$=p-a,Z=p+a;let Q,re;B>$/Z?(Q=p,re=p*j):(Q=.5*Z*(1+B),re=.5*Math.sqrt($*$+2*(p*p+a*a)*B+Z*Z*B*B));const te=f.projection.pixelsPerMeter(f.center.lat,D),se=f._camera.getCameraToWorldMercator(),me=[0,0,-Q*L];r.af(me,me,se);let ce=re*L;const Ae=f._edgeInsets;if(!(Ae.left===0&&Ae.top===0&&Ae.right===0&&Ae.bottom===0||Ae.left===Ae.right&&Ae.top===Ae.bottom)){const bt=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?te:1),Ft=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,a,p);Ft[8]=2*-f.centerOffset.x/f.width,Ft[9]=2*f.centerOffset.y/f.height;const ci=new Float64Array(16);r.cO(ci,Ft,bt);const Mt=new Float64Array(16);r.bk(Mt,ci);const Ot=r.cA.fromInvProjectionMatrix(Mt,D,T,!0);for(const di of Ot.points){const ei=((_e=di)[0]/=R,_e[1]/=R,_e[2]=r.ce(_e[2],f._center.lat),_e);ce=Math.max(ce,r.c5(r.d9([],me,ei)))}}var _e;ce*=y/(y-1);const Ie=Math.acos(t[2]),Ce=Math.atan2(-t[0],-t[1]),Te=new yp;Te.position=me,Te.setPitchBearing(Ie,Ce);const De=Te.getWorldToCamera(D,te),Ge=ce*D,Ue=Math.min(f._mercatorZfromZoom(17)*D*-2,-2*Ge),nt=Te.getCameraToClipOrthographic(-Ge,Ge,-Ge,Ge,Ue,(Ge+b*te)/t[2]),Ke=new Float64Array(16);r.aB(Ke,nt,De);const st=r.d4(Math.floor(1e6*me[0])/1e6*D,Math.floor(1e6*me[1])/1e6*D,0),Pt=.5*y,Ze=[0,0,0];r.af(Ze,st,Ke),r.c4(Ze,Ze,Pt);const ze=[Math.floor(Ze[0]),Math.floor(Ze[1]),Math.floor(Ze[2])],lt=[0,0,0];r.av(lt,Ze,ze),r.c4(lt,lt,-1/Pt);const Je=new Float64Array(16);return r.bz(Je),r.bq(Je,Je,lt),r.aB(Ke,Je,Ke),[Ke,Ge]}class Bm extends r.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,a){return r.db(this.requestManager.transformRequest(a,r.R.Model).url).then(p=>{if(!p)return;const y=r.dc(p),b=new r.dd(t,a,void 0,void 0,y);return b.computeBoundsAndApplyParent(),b}).catch(p=>{if(p&&p.status===404)return null;this.fire(new r.y(new Error(`Could not load model ${t} from ${a}: ${p.message}`)))})}load(t,a,p={forceReload:!1}){this.models[a]||(this.models[a]={});const y=Object.keys(t),b=[],T=[];for(const R of y){const D=t[R];this.hasURLBeenRequested(D)&&!p.forceReload||(this.modelByURL[D]={modelId:R,scope:a},b.push(this.loadModel(R,D)),T.push(R)),this.models[a][R]||(this.models[a][R]={model:null,numReferences:1})}this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+T.length,Promise.allSettled(b).then(R=>{for(let D=0;D<R.length;D++){const{status:L}=R[D];if(L==="rejected")continue;const{value:F}=R[D];this.models[a][T[D]]||(this.models[a][T[D]]={model:null,numReferences:1}),this.models[a][T[D]].model=F}this.numModelsLoading[a]-=T.length,this.fire(new r.z("data",{dataType:"style"}))}).catch(R=>{this.fire(new r.y(new Error(`Could not load models: ${R.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,a,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(t,a):this.getModelByURL(this.modelUris[a][t]))}getModel(t,a){return this.models[a]||(this.models[a]={}),this.models[a][t]?this.models[a][t].model:void 0}getModelByURL(t){if(!t)return null;const a=this.modelByURL[t];return a?this.models[a.scope][a.modelId].model:null}hasModelBeenAdded(t,a){return this.models[a]&&this.models[a][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,a,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const y=this.requestManager.normalizeModelURL(a);if((this.hasModel(t,p,{exactIdMatch:!0})||this.hasModelBeenAdded(t,p))&&this.modelUris[p][t]===y)this.models[p][t].numReferences++;else if(this.hasURLBeenRequested(y)){const{scope:b,modelId:T}=this.modelByURL[y];this.models[b][T].numReferences++}else this.modelUris[p][t]=y,this.load({[t]:this.modelUris[p][t]},p)}addModelURLs(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const p=this.modelUris[a];for(const y in t)p[y]=this.requestManager.normalizeModelURL(t[y])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const p={};for(const y of t)this.hasModel(y,a,{exactIdMatch:!0})||this.hasURLBeenRequested(y)?this.models[a][y].numReferences++:this.modelUris[a][y]&&!this.hasURLBeenRequested(y)?p[y]=this.modelUris[a][y]:!this.hasURLBeenRequested(y)&&r.de(y,!1)&&(this.modelUris[a][y]=this.requestManager.normalizeModelURL(y),p[y]=this.modelUris[a][y]);this.load(p,a)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,a,p=!1,y=!1){if(this.models[a]&&this.models[a][t]&&(this.models[a][t].numReferences--,this.models[a][t].numReferences===0||y)){const b=this.modelUris[a][t];p||delete this.modelUris[a][t],delete this.modelByURL[b];const T=this.models[a][t].model;if(!T)return;delete this.models[a][t],T.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const a of Object.keys(this.models[t])){const p=this.models[t][a].model;delete this.models[t][a],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,a){this.models[a]||(this.models[a]={});for(const p in this.models[a])this.models[a][p].model&&this.models[a][p].model.upload(t.context)}}const xp=r.a6.colorTheme,fh=new r.a9({data:new r.aa(xp.data)});function B_(f){if(!f.metadata||!f.metadata.content_area)return;const t=r.o.devicePixelRatio,{left:a,top:p,width:y,height:b}=f.metadata.content_area,T=a*t,R=p*t;return[T,R,T+y*t,R+b*t]}function ph(f){if(f)return f.map(([t,a])=>[t*r.o.devicePixelRatio,a*r.o.devicePixelRatio])}class Um{constructor(t,a,p){this.id=t,this.scope=a,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const a=this.sourceCache.getVisibleCoordinates();if(a.length===0)return t;const p=this.sourceCache.getSource();if(!(p instanceof Ia))return t;const y=a.map(T=>this.sourceCache.getTile(T)),b=p.getImages(y,Array.from(this.pendingRequests));for(const[T,R]of b)t.set(r.I.from({name:T,iconsetId:this.id}),R),this.pendingRequests.delete(T);for(const T of this.pendingRequests)this.missingRequests.add(T);return this.pendingRequests.clear(),t}}const Ru=(f,t)=>W(f,t&&t.filter(a=>a.identifier!=="source.canvas")),Kd=r.aH(Vn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),U_=r.aH(Vn,["setCenter","setZoom","setBearing","setPitch"]),Vm=new Set(["background","sky","slot","custom"]),V_={version:8,layers:[],sources:{}},j_={duration:300,delay:0};class Fl extends r.E{constructor(t,a={}){super(),this.map=t,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=Object.assign({},j_),this._buildingIndex=new qd(this),this.crossTileSymbolIndex=new Eu,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=a.styleChanges||new jr,this.dispatcher=a.dispatcher?a.dispatcher:new r.D(r.dg(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new to(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new r.dh(t._requestManager,a.localFontFamily?r.di.all:a.localIdeographFontFamily?r.di.ideographs:r.di.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new Bm(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._indoorDependentLayers=a.indoorDependentLayers?a.indoorDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",r.dj());const p=this;this._rtlTextPluginCallback=Fl.registerForPluginStateChange(y=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(b,T)=>{if(r.dk(b),T&&T.every(R=>R))for(const R in p._sourceCaches){const D=p._sourceCaches[R],L=D.getSource().type;L!=="vector"&&L!=="geojson"||D.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.getOwnSource(y.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const R=this._layers[T];R.source===b.id&&this._validateLayer(R)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(r.h(t))return t;const a=r.dl(t);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${r.dm(JSON.stringify(t))}`}_diffStyle(t,a,p){this.globalId=this._getGlobalId(t);const y=(b,T)=>{try{T(null,this.setState(b,p))}catch(R){T(R,!1)}};if(typeof t=="string"){const b=this.map._requestManager.normalizeStyleURL(t),T=this.map._requestManager.transformRequest(b,r.R.Style);r.m(T,(R,D)=>{R?this.fire(new r.y(R)):D&&y(D,a)})}else typeof t=="object"&&y(t,a)}loadURL(t,a={}){this.fire(new r.z("dataloading",{dataType:"style"}));const p=typeof a.validate=="boolean"?a.validate:!r.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,a.accessToken),this.resolvedImports.add(t);const y=this.importsCache.get(t);if(y)return this._load(y,p);const b=this.map._requestManager.transformRequest(t,r.R.Style);this._request=r.m(b,(T,R)=>{if(this._request=null,T)this.fire(new r.y(T));else if(R)return this.importsCache.set(t,R),this._load(R,p)})}loadJSON(t,a={}){this.fire(new r.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=r.o.frame(()=>{this._request=null,this._load(t,a.validate!==!1)})}loadEmpty(){this.fire(new r.z("dataloading",{dataType:"style"})),this._load(V_,!1)}_loadImports(t,a,p){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const b of t){const T=this._createFragmentStyle(b),R=new Promise(F=>{T.once("style.import.load",F),T.once("error",F)}).then(()=>this.mergeAll());if(y.push(R),this.resolvedImports.has(b.url)){T.loadEmpty();continue}const D=b.data||this.importsCache.get(b.url);D?(T.loadJSON(D,{validate:a}),this._isInternalStyle(D)&&(T.globalId=null)):b.url?T.loadURL(b.url,{validate:a}):T.loadEmpty();const L={style:T,id:b.id,config:b.config};if(p){const F=this.fragments.findIndex(({id:j})=>j===p);this.fragments=this.fragments.slice(0,F).concat(L).concat(this.fragments.slice(F))}else this.fragments.push(L)}return Promise.allSettled(y)}getImportGlobalIds(t=this,a=new Set){for(const p of t.fragments)p.style.globalId&&a.add(p.style.globalId),this.getImportGlobalIds(p.style,a);return[...a.values()]}_createFragmentStyle(t){const a=this.scope?r.B(t.id,this.scope):t.id;let p;const y=this._initialConfig&&this._initialConfig[a];(t.config||y)&&(p=Object.assign({},t.config,y));const b=new Fl(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,a){if(this._isInternalStyle(t)){const b=Object.assign({},V_,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(b,a)}if(this.updateConfig(this._config,t.schema),a&&Ru(this,no(t)))return;this._loaded=!0,this.stylesheet=r.dn(t);const p=()=>{for(const D in t.sources)this.addSource(D,t.sources[D],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const D in t.iconsets)this.addIconset(D,t.iconsets[D]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const b=ac(this.stylesheet.layers);if(this._order=b.map(D=>D.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const D=this.stylesheet.lights[0];this.light=new we(D.properties,D.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new we(this.stylesheet.light)),this._layers={};for(const D of b){const L=r.dt(D,this.scope,this._styleColorTheme.lut,this.options);L.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(L.fqid),this._hasAppearances=this._hasAppearances||L.getAppearances().length!==0,L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L;const F=this.getOwnLayerSourceCache(L),j=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&L.canCastShadows()&&j&&(F.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const T=this.stylesheet.terrain;T&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(T,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.z("data",{dataType:"style"}));const R=this.isRootStyle();t.imports?this._loadImports(t.imports,a).then(()=>{this._reloadImports(),this.fire(new r.z(R?"style.load":"style.import.load"))}).catch(D=>{this.fire(new r.y(new Error("Failed to load imports",D))),this.fire(new r.z(R?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.z(R?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const b=this._evaluateColorThemeData(y);this._loadColorTheme(b).then(()=>{p()}).catch(T=>{r.w(`Couldn't load color theme from the stylesheet: ${T}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances}mergeAll(){let t,a,p,y,b,T,R,D,L,F;const j={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(t=B.light),B.stylesheet.lights)for(const $ of B.stylesheet.lights)$.type==="ambient"&&B.ambientLight!=null&&(a=B.ambientLight),$.type==="directional"&&B.directionalLight!=null&&(p=B.directionalLight);y=this._prioritizeTerrain(y,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(b=B.fog),B.stylesheet.snow&&B.snow!=null&&(T=B.snow),B.stylesheet.rain&&B.rain!=null&&(R=B.rain),B.stylesheet.camera!=null&&(F=B.stylesheet.camera),B.stylesheet.projection!=null&&(D=B.stylesheet.projection),B.stylesheet.transition!=null&&(L=B.stylesheet.transition),j[B.scope]=B._styleColorTheme}}),this.light=t,this.ambientLight=a,this.directionalLight=p,this.fog=b,this.snow=T,this.rain=R,this._styleColorThemeForScope=j,y===null?delete this.terrain:this.terrain=y,this.camera=F||{"camera-projection":"perspective"},this.projection=D||{name:"mercator"},this.transition=Object.assign({},j_,L),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const a=p=>{for(const y of p.fragments)a(y.style);t(p)};a(this)}_prioritizeTerrain(t,a,p){const y=t&&t.drapeRenderMode===0;return p===null?a&&a.drapeRenderMode===0?a:y?t:null:a!=null&&(!t||y||a&&a.drapeRenderMode===1)?a:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{t=this._prioritizeTerrain(t,a.terrain,a.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(t=a.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},a={},p={};this.forEachFragmentStyle(y=>{for(const b in y._sourceCaches){const T=r.B(b,y.scope);t[T]=y._sourceCaches[b]}for(const b in y._otherSourceCaches){const T=r.B(b,y.scope);a[T]=y._otherSourceCaches[b]}for(const b in y._symbolSourceCaches){const T=r.B(b,y.scope);p[T]=y._symbolSourceCaches[b]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=p}mergeIndoor(){this.forEachFragmentStyle(t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const a of Object.values(t.stylesheet.indoor)){const p=a,y=r.B(p.sourceId,t.scope);this._mergedIndoor[y]=new Set(p.sourceLayers||[])}})}mergeLayers(){const t={},a=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(T=>{for(const R of T._order){const D=T._layers[R];if(D.type==="slot"){const L=r.dp(R);if(t[L])continue;t[L]=[]}D.slot&&t[D.slot]?t[D.slot].push(D):a.push(D)}}),this._mergedOrder=[];let y=-1;const b=(T=[])=>{for(const R of T)if(R.type==="slot"){const D=r.dp(R.id);t[D]&&b(t[D]),this._mergedSlots.push(D)}else{const D=r.B(R.id,R.scope);this._mergedOrder.push(D),p[D]=R,R.is3D(!!this.terrain)&&(this._has3DLayers=!0,y=this._mergedOrder.length-1),R.type==="circle"&&(this._hasCircleLayers=!0),R.type==="symbol"&&(this._hasSymbolLayers=!0),R.type==="clip"&&(this._clipLayerPresent=!0)}};if(b(a),this._has3DLayers){const T={};for(let R=0;R<this._mergedOrder.length;++R){const D=this._mergedOrder[R];T[D]=R===y?1:R<y?p[D].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((R,D)=>T[R]-T[D])}this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(a,p,y,b){const T=Object.assign({},p);for(const D of Object.keys(xp))T[D]===void 0&&(T[D]=xp[D].default);const R=new r.a8(fh,a,new Map(y));return R.setTransitionOrValue(T,y),R.untransitioned().possiblyEvaluate(new r.ac(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((p,y)=>{const b="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let T=t;T.startsWith(b)||(T=b+T);const R=r.I.from("mapbox-reserved-lut"),D=new Image;D.src=T,D.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},D.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void p();this._styleColorTheme.lutLoading=!1;const{width:L,height:F,data:j}=r.o.getImageData(D);if(F>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==F*F)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(R)&&this.removeImage(R),this.addImage(R,{data:new r.q({width:L,height:F},j),pixelRatio:1,sdf:!1,usvg:!1,version:0});const B=this.imageManager.getImage(R,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:t},p()):y(new Error("Missing LUT image."))}})}getLut(t){const a=this._styleColorThemeForScope[t];return a?a.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(a,p,y){let b,T,R;const D=r.o.devicePixelRatio>1?"@2x":"";let L=r.m(p.transformRequest(p.normalizeSpriteURL(a,D,".json"),r.R.SpriteJSON),(B,$)=>{L=null,R||(R=B,b=$,j())}),F=r.n(p.transformRequest(p.normalizeSpriteURL(a,D,".png"),r.R.SpriteImage),(B,$)=>{F=null,R||(R=B,T=$,j())});function j(){if(R)y(R);else if(b&&T){const B=r.o.getImageData(T),$={};for(const Z in b){const{width:Q,height:re,x:te,y:se,sdf:me,pixelRatio:ce,stretchX:Ae,stretchY:_e,content:Ie}=b[Z],Ce=new r.q({width:Q,height:re});r.q.copy(B,Ce,{x:te,y:se},{x:0,y:0},{width:Q,height:re},null),$[Z]={data:Ce,pixelRatio:ce!==void 0?ce:1,sdf:me!==void 0&&me,stretchX:Ae,stretchY:_e,content:Ie,usvg:!1,version:0}}y(null,$)}}return{cancel(){L&&(L.cancel(),L=null),F&&(F.cancel(),F=null)}}}(t,this.map._requestManager,(a,p)=>{if(this._spriteRequest=null,a)this.fire(new r.y(a));else if(p){const y=new Map;for(const b in p)y.set(r.I.from(b),p[b]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))})}addIconset(t,a){if(a.type==="sprite")return void this._loadSprite(a.url);const p=this.getOwnSourceCache(a.source);if(!p)return void this.fire(new r.y(new Error(`Source "${a.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const y=p.getSource();if(y.type!=="raster-array")return void this.fire(new r.y(new Error(`Source "${a.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));y.partial=!1;const b=new Um(t,this.scope,p);this.imageManager.addImageProvider(b,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!r.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const a=this.map._spriteFormat==="auto";var p,y;this._spriteRequest=(y=(b,T)=>{if(this._spriteRequest=null,b)a?this._loadSprite(t):this.fire(new r.y(b));else if(T){const R=new Map;for(const D in T)R.set(r.I.from(D),T[D]);this.addImages(R)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.z("data",{dataType:"style"}))},r.bt((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(t),r.R.Iconset),(b,T)=>{if(b)return void y(b);const R={},D=r.df(new r.bs(T));for(const L of D.icons){const F={version:1,pixelRatio:r.o.devicePixelRatio,content:B_(L),stretchX:L.metadata?ph(L.metadata.stretch_x_areas):void 0,stretchY:L.metadata?ph(L.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:L};R[L.name]=F}y(null,R)}))}_validateLayer(t){const a=this.getOwnSource(t.source);if(!a)return;const p=t.sourceLayer;p&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(p)===-1)&&this.fire(new r.y(new Error(`Source layer "${p}" does not exist on source "${a.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,a)=>{const p=this.fragments[a];return p&&p.style&&(t.data=p.style.serialize()),t})}_serializeSources(){const t={};for(const a in this._sourceCaches){const p=this._sourceCaches[a].getSource();t[p.id]||(t[p.id]=p.serialize())}return t}_serializeLayers(t){const a=[];for(const p of t){const y=this._layers[p];y&&y.type!=="custom"&&a.push(y.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const a=this.getOwnLayer(t);if(a)return a;this.fire(new r.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const a=this.getOwnSource(t);if(a)return a;this.fire(new r.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,a){const p=this.map.painter;if(p)for(let y=t.minzoom||0;y<(t.maxzoom||25.5);y++){const b=t.getProgramIds();if(b)for(const T of b){const R=t.getDefaultProgramParams(T,a.zoom,this._styleColorTheme.lut);R&&(p.style=this,this.fog&&(p._fogVisible=!0,R.overrideFog=!0,p.getOrCreateProgram(T,R)),p._fogVisible=!1,R.overrideFog=!1,p.getOrCreateProgram(T,R),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(R.overrideRtt=!0,p.getOrCreateProgram(T,R)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const a=this.calculateLightsBrightness();t.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const R=this._changes.getLayerUpdatesByScope();for(const D in R){const{updatedIds:L,removedIds:F}=R[D];(L||F)&&(this._updateWorkerLayers(D,L,F),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const b={};for(const R in this._mergedSourceCaches){const D=this._mergedSourceCaches[R];b[R]=D.used,D.used=!1,D.tileCoverLift=0}for(const R of this._mergedOrder){const D=this._mergedLayers[R];if(D.recalculate(t,this._availableImages),!D.isHidden(t.zoom)){const L=this.getLayerSourceCache(D);L&&(L.used=!0,L.tileCoverLift=Math.max(L.tileCoverLift,D.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(D,t)}):this.precompilePrograms(D,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();const T=this.imageManager.getPendingImageProviders();for(const R of T)R.sourceCache.used=!0;for(const R in b){const D=this._mergedSourceCaches[R];b[R]!==D.used&&D.getSource().fire(new r.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:D.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new r.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const a of t){const p=a.resolvePendingRequests(),y=this.getFragmentStyle(a.scope);y&&y.addImages(p)}}_updateTilesForChangedImages(){const t={};for(const a in this._mergedSourceCaches){const p=this._mergedSourceCaches[a].getSource().scope;t[p]=t[p]||this._changes.getUpdatedImages(p),t[p].length!==0&&this._mergedSourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t[p])}for(const a in t)this._changes.resetUpdatedImages(a)}_updateWorkerLayers(t,a,p){const y=this.getFragmentStyle(t);y&&this.dispatcher.broadcast("updateLayers",{layers:a?y._serializeLayers(a):[],scope:t,removedIds:p||[],options:y.options})}setState(t,a){if(this._checkLoaded(),Ru(this,no(t)))return!1;(t=r.dn(t)).layers=ac(t.layers);const p=function(T,R){if(!T)return[{command:Vn.setStyle,args:[R]}];let D=[];try{if(!r.bx(T.version,R.version))return[{command:Vn.setStyle,args:[R]}];if(r.bx(T.center,R.center)||D.push({command:Vn.setCenter,args:[R.center]}),r.bx(T.zoom,R.zoom)||D.push({command:Vn.setZoom,args:[R.zoom]}),r.bx(T.bearing,R.bearing)||D.push({command:Vn.setBearing,args:[R.bearing]}),r.bx(T.pitch,R.pitch)||D.push({command:Vn.setPitch,args:[R.pitch]}),r.bx(T.sprite,R.sprite)||D.push({command:Vn.setSprite,args:[R.sprite]}),r.bx(T.glyphs,R.glyphs)||D.push({command:Vn.setGlyphs,args:[R.glyphs]}),r.bx(T.imports,R.imports)||function($=[],Z=[],Q){Z=Z||[];const re=($=$||[]).map(Mc),te=Z.map(Mc),se=$.reduce(Pc,{}),me=Z.reduce(Pc,{}),ce=re.slice();let Ae,_e,Ie,Ce;for(Ae=0,_e=0;Ae<re.length;Ae++)Ie=re[Ae],me.hasOwnProperty(Ie)?_e++:(Q.push({command:Vn.removeImport,args:[Ie]}),ce.splice(ce.indexOf(Ie,_e),1));for(Ae=0,_e=0;Ae<te.length;Ae++)Ie=te[te.length-1-Ae],ce[ce.length-1-Ae]!==Ie&&(se.hasOwnProperty(Ie)?(Q.push({command:Vn.removeImport,args:[Ie]}),ce.splice(ce.lastIndexOf(Ie,ce.length-_e),1)):_e++,Ce=ce[ce.length-Ae],Q.push({command:Vn.addImport,args:[me[Ie],Ce]}),ce.splice(ce.length-Ae,0,Ie));for(const Te of Z){const De=se[Te.id];De&&(delete De.data,r.bx(De,Te)||Q.push({command:Vn.updateImport,args:[Te.id,Te]}))}}(T.imports,R.imports,D),r.bx(T.transition,R.transition)||D.push({command:Vn.setTransition,args:[R.transition]}),r.bx(T.light,R.light)||D.push({command:Vn.setLight,args:[R.light]}),r.bx(T.fog,R.fog)||D.push({command:Vn.setFog,args:[R.fog]}),r.bx(T.snow,R.snow)||D.push({command:Vn.setSnow,args:[R.snow]}),r.bx(T.rain,R.rain)||D.push({command:Vn.setRain,args:[R.rain]}),r.bx(T.projection,R.projection)||D.push({command:Vn.setProjection,args:[R.projection]}),r.bx(T.lights,R.lights)||D.push({command:Vn.setLights,args:[R.lights]}),r.bx(T.camera,R.camera)||D.push({command:Vn.setCamera,args:[R.camera]}),r.bx(T.iconsets,R.iconsets)||function($,Z,Q){let re;for(re in Z=Z||{},$=$||{})$.hasOwnProperty(re)&&(Z.hasOwnProperty(re)||Q.push({command:Vn.removeIconset,args:[re]}));for(re in Z){if(!Z.hasOwnProperty(re))continue;const te=Z[re];$.hasOwnProperty(re)?r.bx($[re],te)||(Q.push({command:Vn.removeIconset,args:[re]}),Q.push({command:Vn.addIconset,args:[re,te]})):Q.push({command:Vn.addIconset,args:[re,te]})}}(T.iconsets,R.iconsets,D),!r.bx(T["color-theme"],R["color-theme"]))return[{command:Vn.setStyle,args:[R]}];const L={},F=[];(function($,Z,Q,re){let te;for(te in Z=Z||{},$=$||{})$.hasOwnProperty(te)&&(Z.hasOwnProperty(te)||oc(te,Q,re));for(te in Z){if(!Z.hasOwnProperty(te))continue;const se=Z[te];$.hasOwnProperty(te)?r.bx($[te],se)||($[te].type==="geojson"&&se.type==="geojson"&&sc($,Z,te)?Q.push({command:Vn.setGeoJSONSourceData,args:[te,se.data]}):Tu(te,Z,Q,re)):Ic(te,Z,Q)}})(T.sources,R.sources,F,L);const j=[];T.layers&&T.layers.forEach($=>{$.source&&L[$.source]?D.push({command:Vn.removeLayer,args:[$.id]}):j.push($)});let B=T.terrain;B&&L[B.source]&&(D.push({command:Vn.setTerrain,args:[void 0]}),B=void 0),D=D.concat(F),r.bx(B,R.terrain)||D.push({command:Vn.setTerrain,args:[R.terrain]}),function($,Z,Q){Z=Z||[];const re=($=$||[]).map(Mc),te=Z.map(Mc),se=$.reduce(Pc,{}),me=Z.reduce(Pc,{}),ce=re.slice(),Ae=Object.create(null);let _e,Ie,Ce,Te,De,Ge,Ue;for(_e=0,Ie=0;_e<re.length;_e++)Ce=re[_e],me.hasOwnProperty(Ce)?Ie++:(Q.push({command:Vn.removeLayer,args:[Ce]}),ce.splice(ce.indexOf(Ce,Ie),1));for(_e=0,Ie=0;_e<te.length;_e++)Ce=te[te.length-1-_e],ce[ce.length-1-_e]!==Ce&&(se.hasOwnProperty(Ce)?(Q.push({command:Vn.removeLayer,args:[Ce]}),ce.splice(ce.lastIndexOf(Ce,ce.length-Ie),1)):Ie++,Ge=ce[ce.length-_e],Q.push({command:Vn.addLayer,args:[me[Ce],Ge]}),ce.splice(ce.length-_e,0,Ce),Ae[Ce]=!0);for(_e=0;_e<te.length;_e++)if(Ce=te[_e],Te=se[Ce],De=me[Ce],!Ae[Ce]&&!r.bx(Te,De))if(r.bx(Te.source,De.source)&&r.bx(Te["source-layer"],De["source-layer"])&&r.bx(Te.type,De.type)){for(Ue in Dc(Te.layout,De.layout,Q,Ce,null,Vn.setLayoutProperty),Dc(Te.paint,De.paint,Q,Ce,null,Vn.setPaintProperty),r.bx(Te.slot,De.slot)||Q.push({command:Vn.setSlot,args:[Ce,De.slot]}),r.bx(Te.filter,De.filter)||Q.push({command:Vn.setFilter,args:[Ce,De.filter]}),r.bx(Te.minzoom,De.minzoom)&&r.bx(Te.maxzoom,De.maxzoom)||Q.push({command:Vn.setLayerZoomRange,args:[Ce,De.minzoom,De.maxzoom]}),Te)Te.hasOwnProperty(Ue)&&Ue!=="layout"&&Ue!=="paint"&&Ue!=="filter"&&Ue!=="metadata"&&Ue!=="minzoom"&&Ue!=="maxzoom"&&Ue!=="slot"&&(Ue.indexOf("paint.")===0?Dc(Te[Ue],De[Ue],Q,Ce,Ue.slice(6),Vn.setPaintProperty):r.bx(Te[Ue],De[Ue])||Q.push({command:Vn.setLayerProperty,args:[Ce,Ue,De[Ue]]}));for(Ue in De)De.hasOwnProperty(Ue)&&!Te.hasOwnProperty(Ue)&&Ue!=="layout"&&Ue!=="paint"&&Ue!=="filter"&&Ue!=="metadata"&&Ue!=="minzoom"&&Ue!=="maxzoom"&&Ue!=="slot"&&(Ue.indexOf("paint.")===0?Dc(Te[Ue],De[Ue],Q,Ce,Ue.slice(6),Vn.setPaintProperty):r.bx(Te[Ue],De[Ue])||Q.push({command:Vn.setLayerProperty,args:[Ce,Ue,De[Ue]]}))}else Q.push({command:Vn.removeLayer,args:[Ce]}),Ge=ce[ce.lastIndexOf(Ce)+1],Q.push({command:Vn.addLayer,args:[De,Ge]})}(j,R.layers,D)}catch(L){console.warn("Unable to compute style diff:",L),D=[{command:Vn.setStyle,args:[R]}]}return D}(this.serialize(),t).filter(T=>!(T.command in U_));if(p.length===0)return!1;const y=p.filter(T=>!(T.command in Kd));if(y.length>0)throw new Error(`Unimplemented: ${y.map(T=>T.command).join(", ")}.`);const b=[];return p.forEach(T=>{b.push(this[T.command](...T.args))}),a&&Promise.all(b).then(a).catch(a),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[a,p]of t.entries()){if(this.getImage(a))return this.fire(new r.y(new Error(`An image with the name "${a.name}" already exists.`)));this.imageManager.addImage(a,this.scope,p),this._changes.updateImage(a,this.scope)}return this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this}addImage(t,a){return this.getImage(t)?this.fire(new r.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,a),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this)}updateImage(t,a,p=!1){this.imageManager.updateImage(t,this.scope,a),p&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new r.z("data",{dataType:"style"})),this}addModel(t,a,p={}){return this._checkLoaded(),this._validate(vi,`models.${t}`,a,null,p)||(this.modelManager.addModel(t,a,this.scope),this.fire(new r.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope,!1,!0),this.fire(new r.z("data",{dataType:"style"})),this):this.fire(new r.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,a,p={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(tc,`sources.${t}`,a,null,p))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const y=Po(t,a,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id}));const b=T=>{const R=(T?"symbol:":"other:")+y.id,D=r.B(R,this.scope),L=this._sourceCaches[R]=new Ha(D,y,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=L,L.onAdd(this.map)};b(!1),a.type!=="vector"&&a.type!=="geojson"||b(!0),y.onAdd&&y.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const a=this.getOwnSource(t);if(!a)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const y=Object.entries(this.stylesheet.iconsets).find(([b,T])=>T.type==="source"&&T.source===t);if(y)return this.fire(new r.y(new Error(`Source "${t}" cannot be removed while iconset "${y[0]}" is using it.`)))}const p=this.getOwnSourceCaches(t);for(const y of p){const b=r.dp(y.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(y.id),y.fire(new r.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,a){this._checkLoaded(),this.getOwnSource(t).setData(a),this._changes.setDirty()}getOwnSource(t){const a=this.getOwnSourceCache(t);return a&&a.getSource()}getOwnSources(){const t=[];for(const a in this._otherSourceCaches){const p=this.getOwnSourceCache(a);p&&t.push(p.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const a in t){const p=t[a]._tiles;for(const y in p){const b=p[y];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const b of t){if(this._validate(ic,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const T=this.ambientLight;T.set(b),T.updateTransitions(a)}else this.ambientLight=new Kr(b,lr||(lr=new r.a9({color:new r.aa(r.a6.properties_light_ambient.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const T=this.directionalLight;T.set(b),T.updateTransitions(a)}else this.directionalLight=new Kr(b,Or||(Or=new r.a9({direction:new r.ap(r.a6.properties_light_directional.direction),color:new r.aa(r.a6.properties_light_directional.color),"color-use-theme":new r.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new r.aa(r.a6.properties_light_directional.intensity),"cast-shadows":new r.aa(r.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new r.aa(r.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new r.aa(r.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=Object.assign(a,{worldview:this.map.getWorldview()}),y=new r.ac(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,a=this.ambientLight;if(!t||!a)return;const p=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),y=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),b=t.properties.get("intensity"),T=t.properties.get("direction"),R=1-r.d3(T.x,T.y,T.z)[2]/90,D=p(y)*b*R,L=a.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),F=a.properties.get("intensity"),j=p(L)*F;return Number(((D+j)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(r.dq(t)){const a=r.dr(t),p=this.fragments.find(({id:b})=>b===a);if(!p)return;const y=r.dp(t);return p.style.getFragmentStyle(y)}{const a=this.fragments.find(({id:p})=>p===t);return a?a.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const a={},p=(y,b="")=>`${y}::${b}`;this._featuresetSelectors={};for(const y in t){const b=this._featuresetSelectors[y]=[];for(const T of t[y].selectors){if(T.featureNamespace){const D=this.getOwnLayer(T.layer);if(!D){r.w(`Layer is undefined for selector: ${T.layer}`);continue}const L=p(D.source,D.sourceLayer);if(L in a&&a[L]!==T.featureNamespace){r.w(`"featureNamespace ${T.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}a[L]=T.featureNamespace}let R;if(T.properties)for(const D in T.properties){const L=r.U(T.properties[D]);L.result==="success"&&(R=R||{},R[D]=L.value)}b.push({layerId:T.layer,namespace:T.featureNamespace,properties:R,uniqueFeatureID:T._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const a=this.getFragmentStyle(t);if(!a||!a.stylesheet.featuresets)return[];const p=[];for(const y in a.stylesheet.featuresets)p.push({featuresetId:y,importId:a.scope?a.scope:void 0});return p}getFeaturesetLayers(t,a){const p=this.getFragmentStyle(a),y=p.stylesheet.featuresets;if(!y||!y[t])return this.fire(new r.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const T of y[t].selectors){const R=p.getOwnLayer(T.layer);R&&b.push(R)}return b}getConfigProperty(t,a){const p=this.getFragmentStyle(t);if(!p)return null;const y=r.B(a,p.scope),b=p.options.get(y),T=b?b.value||b.default:null;return T?T.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,a){const p=r.B(t,a);return this._mergedIndoor[p]}setIndoorData(t,a){this.map.indoor.setIndoorData(a)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,a,p){const y=this.getFragmentStyle(t);if(!y)return;const b=y.stylesheet.schema;if(!b||!b[a])return;const T=r.U(p);if(T.result!=="success")return void Ru(this,T.value);const R=T.value.expression,D=r.B(a,y.scope),L=y.options.get(D);if(!L)return;let F;const{minValue:j,maxValue:B,stepValue:$,type:Z,values:Q}=b[a],re=r.U(b[a].default);re.result==="success"&&(F=re.value.expression),F?(this.options.set(D,Object.assign({},L,{value:R,default:F,minValue:j,maxValue:B,stepValue:$,type:Z,values:Q})),this.updateConfigDependencies(a)):this.fire(new r.y(new Error(`No schema defined for the config option "${a}" in the "${t}" fragment.`)))}getConfig(t){const a=this.getFragmentStyle(t);if(!a)return null;const p=a.stylesheet.schema;if(!p)return null;const y={};for(const b in p){const T=r.B(b,a.scope),R=a.options.get(T),D=R?R.value||R.default:null;y[b]=D?D.serialize():null}return y}setConfig(t,a){const p=this.getFragmentStyle(t);p&&(p.updateConfig(a,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const a=this.getFragmentStyle(t);return a?a.stylesheet.schema:null}setSchema(t,a){const p=this.getFragmentStyle(t);p&&(p.stylesheet.schema=a,p.updateConfig(p._config,a),this.updateConfigDependencies())}updateConfig(t,a){if(this._config=t,t||a)if(a)for(const p in a){let y,b;const T=r.U(a[p].default);if(T.result==="success"&&(y=T.value.expression),t&&t[p]!==void 0){const B=r.U(t[p]);B.result==="success"&&(b=B.value.expression)}const{minValue:R,maxValue:D,stepValue:L,type:F,values:j}=a[p];if(y){const B=r.B(p,this.scope);this.options.set(B,{default:y,value:b,minValue:R,maxValue:D,stepValue:L,type:F,values:j})}else this.fire(new r.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new r.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,a=()=>!0){for(const p of t){const y=this.getLayer(p);y&&a(y)&&(y.possiblyEvaluateVisibility(),this._updateLayer(y),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,a=>!t||a.expressionDependencies.configDependencies.has(t)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(a=>{const p=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(p){const y=a._evaluateColorThemeData(p);(!a._styleColorTheme.lut&&y!==""||a._styleColorTheme.lut&&y!==a._styleColorTheme.lut.data)&&a.setColorTheme(p)}}),this._changes.setDirty()}addLayer(t,a,p={}){this._checkLoaded();const y=t.id;if(this._layers[y])return void this.fire(new r.y(new Error(`Layer with id "${y}" already exists on this map`)));let b;if(t.type==="custom"){if(Ru(this,r.ds(t)))return;b=r.dt(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(y,t.source),t=r.dn(t),t=Object.assign(t,{source:y})),this._validate(Mo,`layers.${y}`,t,{arrayIndex:-1},p))return;b=r.dt(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}})}const T=r.B(b.source,b.scope);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(T),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(T);let R=this._order.length;if(a){const j=this._order.indexOf(a);if(j===-1)return void this.fire(new r.y(new Error(`Layer with id "${a}" does not exist on this map.`)));b.slot===this._layers[a].slot?R=j:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(R,0,y),this._layerOrderChanged=!0,this._layers[y]=b;const D=this.getOwnLayerSourceCache(b),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&b.canCastShadows()&&L&&(D.castsShadows=!0);const F=this._changes.getRemovedLayer(b);if(F&&b.source&&D&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const j=r.B(b.source,b.scope);F.type!==b.type?this._changes.updateSourceCache(j,"clear"):(this._changes.updateSourceCache(j,"reload"),D.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(t,a){this._checkLoaded();const p=this._checkLayer(t);if(!p||t===a)return;const y=this._order.indexOf(t);this._order.splice(y,1);let b=this._order.length;if(a){const T=this._order.indexOf(a);if(T===-1)return void this.fire(new r.y(new Error(`Layer with id "${a}" does not exist on this map.`)));p.slot===this._layers[a].slot?b=T:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const a=this._checkLayer(t);if(!a)return;a.setEventedParent(null);const p=this._order.indexOf(t);this._order.splice(p,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._indoorDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const y=this.getOwnLayerSourceCache(a);if(y&&y.castsShadows){let b=!1;for(const T in this._layers)if(this._layers[T].source===a.source&&this._layers[T].canCastShadows()){b=!0;break}y.castsShadows=b}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const a in this._layers)if(this._layers[a].type===t)return!0;return!1}setLayerZoomRange(t,a,p){this._checkLoaded();const y=this._checkLayer(t);y&&(y.minzoom===a&&y.maxzoom===p||(a!=null&&(y.minzoom=a),p!=null&&(y.maxzoom=p),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,a){this._checkLoaded();const p=this._checkLayer(t);p&&p.slot!==a&&(p.slot=a,this._updateLayer(p))}setFilter(t,a,p={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!r.bx(y.filter,a))return a==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(cn,`layers.${y.id}.filter`,a,{layerType:y.type},p)||(y.filter=r.dn(a),this._updateLayer(y)))}getFilter(t){const a=this._checkLayer(t);if(a)return r.dn(a.filter)}setLayoutProperty(t,a,p,y={}){this._checkLoaded();const b=this._checkLayer(t);if(b&&!r.bx(b.getLayoutProperty(a),p)){if(p!=null&&(!y||y.validate!==!1)&&Ru(b,et.call(no,{key:`layers.${t}.layout.${a}`,layerType:b.type,objectKey:a,value:p,styleSpec:r.a6,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(a,p),b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),this._updateLayer(b)}}setLayerProperty(t,a,p,y={}){this._checkLoaded();const b=this._checkLayer(t);b&&(a==="appearances"?(b.setAppearances(p),this._changes.setDirty()):b.isPaintProperty(a)?this.setPaintProperty(t,a,p,y):this.setLayoutProperty(t,a,p,y))}getLayoutProperty(t,a){const p=this._checkLayer(t);if(p)return p.getLayoutProperty(a)}setPaintProperty(t,a,p,y={}){this._checkLoaded();const b=this._checkLayer(t);if(!b||r.bx(b.getPaintProperty(a),p)||p!=null&&(!y||y.validate!==!1)&&Ru(b,Za.call(no,{key:`layers.${t}.paint.${a}`,layerType:b.type,objectKey:a,value:p,styleSpec:r.a6})))return;const T=b.setPaintProperty(a,p);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),T&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(t,a){const p=this._checkLayer(t);if(p)return p.getPaintProperty(a)}setFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:D,importId:L}=t.target,F=this.getFragmentStyle(L),j=F.getFeaturesetLayers(D);for(const{source:B,sourceLayer:$}of j)F.setFeatureState({id:t.id,source:B,sourceLayer:$},a)}else if("layerId"in t.target){const{layerId:D}=t.target,L=this.getLayer(D);this.setFeatureState({id:t.id,source:L.source,sourceLayer:L.sourceLayer},a)}return}const p=t.source,y=t.sourceLayer,b=this._checkSource(p);if(!b)return;const T=b.type;if(T==="geojson"&&y)return void this.fire(new r.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!y)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided.")));const R=this.getOwnSourceCaches(p);for(const D of R)D.setFeatureState(y,t.id,a)}removeFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:D,importId:L}=t.target,F=this.getFragmentStyle(L),j=F.getFeaturesetLayers(D);for(const{source:B,sourceLayer:$}of j)F.removeFeatureState({id:t.id,source:B,sourceLayer:$},a)}else if("layerId"in t.target){const{layerId:D}=t.target,L=this.getLayer(D);this.removeFeatureState({id:t.id,source:L.source,sourceLayer:L.sourceLayer},a)}return}const p=t.source,y=this._checkSource(p);if(!y)return;const b=y.type,T=b==="vector"?t.sourceLayer:void 0;if(b==="vector"&&!T)return void this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new r.y(new Error("A feature id is required to remove its specific state property.")));const R=this.getOwnSourceCaches(p);for(const D of R)D.removeFeatureState(T,t.id,a)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let b;if("featuresetId"in t.target){const{featuresetId:T,importId:R}=t.target,D=this.getFragmentStyle(R),L=D.getFeaturesetLayers(T);for(const{source:F,sourceLayer:j}of L){const B=D.getFeatureState({id:t.id,source:F,sourceLayer:j});if(B&&!b)b=B;else if(!r.bx(b,B))return void this.fire(new r.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:T}=t.target,R=this.getLayer(T);b=this.getFeatureState({id:t.id,source:R.source,sourceLayer:R.sourceLayer})}return b}const a=t.source,p=t.sourceLayer,y=this._checkSource(a);if(y){if(y.type!=="vector"||p)return t.id===void 0&&this.fire(new r.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(p,t.id);this.fire(new r.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),a=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return r.du({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateFilteredLayers(t){for(const a of Object.values(this._mergedLayers))t(a)&&this._updateLayer(a)}_updateLayer(t){this._changes.updateLayer(t);const a=this.getLayerSourceCache(t),p=r.B(t.source,t.scope),y=this._changes.getUpdatedSourceCaches();t.source&&!y[p]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),a.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const a=R=>this._mergedLayers[R].is3D(!!this.terrain),p=this.order,y={},b=[];for(let R=p.length-1;R>=0;R--){const D=p[R];if(a(D)){y[D]=R;for(const L of t){const F=L[D];if(F)for(const j of F)b.push(j)}}}b.sort((R,D)=>D.intersectionZ-R.intersectionZ);const T=[];for(let R=p.length-1;R>=0;R--){const D=p[R];if(a(D))for(let L=b.length-1;L>=0;L--){const F=b[L].feature;if(F.layer&&y[F.layer.id]<R)break;T.push(F),b.pop()}else for(const L of t){const F=L[D];if(F)for(const j of F)T.push(j.feature)}}return T}queryRasterValue(t,a,p){const y=this.getOwnSource(t);return y?y.type!=="raster-array"?(this.fire(new r.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):y.queryRasterArrayValue(a,p):(this.fire(new r.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,a,p){let y;a&&!Array.isArray(a)&&a.filter&&(this._validate(cn,"queryRenderedFeatures.filter",a.filter,null,a),y=r.b5(a.filter));const b={},T=F=>{if(Vm.has(F.type))return;const j=this.getOwnLayerSourceCache(F),B=b[j.id]=b[j.id]||{sourceCache:j,layers:{},has3DLayers:!1};F.is3D(!!this.terrain)&&(B.has3DLayers=!0),B.layers[F.fqid]=B.layers[F.fqid]||{styleLayer:F,targets:[]},B.layers[F.fqid].targets.push({filter:y})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new r.y(new Error("parameters.layers must be an Array."))),[];for(const F of a.layers){const j=this._layers[F];if(!j)return this.fire(new r.y(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];T(j)}}else for(const F in this._layers)T(this._layers[F]);const R=this._queryRenderedFeatures(t,b,p),D=this._flattenAndSortRenderedFeatures(R),L=[];for(const F of D)r.dv(F.layer.id)===this.scope&&L.push(F);return L}queryRenderedFeatureset(t,a,p){let y;a&&!Array.isArray(a)&&a.filter&&(this._validate(cn,"queryRenderedFeatures.filter",a.filter,null,a),y=r.b5(a.filter));const b="mock",T=[];if(a&&a.target)T.push(Object.assign({},a,{targetId:b,filter:y}));else{const F=this.getFeaturesetDescriptors();for(const j of F)T.push({targetId:b,filter:y,target:j});for(const{style:j}of this.fragments){const B=j.getFeaturesetDescriptors();for(const $ of B)T.push({targetId:b,filter:y,target:$})}}const R=this.queryRenderedTargets(t,T,p),D=[],L=new Set;for(const F of R)for(const j of F.variants[b])Ko(j,F,L)||D.push(new r.dw(F,j));return D}queryRenderedTargets(t,a,p){const y={},b=(R,D,L,F)=>{const j=y[D.id]=y[D.id]||{sourceCache:D,layers:{},has3DLayers:!1};if(j.layers[R.fqid]=j.layers[R.fqid]||{styleLayer:R,targets:[]},R.is3D(!!this.terrain)&&(j.has3DLayers=!0),!F)return L.uniqueFeatureID=!1,void j.layers[R.fqid].targets.push(L);j.layers[R.fqid].targets.push(Object.assign({},L,{namespace:F.namespace,properties:F.properties,uniqueFeatureID:F.uniqueFeatureID}))};for(const R of a)if("featuresetId"in R.target){const{featuresetId:D,importId:L}=R.target,F=this.getFragmentStyle(L);if(!F||!F._featuresetSelectors)continue;const j=F._featuresetSelectors[D];if(!j){this.fire(new r.y(new Error(`The featureset '${D}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const B of j){const $=F.getOwnLayer(B.layerId);$&&!Vm.has($.type)&&b($,F.getOwnLayerSourceCache($),R,B)}}else if("layerId"in R.target){const{layerId:D}=R.target,L=this.getLayer(D);if(!L||Vm.has(L.type))continue;b(L,this.getLayerSourceCache(L),R)}const T=this._queryRenderedFeatures(t,y,p);return this._flattenAndSortRenderedFeatures(T)}_queryRenderedFeatures(t,a,p){const y=[],b=!!this.map._showQueryGeometry,T=er.createFromScreenPoints(t,p);for(const R in a){const D=bs(T,a[R],this._availableImages,p,b);Object.keys(D).length&&y.push(D)}if(this.placement)for(const R in a){if(!a[R].sourceCache._onlySymbols)continue;const D=Rc(T.screenGeometry,a[R],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(D).length&&y.push(D)}return y}querySourceFeatures(t,a){const p=a&&a.filter;p&&this._validate(cn,"querySourceFeatures.filter",p,null,a);let y=[];const b=this.getOwnSourceCaches(t);for(const T of b)y=y.concat(ch(T,a));return y}addSourceType(t,a,p){return Fl.getSourceType(t)?p(new Error(`A source type called "${t}" already exists.`)):(Fl.setSourceType(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,a,p={}){this._checkLoaded();const y=this.light.getLight();let b=!1;for(const R in t)if(!r.bx(t[R],y[R])){b=!0;break}if(!b)return;const T=this._getTransitionParameters();this.light.setLight(t,a,p),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,a=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=t;const y=t.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const R="terrain-dem-src";this.addSource(R,p.source),p=r.dn(p),p=Object.assign(p,{source:R})}const b=Object.assign({},p),T={};if(this.terrain&&y){b.source=this.terrain.get().source;const R=this.terrain?this.getFragmentStyle(this.terrain.scope):null;R&&(T.style=R.serialize())}if(this._validate(Ks,"terrain",b,T))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&a!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,a),this.fire(new r.z("data",{dataType:"style"}))}else{const b=this.terrain,T=b.get();for(const R of Object.keys(r.a6.terrain))!p.hasOwnProperty(R)&&r.a6.terrain[R].default&&(p[R]=r.a6.terrain[R].default);for(const R in t)if(!r.bx(t[R],T[R])){b.set(t,this.options),this.stylesheet.terrain=t;const D=this._getTransitionParameters({duration:0});b.updateTransitions(D),this.fire(new r.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const a=this.fog=new Yt(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}_createSnow(t){const a=this.snow=new Ta(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}_createRain(t){const a=this.rain=new oa(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!r.bx(a.get(),t)){a.set(t,this.options),this.stylesheet.fog=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!r.bx(a.get(),t)){a.set(t,this.options),this.stylesheet.snow=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!r.bx(a.get(),t)){a.set(t,this.options),this.stylesheet.rain=a.get();const p=this._getTransitionParameters({duration:0});a.updateTransitions(p)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void t();const p=this._evaluateColorThemeData(a);this._loadColorTheme(p).then(()=>{this.fire(new r.z("colorthemeset")),t()}).catch(y=>{r.w(`Couldn't set color theme: ${y}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&r.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,a){const p=this.getFragmentStyle(t);p&&(p._styleColorTheme.colorThemeOverride=a,p._reloadColorTheme())}_getTransitionParameters(t){return{now:r.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],a=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?t.push(p):a.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...a)}_createTerrain(t,a){const p=this.terrain=new Me(t,a,this.scope,this.options,this.map.getWorldview());a===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});p.updateTransitions(y)}_force3DLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="symbol"&&this._updateLayer(a)}}_validate(t,a,p,y,b={}){if(b&&b.validate===!1)return!1;const T=Object.assign({},this.serialize());return Ru(this,t.call(no,Object.assign({key:a,style:T,value:p,styleSpec:r.a6},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.dx.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const a=this.getSourceCaches(t);for(const p of a)p.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const a=this._mergedLayers[t];a._clear&&a._clear()}}reloadSource(t){const a=this.getSourceCaches(t);for(const p of a)p.resume(),p.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let a;this.directionalLight&&(a=Qv(this.directionalLight));const p=new Set;for(const y in this._mergedLayers){const b=this._mergedLayers[y];b.hasElevation()&&!p.has(b.source)&&p.add(b.source)}for(const y in this._mergedSourceCaches){const b=this._mergedSourceCaches[y],T=p.has(b._source.id);b.update(t,void 0,void 0,a,T)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const a=this._sourceCaches[t];a.resume(),a.reload()}}_updatePlacement(t,a,p,y,b,T,R=!1){let D=!1,L=!1;const F={},j={};for(const B of this._mergedOrder){const $=this._mergedLayers[B];if($.type!=="symbol")continue;const Z=r.B($.source,$.scope);let Q=F[Z];if(!Q){const te=this.getLayerSourceCache($);if(!te)continue;const se=te.getRenderableIds(!0).map(me=>te.getTileByID(me));j[Z]=se.slice(),Q=F[Z]=se.sort((me,ce)=>ce.tileID.overscaledZ-me.tileID.overscaledZ||(me.tileID.isLessThan(ce.tileID)?-1:1))}const re=this.crossTileSymbolIndex.addLayer($,Q,a.center.lng,a.projection);D=D||re}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),R=R||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new r.z("neworder")),(R||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.o.now(),a.zoom))&&(this.pauseablePlacement=new oo(a,this._mergedOrder,R,p,y,b,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,F,j,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.o.now()),L=!0),D&&this.pauseablePlacement.placement.setStale()),L||D){this._buildingIndex.onNewFrame(a.zoom);for(let B=0;B<this._mergedOrder.length;B++){const $=this._mergedLayers[this._mergedOrder[B]];if($.type!=="symbol")continue;const Z=this.isLayerClipped($);this.placement.updateLayerOpacities($,F[r.B($.source,$.scope)],B,Z?T:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,a){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:b})=>b===t.id)!==-1)return void this.fire(new r.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!a)return p.push(t),this._loadImports([t],!0);const y=p.findIndex(({id:b})=>b===a);return y===-1&&this.fire(new r.y(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,y).concat(t).concat(p.slice(y)),this._loadImports([t],!0,a)}updateImport(t,a){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(t);return y===-1?this:typeof a=="string"?(this.setImportUrl(t,a),this):(a.url&&a.url!==p[y].url&&this.setImportUrl(t,a.url),r.bx(a.config,p[y].config)||this.setImportConfig(t,a.config,a.data.schema),r.bx(a.data,p[y].data)||this.setImportData(t,a.data),this)}moveImport(t,a){this._checkLoaded();let p=this.stylesheet.imports||[];const y=this.getImportIndex(t);if(y===-1)return this;const b=this.getImportIndex(a);if(b===-1)return this;const T=p[y],R=this.fragments[y];return p=p.filter(({id:D})=>D!==t),this.fragments=this.fragments.filter(({id:D})=>D!==t),this.stylesheet.imports=p.slice(0,b).concat(T).concat(p.slice(b)),this.fragments=this.fragments.slice(0,b).concat(R).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(t,a){this._checkLoaded();const p=this.stylesheet.imports||[],y=this.getImportIndex(t);if(y===-1)return this;p[y].url=a;const b=this.fragments[y];return b.style=this._createFragmentStyle(p[y]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(a),this}setImportData(t,a){this._checkLoaded();const p=this.getImportIndex(t),y=this.stylesheet.imports||[];return p===-1?this:a?(this.fragments[p].style.setState(a),this._reloadImports(),this):(delete y[p].data,this.setImportUrl(t,y[p].url))}setImportConfig(t,a,p){this._checkLoaded();const y=this.getImportIndex(t),b=this.stylesheet.imports||[];if(y===-1)return this;a?b[y].config=a:delete b[y].config;const T=this.fragments[y];p&&T.style.stylesheet&&(T.style.stylesheet.schema=p);const R=T.style.stylesheet&&T.style.stylesheet.schema;return T.config=a,T.style.updateConfig(a,R),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const a=this.stylesheet.imports||[],p=this.getImportIndex(t);p!==-1&&(a.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(t){const a=(this.stylesheet.imports||[]).findIndex(p=>p.id===t);return a===-1&&this.fire(new r.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),a}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const a in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[a];p&&t.push(p.getSource())}return t}getSource(t,a){const p=this.getSourceCache(t,a);return p&&p.getSource()}getLayerSource(t){const a=this.getLayerSourceCache(t);return a&&a.getSource()}getSourceCache(t,a){const p=r.B(t,a);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(t){const a=r.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[t]&&a.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&a.push(this._mergedSymbolSourceCaches[t]),a}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const a in t){const p=t[a];p==="reload"?this.reloadSource(a):p==="clear"&&this.clearSource(a)}}updateLayers(t){const a=this._changes.getUpdatedPaintProperties();for(const p of a){const y=this.getLayer(p);y&&y.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,a,p){this.imageManager.getImages(a.images,a.scope,p),this._updateTilesForChangedImages();const y=T=>{if(T){const R=a.images.map(D=>r.I.toString(D));T.setDependencies(a.tileID.key,a.type,R)}},b=r.B(a.source,a.scope);y(this._mergedOtherSourceCaches[b]),y(this._mergedSymbolSourceCaches[b]),a.images.some(T=>T.iconsetId)&&this.fire(new r.z("data",{dataType:"style"}))}rasterizeImages(t,a,p){this.imageManager.rasterizeImages(a,p)}getGlyphs(t,a,p){this.glyphManager.getGlyphs(a.stacks,p)}getResource(t,a,p){return r.dy(a,p)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const a=[];return this._otherSourceCaches[t]&&a.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&a.push(this._symbolSourceCaches[t]),a}_isSourceCacheLoaded(t){const a=this.getOwnSourceCaches(t);return a.length===0?(this.fire(new r.y(new Error(`There is no source with ID '${t}'`))),!1):a.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,a){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const p=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),y=t.type==="building";if(t.is3D(!!this.terrain)){if(p||y||a&&a.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Fl.getSourceType=function(f){return as[f]},Fl.setSourceType=function(f,t){as[f]=t},Fl.registerForPluginStateChange=r.dz;class mh extends r.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},r.aX(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[a,p]of Object.entries(t.buildings))if(this._buildings[a])for(const y of p.floorIds)this._buildings[a].floors[y]||(this._buildings[a].floors[y]=p.floors[y]);else this._buildings[a]=p;for(const a of t.activeFloors)this._activeFloors.add(a);this._updateIndoorSelector()}getIndoorTileOptions(t,a){const p=this._style.getIndoorSourceLayers(t,a);return p&&this._indoorState?{sourceLayers:p,indoorState:this._indoorState}:null}_updateUI(t,a,p){const y=function(b,T,R,D){let L=null,F=Number.MAX_SAFE_INTEGER;if(D<16)return null;for(const[j,B]of Object.entries(b)){const $=B.center;if($){const Z=T.distanceTo(r.aS.convert($));Z<F&&R.contains($)&&(F=Z,L=j)}}return L}(this._buildings,a,p,t);y!==this._closestBuildingId&&(this._closestBuildingId=y,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,a=this._closestBuildingId,p=a&&t?t[a]:void 0;if(!p)return void this.fire(new r.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let y=null;for(const T of p.floorIds)if(this._activeFloors&&this._activeFloors.has(T)){y=T;break}const b=Array.from(p.floorIds).map(T=>({id:T,name:p.floors[T].name,zIndex:p.floors[T].zIndex})).sort((T,R)=>R.zIndex-T.zIndex);this.fire(new r.z("selector-update",{selectedFloorId:y,activeFloorsVisible:this._activeFloorsVisible,floors:b}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var bp=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,jm=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,cs=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,pd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Jd=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,G_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Gm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,bl=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Hm=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Lt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,wp=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Lc=[];el(bp,Lc),el(cs,Lc),el(jm,Lc);const Qd={"_prelude_fog.vertex.glsl":G_,"_prelude_terrain.vertex.glsl":Jd,"_prelude_shadow.vertex.glsl":Lt,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Gm,"_prelude_shadow.fragment.glsl":wp,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":bl,"_prelude_raster_particle.glsl":Hm},Iu={};vn("",Jd),vn(Gm,G_),vn(wp,Lt),vn(bl,""),vn(Hm,"");const Tp=vn(jm,cs),zc=bp;var $m={background:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:vn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:vn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:vn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:vn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:vn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:vn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:vn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:vn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:vn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:vn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:vn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:vn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:vn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:vn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:vn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:vn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:vn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:vn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:vn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:vn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,pd),skyboxGradient:vn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,pd),skyboxCapture:vn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:vn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:vn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:vn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:vn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:vn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:vn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:vn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:vn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function el(f,t){const a=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of a)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=p.split(" ");for(const b of y)t.includes(b)||t.push(b)}}function vn(f,t){const a=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,y={},b=[],T=[];if(f=f.replace(a,(D,L)=>(T.push(L),"")),(t=t.replace(a,(D,L)=>(b.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let R=[...Lc];el(f,R),el(t,R);for(const D of[...b,...T])Qd[D]||console.error(`Undefined include: ${D}`),Iu[D]||(Iu[D]=[],el(Qd[D],Iu[D])),R=[...R,...Iu[D]];return{fragmentSource:f=f.replace(p,(D,L,F,j,B)=>(y[B]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${B}
in ${F} ${j} ${B};
#else
uniform ${F} ${j} u_${B};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${B}
    ${F} ${j} ${B} = u_${B};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${F} ${j} ${B};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(p,(D,L,F,j,B)=>{const $=`MATERIAL_ATTRIBUTE_OFFSET_${B}`,Z=j==="float"?"vec2":j,Q=`GET_ATTRIBUTE_${Z}(a_${B}, materialInfo, ${$})`,re=B.match(/color/)?"color":Z;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${B}
in ${F} ${j} a_${B};
#endif
`:y[B]?L==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
    #if !defined(${$})
        in ${F} ${Z} a_${B};
    #endif
out ${F} ${j} ${B};
#else
uniform ${F} ${j} u_${B};
#endif
`:L==="initialize"?re==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${F} ${j} ${B} = u_${B};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${B}) 
    #ifdef ${$}
        ${B} = unpack_mix_${re}(${Q}, u_${B}_t);
    #else
        ${B} = unpack_mix_${re}(a_${B}, u_${B}_t);
    #endif
#else
    ${F} ${j} ${B} = u_${B};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    in ${F} ${j} a_${B};
    out ${F} ${j} ${B};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${B} = a_${B};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
    #if !defined(${$})
        in ${F} ${Z} a_${B};
    #endif  
#else
uniform ${F} ${j} u_${B};
#endif
`:L==="define-instanced"?re==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${B}0;
in vec4 a_${B}1;
in vec4 a_${B}2;
in vec4 a_${B}3;
#else
uniform ${F} ${j} u_${B};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${Z} a_${B};
#else
uniform ${F} ${j} u_${B};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${B}
    ${F} ${j} ${B} = a_${B};
#endif
`:re==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    #ifdef ${$}
        ${F} ${j} ${B} = ${Q};
    #else
        ${F} ${j} ${B} = a_${B};
    #endif
#else
    ${F} ${j} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    #ifdef ${$}
        ${F} ${j} ${B} = unpack_mix_${re}(${Q}, u_${B}_t);
    #else
        ${F} ${j} ${B} = unpack_mix_${re}(a_${B}, u_${B}_t);
    #endif
#else
    ${F} ${j} ${B} = u_${B};
#endif
`}),usedDefines:R,vertexIncludes:b,fragmentIncludes:T}}class cc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,a,p,y,b,T,R,D){this.context=t;let L=this.boundPaintVertexBuffers.length!==y.length;for(let j=0;!L&&j<y.length;j++)this.boundPaintVertexBuffers[j]!==y[j]&&(L=!0);let F=this.boundDynamicVertexBuffers.length!==R.length;for(let j=0;!F&&j<R.length;j++)this.boundDynamicVertexBuffers[j]!==R[j]&&(F=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==p||L||F||this.boundIndexBuffer!==b||this.boundVertexOffset!==T)this.freshBind(a,p,y,b,T,R,D);else{t.bindVertexArrayOES.set(this.vao);for(const j of R)j&&(j.bind(),D&&j.instanceCount&&j.setVertexAttribDivisor(t.gl,a,D));b&&b.dynamicDraw&&b.bind()}}freshBind(t,a,p,y,b,T,R){const D=this.context,L=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=T,a.enableAttributes(L,t),a.bind(),a.setVertexAttribPointers(L,t,b);for(const F of p)F.enableAttributes(L,t),F.bind(),F.setVertexAttribPointers(L,t,b);for(const F of T)F&&(F.enableAttributes(L,t),F.bind(),F.setVertexAttribPointers(L,t,b),R&&F.instanceCount&&F.setVertexAttribDivisor(L,t,R));y&&y.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ef(f,t){const a=Math.pow(2,t.canonical.z),p=t.canonical.y;return[new r.ae(0,p/a).toLngLat().lat,new r.ae(0,(p+1)/a).toLngLat().lat]}function tx(f,t,a,p,y,b,T){const R=f.context,D=R.gl,L=a.hillshadeFBO;if(!L)return;f.prepareDrawTile();const F=f.isTileAffectedByFog(t),j=f.getOrCreateProgram("hillshade",{overrideFog:F});R.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,L.colorAttachment.get());const B=((re,te,se,me)=>{const ce=se.paint.get("hillshade-shadow-color"),Ae=se.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",_e=se.paint.get("hillshade-highlight-color"),Ie=se.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Ce=se.paint.get("hillshade-accent-color"),Te=se.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",De=se.paint.get("hillshade-emissive-strength");let Ge=r.an(se.paint.get("hillshade-illumination-direction"));if(se.paint.get("hillshade-illumination-anchor")==="viewport")Ge-=re.transform.angle;else if(re.style&&re.style.enable3dLights()&&re.style.directionalLight){const nt=re.style.directionalLight.properties.get("direction"),Ke=r.d3(nt.x,nt.y,nt.z);Ge=r.an(Ke[1])}const Ue=!re.options.moving;return{u_matrix:me||re.transform.calculateProjMatrix(te.tileID.toUnwrapped(),Ue),u_image:0,u_latrange:ef(0,te.tileID),u_light:[se.paint.get("hillshade-exaggeration"),Ge],u_shadow:ce.toPremultipliedRenderColor(Ae?null:se.lut),u_highlight:_e.toPremultipliedRenderColor(Ie?null:se.lut),u_emissive_strength:De,u_accent:Ce.toPremultipliedRenderColor(Te?null:se.lut)}})(f,a,p,f.terrain?t.projMatrix:null);f.uploadCommonUniforms(R,j,t.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:Z,tileBoundsSegments:Q}=f.getTileBoundsBuffers(a);j.draw(f,D.TRIANGLES,y,b,T,Ni.disabled,B,p.id,$,Z,Q)}function Wm(f,t,a){if(!t.needsDEMTextureUpload)return;const p=f.context,y=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||f.getTileTexture(a.stride);const b=a.getPixels();t.demTexture?t.demTexture.update(b,{premultiply:!1}):t.demTexture=new r.T(p,b,y.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function ix(f,t,a){const p=f.context,y=p.gl;if(!t.dem)return;const b=t.dem;if(p.activeTexture.set(y.TEXTURE1),Wm(f,t,b),!t.demTexture)return;t.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const T=b.dim;p.activeTexture.set(y.TEXTURE0);let R=t.hillshadeFBO;if(!R){const B=new r.T(p,{width:T,height:T,data:null},y.RGBA8);B.bind(y.LINEAR,y.CLAMP_TO_EDGE),R=t.hillshadeFBO=p.createFramebuffer(T,T,!0,"renderbuffer"),R.colorAttachment.set(B.texture)}p.bindFramebuffer.set(R.framebuffer),p.viewport.set([0,0,T,T]);const{tileBoundsBuffer:D,tileBoundsIndexBuffer:L,tileBoundsSegments:F}=f.getMercatorTileBoundsBuffers(),j=[];f.linearFloatFilteringSupported()&&j.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:j}).draw(f,y.TRIANGLES,pi.disabled,Hi.disabled,an.unblended,Ni.disabled,((B,$)=>{const Z=$.stride,Q=r.bB();return r.cd(Q,0,r.al,-r.al,0,0,1),r.bq(Q,Q,[0,-r.al,0]),{u_matrix:Q,u_image:1,u_dimension:[Z,Z],u_zoom:B.overscaledZ}})(t.tileID,b),a.id,D,L,F),t.needsHillshadePrepare=!1}class Jr{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class H_ extends Jr{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class qm extends Jr{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class nx extends Jr{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class $_ extends Jr{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Lb extends Jr{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class rx extends Jr{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class ax extends Jr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class zb extends Jr{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Zm extends Jr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class Sp extends Jr{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Xm extends Jr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class md extends Jr{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ep extends Jr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Ym extends Jr{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Du extends Jr{getDefault(){return r.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class tf extends Jr{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Fc extends Jr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Mu extends Jr{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Cp extends Jr{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Ap=class extends Jr{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class ox extends Jr{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class gh extends Jr{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Km extends Jr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Jm extends Jr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class W_ extends Jr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class nf extends Jr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Nc extends Jr{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class sx extends Jr{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class lx extends Jr{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Mn extends Jr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class uc extends Jr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class so extends Jr{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Qr extends so{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class _h extends so{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Rp extends so{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Qm extends _h{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Hr=(f,t,a)=>({u_matrix:f,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:a}),Nl=(f,t,a,p,y,b,T,R,D,L,F,j,B,$,Z,Q)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:a,u_zoom_transition:y,u_merc_center:b,u_image0:0,u_frustum_tl:T,u_frustum_tr:R,u_frustum_br:D,u_frustum_bl:L,u_globe_pos:F,u_globe_radius:j,u_viewport:B,u_grid_matrix:Q?Float32Array.from(Q):new Float32Array(9),u_skirt_height:$,u_far_z_cutoff:Z});function Bc(f,t){return f!=null&&t!=null&&!(!f.hasData()||!t.hasData())&&f.demTexture!=null&&t.demTexture!=null&&f.tileID.key!==t.tileID.key}const Bl=new class{constructor(){this.operations={}}newMorphing(f,t,a,p,y){if(f in this.operations){const b=this.operations[f];b.to.tileID.key!==a.tileID.key&&(b.queued=a)}else this.operations[f]={startTime:p,phase:0,duration:y,from:t,to:a,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const t=this.operations[f];return{from:t.from,to:t.to,phase:t.phase}}update(f){for(const t in this.operations){const a=this.operations[t];for(a.phase=(f-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,f)){delete this.operations[t];break}}}_nextOp(f,t){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=t,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Uc={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Vc(f,t,a){if(t===0)return 0;const p=t<1&&a===514?.25/t:1;return 6*Math.pow(1.5,22-f)*Math.max(t,1)*p}function hc(f,t){const a=1<<f.z;return!t&&(f.x===0||f.x===a-1)||f.y===0||f.y===a-1}const Pu=f=>({u_matrix:f});function eg(f,t,a,p,y){if(y>0){const b=r.o.now(),T=(b-f.timeAdded)/y,R=t?(b-t.timeAdded)/y:-1,D=a.getSource(),L=p.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),F=!t||Math.abs(t.tileID.overscaledZ-L)>Math.abs(f.tileID.overscaledZ-L),j=F&&f.refreshedUponExpiration?1:r.aA(F?T:1-R,0,1);return t?{opacity:1,mix:1-j,isFading:T<1}:{opacity:j,mix:0,isFading:T<1}}return{opacity:1,mix:0,isFading:!1}}class Ts extends Ha{constructor(t){const a=Po("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",a,!1),a.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,a){t.state="loaded",a(null)}}class us extends Ha{constructor(t){const a=Po("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,a,p){if(t.freezeTileCoverage)return;this.transform=t;const y=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const R=new Ba(T,this._source.tileSize*T.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);R.state="loaded",this._tiles[T.key]=R}return b},{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(t){const a=this.proxyCachedFBO[t];if(a!==void 0){const p=Object.values(a);this.renderCachePool.push(...p),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class gd extends r.aP{constructor(t,a,p){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=a,this.projMatrix=p}}class rf extends r.bU{constructor(t,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,y,b]=function(D){const L=new r.bc,F=new r.b0,j=131;L.reserve(17161),F.reserve(33800);const B=r.al/128,$=r.al+B/2,Z=$+B;for(let re=-B;re<Z;re+=B)for(let te=-B;te<Z;te+=B){const se=te<0||te>$||re<0||re>$?24575:0,me=r.aA(Math.round(te),0,r.al),ce=r.aA(Math.round(re),0,r.al);L.emplaceBack(me+se,ce)}const Q=(re,te)=>{const se=te*j+re;F.emplaceBack(se+1,se,se+j),F.emplaceBack(se+j,se+j+1,se+1)};for(let re=1;re<129;re++)for(let te=1;te<129;te++)Q(te,re);return[0,129].forEach(re=>{for(let te=0;te<130;te++)Q(te,re),Q(re,te)}),[L,F,32768]}(),T=t.context;this.gridBuffer=T.createVertexBuffer(p,r.be.members),this.gridIndexBuffer=T.createIndexBuffer(y),this.gridSegments=r.bf.simpleSegment(0,0,p.length,y.length),this.gridNoSkirtSegments=r.bf.simpleSegment(0,0,p.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new us(a.map),this.orthoMatrix=r.bB(),r.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.al,0,r.al,0,1);const R=T.gl;this._overlapStencilMode=new Hi({func:R.GEQUAL,mask:255},0,255,R.KEEP,R.KEEP,R.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ts(a.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,a,p){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const y=t.terrain.properties,b=t.terrain.drapeRenderMode===0,T=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.o.now();const R=t.terrain&&t.terrain.scope,D=y.get("source"),L=b?this._mockSourceCache:t.getSourceCache(D,R);if(!L)return void r.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=L,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=T?this.calculateExaggeration(a):y.get("exaggeration"),!a.projection.requiresDraping&&T&&this._exaggeration===0)return void this._disable();this.enabled=!0;const F=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const j=this.getScaledDemTileSize();this.sourceCache.update(a,j,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,F(),this._initializing=!0),F(),a.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const a=this._previousCameraAltitude,p=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=p;const y=a!=null?p-a:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const b=t.zoom,T=this._style.terrain;if(!this._previousUpdateTimestamp)return T.getExaggeration(b);let R=b-this._previousZoom;const D=this._previousUpdateTimestamp;let L=b;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(b-L)>.5&&(R=.5*(b-L+R)),R*y<0&&(L+=R)),this._evaluationZoom=L;const F=T.getExaggeration(L),j=F===T.getExaggeration(Math.max(0,L-.1));if(j&&Math.abs(F-this._exaggeration)<.01)return F;let B=Math.min(.1,.00375*(this._updateTimestamp-D));return(j||F<.1||Math.abs(R)<1e-4)&&(B=Math.min(.2,4*B)),r.ak(this._exaggeration,F,B)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(r.ae.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=a.getIds().map(D=>{const L=a.getTileByID(D).tileID;return L.projMatrix=p.calculateProjMatrix(L.toUnwrapped()),L});(function(D,L){const F=L.transform.pointCoordinate(L.transform.getCameraPoint()),j=new r.P(F.x,F.y);D.sort((B,$)=>{if($.overscaledZ-B.overscaledZ)return $.overscaledZ-B.overscaledZ;const Z=new r.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),Q=new r.P($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),re=j.mult(1<<B.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(Z)-re.distSqr(Q)})})(y,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},y.forEach(D=>{this.proxyToSource[D.key]={}}),this.terrainTileForTile={};const T=this._style._mergedSourceCaches;for(const D in T){const L=T[D];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,t[D],b),L.usedForTerrain))continue;const F=t[D];L.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[a.id]=y.map(D=>new gd(D,D.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const R={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const L=this.terrainTileForTile[D.key];if(!L)continue;const F=L.tileID.key;F in R||(this._visibleDemTiles.push(L),R[F]=F)}}_assignTerrainTiles(t){this._initializing||t.forEach(a=>{if(this.terrainTileForTile[a.key])return;const p=this._findTileCoveringTileID(a,this.sourceCache);p&&(this.terrainTileForTile[a.key]=p)})}_prepareDEMTextures(){const t=this.painter.context,a=t.gl;for(const p in this.terrainTileForTile){const y=this.terrainTileForTile[p],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(t.activeTexture.set(a.TEXTURE1),Wm(this.painter,y,b))}}_prepareDemTileUniforms(t,a,p,y){if(!a||a.demTexture==null)return!1;const b=t.tileID.canonical,T=Math.pow(2,a.tileID.canonical.z-b.z),R=y||"";return p[`u_dem_tl${R}`]=[b.x*T%1,b.y*T%1],p[`u_dem_scale${R}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const a=this._visibleDemTiles.reduce((p,y)=>{if(!y.dem)return p;const b=y.dem.tree.minimums[0];return b>0&&t++,p+b},0);return t?a/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,a=t.gl;t.activeTexture.set(a.TEXTURE2);const p=this._getLoadedAreaMinimum(),y=new r.dK({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new r.T(t,y,a.R32F,{premultiply:!1}),b}setupElevationDraw(t,a,p){const y=this.painter.context,b=y.gl,T={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};T.u_exaggeration=this.exaggeration();let R=null,D=null,L=1;if(p&&p.morphing&&this._useVertexMorphing){const $=p.morphing.srcDemTile,Z=p.morphing.dstDemTile;L=p.morphing.phase,$&&Z&&(this._prepareDemTileUniforms(t,$,T,"_prev")&&(D=$),this._prepareDemTileUniforms(t,Z,T)&&(R=Z))}const F=$=>$&&$.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let j=null;var B;if(this.enabled?D&&R?(j=R.demTexture,y.activeTexture.set(b.TEXTURE4),D.demTexture.bind(F(D),b.CLAMP_TO_EDGE),T.u_dem_lerp=L):(R=this.terrainTileForTile[t.tileID.key],j=this._prepareDemTileUniforms(t,R,T)?R.demTexture:this.emptyDEMTexture):j=this.emptyDEMTexture,y.activeTexture.set(b.TEXTURE2),j&&(T.u_dem_size=(B=j).size[0]===1?1:B.size[0]-2,j.bind(F(R),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,a,T),p&&p.useMeterToDem&&R){const $=(1<<R.tileID.canonical.z)*r.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=$}if(p&&p.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),a.setTerrainUniformValues(y,T),this.painter.transform.projection.name==="globe"){const $=this.globeUniformValues(this.painter.transform,t.tileID.canonical,p&&p.useDenormalizedUpVectorScale);a.setGlobeUniformValues(y,$)}}globeUniformValues(t,a,p){const y=t.projection;return{u_tile_tl_up:y.upVector(a,0,0),u_tile_tr_up:y.upVector(a,r.al,0),u_tile_br_up:y.upVector(a,r.al,r.al),u_tile_bl_up:y.upVector(a,0,r.al),u_tile_up_scale:p?r.dL(1):y.upVectorScale(a,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const a=this.painter,p=this.painter.context;t.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,b,T,R,D){if(y.transform.projection.name==="globe")(function(L,F,j,B,$){const Z=L.context,Q=Z.gl;let re,te;const se=L.transform,me=r.dD(L,Z,se),ce=(nt,Ke)=>{if(te===Ke)return;const st=[Uc[Ke],"PROJECTION_GLOBE_VIEW"];me&&st.push("CUSTOM_ANTIALIASING");const Pt=L.isTileAffectedByFog(nt);re=L.getOrCreateProgram("globeRaster",{defines:st,overrideFog:Pt}),te=Ke},Ae=L.colorModeForRenderPass(),_e=new pi(Q.LEQUAL,pi.ReadWrite,L.depthRangeFor3D);Bl.update($);const Ie=r.dE(se),Ce=[r.aF(se.center.lng),r.aJ(se.center.lat)],Te=L.globeSharedBuffers,De=[se.width*r.o.devicePixelRatio,se.height*r.o.devicePixelRatio],Ge=Float32Array.from(se.globeMatrix),Ue={useDenormalizedUpVectorScale:!0};{const nt=L.transform,Ke=Vc(nt.zoom,F.exaggeration(),F.sourceCache._source.tileSize);te=-1;const st=Q.TRIANGLES;for(const Pt of B){const Ze=j.getTile(Pt),ze=Hi.disabled,lt=F.prevTerrainTileForTile[Pt.key],Je=F.terrainTileForTile[Pt.key];Bc(lt,Je)&&Bl.newMorphing(Pt.key,lt,Je,$,250),Z.activeTexture.set(Q.TEXTURE0),Ze.texture&&Ze.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const bt=Bl.getMorphValuesForProxy(Pt.key),Ft=bt?1:0;bt&&Object.assign(Ue,{morphing:{srcDemTile:bt.from,dstDemTile:bt.to,phase:r.dC(bt.phase)}});const ci=r.dF(Pt.canonical),Mt=r.dG(ci.getCenter().lat),Ot=r.dH(Pt.canonical,ci,Mt,nt.worldSize/nt._pixelsPerMercatorPixel),di=r.bj(r.dI(Pt.canonical)),ei=Nl(nt.expandedFarZProjMatrix,Ge,Ie,di,r.aj(nt.zoom),Ce,nt.frustumCorners.TL,nt.frustumCorners.TR,nt.frustumCorners.BR,nt.frustumCorners.BL,nt.globeCenterInViewSpace,nt.globeRadius,De,Ke,nt._farZ,Ot);if(ce(Pt,Ft),re&&(F.setupElevationDraw(Ze,re,Ue),L.uploadCommonUniforms(Z,re,Pt.toUnwrapped()),Te)){const[Jt,ti,Ii]=Te.getGridBuffers(Mt,Ke!==0);re.draw(L,st,_e,ze,Ae,Ni.backCCW,ei,"globe_raster",Jt,ti,Ii)}}}if(Te&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const nt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];me&&nt.push("CUSTOM_ANTIALIASING"),re=L.getOrCreateProgram("globeRaster",{defines:nt});for(const Ke of B){const{x:st,y:Pt,z:Ze}=Ke.canonical,ze=Pt===0,lt=Pt===(1<<Ze)-1,[Je,bt,Ft,ci]=Te.getPoleBuffers(Ze,!1);if(ci&&(ze||lt)){const Mt=j.getTile(Ke);Z.activeTexture.set(Q.TEXTURE0),Mt.texture&&Mt.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let Ot=r.dJ(Ze,st,se);const di=r.bj(r.dI(Ke.canonical)),ei=(Jt,ti)=>Jt.draw(L,Q.TRIANGLES,_e,Hi.disabled,Ae,Ni.disabled,Nl(se.expandedFarZProjMatrix,Ot,Ot,di,0,Ce,se.frustumCorners.TL,se.frustumCorners.TR,se.frustumCorners.BR,se.frustumCorners.BL,se.globeCenterInViewSpace,se.globeRadius,De,0,se._farZ),"globe_pole_raster",ti,Ft,ci);F.setupElevationDraw(Mt,re,Ue),L.uploadCommonUniforms(Z,re,Ke.toUnwrapped()),ze&&L.renderDefaultNorthPole&&ei(re,Je),lt&&L.renderDefaultSouthPole&&(Ot=r.cR(r.bB(),Ot,[1,-1,1]),ei(re,bt))}}}})(y,b,T,R,D);else{const L=y.context,F=L.gl;let j,B;const $=y.shadowRenderer,Z=Cu(y,y.longestCutoffRange),Q=Ae=>{if(B===Ae)return;const _e=[];_e.push(Uc[Ae]),Z.shouldRenderCutoff&&_e.push("RENDER_CUTOFF"),$&&(_e.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$.useNormalOffset&&_e.push("NORMAL_OFFSET")),j=y.getOrCreateProgram("terrainRaster",{defines:_e}),B=Ae},re=y.colorModeForRenderPass(),te=new pi(F.LEQUAL,pi.ReadWrite,y.depthRangeFor3D);Bl.update(D);const se=y.transform,me=Vc(se.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let ce=[0,0,0];if($){const Ae=y.style.directionalLight,_e=y.style.ambientLight;Ae&&_e&&(ce=xl(y.style,Ae,_e))}{B=-1;const Ae=F.TRIANGLES,[_e,Ie]=[b.gridIndexBuffer,b.gridSegments];for(const Ce of R){const Te=T.getTile(Ce),De=Hi.disabled,Ge=b.prevTerrainTileForTile[Ce.key],Ue=b.terrainTileForTile[Ce.key];Bc(Ge,Ue)&&Bl.newMorphing(Ce.key,Ge,Ue,D,250),L.activeTexture.set(F.TEXTURE0),Te.texture&&Te.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const nt=Bl.getMorphValuesForProxy(Ce.key),Ke=nt?1:0;let st;nt&&(st={morphing:{srcDemTile:nt.from,dstDemTile:nt.to,phase:r.dC(nt.phase)}});const Pt=Hr(Ce.projMatrix,hc(Ce.canonical,se.renderWorldCopies)?me/10:me,ce);if(Q(Ke),!j)continue;b.setupElevationDraw(Te,j,st);const Ze=Ce.toUnwrapped();$&&$.setupShadows(Ze,j),y.uploadCommonUniforms(L,j,Ze,null,Z),j.draw(y,Ae,te,De,re,Ni.backCCW,Pt,"terrain_raster",b.gridBuffer,_e,Ie)}}}}(a,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const a=this.painter,p=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],T=this._drapedRenderBatches.shift(),R=a.style.order,D=[];let L=0;for(const F of b){const j=y.getTileByID(F.proxyTileKey),B=y.proxyCachedFBO[F.key]?y.proxyCachedFBO[F.key][t]:void 0,$=B!==void 0?y.renderCache[B]:this.pool[L++],Z=B!==void 0;if(j.texture=$.tex,Z&&!$.dirty){D.push(j.tileID);continue}let Q;p.bindFramebuffer.set($.fb.framebuffer),this.renderedToTile=!1,$.dirty&&(p.clear({color:r.ao.transparent,stencil:0}),$.dirty=!1);for(let re=T.start;re<=T.end;++re){const te=a.style._mergedLayers[R[re]];if(te.isHidden(a.transform.zoom))continue;const se=a.style.getLayerSourceCache(te),me=se?this.proxyToSource[F.key][se.id]:[F];if(!me)continue;const ce=me;p.viewport.set([0,0,$.fb.width,$.fb.height]),Q!==(se?se.id:null)&&(this._setupStencil($,me,te,se),Q=se?se.id:null),a.renderLayer(a,se,te,ce)}if(this._drapedRenderBatches.length===0)for(const re of this._pendingGroundEffectLayers){const te=a.style._mergedLayers[R[re]];if(te.isHidden(a.transform.zoom))continue;const se=a.style.getLayerSourceCache(te),me=se?this.proxyToSource[F.key][se.id]:[F];if(!me)continue;const ce=me;p.viewport.set([0,0,$.fb.width,$.fb.height]),Q!==(se?se.id:null)&&(this._setupStencil($,me,te,se),Q=se?se.id:null),a.renderLayer(a,se,te,ce)}this.renderedToTile?($.dirty=!0,D.push(j.tileID)):Z||--L,L===5&&(L=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,a.width,a.height]),T.end+1}postRender(){}isLayerOrderingCorrect(t){const a=t.order.length;let p=-1,y=a;for(let b=0;b<a;++b)this._style.isLayerDraped(t._mergedLayers[t.order[b]])?p=Math.max(p,b):y=Math.min(y,b);return y>p}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{t=Math.min(t,a.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,a,p){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const T=b.tileID,R=1<<T.overscaledZ,{x:D,y:L}=T.canonical,F=D/R,j=(D+1)/R,B=L/R,$=(L+1)/R;return{minx:F,miny:B,maxx:j,maxy:$,t:b.dem.tree.raycastRoot(F,B,j,$,t,a,p),tile:b}});y.sort((b,T)=>(b.t!==null?b.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const b of y){if(b.t==null)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,t,a,p);if(T!=null)return T}return null}_createFBO(){const t=this.painter.context,a=t.gl,p=this.drapeBufferSize;t.activeTexture.set(a.TEXTURE0);const y=new r.T(t,{width:p[0],height:p[1],data:null},a.RGBA8);y.bind(a.LINEAR,a.CLAMP_TO_EDGE);const b=t.createFramebuffer(p[0],p[1],!0,null);return b.colorAttachment.set(y.texture),b.depthAttachment=new Qm(t,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:b,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const a=this._style._mergedLayers[t],p=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!p&&a.shouldRedrape():!p&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const p of this._style.getSources())if(p instanceof ro){t=!0;break}if(!t)return;const a={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(y);if(b&&!a[b.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof r.ad){a[b.id]=!0;for(const T of this.proxyCoords){const R=this.proxyToSource[T.key][b.id];if(R)for(const D of R)this._clearRenderCacheForTile(b.id,D)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof Ho){t=!0;break}if(!t)return;const a={};for(let p=0;p<this._style.order.length;++p){const y=this._style._mergedLayers[this._style.order[p]],b=this._style.getLayerSourceCache(y);if(!b||a[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const T=y.paint.get("raster-fade-duration");for(const R of this.proxyCoords){const D=this.proxyToSource[R.key][b.id];if(D)for(const L of D){const F=eg(b.getTile(L),b.findLoadedParent(L,0),b,this.painter.transform,T);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(b.id,L)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,a=t.length;if(a===0)return;const p=[];this._pendingGroundEffectLayers=[];let y,b=0,T=this._style._mergedLayers[t[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<a;)T=this._style._mergedLayers[t[b]];for(;b<a;++b){const R=this._style._mergedLayers[t[b]];R.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(R)?y===void 0&&(y=b):(R.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),y!==void 0&&(p.push({start:y,end:b-1}),y=void 0)))}if(y!==void 0&&p.push({start:y,end:b-1}),p.length!==0){const R=p[p.length-1];this._pendingGroundEffectLayers.every(D=>D>R.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(t){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const T=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let R=0;R<T.length;++R){const D=Object.values(T[R]);a.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,y=this._tilesDirty;for(let T=p.length-1;T>=0;T--){const R=p[T];if(a.getTileByID(R.key),a.proxyCachedFBO[R.key]!==void 0){const D=t[R.key],L=this.proxyToSource[R.key];let F=0;for(const j in L){const B=L[j],$=D[j];if(!$||$.length!==B.length||B.some((Z,Q)=>Z!==$[Q]||y[j]&&y[j].hasOwnProperty(Z.key))){F=-1;break}++F}for(const j in a.proxyCachedFBO[R.key])a.renderCache[a.proxyCachedFBO[R.key][j]].dirty=F<0||F!==Object.values(D).length}}const b=[...this._drapedRenderBatches];b.sort((T,R)=>R.end-R.start-(T.end-T.start));for(const T of b)for(const R of p){if(a.proxyCachedFBO[R.key])continue;let D=a.renderCachePool.pop();D===void 0&&a.renderCache.length<50&&(D=a.renderCache.length,a.renderCache.push(this._createFBO())),D!==void 0&&(a.proxyCachedFBO[R.key]={},a.proxyCachedFBO[R.key][T.start]=D,a.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(t,a,p,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let R;if(p.isTileClipped())R=a.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);R=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+R>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=R,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Hi.disabled}_renderTileClippingMasks(t,a){const p=this.painter,y=this.painter.context,b=y.gl;p._tileClippingMaskIDs={},y.setColorMode(an.disabled),y.setDepthMode(pi.disabled);const T=p.getOrCreateProgram("clippingMask");for(const R of t){const D=p._tileClippingMaskIDs[R.key]=--a;T.draw(p,b.TRIANGLES,pi.disabled,new Hi({func:b.ALWAYS,mask:0},D,255,b.KEEP,b.KEEP,b.REPLACE),an.disabled,Ni.disabled,Pu(R.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(t){const a=this.painter.transform;if(t.x<0||t.x>a.width||t.y<0||t.y>a.height)return null;const p=[t.x,t.y,1,1];r.aC(p,p,a.pixelMatrixInverse),r.cJ(p,p,1/p[3]),p[0]/=a.worldSize,p[1]/=a.worldSize;const y=a._camera.position,b=r.ce(1,a.center.lat),T=[y[0],y[1],y[2]/b,0],R=r.d9([],p.slice(0,3),T);r.aw(R,R);const D=this.raycast(T,R,this._exaggeration);return D!==null&&D?(r.bG(T,T,R,D),T[3]=T[2],T[2]*=b,T):null}_setupProxiedCoordsForOrtho(t,a,p){if(t.getSource()instanceof r.aT)return this._setupProxiedCoordsForImageSource(t,a,p);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const y=this.proxiedCoords[t.id]=[],b=this.proxyCoords;for(let D=0;D<b.length;D++){const L=b[D],F=this._findTileCoveringTileID(L,t);if(F){const j=this._createProxiedId(L,F,p[L.key]&&p[L.key][t.id]);y.push(j),this.proxyToSource[L.key][t.id]=[j]}}let T=!1;const R=new Set;for(let D=0;D<a.length;D++){const L=t.getTile(a[D]);if(!L||!L.hasData())continue;const F=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==L.tileID.canonical.z){const j=this.proxyToSource[F.tileID.key][t.id],B=this._createProxiedId(F.tileID,L,p[F.tileID.key]&&p[F.tileID.key][t.id]);j?j.splice(j.length-1,0,B):this.proxyToSource[F.tileID.key][t.id]=[B];const $=this.proxyToSource[F.tileID.key][t.id];R.has($)||R.add($),y.push(B),T=!0}}if(this._sourceTilesOverlap[t.id]=T,T&&this._debugParams.sortTilesHiZFirst)for(const D of R)D.sort((L,F)=>F.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(t,a,p){if(!t.getSource().loaded())return;const y=this.proxiedCoords[t.id]=[],b=this.proxyCoords,T=t.getSource(),R=T.tileID;if(!R)return;const D=new r.P(R.x,R.y)._div(1<<R.z),L=T.coordinates.map(r.ae.fromLngLat).reduce((j,B)=>(j.min.x=Math.min(j.min.x,B.x-D.x),j.min.y=Math.min(j.min.y,B.y-D.y),j.max.x=Math.max(j.max.x,B.x-D.x),j.max.y=Math.max(j.max.y,B.y-D.y),j),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(j,B)=>{const $=j.wrap+j.canonical.x/(1<<j.canonical.z),Z=j.canonical.y/(1<<j.canonical.z),Q=r.al/(1<<j.canonical.z),re=B.wrap+B.canonical.x/(1<<B.canonical.z),te=B.canonical.y/(1<<B.canonical.z);return $+Q<re+L.min.x||$>re+L.max.x||Z+Q<te+L.min.y||Z>te+L.max.y};for(let j=0;j<b.length;j++){const B=b[j];for(let $=0;$<a.length;$++){const Z=t.getTile(a[$]);if(!Z||!Z.hasData()||F(B,Z.tileID))continue;const Q=this._createProxiedId(B,Z,p[B.key]&&p[B.key][t.id]),re=this.proxyToSource[B.key][t.id];re?re.push(Q):this.proxyToSource[B.key][t.id]=[Q],y.push(Q)}}}_createProxiedId(t,a,p){let y=this.orthoMatrix;if(p){const b=p.find(T=>T.key===a.tileID.key);if(b)return b}if(a.tileID.key!==t.key){const b=t.canonical.z-a.tileID.canonical.z;let T,R,D;y=r.bB();const L=a.tileID.wrap-t.wrap<<t.overscaledZ;b>0?(T=r.al>>b,R=T*((a.tileID.canonical.x<<b)-t.canonical.x+L),D=T*((a.tileID.canonical.y<<b)-t.canonical.y)):(T=r.al<<-b,R=r.al*(a.tileID.canonical.x-(t.canonical.x+L<<-b)),D=r.al*(a.tileID.canonical.y-(t.canonical.y<<-b))),r.cd(y,0,T,0,T,0,1),r.bq(y,y,[R,D,0])}return new gd(a.tileID,t.key,y)}_findTileCoveringTileID(t,a){let p=a.getTile(t);if(p&&p.hasData())return p;const y=this._findCoveringTileCache[a.id],b=y[t.key];if(p=b?a.getTileByID(b):null,p&&p.hasData()||b===null)return p;let T=p?p.tileID:t,R=T.overscaledZ;const D=a.getSource().minzoom,L=[];if(!b){const j=a.getSource().maxzoom;if(t.canonical.z>=j){const B=t.canonical.z-j;a.getSource().reparseOverscaled?(R=Math.max(t.canonical.z+2,a.transform.tileZoom),T=new r.aP(R,t.wrap,j,t.canonical.x>>B,t.canonical.y>>B)):B!==0&&(R=j,T=new r.aP(R,t.wrap,j,t.canonical.x>>B,t.canonical.y>>B))}T.key!==t.key&&(L.push(T.key),p=a.getTile(T))}const F=j=>{L.forEach(B=>{y[B]=j}),L.length=0};for(R-=1;R>=D&&(!p||!p.hasData());R--){p&&F(p.tileID.key);const j=T.calculateScaledKey(R);if(p=a.getTileByID(j),p&&p.hasData())break;const B=y[j];if(B===null)break;B===void 0?L.push(j):p=a.getTileByID(B)}return F(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,a){let p=this._tilesDirty[t];p||(p=this._tilesDirty[t]={}),p[a.key]=!0}}function Ip(f,t,a){const p=function(R,D,L){const F=r.bI(D,R),j=r.bI(L,[.2126,.7152,.0722]),B=(Z,Q,re)=>(1-re)*Z+re*Q,$=B(1-.3*Math.min(j,1),1,Math.min(F+1,1));return B(.92,1,Math.asin(r.aA(D[2],-1,1))/Math.PI+.5)*$}(f,[0,0,1],t),y=[0,0,0];r.c4(y,a.slice(0,3),p);const b=[0,0,0];r.c4(b,t.slice(0,3),f[2]);const T=[0,0,0];return r.d7(T,y,b),r.da(T)}const Ou=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Dp=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Ul{static cacheKey(t,a,p,y){let b=`${a}${y?y.cacheKey:""}`;for(const T of p)t.usedDefines.includes(T)&&(b+=`/${T}`);return b}constructor(t,a,p,y,b,T){const R=t.gl;this.program=R.createProgram(),this.configuration=y,this.name=a,this.fixedDefines=[...T];let D=y?y.defines():[];D=D.concat(T.map(Z=>`#define ${Z}`));const L=`#version 300 es
`;let F=L+D.concat("precision mediump float;",zc,Tp.fragmentSource).join(`
`);for(const Z of p.fragmentIncludes)F+=`
${Qd[Z]}`;F+=`
${p.fragmentSource}`;let j=L+D.concat("precision highp float;",zc,Tp.vertexSource).join(`
`);for(const Z of p.vertexIncludes)j+=`
${Qd[Z]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(j+=`
uniform int u_instanceID;
`),j+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(j=j.replaceAll("gl_InstanceID","u_instanceID"));const B=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);R.shaderSource(B,F),R.compileShader(B),R.attachShader(this.program,B);const $=R.createShader(R.VERTEX_SHADER);R.isContextLost()?this.failedToCreate=!0:(R.shaderSource($,j),R.compileShader($),R.attachShader(this.program,$),this.attributes={},R.linkProgram(this.program),R.deleteShader($),R.deleteShader(B),this.fixedUniforms=b(t),this.binderUniforms=y?y.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Z=>({u_instanceID:new r.cg(Z)}))(t)),(T.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(Z=>({u_dem:new r.cg(Z),u_dem_prev:new r.cg(Z),u_dem_tl:new r.cj(Z),u_dem_scale:new r.ci(Z),u_dem_tl_prev:new r.cj(Z),u_dem_scale_prev:new r.ci(Z),u_dem_size:new r.ci(Z),u_dem_lerp:new r.ci(Z),u_exaggeration:new r.ci(Z),u_depth:new r.cg(Z),u_depth_size_inv:new r.cj(Z),u_depth_range_unpack:new r.cj(Z),u_occluder_half_size:new r.ci(Z),u_occlusion_depth_offset:new r.ci(Z),u_meter_to_dem:new r.ci(Z),u_label_plane_matrix_inv:new r.ck(Z)}))(t)),T.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new r.ch(Z),u_tile_tr_up:new r.ch(Z),u_tile_br_up:new r.ch(Z),u_tile_bl_up:new r.ch(Z),u_tile_up_scale:new r.ci(Z)}))(t)),T.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new r.ck(Z),u_fog_range:new r.cj(Z),u_fog_color:new r.d2(Z),u_fog_horizon_blend:new r.ci(Z),u_fog_vertical_limit:new r.cj(Z),u_fog_temporal_offset:new r.ci(Z),u_frustum_tl:new r.ch(Z),u_frustum_tr:new r.ch(Z),u_frustum_br:new r.ch(Z),u_frustum_bl:new r.ch(Z),u_globe_pos:new r.ch(Z),u_globe_radius:new r.ci(Z),u_globe_transition:new r.ci(Z),u_is_globe:new r.cg(Z),u_viewport:new r.cj(Z)}))(t)),T.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Z=>({u_cutoff_params:new r.d2(Z)}))(t)),T.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Z=>({u_lighting_ambient_color:new r.ch(Z),u_lighting_directional_dir:new r.ch(Z),u_lighting_directional_color:new r.ch(Z),u_ground_radiance:new r.ch(Z)}))(t)),T.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Z=>({u_light_matrix_0:new r.ck(Z),u_light_matrix_1:new r.ck(Z),u_fade_range:new r.cj(Z),u_shadow_normal_offset:new r.ch(Z),u_shadow_intensity:new r.ci(Z),u_shadow_texel_size:new r.ci(Z),u_shadow_map_resolution:new r.ci(Z),u_shadow_direction:new r.ch(Z),u_shadow_bias:new r.ch(Z),u_shadowmap_0:new r.cg(Z),u_shadowmap_1:new r.cg(Z)}))(t)))}getAttributeLocation(t,a){let p=this.attributes[a];return p===void 0&&(p=this.attributes[a]=t.getAttribLocation(this.program,a)),p}setTerrainUniformValues(t,a){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in a)p[y]&&p[y].set(this.program,y,a[y])}}setGlobeUniformValues(t,a){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in a)p[y]&&p[y].set(this.program,y,a[y])}}setFogUniformValues(t,a){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in a)p[y].set(this.program,y,a[y])}}setCutoffUniformValues(t,a){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in a)p[y].set(this.program,y,a[y])}}setLightsUniformValues(t,a){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in a)p[y].set(this.program,y,a[y])}}setShadowUniformValues(t,a){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;t.program.set(this.program);for(const y in a)p[y].set(this.program,y,a[y])}_drawDebugWireframe(t,a,p,y,b,T,R,D,L,F){const j=t.options.wireframe;if(j.terrain===!1&&j.layers2D===!1&&j.layers3D===!1)return;const B=t.context;if(!(!(!j.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!j.layers2D||t._terrain&&t._terrain.renderingToTexture||!Ou.includes(this.name))||!(!j.layers3D||!Dp.includes(this.name))))return;const $=B.gl,Z=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,b,B);if(!Z)return;const Q=[...this.fixedDefines];Q.push("DEBUG_WIREFRAME");const re=t.getOrCreateProgram(this.name,{config:this.configuration,defines:Q});B.program.set(re.program);const te=(ce,Ae,_e)=>{if(Ae[ce]&&_e[ce])for(const Ie in Ae[ce])_e[ce][Ie]&&_e[ce][Ie].set(_e.program,Ie,Ae[ce][Ie].current)};L&&L.setUniforms(re.program,B,re.binderUniforms,R,{zoom:D}),te("fixedUniforms",this,re),te("terrainUniforms",this,re),te("globeUniforms",this,re),te("fogUniforms",this,re),te("lightsUniforms",this,re),te("shadowUniforms",this,re),Z.bind(),B.setColorMode(new an([$.ONE,$.ONE_MINUS_SRC_ALPHA,$.ZERO,$.ONE],r.ao.transparent,[!0,!0,!0,!1])),B.setDepthMode(new pi(a.func===$.LESS?$.LEQUAL:a.func,pi.ReadOnly,a.range)),B.setStencilMode(Hi.disabled);const se=3*T.primitiveLength*2,me=3*T.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ce=F||1;for(let Ae=0;Ae<ce;++Ae)re.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ae),$.drawElements($.LINES,se,$.UNSIGNED_SHORT,me)}else F&&F>1?$.drawElementsInstanced($.LINES,se,$.UNSIGNED_SHORT,me,F):$.drawElements($.LINES,se,$.UNSIGNED_SHORT,me);b.bind(),B.program.set(this.program),B.setDepthMode(a),B.setStencilMode(p),B.setColorMode(y)}checkUniforms(t,a,p){if(this.fixedDefines.includes(a)){for(const y of Object.keys(p))if(!p[y].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${y} not set but required by ${a} being defined`)}}draw(t,a,p,y,b,T,R,D,L,F,j,B,$,Z,Q,re){const te=t.context,se=te.gl;if(this.failedToCreate)return;te.program.set(this.program),te.setDepthMode(p),te.setStencilMode(y),te.setColorMode(b),te.setCullFace(T);for(const Ae of Object.keys(this.fixedUniforms))this.fixedUniforms[Ae].set(this.program,Ae,R[Ae]);Z&&Z.setUniforms(this.program,te,this.binderUniforms,B,{zoom:$});const me={[se.POINTS]:1,[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[a];this.checkUniforms(D,"RENDER_SHADOWS",this.shadowUniforms);const ce=re&&re>0?1:void 0;for(const Ae of j.get()){const _e=Ae.vaos||(Ae.vaos={});if((_e[D]||(_e[D]=new cc)).bind(te,this,L,Z?Z.getPaintVertexBuffers():[],F,Ae.vertexOffset,Q||[],ce),this.forceManualRenderingForInstanceIDShaders){const Ie=re||1;for(let Ce=0;Ce<Ie;++Ce)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ce),F?se.drawElements(a,Ae.primitiveLength*me,se.UNSIGNED_SHORT,Ae.primitiveOffset*me*2):se.drawArrays(a,Ae.vertexOffset,Ae.vertexLength)}else re&&re>1?se.drawElementsInstanced(a,Ae.primitiveLength*me,se.UNSIGNED_SHORT,Ae.primitiveOffset*me*2,re):F?se.drawElements(a,Ae.primitiveLength*me,se.UNSIGNED_SHORT,Ae.primitiveOffset*me*2):se.drawArrays(a,Ae.vertexOffset,Ae.vertexLength);a===se.TRIANGLES&&F&&this._drawDebugWireframe(t,p,y,b,F,Ae,B,$,Z,re)}}}function af(f,t,a=0){const p=Math.pow(2,t.tileID.overscaledZ),y=t.tileSize*Math.pow(2,f.transform.tileZoom)/p,b=y*(t.tileID.canonical.x+t.tileID.wrap*p),T=y*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ay(t,1,f.transform.tileZoom),u_pixel_coord_upper:[b>>16,T>>16],u_pixel_coord_lower:[65535&b,65535&T],u_pattern_transition:a}}const yh={terrain:0,flat:1},of=r.bB(),vh=(f,t,a,p,y,b,T,R,D,L,F,j,B,$,Z,Q,re,te)=>{const se=t.style.light,me=se.properties.get("position"),ce=[me.x,me.y,me.z],Ae=r.dN();se.properties.get("anchor")==="viewport"&&(r.dO(Ae,-t.transform.angle),r.dP(ce,ce,Ae));const _e=se.properties.get("color").toPremultipliedRenderColor(null),Ie=t.transform,Ce={u_matrix:f,u_lightpos:ce,u_lightintensity:se.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_vertical_gradient:+a,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:of,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:yh[L],u_base_type:yh[F],u_ao:y,u_edge_radius:b,u_width_scale:T,u_flood_light_color:Z,u_vertical_scale:Q,u_flood_light_intensity:re,u_ground_shadow_factor:te};return Ie.projection.name==="globe"&&(Ce.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],Ce.u_zoom_transition=j,Ce.u_inv_rot_matrix=$,Ce.u_merc_center=B,Ce.u_up_dir=Ie.projection.upVector(new r.cC(0,0,0),B[0]*r.al,B[1]*r.al),Ce.u_height_lift=D),Ce},_d=(f,t,a,p,y,b)=>({u_matrix:f,u_edge_radius:t,u_width_scale:a,u_vertical_scale:p,u_height_type:yh[y],u_base_type:yh[b]}),jc=(f,t,a,p,y,b,T,R,D,L,F,j,B,$,Z,Q,re,te)=>{const se=vh(f,t,a,p,y,b,T,R,L,F,j,B,$,Z,Q,re,1,[0,0,0]),me={u_height_factor:-Math.pow(2,R.overscaledZ)/D.tileSize/8};return Object.assign(se,af(t,D,te),me)},sf=(f,t,a,p,y,b,T,R,D,L,F)=>({u_matrix:t,u_opacity:a,u_ao_pass:p?1:0,u_meter_to_tile:y,u_ao:b,u_flood_light_intensity:T,u_flood_light_color:R,u_attenuation:D,u_edge_radius:L,u_fb:0,u_fb_size:F,u_dynamic_offset:1}),xh=(f,t,a)=>({u_matrix:f,u_emissive_strength:t,u_ground_shadow_factor:a}),q_=(f,t,a,p,y,b=0)=>Object.assign(xh(f,t,y),af(a,p,b)),cx=(f,t,a,p)=>({u_matrix:f,u_world:a,u_emissive_strength:t,u_ground_shadow_factor:p}),Fb=(f,t,a,p,y,b,T=0)=>Object.assign(q_(f,t,a,p,b,T),{u_world:y}),Nb=(f,t)=>({u_matrix:f,u_ground_shadow_factor:t}),Mp=(f,t,a,p,y)=>({u_matrix:f,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:a,u_height_scale:p,u_reset_depth:y}),tg=(f,t,a,p,y,b,T,R,D)=>({u_matrix:f,u_normal_matrix:t,u_opacity:a,u_faux_facade_ao_intensity:p,u_camera_pos:y,u_tile_to_meter:b,u_facade_emissive_chance:T,u_flood_light_color:R,u_flood_light_intensity:D}),ig=f=>({u_matrix:f}),Z_=f=>({u_matrix:f}),lf=(f,t,a,p,y,b,T,R)=>{const D=r.al/b.tileSize;return{u_matrix:f,u_inv_rot_matrix:t,u_camera_to_center_distance:a.getCameraToCenterDistance(R),u_extrude_scale:[a.pixelsToGLUnits[0]/D,a.pixelsToGLUnits[1]/D],u_zoom_transition:p,u_tile_id:T,u_merc_center:y}},ng=(f,t,a=1)=>({u_matrix:f,u_color:t,u_overlay:0,u_overlay_scale:a}),X_=r.bB(),ux=(f,t,a,p,y,b,T)=>{const R=f.transform,D=R.projection.name==="globe",L=D?r.dQ(R.zoom,t.canonical)*R._pixelsPerMercatorPixel:r.ay(a,1,b),F={u_matrix:t.projMatrix,u_extrude_scale:L,u_intensity:T,u_inv_rot_matrix:X_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){F.u_inv_rot_matrix=p,F.u_merc_center=y,F.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],F.u_zoom_transition=r.aj(R.zoom);const j=y[0]*r.al,B=y[1]*r.al;F.u_up_dir=R.projection.upVector(new r.cC(0,0,0),j,B)}return F};function rg(f,[t,a,p,y],[b,T]){if(b===T)return[0,0,0,0];const R=255*(f-1)/(f*(T-b));return[t*R,a*R,p*R,y*R]}function ku(f,t,[a,p]){return a===p?0:.5/f+(t-a)*(f-1)/(f*(p-a))}const yo=(f,t,a,p,y,b,T,R,D,L,F,j,B,$,Z,Q,re,te,se,me,ce)=>({u_matrix:f,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:L,u_fade_t:F.mix,u_opacity:F.opacity*j.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:j.paint.get("raster-brightness-min"),u_brightness_high:j.paint.get("raster-brightness-max"),u_saturation_factor:r.dS(j.paint.get("raster-saturation")),u_contrast_factor:r.dR(j.paint.get("raster-contrast")),u_spin_weights:ag(j.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:$,u_zoom_transition:T,u_merc_center:R,u_cutoff_params:D,u_colorization_mix:rg(r.dT,Q,te),u_colorization_offset:ku(r.dT,re,te),u_color_ramp:Z,u_texture_offset:[me/(se+2*me),se/(se+2*me)],u_texture_res:[se+2*me,se+2*me],u_emissive_strength:ce});function ag(f){f*=Math.PI/180;const t=Math.sin(f),a=Math.cos(f);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Gc=.05,Hc=(f,t,a,p,y,b,T,R,D,L,F,j)=>({u_matrix:f,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:p,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:L,u_fade_t:F.mix,u_opacity:F.opacity,u_image0:0,u_image1:1,u_raster_elevation:j,u_zoom_transition:T,u_merc_center:R,u_cutoff_params:D}),Lu=(f,t,a,p,y,b,T,R,D,L)=>({u_particle_texture:f,u_particle_texture_side_len:t,u_tile_offset:a,u_velocity:p,u_color_ramp:b,u_velocity_res:y,u_max_speed:T,u_uv_offset:R,u_data_scale:[255*D[0],255*D[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Gc,Gc]}),og=(f,t,a,p,y,b,T,R,D,L)=>({u_particle_texture:f,u_particle_texture_side_len:t,u_velocity:a,u_velocity_res:p,u_max_speed:y,u_speed_factor:b,u_reset_rate:T,u_rand_seed:Math.random(),u_uv_offset:R,u_data_scale:[255*D[0],255*D[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Gc,Gc]}),Pp=r.bB(),Y_=(f,t,a,p,y,b,T,R,D,L,F,j,B,$,Z,Q,re,te,se,me,ce,Ae,_e,Ie)=>{const Ce=y.transform,Te={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Ce.getCameraToCenterDistance(se),u_rotate_symbol:+a,u_aspect_ratio:Ce.width/Ce.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:R,u_is_text:+L,u_elevation_from_sea:D?1:0,u_pitch_with_map:+p,u_texsize:F,u_texsize_icon:j,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Pp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Pp,u_up_vector:[0,-1,0],u_color_adj_mat:Ae,u_icon_transition:_e||0,u_gamma_scale:p?y.transform.getCameraToCenterDistance(se)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:r.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ie||1,u_ground_shadow_factor:me,u_inv_matrix:r.bk(r.bB(),T),u_normal_scale:ce,u_lutTexture:So.LUT};return se.name==="globe"&&(Te.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],Te.u_zoom_transition=Z,Te.u_inv_rot_matrix=re,Te.u_merc_center=Q,Te.u_camera_forward=Ce._camera.forward(),Te.u_ecef_origin=r.dU(Ce.globeMatrix,$.toUnwrapped()),Te.u_tile_matrix=Float32Array.from(Ce.globeMatrix),Te.u_up_vector=te),Te},sg=(f,t,a,p)=>({u_matrix:f,u_emissive_strength:t,u_opacity:a,u_color:p}),zu=(f,t,a,p,y,b,T,R,D)=>Object.assign(function(L,F,j,B,$,Z){const{width:Q,height:re}=B.imageManager.getPixelSize(F),te=Math.pow(2,Z.tileID.overscaledZ),se=Z.tileSize*Math.pow(2,B.transform.tileZoom)/te,me=se*(Z.tileID.canonical.x+Z.tileID.wrap*te),ce=se*Z.tileID.canonical.y;return{u_image:0,u_pattern_tl:j.tl,u_pattern_br:j.br,u_texsize:[Q,re],u_pattern_size:j.displaySize,u_pattern_units_to_pixels:$?[B.transform.width,-1*B.transform.height]:[1/r.ay(Z,1,B.transform.tileZoom),1/r.ay(Z,1,B.transform.tileZoom)],u_pixel_coord_upper:[me>>16,ce>>16],u_pixel_coord_lower:[65535&me,65535&ce]}}(0,b,T,p,R,D),{u_matrix:f,u_emissive_strength:t,u_opacity:a}),Qo=new Float32Array(r.bz([])),qi=(f,t,a,p,y,b,T,R,D,L,F,j,B,$=[0,0,0],Z,Q,re)=>{const te=y.style.light,se=te.properties.get("position"),me=[-se.x,-se.y,se.z],ce=r.dN();te.properties.get("anchor")==="viewport"&&(r.dO(ce,-y.transform.angle),r.dP(me,me,ce));const Ae=F.alphaMode==="MASK",_e=te.properties.get("color").toNonPremultipliedRenderColor(null),Ie=B.paint.get("model-ambient-occlusion-intensity"),Ce=B.paint.get("model-color").constantOr(r.ao.white).toNonPremultipliedRenderColor(null);return Ce.a=B.paint.get("model-color-mix-intensity").constantOr(0),re&&(Ce.r=re[0],Ce.g=re[1],Ce.b=re[2],Ce.a=re[3]),Q&&(Ce.r=Q.color.r,Ce.g=Q.color.g,Ce.b=Q.color.b,Ce.a=Q.colorMix,j=Q.emissionStrength,b=Q.opacity),{u_matrix:f,u_lighting_matrix:t,u_normal_matrix:a,u_node_matrix:p||Qo,u_lightpos:me,u_lightintensity:te.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_camera_pos:$,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+Ae,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:R.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:D,u_roughnessFactor:L,u_baseColorTexture:So.BaseColor,u_metallicRoughnessTexture:So.MetallicRoughness,u_normalTexture:So.Normal,u_occlusionTexture:So.Occlusion,u_emissionTexture:So.Emission,u_lutTexture:So.LUT,u_color_mix:Ce.toArray01(),u_aoIntensity:Ie,u_emissive_strength:j,u_occlusionTextureTransform:Z||[0,0,0,0]}},Ls=(f,t=Qo,a=Qo)=>({u_matrix:f,u_instance:t,u_node_matrix:a}),dc={fillExtrusion:f=>({u_matrix:new r.ck(f),u_lightpos:new r.ch(f),u_lightintensity:new r.ci(f),u_lightcolor:new r.ch(f),u_vertical_gradient:new r.ci(f),u_opacity:new r.ci(f),u_edge_radius:new r.ci(f),u_width_scale:new r.ci(f),u_ao:new r.cj(f),u_height_type:new r.cg(f),u_base_type:new r.cg(f),u_tile_id:new r.ch(f),u_zoom_transition:new r.ci(f),u_inv_rot_matrix:new r.ck(f),u_merc_center:new r.cj(f),u_up_dir:new r.ch(f),u_height_lift:new r.ci(f),u_flood_light_color:new r.ch(f),u_vertical_scale:new r.ci(f),u_flood_light_intensity:new r.ci(f),u_ground_shadow_factor:new r.ch(f)}),fillExtrusionDepth:f=>({u_matrix:new r.ck(f),u_edge_radius:new r.ci(f),u_width_scale:new r.ci(f),u_vertical_scale:new r.ci(f),u_height_type:new r.cg(f),u_base_type:new r.cg(f)}),fillExtrusionPattern:f=>({u_matrix:new r.ck(f),u_lightpos:new r.ch(f),u_lightintensity:new r.ci(f),u_lightcolor:new r.ch(f),u_vertical_gradient:new r.ci(f),u_height_factor:new r.ci(f),u_edge_radius:new r.ci(f),u_width_scale:new r.ci(f),u_ao:new r.cj(f),u_height_type:new r.cg(f),u_base_type:new r.cg(f),u_tile_id:new r.ch(f),u_zoom_transition:new r.ci(f),u_inv_rot_matrix:new r.ck(f),u_merc_center:new r.cj(f),u_up_dir:new r.ch(f),u_height_lift:new r.ci(f),u_image:new r.cg(f),u_texsize:new r.cj(f),u_pixel_coord_upper:new r.cj(f),u_pixel_coord_lower:new r.cj(f),u_tile_units_to_pixels:new r.ci(f),u_opacity:new r.ci(f),u_pattern_transition:new r.ci(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new r.ck(f),u_opacity:new r.ci(f),u_ao_pass:new r.ci(f),u_meter_to_tile:new r.ci(f),u_ao:new r.cj(f),u_flood_light_intensity:new r.ci(f),u_flood_light_color:new r.ch(f),u_attenuation:new r.ci(f),u_edge_radius:new r.ci(f),u_fb:new r.cg(f),u_fb_size:new r.ci(f),u_dynamic_offset:new r.ci(f)}),fill:f=>({u_matrix:new r.ck(f),u_emissive_strength:new r.ci(f),u_ground_shadow_factor:new r.ch(f)}),fillPattern:f=>({u_matrix:new r.ck(f),u_emissive_strength:new r.ci(f),u_image:new r.cg(f),u_texsize:new r.cj(f),u_pixel_coord_upper:new r.cj(f),u_pixel_coord_lower:new r.cj(f),u_tile_units_to_pixels:new r.ci(f),u_ground_shadow_factor:new r.ch(f),u_pattern_transition:new r.ci(f)}),fillOutline:f=>({u_matrix:new r.ck(f),u_emissive_strength:new r.ci(f),u_world:new r.cj(f),u_ground_shadow_factor:new r.ch(f)}),fillOutlinePattern:f=>({u_matrix:new r.ck(f),u_emissive_strength:new r.ci(f),u_world:new r.cj(f),u_image:new r.cg(f),u_texsize:new r.cj(f),u_pixel_coord_upper:new r.cj(f),u_pixel_coord_lower:new r.cj(f),u_tile_units_to_pixels:new r.ci(f),u_ground_shadow_factor:new r.ch(f),u_pattern_transition:new r.ci(f)}),building:f=>({u_matrix:new r.ck(f),u_normal_matrix:new r.ck(f),u_opacity:new r.ci(f),u_faux_facade_ao_intensity:new r.ci(f),u_camera_pos:new r.ch(f),u_tile_to_meter:new r.ci(f),u_facade_emissive_chance:new r.ci(f),u_flood_light_color:new r.ch(f),u_flood_light_intensity:new r.ci(f)}),buildingBloom:f=>({u_matrix:new r.ck(f)}),buildingDepth:f=>({u_matrix:new r.ck(f)}),elevatedStructuresDepth:f=>({u_matrix:new r.ck(f),u_depth_bias:new r.ci(f)}),elevatedStructures:f=>({u_matrix:new r.ck(f),u_ground_shadow_factor:new r.ch(f)}),elevatedStructuresDepthReconstruct:f=>({u_matrix:new r.ck(f),u_camera_pos:new r.ch(f),u_depth_bias:new r.ci(f),u_height_scale:new r.ci(f),u_reset_depth:new r.ci(f)}),circle:r.dX,collisionBox:f=>({u_matrix:new r.ck(f),u_inv_rot_matrix:new r.ck(f),u_camera_to_center_distance:new r.ci(f),u_extrude_scale:new r.cj(f),u_zoom_transition:new r.ci(f),u_merc_center:new r.cj(f),u_tile_id:new r.ch(f)}),collisionCircle:f=>({u_matrix:new r.ck(f),u_inv_matrix:new r.ck(f),u_camera_to_center_distance:new r.ci(f),u_viewport_size:new r.cj(f)}),debug:f=>({u_color:new r.dA(f),u_matrix:new r.ck(f),u_overlay:new r.cg(f),u_overlay_scale:new r.ci(f)}),clippingMask:f=>({u_matrix:new r.ck(f)}),heatmap:f=>({u_extrude_scale:new r.ci(f),u_intensity:new r.ci(f),u_matrix:new r.ck(f),u_inv_rot_matrix:new r.ck(f),u_merc_center:new r.cj(f),u_tile_id:new r.ch(f),u_zoom_transition:new r.ci(f),u_up_dir:new r.ch(f)}),heatmapTexture:f=>({u_image:new r.cg(f),u_color_ramp:new r.cg(f),u_opacity:new r.ci(f)}),hillshade:f=>({u_matrix:new r.ck(f),u_image:new r.cg(f),u_latrange:new r.cj(f),u_light:new r.cj(f),u_shadow:new r.dA(f),u_highlight:new r.dA(f),u_emissive_strength:new r.ci(f),u_accent:new r.dA(f)}),hillshadePrepare:f=>({u_matrix:new r.ck(f),u_image:new r.cg(f),u_dimension:new r.cj(f),u_zoom:new r.ci(f)}),line:r.dW,linePattern:r.dV,raster:f=>({u_matrix:new r.ck(f),u_normalize_matrix:new r.ck(f),u_globe_matrix:new r.ck(f),u_merc_matrix:new r.ck(f),u_grid_matrix:new r.dB(f),u_tl_parent:new r.cj(f),u_scale_parent:new r.ci(f),u_fade_t:new r.ci(f),u_opacity:new r.ci(f),u_image0:new r.cg(f),u_image1:new r.cg(f),u_brightness_low:new r.ci(f),u_brightness_high:new r.ci(f),u_saturation_factor:new r.ci(f),u_contrast_factor:new r.ci(f),u_spin_weights:new r.ch(f),u_perspective_transform:new r.cj(f),u_raster_elevation:new r.ci(f),u_zoom_transition:new r.ci(f),u_merc_center:new r.cj(f),u_cutoff_params:new r.d2(f),u_colorization_mix:new r.d2(f),u_colorization_offset:new r.ci(f),u_color_ramp:new r.cg(f),u_texture_offset:new r.cj(f),u_texture_res:new r.cj(f),u_emissive_strength:new r.ci(f)}),rasterParticle:f=>({u_matrix:new r.ck(f),u_normalize_matrix:new r.ck(f),u_globe_matrix:new r.ck(f),u_merc_matrix:new r.ck(f),u_grid_matrix:new r.dB(f),u_tl_parent:new r.cj(f),u_scale_parent:new r.ci(f),u_fade_t:new r.ci(f),u_opacity:new r.ci(f),u_image0:new r.cg(f),u_image1:new r.cg(f),u_raster_elevation:new r.ci(f),u_zoom_transition:new r.ci(f),u_merc_center:new r.cj(f),u_cutoff_params:new r.d2(f)}),rasterParticleTexture:f=>({u_texture:new r.cg(f),u_opacity:new r.ci(f)}),rasterParticleDraw:f=>({u_particle_texture:new r.cg(f),u_particle_texture_side_len:new r.ci(f),u_tile_offset:new r.cj(f),u_velocity:new r.cg(f),u_color_ramp:new r.cg(f),u_velocity_res:new r.cj(f),u_max_speed:new r.ci(f),u_uv_offset:new r.cj(f),u_data_scale:new r.cj(f),u_data_offset:new r.ci(f),u_particle_pos_scale:new r.ci(f),u_particle_pos_offset:new r.cj(f)}),rasterParticleUpdate:f=>({u_particle_texture:new r.cg(f),u_particle_texture_side_len:new r.ci(f),u_velocity:new r.cg(f),u_velocity_res:new r.cj(f),u_max_speed:new r.ci(f),u_speed_factor:new r.ci(f),u_reset_rate:new r.ci(f),u_rand_seed:new r.ci(f),u_uv_offset:new r.cj(f),u_data_scale:new r.cj(f),u_data_offset:new r.ci(f),u_particle_pos_scale:new r.ci(f),u_particle_pos_offset:new r.cj(f)}),symbol:f=>({u_is_size_zoom_constant:new r.cg(f),u_is_size_feature_constant:new r.cg(f),u_size_t:new r.ci(f),u_size:new r.ci(f),u_camera_to_center_distance:new r.ci(f),u_rotate_symbol:new r.cg(f),u_aspect_ratio:new r.ci(f),u_fade_change:new r.ci(f),u_matrix:new r.ck(f),u_label_plane_matrix:new r.ck(f),u_coord_matrix:new r.ck(f),u_is_text:new r.cg(f),u_elevation_from_sea:new r.cg(f),u_pitch_with_map:new r.cg(f),u_texsize:new r.cj(f),u_texsize_icon:new r.cj(f),u_texture:new r.cg(f),u_texture_icon:new r.cg(f),u_gamma_scale:new r.ci(f),u_device_pixel_ratio:new r.ci(f),u_tile_id:new r.ch(f),u_zoom_transition:new r.ci(f),u_inv_rot_matrix:new r.ck(f),u_merc_center:new r.cj(f),u_camera_forward:new r.ch(f),u_tile_matrix:new r.ck(f),u_up_vector:new r.ch(f),u_ecef_origin:new r.ch(f),u_is_halo:new r.cg(f),u_icon_transition:new r.ci(f),u_color_adj_mat:new r.ck(f),u_scale_factor:new r.ci(f),u_ground_shadow_factor:new r.ch(f),u_inv_matrix:new r.ck(f),u_normal_scale:new r.ci(f),u_lutTexture:new r.cg(f)}),background:f=>({u_matrix:new r.ck(f),u_emissive_strength:new r.ci(f),u_opacity:new r.ci(f),u_color:new r.dA(f)}),backgroundPattern:f=>({u_matrix:new r.ck(f),u_emissive_strength:new r.ci(f),u_opacity:new r.ci(f),u_image:new r.cg(f),u_pattern_tl:new r.cj(f),u_pattern_br:new r.cj(f),u_texsize:new r.cj(f),u_pattern_size:new r.cj(f),u_pixel_coord_upper:new r.cj(f),u_pixel_coord_lower:new r.cj(f),u_pattern_units_to_pixels:new r.cj(f)}),terrainRaster:f=>({u_matrix:new r.ck(f),u_image0:new r.cg(f),u_skirt_height:new r.ci(f),u_ground_shadow_factor:new r.ch(f)}),skybox:f=>({u_matrix:new r.ck(f),u_sun_direction:new r.ch(f),u_cubemap:new r.cg(f),u_opacity:new r.ci(f),u_temporal_offset:new r.ci(f)}),skyboxGradient:f=>({u_matrix:new r.ck(f),u_color_ramp:new r.cg(f),u_center_direction:new r.ch(f),u_radius:new r.ci(f),u_opacity:new r.ci(f),u_temporal_offset:new r.ci(f)}),skyboxCapture:f=>({u_matrix_3f:new r.dB(f),u_sun_direction:new r.ch(f),u_sun_intensity:new r.ci(f),u_color_tint_r:new r.d2(f),u_color_tint_m:new r.d2(f),u_luminance:new r.ci(f)}),globeRaster:f=>({u_proj_matrix:new r.ck(f),u_globe_matrix:new r.ck(f),u_normalize_matrix:new r.ck(f),u_merc_matrix:new r.ck(f),u_zoom_transition:new r.ci(f),u_merc_center:new r.cj(f),u_image0:new r.cg(f),u_grid_matrix:new r.dB(f),u_skirt_height:new r.ci(f),u_far_z_cutoff:new r.ci(f),u_frustum_tl:new r.ch(f),u_frustum_tr:new r.ch(f),u_frustum_br:new r.ch(f),u_frustum_bl:new r.ch(f),u_globe_pos:new r.ch(f),u_globe_radius:new r.ci(f),u_viewport:new r.cj(f)}),globeAtmosphere:f=>({u_frustum_tl:new r.ch(f),u_frustum_tr:new r.ch(f),u_frustum_br:new r.ch(f),u_frustum_bl:new r.ch(f),u_horizon:new r.ci(f),u_transition:new r.ci(f),u_fadeout_range:new r.ci(f),u_atmosphere_fog_color:new r.d2(f),u_high_color:new r.d2(f),u_space_color:new r.d2(f),u_temporal_offset:new r.ci(f),u_horizon_angle:new r.ci(f)}),model:f=>({u_matrix:new r.ck(f),u_lighting_matrix:new r.ck(f),u_normal_matrix:new r.ck(f),u_node_matrix:new r.ck(f),u_lightpos:new r.ch(f),u_lightintensity:new r.ci(f),u_lightcolor:new r.ch(f),u_camera_pos:new r.ch(f),u_opacity:new r.ci(f),u_baseColorFactor:new r.d2(f),u_emissiveFactor:new r.d2(f),u_metallicFactor:new r.ci(f),u_roughnessFactor:new r.ci(f),u_baseTextureIsAlpha:new r.cg(f),u_alphaMask:new r.cg(f),u_alphaCutoff:new r.ci(f),u_baseColorTexture:new r.cg(f),u_metallicRoughnessTexture:new r.cg(f),u_normalTexture:new r.cg(f),u_occlusionTexture:new r.cg(f),u_emissionTexture:new r.cg(f),u_lutTexture:new r.cg(f),u_color_mix:new r.d2(f),u_aoIntensity:new r.ci(f),u_emissive_strength:new r.ci(f),u_occlusionTextureTransform:new r.d2(f)}),modelDepth:f=>({u_matrix:new r.ck(f),u_instance:new r.ck(f),u_node_matrix:new r.ck(f)}),groundShadow:f=>({u_matrix:new r.ck(f),u_ground_shadow_factor:new r.ch(f)}),stars:f=>({u_matrix:new r.ck(f),u_up:new r.ch(f),u_right:new r.ch(f),u_intensity_multiplier:new r.ci(f)}),snowParticle:f=>({u_modelview:new r.ck(f),u_projection:new r.ck(f),u_time:new r.ci(f),u_cam_pos:new r.ch(f),u_velocityConeAperture:new r.ci(f),u_velocity:new r.ci(f),u_horizontalOscillationRadius:new r.ci(f),u_horizontalOscillationRate:new r.ci(f),u_boxSize:new r.ci(f),u_billboardSize:new r.ci(f),u_simpleShapeParameters:new r.cj(f),u_screenSize:new r.cj(f),u_thinningCenterPos:new r.cj(f),u_thinningShape:new r.ch(f),u_thinningAffectedRatio:new r.ci(f),u_thinningParticleOffset:new r.ci(f),u_particleColor:new r.d2(f),u_direction:new r.ch(f)}),rainParticle:f=>({u_modelview:new r.ck(f),u_projection:new r.ck(f),u_time:new r.ci(f),u_cam_pos:new r.ch(f),u_texScreen:new r.cg(f),u_velocityConeAperture:new r.ci(f),u_velocity:new r.ci(f),u_boxSize:new r.ci(f),u_rainDropletSize:new r.cj(f),u_distortionStrength:new r.ci(f),u_rainDirection:new r.ch(f),u_color:new r.d2(f),u_screenSize:new r.cj(f),u_thinningCenterPos:new r.cj(f),u_thinningShape:new r.ch(f),u_thinningAffectedRatio:new r.ci(f),u_thinningParticleOffset:new r.ci(f),u_shapeDirectionalPower:new r.ci(f),u_shapeNormalPower:new r.ci(f),u_mode:new r.ci(f)}),vignette:f=>({u_vignetteShape:new r.ch(f),u_vignetteColor:new r.d2(f)}),occlusion:f=>({u_matrix:new r.ck(f),u_anchorPos:new r.ch(f),u_screenSizePx:new r.cj(f),u_occluderSizePx:new r.cj(f),u_color:new r.d2(f)})};class bh{constructor(t,a,p,y){this.id=bh.uniqueIdxCounter,bh.uniqueIdxCounter++,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||y||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=bh.uniqueIdxCounter,bh.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}bh.uniqueIdxCounter=0;const hx={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Bb{constructor(t,a,p,y,b,T){this.length=a.length,this.attributes=p,this.itemSize=a.bytesPerElement,this.dynamicDraw=y,this.instanceCount=T,this.context=t;const R=t.gl;this.buffer=R.createBuffer(),t.bindVertexBuffer.set(this.buffer),R.bufferData(R.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?R.DYNAMIC_DRAW:R.STATIC_DRAW),this.dynamicDraw||b||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let p=0;p<this.attributes.length;p++){const y=a.getAttributeLocation(t,this.attributes[p].name);y!==-1&&t.enableVertexAttribArray(y)}}setVertexAttribPointers(t,a,p){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],T=a.getAttributeLocation(t,b.name);T!==-1&&t.vertexAttribPointer(T,b.components,t[hx[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(t,a,p){for(let y=0;y<this.attributes.length;y++){const b=a.getAttributeLocation(t,this.attributes[y].name);b!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(b,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class lg{constructor(t,a,p,y,b){this.context=t,this.width=a,this.height=p;const T=this.framebuffer=t.gl.createFramebuffer();y&&(this.colorAttachment=new Qr(t,T)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new _h(t,T):new Rp(t,T))}destroy(){const t=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&t.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&t.deleteTexture(a)}t.deleteFramebuffer(this.framebuffer)}}class cg{constructor(t,a){this.gl=t,this.clearColor=new H_(this),this.clearDepth=new qm(this),this.clearStencil=new nx(this),this.colorMask=new $_(this),this.depthMask=new Lb(this),this.stencilMask=new rx(this),this.stencilFunc=new ax(this),this.stencilOp=new zb(this),this.stencilTest=new Zm(this),this.depthRange=new Sp(this),this.depthTest=new Xm(this),this.depthFunc=new md(this),this.blend=new Ep(this),this.blendFunc=new Ym(this),this.blendColor=new Du(this),this.blendEquation=new tf(this),this.cullFace=new Fc(this),this.cullFaceSide=new Mu(this),this.frontFace=new Cp(this),this.program=new Ap(this),this.activeTexture=new ox(this),this.viewport=new gh(this),this.bindFramebuffer=new Km(this),this.bindRenderbuffer=new Jm(this),this.bindTexture=new W_(this),this.bindVertexBuffer=new nf(this),this.bindElementBuffer=new Nc(this),this.bindVertexArrayOES=new sx(this),this.pixelStoreUnpack=new lx(this),this.pixelStoreUnpackPremultiplyAlpha=new Mn(this),this.pixelStoreUnpackFlipY=new uc(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a,p){return new bh(this,t,a,p)}createVertexBuffer(t,a,p,y,b){return new Bb(this,t,a,p,y,b)}createRenderbuffer(t,a,p){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,t,a,p),this.bindRenderbuffer.set(null),b}createFramebuffer(t,a,p,y){return new lg(this,t,a,p,y)}clear({color:t,depth:a,stencil:p,colorMask:y}){const b=this.gl;let T=0;t&&(T|=b.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(y||[!0,!0,!0,!0])),a!==void 0&&(T|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),p!==void 0&&(T|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),b.clear(T)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){r.bx(t.blendFunction,an.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ua;function Op(f,t,a,p,y,b,T){const R=f.context,D=R.gl,L=f.transform,F=[r.aF(L.center.lng),r.aJ(L.center.lat)],j=a.layout.get("symbol-placement"),B=a.layout.get("text-variable-anchor"),$=a.layout.get("icon-rotation-alignment")==="map",Z=a.layout.get("text-rotation-alignment")==="map",Q=j!=="point",re=[];let te=0,se=0;for(let Te=0;Te<p.length;Te++){const De=p[Te],Ge=t.getTile(De),Ue=Ge.getBucket(a);if(!Ue)continue;const nt=Ue.getProjection().createInversionMatrix(L,De.canonical),Ke=[],st=dp(De,Ue,L),Pt=!T&&$&&Q,Ze=T&&Z&&Q,ze=B&&Ue.hasTextData(),lt=Ue.hasIconTextFit()&&ze&&Ue.hasIconData(),Je=Pt||Ze||T&&ze||lt,bt=Ue.projection.name==="globe",Ft=bt?r.aj(L.zoom):0;bt&&(Ke.push("PROJECTION_GLOBE_VIEW"),Je&&Ke.push("PROJECTED_POS_ON_VIEWPORT"));const ci=f.getOrCreateProgram("collisionBox",{defines:Ke});let Mt=st;y[0]===0&&y[1]===0||(Mt=f.translatePosMatrix(st,Ge,y,b));const Ot=T?Ue.textCollisionBox:Ue.iconCollisionBox,di=Ue.collisionCircleArray;if(di.length>0){const Jt=r.bB(),ti=Mt;r.cO(Jt,Ue.placementInvProjMatrix,L.glCoordMatrix),r.cO(Jt,Jt,Ue.placementViewportMatrix),re.push({circleArray:di,circleOffset:se,transform:ti,invTransform:Jt,projection:Ue.getProjection()}),te+=di.length/4,se=te}if(!Ot)continue;f.terrain&&f.terrain.setupElevationDraw(Ge,ci);const ei=bt?[De.canonical.x,De.canonical.y,1<<De.canonical.z]:[0,0,0];ci.draw(f,D.LINES,pi.disabled,Hi.disabled,f.colorModeForRenderPass(),Ni.disabled,lf(Mt,nt,L,Ft,F,Ge,ei,Ue.getProjection()),a.id,Ot.layoutVertexBuffer,Ot.indexBuffer,Ot.segments,null,L.zoom,null,[Ot.collisionVertexBuffer,Ot.collisionVertexBufferExt])}if(!T||!re.length)return;const me=f.getOrCreateProgram("collisionCircle"),ce=new r.dY;ce.resize(4*te),ce._trim();let Ae=0;for(const Te of re)for(let De=0;De<Te.circleArray.length/4;De++){const Ge=4*De,Ue=Te.circleArray[Ge+0],nt=Te.circleArray[Ge+1],Ke=Te.circleArray[Ge+2],st=Te.circleArray[Ge+3];ce.emplace(Ae++,Ue,nt,Ke,st,0),ce.emplace(Ae++,Ue,nt,Ke,st,1),ce.emplace(Ae++,Ue,nt,Ke,st,2),ce.emplace(Ae++,Ue,nt,Ke,st,3)}(!Ua||Ua.length<2*te)&&(Ua=function(Te){const De=2*Te,Ge=new r.b0;Ge.resize(De),Ge._trim();for(let Ue=0;Ue<De;Ue++){const nt=6*Ue;Ge.uint16[nt+0]=4*Ue+0,Ge.uint16[nt+1]=4*Ue+1,Ge.uint16[nt+2]=4*Ue+2,Ge.uint16[nt+3]=4*Ue+2,Ge.uint16[nt+4]=4*Ue+3,Ge.uint16[nt+5]=4*Ue+0}return Ge}(te));const _e=R.createIndexBuffer(Ua,!0),Ie=R.createVertexBuffer(ce,r.dZ.members,!0);for(const Te of re){const De={u_matrix:Te.transform,u_inv_matrix:Te.invTransform,u_camera_to_center_distance:(Ce=L).getCameraToCenterDistance(Te.projection),u_viewport_size:[Ce.width,Ce.height]};me.draw(f,D.TRIANGLES,pi.disabled,Hi.disabled,f.colorModeForRenderPass(),Ni.disabled,De,a.id,Ie,_e,r.bf.simpleSegment(0,2*Te.circleOffset,Te.circleArray.length,Te.circleArray.length/2),null,L.zoom)}var Ce;Ie.destroy(),_e.destroy()}const wh=r.bB();function K_(f){const t=f._camera.getWorldToCamera(f.worldSize,1),a=r.aB([],t,f.globeMatrix);r.bk(a,a);const p=[0,0,0],y=[0,1,0,0];return r.aC(y,y,a),p[0]=y[0],p[1]=y[1],p[2]=y[2],r.aw(p,p),p}function kp({width:f,height:t,anchor:a,textOffset:p,textScale:y},b){const{horizontalAlign:T,verticalAlign:R}=r.c0(a),D=-(T-.5)*f,L=-(R-.5)*t,F=r.c1(a,p);return new r.P((D/y+F[0])*b,(L/y+F[1])*b)}function Th(f,t,a,p,y,b,T,R,D,L){const F=f.text.placedSymbolArray,j=f.text.dynamicLayoutVertexArray,B=f.icon.dynamicLayoutVertexArray,$={},Z=f.getProjection(),Q=uh(T,Z,y),re=y.elevation,te=Z.upVectorScale(T.canonical,y.center.lat,y.worldSize).metersToTile;j.clear();for(let se=0;se<F.length;se++){const me=F.get(se),{tileAnchorX:ce,tileAnchorY:Ae,numGlyphs:_e}=me,Ie=me.hidden||!me.crossTileID||f.allowVerticalPlacement&&!me.placedOrientation?null:p[me.crossTileID];if(Ie){let Ce=0,Te=0,De=0;const Ge=f.elevationType==="road";if(re||Ge){const Je=Ge?f.getElevationFeatureForText(se):null,bt=r.bU.getAtTileOffset(T,new r.P(ce,Ae),re,Je),[Ft,ci,Mt]=Z.upVector(T.canonical,ce,Ae);Ce=bt*Ft*te,Te=bt*ci*te,De=bt*Mt*te}let[Ue,nt,Ke,st]=Mi(me.projectedAnchorX+Ce,me.projectedAnchorY+Te,me.projectedAnchorZ+De,a?Q:b);const Pt=Wn(y.getCameraToCenterDistance(Z),st);let Ze=r.bL(f.textSizeData,D,me)*Pt/r.bX;a&&(Ze*=f.tilePixelRatio/R);const ze=kp(Ie,Ze);a?({x:Ue,y:nt,z:Ke}=Z.projectTilePoint(ce+ze.x,Ae+ze.y,T.canonical),[Ue,nt,Ke]=Mi(Ue+Ce,nt+Te,Ke+De,b)):(t&&ze._rotate(-y.angle),Ue+=ze.x,nt+=ze.y,Ke=0);const lt=f.allowVerticalPlacement&&me.placedOrientation===r.bK.vertical?Math.PI/2:0;for(let Je=0;Je<_e;Je++)r.bN(j,Ue,nt,Ke,lt);L&&me.associatedIconIndex>=0&&($[me.associatedIconIndex]={x:Ue,y:nt,z:Ke,angle:lt})}else vl(_e,j)}if(L){B.clear();const se=f.icon.placedSymbolArray;for(let me=0;me<se.length;me++){const ce=se.get(me),{numGlyphs:Ae}=ce,_e=$[me];if(ce.hidden||!_e)vl(Ae,B);else{const{x:Ie,y:Ce,z:Te,angle:De}=_e;for(let Ge=0;Ge<Ae;Ge++)r.bN(B,Ie,Ce,Te,De)}}f.icon.dynamicLayoutVertexBuffer.updateData(B)}f.text.dynamicLayoutVertexBuffer.updateData(j)}function $c(f,t,a,p,y,b,T={}){const R=a.paint.get("icon-translate"),D=a.paint.get("text-translate"),L=a.paint.get("icon-translate-anchor"),F=a.paint.get("text-translate-anchor"),j=a.layout.get("icon-rotation-alignment"),B=a.layout.get("text-rotation-alignment"),$=a.layout.get("icon-pitch-alignment"),Z=a.layout.get("text-pitch-alignment"),Q=a.layout.get("icon-keep-upright"),re=a.layout.get("text-keep-upright"),te=a.paint.get("icon-color-saturation"),se=a.paint.get("icon-color-contrast"),me=a.paint.get("icon-color-brightness-min"),ce=a.paint.get("icon-color-brightness-max"),Ae=a.layout.get("symbol-elevation-reference")==="sea",_e=a.layout.get("icon-image-use-theme")==="none",Ie=f.context,Ce=Ie.gl,Te=f.transform,De=j==="map",Ge=B==="map",Ue=$==="map",nt=Z==="map",Ke=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let st=!1;const Pt=f.depthModeForSublayer(0,pi.ReadOnly),Ze=new pi(f.context.gl.LEQUAL,pi.ReadOnly,f.depthRangeFor3D),ze=[r.aF(Te.center.lng),r.aJ(Te.center.lat)],lt=a.layout.get("text-variable-anchor"),Je=Te.projection.name==="globe",bt=[],Ft=[0,-1,0];for(const ci of p){const Mt=t.getTile(ci),Ot=Mt.getBucket(a);if(!Ot||Ot.projection.name==="mercator"&&Je||Ot.fullyClipped)continue;const di=Ot.projection.name==="globe",ei=di?r.aj(Te.zoom):0,Jt=uh(ci,Ot.getProjection(),Te),ti=Te.calculatePixelsToTileUnitsMatrix(Mt),Ii=lt&&Ot.hasTextData(),yn=Ot.hasIconTextFit()&&Ii&&Ot.hasIconData(),An=Ot.getProjection().createInversionMatrix(Te,ci.canonical),_r=(1<<Mt.tileID.canonical.z)*r.al/f.transform.worldSize,Bi=Xn=>{let Fi=[0,0,0];if(Xn){const zn=f.style.directionalLight,$r=f.style.ambientLight;zn&&$r&&(Fi=xl(f.style,zn,$r))}return Fi},In=Xn=>{Te.depthOcclusionForSymbolsAndCircles&&(a.hasOcclusionOpacityProperties||f.terrain)&&(Xn.push("DEPTH_D24"),Xn.push("DEPTH_OCCLUSION"))},tn=Xn=>{a.lut&&!_e&&(a.lut.texture||(a.lut.texture=new r.d_(f.context,a.lut.image,[a.lut.image.height,a.lut.image.height,a.lut.image.height],Ie.gl.RGBA8)),Ie.activeTexture.set(Ie.gl.TEXTURE0+So.LUT),a.lut.texture&&a.lut.texture.bind(Ie.gl.LINEAR,Ie.gl.CLAMP_TO_EDGE),Xn.push("APPLY_LUT_ON_GPU"))},dr=()=>{const Xn=De&&a.layout.get("symbol-placement")!=="point",Fi=[];In(Fi),tn(Fi);const zn=Xn||yn,$r=Ot.elevationType==="road",va=f.shadowRenderer,Xr=$r&&Ue&&!!va&&va.enabled,pa=Bi(Xr),Cs=$r&&Ue&&!f.terrain?Ze:Pt,As=a.paint.get("icon-image-cross-fade");f.terrainRenderModeElevated()&&Ue&&Fi.push("PITCH_WITH_MAP_TERRAIN"),di&&(Fi.push("PROJECTION_GLOBE_VIEW"),zn&&Fi.push("PROJECTED_POS_ON_VIEWPORT")),As>0&&Ot.hasAnySecondaryIcon&&Fi.push("ICON_TRANSITION"),!Ot.icon.zOffsetVertexBuffer||$r&&f.terrain||Fi.push("Z_OFFSET"),te===0&&se===0&&me===0&&ce===1||Fi.push("COLOR_ADJUSTMENT"),Ot.sdfIcons&&Fi.push("RENDER_SDF"),Xr&&Fi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),$r&&Ue&&!f.terrain&&Ot.icon.orientationVertexBuffer&&Fi.push("ELEVATED_ROADS");const Zo=Ot.icon.programConfigurations.get(a.id),es=f.getOrCreateProgram("symbol",{config:Zo,defines:Fi}),nl=Mt.imageAtlasTexture?Mt.imageAtlasTexture.size:[0,0],Lo=Ot.iconSizeData,rl=r.bJ(Lo,Te.zoom),fs=Ue||!Te.isOrthographic,Ao=Xt(Jt,Mt.tileID.canonical,Ue,De,Te,Ot.getProjection(),ti),ca=mn(Jt,Mt.tileID.canonical,Ue,De,Te,Ot.getProjection(),ti),Ea=f.translatePosMatrix(ca,Mt,R,L,!0),br=f.translatePosMatrix(Jt,Mt,R,L),ka=zn?wh:Ao,Ro=De&&!Ue&&!Xn;let ia=Ft;!Je&&!Te.mercatorFromTransition||De||(ia=K_(Te));const El=di?ia:Ft,Sf=a.getColorAdjustmentMatrix(te,se,me,ce),Zc=Y_(Lo.kind,rl,Ro,Ue,f,br,ka,Ea,Ae,!1,nl,[0,0],0,ci,ei,ze,An,El,Ot.getProjection(),pa,_r,Sf,As,null),Xc=Mt.imageAtlasTexture?Mt.imageAtlasTexture:null,Yc=a.layout.get("icon-size").constantOr(0)!==1||Ot.iconsNeedLinear,Cl=Ot.sdfIcons||f.options.rotating||f.options.zooming||Yc||fs?Ce.LINEAR:Ce.NEAREST,Kc=Ot.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,vo=f.terrain&&Ue&&Xn?r.bk(r.bB(),Ao):wh;if(Xn&&Ot.icon){const Rs=r.bU.getAtTileOffsetFunc(ci,Te.center.lat,Te.worldSize,Ot.getProjection()),Cd=Ai(Jt,Mt.tileID.canonical,Ue,De,Te,Ot.getProjection(),ti),yy=a.layout.get("icon-size-scale-range"),Ag=r.aA(f.scaleFactor,yy[0],yy[1]);la(Ot,Jt,f,!1,Cd,ca,Ue,Q,Rs,ci,Ag)}return{program:es,buffers:Ot.icon,uniformValues:Zc,atlasTexture:Xc,atlasTextureIcon:null,atlasInterpolation:Cl,atlasInterpolationIcon:null,isSDF:Ot.sdfIcons,hasHalo:Kc,depthMode:Cs,tile:Mt,renderWithShadows:Xr,labelPlaneMatrixInv:vo}},Pn=()=>{const Xn=Ge&&a.layout.get("symbol-placement")!=="point",Fi=[],zn=Xn||lt||yn,$r=Ot.elevationType==="road",va=f.shadowRenderer,Xr=$r&&nt&&!!va&&va.enabled,pa=Bi(Xr),Cs=$r&&nt&&!f.terrain?Ze:Pt;f.terrainRenderModeElevated()&&nt&&Fi.push("PITCH_WITH_MAP_TERRAIN"),di&&(Fi.push("PROJECTION_GLOBE_VIEW"),zn&&Fi.push("PROJECTED_POS_ON_VIEWPORT")),!Ot.text.zOffsetVertexBuffer||$r&&f.terrain||Fi.push("Z_OFFSET"),Ot.iconsInText&&Fi.push("RENDER_TEXT_AND_SYMBOL"),Fi.push("RENDER_SDF"),Xr&&Fi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),$r&&nt&&!f.terrain&&Ot.text.orientationVertexBuffer&&Fi.push("ELEVATED_ROADS"),In(Fi);const As=Ot.text.programConfigurations.get(a.id),Zo=f.getOrCreateProgram("symbol",{config:As,defines:Fi});let es,nl=[0,0],Lo=null;const rl=Ot.textSizeData;Ot.iconsInText&&(nl=Mt.imageAtlasTexture?Mt.imageAtlasTexture.size:[0,0],Lo=Mt.imageAtlasTexture?Mt.imageAtlasTexture:null,es=nt||!Te.isOrthographic||f.options.rotating||f.options.zooming||rl.kind==="composite"||rl.kind==="camera"?Ce.LINEAR:Ce.NEAREST);const fs=Mt.glyphAtlasTexture?Mt.glyphAtlasTexture.size:[0,0],Ao=a.layout.get("text-size-scale-range"),ca=r.aA(f.scaleFactor,Ao[0],Ao[1]),Ea=r.bJ(rl,Te.zoom,ca),br=Xt(Jt,Mt.tileID.canonical,nt,Ge,Te,Ot.getProjection(),ti),ka=mn(Jt,Mt.tileID.canonical,nt,Ge,Te,Ot.getProjection(),ti),Ro=f.translatePosMatrix(ka,Mt,D,F,!0),ia=f.translatePosMatrix(Jt,Mt,D,F),El=zn?wh:br,Sf=Ge&&!nt&&!Xn;let Zc=Ft;!Je&&!Te.mercatorFromTransition||Ge||(Zc=K_(Te));const Xc=Y_(rl.kind,Ea,Sf,nt,f,ia,El,Ro,Ae,!0,fs,nl,0,ci,ei,ze,An,di?Zc:Ft,Ot.getProjection(),pa,_r,null,null,ca),Yc=Mt.glyphAtlasTexture?Mt.glyphAtlasTexture:null,Cl=Ce.LINEAR,Kc=a.paint.get("text-halo-width").constantOr(1)!==0,vo=f.terrain&&nt&&Xn?r.bk(r.bB(),br):wh;if(Xn&&Ot.text){const Rs=r.bU.getAtTileOffsetFunc(ci,Te.center.lat,Te.worldSize,Ot.getProjection()),Cd=Ai(Jt,Mt.tileID.canonical,nt,Ge,Te,Ot.getProjection(),ti);la(Ot,Jt,f,!0,Cd,ka,nt,re,Rs,ci,ca)}return{program:Zo,buffers:Ot.text,uniformValues:Xc,atlasTexture:Yc,atlasTextureIcon:Lo,atlasInterpolation:Cl,atlasInterpolationIcon:es,isSDF:!0,hasHalo:Kc,depthMode:Cs,tile:Mt,renderWithShadows:Xr,labelPlaneMatrixInv:vo}},Cr=Ot.icon.segments.get().length,jn=Ot.text.segments.get().length,on=Cr&&!T.onlyText?dr():null,tr=jn&&!T.onlyIcons?Pn():null,un=a.paint.get("icon-opacity").constantOr(1),kr=a.paint.get("text-opacity").constantOr(1);if(Ke&&Ot.canOverlap){st=!0;const Xn=un&&!T.onlyText?Ot.icon.segments.get():[],Fi=kr&&!T.onlyIcons?Ot.text.segments.get():[];for(const zn of Xn)bt.push({segments:new r.bf([zn]),sortKey:zn.sortKey,state:on});for(const zn of Fi)bt.push({segments:new r.bf([zn]),sortKey:zn.sortKey,state:tr})}else T.onlyText||bt.push({segments:un?Ot.icon.segments:new r.bf([]),sortKey:0,state:on}),T.onlyIcons||bt.push({segments:kr?Ot.text.segments:new r.bf([]),sortKey:0,state:tr})}st&&bt.sort((ci,Mt)=>ci.sortKey-Mt.sortKey);for(const ci of bt){const Mt=ci.state;if(Mt)if(f.terrain?f.terrain.setupElevationDraw(Mt.tile,Mt.program,{useDepthForOcclusion:Te.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Mt.labelPlaneMatrixInv}):f.setupDepthForOcclusion(Te.depthOcclusionForSymbolsAndCircles,Mt.program),Ie.activeTexture.set(Ce.TEXTURE0),Mt.atlasTexture&&Mt.atlasTexture.bind(Mt.atlasInterpolation,Ce.CLAMP_TO_EDGE,!0),Mt.atlasTextureIcon&&(Ie.activeTexture.set(Ce.TEXTURE1),Mt.atlasTextureIcon&&Mt.atlasTextureIcon.bind(Mt.atlasInterpolationIcon,Ce.CLAMP_TO_EDGE,!0)),Mt.renderWithShadows&&f.shadowRenderer.setupShadows(Mt.tile.tileID.toUnwrapped(),Mt.program,"vector-tile"),f.uploadCommonLightUniforms(f.context,Mt.program),Mt.hasHalo){const Ot=Mt.uniformValues;Ot.u_is_halo=1,ug(Mt.buffers,ci.segments,a,f,Mt.program,Mt.depthMode,y,b,Ot,2),Ot.u_is_halo=0}else{if(Mt.isSDF){const Ot=Mt.uniformValues;Mt.hasHalo&&(Ot.u_is_halo=1,ug(Mt.buffers,ci.segments,a,f,Mt.program,Mt.depthMode,y,b,Ot,1)),Ot.u_is_halo=0}ug(Mt.buffers,ci.segments,a,f,Mt.program,Mt.depthMode,y,b,Mt.uniformValues,1)}}}function ug(f,t,a,p,y,b,T,R,D,L){const F=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer,f.orientationVertexBuffer];y.draw(p,p.context.gl.TRIANGLES,b,T,R,Ni.disabled,D,a.id,f.layoutVertexBuffer,f.indexBuffer,t,a.paint,p.transform.zoom,f.programConfigurations.get(a.id),F,L)}function dx(f,t){const a=1<<f.canonical.z,p=(t.x*a-f.canonical.x-f.wrap*a)*r.al,y=(t.y*a-f.canonical.y)*r.al,b=r.e7(t.z,t.y);return r.d4(p,y,b)}function yd(f,t,a,p,y){if(!a.layout||a.layout.get("fill-elevation-reference")==="none"||a.paint.get("fill-opacity").constantOr(1)===0)return;const b=f.context.gl,T=new pi(f.context.gl.LEQUAL,pi.ReadWrite,f.depthRangeFor3D),R=new pi(f.context.gl.GREATER,pi.ReadWrite,f.depthRangeFor3D),D=function($){let Z=.01;return $.isOrthographic&&(Z=r.ak(1e-4,Z,r.c$($.pitch>=fd?1:$.pitch/fd))),2*Z}(f.transform),L=f.transform.getFreeCameraOptions().position,F="elevatedStructuresDepthReconstruct",j=f.getOrCreateProgram(F,{defines:["DEPTH_RECONSTRUCTION"]}),B=f.getOrCreateProgram(F);for(const $ of p){const Z=t.getTile($),Q=Z.getBucket(a);if(!Q)continue;const re=Q.elevatedStructures;if(!re)continue;const te=Q.elevationBufferData.heightRange,se=dx($.toUnwrapped(),L),me=f.translatePosMatrix($.projMatrix,Z,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));let ce,Ae,_e,Ie;if(y==="initialize"){if(!te||te.min>=1||re.depthSegments.segments[0].primitiveLength===0)continue;ce=Mp(me,se,D,1,0),Ae=T,_e=re.depthSegments,Ie=j}else if(y==="reset"){if(!te||te.min>=0||re.maskSegments.segments[0].primitiveLength===0)continue;ce=Mp(me,se,0,0,1),Ae=R,_e=re.maskSegments,Ie=j}else if(y==="geometry"){if(re.depthSegments.segments[0].primitiveLength===0)continue;ce=Mp(me,se,D,1,0),Ae=T,_e=re.depthSegments,Ie=B}Ie.draw(f,b.TRIANGLES,Ae,Hi.disabled,an.disabled,Ni.disabled,ce,a.id,re.vertexBuffer,re.indexBuffer,_e,a.paint,f.transform.zoom)}}function cf(f,t,a){const{painter:p,sourceCache:y,layer:b,coords:T,colorMode:R,elevationType:D,terrainEnabled:L,pass:F}=f,j=p.context.gl,B=b.paint.get("fill-pattern"),$=b.paint.get("fill-pattern-cross-fade"),Z=B.constantOr(null);let Q=D;D!=="road"||t&&!L||(Q="none");const re=Q==="road",te=f.painter.shadowRenderer,se=re&&!!te&&te.enabled,me=new pi(p.context.gl.LEQUAL,pi.ReadOnly,p.depthRangeFor3D);let ce=[0,0,0];if(se){const Ie=p.style.directionalLight,Ce=p.style.ambientLight;Ie&&Ce&&(ce=xl(p.style,Ie,Ce))}const Ae=B&&B.constantOr(1),_e=(Ie,Ce)=>{let Te,De,Ge,Ue,nt;Ce?(Te=Ae&&!b.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ge=j.LINES):(Te=Ae?"fillPattern":"fill",Ge=j.TRIANGLES);for(const Ke of T){const st=y.getTile(Ke);if(Ae&&!st.patternsLoaded())continue;const Pt=st.getBucket(b);if(!Pt)continue;const Ze=t?Pt.elevationBufferData:Pt.bufferData;if(Ze.isEmpty())continue;p.prepareDrawTile();const ze=Ze.programConfigurations.get(b.id),lt=p.isTileAffectedByFog(Ke),Je=[],bt=[];re&&(Je.push("ELEVATED_ROADS"),bt.push(Ze.elevatedLayoutVertexBuffer)),se&&Je.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ae&&(p.context.activeTexture.set(j.TEXTURE0),st.imageAtlasTexture&&st.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),ze.updatePaintBuffers());let Ft=!1;if(Z&&st.imageAtlas){const ei=st.imageAtlas,Jt=r.e2.from(Z),ti=Jt.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),Ii=Jt.getSecondary(),yn=ei.patternPositions.get(ti),An=Ii?ei.patternPositions.get(Ii.scaleSelf(r.o.devicePixelRatio).toString()):null;Ft=!!yn&&!!An,yn&&ze.setConstantPatternPositions(yn,An)}$>0&&(Ft||ze.getPatternTransitionVertexBuffer("fill-pattern"))&&Je.push("FILL_PATTERN_TRANSITION");const ci=p.getOrCreateProgram(Te,{config:ze,overrideFog:lt,defines:Je}),Mt=p.translatePosMatrix(Ke.projMatrix,st,b.paint.get("fill-translate"),b.paint.get("fill-translate-anchor"));se&&te.setupShadows(st.tileID.toUnwrapped(),ci,"vector-tile");const Ot=b.paint.get("fill-emissive-strength");if(Ce){Ue=Ze.lineIndexBuffer,nt=Ze.lineSegments;const ei=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[j.drawingBufferWidth,j.drawingBufferHeight];De=Te==="fillOutlinePattern"&&Ae?Fb(Mt,Ot,p,st,ei,ce,$):cx(Mt,Ot,ei,ce)}else Ue=Ze.indexBuffer,nt=Ze.triangleSegments,De=Ae?q_(Mt,Ot,p,st,ce,$):xh(Mt,Ot,ce);p.uploadCommonUniforms(p.context,ci,Ke.toUnwrapped());let di=Ie;(D==="road"&&!L||D==="offset")&&(di=me),ci.draw(p,Ge,di,a||p.stencilModeForClipping(Ke),R,Ni.disabled,De,b.id,Ze.layoutVertexBuffer,Ue,nt,b.paint,p.transform.zoom,ze,bt)}};p.renderPass===F&&_e(p.depthModeForSublayer(1,p.renderPass==="opaque"?pi.ReadWrite:pi.ReadOnly),!1),Q==="none"&&p.renderPass==="translucent"&&b.paint.get("fill-antialias")&&_e(p.depthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,pi.ReadOnly),!0)}function ai(f,t,a,p,y,b,T,R){a.resetLayerRenderingStats(f);const D=f.context,L=D.gl,F=f.transform,j=a.paint.get("fill-extrusion-pattern"),B=a.paint.get("fill-extrusion-pattern-cross-fade"),$=j.constantOr(null),Z=j.constantOr(1),Q=a.paint.get("fill-extrusion-opacity"),re=f.style.enable3dLights(),te=a.paint.get(re&&!Z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),se=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),te],me=a.layout.get("fill-extrusion-edge-radius"),ce=me>0&&!a.paint.get("fill-extrusion-rounded-roof"),Ae=ce?0:me,_e=F.projection.name==="globe"?r.ea():0,Ie=F.projection.name==="globe",Ce=Ie?r.aj(F.zoom):0,Te=[r.aF(F.center.lng),r.aJ(F.center.lat)],De=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ge=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(De?null:a.lut).toArray01().slice(0,3),Ue=a.paint.get("fill-extrusion-flood-light-intensity"),nt=a.paint.get("fill-extrusion-vertical-scale"),Ke=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,st=a.paint.get("fill-extrusion-height-alignment"),Pt=a.paint.get("fill-extrusion-base-alignment"),Ze=Cu(f,a.paint.get("fill-extrusion-cutoff-fade-range")),ze=[];let lt;Ie&&ze.push("PROJECTION_GLOBE_VIEW"),se[0]>0&&ze.push("FAUX_AO"),ce&&ze.push("ZERO_ROOF_RADIUS"),R&&ze.push("HAS_CENTROID"),Ue>0&&ze.push("FLOOD_LIGHT"),Ze.shouldRenderCutoff&&ze.push("RENDER_CUTOFF"),Ke&&ze.push("RENDER_WALL_MODE");const Je=f.renderPass==="shadow",bt=f.shadowRenderer,Ft=Je&&!!bt,ci=Je?Ni.disabled:Ni.backCCW;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let Mt=[0,0,0];if(bt){const ei=f.style.directionalLight,Jt=f.style.ambientLight;ei&&Jt&&(Mt=xl(f.style,ei,Jt)),Je||(ze.push("RENDER_SHADOWS","DEPTH_TEXTURE"),bt.useNormalOffset&&ze.push("NORMAL_OFFSET")),lt=ze.concat(["SHADOWS_SINGLE_CASCADE"])}const Ot=Ft?"fillExtrusionDepth":Z?"fillExtrusionPattern":"fillExtrusion",di=a.getLayerRenderingStats();for(const ei of p){const Jt=t.getTile(ei),ti=Jt.getBucket(a);if(!ti||ti.projection.name!==F.projection.name)continue;let Ii=!1;bt&&(Ii=bt.getMaxCascadeForTile(ei.toUnwrapped())===0);const yn=f.isTileAffectedByFog(ei),An=ti.programConfigurations.get(a.id);let _r=!1;if($&&Jt.imageAtlas){const jn=Jt.imageAtlas,on=r.e2.from($),tr=on.getPrimary().scaleSelf(r.o.devicePixelRatio).toString(),un=on.getSecondary(),kr=jn.patternPositions.get(tr),Xn=un?jn.patternPositions.get(un.scaleSelf(r.o.devicePixelRatio).toString()):null;_r=!!kr&&!!Xn,kr&&An.setConstantPatternPositions(kr,Xn)}B>0&&(_r||An.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&ze.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Bi=f.getOrCreateProgram(Ot,{config:An,defines:Ii?lt:ze,overrideFog:yn});if(f.terrain&&f.terrain.setupElevationDraw(Jt,Bi,{useMeterToDem:!0}),!ti.centroidVertexBuffer){const jn=Bi.getAttributeLocation(L,"a_centroid_pos");jn!==-1&&L.vertexAttrib2f(jn,0,0)}!Je&&bt&&bt.setupShadows(Jt.tileID.toUnwrapped(),Bi,"vector-tile"),Z&&(f.context.activeTexture.set(L.TEXTURE0),Jt.imageAtlasTexture&&Jt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),An.updatePaintBuffers());const In=a.paint.get("fill-extrusion-vertical-gradient"),tn=1/ti.tileToMeter;let dr;if(Je&&bt){if(fx(Jt.tileID,ti.maxHeight,f))continue;const jn=bt.calculateShadowPassMatrixFromTile(Jt.tileID.toUnwrapped());dr=_d(jn,Ae,tn,nt,st,Pt)}else{const jn=f.translatePosMatrix(ei.expandedProjMatrix,Jt,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),on=F.projection.createInversionMatrix(F,ei.canonical);dr=Z?jc(jn,f,In,Q,se,Ae,tn,ei,Jt,_e,st,Pt,Ce,Te,on,Ge,nt,B):vh(jn,f,In,Q,se,Ae,tn,ei,_e,st,Pt,Ce,Te,on,Ge,nt,Ue,Mt)}f.uploadCommonUniforms(D,Bi,ei.toUnwrapped(),null,Ze);let Pn=ti.segments;if(F.projection.name==="mercator"&&!Je&&(Pn=ti.getVisibleSegments(Jt.tileID,f.terrain,f.transform.getFrustum(0)),!Pn.get().length))continue;if(di)if(Je)for(const jn of Pn.get())di.numRenderedVerticesInShadowPass+=jn.primitiveLength;else for(const jn of Pn.get())di.numRenderedVerticesInTransparentPass+=jn.primitiveLength;const Cr=[];(f.terrain||R)&&Cr.push(ti.centroidVertexBuffer),Ie&&Cr.push(ti.layoutVertexExtBuffer),Ke&&Cr.push(ti.wallVertexBuffer),Bi.draw(f,D.gl.TRIANGLES,y,b,T,ci,dr,a.id,ti.layoutVertexBuffer,ti.indexBuffer,Pn,a.paint,f.transform.zoom,An,Cr)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}class J_{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Wc(f,t,a,p,y,b,T,R,D,L,F,j,B,$,Z,Q,re,te,se,me){const ce=t.context,Ae=ce.gl,_e=t.transform,Ie=t.transform.zoom,Ce=[],Te=f.translate,De=f.translateAnchor,Ge=f.edgeRadius,Ue=Cu(t,f.cutoffFadeRange);F==="clear"?(Ce.push("CLEAR_SUBPASS"),me&&(Ce.push("CLEAR_FROM_TEXTURE"),ce.activeTexture.set(Ae.TEXTURE0),me.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE))):F==="sdf"&&Ce.push("SDF_SUBPASS"),te&&Ce.push("HAS_CENTROID"),Ue.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF");const nt=(Ke,st,Pt,Ze,ze)=>{let lt=Ce;st.groundRadiusBuffer!=null&&(lt=Ce.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Je=st.programConfigurations.get(p.id),bt=t.isTileAffectedByFog(Ke),Ft=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:Je,defines:lt,overrideFog:bt}),ci=sf(t,Ze,j,L,ze,[B,$*ze],Z,Q,re,Ie>=17?0:Ge*ze,me?me.size[0]:0),Mt=[];te&&Mt.push(st.hiddenByLandmarkVertexBuffer),st.groundRadiusBuffer!=null&&Mt.push(st.groundRadiusBuffer),t.uploadCommonUniforms(ce,Ft,Ke.toUnwrapped(),null,Ue),Ft.draw(t,ce.gl.TRIANGLES,b,T,R,D,ci,p.id,st.vertexBuffer,st.indexBuffer,Pt,p.paint,Ie,Je,Mt)};for(const Ke of y){const st=a.getTile(Ke),Pt=st.getBucket(p);if(!Pt||Pt.projection.name!==_e.projection.name||!Pt.groundEffect||Pt.groundEffect&&!Pt.groundEffect.hasData())continue;const Ze=Pt.groundEffect,ze=1/Pt.tileToMeter;{const lt=t.translatePosMatrix(Ke.projMatrix,st,Te,De),Je=Ze.getDefaultSegment();nt(Ke,Ze,Je,lt,ze)}if(se)for(let lt=0;lt<4;lt++){const Je=r.e8[lt](Ke),bt=a.getTile(Je);if(!bt)continue;const Ft=bt.getBucket(p);if(!Ft||Ft.projection.name!==_e.projection.name||!Ft.groundEffect||Ft.groundEffect&&!Ft.groundEffect.hasData())continue;const ci=Ft.groundEffect;let Mt,Ot;lt===0?(Mt=[-r.al,0,0],Ot=1):lt===1?(Mt=[r.al,0,0],Ot=0):lt===2?(Mt=[0,-r.al,0],Ot=3):(Mt=[0,r.al,0],Ot=2);const di=ci.regionSegments[Ot];if(!di)continue;const ei=new Float32Array(16);r.bq(ei,Ke.projMatrix,Mt),nt(Ke,ci,di,t.translatePosMatrix(ei,st,Te,De),ze)}}}function Fu(f,t,a,p,y,b,T){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const R=b?b.findDEMTileFor(a):null;if(!(R&&R.dem||T))return;b&&R&&R.dem&&p.selfDEMTileTimestamp!==R.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=R.dem._timestamp);const D=te=>new r.P(Math.ceil((te+r.ec)*r.ed),0),L=te=>{const se=t.getSource().minzoom,me=Ae=>{const _e=t.getTileByID(Ae);if(_e&&_e.hasData())return _e.getBucket(y)},ce=[0,-1,1];for(const Ae of ce){if(te.overscaledZ+Ae<se)continue;const _e=me(te.calculateScaledKey(te.overscaledZ+Ae));if(_e)return _e}},F=[0,0,0],j=(te,se)=>(F[0]=Math.min(te.min.y,se.min.y),F[1]=Math.max(te.max.y,se.max.y),F[2]=r.al-se.min.x>te.max.x?se.min.x-r.al:te.max.x,F),B=(te,se)=>(F[0]=Math.min(te.min.x,se.min.x),F[1]=Math.max(te.max.x,se.max.x),F[2]=r.al-se.min.y>te.max.y?se.min.y-r.al:te.max.y,F),$=[(te,se)=>j(te,se),(te,se)=>j(se,te),(te,se)=>B(te,se),(te,se)=>B(se,te)],Z=(te,se,me,ce,Ae,_e,Ie)=>{if(!b)return 0;const Ce=[[_e?me:te,_e?te:me,0],[_e?me:se,_e?se:me,0]],Te=Ie<0?r.al+Ie:Ie,De=[_e?Te:(te+se)/2,_e?(te+se)/2:Te,0];return me===0&&Ie<0||me!==0&&Ie>0?b.getForTilePoints(Ae,[De],!0,ce):Ce.push(De),b.getForTilePoints(a,Ce,!0,R),Math.max(Ce[0][2],Ce[1][2],De[2])/b.exaggeration()};for(let te=0;te<4;te++){const se=p.borderFeatureIndices[te];if(se.length===0)continue;const me=r.e8[te](a),ce=L(me);if(!(ce&&ce instanceof r.e9))continue;const Ae=b?b.findDEMTileFor(me):null;if(!(Ae&&Ae.dem||T)||(b&&Ae&&Ae.dem&&p.borderDEMTileTimestamp[te]!==Ae.dem._timestamp&&(p.borderDoneWithNeighborZ[te]=-1,p.borderDEMTileTimestamp[te]=Ae.dem._timestamp),p.borderDoneWithNeighborZ[te]===ce.canonical.z))continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();const _e=(te<2?1:5)-te,Ie=ce.borderDoneWithNeighborZ[_e]!==p.canonical.z,Ce=ce.borderFeatureIndices[_e];let Te=0;if(p.canonical.z!==ce.canonical.z){for(const De of se)p.showCentroid(p.featuresOnBorder[De]);if(Ie)for(const De of Ce)ce.showCentroid(ce.featuresOnBorder[De]);p.borderDoneWithNeighborZ[te]=ce.canonical.z,ce.borderDoneWithNeighborZ[_e]=p.canonical.z}for(const De of se){const Ge=p.featuresOnBorder[De],Ue=p.centroidData[Ge.centroidDataIndex],nt=Ge.borders[te];let Ke;for(;Te<Ce.length;){Ke=ce.featuresOnBorder[Ce[Te]];const st=Ke.borders[_e];if(st[1]>nt[0]+3||st[0]>nt[0]-3)break;ce.showCentroid(Ke),Te++}if(Ke&&Te<Ce.length){const st=Te;let Pt=0;for(;!(Ke.borders[_e][0]>nt[1]-3)&&(Pt++,++Te!==Ce.length);)Ke=ce.featuresOnBorder[Ce[Te]];Ke=ce.featuresOnBorder[Ce[st]];let Ze=!1;if(Pt>=1){const Je=Ke.borders[_e];Math.abs(nt[0]-Je[0])<3&&Math.abs(nt[1]-Je[1])<3&&(Pt=1,Ze=!0,Te=st+1)}else if(Pt===0){p.showCentroid(Ge);continue}const ze=ce.centroidData[Ke.centroidDataIndex];T&&Ze&&(((Q=Ue).flags|(re=ze).flags)&r.eb?(Q.flags|=r.eb,re.flags|=r.eb):(Q.flags&=~r.eb,re.flags&=~r.eb));const lt=Ge.intersectsCount()>1||Ke.intersectsCount()>1;if(Pt>1)Te=st,Ue.centroidXY=ze.centroidXY=new r.P(0,0);else if(Ae&&Ae.dem&&!lt){const Je=$[te](Ue,ze),bt=te%2?r.al-1:0,Ft=Z(Je[0],Math.min(r.al-1,Je[1]),bt,Ae,me,te<2,Je[2]);Ue.centroidXY=ze.centroidXY=D(Ft)}else lt?Ue.centroidXY=ze.centroidXY=new r.P(0,0):(Ue.centroidXY=p.encodeBorderCentroid(Ge),ze.centroidXY=ce.encodeBorderCentroid(Ke));p.writeCentroidToBuffer(Ue),ce.writeCentroidToBuffer(ze)}else p.showCentroid(Ge)}p.borderDoneWithNeighborZ[te]=ce.canonical.z,ce.borderDoneWithNeighborZ[_e]=p.canonical.z}var Q,re;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}const Sh=[1,0,0],Ri=[0,1,0],Q_=[0,0,1];function fx(f,t,a){const p=a.transform,y=a.shadowRenderer;if(!y)return!0;const b=f.toUnwrapped(),T=p.tileSize*y._cascades[a.currentShadowCascade].scale;let R=t;if(p.elevation){const Q=p.elevation.getMinMaxForTile(f);Q&&(R+=Q.max)}const D=[...y.shadowDirection];D[2]=-D[2];const L=y.computeSimplifiedTileShadowVolume(b,R,T,D);if(!L)return!1;const F=[Sh,Ri,Q_,D,[D[0],0,D[2]],[0,D[1],D[2]]],j=p.projection.name==="globe",B=p.scaleZoom(T),$=r.cA.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,B,!j),Z=y.getCurrentCascadeFrustum();return $.intersectsPrecise(L.vertices,L.planes,F)===0||Z.intersectsPrecise(L.vertices,L.planes,F)===0}function hg(f){const{painter:t,source:a,layer:p,coords:y}=f;let b=f.defines;const T=t.context,R=t.renderPass==="shadow",D=t.renderPass==="light-beam",L=t.shadowRenderer,F=r.ee(t.transform.center.lat,t.transform.zoom),j=Cu(t,p.paint.get("building-cutoff-fade-range"));j.shouldRenderCutoff&&(b=b.concat("RENDER_CUTOFF")),f.floodLightIntensity>0&&(b=b.concat("FLOOD_LIGHT"));for(const B of y){const $=a.getTile(B),Z=$.getBucket(p);if(!Z)continue;L&&L.getMaxCascadeForTile(B.toUnwrapped())===0&&(b=b.concat("SHADOWS_SINGLE_CASCADE"));const Q=Z.programConfigurations.get(p.id);let re,te,se,me=t.translatePosMatrix(B.expandedProjMatrix,$,[0,0],"map");if(me=r.cR(r.bB(),me,[1,1,f.verticalScale]),R&&L){if(fx($.tileID,Z.maxHeight*F,t))continue;let Ae=L.calculateShadowPassMatrixFromTile($.tileID.toUnwrapped());Ae=r.cR(r.bB(),Ae,[1,1,f.verticalScale]),se=Z_(Ae),re=te=t.getOrCreateProgram("buildingDepth",{config:Q,defines:b,overrideFog:!1})}else if(D)re=te=t.getOrCreateProgram("buildingBloom",{config:Q,defines:b,overrideFog:!1}),se=ig(me);else{const Ae=t.transform.calculatePosMatrix(B.toUnwrapped(),t.transform.worldSize);r.cR(Ae,Ae,[1,1,f.verticalScale]);const _e=r.bB();r.cR(_e,Ae,[1,-1,1/F]),r.bk(_e,_e),r.ef(_e,_e);const Ie=t.transform.getFreeCameraOptions().position,Ce=1<<B.canonical.z;if(se=tg(me,_e,f.opacity,f.facadeAOIntensity,[((Ie.x-B.wrap)*Ce-B.canonical.x)*r.al,(Ie.y*Ce-B.canonical.y)*r.al,Ie.z*Ce*r.al],Z.tileToMeter,f.facadeEmissiveChance,f.floodLightColor,f.floodLightIntensity),te=t.getOrCreateProgram("building",{config:Q,defines:b,overrideFog:!1}),f.depthOnly===!0)re=te;else{const Te=b.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);re=t.getOrCreateProgram("building",{config:Q,defines:Te,overrideFog:!1})}L&&(L.setupShadowsFromMatrix(Ae,te,!0),re!==te&&L.setupShadowsFromMatrix(Ae,re,!0))}const ce=(Ae,_e)=>{if(D){const Ie=Ae.entranceBloom;_e.draw(t,T.gl.TRIANGLES,f.depthMode,Hi.disabled,f.blendMode,Ni.disabled,se,p.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segmentsBucket,p.paint,t.transform.zoom,Q,[Ie.layoutAttenuationBuffer,Ie.layoutColorBuffer])}else{const Ie=Ae.segmentsBucket;let Ce=[Ae.layoutNormalBuffer,Ae.layoutCentroidBuffer,Ae.layoutColorBuffer,Ae.layoutFloodLightDataBuffer];Ae.layoutFacadePaintBuffer&&(Ce=Ce.concat([Ae.layoutFacadeDataBuffer,Ae.layoutFacadeVerticalRangeBuffer,Ae.layoutFacadePaintBuffer])),_e.draw(t,T.gl.TRIANGLES,f.depthMode,Hi.disabled,f.blendMode,R?Ni.disabled:Ni.backCW,se,p.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ie,p.paint,t.transform.zoom,Q,Ce)}};t.uploadCommonUniforms(T,te,B.toUnwrapped(),null,j),Z.buildingWithoutFacade&&ce(Z.buildingWithoutFacade,te),Z.buildingWithFacade&&(re!==te&&t.uploadCommonUniforms(T,re,B.toUnwrapped(),null,j),ce(Z.buildingWithFacade,re))}}function dg(f,t,a,p,y,b,T,R,D,L,F,j,B){const $=f.context.gl,Z=f.depthModeForSublayer(1,pi.ReadOnly,$.LEQUAL,!0),Q=.1*(1-(re=F))+3*re;var re;const te=f._showOverdrawInspector,se=j,me=new J_;te||Wc(me,f,t,a,p,Z,new Hi({func:$.ALWAYS,mask:255},255,255,$.KEEP,$.KEEP,$.REPLACE),new an([$.ONE,$.ONE,$.ONE,$.ONE],r.ao.transparent,[!1,!1,!1,!0],$.MIN),Ni.disabled,y,"sdf",b,T,R,D,L,Q,se,!1);{const ce=te?Hi.disabled:new Hi({func:$.EQUAL,mask:255},255,255,$.KEEP,$.DECR,$.DECR),Ae=te?f.colorModeForRenderPass():new an([$.ONE_MINUS_DST_ALPHA,$.DST_ALPHA,$.ONE,$.ONE],r.ao.transparent,[!0,!0,!0,!0]);Wc(me,f,t,a,p,Z,ce,Ae,Ni.disabled,y,"color",b,T,R,D,L,Q,se,!1)}}function fg(f){return[f[0]*r.eg,f[1]*r.eg,f[2]*r.eg,0]}function ey(f,t,a,p,y,b,T,R,D){const L=p.getSource(),F=a.globeSharedBuffers;if(!F)return;let j,B,$;if(t&&(j=p.getTile(t)),L instanceof r.aT?(B=L.texture,$=r.dJ(0,0,a.transform)):j&&t&&(B=j.texture,$=r.dJ(t.canonical.z,t.canonical.x,a.transform)),!B||!$)return;f||($=r.cR(r.bB(),$,[1,-1,1]));const Z=a.context,Q=Z.gl,re=y.paint.get("raster-resampling")==="nearest"?Q.NEAREST:Q.LINEAR,te=a.colorModeForDrapableLayerRenderPass(b),se=T.defines;se.push("GLOBE_POLES");const me=new pi(Q.LEQUAL,pi.ReadWrite,a.depthRangeFor3D),ce=Float32Array.from(a.transform.expandedFarZProjMatrix),Ae=Float32Array.from(r.bj(r.dI(new r.cC(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),Z.activeTexture.set(Q.TEXTURE0),B.bind(re,Q.CLAMP_TO_EDGE),Z.activeTexture.set(Q.TEXTURE1),B.bind(re,Q.CLAMP_TO_EDGE),"useMipmap"in B&&Z.extTextureFilterAnisotropic&&a.transform.pitch>20&&Q.texParameterf(Q.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const[_e,Ie,Ce,Te]=t?F.getPoleBuffers(t.canonical.z,!1):F.getPoleBuffers(0,!0),De=y.paint.get("raster-elevation");let Ge;f?(Ge=_e,a.renderDefaultNorthPole=De!==0):(Ge=Ie,a.renderDefaultSouthPole=De!==0);const Ue=fg(T.mix),nt=((st,Pt,Ze,ze,lt,Je,bt,Ft,ci,Mt,Ot,di,ei)=>yo(st,Pt,Ze,new Float32Array(16),new Float32Array(9),[0,0],ze,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Je,[0,0],Ft,2,Mt,Ot,di,1,0,ei))(ce,Ae,$,r.aj(a.transform.zoom),0,y,0,De,0,Ue,T.offset,T.range,b),Ke=a.getOrCreateProgram("raster",{defines:se});a.uploadCommonUniforms(Z,Ke,null),Ke.draw(a,Q.TRIANGLES,me,D,te,R,nt,y.id,Ge,Ce,Te)}function ty(f){const t=f._nearZ,a=f.projection.farthestPixelDistance(f),p=a-t,y=.2*f.height,b=t+y;return[t,a,(b-y-t)/p,(b-t)/p]}function Ub(f,t,a,p){if(f)return t instanceof Ia&&f instanceof fa?t.getTextureDescriptor(f,a,!0):{texture:f.texture,mix:fg(p.mix),offset:p.offset,buffer:0,tileSize:1}}var Vb=r.eh([{name:"a_index",type:"Int16",components:1}]);class Ss{constructor(t,a,p,y){const b={width:p[0],height:p[1],data:null},T=t.gl;this.targetColorTexture=new r.T(t,b,T.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(t,b,T.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(a,y),this.lastInvalidatedAt=0}updateParticleTexture(t,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,y=a.width*a.height;this.particleTexture0=new r.T(this.context,a,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,a,p.RGBA8,{premultiply:!1,useMipmap:!1});const b=new r.ei;b.reserve(y);for(let T=0;T<y;T++)b.emplaceBack(T);this.particleIndexBuffer=this.context.createVertexBuffer(b,Vb.members,!0),this.particleSegment=r.bf.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=r.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Sn(f,t,a){if(!f)return null;const p=t.getTextureDescriptor(f,a,!0);if(!p)return null;let{texture:y,mix:b,offset:T,tileSize:R,buffer:D,format:L}=p;if(!y||!L)return null;let F=!1;return L==="uint32"&&(F=!0,b[3]=0,b=rg(r.ej,b,[0,a.paint.get("raster-particle-max-speed")]),T=ku(r.ej,T,[0,a.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[D/(R+2*D),R/(R+2*D)],tileSize:R,scalarData:F,scale:b,offset:T,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function Ln(f){const t=f._nearZ,a=f.projection.farthestPixelDistance(f),p=a-t,y=.2*f.height,b=t+y;return[t,a,(b-y-t)/p,(b-t)/p]}const Br=new r.ao(1,0,0,1),lo=new r.ao(0,1,0,1),Vl=new r.ao(0,0,1,1),pg=new r.ao(1,0,1,1),iy=new r.ao(0,1,1,1);function ny(f,t,a,p,y,b){for(let T=0;T<a.length;T++)if(y){const L=new r.ao(p.r*.8,p.g*.8,p.b*.8,1);tl(f,t,a[T],p,-1,-1,b),tl(f,t,a[T],p,-1,1,b),tl(f,t,a[T],p,1,1,b),tl(f,t,a[T],p,1,-1,b),tl(f,t,a[T],L,0,0,b)}else tl(f,t,a[T],p,0,0,b)}function tl(f,t,a,p,y,b,T){const R=f.context,D=f.transform,L=R.gl,F=D.projection.name==="globe",j=F?["PROJECTION_GLOBE_VIEW"]:[];let B=r.by(a.projMatrix);if(F&&r.aj(D.zoom)>0){const Ue=r.bi(a.canonical,D),nt=r.ek(Ue);B=r.aB(new Float32Array(16),D.globeMatrix,nt),r.aB(B,D.projMatrix,B)}const $=r.bB();$[12]+=2*y/(r.o.devicePixelRatio*D.width),$[13]+=2*b/(r.o.devicePixelRatio*D.height),r.aB(B,$,B);const Z=f.getOrCreateProgram("debug",{defines:j}),Q=t.getTileByID(a.key);f.terrain&&f.terrain.setupElevationDraw(Q,Z);const re=pi.disabled,te=Hi.disabled,se=f.colorModeForRenderPass(),me="$debug";R.activeTexture.set(L.TEXTURE0),f.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),F?Q._makeGlobeTileDebugBuffers(f.context,D):Q._makeDebugTileBoundsBuffers(f.context,D.projection);const ce=Q._tileDebugBuffer||f.debugBuffer,Ae=Q._tileDebugIndexBuffer||f.debugIndexBuffer,_e=Q._tileDebugSegments||f.debugSegments;if(Z.draw(f,L.LINE_STRIP,re,te,se,Ni.disabled,ng(B,p.toPremultipliedRenderColor(null)),me,ce,Ae,_e,null,null,null,[Q._globeTileDebugBorderBuffer]),T){const Ue=Q.latestRawTileData,nt=Math.floor((Ue&&Ue.byteLength||0)/1024);let Ke=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Ke+=` => ${a.overscaledZ}`),Ke+=` ${Q.state}`,Ke+=` ${nt}kb`,function(st,Pt){st.initDebugOverlayCanvas();const Ze=st.debugOverlayCanvas,ze=st.context.gl,lt=st.debugOverlayCanvas.getContext("2d");lt.clearRect(0,0,Ze.width,Ze.height),lt.shadowColor="white",lt.shadowBlur=2,lt.lineWidth=1.5,lt.strokeStyle="white",lt.textBaseline="top",lt.font="bold 36px Open Sans, sans-serif",lt.fillText(Pt,5,5),lt.strokeText(Pt,5,5),st.debugOverlayTexture.update(Ze),st.debugOverlayTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE)}(f,Ke)}const Ie=t.getTile(a).tileSize,Ce=512/Math.min(Ie,512)*(a.overscaledZ/D.zoom)*.5,Te=Q._tileDebugTextBuffer||f.debugBuffer,De=Q._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Ge=Q._tileDebugTextSegments||f.debugSegments;Z.draw(f,L.TRIANGLES,re,te,an.alphaBlended,Ni.disabled,ng(B,r.ao.transparent.toPremultipliedRenderColor(null),Ce),me,Te,De,Ge,null,null,null,[Q._globeTileDebugTextBuffer])}function Er(f,t,a,p){co(f,0,t+a/2,f.transform.width,a,p)}function mi(f,t,a,p){co(f,t-a/2,0,a,f.transform.height,p)}function co(f,t,a,p,y,b){const T=f.context,R=T.gl;R.enable(R.SCISSOR_TEST),R.scissor(t*r.o.devicePixelRatio,a*r.o.devicePixelRatio,p*r.o.devicePixelRatio,y*r.o.devicePixelRatio),T.clear({color:b}),R.disable(R.SCISSOR_TEST)}const Zn=r.eh([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:vd}=Zn;function hs(f,t,a,p){f.emplaceBack(t,a,p)}class Nu{constructor(t){this.vertexArray=new r.el,this.indices=new r.b0,hs(this.vertexArray,-1,-1,1),hs(this.vertexArray,1,-1,1),hs(this.vertexArray,-1,1,1),hs(this.vertexArray,1,1,1),hs(this.vertexArray,-1,-1,-1),hs(this.vertexArray,1,-1,-1),hs(this.vertexArray,-1,1,-1),hs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,vd),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=r.bf.simpleSegment(0,0,36,12)}}function Eo(f,t,a,p,y,b){const T=f.context.gl,R=t.paint.get("sky-atmosphere-color"),D=t.paint.get("sky-atmosphere-halo-color"),L=t.paint.get("sky-atmosphere-sun-intensity"),F=((j,B,$,Z,Q)=>({u_matrix_3f:j,u_sun_direction:B,u_sun_intensity:$,u_color_tint_r:[Z.r,Z.g,Z.b,Z.a],u_color_tint_m:[Q.r,Q.g,Q.b,Q.a],u_luminance:5e-5}))(r.en(r.dN(),p),y,L,R.toPremultipliedRenderColor(null),D.toPremultipliedRenderColor(null));T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,t.skyboxTexture,0),a.draw(f,T.TRIANGLES,pi.disabled,Hi.disabled,an.unblended,Ni.frontCW,F,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const fc=r.eh([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class At{constructor(t){const a=new r.eo;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const p=new r.b0;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(a,fc.members),this.indexBuffer=t.createIndexBuffer(p),this.segments=r.bf.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Wt=r.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Eh{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class ea{constructor(t){this.colorModeAlphaBlendedWriteRGB=new an([1,Oa,1,Oa],r.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new an([1,0,1,0],r.ao.transparent,[!1,!1,!1,!0]),this.params=new Eh,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const a=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new At(a);const p=this.params.sizeRange,y=this.params.intensityRange,b=function(F){const j=r.eq(30),B=[];for(let $=0;$<F;++$){const Z=2*Math.PI*j(),Q=Math.acos(1-2*j())-.5*Math.PI;B.push(r.d4(Math.cos(Q)*Math.cos(Z),Math.cos(Q)*Math.sin(Z),Math.sin(Q)))}return B}(this.params.starsCount),T=r.eq(300),R=new r.ep,D=new r.b0;let L=0;for(let F=0;F<b.length;++F){const j=r.c4([],b[F],200),B=Math.max(0,1+.01*p*(1*T()-.5)),$=Math.max(0,1+.01*y*(1*T()-.5));R.emplaceBack(j[0],j[1],j[2],-1,-1,B,$),R.emplaceBack(j[0],j[1],j[2],1,-1,B,$),R.emplaceBack(j[0],j[1],j[2],1,1,B,$),R.emplaceBack(j[0],j[1],j[2],-1,1,B,$),D.emplaceBack(L+0,L+1,L+2),D.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=a.createVertexBuffer(R,Wt.members),this.starsIdx=a.createIndexBuffer(D),this.starsSegments=r.bf.simpleSegment(0,0,R.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,a){const p=t.context,y=p.gl,b=t.transform,T=new pi(y.LEQUAL,pi.ReadOnly,[0,1]),R=r.aj(b.zoom),D=t.style.getLut(a.scope),L=a.properties.get("color-use-theme")==="none",F=a.properties.get("color").toNonPremultipliedRenderColor(L?null:D),j=a.properties.get("high-color-use-theme")==="none",B=a.properties.get("high-color").toNonPremultipliedRenderColor(j?null:D),$=a.properties.get("space-color-use-theme")==="none",Z=a.properties.get("space-color").toNonPremultipliedRenderColor($?null:D),Q=5e-4,re=r.er(a.properties.get("horizon-blend"),0,1,Q,.25),te=r.dD(t,p,b)&&re===Q?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,se=t.frameCounter/1e3%1,me=r.ag(b.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(me,2)-Math.pow(te,2)),Ae=Math.acos(ce/me),_e=Ie=>{const Ce=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ie&&Ce.push("ALPHA_PASS");const Te=t.getOrCreateProgram("globeAtmosphere",{defines:Ce}),De=((Ue,nt,Ke,st,Pt,Ze,ze,lt,Je,bt,Ft,ci)=>({u_frustum_tl:Ue,u_frustum_tr:nt,u_frustum_br:Ke,u_frustum_bl:st,u_horizon:Pt,u_transition:Ze,u_fadeout_range:ze,u_atmosphere_fog_color:lt.toArray01(),u_high_color:Je.toArray01(),u_space_color:bt.toArray01(),u_temporal_offset:Ft,u_horizon_angle:ci}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,R,re,F,B,Z,se,Ae);t.uploadCommonUniforms(p,Te);const Ge=this.atmosphereBuffer;Ge&&Te.draw(t,y.TRIANGLES,T,Hi.disabled,Ie?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Ni.backCW,De,Ie?"atmosphere_glow_alpha":"atmosphere_glow",Ge.vertexBuffer,Ge.indexBuffer,Ge.segments)};_e(!1),_e(!0)}drawStars(t,a){const p=r.aA(a.properties.get("star-intensity"),0,1);if(p===0)return;const y=t.context,b=y.gl,T=t.transform,R=t.getOrCreateProgram("stars"),D=r.c6([]);r.c8(D,D,-T._pitch),r.c7(D,D,-T.angle),r.c8(D,D,r.an(T._center.lat)),r.es(D,D,-r.an(T._center.lng));const L=r.cb(new Float32Array(16),D),F=r.aB([],T.starsProjMatrix,L),j=r.en([],L),B=r.et([],j),$=[0,1,0];r.dP($,$,B),r.c4($,$,this.params.sizeMultiplier);const Z=[1,0,0];r.dP(Z,Z,B),r.c4(Z,Z,this.params.sizeMultiplier);const Q=(re=$,te=Z,se=p,{u_matrix:Float32Array.from(F),u_up:re,u_right:te,u_intensity_multiplier:se});var re,te,se;t.uploadCommonUniforms(y,R),this.starsVx&&this.starsIdx&&R.draw(t,b.TRIANGLES,pi.disabled,Hi.disabled,this.colorModeAlphaBlendedWriteRGB,Ni.disabled,Q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class We{constructor(){this.visibleTiles=[]}updateBorders(t,a){const p=[],y=[],b=t._getRenderableCoordinates(!1,!0);for(const D of b){const L=t.getTile(D);if(!L.hasData())continue;const F=L.getBucket(a);F&&(F.isEmpty()||(p.push(D.key),y.push({bucket:F,tileID:D.canonical})))}let T=p.length!==this.visibleTiles.length;if(!T){p.sort();for(let D=0;D<p.length;D++)if(p[D]!==this.visibleTiles[D]){T=!0;break}}if(!T)return;const R=new Set;this.visibleTiles=p,y.sort((D,L)=>D.tileID.z-L.tileID.z||D.tileID.x-L.tileID.x||D.tileID.y-L.tileID.y);for(const D of y){const L=new Array,F=new Array,j=D.bucket;for(const B of j.featuresOnBorder)R.has(B.featureId)?F.push(B.footprintIndex):(R.add(B.featureId),L.push(B.footprintIndex));j.updateFootprintHiddenFlags(L,r.eu,!1),j.updateFootprintHiddenFlags(F,r.eu,!0)}}}function Lp(f,t){const a=[...f],p=t.cameraWorldSizeForFog/t.worldSize,y=r.bz([]);return r.cR(y,y,[p,p,1]),r.aB(a,y,a),r.aB(a,t.worldToFogMatrix,a),a}function Ch(f,t,a,p,y){const b=a.material,T=p.context,{baseColorTexture:R,metallicRoughnessTexture:D}=b.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:F,emissionTexture:j}=b;function B(Z,Q,re){if(Z&&(f.push(Q),T.activeTexture.set(T.gl.TEXTURE0+re),Z.gfxTexture)){const{minFilter:te,magFilter:se,wrapS:me,wrapT:ce}=Z.sampler;Z.gfxTexture.bindExtraParam(te,se,me,ce)}}B(R,"HAS_TEXTURE_u_baseColorTexture",So.BaseColor),B(D,"HAS_TEXTURE_u_metallicRoughnessTexture",So.MetallicRoughness),B(L,"HAS_TEXTURE_u_normalTexture",So.Normal),B(F,"HAS_TEXTURE_u_occlusionTexture",So.Occlusion),B(j,"HAS_TEXTURE_u_emissionTexture",So.Emission),y&&(y.texture||(y.texture=new r.d_(p.context,y.image,[y.image.height,y.image.height,y.image.height],T.gl.RGBA8)),T.activeTexture.set(T.gl.TEXTURE0+So.LUT),y.texture&&y.texture.bind(T.gl.LINEAR,T.gl.CLAMP_TO_EDGE),f.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(a.texcoordBuffer)),a.colorBuffer&&(f.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(a.colorBuffer)),a.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(a.normalBuffer)),a.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(a.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||f.push("DIFFUSE_SHADED");const $=p.shadowRenderer;$&&(f.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$.useNormalOffset&&f.push("NORMAL_OFFSET"))}function Ah(f,t,a,p,y,b){const T=a.paint.get("model-opacity").constantOr(1),R=t.context,D=new pi(t.context.gl.LEQUAL,f.isLightMesh?pi.ReadOnly:pi.ReadWrite,t.depthRangeFor3D),L=t.transform,F=f.mesh,j=F.material,B=j.pbrMetallicRoughness,$=t.style.fog;let Z;Z=t.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:r.aB([],p.zScaleMatrix,f.nodeModelMatrix),r.aB(Z,p.negCameraPosMatrix,Z);const Q=r.bk([],Z);r.ef(Q,Q);const re=a.paint.get("model-color-use-theme").constantOr("default")==="none",te=a.paint.get("model-emissive-strength").constantOr(0),se=qi(new Float32Array(f.worldViewProjection),new Float32Array(Z),new Float32Array(Q),null,t,T,B.baseColorFactor,j.emissiveFactor,B.metallicFactor,B.roughnessFactor,j,te,a,void 0,void 0,f.materialOverride,f.modelColor),me={defines:[]},ce=[],Ae=t.shadowRenderer;Ae&&(Ae.useNormalOffset=!1),Ch(me.defines,ce,F,t,re?null:a.lut);let _e=null;if($){const Te=Lp(f.nodeModelMatrix,t.transform);if(_e=new Float32Array(Te),L.projection.name!=="globe"){const De=F.aabb.min,Ge=F.aabb.max,[Ue,nt]=$.getOpacityForBounds(Te,De[0],De[1],Ge[0],Ge[1]);me.overrideFog=Ue>=$e||nt>=$e}}const Ie=Cu(t,a.paint.get("model-cutoff-fade-range"));Ie.shouldRenderCutoff&&me.defines.push("RENDER_CUTOFF");const Ce=t.getOrCreateProgram("model",me);t.uploadCommonUniforms(R,Ce,null,_e,Ie),t.renderPass!=="shadow"&&Ae&&Ae.setupShadowsFromMatrix(f.nodeModelMatrix,Ce),Ce.draw(t,R.gl.TRIANGLES,D,y,b,F.material.doubleSided?Ni.disabled:Ni.backCCW,se,a.id,F.vertexBuffer,F.indexBuffer,F.segments,a.paint,t.transform.zoom,void 0,ce)}function uf(f,t,a){return f.type==="vector"?t.scope:a?"basemap":""}function hf(f,t,a,p,y,b,T,R,D){const L=f.transform,F=!!t.isGeometryBloom&&t.isGeometryBloom;if(F&&f.renderPass==="shadow")return;const j=L.projection.name==="globe"?r.eC(a,L):[...a];r.aB(j,j,t.globalMatrix);const B=r.aB([],p,j);if(t.meshes)for(const $ of t.meshes){const Z=R.get($.material.name);if(Z&&Z.opacity<=0)continue;if($.material.alphaMode!=="BLEND"){T.push({mesh:$,depth:0,modelIndex:y,worldViewProjection:B,nodeModelMatrix:j,isLightMesh:F,materialOverride:Z,modelColor:D});continue}const Q=r.af([],$.centroid,B);!L.isOrthographic&&Q[2]<=0||b.push({mesh:$,depth:Q[2],modelIndex:y,worldViewProjection:B,nodeModelMatrix:j,isLightMesh:F,materialOverride:Z,modelColor:D})}if(t.children)for(const $ of t.children)hf(f,$,a,p,y,b,T,R,D)}function Rh(f,t,a,p){const y=a.shadowRenderer;if(!y)return;const b=y.getShadowPassDepthMode(),T=y.getShadowPassColorMode(),R=y.calculateShadowPassMatrixFromMatrix(t),D=Ls(R);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,b,Hi.disabled,T,Ni.disabled,D,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,a.transform.zoom,void 0,void 0)}function Ih(f,t,a,p,y,b){for(const T of y){const R=Object.assign({},p);R.part=T;const D={type:"Unknown",id:t,properties:R},L={orientation:f.paint.get("model-rotation").evaluate(D,a)};b.set(T,L)}}function ry(f,t,a,p,y,b){for(const T of y){const R=Object.assign({},p);R.part=T;const D={type:"Unknown",id:t,properties:R},L={color:f.paint.get("model-color").evaluate(D,a),colorMix:f.paint.get("model-color-mix-intensity").evaluate(D,a),opacity:f.paint.get("model-opacity").evaluate(D,a),emissionStrength:f.paint.get("model-emissive-strength").evaluate(D,a)};b.set(T,L)}}function mg(f,t,a,p,y,b){if(a===1)for(const R of y)Ah(R,f,t,b[R.modelIndex],Hi.disabled,f.colorModeForRenderPass());else{for(const R of y)Ah(R,f,t,b[R.modelIndex],Hi.disabled,an.disabled);for(const R of y)Ah(R,f,t,b[R.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}const T=an.additive;for(const R of p)Ah(R,f,t,b[R.modelIndex],Hi.disabled,R.isLightMesh?T:f.colorModeForRenderPass())}function gg(f,t,a){const p=t.updateZoomBasedPaintProperties(),y=function(b,T,R){let D,L,F,j=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&j>0){const B=b.terrain,$=B.findDEMTileFor(R);$&&$.dem?D=r.eE.create(B,R,$):j=0}if(j===0&&(T.terrainElevationMin=0,T.terrainElevationMax=0),j===T.validForExaggeration&&(j===0||D&&D._demTile&&D._demTile.tileID===T.validForDEMTile.id&&D._dem._timestamp===T.validForDEMTile.timestamp))return!1;for(const B in T.instancesPerModel){const $=T.instancesPerModel[B];for(let Z=0;Z<$.instancedDataArray.length;++Z){const Q=(D?j*D.getElevationAt(0|$.instancedDataArray.float32[16*Z],0|$.instancedDataArray.float32[16*Z+1],!0,!0):0)+$.instancesEvaluatedElevation[Z];$.instancedDataArray.float32[16*Z+6]=Q,L=L?Math.min(T.terrainElevationMin,Q):Q,F=F?Math.max(T.terrainElevationMax,Q):Q}}return T.terrainElevationMin=L||0,T.terrainElevationMax=F||0,T.validForExaggeration=j,T.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,t,a);(p||y)&&(t.uploaded=!1,t.upload(f.context))}const zs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.d8([0,0,0],[r.al,r.al,0])};function zp(f,t){const a=1<<f.canonical.z,p=t.getFreeCameraOptions().position,y=t.elevation,b=f.canonical.x/a,T=(f.canonical.x+1)/a,R=f.canonical.y/a,D=(f.canonical.y+1)/a;let L=t._centerAltitude;if(y){const $=y.getMinMaxForTile(f);$&&$.max>L&&(L=$.max)}const F=r.aA(p.x,b,T)-p.x,j=r.aA(p.y,R,D)-p.y,B=r.ce(L,t.center.lat)-p.z;return t._zoomFromMercatorZ(Math.sqrt(F*F+j*j+B*B))}function df(f,t,a,p,y,b,T){const R=f.context,D=f.renderPass==="shadow",L=f.shadowRenderer,F=D&&L?L.getShadowPassDepthMode():new pi(R.gl.LEQUAL,pi.ReadWrite,f.depthRangeFor3D),j=f.isTileAffectedByFog(b),B=f.transform.projection.name==="globe";if(a.meshes)for(const $ of a.meshes){const Z=B?[]:["MODEL_POSITION_ON_GPU"],Q=[];let re,te,se;const me=!B&&p.instancedDataArray.length>20;me&&Z.push("INSTANCED_ARRAYS");const ce=Cu(f,t.paint.get("model-cutoff-fade-range"));if(ce.shouldRenderCutoff&&Z.push("RENDER_CUTOFF"),D&&L)re=f.getOrCreateProgram("modelDepth",{defines:Z}),te=Ls(T.shadowTileMatrix,T.shadowTileMatrix,Float32Array.from(a.globalMatrix)),se=L.getShadowPassColorMode();else{Ch(Z,Q,$,f,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),re=f.getOrCreateProgram("model",{defines:Z,overrideFog:j});const _e=$.material,Ie=_e.pbrMetallicRoughness,Ce=t.paint.get("model-opacity").constantOr(1),Te=t.paint.get("model-emissive-strength").constantOr(0);te=qi(b.expandedProjMatrix,Float32Array.from(a.globalMatrix),new Float32Array(16),null,f,Ce,Ie.baseColorFactor,_e.emissiveFactor,Ie.metallicFactor,Ie.roughnessFactor,_e,Te,t,y),L&&(T.shadowUniformsInitialized?re.setShadowUniformValues(R,L.getShadowUniformValues()):(L.setupShadows(b.toUnwrapped(),re,"model-tile"),T.shadowUniformsInitialized=!0)),se=ce.shouldRenderCutoff||Ce<1||_e.alphaMode!=="OPAQUE"?an.alphaBlended:an.unblended}f.uploadCommonUniforms(R,re,b.toUnwrapped(),null,ce);const Ae=$.material.doubleSided?Ni.disabled:Ni.backCCW;if(me)Q.push(p.instancedDataBuffer),re.draw(f,R.gl.TRIANGLES,F,Hi.disabled,se,Ae,te,t.id,$.vertexBuffer,$.indexBuffer,$.segments,t.paint,f.transform.zoom,void 0,Q,p.instancedDataArray.length);else{const _e=D?"u_instance":"u_normal_matrix";for(let Ie=0;Ie<p.instancedDataArray.length;++Ie)te[_e]=new Float32Array(p.instancedDataArray.arrayBuffer,64*Ie,16),re.draw(f,R.gl.TRIANGLES,F,Hi.disabled,se,Ae,te,t.id,$.vertexBuffer,$.indexBuffer,$.segments,t.paint,f.transform.zoom,void 0,Q)}}if(a.children)for(const $ of a.children)df(f,t,$,p,y,b,T)}const xd=[1,-1,1];function ff(f,t,a,p){if(!a.modelManager)return!0;const y=a.modelManager;if(!a.shadowRenderer)return!0;const b=a.shadowRenderer,T=t.aabb;let R=!0,D=f.maxHeight;if(D===0){let F=0;for(const j in f.instancesPerModel){const B=y.getModel(j,p);B?F=Math.max(F,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):R=!1}D=f.maxScale*F*1.41+f.maxVerticalOffset,R&&(f.maxHeight=D)}T.max[2]=D,T.min[2]+=f.terrainElevationMin,T.max[2]+=f.terrainElevationMax,r.af(T.min,T.min,t.tileMatrix),r.af(T.max,T.max,t.tileMatrix);const L=T.intersects(b.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=L===2),L===0}function bd(f,t){const a=f.uniformValues.u_cutoff_params[0],p=f.uniformValues.u_cutoff_params[1],y=f.uniformValues.u_cutoff_params[2],b=f.uniformValues.u_cutoff_params[3];return p===a||b===y?1:r.aA(((t-a)/(p-a)-y)/(b-y),0,1)}function Bu(f,t,a,p){if(t.pitch<20)return 1;const y=t.getWorldToCameraMatrix();r.aB(y,y,f);const b=r.bT(a.min[0],a.min[1],a.min[2],1);let T=r.aC(r.eF(),b,y),R=T,D=T;b[1]=a.max[1],T=r.aC(r.eF(),b,y),R=T[1]<R[1]?T:R,D=T[1]>D[1]?T:D,b[0]=a.max[0],T=r.aC(r.eF(),b,y),R=T[1]<R[1]?T:R,D=T[1]>D[1]?T:D,b[1]=a.min[1],T=r.aC(r.eF(),b,y),R=T[1]<R[1]?T:R,D=T[1]>D[1]?T:D;const L=r.aA(p[0],0,1),F=100*t.pixelsPerMeter*r.aA(p[1],0,1),j=r.aA(p[2],0,1),B=r.eG(r.eF(),R,D,L),$=Math.tan(.5*t.fovX),Z=-B[2]*$;if(F===0)return B[1]<-Math.abs(Z)?j:1;const Q=(-Math.abs(Z)-B[1])/F,re=(se,me,ce)=>(1-ce)*se+ce*me,te=r.aA(re(1,j,Q),j,1);return re(1,te,r.aA((t.pitch-20)/20,0,1))}class _g{}class ay{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,a,p){{const j=this._storage.get(a.id);if(j)return j.lastUsedFrameIdx=t,j.buf}const y=p.gl,b=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),T=new ArrayBuffer(b),R=new Int16Array(T);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(T));const D=new r.eI;for(let j=0;j<b/2;j+=3){const B=R[j],$=R[j+1],Z=R[j+2];D.emplaceBack(B,$),D.emplaceBack($,Z),D.emplaceBack(Z,B)}const L=p.bindVertexArrayOES.current,F=new _g;return F.buf=new bh(p,D),F.lastUsedFrameIdx=t,this._storage.set(a.id,F),p.bindVertexArrayOES.set(L),F.buf}update(t){for(const[a,p]of this._storage)t-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(a))}destroy(){for(const[t,a]of this._storage)a.buf.destroy(),this._storage.delete(t)}}class Fp{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const oy=r.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Np{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class uo{constructor(t,a){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...a,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...a,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const wl=r.eh([{type:"Float32",name:"a_pos_2f",components:2}]);class Bp{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,a){const p=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const T=new r.eJ,R=new r.b0;T.emplaceBack(-1,-1),T.emplaceBack(1,-1),T.emplaceBack(1,1),T.emplaceBack(-1,1),R.emplaceBack(0,1,2),R.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(T,wl.members),this.vignetteIdx=t.context.createIndexBuffer(R)}const y=r.bf.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,p);const T={u_vignetteShape:(b={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};p.draw(t,t.context.gl.TRIANGLES,pi.disabled,Hi.disabled,an.alphaBlended,Ni.disabled,T,"vignette",this.vignetteVx,this.vignetteIdx,y)}var b}}class gn{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,a){const p=t.getFreeCameraOptions().position,y=p.toAltitude(),b=p.toLngLat(),T=r.an(b.lng),R=r.an(b.lat),D=t.pixelsPerMeter/a,L=T*r.eL,F=r.eL*Math.log(Math.tan(Math.PI/4+R/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const j=-this._offsetYPrev+F,B=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+L)*D,this._accumulatedOffsetY+=j*D,this._accumulatedElevation+=B*D,this._offsetXPrev=L,this._offsetYPrev=F,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function dn(f,t){return[-(f[0]-Math.floor(f[0]/t)*t),-(f[1]-Math.floor(f[1]/t)*t),-(f[2]-Math.floor(f[2]/t)*t)]}function pf(f){const t=r.eq(1323123451230),a=[];for(let p=0;p<f;++p){const y=2*t()-1,b=2*t()-1,T=2*t()-1;a.push(r.d4(y,b,T))}return a}function Wo(f,t,a,p,y){const b=r.aA((y-a)/(p-a),0,1);return(1-b)*f+b*t}class qc{constructor(t){this._movement=new gn,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Bp,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,a){const p=t.transform;this._movement.update(p,this._ppmScaleFactor);const y=p.starsProjMatrix,b=r.c6([]);r.c8(b,b,r.an(90)-p._pitch),r.c7(b,b,-p.angle);const T=r.cb(new Float32Array(16),b),R=r.eK(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),D=r.ef([],R),L=r.aB([],D,T),F=Date.now()/1e3;return this._accumulatedTimeFromStart+=(F-this._prevTime)*a,this._prevTime=F,{projectionMatrix:y,modelviewMatrix:L}}}class mf extends qc{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new uo(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const p=pf(this.particlesCount),y=new r.eM,b=new r.b0;let T=0;const R=r.eq(1323123451230);for(let D=0;D<p.length;++D){const L=p[D],F=[2*R()-1,R(),R(),R()];y.emplaceBack(L[0],L[1],L[2],-1,-1,...F),y.emplaceBack(L[0],L[1],L[2],1,-1,...F),y.emplaceBack(L[0],L[1],L[2],1,1,...F),y.emplaceBack(L[0],L[1],L[2],-1,1,...F),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=a.createVertexBuffer(y,oy.members),this.particlesIdx=a.createIndexBuffer(b)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=t.transform.zoom;if(a.revealStart>p)return;const y=Wo(0,1,a.revealStart,a.revealStart+a.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let T=[-b.direction.x,b.direction.y,-100];r.aw(T,T);const R=structuredClone(this._vignetteParams);R.strength*=y,b.overrideStyleParameters||(b.intensity=t.style.rain.state.density,b.timeFactor=t.style.rain.state.intensity,b.color=structuredClone(t.style.rain.state.color),T=structuredClone(t.style.rain.state.direction),b.screenThinning.intensity=t.style.rain.state.centerThinning,b.dropletSizeX=t.style.rain.state.dropletSize[0],b.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],b.distortionStrength=100*t.style.rain.state.distortionStrength,R.strength=1,R.color=structuredClone(t.style.rain.state.vignetteColor));const D=this.updateOnRender(t,b.timeFactor),L=t.context,F=L.gl,j=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new r.T(L,{width:t.width,height:t.height,data:null},F.RGBA8)),b.distortionStrength>0&&(L.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),F.copyTexSubImage2D(F.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const B=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(L,B),L.activeTexture.set(F.TEXTURE0),this.screenTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const $=[b.color.r,b.color.g,b.color.b,b.color.a],Z=(Q,re)=>{const te=dn(this._movement.getPosition(),Q),se=b.dropletSizeX,me=b.dropletSizeX*b.dropletSizeYScale,ce=t.width/2,Ae=t.height/2,_e=Wo(0,b.screenThinning.start,0,1,b.screenThinning.intensity),Ie=Wo(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),Ce=Wo(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),Te=(De={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:Q,rainDropletSize:[se,me],distortionStrength:b.distortionStrength,rainDirection:T,color:$,screenSize:[j.width,j.height],thinningCenterPos:[ce,Ae],thinningShape:[_e,Ie,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:Ce,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:re?0:1},{u_modelview:Float32Array.from(De.modelview),u_projection:Float32Array.from(De.projection),u_time:De.time,u_cam_pos:De.camPos,u_texScreen:0,u_velocityConeAperture:De.velocityConeAperture,u_velocity:De.velocity,u_boxSize:De.boxSize,u_rainDropletSize:De.rainDropletSize,u_distortionStrength:De.distortionStrength,u_rainDirection:De.rainDirection,u_color:De.color,u_screenSize:De.screenSize,u_thinningCenterPos:De.thinningCenterPos,u_thinningShape:De.thinningShape,u_thinningAffectedRatio:De.thinningAffectedRatio,u_thinningParticleOffset:De.thinningParticleOffset,u_shapeDirectionalPower:De.shapeDirectionalPower,u_shapeNormalPower:De.shapeNormalPower,u_mode:De.mode});var De;const Ge=Math.round(b.intensity*this.particlesCount),Ue=r.bf.simpleSegment(0,0,4*Ge,2*Ge);B.draw(t,F.TRIANGLES,pi.disabled,Hi.disabled,an.alphaBlended,Ni.disabled,Te,"rain_particles",this.particlesVx,this.particlesIdx,Ue)};b.distortionStrength>0&&Z(b.boxSize,!0),Z(b.boxSize,!1),this._vignette.draw(t,R)}}const Uu=r.eh([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class sy extends qc{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new uo(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const p=pf(this.particlesCount),y=new r.eN,b=new r.b0;let T=0;const R=r.eq(1323123451230);for(let D=0;D<p.length;++D){const L=p[D],F=R(),j=R(),B=R(),$=[D/p.length,F,j,B],Z=[R(),R()];y.emplaceBack(L[0],L[1],L[2],-1,-1,...$,...Z),y.emplaceBack(L[0],L[1],L[2],1,-1,...$,...Z),y.emplaceBack(L[0],L[1],L[2],1,1,...$,...Z),y.emplaceBack(L[0],L[1],L[2],-1,1,...$,...Z),b.emplaceBack(T+0,T+1,T+2),b.emplaceBack(T+0,T+2,T+3),T+=4}this.particlesVx=a.createVertexBuffer(y,Uu.members),this.particlesIdx=a.createIndexBuffer(b)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const a=structuredClone(this._params);let p=[-a.direction.x,a.direction.y,-100];r.aw(p,p);const y=structuredClone(this._vignetteParams),b=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},T=t.transform.zoom;if(b.revealStart>T)return;const R=Wo(0,1,b.revealStart,b.revealStart+b.revealRange,T);y.strength*=R,a.overrideStyleParameters||(a.intensity=t.style.snow.state.density,a.timeFactor=t.style.snow.state.intensity,a.color=structuredClone(t.style.snow.state.color),p=structuredClone(t.style.snow.state.direction),a.screenThinning.intensity=t.style.snow.state.centerThinning,a.billboardSize=2.79*t.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(t.style.snow.state.vignetteColor));const D=this.updateOnRender(t,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const L=t.context,F=L.gl,j=t.transform,B=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(L,B),(($,Z,Q)=>{const re=dn(this._movement.getPosition(),$),te=j.width/2,se=j.height/2,me=Wo(0,Q.screenThinning.start,0,1,Q.screenThinning.intensity),ce=Wo(.001,Q.screenThinning.range,0,1,Q.screenThinning.intensity),Ae=Wo(0,Q.screenThinning.particleOffset,0,1,Q.screenThinning.intensity),_e=(Ie={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:re,velocityConeAperture:Q.velocityConeAperture,velocity:Q.velocity,horizontalOscillationRadius:Q.horizontalOscillationRadius,horizontalOscillationRate:Q.horizontalOscillationRate,boxSize:$,billboardSize:1*Q.billboardSize,simpleShapeParameters:[Q.shapeFadeStart,Q.shapeFadePower],screenSize:[j.width,j.height],thinningCenterPos:[te,se],thinningShape:[me,ce,Math.pow(10,Q.screenThinning.fadePower)],thinningAffectedRatio:Q.screenThinning.affectedRatio,thinningParticleOffset:Ae,color:[Q.color.r,Q.color.g,Q.color.b,Q.color.a],direction:p},{u_modelview:Float32Array.from(Ie.modelview),u_projection:Float32Array.from(Ie.projection),u_time:Ie.time,u_cam_pos:Ie.camPos,u_velocityConeAperture:Ie.velocityConeAperture,u_velocity:Ie.velocity,u_horizontalOscillationRadius:Ie.horizontalOscillationRadius,u_horizontalOscillationRate:Ie.horizontalOscillationRate,u_boxSize:Ie.boxSize,u_billboardSize:Ie.billboardSize,u_simpleShapeParameters:Ie.simpleShapeParameters,u_screenSize:Ie.screenSize,u_thinningCenterPos:Ie.thinningCenterPos,u_thinningShape:Ie.thinningShape,u_thinningAffectedRatio:Ie.thinningAffectedRatio,u_thinningParticleOffset:Ie.thinningParticleOffset,u_particleColor:Ie.color,u_direction:Ie.direction});var Ie;const Ce=Math.round(Q.intensity*this.particlesCount),Te=r.bf.simpleSegment(0,0,4*Ce,2*Ce);this.particlesVx&&this.particlesIdx&&B.draw(t,F.TRIANGLES,pi.disabled,Hi.disabled,an.alphaBlended,Ni.disabled,_e,"snow_particles",this.particlesVx,this.particlesIdx,Te)})(a.boxSize,0,a),this._vignette.draw(t,y)}}const ly={symbol:function(f,t,a,p,y){if(f.renderPass!=="translucent")return;const b=Hi.disabled,T=f.colorModeForRenderPass(),R=a.layout.get("text-variable-anchor"),D=a.layout.get("text-size-scale-range"),L=r.aA(f.scaleFactor,D[0],D[1]);R&&function(B,$,Z,Q,re,te,se,me){const ce=$.transform,Ae=re==="map",_e=te==="map";for(const Ie of B){const Ce=Q.getTile(Ie),Te=Ce.getBucket(Z);if(!Te||!Te.text||!Te.text.segments.get().length)continue;const De=r.bJ(Te.textSizeData,ce.zoom,me),Ge=uh(Ie,Te.getProjection(),ce),Ue=ce.calculatePixelsToTileUnitsMatrix(Ce),nt=Xt(Ge,Ce.tileID.canonical,_e,Ae,ce,Te.getProjection(),Ue),Ke=Te.hasIconTextFit()&&Te.hasIconData();De&&Th(Te,Ae,_e,se,ce,nt,Ie,Math.pow(2,ce.zoom-Ce.tileID.overscaledZ),De,Ke)}}(p,f,a,t,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),y,L);const F=a.paint.get("icon-opacity").constantOr(1)!==0,j=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(F||j)?$c(f,t,a,p,b,T):(F&&$c(f,t,a,p,b,T,{onlyIcons:!0}),j&&$c(f,t,a,p,b,T,{onlyText:!0})),t.map.showCollisionBoxes&&(Op(f,t,a,p,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),Op(f,t,a,p,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(f,t,a,p){if(f.renderPass!=="translucent")return;const y=a.paint.get("circle-opacity"),b=a.paint.get("circle-stroke-width"),T=a.paint.get("circle-stroke-opacity"),R=a.layout.get("circle-sort-key").constantOr(1)!==void 0,D=a.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(b.constantOr(1)===0||T.constantOr(1)===0))return;const L=f.context,F=L.gl,j=f.transform,B=!(!f.terrain||!f.terrain.enabled),$=a.layout.get("circle-elevation-reference"),Z=f.depthModeForSublayer(0,pi.ReadOnly),Q=new pi(f.context.gl.LEQUAL,pi.ReadOnly,f.depthRangeFor3D),re=$==="none"||B?Z:Q,te=Hi.disabled,se=f.colorModeForDrapableLayerRenderPass(D),me=j.projection.name==="globe",ce=[r.aF(j.center.lng),r.aJ(j.center.lat)],Ae=[];for(let Ie=0;Ie<p.length;Ie++){const Ce=p[Ie],Te=t.getTile(Ce),De=Te.getBucket(a);if(!De||De.projection.name!==j.projection.name)continue;const Ge=De.programConfigurations.get(a.id),Ue=De.layoutVertexBuffer,nt=De.globeExtVertexBuffer,Ke=De.indexBuffer,st=r.d$(a),Pt=[nt],Ze=f.isTileAffectedByFog(Ce);me&&st.push("PROJECTION_GLOBE_VIEW"),st.push("DEPTH_D24"),f.terrain&&j.depthOcclusionForSymbolsAndCircles&&st.push("DEPTH_OCCLUSION"),De.hasElevation&&!f.terrain&&(st.push("ELEVATED_ROADS"),Pt.push(De.elevatedLayoutVertexBuffer));const ze=f.getOrCreateProgram("circle",{config:Ge,defines:st,overrideFog:Ze}),lt=j.projection.createInversionMatrix(j,Ce.canonical),Je={programConfiguration:Ge,program:ze,layoutVertexBuffer:Ue,dynamicBuffers:Pt,indexBuffer:Ke,uniformValues:r.e0(f,Ce,Te,lt,ce,a),tile:Te};if(R){const bt=De.segments.get();for(const Ft of bt)Ae.push({segments:new r.bf([Ft]),sortKey:Ft.sortKey,state:Je})}else Ae.push({segments:De.segments,sortKey:0,state:Je})}R&&Ae.sort((Ie,Ce)=>Ie.sortKey-Ce.sortKey);const _e={useDepthForOcclusion:j.depthOcclusionForSymbolsAndCircles};for(const Ie of Ae){const{programConfiguration:Ce,program:Te,layoutVertexBuffer:De,dynamicBuffers:Ge,indexBuffer:Ue,uniformValues:nt,tile:Ke}=Ie.state,st=Ie.segments;f.terrain&&f.terrain.setupElevationDraw(Ke,Te,_e),f.uploadCommonUniforms(L,Te,Ke.tileID.toUnwrapped()),Te.draw(f,F.TRIANGLES,re,te,se,Ni.disabled,nt,a.id,De,Ue,st,a.paint,j.zoom,Ce,Ge)}},heatmap:function(f,t,a,p){if(a.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const y=f.context,b=y.gl,T=Hi.disabled,R=new an([b.ONE,b.ONE,b.ONE,b.ONE],r.ao.transparent,[!0,!0,!0,!0]);(function($,Z,Q,re){const te=$.gl,se=Z.width*re,me=Z.height*re;$.activeTexture.set(te.TEXTURE1),$.viewport.set([0,0,se,me]);let ce=Q.heatmapFbo;if(!ce||ce&&(ce.width!==se||ce.height!==me)){ce&&ce.destroy();const Ae=te.createTexture();te.bindTexture(te.TEXTURE_2D,Ae),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MAG_FILTER,te.LINEAR),ce=Q.heatmapFbo=$.createFramebuffer(se,me,!0,null),function(_e,Ie,Ce,Te,De,Ge){const Ue=_e.gl;Ue.texImage2D(Ue.TEXTURE_2D,0,_e.extRenderToTextureHalfFloat?Ue.RGBA16F:Ue.RGBA,De,Ge,0,Ue.RGBA,_e.extRenderToTextureHalfFloat?Ue.HALF_FLOAT:Ue.UNSIGNED_BYTE,null),Te.colorAttachment.set(Ce)}($,0,Ae,ce,se,me)}else te.bindTexture(te.TEXTURE_2D,ce.colorAttachment.get()),$.bindFramebuffer.set(ce.framebuffer)})(y,f,a,f.transform.projection.name==="globe"?.5:.25),y.clear({color:r.ao.transparent});const D=f.transform,L=D.projection.name==="globe",F=L?["PROJECTION_GLOBE_VIEW"]:[],j=L?Ni.frontCCW:Ni.disabled,B=[r.aF(D.center.lng),r.aJ(D.center.lat)];for(let $=0;$<p.length;$++){const Z=p[$];if(t.hasRenderableParent(Z))continue;const Q=t.getTile(Z),re=Q.getBucket(a);if(!re||re.projection.name!==D.projection.name)continue;const te=f.isTileAffectedByFog(Z),se=re.programConfigurations.get(a.id),me=f.getOrCreateProgram("heatmap",{config:se,defines:F,overrideFog:te}),{zoom:ce}=f.transform;f.terrain&&f.terrain.setupElevationDraw(Q,me),f.uploadCommonUniforms(y,me,Z.toUnwrapped());const Ae=D.projection.createInversionMatrix(D,Z.canonical);me.draw(f,b.TRIANGLES,pi.disabled,T,R,j,ux(f,Z,Q,Ae,B,ce,a.paint.get("heatmap-intensity")),a.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,a.paint,f.transform.zoom,se,L?[re.globeExtVertexBuffer]:null)}y.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(y,b){const T=y.context,R=T.gl,D=b.heatmapFbo;if(!D)return;T.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,D.colorAttachment.get()),T.activeTexture.set(R.TEXTURE1);let L=b.colorRampTexture;L||(L=b.colorRampTexture=new r.T(T,b.colorRamp,R.RGBA8)),L.bind(R.LINEAR,R.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,R.TRIANGLES,pi.disabled,Hi.disabled,y.colorModeForRenderPass(),Ni.disabled,((F,j,B,$)=>({u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}))(0,b),b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)}(f,a))},line:function(f,t,a,p){if(f.renderPass!=="translucent")return;const y=a.paint.get("line-opacity"),b=a.paint.get("line-width");if(y.constantOr(1)===0||b.constantOr(1)===0)return;const T=a.paint.get("line-emissive-strength"),R=a.paint.get("line-occlusion-opacity"),D=a.layout.get("line-elevation-reference"),L=a.layout.get("line-width-unit")==="meters",F=D==="sea",j=!(!f.terrain||!f.terrain.enabled),B=f.context,$=B.gl;if(a.hasElevatedBuckets&&f.transform.projection.name==="globe")return;const Z=a.layout.get("line-cross-slope"),Q=Z!==void 0,re=Z<1,te=f.colorModeForDrapableLayerRenderPass(T),se=f.terrain&&f.terrain.renderingToTexture,me=se?1:r.o.devicePixelRatio,ce=a.paint.get("line-dasharray"),Ae=ce.constantOr(1),_e=a.layout.get("line-cap"),Ie=ce.constantOr(null),Ce=_e.constantOr(null),Te=a.paint.get("line-pattern"),De=Te.constantOr(1),Ge=a.paint.get("line-pattern-cross-fade"),Ue=Te.constantOr(null),nt=a.paint.get("line-opacity").constantOr(1);let Ke=!De&&nt!==1||f.depthOcclusion&&R>0&&R<1;const st=a.paint.get("line-gradient"),Pt=De?"linePattern":"line",Ze=r.e1(a);let ze;if(se&&f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(Ke=!1),R!==0&&f.depthOcclusion){const Ft=a.paint._values["line-opacity"];Ft&&Ft.value&&Ft.value.kind==="constant"?ze=Ft.value:r.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&Ze.push("VARIABLE_LINE_WIDTH");const lt=(Ft,ci,Mt,Ot,di,ei)=>{for(const Jt of Ft){const ti=t.getTile(Jt);if(De&&!ti.patternsLoaded())continue;const Ii=ti.getBucket(a);if(!Ii||Ii.elevationType!=="none"&&!di||Ii.elevationType==="none"&&di)continue;f.prepareDrawTile();const yn=[...ci],An=f.shadowRenderer,_r=Ii.elevationType==="road"&&!!An&&An.enabled;let Bi=[0,0,0];if(_r){const Fi=f.style.directionalLight,zn=f.style.ambientLight;Fi&&zn&&(Bi=xl(f.style,Fi,zn)),yn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const In=Ii.programConfigurations.get(a.id);let tn=!1;if(Ue&&ti.imageAtlas){const Fi=r.e2.from(Ue),zn=Fi.getPrimary().scaleSelf(me).toString(),$r=ti.imageAtlas.patternPositions.get(zn),va=Fi.getSecondary(),Xr=va?ti.imageAtlas.patternPositions.get(va.scaleSelf(me).toString()):null;tn=!!$r&&!!Xr,$r&&In.setConstantPatternPositions($r,Xr)}Ge>0&&(tn||In.getPatternTransitionVertexBuffer("line-pattern"))&&yn.push("LINE_PATTERN_TRANSITION");const dr=f.isTileAffectedByFog(Jt),Pn=f.getOrCreateProgram(Pt,{config:In,defines:yn,overrideFog:dr});if(!De&&Ie&&Ce&&ti.lineAtlas){const Fi=ti.lineAtlas.getDash(Ie,Ce);Fi&&In.setConstantPatternPositions(Fi)}_r&&An.setupShadows(ti.tileID.toUnwrapped(),Pn,"vector-tile");let[Cr,jn]=a.paint.get("line-trim-offset");(Ce==="round"||Ce==="square")&&Cr!==jn&&(Cr===0&&(Cr-=1),jn===1&&(jn+=1));const on=se?Jt.projMatrix:null,tr=L?1/Ii.tileToMeter/r.ay(ti,1,f.transform.zoom):1,un=L?1/Ii.tileToMeter/r.ay(ti,1,Math.floor(f.transform.zoom)):1,kr=De?r.e3(f,ti,a,on,me,tr,un,[Cr,jn],Bi,Ge):r.e4(f,ti,a,on,Ii.lineClipsArray.length,me,tr,un,[Cr,jn],Bi);if(st){const Fi=Ii.gradients[a.id];let zn=Fi.texture;if(a.gradientVersion!==Fi.version){let $r=256;if(a.stepInterpolant){const va=t.getSource().maxzoom,Xr=Jt.canonical.z===va?Math.ceil(1<<f.transform.maxZoom-Jt.canonical.z):1;$r=r.aA(r.e5(Ii.maxLineLength/r.al*1024*Xr),256,B.maxTextureSize)}Fi.gradient=r.e6({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:$r,image:Fi.gradient||void 0,clips:Ii.lineClipsArray}),Fi.texture?Fi.texture.update(Fi.gradient):Fi.texture=new r.T(B,Fi.gradient,$.RGBA8),Fi.version=a.gradientVersion,zn=Fi.texture}B.activeTexture.set($.TEXTURE1),zn.bind(a.stepInterpolant?$.NEAREST:$.LINEAR,$.CLAMP_TO_EDGE)}Ae&&(B.activeTexture.set($.TEXTURE0),ti.lineAtlasTexture&&ti.lineAtlasTexture.bind($.LINEAR,$.REPEAT),In.updatePaintBuffers()),De&&(B.activeTexture.set($.TEXTURE0),ti.imageAtlasTexture&&ti.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),In.updatePaintBuffers()),di&&!F&&f.terrain.setupElevationDraw(ti,Pn),f.uploadCommonUniforms(B,Pn,Jt.toUnwrapped());const Xn=Fi=>{ze!=null&&(ze.value=nt*R),Pn.draw(f,$.TRIANGLES,Mt,Fi,te,Ni.disabled,kr,a.id,Ii.layoutVertexBuffer,Ii.indexBuffer,Ii.segments,a.paint,f.transform.zoom,In,[Ii.layoutVertexBuffer2,Ii.patternVertexBuffer,Ii.zOffsetVertexBuffer]),ze!=null&&(ze.value=nt)};if(Ke&&!di){const Fi=f.stencilModeForClipping(Jt).ref;Fi===0&&se&&B.clear({stencil:0});const zn={func:$.EQUAL,mask:255};kr.u_alpha_discard_threshold=.8,Xn(new Hi(zn,Fi,255,$.KEEP,$.KEEP,$.INVERT)),kr.u_alpha_discard_threshold=0,Xn(new Hi(zn,Fi,255,$.KEEP,$.KEEP,$.KEEP))}else kr.u_alpha_discard_threshold=Ke&&di&&ei?.8:0,Xn(di?Ot:f.stencilModeForClipping(Jt))}};let Je=f.depthModeForSublayer(0,pi.ReadOnly);const bt=new pi(f.depthOcclusion?$.GREATER:$.LEQUAL,pi.ReadOnly,f.depthRangeFor3D);if(a.hasNonElevatedBuckets){const Ft=!se&&f.terrain;R!==0&&Ft?r.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):Ft?r.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):lt(p,Ze,Je,Hi.disabled,!1,!0)}if(a.hasElevatedBuckets){D==="hd-road-markup"?j||(Je=bt,Ze.push("ELEVATED_ROADS")):(Ze.push("ELEVATED"),Je=bt,Q&&Ze.push(re?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),F&&Ze.push("ELEVATION_REFERENCE_SEA"));const Ft=Ke?f.stencilModeFor3D():Hi.disabled;f.forceTerrainMode=!0,lt(p,Ze,Je,Ft,!0,!0),Ke&&lt(p,Ze,Je,Ft,!0,!1),f.forceTerrainMode=!1}Ke&&(f.resetStencilClippingMasks(),se&&B.clear({stencil:0})),R===0||f.depthOcclusion||se||f.layersWithOcclusionOpacity.push(f.currentLayer)},fill:function(f,t,a,p){const y=a.paint.get("fill-color"),b=a.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const T=a.paint.get("fill-emissive-strength"),R=f.colorModeForDrapableLayerRenderPass(T),D=a.paint.get("fill-pattern"),L=f.opaquePassEnabledForLayer()&&!D.constantOr(1)&&y.constantOr(r.ao.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let F="none";a.layout.get("fill-elevation-reference")!=="none"?F="road":a.paint.get("fill-z-offset").constantOr(1)!==0&&(F="offset");const j=!(!f.terrain||!f.terrain.enabled),B={painter:f,sourceCache:t,layer:a,coords:p,colorMode:R,elevationType:F,terrainEnabled:j,pass:L};if(f.renderPass!=="shadow")if(F!=="offset"){if(cf(B,!1),F==="road"){const $=!j&&f.renderPass==="translucent";$&&yd(f,t,a,p,"geometry"),cf(B,!0,Hi.disabled),$&&function(Z){const{painter:Q,sourceCache:re,layer:te,coords:se,colorMode:me}=Z,ce=Q.context.gl,Ae=Z.painter.shadowRenderer,_e=!!Ae&&Ae.enabled,Ie=new pi(Q.context.gl.LEQUAL,pi.ReadOnly,Q.depthRangeFor3D);let Ce=[0,0,0];if(_e){const De=Q.style.directionalLight,Ge=Q.style.ambientLight;De&&Ge&&(Ce=xl(Q.style,De,Ge))}const Te=De=>{for(const Ge of se){const Ue=re.getTile(Ge),nt=Ue.getBucket(te);if(!nt)continue;const Ke=nt.elevatedStructures;if(!Ke)continue;let st,Pt;if(De?(st=Ke.renderableBridgeSegments,Pt=Ke.bridgeProgramConfigurations.get(te.id)):(st=Ke.renderableTunnelSegments,Pt=Ke.tunnelProgramConfigurations.get(te.id)),!st||st.segments[0].primitiveLength===0)continue;Pt.updatePaintBuffers(),Q.prepareDrawTile();const Ze=Q.isTileAffectedByFog(Ge),ze=[];_e&&ze.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const lt=Q.getOrCreateProgram("elevatedStructures",{config:Pt,overrideFog:Ze,defines:ze}),Je=Q.translatePosMatrix(Ge.projMatrix,Ue,te.paint.get("fill-translate"),te.paint.get("fill-translate-anchor"));_e&&Ae.setupShadows(Ue.tileID.toUnwrapped(),lt,"vector-tile");const bt=Nb(Je,Ce);Q.uploadCommonUniforms(Q.context,lt,Ge.toUnwrapped()),lt.draw(Q,ce.TRIANGLES,Ie,Hi.disabled,me,Ni.backCCW,bt,te.id,Ke.vertexBuffer,Ke.indexBuffer,st,te.paint,Q.transform.zoom,Pt,[Ke.vertexBufferNormal])}};Te(!0),Te(!1)}(B)}}else cf(B,!1,f.stencilModeFor3D());else f.shadowRenderer&&F==="road"&&!j&&function($){const{painter:Z,sourceCache:Q,layer:re,coords:te}=$,se=Z.context.gl,me=$.painter.shadowRenderer;for(const ce of te){const Ae=Q.getTile(ce),_e=Ae.getBucket(re);if(!_e)continue;const Ie=_e.elevatedStructures;if(!Ie||!Ie.shadowCasterSegments||Ie.shadowCasterSegments.segments[0].primitiveLength===0)continue;Z.prepareDrawTile();const Ce=_e.bufferData.programConfigurations.get(re.id),Te=Z.isTileAffectedByFog(ce),De=Z.getOrCreateProgram("elevatedStructuresDepth",{config:Ce,overrideFog:Te}),Ge=me.calculateShadowPassMatrixFromTile(Ae.tileID.toUnwrapped());Z.uploadCommonUniforms(Z.context,De,ce.toUnwrapped());const Ue={u_matrix:Ge,u_depth_bias:0};De.draw(Z,se.TRIANGLES,me.getShadowPassDepthMode(),Hi.disabled,me.getShadowPassColorMode(),Ni.disabled,Ue,re.id,Ie.vertexBuffer,Ie.indexBuffer,Ie.shadowCasterSegments,re.paint,Z.transform.zoom,Ce)}}(B)},"fill-extrusion":function(f,t,a,p){const y=a.paint.get("fill-extrusion-opacity"),b=f.context,T=b.gl,R=f.terrain,D=R&&R.renderingToTexture;if(y===0)return;const L=f.conflationActive&&f.style.isLayerClipped(a,t.getSource()),F=f.style.order.indexOf(a.fqid);if(L&&function(j,B,$,Z,Q){for(const re of Z){const te=B.getTile(re).getBucket($);te&&(te.updateReplacement(re,j.replacementSource,Q),te.uploadCentroid(j.context))}}(f,t,a,p,F),R||L)for(const j of p){const B=t.getTile(j).getBucket(a);B&&Fu(f.context,t,j,B,a,R,L)}if(f.renderPass==="shadow"&&f.shadowRenderer){const j=f.shadowRenderer;if(R&&y<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.ad)return;const B=j.getShadowPassDepthMode(),$=j.getShadowPassColorMode();ai(f,t,a,p,B,Hi.disabled,$,L)}else if(f.renderPass==="translucent"){const j=!a.paint.get("fill-extrusion-pattern").constantOr(1),B=a.paint.get("fill-extrusion-color").constantOr(r.ao.white);if(!D&&B.a!==0){const $=new pi(f.context.gl.LEQUAL,pi.ReadWrite,f.depthRangeFor3D);y===1&&j?ai(f,t,a,p,$,Hi.disabled,an.unblended,L):(ai(f,t,a,p,$,Hi.disabled,an.disabled,L),ai(f,t,a,p,$,f.stencilModeFor3D(),f.colorModeForRenderPass(),L),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&j&&(!R&&f.transform.projection.name!=="globe"||D)){const $=a.paint.get("fill-extrusion-opacity"),Z=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),Q=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),re=a.paint.get("fill-extrusion-flood-light-intensity"),te=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",se=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(te?null:a.lut).toArray01().slice(0,3),me=Z>0&&Q>0,ce=re>0,Ae=(Ce,Te,De)=>(1-De)*Ce+De*Te,_e=new J_;_e.translate=a.paint.get("fill-extrusion-translate"),_e.translateAnchor=a.paint.get("fill-extrusion-translate-anchor"),_e.edgeRadius=a.layout.get("fill-extrusion-edge-radius"),_e.cutoffFadeRange=a.paint.get("fill-extrusion-cutoff-fade-range");const Ie=Ce=>{const Te=f.depthModeForSublayer(1,pi.ReadOnly,T.LEQUAL,!0),De=a.paint.get(Ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ge=Ae(.1,3,De),Ue=f._showOverdrawInspector;if(!Ue){const nt=new Hi({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Ke=new an([T.ONE,T.ONE,T.ONE,T.ONE],r.ao.transparent,[!1,!1,!1,!0],T.MIN);Wc(_e,f,t,a,p,Te,nt,Ke,Ni.disabled,Ce,"sdf",$,Z,Q,re,se,Ge,L,!1)}{const nt=Ue?Hi.disabled:new Hi({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),Ke=Ue?f.colorModeForRenderPass():new an([T.ONE_MINUS_DST_ALPHA,T.DST_ALPHA,T.ONE,T.ONE],r.ao.transparent,[!0,!0,!0,!0]);Wc(_e,f,t,a,p,Te,nt,Ke,Ni.disabled,Ce,"color",$,Z,Q,re,se,Ge,L,!1)}};if(D){const Ce=(Te,De,Ge)=>{const Ue=f.depthModeForSublayer(1,pi.ReadOnly,T.LEQUAL,!1),nt=a.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ke=Ae(.1,3,nt);{const st=new an([T.ONE,T.ONE,T.ONE,T.ONE],r.ao.transparent,[!1,!1,!1,!0]);Wc(_e,f,t,a,p,Ue,Hi.disabled,st,Ni.disabled,Te,"clear",$,Z,Q,re,se,Ke,L,De)}{const st=new Hi({func:T.ALWAYS,mask:255},255,255,T.KEEP,T.KEEP,T.REPLACE),Pt=new an([T.ONE,T.ONE,T.ONE,T.ONE],r.ao.transparent,[!1,!1,!1,!0],T.MIN);Wc(_e,f,t,a,p,Ue,st,Pt,Ni.disabled,Te,"sdf",$,Z,Q,re,se,Ke,L,De)}{const st=Te?T.ZERO:T.ONE_MINUS_DST_ALPHA,Pt=new Hi({func:T.EQUAL,mask:255},255,255,T.KEEP,T.DECR,T.DECR),Ze=new an([st,T.DST_ALPHA,T.ONE_MINUS_DST_ALPHA,T.ZERO],r.ao.transparent,[!0,!0,!0,!0]);Wc(_e,f,t,a,p,Ue,Pt,Ze,Ni.disabled,Te,"color",$,Z,Q,re,se,Ke,L,De)}{const st=new an([T.ONE,T.ONE,T.ONE,Te?T.ZERO:T.ONE],r.ao.transparent,[!1,!1,!1,!0],Te?T.FUNC_ADD:T.MAX);Wc(_e,f,t,a,p,Ue,Hi.disabled,st,Ni.disabled,Te,"clear",$,Z,Q,re,se,Ke,L,De,Ge)}};if(me||ce){let Te;if(f.prepareDrawTile(),R){const De=R.drapeBufferSize[0],Ge=R.drapeBufferSize[1];Te=R.framebufferCopyTexture,Te&&(!Te||Te.size[0]===De&&Te.size[1]===Ge)||(Te&&Te.destroy(),Te=R.framebufferCopyTexture=new r.T(b,new r.q({width:De,height:Ge}),T.RGBA8)),Te.bind(T.LINEAR,T.CLAMP_TO_EDGE),T.copyTexSubImage2D(T.TEXTURE_2D,0,0,0,0,0,De,Ge)}me&&Ce(!0,!1,Te),ce&&Ce(!1,!0,Te)}}else me&&Ie(!0),ce&&Ie(!1),(me||ce)&&f.resetStencilClippingMasks()}}},building:function(f,t,a,p){f.currentLayer<f.firstLightBeamLayer&&(f.firstLightBeamLayer=f.currentLayer);const y=a.paint.get("building-ambient-occlusion-ground-intensity"),b=a.paint.get("building-ambient-occlusion-ground-radius"),T=a.paint.get("building-ambient-occlusion-ground-attenuation"),R=a.paint.get("building-opacity");if(R<=0)return;let D=y>0&&b>0,L=!0;const F=a.paint.get("building-vertical-scale");if(F<=0)return;(!f.shadowRenderer||F<1)&&(L=!1);const j=f.conflationActive&&f.style.isLayerClipped(a,t.getSource()),B=f.style.order.indexOf(a.fqid);if(function($,Z,Q,re,te,se){for(const me of se){const ce=Z.getTile(me).getBucket(Q);ce&&(te&&ce.updateReplacement(me,$.replacementSource,re),ce.uploadUpdatedIndexBuffer($.context))}}(f,t,a,B,j,p),function($,Z,Q,re){for(const te of re){const se=Z.getTile(te).getBucket(Q);se&&se.needsEvaluation()&&se.uploadUpdatedColorBuffer($.context)}}(f,t,a,p),a.resetLayerRenderingStats(f),f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0),f.renderPass==="shadow"&&f.shadowRenderer){const $=f.shadowRenderer,Z=[],Q=$.getShadowPassDepthMode();hg({painter:f,source:t,layer:a,coords:p,defines:Z,blendMode:$.getShadowPassColorMode(),depthMode:Q,opacity:R,verticalScale:F,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(f.renderPass==="translucent"){let $=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];L&&($=$.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),f.shadowRenderer&&f.shadowRenderer.useNormalOffset&&($=$.concat("NORMAL_OFFSET"));const Z=a.paint.get("building-facade-emissive-chance"),Q=a.paint.get("building-ambient-occlusion-intensity"),re=a.paint.get("building-flood-light-intensity"),te=a.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",se=a.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(te?null:a.lut).toArray01().slice(0,3),me=a.paint.get("building-flood-light-ground-attenuation"),ce=re>0,Ae=new pi(f.context.gl.LEQUAL,pi.ReadWrite,f.depthRangeFor3D);R<1&&hg({painter:f,source:t,layer:a,coords:p,defines:$,blendMode:an.disabled,depthMode:Ae,opacity:R,verticalScale:F,facadeEmissiveChance:Z,facadeAOIntensity:Q,floodLightIntensity:re,floodLightColor:se,depthOnly:!0});const _e=f.colorModeForRenderPass();hg({painter:f,source:t,layer:a,coords:p,defines:$,blendMode:_e,depthMode:Ae,opacity:R,verticalScale:F,facadeEmissiveChance:Z,facadeAOIntensity:Q,floodLightIntensity:re,floodLightColor:se}),D&&dg(f,t,a,p,!0,R,y,b,re,se,T,j),ce&&dg(f,t,a,p,!1,R,y,b,re,se,me,j)}else if(f.renderPass==="light-beam"){const $=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],Z=new pi(f.context.gl.LEQUAL,pi.ReadOnly,f.depthRangeFor3D);hg({painter:f,source:t,layer:a,coords:p,defines:$,blendMode:an.alphaBlended,depthMode:Z,opacity:R,verticalScale:F,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1),f.resetStencilClippingMasks()},hillshade:function(f,t,a,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;const y=f.context,b=f.terrain&&f.terrain.renderingToTexture,[T,R]=f.renderPass!=="translucent"||b?[{},p]:f.stencilConfigForOverlap(p);for(const D of R){const L=t.getTile(D);if(L.needsHillshadePrepare&&f.renderPass==="offscreen")ix(f,L,a);else if(f.renderPass==="translucent"){const F=f.depthModeForSublayer(0,pi.ReadOnly),j=a.paint.get("hillshade-emissive-strength"),B=f.colorModeForDrapableLayerRenderPass(j),$=b&&f.terrain?f.terrain.stencilModeForRTTOverlap(D):T[D.overscaledZ];tx(f,D,L,a,F,$,B)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,t,a,p,y,b){if(f.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const T=f.transform.projection.name==="globe",R=a.paint.get("raster-elevation")!==0,D=R&&T;if(f.renderElevatedRasterBackface&&!D)return;const L=f.context,F=L.gl,j=t.getSource(),B=function(_e,Ie,Ce,Te){const De=Ie.paint.get("raster-color"),Ge=_e.type==="raster-array",Ue=[],nt=Ie.paint.get("raster-resampling"),Ke=Ie.paint.get("raster-color-mix");let st=Ie.paint.get("raster-color-range");const Pt=[Ke[0],Ke[1],Ke[2],0],Ze=Ke[3];let ze=nt==="nearest"?Te.NEAREST:Te.LINEAR;if(Ge&&(Ue.push("RASTER_ARRAY"),De||Ue.push("RASTER_COLOR"),nt==="linear"&&Ue.push("RASTER_ARRAY_LINEAR"),ze=Te.NEAREST,!st&&_e.rasterLayers)){const lt=_e.rasterLayers.find(({id:Je})=>Je===Ie.sourceLayer);lt&&lt.fields&&lt.fields.range&&(st=lt.fields.range)}if(st=st||[0,1],De){Ue.push("RASTER_COLOR"),Ce.activeTexture.set(Te.TEXTURE2),Ie.updateColorRamp(st);let lt=Ie.colorRampTexture;lt||(lt=Ie.colorRampTexture=new r.T(Ce,Ie.colorRamp,Te.RGBA8)),lt.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}return{mix:Pt,range:st,offset:Ze,defines:Ue,resampling:ze}}(j,a,L,F);if(j instanceof r.aT&&!p.length&&!T)return;const $=a.paint.get("raster-emissive-strength"),Z=f.colorModeForDrapableLayerRenderPass($),Q=f.terrain&&f.terrain.renderingToTexture,re=!f.options.moving,te=a.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR;if(j instanceof r.aT&&!p.length&&(j.onNorthPole||j.onSouthPole)){const _e=R?f.stencilModeFor3D():Hi.disabled;return void ey(!!j.onNorthPole,null,f,t,a,$,B,Ni.disabled,_e)}if(!p.length)return;const[se,me]=j instanceof r.aT||Q?[{},p]:f.stencilConfigForOverlap(p),ce=me[me.length-1].overscaledZ;D&&B.defines.push("PROJECTION_GLOBE_VIEW"),R&&B.defines.push("RENDER_CUTOFF");const Ae=(_e,Ie,Ce)=>{for(const Te of _e){const De=Te.toUnwrapped(),Ge=t.getTile(Te);if(Q&&(!Ge||!Ge.hasData()))continue;L.activeTexture.set(F.TEXTURE0);const Ue=Ub(Ge,j,a,B);if(!Ue||!Ue.texture)continue;const{texture:nt,mix:Ke,offset:st,tileSize:Pt,buffer:Ze}=Ue;let ze,lt;Q?(ze=pi.disabled,lt=Te.projMatrix):R?(ze=new pi(F.LEQUAL,pi.ReadWrite,f.depthRangeFor3D),lt=T?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(De,re)):(ze=f.depthModeForSublayer(Te.overscaledZ-ce,a.paint.get("raster-opacity")===1?pi.ReadWrite:pi.ReadOnly,F.LESS),lt=f.transform.calculateProjMatrix(De,re));const Je=f.terrain&&Q?f.terrain.stencilModeForRTTOverlap(Te):se[Te.overscaledZ],bt=b?0:a.paint.get("raster-fade-duration");Ge.registerFadeDuration(bt);const Ft=t.findLoadedParent(Te,0),ci=eg(Ge,Ft,t,f.transform,bt);let Mt,Ot;!ci.isFading&&Ge.refreshedUponExpiration&&(Ge.refreshedUponExpiration=!1),f.terrain&&f.terrain.prepareDrawTile(),L.activeTexture.set(F.TEXTURE0),nt.bind(te,F.CLAMP_TO_EDGE),L.activeTexture.set(F.TEXTURE1),Ft?(Ft.texture&&Ft.texture.bind(te,F.CLAMP_TO_EDGE),Mt=Math.pow(2,Ft.tileID.overscaledZ-Ge.tileID.overscaledZ),Ot=[Ge.tileID.canonical.x*Mt%1,Ge.tileID.canonical.y*Mt%1]):nt.bind(te,F.CLAMP_TO_EDGE),"useMipmap"in nt&&L.extTextureFilterAnisotropic&&f.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const di=f.transform;let ei;const Jt=R?ty(di):[0,0,0,0];let ti,Ii,yn,An,_r,Bi=0;if(D&&j instanceof r.aT&&j.coordinates.length>3)ti=Float32Array.from(r.bj(r.dI(new r.cC(0,0,0)))),Ii=Float32Array.from(di.globeMatrix),yn=Float32Array.from(r.dE(di)),An=[r.aF(di.center.lng),r.aJ(di.center.lat)],ei=j.elevatedGlobePerspectiveTransform,_r=j.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){const Pn=r.dF(Te.canonical);Bi=r.dG(Pn.getCenter().lat),ti=Float32Array.from(r.bj(r.dI(Te.canonical))),Ii=Float32Array.from(di.globeMatrix),yn=Float32Array.from(r.dE(di)),An=[r.aF(di.center.lng),r.aJ(di.center.lat)],ei=[0,0],_r=Float32Array.from(r.dH(Te.canonical,Pn,Bi,di.worldSize/di._pixelsPerMercatorPixel))}else ei=j instanceof r.aT?j.perspectiveTransform:[0,0],ti=new Float32Array(16),Ii=new Float32Array(9),yn=new Float32Array(16),An=[0,0],_r=new Float32Array(9);const In=yo(lt,ti,Ii,yn,_r,Ot||[0,0],r.aj(f.transform.zoom),An,Jt,Mt||1,ci,a,ei,R?a.paint.get("raster-elevation"):0,2,Ke,st,B.range,Pt,Ze,$),tn=f.isTileAffectedByFog(Te),dr=f.getOrCreateProgram("raster",{defines:B.defines,overrideFog:tn});if(f.uploadCommonUniforms(L,dr,De),j instanceof r.aT){const Pn=j.elevatedGlobeVertexBuffer,Cr=j.elevatedGlobeIndexBuffer;if(Q||!T)j.boundsBuffer&&j.boundsSegments&&dr.draw(f,F.TRIANGLES,ze,Hi.disabled,Z,Ni.disabled,In,a.id,j.boundsBuffer,f.quadTriangleIndexBuffer,j.boundsSegments);else if(Pn&&Cr){const jn=di.zoom<=r.cZ?j.elevatedGlobeSegments:j.getSegmentsForLongitude(di.center.lng);jn&&dr.draw(f,F.TRIANGLES,ze,Hi.disabled,Z,Ie,In,a.id,Pn,Cr,jn)}}else if(D){ze=new pi(F.LEQUAL,pi.ReadOnly,f.depthRangeFor3D);const Pn=f.globeSharedBuffers;if(Pn){const[Cr,jn,on]=Pn.getGridBuffers(Bi,!1);dr.draw(f,F.TRIANGLES,ze,Ce||Je,f.colorModeForRenderPass(),Ie,In,a.id,Cr,jn,on)}}else{const{tileBoundsBuffer:Pn,tileBoundsIndexBuffer:Cr,tileBoundsSegments:jn}=f.getTileBoundsBuffers(Ge);dr.draw(f,F.TRIANGLES,ze,Je,Z,Ni.disabled,In,a.id,Pn,Cr,jn)}}if(!(j instanceof r.aT)&&D)for(const Te of _e){const De=Te.canonical.y===(1<<Te.canonical.z)-1;Te.canonical.y===0&&ey(!0,Te,f,t,a,$,B,Ie,Ce||Hi.disabled),De&&ey(!1,Te,f,t,a,$,B,Ie===Ni.frontCW?Ni.backCW:Ni.frontCW,Ce||Hi.disabled)}};D?Ae(me,f.renderElevatedRasterBackface?Ni.backCW:Ni.frontCW,f.stencilModeFor3D()):Ae(me,Ni.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,t,a,p,y,b){f.renderPass==="offscreen"&&function(T,R,D,L){if(!L.length)return;const F=T.context,j=F.gl,B=R.getSource();if(!(B instanceof Ia))return;const $=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count")));let Z=D.particlePositionRGBAImage;if(!Z||Z.width!==$){const me=function(ce){const Ae=ce*ce,_e=new Uint8Array(4*Ae),Ie=function(Te){return Te|=0,Te=Math.imul(2747636419^Te,2654435769),Te=Math.imul(Te^Te>>>16,2654435769),((Te=Math.imul(Te^Te>>>16,2654435769))>>>0)/4294967296},Ce=1/1.1;for(let Te=0;Te<Ae;Te++){const De=Ce*(Ie(2*Te+0)+Gc),Ge=Ce*(Ie(2*Te+1)+Gc),Ue=255*De%1,nt=255*Ge%1,Ke=Ue,st=Ge-nt/255,Pt=nt;_e[4*Te+0]=255*(De-Ue/255),_e[4*Te+1]=255*Ke,_e[4*Te+2]=255*st,_e[4*Te+3]=255*Pt}return _e}($);Z=D.particlePositionRGBAImage=new r.q({width:$,height:$},me)}let Q=D.particleFramebuffer;Q?Q.width!==$&&(Q.destroy(),Q=D.particleFramebuffer=F.createFramebuffer($,$,!0,null)):Q=D.particleFramebuffer=F.createFramebuffer($,$,!0,null);const re=[];for(const me of L){const ce=R.getTile(me);if(!(ce instanceof fa))continue;const Ae=Sn(ce,B,D);if(!Ae)continue;const _e=[ce.tileSize,ce.tileSize];let Ie=D.tileFramebuffer;Ie||(Ie=D.tileFramebuffer=F.createFramebuffer(_e[0],_e[1],!0,null));let Ce=ce.rasterParticleState;Ce||(Ce=ce.rasterParticleState=new Ss(F,me,_e,Z));const Te=Ce.update(D.lastInvalidatedAt);Ce.particleTextureDimension!==$&&Ce.updateParticleTexture(me,Z);const De=Ce.targetColorTexture;Ce.targetColorTexture=Ce.backgroundColorTexture,Ce.backgroundColorTexture=De;const Ge=Ce.particleTexture0;Ce.particleTexture0=Ce.particleTexture1,Ce.particleTexture1=Ge,re.push([me,Ae,Ce,Te])}if(re.length===0)return;const te=r.o.now(),se=D.previousDrawTimestamp?.001*(te-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=te,D.hasColorMap()){F.activeTexture.set(j.TEXTURE0+2);let me=D.colorRampTexture;me||(me=D.colorRampTexture=new r.T(F,D.colorRamp,j.RGBA8)),me.bind(j.LINEAR,j.CLAMP_TO_EDGE)}F.bindFramebuffer.set(D.tileFramebuffer.framebuffer),function(me,ce,Ae){const _e=me.context,Ie=_e.gl,Ce=ce.tileFramebuffer;_e.activeTexture.set(Ie.TEXTURE0);const Te={u_texture:0,u_opacity:1.05*(Ge=ce.paint.get("raster-particle-fade-opacity-factor"))/(Ge+.05)},De=me.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ge;for(const Ue of Ae){const[,,nt,Ke]=Ue;Ce.colorAttachment.set(nt.targetColorTexture.texture),_e.viewport.set([0,0,Ce.width,Ce.height]),_e.clear({color:r.ao.transparent}),Ke&&(nt.backgroundColorTexture.bind(Ie.NEAREST,Ie.CLAMP_TO_EDGE),De.draw(me,Ie.TRIANGLES,pi.disabled,Hi.disabled,an.alphaBlended,Ni.disabled,Te,ce.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments))}}(T,D,re),function(me,ce,Ae,_e){const Ie=me.context,Ce=Ie.gl,Te=Ae.tileFramebuffer,De=me.transform.projection.name==="globe",Ge=Ae.paint.get("raster-particle-max-speed");for(const Ue of _e){const[nt,Ke,st]=Ue;Ie.activeTexture.set(Ce.TEXTURE0+0),Ke.texture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),Te.colorAttachment.set(st.targetColorTexture.texture);const Pt=me.getOrCreateProgram("rasterParticleDraw",{defines:Ke.defines,overrideFog:!1});Ie.activeTexture.set(Ce.TEXTURE0+1);const Ze=Ke.scalarData?[]:[0,1,2,3].map(Je=>r.e8[Je](nt));Ze.push(nt);const ze=nt.canonical.x,lt=nt.canonical.y;for(const Je of Ze){const bt=ce.getTile(De?Je.wrapped():Je);if(!bt)continue;const Ft=bt.rasterParticleState;if(!Ft)continue;const ci=Je.canonical.x+(1<<Je.canonical.z)*(Je.wrap-nt.wrap),Mt=Je.canonical.y;Ft.particleTexture0.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE);const Ot=Lu(1,Ft.particleTexture0.size[0],[ci-ze,Mt-lt],0,Ke.texture.size,2,Ge,Ke.textureOffset,Ke.scale,Ke.offset);Pt.draw(me,Ce.POINTS,pi.disabled,Hi.disabled,an.alphaBlended,Ni.disabled,Ot,Ae.id,Ft.particleIndexBuffer,void 0,Ft.particleSegment)}}}(T,R,D,re),F.bindFramebuffer.set(D.particleFramebuffer.framebuffer),function(me,ce,Ae,_e){const Ie=me.context,Ce=Ie.gl,Te=ce.paint.get("raster-particle-max-speed"),De=_e*ce.paint.get("raster-particle-speed-factor")*.15,Ge=function(nt){return Math.pow(nt,6)}(.01+1*ce.paint.get("raster-particle-reset-rate-factor")),Ue=ce.particleFramebuffer;Ie.viewport.set([0,0,Ue.width,Ue.height]);for(const nt of Ae){const[,Ke,st]=nt;Ie.activeTexture.set(Ce.TEXTURE0+0),Ke.texture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE),Ie.activeTexture.set(Ce.TEXTURE0+1);const Pt=st.particleTexture0;Pt.bind(Ce.NEAREST,Ce.CLAMP_TO_EDGE);const Ze=og(1,Pt.size[0],0,Ke.texture.size,Te,De,Ge,Ke.textureOffset,Ke.scale,Ke.offset);Ue.colorAttachment.set(st.particleTexture1.texture),Ie.clear({color:r.ao.transparent}),me.getOrCreateProgram("rasterParticleUpdate",{defines:Ke.defines}).draw(me,Ce.TRIANGLES,pi.disabled,Hi.disabled,an.unblended,Ni.disabled,Ze,ce.id,me.viewportBuffer,me.quadTriangleIndexBuffer,me.viewportSegments)}}(T,D,re,se)}(f,t,a,p),f.renderPass==="translucent"&&(function(T,R,D,L,F){const j=T.context,B=j.gl,$=R.getSource().tileSize,Z=5*(1-r.ah(r.cK,r.cK+1,T.transform.zoom))*$+D.paint.get("raster-particle-elevation"),Q=!T.options.moving,re=T.transform.projection.name==="globe";if(!L.length)return;const[te,se]=T.stencilConfigForOverlap(L),me=[];re&&me.push("PROJECTION_GLOBE_VIEW");const ce=T.stencilModeFor3D();for(const Ae of se){const _e=Ae.toUnwrapped(),Ie=R.getTile(Ae);if(!Ie.rasterParticleState)continue;const Ce=Ie.rasterParticleState,Te=100;Ie.registerFadeDuration(Te);const De=R.findLoadedParent(Ae,0),Ge=eg(Ie,De,R,T.transform,Te);let Ue,nt;T.terrain&&T.terrain.prepareDrawTile(),j.activeTexture.set(B.TEXTURE0),Ce.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),j.activeTexture.set(B.TEXTURE1),De&&De.rasterParticleState?(De.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Ue=Math.pow(2,De.tileID.overscaledZ-Ie.tileID.overscaledZ),nt=[Ie.tileID.canonical.x*Ue%1,Ie.tileID.canonical.y*Ue%1]):Ce.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const Ke=re?Float32Array.from(T.transform.expandedFarZProjMatrix):T.transform.calculateProjMatrix(_e,Q),st=T.transform,Pt=Ln(st),Ze=r.dF(Ae.canonical),ze=r.dG(Ze.getCenter().lat);let lt,Je,bt,Ft,ci;re?(lt=Float32Array.from(r.bj(r.dI(Ae.canonical))),Je=Float32Array.from(st.globeMatrix),bt=Float32Array.from(r.dE(st)),Ft=[r.aF(st.center.lng),r.aJ(st.center.lat)],ci=Float32Array.from(r.dH(Ae.canonical,Ze,ze,st.worldSize/st._pixelsPerMercatorPixel))):(lt=new Float32Array(16),Je=new Float32Array(9),bt=new Float32Array(16),Ft=[0,0],ci=new Float32Array(9));const Mt=Hc(Ke,lt,Je,bt,ci,nt||[0,0],r.aj(T.transform.zoom),Ft,Pt,Ue||1,Ge,Z),Ot=T.isTileAffectedByFog(Ae),di=T.getOrCreateProgram("rasterParticle",{defines:me,overrideFog:Ot});if(T.uploadCommonUniforms(j,di,_e),re){const ei=new pi(B.LEQUAL,pi.ReadOnly,T.depthRangeFor3D),Jt=0,ti=T.globeSharedBuffers;if(ti){const[Ii,yn,An]=ti.getGridBuffers(ze,Jt!==0);di.draw(T,B.TRIANGLES,ei,ce,an.alphaBlended,T.renderElevatedRasterBackface?Ni.frontCCW:Ni.backCCW,Mt,D.id,Ii,yn,An)}}else{const ei=T.depthModeForSublayer(0,pi.ReadOnly),Jt=te[Ae.overscaledZ],{tileBoundsBuffer:ti,tileBoundsIndexBuffer:Ii,tileBoundsSegments:yn}=T.getTileBoundsBuffers(Ie);di.draw(T,B.TRIANGLES,ei,Jt,an.alphaBlended,Ni.disabled,Mt,D.id,ti,Ii,yn)}}T.resetStencilClippingMasks()}(f,t,a,p),f.style.map.triggerRepaint())},background:function(f,t,a,p){const y=a.paint.get("background-color"),b=a.paint.get("background-color-use-theme").constantOr("default")==="none",T=a.paint.get("background-opacity"),R=a.paint.get("background-emissive-strength"),D=a.paint.get("background-pitch-alignment")==="viewport";if(T===0)return;const L=f.context,F=L.gl,j=f.transform,B=j.tileSize,$=a.paint.get("background-pattern");let Z;if($!==void 0&&($===null||(Z=f.imageManager.getPattern(r.I.from($.toString()),a.scope,f.style.getLut(a.scope)),!Z)))return;const Q=!$&&y.a===1&&T===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==Q)return;const re=Hi.disabled,te=f.depthModeForSublayer(0,Q==="opaque"?pi.ReadWrite:pi.ReadOnly),se=f.colorModeForDrapableLayerRenderPass(R),me=$?"backgroundPattern":"background";let ce,Ae=p;if(Ae||(ce=f.getBackgroundTiles(),Ae=Object.values(ce).map(_e=>_e.tileID)),$&&(L.activeTexture.set(F.TEXTURE0),f.imageManager.bind(f.context,a.scope)),D){const _e=f.getOrCreateProgram(me,{overrideFog:!1,overrideRtt:!0}),Ie=new Float32Array(r.bz([])),Ce=new r.aP(0,0,0,0,0),Te=$?zu(Ie,R,T,f,0,a.scope,Z,D,{tileID:Ce,tileSize:B}):sg(Ie,R,T,y.toPremultipliedRenderColor(b?null:a.lut));_e.draw(f,F.TRIANGLES,te,re,se,Ni.disabled,Te,a.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments)}else for(const _e of Ae){const Ie=f.isTileAffectedByFog(_e),Ce=f.getOrCreateProgram(me,{overrideFog:Ie}),Te=_e.toUnwrapped(),De=p?_e.projMatrix:f.transform.calculateProjMatrix(Te);f.prepareDrawTile();const Ge=t?t.getTile(_e):ce?ce[_e.key]:new Ba(_e,B,j.zoom,f),Ue=$?zu(De,R,T,f,0,a.scope,Z,D,{tileID:_e,tileSize:B}):sg(De,R,T,y.toPremultipliedRenderColor(b?null:a.lut));f.uploadCommonUniforms(L,Ce,Te);const{tileBoundsBuffer:nt,tileBoundsIndexBuffer:Ke,tileBoundsSegments:st}=f.getTileBoundsBuffers(Ge);Ce.draw(f,F.TRIANGLES,te,re,se,Ni.disabled,Ue,a.id,nt,Ke,st)}},sky:function(f,t,a){const p=f._atmosphere?r.aj(f.transform.zoom):1,y=a.paint.get("sky-opacity")*p;if(y===0)return;const b=f.context,T=a.paint.get("sky-type"),R=new pi(b.gl.LEQUAL,pi.ReadOnly,[0,1]),D=f.frameCounter/1e3%1;T==="atmosphere"?f.renderPass==="offscreen"?a.needsSkyboxCapture(f)&&(function(L,F,j,B){const $=L.context,Z=$.gl;let Q=F.skyboxFbo;if(!Q){Q=F.skyboxFbo=$.createFramebuffer(32,32,!0,null),F.skyboxGeometry=new Nu($),F.skyboxTexture=$.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,F.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let me=0;me<6;++me)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+me,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}$.bindFramebuffer.set(Q.framebuffer),$.viewport.set([0,0,32,32]);const re=F.getCenter(L,!0),te=L.getOrCreateProgram("skyboxCapture"),se=new Float64Array(16);r.bz(se),r.em(se,se,.5*-Math.PI),Eo(L,F,te,se,re,0),r.bz(se),r.em(se,se,.5*Math.PI),Eo(L,F,te,se,re,1),r.bz(se),r.cT(se,se,.5*-Math.PI),Eo(L,F,te,se,re,2),r.bz(se),r.cT(se,se,.5*Math.PI),Eo(L,F,te,se,re,3),r.bz(se),Eo(L,F,te,se,re,4),r.bz(se),r.em(se,se,Math.PI),Eo(L,F,te,se,re,5),$.viewport.set([0,0,L.width,L.height])}(f,a),a.markSkyboxValid(f)):f.renderPass==="sky"&&function(L,F,j,B,$){const Z=L.context,Q=Z.gl,re=L.transform,te=L.getOrCreateProgram("skybox");Z.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_CUBE_MAP,F.skyboxTexture);const se=((me,ce,Ae,_e,Ie)=>({u_matrix:me,u_sun_direction:ce,u_cubemap:0,u_opacity:_e,u_temporal_offset:Ie}))(re.skyboxMatrix,F.getCenter(L,!1),0,B,$);L.uploadCommonUniforms(Z,te),te.draw(L,Q.TRIANGLES,j,Hi.disabled,L.colorModeForRenderPass(),Ni.backCW,se,"skybox",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(f,a,R,y,D):T==="gradient"&&f.renderPass==="sky"&&function(L,F,j,B,$){const Z=L.context,Q=Z.gl,re=L.transform,te=L.getOrCreateProgram("skyboxGradient");F.skyboxGeometry||(F.skyboxGeometry=new Nu(Z)),Z.activeTexture.set(Q.TEXTURE0);let se=F.colorRampTexture;se||(se=F.colorRampTexture=new r.T(Z,F.colorRamp,Q.RGBA8)),se.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const me=((ce,Ae,_e,Ie,Ce)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:Ae,u_radius:r.an(_e),u_opacity:Ie,u_temporal_offset:Ce}))(re.skyboxMatrix,F.getCenter(L,!1),F.paint.get("sky-gradient-radius"),B,$);L.uploadCommonUniforms(Z,te),te.draw(L,Q.TRIANGLES,j,Hi.disabled,L.colorModeForRenderPass(),Ni.backCW,me,"skyboxGradient",F.skyboxGeometry.vertexBuffer,F.skyboxGeometry.indexBuffer,F.skyboxGeometry.segment)}(f,a,R,y,D)},custom:function(f,t,a,p){const y=f.context,b=a.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&a.isDraped(t)){if(f.renderPass==="offscreen"){const T=b.prerender;if(T){if(f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const R=f.transform.pointMerc;T.call(b,y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),r.aj(f.transform.zoom),[R.x,R.y],f.transform.pixelsPerMeterRatio)}else T.call(b,y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const R=b.renderToTile;if(R){const D=p[0].canonical,L={x:D.x+p[0].wrap*(b.wrapTileId?0:1<<D.z),y:D.y,z:D.z};y.setDepthMode(pi.disabled),y.setStencilMode(Hi.disabled),y.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),R.call(b,y.gl,L),y.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),y.setStencilMode(Hi.disabled);const T=b.renderingMode==="3d"?new pi(f.context.gl.LEQUAL,pi.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,pi.ReadOnly);if(y.setDepthMode(T),f.transform.projection.name==="globe"){const R=f.transform.pointMerc;b.render(y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),r.aj(f.transform.zoom),[R.x,R.y],f.transform.pixelsPerMeterRatio)}else b.render(y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState(),y.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,t,a,p){if(f.renderPass==="opaque")return;const y=a.paint.get("model-opacity").constantOr(1),b=a.paint.get("model-elevation-reference"),T=b==="ground",R=b==="ground";if(y===0)return;const D=a.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!D||f.terrain&&y<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof r.ad))return;const L=f.shadowRenderer,F=a.paint.get("model-receive-shadows");L&&(L.useNormalOffset=!0,F||(L.enabled=!1));const j=()=>{L&&(L.useNormalOffset=!0,F||(L.enabled=!0))},B=t.getSource();if(f.renderPass==="light-beam"&&B.type!=="batched-model")return;if(B.type==="vector"||B.type==="geojson")return function(ce,Ae,_e,Ie,Ce){const Te=ce.transform,De=Te.projection.name==="globe",Ge=Te.getFreeCameraOptions().position;if(!ce.modelManager)return;const Ue=ce.modelManager;_e.modelManager=Ue;const nt=ce.shadowRenderer;if(!_e._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ke=_e._unevaluatedLayout._values["model-id"],st=Object.assign({},_e.layout.get("model-id").parameters),Pt=ce.style.order.indexOf(_e.fqid);for(const Ze of Ie){const ze=Ae.getTile(Ze).getBucket(_e);if(!ze||ze.projection.name!==Te.projection.name)continue;const lt=ze.getModelUris();if(lt&&!ze.modelsRequested&&(Ue.addModelsFromBucket(lt,Ce),ze.modelsRequested=!0),De)st.zoom=Ze.overscaledZ;else{const ei=zp(Ze,Te);st.zoom=ei}const Je=Ke.possiblyEvaluate(st);if(gg(ce,ze,Ze),zs.shadowUniformsInitialized=!1,zs.useSingleShadowCascade=!!nt&&nt.getMaxCascadeForTile(Ze.toUnwrapped())===0,ce.renderPass==="shadow"&&nt){if(ce.currentShadowCascade===1&&ze.isInsideFirstShadowMapFrustum)continue;const ei=Te.calculatePosMatrix(Ze.toUnwrapped(),Te.worldSize);if(zs.tileMatrix.set(ei),zs.shadowTileMatrix=Float32Array.from(nt.calculateShadowPassMatrixFromMatrix(ei)),zs.aabb.min=[0,0,0],zs.aabb.max[0]=zs.aabb.max[1]=r.al,zs.aabb.max[2]=0,ff(ze,zs,ce,_e.scope))continue}const bt=1<<Ze.canonical.z,Ft=[((Ge.x-Ze.wrap)*bt-Ze.canonical.x)*r.al,(Ge.y*bt-Ze.canonical.y)*r.al,Ge.z*bt*r.al];ce.conflationActive&&Object.keys(ze.instancesPerModel).length>0&&ce.style.isLayerClipped(_e,Ae.getSource())&&ze.updateReplacement(Ze,ce.replacementSource,Pt,Ce)&&(ze.uploaded=!1,ze.upload(ce.context));let ci=0;const Mt=new Array,Ot=new Array,di=new Array;for(let ei in ze.instancesPerModel){const Jt=ze.instancesPerModel[ei];Jt.features.length>0&&!De&&(ei=Je.evaluate(Jt.features[0].feature,{}));const ti=Ue.getModel(ei,Ce);if(ti||Ue.hasURLBeenRequested(ei)||ze.modelUris.includes(ei)||(ze.modelUris.push(ei),ze.modelsRequested=!1),ti&&ti.uploaded)if(De){const Ii=r.c4([],[Ge.x,Ge.y,Ge.z],ce.transform.worldSize);r.ev(Ii,Ii);for(let yn=0;yn<Jt.instancedDataArray.length;++yn){const An=[0,0,0],_r=[1,1,1],Bi=r.ew(),In=Jt.tileCoordinatesForInstance(yn),tn=Jt.transformForInstance(yn);r.ex(_r,tn),r.ey(Bi,tn),r.ez(An,Bi);const dr=Jt.translationForInstance(yn),Pn=new r.aS(0,0);r.eA(ze.canonical,Pn,In.x,In.y);const Cr=r.bB();r.eB(Cr,ti,ce.transform,Pn,An,_r,dr,!0,!1,!1);const jn=Jt.colorForInstance(yn),on=r.bz([]),tr=r.ee(Pn.lat,ce.transform.zoom),un=r.bp([],[1,1,1/tr]);r.bq(on,on,Ii),di.push({zScaleMatrix:un,negCameraPosMatrix:on});for(const kr of ti.nodes)hf(ce,kr,Cr,ce.transform.expandedFarZProjMatrix,ci,Mt,Ot,ti.materialOverrides,jn);++ci}}else for(const Ii of ti.nodes)df(ce,_e,Ii,Jt,Ft,Ze,zs)}if(De)if(ce.renderPass==="shadow"){for(const ei of Ot)Rh(ei.mesh,ei.nodeModelMatrix,ce,_e);for(const ei of Mt)Rh(ei.mesh,ei.nodeModelMatrix,ce,_e)}else mg(ce,_e,1,Mt,Ot,di)}}(f,t,a,p,uf(B,a,f.style._importedAsBasemap)),void j();if(!B.loaded())return;if(B.type==="batched-model")return function(ce,Ae,_e,Ie){_e.resetLayerRenderingStats(ce);const Ce=ce.context,Te=ce.transform,De=ce.style.fog,Ge=ce.shadowRenderer;if(Te.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${Te.projection.name} projection is not yet implemented`);const Ue=ce.transform.getFreeCameraOptions().position,nt=r.c4([],[Ue.x,Ue.y,Ue.z],ce.transform.worldSize),Ke=r.ev([],nt),st=r.bz([]),Pt=r.ee(Te.center.lat,Te.zoom),Ze=r.bp([],[1,1,1/Pt]);r.bq(st,st,Ke);const ze=_e.paint.get("model-opacity").constantOr(1),lt=new pi(Ce.gl.LEQUAL,pi.ReadWrite,ce.depthRangeFor3D),Je=new pi(Ce.gl.LEQUAL,pi.ReadOnly,ce.depthRangeFor3D),bt=new r.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ft=ce.renderPass==="shadow",ci=Ft&&Ge?Ge.getCurrentCascadeFrustum():Te.getFrustum(Te.scaleZoom(Te.worldSize)),Mt=_e.paint.get("model-front-cutoff"),Ot=Mt[2]<1,di=Cu(ce,_e.paint.get("model-cutoff-fade-range")),ei=_e.getLayerRenderingStats();(function(Jt,ti,Ii,yn){const An=Jt.terrain?Jt.terrain.exaggeration():0,_r=Jt.transform.zoom;for(const Bi of yn){const In=ti.getTile(Bi).getBucket(Ii);In&&(In.setFilter(Ii.filter),Jt.conflationActive&&In.updateReplacement(Bi,Jt.replacementSource),In.evaluateTransform(Jt,Ii),Jt.terrain&&An>0&&In.elevationUpdate(Jt.terrain,An,Bi,Ii.source),In.needsReEvaluation(Jt,_r,Ii)&&In.evaluate(Ii))}})(ce,Ae,_e,Ie),function(){let Jt,ti,Ii;Ot?(Jt=Ie.length-1,ti=-1,Ii=-1):(Jt=0,ti=Ie.length,Ii=1);const yn=new Float64Array(16),An=r.cz(),_r=new r.P(0,0);for(let Bi=Jt;Bi!==ti;Bi+=Ii){const In=Ie[Bi],tn=Ae.getTile(In).getBucket(_e);if(!tn||!tn.uploaded)continue;let dr=!1;Ge&&(dr=Ge.getMaxCascadeForTile(In.toUnwrapped())===0);const Pn=Te.calculatePosMatrix(In.toUnwrapped(),Te.worldSize),Cr=tn.modelTraits;!Ft&&Ot&&(r.bk(yn,Pn),r.af(An,nt,yn),_r.x=An[0],_r.y=An[1]);const jn=[];tn.setFilter(_e.filter);for(const on of tn.getNodesInfo()){if(on.hiddenByReplacement||!on.node.meshes)continue;const tr=on.node;let un=0;ce.terrain&&tr.elevation&&(un=tr.elevation*ce.terrain.exaggeration());const kr=(()=>{const es=on.aabb;return bt.min=[...es.min],bt.max=[...es.max],bt.min[2]+=un,bt.max[2]+=un,r.af(bt.min,bt.min,Pn),r.af(bt.max,bt.max,Pn),bt})(),Xn=on.evaluatedScale;if(Xn[0]<=1&&Xn[1]<=1&&Xn[2]<=1&&kr.intersects(ci)===0)continue;if(!Ft&&Ot){const es=.16666666666666666;on.cameraCollisionOpacity=nt[0]>kr.min[0]&&nt[0]<kr.max[0]&&nt[1]>kr.min[1]&&nt[1]<kr.max[1]&&nt[2]*Pt<kr.max[2]&&tr.footprint&&r.b$(_r,tr.footprint)?Math.max(on.cameraCollisionOpacity-es,0):Math.min(1,on.cameraCollisionOpacity+es)}const Fi=[...Pn],zn=1/r.d6(In.canonical),$r=tr.anchor?tr.anchor[0]:0,va=tr.anchor?tr.anchor[1]:0;r.bq(Fi,Fi,[$r*(Xn[0]-1)+on.evaluatedTranslation[0]*zn,va*(Xn[1]-1)+on.evaluatedTranslation[1]*zn,un+on.evaluatedTranslation[2]]),r.cp(Xn,r.eD)||r.cR(Fi,Fi,Xn);const Xr=r.aB([],Fi,tr.globalMatrix),pa=r.aB([],Te.expandedFarZProjMatrix,Xr),Cs=r.aB([],Te.expandedFarZProjMatrix,Fi),As=r.aC([],[$r,va,un,1],pa)[2];tr.hidden=!1;let Zo=ze;Ft||(Ot&&(Zo*=on.cameraCollisionOpacity,Zo*=Bu(Fi,Te,on.aabb,Mt)),Zo*=bd(di,As)),Zo!==0?jn.push({nodeInfo:on,depth:As,opacity:Zo,wvpForNode:pa,wvpForTile:Cs,nodeModelMatrix:Xr,tileModelMatrix:Fi}):tr.hidden=!0}Ft||jn.sort((on,tr)=>!Ot||on.opacity===1&&tr.opacity===1?on.depth<tr.depth?-1:1:on.opacity===1?-1:tr.opacity===1?1:on.depth>tr.depth?-1:1);for(const on of jn){const tr=on.nodeInfo,un=tr.node;let kr=r.aB([],Ze,on.tileModelMatrix);r.aB(kr,st,kr);const Xn=r.bk([],kr);r.ef(Xn,Xn),r.cR(Xn,Xn,xd),kr=r.aB(kr,kr,un.globalMatrix);const Fi=ce.renderPass==="light-beam",zn=_e.paint.get("model-color-use-theme").constantOr("default")==="none",$r=Cr&r.eH.HasMapboxMeshFeatures,va=$r?0:tr.evaluatedRMEA[0][2];for(let Xr=0;Xr<un.meshes.length;++Xr){const pa=un.meshes[Xr],Cs=Xr===un.lightMeshIndex;let As=on.wvpForNode;if(Cs){if(!Fi&&!ce.terrain&&ce.shadowRenderer){ce.currentLayer<ce.firstLightBeamLayer&&(ce.firstLightBeamLayer=ce.currentLayer);continue}As=on.wvpForTile}else if(Fi)continue;const Zo={defines:[]},es=[];if(!Ft&&Ge&&(Ge.useNormalOffset=!!pa.normalBuffer),Ch(Zo.defines,es,pa,ce,zn?null:_e.lut),$r||Zo.defines.push("DIFFUSE_SHADED"),dr&&Zo.defines.push("SHADOWS_SINGLE_CASCADE"),ei&&(Ft?ei.numRenderedVerticesInShadowPass+=pa.vertexArray.length:ei.numRenderedVerticesInTransparentPass+=pa.vertexArray.length),Ft){Rh(pa,on.nodeModelMatrix,ce,_e);continue}let nl=null;if(De){const Ea=Lp(on.nodeModelMatrix,ce.transform);if(nl=new Float32Array(Ea),Te.projection.name!=="globe"){const br=pa.aabb.min,ka=pa.aabb.max,[Ro,ia]=De.getOpacityForBounds(Ea,br[0],br[1],ka[0],ka[1]);Zo.overrideFog=Ro>=$e||ia>=$e}}const Lo=pa.material;let rl;Lo.occlusionTexture&&Lo.occlusionTexture.offsetScale&&(rl=Lo.occlusionTexture.offsetScale,Zo.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const fs=ce.getOrCreateProgram("model",Zo);!Ft&&Ge&&Ge.setupShadowsFromMatrix(on.tileModelMatrix,fs,Ge.useNormalOffset),ce.uploadCommonUniforms(Ce,fs,null,nl);const Ao=Lo.pbrMetallicRoughness;Ao.metallicFactor=.9,Ao.roughnessFactor=.5;const ca=qi(new Float32Array(As),new Float32Array(kr),new Float32Array(Xn),new Float32Array(un.globalMatrix),ce,on.opacity,Ao.baseColorFactor,Lo.emissiveFactor,Ao.metallicFactor,Ao.roughnessFactor,Lo,va,_e,[0,0,0],rl);!Cs&&(tr.hasTranslucentParts||on.opacity<1)&&fs.draw(ce,Ce.gl.TRIANGLES,lt,Hi.disabled,an.disabled,Ni.backCCW,ca,_e.id,pa.vertexBuffer,pa.indexBuffer,pa.segments,_e.paint,ce.transform.zoom,void 0,es),fs.draw(ce,Ce.gl.TRIANGLES,Cs?Je:lt,Hi.disabled,Cs||on.opacity<1||tr.hasTranslucentParts?an.alphaBlended:an.unblended,Ni.backCCW,ca,_e.id,pa.vertexBuffer,pa.indexBuffer,pa.segments,_e.paint,ce.transform.zoom,void 0,es)}}}}()}(f,t,a,p),void j();if(B.type!=="model")return;const $=B.getModels(),Z=[],Q=f.transform.getFreeCameraOptions().position,re=r.c4([],[Q.x,Q.y,Q.z],f.transform.worldSize);r.ev(re,re);const te=[],se=[];let me=0;for(const ce of $){const Ae=t.getFeatureState("",ce.id),_e={type:"Unknown",id:ce.id,properties:ce.featureProperties},Ie=a.paint.get("model-rotation").evaluate(_e,Ae),Ce=a.paint.get("model-scale").evaluate(_e,Ae),Te=a.paint.get("model-translation").evaluate(_e,Ae);Ih(a,ce.id,Ae,ce.featureProperties,ce.nodeOverrideNames,ce.nodeOverrides),ry(a,ce.id,Ae,ce.featureProperties,ce.materialOverrideNames,ce.materialOverrides),ce.nodeOverrides.size>0&&ce.computeBoundsAndApplyParent(),ce.computeModelMatrix(f,Ie,Ce,Te,R,T,!1);const De=r.bz([]),Ge=r.ee(ce.position.lat,f.transform.zoom),Ue=r.bp([],[1,1,1/Ge]);r.bq(De,De,re),Z.push({zScaleMatrix:Ue,negCameraPosMatrix:De});for(const nt of ce.nodes)hf(f,nt,ce.matrix,f.transform.expandedFarZProjMatrix,me,te,se,ce.materialOverrides);me++}if(te.sort((ce,Ae)=>Ae.depth-ce.depth),f.renderPass!=="shadow")mg(f,a,y,te,se,Z),j();else{for(const ce of se)Rh(ce.mesh,ce.nodeModelMatrix,f,a);for(const ce of te)Rh(ce.mesh,ce.nodeModelMatrix,f,a);j()}}},gf={line:function(f,t,a){if(f.hasElevatedBuckets=!1,f.hasNonElevatedBuckets=!1,f._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||f._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const p=t.getVisibleCoordinates();for(const y of p){const b=t.getTile(y).getBucket(f);if(b&&(b.elevationType!=="none"?f.hasElevatedBuckets=!0:f.hasNonElevatedBuckets=!0,f.hasElevatedBuckets&&f.hasNonElevatedBuckets))break}}}else f.hasNonElevatedBuckets=!0},model:function(f,t,a){const p=t.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson"){const b=uf(p,f,a.style._importedAsBasemap);return void(a.modelManager&&a.modelManager.upload(a,b))}if(p.type==="batched-model"||p.type!=="model")return;const y=p.getModels();for(const b of y)b.upload(a.context)},raster:function(f,t,a){const p=t.getSource();if(!(p instanceof Ia&&p.loaded()))return;const y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const b=f.paint.get("raster-array-band")||p.getInitialBand(y);if(b==null)return;const T=t.getIds().map(R=>t.getTileByID(R));for(const R of T)R.updateNeeded(f.id,b)&&p.prepareTile(R,y,f.id,b)},"raster-particle":function(f,t,a){const p=t.getSource();if(!(p instanceof Ia&&p.loaded()))return;const y=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!y)return;const b=f.paint.get("raster-particle-array-band")||p.getInitialBand(y);if(b==null)return;const T=t.getIds().map(R=>t.getTileByID(R));for(const R of T)R.updateNeeded(f.id,b)&&p.prepareTile(R,y,f.id,b)}},yg={fill:yd},Fs={fill:function(f,t,a,p){if(!a.layout||a.layout.get("fill-elevation-reference")==="none"||a.paint.get("fill-opacity").constantOr(1)===0)return;const y=f.context.gl,b=new pi(y.LEQUAL,pi.ReadOnly,f.depthRangeFor3D),T=new Hi({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),R=f.transform.getFreeCameraOptions().position,D=f.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const L of p){const F=t.getTile(L),j=F.getBucket(a);if(!j)continue;const B=j.elevatedStructures;if(!B||B.depthSegments.segments[0].primitiveLength===0)continue;const $=dx(L.toUnwrapped(),R),Z=f.translatePosMatrix(L.projMatrix,F,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),Q=Mp(Z,$,0,1,0);D.draw(f,y.TRIANGLES,b,T,an.disabled,Ni.disabled,Q,a.id,B.vertexBuffer,B.indexBuffer,B.depthSegments,a.paint,f.transform.zoom)}}};class Vu{constructor(t,a,p,y,b,T){this.context=new cg(t,a),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=r.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const R=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const L of R)this._debugParams.enabledLayers[L]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const L of R)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],L);this.occlusionParams=new Fp(b),this.setup(),this.numSublayers=Ha.maxUnderzooming+Ha.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.eO,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new vp(this),this._wireframeDebugCache=new ay,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const D=new r.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,D,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y,this.worldview=T}updateTerrain(t,a){const p=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new rf(this,t));const y=this._terrain;this.transform.elevation=p?y:null,y.update(t,this.transform,a),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(t){const a=t.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,y]=a.getFovAdjustedRange(this.transform._fov);if(p>y)return void(this.transform.fogCullDistSq=null);const b=p+.78*(y-p);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new rf(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,a){if(this.width=t*r.o.devicePixelRatio,this.height=a*r.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const t=this.context,a=new r.bc;a.emplaceBack(0,0),a.emplaceBack(r.al,0),a.emplaceBack(0,r.al),a.emplaceBack(r.al,r.al),this.tileExtentBuffer=t.createVertexBuffer(a,r.be.members),this.tileExtentSegments=r.bf.simpleSegment(0,0,4,2);const p=new r.bc;p.emplaceBack(0,0),p.emplaceBack(r.al,0),p.emplaceBack(0,r.al),p.emplaceBack(r.al,r.al),this.debugBuffer=t.createVertexBuffer(p,r.be.members),this.debugSegments=r.bf.simpleSegment(0,0,4,5);const y=new r.bc;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(y,r.be.members),this.viewportSegments=r.bf.simpleSegment(0,0,4,2);const b=new r.a$;b.emplaceBack(0,0,0,0),b.emplaceBack(r.al,0,r.al,0),b.emplaceBack(0,r.al,0,r.al),b.emplaceBack(r.al,r.al,r.al,r.al),this.mercatorBoundsBuffer=t.createVertexBuffer(b,r.bh.members),this.mercatorBoundsSegments=r.bf.simpleSegment(0,0,4,2);const T=new r.b0;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(T);const R=new r.bd;for(const L of[0,1,3,2,0])R.emplaceBack(L);this.debugIndexBuffer=t.createIndexBuffer(R),this.emptyTexture=new r.T(t,new r.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=r.bB();const D=this.context.gl;this.stencilClearMode=new Hi({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,pi.disabled,this.stencilClearMode,an.disabled,Ni.disabled,Pu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,a,p){if(!a||this.currentStencilSource===a.id||!t.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let R=!1;for(const D of p)if(this._tileClippingMaskIDs[D.key]===void 0){R=!0;break}if(!R)return}this.currentStencilSource=a.id;const y=this.context,b=y.gl;this.nextStencilID+p.length>256&&this.clearStencil(),y.setColorMode(an.disabled),y.setDepthMode(pi.disabled);const T=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const R of p){const D=a.getTile(R),L=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:j,tileBoundsSegments:B}=this.getTileBoundsBuffers(D);T.draw(this,b.TRIANGLES,pi.disabled,new Hi({func:b.ALWAYS,mask:0},L,255,b.KEEP,b.KEEP,b.REPLACE),an.disabled,Ni.disabled,Pu(R.projMatrix),"$clipping",F,j,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new Hi({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const a=this.context.gl;return new Hi({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,p=t.sort((T,R)=>R.overscaledZ-T.overscaledZ),y=p[p.length-1].overscaledZ,b=p[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let R=0;R<b;R++)T[R+y]=new Hi({func:a.GEQUAL,mask:255},R+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[T,p]}return[{[y]:Hi.disabled},p]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new an([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new r.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?an.unblended:an.alphaBlended}colorModeForDrapableLayerRenderPass(t){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new an([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new r.ao(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,a,p,y=!1){if(this.depthOcclusion)return new pi(this.context.gl.GREATER,pi.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return pi.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new pi(p||this.context.gl.LEQUAL,a,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,a=Math.ceil(this.width),p=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),b=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&p!==0&&(this.depthFBO=new lg(this.context,a,p,!1,"texture"),this.depthTexture=new r.T(this.context,{width:a,height:p,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),t.bindTexture(t.TEXTURE_2D,b),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,a,p,0,0,a,p,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,a)=>t+a/this._fpsHistory.length,0))}render(t,a){const p=r.o.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=a;const y=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),T=()=>this.style._getOrder(b).filter(Ze=>{const ze=y[Ze];return!(ze.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[ze.type]});let R=T(),D=!1,L=!1,F=null;for(const Ze of R){const ze=y[Ze];ze.type==="circle"?D=!0:ze.type==="building"?F=ze:ze.type==="symbol"&&(ze.hasOcclusionOpacityProperties?L=!0:D=!0)}let j=R.map(Ze=>y[Ze]);const B=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(r.o.now()),this.imageManager.beginFrame();let $=0,Z=!1;for(const Ze in B){const ze=B[Ze];ze.used&&(ze.prepare(this.context),ze.getSource().usedInConflation&&++$)}let Q=!1;for(const Ze of j)Ze.isHidden(this.transform.zoom)||(Ze.type==="clip"&&(Q=!0),this.prepareLayer(Ze));const re={},te={},se={},me={},ce={};for(const Ze in B){const ze=B[Ze];re[Ze]=ze.getVisibleCoordinates(),te[Ze]=re[Ze].slice().reverse(),se[Ze]=ze.getVisibleCoordinates(!0).reverse(),me[Ze]=ze.getShadowCasterCoordinates(),ce[Ze]=ze.sortCoordinatesByDistance(re[Ze])}const Ae=Ze=>{const ze=this.style.getLayerSourceCache(Ze);return ze&&ze.used?ze.getSource():null};if($||Q||this._clippingActiveLastFrame){const Ze=[],ze=[];let lt=0;for(const Je of j)this.isSourceForClippingOrConflation(Je,Ae(Je))&&(Ze.push(Je),ze.push(lt)),lt++;if(Ze&&(Q||Ze.length>1)||this._clippingActiveLastFrame){Q=!1;const Je=[];for(let bt=0;bt<Ze.length;bt++){const Ft=Ze[bt],ci=ze[bt],Mt=this.style.getLayerSourceCache(Ft);if(!Mt||!Mt.used||!Mt.getSource().usedInConflation&&Ft.type!=="clip"&&Ft.type!=="building")continue;let Ot=r.eP,di=r.bZ.None;const ei=[];let Jt=!0;if(Ft.type==="building")Ot=r.eR;else if(Ft.type==="clip"){Ot=ci;for(const ti of Ft.layout.get("clip-layer-types"))di|=ti==="model"?r.bZ.Model:ti==="symbol"?r.bZ.Symbol:r.bZ.FillExtrusion;for(const ti of Ft.layout.get("clip-layer-scope"))ei.push(ti);Ft.isHidden(this.transform.zoom)?Jt=!1:Q=!0}Jt&&Je.push({layer:Ft.fqid,cache:Mt,order:Ot,clipMask:di,clipScope:ei})}this.replacementSource.setSources(Je),Z=!0}}this._clippingActiveLastFrame=Q,Z||this.replacementSource.clear(),this.conflationActive=Z,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ze=0;Ze<j.length;Ze++){const ze=j[Ze],lt=ze.cutoffRange();if(this.longestCutoffRange=Math.max(lt,this.longestCutoffRange),lt>0){const Je=Ae(ze);Je&&(this.minCutoffZoom=Math.max(Je.minzoom,this.minCutoffZoom)),ze.minzoom&&(this.minCutoffZoom=Math.max(ze.minzoom,this.minCutoffZoom))}ze.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ze),this._lastOcclusionLayer=Ze)}const _e=this.style&&this.style.fog;_e?(this._fogVisible=_e.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=_e.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(se),this.opaquePassCutoff=0,R=T(),j=R.map(Ze=>y[Ze]));const Ie=this._shadowRenderer;if(Ie){Ie.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ze in B)for(const ze of re[Ze]){let lt={min:0,max:0};this.terrain&&(lt=this.terrain.getMinMaxForTile(ze)||lt),Ie.addShadowReceiver(ze.toUnwrapped(),lt.min,lt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.eQ(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new ea(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Ce=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Ce&&!this._snow&&(this._snow=new sy(this)),!Ce&&this._snow&&(this._snow.destroy(),delete this._snow),Te&&!this._rain&&(this._rain=new mf(this)),!Te&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),F){this.buildingTileBorderManager||(this.buildingTileBorderManager=new We);const Ze=this.style.getLayerSourceCache(F);this.buildingTileBorderManager.updateBorders(Ze,F)}if(!Bn.has(this.context.gl))return;this.renderPass="offscreen";for(const Ze of j){const ze=t.getLayerSourceCache(Ze);if(!Ze.hasOffscreenPass()||Ze.isHidden(this.transform.zoom))continue;const lt=ze?te[ze.id]:void 0;(Ze.type==="custom"||Ze.type==="raster"||Ze.type==="raster-particle"||Ze.isSky()||lt&&lt.length)&&this.renderLayer(this,ze,Ze,lt)}this.depthRangeFor3D=[0,1-(j.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,me)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const De=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ge=(()=>{if(a.showOverdrawInspector)return r.ao.black;const Ze=this.style.fog;if(Ze&&this.transform.projection.supportsFog){const ze=this.style.getLut(Ze.scope);if(!De){const lt=Ze.properties.get("color-use-theme")==="none",Je=Ze.properties.get("color").toNonPremultipliedRenderColor(lt?null:ze).toArray01();return new r.ao(...Je)}if(De){const lt=Ze.properties.get("space-color-use-theme")==="none",Je=Ze.properties.get("space-color").toNonPremultipliedRenderColor(lt?null:ze).toArray01();return new r.ao(...Je)}}return r.ao.transparent})();if(this.context.clear({color:Ge,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&De&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=R.length-1;this.currentLayer>=0;this.currentLayer--){const Ze=j[this.currentLayer],ze=t.getLayerSourceCache(Ze);if(Ze.isSky())continue;const lt=ze?(Ze.is3D(b)?ce:te)[ze.id]:void 0;this._renderTileClippingMasks(Ze,ze,lt),this.renderLayer(this,ze,Ze,lt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&De&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<R.length;this.currentLayer++){const Ze=j[this.currentLayer],ze=t.getLayerSourceCache(Ze);Ze.isSky()&&this.renderLayer(this,ze,Ze,ze?te[ze.id]:void 0)}function Ue(Ze,ze){let lt;return ze&&(lt=(Ze.type==="symbol"?se:Ze.is3D(b)?ce:te)[ze.id]),lt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<R.length;){const Ze=j[this.currentLayer];if(Ze.type==="raster"||Ze.type==="raster-particle"){const ze=t.getLayerSourceCache(Ze);this.renderLayer(this,ze,Ze,Ue(Ze,ze))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let nt=0;Ie&&(nt=Ie.getShadowCastingLayerCount());let Ke=!1,st=-1;for(let Ze=0;Ze<R.length;++Ze){const ze=j[Ze];ze.isHidden(this.transform.zoom)||ze.is3D(b)&&(st=Ze)}L&&st===-1&&(D=!0);let Pt=!1;for(;this.currentLayer<R.length;){const Ze=j[this.currentLayer],ze=t.getLayerSourceCache(Ze);if(Ze.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ze)){if(Ze.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Pt&&Ze.is3D(b)&&!b){const lt=this.currentLayer,Je=bt=>{for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const Ft=j[this.currentLayer];if(yg[Ft.type]){const ci=this.style.getLayerSourceCache(Ft);yg[Ft.type](this,ci,Ft,Ue(Ft,ci),bt)}}};Je("initialize"),Je("reset"),this.currentLayer=lt,Pt=!0}if(D&&!Ke&&this.terrain&&!this.transform.isOrthographic&&(Ke=!0,this.blitDepth()),L&&st!==-1&&this.currentLayer===st+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ze,ze,ze?re[ze.id]:void 0),this.renderLayer(this,ze,Ze,Ue(Ze,ze)),!this.terrain&&Ie&&nt>0&&Ze.hasShadowPass()&&--nt==0){{this.clearStencil(),this.resetStencilClippingMasks();const lt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const Je=j[this.currentLayer];if(Fs[Je.type]){const bt=this.style.getLayerSourceCache(Je);Fs[Je.type](this,bt,Je,Ue(Je,bt))}}this.currentLayer=lt}if(Ie.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const lt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=lt;this.currentLayer++){const Je=j[this.currentLayer];if(!Je.hasLightBeamPass())continue;const bt=t.getLayerSourceCache(Je);this.renderLayer(this,bt,Je,bt?te[bt.id]:void 0)}this.currentLayer=lt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const lt=this.currentLayer;this.depthOcclusion=!0;for(const Je of this.layersWithOcclusionOpacity){this.currentLayer=Je;const bt=j[this.currentLayer],Ft=t.getLayerSourceCache(bt),ci=Ft?te[Ft.id]:void 0;this.terrain||this._renderTileClippingMasks(bt,Ft,Ft?re[Ft.id]:void 0),this.renderLayer(this,Ft,bt,ci)}this.depthOcclusion=!1,this.currentLayer=lt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ze=null;j.forEach(ze=>{const lt=t.getLayerSourceCache(ze);lt&&!ze.isHidden(this.transform.zoom)&&lt.getVisibleCoordinates().length&&(!Ze||Ze.getSource().maxzoom<lt.getSource().maxzoom)&&(Ze=lt)}),Ze&&this.options.showTileBoundaries&&ny(this,Ze,Ze.getVisibleCoordinates(),r.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ny(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ze){const ze=Ze.transform.padding;Er(Ze,Ze.transform.height-(ze.top||0),3,Br),Er(Ze,ze.bottom||0,3,lo),mi(Ze,ze.left||0,3,Vl),mi(Ze,Ze.transform.width-(ze.right||0),3,pg);const lt=Ze.transform.centerPoint;(function(Je,bt,Ft,ci){co(Je,bt-1,Ft-10,2,20,ci),co(Je,bt-10,Ft-1,20,2,ci)})(Ze,lt.x,Ze.transform.height-lt.y,iy)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Z||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:a}=this.transform.projection,p=!a||!a.includes(t.type);if(gf[t.type]&&(p||this.terrain&&t.type==="custom")){const y=this.style.getLayerSourceCache(t);gf[t.type](t,y,this)}this.gpuTimingEnd()}renderLayer(t,a,p,y){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||y&&y.length)&&(this.id=p.id,this.gpuTimingStart(p),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(p.type)&&(!t.terrain||p.type!=="custom")||p.type==="clip"||ly[p.type](t,a,p,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,p=this.context.gl;let y=this.gpuTimers[t.id];y||(y=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:p.createQuery()}),y.calls++,p.beginQuery(a.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,a=this.context.gl,p=a.createQuery();this.deferredRenderGpuTimeQueries.push(p),a.beginQuery(t.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const a={};for(const p in t){const y=t[p],b=this.context.extTimerQuery,T=b.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(y.query),a[p]=T}return a}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let p=0;for(const y of t)p+=a.getQueryParameter(y,a.QUERY_RESULT)/1e6,a.deleteQuery(y);return p}translatePosMatrix(t,a,p,y,b){if(!p[0]&&!p[1])return t;const T=b?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(T){const L=Math.sin(T),F=Math.cos(T);p=[p[0]*F-p[1]*L,p[0]*L+p[1]*F]}const R=[b?p[0]:r.ay(a,p[0],this.transform.zoom),b?p[1]:r.ay(a,p[1],this.transform.zoom),0],D=new Float32Array(16);return r.bq(D,t,R),D}saveTileTexture(t){if(t.context!==this.context)return;const a=t.size[0],p=this._tileTextures[a];p?p.push(t):this._tileTextures[a]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,a,p){const y=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,b=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||y||a!==void 0&&!a||b.push("FOG","FOG_DITHERING"),y&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(t,a){this.cache=this.cache||{};const p=a&&a.defines||[],y=a&&a.config,b=this.currentGlobalDefines(t,a&&a.overrideFog,a&&a.overrideRtt).concat(p),T=Ul.cacheKey($m[t],t,b,y);return this.cache[T]||(this.cache[T]=new Ul(this.context,t,$m[t],y,dc[t],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,a){if(this.style.enable3dLights()){const p=this.style.directionalLight,y=this.style.ambientLight;if(p&&y){const b=((T,R,D)=>{const L=T.properties.get("direction"),F=T.properties.get("color-use-theme")==="none",j=T.properties.get("color").toNonPremultipliedRenderColor(F?null:D.getLut(T.scope)).toArray01(),B=T.properties.get("intensity"),$=R.properties.get("color-use-theme")==="none",Z=R.properties.get("color").toNonPremultipliedRenderColor($?null:D.getLut(R.scope)).toArray01(),Q=R.properties.get("intensity"),re=[L.x,L.y,L.z],te=r.dM(Z,Q),se=r.dM(j,B);return{u_lighting_ambient_color:te,u_lighting_directional_dir:re,u_lighting_directional_color:se,u_ground_radiance:Ip(re,se,te)}})(p,y,this.style);a.setLightsUniformValues(t,b)}}}uploadCommonUniforms(t,a,p,y,b){if(this.uploadCommonLightUniforms(t,a),this.terrain&&this.terrain.renderingToTexture)return;const T=this.style.fog;if(T){const R=T.getOpacity(this.transform.pitch),D=((L,F,j,B,$,Z,Q,re,te,se,me,ce)=>{const Ae=L.transform,_e=F.properties.get("color-use-theme")==="none",Ie=F.properties.get("color").toNonPremultipliedRenderColor(_e?null:L.style.getLut(F.scope)).toArray01();Ie[3]=B;const Ce=L.frameCounter/1e3%1,[Te,De]=F.properties.get("vertical-range");return{u_fog_matrix:j?Ae.calculateFogTileMatrix(j):ce||L.identityMat,u_fog_range:F.getFovAdjustedRange(Ae._fov),u_fog_color:Ie,u_fog_horizon_blend:F.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Te,De),De],u_fog_temporal_offset:Ce,u_frustum_tl:$,u_frustum_tr:Z,u_frustum_br:Q,u_frustum_bl:re,u_globe_pos:te,u_globe_radius:se,u_viewport:me,u_globe_transition:r.aj(Ae.zoom),u_is_globe:+(Ae.projection.name==="globe")}})(this,T,p,R,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.o.devicePixelRatio,this.transform.height*r.o.devicePixelRatio],y);a.setFogUniformValues(t,D)}b&&a.setCutoffUniformValues(t,b.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,a=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const y of p)a[y.key]=t[y.key]||new Ba(y,512,this.transform.tileZoom,this,void 0,this.worldview);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,a){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[t.key];return a||(this._cachedTileFogOpacities[t.key]=a=this.style.fog.getOpacityForTile(t)),a[0]>=$e||a[1]>=$e}setupDepthForOcclusion(t,a,p){const y=this.context,b=y.gl,T=!!p;var R;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(b.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((R=this.depthRangeFor3D)[1]-R[0]),-1-2*R[0]/(R[1]-R[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),y.activeTexture.set(b.TEXTURE0),T||a.setTerrainUniformValues(y,p)}}function wd(f,t){let a=!1,p=null;const y=()=>{p=null,a&&(f(),p=setTimeout(y,t),a=!1)};return()=>(a=!0,p||y(),p)}class vg{constructor(t){this._hashName=t&&encodeURIComponent(t),r.aX(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=wd(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const a=Td(t);if(this._hashName){const p=this._hashName;let y=!1;const b=location.hash.slice(1).split("&").map(T=>{const R=T.split("=")[0];return R===p?(y=!0,`${R}=${a}`):T}).filter(T=>T);return y||b.push(`${p}=${a}`),`#${b.join("&")}`}return`#${a}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let a;return t.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(a=p)}),(a&&a[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(p=>isNaN(Number(p)))){const p=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(a[3]||0):t.getBearing();return t.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:p,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Td(f,t){const a=f.getCenter(),p=Math.round(100*f.getZoom())/100,y=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),T=Math.round(a.lng*b)/b,R=Math.round(a.lat*b)/b,D=f.getBearing(),L=f.getPitch();let F=t?`/${T}/${R}/${p}`:`${p}/${R}/${T}`;return(D||L)&&(F+="/"+Math.round(10*D)/10),L&&(F+=`/${Math.round(L)}`),F}const _f={linearity:.3,easing:r.eS(0,0,.3,1)},ju=Object.assign({deceleration:2500,maxSpeed:1400},_f),xg=Object.assign({deceleration:20,maxSpeed:1400},_f),jl=Object.assign({deceleration:1e3,maxSpeed:360},_f),Gu=Object.assign({deceleration:1e3,maxSpeed:90},_f);class Dh{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=r.o.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(a.pan.mag()){const b=Mh(a.pan.mag(),p,Object.assign({},ju,t||{}));y.offset=a.pan.mult(b.amount/a.pan.mag()),y.center=this._map.transform.center,Gl(y,b)}if(a.zoom){const b=Mh(a.zoom,p,xg);y.zoom=this._map.transform.zoom+b.amount,Gl(y,b)}if(a.bearing){const b=Mh(a.bearing,p,jl);y.bearing=this._map.transform.bearing+r.aA(b.amount,-179,179),Gl(y,b)}if(a.pitch){const b=Mh(a.pitch,p,Gu);y.pitch=this._map.transform.pitch+b.amount,Gl(y,b)}if(y.zoom||y.bearing){const b=a.pinchAround===void 0?a.around:a.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Gl(f,t){(!f.duration||f.duration<t.duration)&&(f.duration=t.duration,f.easing=t.easing)}function Mh(f,t,a){const{maxSpeed:p,linearity:y,deceleration:b}=a,T=r.aA(f*y/(t/1e3),-p,p),R=Math.abs(T)/(b*y);return{easing:a.easing,duration:1e3*R,amount:T*(R/2)}}class ar extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,p,y={}){const b=oi(a.getCanvasContainer(),p),T=a.unproject(b);super(t,Object.assign({point:b,lngLat:T,originalEvent:p},y)),this._defaultPrevented=!1,this.target=a}}class pc extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,p){const y=t==="touchend"?p.changedTouches:p.touches,b=yi(a.getCanvasContainer(),y),T=b.map(D=>a.unproject(D)),R=b.reduce((D,L,F,j)=>D.add(L.div(j.length)),new r.P(0,0));super(t,{points:b,point:R,lngLats:T,lngLat:a.unproject(R),originalEvent:p}),this._defaultPrevented=!1}}class fr extends r.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class yf{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new fr(this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new ar(t.type,this._map,t))}mouseup(t){this._map.fire(new ar(t.type,this._map,t))}preclick(t){const a=new MouseEvent("preclick",t);this._map.fire(new ar(a.type,this._map,a))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(t),this._map.fire(new ar(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new ar(t.type,this._map,t))}mouseover(t){this._map.fire(new ar(t.type,this._map,t))}mouseout(t){this._map.fire(new ar(t.type,this._map,t))}touchstart(t){return this._firePreventable(new pc(t.type,this._map,t))}touchmove(t){this._map.fire(new pc(t.type,this._map,t))}touchend(t){this._map.fire(new pc(t.type,this._map,t))}touchcancel(t){this._map.fire(new pc(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ph{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new ar(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ar("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new ar(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class px{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(Xe(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const p=a,y=this._startPos,b=this._lastPos;if(!y||!b||b.equals(p)||!this._box&&p.dist(y)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=xe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const T=Math.min(y.x,p.x),R=Math.max(y.x,p.x),D=Math.min(y.y,p.y),L=Math.max(y.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${D}px)`,this._box.style.width=R-T+"px",this._box.style.height=L-D+"px")})}mouseupWindow(t,a){if(!this._active)return;const p=this._startPos,y=a;if(p&&t.button===0){if(this.reset(),Nt(),p.x!==y.x||p.y!==y.y)return this._map.fire(new r.z("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(p,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),it(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new r.z(t,{originalEvent:a}))}}function Up(f,t){const a={};for(let p=0;p<f.length;p++)a[f[p].identifier]=t[p];return a}class Vp{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,a,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),p.length===this.numTouches&&(this.centroid=function(y){const b=new r.P(0,0);for(const T of y)b._add(T);return b.div(y.length)}(a),this.touches=Up(p,a)))}touchmove(t,a,p){if(this.aborted||!this.centroid)return;const y=Up(p,a);for(const b in this.touches){const T=y[b];(!T||T.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(t,a,p){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Hl{constructor(t){this.singleTap=new Vp(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,a,p){this.singleTap.touchstart(t,a,p)}touchmove(t,a,p){this.singleTap.touchmove(t,a,p)}touchend(t,a,p){const y=this.singleTap.touchend(t,a,p);if(y){const b=t.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(y)<30;if(b&&T||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class cy{constructor(){this._zoomIn=new Hl({numTouches:1,numTaps:2}),this._zoomOut=new Hl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,p){this._zoomIn.touchstart(t,a,p),this._zoomOut.touchstart(t,a,p)}touchmove(t,a,p){this._zoomIn.touchmove(t,a,p),this._zoomOut.touchmove(t,a,p)}touchend(t,a,p){const y=this._zoomIn.touchend(t,a,p),b=this._zoomOut.touchend(t,a,p);return y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const jp={0:1,2:2},bg={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Oh{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,a){return!1}_move(t,a){return{}}mousedown(t,a){if(this._lastPoint)return;const p=Ui(t);this._correctButton(t,p)&&(this._lastPoint=a,this._eventButton=p)}mousemoveWindow(t,a){const p=this._lastPoint;if(p){if(t.preventDefault(),this._eventButton!=null&&function(y,b){const T=jp[b];return y.buttons===void 0||(y.buttons&T)!==T}(t,this._eventButton))this.reset();else if(this._moved||!(a.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(p,a)}}mouseupWindow(t){this._lastPoint&&Ui(t)===this._eventButton&&(this._moved&&Nt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uy extends Oh{mousedown(t,a){super.mousedown(t,a),this._lastPoint&&(this._active=!0)}_correctButton(t,a){return a===0&&!t.ctrlKey}_move(t,a){return{around:a,panDelta:a.sub(t)}}}class Gp extends Oh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?bg[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const p=.8*(a.x-t.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class wg extends Oh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?bg[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const p=-.5*(a.y-t.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class hy{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),r.aX(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(t,a,p){return this._calculateTransform(t,a,p)}touchmove(t,a,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!r.eT())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,a,p)}}touchend(t,a,p){this._calculateTransform(t,a,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,p){p.length>0&&(this._active=!0);const y=Up(p,a),b=new r.P(0,0),T=new r.P(0,0);let R=0;for(const L in y){const F=y[L],j=this._touches[L];j&&(b._add(F),T._add(F.sub(j)),R++,y[L]=F)}if(this._touches=y,R<this._minTouches||!T.mag())return;const D=T.div(R);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(R),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Es{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,a,p){return{}}touchstart(t,a,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,p){const y=this._firstTwoTouches;if(!y)return;t.preventDefault();const[b,T]=y,R=Tl(p,a,b),D=Tl(p,a,T);if(!R||!D)return;const L=this._aroundCenter?null:R.add(D).div(2);return this._move([R,D],L,t)}touchend(t,a,p){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,T=Tl(p,a,y),R=Tl(p,a,b);T&&R||(this._active&&Nt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Tl(f,t,a){for(let p=0;p<f.length;p++)if(f[p].identifier===a)return t[p]}function mc(f,t){return Math.log2(f/t)}class Hp extends Es{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const p=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(mc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:mc(this._distance,p),pinchAround:a}}}function Sd(f,t){return 180*f.angleWith(t)/Math.PI}class $l extends Es{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const p=this._vector;if(this._vector=t[0].sub(t[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Sd(this._vector,p),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const y=Sd(t,p);return Math.abs(y)<a}}function Co(f){return Math.abs(f.y)>Math.abs(f.x)}class mx extends Es{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Co(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,p){const y=this._lastPoints;if(!y)return;const b=t[0].sub(y[0]),T=t[1].sub(y[1]);return this._map._cooperativeGestures&&!r.eT()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(b,T,p.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5})}gestureBeginsVertically(t,a,p){if(this._valid!==void 0)return this._valid;const y=t.mag()>=2,b=a.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const T=t.y>0==a.y>0;return Co(t)&&Co(a)&&T}}const gx={panStep:100,bearingStep:15,pitchStep:10};class _x{constructor(){const t=gx;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,p=0,y=0,b=0,T=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?p=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?p=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?y=1:(t.preventDefault(),T=-1);break;case 40:t.shiftKey?y=-1:(t.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(p=0,y=0),{cameraAnimation:R=>{const D=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Tg,zoom:a?Math.round(D)+a*(t.shiftKey?2:1):D,bearing:R.getBearing()+p*this._bearingStep,pitch:R.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:R.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Tg(f){return f*(2-f)}const dy=4.000244140625,Sg=1/450;class yx{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Sg,r.aX(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||r.eT()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const p=r.o.now(),y=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,a!==0&&a%dy==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(y*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=oi(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>dy?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&F!==0&&(F=1/F);const j=a(),B=Math.pow(2,j),$=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom($*F))),this._type==="wheel"&&(this._startZoom=j,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:a(),y=this._startZoom,b=this._easing;let T,R=!1;if(this._type==="wheel"&&y&&b){const L=Math.min((r.o.now()-this._lastWheelEventTime)/200,1),F=b(L);T=r.ak(y,p,F),L<1?this._frameId||(this._frameId=!0):R=!0}else T=p,R=!0;this._active=!0,R&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let D=T-a();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!R,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=r.eU;if(this._prevEase){const p=this._prevEase,y=(r.o.now()-p.start)/p.duration,b=p.easing(y+.01)-p.easing(y),T=.27/Math.sqrt(b*b+1e-4)*.01,R=Math.sqrt(.0729-T*T);a=r.eS(T,R,.25,1)}return this._prevEase={start:r.o.now(),duration:t,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class ta{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class vx{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,a){return t.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(t.shiftKey?-1:1),around:p.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fy{constructor(){this._tap=new Hl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,a,p){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=a[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(t,a,p))}touchmove(t,a,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const y=a[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,a,p)}touchend(t,a,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(t,a,p)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jb{constructor(t,a,p){this._el=t,this._mousePan=a,this._touchPan=p}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class xx{constructor(t,a,p){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class $p{constructor(t,a,p,y){this._el=t,this._touchZoom=a,this._touchRotate=p,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const vf=f=>f.zoom||f.drag||f.pitch||f.rotate;class py extends r.z{}class Wp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,a){const p=r.av([],a,t);this.radius=r.ag(p[2]<0?r.eW([],p,this.constants):[p[0],p[1],0])}projectRay(t){r.eW(t,t,this.constants),r.aw(t,t),r.eX(t,t,this.constants);const a=r.c4([],t,this.radius);if(a[2]>0){const p=r.c4([],[0,0,1],r.bI(a,[0,0,1])),y=r.c4([],r.aw([],[a[0],a[1],0]),this.radius),b=r.d7([],a,r.c4([],r.av([],r.d7([],y,p),a),2));a[0]=b[0],a[1]=b[1]}return a}}function Wl(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class xf{constructor(t,a){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Dh(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Wp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),r.aX(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,b,T]of this._listeners){const R=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(b,R,T)}}destroy(){for(const[t,a,p]of this._listeners){const y=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(a,y,p)}}_addDefaultHandlers(t){const a=this._map,p=a.getCanvasContainer();this._add("mapEvent",new yf(a,t));const y=a.boxZoom=new px(a,t);this._add("boxZoom",y);const b=new cy,T=new vx;a.doubleClickZoom=new ta(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const R=new fy;this._add("tapDragZoom",R);const D=a.touchPitch=new mx(a);this._add("touchPitch",D);const L=new Gp(t),F=new wg(t);a.dragRotate=new xx(t,L,F),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const j=new uy(t),B=new hy(a,t);a.dragPan=new jb(p,j,B),this._add("mousePan",j),this._add("touchPan",B,["touchZoom","touchRotate"]);const $=new $l,Z=new Hp;a.touchZoomRotate=new $p(p,Z,$,R),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ph(a));const Q=a.scrollZoom=new yx(a,this);this._add("scrollZoom",Q,["mousePan"]);const re=a.keyboard=new _x;this._add("keyboard",re);for(const te of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[te]&&a[te].enable(t[te])}_add(t,a,p){this._handlers.push({handlerName:t,handler:a,allowed:p}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!vf(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,a,p){for(const y in t)if(y!==p&&(!a||a.indexOf(y)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const a=[];for(const p of t)this._el.contains(p.target)&&a.push(p);return a}handleEvent(t,a){this._updatingCamera=!0;const p=t.type==="renderFrame",y=p?void 0:t,b={needsRenderFrame:!1},T={},R={},D=t.touches?this._getMapTouches(t.touches):void 0,L=D?yi(this._el,D):p?void 0:oi(this._el,t);for(const{handlerName:B,handler:$,allowed:Z}of this._handlers){if(!$.isEnabled())continue;let Q;this._blockedByActive(R,Z,B)?$.reset():$[a||t.type]&&(Q=$[a||t.type](t,L,D),this.mergeHandlerResult(b,T,Q,B,y),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||$.isActive())&&(R[B]=$)}const F={};for(const B in this._previousActiveHandlers)R[B]||(F[B]=y);this._previousActiveHandlers=R,(Object.keys(F).length||Wl(b))&&(this._changes.push([b,T,F]),this._triggerRenderFrame()),(Object.keys(R).length||Wl(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=b;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(t,a,p,y,b){if(!p)return;Object.assign(t,p);const T={handlerName:y,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(a.zoom=T),p.panDelta!==void 0&&(a.drag=T),p.pitchDelta!==void 0&&(a.pitch=T),p.bearingDelta!==void 0&&(a.rotate=T)}_applyChanges(){const t={},a={},p={};for(const[y,b,T]of this._changes)y.panDelta&&(t.panDelta=(t.panDelta||new r.P(0,0))._add(y.panDelta)),y.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(t.around=y.around),y.aroundCoord!==void 0&&(t.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(t.pinchAround=y.pinchAround),y.noInertia&&(t.noInertia=y.noInertia),Object.assign(a,b),Object.assign(p,T);this._updateMapTransform(t,a,p),this._changes=[]}_updateMapTransform(t,a,p){const y=this._map,b=y.transform,T=se=>[se.x,se.y,se.z];if((se=>{const me=this._eventsInProgress.drag;return me&&!this._handlersById[me.handlerName].isActive()})()&&!Wl(t)){const se=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),se!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&y._stop(!0),!Wl(t))return void this._fireEvents(a,p,!0);let{panDelta:R,zoomDelta:D,bearingDelta:L,pitchDelta:F,around:j,aroundCoord:B,pinchAround:$}=t;b._isCameraConstrained&&(D>0&&(D=0),b._isCameraConstrained=!1),$!==void 0&&(j=$),(D||(se=>a[se]&&!this._eventsInProgress[se])("drag"))&&j&&(this._dragOrigin=T(b.pointCoordinate3D(j)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),j=j||y.transform.centerPoint,L&&(b.bearing+=L),F&&(b.pitch+=F),b._updateCameraState();const Z=[0,0,0];if(R)if(b.projection.name==="mercator"){const se=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(j).dir),me=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(j.sub(R)).dir);Z[0]=me[0]-se[0],Z[1]=me[1]-se[1]}else{const se=b.pointCoordinate(j);if(b.projection.name==="globe"){R=R.rotate(-b.angle);const me=b._pixelsPerMercatorPixel/b.worldSize;Z[0]=-R.x*r.eV(r.a_(se.y))*me,Z[1]=-R.y*r.eV(b.center.lat)*me}else{const me=b.pointCoordinate(j.sub(R));se&&me&&(Z[0]=me.x-se.x,Z[1]=me.y-se.y)}}const Q=b.zoom,re=[0,0,0];if(D){const se=T(B||b.pointCoordinate3D(j)),me={dir:r.aw([],r.av([],se,b._camera.position))};if(me.dir[2]<0){const ce=b.zoomDeltaToMovement(se,D);r.c4(re,me.dir,ce)}}const te=r.d7(Z,Z,re);b._translateCameraConstrained(te),D&&Math.abs(b.zoom-Q)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,p,!0)}_fireEvents(t,a,p){const y=vf(this._eventsInProgress),b=vf(t),T={};for(const F in t){const{originalEvent:j}=t[F];this._eventsInProgress[F]||(T[`${F}start`]=j),this._eventsInProgress[F]=t[F]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const F in T)this._fireEvent(F,T[F]);b&&this._fireEvent("move",b.originalEvent);for(const F in t){const{originalEvent:j}=t[F];this._fireEvent(F,j)}const R={};let D;for(const F in this._eventsInProgress){const{handlerName:j,originalEvent:B}=this._eventsInProgress[F];this._handlersById[j].isActive()||(delete this._eventsInProgress[F],D=a[j]||B,R[`${F}end`]=D)}for(const F in R)this._fireEvent(F,R[F]);const L=vf(this._eventsInProgress);if(p&&(y||b)&&!L){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;F?(j(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:D})):(this._map.fire(new r.z("moveend",{originalEvent:D})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new r.z(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new py("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ya="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ds extends r.E{constructor(t,a){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,r.aX(["_renderFrameCallback"],this)}getCenter(){return new r.aS(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,p){return t=r.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},a),p)}panTo(t,a,p){return this.easeTo(Object.assign({center:t},a),p)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,p){return this.easeTo(Object.assign({zoom:t},a),p)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,p){return this.easeTo(Object.assign({bearing:t},a),p)}resetNorth(t,a){return this.rotateTo(0,Object.assign({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=r.aI.convert(t);const p=a&&a.bearing||0,y=a&&a.pitch||0,b=t.getNorthWest(),T=t.getSouthEast();return this._cameraForBounds(this.transform,b,T,p,y,a)}_extendPadding(t){const a={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},a,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},a,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,a){const p=a.max[0]-a.min[0],y=a.max[1]-a.min[1];return p/y>t.aspect?p/(2*Math.tan(.5*t.fovX)*t.aspect):y/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,a,p,y,b,T){const R=t.clone(),D=this._extendCameraOptions(T);R.bearing=y,R.pitch=b;const L=r.aS.convert(a),F=r.aS.convert(p),j=.5*(L.lat+F.lat),B=.5*(L.lng+F.lng),$=r.eY(j,B),Z=r.aw([],$),Q=r.aw([],r.bH([],Z,[0,1,0])),re=r.bH([],Q,Z),te=[Q[0],Q[1],Q[2],0,re[0],re[1],re[2],0,Z[0],Z[1],Z[2],0,0,0,0,1],se=[$,r.eY(L.lat,L.lng),r.eY(F.lat,L.lng),r.eY(F.lat,F.lng),r.eY(L.lat,F.lng),r.eY(j,L.lng),r.eY(j,F.lng),r.eY(L.lat,B),r.eY(F.lat,B)];let me=r.d8.fromPoints(se.map(Je=>[r.bI(Q,Je),r.bI(re,Je),r.bI(Z,Je)]));const ce=r.af([],me.center,te);r.eZ(ce)===0&&r.e_(ce,0,0,1),r.aw(ce,ce),r.c4(ce,ce,r.aD),R.center=r.e$(ce);const Ae=R.getWorldToCameraMatrix(),_e=r.bk(new Float64Array(16),Ae);me=r.d8.applyTransform(me,r.aB([],Ae,te));const Ie=this._extendAABB(me,R,D,y);if(!Ie)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");me=Ie,r.af(ce,ce,Ae);const Ce=.5*(me.max[2]-me.min[2]),Te=this._minimumAABBFrustumDistance(R,me),De=r.c4([],[0,0,1],Ce),Ge=r.d7(De,ce,De),Ue=Te+(R.pitch===0?0:r.bF(ce,Ge)),nt=R.globeCenterInViewSpace,Ke=r.av([],ce,[nt[0],nt[1],nt[2]]);r.aw(Ke,Ke),r.c4(Ke,Ke,Ue);const st=r.d7([],ce,Ke);r.af(st,st,_e);const Pt=r.eL/r.aD,Ze=r.ag(st),ze=r.ce(Math.max(Ze*Pt-r.eL,Number.EPSILON),0),lt=Math.min(R.zoomFromMercatorZAdjusted(ze),D.maxZoom);return lt>.5*(r.cZ+r.cK)?(R.setProjection({name:"mercator"}),R.zoom=lt,this._cameraForBounds(R,a,p,y,b,T)):{center:R.center,zoom:lt,bearing:y,pitch:b}}_extendAABB(t,a,p,y){const b=.5*((p.padding.left||0)+(p.padding.right||0)),T=.5*((p.padding.top||0)+(p.padding.bottom||0)),R=T,D=b,L=b,F=T,j=a.width-(D+L),B=a.height-(R+F),$=r.av([],t.max,t.min),Z=Math.min(j/$[0],B/$[1]),Q=Math.min(a.scaleZoom(a.scale*Z),p.maxZoom);if(isNaN(Q))return null;const re=a.scale/a.zoomScale(Q),te=new r.d8([t.min[0]-D*re,t.min[1]-F*re,t.min[2]],[t.max[0]+L*re,t.max[1]+R*re,t.max[2]]),se=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new r.P(p.offset.x,p.offset.y):r.P.convert(p.offset)).rotate(-r.an(y));return te.center[0]-=se.x*re,te.center[1]+=se.y*re,te}queryTerrainElevation(t,a){const p=this.transform.elevation;return p?(a=Object.assign({},{exaggerated:!0},a),p.getAtPoint(r.ae.fromLngLat(t),null,a.exaggerated)):null}_cameraForBounds(t,a,p,y,b,T){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,a,p,y,b,T);const R=t.clone(),D=this._extendCameraOptions(T);R.bearing=y,R.pitch=b;const L=r.aS.convert(a),F=r.aS.convert(p),j=new r.aS(L.lng,F.lat),B=new r.aS(F.lng,L.lat),$=R.project(L),Z=R.project(F),Q=this.queryTerrainElevation(L),re=this.queryTerrainElevation(F),te=this.queryTerrainElevation(j),se=this.queryTerrainElevation(B),me=[[$.x,$.y,Math.min(Q||0,re||0,te||0,se||0)],[Z.x,Z.y,Math.max(Q||0,re||0,te||0,se||0)]];let ce=r.d8.fromPoints(me);const Ae=R.getWorldToCameraMatrix(),_e=r.bk(new Float64Array(16),Ae);ce=r.d8.applyTransform(ce,Ae);const Ie=this._extendAABB(ce,R,D,y);if(!Ie)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=Ie;const Ce=.5*r.av([],ce.max,ce.min)[2],Te=this._minimumAABBFrustumDistance(R,ce),De=[0,0,1,0];r.aC(De,De,Ae),r.f0(De,De);const Ge=r.c4([],De,Te+Ce),Ue=r.d7([],ce.center,Ge);r.af(ce.center,ce.center,_e),r.af(Ue,Ue,_e);const nt=R.unproject(new r.P(ce.center[0],ce.center[1])),Ke=r.f1(R.projection,nt),st=Math.pow(2,Ke),Pt=Math.min(R._zoomFromMercatorZ(Ue[2]*R.pixelsPerMeter*st/R.worldSize),D.maxZoom);return R.mercatorFromTransition&&Pt<.5*(r.cZ+r.cK)?(R.setProjection({name:"globe"}),R.zoom=Pt,this._cameraForBounds(R,a,p,y,b,T)):{center:nt,zoom:Pt,bearing:y,pitch:b}}fitBounds(t,a,p){const y=this.cameraForBounds(t,a);return this._fitInternal(y,a,p)}fitScreenCoordinates(t,a,p,y,b){const T=r.P.convert(t),R=r.P.convert(a),D=new r.P(Math.min(T.x,R.x),Math.min(T.y,R.y)),L=new r.P(Math.max(T.x,R.x),Math.max(T.y,R.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,R))return this;const F=this.transform.pointLocation3D(D),j=this.transform.pointLocation3D(L),B=this.transform.pointLocation3D(new r.P(D.x,L.y)),$=this.transform.pointLocation3D(new r.P(L.x,D.y)),Z=[Math.min(F.lng,j.lng,B.lng,$.lng),Math.min(F.lat,j.lat,B.lat,$.lat)],Q=[Math.max(F.lng,j.lng,B.lng,$.lng),Math.max(F.lat,j.lat,B.lat,$.lat)],re=y&&y.pitch?y.pitch:this.getPitch(),te=this._cameraForBounds(this.transform,Z,Q,p,re,y);return this._fitInternal(te,y,b)}_fitInternal(t,a,p){return t?(a=Object.assign(t,a)).linear?this.easeTo(a,p):this.flyTo(a,p):this}jumpTo(t,a){this.stop();const p=t.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,T=!1;"zoom"in t&&p.zoom!==+t.zoom&&(y=!0,p.zoom=+t.zoom),t.center!==void 0&&(p.center=r.aS.convert(t.center)),"bearing"in t&&p.bearing!==+t.bearing&&(b=!0,p.bearing=+t.bearing),"pitch"in t&&p.pitch!==+t.pitch&&(T=!0,p.pitch=+t.pitch);const R=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!p.isPaddingEqual(R))if(t.retainPadding===!1){const D=p.clone();D.padding=R,p.setLocationAtPoint(p.center,D.centerPoint)}else p.padding=R;return t.preloadOnly?(this._preloadTiles(p),this):(this.fire(new r.z("movestart",a)).fire(new r.z("move",a)),y&&this.fire(new r.z("zoomstart",a)).fire(new r.z("zoom",a)).fire(new r.z("zoomend",a)),b&&this.fire(new r.z("rotatestart",a)).fire(new r.z("rotate",a)).fire(new r.z("rotateend",a)),T&&this.fire(new r.z("pitchstart",a)).fire(new r.z("pitch",a)).fire(new r.z("pitchend",a)),this.fire(new r.z("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(ya),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,a){const p=this.transform;if(!p.projection.supportsFreeCamera)return r.w(ya),this;this.stop();const y=p.zoom,b=p.pitch,T=p.bearing;p.setFreeCameraOptions(t);const R=y!==p.zoom,D=b!==p.pitch,L=T!==p.bearing;return this.fire(new r.z("movestart",a)).fire(new r.z("move",a)),R&&this.fire(new r.z("zoomstart",a)).fire(new r.z("zoom",a)).fire(new r.z("zoomend",a)),L&&this.fire(new r.z("rotatestart",a)).fire(new r.z("rotate",a)).fire(new r.z("rotateend",a)),D&&this.fire(new r.z("pitchstart",a)).fire(new r.z("pitch",a)).fire(new r.z("pitchend",a)),this.fire(new r.z("moveend",a)),this}easeTo(t,a){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:r.eU},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const p=this.transform,y=this.getZoom(),b=this.getBearing(),T=this.getPitch(),R=this.getPadding(),D="zoom"in t?+t.zoom:y,L="bearing"in t?this._normalizeBearing(t.bearing,b):b,F="pitch"in t?+t.pitch:T,j=this._extendPadding(t.padding),B=r.P.convert(t.offset);let $,Z,Q;if(p.projection.name==="globe"){const De=r.ae.fromLngLat(p.center),Ge=B.rotate(-p.angle);De.x+=Ge.x/p.worldSize,De.y+=Ge.y/p.worldSize;const Ue=De.toLngLat(),nt=r.aS.convert(t.center||Ue);this._normalizeCenter(nt),$=p.centerPoint.add(Ge),Z=new r.P(De.x,De.y).mult(p.worldSize),Q=new r.P(r.aF(nt.lng),r.aJ(nt.lat)).mult(p.worldSize).sub(Z)}else{$=p.centerPoint.add(B);const De=p.pointLocation($),Ge=r.aS.convert(t.center||De);this._normalizeCenter(Ge),Z=p.project(De),Q=p.project(Ge).sub(Z)}const re=p.zoomScale(D-y);let te,se;t.around&&(te=r.aS.convert(t.around),se=p.locationPoint(te));const me=this._zooming||D!==y,ce=this._rotating||b!==L,Ae=this._pitching||F!==T,_e=!p.isPaddingEqual(j),Ie=t.retainPadding===!1?p.clone():p,Ce=De=>Ge=>{if(me&&(De.zoom=r.ak(y,D,Ge)),ce&&(De.bearing=r.ak(b,L,Ge)),Ae&&(De.pitch=r.ak(T,F,Ge)),_e&&(Ie.interpolatePadding(R,j,Ge),$=Ie.centerPoint.add(B)),te)De.setLocationAtPoint(te,se);else{const Ue=De.zoomScale(De.zoom-y),nt=D>y?Math.min(2,re):Math.max(.5,re),Ke=Math.pow(nt,1-Ge),st=De.unproject(Z.add(Q.mult(Ge*Ke)).mult(Ue));De.setLocationAtPoint(De.renderWorldCopies?st.wrap():st,$)}return t.preloadOnly||this._fireMoveEvents(a),De};if(t.preloadOnly){const De=this._emulate(Ce,t.duration,p);return this._preloadTiles(De),this}const Te={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=me,this._rotating=ce,this._pitching=Ae,this._padding=_e,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Te),this._ease(Ce(p),De=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(a,De)},t),this}_prepareEase(t,a,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||p.moving||this.fire(new r.z("movestart",t)),this._zooming&&!p.zooming&&this.fire(new r.z("zoomstart",t)),this._rotating&&!p.rotating&&this.fire(new r.z("rotatestart",t)),this._pitching&&!p.pitching&&this.fire(new r.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new r.z("move",t)),this._zooming&&this.fire(new r.z("zoom",t)),this._rotating&&this.fire(new r.z("rotate",t)),this._pitching&&this.fire(new r.z("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new r.z("zoomend",t)),y&&this.fire(new r.z("rotateend",t)),b&&this.fire(new r.z("pitchend",t)),this.fire(new r.z("moveend",t))}flyTo(t,a){if(this._prefersReducedMotion(t)){const Je=r.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Je,a)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:r.eU},t);const p=this.transform,y=this.getZoom(),b=this.getBearing(),T=this.getPitch(),R=this.getPadding(),D="zoom"in t?r.aA(+t.zoom,p.minZoom,p.maxZoom):y,L="bearing"in t?this._normalizeBearing(t.bearing,b):b,F="pitch"in t?+t.pitch:T,j=this._extendPadding(t.padding),B=p.zoomScale(D-y),$=r.P.convert(t.offset);let Z=p.centerPoint.add($);const Q=p.pointLocation(Z),re=r.aS.convert(t.center||Q);this._normalizeCenter(re);const te=p.project(Q),se=p.project(re).sub(te);let me=t.curve;const ce=Math.max(p.width,p.height),Ae=ce/B,_e=se.mag();if("minZoom"in t){const Je=r.aA(Math.min(t.minZoom,y,D),p.minZoom,p.maxZoom),bt=ce/p.zoomScale(Je-y);me=Math.sqrt(bt/_e*2)}const Ie=me*me;function Ce(Je){const bt=(Ae*Ae-ce*ce+(Je?-1:1)*Ie*Ie*_e*_e)/(2*(Je?Ae:ce)*Ie*_e);return Math.log(Math.sqrt(bt*bt+1)-bt)}function Te(Je){return(Math.exp(Je)-Math.exp(-Je))/2}function De(Je){return(Math.exp(Je)+Math.exp(-Je))/2}const Ge=Ce(0);let Ue=function(Je){return De(Ge)/De(Ge+me*Je)},nt=function(Je){return ce*((De(Ge)*(Te(bt=Ge+me*Je)/De(bt))-Te(Ge))/Ie)/_e;var bt},Ke=(Ce(1)-Ge)/me;if(Math.abs(_e)<1e-6||!isFinite(Ke)){if(Math.abs(ce-Ae)<1e-6)return this.easeTo(t,a);const Je=Ae<ce?-1:1;Ke=Math.abs(Math.log(Ae/ce))/me,nt=function(){return 0},Ue=function(bt){return Math.exp(Je*me*bt)}}t.duration="duration"in t?+t.duration:1e3*Ke/("screenSpeed"in t?+t.screenSpeed/me:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const st=b!==L,Pt=F!==T,Ze=!p.isPaddingEqual(j),ze=t.retainPadding===!1?p.clone():p,lt=Je=>bt=>{const Ft=bt*Ke,ci=1/Ue(Ft);Je.zoom=bt===1?D:y+Je.scaleZoom(ci),st&&(Je.bearing=r.ak(b,L,bt)),Pt&&(Je.pitch=r.ak(T,F,bt)),Ze&&(ze.interpolatePadding(R,j,bt),Z=ze.centerPoint.add($));const Mt=bt===1?re:Je.unproject(te.add(se.mult(nt(Ft))).mult(ci));return Je.setLocationAtPoint(Je.renderWorldCopies?Mt.wrap():Mt,Z),Je._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(a),Je};if(t.preloadOnly){const Je=this._emulate(lt,t.duration,p);return this._preloadTiles(Je),this}return this._zooming=!0,this._rotating=st,this._pitching=Pt,this._padding=Ze,this._prepareEase(a,!1),this._ease(lt(p),()=>this._afterEase(a),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,a)}if(!t){const p=this.handlers;p&&p.stop(!1)}return this}_ease(t,a,p){p.animate===!1||p.duration===0?(t(1),a()):(this._easeStart=r.o.now(),this._easeOptions=p,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((r.o.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,a){t=r.bS(t,-180,180);const p=Math.abs(t-a);return Math.abs(t-360-a)<p&&(t-=360),Math.abs(t+360-a)<p&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const p=t.lng-a.center.lng;t.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&r.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,a,p){const y=Math.ceil(15*a/1e3),b=[],T=t(p.clone());for(let R=0;R<=y;R++){const D=T(R/y);b.push(D.clone())}return b}_preloadTiles(t,a){}}class Sl{constructor(t={}){this.options=t,r.aX(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const a=this.options&&this.options.compact,p=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=xe("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const y=xe("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",p),this._innerContainer=xe("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(t){const p=a.reduce((y,b,T)=>(b.value&&(y+=`${b.key}=${b.value}${T<a.length-1?"&":""}`),y),"?");t.href=`${r.e.FEEDBACK_URL}/${p}#${Td(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const a=this._map.style._mergedSourceCaches;for(const y in a){const b=a[y];if(b.used){const T=b.getSource();T.attribution&&t.indexOf(T.attribution)<0&&t.push(T.attribution)}}t.sort((y,b)=>y.length-b.length),t=t.filter((y,b)=>{for(let T=b+1;T<t.length;T++)if(t[T].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const p=t.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,t.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ql{constructor(){r.aX(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=xe("div","mapboxgl-ctrl");const a=xe("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const a in t){const p=t[a].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const a=t[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Ed{constructor(){r.aX(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",a=>this._onIndoorUpdate(a)),this._container}_createButton(t,a){const p=xe("button",t,this._container);return p.type="button",p.addEventListener("click",a),p}_createSeparator(){return xe("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,a){this._map&&(t.setAttribute("aria-label",a),t.textContent=a)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const a=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",a&&Array.from(this._container.children).forEach(p=>p.remove()),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const a=this._map;this._model&&a&&a._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});xe("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,a){for(let p=0;p<t.length;p++){const y=t[p],b=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(y.id)});this._setButtonTitle(b,y.zIndex.toString()),this._model&&y.id===this._model.selectedFloorId&&a&&b.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(b),p<t.length-1&&this._createSeparator()}}}class bf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,p=a?this._queue.concat(a):this._queue;for(const y of p)if(y.id===t)return void(y.cancelled=!0)}run(t=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const p of a)if(!p.cancelled&&(p.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Zl{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const a=r.dC((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,a,p){this._start=this.getValue(a),this._end=t,this._startTime=a,this._endTime=a+p}}const Gb={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class bx extends r.z{constructor(t,a,p,y){const{point:b,lngLat:T,originalEvent:R,target:D}=t;super(t.type,{point:b,lngLat:T,originalEvent:R,target:D}),this.preventDefault=()=>{t.preventDefault()},this.id=a,this.interaction=p,this.feature=y}}class my{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,a){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const p=a.filter;let y=a.type;p&&this.filters.set(t,r.b5(p)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const b=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,a)):b.size===0&&this.map.on(y,this.handleType),b.size===0&&this.interactionsByType.set(y,b),b.set(t,a),this.typeById.set(t,y)}get(t){const a=this.typeById.get(t);if(!a)return;const p=this.interactionsByType.get(a);return p?p.get(t):void 0}remove(t){const a=this.typeById.get(t);if(!a)return;this.typeById.delete(t),this.filters.delete(t);const p=this.interactionsByType.get(a);p&&(p.delete(t),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(a,this.handleType))}queryTargets(t,a){const p=[];for(const[y,b]of a)b.target&&p.push({targetId:y,target:b.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(t,p,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());a.length&&(t.type="mouseenter",this.handleType(t,a));const p=new Map;for(const[y,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||p.set(b.id,b);p.size&&(t.type="mouseleave",this.handleType(t,Array.from(p.values())))}handleOut(t){const a=Array.from(this.hoveredFeatures.values()).map(({feature:p})=>p);a.length&&(t.type="mouseleave",this.handleType(t,a)),this.hoveredFeatures.clear()}handleType(t,a){const p=t.type==="mouseenter";if(p&&!this.interactionsByType.has(t.type))return void r.w("mouseenter interaction required for mouseleave to work.");const y=Array.from(this.interactionsByType.get(t.type)).reverse(),b=!!a;a=a||this.queryTargets(t.point,y);let T=!1;const R=new Set;for(const D of a){for(const[L,F]of y){if(!F.target)continue;const j=D.variants?D.variants[L]:null;if(j){for(const B of j){if(Ko(B,D,R,L))continue;const $=new r.dw(D,B),Z=Js(B,D,L);b&&$.id!==void 0&&($.state=this.map.getFeatureState($));const Q=p?this.prevHoveredFeatures.get(Z):null,re=new bx(t,L,F,$),te=Q?Q.stop:F.handler(re);if(p&&this.hoveredFeatures.set(Z,{feature:D,stop:te}),te!==!1){T=!0;break}}if(T)break}}if(T)break}if(!T)for(const[D,L]of y){const{handler:F,target:j}=L;if(!j&&F(new bx(t,D,L,null))!==!1)break}}}function Eg(f,t){if(Array.isArray(f)&&Array.isArray(t)){const a=new Set(f),p=new Set(t);return a.size===p.size&&f.every(y=>p.has(y))}return r.bx(f,t)}const kh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Cg={showCompass:!0,showZoom:!0,visualizePitch:!1};class wf{constructor(t,a,p=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Gp({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,p&&(this.mousePitch=new wg({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),r.aX(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(t,a){this.mouseRotate.mousedown(t,a),this.mousePitch&&this.mousePitch.mousedown(t,a),Xe()}move(t,a){const p=this.map,y=this.mouseRotate.mousemoveWindow(t,a),b=y&&y.bearingDelta;if(b&&p.setBearing(p.getBearing()+b),this.mousePitch){const T=this.mousePitch.mousemoveWindow(t,a),R=T&&T.pitchDelta;R&&p.setPitch(p.getPitch()+R)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){it(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),oi(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,oi(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=yi(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=yi(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Hu(f,t,a){if(f=new r.aS(f.lng,f.lat),t){const p=new r.aS(f.lng-360,f.lat),y=new r.aS(f.lng+360,f.lat),b=360*Math.ceil(Math.abs(f.lng-a.center.lng)/360),T=a.locationPoint3D(f).distSqr(t),R=t.x<0||t.y<0||t.x>a.width||t.y>a.height;a.locationPoint3D(p).distSqr(t)<T&&(R||Math.abs(p.lng-a.center.lng)<b)?f=p:a.locationPoint3D(y).distSqr(t)<T&&(R||Math.abs(y.lng-a.center.lng)<b)&&(f=y)}for(;Math.abs(f.lng-a.center.lng)>180;){const p=a.locationPoint3D(f);if(p.x>=0&&p.y>=0&&p.x<=a.width&&p.y<=a.height)break;f.lng>a.center.lng?f.lng-=360:f.lng+=360}return f}const il={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},qo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class $u extends r.E{constructor(t,a){super(),(t instanceof HTMLElement||a)&&(t=Object.assign({element:t},a)),r.aX(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:y="#3FB1CE",scale:b=1,draggable:T=!1,clickTolerance:R=0,rotation:D=qo.rotation,rotationAlignment:L=qo.rotationAlignment,pitchAlignment:F=qo.pitchAlignment,occludedOpacity:j=qo.occludedOpacity,altitude:B=qo.altitude}=t||{};this._anchor=p,this._color=y,this._scale=b,this._draggable=T,this._clickTolerance=R,this._rotation=D,this._rotationAlignment=L,this._pitchAlignment=F,this._occludedOpacity=j,this._altitude=B,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=r.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=r.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",Q=>{Q.preventDefault()}),this._element.addEventListener("mousedown",Q=>{Q.preventDefault()});const $=this._element.classList;for(const Q in il)$.remove(`mapboxgl-marker-anchor-${Q}`);$.add(`mapboxgl-marker-anchor-${this._anchor}`);const Z=t&&t.className?t.className.trim().split(/\s+/):[];$.add(...Z),this._popup=null}_createDefaultMarker(){const t=xe("div"),a=be("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const p=be("radialGradient",{id:"shadowGradient"},be("defs",{},a));be("stop",{offset:"10%","stop-opacity":.4},p),be("stop",{offset:"100%","stop-opacity":.05},p),be("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a)}return be("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),be("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),be("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=r.aS.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||qo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const a=t.code,p=t.charCode||t.keyCode;a!=="Space"&&a!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(t){const a=t.originalEvent.target,p=this._element;this._popup&&(a===p||p.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,a=this._pos;if(!t||!a)return!1;const p=t.unproject(a,this._altitude),y=t.getFreeCameraOptions();if(!y.position)return!1;const b=y.position.toLngLat();return b.distanceTo(p)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const a=this._pos;if(!a||a.x<0||a.x>t.transform.width||a.y<0||a.y>t.transform.height)return void this._clearFadeTimer();const p=t.unproject(a,this._altitude);let y;t._showingGlobe()&&r.f4(t.transform,this._lngLat)?y=0:(y=1-t._queryFogOpacity(p),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${il[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const t=this._pos,a=this._map,p=this.getPitchAlignment();if(!a||!t||p!=="map")return"";if(!a._showingGlobe()){const D=a.getPitch();return D?`rotateX(${D}deg)`:""}const y=r.cW(r.f5(a.transform,this._lngLat)),b=t.sub(r.f6(a.transform)),T=Math.abs(b.x)+Math.abs(b.y);if(T===0)return"";const R=y/T;return`rotateX(${-b.y*R}deg) rotateY(${b.x*R}deg)`}_calculateZTransform(){const t=this._pos,a=this._map;if(!a||!t)return"";let p=0;const y=this.getRotationAlignment();if(y==="map")if(a._showingGlobe()){const b=a.project(new r.aS(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),T=a.project(new r.aS(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);p=r.cW(Math.atan2(T.y,T.x))-90}else p=-a.getBearing();else if(y==="horizon"){const b=r.ah(4,6,a.getZoom()),T=r.f6(a.transform);T.y+=b*a.transform.height;const R=t.sub(T),D=r.cW(Math.atan2(R.y,R.x));p=(D>90?D-270:D+90)*(1-b)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Hu(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=r.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const a=this._map;if(!a)return;const p=this._pointerdownPos,y=this._positionDelta;if(p&&y){if(!this._isDragging){const b=this._clickTolerance||a._clickTolerance;if(t.point.dist(p)<b)return;this._isDragging=!0}this._pos=t.point.sub(y),this._lngLat=a.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.z("dragstart"))),this.fire(new r.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.z("dragend")),this._state="inactive"}_addDragHandler(t){const a=this._map,p=this._pos;a&&p&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(p),this._pointerdownPos=t.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const a=this._map;return a&&(t?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||qo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||qo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||qo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||qo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ns={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},qp={maxWidth:100,unit:"metric"},Tf={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},gy={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},wx=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _y(f=new r.P(0,0),t="bottom"){if(typeof f=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(t){case"top":return new r.P(0,f);case"top-left":return new r.P(a,a);case"top-right":return new r.P(-a,a);case"bottom":return new r.P(0,-f);case"bottom-left":return new r.P(a,-a);case"bottom-right":return new r.P(-a,-a);case"left":return new r.P(f,0);case"right":return new r.P(-f,0)}return new r.P(0,0)}return f instanceof r.P||Array.isArray(f)?r.P.convert(f):r.P.convert(f[t]||[0,0])}return{version:z,supported:pe.supported,setRTLTextPlugin:r.fa,getRTLTextPluginStatus:r.f9,Map:class extends ds{constructor(f){H.mark(N.create);const t=f;if((f=Object.assign({},kh,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&r.f2(window)&&(f.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Yd(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies,null,null),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new bf,this._domRenderTaskQueue=new bf,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.b1(),this._locale=Object.assign({},Gb,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._tessellationStep=f.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=f.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Zl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=f.scaleFactor,this._requestManager=new Di(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Object.assign({},f.contextCreateOptions):{},typeof f.container=="string"){const a=document.getElementById(f.container);if(!a)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=a}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),this._spriteFormat=f.spriteFormat,r.aX(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Np),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new xf(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||r.e.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new vg(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});const a=f.bounds;a&&(this.resize(),this.fitBounds(a,Object.assign({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Sl({customAttribution:f.customAttribution})),this._logoControl=new ql,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new r.z(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new r.z(`${a.dataType}dataloading`,a))}),this._interactions=new my(this)}_getMapId(){return this._mapId}addControl(f,t){if(t===void 0&&(t=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new r.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[t];return t.indexOf("bottom")!==-1?p.insertBefore(a,p.firstChild):p.appendChild(a),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new r.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(f);return t>-1&&this._controls.splice(t,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new r.z("movestart",f)).fire(new r.z("move",f)),this.fire(new r.z("resize",f)),t&&this.fire(new r.z("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(r.aI.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new r.z("zoomstart")).fire(new r.z("zoom")).fire(new r.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new r.z("pitchstart")).fire(new r.z("pitch")).fire(new r.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(f){return this._scaleFactor=f,this.painter.scaleFactor=f,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(t=>t==="auto"?navigator.language:t):f}setLanguage(f){const t=this._parseLanguage(f);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,t=f.projection.name;let a;t==="globe"&&f.zoom>=r.cK?(f.setMercatorFromTransition(),a=!0):t==="mercator"&&f.zoom<r.cK&&(f.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(f,t){return this._updateProjection(f||t||{name:"mercator"})}_updateProjection(f){let t;const a=this.transform.mercatorFromTransition;t=f.name==="globe"&&this.transform.zoom>=r.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate();const p=this.transform.getProjection().name==="mercator"&&a!==this.transform.mercatorFromTransition;return(t||p)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f,t){return this.transform.locationPoint3D(r.aS.convert(f),t)}unproject(f,t){return this.transform.pointLocation3D(r.P.convert(f),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,t,a){const p=y=>{let b=[];if(Array.isArray(t)){const T=t.filter(R=>this.getLayer(R));b=T.length?this.queryRenderedFeatures(y,{layers:T}):[]}else b=this.queryRenderedFeatures(y,{target:t});return b};if(f==="mouseenter"||f==="mouseover"){let y=!1;return{listener:a,targets:t,delegates:{mousemove:T=>{const R=p(T.point);R.length?y||(y=!0,a.call(this,new ar(f,this,T.originalEvent,{features:R}))):y=!1},mouseout:()=>{y=!1}}}}if(f==="mouseleave"||f==="mouseout"){let y=!1;return{listener:a,targets:t,delegates:{mousemove:R=>{p(R.point).length?y=!0:y&&(y=!1,a.call(this,new ar(f,this,R.originalEvent)))},mouseout:R=>{y&&(y=!1,a.call(this,new ar(f,this,R.originalEvent)))}}}}{const y=b=>{const T=p(b.point);T.length&&(b.features=T,a.call(this,b),delete b.features)};return{listener:a,targets:t,delegates:{[f]:y}}}}on(f,t,a){if(typeof t=="function"||a===void 0)return super.on(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const p=this._createDelegatedListener(f,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const y in p.delegates)this.on(y,p.delegates[y]);return this}once(f,t,a){if(typeof t=="function"||a===void 0)return super.once(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const p=this._createDelegatedListener(f,t,a);for(const y in p.delegates)this.once(y,p.delegates[y]);return this}off(f,t,a){if(typeof t=="function"||a===void 0)return super.off(f,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const p=this._delegatedListeners?this._delegatedListeners[f]:void 0;return p&&(y=>{for(let b=0;b<y.length;b++){const T=y[b];if(T.listener===a&&Eg(T.targets,t)){for(const R in T.delegates)this.off(R,T.delegates[R]);return y.splice(b,1),this}}})(p),this}queryRenderedFeatures(f,t){if(!this.style)return[];if(f===void 0||f instanceof r.P||Array.isArray(f)||t!==void 0||(t=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],!t){const b=this.style.queryRenderedFeatures(f,void 0,this.transform),T=this.style.queryRenderedFeatureset(f,void 0,this.transform);return b.concat(T)}let a=!0;if(t.target&&(a=this._isTargetValid(t.target),a&&!t.layers))return this.style.queryRenderedFeatureset(f,t,this.transform);let p=!0;if(t.layers&&Array.isArray(t.layers)){for(const b of t.layers)if(!this._isValidId(b)){p=!1;break}if(p&&!t.target)return this.style.queryRenderedFeatures(f,t,this.transform)}let y=[];return p&&(y=y.concat(this.style.queryRenderedFeatures(f,t,this.transform))),a&&(y=y.concat(this.style.queryRenderedFeatureset(f,t,this.transform))),y}querySourceFeatures(f,t){return!f||typeof f=="string"&&!this._isValidId(f)?[]:this.style.querySourceFeatures(f,t)}queryRasterValue(f,t,a){return this._isValidId(f)?this.style.queryRasterValue(f,t,a):Promise.resolve(null)}isPointOnSurface(f){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&r.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(f))}addInteraction(f,t){return this._interactions.add(f,t),this}removeInteraction(f){return this._interactions.remove(f),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(f){return this._cooperativeGestures=f,this}setStyle(f,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&f&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(f,(a,p)=>{if(a){const y=typeof a=="string"?a:a instanceof Error?a.message:a.error;r.w(`Unable to perform style diff: ${y}. Rebuilding the style from scratch.`),this._updateStyle(f,t)}else p&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(f,t))}_getUIString(f){const t=this._locale[f];if(t==null)throw new Error(`Missing UI string '${f}'`);return t}_updateStyle(f,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){const a=Object.assign({},t);t&&t.config&&(a.initialConfig=t.config,delete a.config),this.style=new Fl(this,a).load(f),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Fl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new r.y(new Error("IDs can't be empty."))),!1):!r.dq(f)||(this.fire(new r.y(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}_isTargetValid(f){return"featuresetId"in f?this._isValidId("importId"in f?f.importId:f.featuresetId):"layerId"in f&&this._isValidId(f.layerId)}_areTargetsValid(f){if(Array.isArray(f)){for(const t of f)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(f)}addSource(f,t){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,t),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,t,a){this._lazyInitEmptyStyle(),this.style.addSourceType(f,t,a)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,t,{pixelRatio:a=1,sdf:p=!1,stretchX:y,stretchY:b,content:T}={}){this._lazyInitEmptyStyle();const R=r.I.from(f);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:D,height:L,data:F}=r.o.getImageData(t);this.style.addImage(R,{data:new r.q({width:D,height:L},F),pixelRatio:a,stretchX:y,stretchY:b,content:T,sdf:p,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new r.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:D,height:L}=t,F=t;this.style.addImage(R,{data:new r.q({width:D,height:L},new Uint8Array(F.data)),pixelRatio:a,stretchX:y,stretchY:b,content:T,sdf:p,usvg:!1,version:0,userImage:F}),F.onAdd&&F.onAdd(this,f)}}updateImage(f,t){this._lazyInitEmptyStyle();const a=r.I.from(f),p=this.style.getImage(a);if(!p)return void this.fire(new r.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?r.o.getImageData(t):t,{width:b,height:T,data:R}=y;if(b===void 0||T===void 0)return void this.fire(new r.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||T!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new r.y(new Error(`The width and height of the updated image (${b}, ${T})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const D=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let L=!1;p.usvg?(p.data=new r.q({width:b,height:T},new Uint8Array(R)),p.usvg=!1,p.icon=void 0,L=!0):p.data.replace(R,D),this.style.updateImage(a,p,L)}hasImage(f){return f?!!this.style&&!!this.style.getImage(r.I.from(f)):(this.fire(new r.y(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(r.I.from(f))}loadImage(f,t){r.n(this._requestManager.transformRequest(f,r.R.Image),(a,p)=>{t(a,p instanceof HTMLImageElement?r.o.getImageData(p):p)})}listImages(){return this.style.listImages().map(f=>f.name)}addModel(f,t){this._lazyInitEmptyStyle(),this.style.addModel(f,t)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new r.y(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,t){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,t),this._update(!0)):this}getSlot(f){const t=this.getLayer(f);return t&&t.slot||null}setSlot(f,t){return this.style.setSlot(f,t),this.style.mergeLayers(),this._update(!0)}addImport(f,t){return this.style.addImport(f,t).catch(a=>this.fire(new r.y(new Error("Failed to add import",a)))),this}updateImport(f,t){return typeof t!="string"&&t.id!==f?(this.removeImport(f),this.addImport(t)):(this.style.updateImport(f,t),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,t){return this.style.moveImport(f,t),this._update(!0)}moveLayer(f,t){return this._isValidId(f)?(this.style.moveLayer(f,t),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){if(!this._isValidId(f))return null;const t=this.style.getOwnLayer(f);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(f,t,a){return this._isValidId(f)?(this.style.setLayerZoomRange(f,t,a),this._update(!0)):this}setFilter(f,t,a={}){return this._isValidId(f)?(this.style.setFilter(f,t,a),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,t,a,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,t,a,p),this._update(!0)):this}getPaintProperty(f,t){return this._isValidId(f)?this.style.getPaintProperty(f,t):null}setLayoutProperty(f,t,a,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,t,a,p),this._update(!0)):this}getLayoutProperty(f,t){return this._isValidId(f)?this.style.getLayoutProperty(f,t):null}setLayerProperty(f,t,a,p={}){return this._isValidId(f)?(this.style.setLayerProperty(f,t,a,p),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(f){return this.style.setGlyphsUrl(f),this._update(!0)}getSchema(f){return this.style.getSchema(f)}setSchema(f,t){return this.style.setSchema(f,t),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,t){return this.style.setConfig(f,t),this._update(!0)}getConfigProperty(f,t){return this.style.getConfigProperty(f,t)}setConfigProperty(f,t,a){return this.style.setConfigProperty(f,t,a),this._update(!0)}getFeaturesetDescriptors(f){return this.style.getFeaturesetDescriptors(f)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){const t=f[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(f){return this._lazyInitEmptyStyle(),this.style.setSnow(f),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(f){return this._lazyInitEmptyStyle(),this.style.setRain(f),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(f){return this._lazyInitEmptyStyle(),this.style.setColorTheme(f),this._update(!0)}setImportColorTheme(f,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(f,t),this._update(!0)}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.aS.convert(f),this.transform):0}setFeatureState(f,t){return f.source&&!this._isValidId(f.source)?this:(this.style.setFeatureState(f,t),this._update())}removeFeatureState(f,t){return f.source&&!this._isValidId(f.source)?this:(this.style.removeFeatureState(f,t),this._update())}getFeatureState(f){return f.source&&!this._isValidId(f.source)?null:this.style.getFeatureState(f)}_selectIndoorFloor(f){this.indoor.selectFloor(f)}_setIndoorActiveFloorsVisibility(f){this.indoor.setActiveFloorsVisibility(f)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Ed),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let a,p,y,b=this._container;for(;b&&(!p||!y);){const T=window.getComputedStyle(b).transform;T&&T!=="none"&&(a=T.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(p=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(y=a[3])),b=b.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=y?Math.abs(t/y):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new mh(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=xe("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=xe("div","mapboxgl-canvas-container",f);this._canvas=xe("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=xe("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(y=>{p[y]=xe("div",`mapboxgl-ctrl-${y}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,t){const a=r.o.devicePixelRatio||1;this._canvas.width=a*Math.ceil(f),this._canvas.height=a*Math.ceil(t),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${t}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const t=this._markers.indexOf(f);t!==-1&&this._markers.splice(t,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const t=this._popups.indexOf(f);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const f=Object.assign({},pe.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",f);t?(eo(t,!0),this.painter=new Vu(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.k.testSupport(t)):this.fire(new r.y(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.z("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new r.z("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let t;this.fire(new r.z("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,p=r.o.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=y.createQuery(),y.beginQuery(a.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,F=this.transform.pitch,j=r.o.now(),B=new r.ac(L,{now:j,fadeDuration:b,pitch:F,transition:this.style.transition,worldview:this._worldview});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):T=this._updateAverageElevation(p);const R=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),R&&(this._placementDirty=R.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,H.mark(N.load),this.fire(new r.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const L=r.o.now()-p;y.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{const F=y.getQueryParameter(t,y.QUERY_RESULT)/1e6;y.deleteQuery(t),this.fire(new r.z("gpu-timing-frame",{cpuTime:L,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(L);this.fire(new r.z("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(L);this.fire(new r.z("gpu-timing-deferred-render",{gpuTime:F}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(D||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(T=this._updateAverageElevation(p,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new r.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new r.z("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,H.mark(N.fullLoad),this._performanceMetricsCollection&&Rn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const t of this._markers)f&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!f||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(f,t=!1){const a=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(t||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const y=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=f;const T=Math.abs(y-b);if(T>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(b),a(b);this._averageElevation.easeTo(b,f,300)}else if(T>1e-4)return this._averageElevation.jumpTo(b),a(b)}return!!this._averageElevation.isEasing(f)&&a(this._averageElevation.getValue(f))}_authenticate(){za(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===Dt||f.status===401)){const t=this.painter.context.gl;eo(t,!1),this._logoControl instanceof ql&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),mr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Aa(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Cn(this._requestManager._customAccessToken)}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const a=this.painter.context.gl,p=a.createFramebuffer();function y(b){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b,0);const T=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,T),T}return a.bindFramebuffer(a.FRAMEBUFFER,p),this._canvasPixelComparison(y(f),t.canvasCopies.map(y),t.timeStamps)}_canvasPixelComparison(f,t,a){let p=a[1]-a[0];const y=f.length/4;for(let b=0;b<t.length;b++){const T=t[b];let R=0;for(let D=0;D<T.length;D+=4)T[D]===f[D]&&T[D+1]===f[D+1]&&T[D+2]===f[D+2]&&T[D+3]===f[D+3]&&(R+=1);p+=(a[b+2]-a[b+1])*(1-R/y)}return p}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Bn.delete(this.painter.context.gl),gr.remove(),xn.remove(),this._removed=!0,this.fire(new r.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=r.o.frame(t=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(t)}))}_preloadTiles(f){const t=this.style?this.style.getSourceCaches():[];return r.bv(t,(a,p)=>a._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,t){r.f3(f,t)}get version(){return z}},NavigationControl:class{constructor(f={}){this.options=Object.assign({},Cg,f),this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(r.aX(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),xe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),xe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aX(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:t}):a.resetNorth({},{originalEvent:t}))}),this._compassIcon=xe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const t=f.getZoom(),a=t===f.getMaxZoom(),p=t===f.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wf(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,t){const a=xe("button",f,this._container);return a.type="button",a.addEventListener("click",t),a}_setButtonTitle(f,t){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${t}`);f.setAttribute("aria-label",a),f.firstElementChild&&f.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends r.E{constructor(f={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},Ns,f),r.aX(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=wd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const t=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,f(a)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>t(a.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(f){const t=this._map.getMaxBounds(),a=f.coords;return!!t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new r.z("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("geolocate",Object.assign({coords:f.coords,timestamp:f.timestamp},f.toJSON?{toJSON:f.toJSON.bind(f)}:{}))),this._finish()}}_updateCamera(f){const t=new r.aS(f.coords.longitude,f.coords.latitude),a=f.coords.accuracy,p=this._map.getBearing(),y=Object.assign({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(a),y,{geolocateSource:!0})}_updateMarker(f){if(f){const t=new r.aS(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,t=r.ce(1,f._center.lat)*f.worldSize,a=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.z("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=xe("button","mapboxgl-ctrl-geolocate",this._container),xe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=xe("div","mapboxgl-user-location"),this._dotElement.appendChild(xe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(xe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new $u({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=xe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $u({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.z("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Sl,ScaleControl:class{constructor(f={}){this.options=Object.assign({},qp,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aX(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,t=this._map,a=t._containerHeight/2,p=t._containerWidth/2-f/2,y=t.unproject([p,a]),b=t.unproject([p+f,a]),T=y.distanceTo(b);if(this.options.unit==="imperial"){const R=3.2808*T;R>5280?this._setScale(f,R/5280,"mile"):this._setScale(f,R,"foot")}else this.options.unit==="nautical"?this._setScale(f,T/1852,"nautical-mile"):T>=1e3?this._setScale(f,T/1e3,"kilometer"):this._setScale(f,T,"meter")}_setScale(f,t,a){this._map._requestDomTask(()=>{const p=function(b){const T=Math.pow(10,`${Math.floor(b)}`.length-1);let R=b/T;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(D){const L=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*L)/L}(R),T*R}(t),y=p/t;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(p):`${p}&nbsp;${Tf[a]}`,this._container.style.width=f*y+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f={}){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:r.w("Full screen control 'container' must be a DOM element.")),r.aX(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=xe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);xe("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Ed,Popup:class extends r.E{constructor(f){super(),this.options=Object.assign(Object.create(gy),f),this._altitude=this.options.altitude,r.aX(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new r.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new r.z("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=r.aS.convert(f),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(f){return this._altitude=f,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const t=document.createDocumentFragment(),a=document.createElement("body");let p;for(a.innerHTML=f;p=a.firstChild,p;)t.appendChild(p);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=xe("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(f),this.options.closeButton){const a=this._closeButton=xe("button","mapboxgl-popup-close-button",t);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let t;return this._classList.delete(f)?t=!1:(this._classList.add(f),t=!0),this._updateClassList(),t}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const t=this._map,a=this._container,p=this._pos;if(!t||!a||!p)return"bottom";const y=a.offsetWidth,b=a.offsetHeight,T=p.x<y/2,R=p.x>t.transform.width-y/2;if(p.y+f<b)return T?"top-left":R?"top-right":"top";if(p.y>t.transform.height-b){if(T)return"bottom-left";if(R)return"bottom-right"}return T?"left":R?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),f.className=t.join(" ")}_update(f){const t=this._map,a=this._content;if(!t||!this._lngLat&&!this._trackPointer||!a)return;let p=this._container;if(p||(p=this._container=xe("div","mapboxgl-popup",t.getContainer()),this._tip=xe("div","mapboxgl-popup-tip",p),p.appendChild(a)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Hu(this._lngLat,this._pos,t.transform)),!this._trackPointer||f){const y=this._pos=this._trackPointer&&f instanceof r.P?f:t.project(this._lngLat,this._altitude),b=_y(this.options.offset),T=this._anchor=this._getAnchor(b.y),R=_y(this.options.offset,T),D=y.add(R).round();t._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${il[T]} translate(${D.x}px,${D.y}px)`)})}if(!this._marker&&t._showingGlobe()){const y=r.f4(t.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(wx);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:$u,Style:Fl,LngLat:r.aS,LngLatBounds:r.aI,Point:r.P,MercatorCoordinate:r.ae,FreeCameraOptions:zl,Evented:r.E,config:r.e,prewarm:r.f8,clearPrewarmedResources:r.f7,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(f){r.e.ACCESS_TOKEN=f},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(f){r.e.API_URL=f},get workerCount(){return r.fh.workerCount},set workerCount(f){r.fh.workerCount=f},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){r.e.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){r.fg(f)},get workerUrl(){return r.ff.workerUrl},set workerUrl(f){r.ff.workerUrl=f},get workerClass(){return r.ff.workerClass},set workerClass(f){r.ff.workerClass=f},get workerParams(){return r.ff.workerParams},set workerParams(f){r.ff.workerParams=f},get dracoUrl(){return r.fe()},set dracoUrl(f){r.fd(f)},get meshoptUrl(){return r.fc()},set meshoptUrl(f){r.fb(f)},setNow:r.o.setNow,restoreNow:r.o.restoreNow}});var C=v;return C})})(bk);var jB=bk.exports;const mC=xO(jB),QM={hass:"#4CAF50",fuerte:"#1E88E5",zutano:"#FB8C00",other:"#8E24AA"};function Tk(d){return d?d.type==="Polygon"?d:d.coordinates?{type:"Polygon",coordinates:d.coordinates}:Array.isArray(d)?{type:"Polygon",coordinates:[d]}:null:null}function GB(d){const s=Tk(d);if(!s)return null;const h=s.coordinates[0];if(!(h!=null&&h.length))return null;const _=new mC.LngLatBounds([h[0][0],h[0][1]],[h[0][0],h[0][1]]);return h.forEach(v=>_.extend([v[0],v[1]])),_}function HB(d){return`sector-${d.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w-]/g,"")}`}const $B=({field:d,height:s="500px",filters:h})=>{const _=Ct.useRef(null),v=Ct.useRef(null),E=Ct.useRef(null),[C,r]=Ct.useState("normal"),z=Ct.useMemo(()=>{let ne=d.sectors??[];return h!=null&&h.species&&(ne=ne.filter(ue=>{var pe;return((pe=ue.species)==null?void 0:pe.toLowerCase())===h.species.toLowerCase()})),ne},[d.sectors,h==null?void 0:h.species]),N=Ct.useMemo(()=>z.reduce((ne,ue)=>ne+(ue.kg_total??0),0),[z]),H=Ct.useMemo(()=>Math.max(...z.map(ne=>ne.kg_total??0),1),[z]),K=ne=>{var ue;return QM[((ue=ne.species)==null?void 0:ue.toLowerCase())??"other"]??QM.other};return Ct.useEffect(()=>{mC.accessToken="pk.eyJ1IjoibWljaGFlbHJ0IiwiYSI6ImNtZ3V2dHk0czBnNzkyam9zcmM2MjlpcWYifQ.8wBT5b8zb0rxn4F5G9HpxQ",!v.current&&(v.current=new mC.Map({container:_.current,style:"mapbox://styles/mapbox/satellite-streets-v12",center:[-70.65,-33.45],zoom:11}),E.current=new mC.Popup({closeButton:!1,closeOnClick:!1}))},[]),Ct.useEffect(()=>{var xe,be,je;const ne=v.current;if(!ne)return;const ue=((xe=d.metadata)==null?void 0:xe.polygon)||((je=(be=d.sectors)==null?void 0:be[0])==null?void 0:je.polygon),pe=GB(ue);pe&&ne.fitBounds(pe,{padding:60,duration:800})},[d]),Ct.useEffect(()=>{const ne=v.current;!ne||!ne.isStyleLoaded()||(Object.keys(ne.getStyle().sources||{}).forEach(ue=>{ue.startsWith("sector-")&&(ne.getLayer(`${ue}-fill`)&&ne.removeLayer(`${ue}-fill`),ne.getLayer(`${ue}-line`)&&ne.removeLayer(`${ue}-line`),ne.getSource(ue)&&ne.removeSource(ue))}),z.forEach(ue=>{const pe=Tk(ue.polygon);if(!pe)return;const xe=HB(ue.name);ne.addSource(xe,{type:"geojson",data:{type:"Feature",geometry:pe,properties:{name:ue.name,kg:ue.kg_total??0,species:ue.species??"other"}}});let be="#66BB6A";C==="species"&&(be=K(ue)),C==="heatmap"&&(be=["interpolate",["linear"],["get","kg"],0,"#E3F2FD",H*.25,"#90CAF9",H*.5,"#42A5F5",H*.75,"#FB8C00",H,"#E65100"]),ne.addLayer({id:`${xe}-fill`,type:"fill",source:xe,paint:{"fill-color":be,"fill-opacity":C==="normal"?.35:.6}}),ne.addLayer({id:`${xe}-line`,type:"line",source:xe,paint:{"line-color":"#263238","line-width":1.2}}),ne.on("mouseenter",`${xe}-fill`,je=>{var He,Xe;ne.getCanvas().style.cursor="pointer";const Be=(Xe=(He=je.features)==null?void 0:He[0])==null?void 0:Xe.properties;!Be||!E.current||E.current.setLngLat(je.lngLat).setHTML(`
            <div style="font-size:12px">
              <strong>${Be.name}</strong><br/>
              Especie: ${Be.species}<br/>
              Produccin: ${Number(Be.kg).toLocaleString("es-CL")} kg
            </div>
          `).addTo(ne)}),ne.on("mouseleave",`${xe}-fill`,()=>{var je;ne.getCanvas().style.cursor="",(je=E.current)==null||je.remove()})}))},[z,C,H]),Ut.jsxDEV("div",{style:{position:"relative"},children:[Ut.jsxDEV("div",{style:{position:"absolute",top:10,left:10,zIndex:10,background:"rgba(0,0,0,0.65)",color:"white",padding:"8px 12px",borderRadius:6,fontSize:13},children:[Ut.jsxDEV("strong",{children:"Total campo"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:276,columnNumber:9},void 0),Ut.jsxDEV("br",{},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:276,columnNumber:37},void 0),N.toLocaleString("es-CL")," kg"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:263,columnNumber:7},void 0),Ut.jsxDEV("div",{style:{position:"absolute",top:10,right:10,zIndex:10,display:"flex",gap:6},children:["normal","species","heatmap"].map(ne=>Ut.jsxDEV("button",{onClick:()=>r(ne),style:{padding:"6px 10px",borderRadius:6,border:"none",cursor:"pointer",background:C===ne?"#0D47A1":"#90CAF9",color:"white",fontWeight:600},children:ne.toUpperCase()},ne,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:292,columnNumber:11},void 0))},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:281,columnNumber:7},void 0),Ut.jsxDEV("div",{ref:_,style:{width:"100%",height:s}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:310,columnNumber:7},void 0)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/FieldMap.tsx",lineNumber:261,columnNumber:5},void 0)};/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function PT(d){return d+.5|0}const D_=(d,s,h)=>Math.max(Math.min(d,h),s);function eT(d){return D_(PT(d*2.55),0,255)}function L_(d){return D_(PT(d*255),0,255)}function Om(d){return D_(PT(d/2.55)/100,0,1)}function eP(d){return D_(PT(d*100),0,100)}const rd={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},yI=[..."0123456789ABCDEF"],WB=d=>yI[d&15],qB=d=>yI[(d&240)>>4]+yI[d&15],ZE=d=>(d&240)>>4===(d&15),ZB=d=>ZE(d.r)&&ZE(d.g)&&ZE(d.b)&&ZE(d.a);function XB(d){var s=d.length,h;return d[0]==="#"&&(s===4||s===5?h={r:255&rd[d[1]]*17,g:255&rd[d[2]]*17,b:255&rd[d[3]]*17,a:s===5?rd[d[4]]*17:255}:(s===7||s===9)&&(h={r:rd[d[1]]<<4|rd[d[2]],g:rd[d[3]]<<4|rd[d[4]],b:rd[d[5]]<<4|rd[d[6]],a:s===9?rd[d[7]]<<4|rd[d[8]]:255})),h}const YB=(d,s)=>d<255?s(d):"";function KB(d){var s=ZB(d)?WB:qB;return d?"#"+s(d.r)+s(d.g)+s(d.b)+YB(d.a,s):void 0}const JB=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Sk(d,s,h){const _=s*Math.min(h,1-h),v=(E,C=(E+d/30)%12)=>h-_*Math.max(Math.min(C-3,9-C,1),-1);return[v(0),v(8),v(4)]}function QB(d,s,h){const _=(v,E=(v+d/60)%6)=>h-h*s*Math.max(Math.min(E,4-E,1),0);return[_(5),_(3),_(1)]}function e3(d,s,h){const _=Sk(d,1,.5);let v;for(s+h>1&&(v=1/(s+h),s*=v,h*=v),v=0;v<3;v++)_[v]*=1-s-h,_[v]+=s;return _}function t3(d,s,h,_,v){return d===v?(s-h)/_+(s<h?6:0):s===v?(h-d)/_+2:(d-s)/_+4}function XI(d){const h=d.r/255,_=d.g/255,v=d.b/255,E=Math.max(h,_,v),C=Math.min(h,_,v),r=(E+C)/2;let z,N,H;return E!==C&&(H=E-C,N=r>.5?H/(2-E-C):H/(E+C),z=t3(h,_,v,H,E),z=z*60+.5),[z|0,N||0,r]}function YI(d,s,h,_){return(Array.isArray(s)?d(s[0],s[1],s[2]):d(s,h,_)).map(L_)}function KI(d,s,h){return YI(Sk,d,s,h)}function i3(d,s,h){return YI(e3,d,s,h)}function n3(d,s,h){return YI(QB,d,s,h)}function Ek(d){return(d%360+360)%360}function r3(d){const s=JB.exec(d);let h=255,_;if(!s)return;s[5]!==_&&(h=s[6]?eT(+s[5]):L_(+s[5]));const v=Ek(+s[2]),E=+s[3]/100,C=+s[4]/100;return s[1]==="hwb"?_=i3(v,E,C):s[1]==="hsv"?_=n3(v,E,C):_=KI(v,E,C),{r:_[0],g:_[1],b:_[2],a:h}}function a3(d,s){var h=XI(d);h[0]=Ek(h[0]+s),h=KI(h),d.r=h[0],d.g=h[1],d.b=h[2]}function o3(d){if(!d)return;const s=XI(d),h=s[0],_=eP(s[1]),v=eP(s[2]);return d.a<255?`hsla(${h}, ${_}%, ${v}%, ${Om(d.a)})`:`hsl(${h}, ${_}%, ${v}%)`}const tP={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},iP={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function s3(){const d={},s=Object.keys(iP),h=Object.keys(tP);let _,v,E,C,r;for(_=0;_<s.length;_++){for(C=r=s[_],v=0;v<h.length;v++)E=h[v],r=r.replace(E,tP[E]);E=parseInt(iP[C],16),d[r]=[E>>16&255,E>>8&255,E&255]}return d}let XE;function l3(d){XE||(XE=s3(),XE.transparent=[0,0,0,0]);const s=XE[d.toLowerCase()];return s&&{r:s[0],g:s[1],b:s[2],a:s.length===4?s[3]:255}}const c3=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function u3(d){const s=c3.exec(d);let h=255,_,v,E;if(s){if(s[7]!==_){const C=+s[7];h=s[8]?eT(C):D_(C*255,0,255)}return _=+s[1],v=+s[3],E=+s[5],_=255&(s[2]?eT(_):D_(_,0,255)),v=255&(s[4]?eT(v):D_(v,0,255)),E=255&(s[6]?eT(E):D_(E,0,255)),{r:_,g:v,b:E,a:h}}}function h3(d){return d&&(d.a<255?`rgba(${d.r}, ${d.g}, ${d.b}, ${Om(d.a)})`:`rgb(${d.r}, ${d.g}, ${d.b})`)}const qR=d=>d<=.0031308?d*12.92:Math.pow(d,1/2.4)*1.055-.055,gb=d=>d<=.04045?d/12.92:Math.pow((d+.055)/1.055,2.4);function d3(d,s,h){const _=gb(Om(d.r)),v=gb(Om(d.g)),E=gb(Om(d.b));return{r:L_(qR(_+h*(gb(Om(s.r))-_))),g:L_(qR(v+h*(gb(Om(s.g))-v))),b:L_(qR(E+h*(gb(Om(s.b))-E))),a:d.a+h*(s.a-d.a)}}function YE(d,s,h){if(d){let _=XI(d);_[s]=Math.max(0,Math.min(_[s]+_[s]*h,s===0?360:1)),_=KI(_),d.r=_[0],d.g=_[1],d.b=_[2]}}function Ck(d,s){return d&&Object.assign(s||{},d)}function nP(d){var s={r:0,g:0,b:0,a:255};return Array.isArray(d)?d.length>=3&&(s={r:d[0],g:d[1],b:d[2],a:255},d.length>3&&(s.a=L_(d[3]))):(s=Ck(d,{r:0,g:0,b:0,a:1}),s.a=L_(s.a)),s}function f3(d){return d.charAt(0)==="r"?u3(d):r3(d)}class xT{constructor(s){if(s instanceof xT)return s;const h=typeof s;let _;h==="object"?_=nP(s):h==="string"&&(_=XB(s)||l3(s)||f3(s)),this._rgb=_,this._valid=!!_}get valid(){return this._valid}get rgb(){var s=Ck(this._rgb);return s&&(s.a=Om(s.a)),s}set rgb(s){this._rgb=nP(s)}rgbString(){return this._valid?h3(this._rgb):void 0}hexString(){return this._valid?KB(this._rgb):void 0}hslString(){return this._valid?o3(this._rgb):void 0}mix(s,h){if(s){const _=this.rgb,v=s.rgb;let E;const C=h===E?.5:h,r=2*C-1,z=_.a-v.a,N=((r*z===-1?r:(r+z)/(1+r*z))+1)/2;E=1-N,_.r=255&N*_.r+E*v.r+.5,_.g=255&N*_.g+E*v.g+.5,_.b=255&N*_.b+E*v.b+.5,_.a=C*_.a+(1-C)*v.a,this.rgb=_}return this}interpolate(s,h){return s&&(this._rgb=d3(this._rgb,s._rgb,h)),this}clone(){return new xT(this.rgb)}alpha(s){return this._rgb.a=L_(s),this}clearer(s){const h=this._rgb;return h.a*=1-s,this}greyscale(){const s=this._rgb,h=PT(s.r*.3+s.g*.59+s.b*.11);return s.r=s.g=s.b=h,this}opaquer(s){const h=this._rgb;return h.a*=1+s,this}negate(){const s=this._rgb;return s.r=255-s.r,s.g=255-s.g,s.b=255-s.b,this}lighten(s){return YE(this._rgb,2,s),this}darken(s){return YE(this._rgb,2,-s),this}saturate(s){return YE(this._rgb,1,s),this}desaturate(s){return YE(this._rgb,1,-s),this}rotate(s){return a3(this._rgb,s),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Dm(){}const p3=(()=>{let d=0;return()=>d++})();function ga(d){return d==null}function Ys(d){if(Array.isArray&&Array.isArray(d))return!0;const s=Object.prototype.toString.call(d);return s.slice(0,7)==="[object"&&s.slice(-6)==="Array]"}function Ca(d){return d!==null&&Object.prototype.toString.call(d)==="[object Object]"}function ad(d){return(typeof d=="number"||d instanceof Number)&&isFinite(+d)}function np(d,s){return ad(d)?d:s}function qr(d,s){return typeof d>"u"?s:d}const m3=(d,s)=>typeof d=="string"&&d.endsWith("%")?parseFloat(d)/100*s:+d;function po(d,s,h){if(d&&typeof d.call=="function")return d.apply(h,s)}function Wa(d,s,h,_){let v,E,C;if(Ys(d))for(E=d.length,v=0;v<E;v++)s.call(h,d[v],v);else if(Ca(d))for(C=Object.keys(d),E=C.length,v=0;v<E;v++)s.call(h,d[C[v]],C[v])}function AC(d,s){let h,_,v,E;if(!d||!s||d.length!==s.length)return!1;for(h=0,_=d.length;h<_;++h)if(v=d[h],E=s[h],v.datasetIndex!==E.datasetIndex||v.index!==E.index)return!1;return!0}function RC(d){if(Ys(d))return d.map(RC);if(Ca(d)){const s=Object.create(null),h=Object.keys(d),_=h.length;let v=0;for(;v<_;++v)s[h[v]]=RC(d[h[v]]);return s}return d}function Ak(d){return["__proto__","prototype","constructor"].indexOf(d)===-1}function g3(d,s,h,_){if(!Ak(d))return;const v=s[d],E=h[d];Ca(v)&&Ca(E)?cp(v,E,_):s[d]=RC(E)}function cp(d,s,h){const _=Ys(s)?s:[s],v=_.length;if(!Ca(d))return d;h=h||{};const E=h.merger||g3;let C;for(let r=0;r<v;++r){if(C=_[r],!Ca(C))continue;const z=Object.keys(C);for(let N=0,H=z.length;N<H;++N)E(z[N],d,C,h)}return d}function sT(d,s){return cp(d,s,{merger:_3})}function _3(d,s,h){if(!Ak(d))return;const _=s[d],v=h[d];Ca(_)&&Ca(v)?sT(_,v):Object.prototype.hasOwnProperty.call(s,d)||(s[d]=RC(v))}const rP={"":d=>d,x:d=>d.x,y:d=>d.y};function y3(d){const s=d.split("."),h=[];let _="";for(const v of s)_+=v,_.endsWith("\\")?_=_.slice(0,-1)+".":(h.push(_),_="");return h}function v3(d){const s=y3(d);return h=>{for(const _ of s){if(_==="")break;h=h&&h[_]}return h}}function Eb(d,s){return(rP[s]||(rP[s]=v3(s)))(d)}function JI(d){return d.charAt(0).toUpperCase()+d.slice(1)}const bT=d=>typeof d<"u",F_=d=>typeof d=="function",aP=(d,s)=>{if(d.size!==s.size)return!1;for(const h of d)if(!s.has(h))return!1;return!0};function x3(d){return d.type==="mouseup"||d.type==="click"||d.type==="contextmenu"}const Io=Math.PI,kl=2*Io,b3=kl+Io,IC=Number.POSITIVE_INFINITY,w3=Io/180,Ol=Io/2,Lv=Io/4,oP=Io*2/3,Rk=Math.log10,lp=Math.sign;function lT(d,s,h){return Math.abs(d-s)<h}function sP(d){const s=Math.round(d);d=lT(d,s,d/1e3)?s:d;const h=Math.pow(10,Math.floor(Rk(d))),_=d/h;return(_<=1?1:_<=2?2:_<=5?5:10)*h}function T3(d){const s=[],h=Math.sqrt(d);let _;for(_=1;_<h;_++)d%_===0&&(s.push(_),s.push(d/_));return h===(h|0)&&s.push(h),s.sort((v,E)=>v-E).pop(),s}function S3(d){return typeof d=="symbol"||typeof d=="object"&&d!==null&&!(Symbol.toPrimitive in d||"toString"in d||"valueOf"in d)}function wT(d){return!S3(d)&&!isNaN(parseFloat(d))&&isFinite(d)}function E3(d,s){const h=Math.round(d);return h-s<=d&&h+s>=d}function C3(d,s,h){let _,v,E;for(_=0,v=d.length;_<v;_++)E=d[_][h],isNaN(E)||(s.min=Math.min(s.min,E),s.max=Math.max(s.max,E))}function $v(d){return d*(Io/180)}function A3(d){return d*(180/Io)}function lP(d){if(!ad(d))return;let s=1,h=0;for(;Math.round(d*s)/s!==d;)s*=10,h++;return h}function Ik(d,s){const h=s.x-d.x,_=s.y-d.y,v=Math.sqrt(h*h+_*_);let E=Math.atan2(_,h);return E<-.5*Io&&(E+=kl),{angle:E,distance:v}}function vI(d,s){return Math.sqrt(Math.pow(s.x-d.x,2)+Math.pow(s.y-d.y,2))}function R3(d,s){return(d-s+b3)%kl-Io}function Vd(d){return(d%kl+kl)%kl}function QI(d,s,h,_){const v=Vd(d),E=Vd(s),C=Vd(h),r=Vd(E-v),z=Vd(C-v),N=Vd(v-E),H=Vd(v-C);return v===E||v===C||_&&E===C||r>z&&N<H}function ec(d,s,h){return Math.max(s,Math.min(h,d))}function I3(d){return ec(d,-32768,32767)}function M_(d,s,h,_=1e-6){return d>=Math.min(s,h)-_&&d<=Math.max(s,h)+_}function eD(d,s,h){h=h||(C=>d[C]<s);let _=d.length-1,v=0,E;for(;_-v>1;)E=v+_>>1,h(E)?v=E:_=E;return{lo:v,hi:_}}const Wv=(d,s,h,_)=>eD(d,h,_?v=>{const E=d[v][s];return E<h||E===h&&d[v+1][s]===h}:v=>d[v][s]<h),D3=(d,s,h)=>eD(d,h,_=>d[_][s]>=h);function M3(d,s,h){let _=0,v=d.length;for(;_<v&&d[_]<s;)_++;for(;v>_&&d[v-1]>h;)v--;return _>0||v<d.length?d.slice(_,v):d}const Dk=["push","pop","shift","splice","unshift"];function P3(d,s){if(d._chartjs){d._chartjs.listeners.push(s);return}Object.defineProperty(d,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[s]}}),Dk.forEach(h=>{const _="_onData"+JI(h),v=d[h];Object.defineProperty(d,h,{configurable:!0,enumerable:!1,value(...E){const C=v.apply(this,E);return d._chartjs.listeners.forEach(r=>{typeof r[_]=="function"&&r[_](...E)}),C}})})}function cP(d,s){const h=d._chartjs;if(!h)return;const _=h.listeners,v=_.indexOf(s);v!==-1&&_.splice(v,1),!(_.length>0)&&(Dk.forEach(E=>{delete d[E]}),delete d._chartjs)}function Mk(d){const s=new Set(d);return s.size===d.length?d:Array.from(s)}const Pk=function(){return typeof window>"u"?function(d){return d()}:window.requestAnimationFrame}();function Ok(d,s){let h=[],_=!1;return function(...v){h=v,_||(_=!0,Pk.call(window,()=>{_=!1,d.apply(s,h)}))}}function O3(d,s){let h;return function(..._){return s?(clearTimeout(h),h=setTimeout(d,s,_)):d.apply(this,_),s}}const kk=d=>d==="start"?"left":d==="end"?"right":"center",lh=(d,s,h)=>d==="start"?s:d==="end"?h:(s+h)/2,k3=(d,s,h,_)=>d===(_?"left":"right")?h:d==="center"?(s+h)/2:s;function L3(d,s,h){const _=s.length;let v=0,E=_;if(d._sorted){const{iScale:C,vScale:r,_parsed:z}=d,N=d.dataset&&d.dataset.options?d.dataset.options.spanGaps:null,H=C.axis,{min:K,max:ne,minDefined:ue,maxDefined:pe}=C.getUserBounds();if(ue){if(v=Math.min(Wv(z,H,K).lo,h?_:Wv(s,H,C.getPixelForValue(K)).lo),N){const xe=z.slice(0,v+1).reverse().findIndex(be=>!ga(be[r.axis]));v-=Math.max(0,xe)}v=ec(v,0,_-1)}if(pe){let xe=Math.max(Wv(z,C.axis,ne,!0).hi+1,h?0:Wv(s,H,C.getPixelForValue(ne),!0).hi+1);if(N){const be=z.slice(xe-1).findIndex(je=>!ga(je[r.axis]));xe+=Math.max(0,be)}E=ec(xe,v,_)-v}else E=_-v}return{start:v,count:E}}function z3(d){const{xScale:s,yScale:h,_scaleRanges:_}=d,v={xmin:s.min,xmax:s.max,ymin:h.min,ymax:h.max};if(!_)return d._scaleRanges=v,!0;const E=_.xmin!==s.min||_.xmax!==s.max||_.ymin!==h.min||_.ymax!==h.max;return Object.assign(_,v),E}const KE=d=>d===0||d===1,uP=(d,s,h)=>-(Math.pow(2,10*(d-=1))*Math.sin((d-s)*kl/h)),hP=(d,s,h)=>Math.pow(2,-10*d)*Math.sin((d-s)*kl/h)+1,cT={linear:d=>d,easeInQuad:d=>d*d,easeOutQuad:d=>-d*(d-2),easeInOutQuad:d=>(d/=.5)<1?.5*d*d:-.5*(--d*(d-2)-1),easeInCubic:d=>d*d*d,easeOutCubic:d=>(d-=1)*d*d+1,easeInOutCubic:d=>(d/=.5)<1?.5*d*d*d:.5*((d-=2)*d*d+2),easeInQuart:d=>d*d*d*d,easeOutQuart:d=>-((d-=1)*d*d*d-1),easeInOutQuart:d=>(d/=.5)<1?.5*d*d*d*d:-.5*((d-=2)*d*d*d-2),easeInQuint:d=>d*d*d*d*d,easeOutQuint:d=>(d-=1)*d*d*d*d+1,easeInOutQuint:d=>(d/=.5)<1?.5*d*d*d*d*d:.5*((d-=2)*d*d*d*d+2),easeInSine:d=>-Math.cos(d*Ol)+1,easeOutSine:d=>Math.sin(d*Ol),easeInOutSine:d=>-.5*(Math.cos(Io*d)-1),easeInExpo:d=>d===0?0:Math.pow(2,10*(d-1)),easeOutExpo:d=>d===1?1:-Math.pow(2,-10*d)+1,easeInOutExpo:d=>KE(d)?d:d<.5?.5*Math.pow(2,10*(d*2-1)):.5*(-Math.pow(2,-10*(d*2-1))+2),easeInCirc:d=>d>=1?d:-(Math.sqrt(1-d*d)-1),easeOutCirc:d=>Math.sqrt(1-(d-=1)*d),easeInOutCirc:d=>(d/=.5)<1?-.5*(Math.sqrt(1-d*d)-1):.5*(Math.sqrt(1-(d-=2)*d)+1),easeInElastic:d=>KE(d)?d:uP(d,.075,.3),easeOutElastic:d=>KE(d)?d:hP(d,.075,.3),easeInOutElastic(d){return KE(d)?d:d<.5?.5*uP(d*2,.1125,.45):.5+.5*hP(d*2-1,.1125,.45)},easeInBack(d){return d*d*((1.70158+1)*d-1.70158)},easeOutBack(d){return(d-=1)*d*((1.70158+1)*d+1.70158)+1},easeInOutBack(d){let s=1.70158;return(d/=.5)<1?.5*(d*d*(((s*=1.525)+1)*d-s)):.5*((d-=2)*d*(((s*=1.525)+1)*d+s)+2)},easeInBounce:d=>1-cT.easeOutBounce(1-d),easeOutBounce(d){return d<1/2.75?7.5625*d*d:d<2/2.75?7.5625*(d-=1.5/2.75)*d+.75:d<2.5/2.75?7.5625*(d-=2.25/2.75)*d+.9375:7.5625*(d-=2.625/2.75)*d+.984375},easeInOutBounce:d=>d<.5?cT.easeInBounce(d*2)*.5:cT.easeOutBounce(d*2-1)*.5+.5};function tD(d){if(d&&typeof d=="object"){const s=d.toString();return s==="[object CanvasPattern]"||s==="[object CanvasGradient]"}return!1}function dP(d){return tD(d)?d:new xT(d)}function ZR(d){return tD(d)?d:new xT(d).saturate(.5).darken(.1).hexString()}const F3=["x","y","borderWidth","radius","tension"],N3=["color","borderColor","backgroundColor"];function B3(d){d.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),d.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:s=>s!=="onProgress"&&s!=="onComplete"&&s!=="fn"}),d.set("animations",{colors:{type:"color",properties:N3},numbers:{type:"number",properties:F3}}),d.describe("animations",{_fallback:"animation"}),d.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:s=>s|0}}}})}function U3(d){d.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const fP=new Map;function V3(d,s){s=s||{};const h=d+JSON.stringify(s);let _=fP.get(h);return _||(_=new Intl.NumberFormat(d,s),fP.set(h,_)),_}function Lk(d,s,h){return V3(s,h).format(d)}const j3={values(d){return Ys(d)?d:""+d},numeric(d,s,h){if(d===0)return"0";const _=this.chart.options.locale;let v,E=d;if(h.length>1){const N=Math.max(Math.abs(h[0].value),Math.abs(h[h.length-1].value));(N<1e-4||N>1e15)&&(v="scientific"),E=G3(d,h)}const C=Rk(Math.abs(E)),r=isNaN(C)?1:Math.max(Math.min(-1*Math.floor(C),20),0),z={notation:v,minimumFractionDigits:r,maximumFractionDigits:r};return Object.assign(z,this.options.ticks.format),Lk(d,_,z)}};function G3(d,s){let h=s.length>3?s[2].value-s[1].value:s[1].value-s[0].value;return Math.abs(h)>=1&&d!==Math.floor(d)&&(h=d-Math.floor(d)),h}var zk={formatters:j3};function H3(d){d.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(s,h)=>h.lineWidth,tickColor:(s,h)=>h.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:zk.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),d.route("scale.ticks","color","","color"),d.route("scale.grid","color","","borderColor"),d.route("scale.border","color","","borderColor"),d.route("scale.title","color","","color"),d.describe("scale",{_fallback:!1,_scriptable:s=>!s.startsWith("before")&&!s.startsWith("after")&&s!=="callback"&&s!=="parser",_indexable:s=>s!=="borderDash"&&s!=="tickBorderDash"&&s!=="dash"}),d.describe("scales",{_fallback:"scale"}),d.describe("scale.ticks",{_scriptable:s=>s!=="backdropPadding"&&s!=="callback",_indexable:s=>s!=="backdropPadding"})}const Yv=Object.create(null),xI=Object.create(null);function uT(d,s){if(!s)return d;const h=s.split(".");for(let _=0,v=h.length;_<v;++_){const E=h[_];d=d[E]||(d[E]=Object.create(null))}return d}function XR(d,s,h){return typeof s=="string"?cp(uT(d,s),h):cp(uT(d,""),s)}class $3{constructor(s,h){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=_=>_.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(_,v)=>ZR(v.backgroundColor),this.hoverBorderColor=(_,v)=>ZR(v.borderColor),this.hoverColor=(_,v)=>ZR(v.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(s),this.apply(h)}set(s,h){return XR(this,s,h)}get(s){return uT(this,s)}describe(s,h){return XR(xI,s,h)}override(s,h){return XR(Yv,s,h)}route(s,h,_,v){const E=uT(this,s),C=uT(this,_),r="_"+h;Object.defineProperties(E,{[r]:{value:E[h],writable:!0},[h]:{enumerable:!0,get(){const z=this[r],N=C[v];return Ca(z)?Object.assign({},N,z):qr(z,N)},set(z){this[r]=z}}})}apply(s){s.forEach(h=>h(this))}}var rs=new $3({_scriptable:d=>!d.startsWith("on"),_indexable:d=>d!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[B3,U3,H3]);function W3(d){return!d||ga(d.size)||ga(d.family)?null:(d.style?d.style+" ":"")+(d.weight?d.weight+" ":"")+d.size+"px "+d.family}function pP(d,s,h,_,v){let E=s[v];return E||(E=s[v]=d.measureText(v).width,h.push(v)),E>_&&(_=E),_}function zv(d,s,h){const _=d.currentDevicePixelRatio,v=h!==0?Math.max(h/2,.5):0;return Math.round((s-v)*_)/_+v}function mP(d,s){!s&&!d||(s=s||d.getContext("2d"),s.save(),s.resetTransform(),s.clearRect(0,0,d.width,d.height),s.restore())}function bI(d,s,h,_){Fk(d,s,h,_,null)}function Fk(d,s,h,_,v){let E,C,r,z,N,H,K,ne;const ue=s.pointStyle,pe=s.rotation,xe=s.radius;let be=(pe||0)*w3;if(ue&&typeof ue=="object"&&(E=ue.toString(),E==="[object HTMLImageElement]"||E==="[object HTMLCanvasElement]")){d.save(),d.translate(h,_),d.rotate(be),d.drawImage(ue,-ue.width/2,-ue.height/2,ue.width,ue.height),d.restore();return}if(!(isNaN(xe)||xe<=0)){switch(d.beginPath(),ue){default:v?d.ellipse(h,_,v/2,xe,0,0,kl):d.arc(h,_,xe,0,kl),d.closePath();break;case"triangle":H=v?v/2:xe,d.moveTo(h+Math.sin(be)*H,_-Math.cos(be)*xe),be+=oP,d.lineTo(h+Math.sin(be)*H,_-Math.cos(be)*xe),be+=oP,d.lineTo(h+Math.sin(be)*H,_-Math.cos(be)*xe),d.closePath();break;case"rectRounded":N=xe*.516,z=xe-N,C=Math.cos(be+Lv)*z,K=Math.cos(be+Lv)*(v?v/2-N:z),r=Math.sin(be+Lv)*z,ne=Math.sin(be+Lv)*(v?v/2-N:z),d.arc(h-K,_-r,N,be-Io,be-Ol),d.arc(h+ne,_-C,N,be-Ol,be),d.arc(h+K,_+r,N,be,be+Ol),d.arc(h-ne,_+C,N,be+Ol,be+Io),d.closePath();break;case"rect":if(!pe){z=Math.SQRT1_2*xe,H=v?v/2:z,d.rect(h-H,_-z,2*H,2*z);break}be+=Lv;case"rectRot":K=Math.cos(be)*(v?v/2:xe),C=Math.cos(be)*xe,r=Math.sin(be)*xe,ne=Math.sin(be)*(v?v/2:xe),d.moveTo(h-K,_-r),d.lineTo(h+ne,_-C),d.lineTo(h+K,_+r),d.lineTo(h-ne,_+C),d.closePath();break;case"crossRot":be+=Lv;case"cross":K=Math.cos(be)*(v?v/2:xe),C=Math.cos(be)*xe,r=Math.sin(be)*xe,ne=Math.sin(be)*(v?v/2:xe),d.moveTo(h-K,_-r),d.lineTo(h+K,_+r),d.moveTo(h+ne,_-C),d.lineTo(h-ne,_+C);break;case"star":K=Math.cos(be)*(v?v/2:xe),C=Math.cos(be)*xe,r=Math.sin(be)*xe,ne=Math.sin(be)*(v?v/2:xe),d.moveTo(h-K,_-r),d.lineTo(h+K,_+r),d.moveTo(h+ne,_-C),d.lineTo(h-ne,_+C),be+=Lv,K=Math.cos(be)*(v?v/2:xe),C=Math.cos(be)*xe,r=Math.sin(be)*xe,ne=Math.sin(be)*(v?v/2:xe),d.moveTo(h-K,_-r),d.lineTo(h+K,_+r),d.moveTo(h+ne,_-C),d.lineTo(h-ne,_+C);break;case"line":C=v?v/2:Math.cos(be)*xe,r=Math.sin(be)*xe,d.moveTo(h-C,_-r),d.lineTo(h+C,_+r);break;case"dash":d.moveTo(h,_),d.lineTo(h+Math.cos(be)*(v?v/2:xe),_+Math.sin(be)*xe);break;case!1:d.closePath();break}d.fill(),s.borderWidth>0&&d.stroke()}}function TT(d,s,h){return h=h||.5,!s||d&&d.x>s.left-h&&d.x<s.right+h&&d.y>s.top-h&&d.y<s.bottom+h}function iD(d,s){d.save(),d.beginPath(),d.rect(s.left,s.top,s.right-s.left,s.bottom-s.top),d.clip()}function nD(d){d.restore()}function q3(d,s,h,_,v){if(!s)return d.lineTo(h.x,h.y);if(v==="middle"){const E=(s.x+h.x)/2;d.lineTo(E,s.y),d.lineTo(E,h.y)}else v==="after"!=!!_?d.lineTo(s.x,h.y):d.lineTo(h.x,s.y);d.lineTo(h.x,h.y)}function Z3(d,s,h,_){if(!s)return d.lineTo(h.x,h.y);d.bezierCurveTo(_?s.cp1x:s.cp2x,_?s.cp1y:s.cp2y,_?h.cp2x:h.cp1x,_?h.cp2y:h.cp1y,h.x,h.y)}function X3(d,s){s.translation&&d.translate(s.translation[0],s.translation[1]),ga(s.rotation)||d.rotate(s.rotation),s.color&&(d.fillStyle=s.color),s.textAlign&&(d.textAlign=s.textAlign),s.textBaseline&&(d.textBaseline=s.textBaseline)}function Y3(d,s,h,_,v){if(v.strikethrough||v.underline){const E=d.measureText(_),C=s-E.actualBoundingBoxLeft,r=s+E.actualBoundingBoxRight,z=h-E.actualBoundingBoxAscent,N=h+E.actualBoundingBoxDescent,H=v.strikethrough?(z+N)/2:N;d.strokeStyle=d.fillStyle,d.beginPath(),d.lineWidth=v.decorationWidth||2,d.moveTo(C,H),d.lineTo(r,H),d.stroke()}}function K3(d,s){const h=d.fillStyle;d.fillStyle=s.color,d.fillRect(s.left,s.top,s.width,s.height),d.fillStyle=h}function DC(d,s,h,_,v,E={}){const C=Ys(s)?s:[s],r=E.strokeWidth>0&&E.strokeColor!=="";let z,N;for(d.save(),d.font=v.string,X3(d,E),z=0;z<C.length;++z)N=C[z],E.backdrop&&K3(d,E.backdrop),r&&(E.strokeColor&&(d.strokeStyle=E.strokeColor),ga(E.strokeWidth)||(d.lineWidth=E.strokeWidth),d.strokeText(N,h,_,E.maxWidth)),d.fillText(N,h,_,E.maxWidth),Y3(d,h,_,N,E),_+=Number(v.lineHeight);d.restore()}function MC(d,s){const{x:h,y:_,w:v,h:E,radius:C}=s;d.arc(h+C.topLeft,_+C.topLeft,C.topLeft,1.5*Io,Io,!0),d.lineTo(h,_+E-C.bottomLeft),d.arc(h+C.bottomLeft,_+E-C.bottomLeft,C.bottomLeft,Io,Ol,!0),d.lineTo(h+v-C.bottomRight,_+E),d.arc(h+v-C.bottomRight,_+E-C.bottomRight,C.bottomRight,Ol,0,!0),d.lineTo(h+v,_+C.topRight),d.arc(h+v-C.topRight,_+C.topRight,C.topRight,0,-Ol,!0),d.lineTo(h+C.topLeft,_)}const J3=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Q3=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function eU(d,s){const h=(""+d).match(J3);if(!h||h[1]==="normal")return s*1.2;switch(d=+h[2],h[3]){case"px":return d;case"%":d/=100;break}return s*d}const tU=d=>+d||0;function rD(d,s){const h={},_=Ca(s),v=_?Object.keys(s):s,E=Ca(d)?_?C=>qr(d[C],d[s[C]]):C=>d[C]:()=>d;for(const C of v)h[C]=tU(E(C));return h}function Nk(d){return rD(d,{top:"y",right:"x",bottom:"y",left:"x"})}function xb(d){return rD(d,["topLeft","topRight","bottomLeft","bottomRight"])}function od(d){const s=Nk(d);return s.width=s.left+s.right,s.height=s.top+s.bottom,s}function Ac(d,s){d=d||{},s=s||rs.font;let h=qr(d.size,s.size);typeof h=="string"&&(h=parseInt(h,10));let _=qr(d.style,s.style);_&&!(""+_).match(Q3)&&(console.warn('Invalid font style specified: "'+_+'"'),_=void 0);const v={family:qr(d.family,s.family),lineHeight:eU(qr(d.lineHeight,s.lineHeight),h),size:h,style:_,weight:qr(d.weight,s.weight),string:""};return v.string=W3(v),v}function Vo(d,s,h,_){let v,E,C;for(v=0,E=d.length;v<E;++v)if(C=d[v],C!==void 0&&(s!==void 0&&typeof C=="function"&&(C=C(s)),h!==void 0&&Ys(C)&&(C=C[h%C.length]),C!==void 0))return C}function iU(d,s,h){const{min:_,max:v}=d,E=m3(s,(v-_)/2),C=(r,z)=>h&&r===0?0:r+z;return{min:C(_,-Math.abs(E)),max:C(v,E)}}function Jv(d,s){return Object.assign(Object.create(d),s)}function aD(d,s=[""],h,_,v=()=>d[0]){const E=h||d;typeof _>"u"&&(_=jk("_fallback",d));const C={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:d,_rootScopes:E,_fallback:_,_getTarget:v,override:r=>aD([r,...d],s,E,_)};return new Proxy(C,{deleteProperty(r,z){return delete r[z],delete r._keys,delete d[0][z],!0},get(r,z){return Uk(r,z,()=>uU(z,s,d,r))},getOwnPropertyDescriptor(r,z){return Reflect.getOwnPropertyDescriptor(r._scopes[0],z)},getPrototypeOf(){return Reflect.getPrototypeOf(d[0])},has(r,z){return _P(r).includes(z)},ownKeys(r){return _P(r)},set(r,z,N){const H=r._storage||(r._storage=v());return r[z]=H[z]=N,delete r._keys,!0}})}function Cb(d,s,h,_){const v={_cacheable:!1,_proxy:d,_context:s,_subProxy:h,_stack:new Set,_descriptors:Bk(d,_),setContext:E=>Cb(d,E,h,_),override:E=>Cb(d.override(E),s,h,_)};return new Proxy(v,{deleteProperty(E,C){return delete E[C],delete d[C],!0},get(E,C,r){return Uk(E,C,()=>rU(E,C,r))},getOwnPropertyDescriptor(E,C){return E._descriptors.allKeys?Reflect.has(d,C)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(d,C)},getPrototypeOf(){return Reflect.getPrototypeOf(d)},has(E,C){return Reflect.has(d,C)},ownKeys(){return Reflect.ownKeys(d)},set(E,C,r){return d[C]=r,delete E[C],!0}})}function Bk(d,s={scriptable:!0,indexable:!0}){const{_scriptable:h=s.scriptable,_indexable:_=s.indexable,_allKeys:v=s.allKeys}=d;return{allKeys:v,scriptable:h,indexable:_,isScriptable:F_(h)?h:()=>h,isIndexable:F_(_)?_:()=>_}}const nU=(d,s)=>d?d+JI(s):s,oD=(d,s)=>Ca(s)&&d!=="adapters"&&(Object.getPrototypeOf(s)===null||s.constructor===Object);function Uk(d,s,h){if(Object.prototype.hasOwnProperty.call(d,s)||s==="constructor")return d[s];const _=h();return d[s]=_,_}function rU(d,s,h){const{_proxy:_,_context:v,_subProxy:E,_descriptors:C}=d;let r=_[s];return F_(r)&&C.isScriptable(s)&&(r=aU(s,r,d,h)),Ys(r)&&r.length&&(r=oU(s,r,d,C.isIndexable)),oD(s,r)&&(r=Cb(r,v,E&&E[s],C)),r}function aU(d,s,h,_){const{_proxy:v,_context:E,_subProxy:C,_stack:r}=h;if(r.has(d))throw new Error("Recursion detected: "+Array.from(r).join("->")+"->"+d);r.add(d);let z=s(E,C||_);return r.delete(d),oD(d,z)&&(z=sD(v._scopes,v,d,z)),z}function oU(d,s,h,_){const{_proxy:v,_context:E,_subProxy:C,_descriptors:r}=h;if(typeof E.index<"u"&&_(d))return s[E.index%s.length];if(Ca(s[0])){const z=s,N=v._scopes.filter(H=>H!==z);s=[];for(const H of z){const K=sD(N,v,d,H);s.push(Cb(K,E,C&&C[d],r))}}return s}function Vk(d,s,h){return F_(d)?d(s,h):d}const sU=(d,s)=>d===!0?s:typeof d=="string"?Eb(s,d):void 0;function lU(d,s,h,_,v){for(const E of s){const C=sU(h,E);if(C){d.add(C);const r=Vk(C._fallback,h,v);if(typeof r<"u"&&r!==h&&r!==_)return r}else if(C===!1&&typeof _<"u"&&h!==_)return null}return!1}function sD(d,s,h,_){const v=s._rootScopes,E=Vk(s._fallback,h,_),C=[...d,...v],r=new Set;r.add(_);let z=gP(r,C,h,E||h,_);return z===null||typeof E<"u"&&E!==h&&(z=gP(r,C,E,z,_),z===null)?!1:aD(Array.from(r),[""],v,E,()=>cU(s,h,_))}function gP(d,s,h,_,v){for(;h;)h=lU(d,s,h,_,v);return h}function cU(d,s,h){const _=d._getTarget();s in _||(_[s]={});const v=_[s];return Ys(v)&&Ca(h)?h:v||{}}function uU(d,s,h,_){let v;for(const E of s)if(v=jk(nU(E,d),h),typeof v<"u")return oD(d,v)?sD(h,_,d,v):v}function jk(d,s){for(const h of s){if(!h)continue;const _=h[d];if(typeof _<"u")return _}}function _P(d){let s=d._keys;return s||(s=d._keys=hU(d._scopes)),s}function hU(d){const s=new Set;for(const h of d)for(const _ of Object.keys(h).filter(v=>!v.startsWith("_")))s.add(_);return Array.from(s)}const dU=Number.EPSILON||1e-14,Ab=(d,s)=>s<d.length&&!d[s].skip&&d[s],Gk=d=>d==="x"?"y":"x";function fU(d,s,h,_){const v=d.skip?s:d,E=s,C=h.skip?s:h,r=vI(E,v),z=vI(C,E);let N=r/(r+z),H=z/(r+z);N=isNaN(N)?0:N,H=isNaN(H)?0:H;const K=_*N,ne=_*H;return{previous:{x:E.x-K*(C.x-v.x),y:E.y-K*(C.y-v.y)},next:{x:E.x+ne*(C.x-v.x),y:E.y+ne*(C.y-v.y)}}}function pU(d,s,h){const _=d.length;let v,E,C,r,z,N=Ab(d,0);for(let H=0;H<_-1;++H)if(z=N,N=Ab(d,H+1),!(!z||!N)){if(lT(s[H],0,dU)){h[H]=h[H+1]=0;continue}v=h[H]/s[H],E=h[H+1]/s[H],r=Math.pow(v,2)+Math.pow(E,2),!(r<=9)&&(C=3/Math.sqrt(r),h[H]=v*C*s[H],h[H+1]=E*C*s[H])}}function mU(d,s,h="x"){const _=Gk(h),v=d.length;let E,C,r,z=Ab(d,0);for(let N=0;N<v;++N){if(C=r,r=z,z=Ab(d,N+1),!r)continue;const H=r[h],K=r[_];C&&(E=(H-C[h])/3,r[`cp1${h}`]=H-E,r[`cp1${_}`]=K-E*s[N]),z&&(E=(z[h]-H)/3,r[`cp2${h}`]=H+E,r[`cp2${_}`]=K+E*s[N])}}function gU(d,s="x"){const h=Gk(s),_=d.length,v=Array(_).fill(0),E=Array(_);let C,r,z,N=Ab(d,0);for(C=0;C<_;++C)if(r=z,z=N,N=Ab(d,C+1),!!z){if(N){const H=N[s]-z[s];v[C]=H!==0?(N[h]-z[h])/H:0}E[C]=r?N?lp(v[C-1])!==lp(v[C])?0:(v[C-1]+v[C])/2:v[C-1]:v[C]}pU(d,v,E),mU(d,E,s)}function JE(d,s,h){return Math.max(Math.min(d,h),s)}function _U(d,s){let h,_,v,E,C,r=TT(d[0],s);for(h=0,_=d.length;h<_;++h)C=E,E=r,r=h<_-1&&TT(d[h+1],s),E&&(v=d[h],C&&(v.cp1x=JE(v.cp1x,s.left,s.right),v.cp1y=JE(v.cp1y,s.top,s.bottom)),r&&(v.cp2x=JE(v.cp2x,s.left,s.right),v.cp2y=JE(v.cp2y,s.top,s.bottom)))}function yU(d,s,h,_,v){let E,C,r,z;if(s.spanGaps&&(d=d.filter(N=>!N.skip)),s.cubicInterpolationMode==="monotone")gU(d,v);else{let N=_?d[d.length-1]:d[0];for(E=0,C=d.length;E<C;++E)r=d[E],z=fU(N,r,d[Math.min(E+1,C-(_?0:1))%C],s.tension),r.cp1x=z.previous.x,r.cp1y=z.previous.y,r.cp2x=z.next.x,r.cp2y=z.next.y,N=r}s.capBezierPoints&&_U(d,h)}function lD(){return typeof window<"u"&&typeof document<"u"}function cD(d){let s=d.parentNode;return s&&s.toString()==="[object ShadowRoot]"&&(s=s.host),s}function PC(d,s,h){let _;return typeof d=="string"?(_=parseInt(d,10),d.indexOf("%")!==-1&&(_=_/100*s.parentNode[h])):_=d,_}const $C=d=>d.ownerDocument.defaultView.getComputedStyle(d,null);function vU(d,s){return $C(d).getPropertyValue(s)}const xU=["top","right","bottom","left"];function Zv(d,s,h){const _={};h=h?"-"+h:"";for(let v=0;v<4;v++){const E=xU[v];_[E]=parseFloat(d[s+"-"+E+h])||0}return _.width=_.left+_.right,_.height=_.top+_.bottom,_}const bU=(d,s,h)=>(d>0||s>0)&&(!h||!h.shadowRoot);function wU(d,s){const h=d.touches,_=h&&h.length?h[0]:d,{offsetX:v,offsetY:E}=_;let C=!1,r,z;if(bU(v,E,d.target))r=v,z=E;else{const N=s.getBoundingClientRect();r=_.clientX-N.left,z=_.clientY-N.top,C=!0}return{x:r,y:z,box:C}}function Bv(d,s){if("native"in d)return d;const{canvas:h,currentDevicePixelRatio:_}=s,v=$C(h),E=v.boxSizing==="border-box",C=Zv(v,"padding"),r=Zv(v,"border","width"),{x:z,y:N,box:H}=wU(d,h),K=C.left+(H&&r.left),ne=C.top+(H&&r.top);let{width:ue,height:pe}=s;return E&&(ue-=C.width+r.width,pe-=C.height+r.height),{x:Math.round((z-K)/ue*h.width/_),y:Math.round((N-ne)/pe*h.height/_)}}function TU(d,s,h){let _,v;if(s===void 0||h===void 0){const E=d&&cD(d);if(!E)s=d.clientWidth,h=d.clientHeight;else{const C=E.getBoundingClientRect(),r=$C(E),z=Zv(r,"border","width"),N=Zv(r,"padding");s=C.width-N.width-z.width,h=C.height-N.height-z.height,_=PC(r.maxWidth,E,"clientWidth"),v=PC(r.maxHeight,E,"clientHeight")}}return{width:s,height:h,maxWidth:_||IC,maxHeight:v||IC}}const P_=d=>Math.round(d*10)/10;function SU(d,s,h,_){const v=$C(d),E=Zv(v,"margin"),C=PC(v.maxWidth,d,"clientWidth")||IC,r=PC(v.maxHeight,d,"clientHeight")||IC,z=TU(d,s,h);let{width:N,height:H}=z;if(v.boxSizing==="content-box"){const ne=Zv(v,"border","width"),ue=Zv(v,"padding");N-=ue.width+ne.width,H-=ue.height+ne.height}return N=Math.max(0,N-E.width),H=Math.max(0,_?N/_:H-E.height),N=P_(Math.min(N,C,z.maxWidth)),H=P_(Math.min(H,r,z.maxHeight)),N&&!H&&(H=P_(N/2)),(s!==void 0||h!==void 0)&&_&&z.height&&H>z.height&&(H=z.height,N=P_(Math.floor(H*_))),{width:N,height:H}}function yP(d,s,h){const _=s||1,v=P_(d.height*_),E=P_(d.width*_);d.height=P_(d.height),d.width=P_(d.width);const C=d.canvas;return C.style&&(h||!C.style.height&&!C.style.width)&&(C.style.height=`${d.height}px`,C.style.width=`${d.width}px`),d.currentDevicePixelRatio!==_||C.height!==v||C.width!==E?(d.currentDevicePixelRatio=_,C.height=v,C.width=E,d.ctx.setTransform(_,0,0,_,0,0),!0):!1}const EU=function(){let d=!1;try{const s={get passive(){return d=!0,!1}};lD()&&(window.addEventListener("test",null,s),window.removeEventListener("test",null,s))}catch{}return d}();function vP(d,s){const h=vU(d,s),_=h&&h.match(/^(\d+)(\.\d+)?px$/);return _?+_[1]:void 0}function Uv(d,s,h,_){return{x:d.x+h*(s.x-d.x),y:d.y+h*(s.y-d.y)}}function CU(d,s,h,_){return{x:d.x+h*(s.x-d.x),y:_==="middle"?h<.5?d.y:s.y:_==="after"?h<1?d.y:s.y:h>0?s.y:d.y}}function AU(d,s,h,_){const v={x:d.cp2x,y:d.cp2y},E={x:s.cp1x,y:s.cp1y},C=Uv(d,v,h),r=Uv(v,E,h),z=Uv(E,s,h),N=Uv(C,r,h),H=Uv(r,z,h);return Uv(N,H,h)}const RU=function(d,s){return{x(h){return d+d+s-h},setWidth(h){s=h},textAlign(h){return h==="center"?h:h==="right"?"left":"right"},xPlus(h,_){return h-_},leftForLtr(h,_){return h-_}}},IU=function(){return{x(d){return d},setWidth(d){},textAlign(d){return d},xPlus(d,s){return d+s},leftForLtr(d,s){return d}}};function bb(d,s,h){return d?RU(s,h):IU()}function Hk(d,s){let h,_;(s==="ltr"||s==="rtl")&&(h=d.canvas.style,_=[h.getPropertyValue("direction"),h.getPropertyPriority("direction")],h.setProperty("direction",s,"important"),d.prevTextDirection=_)}function $k(d,s){s!==void 0&&(delete d.prevTextDirection,d.canvas.style.setProperty("direction",s[0],s[1]))}function Wk(d){return d==="angle"?{between:QI,compare:R3,normalize:Vd}:{between:M_,compare:(s,h)=>s-h,normalize:s=>s}}function xP({start:d,end:s,count:h,loop:_,style:v}){return{start:d%h,end:s%h,loop:_&&(s-d+1)%h===0,style:v}}function DU(d,s,h){const{property:_,start:v,end:E}=h,{between:C,normalize:r}=Wk(_),z=s.length;let{start:N,end:H,loop:K}=d,ne,ue;if(K){for(N+=z,H+=z,ne=0,ue=z;ne<ue&&C(r(s[N%z][_]),v,E);++ne)N--,H--;N%=z,H%=z}return H<N&&(H+=z),{start:N,end:H,loop:K,style:d.style}}function MU(d,s,h){if(!h)return[d];const{property:_,start:v,end:E}=h,C=s.length,{compare:r,between:z,normalize:N}=Wk(_),{start:H,end:K,loop:ne,style:ue}=DU(d,s,h),pe=[];let xe=!1,be=null,je,Be,He;const Xe=()=>z(v,He,je)&&r(v,He)!==0,it=()=>r(E,je)===0||z(E,He,je),kt=()=>xe||Xe(),Nt=()=>!xe||it();for(let oi=H,yi=H;oi<=K;++oi)Be=s[oi%C],!Be.skip&&(je=N(Be[_]),je!==He&&(xe=z(je,v,E),be===null&&kt()&&(be=r(je,v)===0?oi:yi),be!==null&&Nt()&&(pe.push(xP({start:be,end:oi,loop:ne,count:C,style:ue})),be=null),yi=oi,He=je));return be!==null&&pe.push(xP({start:be,end:K,loop:ne,count:C,style:ue})),pe}function PU(d,s){const h=[],_=d.segments;for(let v=0;v<_.length;v++){const E=MU(_[v],d.points,s);E.length&&h.push(...E)}return h}function OU(d,s,h,_){let v=0,E=s-1;if(h&&!_)for(;v<s&&!d[v].skip;)v++;for(;v<s&&d[v].skip;)v++;for(v%=s,h&&(E+=v);E>v&&d[E%s].skip;)E--;return E%=s,{start:v,end:E}}function kU(d,s,h,_){const v=d.length,E=[];let C=s,r=d[s],z;for(z=s+1;z<=h;++z){const N=d[z%v];N.skip||N.stop?r.skip||(_=!1,E.push({start:s%v,end:(z-1)%v,loop:_}),s=C=N.stop?z:null):(C=z,r.skip&&(s=z)),r=N}return C!==null&&E.push({start:s%v,end:C%v,loop:_}),E}function LU(d,s){const h=d.points,_=d.options.spanGaps,v=h.length;if(!v)return[];const E=!!d._loop,{start:C,end:r}=OU(h,v,E,_);if(_===!0)return bP(d,[{start:C,end:r,loop:E}],h,s);const z=r<C?r+v:r,N=!!d._fullLoop&&C===0&&r===v-1;return bP(d,kU(h,C,z,N),h,s)}function bP(d,s,h,_){return!_||!_.setContext||!h?s:zU(d,s,h,_)}function zU(d,s,h,_){const v=d._chart.getContext(),E=wP(d.options),{_datasetIndex:C,options:{spanGaps:r}}=d,z=h.length,N=[];let H=E,K=s[0].start,ne=K;function ue(pe,xe,be,je){const Be=r?-1:1;if(pe!==xe){for(pe+=z;h[pe%z].skip;)pe-=Be;for(;h[xe%z].skip;)xe+=Be;pe%z!==xe%z&&(N.push({start:pe%z,end:xe%z,loop:be,style:je}),H=je,K=xe%z)}}for(const pe of s){K=r?K:pe.start;let xe=h[K%z],be;for(ne=K+1;ne<=pe.end;ne++){const je=h[ne%z];be=wP(_.setContext(Jv(v,{type:"segment",p0:xe,p1:je,p0DataIndex:(ne-1)%z,p1DataIndex:ne%z,datasetIndex:C}))),FU(be,H)&&ue(K,ne-1,pe.loop,H),xe=je,H=be}K<ne-1&&ue(K,ne-1,pe.loop,H)}return N}function wP(d){return{backgroundColor:d.backgroundColor,borderCapStyle:d.borderCapStyle,borderDash:d.borderDash,borderDashOffset:d.borderDashOffset,borderJoinStyle:d.borderJoinStyle,borderWidth:d.borderWidth,borderColor:d.borderColor}}function FU(d,s){if(!s)return!1;const h=[],_=function(v,E){return tD(E)?(h.includes(E)||h.push(E),h.indexOf(E)):E};return JSON.stringify(d,_)!==JSON.stringify(s,_)}function QE(d,s,h){return d.options.clip?d[h]:s[h]}function NU(d,s){const{xScale:h,yScale:_}=d;return h&&_?{left:QE(h,s,"left"),right:QE(h,s,"right"),top:QE(_,s,"top"),bottom:QE(_,s,"bottom")}:s}function BU(d,s){const h=s._clip;if(h.disabled)return!1;const _=NU(s,d.chartArea);return{left:h.left===!1?0:_.left-(h.left===!0?0:h.left),right:h.right===!1?d.width:_.right+(h.right===!0?0:h.right),top:h.top===!1?0:_.top-(h.top===!0?0:h.top),bottom:h.bottom===!1?d.height:_.bottom+(h.bottom===!0?0:h.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class UU{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(s,h,_,v){const E=h.listeners[v],C=h.duration;E.forEach(r=>r({chart:s,initial:h.initial,numSteps:C,currentStep:Math.min(_-h.start,C)}))}_refresh(){this._request||(this._running=!0,this._request=Pk.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(s=Date.now()){let h=0;this._charts.forEach((_,v)=>{if(!_.running||!_.items.length)return;const E=_.items;let C=E.length-1,r=!1,z;for(;C>=0;--C)z=E[C],z._active?(z._total>_.duration&&(_.duration=z._total),z.tick(s),r=!0):(E[C]=E[E.length-1],E.pop());r&&(v.draw(),this._notify(v,_,s,"progress")),E.length||(_.running=!1,this._notify(v,_,s,"complete"),_.initial=!1),h+=E.length}),this._lastDate=s,h===0&&(this._running=!1)}_getAnims(s){const h=this._charts;let _=h.get(s);return _||(_={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},h.set(s,_)),_}listen(s,h,_){this._getAnims(s).listeners[h].push(_)}add(s,h){!h||!h.length||this._getAnims(s).items.push(...h)}has(s){return this._getAnims(s).items.length>0}start(s){const h=this._charts.get(s);h&&(h.running=!0,h.start=Date.now(),h.duration=h.items.reduce((_,v)=>Math.max(_,v._duration),0),this._refresh())}running(s){if(!this._running)return!1;const h=this._charts.get(s);return!(!h||!h.running||!h.items.length)}stop(s){const h=this._charts.get(s);if(!h||!h.items.length)return;const _=h.items;let v=_.length-1;for(;v>=0;--v)_[v].cancel();h.items=[],this._notify(s,h,Date.now(),"complete")}remove(s){return this._charts.delete(s)}}var Mm=new UU;const TP="transparent",VU={boolean(d,s,h){return h>.5?s:d},color(d,s,h){const _=dP(d||TP),v=_.valid&&dP(s||TP);return v&&v.valid?v.mix(_,h).hexString():s},number(d,s,h){return d+(s-d)*h}};class jU{constructor(s,h,_,v){const E=h[_];v=Vo([s.to,v,E,s.from]);const C=Vo([s.from,E,v]);this._active=!0,this._fn=s.fn||VU[s.type||typeof C],this._easing=cT[s.easing]||cT.linear,this._start=Math.floor(Date.now()+(s.delay||0)),this._duration=this._total=Math.floor(s.duration),this._loop=!!s.loop,this._target=h,this._prop=_,this._from=C,this._to=v,this._promises=void 0}active(){return this._active}update(s,h,_){if(this._active){this._notify(!1);const v=this._target[this._prop],E=_-this._start,C=this._duration-E;this._start=_,this._duration=Math.floor(Math.max(C,s.duration)),this._total+=E,this._loop=!!s.loop,this._to=Vo([s.to,h,v,s.from]),this._from=Vo([s.from,v,h])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(s){const h=s-this._start,_=this._duration,v=this._prop,E=this._from,C=this._loop,r=this._to;let z;if(this._active=E!==r&&(C||h<_),!this._active){this._target[v]=r,this._notify(!0);return}if(h<0){this._target[v]=E;return}z=h/_%2,z=C&&z>1?2-z:z,z=this._easing(Math.min(1,Math.max(0,z))),this._target[v]=this._fn(E,r,z)}wait(){const s=this._promises||(this._promises=[]);return new Promise((h,_)=>{s.push({res:h,rej:_})})}_notify(s){const h=s?"res":"rej",_=this._promises||[];for(let v=0;v<_.length;v++)_[v][h]()}}class qk{constructor(s,h){this._chart=s,this._properties=new Map,this.configure(h)}configure(s){if(!Ca(s))return;const h=Object.keys(rs.animation),_=this._properties;Object.getOwnPropertyNames(s).forEach(v=>{const E=s[v];if(!Ca(E))return;const C={};for(const r of h)C[r]=E[r];(Ys(E.properties)&&E.properties||[v]).forEach(r=>{(r===v||!_.has(r))&&_.set(r,C)})})}_animateOptions(s,h){const _=h.options,v=HU(s,_);if(!v)return[];const E=this._createAnimations(v,_);return _.$shared&&GU(s.options.$animations,_).then(()=>{s.options=_},()=>{}),E}_createAnimations(s,h){const _=this._properties,v=[],E=s.$animations||(s.$animations={}),C=Object.keys(h),r=Date.now();let z;for(z=C.length-1;z>=0;--z){const N=C[z];if(N.charAt(0)==="$")continue;if(N==="options"){v.push(...this._animateOptions(s,h));continue}const H=h[N];let K=E[N];const ne=_.get(N);if(K)if(ne&&K.active()){K.update(ne,H,r);continue}else K.cancel();if(!ne||!ne.duration){s[N]=H;continue}E[N]=K=new jU(ne,s,N,H),v.push(K)}return v}update(s,h){if(this._properties.size===0){Object.assign(s,h);return}const _=this._createAnimations(s,h);if(_.length)return Mm.add(this._chart,_),!0}}function GU(d,s){const h=[],_=Object.keys(s);for(let v=0;v<_.length;v++){const E=d[_[v]];E&&E.active()&&h.push(E.wait())}return Promise.all(h)}function HU(d,s){if(!s)return;let h=d.options;if(!h){d.options=s;return}return h.$shared&&(d.options=h=Object.assign({},h,{$shared:!1,$animations:{}})),h}function SP(d,s){const h=d&&d.options||{},_=h.reverse,v=h.min===void 0?s:0,E=h.max===void 0?s:0;return{start:_?E:v,end:_?v:E}}function $U(d,s,h){if(h===!1)return!1;const _=SP(d,h),v=SP(s,h);return{top:v.end,right:_.end,bottom:v.start,left:_.start}}function WU(d){let s,h,_,v;return Ca(d)?(s=d.top,h=d.right,_=d.bottom,v=d.left):s=h=_=v=d,{top:s,right:h,bottom:_,left:v,disabled:d===!1}}function Zk(d,s){const h=[],_=d._getSortedDatasetMetas(s);let v,E;for(v=0,E=_.length;v<E;++v)h.push(_[v].index);return h}function EP(d,s,h,_={}){const v=d.keys,E=_.mode==="single";let C,r,z,N;if(s===null)return;let H=!1;for(C=0,r=v.length;C<r;++C){if(z=+v[C],z===h){if(H=!0,_.all)continue;break}N=d.values[z],ad(N)&&(E||s===0||lp(s)===lp(N))&&(s+=N)}return!H&&!_.all?0:s}function qU(d,s){const{iScale:h,vScale:_}=s,v=h.axis==="x"?"x":"y",E=_.axis==="x"?"x":"y",C=Object.keys(d),r=new Array(C.length);let z,N,H;for(z=0,N=C.length;z<N;++z)H=C[z],r[z]={[v]:H,[E]:d[H]};return r}function YR(d,s){const h=d&&d.options.stacked;return h||h===void 0&&s.stack!==void 0}function ZU(d,s,h){return`${d.id}.${s.id}.${h.stack||h.type}`}function XU(d){const{min:s,max:h,minDefined:_,maxDefined:v}=d.getUserBounds();return{min:_?s:Number.NEGATIVE_INFINITY,max:v?h:Number.POSITIVE_INFINITY}}function YU(d,s,h){const _=d[s]||(d[s]={});return _[h]||(_[h]={})}function CP(d,s,h,_){for(const v of s.getMatchingVisibleMetas(_).reverse()){const E=d[v.index];if(h&&E>0||!h&&E<0)return v.index}return null}function AP(d,s){const{chart:h,_cachedMeta:_}=d,v=h._stacks||(h._stacks={}),{iScale:E,vScale:C,index:r}=_,z=E.axis,N=C.axis,H=ZU(E,C,_),K=s.length;let ne;for(let ue=0;ue<K;++ue){const pe=s[ue],{[z]:xe,[N]:be}=pe,je=pe._stacks||(pe._stacks={});ne=je[N]=YU(v,H,xe),ne[r]=be,ne._top=CP(ne,C,!0,_.type),ne._bottom=CP(ne,C,!1,_.type);const Be=ne._visualValues||(ne._visualValues={});Be[r]=be}}function KR(d,s){const h=d.scales;return Object.keys(h).filter(_=>h[_].axis===s).shift()}function KU(d,s){return Jv(d,{active:!1,dataset:void 0,datasetIndex:s,index:s,mode:"default",type:"dataset"})}function JU(d,s,h){return Jv(d,{active:!1,dataIndex:s,parsed:void 0,raw:void 0,element:h,index:s,mode:"default",type:"data"})}function q1(d,s){const h=d.controller.index,_=d.vScale&&d.vScale.axis;if(_){s=s||d._parsed;for(const v of s){const E=v._stacks;if(!E||E[_]===void 0||E[_][h]===void 0)return;delete E[_][h],E[_]._visualValues!==void 0&&E[_]._visualValues[h]!==void 0&&delete E[_]._visualValues[h]}}}const JR=d=>d==="reset"||d==="none",RP=(d,s)=>s?d:Object.assign({},d),QU=(d,s,h)=>d&&!s.hidden&&s._stacked&&{keys:Zk(h,!0),values:null};class wb{constructor(s,h){this.chart=s,this._ctx=s.ctx,this.index=h,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const s=this._cachedMeta;this.configure(),this.linkScales(),s._stacked=YR(s.vScale,s),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(s){this.index!==s&&q1(this._cachedMeta),this.index=s}linkScales(){const s=this.chart,h=this._cachedMeta,_=this.getDataset(),v=(K,ne,ue,pe)=>K==="x"?ne:K==="r"?pe:ue,E=h.xAxisID=qr(_.xAxisID,KR(s,"x")),C=h.yAxisID=qr(_.yAxisID,KR(s,"y")),r=h.rAxisID=qr(_.rAxisID,KR(s,"r")),z=h.indexAxis,N=h.iAxisID=v(z,E,C,r),H=h.vAxisID=v(z,C,E,r);h.xScale=this.getScaleForId(E),h.yScale=this.getScaleForId(C),h.rScale=this.getScaleForId(r),h.iScale=this.getScaleForId(N),h.vScale=this.getScaleForId(H)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(s){return this.chart.scales[s]}_getOtherScale(s){const h=this._cachedMeta;return s===h.iScale?h.vScale:h.iScale}reset(){this._update("reset")}_destroy(){const s=this._cachedMeta;this._data&&cP(this._data,this),s._stacked&&q1(s)}_dataCheck(){const s=this.getDataset(),h=s.data||(s.data=[]),_=this._data;if(Ca(h)){const v=this._cachedMeta;this._data=qU(h,v)}else if(_!==h){if(_){cP(_,this);const v=this._cachedMeta;q1(v),v._parsed=[]}h&&Object.isExtensible(h)&&P3(h,this),this._syncList=[],this._data=h}}addElements(){const s=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(s.dataset=new this.datasetElementType)}buildOrUpdateElements(s){const h=this._cachedMeta,_=this.getDataset();let v=!1;this._dataCheck();const E=h._stacked;h._stacked=YR(h.vScale,h),h.stack!==_.stack&&(v=!0,q1(h),h.stack=_.stack),this._resyncElements(s),(v||E!==h._stacked)&&(AP(this,h._parsed),h._stacked=YR(h.vScale,h))}configure(){const s=this.chart.config,h=s.datasetScopeKeys(this._type),_=s.getOptionScopes(this.getDataset(),h,!0);this.options=s.createResolver(_,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(s,h){const{_cachedMeta:_,_data:v}=this,{iScale:E,_stacked:C}=_,r=E.axis;let z=s===0&&h===v.length?!0:_._sorted,N=s>0&&_._parsed[s-1],H,K,ne;if(this._parsing===!1)_._parsed=v,_._sorted=!0,ne=v;else{Ys(v[s])?ne=this.parseArrayData(_,v,s,h):Ca(v[s])?ne=this.parseObjectData(_,v,s,h):ne=this.parsePrimitiveData(_,v,s,h);const ue=()=>K[r]===null||N&&K[r]<N[r];for(H=0;H<h;++H)_._parsed[H+s]=K=ne[H],z&&(ue()&&(z=!1),N=K);_._sorted=z}C&&AP(this,ne)}parsePrimitiveData(s,h,_,v){const{iScale:E,vScale:C}=s,r=E.axis,z=C.axis,N=E.getLabels(),H=E===C,K=new Array(v);let ne,ue,pe;for(ne=0,ue=v;ne<ue;++ne)pe=ne+_,K[ne]={[r]:H||E.parse(N[pe],pe),[z]:C.parse(h[pe],pe)};return K}parseArrayData(s,h,_,v){const{xScale:E,yScale:C}=s,r=new Array(v);let z,N,H,K;for(z=0,N=v;z<N;++z)H=z+_,K=h[H],r[z]={x:E.parse(K[0],H),y:C.parse(K[1],H)};return r}parseObjectData(s,h,_,v){const{xScale:E,yScale:C}=s,{xAxisKey:r="x",yAxisKey:z="y"}=this._parsing,N=new Array(v);let H,K,ne,ue;for(H=0,K=v;H<K;++H)ne=H+_,ue=h[ne],N[H]={x:E.parse(Eb(ue,r),ne),y:C.parse(Eb(ue,z),ne)};return N}getParsed(s){return this._cachedMeta._parsed[s]}getDataElement(s){return this._cachedMeta.data[s]}applyStack(s,h,_){const v=this.chart,E=this._cachedMeta,C=h[s.axis],r={keys:Zk(v,!0),values:h._stacks[s.axis]._visualValues};return EP(r,C,E.index,{mode:_})}updateRangeFromParsed(s,h,_,v){const E=_[h.axis];let C=E===null?NaN:E;const r=v&&_._stacks[h.axis];v&&r&&(v.values=r,C=EP(v,E,this._cachedMeta.index)),s.min=Math.min(s.min,C),s.max=Math.max(s.max,C)}getMinMax(s,h){const _=this._cachedMeta,v=_._parsed,E=_._sorted&&s===_.iScale,C=v.length,r=this._getOtherScale(s),z=QU(h,_,this.chart),N={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:H,max:K}=XU(r);let ne,ue;function pe(){ue=v[ne];const xe=ue[r.axis];return!ad(ue[s.axis])||H>xe||K<xe}for(ne=0;ne<C&&!(!pe()&&(this.updateRangeFromParsed(N,s,ue,z),E));++ne);if(E){for(ne=C-1;ne>=0;--ne)if(!pe()){this.updateRangeFromParsed(N,s,ue,z);break}}return N}getAllParsedValues(s){const h=this._cachedMeta._parsed,_=[];let v,E,C;for(v=0,E=h.length;v<E;++v)C=h[v][s.axis],ad(C)&&_.push(C);return _}getMaxOverflow(){return!1}getLabelAndValue(s){const h=this._cachedMeta,_=h.iScale,v=h.vScale,E=this.getParsed(s);return{label:_?""+_.getLabelForValue(E[_.axis]):"",value:v?""+v.getLabelForValue(E[v.axis]):""}}_update(s){const h=this._cachedMeta;this.update(s||"default"),h._clip=WU(qr(this.options.clip,$U(h.xScale,h.yScale,this.getMaxOverflow())))}update(s){}draw(){const s=this._ctx,h=this.chart,_=this._cachedMeta,v=_.data||[],E=h.chartArea,C=[],r=this._drawStart||0,z=this._drawCount||v.length-r,N=this.options.drawActiveElementsOnTop;let H;for(_.dataset&&_.dataset.draw(s,E,r,z),H=r;H<r+z;++H){const K=v[H];K.hidden||(K.active&&N?C.push(K):K.draw(s,E))}for(H=0;H<C.length;++H)C[H].draw(s,E)}getStyle(s,h){const _=h?"active":"default";return s===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(_):this.resolveDataElementOptions(s||0,_)}getContext(s,h,_){const v=this.getDataset();let E;if(s>=0&&s<this._cachedMeta.data.length){const C=this._cachedMeta.data[s];E=C.$context||(C.$context=JU(this.getContext(),s,C)),E.parsed=this.getParsed(s),E.raw=v.data[s],E.index=E.dataIndex=s}else E=this.$context||(this.$context=KU(this.chart.getContext(),this.index)),E.dataset=v,E.index=E.datasetIndex=this.index;return E.active=!!h,E.mode=_,E}resolveDatasetElementOptions(s){return this._resolveElementOptions(this.datasetElementType.id,s)}resolveDataElementOptions(s,h){return this._resolveElementOptions(this.dataElementType.id,h,s)}_resolveElementOptions(s,h="default",_){const v=h==="active",E=this._cachedDataOpts,C=s+"-"+h,r=E[C],z=this.enableOptionSharing&&bT(_);if(r)return RP(r,z);const N=this.chart.config,H=N.datasetElementScopeKeys(this._type,s),K=v?[`${s}Hover`,"hover",s,""]:[s,""],ne=N.getOptionScopes(this.getDataset(),H),ue=Object.keys(rs.elements[s]),pe=()=>this.getContext(_,v,h),xe=N.resolveNamedOptions(ne,ue,pe,K);return xe.$shared&&(xe.$shared=z,E[C]=Object.freeze(RP(xe,z))),xe}_resolveAnimations(s,h,_){const v=this.chart,E=this._cachedDataOpts,C=`animation-${h}`,r=E[C];if(r)return r;let z;if(v.options.animation!==!1){const H=this.chart.config,K=H.datasetAnimationScopeKeys(this._type,h),ne=H.getOptionScopes(this.getDataset(),K);z=H.createResolver(ne,this.getContext(s,_,h))}const N=new qk(v,z&&z.animations);return z&&z._cacheable&&(E[C]=Object.freeze(N)),N}getSharedOptions(s){if(s.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},s))}includeOptions(s,h){return!h||JR(s)||this.chart._animationsDisabled}_getSharedOptions(s,h){const _=this.resolveDataElementOptions(s,h),v=this._sharedOptions,E=this.getSharedOptions(_),C=this.includeOptions(h,E)||E!==v;return this.updateSharedOptions(E,h,_),{sharedOptions:E,includeOptions:C}}updateElement(s,h,_,v){JR(v)?Object.assign(s,_):this._resolveAnimations(h,v).update(s,_)}updateSharedOptions(s,h,_){s&&!JR(h)&&this._resolveAnimations(void 0,h).update(s,_)}_setStyle(s,h,_,v){s.active=v;const E=this.getStyle(h,v);this._resolveAnimations(h,_,v).update(s,{options:!v&&this.getSharedOptions(E)||E})}removeHoverStyle(s,h,_){this._setStyle(s,_,"active",!1)}setHoverStyle(s,h,_){this._setStyle(s,_,"active",!0)}_removeDatasetHoverStyle(){const s=this._cachedMeta.dataset;s&&this._setStyle(s,void 0,"active",!1)}_setDatasetHoverStyle(){const s=this._cachedMeta.dataset;s&&this._setStyle(s,void 0,"active",!0)}_resyncElements(s){const h=this._data,_=this._cachedMeta.data;for(const[r,z,N]of this._syncList)this[r](z,N);this._syncList=[];const v=_.length,E=h.length,C=Math.min(E,v);C&&this.parse(0,C),E>v?this._insertElements(v,E-v,s):E<v&&this._removeElements(E,v-E)}_insertElements(s,h,_=!0){const v=this._cachedMeta,E=v.data,C=s+h;let r;const z=N=>{for(N.length+=h,r=N.length-1;r>=C;r--)N[r]=N[r-h]};for(z(E),r=s;r<C;++r)E[r]=new this.dataElementType;this._parsing&&z(v._parsed),this.parse(s,h),_&&this.updateElements(E,s,h,"reset")}updateElements(s,h,_,v){}_removeElements(s,h){const _=this._cachedMeta;if(this._parsing){const v=_._parsed.splice(s,h);_._stacked&&q1(_,v)}_.data.splice(s,h)}_sync(s){if(this._parsing)this._syncList.push(s);else{const[h,_,v]=s;this[h](_,v)}this.chart._dataChanges.push([this.index,...s])}_onDataPush(){const s=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-s,s])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(s,h){h&&this._sync(["_removeElements",s,h]);const _=arguments.length-2;_&&this._sync(["_insertElements",s,_])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}kn(wb,"defaults",{}),kn(wb,"datasetElementType",null),kn(wb,"dataElementType",null);function eV(d,s){if(!d._cache.$bar){const h=d.getMatchingVisibleMetas(s);let _=[];for(let v=0,E=h.length;v<E;v++)_=_.concat(h[v].controller.getAllParsedValues(d));d._cache.$bar=Mk(_.sort((v,E)=>v-E))}return d._cache.$bar}function tV(d){const s=d.iScale,h=eV(s,d.type);let _=s._length,v,E,C,r;const z=()=>{C===32767||C===-32768||(bT(r)&&(_=Math.min(_,Math.abs(C-r)||_)),r=C)};for(v=0,E=h.length;v<E;++v)C=s.getPixelForValue(h[v]),z();for(r=void 0,v=0,E=s.ticks.length;v<E;++v)C=s.getPixelForTick(v),z();return _}function iV(d,s,h,_){const v=h.barThickness;let E,C;return ga(v)?(E=s.min*h.categoryPercentage,C=h.barPercentage):(E=v*_,C=1),{chunk:E/_,ratio:C,start:s.pixels[d]-E/2}}function nV(d,s,h,_){const v=s.pixels,E=v[d];let C=d>0?v[d-1]:null,r=d<v.length-1?v[d+1]:null;const z=h.categoryPercentage;C===null&&(C=E-(r===null?s.end-s.start:r-E)),r===null&&(r=E+E-C);const N=E-(E-Math.min(C,r))/2*z;return{chunk:Math.abs(r-C)/2*z/_,ratio:h.barPercentage,start:N}}function rV(d,s,h,_){const v=h.parse(d[0],_),E=h.parse(d[1],_),C=Math.min(v,E),r=Math.max(v,E);let z=C,N=r;Math.abs(C)>Math.abs(r)&&(z=r,N=C),s[h.axis]=N,s._custom={barStart:z,barEnd:N,start:v,end:E,min:C,max:r}}function Xk(d,s,h,_){return Ys(d)?rV(d,s,h,_):s[h.axis]=h.parse(d,_),s}function IP(d,s,h,_){const v=d.iScale,E=d.vScale,C=v.getLabels(),r=v===E,z=[];let N,H,K,ne;for(N=h,H=h+_;N<H;++N)ne=s[N],K={},K[v.axis]=r||v.parse(C[N],N),z.push(Xk(ne,K,E,N));return z}function QR(d){return d&&d.barStart!==void 0&&d.barEnd!==void 0}function aV(d,s,h){return d!==0?lp(d):(s.isHorizontal()?1:-1)*(s.min>=h?1:-1)}function oV(d){let s,h,_,v,E;return d.horizontal?(s=d.base>d.x,h="left",_="right"):(s=d.base<d.y,h="bottom",_="top"),s?(v="end",E="start"):(v="start",E="end"),{start:h,end:_,reverse:s,top:v,bottom:E}}function sV(d,s,h,_){let v=s.borderSkipped;const E={};if(!v){d.borderSkipped=E;return}if(v===!0){d.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:C,end:r,reverse:z,top:N,bottom:H}=oV(d);v==="middle"&&h&&(d.enableBorderRadius=!0,(h._top||0)===_?v=N:(h._bottom||0)===_?v=H:(E[DP(H,C,r,z)]=!0,v=N)),E[DP(v,C,r,z)]=!0,d.borderSkipped=E}function DP(d,s,h,_){return _?(d=lV(d,s,h),d=MP(d,h,s)):d=MP(d,s,h),d}function lV(d,s,h){return d===s?h:d===h?s:d}function MP(d,s,h){return d==="start"?s:d==="end"?h:d}function cV(d,{inflateAmount:s},h){d.inflateAmount=s==="auto"?h===1?.33:0:s}class gC extends wb{parsePrimitiveData(s,h,_,v){return IP(s,h,_,v)}parseArrayData(s,h,_,v){return IP(s,h,_,v)}parseObjectData(s,h,_,v){const{iScale:E,vScale:C}=s,{xAxisKey:r="x",yAxisKey:z="y"}=this._parsing,N=E.axis==="x"?r:z,H=C.axis==="x"?r:z,K=[];let ne,ue,pe,xe;for(ne=_,ue=_+v;ne<ue;++ne)xe=h[ne],pe={},pe[E.axis]=E.parse(Eb(xe,N),ne),K.push(Xk(Eb(xe,H),pe,C,ne));return K}updateRangeFromParsed(s,h,_,v){super.updateRangeFromParsed(s,h,_,v);const E=_._custom;E&&h===this._cachedMeta.vScale&&(s.min=Math.min(s.min,E.min),s.max=Math.max(s.max,E.max))}getMaxOverflow(){return 0}getLabelAndValue(s){const h=this._cachedMeta,{iScale:_,vScale:v}=h,E=this.getParsed(s),C=E._custom,r=QR(C)?"["+C.start+", "+C.end+"]":""+v.getLabelForValue(E[v.axis]);return{label:""+_.getLabelForValue(E[_.axis]),value:r}}initialize(){this.enableOptionSharing=!0,super.initialize();const s=this._cachedMeta;s.stack=this.getDataset().stack}update(s){const h=this._cachedMeta;this.updateElements(h.data,0,h.data.length,s)}updateElements(s,h,_,v){const E=v==="reset",{index:C,_cachedMeta:{vScale:r}}=this,z=r.getBasePixel(),N=r.isHorizontal(),H=this._getRuler(),{sharedOptions:K,includeOptions:ne}=this._getSharedOptions(h,v);for(let ue=h;ue<h+_;ue++){const pe=this.getParsed(ue),xe=E||ga(pe[r.axis])?{base:z,head:z}:this._calculateBarValuePixels(ue),be=this._calculateBarIndexPixels(ue,H),je=(pe._stacks||{})[r.axis],Be={horizontal:N,base:xe.base,enableBorderRadius:!je||QR(pe._custom)||C===je._top||C===je._bottom,x:N?xe.head:be.center,y:N?be.center:xe.head,height:N?be.size:Math.abs(xe.size),width:N?Math.abs(xe.size):be.size};ne&&(Be.options=K||this.resolveDataElementOptions(ue,s[ue].active?"active":v));const He=Be.options||s[ue].options;sV(Be,He,je,C),cV(Be,He,H.ratio),this.updateElement(s[ue],ue,Be,v)}}_getStacks(s,h){const{iScale:_}=this._cachedMeta,v=_.getMatchingVisibleMetas(this._type).filter(H=>H.controller.options.grouped),E=_.options.stacked,C=[],r=this._cachedMeta.controller.getParsed(h),z=r&&r[_.axis],N=H=>{const K=H._parsed.find(ue=>ue[_.axis]===z),ne=K&&K[H.vScale.axis];if(ga(ne)||isNaN(ne))return!0};for(const H of v)if(!(h!==void 0&&N(H))&&((E===!1||C.indexOf(H.stack)===-1||E===void 0&&H.stack===void 0)&&C.push(H.stack),H.index===s))break;return C.length||C.push(void 0),C}_getStackCount(s){return this._getStacks(void 0,s).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const s=this.chart.scales,h=this.chart.options.indexAxis;return Object.keys(s).filter(_=>s[_].axis===h).shift()}_getAxis(){const s={},h=this.getFirstScaleIdForIndexAxis();for(const _ of this.chart.data.datasets)s[qr(this.chart.options.indexAxis==="x"?_.xAxisID:_.yAxisID,h)]=!0;return Object.keys(s)}_getStackIndex(s,h,_){const v=this._getStacks(s,_),E=h!==void 0?v.indexOf(h):-1;return E===-1?v.length-1:E}_getRuler(){const s=this.options,h=this._cachedMeta,_=h.iScale,v=[];let E,C;for(E=0,C=h.data.length;E<C;++E)v.push(_.getPixelForValue(this.getParsed(E)[_.axis],E));const r=s.barThickness;return{min:r||tV(h),pixels:v,start:_._startPixel,end:_._endPixel,stackCount:this._getStackCount(),scale:_,grouped:s.grouped,ratio:r?1:s.categoryPercentage*s.barPercentage}}_calculateBarValuePixels(s){const{_cachedMeta:{vScale:h,_stacked:_,index:v},options:{base:E,minBarLength:C}}=this,r=E||0,z=this.getParsed(s),N=z._custom,H=QR(N);let K=z[h.axis],ne=0,ue=_?this.applyStack(h,z,_):K,pe,xe;ue!==K&&(ne=ue-K,ue=K),H&&(K=N.barStart,ue=N.barEnd-N.barStart,K!==0&&lp(K)!==lp(N.barEnd)&&(ne=0),ne+=K);const be=!ga(E)&&!H?E:ne;let je=h.getPixelForValue(be);if(this.chart.getDataVisibility(s)?pe=h.getPixelForValue(ne+ue):pe=je,xe=pe-je,Math.abs(xe)<C){xe=aV(xe,h,r)*C,K===r&&(je-=xe/2);const Be=h.getPixelForDecimal(0),He=h.getPixelForDecimal(1),Xe=Math.min(Be,He),it=Math.max(Be,He);je=Math.max(Math.min(je,it),Xe),pe=je+xe,_&&!H&&(z._stacks[h.axis]._visualValues[v]=h.getValueForPixel(pe)-h.getValueForPixel(je))}if(je===h.getPixelForValue(r)){const Be=lp(xe)*h.getLineWidthForValue(r)/2;je+=Be,xe-=Be}return{size:xe,base:je,head:pe,center:pe+xe/2}}_calculateBarIndexPixels(s,h){const _=h.scale,v=this.options,E=v.skipNull,C=qr(v.maxBarThickness,1/0);let r,z;const N=this._getAxisCount();if(h.grouped){const H=E?this._getStackCount(s):h.stackCount,K=v.barThickness==="flex"?nV(s,h,v,H*N):iV(s,h,v,H*N),ne=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,ue=this._getAxis().indexOf(qr(ne,this.getFirstScaleIdForIndexAxis())),pe=this._getStackIndex(this.index,this._cachedMeta.stack,E?s:void 0)+ue;r=K.start+K.chunk*pe+K.chunk/2,z=Math.min(C,K.chunk*K.ratio)}else r=_.getPixelForValue(this.getParsed(s)[_.axis],s),z=Math.min(C,h.min*h.ratio);return{base:r-z/2,head:r+z/2,center:r,size:z}}draw(){const s=this._cachedMeta,h=s.vScale,_=s.data,v=_.length;let E=0;for(;E<v;++E)this.getParsed(E)[h.axis]!==null&&!_[E].hidden&&_[E].draw(this._ctx)}}kn(gC,"id","bar"),kn(gC,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),kn(gC,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class _C extends wb{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(s){const h=this._cachedMeta,{dataset:_,data:v=[],_dataset:E}=h,C=this.chart._animationsDisabled;let{start:r,count:z}=L3(h,v,C);this._drawStart=r,this._drawCount=z,z3(h)&&(r=0,z=v.length),_._chart=this.chart,_._datasetIndex=this.index,_._decimated=!!E._decimated,_.points=v;const N=this.resolveDatasetElementOptions(s);this.options.showLine||(N.borderWidth=0),N.segment=this.options.segment,this.updateElement(_,void 0,{animated:!C,options:N},s),this.updateElements(v,r,z,s)}updateElements(s,h,_,v){const E=v==="reset",{iScale:C,vScale:r,_stacked:z,_dataset:N}=this._cachedMeta,{sharedOptions:H,includeOptions:K}=this._getSharedOptions(h,v),ne=C.axis,ue=r.axis,{spanGaps:pe,segment:xe}=this.options,be=wT(pe)?pe:Number.POSITIVE_INFINITY,je=this.chart._animationsDisabled||E||v==="none",Be=h+_,He=s.length;let Xe=h>0&&this.getParsed(h-1);for(let it=0;it<He;++it){const kt=s[it],Nt=je?kt:{};if(it<h||it>=Be){Nt.skip=!0;continue}const oi=this.getParsed(it),yi=ga(oi[ue]),Ui=Nt[ne]=C.getPixelForValue(oi[ne],it),hi=Nt[ue]=E||yi?r.getBasePixel():r.getPixelForValue(z?this.applyStack(r,oi,z):oi[ue],it);Nt.skip=isNaN(Ui)||isNaN(hi)||yi,Nt.stop=it>0&&Math.abs(oi[ne]-Xe[ne])>be,xe&&(Nt.parsed=oi,Nt.raw=N.data[it]),K&&(Nt.options=H||this.resolveDataElementOptions(it,kt.active?"active":v)),je||this.updateElement(kt,it,Nt,v),Xe=oi}}getMaxOverflow(){const s=this._cachedMeta,h=s.dataset,_=h.options&&h.options.borderWidth||0,v=s.data||[];if(!v.length)return _;const E=v[0].size(this.resolveDataElementOptions(0)),C=v[v.length-1].size(this.resolveDataElementOptions(v.length-1));return Math.max(_,E,C)/2}draw(){const s=this._cachedMeta;s.dataset.updateControlPoints(this.chart.chartArea,s.iScale.axis),super.draw()}}kn(_C,"id","line"),kn(_C,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),kn(_C,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});function Fv(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class uD{constructor(s){kn(this,"options");this.options=s||{}}static override(s){Object.assign(uD.prototype,s)}init(){}formats(){return Fv()}parse(){return Fv()}format(){return Fv()}add(){return Fv()}diff(){return Fv()}startOf(){return Fv()}endOf(){return Fv()}}var uV={_date:uD};function hV(d,s,h,_){const{controller:v,data:E,_sorted:C}=d,r=v._cachedMeta.iScale,z=d.dataset&&d.dataset.options?d.dataset.options.spanGaps:null;if(r&&s===r.axis&&s!=="r"&&C&&E.length){const N=r._reversePixels?D3:Wv;if(_){if(v._sharedOptions){const H=E[0],K=typeof H.getRange=="function"&&H.getRange(s);if(K){const ne=N(E,s,h-K),ue=N(E,s,h+K);return{lo:ne.lo,hi:ue.hi}}}}else{const H=N(E,s,h);if(z){const{vScale:K}=v._cachedMeta,{_parsed:ne}=d,ue=ne.slice(0,H.lo+1).reverse().findIndex(xe=>!ga(xe[K.axis]));H.lo-=Math.max(0,ue);const pe=ne.slice(H.hi).findIndex(xe=>!ga(xe[K.axis]));H.hi+=Math.max(0,pe)}return H}}return{lo:0,hi:E.length-1}}function WC(d,s,h,_,v){const E=d.getSortedVisibleDatasetMetas(),C=h[s];for(let r=0,z=E.length;r<z;++r){const{index:N,data:H}=E[r],{lo:K,hi:ne}=hV(E[r],s,C,v);for(let ue=K;ue<=ne;++ue){const pe=H[ue];pe.skip||_(pe,N,ue)}}}function dV(d){const s=d.indexOf("x")!==-1,h=d.indexOf("y")!==-1;return function(_,v){const E=s?Math.abs(_.x-v.x):0,C=h?Math.abs(_.y-v.y):0;return Math.sqrt(Math.pow(E,2)+Math.pow(C,2))}}function eI(d,s,h,_,v){const E=[];return!v&&!d.isPointInArea(s)||WC(d,h,s,function(r,z,N){!v&&!TT(r,d.chartArea,0)||r.inRange(s.x,s.y,_)&&E.push({element:r,datasetIndex:z,index:N})},!0),E}function fV(d,s,h,_){let v=[];function E(C,r,z){const{startAngle:N,endAngle:H}=C.getProps(["startAngle","endAngle"],_),{angle:K}=Ik(C,{x:s.x,y:s.y});QI(K,N,H)&&v.push({element:C,datasetIndex:r,index:z})}return WC(d,h,s,E),v}function pV(d,s,h,_,v,E){let C=[];const r=dV(h);let z=Number.POSITIVE_INFINITY;function N(H,K,ne){const ue=H.inRange(s.x,s.y,v);if(_&&!ue)return;const pe=H.getCenterPoint(v);if(!(!!E||d.isPointInArea(pe))&&!ue)return;const be=r(s,pe);be<z?(C=[{element:H,datasetIndex:K,index:ne}],z=be):be===z&&C.push({element:H,datasetIndex:K,index:ne})}return WC(d,h,s,N),C}function tI(d,s,h,_,v,E){return!E&&!d.isPointInArea(s)?[]:h==="r"&&!_?fV(d,s,h,v):pV(d,s,h,_,v,E)}function PP(d,s,h,_,v){const E=[],C=h==="x"?"inXRange":"inYRange";let r=!1;return WC(d,h,s,(z,N,H)=>{z[C]&&z[C](s[h],v)&&(E.push({element:z,datasetIndex:N,index:H}),r=r||z.inRange(s.x,s.y,v))}),_&&!r?[]:E}var mV={modes:{index(d,s,h,_){const v=Bv(s,d),E=h.axis||"x",C=h.includeInvisible||!1,r=h.intersect?eI(d,v,E,_,C):tI(d,v,E,!1,_,C),z=[];return r.length?(d.getSortedVisibleDatasetMetas().forEach(N=>{const H=r[0].index,K=N.data[H];K&&!K.skip&&z.push({element:K,datasetIndex:N.index,index:H})}),z):[]},dataset(d,s,h,_){const v=Bv(s,d),E=h.axis||"xy",C=h.includeInvisible||!1;let r=h.intersect?eI(d,v,E,_,C):tI(d,v,E,!1,_,C);if(r.length>0){const z=r[0].datasetIndex,N=d.getDatasetMeta(z).data;r=[];for(let H=0;H<N.length;++H)r.push({element:N[H],datasetIndex:z,index:H})}return r},point(d,s,h,_){const v=Bv(s,d),E=h.axis||"xy",C=h.includeInvisible||!1;return eI(d,v,E,_,C)},nearest(d,s,h,_){const v=Bv(s,d),E=h.axis||"xy",C=h.includeInvisible||!1;return tI(d,v,E,h.intersect,_,C)},x(d,s,h,_){const v=Bv(s,d);return PP(d,v,"x",h.intersect,_)},y(d,s,h,_){const v=Bv(s,d);return PP(d,v,"y",h.intersect,_)}}};const Yk=["left","top","right","bottom"];function Z1(d,s){return d.filter(h=>h.pos===s)}function OP(d,s){return d.filter(h=>Yk.indexOf(h.pos)===-1&&h.box.axis===s)}function X1(d,s){return d.sort((h,_)=>{const v=s?_:h,E=s?h:_;return v.weight===E.weight?v.index-E.index:v.weight-E.weight})}function gV(d){const s=[];let h,_,v,E,C,r;for(h=0,_=(d||[]).length;h<_;++h)v=d[h],{position:E,options:{stack:C,stackWeight:r=1}}=v,s.push({index:h,box:v,pos:E,horizontal:v.isHorizontal(),weight:v.weight,stack:C&&E+C,stackWeight:r});return s}function _V(d){const s={};for(const h of d){const{stack:_,pos:v,stackWeight:E}=h;if(!_||!Yk.includes(v))continue;const C=s[_]||(s[_]={count:0,placed:0,weight:0,size:0});C.count++,C.weight+=E}return s}function yV(d,s){const h=_V(d),{vBoxMaxWidth:_,hBoxMaxHeight:v}=s;let E,C,r;for(E=0,C=d.length;E<C;++E){r=d[E];const{fullSize:z}=r.box,N=h[r.stack],H=N&&r.stackWeight/N.weight;r.horizontal?(r.width=H?H*_:z&&s.availableWidth,r.height=v):(r.width=_,r.height=H?H*v:z&&s.availableHeight)}return h}function vV(d){const s=gV(d),h=X1(s.filter(N=>N.box.fullSize),!0),_=X1(Z1(s,"left"),!0),v=X1(Z1(s,"right")),E=X1(Z1(s,"top"),!0),C=X1(Z1(s,"bottom")),r=OP(s,"x"),z=OP(s,"y");return{fullSize:h,leftAndTop:_.concat(E),rightAndBottom:v.concat(z).concat(C).concat(r),chartArea:Z1(s,"chartArea"),vertical:_.concat(v).concat(z),horizontal:E.concat(C).concat(r)}}function kP(d,s,h,_){return Math.max(d[h],s[h])+Math.max(d[_],s[_])}function Kk(d,s){d.top=Math.max(d.top,s.top),d.left=Math.max(d.left,s.left),d.bottom=Math.max(d.bottom,s.bottom),d.right=Math.max(d.right,s.right)}function xV(d,s,h,_){const{pos:v,box:E}=h,C=d.maxPadding;if(!Ca(v)){h.size&&(d[v]-=h.size);const K=_[h.stack]||{size:0,count:1};K.size=Math.max(K.size,h.horizontal?E.height:E.width),h.size=K.size/K.count,d[v]+=h.size}E.getPadding&&Kk(C,E.getPadding());const r=Math.max(0,s.outerWidth-kP(C,d,"left","right")),z=Math.max(0,s.outerHeight-kP(C,d,"top","bottom")),N=r!==d.w,H=z!==d.h;return d.w=r,d.h=z,h.horizontal?{same:N,other:H}:{same:H,other:N}}function bV(d){const s=d.maxPadding;function h(_){const v=Math.max(s[_]-d[_],0);return d[_]+=v,v}d.y+=h("top"),d.x+=h("left"),h("right"),h("bottom")}function wV(d,s){const h=s.maxPadding;function _(v){const E={left:0,top:0,right:0,bottom:0};return v.forEach(C=>{E[C]=Math.max(s[C],h[C])}),E}return _(d?["left","right"]:["top","bottom"])}function tT(d,s,h,_){const v=[];let E,C,r,z,N,H;for(E=0,C=d.length,N=0;E<C;++E){r=d[E],z=r.box,z.update(r.width||s.w,r.height||s.h,wV(r.horizontal,s));const{same:K,other:ne}=xV(s,h,r,_);N|=K&&v.length,H=H||ne,z.fullSize||v.push(r)}return N&&tT(v,s,h,_)||H}function eC(d,s,h,_,v){d.top=h,d.left=s,d.right=s+_,d.bottom=h+v,d.width=_,d.height=v}function LP(d,s,h,_){const v=h.padding;let{x:E,y:C}=s;for(const r of d){const z=r.box,N=_[r.stack]||{placed:0,weight:1},H=r.stackWeight/N.weight||1;if(r.horizontal){const K=s.w*H,ne=N.size||z.height;bT(N.start)&&(C=N.start),z.fullSize?eC(z,v.left,C,h.outerWidth-v.right-v.left,ne):eC(z,s.left+N.placed,C,K,ne),N.start=C,N.placed+=K,C=z.bottom}else{const K=s.h*H,ne=N.size||z.width;bT(N.start)&&(E=N.start),z.fullSize?eC(z,E,v.top,ne,h.outerHeight-v.bottom-v.top):eC(z,E,s.top+N.placed,ne,K),N.start=E,N.placed+=K,E=z.right}}s.x=E,s.y=C}var O_={addBox(d,s){d.boxes||(d.boxes=[]),s.fullSize=s.fullSize||!1,s.position=s.position||"top",s.weight=s.weight||0,s._layers=s._layers||function(){return[{z:0,draw(h){s.draw(h)}}]},d.boxes.push(s)},removeBox(d,s){const h=d.boxes?d.boxes.indexOf(s):-1;h!==-1&&d.boxes.splice(h,1)},configure(d,s,h){s.fullSize=h.fullSize,s.position=h.position,s.weight=h.weight},update(d,s,h,_){if(!d)return;const v=od(d.options.layout.padding),E=Math.max(s-v.width,0),C=Math.max(h-v.height,0),r=vV(d.boxes),z=r.vertical,N=r.horizontal;Wa(d.boxes,xe=>{typeof xe.beforeLayout=="function"&&xe.beforeLayout()});const H=z.reduce((xe,be)=>be.box.options&&be.box.options.display===!1?xe:xe+1,0)||1,K=Object.freeze({outerWidth:s,outerHeight:h,padding:v,availableWidth:E,availableHeight:C,vBoxMaxWidth:E/2/H,hBoxMaxHeight:C/2}),ne=Object.assign({},v);Kk(ne,od(_));const ue=Object.assign({maxPadding:ne,w:E,h:C,x:v.left,y:v.top},v),pe=yV(z.concat(N),K);tT(r.fullSize,ue,K,pe),tT(z,ue,K,pe),tT(N,ue,K,pe)&&tT(z,ue,K,pe),bV(ue),LP(r.leftAndTop,ue,K,pe),ue.x+=ue.w,ue.y+=ue.h,LP(r.rightAndBottom,ue,K,pe),d.chartArea={left:ue.left,top:ue.top,right:ue.left+ue.w,bottom:ue.top+ue.h,height:ue.h,width:ue.w},Wa(r.chartArea,xe=>{const be=xe.box;Object.assign(be,d.chartArea),be.update(ue.w,ue.h,{left:0,top:0,right:0,bottom:0})})}};class Jk{acquireContext(s,h){}releaseContext(s){return!1}addEventListener(s,h,_){}removeEventListener(s,h,_){}getDevicePixelRatio(){return 1}getMaximumSize(s,h,_,v){return h=Math.max(0,h||s.width),_=_||s.height,{width:h,height:Math.max(0,v?Math.floor(h/v):_)}}isAttached(s){return!0}updateConfig(s){}}class TV extends Jk{acquireContext(s){return s&&s.getContext&&s.getContext("2d")||null}updateConfig(s){s.options.animation=!1}}const yC="$chartjs",SV={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},zP=d=>d===null||d==="";function EV(d,s){const h=d.style,_=d.getAttribute("height"),v=d.getAttribute("width");if(d[yC]={initial:{height:_,width:v,style:{display:h.display,height:h.height,width:h.width}}},h.display=h.display||"block",h.boxSizing=h.boxSizing||"border-box",zP(v)){const E=vP(d,"width");E!==void 0&&(d.width=E)}if(zP(_))if(d.style.height==="")d.height=d.width/(s||2);else{const E=vP(d,"height");E!==void 0&&(d.height=E)}return d}const Qk=EU?{passive:!0}:!1;function CV(d,s,h){d&&d.addEventListener(s,h,Qk)}function AV(d,s,h){d&&d.canvas&&d.canvas.removeEventListener(s,h,Qk)}function RV(d,s){const h=SV[d.type]||d.type,{x:_,y:v}=Bv(d,s);return{type:h,chart:s,native:d,x:_!==void 0?_:null,y:v!==void 0?v:null}}function OC(d,s){for(const h of d)if(h===s||h.contains(s))return!0}function IV(d,s,h){const _=d.canvas,v=new MutationObserver(E=>{let C=!1;for(const r of E)C=C||OC(r.addedNodes,_),C=C&&!OC(r.removedNodes,_);C&&h()});return v.observe(document,{childList:!0,subtree:!0}),v}function DV(d,s,h){const _=d.canvas,v=new MutationObserver(E=>{let C=!1;for(const r of E)C=C||OC(r.removedNodes,_),C=C&&!OC(r.addedNodes,_);C&&h()});return v.observe(document,{childList:!0,subtree:!0}),v}const ST=new Map;let FP=0;function e2(){const d=window.devicePixelRatio;d!==FP&&(FP=d,ST.forEach((s,h)=>{h.currentDevicePixelRatio!==d&&s()}))}function MV(d,s){ST.size||window.addEventListener("resize",e2),ST.set(d,s)}function PV(d){ST.delete(d),ST.size||window.removeEventListener("resize",e2)}function OV(d,s,h){const _=d.canvas,v=_&&cD(_);if(!v)return;const E=Ok((r,z)=>{const N=v.clientWidth;h(r,z),N<v.clientWidth&&h()},window),C=new ResizeObserver(r=>{const z=r[0],N=z.contentRect.width,H=z.contentRect.height;N===0&&H===0||E(N,H)});return C.observe(v),MV(d,E),C}function iI(d,s,h){h&&h.disconnect(),s==="resize"&&PV(d)}function kV(d,s,h){const _=d.canvas,v=Ok(E=>{d.ctx!==null&&h(RV(E,d))},d);return CV(_,s,v),v}class LV extends Jk{acquireContext(s,h){const _=s&&s.getContext&&s.getContext("2d");return _&&_.canvas===s?(EV(s,h),_):null}releaseContext(s){const h=s.canvas;if(!h[yC])return!1;const _=h[yC].initial;["height","width"].forEach(E=>{const C=_[E];ga(C)?h.removeAttribute(E):h.setAttribute(E,C)});const v=_.style||{};return Object.keys(v).forEach(E=>{h.style[E]=v[E]}),h.width=h.width,delete h[yC],!0}addEventListener(s,h,_){this.removeEventListener(s,h);const v=s.$proxies||(s.$proxies={}),C={attach:IV,detach:DV,resize:OV}[h]||kV;v[h]=C(s,h,_)}removeEventListener(s,h){const _=s.$proxies||(s.$proxies={}),v=_[h];if(!v)return;({attach:iI,detach:iI,resize:iI}[h]||AV)(s,h,v),_[h]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(s,h,_,v){return SU(s,h,_,v)}isAttached(s){const h=s&&cD(s);return!!(h&&h.isConnected)}}function zV(d){return!lD()||typeof OffscreenCanvas<"u"&&d instanceof OffscreenCanvas?TV:LV}class up{constructor(){kn(this,"x");kn(this,"y");kn(this,"active",!1);kn(this,"options");kn(this,"$animations")}tooltipPosition(s){const{x:h,y:_}=this.getProps(["x","y"],s);return{x:h,y:_}}hasValue(){return wT(this.x)&&wT(this.y)}getProps(s,h){const _=this.$animations;if(!h||!_)return this;const v={};return s.forEach(E=>{v[E]=_[E]&&_[E].active()?_[E]._to:this[E]}),v}}kn(up,"defaults",{}),kn(up,"defaultRoutes");function FV(d,s){const h=d.options.ticks,_=NV(d),v=Math.min(h.maxTicksLimit||_,_),E=h.major.enabled?UV(s):[],C=E.length,r=E[0],z=E[C-1],N=[];if(C>v)return VV(s,N,E,C/v),N;const H=BV(E,s,v);if(C>0){let K,ne;const ue=C>1?Math.round((z-r)/(C-1)):null;for(tC(s,N,H,ga(ue)?0:r-ue,r),K=0,ne=C-1;K<ne;K++)tC(s,N,H,E[K],E[K+1]);return tC(s,N,H,z,ga(ue)?s.length:z+ue),N}return tC(s,N,H),N}function NV(d){const s=d.options.offset,h=d._tickSize(),_=d._length/h+(s?0:1),v=d._maxLength/h;return Math.floor(Math.min(_,v))}function BV(d,s,h){const _=jV(d),v=s.length/h;if(!_)return Math.max(v,1);const E=T3(_);for(let C=0,r=E.length-1;C<r;C++){const z=E[C];if(z>v)return z}return Math.max(v,1)}function UV(d){const s=[];let h,_;for(h=0,_=d.length;h<_;h++)d[h].major&&s.push(h);return s}function VV(d,s,h,_){let v=0,E=h[0],C;for(_=Math.ceil(_),C=0;C<d.length;C++)C===E&&(s.push(d[C]),v++,E=h[v*_])}function tC(d,s,h,_,v){const E=qr(_,0),C=Math.min(qr(v,d.length),d.length);let r=0,z,N,H;for(h=Math.ceil(h),v&&(z=v-_,h=z/Math.floor(z/h)),H=E;H<0;)r++,H=Math.round(E+r*h);for(N=Math.max(E,0);N<C;N++)N===H&&(s.push(d[N]),r++,H=Math.round(E+r*h))}function jV(d){const s=d.length;let h,_;if(s<2)return!1;for(_=d[0],h=1;h<s;++h)if(d[h]-d[h-1]!==_)return!1;return _}const GV=d=>d==="left"?"right":d==="right"?"left":d,NP=(d,s,h)=>s==="top"||s==="left"?d[s]+h:d[s]-h,BP=(d,s)=>Math.min(s||d,d);function UP(d,s){const h=[],_=d.length/s,v=d.length;let E=0;for(;E<v;E+=_)h.push(d[Math.floor(E)]);return h}function HV(d,s,h){const _=d.ticks.length,v=Math.min(s,_-1),E=d._startPixel,C=d._endPixel,r=1e-6;let z=d.getPixelForTick(v),N;if(!(h&&(_===1?N=Math.max(z-E,C-z):s===0?N=(d.getPixelForTick(1)-z)/2:N=(z-d.getPixelForTick(v-1))/2,z+=v<s?N:-N,z<E-r||z>C+r)))return z}function $V(d,s){Wa(d,h=>{const _=h.gc,v=_.length/2;let E;if(v>s){for(E=0;E<v;++E)delete h.data[_[E]];_.splice(0,v)}})}function Y1(d){return d.drawTicks?d.tickLength:0}function VP(d,s){if(!d.display)return 0;const h=Ac(d.font,s),_=od(d.padding);return(Ys(d.text)?d.text.length:1)*h.lineHeight+_.height}function WV(d,s){return Jv(d,{scale:s,type:"scale"})}function qV(d,s,h){return Jv(d,{tick:h,index:s,type:"tick"})}function ZV(d,s,h){let _=kk(d);return(h&&s!=="right"||!h&&s==="right")&&(_=GV(_)),_}function XV(d,s,h,_){const{top:v,left:E,bottom:C,right:r,chart:z}=d,{chartArea:N,scales:H}=z;let K=0,ne,ue,pe;const xe=C-v,be=r-E;if(d.isHorizontal()){if(ue=lh(_,E,r),Ca(h)){const je=Object.keys(h)[0],Be=h[je];pe=H[je].getPixelForValue(Be)+xe-s}else h==="center"?pe=(N.bottom+N.top)/2+xe-s:pe=NP(d,h,s);ne=r-E}else{if(Ca(h)){const je=Object.keys(h)[0],Be=h[je];ue=H[je].getPixelForValue(Be)-be+s}else h==="center"?ue=(N.left+N.right)/2-be+s:ue=NP(d,h,s);pe=lh(_,C,v),K=h==="left"?-Ol:Ol}return{titleX:ue,titleY:pe,maxWidth:ne,rotation:K}}class Pb extends up{constructor(s){super(),this.id=s.id,this.type=s.type,this.options=void 0,this.ctx=s.ctx,this.chart=s.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(s){this.options=s.setContext(this.getContext()),this.axis=s.axis,this._userMin=this.parse(s.min),this._userMax=this.parse(s.max),this._suggestedMin=this.parse(s.suggestedMin),this._suggestedMax=this.parse(s.suggestedMax)}parse(s,h){return s}getUserBounds(){let{_userMin:s,_userMax:h,_suggestedMin:_,_suggestedMax:v}=this;return s=np(s,Number.POSITIVE_INFINITY),h=np(h,Number.NEGATIVE_INFINITY),_=np(_,Number.POSITIVE_INFINITY),v=np(v,Number.NEGATIVE_INFINITY),{min:np(s,_),max:np(h,v),minDefined:ad(s),maxDefined:ad(h)}}getMinMax(s){let{min:h,max:_,minDefined:v,maxDefined:E}=this.getUserBounds(),C;if(v&&E)return{min:h,max:_};const r=this.getMatchingVisibleMetas();for(let z=0,N=r.length;z<N;++z)C=r[z].controller.getMinMax(this,s),v||(h=Math.min(h,C.min)),E||(_=Math.max(_,C.max));return h=E&&h>_?_:h,_=v&&h>_?h:_,{min:np(h,np(_,h)),max:np(_,np(h,_))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const s=this.chart.data;return this.options.labels||(this.isHorizontal()?s.xLabels:s.yLabels)||s.labels||[]}getLabelItems(s=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(s))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){po(this.options.beforeUpdate,[this])}update(s,h,_){const{beginAtZero:v,grace:E,ticks:C}=this.options,r=C.sampleSize;this.beforeUpdate(),this.maxWidth=s,this.maxHeight=h,this._margins=_=Object.assign({left:0,right:0,top:0,bottom:0},_),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+_.left+_.right:this.height+_.top+_.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=iU(this,E,v),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const z=r<this.ticks.length;this._convertTicksToLabels(z?UP(this.ticks,r):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),C.display&&(C.autoSkip||C.source==="auto")&&(this.ticks=FV(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),z&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let s=this.options.reverse,h,_;this.isHorizontal()?(h=this.left,_=this.right):(h=this.top,_=this.bottom,s=!s),this._startPixel=h,this._endPixel=_,this._reversePixels=s,this._length=_-h,this._alignToPixels=this.options.alignToPixels}afterUpdate(){po(this.options.afterUpdate,[this])}beforeSetDimensions(){po(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){po(this.options.afterSetDimensions,[this])}_callHooks(s){this.chart.notifyPlugins(s,this.getContext()),po(this.options[s],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){po(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(s){const h=this.options.ticks;let _,v,E;for(_=0,v=s.length;_<v;_++)E=s[_],E.label=po(h.callback,[E.value,_,s],this)}afterTickToLabelConversion(){po(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){po(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const s=this.options,h=s.ticks,_=BP(this.ticks.length,s.ticks.maxTicksLimit),v=h.minRotation||0,E=h.maxRotation;let C=v,r,z,N;if(!this._isVisible()||!h.display||v>=E||_<=1||!this.isHorizontal()){this.labelRotation=v;return}const H=this._getLabelSizes(),K=H.widest.width,ne=H.highest.height,ue=ec(this.chart.width-K,0,this.maxWidth);r=s.offset?this.maxWidth/_:ue/(_-1),K+6>r&&(r=ue/(_-(s.offset?.5:1)),z=this.maxHeight-Y1(s.grid)-h.padding-VP(s.title,this.chart.options.font),N=Math.sqrt(K*K+ne*ne),C=A3(Math.min(Math.asin(ec((H.highest.height+6)/r,-1,1)),Math.asin(ec(z/N,-1,1))-Math.asin(ec(ne/N,-1,1)))),C=Math.max(v,Math.min(E,C))),this.labelRotation=C}afterCalculateLabelRotation(){po(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){po(this.options.beforeFit,[this])}fit(){const s={width:0,height:0},{chart:h,options:{ticks:_,title:v,grid:E}}=this,C=this._isVisible(),r=this.isHorizontal();if(C){const z=VP(v,h.options.font);if(r?(s.width=this.maxWidth,s.height=Y1(E)+z):(s.height=this.maxHeight,s.width=Y1(E)+z),_.display&&this.ticks.length){const{first:N,last:H,widest:K,highest:ne}=this._getLabelSizes(),ue=_.padding*2,pe=$v(this.labelRotation),xe=Math.cos(pe),be=Math.sin(pe);if(r){const je=_.mirror?0:be*K.width+xe*ne.height;s.height=Math.min(this.maxHeight,s.height+je+ue)}else{const je=_.mirror?0:xe*K.width+be*ne.height;s.width=Math.min(this.maxWidth,s.width+je+ue)}this._calculatePadding(N,H,be,xe)}}this._handleMargins(),r?(this.width=this._length=h.width-this._margins.left-this._margins.right,this.height=s.height):(this.width=s.width,this.height=this._length=h.height-this._margins.top-this._margins.bottom)}_calculatePadding(s,h,_,v){const{ticks:{align:E,padding:C},position:r}=this.options,z=this.labelRotation!==0,N=r!=="top"&&this.axis==="x";if(this.isHorizontal()){const H=this.getPixelForTick(0)-this.left,K=this.right-this.getPixelForTick(this.ticks.length-1);let ne=0,ue=0;z?N?(ne=v*s.width,ue=_*h.height):(ne=_*s.height,ue=v*h.width):E==="start"?ue=h.width:E==="end"?ne=s.width:E!=="inner"&&(ne=s.width/2,ue=h.width/2),this.paddingLeft=Math.max((ne-H+C)*this.width/(this.width-H),0),this.paddingRight=Math.max((ue-K+C)*this.width/(this.width-K),0)}else{let H=h.height/2,K=s.height/2;E==="start"?(H=0,K=s.height):E==="end"&&(H=h.height,K=0),this.paddingTop=H+C,this.paddingBottom=K+C}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){po(this.options.afterFit,[this])}isHorizontal(){const{axis:s,position:h}=this.options;return h==="top"||h==="bottom"||s==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(s){this.beforeTickToLabelConversion(),this.generateTickLabels(s);let h,_;for(h=0,_=s.length;h<_;h++)ga(s[h].label)&&(s.splice(h,1),_--,h--);this.afterTickToLabelConversion()}_getLabelSizes(){let s=this._labelSizes;if(!s){const h=this.options.ticks.sampleSize;let _=this.ticks;h<_.length&&(_=UP(_,h)),this._labelSizes=s=this._computeLabelSizes(_,_.length,this.options.ticks.maxTicksLimit)}return s}_computeLabelSizes(s,h,_){const{ctx:v,_longestTextCache:E}=this,C=[],r=[],z=Math.floor(h/BP(h,_));let N=0,H=0,K,ne,ue,pe,xe,be,je,Be,He,Xe,it;for(K=0;K<h;K+=z){if(pe=s[K].label,xe=this._resolveTickFontOptions(K),v.font=be=xe.string,je=E[be]=E[be]||{data:{},gc:[]},Be=xe.lineHeight,He=Xe=0,!ga(pe)&&!Ys(pe))He=pP(v,je.data,je.gc,He,pe),Xe=Be;else if(Ys(pe))for(ne=0,ue=pe.length;ne<ue;++ne)it=pe[ne],!ga(it)&&!Ys(it)&&(He=pP(v,je.data,je.gc,He,it),Xe+=Be);C.push(He),r.push(Xe),N=Math.max(He,N),H=Math.max(Xe,H)}$V(E,h);const kt=C.indexOf(N),Nt=r.indexOf(H),oi=yi=>({width:C[yi]||0,height:r[yi]||0});return{first:oi(0),last:oi(h-1),widest:oi(kt),highest:oi(Nt),widths:C,heights:r}}getLabelForValue(s){return s}getPixelForValue(s,h){return NaN}getValueForPixel(s){}getPixelForTick(s){const h=this.ticks;return s<0||s>h.length-1?null:this.getPixelForValue(h[s].value)}getPixelForDecimal(s){this._reversePixels&&(s=1-s);const h=this._startPixel+s*this._length;return I3(this._alignToPixels?zv(this.chart,h,0):h)}getDecimalForPixel(s){const h=(s-this._startPixel)/this._length;return this._reversePixels?1-h:h}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:s,max:h}=this;return s<0&&h<0?h:s>0&&h>0?s:0}getContext(s){const h=this.ticks||[];if(s>=0&&s<h.length){const _=h[s];return _.$context||(_.$context=qV(this.getContext(),s,_))}return this.$context||(this.$context=WV(this.chart.getContext(),this))}_tickSize(){const s=this.options.ticks,h=$v(this.labelRotation),_=Math.abs(Math.cos(h)),v=Math.abs(Math.sin(h)),E=this._getLabelSizes(),C=s.autoSkipPadding||0,r=E?E.widest.width+C:0,z=E?E.highest.height+C:0;return this.isHorizontal()?z*_>r*v?r/_:z/v:z*v<r*_?z/_:r/v}_isVisible(){const s=this.options.display;return s!=="auto"?!!s:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(s){const h=this.axis,_=this.chart,v=this.options,{grid:E,position:C,border:r}=v,z=E.offset,N=this.isHorizontal(),K=this.ticks.length+(z?1:0),ne=Y1(E),ue=[],pe=r.setContext(this.getContext()),xe=pe.display?pe.width:0,be=xe/2,je=function(ui){return zv(_,ui,xe)};let Be,He,Xe,it,kt,Nt,oi,yi,Ui,hi,Ti,Dt;if(C==="top")Be=je(this.bottom),Nt=this.bottom-ne,yi=Be-be,hi=je(s.top)+be,Dt=s.bottom;else if(C==="bottom")Be=je(this.top),hi=s.top,Dt=je(s.bottom)-be,Nt=Be+be,yi=this.top+ne;else if(C==="left")Be=je(this.right),kt=this.right-ne,oi=Be-be,Ui=je(s.left)+be,Ti=s.right;else if(C==="right")Be=je(this.left),Ui=s.left,Ti=je(s.right)-be,kt=Be+be,oi=this.left+ne;else if(h==="x"){if(C==="center")Be=je((s.top+s.bottom)/2+.5);else if(Ca(C)){const ui=Object.keys(C)[0],ri=C[ui];Be=je(this.chart.scales[ui].getPixelForValue(ri))}hi=s.top,Dt=s.bottom,Nt=Be+be,yi=Nt+ne}else if(h==="y"){if(C==="center")Be=je((s.left+s.right)/2);else if(Ca(C)){const ui=Object.keys(C)[0],ri=C[ui];Be=je(this.chart.scales[ui].getPixelForValue(ri))}kt=Be-be,oi=kt-ne,Ui=s.left,Ti=s.right}const Di=qr(v.ticks.maxTicksLimit,K),Qt=Math.max(1,Math.ceil(K/Di));for(He=0;He<K;He+=Qt){const ui=this.getContext(He),ri=E.setContext(ui),zi=r.setContext(ui),En=ri.lineWidth,hr=ri.color,wr=zi.dash||[],Jn=zi.dashOffset,xn=ri.tickWidth,mr=ri.tickColor,Va=ri.tickBorderDash||[],Aa=ri.tickBorderDashOffset;Xe=HV(this,He,z),Xe!==void 0&&(it=zv(_,Xe,En),N?kt=oi=Ui=Ti=it:Nt=yi=hi=Dt=it,ue.push({tx1:kt,ty1:Nt,tx2:oi,ty2:yi,x1:Ui,y1:hi,x2:Ti,y2:Dt,width:En,color:hr,borderDash:wr,borderDashOffset:Jn,tickWidth:xn,tickColor:mr,tickBorderDash:Va,tickBorderDashOffset:Aa}))}return this._ticksLength=K,this._borderValue=Be,ue}_computeLabelItems(s){const h=this.axis,_=this.options,{position:v,ticks:E}=_,C=this.isHorizontal(),r=this.ticks,{align:z,crossAlign:N,padding:H,mirror:K}=E,ne=Y1(_.grid),ue=ne+H,pe=K?-H:ue,xe=-$v(this.labelRotation),be=[];let je,Be,He,Xe,it,kt,Nt,oi,yi,Ui,hi,Ti,Dt="middle";if(v==="top")kt=this.bottom-pe,Nt=this._getXAxisLabelAlignment();else if(v==="bottom")kt=this.top+pe,Nt=this._getXAxisLabelAlignment();else if(v==="left"){const Qt=this._getYAxisLabelAlignment(ne);Nt=Qt.textAlign,it=Qt.x}else if(v==="right"){const Qt=this._getYAxisLabelAlignment(ne);Nt=Qt.textAlign,it=Qt.x}else if(h==="x"){if(v==="center")kt=(s.top+s.bottom)/2+ue;else if(Ca(v)){const Qt=Object.keys(v)[0],ui=v[Qt];kt=this.chart.scales[Qt].getPixelForValue(ui)+ue}Nt=this._getXAxisLabelAlignment()}else if(h==="y"){if(v==="center")it=(s.left+s.right)/2-ue;else if(Ca(v)){const Qt=Object.keys(v)[0],ui=v[Qt];it=this.chart.scales[Qt].getPixelForValue(ui)}Nt=this._getYAxisLabelAlignment(ne).textAlign}h==="y"&&(z==="start"?Dt="top":z==="end"&&(Dt="bottom"));const Di=this._getLabelSizes();for(je=0,Be=r.length;je<Be;++je){He=r[je],Xe=He.label;const Qt=E.setContext(this.getContext(je));oi=this.getPixelForTick(je)+E.labelOffset,yi=this._resolveTickFontOptions(je),Ui=yi.lineHeight,hi=Ys(Xe)?Xe.length:1;const ui=hi/2,ri=Qt.color,zi=Qt.textStrokeColor,En=Qt.textStrokeWidth;let hr=Nt;C?(it=oi,Nt==="inner"&&(je===Be-1?hr=this.options.reverse?"left":"right":je===0?hr=this.options.reverse?"right":"left":hr="center"),v==="top"?N==="near"||xe!==0?Ti=-hi*Ui+Ui/2:N==="center"?Ti=-Di.highest.height/2-ui*Ui+Ui:Ti=-Di.highest.height+Ui/2:N==="near"||xe!==0?Ti=Ui/2:N==="center"?Ti=Di.highest.height/2-ui*Ui:Ti=Di.highest.height-hi*Ui,K&&(Ti*=-1),xe!==0&&!Qt.showLabelBackdrop&&(it+=Ui/2*Math.sin(xe))):(kt=oi,Ti=(1-hi)*Ui/2);let wr;if(Qt.showLabelBackdrop){const Jn=od(Qt.backdropPadding),xn=Di.heights[je],mr=Di.widths[je];let Va=Ti-Jn.top,Aa=0-Jn.left;switch(Dt){case"middle":Va-=xn/2;break;case"bottom":Va-=xn;break}switch(Nt){case"center":Aa-=mr/2;break;case"right":Aa-=mr;break;case"inner":je===Be-1?Aa-=mr:je>0&&(Aa-=mr/2);break}wr={left:Aa,top:Va,width:mr+Jn.width,height:xn+Jn.height,color:Qt.backdropColor}}be.push({label:Xe,font:yi,textOffset:Ti,options:{rotation:xe,color:ri,strokeColor:zi,strokeWidth:En,textAlign:hr,textBaseline:Dt,translation:[it,kt],backdrop:wr}})}return be}_getXAxisLabelAlignment(){const{position:s,ticks:h}=this.options;if(-$v(this.labelRotation))return s==="top"?"left":"right";let v="center";return h.align==="start"?v="left":h.align==="end"?v="right":h.align==="inner"&&(v="inner"),v}_getYAxisLabelAlignment(s){const{position:h,ticks:{crossAlign:_,mirror:v,padding:E}}=this.options,C=this._getLabelSizes(),r=s+E,z=C.widest.width;let N,H;return h==="left"?v?(H=this.right+E,_==="near"?N="left":_==="center"?(N="center",H+=z/2):(N="right",H+=z)):(H=this.right-r,_==="near"?N="right":_==="center"?(N="center",H-=z/2):(N="left",H=this.left)):h==="right"?v?(H=this.left+E,_==="near"?N="right":_==="center"?(N="center",H-=z/2):(N="left",H-=z)):(H=this.left+r,_==="near"?N="left":_==="center"?(N="center",H+=z/2):(N="right",H=this.right)):N="right",{textAlign:N,x:H}}_computeLabelArea(){if(this.options.ticks.mirror)return;const s=this.chart,h=this.options.position;if(h==="left"||h==="right")return{top:0,left:this.left,bottom:s.height,right:this.right};if(h==="top"||h==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:s.width}}drawBackground(){const{ctx:s,options:{backgroundColor:h},left:_,top:v,width:E,height:C}=this;h&&(s.save(),s.fillStyle=h,s.fillRect(_,v,E,C),s.restore())}getLineWidthForValue(s){const h=this.options.grid;if(!this._isVisible()||!h.display)return 0;const v=this.ticks.findIndex(E=>E.value===s);return v>=0?h.setContext(this.getContext(v)).lineWidth:0}drawGrid(s){const h=this.options.grid,_=this.ctx,v=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(s));let E,C;const r=(z,N,H)=>{!H.width||!H.color||(_.save(),_.lineWidth=H.width,_.strokeStyle=H.color,_.setLineDash(H.borderDash||[]),_.lineDashOffset=H.borderDashOffset,_.beginPath(),_.moveTo(z.x,z.y),_.lineTo(N.x,N.y),_.stroke(),_.restore())};if(h.display)for(E=0,C=v.length;E<C;++E){const z=v[E];h.drawOnChartArea&&r({x:z.x1,y:z.y1},{x:z.x2,y:z.y2},z),h.drawTicks&&r({x:z.tx1,y:z.ty1},{x:z.tx2,y:z.ty2},{color:z.tickColor,width:z.tickWidth,borderDash:z.tickBorderDash,borderDashOffset:z.tickBorderDashOffset})}}drawBorder(){const{chart:s,ctx:h,options:{border:_,grid:v}}=this,E=_.setContext(this.getContext()),C=_.display?E.width:0;if(!C)return;const r=v.setContext(this.getContext(0)).lineWidth,z=this._borderValue;let N,H,K,ne;this.isHorizontal()?(N=zv(s,this.left,C)-C/2,H=zv(s,this.right,r)+r/2,K=ne=z):(K=zv(s,this.top,C)-C/2,ne=zv(s,this.bottom,r)+r/2,N=H=z),h.save(),h.lineWidth=E.width,h.strokeStyle=E.color,h.beginPath(),h.moveTo(N,K),h.lineTo(H,ne),h.stroke(),h.restore()}drawLabels(s){if(!this.options.ticks.display)return;const _=this.ctx,v=this._computeLabelArea();v&&iD(_,v);const E=this.getLabelItems(s);for(const C of E){const r=C.options,z=C.font,N=C.label,H=C.textOffset;DC(_,N,0,H,z,r)}v&&nD(_)}drawTitle(){const{ctx:s,options:{position:h,title:_,reverse:v}}=this;if(!_.display)return;const E=Ac(_.font),C=od(_.padding),r=_.align;let z=E.lineHeight/2;h==="bottom"||h==="center"||Ca(h)?(z+=C.bottom,Ys(_.text)&&(z+=E.lineHeight*(_.text.length-1))):z+=C.top;const{titleX:N,titleY:H,maxWidth:K,rotation:ne}=XV(this,z,h,r);DC(s,_.text,0,0,E,{color:_.color,maxWidth:K,rotation:ne,textAlign:ZV(r,h,v),textBaseline:"middle",translation:[N,H]})}draw(s){this._isVisible()&&(this.drawBackground(),this.drawGrid(s),this.drawBorder(),this.drawTitle(),this.drawLabels(s))}_layers(){const s=this.options,h=s.ticks&&s.ticks.z||0,_=qr(s.grid&&s.grid.z,-1),v=qr(s.border&&s.border.z,0);return!this._isVisible()||this.draw!==Pb.prototype.draw?[{z:h,draw:E=>{this.draw(E)}}]:[{z:_,draw:E=>{this.drawBackground(),this.drawGrid(E),this.drawTitle()}},{z:v,draw:()=>{this.drawBorder()}},{z:h,draw:E=>{this.drawLabels(E)}}]}getMatchingVisibleMetas(s){const h=this.chart.getSortedVisibleDatasetMetas(),_=this.axis+"AxisID",v=[];let E,C;for(E=0,C=h.length;E<C;++E){const r=h[E];r[_]===this.id&&(!s||r.type===s)&&v.push(r)}return v}_resolveTickFontOptions(s){const h=this.options.ticks.setContext(this.getContext(s));return Ac(h.font)}_maxDigits(){const s=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/s}}class iC{constructor(s,h,_){this.type=s,this.scope=h,this.override=_,this.items=Object.create(null)}isForType(s){return Object.prototype.isPrototypeOf.call(this.type.prototype,s.prototype)}register(s){const h=Object.getPrototypeOf(s);let _;JV(h)&&(_=this.register(h));const v=this.items,E=s.id,C=this.scope+"."+E;if(!E)throw new Error("class does not have id: "+s);return E in v||(v[E]=s,YV(s,C,_),this.override&&rs.override(s.id,s.overrides)),C}get(s){return this.items[s]}unregister(s){const h=this.items,_=s.id,v=this.scope;_ in h&&delete h[_],v&&_ in rs[v]&&(delete rs[v][_],this.override&&delete Yv[_])}}function YV(d,s,h){const _=cp(Object.create(null),[h?rs.get(h):{},rs.get(s),d.defaults]);rs.set(s,_),d.defaultRoutes&&KV(s,d.defaultRoutes),d.descriptors&&rs.describe(s,d.descriptors)}function KV(d,s){Object.keys(s).forEach(h=>{const _=h.split("."),v=_.pop(),E=[d].concat(_).join("."),C=s[h].split("."),r=C.pop(),z=C.join(".");rs.route(E,v,z,r)})}function JV(d){return"id"in d&&"defaults"in d}class QV{constructor(){this.controllers=new iC(wb,"datasets",!0),this.elements=new iC(up,"elements"),this.plugins=new iC(Object,"plugins"),this.scales=new iC(Pb,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...s){this._each("register",s)}remove(...s){this._each("unregister",s)}addControllers(...s){this._each("register",s,this.controllers)}addElements(...s){this._each("register",s,this.elements)}addPlugins(...s){this._each("register",s,this.plugins)}addScales(...s){this._each("register",s,this.scales)}getController(s){return this._get(s,this.controllers,"controller")}getElement(s){return this._get(s,this.elements,"element")}getPlugin(s){return this._get(s,this.plugins,"plugin")}getScale(s){return this._get(s,this.scales,"scale")}removeControllers(...s){this._each("unregister",s,this.controllers)}removeElements(...s){this._each("unregister",s,this.elements)}removePlugins(...s){this._each("unregister",s,this.plugins)}removeScales(...s){this._each("unregister",s,this.scales)}_each(s,h,_){[...h].forEach(v=>{const E=_||this._getRegistryForType(v);_||E.isForType(v)||E===this.plugins&&v.id?this._exec(s,E,v):Wa(v,C=>{const r=_||this._getRegistryForType(C);this._exec(s,r,C)})})}_exec(s,h,_){const v=JI(s);po(_["before"+v],[],_),h[s](_),po(_["after"+v],[],_)}_getRegistryForType(s){for(let h=0;h<this._typedRegistries.length;h++){const _=this._typedRegistries[h];if(_.isForType(s))return _}return this.plugins}_get(s,h,_){const v=h.get(s);if(v===void 0)throw new Error('"'+s+'" is not a registered '+_+".");return v}}var ap=new QV;class e5{constructor(){this._init=void 0}notify(s,h,_,v){if(h==="beforeInit"&&(this._init=this._createDescriptors(s,!0),this._notify(this._init,s,"install")),this._init===void 0)return;const E=v?this._descriptors(s).filter(v):this._descriptors(s),C=this._notify(E,s,h,_);return h==="afterDestroy"&&(this._notify(E,s,"stop"),this._notify(this._init,s,"uninstall"),this._init=void 0),C}_notify(s,h,_,v){v=v||{};for(const E of s){const C=E.plugin,r=C[_],z=[h,v,E.options];if(po(r,z,C)===!1&&v.cancelable)return!1}return!0}invalidate(){ga(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(s){if(this._cache)return this._cache;const h=this._cache=this._createDescriptors(s);return this._notifyStateChanges(s),h}_createDescriptors(s,h){const _=s&&s.config,v=qr(_.options&&_.options.plugins,{}),E=t5(_);return v===!1&&!h?[]:n5(s,E,v,h)}_notifyStateChanges(s){const h=this._oldCache||[],_=this._cache,v=(E,C)=>E.filter(r=>!C.some(z=>r.plugin.id===z.plugin.id));this._notify(v(h,_),s,"stop"),this._notify(v(_,h),s,"start")}}function t5(d){const s={},h=[],_=Object.keys(ap.plugins.items);for(let E=0;E<_.length;E++)h.push(ap.getPlugin(_[E]));const v=d.plugins||[];for(let E=0;E<v.length;E++){const C=v[E];h.indexOf(C)===-1&&(h.push(C),s[C.id]=!0)}return{plugins:h,localIds:s}}function i5(d,s){return!s&&d===!1?null:d===!0?{}:d}function n5(d,{plugins:s,localIds:h},_,v){const E=[],C=d.getContext();for(const r of s){const z=r.id,N=i5(_[z],v);N!==null&&E.push({plugin:r,options:r5(d.config,{plugin:r,local:h[z]},N,C)})}return E}function r5(d,{plugin:s,local:h},_,v){const E=d.pluginScopeKeys(s),C=d.getOptionScopes(_,E);return h&&s.defaults&&C.push(s.defaults),d.createResolver(C,v,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function wI(d,s){const h=rs.datasets[d]||{};return((s.datasets||{})[d]||{}).indexAxis||s.indexAxis||h.indexAxis||"x"}function a5(d,s){let h=d;return d==="_index_"?h=s:d==="_value_"&&(h=s==="x"?"y":"x"),h}function o5(d,s){return d===s?"_index_":"_value_"}function jP(d){if(d==="x"||d==="y"||d==="r")return d}function s5(d){if(d==="top"||d==="bottom")return"x";if(d==="left"||d==="right")return"y"}function TI(d,...s){if(jP(d))return d;for(const h of s){const _=h.axis||s5(h.position)||d.length>1&&jP(d[0].toLowerCase());if(_)return _}throw new Error(`Cannot determine type of '${d}' axis. Please provide 'axis' or 'position' option.`)}function GP(d,s,h){if(h[s+"AxisID"]===d)return{axis:s}}function l5(d,s){if(s.data&&s.data.datasets){const h=s.data.datasets.filter(_=>_.xAxisID===d||_.yAxisID===d);if(h.length)return GP(d,"x",h[0])||GP(d,"y",h[0])}return{}}function c5(d,s){const h=Yv[d.type]||{scales:{}},_=s.scales||{},v=wI(d.type,s),E=Object.create(null);return Object.keys(_).forEach(C=>{const r=_[C];if(!Ca(r))return console.error(`Invalid scale configuration for scale: ${C}`);if(r._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${C}`);const z=TI(C,r,l5(C,d),rs.scales[r.type]),N=o5(z,v),H=h.scales||{};E[C]=sT(Object.create(null),[{axis:z},r,H[z],H[N]])}),d.data.datasets.forEach(C=>{const r=C.type||d.type,z=C.indexAxis||wI(r,s),H=(Yv[r]||{}).scales||{};Object.keys(H).forEach(K=>{const ne=a5(K,z),ue=C[ne+"AxisID"]||ne;E[ue]=E[ue]||Object.create(null),sT(E[ue],[{axis:ne},_[ue],H[K]])})}),Object.keys(E).forEach(C=>{const r=E[C];sT(r,[rs.scales[r.type],rs.scale])}),E}function t2(d){const s=d.options||(d.options={});s.plugins=qr(s.plugins,{}),s.scales=c5(d,s)}function i2(d){return d=d||{},d.datasets=d.datasets||[],d.labels=d.labels||[],d}function u5(d){return d=d||{},d.data=i2(d.data),t2(d),d}const HP=new Map,n2=new Set;function nC(d,s){let h=HP.get(d);return h||(h=s(),HP.set(d,h),n2.add(h)),h}const K1=(d,s,h)=>{const _=Eb(s,h);_!==void 0&&d.add(_)};class h5{constructor(s){this._config=u5(s),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(s){this._config.type=s}get data(){return this._config.data}set data(s){this._config.data=i2(s)}get options(){return this._config.options}set options(s){this._config.options=s}get plugins(){return this._config.plugins}update(){const s=this._config;this.clearCache(),t2(s)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(s){return nC(s,()=>[[`datasets.${s}`,""]])}datasetAnimationScopeKeys(s,h){return nC(`${s}.transition.${h}`,()=>[[`datasets.${s}.transitions.${h}`,`transitions.${h}`],[`datasets.${s}`,""]])}datasetElementScopeKeys(s,h){return nC(`${s}-${h}`,()=>[[`datasets.${s}.elements.${h}`,`datasets.${s}`,`elements.${h}`,""]])}pluginScopeKeys(s){const h=s.id,_=this.type;return nC(`${_}-plugin-${h}`,()=>[[`plugins.${h}`,...s.additionalOptionScopes||[]]])}_cachedScopes(s,h){const _=this._scopeCache;let v=_.get(s);return(!v||h)&&(v=new Map,_.set(s,v)),v}getOptionScopes(s,h,_){const{options:v,type:E}=this,C=this._cachedScopes(s,_),r=C.get(h);if(r)return r;const z=new Set;h.forEach(H=>{s&&(z.add(s),H.forEach(K=>K1(z,s,K))),H.forEach(K=>K1(z,v,K)),H.forEach(K=>K1(z,Yv[E]||{},K)),H.forEach(K=>K1(z,rs,K)),H.forEach(K=>K1(z,xI,K))});const N=Array.from(z);return N.length===0&&N.push(Object.create(null)),n2.has(h)&&C.set(h,N),N}chartOptionScopes(){const{options:s,type:h}=this;return[s,Yv[h]||{},rs.datasets[h]||{},{type:h},rs,xI]}resolveNamedOptions(s,h,_,v=[""]){const E={$shared:!0},{resolver:C,subPrefixes:r}=$P(this._resolverCache,s,v);let z=C;if(f5(C,h)){E.$shared=!1,_=F_(_)?_():_;const N=this.createResolver(s,_,r);z=Cb(C,_,N)}for(const N of h)E[N]=z[N];return E}createResolver(s,h,_=[""],v){const{resolver:E}=$P(this._resolverCache,s,_);return Ca(h)?Cb(E,h,void 0,v):E}}function $P(d,s,h){let _=d.get(s);_||(_=new Map,d.set(s,_));const v=h.join();let E=_.get(v);return E||(E={resolver:aD(s,h),subPrefixes:h.filter(r=>!r.toLowerCase().includes("hover"))},_.set(v,E)),E}const d5=d=>Ca(d)&&Object.getOwnPropertyNames(d).some(s=>F_(d[s]));function f5(d,s){const{isScriptable:h,isIndexable:_}=Bk(d);for(const v of s){const E=h(v),C=_(v),r=(C||E)&&d[v];if(E&&(F_(r)||d5(r))||C&&Ys(r))return!0}return!1}var p5="4.5.1";const m5=["top","bottom","left","right","chartArea"];function WP(d,s){return d==="top"||d==="bottom"||m5.indexOf(d)===-1&&s==="x"}function qP(d,s){return function(h,_){return h[d]===_[d]?h[s]-_[s]:h[d]-_[d]}}function ZP(d){const s=d.chart,h=s.options.animation;s.notifyPlugins("afterRender"),po(h&&h.onComplete,[d],s)}function g5(d){const s=d.chart,h=s.options.animation;po(h&&h.onProgress,[d],s)}function r2(d){return lD()&&typeof d=="string"?d=document.getElementById(d):d&&d.length&&(d=d[0]),d&&d.canvas&&(d=d.canvas),d}const vC={},XP=d=>{const s=r2(d);return Object.values(vC).filter(h=>h.canvas===s).pop()};function _5(d,s,h){const _=Object.keys(d);for(const v of _){const E=+v;if(E>=s){const C=d[v];delete d[v],(h>0||E>s)&&(d[E+h]=C)}}}function y5(d,s,h,_){return!h||d.type==="mouseout"?null:_?s:d}var A_;let hD=(A_=class{static register(...s){ap.add(...s),YP()}static unregister(...s){ap.remove(...s),YP()}constructor(s,h){const _=this.config=new h5(h),v=r2(s),E=XP(v);if(E)throw new Error("Canvas is already in use. Chart with ID '"+E.id+"' must be destroyed before the canvas with ID '"+E.canvas.id+"' can be reused.");const C=_.createResolver(_.chartOptionScopes(),this.getContext());this.platform=new(_.platform||zV(v)),this.platform.updateConfig(_);const r=this.platform.acquireContext(v,C.aspectRatio),z=r&&r.canvas,N=z&&z.height,H=z&&z.width;if(this.id=p3(),this.ctx=r,this.canvas=z,this.width=H,this.height=N,this._options=C,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new e5,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=O3(K=>this.update(K),C.resizeDelay||0),this._dataChanges=[],vC[this.id]=this,!r||!z){console.error("Failed to create chart: can't acquire context from the given item");return}Mm.listen(this,"complete",ZP),Mm.listen(this,"progress",g5),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:s,maintainAspectRatio:h},width:_,height:v,_aspectRatio:E}=this;return ga(s)?h&&E?E:v?_/v:null:s}get data(){return this.config.data}set data(s){this.config.data=s}get options(){return this._options}set options(s){this.config.options=s}get registry(){return ap}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():yP(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return mP(this.canvas,this.ctx),this}stop(){return Mm.stop(this),this}resize(s,h){Mm.running(this)?this._resizeBeforeDraw={width:s,height:h}:this._resize(s,h)}_resize(s,h){const _=this.options,v=this.canvas,E=_.maintainAspectRatio&&this.aspectRatio,C=this.platform.getMaximumSize(v,s,h,E),r=_.devicePixelRatio||this.platform.getDevicePixelRatio(),z=this.width?"resize":"attach";this.width=C.width,this.height=C.height,this._aspectRatio=this.aspectRatio,yP(this,r,!0)&&(this.notifyPlugins("resize",{size:C}),po(_.onResize,[this,C],this),this.attached&&this._doResize(z)&&this.render())}ensureScalesHaveIDs(){const h=this.options.scales||{};Wa(h,(_,v)=>{_.id=v})}buildOrUpdateScales(){const s=this.options,h=s.scales,_=this.scales,v=Object.keys(_).reduce((C,r)=>(C[r]=!1,C),{});let E=[];h&&(E=E.concat(Object.keys(h).map(C=>{const r=h[C],z=TI(C,r),N=z==="r",H=z==="x";return{options:r,dposition:N?"chartArea":H?"bottom":"left",dtype:N?"radialLinear":H?"category":"linear"}}))),Wa(E,C=>{const r=C.options,z=r.id,N=TI(z,r),H=qr(r.type,C.dtype);(r.position===void 0||WP(r.position,N)!==WP(C.dposition))&&(r.position=C.dposition),v[z]=!0;let K=null;if(z in _&&_[z].type===H)K=_[z];else{const ne=ap.getScale(H);K=new ne({id:z,type:H,ctx:this.ctx,chart:this}),_[K.id]=K}K.init(r,s)}),Wa(v,(C,r)=>{C||delete _[r]}),Wa(_,C=>{O_.configure(this,C,C.options),O_.addBox(this,C)})}_updateMetasets(){const s=this._metasets,h=this.data.datasets.length,_=s.length;if(s.sort((v,E)=>v.index-E.index),_>h){for(let v=h;v<_;++v)this._destroyDatasetMeta(v);s.splice(h,_-h)}this._sortedMetasets=s.slice(0).sort(qP("order","index"))}_removeUnreferencedMetasets(){const{_metasets:s,data:{datasets:h}}=this;s.length>h.length&&delete this._stacks,s.forEach((_,v)=>{h.filter(E=>E===_._dataset).length===0&&this._destroyDatasetMeta(v)})}buildOrUpdateControllers(){const s=[],h=this.data.datasets;let _,v;for(this._removeUnreferencedMetasets(),_=0,v=h.length;_<v;_++){const E=h[_];let C=this.getDatasetMeta(_);const r=E.type||this.config.type;if(C.type&&C.type!==r&&(this._destroyDatasetMeta(_),C=this.getDatasetMeta(_)),C.type=r,C.indexAxis=E.indexAxis||wI(r,this.options),C.order=E.order||0,C.index=_,C.label=""+E.label,C.visible=this.isDatasetVisible(_),C.controller)C.controller.updateIndex(_),C.controller.linkScales();else{const z=ap.getController(r),{datasetElementType:N,dataElementType:H}=rs.datasets[r];Object.assign(z,{dataElementType:ap.getElement(H),datasetElementType:N&&ap.getElement(N)}),C.controller=new z(this,_),s.push(C.controller)}}return this._updateMetasets(),s}_resetElements(){Wa(this.data.datasets,(s,h)=>{this.getDatasetMeta(h).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(s){const h=this.config;h.update();const _=this._options=h.createResolver(h.chartOptionScopes(),this.getContext()),v=this._animationsDisabled=!_.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:s,cancelable:!0})===!1)return;const E=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let C=0;for(let N=0,H=this.data.datasets.length;N<H;N++){const{controller:K}=this.getDatasetMeta(N),ne=!v&&E.indexOf(K)===-1;K.buildOrUpdateElements(ne),C=Math.max(+K.getMaxOverflow(),C)}C=this._minPadding=_.layout.autoPadding?C:0,this._updateLayout(C),v||Wa(E,N=>{N.reset()}),this._updateDatasets(s),this.notifyPlugins("afterUpdate",{mode:s}),this._layers.sort(qP("z","_idx"));const{_active:r,_lastEvent:z}=this;z?this._eventHandler(z,!0):r.length&&this._updateHoverStyles(r,r,!0),this.render()}_updateScales(){Wa(this.scales,s=>{O_.removeBox(this,s)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const s=this.options,h=new Set(Object.keys(this._listeners)),_=new Set(s.events);(!aP(h,_)||!!this._responsiveListeners!==s.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:s}=this,h=this._getUniformDataChanges()||[];for(const{method:_,start:v,count:E}of h){const C=_==="_removeElements"?-E:E;_5(s,v,C)}}_getUniformDataChanges(){const s=this._dataChanges;if(!s||!s.length)return;this._dataChanges=[];const h=this.data.datasets.length,_=E=>new Set(s.filter(C=>C[0]===E).map((C,r)=>r+","+C.splice(1).join(","))),v=_(0);for(let E=1;E<h;E++)if(!aP(v,_(E)))return;return Array.from(v).map(E=>E.split(",")).map(E=>({method:E[1],start:+E[2],count:+E[3]}))}_updateLayout(s){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;O_.update(this,this.width,this.height,s);const h=this.chartArea,_=h.width<=0||h.height<=0;this._layers=[],Wa(this.boxes,v=>{_&&v.position==="chartArea"||(v.configure&&v.configure(),this._layers.push(...v._layers()))},this),this._layers.forEach((v,E)=>{v._idx=E}),this.notifyPlugins("afterLayout")}_updateDatasets(s){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:s,cancelable:!0})!==!1){for(let h=0,_=this.data.datasets.length;h<_;++h)this.getDatasetMeta(h).controller.configure();for(let h=0,_=this.data.datasets.length;h<_;++h)this._updateDataset(h,F_(s)?s({datasetIndex:h}):s);this.notifyPlugins("afterDatasetsUpdate",{mode:s})}}_updateDataset(s,h){const _=this.getDatasetMeta(s),v={meta:_,index:s,mode:h,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",v)!==!1&&(_.controller._update(h),v.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",v))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Mm.has(this)?this.attached&&!Mm.running(this)&&Mm.start(this):(this.draw(),ZP({chart:this})))}draw(){let s;if(this._resizeBeforeDraw){const{width:_,height:v}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(_,v)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const h=this._layers;for(s=0;s<h.length&&h[s].z<=0;++s)h[s].draw(this.chartArea);for(this._drawDatasets();s<h.length;++s)h[s].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(s){const h=this._sortedMetasets,_=[];let v,E;for(v=0,E=h.length;v<E;++v){const C=h[v];(!s||C.visible)&&_.push(C)}return _}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const s=this.getSortedVisibleDatasetMetas();for(let h=s.length-1;h>=0;--h)this._drawDataset(s[h]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(s){const h=this.ctx,_={meta:s,index:s.index,cancelable:!0},v=BU(this,s);this.notifyPlugins("beforeDatasetDraw",_)!==!1&&(v&&iD(h,v),s.controller.draw(),v&&nD(h),_.cancelable=!1,this.notifyPlugins("afterDatasetDraw",_))}isPointInArea(s){return TT(s,this.chartArea,this._minPadding)}getElementsAtEventForMode(s,h,_,v){const E=mV.modes[h];return typeof E=="function"?E(this,s,_,v):[]}getDatasetMeta(s){const h=this.data.datasets[s],_=this._metasets;let v=_.filter(E=>E&&E._dataset===h).pop();return v||(v={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:h&&h.order||0,index:s,_dataset:h,_parsed:[],_sorted:!1},_.push(v)),v}getContext(){return this.$context||(this.$context=Jv(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(s){const h=this.data.datasets[s];if(!h)return!1;const _=this.getDatasetMeta(s);return typeof _.hidden=="boolean"?!_.hidden:!h.hidden}setDatasetVisibility(s,h){const _=this.getDatasetMeta(s);_.hidden=!h}toggleDataVisibility(s){this._hiddenIndices[s]=!this._hiddenIndices[s]}getDataVisibility(s){return!this._hiddenIndices[s]}_updateVisibility(s,h,_){const v=_?"show":"hide",E=this.getDatasetMeta(s),C=E.controller._resolveAnimations(void 0,v);bT(h)?(E.data[h].hidden=!_,this.update()):(this.setDatasetVisibility(s,_),C.update(E,{visible:_}),this.update(r=>r.datasetIndex===s?v:void 0))}hide(s,h){this._updateVisibility(s,h,!1)}show(s,h){this._updateVisibility(s,h,!0)}_destroyDatasetMeta(s){const h=this._metasets[s];h&&h.controller&&h.controller._destroy(),delete this._metasets[s]}_stop(){let s,h;for(this.stop(),Mm.remove(this),s=0,h=this.data.datasets.length;s<h;++s)this._destroyDatasetMeta(s)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:s,ctx:h}=this;this._stop(),this.config.clearCache(),s&&(this.unbindEvents(),mP(s,h),this.platform.releaseContext(h),this.canvas=null,this.ctx=null),delete vC[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...s){return this.canvas.toDataURL(...s)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const s=this._listeners,h=this.platform,_=(E,C)=>{h.addEventListener(this,E,C),s[E]=C},v=(E,C,r)=>{E.offsetX=C,E.offsetY=r,this._eventHandler(E)};Wa(this.options.events,E=>_(E,v))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const s=this._responsiveListeners,h=this.platform,_=(z,N)=>{h.addEventListener(this,z,N),s[z]=N},v=(z,N)=>{s[z]&&(h.removeEventListener(this,z,N),delete s[z])},E=(z,N)=>{this.canvas&&this.resize(z,N)};let C;const r=()=>{v("attach",r),this.attached=!0,this.resize(),_("resize",E),_("detach",C)};C=()=>{this.attached=!1,v("resize",E),this._stop(),this._resize(0,0),_("attach",r)},h.isAttached(this.canvas)?r():C()}unbindEvents(){Wa(this._listeners,(s,h)=>{this.platform.removeEventListener(this,h,s)}),this._listeners={},Wa(this._responsiveListeners,(s,h)=>{this.platform.removeEventListener(this,h,s)}),this._responsiveListeners=void 0}updateHoverStyle(s,h,_){const v=_?"set":"remove";let E,C,r,z;for(h==="dataset"&&(E=this.getDatasetMeta(s[0].datasetIndex),E.controller["_"+v+"DatasetHoverStyle"]()),r=0,z=s.length;r<z;++r){C=s[r];const N=C&&this.getDatasetMeta(C.datasetIndex).controller;N&&N[v+"HoverStyle"](C.element,C.datasetIndex,C.index)}}getActiveElements(){return this._active||[]}setActiveElements(s){const h=this._active||[],_=s.map(({datasetIndex:E,index:C})=>{const r=this.getDatasetMeta(E);if(!r)throw new Error("No dataset found at index "+E);return{datasetIndex:E,element:r.data[C],index:C}});!AC(_,h)&&(this._active=_,this._lastEvent=null,this._updateHoverStyles(_,h))}notifyPlugins(s,h,_){return this._plugins.notify(this,s,h,_)}isPluginEnabled(s){return this._plugins._cache.filter(h=>h.plugin.id===s).length===1}_updateHoverStyles(s,h,_){const v=this.options.hover,E=(z,N)=>z.filter(H=>!N.some(K=>H.datasetIndex===K.datasetIndex&&H.index===K.index)),C=E(h,s),r=_?s:E(s,h);C.length&&this.updateHoverStyle(C,v.mode,!1),r.length&&v.mode&&this.updateHoverStyle(r,v.mode,!0)}_eventHandler(s,h){const _={event:s,replay:h,cancelable:!0,inChartArea:this.isPointInArea(s)},v=C=>(C.options.events||this.options.events).includes(s.native.type);if(this.notifyPlugins("beforeEvent",_,v)===!1)return;const E=this._handleEvent(s,h,_.inChartArea);return _.cancelable=!1,this.notifyPlugins("afterEvent",_,v),(E||_.changed)&&this.render(),this}_handleEvent(s,h,_){const{_active:v=[],options:E}=this,C=h,r=this._getActiveElements(s,v,_,C),z=x3(s),N=y5(s,this._lastEvent,_,z);_&&(this._lastEvent=null,po(E.onHover,[s,r,this],this),z&&po(E.onClick,[s,r,this],this));const H=!AC(r,v);return(H||h)&&(this._active=r,this._updateHoverStyles(r,v,h)),this._lastEvent=N,H}_getActiveElements(s,h,_,v){if(s.type==="mouseout")return[];if(!_)return h;const E=this.options.hover;return this.getElementsAtEventForMode(s,E.mode,E,v)}},kn(A_,"defaults",rs),kn(A_,"instances",vC),kn(A_,"overrides",Yv),kn(A_,"registry",ap),kn(A_,"version",p5),kn(A_,"getChart",XP),A_);function YP(){return Wa(hD.instances,d=>d._plugins.invalidate())}function v5(d,s,h){const{startAngle:_,x:v,y:E,outerRadius:C,innerRadius:r,options:z}=s,{borderWidth:N,borderJoinStyle:H}=z,K=Math.min(N/C,Vd(_-h));if(d.beginPath(),d.arc(v,E,C-N/2,_+K/2,h-K/2),r>0){const ne=Math.min(N/r,Vd(_-h));d.arc(v,E,r+N/2,h-ne/2,_+ne/2,!0)}else{const ne=Math.min(N/2,C*Vd(_-h));if(H==="round")d.arc(v,E,ne,h-Io/2,_+Io/2,!0);else if(H==="bevel"){const ue=2*ne*ne,pe=-ue*Math.cos(h+Io/2)+v,xe=-ue*Math.sin(h+Io/2)+E,be=ue*Math.cos(_+Io/2)+v,je=ue*Math.sin(_+Io/2)+E;d.lineTo(pe,xe),d.lineTo(be,je)}}d.closePath(),d.moveTo(0,0),d.rect(0,0,d.canvas.width,d.canvas.height),d.clip("evenodd")}function x5(d,s,h){const{startAngle:_,pixelMargin:v,x:E,y:C,outerRadius:r,innerRadius:z}=s;let N=v/r;d.beginPath(),d.arc(E,C,r,_-N,h+N),z>v?(N=v/z,d.arc(E,C,z,h+N,_-N,!0)):d.arc(E,C,v,h+Ol,_-Ol),d.closePath(),d.clip()}function b5(d){return rD(d,["outerStart","outerEnd","innerStart","innerEnd"])}function w5(d,s,h,_){const v=b5(d.options.borderRadius),E=(h-s)/2,C=Math.min(E,_*s/2),r=z=>{const N=(h-Math.min(E,z))*_/2;return ec(z,0,Math.min(E,N))};return{outerStart:r(v.outerStart),outerEnd:r(v.outerEnd),innerStart:ec(v.innerStart,0,C),innerEnd:ec(v.innerEnd,0,C)}}function _b(d,s,h,_){return{x:h+d*Math.cos(s),y:_+d*Math.sin(s)}}function kC(d,s,h,_,v,E){const{x:C,y:r,startAngle:z,pixelMargin:N,innerRadius:H}=s,K=Math.max(s.outerRadius+_+h-N,0),ne=H>0?H+_+h+N:0;let ue=0;const pe=v-z;if(_){const Qt=H>0?H-_:0,ui=K>0?K-_:0,ri=(Qt+ui)/2,zi=ri!==0?pe*ri/(ri+_):pe;ue=(pe-zi)/2}const xe=Math.max(.001,pe*K-h/Io)/K,be=(pe-xe)/2,je=z+be+ue,Be=v-be-ue,{outerStart:He,outerEnd:Xe,innerStart:it,innerEnd:kt}=w5(s,ne,K,Be-je),Nt=K-He,oi=K-Xe,yi=je+He/Nt,Ui=Be-Xe/oi,hi=ne+it,Ti=ne+kt,Dt=je+it/hi,Di=Be-kt/Ti;if(d.beginPath(),E){const Qt=(yi+Ui)/2;if(d.arc(C,r,K,yi,Qt),d.arc(C,r,K,Qt,Ui),Xe>0){const En=_b(oi,Ui,C,r);d.arc(En.x,En.y,Xe,Ui,Be+Ol)}const ui=_b(Ti,Be,C,r);if(d.lineTo(ui.x,ui.y),kt>0){const En=_b(Ti,Di,C,r);d.arc(En.x,En.y,kt,Be+Ol,Di+Math.PI)}const ri=(Be-kt/ne+(je+it/ne))/2;if(d.arc(C,r,ne,Be-kt/ne,ri,!0),d.arc(C,r,ne,ri,je+it/ne,!0),it>0){const En=_b(hi,Dt,C,r);d.arc(En.x,En.y,it,Dt+Math.PI,je-Ol)}const zi=_b(Nt,je,C,r);if(d.lineTo(zi.x,zi.y),He>0){const En=_b(Nt,yi,C,r);d.arc(En.x,En.y,He,je-Ol,yi)}}else{d.moveTo(C,r);const Qt=Math.cos(yi)*K+C,ui=Math.sin(yi)*K+r;d.lineTo(Qt,ui);const ri=Math.cos(Ui)*K+C,zi=Math.sin(Ui)*K+r;d.lineTo(ri,zi)}d.closePath()}function T5(d,s,h,_,v){const{fullCircles:E,startAngle:C,circumference:r}=s;let z=s.endAngle;if(E){kC(d,s,h,_,z,v);for(let N=0;N<E;++N)d.fill();isNaN(r)||(z=C+(r%kl||kl))}return kC(d,s,h,_,z,v),d.fill(),z}function S5(d,s,h,_,v){const{fullCircles:E,startAngle:C,circumference:r,options:z}=s,{borderWidth:N,borderJoinStyle:H,borderDash:K,borderDashOffset:ne,borderRadius:ue}=z,pe=z.borderAlign==="inner";if(!N)return;d.setLineDash(K||[]),d.lineDashOffset=ne,pe?(d.lineWidth=N*2,d.lineJoin=H||"round"):(d.lineWidth=N,d.lineJoin=H||"bevel");let xe=s.endAngle;if(E){kC(d,s,h,_,xe,v);for(let be=0;be<E;++be)d.stroke();isNaN(r)||(xe=C+(r%kl||kl))}pe&&x5(d,s,xe),z.selfJoin&&xe-C>=Io&&ue===0&&H!=="miter"&&v5(d,s,xe),E||(kC(d,s,h,_,xe,v),d.stroke())}class iT extends up{constructor(h){super();kn(this,"circumference");kn(this,"endAngle");kn(this,"fullCircles");kn(this,"innerRadius");kn(this,"outerRadius");kn(this,"pixelMargin");kn(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,h&&Object.assign(this,h)}inRange(h,_,v){const E=this.getProps(["x","y"],v),{angle:C,distance:r}=Ik(E,{x:h,y:_}),{startAngle:z,endAngle:N,innerRadius:H,outerRadius:K,circumference:ne}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],v),ue=(this.options.spacing+this.options.borderWidth)/2,pe=qr(ne,N-z),xe=QI(C,z,N)&&z!==N,be=pe>=kl||xe,je=M_(r,H+ue,K+ue);return be&&je}getCenterPoint(h){const{x:_,y:v,startAngle:E,endAngle:C,innerRadius:r,outerRadius:z}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],h),{offset:N,spacing:H}=this.options,K=(E+C)/2,ne=(r+z+H+N)/2;return{x:_+Math.cos(K)*ne,y:v+Math.sin(K)*ne}}tooltipPosition(h){return this.getCenterPoint(h)}draw(h){const{options:_,circumference:v}=this,E=(_.offset||0)/4,C=(_.spacing||0)/2,r=_.circular;if(this.pixelMargin=_.borderAlign==="inner"?.33:0,this.fullCircles=v>kl?Math.floor(v/kl):0,v===0||this.innerRadius<0||this.outerRadius<0)return;h.save();const z=(this.startAngle+this.endAngle)/2;h.translate(Math.cos(z)*E,Math.sin(z)*E);const N=1-Math.sin(Math.min(Io,v||0)),H=E*N;h.fillStyle=_.backgroundColor,h.strokeStyle=_.borderColor,T5(h,this,H,C,r),S5(h,this,H,C,r),h.restore()}}kn(iT,"id","arc"),kn(iT,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),kn(iT,"defaultRoutes",{backgroundColor:"backgroundColor"}),kn(iT,"descriptors",{_scriptable:!0,_indexable:h=>h!=="borderDash"});function a2(d,s,h=s){d.lineCap=qr(h.borderCapStyle,s.borderCapStyle),d.setLineDash(qr(h.borderDash,s.borderDash)),d.lineDashOffset=qr(h.borderDashOffset,s.borderDashOffset),d.lineJoin=qr(h.borderJoinStyle,s.borderJoinStyle),d.lineWidth=qr(h.borderWidth,s.borderWidth),d.strokeStyle=qr(h.borderColor,s.borderColor)}function E5(d,s,h){d.lineTo(h.x,h.y)}function C5(d){return d.stepped?q3:d.tension||d.cubicInterpolationMode==="monotone"?Z3:E5}function o2(d,s,h={}){const _=d.length,{start:v=0,end:E=_-1}=h,{start:C,end:r}=s,z=Math.max(v,C),N=Math.min(E,r),H=v<C&&E<C||v>r&&E>r;return{count:_,start:z,loop:s.loop,ilen:N<z&&!H?_+N-z:N-z}}function A5(d,s,h,_){const{points:v,options:E}=s,{count:C,start:r,loop:z,ilen:N}=o2(v,h,_),H=C5(E);let{move:K=!0,reverse:ne}=_||{},ue,pe,xe;for(ue=0;ue<=N;++ue)pe=v[(r+(ne?N-ue:ue))%C],!pe.skip&&(K?(d.moveTo(pe.x,pe.y),K=!1):H(d,xe,pe,ne,E.stepped),xe=pe);return z&&(pe=v[(r+(ne?N:0))%C],H(d,xe,pe,ne,E.stepped)),!!z}function R5(d,s,h,_){const v=s.points,{count:E,start:C,ilen:r}=o2(v,h,_),{move:z=!0,reverse:N}=_||{};let H=0,K=0,ne,ue,pe,xe,be,je;const Be=Xe=>(C+(N?r-Xe:Xe))%E,He=()=>{xe!==be&&(d.lineTo(H,be),d.lineTo(H,xe),d.lineTo(H,je))};for(z&&(ue=v[Be(0)],d.moveTo(ue.x,ue.y)),ne=0;ne<=r;++ne){if(ue=v[Be(ne)],ue.skip)continue;const Xe=ue.x,it=ue.y,kt=Xe|0;kt===pe?(it<xe?xe=it:it>be&&(be=it),H=(K*H+Xe)/++K):(He(),d.lineTo(Xe,it),pe=kt,K=0,xe=be=it),je=it}He()}function SI(d){const s=d.options,h=s.borderDash&&s.borderDash.length;return!d._decimated&&!d._loop&&!s.tension&&s.cubicInterpolationMode!=="monotone"&&!s.stepped&&!h?R5:A5}function I5(d){return d.stepped?CU:d.tension||d.cubicInterpolationMode==="monotone"?AU:Uv}function D5(d,s,h,_){let v=s._path;v||(v=s._path=new Path2D,s.path(v,h,_)&&v.closePath()),a2(d,s.options),d.stroke(v)}function M5(d,s,h,_){const{segments:v,options:E}=s,C=SI(s);for(const r of v)a2(d,E,r.style),d.beginPath(),C(d,s,r,{start:h,end:h+_-1})&&d.closePath(),d.stroke()}const P5=typeof Path2D=="function";function O5(d,s,h,_){P5&&!s.options.segment?D5(d,s,h,_):M5(d,s,h,_)}class nT extends up{constructor(s){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,s&&Object.assign(this,s)}updateControlPoints(s,h){const _=this.options;if((_.tension||_.cubicInterpolationMode==="monotone")&&!_.stepped&&!this._pointsUpdated){const v=_.spanGaps?this._loop:this._fullLoop;yU(this._points,_,s,v,h),this._pointsUpdated=!0}}set points(s){this._points=s,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=LU(this,this.options.segment))}first(){const s=this.segments,h=this.points;return s.length&&h[s[0].start]}last(){const s=this.segments,h=this.points,_=s.length;return _&&h[s[_-1].end]}interpolate(s,h){const _=this.options,v=s[h],E=this.points,C=PU(this,{property:h,start:v,end:v});if(!C.length)return;const r=[],z=I5(_);let N,H;for(N=0,H=C.length;N<H;++N){const{start:K,end:ne}=C[N],ue=E[K],pe=E[ne];if(ue===pe){r.push(ue);continue}const xe=Math.abs((v-ue[h])/(pe[h]-ue[h])),be=z(ue,pe,xe,_.stepped);be[h]=s[h],r.push(be)}return r.length===1?r[0]:r}pathSegment(s,h,_){return SI(this)(s,this,h,_)}path(s,h,_){const v=this.segments,E=SI(this);let C=this._loop;h=h||0,_=_||this.points.length-h;for(const r of v)C&=E(s,this,r,{start:h,end:h+_-1});return!!C}draw(s,h,_,v){const E=this.options||{};(this.points||[]).length&&E.borderWidth&&(s.save(),O5(s,this,_,v),s.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}kn(nT,"id","line"),kn(nT,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),kn(nT,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),kn(nT,"descriptors",{_scriptable:!0,_indexable:s=>s!=="borderDash"&&s!=="fill"});function KP(d,s,h,_){const v=d.options,{[h]:E}=d.getProps([h],_);return Math.abs(s-E)<v.radius+v.hitRadius}class hT extends up{constructor(h){super();kn(this,"parsed");kn(this,"skip");kn(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,h&&Object.assign(this,h)}inRange(h,_,v){const E=this.options,{x:C,y:r}=this.getProps(["x","y"],v);return Math.pow(h-C,2)+Math.pow(_-r,2)<Math.pow(E.hitRadius+E.radius,2)}inXRange(h,_){return KP(this,h,"x",_)}inYRange(h,_){return KP(this,h,"y",_)}getCenterPoint(h){const{x:_,y:v}=this.getProps(["x","y"],h);return{x:_,y:v}}size(h){h=h||this.options||{};let _=h.radius||0;_=Math.max(_,_&&h.hoverRadius||0);const v=_&&h.borderWidth||0;return(_+v)*2}draw(h,_){const v=this.options;this.skip||v.radius<.1||!TT(this,_,this.size(v)/2)||(h.strokeStyle=v.borderColor,h.lineWidth=v.borderWidth,h.fillStyle=v.backgroundColor,bI(h,v,this.x,this.y))}getRange(){const h=this.options||{};return h.radius+h.hitRadius}}kn(hT,"id","point"),kn(hT,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),kn(hT,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function s2(d,s){const{x:h,y:_,base:v,width:E,height:C}=d.getProps(["x","y","base","width","height"],s);let r,z,N,H,K;return d.horizontal?(K=C/2,r=Math.min(h,v),z=Math.max(h,v),N=_-K,H=_+K):(K=E/2,r=h-K,z=h+K,N=Math.min(_,v),H=Math.max(_,v)),{left:r,top:N,right:z,bottom:H}}function k_(d,s,h,_){return d?0:ec(s,h,_)}function k5(d,s,h){const _=d.options.borderWidth,v=d.borderSkipped,E=Nk(_);return{t:k_(v.top,E.top,0,h),r:k_(v.right,E.right,0,s),b:k_(v.bottom,E.bottom,0,h),l:k_(v.left,E.left,0,s)}}function L5(d,s,h){const{enableBorderRadius:_}=d.getProps(["enableBorderRadius"]),v=d.options.borderRadius,E=xb(v),C=Math.min(s,h),r=d.borderSkipped,z=_||Ca(v);return{topLeft:k_(!z||r.top||r.left,E.topLeft,0,C),topRight:k_(!z||r.top||r.right,E.topRight,0,C),bottomLeft:k_(!z||r.bottom||r.left,E.bottomLeft,0,C),bottomRight:k_(!z||r.bottom||r.right,E.bottomRight,0,C)}}function z5(d){const s=s2(d),h=s.right-s.left,_=s.bottom-s.top,v=k5(d,h/2,_/2),E=L5(d,h/2,_/2);return{outer:{x:s.left,y:s.top,w:h,h:_,radius:E},inner:{x:s.left+v.l,y:s.top+v.t,w:h-v.l-v.r,h:_-v.t-v.b,radius:{topLeft:Math.max(0,E.topLeft-Math.max(v.t,v.l)),topRight:Math.max(0,E.topRight-Math.max(v.t,v.r)),bottomLeft:Math.max(0,E.bottomLeft-Math.max(v.b,v.l)),bottomRight:Math.max(0,E.bottomRight-Math.max(v.b,v.r))}}}}function nI(d,s,h,_){const v=s===null,E=h===null,r=d&&!(v&&E)&&s2(d,_);return r&&(v||M_(s,r.left,r.right))&&(E||M_(h,r.top,r.bottom))}function F5(d){return d.topLeft||d.topRight||d.bottomLeft||d.bottomRight}function N5(d,s){d.rect(s.x,s.y,s.w,s.h)}function rI(d,s,h={}){const _=d.x!==h.x?-s:0,v=d.y!==h.y?-s:0,E=(d.x+d.w!==h.x+h.w?s:0)-_,C=(d.y+d.h!==h.y+h.h?s:0)-v;return{x:d.x+_,y:d.y+v,w:d.w+E,h:d.h+C,radius:d.radius}}class dT extends up{constructor(s){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,s&&Object.assign(this,s)}draw(s){const{inflateAmount:h,options:{borderColor:_,backgroundColor:v}}=this,{inner:E,outer:C}=z5(this),r=F5(C.radius)?MC:N5;s.save(),(C.w!==E.w||C.h!==E.h)&&(s.beginPath(),r(s,rI(C,h,E)),s.clip(),r(s,rI(E,-h,C)),s.fillStyle=_,s.fill("evenodd")),s.beginPath(),r(s,rI(E,h)),s.fillStyle=v,s.fill(),s.restore()}inRange(s,h,_){return nI(this,s,h,_)}inXRange(s,h){return nI(this,s,null,h)}inYRange(s,h){return nI(this,null,s,h)}getCenterPoint(s){const{x:h,y:_,base:v,horizontal:E}=this.getProps(["x","y","base","horizontal"],s);return{x:E?(h+v)/2:h,y:E?_:(_+v)/2}}getRange(s){return s==="x"?this.width/2:this.height/2}}kn(dT,"id","bar"),kn(dT,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),kn(dT,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});const JP=(d,s)=>{let{boxHeight:h=s,boxWidth:_=s}=d;return d.usePointStyle&&(h=Math.min(h,s),_=d.pointStyleWidth||Math.min(_,s)),{boxWidth:_,boxHeight:h,itemHeight:Math.max(s,h)}},B5=(d,s)=>d!==null&&s!==null&&d.datasetIndex===s.datasetIndex&&d.index===s.index;class QP extends up{constructor(s){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,h,_){this.maxWidth=s,this.maxHeight=h,this._margins=_,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const s=this.options.labels||{};let h=po(s.generateLabels,[this.chart],this)||[];s.filter&&(h=h.filter(_=>s.filter(_,this.chart.data))),s.sort&&(h=h.sort((_,v)=>s.sort(_,v,this.chart.data))),this.options.reverse&&h.reverse(),this.legendItems=h}fit(){const{options:s,ctx:h}=this;if(!s.display){this.width=this.height=0;return}const _=s.labels,v=Ac(_.font),E=v.size,C=this._computeTitleHeight(),{boxWidth:r,itemHeight:z}=JP(_,E);let N,H;h.font=v.string,this.isHorizontal()?(N=this.maxWidth,H=this._fitRows(C,E,r,z)+10):(H=this.maxHeight,N=this._fitCols(C,v,r,z)+10),this.width=Math.min(N,s.maxWidth||this.maxWidth),this.height=Math.min(H,s.maxHeight||this.maxHeight)}_fitRows(s,h,_,v){const{ctx:E,maxWidth:C,options:{labels:{padding:r}}}=this,z=this.legendHitBoxes=[],N=this.lineWidths=[0],H=v+r;let K=s;E.textAlign="left",E.textBaseline="middle";let ne=-1,ue=-H;return this.legendItems.forEach((pe,xe)=>{const be=_+h/2+E.measureText(pe.text).width;(xe===0||N[N.length-1]+be+2*r>C)&&(K+=H,N[N.length-(xe>0?0:1)]=0,ue+=H,ne++),z[xe]={left:0,top:ue,row:ne,width:be,height:v},N[N.length-1]+=be+r}),K}_fitCols(s,h,_,v){const{ctx:E,maxHeight:C,options:{labels:{padding:r}}}=this,z=this.legendHitBoxes=[],N=this.columnSizes=[],H=C-s;let K=r,ne=0,ue=0,pe=0,xe=0;return this.legendItems.forEach((be,je)=>{const{itemWidth:Be,itemHeight:He}=U5(_,h,E,be,v);je>0&&ue+He+2*r>H&&(K+=ne+r,N.push({width:ne,height:ue}),pe+=ne+r,xe++,ne=ue=0),z[je]={left:pe,top:ue,col:xe,width:Be,height:He},ne=Math.max(ne,Be),ue+=He+r}),K+=ne,N.push({width:ne,height:ue}),K}adjustHitBoxes(){if(!this.options.display)return;const s=this._computeTitleHeight(),{legendHitBoxes:h,options:{align:_,labels:{padding:v},rtl:E}}=this,C=bb(E,this.left,this.width);if(this.isHorizontal()){let r=0,z=lh(_,this.left+v,this.right-this.lineWidths[r]);for(const N of h)r!==N.row&&(r=N.row,z=lh(_,this.left+v,this.right-this.lineWidths[r])),N.top+=this.top+s+v,N.left=C.leftForLtr(C.x(z),N.width),z+=N.width+v}else{let r=0,z=lh(_,this.top+s+v,this.bottom-this.columnSizes[r].height);for(const N of h)N.col!==r&&(r=N.col,z=lh(_,this.top+s+v,this.bottom-this.columnSizes[r].height)),N.top=z,N.left+=this.left+v,N.left=C.leftForLtr(C.x(N.left),N.width),z+=N.height+v}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const s=this.ctx;iD(s,this),this._draw(),nD(s)}}_draw(){const{options:s,columnSizes:h,lineWidths:_,ctx:v}=this,{align:E,labels:C}=s,r=rs.color,z=bb(s.rtl,this.left,this.width),N=Ac(C.font),{padding:H}=C,K=N.size,ne=K/2;let ue;this.drawTitle(),v.textAlign=z.textAlign("left"),v.textBaseline="middle",v.lineWidth=.5,v.font=N.string;const{boxWidth:pe,boxHeight:xe,itemHeight:be}=JP(C,K),je=function(kt,Nt,oi){if(isNaN(pe)||pe<=0||isNaN(xe)||xe<0)return;v.save();const yi=qr(oi.lineWidth,1);if(v.fillStyle=qr(oi.fillStyle,r),v.lineCap=qr(oi.lineCap,"butt"),v.lineDashOffset=qr(oi.lineDashOffset,0),v.lineJoin=qr(oi.lineJoin,"miter"),v.lineWidth=yi,v.strokeStyle=qr(oi.strokeStyle,r),v.setLineDash(qr(oi.lineDash,[])),C.usePointStyle){const Ui={radius:xe*Math.SQRT2/2,pointStyle:oi.pointStyle,rotation:oi.rotation,borderWidth:yi},hi=z.xPlus(kt,pe/2),Ti=Nt+ne;Fk(v,Ui,hi,Ti,C.pointStyleWidth&&pe)}else{const Ui=Nt+Math.max((K-xe)/2,0),hi=z.leftForLtr(kt,pe),Ti=xb(oi.borderRadius);v.beginPath(),Object.values(Ti).some(Dt=>Dt!==0)?MC(v,{x:hi,y:Ui,w:pe,h:xe,radius:Ti}):v.rect(hi,Ui,pe,xe),v.fill(),yi!==0&&v.stroke()}v.restore()},Be=function(kt,Nt,oi){DC(v,oi.text,kt,Nt+be/2,N,{strikethrough:oi.hidden,textAlign:z.textAlign(oi.textAlign)})},He=this.isHorizontal(),Xe=this._computeTitleHeight();He?ue={x:lh(E,this.left+H,this.right-_[0]),y:this.top+H+Xe,line:0}:ue={x:this.left+H,y:lh(E,this.top+Xe+H,this.bottom-h[0].height),line:0},Hk(this.ctx,s.textDirection);const it=be+H;this.legendItems.forEach((kt,Nt)=>{v.strokeStyle=kt.fontColor,v.fillStyle=kt.fontColor;const oi=v.measureText(kt.text).width,yi=z.textAlign(kt.textAlign||(kt.textAlign=C.textAlign)),Ui=pe+ne+oi;let hi=ue.x,Ti=ue.y;z.setWidth(this.width),He?Nt>0&&hi+Ui+H>this.right&&(Ti=ue.y+=it,ue.line++,hi=ue.x=lh(E,this.left+H,this.right-_[ue.line])):Nt>0&&Ti+it>this.bottom&&(hi=ue.x=hi+h[ue.line].width+H,ue.line++,Ti=ue.y=lh(E,this.top+Xe+H,this.bottom-h[ue.line].height));const Dt=z.x(hi);if(je(Dt,Ti,kt),hi=k3(yi,hi+pe+ne,He?hi+Ui:this.right,s.rtl),Be(z.x(hi),Ti,kt),He)ue.x+=Ui+H;else if(typeof kt.text!="string"){const Di=N.lineHeight;ue.y+=l2(kt,Di)+H}else ue.y+=it}),$k(this.ctx,s.textDirection)}drawTitle(){const s=this.options,h=s.title,_=Ac(h.font),v=od(h.padding);if(!h.display)return;const E=bb(s.rtl,this.left,this.width),C=this.ctx,r=h.position,z=_.size/2,N=v.top+z;let H,K=this.left,ne=this.width;if(this.isHorizontal())ne=Math.max(...this.lineWidths),H=this.top+N,K=lh(s.align,K,this.right-ne);else{const pe=this.columnSizes.reduce((xe,be)=>Math.max(xe,be.height),0);H=N+lh(s.align,this.top,this.bottom-pe-s.labels.padding-this._computeTitleHeight())}const ue=lh(r,K,K+ne);C.textAlign=E.textAlign(kk(r)),C.textBaseline="middle",C.strokeStyle=h.color,C.fillStyle=h.color,C.font=_.string,DC(C,h.text,ue,H,_)}_computeTitleHeight(){const s=this.options.title,h=Ac(s.font),_=od(s.padding);return s.display?h.lineHeight+_.height:0}_getLegendItemAt(s,h){let _,v,E;if(M_(s,this.left,this.right)&&M_(h,this.top,this.bottom)){for(E=this.legendHitBoxes,_=0;_<E.length;++_)if(v=E[_],M_(s,v.left,v.left+v.width)&&M_(h,v.top,v.top+v.height))return this.legendItems[_]}return null}handleEvent(s){const h=this.options;if(!G5(s.type,h))return;const _=this._getLegendItemAt(s.x,s.y);if(s.type==="mousemove"||s.type==="mouseout"){const v=this._hoveredItem,E=B5(v,_);v&&!E&&po(h.onLeave,[s,v,this],this),this._hoveredItem=_,_&&!E&&po(h.onHover,[s,_,this],this)}else _&&po(h.onClick,[s,_,this],this)}}function U5(d,s,h,_,v){const E=V5(_,d,s,h),C=j5(v,_,s.lineHeight);return{itemWidth:E,itemHeight:C}}function V5(d,s,h,_){let v=d.text;return v&&typeof v!="string"&&(v=v.reduce((E,C)=>E.length>C.length?E:C)),s+h.size/2+_.measureText(v).width}function j5(d,s,h){let _=d;return typeof s.text!="string"&&(_=l2(s,h)),_}function l2(d,s){const h=d.text?d.text.length:0;return s*h}function G5(d,s){return!!((d==="mousemove"||d==="mouseout")&&(s.onHover||s.onLeave)||s.onClick&&(d==="click"||d==="mouseup"))}var H5={id:"legend",_element:QP,start(d,s,h){const _=d.legend=new QP({ctx:d.ctx,options:h,chart:d});O_.configure(d,_,h),O_.addBox(d,_)},stop(d){O_.removeBox(d,d.legend),delete d.legend},beforeUpdate(d,s,h){const _=d.legend;O_.configure(d,_,h),_.options=h},afterUpdate(d){const s=d.legend;s.buildLabels(),s.adjustHitBoxes()},afterEvent(d,s){s.replay||d.legend.handleEvent(s.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(d,s,h){const _=s.datasetIndex,v=h.chart;v.isDatasetVisible(_)?(v.hide(_),s.hidden=!0):(v.show(_),s.hidden=!1)},onHover:null,onLeave:null,labels:{color:d=>d.chart.options.color,boxWidth:40,padding:10,generateLabels(d){const s=d.data.datasets,{labels:{usePointStyle:h,pointStyle:_,textAlign:v,color:E,useBorderRadius:C,borderRadius:r}}=d.legend.options;return d._getSortedDatasetMetas().map(z=>{const N=z.controller.getStyle(h?0:void 0),H=od(N.borderWidth);return{text:s[z.index].label,fillStyle:N.backgroundColor,fontColor:E,hidden:!z.visible,lineCap:N.borderCapStyle,lineDash:N.borderDash,lineDashOffset:N.borderDashOffset,lineJoin:N.borderJoinStyle,lineWidth:(H.width+H.height)/4,strokeStyle:N.borderColor,pointStyle:_||N.pointStyle,rotation:N.rotation,textAlign:v||N.textAlign,borderRadius:C&&(r||N.borderRadius),datasetIndex:z.index}},this)}},title:{color:d=>d.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:d=>!d.startsWith("on"),labels:{_scriptable:d=>!["generateLabels","filter","sort"].includes(d)}}};const rT={average(d){if(!d.length)return!1;let s,h,_=new Set,v=0,E=0;for(s=0,h=d.length;s<h;++s){const r=d[s].element;if(r&&r.hasValue()){const z=r.tooltipPosition();_.add(z.x),v+=z.y,++E}}return E===0||_.size===0?!1:{x:[..._].reduce((r,z)=>r+z)/_.size,y:v/E}},nearest(d,s){if(!d.length)return!1;let h=s.x,_=s.y,v=Number.POSITIVE_INFINITY,E,C,r;for(E=0,C=d.length;E<C;++E){const z=d[E].element;if(z&&z.hasValue()){const N=z.getCenterPoint(),H=vI(s,N);H<v&&(v=H,r=z)}}if(r){const z=r.tooltipPosition();h=z.x,_=z.y}return{x:h,y:_}}};function rp(d,s){return s&&(Ys(s)?Array.prototype.push.apply(d,s):d.push(s)),d}function Pm(d){return(typeof d=="string"||d instanceof String)&&d.indexOf(`
`)>-1?d.split(`
`):d}function $5(d,s){const{element:h,datasetIndex:_,index:v}=s,E=d.getDatasetMeta(_).controller,{label:C,value:r}=E.getLabelAndValue(v);return{chart:d,label:C,parsed:E.getParsed(v),raw:d.data.datasets[_].data[v],formattedValue:r,dataset:E.getDataset(),dataIndex:v,datasetIndex:_,element:h}}function eO(d,s){const h=d.chart.ctx,{body:_,footer:v,title:E}=d,{boxWidth:C,boxHeight:r}=s,z=Ac(s.bodyFont),N=Ac(s.titleFont),H=Ac(s.footerFont),K=E.length,ne=v.length,ue=_.length,pe=od(s.padding);let xe=pe.height,be=0,je=_.reduce((Xe,it)=>Xe+it.before.length+it.lines.length+it.after.length,0);if(je+=d.beforeBody.length+d.afterBody.length,K&&(xe+=K*N.lineHeight+(K-1)*s.titleSpacing+s.titleMarginBottom),je){const Xe=s.displayColors?Math.max(r,z.lineHeight):z.lineHeight;xe+=ue*Xe+(je-ue)*z.lineHeight+(je-1)*s.bodySpacing}ne&&(xe+=s.footerMarginTop+ne*H.lineHeight+(ne-1)*s.footerSpacing);let Be=0;const He=function(Xe){be=Math.max(be,h.measureText(Xe).width+Be)};return h.save(),h.font=N.string,Wa(d.title,He),h.font=z.string,Wa(d.beforeBody.concat(d.afterBody),He),Be=s.displayColors?C+2+s.boxPadding:0,Wa(_,Xe=>{Wa(Xe.before,He),Wa(Xe.lines,He),Wa(Xe.after,He)}),Be=0,h.font=H.string,Wa(d.footer,He),h.restore(),be+=pe.width,{width:be,height:xe}}function W5(d,s){const{y:h,height:_}=s;return h<_/2?"top":h>d.height-_/2?"bottom":"center"}function q5(d,s,h,_){const{x:v,width:E}=_,C=h.caretSize+h.caretPadding;if(d==="left"&&v+E+C>s.width||d==="right"&&v-E-C<0)return!0}function Z5(d,s,h,_){const{x:v,width:E}=h,{width:C,chartArea:{left:r,right:z}}=d;let N="center";return _==="center"?N=v<=(r+z)/2?"left":"right":v<=E/2?N="left":v>=C-E/2&&(N="right"),q5(N,d,s,h)&&(N="center"),N}function tO(d,s,h){const _=h.yAlign||s.yAlign||W5(d,h);return{xAlign:h.xAlign||s.xAlign||Z5(d,s,h,_),yAlign:_}}function X5(d,s){let{x:h,width:_}=d;return s==="right"?h-=_:s==="center"&&(h-=_/2),h}function Y5(d,s,h){let{y:_,height:v}=d;return s==="top"?_+=h:s==="bottom"?_-=v+h:_-=v/2,_}function iO(d,s,h,_){const{caretSize:v,caretPadding:E,cornerRadius:C}=d,{xAlign:r,yAlign:z}=h,N=v+E,{topLeft:H,topRight:K,bottomLeft:ne,bottomRight:ue}=xb(C);let pe=X5(s,r);const xe=Y5(s,z,N);return z==="center"?r==="left"?pe+=N:r==="right"&&(pe-=N):r==="left"?pe-=Math.max(H,ne)+v:r==="right"&&(pe+=Math.max(K,ue)+v),{x:ec(pe,0,_.width-s.width),y:ec(xe,0,_.height-s.height)}}function rC(d,s,h){const _=od(h.padding);return s==="center"?d.x+d.width/2:s==="right"?d.x+d.width-_.right:d.x+_.left}function nO(d){return rp([],Pm(d))}function K5(d,s,h){return Jv(d,{tooltip:s,tooltipItems:h,type:"tooltip"})}function rO(d,s){const h=s&&s.dataset&&s.dataset.tooltip&&s.dataset.tooltip.callbacks;return h?d.override(h):d}const c2={beforeTitle:Dm,title(d){if(d.length>0){const s=d[0],h=s.chart.data.labels,_=h?h.length:0;if(this&&this.options&&this.options.mode==="dataset")return s.dataset.label||"";if(s.label)return s.label;if(_>0&&s.dataIndex<_)return h[s.dataIndex]}return""},afterTitle:Dm,beforeBody:Dm,beforeLabel:Dm,label(d){if(this&&this.options&&this.options.mode==="dataset")return d.label+": "+d.formattedValue||d.formattedValue;let s=d.dataset.label||"";s&&(s+=": ");const h=d.formattedValue;return ga(h)||(s+=h),s},labelColor(d){const h=d.chart.getDatasetMeta(d.datasetIndex).controller.getStyle(d.dataIndex);return{borderColor:h.borderColor,backgroundColor:h.backgroundColor,borderWidth:h.borderWidth,borderDash:h.borderDash,borderDashOffset:h.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(d){const h=d.chart.getDatasetMeta(d.datasetIndex).controller.getStyle(d.dataIndex);return{pointStyle:h.pointStyle,rotation:h.rotation}},afterLabel:Dm,afterBody:Dm,beforeFooter:Dm,footer:Dm,afterFooter:Dm};function mu(d,s,h,_){const v=d[s].call(h,_);return typeof v>"u"?c2[s].call(h,_):v}class EI extends up{constructor(s){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=s.chart,this.options=s.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(s){this.options=s,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const s=this._cachedAnimations;if(s)return s;const h=this.chart,_=this.options.setContext(this.getContext()),v=_.enabled&&h.options.animation&&_.animations,E=new qk(this.chart,v);return v._cacheable&&(this._cachedAnimations=Object.freeze(E)),E}getContext(){return this.$context||(this.$context=K5(this.chart.getContext(),this,this._tooltipItems))}getTitle(s,h){const{callbacks:_}=h,v=mu(_,"beforeTitle",this,s),E=mu(_,"title",this,s),C=mu(_,"afterTitle",this,s);let r=[];return r=rp(r,Pm(v)),r=rp(r,Pm(E)),r=rp(r,Pm(C)),r}getBeforeBody(s,h){return nO(mu(h.callbacks,"beforeBody",this,s))}getBody(s,h){const{callbacks:_}=h,v=[];return Wa(s,E=>{const C={before:[],lines:[],after:[]},r=rO(_,E);rp(C.before,Pm(mu(r,"beforeLabel",this,E))),rp(C.lines,mu(r,"label",this,E)),rp(C.after,Pm(mu(r,"afterLabel",this,E))),v.push(C)}),v}getAfterBody(s,h){return nO(mu(h.callbacks,"afterBody",this,s))}getFooter(s,h){const{callbacks:_}=h,v=mu(_,"beforeFooter",this,s),E=mu(_,"footer",this,s),C=mu(_,"afterFooter",this,s);let r=[];return r=rp(r,Pm(v)),r=rp(r,Pm(E)),r=rp(r,Pm(C)),r}_createItems(s){const h=this._active,_=this.chart.data,v=[],E=[],C=[];let r=[],z,N;for(z=0,N=h.length;z<N;++z)r.push($5(this.chart,h[z]));return s.filter&&(r=r.filter((H,K,ne)=>s.filter(H,K,ne,_))),s.itemSort&&(r=r.sort((H,K)=>s.itemSort(H,K,_))),Wa(r,H=>{const K=rO(s.callbacks,H);v.push(mu(K,"labelColor",this,H)),E.push(mu(K,"labelPointStyle",this,H)),C.push(mu(K,"labelTextColor",this,H))}),this.labelColors=v,this.labelPointStyles=E,this.labelTextColors=C,this.dataPoints=r,r}update(s,h){const _=this.options.setContext(this.getContext()),v=this._active;let E,C=[];if(!v.length)this.opacity!==0&&(E={opacity:0});else{const r=rT[_.position].call(this,v,this._eventPosition);C=this._createItems(_),this.title=this.getTitle(C,_),this.beforeBody=this.getBeforeBody(C,_),this.body=this.getBody(C,_),this.afterBody=this.getAfterBody(C,_),this.footer=this.getFooter(C,_);const z=this._size=eO(this,_),N=Object.assign({},r,z),H=tO(this.chart,_,N),K=iO(_,N,H,this.chart);this.xAlign=H.xAlign,this.yAlign=H.yAlign,E={opacity:1,x:K.x,y:K.y,width:z.width,height:z.height,caretX:r.x,caretY:r.y}}this._tooltipItems=C,this.$context=void 0,E&&this._resolveAnimations().update(this,E),s&&_.external&&_.external.call(this,{chart:this.chart,tooltip:this,replay:h})}drawCaret(s,h,_,v){const E=this.getCaretPosition(s,_,v);h.lineTo(E.x1,E.y1),h.lineTo(E.x2,E.y2),h.lineTo(E.x3,E.y3)}getCaretPosition(s,h,_){const{xAlign:v,yAlign:E}=this,{caretSize:C,cornerRadius:r}=_,{topLeft:z,topRight:N,bottomLeft:H,bottomRight:K}=xb(r),{x:ne,y:ue}=s,{width:pe,height:xe}=h;let be,je,Be,He,Xe,it;return E==="center"?(Xe=ue+xe/2,v==="left"?(be=ne,je=be-C,He=Xe+C,it=Xe-C):(be=ne+pe,je=be+C,He=Xe-C,it=Xe+C),Be=be):(v==="left"?je=ne+Math.max(z,H)+C:v==="right"?je=ne+pe-Math.max(N,K)-C:je=this.caretX,E==="top"?(He=ue,Xe=He-C,be=je-C,Be=je+C):(He=ue+xe,Xe=He+C,be=je+C,Be=je-C),it=He),{x1:be,x2:je,x3:Be,y1:He,y2:Xe,y3:it}}drawTitle(s,h,_){const v=this.title,E=v.length;let C,r,z;if(E){const N=bb(_.rtl,this.x,this.width);for(s.x=rC(this,_.titleAlign,_),h.textAlign=N.textAlign(_.titleAlign),h.textBaseline="middle",C=Ac(_.titleFont),r=_.titleSpacing,h.fillStyle=_.titleColor,h.font=C.string,z=0;z<E;++z)h.fillText(v[z],N.x(s.x),s.y+C.lineHeight/2),s.y+=C.lineHeight+r,z+1===E&&(s.y+=_.titleMarginBottom-r)}}_drawColorBox(s,h,_,v,E){const C=this.labelColors[_],r=this.labelPointStyles[_],{boxHeight:z,boxWidth:N}=E,H=Ac(E.bodyFont),K=rC(this,"left",E),ne=v.x(K),ue=z<H.lineHeight?(H.lineHeight-z)/2:0,pe=h.y+ue;if(E.usePointStyle){const xe={radius:Math.min(N,z)/2,pointStyle:r.pointStyle,rotation:r.rotation,borderWidth:1},be=v.leftForLtr(ne,N)+N/2,je=pe+z/2;s.strokeStyle=E.multiKeyBackground,s.fillStyle=E.multiKeyBackground,bI(s,xe,be,je),s.strokeStyle=C.borderColor,s.fillStyle=C.backgroundColor,bI(s,xe,be,je)}else{s.lineWidth=Ca(C.borderWidth)?Math.max(...Object.values(C.borderWidth)):C.borderWidth||1,s.strokeStyle=C.borderColor,s.setLineDash(C.borderDash||[]),s.lineDashOffset=C.borderDashOffset||0;const xe=v.leftForLtr(ne,N),be=v.leftForLtr(v.xPlus(ne,1),N-2),je=xb(C.borderRadius);Object.values(je).some(Be=>Be!==0)?(s.beginPath(),s.fillStyle=E.multiKeyBackground,MC(s,{x:xe,y:pe,w:N,h:z,radius:je}),s.fill(),s.stroke(),s.fillStyle=C.backgroundColor,s.beginPath(),MC(s,{x:be,y:pe+1,w:N-2,h:z-2,radius:je}),s.fill()):(s.fillStyle=E.multiKeyBackground,s.fillRect(xe,pe,N,z),s.strokeRect(xe,pe,N,z),s.fillStyle=C.backgroundColor,s.fillRect(be,pe+1,N-2,z-2))}s.fillStyle=this.labelTextColors[_]}drawBody(s,h,_){const{body:v}=this,{bodySpacing:E,bodyAlign:C,displayColors:r,boxHeight:z,boxWidth:N,boxPadding:H}=_,K=Ac(_.bodyFont);let ne=K.lineHeight,ue=0;const pe=bb(_.rtl,this.x,this.width),xe=function(oi){h.fillText(oi,pe.x(s.x+ue),s.y+ne/2),s.y+=ne+E},be=pe.textAlign(C);let je,Be,He,Xe,it,kt,Nt;for(h.textAlign=C,h.textBaseline="middle",h.font=K.string,s.x=rC(this,be,_),h.fillStyle=_.bodyColor,Wa(this.beforeBody,xe),ue=r&&be!=="right"?C==="center"?N/2+H:N+2+H:0,Xe=0,kt=v.length;Xe<kt;++Xe){for(je=v[Xe],Be=this.labelTextColors[Xe],h.fillStyle=Be,Wa(je.before,xe),He=je.lines,r&&He.length&&(this._drawColorBox(h,s,Xe,pe,_),ne=Math.max(K.lineHeight,z)),it=0,Nt=He.length;it<Nt;++it)xe(He[it]),ne=K.lineHeight;Wa(je.after,xe)}ue=0,ne=K.lineHeight,Wa(this.afterBody,xe),s.y-=E}drawFooter(s,h,_){const v=this.footer,E=v.length;let C,r;if(E){const z=bb(_.rtl,this.x,this.width);for(s.x=rC(this,_.footerAlign,_),s.y+=_.footerMarginTop,h.textAlign=z.textAlign(_.footerAlign),h.textBaseline="middle",C=Ac(_.footerFont),h.fillStyle=_.footerColor,h.font=C.string,r=0;r<E;++r)h.fillText(v[r],z.x(s.x),s.y+C.lineHeight/2),s.y+=C.lineHeight+_.footerSpacing}}drawBackground(s,h,_,v){const{xAlign:E,yAlign:C}=this,{x:r,y:z}=s,{width:N,height:H}=_,{topLeft:K,topRight:ne,bottomLeft:ue,bottomRight:pe}=xb(v.cornerRadius);h.fillStyle=v.backgroundColor,h.strokeStyle=v.borderColor,h.lineWidth=v.borderWidth,h.beginPath(),h.moveTo(r+K,z),C==="top"&&this.drawCaret(s,h,_,v),h.lineTo(r+N-ne,z),h.quadraticCurveTo(r+N,z,r+N,z+ne),C==="center"&&E==="right"&&this.drawCaret(s,h,_,v),h.lineTo(r+N,z+H-pe),h.quadraticCurveTo(r+N,z+H,r+N-pe,z+H),C==="bottom"&&this.drawCaret(s,h,_,v),h.lineTo(r+ue,z+H),h.quadraticCurveTo(r,z+H,r,z+H-ue),C==="center"&&E==="left"&&this.drawCaret(s,h,_,v),h.lineTo(r,z+K),h.quadraticCurveTo(r,z,r+K,z),h.closePath(),h.fill(),v.borderWidth>0&&h.stroke()}_updateAnimationTarget(s){const h=this.chart,_=this.$animations,v=_&&_.x,E=_&&_.y;if(v||E){const C=rT[s.position].call(this,this._active,this._eventPosition);if(!C)return;const r=this._size=eO(this,s),z=Object.assign({},C,this._size),N=tO(h,s,z),H=iO(s,z,N,h);(v._to!==H.x||E._to!==H.y)&&(this.xAlign=N.xAlign,this.yAlign=N.yAlign,this.width=r.width,this.height=r.height,this.caretX=C.x,this.caretY=C.y,this._resolveAnimations().update(this,H))}}_willRender(){return!!this.opacity}draw(s){const h=this.options.setContext(this.getContext());let _=this.opacity;if(!_)return;this._updateAnimationTarget(h);const v={width:this.width,height:this.height},E={x:this.x,y:this.y};_=Math.abs(_)<.001?0:_;const C=od(h.padding),r=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;h.enabled&&r&&(s.save(),s.globalAlpha=_,this.drawBackground(E,s,v,h),Hk(s,h.textDirection),E.y+=C.top,this.drawTitle(E,s,h),this.drawBody(E,s,h),this.drawFooter(E,s,h),$k(s,h.textDirection),s.restore())}getActiveElements(){return this._active||[]}setActiveElements(s,h){const _=this._active,v=s.map(({datasetIndex:r,index:z})=>{const N=this.chart.getDatasetMeta(r);if(!N)throw new Error("Cannot find a dataset at index "+r);return{datasetIndex:r,element:N.data[z],index:z}}),E=!AC(_,v),C=this._positionChanged(v,h);(E||C)&&(this._active=v,this._eventPosition=h,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(s,h,_=!0){if(h&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const v=this.options,E=this._active||[],C=this._getActiveElements(s,E,h,_),r=this._positionChanged(C,s),z=h||!AC(C,E)||r;return z&&(this._active=C,(v.enabled||v.external)&&(this._eventPosition={x:s.x,y:s.y},this.update(!0,h))),z}_getActiveElements(s,h,_,v){const E=this.options;if(s.type==="mouseout")return[];if(!v)return h.filter(r=>this.chart.data.datasets[r.datasetIndex]&&this.chart.getDatasetMeta(r.datasetIndex).controller.getParsed(r.index)!==void 0);const C=this.chart.getElementsAtEventForMode(s,E.mode,E,_);return E.reverse&&C.reverse(),C}_positionChanged(s,h){const{caretX:_,caretY:v,options:E}=this,C=rT[E.position].call(this,s,h);return C!==!1&&(_!==C.x||v!==C.y)}}kn(EI,"positioners",rT);var J5={id:"tooltip",_element:EI,positioners:rT,afterInit(d,s,h){h&&(d.tooltip=new EI({chart:d,options:h}))},beforeUpdate(d,s,h){d.tooltip&&d.tooltip.initialize(h)},reset(d,s,h){d.tooltip&&d.tooltip.initialize(h)},afterDraw(d){const s=d.tooltip;if(s&&s._willRender()){const h={tooltip:s};if(d.notifyPlugins("beforeTooltipDraw",{...h,cancelable:!0})===!1)return;s.draw(d.ctx),d.notifyPlugins("afterTooltipDraw",h)}},afterEvent(d,s){if(d.tooltip){const h=s.replay;d.tooltip.handleEvent(s.event,h,s.inChartArea)&&(s.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(d,s)=>s.bodyFont.size,boxWidth:(d,s)=>s.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:c2},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:d=>d!=="filter"&&d!=="itemSort"&&d!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const Q5=(d,s,h,_)=>(typeof s=="string"?(h=d.push(s)-1,_.unshift({index:h,label:s})):isNaN(s)&&(h=null),h);function e4(d,s,h,_){const v=d.indexOf(s);if(v===-1)return Q5(d,s,h,_);const E=d.lastIndexOf(s);return v!==E?h:v}const t4=(d,s)=>d===null?null:ec(Math.round(d),0,s);function aO(d){const s=this.getLabels();return d>=0&&d<s.length?s[d]:d}class CI extends Pb{constructor(s){super(s),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(s){const h=this._addedLabels;if(h.length){const _=this.getLabels();for(const{index:v,label:E}of h)_[v]===E&&_.splice(v,1);this._addedLabels=[]}super.init(s)}parse(s,h){if(ga(s))return null;const _=this.getLabels();return h=isFinite(h)&&_[h]===s?h:e4(_,s,qr(h,s),this._addedLabels),t4(h,_.length-1)}determineDataLimits(){const{minDefined:s,maxDefined:h}=this.getUserBounds();let{min:_,max:v}=this.getMinMax(!0);this.options.bounds==="ticks"&&(s||(_=0),h||(v=this.getLabels().length-1)),this.min=_,this.max=v}buildTicks(){const s=this.min,h=this.max,_=this.options.offset,v=[];let E=this.getLabels();E=s===0&&h===E.length-1?E:E.slice(s,h+1),this._valueRange=Math.max(E.length-(_?0:1),1),this._startValue=this.min-(_?.5:0);for(let C=s;C<=h;C++)v.push({value:C});return v}getLabelForValue(s){return aO.call(this,s)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(s){return typeof s!="number"&&(s=this.parse(s)),s===null?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getPixelForTick(s){const h=this.ticks;return s<0||s>h.length-1?null:this.getPixelForValue(h[s].value)}getValueForPixel(s){return Math.round(this._startValue+this.getDecimalForPixel(s)*this._valueRange)}getBasePixel(){return this.bottom}}kn(CI,"id","category"),kn(CI,"defaults",{ticks:{callback:aO}});function i4(d,s){const h=[],{bounds:v,step:E,min:C,max:r,precision:z,count:N,maxTicks:H,maxDigits:K,includeBounds:ne}=d,ue=E||1,pe=H-1,{min:xe,max:be}=s,je=!ga(C),Be=!ga(r),He=!ga(N),Xe=(be-xe)/(K+1);let it=sP((be-xe)/pe/ue)*ue,kt,Nt,oi,yi;if(it<1e-14&&!je&&!Be)return[{value:xe},{value:be}];yi=Math.ceil(be/it)-Math.floor(xe/it),yi>pe&&(it=sP(yi*it/pe/ue)*ue),ga(z)||(kt=Math.pow(10,z),it=Math.ceil(it*kt)/kt),v==="ticks"?(Nt=Math.floor(xe/it)*it,oi=Math.ceil(be/it)*it):(Nt=xe,oi=be),je&&Be&&E&&E3((r-C)/E,it/1e3)?(yi=Math.round(Math.min((r-C)/it,H)),it=(r-C)/yi,Nt=C,oi=r):He?(Nt=je?C:Nt,oi=Be?r:oi,yi=N-1,it=(oi-Nt)/yi):(yi=(oi-Nt)/it,lT(yi,Math.round(yi),it/1e3)?yi=Math.round(yi):yi=Math.ceil(yi));const Ui=Math.max(lP(it),lP(Nt));kt=Math.pow(10,ga(z)?Ui:z),Nt=Math.round(Nt*kt)/kt,oi=Math.round(oi*kt)/kt;let hi=0;for(je&&(ne&&Nt!==C?(h.push({value:C}),Nt<C&&hi++,lT(Math.round((Nt+hi*it)*kt)/kt,C,oO(C,Xe,d))&&hi++):Nt<C&&hi++);hi<yi;++hi){const Ti=Math.round((Nt+hi*it)*kt)/kt;if(Be&&Ti>r)break;h.push({value:Ti})}return Be&&ne&&oi!==r?h.length&&lT(h[h.length-1].value,r,oO(r,Xe,d))?h[h.length-1].value=r:h.push({value:r}):(!Be||oi===r)&&h.push({value:oi}),h}function oO(d,s,{horizontal:h,minRotation:_}){const v=$v(_),E=(h?Math.sin(v):Math.cos(v))||.001,C=.75*s*(""+d).length;return Math.min(s/E,C)}class n4 extends Pb{constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(s,h){return ga(s)||(typeof s=="number"||s instanceof Number)&&!isFinite(+s)?null:+s}handleTickRangeOptions(){const{beginAtZero:s}=this.options,{minDefined:h,maxDefined:_}=this.getUserBounds();let{min:v,max:E}=this;const C=z=>v=h?v:z,r=z=>E=_?E:z;if(s){const z=lp(v),N=lp(E);z<0&&N<0?r(0):z>0&&N>0&&C(0)}if(v===E){let z=E===0?1:Math.abs(E*.05);r(E+z),s||C(v-z)}this.min=v,this.max=E}getTickLimit(){const s=this.options.ticks;let{maxTicksLimit:h,stepSize:_}=s,v;return _?(v=Math.ceil(this.max/_)-Math.floor(this.min/_)+1,v>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${_} would result generating up to ${v} ticks. Limiting to 1000.`),v=1e3)):(v=this.computeTickLimit(),h=h||11),h&&(v=Math.min(h,v)),v}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const s=this.options,h=s.ticks;let _=this.getTickLimit();_=Math.max(2,_);const v={maxTicks:_,bounds:s.bounds,min:s.min,max:s.max,precision:h.precision,step:h.stepSize,count:h.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:h.minRotation||0,includeBounds:h.includeBounds!==!1},E=this._range||this,C=i4(v,E);return s.bounds==="ticks"&&C3(C,this,"value"),s.reverse?(C.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),C}configure(){const s=this.ticks;let h=this.min,_=this.max;if(super.configure(),this.options.offset&&s.length){const v=(_-h)/Math.max(s.length-1,1)/2;h-=v,_+=v}this._startValue=h,this._endValue=_,this._valueRange=_-h}getLabelForValue(s){return Lk(s,this.chart.options.locale,this.options.ticks.format)}}class AI extends n4{determineDataLimits(){const{min:s,max:h}=this.getMinMax(!0);this.min=ad(s)?s:0,this.max=ad(h)?h:1,this.handleTickRangeOptions()}computeTickLimit(){const s=this.isHorizontal(),h=s?this.width:this.height,_=$v(this.options.ticks.minRotation),v=(s?Math.sin(_):Math.cos(_))||.001,E=this._resolveTickFontOptions(0);return Math.ceil(h/Math.min(40,E.lineHeight/v))}getPixelForValue(s){return s===null?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getValueForPixel(s){return this._startValue+this.getDecimalForPixel(s)*this._valueRange}}kn(AI,"id","linear"),kn(AI,"defaults",{ticks:{callback:zk.formatters.numeric}});const qC={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},_u=Object.keys(qC);function sO(d,s){return d-s}function lO(d,s){if(ga(s))return null;const h=d._adapter,{parser:_,round:v,isoWeekday:E}=d._parseOpts;let C=s;return typeof _=="function"&&(C=_(C)),ad(C)||(C=typeof _=="string"?h.parse(C,_):h.parse(C)),C===null?null:(v&&(C=v==="week"&&(wT(E)||E===!0)?h.startOf(C,"isoWeek",E):h.startOf(C,v)),+C)}function cO(d,s,h,_){const v=_u.length;for(let E=_u.indexOf(d);E<v-1;++E){const C=qC[_u[E]],r=C.steps?C.steps:Number.MAX_SAFE_INTEGER;if(C.common&&Math.ceil((h-s)/(r*C.size))<=_)return _u[E]}return _u[v-1]}function r4(d,s,h,_,v){for(let E=_u.length-1;E>=_u.indexOf(h);E--){const C=_u[E];if(qC[C].common&&d._adapter.diff(v,_,C)>=s-1)return C}return _u[h?_u.indexOf(h):0]}function a4(d){for(let s=_u.indexOf(d)+1,h=_u.length;s<h;++s)if(qC[_u[s]].common)return _u[s]}function uO(d,s,h){if(!h)d[s]=!0;else if(h.length){const{lo:_,hi:v}=eD(h,s),E=h[_]>=s?h[_]:h[v];d[E]=!0}}function o4(d,s,h,_){const v=d._adapter,E=+v.startOf(s[0].value,_),C=s[s.length-1].value;let r,z;for(r=E;r<=C;r=+v.add(r,1,_))z=h[r],z>=0&&(s[z].major=!0);return s}function hO(d,s,h){const _=[],v={},E=s.length;let C,r;for(C=0;C<E;++C)r=s[C],v[r]=C,_.push({value:r,major:!1});return E===0||!h?_:o4(d,_,v,h)}class LC extends Pb{constructor(s){super(s),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(s,h={}){const _=s.time||(s.time={}),v=this._adapter=new uV._date(s.adapters.date);v.init(h),sT(_.displayFormats,v.formats()),this._parseOpts={parser:_.parser,round:_.round,isoWeekday:_.isoWeekday},super.init(s),this._normalized=h.normalized}parse(s,h){return s===void 0?null:lO(this,s)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const s=this.options,h=this._adapter,_=s.time.unit||"day";let{min:v,max:E,minDefined:C,maxDefined:r}=this.getUserBounds();function z(N){!C&&!isNaN(N.min)&&(v=Math.min(v,N.min)),!r&&!isNaN(N.max)&&(E=Math.max(E,N.max))}(!C||!r)&&(z(this._getLabelBounds()),(s.bounds!=="ticks"||s.ticks.source!=="labels")&&z(this.getMinMax(!1))),v=ad(v)&&!isNaN(v)?v:+h.startOf(Date.now(),_),E=ad(E)&&!isNaN(E)?E:+h.endOf(Date.now(),_)+1,this.min=Math.min(v,E-1),this.max=Math.max(v+1,E)}_getLabelBounds(){const s=this.getLabelTimestamps();let h=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY;return s.length&&(h=s[0],_=s[s.length-1]),{min:h,max:_}}buildTicks(){const s=this.options,h=s.time,_=s.ticks,v=_.source==="labels"?this.getLabelTimestamps():this._generate();s.bounds==="ticks"&&v.length&&(this.min=this._userMin||v[0],this.max=this._userMax||v[v.length-1]);const E=this.min,C=this.max,r=M3(v,E,C);return this._unit=h.unit||(_.autoSkip?cO(h.minUnit,this.min,this.max,this._getLabelCapacity(E)):r4(this,r.length,h.minUnit,this.min,this.max)),this._majorUnit=!_.major.enabled||this._unit==="year"?void 0:a4(this._unit),this.initOffsets(v),s.reverse&&r.reverse(),hO(this,r,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(s=>+s.value))}initOffsets(s=[]){let h=0,_=0,v,E;this.options.offset&&s.length&&(v=this.getDecimalForValue(s[0]),s.length===1?h=1-v:h=(this.getDecimalForValue(s[1])-v)/2,E=this.getDecimalForValue(s[s.length-1]),s.length===1?_=E:_=(E-this.getDecimalForValue(s[s.length-2]))/2);const C=s.length<3?.5:.25;h=ec(h,0,C),_=ec(_,0,C),this._offsets={start:h,end:_,factor:1/(h+1+_)}}_generate(){const s=this._adapter,h=this.min,_=this.max,v=this.options,E=v.time,C=E.unit||cO(E.minUnit,h,_,this._getLabelCapacity(h)),r=qr(v.ticks.stepSize,1),z=C==="week"?E.isoWeekday:!1,N=wT(z)||z===!0,H={};let K=h,ne,ue;if(N&&(K=+s.startOf(K,"isoWeek",z)),K=+s.startOf(K,N?"day":C),s.diff(_,h,C)>1e5*r)throw new Error(h+" and "+_+" are too far apart with stepSize of "+r+" "+C);const pe=v.ticks.source==="data"&&this.getDataTimestamps();for(ne=K,ue=0;ne<_;ne=+s.add(ne,r,C),ue++)uO(H,ne,pe);return(ne===_||v.bounds==="ticks"||ue===1)&&uO(H,ne,pe),Object.keys(H).sort(sO).map(xe=>+xe)}getLabelForValue(s){const h=this._adapter,_=this.options.time;return _.tooltipFormat?h.format(s,_.tooltipFormat):h.format(s,_.displayFormats.datetime)}format(s,h){const v=this.options.time.displayFormats,E=this._unit,C=h||v[E];return this._adapter.format(s,C)}_tickFormatFunction(s,h,_,v){const E=this.options,C=E.ticks.callback;if(C)return po(C,[s,h,_],this);const r=E.time.displayFormats,z=this._unit,N=this._majorUnit,H=z&&r[z],K=N&&r[N],ne=_[h],ue=N&&K&&ne&&ne.major;return this._adapter.format(s,v||(ue?K:H))}generateTickLabels(s){let h,_,v;for(h=0,_=s.length;h<_;++h)v=s[h],v.label=this._tickFormatFunction(v.value,h,s)}getDecimalForValue(s){return s===null?NaN:(s-this.min)/(this.max-this.min)}getPixelForValue(s){const h=this._offsets,_=this.getDecimalForValue(s);return this.getPixelForDecimal((h.start+_)*h.factor)}getValueForPixel(s){const h=this._offsets,_=this.getDecimalForPixel(s)/h.factor-h.end;return this.min+_*(this.max-this.min)}_getLabelSize(s){const h=this.options.ticks,_=this.ctx.measureText(s).width,v=$v(this.isHorizontal()?h.maxRotation:h.minRotation),E=Math.cos(v),C=Math.sin(v),r=this._resolveTickFontOptions(0).size;return{w:_*E+r*C,h:_*C+r*E}}_getLabelCapacity(s){const h=this.options.time,_=h.displayFormats,v=_[h.unit]||_.millisecond,E=this._tickFormatFunction(s,0,hO(this,[s],this._majorUnit),v),C=this._getLabelSize(E),r=Math.floor(this.isHorizontal()?this.width/C.w:this.height/C.h)-1;return r>0?r:1}getDataTimestamps(){let s=this._cache.data||[],h,_;if(s.length)return s;const v=this.getMatchingVisibleMetas();if(this._normalized&&v.length)return this._cache.data=v[0].controller.getAllParsedValues(this);for(h=0,_=v.length;h<_;++h)s=s.concat(v[h].controller.getAllParsedValues(this));return this._cache.data=this.normalize(s)}getLabelTimestamps(){const s=this._cache.labels||[];let h,_;if(s.length)return s;const v=this.getLabels();for(h=0,_=v.length;h<_;++h)s.push(lO(this,v[h]));return this._cache.labels=this._normalized?s:this.normalize(s)}normalize(s){return Mk(s.sort(sO))}}kn(LC,"id","time"),kn(LC,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function aC(d,s,h){let _=0,v=d.length-1,E,C,r,z;h?(s>=d[_].pos&&s<=d[v].pos&&({lo:_,hi:v}=Wv(d,"pos",s)),{pos:E,time:r}=d[_],{pos:C,time:z}=d[v]):(s>=d[_].time&&s<=d[v].time&&({lo:_,hi:v}=Wv(d,"time",s)),{time:E,pos:r}=d[_],{time:C,pos:z}=d[v]);const N=C-E;return N?r+(z-r)*(s-E)/N:r}class dO extends LC{constructor(s){super(s),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const s=this._getTimestampsForTable(),h=this._table=this.buildLookupTable(s);this._minPos=aC(h,this.min),this._tableRange=aC(h,this.max)-this._minPos,super.initOffsets(s)}buildLookupTable(s){const{min:h,max:_}=this,v=[],E=[];let C,r,z,N,H;for(C=0,r=s.length;C<r;++C)N=s[C],N>=h&&N<=_&&v.push(N);if(v.length<2)return[{time:h,pos:0},{time:_,pos:1}];for(C=0,r=v.length;C<r;++C)H=v[C+1],z=v[C-1],N=v[C],Math.round((H+z)/2)!==N&&E.push({time:N,pos:C/(r-1)});return E}_generate(){const s=this.min,h=this.max;let _=super.getDataTimestamps();return(!_.includes(s)||!_.length)&&_.splice(0,0,s),(!_.includes(h)||_.length===1)&&_.push(h),_.sort((v,E)=>v-E)}_getTimestampsForTable(){let s=this._cache.all||[];if(s.length)return s;const h=this.getDataTimestamps(),_=this.getLabelTimestamps();return h.length&&_.length?s=this.normalize(h.concat(_)):s=h.length?h:_,s=this._cache.all=s,s}getDecimalForValue(s){return(aC(this._table,s)-this._minPos)/this._tableRange}getValueForPixel(s){const h=this._offsets,_=this.getDecimalForPixel(s)/h.factor-h.end;return aC(this._table,_*this._tableRange+this._minPos,!0)}}kn(dO,"id","timeseries"),kn(dO,"defaults",LC.defaults);/*!
 * chartjs-plugin-datalabels v2.2.0
 * https://chartjs-plugin-datalabels.netlify.app
 * (c) 2017-2022 chartjs-plugin-datalabels contributors
 * Released under the MIT license
 */var fO=function(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var d=window.screen;if(d)return(d.deviceXDPI||1)/(d.logicalXDPI||1)}return 1}(),fT={toTextLines:function(d){var s=[],h;for(d=[].concat(d);d.length;)h=d.pop(),typeof h=="string"?s.unshift.apply(s,h.split(`
`)):Array.isArray(h)?d.push.apply(d,h):ga(d)||s.unshift(""+h);return s},textSize:function(d,s,h){var _=[].concat(s),v=_.length,E=d.font,C=0,r;for(d.font=h.string,r=0;r<v;++r)C=Math.max(d.measureText(_[r]).width,C);return d.font=E,{height:v*h.lineHeight,width:C}},bound:function(d,s,h){return Math.max(d,Math.min(s,h))},arrayDiff:function(d,s){var h=d.slice(),_=[],v,E,C,r;for(v=0,C=s.length;v<C;++v)r=s[v],E=h.indexOf(r),E===-1?_.push([r,1]):h.splice(E,1);for(v=0,C=h.length;v<C;++v)_.push([h[v],-1]);return _},rasterize:function(d){return Math.round(d*fO)/fO}};function aI(d,s){var h=s.x,_=s.y;if(h===null)return{x:0,y:-1};if(_===null)return{x:1,y:0};var v=d.x-h,E=d.y-_,C=Math.sqrt(v*v+E*E);return{x:C?v/C:0,y:C?E/C:-1}}function s4(d,s,h,_,v){switch(v){case"center":h=_=0;break;case"bottom":h=0,_=1;break;case"right":h=1,_=0;break;case"left":h=-1,_=0;break;case"top":h=0,_=-1;break;case"start":h=-h,_=-_;break;case"end":break;default:v*=Math.PI/180,h=Math.cos(v),_=Math.sin(v);break}return{x:d,y:s,vx:h,vy:_}}var l4=0,u2=1,h2=2,d2=4,f2=8;function oC(d,s,h){var _=l4;return d<h.left?_|=u2:d>h.right&&(_|=h2),s<h.top?_|=f2:s>h.bottom&&(_|=d2),_}function c4(d,s){for(var h=d.x0,_=d.y0,v=d.x1,E=d.y1,C=oC(h,_,s),r=oC(v,E,s),z,N,H;!(!(C|r)||C&r);)z=C||r,z&f2?(N=h+(v-h)*(s.top-_)/(E-_),H=s.top):z&d2?(N=h+(v-h)*(s.bottom-_)/(E-_),H=s.bottom):z&h2?(H=_+(E-_)*(s.right-h)/(v-h),N=s.right):z&u2&&(H=_+(E-_)*(s.left-h)/(v-h),N=s.left),z===C?(h=N,_=H,C=oC(h,_,s)):(v=N,E=H,r=oC(v,E,s));return{x0:h,x1:v,y0:_,y1:E}}function sC(d,s){var h=s.anchor,_=d,v,E;return s.clamp&&(_=c4(_,s.area)),h==="start"?(v=_.x0,E=_.y0):h==="end"?(v=_.x1,E=_.y1):(v=(_.x0+_.x1)/2,E=(_.y0+_.y1)/2),s4(v,E,d.vx,d.vy,s.align)}var lC={arc:function(d,s){var h=(d.startAngle+d.endAngle)/2,_=Math.cos(h),v=Math.sin(h),E=d.innerRadius,C=d.outerRadius;return sC({x0:d.x+_*E,y0:d.y+v*E,x1:d.x+_*C,y1:d.y+v*C,vx:_,vy:v},s)},point:function(d,s){var h=aI(d,s.origin),_=h.x*d.options.radius,v=h.y*d.options.radius;return sC({x0:d.x-_,y0:d.y-v,x1:d.x+_,y1:d.y+v,vx:h.x,vy:h.y},s)},bar:function(d,s){var h=aI(d,s.origin),_=d.x,v=d.y,E=0,C=0;return d.horizontal?(_=Math.min(d.x,d.base),E=Math.abs(d.base-d.x)):(v=Math.min(d.y,d.base),C=Math.abs(d.base-d.y)),sC({x0:_,y0:v+C,x1:_+E,y1:v,vx:h.x,vy:h.y},s)},fallback:function(d,s){var h=aI(d,s.origin);return sC({x0:d.x,y0:d.y,x1:d.x+(d.width||0),y1:d.y+(d.height||0),vx:h.x,vy:h.y},s)}},km=fT.rasterize;function u4(d){var s=d.borderWidth||0,h=d.padding,_=d.size.height,v=d.size.width,E=-v/2,C=-_/2;return{frame:{x:E-h.left-s,y:C-h.top-s,w:v+h.width+s*2,h:_+h.height+s*2},text:{x:E,y:C,w:v,h:_}}}function h4(d,s){var h=s.chart.getDatasetMeta(s.datasetIndex).vScale;if(!h)return null;if(h.xCenter!==void 0&&h.yCenter!==void 0)return{x:h.xCenter,y:h.yCenter};var _=h.getBasePixel();return d.horizontal?{x:_,y:null}:{x:null,y:_}}function d4(d){return d instanceof iT?lC.arc:d instanceof hT?lC.point:d instanceof dT?lC.bar:lC.fallback}function f4(d,s,h,_,v,E){var C=Math.PI/2;if(E){var r=Math.min(E,v/2,_/2),z=s+r,N=h+r,H=s+_-r,K=h+v-r;d.moveTo(s,N),z<H&&N<K?(d.arc(z,N,r,-Math.PI,-C),d.arc(H,N,r,-C,0),d.arc(H,K,r,0,C),d.arc(z,K,r,C,Math.PI)):z<H?(d.moveTo(z,h),d.arc(H,N,r,-C,C),d.arc(z,N,r,C,Math.PI+C)):N<K?(d.arc(z,N,r,-Math.PI,0),d.arc(z,K,r,0,Math.PI)):d.arc(z,N,r,-Math.PI,Math.PI),d.closePath(),d.moveTo(s,h)}else d.rect(s,h,_,v)}function p4(d,s,h){var _=h.backgroundColor,v=h.borderColor,E=h.borderWidth;!_&&(!v||!E)||(d.beginPath(),f4(d,km(s.x)+E/2,km(s.y)+E/2,km(s.w)-E,km(s.h)-E,h.borderRadius),d.closePath(),_&&(d.fillStyle=_,d.fill()),v&&E&&(d.strokeStyle=v,d.lineWidth=E,d.lineJoin="miter",d.stroke()))}function m4(d,s,h){var _=h.lineHeight,v=d.w,E=d.x,C=d.y+_/2;return s==="center"?E+=v/2:(s==="end"||s==="right")&&(E+=v),{h:_,w:v,x:E,y:C}}function g4(d,s,h){var _=d.shadowBlur,v=h.stroked,E=km(h.x),C=km(h.y),r=km(h.w);v&&d.strokeText(s,E,C,r),h.filled&&(_&&v&&(d.shadowBlur=0),d.fillText(s,E,C,r),_&&v&&(d.shadowBlur=_))}function _4(d,s,h,_){var v=_.textAlign,E=_.color,C=!!E,r=_.font,z=s.length,N=_.textStrokeColor,H=_.textStrokeWidth,K=N&&H,ne;if(!(!z||!C&&!K))for(h=m4(h,v,r),d.font=r.string,d.textAlign=v,d.textBaseline="middle",d.shadowBlur=_.textShadowBlur,d.shadowColor=_.textShadowColor,C&&(d.fillStyle=E),K&&(d.lineJoin="round",d.lineWidth=H,d.strokeStyle=N),ne=0,z=s.length;ne<z;++ne)g4(d,s[ne],{stroked:K,filled:C,w:h.w,x:h.x,y:h.y+h.h*ne})}var p2=function(d,s,h,_){var v=this;v._config=d,v._index=_,v._model=null,v._rects=null,v._ctx=s,v._el=h};cp(p2.prototype,{_modelize:function(d,s,h,_){var v=this,E=v._index,C=Ac(Vo([h.font,{}],_,E)),r=Vo([h.color,rs.color],_,E);return{align:Vo([h.align,"center"],_,E),anchor:Vo([h.anchor,"center"],_,E),area:_.chart.chartArea,backgroundColor:Vo([h.backgroundColor,null],_,E),borderColor:Vo([h.borderColor,null],_,E),borderRadius:Vo([h.borderRadius,0],_,E),borderWidth:Vo([h.borderWidth,0],_,E),clamp:Vo([h.clamp,!1],_,E),clip:Vo([h.clip,!1],_,E),color:r,display:d,font:C,lines:s,offset:Vo([h.offset,4],_,E),opacity:Vo([h.opacity,1],_,E),origin:h4(v._el,_),padding:od(Vo([h.padding,4],_,E)),positioner:d4(v._el),rotation:Vo([h.rotation,0],_,E)*(Math.PI/180),size:fT.textSize(v._ctx,s,C),textAlign:Vo([h.textAlign,"start"],_,E),textShadowBlur:Vo([h.textShadowBlur,0],_,E),textShadowColor:Vo([h.textShadowColor,r],_,E),textStrokeColor:Vo([h.textStrokeColor,r],_,E),textStrokeWidth:Vo([h.textStrokeWidth,0],_,E)}},update:function(d){var s=this,h=null,_=null,v=s._index,E=s._config,C,r,z,N=Vo([E.display,!0],d,v);N&&(C=d.dataset.data[v],r=qr(po(E.formatter,[C,d]),C),z=ga(r)?[]:fT.toTextLines(r),z.length&&(h=s._modelize(N,z,E,d),_=u4(h))),s._model=h,s._rects=_},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(d,s){var h=this,_=d.ctx,v=h._model,E=h._rects,C;this.visible()&&(_.save(),v.clip&&(C=v.area,_.beginPath(),_.rect(C.left,C.top,C.right-C.left,C.bottom-C.top),_.clip()),_.globalAlpha=fT.bound(0,v.opacity,1),_.translate(km(s.x),km(s.y)),_.rotate(v.rotation),p4(_,E.frame,v),_4(_,v.lines,E.text,v),_.restore())}});var y4=Number.MIN_SAFE_INTEGER||-9007199254740991,v4=Number.MAX_SAFE_INTEGER||9007199254740991;function J1(d,s,h){var _=Math.cos(h),v=Math.sin(h),E=s.x,C=s.y;return{x:E+_*(d.x-E)-v*(d.y-C),y:C+v*(d.x-E)+_*(d.y-C)}}function pO(d,s){var h=v4,_=y4,v=s.origin,E,C,r,z,N;for(E=0;E<d.length;++E)C=d[E],r=C.x-v.x,z=C.y-v.y,N=s.vx*r+s.vy*z,h=Math.min(h,N),_=Math.max(_,N);return{min:h,max:_}}function cC(d,s){var h=s.x-d.x,_=s.y-d.y,v=Math.sqrt(h*h+_*_);return{vx:(s.x-d.x)/v,vy:(s.y-d.y)/v,origin:d,ln:v}}var m2=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};cp(m2.prototype,{center:function(){var d=this._rect;return{x:d.x+d.w/2,y:d.y+d.h/2}},update:function(d,s,h){this._rotation=h,this._rect={x:s.x+d.x,y:s.y+d.y,w:s.w,h:s.h}},contains:function(d){var s=this,h=1,_=s._rect;return d=J1(d,s.center(),-s._rotation),!(d.x<_.x-h||d.y<_.y-h||d.x>_.x+_.w+h*2||d.y>_.y+_.h+h*2)},intersects:function(d){var s=this._points(),h=d._points(),_=[cC(s[0],s[1]),cC(s[0],s[3])],v,E,C;for(this._rotation!==d._rotation&&_.push(cC(h[0],h[1]),cC(h[0],h[3])),v=0;v<_.length;++v)if(E=pO(s,_[v]),C=pO(h,_[v]),E.max<C.min||C.max<E.min)return!1;return!0},_points:function(){var d=this,s=d._rect,h=d._rotation,_=d.center();return[J1({x:s.x,y:s.y},_,h),J1({x:s.x+s.w,y:s.y},_,h),J1({x:s.x+s.w,y:s.y+s.h},_,h),J1({x:s.x,y:s.y+s.h},_,h)]}});function g2(d,s,h){var _=s.positioner(d,s),v=_.vx,E=_.vy;if(!v&&!E)return{x:_.x,y:_.y};var C=h.w,r=h.h,z=s.rotation,N=Math.abs(C/2*Math.cos(z))+Math.abs(r/2*Math.sin(z)),H=Math.abs(C/2*Math.sin(z))+Math.abs(r/2*Math.cos(z)),K=1/Math.max(Math.abs(v),Math.abs(E));return N*=v*K,H*=E*K,N+=s.offset*v,H+=s.offset*E,{x:_.x+N,y:_.y+H}}function x4(d,s){var h,_,v,E;for(h=d.length-1;h>=0;--h)for(v=d[h].$layout,_=h-1;_>=0&&v._visible;--_)E=d[_].$layout,E._visible&&v._box.intersects(E._box)&&s(v,E);return d}function b4(d){var s,h,_,v,E,C,r;for(s=0,h=d.length;s<h;++s)_=d[s],v=_.$layout,v._visible&&(r=new Proxy(_._el,{get:(z,N)=>z.getProps([N],!0)[N]}),E=_.geometry(),C=g2(r,_.model(),E),v._box.update(C,E,_.rotation()));return x4(d,function(z,N){var H=z._hidable,K=N._hidable;H&&K||K?N._visible=!1:H&&(z._visible=!1)})}var pT={prepare:function(d){var s=[],h,_,v,E,C;for(h=0,v=d.length;h<v;++h)for(_=0,E=d[h].length;_<E;++_)C=d[h][_],s.push(C),C.$layout={_box:new m2,_hidable:!1,_visible:!0,_set:h,_idx:C._index};return s.sort(function(r,z){var N=r.$layout,H=z.$layout;return N._idx===H._idx?H._set-N._set:H._idx-N._idx}),this.update(s),s},update:function(d){var s=!1,h,_,v,E,C;for(h=0,_=d.length;h<_;++h)v=d[h],E=v.model(),C=v.$layout,C._hidable=E&&E.display==="auto",C._visible=v.visible(),s|=C._hidable;s&&b4(d)},lookup:function(d,s){var h,_;for(h=d.length-1;h>=0;--h)if(_=d[h].$layout,_&&_._visible&&_._box.contains(s))return d[h];return null},draw:function(d,s){var h,_,v,E,C,r;for(h=0,_=s.length;h<_;++h)v=s[h],E=v.$layout,E._visible&&(C=v.geometry(),r=g2(v._el,v.model(),C),E._box.update(r,C,v.rotation()),v.draw(d,r))}},w4=function(d){if(ga(d))return null;var s=d,h,_,v;if(Ca(d))if(!ga(d.label))s=d.label;else if(!ga(d.r))s=d.r;else for(s="",h=Object.keys(d),v=0,_=h.length;v<_;++v)s+=(v!==0?", ":"")+h[v]+": "+d[h[v]];return""+s},T4={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:w4,labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},gu="$datalabels",_2="$default";function S4(d,s){var h=d.datalabels,_={},v=[],E,C;return h===!1?null:(h===!0&&(h={}),s=cp({},[s,h]),E=s.labels||{},C=Object.keys(E),delete s.labels,C.length?C.forEach(function(r){E[r]&&v.push(cp({},[s,E[r],{_key:r}]))}):v.push(s),_=v.reduce(function(r,z){return Wa(z.listeners||{},function(N,H){r[H]=r[H]||{},r[H][z._key||_2]=N}),delete z.listeners,r},{}),{labels:v,listeners:_})}function RI(d,s,h,_){if(s){var v=h.$context,E=h.$groups,C;s[E._set]&&(C=s[E._set][E._key],C&&po(C,[v,_])===!0&&(d[gu]._dirty=!0,h.update(v)))}}function E4(d,s,h,_,v){var E,C;!h&&!_||(h?_?h!==_&&(C=E=!0):C=!0:E=!0,C&&RI(d,s.leave,h,v),E&&RI(d,s.enter,_,v))}function C4(d,s){var h=d[gu],_=h._listeners,v,E;if(!(!_.enter&&!_.leave)){if(s.type==="mousemove")E=pT.lookup(h._labels,s);else if(s.type!=="mouseout")return;v=h._hovered,h._hovered=E,E4(d,_,v,E,s)}}function A4(d,s){var h=d[gu],_=h._listeners.click,v=_&&pT.lookup(h._labels,s);v&&RI(d,_,v,s)}var R4={id:"datalabels",defaults:T4,beforeInit:function(d){d[gu]={_actives:[]}},beforeUpdate:function(d){var s=d[gu];s._listened=!1,s._listeners={},s._datasets=[],s._labels=[]},afterDatasetUpdate:function(d,s,h){var _=s.index,v=d[gu],E=v._datasets[_]=[],C=d.isDatasetVisible(_),r=d.data.datasets[_],z=S4(r,h),N=s.meta.data||[],H=d.ctx,K,ne,ue,pe,xe,be,je,Be;for(H.save(),K=0,ue=N.length;K<ue;++K)if(je=N[K],je[gu]=[],C&&je&&d.getDataVisibility(K)&&!je.skip)for(ne=0,pe=z.labels.length;ne<pe;++ne)xe=z.labels[ne],be=xe._key,Be=new p2(xe,H,je,K),Be.$groups={_set:_,_key:be||_2},Be.$context={active:!1,chart:d,dataIndex:K,dataset:r,datasetIndex:_},Be.update(Be.$context),je[gu].push(Be),E.push(Be);H.restore(),cp(v._listeners,z.listeners,{merger:function(He,Xe,it){Xe[He]=Xe[He]||{},Xe[He][s.index]=it[He],v._listened=!0}})},afterUpdate:function(d){d[gu]._labels=pT.prepare(d[gu]._datasets)},afterDatasetsDraw:function(d){pT.draw(d,d[gu]._labels)},beforeEvent:function(d,s){if(d[gu]._listened){var h=s.event;switch(h.type){case"mousemove":case"mouseout":C4(d,h);break;case"click":A4(d,h);break}}},afterEvent:function(d){var s=d[gu],h=s._actives,_=s._actives=d.getActiveElements(),v=fT.arrayDiff(h,_),E,C,r,z,N,H,K;for(E=0,C=v.length;E<C;++E)if(N=v[E],N[1])for(K=N[0].element[gu]||[],r=0,z=K.length;r<z;++r)H=K[r],H.$context.active=N[1]===1,H.update(H.$context);(s._dirty||v.length)&&(pT.update(s._labels),d.render()),delete s._dirty}},y2={exports:{}},xC={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(){var d=Ct,s=Symbol.for("react.element"),h=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),v=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),r=Symbol.for("react.context"),z=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),K=Symbol.for("react.memo"),ne=Symbol.for("react.lazy"),ue=Symbol.for("react.offscreen"),pe=Symbol.iterator,xe="@@iterator";function be(ie){if(ie===null||typeof ie!="object")return null;var W=pe&&ie[pe]||ie[xe];return typeof W=="function"?W:null}var je=d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function Be(ie){{for(var W=arguments.length,X=new Array(W>1?W-1:0),he=1;he<W;he++)X[he-1]=arguments[he];He("error",ie,X)}}function He(ie,W,X){{var he=je.ReactDebugCurrentFrame,we=he.getStackAddendum();we!==""&&(W+="%s",X=X.concat([we]));var ye=X.map(function(Me){return String(Me)});ye.unshift("Warning: "+W),Function.prototype.apply.call(console[ie],console,ye)}}var Xe=!1,it=!1,kt=!1,Nt=!1,oi=!1,yi;yi=Symbol.for("react.module.reference");function Ui(ie){return!!(typeof ie=="string"||typeof ie=="function"||ie===_||ie===E||oi||ie===v||ie===N||ie===H||Nt||ie===ue||Xe||it||kt||typeof ie=="object"&&ie!==null&&(ie.$$typeof===ne||ie.$$typeof===K||ie.$$typeof===C||ie.$$typeof===r||ie.$$typeof===z||ie.$$typeof===yi||ie.getModuleId!==void 0))}function hi(ie,W,X){var he=ie.displayName;if(he)return he;var we=W.displayName||W.name||"";return we!==""?X+"("+we+")":X}function Ti(ie){return ie.displayName||"Context"}function Dt(ie){if(ie==null)return null;if(typeof ie.tag=="number"&&Be("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof ie=="function")return ie.displayName||ie.name||null;if(typeof ie=="string")return ie;switch(ie){case _:return"Fragment";case h:return"Portal";case E:return"Profiler";case v:return"StrictMode";case N:return"Suspense";case H:return"SuspenseList"}if(typeof ie=="object")switch(ie.$$typeof){case r:var W=ie;return Ti(W)+".Consumer";case C:var X=ie;return Ti(X._context)+".Provider";case z:return hi(ie,ie.render,"ForwardRef");case K:var he=ie.displayName||null;return he!==null?he:Dt(ie.type)||"Memo";case ne:{var we=ie,ye=we._payload,Me=we._init;try{return Dt(Me(ye))}catch{return null}}}return null}var Di=Object.assign,Qt=0,ui,ri,zi,En,hr,wr,Jn;function xn(){}xn.__reactDisabledLog=!0;function mr(){{if(Qt===0){ui=console.log,ri=console.info,zi=console.warn,En=console.error,hr=console.group,wr=console.groupCollapsed,Jn=console.groupEnd;var ie={configurable:!0,enumerable:!0,value:xn,writable:!0};Object.defineProperties(console,{info:ie,log:ie,warn:ie,error:ie,group:ie,groupCollapsed:ie,groupEnd:ie})}Qt++}}function Va(){{if(Qt--,Qt===0){var ie={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Di({},ie,{value:ui}),info:Di({},ie,{value:ri}),warn:Di({},ie,{value:zi}),error:Di({},ie,{value:En}),group:Di({},ie,{value:hr}),groupCollapsed:Di({},ie,{value:wr}),groupEnd:Di({},ie,{value:Jn})})}Qt<0&&Be("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var Aa=je.ReactCurrentDispatcher,Gi;function Cn(ie,W,X){{if(Gi===void 0)try{throw Error()}catch(we){var he=we.stack.trim().match(/\n( *(at )?)/);Gi=he&&he[1]||""}return`
`+Gi+ie}}var Vi=!1,Rn;{var gr=typeof WeakMap=="function"?WeakMap:Map;Rn=new gr}function za(ie,W){if(!ie||Vi)return"";{var X=Rn.get(ie);if(X!==void 0)return X}var he;Vi=!0;var we=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var ye;ye=Aa.current,Aa.current=null,mr();try{if(W){var Me=function(){throw Error()};if(Object.defineProperty(Me.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Me,[])}catch(_i){he=_i}Reflect.construct(ie,[],Me)}else{try{Me.call()}catch(_i){he=_i}ie.call(Me.prototype)}}else{try{throw Error()}catch(_i){he=_i}ie()}}catch(_i){if(_i&&he&&typeof _i.stack=="string"){for(var Ve=_i.stack.split(`
`),Le=he.stack.split(`
`),$e=Ve.length-1,gt=Le.length-1;$e>=1&&gt>=0&&Ve[$e]!==Le[gt];)gt--;for(;$e>=1&&gt>=0;$e--,gt--)if(Ve[$e]!==Le[gt]){if($e!==1||gt!==1)do if($e--,gt--,gt<0||Ve[$e]!==Le[gt]){var ut=`
`+Ve[$e].replace(" at new "," at ");return ie.displayName&&ut.includes("<anonymous>")&&(ut=ut.replace("<anonymous>",ie.displayName)),typeof ie=="function"&&Rn.set(ie,ut),ut}while($e>=1&&gt>=0);break}}}finally{Vi=!1,Aa.current=ye,Va(),Error.prepareStackTrace=we}var Kt=ie?ie.displayName||ie.name:"",Ci=Kt?Cn(Kt):"";return typeof ie=="function"&&Rn.set(ie,Ci),Ci}function Bn(ie,W,X){return za(ie,!1)}function eo(ie){var W=ie.prototype;return!!(W&&W.isReactComponent)}function jr(ie,W,X){if(ie==null)return"";if(typeof ie=="function")return za(ie,eo(ie));if(typeof ie=="string")return Cn(ie);switch(ie){case N:return Cn("Suspense");case H:return Cn("SuspenseList")}if(typeof ie=="object")switch(ie.$$typeof){case z:return Bn(ie.render);case K:return jr(ie.type,W,X);case ne:{var he=ie,we=he._payload,ye=he._init;try{return jr(ye(we),W,X)}catch{}}}return""}var Zr=Object.prototype.hasOwnProperty,to={},Pr=je.ReactDebugCurrentFrame;function Do(ie){if(ie){var W=ie._owner,X=jr(ie.type,ie._source,W?W.type:null);Pr.setExtraStackFrame(X)}else Pr.setExtraStackFrame(null)}function mo(ie,W,X,he,we){{var ye=Function.call.bind(Zr);for(var Me in ie)if(ye(ie,Me)){var Ve=void 0;try{if(typeof ie[Me]!="function"){var Le=Error((he||"React class")+": "+X+" type `"+Me+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof ie[Me]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw Le.name="Invariant Violation",Le}Ve=ie[Me](W,Me,he,X,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch($e){Ve=$e}Ve&&!(Ve instanceof Error)&&(Do(we),Be("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",he||"React class",X,Me,typeof Ve),Do(null)),Ve instanceof Error&&!(Ve.message in to)&&(to[Ve.message]=!0,Do(we),Be("Failed %s type: %s",X,Ve.message),Do(null))}}}var ha=Array.isArray;function Ra(ie){return ha(ie)}function bo(ie){{var W=typeof Symbol=="function"&&Symbol.toStringTag,X=W&&ie[Symbol.toStringTag]||ie.constructor.name||"Object";return X}}function Fa(ie){try{return wa(ie),!1}catch{return!0}}function wa(ie){return""+ie}function Na(ie){if(Fa(ie))return Be("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",bo(ie)),wa(ie)}var qa=je.ReactCurrentOwner,xs={key:!0,ref:!0,__self:!0,__source:!0},ja,Pi;function rn(ie){if(Zr.call(ie,"ref")){var W=Object.getOwnPropertyDescriptor(ie,"ref").get;if(W&&W.isReactWarning)return!1}return ie.ref!==void 0}function Qn(ie){if(Zr.call(ie,"key")){var W=Object.getOwnPropertyDescriptor(ie,"key").get;if(W&&W.isReactWarning)return!1}return ie.key!==void 0}function Fr(ie,W){typeof ie.ref=="string"&&qa.current}function Un(ie,W){{var X=function(){ja||(ja=!0,Be("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",W))};X.isReactWarning=!0,Object.defineProperty(ie,"key",{get:X,configurable:!0})}}function da(ie,W){{var X=function(){Pi||(Pi=!0,Be("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",W))};X.isReactWarning=!0,Object.defineProperty(ie,"ref",{get:X,configurable:!0})}}var _a=function(ie,W,X,he,we,ye,Me){var Ve={$$typeof:s,type:ie,key:W,ref:X,props:Me,_owner:ye};return Ve._store={},Object.defineProperty(Ve._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(Ve,"_self",{configurable:!1,enumerable:!1,writable:!1,value:he}),Object.defineProperty(Ve,"_source",{configurable:!1,enumerable:!1,writable:!1,value:we}),Object.freeze&&(Object.freeze(Ve.props),Object.freeze(Ve)),Ve};function Ga(ie,W,X,he,we){{var ye,Me={},Ve=null,Le=null;X!==void 0&&(Na(X),Ve=""+X),Qn(W)&&(Na(W.key),Ve=""+W.key),rn(W)&&(Le=W.ref,Fr(W,we));for(ye in W)Zr.call(W,ye)&&!xs.hasOwnProperty(ye)&&(Me[ye]=W[ye]);if(ie&&ie.defaultProps){var $e=ie.defaultProps;for(ye in $e)Me[ye]===void 0&&(Me[ye]=$e[ye])}if(Ve||Le){var gt=typeof ie=="function"?ie.displayName||ie.name||"Unknown":ie;Ve&&Un(Me,gt),Le&&da(Me,gt)}return _a(ie,Ve,Le,we,he,qa.current,Me)}}var Vr=je.ReactCurrentOwner,xr=je.ReactDebugCurrentFrame;function _n(ie){if(ie){var W=ie._owner,X=jr(ie.type,ie._source,W?W.type:null);xr.setExtraStackFrame(X)}else xr.setExtraStackFrame(null)}var aa;aa=!1;function wo(ie){return typeof ie=="object"&&ie!==null&&ie.$$typeof===s}function go(){{if(Vr.current){var ie=Dt(Vr.current.type);if(ie)return`

Check the render method of \``+ie+"`."}return""}}function no(ie){return""}var tc={};function ml(ie){{var W=go();if(!W){var X=typeof ie=="string"?ie:ie.displayName||ie.name;X&&(W=`

Check the top-level render call using <`+X+">.")}return W}}function ic(ie,W){{if(!ie._store||ie._store.validated||ie.key!=null)return;ie._store.validated=!0;var X=ml(W);if(tc[X])return;tc[X]=!0;var he="";ie&&ie._owner&&ie._owner!==Vr.current&&(he=" It was passed a child from "+Dt(ie._owner.type)+"."),_n(ie),Be('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',X,he),_n(null)}}function Ks(ie,W){{if(typeof ie!="object")return;if(Ra(ie))for(var X=0;X<ie.length;X++){var he=ie[X];wo(he)&&ic(he,W)}else if(wo(ie))ie._store&&(ie._store.validated=!0);else if(ie){var we=be(ie);if(typeof we=="function"&&we!==ie.entries)for(var ye=we.call(ie),Me;!(Me=ye.next()).done;)wo(Me.value)&&ic(Me.value,W)}}}function vt(ie){{var W=ie.type;if(W==null||typeof W=="string")return;var X;if(typeof W=="function")X=W.propTypes;else if(typeof W=="object"&&(W.$$typeof===z||W.$$typeof===K))X=W.propTypes;else return;if(X){var he=Dt(W);mo(X,ie.props,"prop",he,ie)}else if(W.PropTypes!==void 0&&!aa){aa=!0;var we=Dt(W);Be("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",we||"Unknown")}typeof W.getDefaultProps=="function"&&!W.getDefaultProps.isReactClassApproved&&Be("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function To(ie){{for(var W=Object.keys(ie.props),X=0;X<W.length;X++){var he=W[X];if(he!=="children"&&he!=="key"){_n(ie),Be("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",he),_n(null);break}}ie.ref!==null&&(_n(ie),Be("Invalid attribute `ref` supplied to `React.Fragment`."),_n(null))}}var Go={};function Mo(ie,W,X,he,we,ye){{var Me=Ui(ie);if(!Me){var Ve="";(ie===void 0||typeof ie=="object"&&ie!==null&&Object.keys(ie).length===0)&&(Ve+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var Le=no();Le?Ve+=Le:Ve+=go();var $e;ie===null?$e="null":Ra(ie)?$e="array":ie!==void 0&&ie.$$typeof===s?($e="<"+(Dt(ie.type)||"Unknown")+" />",Ve=" Did you accidentally export a JSX literal instead of a component?"):$e=typeof ie,Be("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",$e,Ve)}var gt=Ga(ie,W,X,we,ye);if(gt==null)return gt;if(Me){var ut=W.children;if(ut!==void 0)if(he)if(Ra(ut)){for(var Kt=0;Kt<ut.length;Kt++)Ks(ut[Kt],ie);Object.freeze&&Object.freeze(ut)}else Be("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else Ks(ut,ie)}if(Zr.call(W,"key")){var Ci=Dt(ie),_i=Object.keys(W).filter(function(ln){return ln!=="key"}),Yt=_i.length>0?"{key: someKey, "+_i.join(": ..., ")+": ...}":"{key: someKey}";if(!Go[Ci+Yt]){var Yi=_i.length>0?"{"+_i.join(": ..., ")+": ...}":"{}";Be(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Yt,Ci,Yi,Ci),Go[Ci+Yt]=!0}}return ie===_?To(gt):vt(gt),gt}}function cn(ie,W,X){return Mo(ie,W,X,!0)}function Za(ie,W,X){return Mo(ie,W,X,!1)}var et=Za,vi=cn;xC.Fragment=_,xC.jsx=et,xC.jsxs=vi})();y2.exports=xC;var I4=y2.exports;const v2="label";function mO(d,s){typeof d=="function"?d(s):d&&(d.current=s)}function D4(d,s){const h=d.options;h&&s&&Object.assign(h,s)}function x2(d,s){d.labels=s}function b2(d,s,h=v2){const _=[];d.datasets=s.map(v=>{const E=d.datasets.find(C=>C[h]===v[h]);return!E||!v.data||_.includes(E)?{...v}:(_.push(E),Object.assign(E,v),E)})}function M4(d,s=v2){const h={labels:[],datasets:[]};return x2(h,d.labels),b2(h,d.datasets,s),h}function P4(d,s){const{height:h=150,width:_=300,redraw:v=!1,datasetIdKey:E,type:C,data:r,options:z,plugins:N=[],fallbackContent:H,updateMode:K,...ne}=d,ue=Ct.useRef(null),pe=Ct.useRef(null),xe=()=>{ue.current&&(pe.current=new hD(ue.current,{type:C,data:M4(r,E),options:z&&{...z},plugins:N}),mO(s,pe.current))},be=()=>{mO(s,null),pe.current&&(pe.current.destroy(),pe.current=null)};return Ct.useEffect(()=>{!v&&pe.current&&z&&D4(pe.current,z)},[v,z]),Ct.useEffect(()=>{!v&&pe.current&&x2(pe.current.config.data,r.labels)},[v,r.labels]),Ct.useEffect(()=>{!v&&pe.current&&r.datasets&&b2(pe.current.config.data,r.datasets,E)},[v,r.datasets]),Ct.useEffect(()=>{pe.current&&(v?(be(),setTimeout(xe)):pe.current.update(K))},[v,z,r.labels,r.datasets,K]),Ct.useEffect(()=>{pe.current&&(be(),setTimeout(xe))},[C]),Ct.useEffect(()=>(xe(),()=>be()),[]),I4.jsx("canvas",{ref:ue,role:"img",height:h,width:_,...ne,children:H})}const gO=Ct.forwardRef(P4);function O4(d,s){const{getAccessTokenSilently:h}=BC(),[_,v]=Ct.useState([]),[E,C]=Ct.useState([]),[r,z]=Ct.useState([]),[N,H]=Ct.useState(!1),[K,ne]=Ct.useState(null);return Ct.useEffect(()=>{if(!d){v([]),C([]),z([]),H(!1);return}let ue=!1;return H(!0),ne(null),(async()=>{var xe,be,je,Be,He,Xe,it,kt,Nt,oi,yi,Ui,hi,Ti,Dt,Di;try{const Qt=await h(),ui={fieldId:d};s!=null&&s.specie&&(ui.specie=s.specie),s!=null&&s.variety&&(ui.variety=s.variety),s!=null&&s.startDate&&(ui.startDate=s.startDate),s!=null&&s.endDate&&(ui.endDate=s.endDate),s!=null&&s.harvestName&&(ui.harvestName=s.harvestName),console.log(" Loading harvest summary with params:",ui);const ri={Authorization:`Bearer ${Qt}`},[zi,En,hr]=await Promise.all([sp.get("/analytics/harvests/summary",{params:ui,headers:ri}),sp.get("/analytics/harvests/summary/timeline",{params:ui,headers:ri}),sp.get("/analytics/harvests/summary/payments/timeline",{params:ui,headers:ri})]);if(ue)return;console.log(" SUMMARY DATA:",(xe=zi.data)==null?void 0:xe.data),console.log(" TIMELINE DATA:",(be=En.data)==null?void 0:be.data),console.log(" PAYMENTS DATA:",(je=hr.data)==null?void 0:je.data),((He=(Be=zi.data)==null?void 0:Be.data)==null?void 0:He.length)>0?(console.log(" Summary tiene",zi.data.data.length,"registros"),console.log("   Primer registro:",zi.data.data[0])):console.warn(" Summary est VACO"),((it=(Xe=En.data)==null?void 0:Xe.data)==null?void 0:it.length)>0?(console.log(" Timeline tiene",En.data.data.length,"registros"),console.log("   Primer registro:",En.data.data[0]),console.log("   ltimo registro:",En.data.data[En.data.data.length-1])):console.warn(" Timeline est VACO"),((Nt=(kt=hr.data)==null?void 0:kt.data)==null?void 0:Nt.length)>0?(console.log(" Payments tiene",hr.data.data.length,"registros"),console.log("   Primer registro:",hr.data.data[0]),console.log("   ltimo registro:",hr.data.data[hr.data.data.length-1])):console.warn(" Payments est VACO"),v(((oi=zi.data)==null?void 0:oi.data)??[]),C(((yi=En.data)==null?void 0:yi.data)??[]),z(((Ui=hr.data)==null?void 0:Ui.data)??[])}catch(Qt){ue||(console.error(" Error loading harvest summary:",Qt),console.error(" Error details:",{message:Qt==null?void 0:Qt.message,response:(hi=Qt==null?void 0:Qt.response)==null?void 0:hi.data,status:(Ti=Qt==null?void 0:Qt.response)==null?void 0:Ti.status}),ne(((Di=(Dt=Qt==null?void 0:Qt.response)==null?void 0:Dt.data)==null?void 0:Di.message)??"Error al cargar datos"),v([]),C([]),z([]))}finally{ue||H(!1)}})(),()=>{ue=!0}},[d,s==null?void 0:s.specie,s==null?void 0:s.variety,s==null?void 0:s.startDate,s==null?void 0:s.endDate,s==null?void 0:s.harvestName,h]),{summary:_,timeline:E,payments:r,loading:N,error:K}}hD.register(CI,AI,gC,_C,dT,nT,hT,J5,H5,R4);function _O(d){const s=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],h=d.map(r=>{let z;r.includes("T")?z=new Date(r):z=new Date(r+"T12:00:00Z");const N=z.getUTCDate(),H=z.getUTCMonth();return{day:N,month:H,valid:!isNaN(N)&&!isNaN(H)}}),_=[],v=[];let E=-1,C=0;if(h.forEach((r,z)=>{if(!r.valid){_.push("?");return}if(_.push(r.day.toString()),r.month!==E){if(E!==-1){const N=Math.floor((C+z-1)/2);v.push({index:N,label:s[E]})}E=r.month,C=z}}),E!==-1){const r=Math.floor((C+h.length-1)/2);v.push({index:r,label:s[E]})}return{labels:_,months:v}}function k4({fieldId:d,fieldName:s,filters:h}){const[_,v]=Ct.useState(!0),[E,C]=Ct.useState(""),[r,z]=Ct.useState("");Ct.useEffect(()=>{C((h==null?void 0:h.initialStartDate)??""),z((h==null?void 0:h.initialEndDate)??"")},[h==null?void 0:h.initialStartDate,h==null?void 0:h.initialEndDate]);const{summary:N,timeline:H,payments:K,loading:ne,error:ue}=O4(d,{specie:h==null?void 0:h.specie,variety:h==null?void 0:h.variety,startDate:E||void 0,endDate:r||void 0,harvestName:h==null?void 0:h.harvestName});Ct.useMemo(()=>{var hi,Ti,Dt,Di,Qt,ui;if(!N.length)return{kg_totales:0,superficie_ha:0,kg_por_ha:0,kg_por_cosechero:0,pct_exportacion_campo:0,pct_mercado_interno:0,pct_exportacion_procesos:0,pct_exportacion_final:0};const He=N.reduce((ri,zi)=>ri+Number(zi.kg_totales??0),0),Xe=Number(((hi=N[0])==null?void 0:hi.superficie_ha)??0),it=Xe>0?He/Xe:0,kt=Number(((Ti=N[0])==null?void 0:Ti.kg_por_cosechero)??0),Nt=Number(((Dt=N[0])==null?void 0:Dt.pct_exportacion_campo)??0),oi=Number(((Di=N[0])==null?void 0:Di.pct_mercado_interno)??0),yi=Number(((Qt=N[0])==null?void 0:Qt.pct_exportacion_procesos)??0),Ui=Number(((ui=N[0])==null?void 0:ui.pct_exportacion_final)??0);return{kg_totales:He,superficie_ha:Xe,kg_por_ha:it,kg_por_cosechero:kt,pct_exportacion_campo:Nt,pct_mercado_interno:oi,pct_exportacion_procesos:yi,pct_exportacion_final:Ui}},[N]);const pe=Ct.useMemo(()=>{if(!H.length)return null;const{labels:He,months:Xe}=_O(H.map(kt=>kt.fecha)),it=H.map(kt=>{const Nt=Number(kt.kg_exportacion)+Number(kt.kg_mercado_interno);if(Nt===0)return{exp:0,int:0};const oi=Math.round(Number(kt.kg_exportacion)/Nt*100),yi=Math.round(Number(kt.kg_mercado_interno)/Nt*100);return{exp:oi,int:yi}});return{labels:He,datasets:[{type:"bar",label:"Kg Exportacin Campo",data:H.map(kt=>Number(kt.kg_exportacion)),backgroundColor:"#FF8C42",stack:"stack0",yAxisID:"y",barThickness:"flex",maxBarThickness:35,order:2,datalabels:{display:kt=>it[kt.dataIndex].exp>=5,color:"#000",font:{size:8,weight:"bold"},formatter:(kt,Nt)=>`${it[Nt.dataIndex].exp}%`,anchor:"center",align:"center"}},{type:"bar",label:"Kg Mercado Interno",data:H.map(kt=>Number(kt.kg_mercado_interno)),backgroundColor:"#90C695",stack:"stack0",yAxisID:"y",barThickness:"flex",maxBarThickness:35,order:2,datalabels:{display:kt=>it[kt.dataIndex].int>=5,color:"#000",font:{size:8,weight:"bold"},formatter:(kt,Nt)=>`${it[Nt.dataIndex].int}%`,anchor:"center",align:"center"}},{type:"line",label:"Cosecheros",data:H.map(kt=>Number(kt.cosecheros??0)),borderColor:"#F4C430",backgroundColor:"#F4C430",borderWidth:2,pointRadius:6,pointHoverRadius:8,pointStyle:"circle",yAxisID:"y1",tension:0,order:1,datalabels:{display:!0,color:"#000",backgroundColor:"#F4C430",borderRadius:3,font:{size:8,weight:"bold"},padding:2,formatter:kt=>kt>0?kt:"",anchor:"end",align:"top",offset:2}}],months:Xe}},[H]),xe=Ct.useMemo(()=>{if(!K.length)return null;const{labels:He,months:Xe}=_O(K.map(it=>it.fecha));return{labels:He,datasets:[{type:"bar",label:"Kg/Cosechero",data:K.map(it=>Number(it.kg_por_cosechero)),backgroundColor:"#90C695",yAxisID:"y",barThickness:"flex",maxBarThickness:40,order:2,datalabels:{display:it=>it.dataset.data[it.dataIndex]>0,color:"#fff",font:{size:9,weight:"bold"},formatter:it=>it===0?"":it>=1e3?Math.round(it/100)/10+"k":Math.round(it),anchor:"center",align:"center"}},{type:"line",label:"Pago/Kg",data:K.map(it=>Number(it.pago_kg??0)),borderColor:"#4A90E2",backgroundColor:"#4A90E2",borderWidth:2,pointRadius:6,pointHoverRadius:8,pointStyle:"circle",yAxisID:"y1",tension:0,order:1,datalabels:{display:!0,color:"#fff",backgroundColor:"#4A90E2",borderRadius:3,font:{size:8,weight:"bold"},padding:2,formatter:it=>it>0?Math.round(it):"",anchor:"end",align:"top",offset:2}}],months:Xe}},[K]),be=Ct.useMemo(()=>({id:"monthsPlugin",afterDraw(He){const{ctx:Xe,chartArea:it,scales:kt}=He,Nt=He.data.months;!Nt||Nt.length===0||(Xe.save(),Xe.font="bold 12px Arial",Xe.fillStyle="#374151",Xe.textAlign="center",Nt.forEach(oi=>{const yi=kt.x.getPixelForValue(oi.index),Ui=it.bottom+35;Xe.fillText(oi.label,yi,Ui)}),Xe.restore())}}),[]),je=Ct.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{y:{type:"linear",display:!0,position:"left",stacked:!0,title:{display:!1},ticks:{callback:function(He){return He>=1e3?(He/1e3).toFixed(0)+"k":He.toLocaleString()}},grid:{color:"#e0e0e0"}},y1:{type:"linear",display:!0,position:"right",grid:{drawOnChartArea:!1},title:{display:!1},ticks:{stepSize:20}},x:{stacked:!0,grid:{display:!1},ticks:{font:{size:10,weight:"bold"},maxRotation:0,minRotation:0,autoSkip:!1,color:"#374151"}}},plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:15,font:{size:12,weight:"bold"},color:"#1f2937"}},tooltip:{callbacks:{label:function(He){let Xe=He.dataset.label||"";return Xe&&(Xe+=": "),He.parsed.y!==null&&(Xe+=He.parsed.y.toLocaleString()),Xe}}}},layout:{padding:{top:10,right:10,bottom:50,left:10}},categoryPercentage:.9,barPercentage:.85}),[]),Be=Ct.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{y:{type:"linear",display:!0,position:"left",title:{display:!1},ticks:{callback:function(He){return He>=1e3?(He/1e3).toFixed(1)+"k":He.toLocaleString()}},grid:{color:"#e0e0e0"}},y1:{type:"linear",display:!0,position:"right",grid:{drawOnChartArea:!1},title:{display:!1},ticks:{callback:function(He){return"$"+He.toLocaleString()}}},x:{grid:{display:!1},ticks:{font:{size:10,weight:"bold"},maxRotation:0,minRotation:0,color:"#374151"}}},plugins:{legend:{position:"top",labels:{usePointStyle:!0,padding:15,font:{size:12,weight:"bold"},color:"#1f2937"}},tooltip:{callbacks:{label:function(He){let Xe=He.dataset.label||"";return Xe&&(Xe+=": "),He.parsed.y!==null&&(He.datasetIndex===1?Xe+="$"+He.parsed.y.toLocaleString():Xe+=He.parsed.y.toLocaleString()),Xe}}}},layout:{padding:{top:10,right:10,bottom:50,left:10}},categoryPercentage:.8,barPercentage:.9}),[]);return Ut.jsxDEV("div",{className:"box",style:{backgroundColor:"#fff"},children:[Ut.jsxDEV("header",{className:"is-flex is-justify-content-space-between is-align-items-center",onClick:()=>v(He=>!He),style:{cursor:"pointer",borderBottom:"2px solid #f0f0f0",paddingBottom:"1rem"},children:[Ut.jsxDEV("div",{children:[Ut.jsxDEV("h3",{className:"title is-5",style:{marginBottom:"0.25rem"},children:" Informe de Cosecha"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:512,columnNumber:11},this),Ut.jsxDEV("p",{className:"is-size-7 has-text-grey",children:["Campo: ",s]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:513,columnNumber:11},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:511,columnNumber:9},this),Ut.jsxDEV("button",{className:"button is-small is-ghost",children:_?"":""},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:515,columnNumber:9},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:506,columnNumber:7},this),_&&Ut.jsxDEV("div",{className:"mt-4",children:[ne&&Ut.jsxDEV("progress",{className:"progress is-primary",max:"100",children:"Cargando..."},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:524,columnNumber:13},this),ue&&Ut.jsxDEV("div",{className:"notification is-danger",children:Ut.jsxDEV("p",{children:[Ut.jsxDEV("strong",{children:"Error:"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:531,columnNumber:18},this)," ",ue]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:531,columnNumber:15},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:530,columnNumber:13},this),!ne&&!ue&&N.length===0&&Ut.jsxDEV("div",{className:"notification is-warning",children:Ut.jsxDEV("p",{className:"has-text-weight-bold mb-2",children:"No hay datos disponibles."},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:537,columnNumber:15},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:536,columnNumber:13},this),!ne&&!ue&&N.length>0&&Ut.jsxDEV(Ut.Fragment,{children:[Ut.jsxDEV("div",{className:"box",style:{backgroundColor:"#fff",border:"1px solid #dee2e6"},children:Ut.jsxDEV("div",{className:"table-container",children:Ut.jsxDEV("table",{className:"table is-fullwidth is-bordered is-hoverable",style:{fontSize:"0.9rem"},children:[Ut.jsxDEV("thead",{children:Ut.jsxDEV("tr",{style:{backgroundColor:"#1f2937",color:"#fff"},children:[Ut.jsxDEV("th",{children:"Variedad"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:549,columnNumber:25},this),Ut.jsxDEV("th",{children:"Kg Totales"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:550,columnNumber:25},this),Ut.jsxDEV("th",{children:"Superficie"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:551,columnNumber:25},this),Ut.jsxDEV("th",{children:"Kg/ha"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:552,columnNumber:25},this),Ut.jsxDEV("th",{children:"Costo/Kg"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:553,columnNumber:25},this),Ut.jsxDEV("th",{children:"Pago/Kg"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:554,columnNumber:25},this),Ut.jsxDEV("th",{children:"Kg/Cosechero"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:555,columnNumber:25},this),Ut.jsxDEV("th",{children:"% M. Interno"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:556,columnNumber:25},this),Ut.jsxDEV("th",{children:"% Exp. Campo"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:557,columnNumber:25},this),Ut.jsxDEV("th",{children:"% Exp. Procesos"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:558,columnNumber:25},this),Ut.jsxDEV("th",{children:"% Exp. Final"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:559,columnNumber:25},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:548,columnNumber:23},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:547,columnNumber:21},this),Ut.jsxDEV("tbody",{children:N.map((He,Xe)=>Ut.jsxDEV("tr",{children:[Ut.jsxDEV("td",{children:Ut.jsxDEV("strong",{children:He.variety??""},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:565,columnNumber:31},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:565,columnNumber:27},this),Ut.jsxDEV("td",{children:Number(He.kg_totales??0).toLocaleString()},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:566,columnNumber:27},this),Ut.jsxDEV("td",{children:Number(He.superficie_ha??0).toFixed(2)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:567,columnNumber:27},this),Ut.jsxDEV("td",{children:Number(He.kg_por_ha??0).toLocaleString()},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:568,columnNumber:27},this),Ut.jsxDEV("td",{children:He.costo_total_kg?Number(He.costo_total_kg).toFixed(2):""},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:569,columnNumber:27},this),Ut.jsxDEV("td",{children:He.pago_kg?Number(He.pago_kg).toLocaleString():""},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:570,columnNumber:27},this),Ut.jsxDEV("td",{children:Number(He.kg_por_cosechero??0).toLocaleString()},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:571,columnNumber:27},this),Ut.jsxDEV("td",{children:[Number(He.pct_mercado_interno??0).toFixed(0),"%"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:572,columnNumber:27},this),Ut.jsxDEV("td",{children:[Number(He.pct_exportacion_campo??0).toFixed(0),"%"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:573,columnNumber:27},this),Ut.jsxDEV("td",{children:[Number(He.pct_exportacion_procesos??0).toFixed(0),"%"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:574,columnNumber:27},this),Ut.jsxDEV("td",{children:[Number(He.pct_exportacion_final??0).toFixed(0),"%"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:575,columnNumber:27},this)]},Xe,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:564,columnNumber:25},this))},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:562,columnNumber:21},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:546,columnNumber:19},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:545,columnNumber:17},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:544,columnNumber:15},this),pe&&Ut.jsxDEV("div",{className:"box",style:{backgroundColor:"#fff",border:"1px solid #dee2e6"},children:[Ut.jsxDEV("h4",{className:"title is-5 mb-4",style:{textTransform:"uppercase",fontSize:"1.1rem",fontWeight:"bold",color:"#1f2937",textAlign:"center",letterSpacing:"0.5px"},children:"KILOS COSECHADOS Y CANTIDAD COSECHEROS"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:586,columnNumber:19},this),Ut.jsxDEV("div",{style:{height:"500px"},children:Ut.jsxDEV(gO,{type:"bar",data:pe,options:je,plugins:[be]},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:600,columnNumber:21},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:599,columnNumber:19},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:585,columnNumber:17},this),xe&&Ut.jsxDEV("div",{className:"box",style:{backgroundColor:"#fff",border:"1px solid #dee2e6"},children:[Ut.jsxDEV("h4",{className:"title is-5 mb-4",style:{textTransform:"uppercase",fontSize:"1.1rem",fontWeight:"bold",color:"#1f2937",textAlign:"center",letterSpacing:"0.5px"},children:"KG/PERSONA Y PAGO/KG"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:613,columnNumber:19},this),Ut.jsxDEV("div",{style:{height:"500px"},children:Ut.jsxDEV(gO,{type:"bar",data:xe,options:Be,plugins:[be]},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:627,columnNumber:21},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:626,columnNumber:19},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:612,columnNumber:17},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:542,columnNumber:13},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:522,columnNumber:9},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/components/CollapsibleAnalyticsPanel.tsx",lineNumber:504,columnNumber:5},this)}/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L4=d=>d.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),z4=d=>d.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,h,_)=>_?_.toUpperCase():h.toLowerCase()),yO=d=>{const s=z4(d);return s.charAt(0).toUpperCase()+s.slice(1)},w2=(...d)=>d.filter((s,h,_)=>!!s&&s.trim()!==""&&_.indexOf(s)===h).join(" ").trim(),F4=d=>{for(const s in d)if(s.startsWith("aria-")||s==="role"||s==="title")return!0};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var N4={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B4=Ct.forwardRef(({color:d="currentColor",size:s=24,strokeWidth:h=2,absoluteStrokeWidth:_,className:v="",children:E,iconNode:C,...r},z)=>Ct.createElement("svg",{ref:z,...N4,width:s,height:s,stroke:d,strokeWidth:_?Number(h)*24/Number(s):h,className:w2("lucide",v),...!E&&!F4(r)&&{"aria-hidden":"true"},...r},[...C.map(([N,H])=>Ct.createElement(N,H)),...Array.isArray(E)?E:[E]]));/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U4=(d,s)=>{const h=Ct.forwardRef(({className:_,...v},E)=>Ct.createElement(B4,{ref:E,iconNode:s,className:w2(`lucide-${L4(yO(d))}`,`lucide-${d}`,_),...v}));return h.displayName=yO(d),h};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V4=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],j4=U4("calendar",V4);function G4(d){if(!d)return{start:void 0,end:void 0};const s=d.match(/\d{4}/g);if(s&&s.length>=1){s.sort();const h=s[0],_=s[s.length-1];return{start:`${h}-01-01`,end:`${_}-12-31`}}return{start:void 0,end:void 0}}function vO(d){const s=new Date,h=new Date;return h.setDate(h.getDate()-d),{start:h.toISOString().split("T")[0],end:s.toISOString().split("T")[0]}}function H4(){const{user:d,getAccessTokenSilently:s,logout:h}=BC(),[_,v]=Ct.useState(!0),[E,C]=Ct.useState([]),[r,z]=Ct.useState(null),[N,H]=Ct.useState(null),[K,ne]=Ct.useState([]),[ue,pe]=Ct.useState([]),[xe,be]=Ct.useState([]),[je,Be]=Ct.useState(null),[He,Xe]=Ct.useState(null),[it,kt]=Ct.useState(null),[Nt,oi]=Ct.useState(!1),[yi,Ui]=Ct.useState(""),[hi,Ti]=Ct.useState(""),[Dt,Di]=Ct.useState("20days"),[Qt,ui]=Ct.useState([]),[ri,zi]=Ct.useState(5),[En,hr]=Ct.useState("desc");Ct.useEffect(()=>{(async()=>{try{const Cn=await s(),Vi=await sp.get("/fields",{headers:{Authorization:`Bearer ${Cn}`}});C(Vi.data)}finally{v(!1)}})()},[]);const wr=async Gi=>{const Cn=await s(),Vi=await sp.get(`/fields/${Gi}`,{headers:{Authorization:`Bearer ${Cn}`}});z(Vi.data)},Jn=async Gi=>{const Cn=await s(),[Vi,Rn]=await Promise.all([sp.get(`/analytics/field/${Gi}/harvests`,{headers:{Authorization:`Bearer ${Cn}`}}),sp.get(`/analytics/field/${Gi}/species-list`,{headers:{Authorization:`Bearer ${Cn}`}})]),gr=Vi.data.data??[];ne(gr),pe(Rn.data.data??[]),Be(gr[0]??null),Xe(null),kt(null),H(null),Di("20days")};Ct.useEffect(()=>{if(!r||!je)return;(async()=>{var Cn;try{const Vi=await s(),Rn=await sp.get("/analytics/harvests/summary",{headers:{Authorization:`Bearer ${Vi}`},params:{fieldId:r.id,harvestName:je,specie:He}});if((Cn=Rn.data)!=null&&Cn.data){const gr=[...new Set(Rn.data.data.map(za=>za.variety).filter(za=>za&&za!=="Sin Variedad"))];be(gr)}}catch(Vi){console.error("Error cargando variedades:",Vi),be([])}})()},[r==null?void 0:r.id,je,He]),Ct.useEffect(()=>{if(!r||!je)return;(async()=>{const Cn=await s(),Vi=await sp.get(`/analytics/field/${r.name}/sectors/production`,{headers:{Authorization:`Bearer ${Cn}`},params:{harvest:je,species:He}});ui(Vi.data.data??[])})()},[r==null?void 0:r.name,je,He]);const xn=Ct.useMemo(()=>Dt==="custom"?{start:yi,end:hi}:Dt==="20days"?vO(20):Dt==="30days"?vO(30):G4(je),[Dt,yi,hi,je]),mr=Ct.useMemo(()=>[...Qt].sort((Cn,Vi)=>En==="desc"?Number(Vi.kg_total)-Number(Cn.kg_total):Number(Cn.kg_total)-Number(Vi.kg_total)).slice(0,ri),[Qt,ri,En]),Va=Math.max(...mr.map(Gi=>Number(Gi.kg_total)),1),Aa=r?{...r,sectors:r.sectors.map(Gi=>{const Cn=Qt.find(Vi=>{var Rn;return((Rn=Vi.sector)==null?void 0:Rn.toLowerCase())===Gi.name.toLowerCase()});return{...Gi,kg_total:Number((Cn==null?void 0:Cn.kg_total)??0),species:(Cn==null?void 0:Cn.specie)??"other"}})}:null;return Ut.jsxDEV("section",{className:"section",children:Ut.jsxDEV("div",{className:"container",children:[Ut.jsxDEV("div",{className:"box has-background-info-light",children:[Ut.jsxDEV("h1",{className:"title is-3",children:" Gestin Agrcola"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:243,columnNumber:11},this),Ut.jsxDEV("p",{className:"subtitle is-6",children:["Usuario: ",Ut.jsxDEV("strong",{children:d==null?void 0:d.email},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:245,columnNumber:22},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:244,columnNumber:11},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:242,columnNumber:9},this),_&&Ut.jsxDEV("progress",{className:"progress is-primary",max:"100"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:249,columnNumber:21},this),Ut.jsxDEV("div",{className:"box",children:[Ut.jsxDEV("label",{className:"label",children:"Campo"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:253,columnNumber:11},this),Ut.jsxDEV("div",{className:"select is-fullwidth",children:Ut.jsxDEV("select",{value:(r==null?void 0:r.id)??"",onChange:async Gi=>{const Cn=E.find(Vi=>String(Vi.id)===Gi.target.value);Cn&&(await wr(Cn.id),await Jn(Cn.name))},children:[Ut.jsxDEV("option",{value:"",children:"-- Selecciona campo --"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:265,columnNumber:15},this),E.map(Gi=>Ut.jsxDEV("option",{value:Gi.id,children:Gi.name},Gi.id,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:267,columnNumber:17},this))]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:255,columnNumber:13},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:254,columnNumber:11},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:252,columnNumber:9},this),r&&Ut.jsxDEV("div",{className:"box",children:[Ut.jsxDEV("div",{className:"columns",children:[Ut.jsxDEV("div",{className:"column",children:[Ut.jsxDEV("label",{className:"label",children:"Cosecha"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:281,columnNumber:17},this),Ut.jsxDEV("div",{className:"select is-fullwidth",children:Ut.jsxDEV("select",{value:je??"",onChange:Gi=>Be(Gi.target.value||null),children:K.map(Gi=>Ut.jsxDEV("option",{value:Gi,children:Gi},Gi,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:288,columnNumber:23},this))},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:283,columnNumber:19},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:282,columnNumber:17},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:280,columnNumber:15},this),Ut.jsxDEV("div",{className:"column",children:[Ut.jsxDEV("label",{className:"label",children:"Especie"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:297,columnNumber:17},this),Ut.jsxDEV("div",{className:"select is-fullwidth",children:Ut.jsxDEV("select",{value:He??"",onChange:Gi=>Xe(Gi.target.value||null),children:[Ut.jsxDEV("option",{value:"",children:"Todas"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:305,columnNumber:21},this),ue.map(Gi=>Ut.jsxDEV("option",{value:Gi,children:Gi},Gi,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:307,columnNumber:23},this))]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:299,columnNumber:19},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:298,columnNumber:17},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:296,columnNumber:15},this),Ut.jsxDEV("div",{className:"column",children:[Ut.jsxDEV("label",{className:"label",children:"Variedad"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:316,columnNumber:17},this),Ut.jsxDEV("div",{className:"select is-fullwidth",children:Ut.jsxDEV("select",{value:it??"",onChange:Gi=>kt(Gi.target.value||null),children:[Ut.jsxDEV("option",{value:"",children:"Todas"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:324,columnNumber:21},this),xe.map(Gi=>Ut.jsxDEV("option",{value:Gi,children:Gi},Gi,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:326,columnNumber:23},this))]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:318,columnNumber:19},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:317,columnNumber:17},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:315,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:279,columnNumber:13},this),Ut.jsxDEV("div",{className:"field is-grouped",style:{marginTop:"1rem"},children:[Ut.jsxDEV("p",{className:"control",children:Ut.jsxDEV("button",{className:`button ${Dt==="20days"?"is-info":"is-light"}`,onClick:()=>Di("20days"),children:"ltimos 20 das"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:338,columnNumber:17},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:337,columnNumber:15},this),Ut.jsxDEV("p",{className:"control",children:Ut.jsxDEV("button",{className:`button ${Dt==="30days"?"is-info":"is-light"}`,onClick:()=>Di("30days"),children:"ltimos 30 das"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:346,columnNumber:17},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:345,columnNumber:15},this),Ut.jsxDEV("p",{className:"control",children:Ut.jsxDEV("button",{className:`button ${Dt==="harvest"?"is-info":"is-light"}`,onClick:()=>Di("harvest"),children:"Rango de cosecha"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:354,columnNumber:17},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:353,columnNumber:15},this),Ut.jsxDEV("p",{className:"control",children:Ut.jsxDEV("button",{className:`button ${Dt==="custom"?"is-info":"is-light"}`,onClick:()=>{Di("custom"),oi(!Nt)},children:[Ut.jsxDEV("span",{className:"icon",children:Ut.jsxDEV(j4,{size:18},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:370,columnNumber:21},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:369,columnNumber:19},this),Ut.jsxDEV("span",{children:"Personalizar"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:372,columnNumber:19},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:362,columnNumber:17},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:361,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:336,columnNumber:13},this),Nt&&Dt==="custom"&&Ut.jsxDEV("div",{className:"box",style:{marginTop:"1rem",backgroundColor:"#f8f9fa"},children:Ut.jsxDEV("div",{className:"columns",children:[Ut.jsxDEV("div",{className:"column",children:[Ut.jsxDEV("label",{className:"label is-small",children:"Fecha Inicio"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:382,columnNumber:21},this),Ut.jsxDEV("input",{type:"date",className:"input",value:yi,onChange:Gi=>Ui(Gi.target.value)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:383,columnNumber:21},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:381,columnNumber:19},this),Ut.jsxDEV("div",{className:"column",children:[Ut.jsxDEV("label",{className:"label is-small",children:"Fecha Fin"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:391,columnNumber:21},this),Ut.jsxDEV("input",{type:"date",className:"input",value:hi,onChange:Gi=>Ti(Gi.target.value)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:392,columnNumber:21},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:390,columnNumber:19},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:380,columnNumber:17},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:379,columnNumber:15},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:277,columnNumber:11},this),Aa&&je&&Ut.jsxDEV("div",{className:"columns",children:[Ut.jsxDEV("div",{className:"column is-7",children:Ut.jsxDEV("div",{className:"box",children:Ut.jsxDEV($B,{field:Aa,height:"450px"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:410,columnNumber:17},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:409,columnNumber:15},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:408,columnNumber:13},this),Ut.jsxDEV("div",{className:"column is-5",children:Ut.jsxDEV("div",{className:"box",children:[Ut.jsxDEV("h3",{className:"title is-5 mb-3",children:"Comparacin de Sectores"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:416,columnNumber:17},this),Ut.jsxDEV("div",{className:"columns is-mobile mb-3",children:[Ut.jsxDEV("div",{className:"column",children:[Ut.jsxDEV("label",{className:"label is-small",children:"Top"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:420,columnNumber:21},this),Ut.jsxDEV("input",{type:"number",min:1,max:20,className:"input",value:ri,onChange:Gi=>zi(Number(Gi.target.value))},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:421,columnNumber:21},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:419,columnNumber:19},this),Ut.jsxDEV("div",{className:"column",children:[Ut.jsxDEV("label",{className:"label is-small",children:"Orden"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:432,columnNumber:21},this),Ut.jsxDEV("div",{className:"select is-fullwidth",children:Ut.jsxDEV("select",{value:En,onChange:Gi=>hr(Gi.target.value),children:[Ut.jsxDEV("option",{value:"desc",children:"Mayor  Menor"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:440,columnNumber:25},this),Ut.jsxDEV("option",{value:"asc",children:"Menor  Mayor"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:441,columnNumber:25},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:434,columnNumber:23},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:433,columnNumber:21},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:431,columnNumber:19},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:418,columnNumber:17},this),mr.map(Gi=>{const Cn=Number(Gi.kg_total)/Va*100,Vi=(N==null?void 0:N.name)===Gi.sector;return Ut.jsxDEV("div",{className:`box mb-2 ${Vi?"has-background-info-light":""}`,style:{cursor:"pointer"},onClick:()=>H({name:Gi.sector}),children:[Ut.jsxDEV("div",{className:"is-flex is-justify-content-space-between",children:[Ut.jsxDEV("strong",{children:Gi.sector},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:461,columnNumber:25},this),Ut.jsxDEV("span",{children:[Number(Gi.kg_total).toLocaleString()," kg"]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:462,columnNumber:25},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:460,columnNumber:23},this),Ut.jsxDEV("progress",{className:"progress is-info mt-2",value:Cn,max:100},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:464,columnNumber:23},this)]},Gi.sector,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:452,columnNumber:21},this)})]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:415,columnNumber:15},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:414,columnNumber:13},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:407,columnNumber:11},this),r&&Ut.jsxDEV(k4,{fieldId:r.id,fieldName:r.name,filters:{specie:He,variety:it,initialStartDate:xn.start,initialEndDate:xn.end,harvestName:je}},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:479,columnNumber:11},this),Ut.jsxDEV("button",{className:"button is-danger mt-5",onClick:()=>h({logoutParams:{returnTo:void 0}}),children:"Cerrar sesin"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:493,columnNumber:9},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:240,columnNumber:7},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Dashboard.tsx",lineNumber:239,columnNumber:5},this)}function $4(){return Ut.jsxDEV("div",{className:"h-screen flex items-center justify-center text-xl",children:"Tu cuenta est en estado pendiente. Contacta al administrador."},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/pages/Pending.tsx",lineNumber:3,columnNumber:5},this)}function W4({children:d}){const{isAuthenticated:s,isLoading:h}=BC();return h?Ut.jsxDEV("div",{children:"Cargando"},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:16,columnNumber:12},this):s?d:Ut.jsxDEV(kO,{to:"/",replace:!0},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:19,columnNumber:39},this)}function q4(){return Ut.jsxDEV(qz,{children:[Ut.jsxDEV(Q1,{path:"/",element:Ut.jsxDEV(dN,{},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:26,columnNumber:32},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:26,columnNumber:7},this),Ut.jsxDEV(Q1,{path:"/dashboard",element:Ut.jsxDEV(W4,{children:Ut.jsxDEV(H4,{},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:33,columnNumber:13},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:32,columnNumber:11},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:29,columnNumber:7},this),Ut.jsxDEV(Q1,{path:"/pendiente",element:Ut.jsxDEV($4,{},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:39,columnNumber:41},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:39,columnNumber:7},this),Ut.jsxDEV(Q1,{path:"*",element:Ut.jsxDEV(kO,{to:"/",replace:!0},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:42,columnNumber:32},this)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:42,columnNumber:7},this)]},void 0,!0,{fileName:"/home/michael/AFT-GESTION/Frontend/src/App.tsx",lineNumber:24,columnNumber:5},this)}sI.createRoot(document.getElementById("root")).render(Ut.jsxDEV(II.StrictMode,{children:Ut.jsxDEV(lF,{children:Ut.jsxDEV(hN,{domain:"dev-2c7hbbihiefpum6a.us.auth0.com",clientId:"rk3uUebq6trvBQAHxT2LUNHARjNXe2fZ",authorizationParams:{redirect_uri:window.location.origin,audience:"https://aft-gestion/api",scope:"openid profile email"},cacheLocation:"localstorage",useRefreshTokens:!0,useRefreshTokensFallback:!0,children:Ut.jsxDEV(q4,{},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/main.tsx",lineNumber:24,columnNumber:9},void 0)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/main.tsx",lineNumber:12,columnNumber:7},void 0)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/main.tsx",lineNumber:11,columnNumber:5},void 0)},void 0,!1,{fileName:"/home/michael/AFT-GESTION/Frontend/src/main.tsx",lineNumber:10,columnNumber:3},void 0));
